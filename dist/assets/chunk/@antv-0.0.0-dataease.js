import{e as Li,E as NE}from"./eventemitter3-0.0.0-dataease.js";import{i as u$,m as c$,t as h$,a as f$,d as d$,p as v$,b as p$,c as g$,e as m$,f as y$,g as _$,h as x$,u as C$,j as E$,k as S$,l as A$,n as T$,o as b$,q as w$,r as R$,s as M$,v as I$}from"./lodash-0.0.0-dataease.js";import{r as L$,V as O$,T as P$,U as F$,P as he}from"./@mapbox-0.0.0-dataease.js";import{P as B$}from"./pbf-0.0.0-dataease.js";import{S as D$}from"./supercluster-0.0.0-dataease.js";import{_ as E,a as G,b as Z,c as An}from"./@babel-0.0.0-dataease.js";import{c as Ou,i as g0,m as Xf,t as Nl,f as Z1,a as yn,b as si,n as Xc,s as q1,d as m0,e as S_,g as Ko,h as N$,j as gp,k as Yr,l as p2,o as k$,p as Mf,q as g2,r as vv,u as Sh,v as mp,w as U$,x as z$,y as H$,z as qa,A as Ka,B as pv,C as $$,D as W$,E as m2,F as V$,G as G$,H as Dm,I as X$,J as Y$,K as K1,L as j$,M as gd,N as Z$,O as gc,P as q$,Q as Ai,R as kr,S as Ur,T as Yc}from"./gl-matrix-0.0.0-dataease.js";import{_ as N,a as Qt,b as S,c as Ti,d as ba,e as ct,f as xt,g as zt,h as md,r as gv}from"./tslib-0.0.0-dataease.js";import{d as VF}from"./detect-browser-0.0.0-dataease.js";import{b as K$}from"./size-sensor-0.0.0-dataease.js";import{e as Q$,l as J$,a as tW,b as eW,p as rW,c as iW,q as nW}from"./d3-regression-0.0.0-dataease.js";import{i as aW,h as kE,p as oW,d as y2,a as sW}from"./d3-hierarchy-0.0.0-dataease.js";import{i as lW,g as _2,r as x2}from"./lodash-es-0.0.0-dataease.js";import{n as GF,a as C2,z as uW,c as cW,s as hW,b as fW,d as E2}from"./fmin-0.0.0-dataease.js";import{p as dW}from"./pdfast-0.0.0-dataease.js";import{A as vW,g as pW,a as Pu}from"./@amap-0.0.0-dataease.js";import{d as gW}from"./d3-ease-0.0.0-dataease.js";import{i as S2,a as mW}from"./d3-interpolate-0.0.0-dataease.js";import{t as yW}from"./d3-timer-0.0.0-dataease.js";import{f as _W,a as xW}from"./fecha-0.0.0-dataease.js";import{f as CW}from"./topojson-client-0.0.0-dataease.js";import{W as A2}from"./viewport-mercator-project-0.0.0-dataease.js";import{b as EW,f as SW,l as AW,d as yp,r as TW,a as bW,c as XF,g as YF,p as wW,u as RW}from"./@turf-0.0.0-dataease.js";import{o as Q1,l as MW,p as IW,a as LW,s as OW,t as PW,q as FW,b as BW,c as DW,d as NW}from"./d3-scale-0.0.0-dataease.js";import{e as T2}from"./d3-array-0.0.0-dataease.js";import{c as kW,r as J1}from"./d3-color-0.0.0-dataease.js";import{e as is}from"./earcut-0.0.0-dataease.js";import{r as UW}from"./regl-0.0.0-dataease.js";import{m as If}from"./mapbox-gl-0.0.0-dataease.js";import{c as zW}from"./d3-dsv-0.0.0-dataease.js";import{g as HW}from"./geojson-vt-0.0.0-dataease.js";import{H as Qh}from"./hammerjs-0.0.0-dataease.js";import{e as $W}from"./element-resize-detector-0.0.0-dataease.js";import{h as WW}from"./d3-hexbin-0.0.0-dataease.js";const Nm=Object.freeze(Object.defineProperty({__proto__:null,get Base(){return $a},get Circle(){return jht},get Ellipse(){return Zht},get Image(){return qht},get Line(){return Kht},get Marker(){return lft},get Path(){return gA},get Polygon(){return pft},get Polyline(){return gft},get Rect(){return _ft},get Text(){return xft}},Symbol.toStringTag,{value:"Module"})),km=Object.freeze(Object.defineProperty({__proto__:null,get Base(){return ca},get Circle(){return wft},get Dom(){return Rft},get Ellipse(){return Mft},get Image(){return Ift},get Line(){return Lft},get Marker(){return Oft},get Path(){return Pft},get Polygon(){return Fft},get Polyline(){return Bft},get Rect(){return Nft},get Text(){return Hft}},Symbol.toStringTag,{value:"Module"}));var Lf,A_,jF,tx;function VW(){Lf=document.createElement("table"),A_=document.createElement("tr"),jF=/^\s*<(\w+|!)[^>]*>/,tx={tr:document.createElement("tbody"),tbody:Lf,thead:Lf,tfoot:Lf,td:A_,th:A_,"*":document.createElement("div")}}function Qo(r){Lf||VW();var t=jF.test(r)&&RegExp.$1;(!t||!(t in tx))&&(t="*");var e=tx[t];r=typeof r=="string"?r.replace(/(^\s*)|(\s*$)/g,""):r,e.innerHTML=""+r;var i=e.childNodes[0];return i&&e.contains(i)&&e.removeChild(i),i}const UE="l7plot-legend l7plot-legend__category",zE="l7plot-legend__title",HE="l7plot-legend__category-list",ZF="l7plot-legend__list-item",qF="l7plot-legend__category-marker",KF="l7plot-legend__category-value",GW=`<div class="${UE}">
  <div class="${zE}"></div>
  <ul class="${HE}"></ul>
</div>`,b2=`<li class="${ZF}" data-index={index}>
  <span class="${qF}" style="background:{color}"></span>
  <span class="${KF}">{value}</span>
</li>`;function Ah(r,t){return!r||!t?r:r.replace(/\\?\{([^{}]+)\}/g,function(e,i){return e.charAt(0)==="\\"?e.slice(1):t[i]===void 0?"":t[i]})}var QF={},JF={},w2=r=>JF[r],In=(r,t)=>{JF[r]=t},XW=r=>QF[r],Th=(r,t)=>{QF[r]=t},kg={REGISTERED_PROTOCOLS:{}},YW=Object.defineProperty,jW=Object.defineProperties,ZW=Object.getOwnPropertyDescriptors,R2=Object.getOwnPropertySymbols,qW=Object.prototype.hasOwnProperty,KW=Object.prototype.propertyIsEnumerable,M2=(r,t,e)=>t in r?YW(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,$E=(r,t)=>{for(var e in t||(t={}))qW.call(t,e)&&M2(r,e,t[e]);if(R2)for(var e of R2(t))KW.call(t,e)&&M2(r,e,t[e]);return r},WE=(r,t)=>jW(r,ZW(t)),VE=r=>kg.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))],QW=class extends Error{constructor(r,t,e,i){super(`AJAXError: ${t} (${r}): ${e}`),this.status=r,this.statusText=t,this.url=e,this.body=i}};function tB(r,t){const e=new XMLHttpRequest,i=Array.isArray(r.url)?r.url[0]:r.url;e.open(r.method||"GET",i,!0),r.type==="arrayBuffer"&&(e.responseType="arraybuffer");for(const n in r.headers)r.headers.hasOwnProperty(n)&&e.setRequestHeader(n,r.headers[n]);return r.type==="json"&&(e.responseType="text",e.setRequestHeader("Accept","application/json")),e.withCredentials=r.credentials==="include",e.onerror=()=>{t(new Error(e.statusText))},e.onload=()=>{if((e.status>=200&&e.status<300||e.status===0)&&e.response!==null){let n=e.response;if(r.type==="json")try{n=JSON.parse(e.response)}catch(a){return t(a)}t(null,n,e.getResponseHeader("Cache-Control"),e.getResponseHeader("Expires"),e)}else{const n=new Blob([e.response],{type:e.getResponseHeader("Content-Type")});t(new QW(e.status,e.statusText,i.toString(),n))}},e.cancel=e.abort,e.send(r.body),e}function JW(r){return new Promise((t,e)=>{tB(r,(i,n,a,o,s)=>{i?e({err:i,data:null,xhr:s}):t({err:null,data:n,cacheControl:a,expires:o,xhr:s})})})}function GE(r,t){return tB(r,t)}var tV=(r,t)=>(VE(r.url)||GE)(WE($E({},r),{type:"json"}),t),XE=(r,t)=>(VE(r.url)||GE)(WE($E({},r),{type:"arrayBuffer"}),t),eV=(r,t)=>GE(WE($E({},r),{method:"GET"}),t),I2="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function eB(r,t){const e=new window.Image,i=window.URL||window.webkitURL;e.crossOrigin="anonymous",e.onload=()=>{t(null,e),i.revokeObjectURL(e.src),e.onload=null,window.requestAnimationFrame(()=>{e.src=I2})},e.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const n=new Blob([new Uint8Array(r)],{type:"image/png"});e.src=r.byteLength?i.createObjectURL(n):I2}function rB(r,t){const e=new Blob([new Uint8Array(r)],{type:"image/png"});createImageBitmap(e).then(i=>{t(null,i)}).catch(i=>{t(new Error(`Could not load image because of ${i.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}var ex=(r,t,e)=>{const i=(n,a)=>{if(n)t(n);else if(a){const o=typeof createImageBitmap=="function",s=e?e(a):a;o?rB(s,t):eB(s,t)}};return r.type==="json"?tV(r,i):XE(r,i)},rV=(r,t)=>{typeof createImageBitmap=="function"?rB(r,t):eB(r,t)},Um=(r=>(r.CENTER="center",r.TOP="top",r["TOP-LEFT"]="top-left",r["TOP-RIGHT"]="top-right",r.BOTTOM="bottom",r["BOTTOM-LEFT"]="bottom-left",r["BOTTOM-RIGHT"]="bottom-right",r.LEFT="left",r.RIGHT="right",r))(Um||{}),y0={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function iB(r,t,e){const i=r.classList;for(const n in y0)y0.hasOwnProperty(n)&&i.remove(`l7-${e}-anchor-${n}`);i.add(`l7-${e}-anchor-${t}`)}function Pe(r){const t=kW(r),e=[0,0,0,0];return t!=null&&(e[0]=t.r/255,e[1]=t.g/255,e[2]=t.b/255,e[3]=t.opacity),e}function Kl(r){const t=r&&r[0],e=r&&r[1],i=r&&r[2];return t+e*256+i*65536-1}function jc(r){return[r+1&255,r+1>>8&255,r+1>>8>>8&255]}function nB(r){let t=window.document.createElement("canvas"),e=t.getContext("2d");t.width=256,t.height=1;let i=null;const n=e.createLinearGradient(0,0,256,1),a=r.positions[0],o=r.positions[r.positions.length-1];for(let s=0;s<r.colors.length;++s){const l=(r.positions[s]-a)/(o-a);n.addColorStop(l,r.colors[s])}return e.fillStyle=n,e.fillRect(0,0,256,1),i=new Uint8ClampedArray(e.getImageData(0,0,256,1).data),t=null,e=null,{data:i,width:256,height:1}}function iV(r,t){let e=window.document.createElement("canvas"),i=e.getContext("2d");e.width=256,e.height=1;const n=i.createLinearGradient(0,0,256,1),a=t[1]-t[0];for(let l=0;l<r.colors.length;++l){const u=Math.max((r.positions[l]-t[0])/a,0);n.addColorStop(u,r.colors[l])}i.fillStyle=n,i.fillRect(0,0,256,1);const o=i.getImageData(0,0,256,1).data,s=YE(i,o);return e=null,i=null,s}function nV(r){let t=window.document.createElement("canvas"),e=t.getContext("2d");t.width=256,t.height=1;const i=e.createImageData(256,1);return i.data.fill(0),r.positions.forEach((n,a)=>{const o=Pe(r.colors[a]);i.data[n*4+0]=o[0]*255,i.data[n*4+1]=o[1]*255,i.data[n*4+2]=o[2]*255,i.data[n*4+3]=o[3]*255}),t=null,e=null,i}function aV(r){let t=window.document.createElement("canvas"),e=t.getContext("2d");e.globalAlpha=1,t.width=256,t.height=1;const i=256/r.colors.length;for(let o=0;o<r.colors.length;o++)e.beginPath(),e.lineWidth=2,e.strokeStyle=r.colors[o],e.moveTo(o*i,0),e.lineTo((o+1)*i,0),e.stroke();const n=e.getImageData(0,0,256,1).data,a=YE(e,n);return t=null,e=null,a}function oV(r,t){let e=window.document.createElement("canvas"),i=e.getContext("2d");i.globalAlpha=1,e.width=256,e.height=1;const n=t[1]-t[0];r.positions.length-r.colors.length!==1&&console.warn("positions 的数字个数应当比 colors 的样式多一个,poisitions 的首尾值一般为数据的最大最新值");for(let s=0;s<r.colors.length;s++)i.beginPath(),i.lineWidth=2,i.strokeStyle=r.colors[s],i.moveTo((r.positions[s]-t[0])/n*255,0),i.lineTo((r.positions[s+1]-t[0])/n*255,0),i.stroke();const a=i.getImageData(0,0,256,1).data,o=YE(i,a);return e=null,i=null,o}function YE(r,t){const e=r.createImageData(256,1);for(let i=0;i<e.data.length;i+=4)e.data[i+0]=t[i+0],e.data[i+1]=t[i+1],e.data[i+2]=t[i+2],e.data[i+3]=t[i+3];return e}function jE(r){switch(r==null?void 0:r.type){case"cat":return[0,255];default:return[0,1]}}var er={isNil:u$,merge:c$,throttle:h$,isString:f$,debounce:d$,pull:v$,isTypedArray:p$,isPlainObject:g$,isNumber:m$,isBoolean:y$,isEqual:_$,cloneDeep:x$,uniq:C$,clamp:E$,upperFirst:S$,get:A$,mergeWith:T$,isFunction:b$,isObject:w$,isUndefined:R$,camelCase:M$,uniqueId:I$};function aB(r){let t=r;return typeof r=="string"&&(t=window.document.getElementById(r)),t}function oB(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")}function sB(r){return oB(r).split(/\s+/)}function sV(r){var t;const e=(t=document==null?void 0:document.documentElement)==null?void 0:t.style;if(!e)return r[0];for(const i in r)if(r[i]&&r[i]in e)return r[i];return r[0]}function we(r,t,e){const i=window.document.createElement(r);return t&&(i.className=t||""),e&&e.appendChild(i),i}function xn(r){const t=r.parentNode;t&&t.removeChild(r)}function fo(r,t){if(r.classList!==void 0){const e=sB(t);for(let i=0,n=e.length;i<n;i++)r.classList.add(e[i])}else if(!lV(r,t)){const e=ZE(r);lB(r,(e?e+" ":"")+t)}}function Zc(r,t){r.classList!==void 0?sB(t).forEach(i=>{r.classList.remove(i)}):lB(r,oB((" "+ZE(r)+" ").replace(" "+t+" "," ")))}function lV(r,t){if(r.classList!==void 0)return r.classList.contains(t);const e=ZE(r);return e.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(e)}function lB(r,t){r instanceof HTMLElement?r.className=t:r.className.baseVal=t}function ZE(r){return r instanceof SVGElement&&(r=r.correspondingElement),r.className.baseVal===void 0?r.className:r.className.baseVal}var uV=sV(["transform","WebkitTransform"]);function uB(r,t){r.style[uV]=t}function cV(){var r;const t=window.document.querySelector('meta[name="viewport"]');if(!t)return 1;const i=((r=t.content)==null?void 0:r.split(",")).find(n=>{const[a]=n.split("=");return a==="initial-scale"});return i?i.split("=")[1]*1:1}var Ni=cV()<1?1:window.devicePixelRatio;function qE(r,t){r.setAttribute("style",`${r.style.cssText}${t}`)}function hV(r){return Object.entries(r).map(([t,e])=>`${t}: ${e}`).join(";")}function fV(r,t){return{left:r.left-t.left,top:r.top-t.top,right:t.left+t.width-r.left-r.width,bottom:t.top+t.height-r.top-r.height}}function mv(r){r.innerHTML=""}function dV(r){r.setAttribute("draggable","false")}function kl(r,t){if(typeof t=="string"){const e=document.createElement("div");for(e.innerHTML=t;e.firstChild;)r.append(e.firstChild)}else Array.isArray(t)?r.append(...t):r.append(t)}function vV(r,t){var e;const i=Array.isArray(t)?t:[t];let n=r;for(;n instanceof Element&&n!==window.document.body;){if(i.find(a=>n==null?void 0:n.matches(a)))return n;n=(e=n==null?void 0:n.parentElement)!=null?e:null}}function pV(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}var _0=navigator==null?void 0:navigator.userAgent;_0.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);_0.indexOf("Android")>-1||_0.indexOf("Adr")>-1;function gV(){const r=_0,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"];let e=!0;for(const i of t)if(r.indexOf(i)>0){e=!1;break}return e}function mV(r,t){r.forEach(e=>{t[e]&&(t[e]=t[e].bind(t))})}function T_(r){return typeof r=="number"}function _r(r){return r-Math.fround(r)}var L2=2*Math.PI*6378137/2;function yV(r,t){const[e,i,n,a]=t;return r.lng>e&&r.lng<=n&&r.lat>i&&r.lat<=a}function _V(r){const t=[1/0,1/0,-1/0,-1/0];return r.forEach(e=>{const{coordinates:i}=e;cB(t,i)}),t}function cB(r,t){return Array.isArray(t[0])?t.forEach(e=>{cB(r,e)}):(r[0]>t[0]&&(r[0]=t[0]),r[1]>t[1]&&(r[1]=t[1]),r[2]<t[0]&&(r[2]=t[0]),r[3]<t[1]&&(r[3]=t[1])),r}function Ug(r,t=!0,e={enable:!0,decimal:1}){r=EV(r,t);const i=r[0],n=r[1];let a=i*L2/180,o=Math.log(Math.tan((90+n)*Math.PI/360))/(Math.PI/180);return o=o*L2/180,e.enable&&(a=Number(a.toFixed(e.decimal)),o=Number(o.toFixed(e.decimal))),r.length===3?[a,o,r[2]]:[a,o]}function xV(r){if(r==null)throw new Error("lng is required");return(r>180||r<-180)&&(r=r%360,r>180&&(r=-360+r),r<-180&&(r=360+r),r===0&&(r=0)),r}function CV(r){if(r==null)throw new Error("lat is required");return(r>90||r<-90)&&(r=r%180,r>90&&(r=-180+r),r<-90&&(r=180+r),r===0&&(r=0)),r}function EV(r,t){if(t===!1)return r;const e=xV(r[0]);let i=CV(r[1]);return i>85&&(i=85),i<-85&&(i=-85),r.length===3?[e,i,r[2]]:[e,i]}function Vn(r){const t=85.0511287798,e=Math.max(Math.min(t,r[1]),-t),i=256<<20;let n=Math.PI/180,a=r[0]*n,o=e*n;o=Math.log(Math.tan(Math.PI/4+o/2));const s=.5/Math.PI,l=.5,u=-.5/Math.PI;return n=.5,a=i*(s*a+l),o=i*(u*o+n),[Math.floor(a),Math.floor(o)]}function b_(r,t){const e=85.0511287798,i=Math.PI/180,n=6378137;return t=Math.max(Math.min(e,t),-e),r*=i,t*=i,t=Math.log(Math.tan(Math.PI/4+t/2)),[r*n,t*n]}function SV(r,t,e){const i=yp(t[1]-r[1]),n=yp(t[0]-r[0]),a=yp(r[1]),o=yp(t[1]),s=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(n/2),2)*Math.cos(a)*Math.cos(o);return TW(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)),"meters")}function KE(r,t){const e=Math.abs(r[1][1]-r[0][1])*t,i=Math.abs(r[1][0]-r[0][0])*t;return[[r[0][0]-i,r[0][1]-e],[r[1][0]+i,r[1][1]+e]]}function hB(r,t){return r[0][0]<=t[0][0]&&r[0][1]<=t[0][1]&&r[1][0]>=t[1][0]&&r[1][1]>=t[1][1]}function x0(r){return[[r[0],r[1]],[r[2],r[3]]]}function AV(r){const t=TV(r,[0,0]);return[r[0]/t,r[1]/t]}function TV(r,t){return Math.sqrt(Math.pow(r[0]-t[0],2)+Math.pow(r[1]-t[1],2))}function cu(r){if(T_(r[0]))return r;if(T_(r[0][0]))throw new Error("当前数据不支持标注");if(T_(r[0][0][0])){const t=r;let e=0,i=0,n=0;return t.forEach(a=>{a.forEach(o=>{e+=o[0],i+=o[1],n++})}),[e/n,i/n,0]}else throw new Error("当前数据不支持标注")}function bV(r){let t=r[0],e=r[1],i=r[0],n=r[1],a=0,o=0,s=0;for(let l=0;l<r.length;l+=2){const u=r[l],c=r[l+1];u&&c&&(t=Math.max(u,t),e=Math.max(c,e),i=Math.min(u,i),n=Math.min(c,n),a+=u,o+=c,s++)}return{center:[a/s,o/s],radius:Math.sqrt(Math.pow(t-i,2)+Math.pow(e-n,2))/2}}function wV(r){return EW(SW([AW(r)]))}function RV(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const t=Math.random()*16|0;return(r==="x"?t:t&3|8).toString(16)})}var MV=class{constructor(r=50,t){this.limit=r,this.destroy=t||this.defaultDestroy,this.order=[],this.clear()}clear(){this.order.forEach(r=>{this.delete(r)}),this.cache={},this.order=[]}get(r){const t=this.cache[r];return t&&(this.deleteOrder(r),this.appendOrder(r)),t}set(r,t){this.cache[r]?(this.delete(r),this.cache[r]=t,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=t,this.appendOrder(r))}delete(r){const t=this.cache[r];t&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(t,r))}deleteCache(r){delete this.cache[r]}deleteOrder(r){const t=this.order.findIndex(e=>e===r);t>=0&&this.order.splice(t,1)}appendOrder(r){this.order.push(r)}defaultDestroy(r,t){return null}};function IV(r){if(r.length===0)throw new Error("max requires at least one data point");let t=r[0];for(let e=1;e<r.length;e++)r[e]>t&&(t=r[e]);return t*1}function LV(r){if(r.length===0)throw new Error("min requires at least one data point");let t=r[0];for(let e=1;e<r.length;e++)r[e]<t&&(t=r[e]);return t*1}function fB(r){if(r.length===0)return 0;let t=r[0]*1;for(let e=1;e<r.length;e++)t+=r[e]*1;return t}function OV(r){if(r.length===0)throw new Error("mean requires at least one data point");return fB(r)/r.length}function PV(r){if(r.length===0)throw new Error("mean requires at least one data point");if(r.length<3)return r[0];r.sort();let t=r[0],e=NaN,i=0,n=1;for(let a=1;a<r.length+1;a++)r[a]!==t?(n>i&&(i=n,e=t),n=1,t=r[a]):n++;return e*1}var dB={min:LV,max:IV,mean:OV,sum:fB,mode:PV};function vB(r,t){return r.map(e=>e[t])}var Yf=(r=>(r.Realtime="realtime",r.Overlap="overlap",r.Replace="replace",r))(Yf||{}),Un=(r=>(r.Loading="Loading",r.Loaded="Loaded",r.Failure="Failure",r.Cancelled="Cancelled",r))(Un||{}),pB=0,O2=1,zm=2;function FV(r){r.forEach(t=>{t.isCurrent&&(t.isVisible=t.isLoaded)})}function BV(r){r.forEach(t=>{t.properties.state=pB}),r.forEach(t=>{t.isCurrent&&!gB(t)&&QE(t)}),r.forEach(t=>{t.isVisible=!!(t.properties.state&zm)})}function DV(r){r.forEach(e=>{e.properties.state=pB}),r.forEach(e=>{e.isCurrent&&gB(e)}),r.slice().sort((e,i)=>e.z-i.z).forEach(e=>{e.isVisible=!!(e.properties.state&zm),e.children.length&&(e.isVisible||e.properties.state&O2)?e.children.forEach(i=>{i.properties.state=O2}):e.isCurrent&&QE(e)})}function gB(r){for(;r;){if(r.isLoaded)return r.properties.state|=zm,!0;r=r.parent}return!1}function QE(r){r.children.forEach(t=>{t.isLoaded?t.properties.state|=zm:QE(t)})}var mB=[-1/0,-1/0,1/0,1/0],NV=.2,kV=5,UV={[Yf.Realtime]:FV,[Yf.Overlap]:BV,[Yf.Replace]:DV},zV=()=>{};function rx(r,t,e){const i=Math.floor((r+180)/360*Math.pow(2,e)),n=Math.floor((1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,e));return[i,n]}function P2(r,t,e){const i=r/Math.pow(2,e)*360-180,n=Math.PI-2*Math.PI*t/Math.pow(2,e),a=180/Math.PI*Math.atan(.5*(Math.exp(n)-Math.exp(-n)));return[i,a]}var yB=(r,t,e)=>{const[i,n]=P2(r,t,e),[a,o]=P2(r+1,t+1,e);return[i,o,a,n]};function HV({zoom:r,latLonBounds:t,maxZoom:e=1/0,minZoom:i=0,zoomOffset:n=0,extent:a=mB}){let o=Math.ceil(r)+n;if(Number.isFinite(i)&&o<i)return[];Number.isFinite(e)&&o>e&&(o=e);const[s,l,u,c]=t,h=[Math.max(s,a[0]),Math.max(l,a[1]),Math.min(u,a[2]),Math.min(c,a[3])],f=[],[d,v]=rx(h[0],h[1],o),[p,g]=rx(h[2],h[3],o);for(let x=d;x<=p;x++)for(let C=g;C<=v;C++)f.push({x,y:C,z:o});const m=(p+d)/2,y=(v+g)/2,_=(x,C)=>Math.abs(x-m)+Math.abs(C-y);return f.sort((x,C)=>_(x.x,x.y)-_(C.x,C.y)),f}var $V=(r,t,e,i=!0)=>{const n=Math.pow(2,e),a=n-1,o=n;let s=r;const l=t;return i&&(s<0?s=s+o:s>a&&(s=s%o)),{warpX:s,warpY:l}},WV=(r,t,e)=>new Promise((i,n)=>{var a=l=>{try{s(e.next(l))}catch(u){n(u)}},o=l=>{try{s(e.throw(l))}catch(u){n(u)}},s=l=>l.done?i(l.value):Promise.resolve(l.value).then(a,o);s((e=e.apply(r,t)).next())}),VV=class extends Li.EventEmitter{constructor(r){super(),this.tileSize=256,this.isVisible=!1,this.isCurrent=!1,this.isVisibleChange=!1,this.loadedLayers=0,this.isLayerLoaded=!1,this.isLoad=!1,this.isChildLoad=!1,this.parent=null,this.children=[],this.data=null,this.properties={},this.loadDataId=0;const{x:t,y:e,z:i,tileSize:n,warp:a=!0}=r;this.x=t,this.y=e,this.z=i,this.warp=a||!0,this.tileSize=n}get isLoading(){return this.loadStatus===Un.Loading}get isLoaded(){return this.loadStatus===Un.Loaded}get isFailure(){return this.loadStatus===Un.Failure}setTileLayerLoaded(){this.isLayerLoaded=!0}get isCancelled(){return this.loadStatus===Un.Cancelled}get isDone(){return[Un.Loaded,Un.Cancelled,Un.Failure].includes(this.loadStatus)}get bounds(){return yB(this.x,this.y,this.z)}get bboxPolygon(){const[r,t,e,i]=this.bounds,n=[(e-r)/2,(i-t)/2];return bW(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:n,meta:`
      ${this.key}
      `}})}get key(){return`${this.x}_${this.y}_${this.z}`}layerLoad(){this.loadedLayers++,this.emit("layerLoaded")}loadData(r){return WV(this,arguments,function*({getData:t,onLoad:e,onError:i}){this.loadDataId++;const n=this.loadDataId;this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=Un.Loading;let a=null,o;try{const{x:s,y:l,z:u,bounds:c,tileSize:h,warp:f}=this,{warpX:d,warpY:v}=$V(s,l,u,f),{signal:p}=this.abortController;a=yield t({x:d,y:v,z:u,bounds:c,tileSize:h,signal:p,warp:f},this)}catch(s){o=s}if(n===this.loadDataId&&!(this.isCancelled&&!a)){if(o||!a){this.loadStatus=Un.Failure,i(o,this);return}this.loadStatus=Un.Loaded,this.data=a,e(this)}})}reloadData(r){this.isLoading&&this.abortLoad(),this.loadData(r)}abortLoad(){this.isLoaded||this.isCancelled||(this.loadStatus=Un.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}},GV=(r,t)=>{const e=x0(r),i=KE(e,t),n=360*3-180,a=85.0511287798065;return[Math.max(i[0][0],-n),Math.max(i[0][1],-a),Math.min(i[1][0],n),Math.min(i[1][1],a)]},XV=(r,t)=>{const e=x0(r),i=x0(t);return hB(e,i)},YV=Object.defineProperty,jV=Object.defineProperties,ZV=Object.getOwnPropertyDescriptors,F2=Object.getOwnPropertySymbols,qV=Object.prototype.hasOwnProperty,KV=Object.prototype.propertyIsEnumerable,B2=(r,t,e)=>t in r?YV(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,D2=(r,t)=>{for(var e in t||(t={}))qV.call(t,e)&&B2(r,e,t[e]);if(F2)for(var e of F2(t))KV.call(t,e)&&B2(r,e,t[e]);return r},QV=(r,t)=>jV(r,ZV(t)),{throttle:JV}=er,tG=class extends NE{constructor(r){super(),this.currentTiles=[],this.cacheTiles=new Map,this.throttleUpdate=JV((t,e)=>{this.update(t,e)},16),this.onTileLoad=t=>{this.emit("tile-loaded",t),this.updateTileVisible(),this.loadFinished()},this.onTileError=(t,e)=>{this.emit("tile-error",{error:t,tile:e}),this.updateTileVisible(),this.loadFinished()},this.onTileUnload=t=>{this.emit("tile-unload",t),this.loadFinished()},this.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:mB,getTileData:zV,warp:!0,updateStrategy:Yf.Replace},this.updateOptions(r)}get isLoaded(){return this.currentTiles.every(r=>r.isDone)}get tiles(){return Array.from(this.cacheTiles.values()).sort((t,e)=>t.z-e.z)}updateOptions(r){const t=r.minZoom===void 0?this.options.minZoom:Math.ceil(r.minZoom),e=r.maxZoom===void 0?this.options.maxZoom:Math.floor(r.maxZoom);this.options=QV(D2(D2({},this.options),r),{minZoom:t,maxZoom:e})}update(r,t){const e=Math.max(0,Math.ceil(r));if(this.lastViewStates&&this.lastViewStates.zoom===e&&XV(this.lastViewStates.latLonBoundsBuffer,t))return;const i=GV(t,NV);this.lastViewStates={zoom:e,latLonBounds:t,latLonBoundsBuffer:i},this.currentZoom=e;let n=!1;const a=this.getTileIndices(e,i).filter(o=>this.options.warp||o.x>=0&&o.x<Math.pow(2,e));this.emit("tiles-load-start"),this.currentTiles=a.map(({x:o,y:s,z:l})=>{let u=this.getTile(o,s,l);return u?(((u==null?void 0:u.isFailure)||(u==null?void 0:u.isCancelled))&&u.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),u):(u=this.createTile(o,s,l),n=!0,u)}),n&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}reloadAll(){for(const[r,t]of this.cacheTiles){if(!this.currentTiles.includes(t)){this.cacheTiles.delete(r),this.onTileUnload(t);return}this.onTileUnload(t),t.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}reloadTileById(r,t,e){const i=this.cacheTiles.get(`${t},${e},${r}`);i&&(this.onTileUnload(i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}reloadTileByLnglat(r,t,e){const i=this.getTileByLngLat(r,t,e);i&&this.reloadTileById(i.z,i.x,i.y)}reloadTileByExtent(r,t){this.getTileIndices(t,r).forEach(i=>{this.reloadTileById(i.z,i.x,i.y)})}pruneRequests(){const r=[];for(const t of this.cacheTiles.values())t.isLoading&&!t.isCurrent&&!t.isVisible&&r.push(t);for(;r.length>0;)r.shift().abortLoad()}getTileByLngLat(r,t,e){const{zoomOffset:i}=this.options,n=Math.ceil(e)+i,a=rx(r,t,n);return this.tiles.filter(s=>s.key===`${a[0]}_${a[1]}_${n}`)[0]}getTileExtent(r,t){return this.getTileIndices(t,r)}getTileByZXY(r,t,e){return this.tiles.filter(n=>n.key===`${t}_${e}_${r}`)[0]}clear(){for(const r of this.cacheTiles.values())r.isLoading?r.abortLoad():this.onTileUnload(r);this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}destroy(){this.clear(),this.removeAllListeners()}updateTileVisible(){const r=this.options.updateStrategy,t=new Map;for(const n of this.cacheTiles.values())t.set(n.key,n.isVisible),n.isCurrent=!1,n.isVisible=!1;for(const n of this.currentTiles)n.isCurrent=!0,n.isVisible=!0;const e=Array.from(this.cacheTiles.values());typeof r=="function"?r(e):UV[r](e);let i=!1;Array.from(this.cacheTiles.values()).forEach(n=>{n.isVisible!==t.get(n.key)?(n.isVisibleChange=!0,i=!0):n.isVisibleChange=!1}),i&&this.emit("tile-update")}getTileIndices(r,t){const{tileSize:e,extent:i,zoomOffset:n}=this.options,a=Math.floor(this.options.maxZoom),o=Math.ceil(this.options.minZoom);return HV({maxZoom:a,minZoom:o,zoomOffset:n,tileSize:e,zoom:r,latLonBounds:t,extent:i})}getTileId(r,t,e){return`${r},${t},${e}`}loadFinished(){const r=!this.currentTiles.some(t=>!t.isDone);return r&&this.emit("tiles-load-finished"),r}getTile(r,t,e){const i=this.getTileId(r,t,e);return this.cacheTiles.get(i)}createTile(r,t,e){const i=this.getTileId(r,t,e),n=new VV({x:r,y:t,z:e,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(i,n),n.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),n}resizeCacheTiles(){const r=kV*this.currentTiles.length;if(this.cacheTiles.size>r){for(const[e,i]of this.cacheTiles)if(!i.isVisible&&!this.currentTiles.includes(i)&&(this.cacheTiles.delete(e),this.onTileUnload(i)),this.cacheTiles.size<=r)break}this.rebuildTileTree()}rebuildTileTree(){for(const r of this.cacheTiles.values())r.parent=null,r.children.length=0;for(const r of this.cacheTiles.values()){const t=this.getNearestAncestor(r.x,r.y,r.z);r.parent=t,t!=null&&t.children&&t.children.push(r)}}getNearestAncestor(r,t,e){for(;e>this.options.minZoom;){r=Math.floor(r/2),t=Math.floor(t/2),e=e-1;const i=this.getTile(r,t,e);if(i)return i}return null}};function _B(r){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(r);if(e){const i=e[1].charCodeAt(0),n=e[2].charCodeAt(0);let a;for(a=i;a<=n;++a)t.push(r.replace(e[0],String.fromCharCode(a)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(r),e){const i=parseInt(e[2],10);for(let n=parseInt(e[1],10);n<=i;n++)t.push(r.replace(e[0],n.toString()));return t}return t.push(r),t}function Mc(r,t){if(!r||!r.length)throw new Error("url is not allowed to be empty");const{x:e,y:i,z:n}=t,a=_B(r),o=Math.abs(e+i)%a.length;return(VE(a[o])?`${a[o]}/{z}/{x}/{y}`:a[o]).replace(/\{x\}/g,e.toString()).replace(/\{y\}/g,i.toString()).replace(/\{z\}/g,n.toString()).replace(/\{bbox\}/g,yB(e,i,n).join(",")).replace(/\{-y\}/g,(Math.pow(2,n)-i-1).toString())}function eG(r,t){const{x:e,y:i,z:n,layer:a,version:o="1.0.0",style:s="default",format:l,service:u="WMTS",tileMatrixset:c}=t,h=_B(r),f=Math.abs(e+i)%h.length;return`${h[f]}&SERVICE=${u}&REQUEST=GetTile&VERSION=${o}&LAYER=${a}&STYLE=${s}&TILEMATRIXSET=${c}&FORMAT=${l}&TILECOL=${e}&TILEROW=${i}&TILEMATRIX=${n}`}function Jh(r,t){return r??t}function rG(r,t){return r.map(e=>e[t]*1)}function xB(r){return Array.isArray(r)?r.length===0||typeof r[0]=="number":!1}function ix(r){const t=Object.isFrozen(r)?er.cloneDeep(r):r;return L$(t,!0),t}function bh(r,t){return r||[[t[0],t[3]],[t[2],t[3]],[t[2],t[1]],[t[0],t[1]]]}var iG=Object.defineProperty,nG=Object.defineProperties,aG=Object.getOwnPropertyDescriptors,N2=Object.getOwnPropertySymbols,oG=Object.prototype.hasOwnProperty,sG=Object.prototype.propertyIsEnumerable,k2=(r,t,e)=>t in r?iG(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,U2=(r,t)=>{for(var e in t||(t={}))oG.call(t,e)&&k2(r,e,t[e]);if(N2)for(var e of N2(t))sG.call(t,e)&&k2(r,e,t[e]);return r},z2=(r,t)=>nG(r,aG(t));function CB(r,t){const{x:e,y:i,x1:n,y1:a,coordinates:o,geometry:s}=t,l=[];if(!Array.isArray(r))return{dataArray:[]};if(s)return r.filter(u=>u[s]&&u[s].type&&u[s].coordinates&&u[s].coordinates.length>0).forEach((u,c)=>{const h=ix(u[s]);XF(h,f=>{const d=YF(f),v=z2(U2({},u),{_id:c,coordinates:d});l.push(v)})}),{dataArray:l};for(let u=0;u<r.length;u++){const c=r[u];let h=[];if(o){let d="Polygon";Array.isArray(o[0])||(d="Point"),Array.isArray(o[0])&&!Array.isArray(o[0][0])&&(d="LineString"),h=ix({type:d,coordinates:c[o]}).coordinates}else if(e&&i&&n&&a){const d=[parseFloat(c[e]),parseFloat(c[i])],v=[parseFloat(c[n]),parseFloat(c[a])];h=[d,v]}else e&&i&&(h=[parseFloat(c[e]),parseFloat(c[i])]);const f=z2(U2({},c),{_id:u,coordinates:h});l.push(f)}return{dataArray:l}}function lG(r,t){const e=zW(r);return CB(e,t)}var uG=Object.defineProperty,cG=Object.defineProperties,hG=Object.getOwnPropertyDescriptors,H2=Object.getOwnPropertySymbols,fG=Object.prototype.hasOwnProperty,dG=Object.prototype.propertyIsEnumerable,$2=(r,t,e)=>t in r?uG(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,vG=(r,t)=>{for(var e in t||(t={}))fG.call(t,e)&&$2(r,e,t[e]);if(H2)for(var e of H2(t))dG.call(t,e)&&$2(r,e,t[e]);return r},pG=(r,t)=>cG(r,hG(t));function gG(r){const t=r.toString();let e=5381,i=t.length;for(;i;)e=e*33^t.charCodeAt(--i);return e>>>0}function mG(r,t){return t===void 0?null:isNaN(r.properties[t]*1)?r.properties&&r.properties[t]?gG(r.properties[t]+"")%1000019:null:r.properties[t]*1}function yG(r,t){const e=[],i={};return r.features?(r.features=r.features.filter(n=>{const a=n.geometry;return n!=null&&a&&a.type&&a.coordinates&&a.coordinates.length>0}),r=ix(r),r.features.length===0?{dataArray:[],featureKeys:i}:(XF(r,(n,a)=>{let o=mG(n,t==null?void 0:t.featureId);o===null&&(o=a);const s=o,l=YF(n),u=pG(vG({},n.properties),{coordinates:l,_id:s});e.push(u)}),{dataArray:e,featureKeys:i})):(r.features=[],{dataArray:[]})}var Of=class{constructor(t,e,i,n){this.vectorLayerCache={},this.x=e,this.y=i,this.z=n,this.vectorTile=t}getTileData(t){return!t||!this.vectorTile.layers[t]?[]:this.vectorLayerCache[t]?this.vectorLayerCache[t]:this.vectorTile.layers[t].features}getFeatureById(){throw new Error("Method not implemented.")}},_G=Object.defineProperty,xG=Object.defineProperties,CG=Object.getOwnPropertyDescriptors,W2=Object.getOwnPropertySymbols,EG=Object.prototype.hasOwnProperty,SG=Object.prototype.propertyIsEnumerable,V2=(r,t,e)=>t in r?_G(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,C0=(r,t)=>{for(var e in t||(t={}))EG.call(t,e)&&V2(r,e,t[e]);if(W2)for(var e of W2(t))SG.call(t,e)&&V2(r,e,t[e]);return r},AG=(r,t)=>xG(r,CG(t)),TG=(r,t,e)=>new Promise((i,n)=>{var a=l=>{try{s(e.next(l))}catch(u){n(u)}},o=l=>{try{s(e.throw(l))}catch(u){n(u)}},s=l=>l.done?i(l.value):Promise.resolve(l.value).then(a,o);s((e=e.apply(r,t)).next())}),bG={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function wG(r){let t=0;for(let e=0,i=r.length,n=i-1,a,o;e<i;n=e++)a=r[e],o=r[n],t+=(o.x-a.x)*(a.y+o.y);return t}function RG(r){const t=r.length;if(t<=1)return[r];const e=[];let i,n;for(let a=0;a<t;a++){const o=wG(r[a]);o!==0&&(n===void 0&&(n=o<0),n===o<0?(i&&e.push(i),i=[r[a]]):i.push(r[a]))}return i&&e.push(i),e}var MG=["Unknown","Point","LineString","Polygon"];function IG(r,t,e,i,n){let a=n.geometry;const o=n.type,s=n.tags,l=n.id,u=r*Math.pow(2,i),c=r*t,h=r*e;let f=MG[o],d,v;function p(m){for(let y=0;y<m.length;y++){const _=m[y];if(_[3])break;const x=180-(_[1]+h)*360/u,C=(_[0]+c)*360/u-180,A=360/Math.PI*Math.atan(Math.exp(x*Math.PI/180))-90;m[y]=[C,A,0,1]}}switch(o){case 1:const m=[];for(d=0;d<a.length;d++)m[d]=a[d][0];a=m,p(a);break;case 2:for(d=0;d<a.length;d++)p(a[d]);break;case 3:for(a=RG(a),d=0;d<a.length;d++)for(v=0;v<a[d].length;v++)p(a[d][v]);break}return a.length===1?a=a[0]:f="Multi"+f,{type:"Feature",geometry:{type:f,coordinates:a},properties:s,id:l,relativeOrigin:[0,0],coord:""}}var LG=(r,t,e,i)=>TG(void 0,null,function*(){return new Promise(n=>{const a=t.getTile(r.z,r.x,r.y),s={layers:{defaultLayer:{features:a?a.features.map(u=>IG(i,e.x,e.y,e.z,u)):[]}}},l=new Of(s,r.x,r.y,r.z);n(l)})});function OG(r){const t={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return r===void 0||typeof r.geojsonvtOptions>"u"?t:C0(C0({},t),r.geojsonvtOptions)}function PG(r,t){const e=OG(t),i=e.extent||4096,n=HW(r,e),a=(s,l)=>LG(l,n,s,i),o=AG(C0(C0({},bG),t),{getTileData:a});return{data:r,dataArray:[],tilesetOptions:o,isTile:!0}}var FG=Object.defineProperty,BG=Object.defineProperties,DG=Object.getOwnPropertyDescriptors,G2=Object.getOwnPropertySymbols,NG=Object.prototype.hasOwnProperty,kG=Object.prototype.propertyIsEnumerable,X2=(r,t,e)=>t in r?FG(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Y2=(r,t)=>{for(var e in t||(t={}))NG.call(t,e)&&X2(r,e,t[e]);if(G2)for(var e of G2(t))kG.call(t,e)&&X2(r,e,t[e]);return r},j2=(r,t)=>BG(r,DG(t));function EB(r,t){const{extent:e=[121.168,30.2828,121.384,30.4219],coordinates:i,requestParameters:n={}}=t,a=new Promise(l=>{r instanceof HTMLImageElement||pV(r)?l([r]):UG(r,n,u=>{l(u)})}),o=bh(i,e);return{originData:r,images:a,_id:1,dataArray:[{_id:0,coordinates:o}]}}function UG(r,t,e){const i=[];if(typeof r=="string")ex(j2(Y2({},t),{url:r}),(n,a)=>{a&&(i.push(a),e(i))});else{const n=r.length;let a=0;r.forEach(o=>{ex(j2(Y2({},t),{url:o}),(s,l)=>{a++,l&&i.push(l),a===n&&e(i)})})}return EB}var zG=Object.defineProperty,HG=Object.defineProperties,$G=Object.getOwnPropertyDescriptors,Z2=Object.getOwnPropertySymbols,WG=Object.prototype.hasOwnProperty,VG=Object.prototype.propertyIsEnumerable,q2=(r,t,e)=>t in r?zG(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,SB=(r,t)=>{for(var e in t||(t={}))WG.call(t,e)&&q2(r,e,t[e]);if(Z2)for(var e of Z2(t))VG.call(t,e)&&q2(r,e,t[e]);return r},AB=(r,t)=>HG(r,$G(t)),GG=(r,t,e)=>new Promise((i,n)=>{var a=l=>{try{s(e.next(l))}catch(u){n(u)}},o=l=>{try{s(e.throw(l))}catch(u){n(u)}},s=l=>l.done?i(l.value):Promise.resolve(l.value).then(a,o);s((e=e.apply(r,t)).next())}),XG=(r,t,e,i)=>GG(void 0,null,function*(){const n={x:t.x,y:t.y,z:t.z},a=Mc(r,n);return new Promise(o=>{i?i(n,(s,l)=>{if(s||!l){const u={layers:{defaultLayer:{features:[]}}},c=new Of(u,t.x,t.y,t.z);o(c)}else{const u={layers:{defaultLayer:{features:l.features}}},c=new Of(u,t.x,t.y,t.z);o(c)}}):eV(AB(SB({},e),{url:a}),(s,l)=>{if(s||!l){const u={layers:{defaultLayer:{features:[]}}},c=new Of(u,t.x,t.y,t.z);o(c)}else{const c={layers:{defaultLayer:{features:JSON.parse(l)}}},h=new Of(c,t.x,t.y,t.z);o(h)}})})});function YG(r,t){const e=(n,a)=>XG(r,a,t==null?void 0:t.requestParameters,t.getCustomData),i=AB(SB({},t),{getTileData:e});return{dataArray:[],tilesetOptions:i,isTile:!0}}var jG=Object.defineProperty,ZG=Object.defineProperties,qG=Object.getOwnPropertyDescriptors,K2=Object.getOwnPropertySymbols,KG=Object.prototype.hasOwnProperty,QG=Object.prototype.propertyIsEnumerable,Q2=(r,t,e)=>t in r?jG(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,J2=(r,t)=>{for(var e in t||(t={}))KG.call(t,e)&&Q2(r,e,t[e]);if(K2)for(var e of K2(t))QG.call(t,e)&&Q2(r,e,t[e]);return r},JG=(r,t)=>ZG(r,qG(t)),tw=class{constructor(r,t,e,i){this.vectorLayerCache={},this.x=t,this.y=e,this.z=i,this.vectorTile=new O$(new B$(r))}getTileData(r){if(!r||!this.vectorTile.layers[r])return[];if(this.vectorLayerCache[r])return this.vectorLayerCache[r];const t=this.vectorTile.layers[r];if(Array.isArray(t.features))return this.vectorLayerCache[r]=t.features,t.features;const e=[];for(let i=0;i<t.length;i++){const a=t.feature(i).toGeoJSON(this.x,this.y,this.z);e.push(JG(J2({},a),{properties:J2({id:a.id},a.properties)}))}return this.vectorLayerCache[r]=e,e}getFeatureById(){throw new Error("Method not implemented.")}},tX=Object.defineProperty,eX=Object.defineProperties,rX=Object.getOwnPropertyDescriptors,ew=Object.getOwnPropertySymbols,iX=Object.prototype.hasOwnProperty,nX=Object.prototype.propertyIsEnumerable,rw=(r,t,e)=>t in r?tX(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,nx=(r,t)=>{for(var e in t||(t={}))iX.call(t,e)&&rw(r,e,t[e]);if(ew)for(var e of ew(t))nX.call(t,e)&&rw(r,e,t[e]);return r},TB=(r,t)=>eX(r,rX(t)),aX=(r,t,e)=>new Promise((i,n)=>{var a=l=>{try{s(e.next(l))}catch(u){n(u)}},o=l=>{try{s(e.throw(l))}catch(u){n(u)}},s=l=>l.done?i(l.value):Promise.resolve(l.value).then(a,o);s((e=e.apply(r,t)).next())}),oX={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},sX=(r,t,e,i,n)=>aX(void 0,null,function*(){const a=Mc(r,t);return new Promise(o=>{if(n)n({x:e.x,y:e.y,z:e.z},(s,l)=>{if(s||!l)o(void 0);else{const u=new tw(l,e.x,e.y,e.z);o(u)}});else{const s=XE(TB(nx({},i),{url:a}),(l,u)=>{if(l||!u)o(void 0);else{const c=new tw(u,e.x,e.y,e.z);o(c)}});e.xhrCancel=()=>s.cancel()}})});function lX(r,t){const e=Array.isArray(r)?r[0]:r,i=(a,o)=>sX(e,a,o,t==null?void 0:t.requestParameters,t==null?void 0:t.getCustomData),n=TB(nx(nx({},oX),t),{getTileData:i});return{data:e,dataArray:[],tilesetOptions:n,isTile:!0}}function uX(r,t,e){switch(r){case"+":return t+e;case"-":return t-e;case"*":return t*e;case"/":return t/e;case"%":return t%e;case"^":return Math.pow(t,e);case"abs":return Math.abs(t);case"floor":return Math.floor(t);case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"sin":return Math.sin(t);case"cos":return Math.cos(t);case"atan":return e===-1?Math.atan(t):Math.atan2(t,e);case"min":return Math.min(t,e);case"max":return Math.max(t,e);case"log10":return Math.log(t);case"log2":return Math.log2(t);default:return console.warn("Calculate symbol err! Return default 0"),0}}function jf(r,t){const{width:e,height:i}=t[0],n=t.map(l=>l.rasterData),a=e*i,o=[],s=JSON.stringify(r);for(let l=0;l<a;l++){const u=JSON.parse(s),c=bB(u,n,l);if(typeof c=="number")o.push(c);else{const h=ax(u);o.push(h)}}return o}function bB(r,t,e){if(r.length===2&&r[0]==="band"&&typeof r[1]=="number")try{return t[r[1]][e]}catch{return console.warn("Raster Data err!"),0}r.map((i,n)=>{if(Array.isArray(i)&&i.length>0)switch(i[0]){case"band":try{r[n]=t[i[1]][e]}catch{console.warn("Raster Data err!"),r[n]=0}break;default:bB(i,t,e)}})}function cX(r){const[t,e=-1,i=-1]=r;return t===void 0?(console.warn("Express err!"),["+",0,0]):[t.replace(/\s+/g,""),e,i]}function ax(r){const t=cX(r),e=t[0];let i=t[1],n=t[2];return Array.isArray(i)&&(i=ax(r[1])),Array.isArray(n)&&(n=ax(r[2])),uX(e,i,n)}var hX={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:fX}};function fX(r,t){const e=r[0].rasterData,i=r[1].rasterData,n=r[2].rasterData,a=[],[o,s]=(t==null?void 0:t.countCut)||[2,98],l=(t==null?void 0:t.RMinMax)||Ic(e,o,s),u=(t==null?void 0:t.GMinMax)||Ic(i,o,s),c=(t==null?void 0:t.BMinMax)||Ic(n,o,s);for(let h=0;h<e.length;h++)a.push(Math.max(0,e[h]-l[0])),a.push(Math.max(0,i[h]-u[0])),a.push(Math.max(0,n[h]-c[0]));return{rasterData:a,rMinMax:l,gMinMax:u,bMinMax:c}}function Ic(r,t,e){const i=r.slice().sort((s,l)=>s-l),n=i.length,a=i[Math.ceil(n*t/100)],o=i[Math.ceil(n*e/100)];return[a,o]}var dX=Object.defineProperty,vX=Object.defineProperties,pX=Object.getOwnPropertyDescriptors,iw=Object.getOwnPropertySymbols,gX=Object.prototype.hasOwnProperty,mX=Object.prototype.propertyIsEnumerable,nw=(r,t,e)=>t in r?dX(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,yX=(r,t)=>{for(var e in t||(t={}))gX.call(t,e)&&nw(r,e,t[e]);if(iw)for(var e of iw(t))mX.call(t,e)&&nw(r,e,t[e]);return r},_X=(r,t)=>vX(r,pX(t)),wB=(r,t,e)=>new Promise((i,n)=>{var a=l=>{try{s(e.next(l))}catch(u){n(u)}},o=l=>{try{s(e.throw(l))}catch(u){n(u)}},s=l=>l.done?i(l.value):Promise.resolve(l.value).then(a,o);s((e=e.apply(r,t)).next())});function JE(r,t,e){return wB(this,null,function*(){if(r.length===0)return{rasterData:[0],width:1,heigh:1};const i=yield Promise.all(r.map(({data:l,bands:u=[0]})=>t(l,u))),n=[];i.forEach(l=>{Array.isArray(l)?n.push(...l):n.push(l)});const{width:a,height:o}=n[0];let s;switch(typeof e){case"function":s=e(n);break;case"object":Array.isArray(e)?s={rasterData:jf(e,n)}:s=xX(e,n);break;default:s={rasterData:n[0].rasterData}}return _X(yX({},s),{width:a,height:o})})}function xX(r,t){const e=hX[r.type];if(e.type==="function")return e.method(t,r==null?void 0:r.options);if(e.type==="operation")return r.type==="rgb"?CX(e.expression,t):{rasterData:jf(e.expression,t)}}function CX(r,t){r.r===void 0&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),r.g===void 0&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),r.b===void 0&&console.warn("Channel B lost in Operation! Use band[0] to fill!");const e=jf(r.r||["band",0],t),i=jf(r.g||["band",0],t),n=jf(r.b||["band",0],t);return[e,i,n]}function ox(r,t,e,i){return wB(this,null,function*(){const n=yield JE(r,t,e);i(null,{data:n})})}function EX(r,t){const{extent:e=[121.168,30.2828,121.384,30.4219],coordinates:i,width:n,height:a,min:o,max:s,format:l,operation:u}=t;let c,h,f;if(l===void 0||xB(r))c=Array.from(r),h=n,f=a;else{const p=Array.isArray(r)?r:[r];c=JE(p,l,u)}const d=bh(i,e);return{_id:1,dataArray:[{_id:1,data:c,width:h,height:f,min:o,max:s,coordinates:d}]}}let yv=function(r){return r.Normal="normal",r.PostProcessing="post-processing",r}({}),w=function(r){return r[r.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",r[r.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",r[r.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r[r.ZERO=0]="ZERO",r[r.ONE=1]="ONE",r[r.SRC_COLOR=768]="SRC_COLOR",r[r.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",r[r.SRC_ALPHA=770]="SRC_ALPHA",r[r.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",r[r.DST_ALPHA=772]="DST_ALPHA",r[r.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",r[r.DST_COLOR=774]="DST_COLOR",r[r.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",r[r.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",r[r.FUNC_ADD=32774]="FUNC_ADD",r[r.BLEND_EQUATION=32777]="BLEND_EQUATION",r[r.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",r[r.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",r[r.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",r[r.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",r[r.MAX_EXT=32776]="MAX_EXT",r[r.MIN_EXT=32775]="MIN_EXT",r[r.BLEND_DST_RGB=32968]="BLEND_DST_RGB",r[r.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",r[r.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",r[r.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",r[r.CONSTANT_COLOR=32769]="CONSTANT_COLOR",r[r.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",r[r.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",r[r.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",r[r.BLEND_COLOR=32773]="BLEND_COLOR",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",r[r.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",r[r.STREAM_DRAW=35040]="STREAM_DRAW",r[r.STATIC_DRAW=35044]="STATIC_DRAW",r[r.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",r[r.BUFFER_SIZE=34660]="BUFFER_SIZE",r[r.BUFFER_USAGE=34661]="BUFFER_USAGE",r[r.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",r[r.FRONT=1028]="FRONT",r[r.BACK=1029]="BACK",r[r.FRONT_AND_BACK=1032]="FRONT_AND_BACK",r[r.CULL_FACE=2884]="CULL_FACE",r[r.BLEND=3042]="BLEND",r[r.DITHER=3024]="DITHER",r[r.STENCIL_TEST=2960]="STENCIL_TEST",r[r.DEPTH_TEST=2929]="DEPTH_TEST",r[r.SCISSOR_TEST=3089]="SCISSOR_TEST",r[r.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",r[r.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",r[r.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",r[r.NO_ERROR=0]="NO_ERROR",r[r.INVALID_ENUM=1280]="INVALID_ENUM",r[r.INVALID_VALUE=1281]="INVALID_VALUE",r[r.INVALID_OPERATION=1282]="INVALID_OPERATION",r[r.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",r[r.CW=2304]="CW",r[r.CCW=2305]="CCW",r[r.LINE_WIDTH=2849]="LINE_WIDTH",r[r.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",r[r.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",r[r.CULL_FACE_MODE=2885]="CULL_FACE_MODE",r[r.FRONT_FACE=2886]="FRONT_FACE",r[r.DEPTH_RANGE=2928]="DEPTH_RANGE",r[r.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",r[r.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",r[r.DEPTH_FUNC=2932]="DEPTH_FUNC",r[r.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",r[r.STENCIL_FUNC=2962]="STENCIL_FUNC",r[r.STENCIL_FAIL=2964]="STENCIL_FAIL",r[r.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",r[r.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",r[r.STENCIL_REF=2967]="STENCIL_REF",r[r.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",r[r.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",r[r.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",r[r.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",r[r.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",r[r.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",r[r.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",r[r.VIEWPORT=2978]="VIEWPORT",r[r.SCISSOR_BOX=3088]="SCISSOR_BOX",r[r.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",r[r.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",r[r.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",r[r.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",r[r.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",r[r.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",r[r.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",r[r.RED_BITS=3410]="RED_BITS",r[r.GREEN_BITS=3411]="GREEN_BITS",r[r.BLUE_BITS=3412]="BLUE_BITS",r[r.ALPHA_BITS=3413]="ALPHA_BITS",r[r.DEPTH_BITS=3414]="DEPTH_BITS",r[r.STENCIL_BITS=3415]="STENCIL_BITS",r[r.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",r[r.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",r[r.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",r[r.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",r[r.SAMPLES=32937]="SAMPLES",r[r.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",r[r.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",r[r.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",r[r.DONT_CARE=4352]="DONT_CARE",r[r.FASTEST=4353]="FASTEST",r[r.NICEST=4354]="NICEST",r[r.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",r[r.BYTE=5120]="BYTE",r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.SHORT=5122]="SHORT",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.INT=5124]="INT",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.FLOAT=5126]="FLOAT",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.ALPHA=6406]="ALPHA",r[r.RGB=6407]="RGB",r[r.RGBA=6408]="RGBA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.RED=6403]="RED",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",r[r.VERTEX_SHADER=35633]="VERTEX_SHADER",r[r.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",r[r.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",r[r.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",r[r.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",r[r.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",r[r.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",r[r.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",r[r.SHADER_TYPE=35663]="SHADER_TYPE",r[r.DELETE_STATUS=35712]="DELETE_STATUS",r[r.LINK_STATUS=35714]="LINK_STATUS",r[r.VALIDATE_STATUS=35715]="VALIDATE_STATUS",r[r.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",r[r.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",r[r.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",r[r.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",r[r.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",r[r.NEVER=512]="NEVER",r[r.LESS=513]="LESS",r[r.EQUAL=514]="EQUAL",r[r.LEQUAL=515]="LEQUAL",r[r.GREATER=516]="GREATER",r[r.NOTEQUAL=517]="NOTEQUAL",r[r.GEQUAL=518]="GEQUAL",r[r.ALWAYS=519]="ALWAYS",r[r.KEEP=7680]="KEEP",r[r.REPLACE=7681]="REPLACE",r[r.INCR=7682]="INCR",r[r.DECR=7683]="DECR",r[r.INVERT=5386]="INVERT",r[r.INCR_WRAP=34055]="INCR_WRAP",r[r.DECR_WRAP=34056]="DECR_WRAP",r[r.VENDOR=7936]="VENDOR",r[r.RENDERER=7937]="RENDERER",r[r.VERSION=7938]="VERSION",r[r.NEAREST=9728]="NEAREST",r[r.LINEAR=9729]="LINEAR",r[r.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",r[r.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",r[r.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",r[r.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",r[r.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",r[r.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",r[r.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",r[r.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE=5890]="TEXTURE",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r[r.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",r[r.TEXTURE0=33984]="TEXTURE0",r[r.TEXTURE1=33985]="TEXTURE1",r[r.TEXTURE2=33986]="TEXTURE2",r[r.TEXTURE3=33987]="TEXTURE3",r[r.TEXTURE4=33988]="TEXTURE4",r[r.TEXTURE5=33989]="TEXTURE5",r[r.TEXTURE6=33990]="TEXTURE6",r[r.TEXTURE7=33991]="TEXTURE7",r[r.TEXTURE8=33992]="TEXTURE8",r[r.TEXTURE9=33993]="TEXTURE9",r[r.TEXTURE10=33994]="TEXTURE10",r[r.TEXTURE11=33995]="TEXTURE11",r[r.TEXTURE12=33996]="TEXTURE12",r[r.TEXTURE13=33997]="TEXTURE13",r[r.TEXTURE14=33998]="TEXTURE14",r[r.TEXTURE15=33999]="TEXTURE15",r[r.TEXTURE16=34e3]="TEXTURE16",r[r.TEXTURE17=34001]="TEXTURE17",r[r.TEXTURE18=34002]="TEXTURE18",r[r.TEXTURE19=34003]="TEXTURE19",r[r.TEXTURE20=34004]="TEXTURE20",r[r.TEXTURE21=34005]="TEXTURE21",r[r.TEXTURE22=34006]="TEXTURE22",r[r.TEXTURE23=34007]="TEXTURE23",r[r.TEXTURE24=34008]="TEXTURE24",r[r.TEXTURE25=34009]="TEXTURE25",r[r.TEXTURE26=34010]="TEXTURE26",r[r.TEXTURE27=34011]="TEXTURE27",r[r.TEXTURE28=34012]="TEXTURE28",r[r.TEXTURE29=34013]="TEXTURE29",r[r.TEXTURE30=34014]="TEXTURE30",r[r.TEXTURE31=34015]="TEXTURE31",r[r.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",r[r.REPEAT=10497]="REPEAT",r[r.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r[r.FLOAT_VEC2=35664]="FLOAT_VEC2",r[r.FLOAT_VEC3=35665]="FLOAT_VEC3",r[r.FLOAT_VEC4=35666]="FLOAT_VEC4",r[r.INT_VEC2=35667]="INT_VEC2",r[r.INT_VEC3=35668]="INT_VEC3",r[r.INT_VEC4=35669]="INT_VEC4",r[r.BOOL=35670]="BOOL",r[r.BOOL_VEC2=35671]="BOOL_VEC2",r[r.BOOL_VEC3=35672]="BOOL_VEC3",r[r.BOOL_VEC4=35673]="BOOL_VEC4",r[r.FLOAT_MAT2=35674]="FLOAT_MAT2",r[r.FLOAT_MAT3=35675]="FLOAT_MAT3",r[r.FLOAT_MAT4=35676]="FLOAT_MAT4",r[r.SAMPLER_2D=35678]="SAMPLER_2D",r[r.SAMPLER_CUBE=35680]="SAMPLER_CUBE",r[r.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",r[r.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",r[r.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",r[r.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",r[r.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",r[r.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",r[r.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",r[r.COMPILE_STATUS=35713]="COMPILE_STATUS",r[r.LOW_FLOAT=36336]="LOW_FLOAT",r[r.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",r[r.HIGH_FLOAT=36338]="HIGH_FLOAT",r[r.LOW_INT=36339]="LOW_INT",r[r.MEDIUM_INT=36340]="MEDIUM_INT",r[r.HIGH_INT=36341]="HIGH_INT",r[r.FRAMEBUFFER=36160]="FRAMEBUFFER",r[r.RENDERBUFFER=36161]="RENDERBUFFER",r[r.RGBA4=32854]="RGBA4",r[r.RGB5_A1=32855]="RGB5_A1",r[r.RGB565=36194]="RGB565",r[r.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",r[r.STENCIL_INDEX=6401]="STENCIL_INDEX",r[r.STENCIL_INDEX8=36168]="STENCIL_INDEX8",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r[r.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",r[r.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",r[r.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",r[r.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",r[r.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",r[r.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",r[r.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",r[r.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",r[r.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",r[r.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",r[r.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",r[r.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",r[r.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",r[r.NONE=0]="NONE",r[r.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",r[r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",r[r.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",r[r.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",r[r.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",r[r.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",r[r.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",r[r.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",r[r.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",r[r.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",r[r.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",r[r.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",r}({});const SX=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,{camelCase:AX,isNil:TX,upperFirst:bX}=er;class hs{constructor(){E(this,"shaderModuleService",void 0),E(this,"rendererService",void 0),E(this,"config",void 0),E(this,"quad",SX),E(this,"enabled",!0),E(this,"renderToScreen",!1),E(this,"model",void 0),E(this,"name",void 0),E(this,"optionsToUpdate",{})}getName(){return this.name}setName(t){this.name=t}getType(){return yv.PostProcessing}init(t,e){this.config=e,this.rendererService=t.getContainer().rendererService,this.shaderModuleService=t.getContainer().shaderModuleService;const{createAttribute:i,createBuffer:n,createModel:a}=this.rendererService,{vs:o,fs:s,uniforms:l}=this.setupShaders();this.model=a({vs:o,fs:s,attributes:{a_Position:i({buffer:n({data:[-4,-4,4,-4,0,4],type:w.FLOAT}),size:2})},uniforms:G(G({u_Texture:null},l),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}render(t,e){const i=t.multiPassRenderer.getPostProcessor(),{useFramebuffer:n,getViewportSize:a,clear:o}=this.rendererService,{width:s,height:l}=a();n(this.renderToScreen?null:i.getWriteFBO(),()=>{o({framebuffer:i.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});const u=G({u_BloomFinal:0,u_Texture:i.getReadFBO(),u_ViewportSize:[s,l]},this.convertOptionsToUniforms(this.optionsToUpdate));e&&(u.u_BloomFinal=1,u.u_Texture2=e),this.model.draw({uniforms:u})})}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}setRenderToScreen(t){this.renderToScreen=t}updateOptions(t){this.optionsToUpdate=G(G({},this.optionsToUpdate),t)}setupShaders(){throw new Error("Method not implemented.")}convertOptionsToUniforms(t){const e={};return Object.keys(t).forEach(i=>{TX(t[i])||(e[`u_${bX(AX(i))}`]=t[i])}),e}}function wX(r){let t=0;switch(r){case"vec2":case"ivec2":t=2;break;case"vec3":case"ivec3":t=3;break;case"vec4":case"ivec4":case"mat2":t=4;break;case"mat3":t=9;break;case"mat4":t=16;break}return t}const RB=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function aw(r,t=!1){const e={};return r=r.replace(RB,(i,n,a)=>{const o=a.split(":"),s=o[0].trim();let l="";switch(o.length>1&&(l=o[1].trim()),n){case"bool":l=l==="true";break;case"float":case"int":l=Number(l);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":l?l=l.replace("[","").replace("]","").split(",").reduce((u,c)=>(u.push(Number(c.trim())),u),[]):l=new Array(wX(n)).fill(0);break}return e[s]=l,`${t?"uniform ":""}${n} ${s};
`}),{content:r,uniforms:e}}function w_(r){let{content:t,uniforms:e}=aw(r,!0);return t=t.replace(/(\s*uniform\s*.*\s*){((?:\s*.*\s*)*?)};/g,(i,n,a)=>{a=a.trim().replace(/^.*$/gm,l=>`uniform ${l}`);const{content:o,uniforms:s}=aw(a);return Object.assign(e,s),`${n}{
${o}
};`}),{content:t,uniforms:e}}function ow(r){const t={};return r.replace(RB,(e,i,n)=>{const a=n.trim();return t[a]?"":(t[a]=!0,`uniform ${i} ${a};
`)})}const Al={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"};let qc=function(r){return r.TOPRIGHT="topright",r.TOPLEFT="topleft",r.BOTTOMRIGHT="bottomright",r.BOTTOMLEFT="bottomleft",r.TOPCENTER="topcenter",r.BOTTOMCENTER="bottomcenter",r.LEFTCENTER="leftcenter",r.RIGHTCENTER="rightcenter",r.LEFTTOP="lefttop",r.RIGHTTOP="righttop",r.LEFTBOTTOM="leftbottom",r.RIGHTBOTTOM="rightbottom",r}({}),Kc=function(r){return r[r.LNGLAT=1]="LNGLAT",r[r.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",r[r.VECTOR_TILE=3]="VECTOR_TILE",r[r.IDENTITY=4]="IDENTITY",r[r.METER_OFFSET=5]="METER_OFFSET",r}({});const Ku={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",RelativeOrigin:"u_RelativeOrigin"};var Mr={MapInitStart:"mapInitStart",LayerInitStart:"layerInitStart",LayerInitEnd:"layerInitEnd",SourceInitStart:"sourceInitStart",SourceInitEnd:"sourceInitEnd",ScaleInitStart:"scaleInitStart",ScaleInitEnd:"scaleInitEnd",MappingStart:"mappingStart",MappingEnd:"mappingEnd",BuildModelStart:"buildModelStart",BuildModelEnd:"buildModelEnd"};let ki=function(r){return r.Hover="hover",r.Click="click",r.Select="select",r.Active="active",r.Drag="drag",r}({}),Ms=function(r){return r.normal="normal",r.additive="additive",r.subtractive="subtractive",r.min="min",r.max="max",r.none="none",r}({}),zl=function(r){return r.MULTIPLE="MULTIPLE",r.SINGLE="SINGLE",r}({}),Hm=function(r){return r.AND="and",r.OR="or",r}({}),jr=function(r){return r.INIT="init",r.UPDATE="update",r}({}),Ae=function(r){return r.LINEAR="linear",r.SEQUENTIAL="sequential",r.POWER="power",r.LOG="log",r.IDENTITY="identity",r.TIME="time",r.QUANTILE="quantile",r.QUANTIZE="quantize",r.THRESHOLD="threshold",r.CAT="cat",r.DIVERGING="diverging",r.CUSTOM="threshold",r}({}),Qu=function(r){return r.CONSTANT="constant",r.VARIABLE="variable",r}({}),pt=function(r){return r[r.Attribute=0]="Attribute",r[r.InstancedAttribute=1]="InstancedAttribute",r[r.Uniform=2]="Uniform",r}({});const hu=["mapload","mapchange","mapAfterFrameChange"],tf=30;function RX({characterSet:r,getFontWidth:t,fontHeight:e,buffer:i,maxCanvasWidth:n,mapping:a={},xOffset:o=0,yOffset:s=0}){let l=0,u=o;Array.from(r).forEach((h,f)=>{if(!a[h]){const d=t(h,f);u+tf>n&&(u=0,l++),a[h]={x:u,y:s+l*tf,width:tf,height:tf,advance:d},u+=tf}});const c=e+i*2;return{mapping:a,xOffset:u,yOffset:s+l*c,canvasHeight:MB(s+(l+1)*c)}}function MX(r,t,e){let i=0,n=0,a=0,o=[];const s={};for(const u of r)if(!s[u.id]){const{size:c}=u;i+c+t>e&&(sw(s,o,n),i=0,n=a+n+t,a=0,o=[]),o.push({icon:u,xOffset:i}),i=i+c+t,a=Math.max(a,c)}o.length>0&&sw(s,o,n);const l=MB(a+n+t);return{mapping:s,canvasHeight:l}}function sw(r,t,e){for(const i of t){const{icon:n,xOffset:a}=i;r[n.id]=G(G({},n),{},{x:a,y:e,image:n.image,width:n.width,height:n.height})}}function MB(r){return Math.pow(2,Math.ceil(Math.log2(r)))}const IX=UX(),LX="sans-serif",OX="normal",PX=24,FX=3,BX=.25,DX=8,lw=1024,NX=1,uw=1,kX=3;function UX(){const r=[];for(let t=32;t<128;t++)r.push(String.fromCharCode(t));return r}function cw(r,t,e,i){r.font=`${i} ${e}px ${t}`,r.fillStyle="black",r.textBaseline="middle"}function hw(r,t){for(let e=0;e<r.length;e++)t.data[4*e+3]=r[e]}class zX extends Li.EventEmitter{constructor(...t){super(...t),E(this,"fontAtlas",void 0),E(this,"iconFontMap",void 0),E(this,"iconFontGlyphs",{}),E(this,"fontOptions",void 0),E(this,"key",void 0),E(this,"cache",new MV(kX))}get scale(){return uw}get canvas(){const t=this.cache.get(this.key);return t&&t.data}get mapping(){const t=this.cache.get(this.key);return t&&t.mapping||{}}getCanvasByKey(t){const e=this.cache.get(t);return e&&e.data}getMappingByKey(t){const e=this.cache.get(t);return e&&e.mapping||{}}init(){this.cache.clear(),this.fontOptions={fontFamily:LX,fontWeight:OX,characterSet:IX,fontSize:PX,buffer:FX,sdf:!0,cutoff:BX,radius:DX,iconfont:!1},this.key="",this.iconFontMap=new Map}addIconGlyphs(t){t.forEach(e=>{this.iconFontGlyphs[e.name]=e.unicode})}addIconFont(t,e){this.iconFontMap.set(t,e)}getIconFontKey(t){return this.iconFontMap.get(t)||t}getGlyph(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}setFontOptions(t){this.fontOptions=G(G({},this.fontOptions),t),this.key=this.getKey();const e=this.getNewChars(this.key,this.fontOptions.characterSet),i=this.cache.get(this.key);if(i&&e.length===0)return;const n=this.generateFontAtlas(this.key,e,i);this.fontAtlas=n,this.cache.set(this.key,n)}addFontFace(t,e){const i=document.createElement("style");i.type="text/css",i.innerText=`
        @font-face{
            font-family: '${t}';
            src: url('${e}') format('woff2'),
            url('${e}') format('woff'),
            url('${e}') format('truetype');
        }`,i.onload=()=>{if(document.fonts)try{document.fonts.load(`24px ${t}`,"L7text"),document.fonts.ready.then(()=>{this.emit("fontloaded",{fontFamily:t})})}catch(n){console.warn("当前环境不支持 document.fonts !"),console.warn("当前环境不支持 iconfont !"),console.warn(n)}},document.getElementsByTagName("head")[0].appendChild(i)}destroy(){this.cache.clear(),this.iconFontMap.clear()}generateFontAtlas(t,e,i){const{fontFamily:n,fontWeight:a,fontSize:o,buffer:s,sdf:l,radius:u,cutoff:c,iconfont:h}=this.fontOptions;let f=i&&i.data;f||(f=window.document.createElement("canvas"),f.width=lw);const d=f.getContext("2d",{willReadFrequently:!0});cw(d,n,o,a);const{mapping:v,canvasHeight:p,xOffset:g,yOffset:m}=RX(G({getFontWidth:_=>d.measureText(_).width,fontHeight:o*uw,buffer:s,characterSet:e,maxCanvasWidth:lw},i&&{mapping:i.mapping,xOffset:i.xOffset,yOffset:i.yOffset})),y=d.getImageData(0,0,f.width,f.height);if(f.height=p,d.putImageData(y,0,0),cw(d,n,o,a),l){const _=new P$(o,s,u,c,n,a),x=d.getImageData(0,0,_.size,_.size);for(const C of e){if(h){const A=String.fromCharCode(parseInt(C.replace("&#x","").replace(";",""),16)),b=_.draw(A);hw(b,x)}else hw(_.draw(C),x);d.putImageData(x,v[C].x,v[C].y)}}else for(const _ of e)d.fillText(_,v[_].x,v[_].y+o*NX);return{xOffset:g,yOffset:m,mapping:v,data:f,width:f.width,height:f.height}}getKey(){const{fontFamily:t,fontWeight:e}=this.fontOptions;return`${t}_${e}`}getNewChars(t,e){const i=this.cache.get(t);if(!i)return e;const n=[],a=i.mapping,o=new Set(Object.keys(a));return new Set(e).forEach(l=>{o.has(l)||n.push(l)}),n}}const HX=3,fw=1024,ef=64;class $X extends Li.EventEmitter{constructor(...t){super(...t),E(this,"canvasHeight",128),E(this,"texture",void 0),E(this,"canvas",void 0),E(this,"iconData",void 0),E(this,"iconMap",void 0),E(this,"ctx",void 0),E(this,"loadingImageCount",0)}isLoading(){return this.loadingImageCount===0}init(){this.iconData=[],this.iconMap={},this.canvas=window.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}addImage(t,e){var i=this;return Z(function*(){let n=new Image;i.loadingImageCount++,i.hasImage(t)?console.warn("Image Id already exists"):i.iconData.push({id:t,size:ef}),i.updateIconMap(),n=yield i.loadImage(e);const a=i.iconData.find(o=>o.id===t);a&&(a.image=n,a.width=n.width,a.height=n.height),i.update()})()}addImageMini(t,e,i){const n=i.getSceneConfig().canvas;let a=n.createImage();if(this.loadingImageCount++,this.hasImage(t))throw new Error("Image Id already exists");this.iconData.push({id:t,size:ef}),this.updateIconMap(),this.loadImageMini(e,n).then(o=>{a=o;const s=this.iconData.find(l=>l.id===t);s&&(s.image=a,s.width=a.width,s.height=a.height),this.update()})}getTexture(){return this.texture}getIconMap(){return this.iconMap}getCanvas(){return this.canvas}hasImage(t){return this.iconMap.hasOwnProperty(t)}removeImage(t){this.hasImage(t)&&(this.iconData=this.iconData.filter(e=>e.id!==t),delete this.iconMap[t],this.update())}destroy(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}loadImage(t){return new Promise((e,i)=>{if(t instanceof HTMLImageElement){e(t);return}const n=new Image;n.crossOrigin="anonymous",n.onload=()=>{e(n)},n.onerror=()=>{i(new Error("Could not load image at "+t))},n.src=t instanceof File?URL.createObjectURL(t):t})}update(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}updateIconAtlas(){this.canvas.width=fw,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(t=>{const{x:e,y:i,image:n,width:a=64,height:o=64}=this.iconMap[t],l=Math.max(a,o)/ef,u=o/l,c=a/l;n&&this.ctx.drawImage(n,e+(ef-c)/2,i+(ef-u)/2,c,u)})}updateIconMap(){const{mapping:t,canvasHeight:e}=MX(this.iconData,HX,fw);this.iconMap=t,this.canvasHeight=e}loadImageMini(t,e){return new Promise((i,n)=>{const a=e.createImage();a.crossOrigin="anonymous",a.onload=()=>{i(a)},a.onerror=()=>{n(new Error("Could not load image at "+t))},a.src=t})}}class WX{constructor(){E(this,"viewport",void 0),E(this,"overridedViewProjectionMatrix",void 0),E(this,"viewMatrixInverse",void 0),E(this,"cameraPosition",void 0)}init(){}update(t){this.viewport=t,this.viewMatrixInverse=Ou(),g0(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}getProjectionMatrix(){return this.viewport.getProjectionMatrix()}getModelMatrix(){return this.viewport.getModelMatrix()}getViewMatrix(){return this.viewport.getViewMatrix()}getViewMatrixUncentered(){return this.viewport.getViewMatrixUncentered()}getViewProjectionMatrixUncentered(){return this.viewport.getViewProjectionMatrixUncentered()}getViewProjectionMatrix(){return this.overridedViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}getZoom(){return this.viewport.getZoom()}getZoomScale(){return this.viewport.getZoomScale()}getCenter(){const[t,e]=this.viewport.getCenter();return[t,e]}getFocalDistance(){return this.viewport.getFocalDistance()}getCameraPosition(){return this.cameraPosition}projectFlat(t,e){return this.viewport.projectFlat(t,e)}setViewProjectionMatrix(t){this.overridedViewProjectionMatrix=t}}const VX={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"};class GX{constructor(){E(this,"container",void 0),E(this,"controlCorners",void 0),E(this,"controlContainer",void 0),E(this,"scene",void 0),E(this,"mapsService",void 0),E(this,"controls",[]),E(this,"unAddControls",[])}init(t,e){this.container=t.container,this.scene=e,this.mapsService=e.mapService,this.initControlPos()}addControl(t,e){e.mapService.map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}getControlByName(t){return this.controls.find(e=>e.controlOption.name===t)}removeControl(t){const e=this.controls.indexOf(t);return e>-1&&this.controls.splice(e,1),t.remove(),this}addControls(){this.unAddControls.forEach(t=>{t.addTo(this.scene),this.controls.push(t)}),this.unAddControls=[]}destroy(){for(const t of this.controls)t.remove();this.controls=[],this.clearControlPos()}initControlPos(){const t=this.controlCorners={},e="l7-",i=this.controlContainer=we("div",e+"control-container",this.container);function n(o=[]){const s=o.map(l=>e+l).join(" ");t[o.filter(l=>!["row","column"].includes(l)).join("")]=we("div",s,i)}function a(o){return[...o.replace(/^(top|bottom|left|right|center)/,"$1-").split("-"),VX[o]]}Object.values(qc).forEach(o=>{n(a(o))}),this.checkCornerOverlap()}clearControlPos(){for(const t in this.controlCorners)this.controlCorners[t]&&xn(this.controlCorners[t]);this.controlContainer&&xn(this.controlContainer)}checkCornerOverlap(){const t=window.MutationObserver;if(t)for(const e of Object.keys(this.controlCorners)){const i=e.match(/^(top|bottom)(left|right)$/);if(i){const[,n,a]=i,o=this.controlCorners[`${n}${a}`];new t(([{target:l}])=>{o&&(o.style[n]=l.clientHeight+"px")}).observe(this.controlCorners[`${a}${n}`],{childList:!0,attributes:!0})}}}}class XX{constructor(){E(this,"container",void 0),E(this,"scene",void 0),E(this,"mapsService",void 0),E(this,"markers",[]),E(this,"markerLayers",[]),E(this,"unAddMarkers",[]),E(this,"unAddMarkerLayers",[])}addMarkerLayer(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}removeMarkerLayer(t){t.destroy(),this.markerLayers.indexOf(t);const e=this.markerLayers.indexOf(t);e>-1&&this.markerLayers.splice(e,1)}addMarker(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}addMarkers(){this.unAddMarkers.forEach(t=>{t.addTo(this.scene),this.markers.push(t)}),this.unAddMarkers=[]}addMarkerLayers(){this.unAddMarkerLayers.forEach(t=>{this.markerLayers.push(t),t.addTo(this.scene)}),this.unAddMarkers=[]}removeMarker(t){t.remove(),this.markers.indexOf(t);const e=this.markers.indexOf(t);e>-1&&this.markers.splice(e,1)}removeAllMarkers(){this.destroy()}init(t){this.scene=t,this.mapsService=t.mapService}destroy(){this.markers.forEach(t=>{t.remove()}),this.markers=[],this.markerLayers.forEach(t=>{t.destroy()}),this.markerLayers=[]}removeMakerLayerMarker(t){t.destroy()}}class YX{constructor(){E(this,"scene",void 0),E(this,"mapsService",void 0),E(this,"popups",[]),E(this,"unAddPopups",[])}get isMarkerReady(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}removePopup(t){t!=null&&t.isOpen()&&t.remove();const e=this.popups.indexOf(t);e>-1&&this.popups.splice(e,1);const i=this.unAddPopups.indexOf(t);i>-1&&this.unAddPopups.splice(i,1)}destroy(){this.popups.forEach(t=>t.remove())}addPopup(t){t&&t.getOptions().autoClose&&[...this.popups,...this.unAddPopups].forEach(e=>{e.getOptions().autoClose&&this.removePopup(e)}),this.isMarkerReady?(t.addTo(this.scene),this.popups.push(t)):this.unAddPopups.push(t),t.on("close",()=>{this.removePopup(t)})}initPopup(){this.unAddPopups.length&&this.unAddPopups.forEach(t=>{this.addPopup(t),this.unAddPopups=[]})}init(t){this.scene=t,this.mapsService=t.mapService}}const jX={MapToken:"您正在使用 Demo 测试 Token, 生产环境务必自行注册 Token 确保服务稳定 高德地图申请地址 https://lbs.amap.com/api/javascript-api/guide/abc/prepare  Mapbox地图申请地址 https://docs.mapbox.com/help/glossary/access-token/",SDK:"请确认引入了mapbox-gl api且在L7之前引入"},{merge:ZX}=er,qX={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},KX={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:Hm.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0};class QX{constructor(){E(this,"sceneConfigCache",{}),E(this,"layerConfigCache",{}),E(this,"layerAttributeConfigCache",{})}getSceneConfig(t){return this.sceneConfigCache[t]}getSceneWarninfo(t){return jX[t]}setSceneConfig(t,e){this.sceneConfigCache[t]=G(G({},qX),e)}getLayerConfig(t){return this.layerConfigCache[t]}setLayerConfig(t,e,i){this.layerConfigCache[e]=G({},ZX({},this.sceneConfigCache[t],KX,i))}getAttributeConfig(t){return this.layerAttributeConfigCache[t]}setAttributeConfig(t,e){this.layerAttributeConfigCache[t]=G(G({},this.layerAttributeConfigCache[t]),e)}clean(){this.sceneConfigCache={},this.layerConfigCache={}}}const R_=Math.PI/180,JX=512,dw=4003e4;function vw({latitude:r=0,zoom:t=0,scale:e,highPrecision:i=!1,flipY:n=!1}){e=e!==void 0?e:Math.pow(2,t);const a={},o=JX*e,s=Math.cos(r*R_),l=o/360,u=l/s,c=o/dw/s;if(a.pixelsPerMeter=[c,-c,c],a.metersPerPixel=[1/c,-1/c,1/c],a.pixelsPerDegree=[l,-u,c],a.degreesPerPixel=[1/l,-1/u,1/c],i){const h=R_*Math.tan(r*R_)/s,f=l*h/2,d=o/dw*h,v=d/u*c;a.pixelsPerDegree2=[0,-f,d],a.pixelsPerMeter2=[v,0,v],n&&(a.pixelsPerDegree2[1]=-a.pixelsPerDegree2[1],a.pixelsPerMeter2[1]=-a.pixelsPerMeter2[1])}return n&&(a.pixelsPerMeter[1]=-a.pixelsPerMeter[1],a.metersPerPixel[1]=-a.metersPerPixel[1],a.pixelsPerDegree[1]=-a.pixelsPerDegree[1],a.degreesPerPixel[1]=-a.degreesPerPixel[1]),a}const tY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];class eY{constructor(t){E(this,"needRefresh",!0),E(this,"coordinateSystem",void 0),E(this,"viewportCenter",void 0),E(this,"viewportCenterProjection",void 0),E(this,"pixelsPerDegree",void 0),E(this,"pixelsPerDegree2",void 0),E(this,"pixelsPerMeter",void 0),this.cameraService=t}refresh(t){const e=this.cameraService.getZoom(),i=t||this.cameraService.getCenter(),{pixelsPerMeter:n,pixelsPerDegree:a}=vw({latitude:i[1],zoom:e});this.viewportCenter=i,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=n,this.pixelsPerDegree=a,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Kc.LNGLAT?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Kc.LNGLAT_OFFSET&&this.calculateLnglatOffset(i,e),this.needRefresh=!1}getCoordinateSystem(){return this.coordinateSystem}setCoordinateSystem(t){this.coordinateSystem=t}getViewportCenter(){return this.viewportCenter}setViewportCenter(t){this.refresh(t)}getViewportCenterProjection(){return this.viewportCenterProjection}getPixelsPerDegree(){return this.pixelsPerDegree}getPixelsPerDegree2(){return this.pixelsPerDegree2}getPixelsPerMeter(){return this.pixelsPerMeter}calculateLnglatOffset(t,e,i,n){const{pixelsPerMeter:a,pixelsPerDegree:o,pixelsPerDegree2:s}=vw({latitude:t[1],zoom:e,scale:i,flipY:n,highPrecision:!0});let l=this.cameraService.getViewMatrix();const u=this.cameraService.getProjectionMatrix();let c=Xf([],u,l);const h=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,e));this.viewportCenterProjection=Nl([],[h[0],h[1],0,1],c),l=this.cameraService.getViewMatrixUncentered()||l,c=Xf([],u,l),c=Xf([],c,tY),this.cameraService.setViewProjectionMatrix(c),this.pixelsPerMeter=a,this.pixelsPerDegree=o,this.pixelsPerDegree2=s}}class rY extends Li.EventEmitter{constructor(...t){super(...t),E(this,"renderMap",new Map),E(this,"enable",!1),E(this,"renderEnable",!1),E(this,"cacheLogs",{})}setEnable(t){this.enable=!!t}log(t,e){if(!this.enable)return;const i=t.split(".");let n=null;i.forEach((a,o)=>{n!==null?(n[a]||(n[a]={}),o!==i.length-1&&(n=n[a])):(this.cacheLogs[a]||(this.cacheLogs[a]={}),o!==i.length-1&&(n=this.cacheLogs[a])),o===i.length-1&&(n[a]=G(G({time:Date.now()},n[a]),e))})}getLog(t){switch(typeof t){case"string":return this.cacheLogs[t];case"object":return t.map(e=>this.cacheLogs[e]).filter(e=>e!==void 0);case"undefined":return this.cacheLogs}}removeLog(t){delete this.cacheLogs[t]}generateRenderUid(){return this.renderEnable?RV():""}renderDebug(t){this.renderEnable=t}renderStart(t){if(!this.renderEnable||!this.enable)return;const e=this.renderMap.get(t)||{};this.renderMap.set(t,G(G({},e),{},{renderUid:t,renderStart:Date.now()}))}renderEnd(t){if(!this.renderEnable||!this.enable)return;const e=this.renderMap.get(t);if(e){const i=e.renderStart,n=Date.now();this.emit("renderEnd",G(G({},e),{},{renderEnd:n,renderDuration:n-i})),this.renderMap.delete(t)}}destroy(){this.cacheLogs=null,this.renderMap.clear()}}const iY={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"};class nY extends NE{get mapService(){return this.container.mapService}constructor(t){super(),E(this,"indragging",!1),E(this,"hammertime",void 0),E(this,"lastClickTime",0),E(this,"lastClickXY",[-1,-1]),E(this,"clickTimer",void 0),E(this,"$containter",void 0),E(this,"onDrag",e=>{const i=this.interactionEvent(e);i.type=iY[i.type],i.type==="dragging"?this.indragging=!0:this.indragging=!1,this.emit(ki.Drag,i)}),E(this,"onHammer",e=>{e.srcEvent.stopPropagation();const i=this.interactionEvent(e);this.emit(ki.Hover,i)}),E(this,"onTouch",e=>{const i=e.touches[0];this.onHover({clientX:i.clientX,clientY:i.clientY,type:"touchstart"})}),E(this,"onTouchEnd",e=>{if(e.changedTouches.length>0){const i=e.changedTouches[0];this.onHover({clientX:i.clientX,clientY:i.clientY,type:"touchend"})}}),E(this,"onTouchMove",e=>{const i=e.changedTouches[0];this.onHover({clientX:i.clientX,clientY:i.clientY,type:"touchmove"})}),E(this,"onHover",e=>{const{clientX:i,clientY:n}=e;let a=i,o=n;const s=e.type,l=this.mapService.getMapContainer();if(l){const{top:c,left:h}=l.getBoundingClientRect();a=a-h-l.clientLeft,o=o-c-l.clientTop}const u=this.mapService.containerToLngLat([a,o]);if(s==="click"){this.isDoubleTap(a,o,u);return}if(s==="touch"){this.isDoubleTap(a,o,u);return}s!=="click"&&s!=="dblclick"&&this.emit(ki.Hover,{x:a,y:o,lngLat:u,type:s,target:e})}),this.container=t}init(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}destroy(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(ki.Hover)}triggerHover({x:t,y:e}){this.emit(ki.Hover,{x:t,y:e})}triggerSelect(t){this.emit(ki.Select,{featureId:t})}triggerActive(t){this.emit(ki.Active,{featureId:t})}addEventListenerOnMap(){const t=this.mapService.getMapContainer();if(t){const e=new Qh.Manager(t);e.add(new Qh.Tap({event:"dblclick",taps:2})),e.add(new Qh.Tap({event:"click"})),e.add(new Qh.Pan({threshold:0,pointers:0})),e.add(new Qh.Press({})),e.on("dblclick click",this.onHammer),e.on("panstart panmove panend pancancel",this.onDrag),t.addEventListener("touchstart",this.onTouch),t.addEventListener("touchend",this.onTouchEnd),t.addEventListener("mousemove",this.onHover),t.addEventListener("touchmove",this.onTouchMove),t.addEventListener("mousedown",this.onHover,!0),t.addEventListener("mouseup",this.onHover),t.addEventListener("contextmenu",this.onHover),this.hammertime=e}}removeEventListenerOnMap(){const t=this.mapService.getMapContainer();t&&(t.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),t.removeEventListener("touchstart",this.onTouch),t.removeEventListener("touchend",this.onTouchEnd),t.removeEventListener("mousedown",this.onHover),t.removeEventListener("mouseup",this.onHover),t.removeEventListener("contextmenu",this.onHover))}interactionEvent(t){const{type:e,pointerType:i}=t;let n,a;i==="touch"?(a=Math.floor(t.pointers[0].clientY),n=Math.floor(t.pointers[0].clientX)):(a=Math.floor(t.srcEvent.y),n=Math.floor(t.srcEvent.x));const o=this.mapService.getMapContainer();if(o){const{top:l,left:u}=o.getBoundingClientRect();n-=u,a-=l}const s=this.mapService.containerToLngLat([n,a]);return{x:n,y:a,lngLat:s,type:e,target:t.srcEvent}}isDoubleTap(t,e,i){const n=new Date().getTime();let a="click";n-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-t)<10&&Math.abs(this.lastClickXY[1]-e)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),a="dblclick",this.emit(ki.Hover,{x:t,y:e,lngLat:i,type:a})):(this.lastClickTime=n,this.lastClickXY=[t,e],this.clickTimer=setTimeout(()=>{a="click",this.emit(ki.Hover,{x:t,y:e,lngLat:i,type:a})},400))}}let aY=0;function oY(r){let t=r;if(typeof r=="string"&&(t=document.getElementById(r)),t){const e=document.createElement("div");return e.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,e.id=`l7-scene-${aY++}`,e.classList.add("l7-scene"),t.appendChild(e),e}return null}function sY(r){var t;let e=!0;if((r==null||(t=r.target)===null||t===void 0?void 0:t.target)instanceof HTMLElement){var i;let a=r==null||(i=r.target)===null||i===void 0?void 0:i.target;for(;a;){var n;const o=Array.from(a.classList);if(o.includes("l7-marker")||o.includes("l7-popup")){e=!1;break}a=(n=a)===null||n===void 0?void 0:n.parentElement}}return e}let fu=function(r){return r[r.SAMPLED=0]="SAMPLED",r[r.RENDER_TARGET=1]="RENDER_TARGET",r}({});class lY{constructor(t){var e=this;E(this,"pickedColors",void 0),E(this,"pickedTileLayers",[]),E(this,"pickingFBO",void 0),E(this,"width",0),E(this,"height",0),E(this,"alreadyInPicking",!1),E(this,"pickBufferScale",1),E(this,"pickFromPickingFBO",function(){var i=Z(function*(n,{x:a,y:o,lngLat:s,type:l,target:u}){var c;let h=!1;const{readPixels:f,readPixelsAsync:d,getViewportSize:v,queryVerdorInfo:p}=e.rendererService,{width:g,height:m}=v(),{enableHighlight:y,enableSelect:_}=n.getLayerConfig(),x=a*Ni,C=o*Ni;if(x>g-1*Ni||x<0||C>m-1*Ni||C<0)return!1;let A;if(p()==="WebGPU"?A=yield d({x:Math.floor(x/e.pickBufferScale),y:Math.floor((m-(o+1)*Ni)/e.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:e.pickingFBO}):A=f({x:Math.floor(x/e.pickBufferScale),y:Math.floor((m-(o+1)*Ni)/e.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:e.pickingFBO}),e.pickedColors=A,A[0]!==0||A[1]!==0||A[2]!==0){const R=Kl(A),M=n.layerPickService.getFeatureById(R);R!==n.getCurrentPickId()&&l==="mousemove"&&(l="mouseenter");const O={x:a,y:o,type:l,lngLat:s,featureId:R,feature:M,target:u};M&&(h=!0,n.setCurrentPickId(R),e.triggerHoverOnLayer(n,O))}else{const R={x:a,y:o,lngLat:s,type:n.getCurrentPickId()!==null&&l==="mousemove"?"mouseout":"un"+l,featureId:null,target:u,feature:null};e.triggerHoverOnLayer(n,G(G({},R),{},{type:"unpick"})),e.triggerHoverOnLayer(n,R),n.setCurrentPickId(null)}if(y&&n.layerPickService.highlightPickedFeature(A),_&&l==="click"&&((c=A)===null||c===void 0?void 0:c.toString())!==[0,0,0,0].toString()){const R=Kl(A);n.getCurrentSelectedId()===null||R!==n.getCurrentSelectedId()?(n.layerPickService.selectFeature(A),n.setCurrentSelectedId(R)):(n.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),n.setCurrentSelectedId(null))}return h});return function(n,a){return i.apply(this,arguments)}}()),this.container=t}get mapService(){return this.container.mapService}get rendererService(){return this.container.rendererService}get configService(){return this.container.globalConfigService}get interactionService(){return this.container.interactionService}get layerService(){return this.container.layerService}init(t){const{createTexture2D:e,createFramebuffer:i,getViewportSize:n}=this.rendererService;let{width:a,height:o}=n();this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,a=Math.round(a/this.pickBufferScale),o=Math.round(o/this.pickBufferScale);const s=e({width:a,height:o,usage:fu.RENDER_TARGET,label:"Picking Texture"});this.pickingFBO=i({color:s,depth:!0,width:a,height:o}),this.interactionService.on(ki.Hover,this.pickingAllLayer.bind(this))}boxPickLayer(t,e,i){var n=this;return Z(function*(){const{useFramebufferAsync:a,clear:o}=n.rendererService;n.resizePickingFBO(),t.hooks.beforePickingEncode.call(),yield a(n.pickingFBO,Z(function*(){o({framebuffer:n.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),t.renderModels({ispick:!0})})),t.hooks.afterPickingEncode.call();const s=yield n.pickBox(t,e);i(s)})()}pickBox(t,e){var i=this;return Z(function*(){const[n,a,o,s]=e.map(m=>{const y=m<0?0:m;return Math.floor(y*Ni/i.pickBufferScale)}),{readPixelsAsync:l,getViewportSize:u}=i.rendererService,{width:c,height:h}=u();if(n>(c-1)*Ni/i.pickBufferScale||o<0||a>(h-1)*Ni/i.pickBufferScale||s<0)return[];const f=Math.min(c/i.pickBufferScale,o)-n,d=Math.min(h/i.pickBufferScale,s)-a,v=yield l({x:n,y:Math.floor(h/i.pickBufferScale-(s+1)),width:f,height:d,data:new Uint8Array(f*d*4),framebuffer:i.pickingFBO}),p=[],g={};for(let m=0;m<v.length/4;m=m+1){const y=v.slice(m*4,m*4+4),_=Kl(y);if(_!==-1&&!g[_]){const x=t.layerPickService.getFeatureById(_);p.push(G(G({},x),{},{pickedFeatureIdx:_})),g[_]=!0}}return p})()}handleCursor(t,e){const{cursor:i="",cursorEnabled:n}=t.getLayerConfig();if(n){const o=this.mapService.getType()==="amap"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),s=o==null?void 0:o.style.getPropertyValue("cursor");e==="unmousemove"&&s!==""?o==null||o.style.setProperty("cursor",""):e==="mousemove"&&(o==null||o.style.setProperty("cursor",i))}}destroy(){this.pickingFBO.destroy(),this.pickingFBO=null}pickingAllLayer(t){var e=this;return Z(function*(){!e.layerService.needPick(t.type)||!e.isPickingAllLayer()||(e.alreadyInPicking=!0,yield e.pickingLayers(t),e.layerService.renderLayers(),e.alreadyInPicking=!1)})()}isPickingAllLayer(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}resizePickingFBO(){const{getViewportSize:t}=this.rendererService,{width:e,height:i}=t();(this.width!==e||this.height!==i)&&(this.pickingFBO.resize({width:Math.round(e/this.pickBufferScale),height:Math.round(i/this.pickBufferScale)}),this.width=e,this.height=i)}pickingLayers(t){var e=this;return Z(function*(){const{clear:i,useFramebufferAsync:n}=e.rendererService;e.resizePickingFBO();const a=e.layerService.getRenderList();for(const o of a.filter(s=>s.needPick(t.type)).reverse()){yield n(e.pickingFBO,Z(function*(){i({framebuffer:e.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),o.layerPickService.pickRender(t)}));const s=yield e.pickFromPickingFBO(o,t);if(e.layerService.pickedLayerId=s?+o.id:-1,s&&!o.getLayerConfig().enablePropagation)break}})()}triggerHoverOnLayer(t,e){sY(e)&&(this.handleCursor(t,e.type),t.emit(e.type,e))}}class uY{constructor(t=!0){E(this,"autoStart",void 0),E(this,"startTime",0),E(this,"oldTime",0),E(this,"running",!1),E(this,"elapsedTime",0),this.autoStart=t}start(){this.startTime=(typeof performance>"u"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=(typeof performance>"u"?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}const{throttle:pw}=er;class cY extends Li.EventEmitter{get renderService(){return this.container.rendererService}get mapService(){return this.container.mapService}get debugService(){return this.container.debugService}constructor(t){super(),E(this,"pickedLayerId",-1),E(this,"clock",new uY),E(this,"alreadyInRendering",!1),E(this,"layers",[]),E(this,"layerList",[]),E(this,"layerRenderID",void 0),E(this,"sceneInited",!1),E(this,"animateInstanceCount",0),E(this,"shaderPicking",!0),E(this,"enableRender",!0),E(this,"reRender",pw(()=>{this.renderLayers()},32)),E(this,"throttleRenderLayers",pw(()=>{this.renderLayers()},16)),this.container=t}needPick(t){return this.updateLayerRenderList(),this.layerList.some(e=>e.needPick(t))}add(t){this.layers.push(t),this.sceneInited&&t.init().then(()=>{this.renderLayers()})}addMask(t){this.sceneInited&&t.init().then(()=>{this.renderLayers()})}initLayers(){var t=this;return Z(function*(){t.sceneInited=!0,t.layers.forEach(function(){var e=Z(function*(i){i.startInit||(yield i.init(),t.updateLayerRenderList())});return function(i){return e.apply(this,arguments)}}())})()}getSceneInited(){return this.sceneInited}getRenderList(){return this.layerList}getLayers(){return this.layers}getLayer(t){return this.layers.find(e=>e.id===t)}getLayerByName(t){return this.layers.find(e=>e.name===t)}remove(t,e){var i=this;return Z(function*(){if(e){e.layerChildren||(e.layerChildren=[]);const n=e.layerChildren.findIndex(a=>a.id===t.id);n>-1&&e.layerChildren.splice(n,1)}else{const n=i.layers.findIndex(a=>a.id===t.id);n>-1&&i.layers.splice(n,1)}t.destroy(),i.reRender(),i.emit("layerChange",i.layers)})()}removeAllLayers(){var t=this;return Z(function*(){t.destroy(),t.reRender()})()}setEnableRender(t){this.enableRender=t}renderLayers(){var t=this;return Z(function*(){if(t.alreadyInRendering||!t.enableRender)return;t.updateLayerRenderList();const e=t.debugService.generateRenderUid();t.debugService.renderStart(e),t.alreadyInRendering=!0,t.clear();for(const i of t.layerList)i.prerender();t.renderService.beginFrame();for(const i of t.layerList){const{enableMask:n}=i.getLayerConfig();i.masks.filter(a=>a.inited).length>0&&n&&t.renderMask(i.masks),i.getLayerConfig().enableMultiPassRenderer?yield i.renderMultiPass():i.render()}t.renderService.endFrame(),t.debugService.renderEnd(e),t.alreadyInRendering=!1})()}renderMask(t){let e=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});const i=t.length>1?zl.MULTIPLE:zl.SINGLE;for(const n of t)n.render({isStencil:!0,stencilType:i,stencilIndex:e++})}beforeRenderData(t){var e=this;return Z(function*(){(yield t.hooks.beforeRenderData.promise())&&e.renderLayers()})()}renderTileLayerMask(t){let e=0;const{enableMask:i=!0}=t.getLayerConfig();let n=t.tileMask?1:0;const a=t.masks.filter(s=>s.inited);n=n+(i?a.length:1);const o=n>1?zl.MULTIPLE:zl.SINGLE;if((t.tileMask||a.length&&i)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),a.length&&i)for(const s of a)s.render({isStencil:!0,stencilType:o,stencilIndex:e++});t.tileMask&&t.tileMask.render({isStencil:!0,stencilType:o,stencilIndex:e++,stencilOperation:Hm.OR})}renderTileLayer(t){var e=this;return Z(function*(){e.renderTileLayerMask(t),t.getLayerConfig().enableMultiPassRenderer?yield t.renderMultiPass():yield t.render()})()}updateLayerRenderList(){this.layerList=[],this.layers.filter(t=>t.inited).filter(t=>t.isVisible()).sort((t,e)=>t.zIndex-e.zIndex).forEach(t=>{this.layerList.push(t)})}destroy(){this.layers.forEach(t=>{t.destroy()}),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}startAnimate(){this.animateInstanceCount++===0&&(this.clock.start(),this.runRender())}stopAnimate(){--this.animateInstanceCount===0&&(this.stopRender(),this.clock.stop())}getOESTextureFloat(){return this.renderService.extensionObject.OES_texture_float}enableShaderPick(){this.shaderPicking=!0}disableShaderPick(){this.shaderPicking=!1}getShaderPickStat(){return this.shaderPicking}clear(){const t=Pe(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}runRender(){this.renderLayers(),this.layerRenderID=window.requestAnimationFrame(this.runRender.bind(this))}stopRender(){window.cancelAnimationFrame(this.layerRenderID)}}const{isNil:hY}=er;class fY{constructor(t){E(this,"name",void 0),E(this,"type",void 0),E(this,"scale",void 0),E(this,"descriptor",void 0),E(this,"featureBufferLayout",[]),E(this,"needRescale",!1),E(this,"needRemapping",!1),E(this,"needRegenerateVertices",!1),E(this,"featureRange",{startIndex:0,endIndex:1/0}),E(this,"vertexAttribute",void 0),E(this,"defaultCallback",e=>{if(e.length===0){var i;return((i=this.scale)===null||i===void 0?void 0:i.defaultValues)||[]}return e.map((n,a)=>{var o;return((o=this.scale)===null||o===void 0?void 0:o.scalers[a].func)(n)})}),this.setProps(t)}setProps(t){Object.assign(this,t)}mapping(t){var e;if((e=this.scale)!==null&&e!==void 0&&e.callback){var i;const n=(i=this.scale)===null||i===void 0?void 0:i.callback(...t);if(!hY(n))return[n]}return this.defaultCallback(t)}resetDescriptor(){this.descriptor&&(this.descriptor.buffer.data=[])}}const dY=["buffer","update","name"],vY=["buffer","update","name"],pY={[w.FLOAT]:4,[w.UNSIGNED_BYTE]:1,[w.UNSIGNED_SHORT]:2};class gY{constructor(t){E(this,"attributesAndIndices",void 0),E(this,"attributes",[]),E(this,"triangulation",void 0),E(this,"featureLayout",{sizePerElement:0,elements:[]}),this.rendererService=t}registerStyleAttribute(t){let e=this.getLayerStyleAttribute(t.name||"");return e?e.setProps(t):(e=new fY(t),this.attributes.push(e)),e}unRegisterStyleAttribute(t){const e=this.attributes.findIndex(i=>i.name===t);e>-1&&this.attributes.splice(e,1)}updateScaleAttribute(t){this.attributes.forEach(e=>{var i;const n=e.name,a=(i=e.scale)===null||i===void 0?void 0:i.field;(t[n]||a&&t[a])&&(e.needRescale=!0,e.needRemapping=!0,e.needRegenerateVertices=!0)})}updateStyleAttribute(t,e,i){let n=this.getLayerStyleAttribute(t);n||(n=this.registerStyleAttribute(G(G({},e),{},{name:t})));const{scale:a}=e;a&&n&&(n.scale=a,n.needRescale=!0,n.needRemapping=!0,n.needRegenerateVertices=!0,i&&i.featureRange&&(n.featureRange=i.featureRange))}getLayerStyleAttributes(){return this.attributes}getLayerStyleAttribute(t){return this.attributes.find(e=>e.name===t)}getLayerAttributeScale(t){var e;const i=this.getLayerStyleAttribute(t),n=i==null||(e=i.scale)===null||e===void 0?void 0:e.scalers;return n&&n[0]?n[0].func:null}updateAttributeByFeatureRange(t,e,i=0,n,a){const o=this.attributes.find(s=>s.name===t);if(o&&o.descriptor){const{descriptor:s}=o,{update:l,buffer:u,size:c=0}=s,h=pY[u.type||w.FLOAT];if(l){const{elements:f,sizePerElement:d}=this.featureLayout,v=f.slice(i,n);if(!v.length)return;const{offset:p}=v[0],g=p*c*h,m=v.map(({featureIdx:y,vertices:_,normals:x},C)=>{const A=_.length/d,b=[];for(let R=0;R<A;R++){const M=x?x.slice(R*3,R*3+3):[];b.push(...l(e[y],y,_.slice(R*d,R*d+d),C,M))}return b}).flat();o.vertexAttribute.updateBuffer({data:m,offset:g}),a==null||a.emit(`legend:${t}`,a.getLegend(t))}}}createAttributesAndIndices(t,e,i,n){this.featureLayout={sizePerElement:0,elements:[]},e&&(this.triangulation=e);const a=this.attributes.map(p=>(p.resetDescriptor(),p.descriptor));let o=0,s=0;const l=[];let u=3;t.forEach((p,g)=>{const{indices:m,vertices:y,normals:_,size:x,indexes:C,count:A}=this.triangulation(p,i);typeof A=="number"&&(s+=A),m.forEach(R=>{l.push(R+o)}),u=x;const b=y.length/x;this.featureLayout.sizePerElement=u,this.featureLayout.elements.push({featureIdx:g,vertices:y,normals:_,offset:o}),o+=b;for(let R=0;R<b;R++){const M=(_==null?void 0:_.slice(R*3,R*3+3))||[],O=y.slice(R*x,R*x+x);let F=0;C&&C[R]!==void 0&&(F=C[R]),a.forEach((D,H)=>{D&&D.update&&D.buffer.data.push(...D.update(p,g,O,R,M,F))})}});const{createAttribute:c,createBuffer:h,createElements:f}=this.rendererService,d={};a.forEach((p,g)=>{if(p){const{buffer:m,update:y,name:_}=p,x=An(p,dY),C=c(G({buffer:h(m)},x));d[p.name||""]=C,this.attributes[g].vertexAttribute=C}});const v=f({data:l,type:w.UNSIGNED_INT,count:l.length});return this.attributesAndIndices={attributes:d,elements:v,count:s},Object.values(this.attributes).filter(p=>p.scale).forEach(p=>{const g=p.name;n==null||n.emit(`legend:${g}`,n.getLegend(g))}),this.attributesAndIndices}createAttributes(t,e){this.featureLayout={sizePerElement:0,elements:[]},e&&(this.triangulation=e);const i=this.attributes.map(u=>(u.resetDescriptor(),u.descriptor));let n=0,a=3;t.forEach((u,c)=>{const{indices:h,vertices:f,normals:d,size:v,indexes:p}=this.triangulation(u);h.forEach(m=>{}),a=v;const g=f.length/v;this.featureLayout.sizePerElement=a,this.featureLayout.elements.push({featureIdx:c,vertices:f,normals:d,offset:n}),n+=g;for(let m=0;m<g;m++){const y=(d==null?void 0:d.slice(m*3,m*3+3))||[],_=f.slice(m*v,m*v+v);let x=0;p&&p[m]!==void 0&&(x=p[m]),i.forEach((C,A)=>{C&&C.update&&C.buffer.data.push(...C.update(u,c,_,m,y,x))})}});const{createAttribute:o,createBuffer:s}=this.rendererService,l={};return i.forEach((u,c)=>{if(u){const{buffer:h,update:f,name:d}=u,v=An(u,vY),p=o(G({buffer:s(h)},v));l[u.name||""]=p,this.attributes[c].vertexAttribute=p}}),{attributes:l}}clearAllAttributes(){var t;this.attributes.forEach(e=>{e.vertexAttribute&&e.vertexAttribute.destroy()}),(t=this.attributesAndIndices)===null||t===void 0||t.elements.destroy(),this.attributes=[]}}function IB(r,t,e,i){function n(a){return a instanceof e?a:new e(function(o){o(a)})}return new(e||(e=Promise))(function(a,o){function s(c){try{u(i.next(c))}catch(h){o(h)}}function l(c){try{u(i.throw(c))}catch(h){o(h)}}function u(c){c.done?a(c.value):n(c.value).then(s,l)}u((i=i.apply(r,t||[])).next())})}function LB(r,t){var e={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},i,n,a,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(u){return function(c){return l([u,c])}}function l(u){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,n&&(a=u[0]&2?n.return:u[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,u[1])).done)return a;switch(n=0,a&&(u=[u[0]&2,a.value]),u[0]){case 0:case 1:a=u;break;case 4:return e.label++,{value:u[1],done:!1};case 5:e.label++,n=u[1],u=[0];continue;case 7:u=e.ops.pop(),e.trys.pop();continue;default:if(a=e.trys,!(a=a.length>0&&a[a.length-1])&&(u[0]===6||u[0]===2)){e=0;continue}if(u[0]===3&&(!a||u[1]>a[0]&&u[1]<a[3])){e.label=u[1];break}if(u[0]===6&&e.label<a[1]){e.label=a[1],a=u;break}if(a&&e.label<a[2]){e.label=a[2],e.ops.push(u);break}a[2]&&e.ops.pop(),e.trys.pop();continue}u=t.call(r,e)}catch(c){u=[6,c],n=0}finally{i=a=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function tS(r,t){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var i=e.call(r),n,a=[],o;try{for(;(t===void 0||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){o={error:s}}finally{try{n&&!n.done&&(e=i.return)&&e.call(i)}finally{if(o)throw o.error}}return a}function eS(r,t,e){if(e||arguments.length===2)for(var i=0,n=t.length,a;i<n;i++)(a||!(i in t))&&(a||(a=Array.prototype.slice.call(t,0,i)),a[i]=t[i]);return r.concat(a||Array.prototype.slice.call(t))}function OB(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var sx={exports:{}},E0={exports:{}},yd={exports:{}};(function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=e;function e(i){return i&&typeof i.length=="number"&&i.length>=0&&i.length%1===0}r.exports=t.default})(yd,yd.exports);var qi={},lx={exports:{}},ux={exports:{}};(function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(){for(var i=[],n=arguments.length;n--;)i[n]=arguments[n];var a=i.pop();return e.call(this,i,a)}},r.exports=t.default})(ux,ux.exports);var ul={};Object.defineProperty(ul,"__esModule",{value:!0});ul.fallback=PB;ul.wrap=FB;var mY=ul.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,yY=ul.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,_Y=ul.hasNextTick=typeof process=="object"&&typeof process.nextTick=="function";function PB(r){setTimeout(r,0)}function FB(r){return function(t){for(var e=[],i=arguments.length-1;i-- >0;)e[i]=arguments[i+1];return r(function(){return t.apply(void 0,e)})}}var Pf;mY?Pf=queueMicrotask:yY?Pf=setImmediate:_Y?Pf=process.nextTick:Pf=PB;ul.default=FB(Pf);(function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=l;var e=ux.exports,i=s(e),n=ul,a=s(n),o=qi;function s(h){return h&&h.__esModule?h:{default:h}}function l(h){return(0,o.isAsync)(h)?function(){for(var f=[],d=arguments.length;d--;)f[d]=arguments[d];var v=f.pop(),p=h.apply(this,f);return u(p,v)}:(0,i.default)(function(f,d){var v;try{v=h.apply(this,f)}catch(p){return d(p)}if(v&&typeof v.then=="function")return u(v,d);d(null,v)})}function u(h,f){return h.then(function(d){c(f,null,d)},function(d){c(f,d&&d.message?d:new Error(d))})}function c(h,f,d){try{h(f,d)}catch(v){(0,a.default)(function(p){throw p},v)}}r.exports=t.default})(lx,lx.exports);Object.defineProperty(qi,"__esModule",{value:!0});qi.isAsyncIterable=qi.isAsyncGenerator=qi.isAsync=void 0;var xY=lx.exports,CY=EY(xY);function EY(r){return r&&r.__esModule?r:{default:r}}function BB(r){return r[Symbol.toStringTag]==="AsyncFunction"}function SY(r){return r[Symbol.toStringTag]==="AsyncGenerator"}function AY(r){return typeof r[Symbol.asyncIterator]=="function"}function TY(r){if(typeof r!="function")throw new Error("expected a function");return BB(r)?(0,CY.default)(r):r}qi.default=TY;qi.isAsync=BB;qi.isAsyncGenerator=SY;qi.isAsyncIterable=AY;var du={exports:{}};(function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=e;function e(i,n){if(n===void 0&&(n=i.length),!n)throw new Error("arity is undefined");function a(){for(var o=this,s=[],l=arguments.length;l--;)s[l]=arguments[l];return typeof s[n-1]=="function"?i.apply(this,s):new Promise(function(u,c){s[n-1]=function(h){for(var f=[],d=arguments.length-1;d-- >0;)f[d]=arguments[d+1];if(h)return c(h);u(f.length>1?f:f[0])},i.apply(o,s)})}return a}r.exports=t.default})(du,du.exports);(function(r,t){Object.defineProperty(t,"__esModule",{value:!0});var e=yd.exports,i=l(e),n=qi,a=l(n),o=du.exports,s=l(o);function l(u){return u&&u.__esModule?u:{default:u}}t.default=(0,s.default)(function(u,c,h){var f=(0,i.default)(c)?[]:{};u(c,function(d,v,p){(0,a.default)(d)(function(g){for(var m,y=[],_=arguments.length-1;_-- >0;)y[_]=arguments[_+1];y.length<2&&(m=y,y=m[0]),f[v]=y,p(g)})},function(d){return h(d,f)})},3),r.exports=t.default})(E0,E0.exports);var cx={exports:{}},S0={exports:{}},hx={exports:{}},_d={exports:{}};(function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=e;function e(i){function n(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(i!==null){var s=i;i=null,s.apply(this,a)}}return Object.assign(n,i),n}r.exports=t.default})(_d,_d.exports);var fx={exports:{}},dx={exports:{}};(function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e[Symbol.iterator]&&e[Symbol.iterator]()},r.exports=t.default})(dx,dx.exports);(function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=c;var e=yd.exports,i=o(e),n=dx.exports,a=o(n);function o(h){return h&&h.__esModule?h:{default:h}}function s(h){var f=-1,d=h.length;return function(){return++f<d?{value:h[f],key:f}:null}}function l(h){var f=-1;return function(){var v=h.next();return v.done?null:(f++,{value:v.value,key:f})}}function u(h){var f=h?Object.keys(h):[],d=-1,v=f.length;return function p(){var g=f[++d];return g==="__proto__"?p():d<v?{value:h[g],key:g}:null}}function c(h){if((0,i.default)(h))return s(h);var f=(0,a.default)(h);return f?l(f):u(h)}r.exports=t.default})(fx,fx.exports);var xd={exports:{}};(function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=e;function e(i){return function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];if(i===null)throw new Error("Callback was already called.");var o=i;i=null,o.apply(this,n)}}r.exports=t.default})(xd,xd.exports);var vx={exports:{}},Cd={exports:{}};(function(r,t){Object.defineProperty(t,"__esModule",{value:!0});var e={};t.default=e,r.exports=t.default})(Cd,Cd.exports);(function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=a;var e=Cd.exports,i=n(e);function n(o){return o&&o.__esModule?o:{default:o}}function a(o,s,l,u){var c=!1,h=!1,f=!1,d=0,v=0;function p(){d>=s||f||c||(f=!0,o.next().then(function(y){var _=y.value,x=y.done;if(!(h||c)){if(f=!1,x){c=!0,d<=0&&u(null);return}d++,l(_,v,g),v++,p()}}).catch(m))}function g(y,_){if(d-=1,!h){if(y)return m(y);if(y===!1){c=!0,h=!0;return}if(_===i.default||c&&d<=0)return c=!0,u(null);p()}}function m(y){h||(f=!1,c=!0,u(y))}p()}r.exports=t.default})(vx,vx.exports);(function(r,t){Object.defineProperty(t,"__esModule",{value:!0});var e=_d.exports,i=d(e),n=fx.exports,a=d(n),o=xd.exports,s=d(o),l=qi,u=vx.exports,c=d(u),h=Cd.exports,f=d(h);function d(v){return v&&v.__esModule?v:{default:v}}t.default=function(v){return function(p,g,m){if(m=(0,i.default)(m),v<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!p)return m(null);if((0,l.isAsyncGenerator)(p))return(0,c.default)(p,v,g,m);if((0,l.isAsyncIterable)(p))return(0,c.default)(p[Symbol.asyncIterator](),v,g,m);var y=(0,a.default)(p),_=!1,x=!1,C=0,A=!1;function b(M,O){if(!x)if(C-=1,M)_=!0,m(M);else if(M===!1)_=!0,x=!0;else{if(O===f.default||_&&C<=0)return _=!0,m(null);A||R()}}function R(){for(A=!0;C<v&&!_;){var M=y();if(M===null){_=!0,C<=0&&m(null);return}C+=1,g(M.value,M.key,(0,s.default)(b))}A=!1}R()}},r.exports=t.default})(hx,hx.exports);(function(r,t){Object.defineProperty(t,"__esModule",{value:!0});var e=hx.exports,i=l(e),n=qi,a=l(n),o=du.exports,s=l(o);function l(c){return c&&c.__esModule?c:{default:c}}function u(c,h,f,d){return(0,i.default)(h)(c,(0,a.default)(f),d)}t.default=(0,s.default)(u,4),r.exports=t.default})(S0,S0.exports);(function(r,t){Object.defineProperty(t,"__esModule",{value:!0});var e=S0.exports,i=o(e),n=du.exports,a=o(n);function o(l){return l&&l.__esModule?l:{default:l}}function s(l,u,c){return(0,i.default)(l,1,u,c)}t.default=(0,a.default)(s,3),r.exports=t.default})(cx,cx.exports);(function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var e=E0.exports,i=o(e),n=cx.exports,a=o(n);function o(l){return l&&l.__esModule?l:{default:l}}function s(l,u){return(0,i.default)(a.default,l,u)}r.exports=t.default})(sx,sx.exports);var $m=OB(sx.exports),ja=function(){function r(){this.args=[],this.tasks=[]}return r.prototype.call=function(){for(var t=arguments,e=[],i=0;i<arguments.length;i++)e[i]=t[i];return this.args=e,$m(this.tasks)},r.prototype.tap=function(t,e){var i=this;this.tasks.push(function(n){e.apply(void 0,eS([],tS(i.args),!1)),n(null,t)})},r}(),gw={exports:{}},px={exports:{}};(function(r,t){Object.defineProperty(t,"__esModule",{value:!0});var e=yd.exports,i=g(e),n=Cd.exports,a=g(n),o=S0.exports,s=g(o),l=_d.exports,u=g(l),c=xd.exports,h=g(c),f=qi,d=g(f),v=du.exports,p=g(v);function g(x){return x&&x.__esModule?x:{default:x}}function m(x,C,A){A=(0,u.default)(A);var b=0,R=0,M=x.length,O=!1;M===0&&A(null);function F(D,H){D===!1&&(O=!0),O!==!0&&(D?A(D):(++R===M||H===a.default)&&A(null))}for(;b<M;b++)C(x[b],b,(0,h.default)(F))}function y(x,C,A){return(0,s.default)(x,1/0,C,A)}function _(x,C,A){var b=(0,i.default)(x)?m:y;return b(x,(0,d.default)(C),A)}t.default=(0,p.default)(_,3),r.exports=t.default})(px,px.exports);(function(r,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var e=px.exports,i=o(e),n=E0.exports,a=o(n);function o(l){return l&&l.__esModule?l:{default:l}}function s(l,u){return(0,a.default)(i.default,l,u)}r.exports=t.default})(gw,gw.exports);var gx={exports:{}};(function(r,t){Object.defineProperty(t,"__esModule",{value:!0});var e=_d.exports,i=c(e),n=xd.exports,a=c(n),o=qi,s=c(o),l=du.exports,u=c(l);function c(f){return f&&f.__esModule?f:{default:f}}function h(f,d){if(d=(0,i.default)(d),!Array.isArray(f))return d(new Error("First argument to waterfall must be an array of functions"));if(!f.length)return d();var v=0;function p(m){var y=(0,s.default)(f[v++]);y.apply(void 0,m.concat([(0,a.default)(g)]))}function g(m){for(var y=[],_=arguments.length-1;_-- >0;)y[_]=arguments[_+1];if(m!==!1){if(m||v===f.length)return d.apply(void 0,[m].concat(y));p(y)}}p([])}t.default=(0,u.default)(h),r.exports=t.default})(gx,gx.exports);var bY=OB(gx.exports),mw=function(){function r(){this.tasks=[]}return r.prototype.call=function(){return $m(this.tasks)},r.prototype.tap=function(t,e){this.tasks.push(function(i){var n=e();i(n,t)})},r}(),wY=function(){function r(){this.args=[],this.tasks=[]}return r.prototype.promise=function(){for(var t=arguments,e=[],i=0;i<arguments.length;i++)e[i]=t[i];return this.args=e,$m(this.tasks)},r.prototype.tapPromise=function(t,e){var i=this;this.tasks.push(function(n){return IB(i,void 0,void 0,function(){return LB(this,function(a){switch(a.label){case 0:return[4,e.apply(void 0,eS([],tS(this.args),!1))];case 1:return a.sent(),n(null,t),[2]}})})})},r}(),RY=function(){function r(){this.args=[],this.tasks=[]}return r.prototype.promise=function(){for(var t=arguments,e=[],i=0;i<arguments.length;i++)e[i]=t[i];return this.args=e,$m(this.tasks)},r.prototype.tapPromise=function(t,e){var i=this;this.tasks.push(function(n){return IB(i,void 0,void 0,function(){var a;return LB(this,function(o){switch(o.label){case 0:return[4,e.apply(void 0,eS([],tS(this.args),!1))];case 1:return a=o.sent(),n(a,t),[2]}})})})},r}(),MY=function(){function r(){this.tasks=[]}return r.prototype.promise=function(){return bY(this.tasks)},r.prototype.tapPromise=function(t,e){this.tasks.length===0?this.tasks.push(function(i){e().then(function(n){i(null,n)})}):this.tasks.push(function(i,n){e(i).then(function(a){n(null,a)})})},r}();let IY=class extends Li.EventEmitter{get iconService(){return this.container.iconService}get fontService(){return this.container.fontService}get controlService(){return this.container.controlService}get configService(){return this.container.globalConfigService}get map(){return this.container.mapService}get coordinateSystemService(){return this.container.coordinateSystemService}get rendererService(){return this.container.rendererService}get layerService(){return this.container.layerService}get debugService(){return this.container.debugService}get cameraService(){return this.container.cameraService}get interactionService(){return this.container.interactionService}get pickingService(){return this.container.pickingService}get shaderModuleService(){return this.container.shaderModuleService}get markerService(){return this.container.markerService}get popupService(){return this.container.popupService}constructor(t){super(),E(this,"destroyed",!1),E(this,"loaded",!1),E(this,"id",void 0),E(this,"inited",!1),E(this,"rendering",!1),E(this,"$container",void 0),E(this,"canvas",void 0),E(this,"markerContainer",void 0),E(this,"resizeDetector",void 0),E(this,"hooks",void 0),E(this,"handleWindowResized",()=>{this.emit("resize"),this.$container&&(this.initContainer(),this.coordinateSystemService.needRefresh=!0,this.render())}),E(this,"handleMapCameraChanged",e=>{this.cameraService.update(e),this.render()}),this.container=t,this.hooks={init:new wY},this.id=t.id}init(t){var e=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",()=>this.render()),this.fontService.init(),this.hooks.init.tapPromise("initMap",Z(function*(){e.debugService.log("map.mapInitStart",{type:e.map.version}),yield new Promise(i=>{e.map.onCameraChanged(n=>{e.cameraService.init(),e.cameraService.update(n),i()}),e.map.init()}),e.map.onCameraChanged(e.handleMapCameraChanged),e.map.addMarkerContainer(),e.markerService.addMarkers(),e.markerService.addMarkerLayers(),e.popupService.initPopup(),e.interactionService.init(),e.interactionService.on(ki.Drag,e.addSceneEvent.bind(e))})),this.hooks.init.tapPromise("initRenderer",Z(function*(){var i;const n=((i=e.map)===null||i===void 0?void 0:i.getOverlayContainer())||void 0;if(n?e.$container=n:e.$container=oY(e.configService.getSceneConfig(e.id).id||""),e.$container){const{canvas:o}=t;if(e.canvas=o||we("canvas","",e.$container),e.setCanvas(),yield e.rendererService.init(e.canvas,e.configService.getSceneConfig(e.id),t.gl),e.registerContextLost(),e.initContainer(),e.resizeDetector=$W({strategy:"scroll"}),e.resizeDetector.listenTo(e.$container,e.handleWindowResized),window.matchMedia){var a;(a=window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||a===void 0||a.addListener(e.handleWindowResized.bind("screen"))}}else console.error("容器 id 不存在");e.pickingService.init(e.id)})),this.render()}registerContextLost(){const t=this.rendererService.getCanvas();t&&t.addEventListener("webglcontextlost",()=>this.emit("webglcontextlost"))}addLayer(t){this.layerService.sceneService=this,this.layerService.add(t)}addMask(t){this.layerService.sceneService=this,this.layerService.addMask(t)}render(){var t=this;return Z(function*(){t.rendering||t.destroyed||(t.rendering=!0,t.inited?(yield t.layerService.initLayers(),yield t.layerService.renderLayers()):(yield t.hooks.init.promise(),t.destroyed&&t.destroy(),yield t.layerService.initLayers(),t.layerService.renderLayers(),t.controlService.addControls(),t.loaded=!0,t.emit("loaded"),t.inited=!0),t.rendering=!1)})()}addFontFace(t,e){this.fontService.addFontFace(t,e)}getSceneContainer(){return this.$container}exportPng(t){var e=this;return Z(function*(){var i;const n=(i=e.$container)===null||i===void 0?void 0:i.getElementsByTagName("canvas")[0];return yield e.render(),t==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png")})()}getSceneConfig(){return this.configService.getSceneConfig(this.id)}getPointSizeRange(){return this.rendererService.getPointSizeRange()}addMarkerContainer(){const t=this.$container.parentElement;t!==null&&(this.markerContainer=we("div","l7-marker-container",t))}getMarkerContainer(){return this.markerContainer}destroy(){var t;if(!this.inited){this.destroyed=!0;return}this.resizeDetector.removeListener(this.$container,this.handleWindowResized),this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout(()=>{var e;(e=this.$container)===null||e===void 0||e.removeChild(this.canvas),this.canvas=null,this.rendererService.destroy()}),(t=this.$container)===null||t===void 0||(t=t.parentNode)===null||t===void 0||t.removeChild(this.$container),this.emit("destroy")}initContainer(){var t,e;const i=Ni,n=((t=this.$container)===null||t===void 0?void 0:t.clientWidth)||400,a=((e=this.$container)===null||e===void 0?void 0:e.clientHeight)||300,o=this.canvas;o&&(o.width=n*i,o.height=a*i),this.rendererService.viewport({x:0,y:0,width:i*n,height:i*a})}setCanvas(){var t,e;const i=Ni,n=((t=this.$container)===null||t===void 0?void 0:t.clientWidth)||400,a=((e=this.$container)===null||e===void 0?void 0:e.clientHeight)||300,o=this.canvas;o.width=n*i,o.height=a*i,o.style.width="100%",o.style.height="100%"}addSceneEvent(t){this.emit(t.type,t)}};const{uniq:LY}=er,yw="#define PI 3.14159265359",OY=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,PY=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,FY=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}


vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  return weight;
}
`,BY=`
in vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  float activeType = v_PickingResult.a;
  if(activeType > 0.0) {
    vec4 highLightColor =  activeType > 1.5 ? u_SelectColor : u_HighlightColor;
    highLightColor = highLightColor * COLOR_SCALE;
    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));
    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  }
  else {
    return color;
  }

  
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // 过滤多余的 shader 计算
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // 过滤多余的 shader 计算
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,DY=`layout(location = ATTRIBUTE_LOCATION_PICKING_COLOR) in vec3 a_PickingColor;
out vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return distance(vertexColor,u_PickingColor.rgb) < 0.01;
}

// 判断当前点是否已经被 select 选中
bool isVertexSelected(vec3 vertexColor) {
  return distance(vertexColor,u_CurrentSelectedId.rgb) < 0.01;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  if(u_PickingStage == PICKING_HIGHLIGHT) {
    if(isVertexPicked(pickingColor)) {
       v_PickingResult = vec4(pickingColor.rgb * COLOR_SCALE,HIGHLIGHT);
       return;
    }
    if(isVertexSelected(pickingColor)) {
     v_PickingResult = vec4(u_CurrentSelectedId.rgb * COLOR_SCALE,SELECT);
      return;
    }

  } else {
      v_PickingResult= vec4(pickingColor.rgb * COLOR_SCALE,NORMAL);
      return;
  }

  // // v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && (isVertexPicked(pickingColor) || isVertexPicked(u_CurrentSelectedId)));

  // // Stores the picking color so that the fragment shader can render it during picking
  // v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,_w=`layout(std140) uniform PickingUniforms {
  vec4 u_HighlightColor;
  vec4 u_SelectColor;
  vec3 u_PickingColor;
  float u_PickingStage;
  vec3 u_CurrentSelectedId;
  float u_PickingThreshold;
  float u_PickingBuffer;
  float u_shaderPick;
  float u_activeMix;
};`,NY=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // 经纬度 => 平面坐标
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // 平面坐标 => 经纬度
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,xw=`#define TILE_SIZE (512.0)
#define PI (3.1415926536)
#define WORLD_SCALE (TILE_SIZE / (PI * 2.0))
#define EARTH_CIRCUMFERENCE (40.03e6)

#define COORDINATE_SYSTEM_LNGLAT (1.0) // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET (2.0) // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE (3.0)
#define COORDINATE_SYSTEM_IDENTITY (4.0)
#define COORDINATE_SYSTEM_METER_OFFSET (5.0)

#pragma include "scene_uniforms"

const vec2 ZERO_64_XY_LOW = vec2(0.0, 0.0);

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(radians(x) + PI, PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5)));
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}

// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1.0, 1.0);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (
    u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 &&
      u_CoordinateSystem > COORDINATE_SYSTEM_LNGLAT - 0.01 ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}

vec4 project_position(vec4 position, vec2 position64xyLow) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(
      vec4(X + position64xyLow.x, Y + position64xyLow.y, position.z, position.w)
    );
  }
  if (
    u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 &&
    u_CoordinateSystem > COORDINATE_SYSTEM_LNGLAT - 0.01
  ) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  return position;
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_XY_LOW);
}

vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

// 适配纹理贴图的等像素大小
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom) * u_FocalDistance;
  }

  return pixel * 2.0 * u_FocalDistance;
}

// 在不论什么底图下需要统一处理的时候使用
float project_float_pixel(float pixel) {
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // mapbox 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1
    return pixel * pow(2.0, 19.0 - u_Zoom) * u_FocalDistance;
  }

  return pixel * u_FocalDistance;
}

// Project meter into the unit of pixel which used in the camera world space
float project_float_meter(float meter) {
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // Since the zoom level uniform is updated by mapservice and it's alread been subtracted by 1
    // Not sure if we are supposed to do that again
    return meter;
  } else {
    return project_float_pixel(meter);
  }

  // TODO: change the following code to make adaptations for amap
  // return u_FocalDistance * TILE_SIZE * pow(2.0, u_Zoom) * meter / EARTH_CIRCUMFERENCE;

}

float project_pixel(float pixel) {
  return pixel * u_FocalDistance;
}

vec2 project_pixel(vec2 pixel) {
  return pixel * -1.0 * u_FocalDistance;
}

vec3 project_pixel(vec3 pixel) {
  return pixel * -1.0 * u_FocalDistance;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}

bool isEqual(float a, float b) {
  return a < b + 0.001 && a > b - 0.001;
}

`,kY=`vec2 rotate_matrix(vec2 v, float a) {
    float b = a / 180.0 * 3.1415926535897932384626433832795;
    float s = sin(b);
    float c = cos(b);
    mat2 m = mat2(c, s, -s, c);
    return m * v;
}`,Cw=`layout(std140) uniform SceneUniforms {
  mat4 u_ViewMatrix;
  mat4 u_ProjectionMatrix;
  mat4 u_ViewProjectionMatrix;
  mat4 u_ModelMatrix;
  vec4 u_ViewportCenterProjection;
  vec3 u_PixelsPerDegree;
  float u_Zoom;
  vec3 u_PixelsPerDegree2;
  float u_ZoomScale;
  vec3 u_PixelsPerMeter;
  float u_CoordinateSystem;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_ViewportCenter;
  vec2 u_ViewportSize;
  float u_FocalDistance;
};
`,UY=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,Ew=/precision\s+(high|low|medium)p\s+float/,Sw=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,zY=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,HY=/void\s+main\s*\([^)]*\)\s*\{\n?/;class $Y{constructor(){E(this,"moduleCache",{}),E(this,"rawContentCache",{})}registerBuiltinModules(){this.destroy(),this.registerModule("common",{vs:yw,fs:yw}),this.registerModule("decode",{vs:PY,fs:""}),this.registerModule("scene_uniforms",{vs:Cw,fs:Cw}),this.registerModule("picking_uniforms",{vs:_w,fs:_w}),this.registerModule("projection",{vs:xw,fs:xw}),this.registerModule("project",{vs:NY,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:UY}),this.registerModule("lighting",{vs:FY,fs:""}),this.registerModule("light",{vs:OY,fs:""}),this.registerModule("picking",{vs:DY,fs:BY}),this.registerModule("rotation_2d",{vs:kY,fs:""})}registerModule(t,e){e.vs=e.vs.replace(/\r\n/g,`
`),e.fs=e.fs.replace(/\r\n/g,`
`);const{vs:i,fs:n,uniforms:a,defines:o,inject:s}=e,{content:l,uniforms:u}=w_(i),{content:c,uniforms:h}=w_(n);this.rawContentCache[t]={fs:c,defines:o,inject:s,uniforms:G(G(G({},u),h),a),vs:l}}getModule(t){let e=this.rawContentCache[t].vs,i=this.rawContentCache[t].fs;const{defines:n={},inject:a={}}=this.rawContentCache[t];let o={};a["vs:#decl"]&&(e=a["vs:#decl"]+e,o=w_(a["vs:#decl"]).uniforms),a["vs:#main-start"]&&(e=e.replace(HY,p=>p+a["vs:#main-start"])),a["fs:#decl"]&&(i=a["fs:#decl"]+i),e=WY(n)+e;const{content:l,includeList:u}=this.processModule(e,[],"vs"),{content:c,includeList:h}=this.processModule(i,[],"fs"),f=LY(u.concat(h).concat(t)).reduce((p,g)=>G(G({},p),this.rawContentCache[g].uniforms),G({},o)),d=(Ew.test(c)?"":Sw)+l,v=(Ew.test(c)?"":Sw)+c;return this.moduleCache[t]={vs:d.trim(),fs:v.trim(),uniforms:f},this.moduleCache[t]}destroy(){this.moduleCache={},this.rawContentCache={}}processModule(t,e,i){return{content:t.replace(zY,(a,o)=>{const l=o.split(" ")[0].replace(/"/g,"");if(e.indexOf(l)>-1)return"";const u=this.rawContentCache[l][i];e.push(l);const{content:c}=this.processModule(u,e,i);return c}),includeList:e}}}function WY(r){return Object.keys(r).reduce((e,i)=>e+`#define ${i.toUpperCase()} ${r[i]}
`,`
`)}class rS{constructor(){E(this,"shaderModuleService",void 0),E(this,"rendererService",void 0),E(this,"cameraService",void 0),E(this,"mapService",void 0),E(this,"interactionService",void 0),E(this,"layerService",void 0),E(this,"config",void 0)}getName(){return""}getType(){return yv.Normal}init(t,e){this.config=e,this.rendererService=t.getContainer().rendererService,this.cameraService=t.getContainer().cameraService,this.mapService=t.getContainer().mapService,this.interactionService=t.getContainer().interactionService,this.layerService=t.getContainer().layerService,this.shaderModuleService=t.getContainer().shaderModuleService}render(t){}}class VY extends rS{getName(){return"clear"}init(t,e){super.init(t,e)}render(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}class GY{constructor(t){E(this,"passes",[]),E(this,"layer",void 0),E(this,"renderFlag",void 0),E(this,"width",0),E(this,"height",0),this.postProcessor=t}setLayer(t){this.layer=t}setRenderFlag(t){this.renderFlag=t}getRenderFlag(){return this.renderFlag}getPostProcessor(){return this.postProcessor}render(){var t=this;return Z(function*(){for(const e of t.passes)yield e.render(t.layer);yield t.postProcessor.render(t.layer)})()}resize(t,e){(this.width!==t||this.height!==e)&&(this.postProcessor.resize(t,e),this.width=t,this.height=e)}add(t,e){t.getType()===yv.PostProcessing?this.postProcessor.add(t,this.layer,e):(t.init(this.layer,e),this.passes.push(t))}insert(t,e,i){t.init(this.layer,e),this.passes.splice(i,0,t)}destroy(){this.passes.length=0}}class XY extends rS{constructor(...t){var e;super(...t),e=this,E(this,"pickingFBO",void 0),E(this,"layer",void 0),E(this,"width",0),E(this,"height",0),E(this,"alreadyInRendering",!1),E(this,"pickFromPickingFBO",({x:i,y:n,lngLat:a,type:o})=>{if(!this.layer.isVisible()||!this.layer.needPick(o))return;const{getViewportSize:s,readPixelsAsync:l,useFramebuffer:u}=this.rendererService,{width:c,height:h}=s(),{enableHighlight:f,enableSelect:d}=this.layer.getLayerConfig(),v=i*Ni,p=n*Ni;if(v>c||v<0||p>h||p<0)return;let g;u(this.pickingFBO,Z(function*(){var m;if(g=yield l({x:Math.round(v),y:Math.round(h-(n+1)*Ni),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:e.pickingFBO}),g[0]!==0||g[1]!==0||g[2]!==0){const y=Kl(g),_=e.layer.getSource().getFeatureById(y),x={x:i,y:n,type:o,lngLat:a,featureId:y,feature:_};_&&(e.layer.setCurrentPickId(y),e.triggerHoverOnLayer(x))}else{const y={x:i,y:n,lngLat:a,type:e.layer.getCurrentPickId()===null?"un"+o:"mouseout",featureId:null,feature:null};e.triggerHoverOnLayer(G(G({},y),{},{type:"unpick"})),e.triggerHoverOnLayer(y),e.layer.setCurrentPickId(null)}f&&e.highlightPickedFeature(g),d&&o==="click"&&((m=g)===null||m===void 0?void 0:m.toString())!==[0,0,0,0].toString()&&e.selectFeature(g)}))})}getType(){return yv.Normal}getName(){return"pixelPicking"}init(t,e){super.init(t,e),this.layer=t;const{createTexture2D:i,createFramebuffer:n,getViewportSize:a}=this.rendererService,{width:o,height:s}=a(),l=i({width:o,height:s,wrapS:w.CLAMP_TO_EDGE,wrapT:w.CLAMP_TO_EDGE,label:"Picking Texture"});this.pickingFBO=n({color:l}),this.interactionService.on(ki.Hover,this.pickFromPickingFBO),this.interactionService.on(ki.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(ki.Active,this.highlightFeatureHandle.bind(this))}render(t){if(this.alreadyInRendering)return;const{getViewportSize:e,useFramebuffer:i,clear:n}=this.rendererService,{width:a,height:o}=e();this.alreadyInRendering=!0,(this.width!==a||this.height!==o)&&(this.pickingFBO.resize({width:a,height:o}),this.width=a,this.height=o),i(this.pickingFBO,()=>{n({framebuffer:this.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});const s=this.layer.multiPassRenderer.getRenderFlag();this.layer.multiPassRenderer.setRenderFlag(!1),t.hooks.beforePickingEncode.call(),t.render(),t.hooks.afterPickingEncode.call(),this.layer.multiPassRenderer.setRenderFlag(s),this.alreadyInRendering=!1})}triggerHoverOnLayer(t){this.layer.emit(t.type,t)}highlightPickedFeature(t){const[e,i,n]=t;this.layer.hooks.beforeHighlight.call([e,i,n]),this.layerService.renderLayers()}selectFeature(t){const[e,i,n]=t;this.layer.hooks.beforeSelect.call([e,i,n]),this.layerService.renderLayers()}selectFeatureHandle({featureId:t}){const e=jc(t);this.selectFeature(new Uint8Array(e))}highlightFeatureHandle({featureId:t}){const e=jc(t);this.highlightPickedFeature(new Uint8Array(e))}}class YY{constructor(t){E(this,"passes",[]),E(this,"readFBO",void 0),E(this,"writeFBO",void 0),this.rendererService=t,this.init()}getReadFBO(){return this.readFBO}getWriteFBO(){return this.writeFBO}getCurrentFBOTex(){const{getViewportSize:t,createTexture2D:e}=this.rendererService,{width:i,height:n}=t();return e({x:0,y:0,width:i,height:n,copy:!0})}getReadFBOTex(){var t=this;const{useFramebuffer:e}=this.rendererService;return new Promise(i=>{e(this.readFBO,Z(function*(){i(t.getCurrentFBOTex())}))})}renderBloomPass(t,e){var i=this;return Z(function*(){const n=yield i.getReadFBOTex();let a=0;for(;a<4;)yield e.render(t,n),i.swap(),a++})()}render(t){var e=this;return Z(function*(){for(let i=0;i<e.passes.length;i++){const n=e.passes[i];n.setRenderToScreen(e.isLastEnabledPass(i)),n.getName()==="bloom"?yield e.renderBloomPass(t,n):(yield n.render(t),i!==e.passes.length-1&&e.swap())}})()}resize(t,e){this.readFBO.resize({width:t,height:e}),this.writeFBO.resize({width:t,height:e})}add(t,e,i){t.init(e,i),this.passes.push(t)}insert(t,e,i,n){t.init(i,n),this.passes.splice(e,0,t)}getPostProcessingPassByName(t){return this.passes.find(e=>e.getName()===t)}init(){const{createFramebuffer:t,createTexture2D:e}=this.rendererService;this.readFBO=t({color:e({width:1,height:1,wrapS:w.CLAMP_TO_EDGE,wrapT:w.CLAMP_TO_EDGE,usage:fu.RENDER_TARGET})}),this.writeFBO=t({color:e({width:1,height:1,wrapS:w.CLAMP_TO_EDGE,wrapT:w.CLAMP_TO_EDGE,usage:fu.RENDER_TARGET})})}isLastEnabledPass(t){for(let e=t+1;e<this.passes.length;e++)if(this.passes[e].isEnabled())return!1;return!0}swap(){const t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}class jY extends rS{getType(){return yv.Normal}getName(){return"render"}init(t,e){super.init(t,e)}render(t){const{useFramebuffer:e,clear:i}=this.rendererService,n=t.multiPassRenderer.getPostProcessor().getReadFBO();e(n,()=>{i({color:[0,0,0,0],depth:1,stencil:0,framebuffer:n}),t.multiPassRenderer.setRenderFlag(!1),t.models.forEach(a=>{a.draw({uniforms:t.layerModel.getUninforms()})}),t.multiPassRenderer.setRenderFlag(!0)})}}const ZY=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,qY=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,{isNil:M_}=er;class KY extends hs{setupShaders(){this.shaderModuleService.registerModule("blur-pass",{vs:qY,fs:ZY});const{vs:t,fs:e,uniforms:i}=this.shaderModuleService.getModule("blur-pass"),{width:n,height:a}=this.rendererService.getViewportSize();return{vs:t,fs:e,uniforms:G(G({},i),{},{u_ViewportSize:[n,a]})}}convertOptionsToUniforms(t){const e={};return M_(t.bloomRadius)||(e.u_radius=t.bloomRadius),M_(t.bloomIntensity)||(e.u_intensity=t.bloomIntensity),M_(t.bloomBaseRadio)||(e.u_baseRadio=t.bloomBaseRadio),e}}const QY=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,JY=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,{isNil:tj}=er;class ej extends hs{setupShaders(){this.shaderModuleService.registerModule("blur-pass",{vs:JY,fs:QY});const{vs:t,fs:e,uniforms:i}=this.shaderModuleService.getModule("blur-pass"),{width:n,height:a}=this.rendererService.getViewportSize();return{vs:t,fs:e,uniforms:G(G({},i),{},{u_ViewportSize:[n,a]})}}convertOptionsToUniforms(t){const e={};return tj(t.blurRadius)||(e.u_BlurDir=[t.blurRadius,0]),e}}const rj=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,ij=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,{isNil:nj}=er;class aj extends hs{setupShaders(){this.shaderModuleService.registerModule("blur-pass",{vs:ij,fs:rj});const{vs:t,fs:e,uniforms:i}=this.shaderModuleService.getModule("blur-pass"),{width:n,height:a}=this.rendererService.getViewportSize();return{vs:t,fs:e,uniforms:G(G({},i),{},{u_ViewportSize:[n,a]})}}convertOptionsToUniforms(t){const e={};return nj(t.blurRadius)||(e.u_BlurDir=[0,t.blurRadius]),e}}const oj=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,sj=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class lj extends hs{setupShaders(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:sj,fs:oj});const{vs:t,fs:e,uniforms:i}=this.shaderModuleService.getModule("colorhalftone-pass"),{width:n,height:a}=this.rendererService.getViewportSize();return{vs:t,fs:e,uniforms:G(G({},i),{},{u_ViewportSize:[n,a]})}}}const uj=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,cj=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class hj extends hs{setupShaders(){return this.shaderModuleService.registerModule("copy-pass",{vs:cj,fs:uj}),this.shaderModuleService.getModule("copy-pass")}}const fj=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,dj=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class vj extends hs{setupShaders(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:dj,fs:fj});const{vs:t,fs:e,uniforms:i}=this.shaderModuleService.getModule("hexagonalpixelate-pass"),{width:n,height:a}=this.rendererService.getViewportSize();return{vs:t,fs:e,uniforms:G(G({},i),{},{u_ViewportSize:[n,a]})}}}const pj=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,gj=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class mj extends hs{setupShaders(){this.shaderModuleService.registerModule("ink-pass",{vs:gj,fs:pj});const{vs:t,fs:e,uniforms:i}=this.shaderModuleService.getModule("ink-pass"),{width:n,height:a}=this.rendererService.getViewportSize();return{vs:t,fs:e,uniforms:G(G({},i),{},{u_ViewportSize:[n,a]})}}}const yj=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,_j=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class xj extends hs{setupShaders(){return this.shaderModuleService.registerModule("noise-pass",{vs:_j,fs:yj}),this.shaderModuleService.getModule("noise-pass")}}const Cj=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ej=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`;class Sj extends hs{setupShaders(){return this.shaderModuleService.registerModule("sepia-pass",{vs:Cj,fs:Ej}),this.shaderModuleService.getModule("sepia-pass")}}const DB=new QX;let Aj=0;function Tj(){const r=new $Y,t=new rY,e=new WX,i=new eY(e),n=new zX,a=new $X,o=new XX,s=new YX,l=new GX,u={id:`${Aj++}`,globalConfigService:DB,shaderModuleService:r,debugService:t,cameraService:e,coordinateSystemService:i,fontService:n,iconService:a,markerService:o,popupService:s,controlService:l,customRenderService:{}},c=new cY(u);u.layerService=c;const h=new IY(u);u.sceneService=h;const f=new nY(u);u.interactionService=f;const d=new lY(u);u.pickingService=d;const v={clear:new VY,pixelPicking:new XY,render:new jY};u.normalPassFactory=g=>v[g];const p={copy:new hj,bloom:new KY,blurH:new ej,blurV:new aj,noise:new xj,sepia:new Sj,colorHalftone:new lj,hexagonalPixelate:new vj,ink:new mj};return u.postProcessingPass=p,u.postProcessingPassFactory=g=>p[g],u}function Zf(r){const t=G({},r);return t.postProcessor=new YY(t.rendererService),t.multiPassRenderer=new GY(t.postProcessor),t.styleAttributeService=new gY(t.rendererService),t}const _p=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"];let Xr=function(r){return r.IMAGE="image",r.CUSTOMIMAGE="customImage",r.ARRAYBUFFER="arraybuffer",r.RGB="rgb",r.TERRAINRGB="terrainRGB",r.CUSTOMRGB="customRGB",r.CUSTOMARRAYBUFFER="customArrayBuffer",r.CUSTOMTERRAINRGB="customTerrainRGB",r}({});var NB=(r,t,e)=>new Promise((i,n)=>{var a=l=>{try{s(e.next(l))}catch(u){n(u)}},o=l=>{try{s(e.throw(l))}catch(u){n(u)}},s=l=>l.done?i(l.value):Promise.resolve(l.value).then(a,o);s((e=e.apply(r,t)).next())}),bj=(r,t,e,i)=>NB(void 0,null,function*(){return new Promise((n,a)=>{t({x:r.x,y:r.y,z:r.z},(o,s)=>{if(o||s.length===0){a(o);return}s&&ox([{data:s,bands:[0]}],e,i,(l,u)=>{l?a(l):u&&n(u)})})})}),wj=(r,t)=>NB(void 0,null,function*(){return new Promise((e,i)=>{t({x:r.x,y:r.y,z:r.z},(n,a)=>{if(n||!a){i(n);return}a instanceof ArrayBuffer?rV(a,(o,s)=>{o&&i(o),e(s)}):a instanceof HTMLImageElement?e(a):i(n)})})});function Rj(r,t){return Array.isArray(r)?typeof r[0]=="string"?r.map(e=>Mc(e,t)):r.map(e=>({url:Mc(e.url,t),bands:e.bands||[0]})):Mc(r,t)}function Mj(r){return typeof r=="string"?[{url:r,bands:[0]}]:typeof r[0]=="string"?r.map(t=>({url:t,bands:[0]})):r}function Aw(r,t){r.xhrCancel=()=>{t.map(e=>{e.abort()})}}var Ij=Object.defineProperty,Lj=Object.defineProperties,Oj=Object.getOwnPropertyDescriptors,Tw=Object.getOwnPropertySymbols,Pj=Object.prototype.hasOwnProperty,Fj=Object.prototype.propertyIsEnumerable,bw=(r,t,e)=>t in r?Ij(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,ww=(r,t)=>{for(var e in t||(t={}))Pj.call(t,e)&&bw(r,e,t[e]);if(Tw)for(var e of Tw(t))Fj.call(t,e)&&bw(r,e,t[e]);return r},Rw=(r,t)=>Lj(r,Oj(t)),kB=(r,t,e)=>new Promise((i,n)=>{var a=l=>{try{s(e.next(l))}catch(u){n(u)}},o=l=>{try{s(e.throw(l))}catch(u){n(u)}},s=l=>l.done?i(l.value):Promise.resolve(l.value).then(a,o);s((e=e.apply(r,t)).next())}),Bj=(r,t,e,i,n)=>kB(void 0,null,function*(){const a=Mj(t.url);if(a.length>1){const{rasterFiles:o,xhrList:s,errList:l}=yield Dj(a,t);if(Aw(r,s),l.length>0){e(l,null);return}ox(o,i,n,e)}else{const o=XE(t,(s,l)=>{if(s)e(s);else if(l){const u=[{data:l,bands:a[0].bands}];ox(u,i,n,e)}});Aw(r,[o])}});function Dj(r,t){return kB(this,null,function*(){const e=[],i=[],n=[];for(let a=0;a<r.length;a++){const o=r[a],s=Rw(ww({},t),{url:o.url}),l=o.bands,{err:u,data:c,xhr:h}=yield JW(Rw(ww({},s),{type:"arrayBuffer"}));u&&n.push(u),i.push(h),e.push({data:c,bands:l})}return{rasterFiles:e,xhrList:i,errList:n}})}var Nj=Object.defineProperty,kj=Object.defineProperties,Uj=Object.getOwnPropertyDescriptors,Mw=Object.getOwnPropertySymbols,zj=Object.prototype.hasOwnProperty,Hj=Object.prototype.propertyIsEnumerable,Iw=(r,t,e)=>t in r?Nj(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,zg=(r,t)=>{for(var e in t||(t={}))zj.call(t,e)&&Iw(r,e,t[e]);if(Mw)for(var e of Mw(t))Hj.call(t,e)&&Iw(r,e,t[e]);return r},UB=(r,t)=>kj(r,Uj(t)),zB=(r,t,e)=>new Promise((i,n)=>{var a=l=>{try{s(e.next(l))}catch(u){n(u)}},o=l=>{try{s(e.throw(l))}catch(u){n(u)}},s=l=>l.done?i(l.value):Promise.resolve(l.value).then(a,o);s((e=e.apply(r,t)).next())}),$j=(r,t,e,i)=>zB(void 0,null,function*(){const{format:n=HB,operation:a,requestParameters:o={}}=i,s=UB(zg({},o),{url:Rj(r,t)});return new Promise((l,u)=>{Bj(e,s,(c,h)=>{c?u(c):h&&l(h)},n,a)})}),Lw=(r,t,e,i)=>zB(void 0,null,function*(){let n;const a=Array.isArray(r)?r[0]:r;return i.wmtsOptions?n=((i==null?void 0:i.getURLFromTemplate)||eG)(a,zg(zg({},t),i.wmtsOptions)):n=((i==null?void 0:i.getURLFromTemplate)||Mc)(a,t),new Promise((o,s)=>{var l;const u=ex(UB(zg({},i==null?void 0:i.requestParameters),{url:n,type:((l=i==null?void 0:i.requestParameters)==null?void 0:l.type)||"arrayBuffer"}),(c,h)=>{c?s(c):h&&o(h)},i.transformResponse);e.xhrCancel=()=>u.cancel()})}),HB=()=>({rasterData:new Uint8Array([0]),width:1,height:1}),Wj=Object.defineProperty,Vj=Object.defineProperties,Gj=Object.getOwnPropertyDescriptors,Ow=Object.getOwnPropertySymbols,Xj=Object.prototype.hasOwnProperty,Yj=Object.prototype.propertyIsEnumerable,Pw=(r,t,e)=>t in r?Wj(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Fw=(r,t)=>{for(var e in t||(t={}))Xj.call(t,e)&&Pw(r,e,t[e]);if(Ow)for(var e of Ow(t))Yj.call(t,e)&&Pw(r,e,t[e]);return r},jj=(r,t)=>Vj(r,Gj(t)),Zj={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0};Xr.ARRAYBUFFER,Xr.RGB;function qj(r){return!!(Array.isArray(r)&&r.length===0||!Array.isArray(r)&&typeof r!="string")}function Kj(r,t={}){if(qj(r))throw new Error("tile server url is error");const{extent:e=[1/0,1/0,-1/0,-1/0],coordinates:i}=t;let n=(t==null?void 0:t.dataType)||Xr.IMAGE;n===Xr.RGB&&(n=Xr.ARRAYBUFFER);const a=(l,u)=>{switch(n){case Xr.IMAGE:return Lw(r,l,u,t);case Xr.CUSTOMIMAGE:case Xr.CUSTOMTERRAINRGB:return wj(u,t==null?void 0:t.getCustomData);case Xr.ARRAYBUFFER:return $j(r,l,u,t);case Xr.CUSTOMARRAYBUFFER:case Xr.CUSTOMRGB:return bj(u,t==null?void 0:t.getCustomData,(t==null?void 0:t.format)||HB,t==null?void 0:t.operation);default:return Lw(r,l,u,t)}},o=jj(Fw(Fw({},Zj),t),{getTileData:a}),s=bh(i,e);return{data:r,dataArray:[{_id:1,coordinates:s}],tilesetOptions:o,isTile:!0}}var Qj=Object.defineProperty,Jj=Object.defineProperties,tZ=Object.getOwnPropertyDescriptors,A0=Object.getOwnPropertySymbols,$B=Object.prototype.hasOwnProperty,WB=Object.prototype.propertyIsEnumerable,Bw=(r,t,e)=>t in r?Qj(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,eZ=(r,t)=>{for(var e in t||(t={}))$B.call(t,e)&&Bw(r,e,t[e]);if(A0)for(var e of A0(t))WB.call(t,e)&&Bw(r,e,t[e]);return r},rZ=(r,t)=>Jj(r,tZ(t)),iZ=(r,t)=>{var e={};for(var i in r)$B.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&A0)for(var i of A0(r))t.indexOf(i)<0&&WB.call(r,i)&&(e[i]=r[i]);return e};function nZ(r,t){const e=t,{extent:i=[121.168,30.2828,121.384,30.4219],coordinates:n,width:a,height:o}=e,s=iZ(e,["extent","coordinates","width","height"]);r.length<2&&console.warn("RGB解析需要2个波段的数据");const[l,u]=s.bands||[0,1],c=[r[l],r[u]],h=[];for(let v=0;v<c[0].length;v++)h.push((c[1][v]-c[0][v])/(c[1][v]+c[0][v]));const f=bh(n,i);return{_id:1,dataArray:[rZ(eZ({_id:1,data:h,width:a,height:o},s),{coordinates:f})]}}var aZ=Object.defineProperty,oZ=Object.defineProperties,sZ=Object.getOwnPropertyDescriptors,T0=Object.getOwnPropertySymbols,VB=Object.prototype.hasOwnProperty,GB=Object.prototype.propertyIsEnumerable,Dw=(r,t,e)=>t in r?aZ(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,lZ=(r,t)=>{for(var e in t||(t={}))VB.call(t,e)&&Dw(r,e,t[e]);if(T0)for(var e of T0(t))GB.call(t,e)&&Dw(r,e,t[e]);return r},uZ=(r,t)=>oZ(r,sZ(t)),cZ=(r,t)=>{var e={};for(var i in r)VB.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&T0)for(var i of T0(r))t.indexOf(i)<0&&GB.call(r,i)&&(e[i]=r[i]);return e};function hZ(r,t){const e=t,{extent:i,coordinates:n,width:a,height:o}=e,s=cZ(e,["extent","coordinates","width","height"]);r.length<3&&console.warn("RGB解析需要三个波段的数据");const[l,u,c]=s.bands||[0,1,2],h=[r[l],r[u],r[c]],f=[],[d,v]=(s==null?void 0:s.countCut)||[2,98],p=(s==null?void 0:s.RMinMax)||Ic(h[0],d,v),g=(s==null?void 0:s.GMinMax)||Ic(h[1],d,v),m=(s==null?void 0:s.BMinMax)||Ic(h[2],d,v);for(let x=0;x<h[0].length;x++)f.push(Math.max(0,h[0][x]-p[0])),f.push(Math.max(0,h[1][x]-g[0])),f.push(Math.max(0,h[2][x]-m[0]));const y=bh(n,i);return{_id:1,dataArray:[uZ(lZ({_id:1,data:f,width:a,height:o,rMinMax:p,gMinMax:g,bMinMax:m},s),{coordinates:y})]}}var fZ=Object.defineProperty,dZ=Object.defineProperties,vZ=Object.getOwnPropertyDescriptors,b0=Object.getOwnPropertySymbols,XB=Object.prototype.hasOwnProperty,YB=Object.prototype.propertyIsEnumerable,Nw=(r,t,e)=>t in r?fZ(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,pZ=(r,t)=>{for(var e in t||(t={}))XB.call(t,e)&&Nw(r,e,t[e]);if(b0)for(var e of b0(t))YB.call(t,e)&&Nw(r,e,t[e]);return r},gZ=(r,t)=>dZ(r,vZ(t)),mZ=(r,t)=>{var e={};for(var i in r)XB.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&b0)for(var i of b0(r))t.indexOf(i)<0&&YB.call(r,i)&&(e[i]=r[i]);return e};function yZ(r,t){const e=t,{extent:i,coordinates:n,min:a,max:o,width:s,height:l,format:u,operation:c}=e,h=mZ(e,["extent","coordinates","min","max","width","height","format","operation"]);let f;if(u===void 0||xB(r))f=Array.from(r);else{const p=Array.isArray(r)?r:[r];f=JE(p,u,c)}const d=bh(n,i);return{_id:1,dataArray:[gZ(pZ({_id:1,data:f,width:s,height:l},h),{min:a,max:o,coordinates:d})]}}var _Z=Object.defineProperty,xZ=Object.defineProperties,CZ=Object.getOwnPropertyDescriptors,kw=Object.getOwnPropertySymbols,EZ=Object.prototype.hasOwnProperty,SZ=Object.prototype.propertyIsEnumerable,Uw=(r,t,e)=>t in r?_Z(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,zw=(r,t)=>{for(var e in t||(t={}))EZ.call(t,e)&&Uw(r,e,t[e]);if(kw)for(var e of kw(t))SZ.call(t,e)&&Uw(r,e,t[e]);return r},AZ=(r,t)=>xZ(r,CZ(t)),TZ=(r,t,e)=>new Promise((i,n)=>{var a=l=>{try{s(e.next(l))}catch(u){n(u)}},o=l=>{try{s(e.throw(l))}catch(u){n(u)}},s=l=>l.done?i(l.value):Promise.resolve(l.value).then(a,o);s((e=e.apply(r,t)).next())}),bZ={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},wZ=r=>TZ(void 0,null,function*(){return new Promise(t=>{const[e,i,n,a]=r.bounds,o={layers:{testTile:{features:[{type:"Feature",properties:{key:r.x+"/"+r.y+"/"+r.z,x:(e+n)/2,y:(i+a)/2},geometry:{type:"LineString",coordinates:[[n,a],[n,i],[e,i],[e,i]]}}]}}};t(o)})});function RZ(r,t){const e=n=>wZ(n),i=AZ(zw(zw({},bZ),t),{getTileData:e});return{data:r,dataArray:[],tilesetOptions:i,isTile:!0}}var MZ=Object.defineProperty,Hw=Object.getOwnPropertySymbols,IZ=Object.prototype.hasOwnProperty,LZ=Object.prototype.propertyIsEnumerable,$w=(r,t,e)=>t in r?MZ(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,jB=(r,t)=>{for(var e in t||(t={}))IZ.call(t,e)&&$w(r,e,t[e]);if(Hw)for(var e of Hw(t))LZ.call(t,e)&&$w(r,e,t[e]);return r};function ZB(r,t){const{radius:e=40,maxZoom:i=18,minZoom:n=0,zoom:a=2}=t;if(r.pointIndex){const l=r.pointIndex.getClusters(r.extent,Math.floor(a));return r.dataArray=OZ(l),r}const o=new D$({radius:e,minZoom:n,maxZoom:i}),s={type:"FeatureCollection",features:[]};return s.features=r.dataArray.map(l=>({type:"Feature",geometry:{type:"Point",coordinates:l.coordinates},properties:jB({},l)})),o.load(s.features),o}function OZ(r){return r.map((t,e)=>jB({coordinates:t.geometry.coordinates,_id:e+1},t.properties))}function PZ(r){if(r.length===0)throw new Error("max requires at least one data point");let t=r[0];for(let e=1;e<r.length;e++)r[e]>t&&(t=r[e]);return t}function FZ(r){if(r.length===0)throw new Error("min requires at least one data point");let t=r[0];for(let e=1;e<r.length;e++)r[e]<t&&(t=r[e]);return t}function qB(r){if(r.length===0)return 0;let t=r[0],e=0,i;for(let n=1;n<r.length;n++)i=t+r[n]*1,Math.abs(t)>=Math.abs(r[n])?e+=t-i+r[n]:e+=r[n]-i+t,t=i;return t+e*1}function BZ(r){if(r.length===0)throw new Error("mean requires at least one data point");return qB(r)/r.length}var DZ={min:FZ,max:PZ,mean:BZ,sum:qB},NZ=Object.defineProperty,Ww=Object.getOwnPropertySymbols,kZ=Object.prototype.hasOwnProperty,UZ=Object.prototype.propertyIsEnumerable,Vw=(r,t,e)=>t in r?NZ(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,rf=(r,t)=>{for(var e in t||(t={}))kZ.call(t,e)&&Vw(r,e,t[e]);if(Ww)for(var e of Ww(t))UZ.call(t,e)&&Vw(r,e,t[e]);return r},Gw=(r,t,e)=>new Promise((i,n)=>{var a=l=>{try{s(e.next(l))}catch(u){n(u)}},o=l=>{try{s(e.throw(l))}catch(u){n(u)}},s=l=>l.done?i(l.value):Promise.resolve(l.value).then(a,o);s((e=e.apply(r,t)).next())}),{cloneDeep:zZ,isFunction:Xw,isString:HZ,mergeWith:$Z}=er;function WZ(r,t){if(Array.isArray(t))return t}var VZ=class extends Li.EventEmitter{constructor(r,t){super(),this.type="source",this.isTile=!1,this.inited=!1,this.hooks={init:new ja},this.parser={type:"geojson"},this.transforms=[],this.cluster=!1,this.clusterOptions={enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"},this.invalidExtent=!1,this.dataArrayChanged=!1,this.cfg={autoRender:!0},this.originData=r,this.initCfg(t),this.init().then(()=>{this.inited=!0,this.emit("update",{type:"inited"})})}getSourceCfg(){return this.cfg}getClusters(r){return this.clusterIndex.getClusters(this.caculClusterExtent(2),r)}getClustersLeaves(r){return this.clusterIndex.getLeaves(r,1/0)}getParserType(){return this.parser.type}updateClusterData(r){const{method:t="sum",field:e}=this.clusterOptions;let i=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(r));this.clusterOptions.zoom=r,i.forEach(n=>{n.id||(n.properties.point_count=1)}),(e||Xw(t))&&(i=i.map(n=>{const a=n.id;if(a){const s=this.clusterIndex.getLeaves(a,1/0).map(u=>u.properties);let l;if(HZ(t)&&e){const u=rG(s,e);l=DZ[t](u)}Xw(t)&&(l=t(s)),n.properties.stat=l}else n.properties.point_count=1;return n})),this.data=w2("geojson")({type:"FeatureCollection",features:i}),this.executeTrans()}getFeatureById(r){const{type:t="geojson",geometry:e}=this.parser;if(t==="geojson"&&!this.cluster){const i=r<this.originData.features.length?this.originData.features[r]:"null",n=zZ(i);if(n!=null&&n.properties&&(this.transforms.length!==0||this.dataArrayChanged)){const a=this.data.dataArray.find(o=>o._id===r);n.properties=a}return n}else return t==="json"&&e?this.data.dataArray.find(i=>i._id===r):r<this.data.dataArray.length?this.data.dataArray[r]:"null"}updateFeaturePropertiesById(r,t){this.data.dataArray=this.data.dataArray.map(e=>e._id===r?rf(rf({},e),t):e),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}getFeatureId(r,t){const e=this.data.dataArray.find(i=>i[r]===t);return e==null?void 0:e._id}setData(r,t){this.originData=r,this.dataArrayChanged=!1,this.initCfg(t),this.init().then(()=>{this.emit("update",{type:"update"})})}reloadAllTile(){var r;(r=this.tileset)==null||r.reloadAll()}reloadTilebyId(r,t,e){var i;(i=this.tileset)==null||i.reloadTileById(r,t,e)}reloadTileByLnglat(r,t,e){var i;(i=this.tileset)==null||i.reloadTileByLnglat(r,t,e)}getTileExtent(r,t){var e;return(e=this.tileset)==null?void 0:e.getTileExtent(r,t)}getTileByZXY(r,t,e){var i;return(i=this.tileset)==null?void 0:i.getTileByZXY(r,t,e)}reloadTileByExtent(r,t){var e;(e=this.tileset)==null||e.reloadTileByExtent(r,t)}destroy(){var r;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(r=this.tileset)==null||r.destroy()}processData(){return Gw(this,null,function*(){return new Promise((r,t)=>{try{this.excuteParser(),this.initCluster(),this.executeTrans(),r({})}catch(e){t(e)}})})}initCfg(r){this.cfg=$Z(this.cfg,r,WZ);const t=this.cfg;t&&(t.parser&&(this.parser=t.parser),t.transforms&&(this.transforms=t.transforms),this.cluster=t.cluster||!1,t.clusterOptions&&(this.cluster=!0,this.clusterOptions=rf(rf({},this.clusterOptions),t.clusterOptions)))}init(){return Gw(this,null,function*(){this.inited=!1,yield this.processData(),this.inited=!0})}excuteParser(){const r=this.parser,t=r.type||"geojson",e=w2(t);this.data=e(this.originData,r),this.tileset=this.initTileset(),!r.cancelExtent&&(this.extent=_V(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}setCenter(r){this.center=[(r[0]+r[2])/2,(r[1]+r[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}initTileset(){const{tilesetOptions:r}=this.data;return r?(this.isTile=!0,this.tileset?(this.tileset.updateOptions(r),this.tileset):new tG(rf({},r))):void 0}executeTrans(){this.transforms.forEach(t=>{const{type:e}=t,i=XW(e)(this.data,t);Object.assign(this.data,i)})}initCluster(){if(!this.cluster)return;const r=this.clusterOptions||{};this.clusterIndex=ZB(this.data,r)}caculClusterExtent(r){let t=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(t=KE(x0(this.extent),r)),t[0].concat(t[1])}};function GZ(r,t){const{callback:e}=t;return e&&(r.dataArray=r.dataArray.filter(e)),r}var iS=6378e3;function XZ(r,t){const e=r.dataArray,{size:i=10}=t,n=i/(2*Math.PI*iS)*(256<<20)/2,{gridHash:a,gridOffset:o}=YZ(e,i),s=KZ(a,o,t);return{yOffset:n,xOffset:n,radius:n,type:"grid",dataArray:s}}function YZ(r,t){let e=1/0,i=-1/0,n;for(const l of r)n=l.coordinates[1],Number.isFinite(n)&&(e=n<e?n:e,i=n>i?n:i);const a=(e+i)/2,o=jZ(t,a);if(o.xOffset<=0||o.yOffset<=0)return{gridHash:{},gridOffset:o};const s={};for(const l of r){const u=l.coordinates[1],c=l.coordinates[0];if(Number.isFinite(u)&&Number.isFinite(c)){const h=Math.floor((u+90)/o.yOffset),f=Math.floor((c+180)/o.xOffset),d=`${h}-${f}`;s[d]=s[d]||{count:0,points:[]},s[d].count+=1,s[d].points.push(l)}}return{gridHash:s,gridOffset:o}}function jZ(r,t){const e=ZZ(r),i=qZ(t,r);return{yOffset:e,xOffset:i}}function ZZ(r){return r/iS*(180/Math.PI)}function qZ(r,t){return t/iS*(180/Math.PI)/Math.cos(r*Math.PI/180)}function KZ(r,t,e){return Object.keys(r).reduce((i,n,a)=>{const o=n.split("-"),s=parseInt(o[0],10),l=parseInt(o[1],10),u={};if(e.field&&e.method){const c=vB(r[n].points,e.field);u[e.method]=dB[e.method](c)}return Object.assign(u,{_id:a,coordinates:Vn([-180+t.xOffset*(l+.5),-90+t.yOffset*(s+.5)]),rawData:r[n].points,count:r[n].count}),i.push(u),i},[])}var QZ=Object.defineProperty,JZ=Object.defineProperties,tq=Object.getOwnPropertyDescriptors,Yw=Object.getOwnPropertySymbols,eq=Object.prototype.hasOwnProperty,rq=Object.prototype.propertyIsEnumerable,jw=(r,t,e)=>t in r?QZ(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,iq=(r,t)=>{for(var e in t||(t={}))eq.call(t,e)&&jw(r,e,t[e]);if(Yw)for(var e of Yw(t))rq.call(t,e)&&jw(r,e,t[e]);return r},nq=(r,t)=>JZ(r,tq(t)),aq=6378e3;function oq(r,t){const e=r.dataArray,{size:i=10,method:n="sum"}=t,a=i/(2*Math.PI*aq)*(256<<20)/2,o=e.map(c=>{const[h,f]=Vn(c.coordinates);return nq(iq({},c),{coordinates:[h,f]})});return{dataArray:WW().radius(a).x(c=>c.coordinates[0]).y(c=>c.coordinates[1])(o).map((c,h)=>{if(t.field&&n){const f=vB(c,t.field);c[n]=dB[n](f)}return{[t.method]:c[n],count:c.length,rawData:c,coordinates:[c.x,c.y],_id:h}}),radius:a,xOffset:a,yOffset:a,type:"hexagon"}}var sq=Object.defineProperty,Zw=Object.getOwnPropertySymbols,lq=Object.prototype.hasOwnProperty,uq=Object.prototype.propertyIsEnumerable,qw=(r,t,e)=>t in r?sq(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Kw=(r,t)=>{for(var e in t||(t={}))lq.call(t,e)&&qw(r,e,t[e]);if(Zw)for(var e of Zw(t))uq.call(t,e)&&qw(r,e,t[e]);return r};function cq(r,t){const{sourceField:e,targetField:i,data:n}=t,a={};return n.forEach(o=>{a[o[e]]=o}),r.dataArray=r.dataArray.map(o=>{const s=o[i];return Kw(Kw({},o),a[s])}),r}function hq(r,t){const{callback:e}=t;return e&&(r.dataArray=r.dataArray.map(e)),r}var fq=Object.defineProperty,dq=Object.defineProperties,vq=Object.getOwnPropertyDescriptors,Qw=Object.getOwnPropertySymbols,pq=Object.prototype.hasOwnProperty,gq=Object.prototype.propertyIsEnumerable,Jw=(r,t,e)=>t in r?fq(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,mq=(r,t)=>{for(var e in t||(t={}))pq.call(t,e)&&Jw(r,e,t[e]);if(Qw)for(var e of Qw(t))gq.call(t,e)&&Jw(r,e,t[e]);return r},yq=(r,t)=>dq(r,vq(t));function _q(r){let t=1/0,e=-1/0,i=1/0,n=-1/0;r.forEach(s=>{const l=s.coordinates;if(!l)return;const u=c=>{if(typeof c[0]=="number"&&typeof c[1]=="number"){const[h,f]=c;t=Math.min(t,h),e=Math.max(e,h),i=Math.min(i,f),n=Math.max(n,f)}else Array.isArray(c[0])&&c.forEach(u)};u(l)});const a=(t+e)/2,o=(i+n)/2;return[a,o]}function xq(r,t){const[e,i]=t;return r.map(n=>{if(!n.coordinates)return n;const a=o=>{if(typeof o[0]=="number"&&typeof o[1]=="number"){const s=Number((o[0]-e).toPrecision(15)),l=Number((o[1]-i).toPrecision(15));return[s,l,...o.slice(2)||[]]}else if(Array.isArray(o[0]))return o.map(a);return o};return yq(mq({},n),{coordinates:a(n.coordinates)})})}function Cq(r,t={}){const{enableRelativeCoordinates:e=!1,relativeOrigin:i}=t;if(!e)return{dataArray:r,relativeOrigin:[0,0],originalExtent:[0,0,0,0]};let n=1/0,a=-1/0,o=1/0,s=-1/0;r.forEach(h=>{const f=h.coordinates;if(!f)return;const d=v=>{if(typeof v[0]=="number"&&typeof v[1]=="number"){const[p,g]=v;n=Math.min(n,p),a=Math.max(a,p),o=Math.min(o,g),s=Math.max(s,g)}else Array.isArray(v[0])&&v.forEach(d)};d(f)});const l=[n,o,a,s],u=i||_q(r);return{dataArray:xq(r,u),relativeOrigin:u,originalExtent:l}}In("rasterTile",Kj);In("mvt",lX);In("geojsonvt",PG);In("testTile",RZ);In("geojson",yG);In("jsonTile",YG);In("image",EB);In("csv",lG);In("json",CB);In("raster",EX);In("rasterRgb",yZ);In("rgb",hZ);In("ndi",nZ);Th("cluster",ZB);Th("filter",GZ);Th("join",cq);Th("map",hq);Th("grid",XZ);Th("hexagon",oq);var Wm=VZ;let tR=class extends Li.EventEmitter{getMarkerLayerContainerSize(){}constructor(t){super(),E(this,"markerOption",void 0),E(this,"popup",void 0),E(this,"mapsService",void 0),E(this,"lngLat",void 0),E(this,"scene",void 0),E(this,"added",!1),E(this,"preLngLat",{lng:0,lat:0}),E(this,"onMarkerDragStart",e=>{const i=this.mapsService.getContainer();if(!i)return;this.mapsService.setMapStatus({dragEnable:!1,zoomEnable:!1});const{left:n,top:a}=i.getClientRects()[0],{x:o,y:s}=e;this.preLngLat=this.mapsService.containerToLngLat([o-n,s-a]),this.mapsService.on("mousemove",this.onMarkerDragMove),document.addEventListener("mouseup",this.onMarkerDragEnd),this.emit("dragstart",this.lngLat)}),E(this,"onMarkerDragMove",e=>{const i=e.lngLat||e.lnglat,{lng:n,lat:a}=this.preLngLat,{lng:o,lat:s}=i,l={lng:this.lngLat.lng+o-n,lat:this.lngLat.lat+s-a};this.setLnglat(l),this.preLngLat=i,this.emit("dragging",l)}),E(this,"onMarkerDragEnd",()=>{this.mapsService.setMapStatus({dragEnable:!0,zoomEnable:!0}),this.mapsService.off("mousemove",this.onMarkerDragMove),document.removeEventListener("mouseup",this.onMarkerDragEnd),this.emit("dragend",this.lngLat)}),E(this,"eventHandle",e=>{this.polyfillEvent(e),this.emit(e.type,{target:e,data:this.markerOption.extData,lngLat:this.lngLat})}),E(this,"touchStartTime",void 0),this.markerOption=G(G({},this.getDefault()),t),mV(["update","onMove","onMapClick","updatePositionWhenZoom"],this),this.init()}getDefault(){return{element:void 0,anchor:Um.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1,overflowHide:!0}}addTo(t){this.scene=t,this.mapsService=t.mapService;const{element:e}=this.markerOption;return this.mapsService.getMarkerContainer().appendChild(e),this.registerMarkerEvent(e),this.mapsService.on("camerachange",this.update),this.update(),this.updateDraggable(),this.added=!0,this.emit("added"),this}remove(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();const{element:t}=this.markerOption;return t&&xn(t),this.popup&&this.popup.remove(),this}setLnglat(t){return this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}getLnglat(){return this.lngLat}getElement(){return this.markerOption.element}setElement(t){if(!this.added)return this.once("added",()=>{this.setElement(t)}),this;const{element:e}=this.markerOption;return e&&xn(e),this.markerOption.element=t,this.init(),this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.updateDraggable(),this.update(),this}openPopup(){if(!this.added)return this.once("added",()=>{this.openPopup()}),this;const t=this.popup;return t?(t.isOpen()||t.addTo(this.scene),this):this}closePopup(){this.added||this.once("added",()=>{this.closePopup()});const t=this.popup;return t&&t.remove(),this}setPopup(t){return this.popup=t,this.lngLat&&this.popup.setLnglat(this.lngLat),this}togglePopup(){const t=this.popup;if(t)t.isOpen()?t.remove():t.addTo(this.scene);else return this;return this}getPopup(){return this.popup}getOffset(){return this.markerOption.offsets}setDraggable(t){this.markerOption.draggable=t,this.updateDraggable()}getDraggable(){return this.markerOption.draggable}getExtData(){return this.markerOption.extData}setExtData(t){this.markerOption.extData=t}update(){if(!this.mapsService)return;const{element:t,anchor:e}=this.markerOption;this.updatePosition(),uB(t,`${y0[e]}`)}updatePositionWhenZoom(t){if(!this.mapsService)return;const{element:e,offsets:i}=this.markerOption,{lng:n,lat:a}=this.lngLat;if(e){e.style.display="block",e.style.whiteSpace="nowrap";const{containerHeight:o,containerWidth:s,bounds:l}=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize();if(!l)return;const u=t.map,c=t.center,h=t.zoom,f=u.DE(this.lngLat,h,c);if(f.x=Math.round(f.x+i[0]),f.y=Math.round(f.y-i[1]),Math.abs(l[0][0])>180||Math.abs(l[1][0])>180){if(f.x>s){const d=this.mapsService.lngLatToContainer([n-360,a]);f.x=d.x}if(f.x<0){const d=this.mapsService.lngLatToContainer([n+360,a]);f.x=d.x}}(f.x>s||f.x<0||f.y>o||f.y<0)&&(e.style.display="none"),e.style.left=f.x+"px",e.style.top=f.y+"px",e.style.transition="left 0.25s cubic-bezier(0,0,0.25,1), top 0.25s cubic-bezier(0,0,0.25,1)"}}onMapClick(t){const{element:e}=this.markerOption;this.popup&&e&&this.togglePopup()}getCurrentContainerSize(){const t=this.mapsService.getContainer();return{containerHeight:(t==null?void 0:t.scrollHeight)||0,containerWidth:(t==null?void 0:t.scrollWidth)||0,bounds:this.mapsService.getBounds()}}updateDraggable(){const{element:t}=this.markerOption;t==null||t.removeEventListener("mousedown",this.onMarkerDragStart),this.mapsService.off("mousemove",this.onMarkerDragMove),document.removeEventListener("mouseup",this.onMarkerDragEnd),this.markerOption.draggable&&(t==null||t.addEventListener("mousedown",this.onMarkerDragStart))}updatePosition(){if(!this.mapsService)return;const{element:t,offsets:e}=this.markerOption,{lng:i,lat:n}=this.lngLat,a=this.mapsService.lngLatToContainer([i,n]);if(t){t.style.display="block",t.style.whiteSpace="nowrap";const{containerHeight:o,containerWidth:s,bounds:l}=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize();if(!l)return;if(Math.abs(l[0][0])>180||Math.abs(l[1][0])>180){if(a.x>s){const u=this.mapsService.lngLatToContainer([i-360,n]);a.x=u.x}if(a.x<0){const u=this.mapsService.lngLatToContainer([i+360,n]);a.x=u.x}}this.markerOption.overflowHide&&(a.x>s||a.x<0||a.y>o||a.y<0)&&(t.style.display="none"),t.style.left=a.x+e[0]+"px",t.style.top=a.y-e[1]+"px"}}init(){let{element:t}=this.markerOption;const{color:e,anchor:i}=this.markerOption;if(!t){t=we("div"),this.markerOption.element=t;const n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height","48px"),n.setAttributeNS(null,"width","48px"),n.setAttributeNS(null,"viewBox","0 0 1024 1024");const a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),a.setAttributeNS(null,"fill",e),n.appendChild(a),t.appendChild(n)}fo(t,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(n=>{var a,o;const s=((a=this.markerOption)===null||a===void 0?void 0:a.style)&&((o=this.markerOption)===null||o===void 0?void 0:o.style[n]);t&&(t.style[n]=s)}),iB(t,i,"marker")}registerMarkerEvent(t){t.addEventListener("click",this.onMapClick),t.addEventListener("mousemove",this.eventHandle),t.addEventListener("click",this.eventHandle),t.addEventListener("mousedown",this.eventHandle),t.addEventListener("mouseup",this.eventHandle),t.addEventListener("dblclick",this.eventHandle),t.addEventListener("contextmenu",this.eventHandle),t.addEventListener("mouseover",this.eventHandle),t.addEventListener("mouseout",this.eventHandle),t.addEventListener("touchstart",this.eventHandle),t.addEventListener("touchend",this.eventHandle)}unRegisterMarkerEvent(){const t=this.getElement();t.removeEventListener("click",this.onMapClick),t.removeEventListener("mousemove",this.eventHandle),t.removeEventListener("click",this.eventHandle),t.removeEventListener("mousedown",this.eventHandle),t.removeEventListener("mouseup",this.eventHandle),t.removeEventListener("dblclick",this.eventHandle),t.removeEventListener("contextmenu",this.eventHandle),t.removeEventListener("mouseover",this.eventHandle),t.removeEventListener("mouseout",this.eventHandle),t.removeEventListener("touchstart",this.eventHandle),t.removeEventListener("touchend",this.eventHandle)}polyfillEvent(t){!this.mapsService||this.mapsService.getType()!=="amap"||gV()||(t.type==="touchstart"&&(this.touchStartTime=Date.now()),t.type==="touchend"&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:t,data:this.markerOption.extData,lngLat:this.lngLat}))}addDragHandler(t){return null}onUp(t){throw new Error("Method not implemented.")}};window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(r){try{let u=function(){s||(s=!0,a())},c=function(){try{o.documentElement.doScroll("left")}catch{return void setTimeout(c,50)}u()};var e=(e=document.getElementsByTagName("script"))[e.length-1],t=e.getAttribute("data-injectcss"),e=e.getAttribute("data-disable-injectsvg");if(!e){var i,n,a,o,s,l=function(h,f){f.parentNode.insertBefore(h,f)};if(t&&!r.__iconfont__svg__cssinject__){r.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(h){console&&console.log(h)}}i=function(){var h,f=document.createElement("div");f.innerHTML=r._iconfont_svg_string_3580659,(f=f.getElementsByTagName("svg")[0])&&(f.setAttribute("aria-hidden","true"),f.style.position="absolute",f.style.width=0,f.style.height=0,f.style.overflow="hidden",f=f,(h=document.body).firstChild?l(f,h.firstChild):h.appendChild(f))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(i,0):(n=function(){document.removeEventListener("DOMContentLoaded",n,!1),i()},document.addEventListener("DOMContentLoaded",n,!1)):document.attachEvent&&(a=i,o=r.document,s=!1,c(),o.onreadystatechange=function(){o.readyState=="complete"&&(o.onreadystatechange=null,u())})}}catch{}}(window);class ns extends NE{constructor(t){super(),E(this,"controlOption",void 0),E(this,"container",void 0),E(this,"isShow",void 0),E(this,"sceneContainer",void 0),E(this,"scene",void 0),E(this,"mapsService",void 0),E(this,"renderService",void 0),E(this,"layerService",void 0),E(this,"controlService",void 0),E(this,"configService",void 0),ns.controlCount++,this.controlOption=G(G({},this.getDefault(t)),t||{})}getOptions(){return this.controlOption}setOptions(t){const e=this.getDefault(t);Object.entries(t).forEach(([i,n])=>{n===void 0&&(t[i]=e[i])}),"position"in t&&this.setPosition(t.position),"className"in t&&this.setClassName(t.className),"style"in t&&this.setStyle(t.style),this.controlOption=G(G({},this.controlOption),t)}addTo(t){this.mapsService=t.mapService,this.renderService=t.rendererService,this.layerService=t.layerService,this.controlService=t.controlService,this.configService=t.globalConfigService,this.scene=t.sceneService,this.sceneContainer=t,this.isShow=!0,this.container=this.onAdd(),fo(this.container,"l7-control");const{className:e,style:i}=this.controlOption;return e&&this.setClassName(e),i&&this.setStyle(i),this.insertContainer(),this.emit("add",this),this}remove(){if(!this.mapsService)return this;xn(this.container),this.onRemove(),this.emit("remove",this)}onAdd(){return we("div")}onRemove(){}show(){const t=this.container;Zc(t,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}hide(){const t=this.container;fo(t,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}getDefault(t){return{position:qc.TOPRIGHT,name:`${ns.controlCount}`}}getContainer(){return this.container}getIsShow(){return this.isShow}_refocusOnMap(t){if(this.mapsService&&t&&t.screenX>0&&t.screenY>0){const e=this.mapsService.getContainer();e!==null&&e.focus()}}setPosition(t=qc.TOPLEFT){const e=this.controlService;return e&&e.removeControl(this),this.controlOption.position=t,e&&e.addControl(this,this.sceneContainer),this}setClassName(t){const e=this.container,{className:i}=this.controlOption;i&&Zc(e,i),t&&fo(e,t)}setStyle(t){const e=this.container;t?e.setAttribute("style",t):e.removeAttribute("style")}insertContainer(){const t=this.controlOption.position,e=this.container;if(t instanceof Element)t.appendChild(e);else{const i=this.controlService.controlCorners[t];["bottomleft","bottomright","righttop","rightbottom"].includes(t)?i.insertBefore(e,i.firstChild):i.appendChild(e)}}checkUpdateOption(t,e){return e.some(i=>i in t)}}E(ns,"controlCount",0);class Eq extends ns{constructor(...t){super(...t),E(this,"isDisable",!1),E(this,"button",void 0),E(this,"buttonText",void 0),E(this,"buttonIcon",void 0)}setIsDisable(t){if(this.isDisable=t,t){var e;(e=this.button)===null||e===void 0||e.setAttribute("disabled","true")}else{var i;(i=this.button)===null||i===void 0||i.removeAttribute("disabled")}}createButton(t=""){return we("button",`l7-button-control ${t}`)}onAdd(){this.button=this.createButton(),this.isDisable=!1;const{title:t,btnText:e,btnIcon:i}=this.controlOption;return this.setBtnTitle(t),this.setBtnText(e),this.setBtnIcon(i),this.button}onRemove(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}setOptions(t){const{title:e,btnText:i,btnIcon:n}=t;this.checkUpdateOption(t,["title"])&&this.setBtnTitle(e),this.checkUpdateOption(t,["btnIcon"])&&this.setBtnIcon(n),this.checkUpdateOption(t,["btnText"])&&this.setBtnText(i),super.setOptions(t)}setBtnTitle(t){var e;(e=this.button)===null||e===void 0||e.setAttribute("title",t??"")}setBtnIcon(t){if(this.buttonIcon&&xn(this.buttonIcon),t){var e;const a=(e=this.button)===null||e===void 0?void 0:e.firstChild;if(a){var i;(i=this.button)===null||i===void 0||i.insertBefore(t,a)}else{var n;(n=this.button)===null||n===void 0||n.appendChild(t)}this.buttonIcon=t}}setBtnText(t){if(this.button)if(Zc(this.button,"l7-button-control--row"),Zc(this.button,"l7-button-control--column"),t){let i=this.buttonText;if(!i){var e;i=we("div","l7-button-control__text"),(e=this.button)===null||e===void 0||e.appendChild(i),this.buttonText=i}i.innerText=t,fo(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!t&&this.buttonText&&(xn(this.buttonText),this.buttonText=void 0)}}class w0 extends Li.EventEmitter{get buttonRect(){return this.button.getBoundingClientRect()}constructor(t,e){super(),E(this,"popperDOM",void 0),E(this,"contentDOM",void 0),E(this,"button",void 0),E(this,"option",void 0),E(this,"isShow",!1),E(this,"content",void 0),E(this,"timeout",null),E(this,"show",()=>this.isShow||!this.contentDOM.innerHTML?this:(this.resetPopperPosition(),Zc(this.popperDOM,"l7-popper-hide"),this.isShow=!0,this.option.unique&&w0.conflictPopperList.forEach(i=>{i!==this&&i.isShow&&i.hide()}),this.emit("show"),window.addEventListener("pointerdown",this.onPopperUnClick),this)),E(this,"hide",()=>this.isShow?(fo(this.popperDOM,"l7-popper-hide"),this.isShow=!1,this.emit("hide"),window.removeEventListener("pointerdown",this.onPopperUnClick),this):this),E(this,"setHideTimeout",()=>{this.timeout||(this.timeout=window.setTimeout(()=>{this.isShow&&(this.hide(),this.timeout=null)},300))}),E(this,"clearHideTimeout",()=>{this.timeout&&(window.clearTimeout(this.timeout),this.timeout=null)}),E(this,"onBtnClick",()=>{this.isShow?this.hide():this.show()}),E(this,"onPopperUnClick",i=>{vV(i.target,[".l7-button-control",".l7-popper-content"])||this.hide()}),E(this,"onBtnMouseLeave",()=>{this.setHideTimeout()}),E(this,"onBtnMouseMove",()=>{this.clearHideTimeout(),!this.isShow&&this.show()}),this.button=t,this.option=e,this.init(),e.unique&&w0.conflictPopperList.push(this)}getPopperDOM(){return this.popperDOM}getIsShow(){return this.isShow}getContent(){return this.content}setContent(t){typeof t=="string"?this.contentDOM.innerHTML=t:t instanceof HTMLElement&&(mv(this.contentDOM),this.contentDOM.appendChild(t)),this.content=t}init(){const{trigger:t}=this.option;this.popperDOM=this.createPopper(),t==="click"?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}destroy(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),xn(this.popperDOM)}resetPopperPosition(){const t={},{container:e,offset:i=[0,0],placement:n}=this.option,[a,o]=i,s=this.button.getBoundingClientRect(),l=e.getBoundingClientRect(),{left:u,right:c,top:h,bottom:f}=fV(s,l);let d=!1,v=!1;/^(left|right)/.test(n)?(n.includes("left")?t.right=`${s.width+c}px`:n.includes("right")&&(t.left=`${s.width+u}px`),n.includes("start")?t.top=`${h}px`:n.includes("end")?t.bottom=`${f}px`:(t.top=`${h+s.height/2}px`,v=!0,t.transform=`translate(${a}px, calc(${o}px - 50%))`)):/^(top|bottom)/.test(n)&&(n.includes("top")?t.bottom=`${s.height+f}px`:n.includes("bottom")&&(t.top=`${s.height+h}px`),n.includes("start")?t.left=`${u}px`:n.includes("end")?t.right=`${c}px`:(t.left=`${u+s.width/2}px`,d=!0,t.transform=`translate(calc(${a}px - 50%), ${o}px)`)),t.transform=`translate(calc(${a}px - ${d?"50%":"0%"}), calc(${o}px - ${v?"50%":"0%"})`;const p=n.split("-");p.length&&fo(this.popperDOM,p.map(g=>`l7-popper-${g}`).join(" ")),qE(this.popperDOM,hV(t))}createPopper(){const{container:t,className:e="",content:i}=this.option,n=we("div",`l7-popper l7-popper-hide ${e}`),a=we("div","l7-popper-content"),o=we("div","l7-popper-arrow");return n.appendChild(a),n.appendChild(o),t.appendChild(n),this.popperDOM=n,this.contentDOM=a,i&&this.setContent(i),n}}E(w0,"conflictPopperList",[]);const R0=r=>{const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("l7-iconfont"),t.setAttribute("aria-hidden","true");const e=document.createElementNS("http://www.w3.org/2000/svg","use");return e.setAttributeNS("http://www.w3.org/1999/xlink","href",`#${r}`),t.appendChild(e),t};class vWt extends Eq{constructor(...t){var e;super(...t),e=this,E(this,"onClick",Z(function*(){const{onExport:i}=e.controlOption;i==null||i(yield e.getImage())})),E(this,"mergeImage",Z(function*(...i){var n,a;const{imageType:o}=e.controlOption,{width:s=0,height:l=0}=(n=(a=e.mapsService.getContainer())===null||a===void 0?void 0:a.getBoundingClientRect())!==null&&n!==void 0?n:{},u=document.createElement("canvas");u.width=s,u.height=l;const c=u.getContext("2d");return(yield Promise.all(i.map(f=>new Promise(d=>{const v=new Image;v.onload=()=>{d(v)},v.src=f})))).forEach(f=>{c==null||c.drawImage(f,0,0,s,l)}),u.toDataURL(`image/${o}`)}))}onAdd(){const t=super.onAdd();return t.addEventListener("click",this.onClick),t}getDefault(t){return G(G({},super.getDefault(t)),{},{title:"导出图片",btnIcon:R0("l7-icon-export-picture"),imageType:"png"})}getImage(){var t=this;return Z(function*(){const e=yield t.mapsService.exportMap("png"),i=yield t.scene.exportPng("png");return t.mergeImage(...[e,i].filter(n=>n))})()}}const eR=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],Jo=(()=>{if(typeof document>"u")return!1;const r=eR[0],t={};for(const e of eR)if((e==null?void 0:e[1])in document){for(const[n,a]of e.entries())t[r[n]]=a;return t}return!1})(),rR={change:Jo.fullscreenchange,error:Jo.fullscreenerror};let zn={request(r=document.documentElement,t){return new Promise((e,i)=>{const n=()=>{zn.off("change",n),e()};zn.on("change",n);const a=r[Jo.requestFullscreen](t);a instanceof Promise&&a.then(n).catch(i)})},exit(){return new Promise((r,t)=>{if(!zn.isFullscreen){r();return}const e=()=>{zn.off("change",e),r()};zn.on("change",e);const i=document[Jo.exitFullscreen]();i instanceof Promise&&i.then(e).catch(t)})},toggle(r,t){return zn.isFullscreen?zn.exit():zn.request(r,t)},onchange(r){zn.on("change",r)},onerror(r){zn.on("error",r)},on(r,t){const e=rR[r];e&&document.addEventListener(e,t,!1)},off(r,t){const e=rR[r];e&&document.removeEventListener(e,t,!1)},raw:Jo};Object.defineProperties(zn,{isFullscreen:{get:()=>!!document[Jo.fullscreenElement]},element:{enumerable:!0,get:()=>{var r;return(r=document[Jo.fullscreenElement])!==null&&r!==void 0?r:void 0}},isEnabled:{enumerable:!0,get:()=>!!document[Jo.fullscreenEnabled]}});Jo||(zn={isEnabled:!1});class Sq extends ns{getDefault(){return{position:qc.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}onAdd(){const t=we("div","l7-control-logo");return this.setLogoContent(t),t}onRemove(){return null}setOptions(t){super.setOptions(t),this.checkUpdateOption(t,["img","href"])&&(mv(this.container),this.setLogoContent(this.container))}setLogoContent(t){const{href:e,img:i}=this.controlOption,n=we("img");if(n.setAttribute("src",i),n.setAttribute("aria-label","AntV logo"),dV(n),e){const a=we("a","l7-control-logo-link");a.target="_blank",a.href=e,a.rel="noopener nofollow",a.setAttribute("rel","noopener nofollow"),a.appendChild(n),t.appendChild(a)}else t.appendChild(n)}}let Aq=class extends ns{constructor(...t){super(...t),E(this,"mScale",void 0),E(this,"iScale",void 0),E(this,"update",()=>{const e=this.mapsService,{maxWidth:i}=this.controlOption,n=e.getSize()[1]/2,a=e.containerToLngLat([0,n]),o=e.containerToLngLat([i,n]),s=SV([a.lng,a.lat],[o.lng,o.lat]);this.updateScales(s)})}getDefault(t){return G(G({},super.getDefault(t)),{},{name:"scale",position:qc.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}onAdd(){const e=we("div","l7-control-scale");this.resetScaleLines(e);const{updateWhenIdle:i}=this.controlOption;return this.mapsService.on(i?"moveend":"mapmove",this.update),this.mapsService.on(i?"zoomend":"zoomchange",this.update),e}onRemove(){const{updateWhenIdle:t}=this.controlOption;this.mapsService.off(t?"zoomend":"zoomchange",this.update),this.mapsService.off(t?"moveend":"mapmove",this.update)}setOptions(t){super.setOptions(t),this.checkUpdateOption(t,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}updateScales(t){const{metric:e,imperial:i}=this.controlOption;e&&t&&this.updateMetric(t),i&&t&&this.updateImperial(t)}resetScaleLines(t){mv(t);const{metric:e,imperial:i,maxWidth:n,lockWidth:a}=this.controlOption;a&&qE(t,`width: ${n}px`),e&&(this.mScale=we("div","l7-control-scale-line",t)),i&&(this.iScale=we("div","l7-control-scale-line",t)),this.update()}updateScale(t,e,i){const{maxWidth:n}=this.controlOption;t.style.width=Math.round(n*i)+"px",t.innerHTML=e}getRoundNum(t){const e=Math.pow(10,(Math.floor(t)+"").length-1);let i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1,e*i}updateMetric(t){const e=this.getRoundNum(t),i=e<1e3?e+" m":e/1e3+" km";this.updateScale(this.mScale,i,e/t)}updateImperial(t){const e=t*3.2808399;let i,n,a;e>5280?(i=e/5280,n=this.getRoundNum(i),this.updateScale(this.iScale,n+" mi",n/i)):(a=this.getRoundNum(e),this.updateScale(this.iScale,a+" ft",a/e))}};class Tq{constructor(){E(this,"mapService",void 0),E(this,"fontService",void 0)}apply(t,{styleAttributeService:e,mapService:i,fontService:n}){var a=this;this.mapService=i,this.fontService=n,t.hooks.init.tapPromise("DataMappingPlugin",Z(function*(){t.log(Mr.MappingStart,jr.INIT),a.generateMaping(t,{styleAttributeService:e}),t.log(Mr.MappingEnd,jr.INIT)})),t.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var o=Z(function*(s){if(!s)return s;t.dataState.dataMappingNeedUpdate=!1,t.log(Mr.MappingStart,jr.UPDATE);const l=a.generateMaping(t,{styleAttributeService:e});return t.log(Mr.MappingEnd,jr.UPDATE),l});return function(s){return o.apply(this,arguments)}}()),t.hooks.beforeRender.tap("DataMappingPlugin",()=>{const o=t.getSource();if(t.layerModelNeedUpdate||!o||!o.inited)return;const s=e.getLayerStyleAttributes()||[],l=e.getLayerStyleAttribute("filter"),{dataArray:u}=o.data;if(Array.isArray(u)&&u.length===0)return;const c=s.filter(f=>f.needRemapping);let h=u;if(l!=null&&l.needRemapping&&l!==null&&l!==void 0&&l.scale&&(h=u.filter(f=>this.applyAttributeMapping(l,f)[0])),c.length){const f=this.mapping(t,c,h,t.getEncodedData());t.setEncodedData(f)}})}generateMaping(t,{styleAttributeService:e}){const i=e.getLayerStyleAttributes()||[],n=e.getLayerStyleAttribute("filter"),{dataArray:a}=t.getSource().data;let o=a;n!=null&&n.scale&&(o=a.filter(l=>this.applyAttributeMapping(n,l)[0])),o=t.processData(o);const s=this.mapping(t,i,o,void 0);return t.setEncodedData(s),t.emit("dataUpdate",null),!0}mapping(t,e,i,n){const a=e.filter(s=>s.scale!==void 0).filter(s=>s.name!=="filter"),o=i.map((s,l)=>{const u=n?n[l]:{},c=G({id:s._id,coordinates:s.coordinates},u);return a.forEach(h=>{let f=this.applyAttributeMapping(h,s);(h.name==="color"||h.name==="stroke")&&(f=f.map(d=>Pe(d))),c[h.name]=Array.isArray(f)&&f.length===1?f[0]:f,h.name==="shape"&&(c.shape=this.fontService.getIconFontKey(c[h.name]))}),c});return e.forEach(s=>{s.needRemapping=!1}),this.adjustData2SimpleCoordinates(o),o}adjustData2SimpleCoordinates(t){t.length>0&&this.mapService.version==="SIMPLE"&&t.map(e=>{e.simpleCoordinate||(e.coordinates=this.unProjectCoordinates(e.coordinates),e.simpleCoordinate=!0)})}unProjectCoordinates(t){if(typeof t[0]=="number")return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){const e=[];return t.map(i=>{const n=[];i.map(a=>{n.push(this.mapService.simpleMapCoord.unproject(a))}),e.push(n)}),e}else{const e=[];return t.map(i=>{e.push(this.mapService.simpleMapCoord.unproject(i))}),e}}applyAttributeMapping(t,e){var i;if(!t.scale)return[];const n=(t==null||(i=t.scale)===null||i===void 0?void 0:i.scalers)||[],a=[];return n.forEach(({field:s})=>{var l;(e.hasOwnProperty(s)||((l=t.scale)===null||l===void 0?void 0:l.type)==="variable")&&a.push(e[s])}),t.mapping?t.mapping(a):[]}getArrowPoints(t,e){const i=[e[0]-t[0],e[1]-t[1]],n=AV(i);return[t[0]+n[0]*1e-4,t[1]+n[1]*1e-4]}}class bq{constructor(){E(this,"mapService",void 0)}apply(t){var e=this;this.mapService=t.getContainer().mapService,t.hooks.init.tapPromise("DataSourcePlugin",Z(function*(){t.log(Mr.SourceInitStart,jr.INIT);let i=t.getSource();if(!i){const{data:n,options:a}=t.sourceOption||t.defaultSourceConfig;i=new Wm(n,a),t.setSource(i)}i.inited?(e.updateClusterData(t),t.log(Mr.SourceInitEnd,jr.INIT)):yield new Promise(n=>{i.on("update",a=>{a.type==="inited"&&(e.updateClusterData(t),t.log(Mr.SourceInitEnd,jr.INIT)),n(null)})})})),t.hooks.beforeRenderData.tapPromise("DataSourcePlugin",Z(function*(){const i=e.updateClusterData(t),n=t.dataState.dataSourceNeedUpdate;return t.dataState.dataSourceNeedUpdate=!1,i||n}))}updateClusterData(t){if(t.isTileLayer||t.tileLayer||!t.getSource())return!1;const e=t.getSource(),i=e.cluster,{zoom:n=0}=e.clusterOptions,a=this.mapService.getZoom()-1,o=t.dataState.dataSourceNeedUpdate;return i&&o&&e.updateClusterData(Math.floor(a)),i&&Math.abs(t.clusterZoom-a)>=1?(n!==Math.floor(a)&&e.updateClusterData(Math.floor(a)),t.clusterZoom=a,!0):!1}}function wq(r,t,e,i,n){var a=r*r,o=a*r;return((1-3*r+3*a-o)*t+(4-6*a+3*o)*e+(1+3*r+3*a-3*o)*i+o*n)/6}function Rq(r){var t=r.length-1;return function(e){var i=e<=0?e=0:e>=1?(e=1,t-1):Math.floor(e*t),n=r[i],a=r[i+1],o=i>0?r[i-1]:2*n-a,s=i<t-1?r[i+2]:2*a-n;return wq((e-i/t)*t,o,n,a,s)}}function KB(r){return function(){return r}}function Mq(r,t){return function(e){return r+e*t}}function Iq(r,t,e){return r=Math.pow(r,e),t=Math.pow(t,e)-r,e=1/e,function(i){return Math.pow(r+i*t,e)}}function Lq(r){return(r=+r)==1?QB:function(t,e){return e-t?Iq(t,e,r):KB(isNaN(t)?e:t)}}function QB(r,t){var e=t-r;return e?Mq(r,e):KB(isNaN(r)?t:r)}(function r(t){var e=Lq(t);function i(n,a){var o=e((n=J1(n)).r,(a=J1(a)).r),s=e(n.g,a.g),l=e(n.b,a.b),u=QB(n.opacity,a.opacity);return function(c){return n.r=o(c),n.g=s(c),n.b=l(c),n.opacity=u(c),n+""}}return i.gamma=r,i})(1);function Oq(r){return function(t){var e=t.length,i=new Array(e),n=new Array(e),a=new Array(e),o,s;for(o=0;o<e;++o)s=J1(t[o]),i[o]=s.r||0,n[o]=s.g||0,a[o]=s.b||0;return i=r(i),n=r(n),a=r(a),s.opacity=1,function(l){return s.r=i(l),s.g=n(l),s.b=a(l),s+""}}}var Pq=Oq(Rq);function JB(r){let t,e=[];function i(n){return n??t}return i.invert=i,i.domain=i.range=n=>n?(e=n,n):e,i.unknown=n=>n?(t=n,n):t,i.copy=()=>JB().unknown(t),i}const{isNil:I_,isString:Fq,uniq:Bq}=er,Dq=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,Nq={[Ae.LINEAR]:MW,[Ae.POWER]:IW,[Ae.LOG]:LW,[Ae.IDENTITY]:JB,[Ae.SEQUENTIAL]:OW,[Ae.TIME]:PW,[Ae.QUANTILE]:FW,[Ae.QUANTIZE]:BW,[Ae.THRESHOLD]:DW,[Ae.CAT]:Q1,[Ae.DIVERGING]:NW};class kq{constructor(){E(this,"scaleOptions",{})}apply(t,{styleAttributeService:e}){var i=this;t.hooks.init.tapPromise("FeatureScalePlugin",Z(function*(){var n;t.log(Mr.ScaleInitStart,jr.INIT),i.scaleOptions=t.getScaleOptions();const a=e.getLayerStyleAttributes(),o=(n=t.getSource())===null||n===void 0?void 0:n.data.dataArray;Array.isArray(o)&&o.length===0||(i.caculateScalesForAttributes(a||[],o),t.log(Mr.ScaleInitEnd,jr.INIT))})),t.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var n=Z(function*(a){if(!a)return a;t.log(Mr.ScaleInitStart,jr.UPDATE),i.scaleOptions=t.getScaleOptions();const o=e.getLayerStyleAttributes(),s=t.getSource().data.dataArray;return Array.isArray(s)&&s.length===0||(i.caculateScalesForAttributes(o||[],s),t.log(Mr.ScaleInitEnd,jr.UPDATE),t.layerModelNeedUpdate=!0),!0});return function(a){return n.apply(this,arguments)}}()),t.hooks.beforeRender.tap("FeatureScalePlugin",()=>{if(t.layerModelNeedUpdate)return;this.scaleOptions=t.getScaleOptions();const n=e.getLayerStyleAttributes(),a=t.getSource().data.dataArray;if(!(Array.isArray(a)&&a.length===0)&&n){const o=n.filter(s=>s.needRescale);o.length&&this.caculateScalesForAttributes(o,a)}})}isNumber(t){return!isNaN(parseFloat(t))&&isFinite(t)}caculateScalesForAttributes(t,e){t.forEach(i=>{if(i.scale){const n=i.scale,a=i.scale.field;n.names=this.parseFields(I_(a)?[]:a);const o=[];n.names.forEach(s=>{var l;o.push(this.createScale(s,i.name,(l=i.scale)===null||l===void 0?void 0:l.values,e))}),o.some(s=>s.type===Qu.VARIABLE)?(n.type=Qu.VARIABLE,o.forEach(s=>{if(!n.callback&&n.values!=="text"){var l;switch((l=s.option)===null||l===void 0?void 0:l.type){case Ae.LOG:case Ae.LINEAR:case Ae.POWER:if(n.values&&n.values.length>2){const c=s.scale.ticks(n.values.length);s.scale.domain(c)}n.values?s.scale.range(n.values):s.scale.range(s.option.domain);break;case Ae.QUANTILE:case Ae.QUANTIZE:case Ae.THRESHOLD:s.scale.range(n.values);break;case Ae.IDENTITY:break;case Ae.CAT:n.values?s.scale.range(n.values):s.scale.range(s.option.domain);break;case Ae.DIVERGING:case Ae.SEQUENTIAL:s.scale.interpolator(Pq(n.values));break}}if(n.values==="text"){var u;s.scale.range((u=s.option)===null||u===void 0?void 0:u.domain)}})):(n.type=Qu.CONSTANT,n.defaultValues=o.map((s,l)=>s.scale(n.names[l]))),n.scalers=o.map(s=>({field:s.field,func:s.scale,option:s.option})),i.needRescale=!1}})}parseFields(t){return Array.isArray(t)?t:Fq(t)?t.split("*"):[t]}createScale(t,e,i,n){var a,o;const s=this.scaleOptions[e]&&((a=this.scaleOptions[e])===null||a===void 0?void 0:a.field)===t?this.scaleOptions[e]:this.scaleOptions[t],l={field:t,scale:void 0,type:Qu.VARIABLE,option:s};if(!n||!n.length)return s&&s.type?l.scale=this.createDefaultScale(s):(l.scale=Q1([t]),l.type=Qu.CONSTANT),l;const u=(o=n.find(c=>!I_(c[t])))===null||o===void 0?void 0:o[t];if(this.isNumber(t)||I_(u)&&!s)l.scale=Q1([t]),l.type=Qu.CONSTANT;else{let c=s&&s.type||this.getDefaultType(u);i==="text"&&(c=Ae.CAT),i===void 0&&(c=Ae.IDENTITY);const h=this.createScaleConfig(c,t,s,n);l.scale=this.createDefaultScale(h),l.option=h}return l}getDefaultType(t){let e=Ae.LINEAR;return typeof t=="string"&&(e=Dq.test(t)?Ae.TIME:Ae.CAT),e}createScaleConfig(t,e,i,n){const a=G(G({},i),{},{type:t});if(a!=null&&a.domain)return a;let o=[];if(t===Ae.QUANTILE){const s=new Map;n==null||n.forEach(l=>{s.set(l._id,l[e])}),o=Array.from(s.values())}else o=(n==null?void 0:n.map(s=>s[e]))||[];if(t===Ae.CAT||t===Ae.IDENTITY)a.domain=Bq(o);else if(t===Ae.QUANTILE)a.domain=o;else if(t===Ae.DIVERGING){const s=T2(o),l=(i==null?void 0:i.neutral)!==void 0?i==null?void 0:i.neutral:(s[0]+s[1])/2;a.domain=[s[0],l,s[1]]}else a.domain=T2(o);return a}createDefaultScale({type:t,domain:e,unknown:i,clamp:n,nice:a}){const o=Nq[t]();return e&&o.domain&&o.domain(e),i&&o.unknown(i),n!==void 0&&o.clamp&&o.clamp(n),a!==void 0&&o.nice&&o.nice(a),o}}class Uq{apply(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",()=>{t.animateStatus&&t.models.forEach(i=>{i.addUniforms(G({},t.layerModel.getAnimateUniforms()))})})}}let zq=class{apply(t){t.hooks.afterInit.tap("LayerMaskPlugin",()=>{const{maskLayers:e,enableMask:i}=t.getLayerConfig();!t.tileLayer&&e&&e.length>0&&t.updateLayerConfig({mask:i})})}};class Hq{build(t){return Z(function*(){t.prepareBuildModel(),yield t.buildModels()})()}initLayerModel(t){var e=this;return Z(function*(){yield e.build(t),t.styleNeedUpdate=!1})()}prepareLayerModel(t){var e=this;return Z(function*(){yield e.build(t),t.styleNeedUpdate=!1})()}apply(t){var e=this;t.hooks.init.tapPromise("LayerModelPlugin",Z(function*(){if(t.getSource().isTile){t.prepareBuildModel();return}t.log(Mr.BuildModelStart,jr.INIT),yield e.initLayerModel(t),t.log(Mr.BuildModelEnd,jr.INIT)})),t.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var i=Z(function*(n){return!n||t.getSource().isTile?!1:(t.log(Mr.BuildModelStart,jr.UPDATE),yield e.prepareLayerModel(t),t.log(Mr.BuildModelEnd,jr.UPDATE),!0)});return function(n){return i.apply(this,arguments)}}())}}class $q{apply(t){t.hooks.afterInit.tap("LayerStylePlugin",()=>{const{autoFit:e,fitBoundsOptions:i}=t.getLayerConfig();e&&t.fitBounds(i),t.styleNeedUpdate=!1})}}const Wq=["type"],iR={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},Vq={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},Gq={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},Xq={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function Yq(r){const t={u_DirectionalLights:new Array(3).fill(G({},Gq)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(G({},Xq)),u_NumOfSpotLights:0};return(!r||!r.length)&&(r=[Vq]),r.forEach(e=>{let{type:i="directional"}=e,n=An(e,Wq);const a=iR[i].lights,o=iR[i].num,s=t[o];t[a][s]=G(G({},t[a][s]),n),t[o]++}),t}class jq{apply(t){t.hooks.beforeRender.tap("LightingPlugin",()=>{const{enableLighting:e}=t.getLayerConfig();e&&t.models.forEach(i=>i.addUniforms(G({},Yq())))})}}function tD(r){return r.map(t=>(typeof t=="string"&&(t=[t,{}]),t))}function eD(r,t,e,i){const n=r.multiPassRenderer;return n.add(i("render")),tD(t).forEach(a=>{const[o,s]=a;n.add(e(o),s)}),n.add(e("copy")),n}class Zq{constructor(){E(this,"enabled",void 0)}apply(t,{rendererService:e,postProcessingPassFactory:i,normalPassFactory:n}){t.hooks.init.tapPromise("MultiPassRendererPlugin",()=>{const{enableMultiPassRenderer:a,passes:o=[]}=t.getLayerConfig();this.enabled=!!a&&t.getLayerConfig().enableMultiPassRenderer!==!1,this.enabled&&(t.multiPassRenderer=eD(t,o,i,n),t.multiPassRenderer.setRenderFlag(!0))}),t.hooks.beforeRender.tap("MultiPassRendererPlugin",()=>{if(this.enabled){const{width:a,height:o}=e.getViewportSize();t.multiPassRenderer.resize(a,o)}})}}const Ns={POSITION:0,POSITION_64LOW:1,COLOR:2,PICKING_COLOR:3,STROKE:4,OPACITY:5,OFFSETS:6,ROTATION:7,MAX:8};function qq(r){switch(r){case"rotation":return{name:"Rotation",type:pt.Attribute,descriptor:{name:"a_Rotation",shaderLocation:Ns.ROTATION,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:1,update:t=>{const{rotation:e=0}=t;return Array.isArray(e)?[e[0]]:[e]}}};case"stroke":return{name:"stroke",type:pt.Attribute,descriptor:{name:"a_Stroke",shaderLocation:Ns.STROKE,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:4,update:t=>{const{stroke:e=[1,1,1,1]}=t;return e}}};case"opacity":return{name:"opacity",type:pt.Attribute,descriptor:{name:"a_Opacity",shaderLocation:Ns.OPACITY,buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:1,update:t=>{const{opacity:e=1}=t;return[e]}}};case"offsets":return{name:"offsets",type:pt.Attribute,descriptor:{name:"a_Offsets",shaderLocation:Ns.OFFSETS,buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:2,update:t=>{const{offsets:e}=t;return e}}};default:return}}const{isNumber:Kq}=er,Ju={NONE:0,ENCODE:1,HIGHLIGHT:2};class Qq{constructor(){E(this,"pickingUniformMap",void 0)}pickOption2Array(){const t=[];return this.pickingUniformMap.forEach(e=>{Kq(e)?t.push(e):t.push(...e)}),t}updatePickOption(t,e){Object.keys(t).forEach(o=>{this.pickingUniformMap.set(o,t[o])});const i=e.getLayerConfig().pickingBuffer||0,n=Number(e.getShaderPickStat());this.pickingUniformMap.set("u_PickingBuffer",i),this.pickingUniformMap.set("u_shaderPick",n),e.getPickingUniformBuffer().subData({offset:0,data:this.pickOption2Array()})}apply(t,{styleAttributeService:e}){this.pickingUniformMap=new Map([["u_HighlightColor",[1,0,0,1]],["u_SelectColor",[1,0,0,1]],["u_PickingColor",[0,0,0]],["u_PickingStage",0],["u_CurrentSelectedId",[0,0,0]],["u_PickingThreshold",10],["u_PickingBuffer",0],["u_shaderPick",0],["u_activeMix",0]]),t.hooks.init.tapPromise("PixelPickingPlugin",()=>{const{enablePicking:i}=t.getLayerConfig();e.registerStyleAttribute({name:"pickingColor",type:pt.Attribute,descriptor:{name:"a_PickingColor",shaderLocation:Ns.PICKING_COLOR,buffer:{data:[],type:w.FLOAT},size:3,update:n=>{const{id:a}=n;return i?jc(a):[0,0,0]}}})}),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",()=>{const{enablePicking:i}=t.getLayerConfig();i&&t.isVisible()&&(this.updatePickOption({u_PickingStage:Ju.ENCODE},t),t.models.forEach(n=>n.addUniforms({u_PickingStage:Ju.ENCODE})))}),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",()=>{const{enablePicking:i}=t.getLayerConfig();i&&t.isVisible()&&(this.updatePickOption({u_PickingStage:Ju.HIGHLIGHT},t),t.models.forEach(n=>n.addUniforms({u_PickingStage:Ju.HIGHLIGHT})))}),t.hooks.beforeHighlight.tap("PixelPickingPlugin",i=>{const{highlightColor:n,activeMix:a=0}=t.getLayerConfig(),o=typeof n=="string"?Pe(n):n||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Kl(new Uint8Array(i))});const s={u_PickingStage:Ju.HIGHLIGHT,u_PickingColor:i,u_HighlightColor:o.map(l=>l*255),u_activeMix:a};this.updatePickOption(s,t),t.models.forEach(l=>l.addUniforms(s))}),t.hooks.beforeSelect.tap("PixelPickingPlugin",i=>{const{selectColor:n,selectMix:a=0}=t.getLayerConfig(),o=typeof n=="string"?Pe(n):n||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Kl(new Uint8Array(i))});const s={u_PickingStage:Ju.HIGHLIGHT,u_PickingColor:i,u_HighlightColor:o.map(l=>l*255),u_activeMix:a,u_CurrentSelectedId:i,u_SelectColor:o.map(l=>l*255)};this.updatePickOption(s,t),t.models.forEach(l=>l.addUniforms(s))})}}const Jq=["mvt","geojsonvt","testTile"];function tK(r){const t=r.getSource();return Jq.includes(t.parser.type)}class eK{apply(t,{styleAttributeService:e}){t.hooks.init.tapPromise("RegisterStyleAttributePlugin",()=>{tK(t)||this.registerBuiltinAttributes(e,t)})}registerBuiltinAttributes(t,e){if(e.type==="MaskLayer"){this.registerPositionAttribute(t);return}this.registerPositionAttribute(t),this.registerColorAttribute(t)}registerPositionAttribute(t){t.registerStyleAttribute({name:"position",type:pt.Attribute,descriptor:{name:"a_Position",shaderLocation:Ns.POSITION,buffer:{data:[],type:w.FLOAT},size:3,update:(e,i,n)=>n.length===2?[n[0],n[1],0]:[n[0],n[1],n[2]]}})}registerColorAttribute(t){t.registerStyleAttribute({name:"color",type:pt.Attribute,descriptor:{name:"a_Color",shaderLocation:Ns.COLOR,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:4,update:e=>{const{color:i}=e;return!i||!i.length?[1,1,1,1]:i}}})}}class rK{constructor(){E(this,"cameraService",void 0),E(this,"coordinateSystemService",void 0),E(this,"rendererService",void 0),E(this,"mapService",void 0),E(this,"layerService",void 0)}apply(t,{rendererService:e,mapService:i,layerService:n,coordinateSystemService:a,cameraService:o}){this.rendererService=e,this.mapService=i,this.layerService=n,this.coordinateSystemService=a,this.cameraService=o;let s;this.rendererService.uniformBuffers[0]||(s=this.rendererService.createBuffer({data:new Float32Array(96),isUBO:!0,label:"renderUniformBuffer"}),this.rendererService.uniformBuffers[0]=s),t.hooks.beforeRender.tap("ShaderUniformPlugin",()=>{const u=t.getRelativeOrigin&&t.getRelativeOrigin()||[0,0];this.coordinateSystemService.refresh(),u&&(Math.abs(u[0])>1e-4||Math.abs(u[1])>1e-4)&&this.coordinateSystemService.getCoordinateSystem()===2&&this.coordinateSystemService.setViewportCenter(u);const{width:h,height:f}=this.rendererService.getViewportSize(),{data:d,uniforms:v}=this.generateUBO(h,f,u);this.layerService.alreadyInRendering&&this.rendererService.uniformBuffers[0]&&this.rendererService.uniformBuffers[0].subData({offset:0,data:d}),this.rendererService.queryVerdorInfo()==="WebGL1"&&t.models.forEach(g=>{g.addUniforms(G(G({},v),{},{u_PickingBuffer:t.getLayerConfig().pickingBuffer||0,u_shaderPick:Number(t.getShaderPickStat())}))})})}generateUBO(t,e,i){const n=this.cameraService.getProjectionMatrix(),a=this.cameraService.getViewMatrix(),o=this.cameraService.getViewProjectionMatrix(),s=this.cameraService.getModelMatrix(),l=this.coordinateSystemService.getViewportCenterProjection(),u=this.coordinateSystemService.getPixelsPerDegree(),c=this.cameraService.getZoom(),h=this.coordinateSystemService.getPixelsPerDegree2(),f=this.cameraService.getZoomScale(),d=this.coordinateSystemService.getPixelsPerMeter(),v=this.coordinateSystemService.getCoordinateSystem(),p=this.cameraService.getCameraPosition(),g=window.devicePixelRatio,m=this.coordinateSystemService.getViewportCenter(),y=[t,e],_=this.cameraService.getFocalDistance(),x=i&&i.length>=2?[i[0],i[1]]:[0,0];return{data:[...a,...n,...o,...s,...l,...u,c,...h,f,...d,v,...p,g,...m,...y,_,...x,0],uniforms:{[Al.ProjectionMatrix]:n,[Al.ViewMatrix]:a,[Al.ViewProjectionMatrix]:o,[Al.Zoom]:c,[Al.ZoomScale]:f,[Al.FocalDistance]:_,[Al.CameraPosition]:p,[Ku.CoordinateSystem]:v,[Ku.ViewportCenter]:m,[Ku.ViewportCenterProjection]:l,[Ku.PixelsPerDegree]:u,[Ku.PixelsPerDegree2]:h,[Ku.PixelsPerMeter]:d,u_ViewportSize:y,u_ModelMatrix:s,u_DevicePixelRatio:g,u_RelativeOrigin:x}}}}class iK{apply(t){t.hooks.beforeRender.tap("UpdateModelPlugin",()=>{t.layerModel&&t.layerModel.needUpdate().then(e=>{e&&t.renderLayers()})}),t.hooks.afterRender.tap("UpdateModelPlugin",()=>{t.layerModelNeedUpdate=!1})}}class nK{apply(t,{styleAttributeService:e}){t.hooks.init.tapPromise("UpdateStyleAttributePlugin",()=>{this.initStyleAttribute(t,{styleAttributeService:e})}),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",()=>{t.layerModelNeedUpdate||t.inited&&this.updateStyleAttribute(t,{styleAttributeService:e})})}updateStyleAttribute(t,{styleAttributeService:e}){const i=e.getLayerStyleAttributes()||[],n=e.getLayerStyleAttribute("filter");if(n&&n.needRegenerateVertices){t.layerModelNeedUpdate=!0,i.forEach(a=>a.needRegenerateVertices=!1);return}i.filter(a=>a.needRegenerateVertices).forEach(a=>{e.updateAttributeByFeatureRange(a.name,t.getEncodedData(),a.featureRange.startIndex,a.featureRange.endIndex,t),a.needRegenerateVertices=!1})}initStyleAttribute(t,{styleAttributeService:e}){(e.getLayerStyleAttributes()||[]).filter(n=>n.needRegenerateVertices).forEach(n=>{e.updateAttributeByFeatureRange(n.name,t.getEncodedData(),n.featureRange.startIndex,n.featureRange.endIndex),n.needRegenerateVertices=!1})}}function aK(){return[new bq,new eK,new kq,new Tq,new $q,new zq,new nK,new iK,new Zq,new rK,new Uq,new jq,new Qq,new Hq]}const rD={[Ms.additive]:{enable:!0,func:{srcRGB:w.ONE,dstRGB:w.ONE,srcAlpha:1,dstAlpha:1}},[Ms.none]:{enable:!1},[Ms.normal]:{enable:!0,func:{srcRGB:w.SRC_ALPHA,dstRGB:w.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}},[Ms.subtractive]:{enable:!0,func:{srcRGB:w.ONE,dstRGB:w.ONE,srcAlpha:w.ZERO,dstAlpha:w.ONE_MINUS_SRC_COLOR},equation:{rgb:w.FUNC_SUBTRACT,alpha:w.FUNC_SUBTRACT}},[Ms.max]:{enable:!0,func:{srcRGB:w.ONE,dstRGB:w.ONE},equation:{rgb:w.MAX_EXT}},[Ms.min]:{enable:!0,func:{srcRGB:w.ONE,dstRGB:w.ONE},equation:{rgb:w.MIN_EXT}}};class oK{constructor(t){E(this,"layer",void 0),this.layer=t}pickRender(t){const i=this.layer.getContainer().layerService,n=this.layer;if(n.tileLayer)return n.tileLayer.pickRender(t);n.hooks.beforePickingEncode.call(),i.renderTileLayerMask(n),n.renderModels({ispick:!0}),n.hooks.afterPickingEncode.call()}pick(t,e){var i=this;return Z(function*(){const a=i.layer.getContainer().pickingService;return t.type==="RasterLayer"?i.pickRasterLayer(t,e):(i.pickRender(e),a.pickFromPickingFBO(t,e))})()}pickRasterLayer(t,e,i){const n=this.layer.getContainer(),a=n.pickingService,o=n.mapService,s=this.layer.getSource().extent,l=yV(e.lngLat,s),u={x:e.x,y:e.y,type:e.type,lngLat:e.lngLat,target:e,rasterValue:null},c=i||t;if(l){const h=this.readRasterValue(t,s,o,e.x,e.y);return u.rasterValue=h,a.triggerHoverOnLayer(c,u),!0}else return u.type=e.type==="mousemove"?"mouseout":"un"+e.type,a.triggerHoverOnLayer(c,G(G({},u),{},{type:"unpick"})),a.triggerHoverOnLayer(c,u),!1}readRasterValue(t,e,i,n,a){const o=t.getSource().data.dataArray[0],[s=0,l=0,u=10,c=-10]=e,h=i.lngLatToContainer([s,l]),f=i.lngLatToContainer([u,c]),d=f.x-h.x,v=h.y-f.y,p=[(n-h.x)/d,(a-f.y)/v],g=o.width||1,m=o.height||1,y=Math.floor(p[0]*g),_=Math.floor(p[1]*m),x=Math.max(0,_-1)*g+y;return o.data[x]}selectFeature(t){const e=this.layer,[i,n,a]=t;e.hooks.beforeSelect.call([i,n,a])}highlightPickedFeature(t){const[e,i,n]=t;this.layer.hooks.beforeHighlight.call([e,i,n])}getFeatureById(t){return this.layer.getSource().getFeatureById(t)}}class sK{constructor(t){E(this,"layer",void 0),E(this,"rendererService",void 0),E(this,"colorTexture",void 0),E(this,"key",void 0),this.layer=t;const e=this.layer.getContainer();this.rendererService=e.rendererService}getColorTexture(t,e){const i=this.getTextureKey(t,e);return this.key===i?this.colorTexture:(this.createColorTexture(t,e),this.key=i,this.colorTexture)}createColorTexture(t,e){const{createTexture2D:i}=this.rendererService,n=this.getColorRampBar(t,e),a=i({data:new Uint8Array(n.data),width:n.width,height:n.height,flipY:!1,unorm:!0});return this.colorTexture=a,a}setColorTexture(t,e,i){this.key=this.getTextureKey(e,i),this.colorTexture=t}destroy(){var t;(t=this.colorTexture)===null||t===void 0||t.destroy()}getColorRampBar(t,e){switch(t.type){case"cat":return nV(t);case"quantize":return aV(t);case"custom":return oV(t,e);case"linear":return iV(t,e);default:return nB(t)}}getTextureKey(t,e){var i;return`${t.colors.join("_")}_${t==null||(i=t.positions)===null||i===void 0?void 0:i.join("_")}_${t.type}_${e==null?void 0:e.join("_")}`}}const lK=["passes"],uK=["moduleName","vertexShader","fragmentShader","defines","inject","triangulation","styleOption","pickingEnabled"],{isEqual:L_,isFunction:nR,isNumber:aR,isObject:Gr,isPlainObject:cK,isUndefined:hK}=er;let oR=0;class Fu extends Li.EventEmitter{get shaderModuleService(){return this.container.shaderModuleService}get cameraService(){return this.container.cameraService}get coordinateService(){return this.container.coordinateSystemService}get iconService(){return this.container.iconService}get fontService(){return this.container.fontService}get pickingService(){return this.container.pickingService}get rendererService(){return this.container.rendererService}get layerService(){return this.container.layerService}get debugService(){return this.container.debugService}get interactionService(){return this.container.interactionService}get mapService(){var t;return(t=this.container)===null||t===void 0?void 0:t.mapService}get normalPassFactory(){return this.container.normalPassFactory}constructor(t={}){super(),E(this,"id",`${oR++}`),E(this,"name",`${oR}`),E(this,"parent",void 0),E(this,"coordCenter",void 0),E(this,"type",void 0),E(this,"visible",!0),E(this,"zIndex",0),E(this,"minZoom",void 0),E(this,"maxZoom",void 0),E(this,"inited",!1),E(this,"layerModelNeedUpdate",!1),E(this,"pickedFeatureID",null),E(this,"selectedFeatureID",null),E(this,"styleNeedUpdate",!1),E(this,"rendering",void 0),E(this,"forceRender",!1),E(this,"clusterZoom",0),E(this,"layerType",void 0),E(this,"triangulation",void 0),E(this,"layerPickService",void 0),E(this,"textureService",void 0),E(this,"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),E(this,"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),E(this,"hooks",{init:new RY,afterInit:new mw,beforeRender:new mw,beforeRenderData:new MY,afterRender:new ja,beforePickingEncode:new ja,afterPickingEncode:new ja,beforeHighlight:new ja(["pickedColor"]),afterHighlight:new ja,beforeSelect:new ja(["pickedColor"]),afterSelect:new ja,beforeDestroy:new ja,afterDestroy:new ja}),E(this,"models",[]),E(this,"multiPassRenderer",void 0),E(this,"plugins",void 0),E(this,"startInit",!1),E(this,"sourceOption",void 0),E(this,"layerModel",void 0),E(this,"shapeOption",void 0),E(this,"tileLayer",void 0),E(this,"layerChildren",[]),E(this,"masks",[]),E(this,"configService",DB),E(this,"styleAttributeService",void 0),E(this,"layerSource",void 0),E(this,"postProcessingPassFactory",void 0),E(this,"animateOptions",{enable:!1}),E(this,"relativeOrigin",[0,0]),E(this,"originalExtent",[0,0,0,0]),E(this,"absoluteDataArray",[]),E(this,"container",void 0),E(this,"encodedData",void 0),E(this,"currentPickId",null),E(this,"rawConfig",void 0),E(this,"needUpdateConfig",void 0),E(this,"encodeStyleAttribute",{}),E(this,"enableShaderEncodeStyles",[]),E(this,"enableDataEncodeStyles",[]),E(this,"pendingStyleAttributes",[]),E(this,"scaleOptions",{}),E(this,"animateStartTime",void 0),E(this,"animateStatus",!1),E(this,"isDestroyed",!1),E(this,"uniformBuffers",[]),E(this,"encodeDataLength",0),E(this,"sourceEvent",()=>{this.dataState.dataSourceNeedUpdate=!0,this.processRelativeCoordinates();const e=this.getLayerConfig();e&&e.autoFit&&this.fitBounds(e.fitBoundsOptions),this.layerSource.getSourceCfg().autoRender&&setTimeout(()=>{this.reRender()},10)}),this.name=t.name||this.id,this.zIndex=t.zIndex||0,this.rawConfig=t,this.masks=t.maskLayers||[]}addMask(t){this.masks.push(t),this.updateLayerConfig({maskLayers:this.masks}),this.enableMask()}removeMask(t){const e=this.masks.indexOf(t);e>-1&&this.masks.splice(e,1),this.updateLayerConfig({maskLayers:this.masks})}disableMask(){this.updateLayerConfig({enableMask:!1})}enableMask(){this.updateLayerConfig({enableMask:!0})}addMaskLayer(t){this.masks.push(t)}removeMaskLayer(t){const e=this.masks.indexOf(t);e>-1&&this.masks.splice(e,1),t.destroy()}getAttribute(t){return this.styleAttributeService.getLayerStyleAttribute(t)}getLayerConfig(){return this.configService.getLayerConfig(this.id)}updateLayerConfig(t){if(Object.keys(t).map(e=>{e in this.rawConfig&&(this.rawConfig[e]=t[e])}),!this.startInit)this.needUpdateConfig=G(G({},this.needUpdateConfig),t);else{const e=this.container.id;this.configService.setLayerConfig(e,this.id,G(G(G({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),t)),this.needUpdateConfig={}}}setContainer(t){this.container=t}getContainer(){return this.container}addPlugin(t){return this.plugins.push(t),this}init(){var t=this;return Z(function*(){const e=t.container.id;t.startInit=!0,t.configService.setLayerConfig(e,t.id,t.rawConfig),t.layerType=t.rawConfig.layerType;const{enableMultiPassRenderer:i,passes:n}=t.getLayerConfig();i&&n!==null&&n!==void 0&&n.length&&n.length>0&&t.mapService.on("mapAfterFrameChange",()=>{t.renderLayers()}),t.postProcessingPassFactory=t.container.postProcessingPassFactory,t.styleAttributeService=t.container.styleAttributeService,i&&(t.multiPassRenderer=t.container.multiPassRenderer,t.multiPassRenderer.setLayer(t)),t.pendingStyleAttributes.forEach(({attributeName:a,attributeField:o,attributeValues:s,updateOptions:l})=>{t.styleAttributeService.updateStyleAttribute(a,{scale:G({field:o},t.splitValuesAndCallbackInAttribute(s,o?void 0:t.getLayerConfig()[a]))},l)}),t.pendingStyleAttributes=[],t.plugins=aK();for(const a of t.plugins)a.apply(t,t.container);t.layerPickService=new oK(t),t.textureService=new sK(t),t.log(Mr.LayerInitStart),yield t.hooks.init.promise(),t.log(Mr.LayerInitEnd),t.inited=!0,t.emit("inited",{target:t,type:"inited"}),t.emit("add",{target:t,type:"add"}),t.hooks.afterInit.call()})()}log(t,e="init"){var i;if(this.tileLayer||this.isTileLayer)return;const n=`${this.id}.${e}.${t}`,a={id:this.id,type:this.type};(i=this.debugService)===null||i===void 0||i.log(n,a)}updateModelData(t){t.attributes&&t.elements?this.models.map(e=>{e.updateAttributesAndElements(t.attributes,t.elements)}):console.warn("data error")}setLayerPickService(t){this.layerPickService=t}prepareBuildModel(){Object.keys(this.needUpdateConfig||{}).length!==0&&this.updateLayerConfig({});const{animateOption:t}=this.getLayerConfig();t!=null&&t.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}color(t,e,i){return this.updateStyleAttribute("color",t,e,i),this}texture(t,e,i){return this.updateStyleAttribute("texture",t,e,i),this}rotate(t,e,i){return this.updateStyleAttribute("rotate",t,e,i),this}size(t,e,i){return this.updateStyleAttribute("size",t,e,i),this}filter(t,e,i){const n=this.updateStyleAttribute("filter",t,e,i);return this.dataState.dataSourceNeedUpdate=n&&this.inited,this}shape(t,e,i){this.shapeOption={field:t,values:e};const n=this.updateStyleAttribute("shape",t,e,i);return this.dataState.dataSourceNeedUpdate=n&&this.inited,this}label(t,e,i){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:t,attributeValues:e,updateOptions:i}),this}animate(t){let e={};return Gr(t)?(e.enable=!0,e=G(G({},e),t)):e.enable=t,this.updateLayerConfig({animateOption:e}),this}source(t,e){return(t==null?void 0:t.type)==="source"?(this.setSource(t),this):(this.sourceOption={data:t,options:e},this.clusterZoom=0,this)}setData(t,e){return this.inited?(this.dataUpdatelog(),this.layerSource.setData(t,e)):this.on("inited",()=>{this.dataUpdatelog(),this.layerSource.setData(t,e)}),this}dataUpdatelog(){this.log(Mr.SourceInitStart,jr.UPDATE),this.layerSource.once("update",()=>{this.log(Mr.SourceInitEnd,jr.UPDATE)})}style(t){const{passes:e}=t,i=An(t,lK);e&&tD(e).forEach(a=>{const o=this.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(a[0]);o&&o.updateOptions(a[1])}),i.borderColor&&(i.stroke=i.borderColor),i.borderWidth&&(i.strokeWidth=i.borderWidth);const n=i;return Object.keys(i).forEach(a=>{const o=i[a];Array.isArray(o)&&o.length===2&&!aR(o[0])&&!aR(o[1])&&(n[a]={field:o[0],value:o[1]})}),this.encodeStyle(n),this.updateLayerConfig(n),this}encodeStyle(t){Object.keys(t).forEach(e=>{[...this.enableShaderEncodeStyles,...this.enableDataEncodeStyles].includes(e)&&cK(t[e])&&(t[e].field||t[e].value)&&!L_(this.encodeStyleAttribute[e],t[e])?(this.encodeStyleAttribute[e]=t[e],this.updateStyleAttribute(e,t[e].field,t[e].value),this.inited&&(this.dataState.dataMappingNeedUpdate=!0)):this.encodeStyleAttribute[e]&&(delete this.encodeStyleAttribute[e],this.dataState.dataSourceNeedUpdate=!0)})}scale(t,e){const i=G({},this.scaleOptions);if(Gr(t)?this.scaleOptions=G(G({},this.scaleOptions),t):this.scaleOptions[t]=e,this.styleAttributeService&&!L_(i,this.scaleOptions)){const n=Gr(t)?t:{[t]:e};this.styleAttributeService.updateScaleAttribute(n)}return this}renderLayers(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}prerender(){}render(t={}){return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(t),this))}renderMultiPass(){var t=this;return Z(function*(){t.encodeDataLength<=0&&!t.forceRender||(t.multiPassRenderer&&t.multiPassRenderer.getRenderFlag()?yield t.multiPassRenderer.render():t.renderModels())})()}active(t){const e={};return e.enableHighlight=Gr(t)?!0:t,Gr(t)?(e.enableHighlight=!0,t.color&&(e.highlightColor=t.color),t.mix&&(e.activeMix=t.mix)):e.enableHighlight=!!t,this.updateLayerConfig(e),this}setActive(t,e){if(Gr(t)){const{x:i=0,y:n=0}=t;this.updateLayerConfig({highlightColor:Gr(e)?e.color:this.getLayerConfig().highlightColor,activeMix:Gr(e)?e.mix:this.getLayerConfig().activeMix}),this.pick({x:i,y:n})}else this.updateLayerConfig({pickedFeatureID:t,highlightColor:Gr(e)?e.color:this.getLayerConfig().highlightColor,activeMix:Gr(e)?e.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call(jc(t)).then(()=>{setTimeout(()=>{this.reRender()},1)})}select(t){const e={};return e.enableSelect=Gr(t)?!0:t,Gr(t)?(e.enableSelect=!0,t.color&&(e.selectColor=t.color),t.mix&&(e.selectMix=t.mix)):e.enableSelect=!!t,this.updateLayerConfig(e),this}setSelect(t,e){if(Gr(t)){const{x:i=0,y:n=0}=t;this.updateLayerConfig({selectColor:Gr(e)?e.color:this.getLayerConfig().selectColor,selectMix:Gr(e)?e.mix:this.getLayerConfig().selectMix}),this.pick({x:i,y:n})}else this.updateLayerConfig({pickedFeatureID:t,selectColor:Gr(e)?e.color:this.getLayerConfig().selectColor,selectMix:Gr(e)?e.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(jc(t)).then(()=>{setTimeout(()=>{this.reRender()},1)})}setBlend(t){return this.updateLayerConfig({blend:t}),this.reRender(),this}show(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}hide(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}setIndex(t){return this.zIndex=t,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}setCurrentPickId(t){this.currentPickId=t}getCurrentPickId(){return this.currentPickId}setCurrentSelectedId(t){this.selectedFeatureID=t}getCurrentSelectedId(){return this.selectedFeatureID}isVisible(){const t=this.mapService.getZoom(),{visible:e,minZoom:i=-1/0,maxZoom:n=1/0}=this.getLayerConfig();return!!e&&t>=i&&t<n}setMultiPass(t,e){if(this.updateLayerConfig({enableMultiPassRenderer:t}),e&&this.updateLayerConfig({passes:e}),t){const{passes:i=[]}=this.getLayerConfig();this.multiPassRenderer=eD(this,i,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);const{width:n,height:a}=this.rendererService.getViewportSize();this.multiPassRenderer.resize(n,a)}return this}setMinZoom(t){return this.updateLayerConfig({minZoom:t}),this}getMinZoom(){const{minZoom:t}=this.getLayerConfig();return t}getMaxZoom(){const{maxZoom:t}=this.getLayerConfig();return t}get(t){return this.getLayerConfig()[t]}setMaxZoom(t){return this.updateLayerConfig({maxZoom:t}),this}setAutoFit(t){return this.updateLayerConfig({autoFit:t}),this}fitBounds(t){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;const i=this.getSource().extent;return i.some(a=>Math.abs(a)===1/0)?this:(this.mapService.fitBounds([[i[0],i[1]],[i[2],i[3]]],t),this)}destroy(t=!0){var e,i,n,a,o;if(this.isDestroyed)return;(e=this.layerModel)===null||e===void 0||e.uniformBuffers.forEach(l=>{l.destroy()}),this.layerChildren.map(l=>l.destroy(!1)),this.layerChildren=[];const{maskfence:s}=this.getLayerConfig();s&&(this.masks.map(l=>l.destroy(!1)),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(i=this.multiPassRenderer)===null||i===void 0||i.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(n=this.layerModel)===null||n===void 0||n.clearModels(t),(a=this.tileLayer)===null||a===void 0||a.destroy(),this.models=[],(o=this.debugService)===null||o===void 0||o.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}clear(){this.styleAttributeService.clearAllAttributes()}clearModels(){var t;this.models.forEach(e=>e.destroy()),(t=this.layerModel)===null||t===void 0||t.clearModels(),this.models=[]}isDirty(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(t=>t.needRescale||t.needRemapping||t.needRegenerateVertices).length}setSource(t){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=t,this.clusterZoom=0,this.inited&&this.layerSource.cluster){const e=this.mapService.getZoom();this.layerSource.updateClusterData(e)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",({type:e})=>{if(this.coordCenter===void 0){const i=this.layerSource.center;this.coordCenter=i}if(e==="update"){if(this.tileLayer){this.tileLayer.reload();return}this.sourceEvent()}e==="inited"&&this.processRelativeCoordinates()})}getSource(){return this.layerSource}getScaleOptions(){return this.scaleOptions}setEncodedData(t){this.encodedData=t,this.encodeDataLength=t.length}getEncodedData(){return this.encodedData}getScale(t){return this.styleAttributeService.getLayerAttributeScale(t)}getLegend(t){var e,i,n;const a=this.styleAttributeService.getLayerStyleAttribute(t);return{type:(i=((a==null||(e=a.scale)===null||e===void 0?void 0:e.scalers)||[])[0])===null||i===void 0||(i=i.option)===null||i===void 0?void 0:i.type,field:a==null||(n=a.scale)===null||n===void 0?void 0:n.field,items:this.getLegendItems(t)}}getLegendItems(t){const e=this.styleAttributeService.getLayerAttributeScale(t);return e?e.invertExtent?e.range().map(n=>({value:e.invertExtent(n),[t]:n})):e.ticks?e.ticks().map(n=>({value:n,[t]:e(n)})):e!=null&&e.domain?e.domain().filter(n=>!hK(n)).map(n=>({value:n,[t]:e(n)})):[]:[]}pick({x:t,y:e}){this.interactionService.triggerHover({x:t,y:e})}boxSelect(t,e){this.pickingService.boxPickLayer(this,t,e)}buildLayerModel(t){var e=this;return Z(function*(){const{moduleName:i,vertexShader:n,fragmentShader:a,defines:o,inject:s,triangulation:l,styleOption:u,pickingEnabled:c=!0}=t,h=An(t,uK);e.shaderModuleService.registerModule(i,{vs:n,fs:a,defines:o,inject:s});const{vs:f,fs:d,uniforms:v}=e.shaderModuleService.getModule(i),{createModel:p}=e.rendererService;return new Promise(g=>{const{attributes:m,elements:y,count:_}=e.styleAttributeService.createAttributesAndIndices(e.encodedData,l,u,e),x=[...e.layerModel.uniformBuffers,...e.rendererService.uniformBuffers];c&&x.push(e.getPickingUniformBuffer());const C=G({attributes:m,uniforms:v,fs:d,vs:f,elements:y,blend:rD[Ms.normal],uniformBuffers:x,textures:e.layerModel.textures},h);_&&(C.count=_);const A=p(C);g(A)})})()}createAttributes(t){const{triangulation:e}=t,{attributes:i}=this.styleAttributeService.createAttributes(this.encodedData,e);return i}getTime(){return this.layerService.clock.getDelta()}setAnimateStartTime(){this.animateStartTime=this.layerService.clock.getElapsedTime()}stopAnimate(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}getLayerAnimateTime(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}needPick(t){const{enableHighlight:e=!0,enableSelect:i=!0}=this.getLayerConfig();let n=this.eventNames().indexOf(t)!==-1||this.eventNames().indexOf("un"+t)!==-1;return(t==="click"||t==="dblclick")&&i&&(n=!0),t==="mousemove"&&(e||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(n=!0),this.isVisible()&&n}buildModels(){return Z(function*(){throw new Error("Method not implemented.")})()}rebuildModels(){var t=this;return Z(function*(){yield t.buildModels()})()}renderMulPass(t){return Z(function*(){yield t.render()})()}renderModels(t={}){return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach(e=>{e.draw({uniforms:this.layerModel.getUninforms(),blend:this.layerModel.getBlend(),stencil:this.layerModel.getStencil(t),textures:this.layerModel.textures},(t==null?void 0:t.ispick)||!1)}),this.hooks.afterRender.call(),this)}updateStyleAttribute(t,e,i,n){const a=this.configService.getAttributeConfig(this.id)||{};return L_(a[t],{field:e,values:i})?!1:(["color","size","texture","rotate","filter","label","shape"].indexOf(t)!==-1&&this.configService.setAttributeConfig(this.id,{[t]:{field:e,values:i}}),this.startInit?this.styleAttributeService.updateStyleAttribute(t,{scale:G({field:e},this.splitValuesAndCallbackInAttribute(i,this.getLayerConfig()[e]))},n):this.pendingStyleAttributes.push({attributeName:t,attributeField:e,attributeValues:i,updateOptions:n}),!0)}getLayerAttributeConfig(){return this.configService.getAttributeConfig(this.id)}getShaderPickStat(){return this.layerService.getShaderPickStat()}setEarthTime(t){console.warn("empty fn")}processData(t){return t}getModelType(){throw new Error("Method not implemented.")}getDefaultConfig(){return{}}processRelativeCoordinates(){if(!this.getLayerConfig().enableRelativeCoordinates||!this.layerSource||!this.layerSource.data)return;this.absoluteDataArray=[...this.layerSource.data.dataArray];const i=Cq(this.layerSource.data.dataArray,{enableRelativeCoordinates:!0});this.layerSource.data.dataArray=i.dataArray,this.relativeOrigin=i.relativeOrigin,this.originalExtent=i.originalExtent}getAbsoluteData(){return this.absoluteDataArray}getRelativeOrigin(){return this.relativeOrigin}getOriginalExtent(){return this.originalExtent}initLayerModels(){var t=this;return Z(function*(){t.models.forEach(i=>i.destroy()),t.models=[],t.uniformBuffers.forEach(i=>{i.destroy()}),t.uniformBuffers=[];const e=t.rendererService.createBuffer({data:new Float32Array(20).fill(0),isUBO:!0,label:"pickingUniforms"});t.uniformBuffers.push(e),t.models=yield t.layerModel.initModels()})()}getPickingUniformBuffer(){return this.uniformBuffers[0]}reRender(){this.inited&&this.layerService.reRender()}splitValuesAndCallbackInAttribute(t){return{values:nR(t)?void 0:t,callback:nR(t)?t:void 0}}}function fK(r,t){return{enable:r,mask:255,func:{cmp:w.EQUAL,ref:t?1:0,mask:1}}}function sR(r){return r.maskOperation===Hm.OR?{enable:!0,mask:255,func:{cmp:w.ALWAYS,ref:1,mask:255},opFront:{fail:w.KEEP,zfail:w.REPLACE,zpass:w.REPLACE}}:{enable:!0,mask:255,func:{cmp:r.stencilType===zl.SINGLE||r.stencilIndex===0?w.ALWAYS:w.LESS,ref:r.stencilType===zl.SINGLE?1:r.stencilIndex===0?2:1,mask:255},opFront:{fail:w.KEEP,zfail:w.REPLACE,zpass:w.REPLACE}}}const dK={opacity:1,stroke:[1,0,0,1],offsets:[0,0],rotation:0,extrusionBase:0,strokeOpacity:1,thetaOffset:.314},xp={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2",rotation:"float",extrusionBase:"float",strokeOpacity:"float",thetaOffset:"float"};function lR(r){return Math.max(Math.ceil(r/4)*4,4)}function iD(r,t,e,i=!0){const n=e===3;if(i){r=r.slice();const o=[];for(let s=0;s<r.length;s+=e){o[0]=r[s],o[1]=r[s+1],n&&(o[2]=r[s+2]);const l=Ug(o,!0,{enable:!1,decimal:1});r[s]=l[0],r[s+1]=l[1],n&&(r[s+2]=l[2])}}return is(r,t,e)}const nD="ATTRIBUTE_LOCATION_";class Me{get attributeLocation(){return G({},Ns)}constructor(t){E(this,"triangulation",void 0),E(this,"uniformBuffers",[]),E(this,"textures",[]),E(this,"createTexture2D",void 0),E(this,"preStyleAttribute",{}),E(this,"encodeStyleAttribute",{}),E(this,"layer",void 0),E(this,"dataTexture",void 0),E(this,"DATA_TEXTURE_WIDTH",void 0),E(this,"dataTextureTest",void 0),E(this,"configService",void 0),E(this,"shaderModuleService",void 0),E(this,"rendererService",void 0),E(this,"iconService",void 0),E(this,"fontService",void 0),E(this,"styleAttributeService",void 0),E(this,"mapService",void 0),E(this,"cameraService",void 0),E(this,"layerService",void 0),E(this,"pickingService",void 0),E(this,"attributeUnifoms",void 0),E(this,"commonUnifoms",void 0),this.layer=t,this.configService=t.getContainer().globalConfigService,this.rendererService=t.getContainer().rendererService,this.pickingService=t.getContainer().pickingService,this.shaderModuleService=t.getContainer().shaderModuleService,this.styleAttributeService=t.getContainer().styleAttributeService,this.mapService=t.getContainer().mapService,this.iconService=t.getContainer().iconService,this.fontService=t.getContainer().fontService,this.cameraService=t.getContainer().cameraService,this.layerService=t.getContainer().layerService,this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();const{createTexture2D:e}=this.rendererService;this.createTexture2D=e}getBlend(){const{blend:t="normal"}=this.layer.getLayerConfig();return rD[Ms[t]]}getStencil(t){const{mask:e=!1,maskInside:i=!0,enableMask:n,maskOperation:a=Hm.AND}=this.layer.getLayerConfig();if(this.layer.type==="MaskLayer")return sR({isStencil:!0,stencilType:zl.SINGLE});if(t.isStencil)return sR(G(G({},t),{},{maskOperation:a}));const o=e||n&&this.layer.masks.length!==0||this.layer.tileMask!==void 0;return fK(o,i)}getDefaultStyle(){return{}}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());this.updateStyleUnifoms();const i=G(G({},e.uniformsOption),t.uniformsOption);return Object.keys(i).forEach(n=>{typeof i[n]=="boolean"&&(i[n]=i[n]?1:0)}),!this.rendererService.hasOwnProperty("device")&&this.textures&&this.textures.length===1&&(i.u_texture=this.textures[0]),i}getAnimateUniforms(){return{}}needUpdate(){return Z(function*(){return!1})()}buildModels(){return Z(function*(){throw new Error("Method not implemented.")})()}initModels(){return Z(function*(){throw new Error("Method not implemented.")})()}clearModels(t=!0){}getAttribute(){throw new Error("Method not implemented.")}prerender(){}render(t){throw new Error("Method not implemented.")}registerBuiltinAttributes(){throw new Error("Method not implemented.")}animateOption2Array(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}startModelAnimate(){const{animateOption:t}=this.layer.getLayerConfig();t.enable&&this.layer.setAnimateStartTime()}getInject(){return vK(this.layer.enableShaderEncodeStyles,this.layer.encodeStyleAttribute)}getDefines(){const t=Object.keys(this.attributeLocation).reduce((e,i)=>{const n=nD+i;return e[n]=this.attributeLocation[i],e},{});return G({},t)}getStyleAttribute(){const t={};return this.layer.enableShaderEncodeStyles.forEach(e=>{if(!this.layer.encodeStyleAttribute[e]){const i=this.layer.getLayerConfig()[e];let n=typeof i>"u"?dK[e]:i;e==="stroke"&&(n=Pe(n)),t["u_"+e]=n}}),t}registerStyleAttribute(){Object.keys(this.layer.encodeStyleAttribute).forEach(t=>{const e=qq(t);e&&this.styleAttributeService.registerStyleAttribute(e)})}registerPosition64LowAttribute(t=!0){this.styleAttributeService.registerStyleAttribute({name:"position64Low",type:pt.Attribute,descriptor:{name:"a_Position64Low",shaderLocation:this.attributeLocation.POSITION_64LOW,buffer:{data:[],type:w.FLOAT},size:2,update:(e,i,n)=>t?[_r(n[0]),_r(n[1])]:[0,0]}})}updateEncodeAttribute(t,e){this.encodeStyleAttribute[t]=e}initUniformsBuffer(){const t=this.getUniformsBufferInfo(this.getStyleAttribute()),e=this.getCommonUniformsInfo();t.uniformsLength!==0&&(this.attributeUnifoms=this.rendererService.createBuffer({data:new Float32Array(lR(t.uniformsLength)).fill(0),isUBO:!0,label:"layerModelAttributeUnifoms"}),this.uniformBuffers.push(this.attributeUnifoms)),e.uniformsLength!==0&&(this.commonUnifoms=this.rendererService.createBuffer({data:new Float32Array(lR(e.uniformsLength)).fill(0),isUBO:!0,label:"layerModelCommonUnifoms"}),this.uniformBuffers.push(this.commonUnifoms))}getUniformsBufferInfo(t){let e=0;const i=[];return Object.values(t).forEach(n=>{Array.isArray(n)?(i.push(...n),e+=n.length):typeof n=="number"?(i.push(n),e+=1):typeof n=="boolean"&&(i.push(Number(n)),e+=1)}),{uniformsOption:t,uniformsLength:e,uniformsArray:i}}getCommonUniformsInfo(){return{uniformsLength:0,uniformsArray:[],uniformsOption:{}}}updateStyleUnifoms(){var t,e;const{uniformsArray:i}=this.getUniformsBufferInfo(this.getStyleAttribute()),{uniformsArray:n}=this.getCommonUniformsInfo();(t=this.attributeUnifoms)===null||t===void 0||t.subData({offset:0,data:new Uint8Array(new Float32Array(i).buffer)}),(e=this.commonUnifoms)===null||e===void 0||e.subData({offset:0,data:new Uint8Array(new Float32Array(n).buffer)})}}function vK(r,t){const e=[];let i="";r.forEach(o=>{const s=o.replace(/([a-z])([A-Z])/g,"$1_$2").toUpperCase(),l=nD+s;t[o]?i+=`#define USE_ATTRIBUTE_${s} 0.0 
`:e.push(`  ${xp[o]} u_${o};`),i+=`
#ifdef USE_ATTRIBUTE_${s}
layout(location = ${l}) in ${xp[o]} a_${o.charAt(0).toUpperCase()+o.slice(1)};
#endif 
`});const n=e.length?`
layout(std140) uniform AttributeUniforms {
  ${e.join(`
`)}
};
`:"";i+=n;let a="";return r.forEach(o=>{const s=o.replace(/([a-z])([A-Z])/g,"$1_$2").toUpperCase();a+=`
  #ifdef USE_ATTRIBUTE_${s}
    ${xp[o]} ${o} = a_${o.charAt(0).toUpperCase()+o.slice(1)};
  #else
    ${xp[o]} ${o} = u_${o};
  #endif
  `}),{"vs:#decl":i,"fs:#decl":n,"vs:#main-start":a}}let uR=function(r){return r.VERTICAL="vertical",r.HORIZONTAL="horizontal",r}({}),pK=function(r){return r.NORMAL="normal",r.REPLACE="replace",r}({}),nS=function(r){return r[r.pixel=0]="pixel",r[r.meter=1]="meter",r}({});const aD=100;function cR(r){return r/180*Math.acos(-1)}function oD(r){const t=cR(r[0])+Math.PI/2,e=cR(r[1]),i=aD+Math.random()*.4,n=i*Math.cos(e)*Math.cos(t),a=i*Math.cos(e)*Math.sin(t),o=i*Math.sin(e);return[a,o,n]}const hR=yn();yn();const Nn=yn(),nf=yn(),Cp=yn();function fR(r,t,e,i,n){si(r,e,i),Xc(r,r),t=Z1(-r[1],r[0]);const a=Z1(-e[1],e[0]);return[n/m0(t,a),t]}function af(r,t){return N$(r,-t[1],t[0])}function Ep(r,t,e){return Ko(r,t,e),Xc(r,r),r}function dR(r,t){return r[0]===t[0]&&r[1]===t[1]}class gK{constructor(t={}){E(this,"complex",void 0),E(this,"join",void 0),E(this,"cap",void 0),E(this,"miterLimit",void 0),E(this,"thickness",void 0),E(this,"normal",void 0),E(this,"lastFlip",-1),E(this,"miter",Z1(0,0)),E(this,"started",!1),E(this,"dash",!1),E(this,"totalDistance",0),E(this,"currentIndex",0),this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}simpleExtrude(t){const e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;const i=t.length;let n=e.startIndex;for(let a=1;a<i;a++){const o=t[a-1],s=t[a],l=a<t.length-1?t[a+1]:null,u=this.simpleSegment(e,n,o,s,l);n+=u}if(this.dash)for(let a=0;a<e.positions.length/6;a++)e.positions[a*6+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}extrude(t){const e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;const i=t.length;let n=e.startIndex;for(let a=1;a<i;a++){const o=t[a-1],s=t[a],l=a<t.length-1?t[a+1]:null,u=this.segment(e,n,o,s,l);n+=u}if(this.dash)for(let a=0;a<e.positions.length/6;a++)e.positions[a*6+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}simpleSegment(t,e,i,n,a){let o=0;const s=t.indices,l=t.positions,u=t.normals,c=Vn([n[0],n[1]]),h=Vn([i[0],i[1]]);Ep(Nn,c,h);let f=0;if(this.dash&&(f=this.lineSegmentDistance(c,h),this.totalDistance+=f),this.normal||(this.normal=yn(),af(this.normal,Nn)),this.started||(this.started=!0,this.extrusions(l,u,i,this.normal,this.thickness,this.totalDistance-f)),s.push(e+0,e+1,e+2),!a)af(this.normal,Nn),this.extrusions(l,u,n,this.normal,this.thickness,this.totalDistance),s.push(...this.lastFlip===1?[e,e+2,e+3]:[e+2,e+1,e+3]),o+=2;else{const d=Vn([a[0],a[1]]);dR(c,d)&&si(d,c,Xc(d,q1(d,c,h))),Ep(nf,d,c);const[v,p]=fR(Cp,yn(),Nn,nf,this.thickness);let g=m0(Cp,this.normal)<0?-1:1;this.extrusions(l,u,n,p,v,this.totalDistance),s.push(...this.lastFlip===1?[e,e+2,e+3]:[e+2,e+1,e+3]),g=-1,S_(this.normal,p),o+=2,this.lastFlip=g}return o}segment(t,e,i,n,a){let o=0;const s=t.indices,l=t.positions,u=t.normals,c=this.cap==="square",h=this.join==="bevel",f=Vn([n[0],n[1]]),d=Vn([i[0],i[1]]);Ep(Nn,f,d);let v=0;if(this.dash&&(v=this.lineSegmentDistance(f,d),this.totalDistance+=v),this.normal||(this.normal=yn(),af(this.normal,Nn)),!this.started)if(this.started=!0,c){const p=yn(),g=yn();si(p,this.normal,Nn),si(g,this.normal,Nn),u.push(g[0],g[1],0),u.push(p[0],p[1],0),l.push(i[0],i[1],i[2]|0,this.totalDistance-v,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),l.push(i[0],i[1],i[2]|0,this.totalDistance-v,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,u,i,this.normal,this.thickness,this.totalDistance-v);if(s.push(e+0,e+1,e+2),a){const p=Vn([a[0],a[1]]);dR(f,p)&&si(p,f,Xc(p,q1(p,f,d))),Ep(nf,p,f);const[g,m]=fR(Cp,yn(),Nn,nf,this.thickness);let y=m0(Cp,this.normal)<0?-1:1,_=h;!_&&this.join==="miter"&&g>this.miterLimit&&(_=!0),_?(u.push(this.normal[0],this.normal[1],0),u.push(m[0],m[1],0),l.push(n[0],n[1],n[2]|0,this.totalDistance,-this.thickness*y,n[2]|0),this.complex.indexes.push(this.currentIndex),l.push(n[0],n[1],n[2]|0,this.totalDistance,this.thickness*y,n[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,s.push(...this.lastFlip!==-y?[e,e+2,e+3]:[e+2,e+1,e+3]),s.push(e+2,e+3,e+4),af(hR,nf),S_(this.normal,hR),u.push(this.normal[0],this.normal[1],0),l.push(n[0],n[1],n[2]|0,this.totalDistance,-this.thickness*y,n[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,o+=3):(this.extrusions(l,u,n,m,g,this.totalDistance),s.push(...this.lastFlip===1?[e,e+2,e+3]:[e+2,e+1,e+3]),y=-1,S_(this.normal,m),o+=2),this.lastFlip=y}else{if(af(this.normal,Nn),c){const p=yn(),g=yn();Ko(g,Nn,this.normal),si(p,Nn,this.normal),u.push(g[0],g[1],0),u.push(p[0],p[1],0),l.push(n[0],n[1],n[2]|0,this.totalDistance,this.thickness,n[2]|0),this.complex.indexes.push(this.currentIndex),l.push(n[0],n[1],n[2]|0,this.totalDistance,this.thickness,n[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,u,n,this.normal,this.thickness,this.totalDistance);s.push(...this.lastFlip===1?[e,e+2,e+3]:[e+2,e+1,e+3]),o+=2}return o}extrusions(t,e,i,n,a,o){e.push(n[0],n[1],0),e.push(n[0],n[1],0),t.push(i[0],i[1],i[2]|0,o,-a,i[2]|0),this.complex.indexes.push(this.currentIndex),t.push(i[0],i[1],i[2]|0,o,a,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}lineSegmentDistance(t,e){const i=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(i*i+n*n)}}let of=function(r){return r.CYLINDER="cylinder",r.SQUARECOLUMN="squareColumn",r.TRIANGLECOLUMN="triangleColumn",r.HEXAGONCOLUMN="hexagonColumn",r.PENTAGONCOLUMN="pentagonColumn",r}({}),sf=function(r){return r.CIRCLE="circle",r.SQUARE="square",r.TRIANGLE="triangle",r.HEXAGON="hexagon",r.PENTAGON="pentagon",r}({});function _v(r,t=0){const e=Math.PI*2/r,i=[];for(let a=0;a<r;a++)i.push(e*a+t*Math.PI/12);return i.map(a=>{const o=Math.sin(a+Math.PI/4),s=Math.cos(a+Math.PI/4);return[o,s,0]})}function mx(){return _v(30)}function vR(){return _v(4)}function pR(){return _v(3)}function gR(){return _v(6,1)}function mR(){return _v(5)}const Lc={[sf.CIRCLE]:mx,[sf.HEXAGON]:gR,[sf.TRIANGLE]:pR,[sf.SQUARE]:vR,[sf.PENTAGON]:mR,[of.CYLINDER]:mx,[of.HEXAGONCOLUMN]:gR,[of.TRIANGLECOLUMN]:pR,[of.SQUARECOLUMN]:vR,[of.PENTAGONCOLUMN]:mR};function mK(r){const t=r[0][0],e=r[0][r[0].length-1];t[0]===e[0]&&t[1]===e[1]&&(r[0]=r[0].slice(0,r[0].length-1));const i=r[0].length,n=is.flatten(r),{vertices:a,dimensions:o}=n,s=[],l=[];for(let c=0;c<a.length/o;c++)o===2?s.push(a[c*2],a[c*2+1],1):s.push(a[c*3],a[c*3+1],1);const u=is(n.vertices,n.holes,n.dimensions);l.push(...u);for(let c=0;c<i;c++){const h=n.vertices.slice(c*o,(c+1)*o);let f=n.vertices.slice((c+1)*o,(c+2)*o);f.length===0&&(f=n.vertices.slice(0,o));const d=s.length/3;s.push(h[0],h[1],1,f[0],f[1],1,h[0],h[1],0,f[0],f[1],0),l.push(...[0,2,1,2,3,1].map(v=>v+d))}return{positions:s,index:l}}function yK(r){const t=is.flatten(r),e=is(t.vertices,t.holes,t.dimensions);return{positions:t.vertices,index:e}}function sD(r,t=!1){const e=r[0][0],i=r[0][r[0].length-1];e[0]===i[0]&&e[1]===i[1]&&(r[0]=r[0].slice(0,r[0].length-1));const n=r[0].length,a=is.flatten(r),{vertices:o,dimensions:s,holes:l}=a,u=[],c=[],h=[];for(let d=0;d<o.length/s;d++)u.push(o[d*s],o[d*s+1],1,-1,-1),h.push(0,0,1);const f=iD(o,l,s,t);c.push(...f);for(let d=0;d<n;d++){const v=a.vertices.slice(d*s,(d+1)*s);let p=a.vertices.slice((d+1)*s,(d+2)*s);p.length===0&&(p=a.vertices.slice(0,s));const g=u.length/5;u.push(v[0],v[1],1,0,0,p[0],p[1],1,.1,0,v[0],v[1],0,0,.8,p[0],p[1],0,.1,.8);const m=_K([p[0],p[1],1],[v[0],v[1],0],[v[0],v[1],1],t);h.push(...m,...m,...m,...m),c.push(...[1,2,0,3,2,1].map(y=>y+g))}return{positions:u,index:c,normals:h}}function _K(r,t,e,i=!1){const n=gp(),a=gp(),o=gp();i&&(r=Ug(r),t=Ug(t),e=Ug(e));const s=Yr(...r),l=Yr(...t),u=Yr(...e);p2(n,u,l),p2(a,s,l),k$(o,n,a);const c=gp();return Mf(c,o),c}const Sp={};function Ql(r){const t=cu(r.coordinates);return{vertices:[...t,...t,...t,...t],indices:[0,1,2,2,3,0],size:t.length}}function yR(r){const t=cu(r.coordinates),e=oD(t);return{vertices:[...e,...e,...e,...e],indices:[0,1,2,2,3,0],size:e.length}}function aS(r){const{shape:t}=r,{positions:e,index:i,normals:n}=TK(t,!1);return{vertices:e,indices:i,normals:n,size:5}}function xK(r){const t=cu(r.coordinates);return{vertices:[...t],indices:[0],size:t.length}}function yx(r){const{coordinates:t}=r,e=new gK({dash:!0,join:"bevel"});let i=t;i[0]&&!Array.isArray(i[0][0])&&(i=[t]),i.forEach(a=>{e.extrude(a)});const n=e.complex;return{vertices:n.positions,indices:n.indices,normals:n.normals,indexes:n.indexes,size:6}}function CK(r){const{coordinates:t}=r,e=[];if(!Array.isArray(t[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};const{results:i,totalDistance:n}=EK(t);return i.map(a=>{e.push(a[0],a[1],a[2],a[3],0,n)}),{vertices:e,indices:[],normals:[],size:6,count:i.length}}function _R(r,t){const e=t[0]-r[0],i=t[1]-r[1];return Math.sqrt(e*e+i*i)}function O_(r,t){return r.length<3&&r.push(0),t!==void 0&&r.push(t),r}function EK(r){let t=r;Array.isArray(t)&&Array.isArray(t[0])&&Array.isArray(t[0][0])&&(t=r.flat());let e=0;if(t.length<2)return{results:t,totalDistance:0};{const i=[],n=O_(t[0],e);i.push(n);for(let o=1;o<t.length-1;o++){const s=_R(Vn(t[o-1]),Vn(t[o]));e+=s;const l=O_(t[o],e);i.push(l),i.push(l)}const a=_R(Vn(t[t.length-2]),Vn(t[t.length-1]));return e+=a,i.push(O_(t[t.length-1],e)),{results:i,totalDistance:e}}}function xv(r){const{coordinates:t}=r,e=is.flatten(t),{vertices:i,dimensions:n,holes:a}=e;return{indices:iD(i,a,n),vertices:i,size:n}}function SK(r){const{indices:t,vertices:e,size:i}=xv(r);return{indices:t,vertices:AK(e),size:i+4}}function AK(r){const t=[],{center:e,radius:i}=bV(r);for(let n=0;n<r.length;n+=2){const a=r[n],o=r[n+1];t.push(a,o,0,...e,i)}return t}function lD(r){const t=r.coordinates,{positions:e,index:i,normals:n}=sD(t,!0);return{vertices:e,indices:i,normals:n,size:5}}function uD(r){const{shape:t}=r,{positions:e,index:i}=bK(t);return{vertices:e,indices:i,size:3}}function Vm(r){const t=r.coordinates;return{vertices:[...t[0],0,0,0,...t[1],0,1,0,...t[2],0,1,1,...t[3],0,0,1],indices:[0,1,2,0,2,3],size:5}}function oS(r,t){const{segmentNumber:e=30}=t,i=r.coordinates,n=[],a=[];for(let o=0;o<e;o++)n.push(o,1,o,i[0][0],i[0][1],i[1][0],i[1][1],o,-1,o,i[0][0],i[0][1],i[1][0],i[1][1]),o!==e-1&&a.push(...[0,1,2,1,3,2].map(s=>o*2+s));return{vertices:n,indices:a,size:7}}function xR(r){const t=r.coordinates;t.length===2&&t.push(0);const e=Ap(-1,1),i=Ap(1,1),n=Ap(-1,-1),a=Ap(1,-1);return{vertices:[...t,...e,...t,...n,...t,...a,...t,...i],indices:[0,1,2,3,0,2],size:5}}function TK(r,t=!1){if(Sp&&Sp[r])return Sp[r];const e=Lc[r]?Lc[r]():Lc.cylinder(),i=sD([e],t);return Sp[r]=i,i}function bK(r){const t=["cylinder","triangleColumn","hexagonColumn","squareColumn"],e=Lc[r]?Lc[r]():Lc.circle();return t.indexOf(r)===-1?yK([e]):mK([e])}function Ap(r,t){const e=(r+1)/2,i=(t+1)/2;return[e,i]}function cD(r,t){return{type:r.type,field:"value",items:r.positions.map((e,i)=>({[t]:i>=r.colors.length?null:r.colors[i],value:e}))}}const wK=`in vec4 v_color;

#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,RK=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location =  ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;

layout(std140) uniform commonUniforms {
    vec2 u_radius;
    float u_opacity;
    float u_coverage;
    float u_angle;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
  v_color.a *= u_opacity;

  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage;

  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
  vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  gl_Position = project_common_position_to_clipspace(project_pos);

  setPickingColor(a_PickingColor);
}
`;class MK extends Me{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,POS:9})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),G(G({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{opacity:t,coverage:e,angle:i}=this.layer.getLayerConfig(),n={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:t||1,u_coverage:e||.9,u_angle:i||0};return this.getUniformsBufferInfo(n)}initModels(){var t=this;return Z(function*(){return t.buildModels()})()}buildModels(){var t=this;return Z(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:RK,fragmentShader:wK,defines:t.getDefines(),triangulation:uD,primitive:w.TRIANGLES,depth:{enable:!1}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:pt.Attribute,descriptor:{shaderLocation:this.attributeLocation.POS,name:"a_Pos",buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:3,update:t=>{const e=t.coordinates;return[e[0],e[1],0]}}})}}const IK=`in vec4 v_color;

layout(std140) uniform commonUniforms {
  vec2 u_radius;
  float u_opacity;
  float u_coverage;
  float u_angle;
};

#pragma include "scene_uniforms"
#pragma include "picking"

out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,LK=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
  vec2 u_radius;
  float u_opacity;
  float u_coverage;
  float u_angle;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"

void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset = vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage);

  vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // 实际的经纬度
  vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

  float lightWeight = calc_lighting(project_pos);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  gl_Position = project_common_position_to_clipspace(project_pos);

  setPickingColor(a_PickingColor);
}
`;class OK extends Me{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,POS:10,NORMAL:11})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),G(G({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{opacity:t,coverage:e,angle:i}=this.layer.getLayerConfig(),n={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:t||1,u_coverage:e||.9,u_angle:i||0};return this.getUniformsBufferInfo(n)}initModels(){var t=this;return Z(function*(){return t.buildModels()})()}buildModels(){var t=this;return Z(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:LK,fragmentShader:IK,defines:t.getDefines(),triangulation:aS,primitive:w.TRIANGLES,depth:{enable:!0}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:pt.Attribute,descriptor:{shaderLocation:this.attributeLocation.SIZE,name:"a_Size",buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:1,update:t=>{const{size:e}=t;return Array.isArray(e)?[e[0]]:[e]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:pt.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:3,update:(t,e,i,n,a)=>a}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:pt.Attribute,descriptor:{name:"a_Pos",shaderLocation:this.attributeLocation.POS,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:3,update:t=>{const e=t.coordinates;return[e[0],e[1],0]}}})}}function PK(r,t){const e=[],i=[],n=[],a=r+1,o=t+1,s=r/2,l=t/2;for(let u=0;u<o;u++){const c=u-l;for(let h=0;h<a;h++){const f=h-s;i.push(f/s,-c/l,0),n.push(h/r),n.push(1-u/t)}}for(let u=0;u<t;u++)for(let c=0;c<r;c++){const h=c+a*u,f=c+a*(u+1),d=c+1+a*(u+1),v=c+1+a*u;e.push(h,f,v),e.push(f,d,v)}return{vertices:i,indices:e,uvs:n}}const FK=`layout(std140) uniform commonUniforms {
  mat4 u_ViewProjectionMatrixUncentered;
  mat4 u_InverseViewProjectionMatrix;
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

in vec2 v_texCoord;
in float v_intensity;
out vec4 outputColor;

void main(){
   
    float intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;
    vec4 color = texture(SAMPLER_2D(u_colorTexture),vec2(intensity, 0));
    outputColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
   outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,BK=`layout(location = 0) in vec3 a_Position;
layout(location = 10) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  mat4 u_ViewProjectionMatrixUncentered;
  mat4 u_InverseViewProjectionMatrix;
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

out vec2 v_texCoord;
out float v_intensity;

vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
  float t2 = t * t;
  float one_minus_t = 1.0 - t;
  float one_minus_t2 = one_minus_t * one_minus_t;
  return P0 * one_minus_t2 * one_minus_t +
  P1 * 3.0 * t * one_minus_t2 +
  P2 * 3.0 * t2 * one_minus_t +
  P3 * t2 * t;
}
vec2 toBezier(float t, vec4 p) {
  return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}

#pragma include "projection"
#pragma include "project"

void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // 将原本 0 -> 1 的 uv 转换为 -1 -> 1 的标准坐标空间（NDC）

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y 平面上的点（z == 0）可以认为是三维上的点被投影到平面后的点
  vec4 p2 = vec4(pos, 1.0, 1.0); // 平行于x/y平面、z==1 的平面上的点

  vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // 根据视图投影矩阵的逆矩阵平面上的反算出三维空间中的点（p1平面上的点）
  vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // 归一化操作（归一化后为世界坐标）
  inverseP2 = inverseP2 / inverseP2.w;

  float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
  vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b = vec4(0.5, 0.0, 1.0, 0.5);
  float fh;

  v_intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.0), 1.0);

}
`,DK=`uniform sampler2D u_texture;        // 热力强度图
uniform sampler2D u_colorTexture;   // 根据强度分布的色带

layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};
in vec2 v_texCoord;
out vec4 outputColor;

#pragma include "scene_uniforms"

float getBlurIndusty() {
    float vW = 2.0/ u_ViewportSize.x;
    float vH = 2.0/ u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture(SAMPLER_2D(u_texture), vec2( vUv.x , vUv.y) ).r;
    float i23 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(intensity, 0.0));
    outputColor = color;
    outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,NK=`layout(location = 0) in vec3 a_Position;
layout(location = 10) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

#pragma include "scene_uniforms"

out vec2 v_texCoord;
void main() {
  v_texCoord = a_Uv;
  #ifdef VIEWPORT_ORIGIN_TL
  v_texCoord.y = 1.0 - v_texCoord.y;
  #endif

  gl_Position = vec4(a_Position.xy, 0, 1.0);
}
`,kK=`layout(std140) uniform commonUniforms {
  float u_radius;
  float u_intensity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
};

in vec2 v_extrude;
in float v_weight;
out vec4 outputColor;
#define GAUSS_COEF  0.3989422804014327

void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    outputColor = vec4(val, 1., 1., 1.);
}
`,UK=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_DIR) in vec2 a_Dir;

layout(std140) uniform commonUniforms {
  float u_radius;
  float u_intensity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
};

out vec2 v_extrude;
out float v_weight;

#define GAUSS_COEF (0.3989422804014327)

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 picking_color_placeholder = u_PickingColor;

  v_weight = a_Size;
  float ZERO = 1.0 / 255.0 / 16.0;
  float extrude_x = a_Dir.x * 2.0 - 1.0;
  float extrude_y = a_Dir.y * 2.0 - 1.0;
  vec2 extrude_dir = normalize(vec2(extrude_x, extrude_y));
  float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
  v_extrude = extrude_dir * S;

  vec2 offset = project_pixel(v_extrude * u_radius);
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

}
`,{isEqual:zK}=er;class CR extends Me{constructor(...t){super(...t),E(this,"texture",void 0),E(this,"colorTexture",void 0),E(this,"heatmapFramerBuffer",void 0),E(this,"heatmapTexture",void 0),E(this,"intensityModel",void 0),E(this,"colorModel",void 0),E(this,"shapeType",void 0),E(this,"preRampColors",void 0),E(this,"colorModelUniformBuffer",[]),E(this,"heat3DModelUniformBuffer",[])}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,UV:10,DIR:11})}prerender(){const{clear:t,useFramebuffer:e}=this.rendererService;e(this.heatmapFramerBuffer,()=>{t({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.heatmapFramerBuffer}),this.drawIntensityMode()})}render(t){const{rampColors:e}=this.layer.getLayerConfig();zK(this.preRampColors,e)||this.updateColorTexture(),this.shapeType==="heatmap"?this.drawHeatMap(t):this.draw3DHeatMap(t)}getUninforms(){throw new Error("Method not implemented.")}initModels(){var t=this;return Z(function*(){var e;const{createFramebuffer:i,getViewportSize:n,createTexture2D:a}=t.rendererService,o=t.styleAttributeService.getLayerStyleAttribute("shape"),s=(o==null||(e=o.scale)===null||e===void 0?void 0:e.field)||"heatmap";t.shapeType=s,t.intensityModel=yield t.buildHeatMapIntensity(),t.colorModel=s==="heatmap"?t.buildHeatmap():t.build3dHeatMap();const{width:l,height:u}=n();return t.heatmapTexture=a({width:Math.floor(l/4),height:Math.floor(u/4),wrapS:w.CLAMP_TO_EDGE,wrapT:w.CLAMP_TO_EDGE,min:w.LINEAR,mag:w.LINEAR,usage:fu.RENDER_TARGET}),t.heatmapFramerBuffer=i({color:t.heatmapTexture,depth:!0,width:Math.floor(l/4),height:Math.floor(u/4)}),t.updateColorTexture(),[t.intensityModel,t.colorModel]})()}buildModels(){var t=this;return Z(function*(){return t.initModels()})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:pt.Attribute,descriptor:{name:"a_Dir",shaderLocation:this.attributeLocation.DIR,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:2,update:(t,e,i)=>[i[3],i[4]]}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:pt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:1,update:t=>{const{size:e=1}=t;return[e]}}})}buildHeatMapIntensity(){var t=this;return Z(function*(){return t.uniformBuffers=[t.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})],t.layer.triangulation=xR,yield t.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:UK,fragmentShader:kK,triangulation:xR,defines:t.getDefines(),depth:{enable:!1},cull:{enable:!0,face:w.FRONT}})})()}buildHeatmap(){this.shaderModuleService.registerModule("heatmapColor",{vs:NK,fs:DK}),this.colorModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})];const{vs:t,fs:e,uniforms:i}=this.shaderModuleService.getModule("heatmapColor"),{createAttribute:n,createElements:a,createBuffer:o,createModel:s}=this.rendererService;return s({vs:t,fs:e,uniformBuffers:[...this.colorModelUniformBuffer,...this.rendererService.uniformBuffers],attributes:{a_Position:n({shaderLocation:this.attributeLocation.POSITION,buffer:o({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:w.FLOAT}),size:3}),a_Uv:n({shaderLocation:this.attributeLocation.UV,buffer:o({data:[0,1,1,1,0,0,1,0],type:w.FLOAT}),size:2})},uniforms:G({},i),depth:{enable:!1},elements:a({data:[0,2,1,2,3,1],type:w.UNSIGNED_INT,count:6})})}build3dHeatMap(){const{getViewportSize:t}=this.rendererService,{width:e,height:i}=t(),n=PK(e/4,i/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:BK,fs:FK}),this.heat3DModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(16*2+4).fill(0),isUBO:!0})];const{vs:a,fs:o,uniforms:s}=this.shaderModuleService.getModule("heatmap3dColor"),{createAttribute:l,createElements:u,createBuffer:c,createModel:h}=this.rendererService;return h({vs:a,fs:o,attributes:{a_Position:l({shaderLocation:this.attributeLocation.POSITION,buffer:c({data:n.vertices,type:w.FLOAT}),size:3}),a_Uv:l({shaderLocation:this.attributeLocation.UV,buffer:c({data:n.uvs,type:w.FLOAT}),size:2})},primitive:w.TRIANGLES,uniformBuffers:[...this.heat3DModelUniformBuffer,...this.rendererService.uniformBuffers],uniforms:G({},s),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:w.SRC_ALPHA,srcAlpha:1,dstRGB:w.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:u({data:n.indices,type:w.UNSIGNED_INT,count:n.indices.length})})}drawIntensityMode(){var t;const{intensity:e=10,radius:i=5}=this.layer.getLayerConfig(),n={u_radius:i,u_intensity:e};this.uniformBuffers[0].subData({offset:0,data:[i,e]}),this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),(t=this.intensityModel)===null||t===void 0||t.draw({uniforms:n,blend:{enable:!0,func:{srcRGB:w.ONE,srcAlpha:1,dstRGB:w.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}drawHeatMap(t){var e;const{opacity:i=1}=this.layer.getLayerConfig(),n={u_opacity:i,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},a=[this.heatmapTexture,this.colorTexture];this.colorModelUniformBuffer[0].subData({offset:0,data:[i]}),(e=this.colorModel)===null||e===void 0||e.draw({uniforms:n,textures:a,blend:this.getBlend(),stencil:this.getStencil(t)})}draw3DHeatMap(t){var e;const{opacity:i=1}=this.layer.getLayerConfig(),n=Ou();g0(n,this.cameraService.getViewProjectionMatrixUncentered());const a={u_opacity:i,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:[...n]};this.heat3DModelUniformBuffer[0].subData({offset:0,data:[...a.u_ViewProjectionMatrixUncentered,...a.u_InverseViewProjectionMatrix,i]});const o=[this.heatmapTexture,this.colorTexture];(e=this.colorModel)===null||e===void 0||e.draw({uniforms:a,textures:o,blend:{enable:!0,func:{srcRGB:w.SRC_ALPHA,srcAlpha:1,dstRGB:w.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(t)})}updateColorTexture(){const{createTexture2D:t}=this.rendererService;this.texture&&this.texture.destroy();const{rampColors:e}=this.layer.getLayerConfig(),i=nB(e);this.colorTexture=t({data:i.data,usage:fu.SAMPLED,width:i.width,height:i.height,wrapS:w.CLAMP_TO_EDGE,wrapT:w.CLAMP_TO_EDGE,min:w.NEAREST,mag:w.NEAREST,flipY:!1,unorm:!0}),this.preRampColors=e}}const HK=`in vec4 v_color;

#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,$K=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;

layout(std140) uniform commonUniforms {
  vec2 u_radius;
  float u_opacity;
  float u_coverage;
  float u_angle;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
  v_color.a *= u_opacity;

  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset = vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage);
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);

  vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`;class WK extends Me{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,POS:9})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),G(G({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{opacity:t,coverage:e,angle:i}=this.layer.getLayerConfig(),n={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:t||1,u_coverage:e||.9,u_angle:i||0};return this.getUniformsBufferInfo(n)}initModels(){var t=this;return Z(function*(){return t.buildModels()})()}buildModels(){var t=this;return Z(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:$K,fragmentShader:HK,defines:t.getDefines(),triangulation:uD,depth:{enable:!1},primitive:w.TRIANGLES})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:pt.Attribute,descriptor:{name:"a_Pos",shaderLocation:this.attributeLocation.POS,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:3,update:t=>{const e=t.coordinates;return[e[0],e[1],0]}}})}}const VK={heatmap:CR,heatmap3d:CR,grid:MK,grid3d:OK,hexagon:WK},GK=VK;class mWt extends Fu{constructor(...t){super(...t),E(this,"type","HeatMapLayer")}buildModels(){var t=this;return Z(function*(){const e=t.getModelType();t.layerModel=new GK[e](t),yield t.initLayerModels()})()}prerender(){this.getModelType()==="heatmap"&&this.layerModel&&this.layerModel.prerender()}renderModels(t={}){return this.getModelType()==="heatmap"?(this.layerModel&&this.layerModel.render(t),this):this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(i=>i.draw({uniforms:this.layerModel.getUninforms(),blend:this.layerModel.getBlend(),stencil:this.layerModel.getStencil(t)})),this.hooks.afterRender.call(),this)}updateModelData(t){t.attributes&&t.elements?this.models[0].updateAttributesAndElements(t.attributes,t.elements):console.warn("data error")}getModelType(){var t;const e=this.styleAttributeService.getLayerStyleAttribute("shape"),{shape3d:i}=this.getLayerConfig(),a=this.getSource().data.type,o=(e==null||(t=e.scale)===null||t===void 0?void 0:t.field)||"heatmap";return o==="heatmap"||o==="heatmap3d"?"heatmap":a==="hexagon"?(i==null?void 0:i.indexOf(o))===-1?"hexagon":"grid3d":a==="grid"?(i==null?void 0:i.indexOf(o))===-1?"grid":"grid3d":"heatmap"}getLegend(t){if(this.getModelType()==="heatmap"){if(t!=="color")return{type:void 0,field:void 0,items:[]};const e=this.getLayerConfig().rampColors;return cD(e,t)}else return super.getLegend(t)}}const XK=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
    float u_opacity:1.0;
    float u_brightness:1.0;
    float u_contrast:1.0;
    float u_saturation:1.0;
    float u_gamma:1.0;
};

in vec2 v_texCoord;
out vec4 outputColor;
vec3 setContrast(vec3 rgb, float contrast) {
  vec3 color = mix(vec3(0.5), rgb, contrast);
  color = clamp(color, 0.0, 1.0);
  return color;
}
vec3 setSaturation(vec3 rgb, float adjustment) {
  const vec3 grayVector = vec3(0.2125, 0.7154, 0.0721);
  vec3 intensity = vec3(dot(rgb, grayVector));
  vec3 color = mix(intensity, rgb, adjustment);
  color = clamp(color, 0.0, 1.0);
  return color;
}
void main() {
  vec4 color = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y));
  //brightness
  color.rgb = mix(vec3(0.0, 0.0, 0.0), color.rgb, u_brightness);
  //contrast
  color.rgb = setContrast(color.rgb, u_contrast);
  // saturation
  color.rgb = setSaturation(color.rgb, u_saturation);
  // gamma
  color.rgb = pow(color.rgb, vec3(u_gamma));
  outputColor = color;
  outputColor.a *= u_opacity;
  if(outputColor.a < 0.01)
    discard;
}
`,YK=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
    float u_opacity:1.0;
    float u_brightness:1.0;
    float u_contrast:1.0;
    float u_saturation:1.0;
    float u_gamma:1.0;
};

out vec2 v_texCoord;
#pragma include "projection"

void main() {
  v_texCoord = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
}
`;let jK=class extends Me{constructor(...t){super(...t),E(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getCommonUniformsInfo(){const{opacity:t,brightness:e,contrast:i,saturation:n,gamma:a}=this.layer.getLayerConfig(),o={u_opacity:Jh(t,1),u_brightness:Jh(e,1),u_contrast:Jh(i,1),u_saturation:Jh(n,1),u_gamma:Jh(a,1)};return this.textures=[this.texture],this.getUniformsBufferInfo(o)}initModels(){var t=this;return Z(function*(){return yield t.loadTexture(),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}loadTexture(){var t=this;return Z(function*(){const{createTexture2D:e}=t.rendererService,n=yield t.layer.getSource().data.images;t.texture=e({data:n[0],width:n[0].width,height:n[0].height,mag:w.LINEAR,min:w.LINEAR})})()}buildModels(){var t=this;return Z(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:YK,fragmentShader:XK,defines:t.getDefines(),triangulation:Vm,primitive:w.TRIANGLES,blend:{enable:!0},depth:{enable:!1},pickingEnabled:!1})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:pt.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:2,update:(t,e,i)=>[i[3],i[4]]}})}};const ZK={image:jK},qK=ZK;class KK extends Fu{constructor(...t){super(...t),E(this,"type","ImageLayer")}buildModels(){var t=this;return Z(function*(){const e=t.getModelType();t.layerModel=new qK[e](t),yield t.initLayerModels()})()}getDefaultConfig(){const t=this.getModelType();return{image:{}}[t]}getModelType(){return"image"}}const QK=`
#define Animate 0.0
#define LineTexture 1.0
uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_lineDir: 1.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_blur : 0.9;
  float u_line_type: 0.0;
  float u_time;
  float u_linearColor: 0.0;
};

in vec4 v_color;
in vec2 v_iconMapUV;
in vec4 v_lineData;
//dash
in vec4 v_dash_array;
in float v_distance_ratio;

out vec4 outputColor;
#pragma include "picking"

void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      discard;
    };
  }
  float animateSpeed = 0.0; // 运动速度
  outputColor = v_color;
  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      outputColor.a *= alpha;
  }

  // 当存在贴图时在底色上贴上贴图
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = v_lineData.g; // 贴图在弧线上重复的数量

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = v_lineData.a; // 横向 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
    
  } else {
     outputColor = filterColor(outputColor);
  }
}`,JK=`#define Animate (0.0)
#define LineTexture (1.0)

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;
layout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_lineDir: 1.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_blur : 0.9;
  float u_line_type: 0.0;
  float u_time;
  float u_linearColor: 0.0;
};

out vec4 v_color;
out vec2 v_iconMapUV;
out vec4 v_lineData;
//dash
out vec4 v_dash_array;
out float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1.0 - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2 * cos(theta2) + source.x, r2 * sin(theta2) + source.y);
  if (u_lineDir == 1.0) {
    // 正向
    return mid;
  } else {
    // 逆向
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  // dash: index / (segmentNumber - 1.);
  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
  //  return index / (segmentNumber - 1.);
}
vec2 interpolate(vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x, t), bezier3(y, t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return dir_screenspace.xy * sign(offset_direction);
}

void main() {
  //vs中计算渐变色
  if (u_linearColor == 1.0) {
    float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置
    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex / segmentNumber);
  } else {
    v_color = a_Color;
  }
  v_color.a = v_color.a * opacity;

  vec2 source_world = a_Instance.rg; // 起始点
  vec2 target_world = a_Instance.ba; // 终点

  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  // 计算 dashArray 和 distanceRatio 输出到片元
  float total_Distance = pixelDistance(source_world, target_world) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  v_distance_ratio = segmentIndex / segmentNumber;

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

  v_lineData.b = d_distance_ratio;

  vec4 source = project_position(vec4(source_world, 0, 1.), a_Instance64Low.xy);
  vec4 target = project_position(vec4(target_world, 0, 1.), a_Instance64Low.zw);

  vec2 currPos = interpolate(source.xy, target.xy, segmentRatio, thetaOffset);
  vec2 nextPos = interpolate(source.xy, target.xy, nextSegmentRatio, thetaOffset);

  vec2 offset = project_pixel(
    getExtrusionOffset((nextPos.xy - currPos.xy) * indexDir, a_Position.y)
  );

  float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置
  v_lineData.r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // 开启贴图模式
    float arcDistrance = length(source - target); // 起始点和终点的距离
    arcDistrance = project_pixel(arcDistrance);

    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // 贴图沿弧线方向的长度 - 随地图缩放改变
    float texCount = floor(arcDistrance / pixelLen); // 贴图在弧线上重复的数量
    v_lineData.g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离
    float linePixelSize = project_pixel(a_Size); // 定点位置偏移
    v_lineData.a = lineOffsetWidth / linePixelSize; // 线图层贴图部分的 v 坐标值
  }

  gl_Position = project_common_position_to_clipspace(vec4(currPos.xy + offset, 0, 1.0));

  setPickingColor(a_PickingColor);
}
`,tQ={solid:0,dash:1};class eQ extends Me{constructor(...t){super(...t),E(this,"texture",void 0),E(this,"updateTexture",()=>{const{createTexture2D:e}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=e({data:this.iconService.getCanvas(),mag:w.NEAREST,min:w.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,UV:12,THETA_OFFSET:13})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:e,textureBlend:i="normal",lineType:n="solid",dashArray:a=[10,5],forward:o=!0,lineTexture:s=!1,iconStep:l=100,segmentNumber:u=30}=this.layer.getLayerConfig(),{animateOption:c}=this.layer.getLayerConfig();let h=a;n!=="dash"&&(h=[0,0]),h.length===2&&h.push(0,0);let f=0,d=[0,0,0,0],v=[0,0,0,0];if(t&&e&&(d=Pe(t),v=Pe(e),f=1),this.rendererService.getDirty()){var p;(p=this.texture)===null||p===void 0||p.bind()}const g={u_animate:this.animateOption2Array(c),u_dash_array:h,u_sourceColor:d,u_targetColor:v,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:u,u_lineDir:o?1:-1,u_icon_step:l,u_line_texture:s?1:0,u_textureBlend:i==="normal"?0:1,u_blur:.9,u_line_type:tQ[n||"solid"],u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:f};return this.getUniformsBufferInfo(g)}initModels(){var t=this;return Z(function*(){return t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}getShaders(){return{frag:QK,vert:JK,type:""}}buildModels(){var t=this;return Z(function*(){t.initUniformsBuffer();const{segmentNumber:e=30}=t.layer.getLayerConfig(),{frag:i,vert:n,type:a}=t.getShaders();return[yield t.layer.buildLayerModel({moduleName:"lineArc2d"+a,vertexShader:n,fragmentShader:i,defines:t.getDefines(),inject:t.getInject(),triangulation:oS,depth:{enable:!1},styleOption:{segmentNumber:e}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:pt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:1,update:t=>{const{size:e=1}=t;return Array.isArray(e)?[e[0]]:[e]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:pt.Attribute,descriptor:{name:"a_Instance",shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:4,update:(t,e,i)=>[i[3],i[4],i[5],i[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"instance64Low",type:pt.Attribute,descriptor:{name:"a_Instance64Low",shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:4,update:(t,e,i)=>[_r(i[3]),_r(i[4]),_r(i[5]),_r(i[6])]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:pt.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:2,update:t=>{const e=this.iconService.getIconMap(),{texture:i}=t,{x:n,y:a}=e[i]||{x:0,y:0};return[n,a]}}}),this.styleAttributeService.registerStyleAttribute({name:"thetaOffset",type:pt.Attribute,descriptor:{name:"a_ThetaOffset",shaderLocation:this.attributeLocation.THETA_OFFSET,buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:1,update:t=>{const{thetaOffset:e=1}=t;return[e]}}})}}const rQ=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_globel;
  float u_globel_radius;
  float u_global_height: 10;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0.0;
};

in vec4 v_color;
in vec4 v_dash_array;
in float v_segmentIndex;
in vec2 v_iconMapUV;
in vec4 v_line_data;

out vec4 outputColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // 运动速度
  float d_distance_ratio = v_line_data.g; // 当前点位距离占线总长的比例
  outputColor = v_color;

  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    outputColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      outputColor.a *= alpha;

      // u_animate
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // 贴图在弧线上重复的数量

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // 线图层贴图部分的 v 坐标值
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          outputColor = filterColor(pattern);
        }
    }

  } else {
    outputColor = filterColor(outputColor);
  }
}
`,iQ=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;
layout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;


layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_globel;
  float u_globel_radius;
  float u_global_height: 10;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0.0;
};
out vec4 v_color;
out vec4 v_dash_array;
out float v_segmentIndex;
out vec2 v_iconMapUV;
out vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return dir_screenspace.xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 是为了对齐坐标
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // 手动增加一些偏移，减轻面的冲突
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  //vs中计算渐变色
  if(u_linearColor==1.0){
    float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置
    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  }
  else{
    v_color = a_Color;
  }
  v_color.a = v_color.a * opacity;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0), a_Instance64Low.xy).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0), a_Instance64Low.zw).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    float total_Distance = pixelDistance(source, target) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // 当前点位距离占线总长的比例

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // 开启贴图模式

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // 线横向偏移的距离
    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离
    v_line_data.a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值

    v_iconMapUV = a_iconMapUV;
  }


  gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z * thetaOffset, 1.0));

  // 地球模式
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // 线的偏移
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // 计算起始点和终止点的距离
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // 计算飞线各个节点相应的高度
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // 地球点位
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;

    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }


  setPickingColor(a_PickingColor);
}
`,nQ={solid:0,dash:1};class ER extends Me{constructor(...t){super(...t),E(this,"texture",void 0),E(this,"updateTexture",()=>{const{createTexture2D:e}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=e({data:this.iconService.getCanvas(),mag:w.NEAREST,min:w.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,UV:12,THETA_OFFSET:13})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:e,textureBlend:i="normal",lineType:n="solid",dashArray:a=[10,5],lineTexture:o=!1,iconStep:s=100,segmentNumber:l=30,globalArcHeight:u=10}=this.layer.getLayerConfig(),{animateOption:c}=this.layer.getLayerConfig();a.length===2&&a.push(0,0);let h=0,f=[0,0,0,0],d=[0,0,0,0];if(t&&e&&(f=Pe(t),d=Pe(e),h=1),this.rendererService.getDirty()){var v;(v=this.texture)===null||v===void 0||v.bind()}const p={u_animate:this.animateOption2Array(c),u_dash_array:a,u_sourceColor:f,u_targetColor:d,u_textSize:[1024,this.iconService.canvasHeight||128],u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:aD,u_global_height:u,segmentNumber:l,u_line_type:nQ[n]||0,u_icon_step:s,u_line_texture:o?1:0,u_textureBlend:i==="normal"?0:1,u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:h};return this.getUniformsBufferInfo(p)}initModels(){var t=this;return Z(function*(){return t.initUniformsBuffer(),t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}getShaders(){return{frag:rQ,vert:iQ,type:""}}buildModels(){var t=this;return Z(function*(){const{segmentNumber:e=30}=t.layer.getLayerConfig(),{frag:i,vert:n,type:a}=t.getShaders();return[yield t.layer.buildLayerModel({moduleName:"lineArc3d"+a,vertexShader:n,fragmentShader:i,defines:t.getDefines(),inject:t.getInject(),triangulation:oS,styleOption:{segmentNumber:e}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:pt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:1,update:t=>{const{size:e=1}=t;return Array.isArray(e)?[e[0]]:[e]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:pt.Attribute,descriptor:{name:"a_Instance",shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:4,update:(t,e,i)=>[i[3],i[4],i[5],i[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"instance64Low",type:pt.Attribute,descriptor:{name:"a_Instance64Low",shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:4,update:(t,e,i)=>[_r(i[3]),_r(i[4]),_r(i[5]),_r(i[6])]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:pt.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:2,update:t=>{const e=this.iconService.getIconMap(),{texture:i}=t,{x:n,y:a}=e[i]||{x:0,y:0};return[n,a]}}}),this.styleAttributeService.registerStyleAttribute({name:"thetaOffset",type:pt.Attribute,descriptor:{name:"a_ThetaOffset",shaderLocation:this.attributeLocation.THETA_OFFSET,buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:1,update:t=>{const{thetaOffset:e=1}=t;return[e]}}})}}const SR={circle:2,triangle:2,diamond:4,rect:2,classic:3,halfTriangle:2,none:0},zi=1/2;function aQ(r,t){const{width:e=2,height:i=1}=t;return{vertices:[0,zi*r,1*r*e,-(i+zi)*r,1*r*e,(i-zi)*r,0,zi*r,1*r*e,-(i+zi)*r,1*r*e,(i-zi)*r],indices:[3,4,5],outLineIndices:[0,1,2],normals:[1*r,-2*r,1,-2*r,1.5*r,1,1*r,1.5*r,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function oQ(r,t){const{width:e=2,height:i=3}=t;return{vertices:[0,0,1*r*e,1*i,1*r*e,-1*i,0,0,1*r*e,1*i,1*r*e,-1*i],outLineIndices:[0,1,2],indices:[3,4,5],normals:[0,-1.5*r,1,2,1*r,1,-2,1*r,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function sQ(r,t){const{width:e=2,height:i=2}=t;return{vertices:[0,i/2,r*e*1,i/2,r*e*1,-i/2,0,-i/2,0,i/2,r*e*1,i/2,r*e*1,-i/2,0,-i/2],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-r,1,1,0,1,0,-r,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function lQ(r,t){const{width:e=2,height:i=3}=t;return{vertices:[0,0,1*e*r,.5*i,2*e*r,0,1*e*r,-.5*i,0,0,1*e*r,.5*i,2*e*r,0,1*e*r,-.5*i],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-r,1,1,0,1,0,-r,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function uQ(r,t){const{width:e=2,height:i=3}=t;return{vertices:[0,0,2*r*e,1*i,1.5*r*e,0,2*r*e,-1*i,0,0,2*r*e,1*i,1.5*r*e,0,2*r*e,-1*i],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-r,1,1,0,1,0,-r,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function cQ(r,t){const{width:e=2,height:i=2}=t,n=mx(),a=is.flatten([n]),o=is(a.vertices,a.holes,a.dimensions),s=n.map(l=>[l[0]*e*r,l[1]*i]).flat();return{vertices:[...s,...s],dimensions:2,indices:o.map(l=>l+n.length),outLineIndices:o,normals:[...n.map(l=>[l[1]*i,l[0]*e*r,1]).flat(),...new Array(n.length*3).fill(0)]}}function hQ(r,t=0,e){const i=typeof e.source=="object"?e.source.type:e.source,n=typeof e.target=="object"?e.target.type:e.target,{width:a=i?SR[i]:0}=typeof e.source=="object"?e.source:{},{width:o=n?SR[n]:0}=typeof e.target=="object"?e.target:{};return{vertices:[0,zi,1*a,...r,1,zi,-1*o,...r,1,-zi,-1*o,...r,0,-zi,1*a,...r,0,zi,1*a,...r,1,zi,-1*o,...r,1,-zi,-1*o,...r,0,-zi,1*a,...r],outLineIndices:[0,1,2,0,2,3].map(s=>s+t),indices:[4,5,6,4,6,7].map(s=>s+t),normals:[1,-1,1,1,1,1,-1,0,1,-1,0,1,0,0,0,0,0,0,0,0,0,0,0,0],dimensions:2}}function AR(r,t){const e=typeof r=="object"?r.type:r,i=t==="source"?1:-1,n=typeof r=="object"?r:{};switch(e){case"circle":return cQ(i,n);case"triangle":return oQ(i,n);case"diamond":return lQ(i,n);case"rect":return sQ(i,n);case"classic":return uQ(i,n);case"halfTriangle":return aQ(i,n);default:return{vertices:[],indices:[],normals:[],dimensions:2,outLineIndices:[],outLineNormals:[]}}}function fQ(r){const t=r.coordinates.flat(),e=1,i=1;return{vertices:[1,0,0,...t,1,2,-3,...t,1,1,-3,...t,0,1,0,...t,0,0,0,...t,1,0,0,...t,1,2,-3,...t,1,1,-3,...t,0,1,0,...t,0,0,0,...t],normals:[-e,2*i,1,2*i,-i,1,i,-i,1,i,-i,1,-e,-i,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function dQ(r,t){return t?vQ(r,t):fQ(r)}function vQ(r,t){const e=r.coordinates.flat(),{target:i="classic",source:n="circle"}=t,a=TR(AR(n,"source"),e,0,0),o=hQ(e,a.vertices.length/7,t),s=TR(AR(i,"target"),e,1,a.vertices.length/7+o.vertices.length/7);return{vertices:[...a.vertices,...o.vertices,...s.vertices],indices:[...a.outLineIndices,...o.outLineIndices,...s.outLineIndices,...a.indices,...o.indices,...s.indices],normals:[...a.normals,...o.normals,...s.normals],size:7}}function TR(r,t,e=1,i=0){const n=[],{vertices:a,indices:o,dimensions:s,outLineIndices:l}=r;for(let u=0;u<a.length;u+=s)n.push(e,a[u+1],a[u],...t);return G(G({},r),{},{vertices:n,indices:o.map(u=>u+i),outLineIndices:l.map(u=>u+i)})}const pQ=`// #extension GL_OES_standard_derivatives : enable

in vec4 v_color;
out vec4 outputColor;


// line texture

#pragma include "picking"

void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,gQ=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec2 a_Size;
layout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;
layout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

layout(std140) uniform commonUniorm {
  float u_gap_width: 1.0;
  float u_stroke_width: 1.0;
  float u_stroke_opacity: 1.0;
};

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

out vec4 v_color;

vec2 project_pixel_offset(vec2 offsets) {
  vec2 data = project_pixel(offsets);

  return vec2(data.x, -data.y);
}

vec2 line_dir(vec2 target, vec2 source) {
  return normalize(ProjectFlat(target) - ProjectFlat(source));
}


void main() {
  // 透明度计算
  vec2 source_world = a_Instance.rg; // 起点
  vec2 target_world = a_Instance.ba; // 终点
  vec2 flowlineDir = line_dir(target_world, source_world);
  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x);

  vec2 position = mix(source_world, target_world, a_Position.x);
  vec2 position64Low = mix(a_Instance64Low.rg, a_Instance64Low.ba, a_Position.x);

  float lengthCommon = length(
    project_position(vec4(target_world, 0, 1)) - project_position(vec4(source_world, 0, 1))
  );
  vec2 offsetDistances = a_Size.x * project_pixel_offset(vec2(a_Position.y, a_Position.z)); // Mapbox || 高德
  vec2 limitedOffsetDistances = clamp(
    offsetDistances,
    project_pixel(-lengthCommon * 0.2),
    project_pixel(lengthCommon * 0.2)
  );

  float startOffsetCommon = project_pixel(offsets[0]);
  float endOffsetCommon = project_pixel(offsets[1]);
  float endpointOffset = mix(
    clamp(startOffsetCommon, 0.0, lengthCommon * 0.2),
    -clamp(endOffsetCommon, 0.0, lengthCommon * 0.2),
    a_Position.x
  );

  vec2 normalsCommon = u_stroke_width * project_pixel_offset(vec2(a_Normal.x, a_Normal.y));

  float gapCommon = -1. * project_pixel(u_gap_width);
  vec3 offsetCommon = vec3(
    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -
      perpendicularDir * (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),
    0.0
  );

  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0), position64Low);

  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);
  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy +  offsetCommon.xy, 0., 1.0));

  setPickingColor(a_PickingColor);
}
`;class mQ extends Me{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,NORMAL:12})}getCommonUniformsInfo(){const{gapWidth:t=2,strokeWidth:e=1,strokeOpacity:i=1}=this.layer.getLayerConfig(),n={u_gap_width:t,u_stroke_width:e,u_stroke_opacity:i};return this.getUniformsBufferInfo(n)}initModels(){var t=this;return Z(function*(){return t.initUniformsBuffer(),t.buildModels()})()}buildModels(){var t=this;return Z(function*(){return[yield t.layer.buildLayerModel({moduleName:"flow_line",vertexShader:gQ,fragmentShader:pQ,defines:t.getDefines(),inject:t.getInject(),triangulation:dQ,styleOption:t.layer.getLayerConfig().symbol,primitive:w.TRIANGLES,depth:{enable:!1},pick:!1})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:pt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:2,update:t=>{const{size:e=1}=t;return Array.isArray(e)?[e[0],e[1]]:[e,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:pt.Attribute,descriptor:{name:"a_Instance",shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:4,update:(t,e,i)=>[i[3],i[4],i[5],i[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"instance64Low",type:pt.Attribute,descriptor:{name:"a_Instance64Low",shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:4,update:(t,e,i)=>[_r(i[3]),_r(i[4]),_r(i[5]),_r(i[6])]}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:pt.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:3,update:(t,e,i,n,a)=>a}})}}const yQ=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0;
};

in vec4 v_dash_array;
in vec4 v_color;
in vec2 v_iconMapUV;
in vec4 v_line_data;
in float v_distance_ratio;

out vec4 outputColor;
#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {

  float animateSpeed = 0.0;
  float d_segmentIndex = v_line_data.g;

  // 设置弧线的底色
  if(u_linearColor == 1.0) { // 使用渐变颜色
    outputColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
    outputColor.a *= v_color.a;
  } else { // 使用 color 方法传入的颜色
    outputColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // 实线部分
    } else {
      // 虚线部分
      discard;
    };
  }

  // 设置弧线的动画模式
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  // 设置弧线的贴图
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) {
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // 贴图在弧线上重复的数量
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = outputColor.a/v_color.a;
    }

    float v = v_line_data.a; // 线图层贴图部分的 v 坐标值

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    // 设置贴图和底色的叠加模式
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
  } else {
    outputColor = filterColor(outputColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,_Q=`#define LineTypeSolid (0.0)
#define LineTypeDash (1.0)
#define Animate (0.0)
#define LineTexture (1.0)

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;
layout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0;
};

out vec4 v_dash_array;
out vec4 v_color;
out vec2 v_iconMapUV;
out vec4 v_line_data;
out float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps(float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return index / (segmentNumber - 1.0);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(mix(source, target, segmentRatio), sqrt(max(0.0, vertex_height)));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return dir_screenspace.xy * sign(offset_direction);
}
float getAngularDist(vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) * sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2 * cos(theta2) + source.x, r2 * sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1.0 - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate(vec2 source, vec2 target, float angularDist, float t) {
  if (abs(angularDist - PI) < 0.001) {
    return (1.0 - t) * source + t * target;
  }
  float a = sin((1.0 - t) * angularDist) / sin(angularDist);
  float b = sin(t * angularDist) / sin(angularDist);
  vec2 sin_source = sin(source);
  vec2 cos_source = cos(source);
  vec2 sin_target = sin(target);
  vec2 cos_target = cos(target);
  float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
  float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
  float z = a * sin_source.y + b * sin_target.y;
  return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));

}

void main() {
  v_color = a_Color;
  v_color.a = v_color.a * opacity;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if (u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    float total_Distance = pixelDistance(source, target) / 2.0 * PI;
    total_Distance = total_Distance * 16.0; // total_Distance*16.0 调整默认的效果
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if (u_animate.x == Animate) {
    v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;

  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0), a_Instance64Low.xy);
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0), a_Instance64Low.zw);

  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_line_data.g = a_Position.x; // 该顶点在弧线上的分段排序
  if (LineTexture == u_line_texture) {
    float d_arcDistrance = length(source - target);
    d_arcDistrance = project_pixel(d_arcDistrance);

    float d_pixelLen = project_pixel(u_icon_step) / 8.0;
    v_line_data.b = floor(d_arcDistrance / d_pixelLen); // 贴图在弧线上重复的数量

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离
    float linePixelSize = project_pixel(a_Size); // 定点位置偏移，按地图等级缩放后的距离
    v_line_data.a = lineOffsetWidth / linePixelSize; // 线图层贴图部分的 v 坐标值

    v_iconMapUV = a_iconMapUV;
  }

  gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  setPickingColor(a_PickingColor);
}

`,xQ={solid:0,dash:1};class CQ extends Me{constructor(...t){super(...t),E(this,"texture",void 0),E(this,"updateTexture",()=>{const{createTexture2D:e}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=e({data:this.iconService.getCanvas(),mag:w.NEAREST,min:w.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,UV:12})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:e,textureBlend:i="normal",lineType:n="solid",dashArray:a=[10,5],lineTexture:o=!1,iconStep:s=100,segmentNumber:l=30}=this.layer.getLayerConfig(),{animateOption:u}=this.layer.getLayerConfig();if(a.length===2&&a.push(0,0),this.rendererService.getDirty()){var c;(c=this.texture)===null||c===void 0||c.bind()}let h=0,f=[0,0,0,0],d=[0,0,0,0];t&&e&&(f=Pe(t),d=Pe(e),h=1);let v=this.layer.getLayerAnimateTime();isNaN(v)&&(v=0);const p={u_animate:this.animateOption2Array(u),u_dash_array:a,u_sourceColor:f,u_targetColor:d,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:l,u_line_type:xQ[n]||0,u_icon_step:s,u_line_texture:o?1:0,u_textureBlend:i==="normal"?0:1,u_time:v,u_linearColor:h};return this.getUniformsBufferInfo(p)}initModels(){var t=this;return Z(function*(){return t.initUniformsBuffer(),t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var t=this;return Z(function*(){const{segmentNumber:e=30}=t.layer.getLayerConfig();return[yield t.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:_Q,fragmentShader:yQ,triangulation:oS,styleOption:{segmentNumber:e},defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:pt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:1,update:t=>{const{size:e=1}=t;return Array.isArray(e)?[e[0]]:[e]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:pt.Attribute,descriptor:{name:"a_Instance",shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:4,update:(t,e,i)=>[i[3],i[4],i[5],i[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"instance64Low",type:pt.Attribute,descriptor:{name:"a_Instance64Low",shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:4,update:(t,e,i)=>[_r(i[3]),_r(i[4]),_r(i[5]),_r(i[6])]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:pt.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:2,update:t=>{const e=this.iconService.getIconMap(),{texture:i}=t,{x:n,y:a}=e[i]||{x:0,y:0};return[n,a]}}})}}const EQ=`// #extension GL_OES_standard_derivatives : enable
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_blur;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed: 0.0;
  float u_vertexScale: 1.0;
  float u_raisingHeight: 0.0;
  float u_strokeWidth: 0.0;
  float u_textureBlend;
  float u_line_texture;
  float u_linearDir: 1.0;
  float u_linearColor: 0;
  float u_time;
};

in vec4 v_color;
in vec4 v_stroke;
// dash
in vec4 v_dash_array;
in float v_d_distance_ratio;
in vec2 v_iconMapUV;
in vec4 v_texture_data;

out vec4 outputColor;
#pragma include "picking"

// [animate, duration, interval, trailLength],
void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      // 虚线部分
      discard;
    };
  }
  float animateSpeed = 0.0; // 运动速度
  float d_distance_ratio = v_texture_data.r; // 当前点位距离占线总长的比例
  if(u_linearDir < 1.0) {
    d_distance_ratio = v_texture_data.a;
  }
  if(u_linearColor == 1.0) { // 使用渐变颜色
    outputColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
    outputColor.a *= v_color.a;
  } else { // 使用 color 方法传入的颜色
     outputColor = v_color;
  }
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_texture_data.g;      // 当前顶点的距离
    float d_texPixelLen = v_texture_data.b;  // 贴图的像素长度，根据地图层级缩放
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_texture_data.a;  // 线图层贴图部分的 v 坐标值

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
     vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor += pattern;
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = pattern;
    }
  } 

  float v = v_texture_data.a;
  float strokeWidth = min(0.5, u_strokeWidth);
  // 绘制 border
  if(strokeWidth > 0.01) {
    float borderOuterWidth = strokeWidth / 2.0;


    if(v >= 1.0 - strokeWidth || v <= strokeWidth) {
      if(v > strokeWidth) { // 外侧
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - strokeWidth))/strokeWidth);
        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);
        outputColor.rgb = mix(outputColor.rgb, v_stroke.rgb, linear);
      } else if(v <= strokeWidth) {
        float linear = smoothstep(0.0, 1.0, v/strokeWidth);
        outputColor.rgb = mix(v_stroke.rgb, outputColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      outputColor.a = mix(0.0, outputColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = v_texture_data.a;
  if(blurV < 0.5) {
    outputColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    outputColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  outputColor = filterColor(outputColor);
}
`,SQ=`#define Animate (0.0)

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec2 a_Size;
layout(location = ATTRIBUTE_LOCATION_DISTANCE_INDEX) in vec3 a_DistanceAndIndexAndMiter;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec4 a_Normal_Total_Distance;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_blur;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed: 0.0;
  float u_vertexScale: 1.0;
  float u_raisingHeight: 0.0;
  float u_strokeWidth: 0.0;
  float u_textureBlend;
  float u_line_texture;
  float u_linearDir: 1.0;
  float u_linearColor: 0;
  float u_time;
};

out vec4 v_color;
out vec4 v_stroke;
//dash
out vec4 v_dash_array;
out float v_d_distance_ratio;
// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）
out vec2 v_iconMapUV;
out vec4 v_texture_data;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec2 a_DistanceAndIndex = a_DistanceAndIndexAndMiter.xy;
  float a_Miter = a_DistanceAndIndexAndMiter.z;
  vec3 a_Normal = a_Normal_Total_Distance.xyz;
  float a_Total_Distance = a_Normal_Total_Distance.w;
  //dash输出
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;

  // cal style mapping - 数据纹理映射部分的计算
  float d_texPixelLen; // 贴图的像素长度，根据地图层级缩放
  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);

  v_color = a_Color;
  v_color.a *= opacity;
  v_stroke = stroke;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * a_Normal;

  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // 线横向偏移的距离（向两侧偏移的和）
  float linePixelSize = project_pixel(a_Size.x) * 2.0; // 定点位置偏移，按地图等级缩放后的距离 单侧 * 2
  float texV = lineOffsetWidth / linePixelSize; // 线图层贴图部分的 v 坐标值

  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);
  // 设置数据集的参数

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0), a_Position64Low);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况 vertex height
  float lineHeight = a_Size.y; // size 第二个参数代表的高度 [linewidth, lineheight]

  // 兼容 mapbox 在线高度上的效果表现基本一致
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // mapbox
    // 保持高度相对不变
    float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
    h *= mapboxZoomScale;
    h += u_raisingHeight * mapboxZoomScale;
    if (u_heightfixed > 0.0) {
      lineHeight *= mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(
    vec4(project_pos.xy + offset, lineHeight + h, 1.0)
  );

  setPickingColor(a_PickingColor);
}
`;class hD extends Me{constructor(...t){super(...t),E(this,"textureEventFlag",!1),E(this,"texture",this.createTexture2D({data:new Uint8Array([0,0,0,0]),width:1,height:1})),E(this,"updateTexture",()=>{const{createTexture2D:e}=this.rendererService;if(this.textures.length===0&&(this.textures=[this.texture]),this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=e({data:this.iconService.getCanvas(),mag:w.NEAREST,min:w.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128})})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,DISTANCE_INDEX:10,NORMAL:11,UV:12})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:e,textureBlend:i="normal",lineType:n="solid",dashArray:a=[10,5,0,0],lineTexture:o=!1,iconStep:s=100,vertexHeightScale:l=20,strokeWidth:u=0,raisingHeight:c=0,heightfixed:h=!1,linearDir:f=uR.VERTICAL,blur:d=[1,1,1,0]}=this.layer.getLayerConfig();let v=a;if(n!=="dash"&&(v=[0,0,0,0]),v.length===2&&v.push(0,0),this.rendererService.getDirty()&&this.texture){var p;(p=this.texture)===null||p===void 0||p.bind()}const{animateOption:g}=this.layer.getLayerConfig();let m=0,y=[0,0,0,0],_=[0,0,0,0];t&&e&&(y=Pe(t),_=Pe(e),m=1);const x={u_animate:this.animateOption2Array(g),u_dash_array:v,u_blur:d,u_sourceColor:y,u_targetColor:_,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:s,u_heightfixed:Number(h),u_vertexScale:l,u_raisingHeight:Number(c),u_strokeWidth:u,u_textureBlend:i===pK.NORMAL?0:1,u_line_texture:o?1:0,u_linearDir:f===uR.VERTICAL?1:0,u_linearColor:m,u_time:this.layer.getLayerAnimateTime()||0};return this.getUniformsBufferInfo(x)}initModels(){var t=this;return Z(function*(){return t.initUniformsBuffer(),t.textureEventFlag||(t.textureEventFlag=!0,t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture)),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var t=this;return Z(function*(){const{depth:e=!1}=t.layer.getLayerConfig(),{frag:i,vert:n,type:a}=t.getShaders();return t.layer.triangulation=yx,[yield t.layer.buildLayerModel({moduleName:"line"+a,vertexShader:n,fragmentShader:i,triangulation:yx,defines:t.getDefines(),inject:t.getInject(),depth:{enable:e}})]})()}getShaders(){return{frag:EQ,vert:SQ,type:""}}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:pt.Attribute,descriptor:{name:"a_DistanceAndIndexAndMiter",shaderLocation:this.attributeLocation.DISTANCE_INDEX,buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:3,update:(t,e,i,n,a,o)=>o===void 0?[i[3],10,i[4]]:[i[3],o,i[4]]}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:pt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:2,update:t=>{const{size:e=1}=t;return Array.isArray(e)?[e[0],e[1]]:[e,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal_total_distance",type:pt.Attribute,descriptor:{name:"a_Normal_Total_Distance",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:4,update:(t,e,i,n,a)=>[...a,i[5]]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:pt.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:2,update:t=>{const e=this.iconService.getIconMap(),{texture:i}=t,{x:n,y:a}=e[i]||{x:0,y:0};return[n,a]}}})}}const AQ=`
layout(std140) uniform commonUniorm {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec4 u_dash_array;
  float u_vertexScale: 1.0;
  float u_linearColor: 0;
};
in float v_distanceScale;
in vec4 v_color;
//dash
in vec4 v_dash_array;

out vec4 outputColor;
void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_distanceScale, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      // 虚线部分
      discard;
    };
  }
  if(u_linearColor==1.0){
    outputColor = mix(u_sourceColor, u_targetColor, v_distanceScale);
    outputColor.a *= v_color.a; // 全局透明度
  }
  else{
    outputColor = v_color;
  }
}
`,TQ=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec4 a_SizeDistanceAndTotalDistance;

layout(std140) uniform commonUniorm {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec4 u_dash_array;
  float u_vertexScale: 1.0;
  float u_linearColor: 0;
};

#pragma include "projection"
#pragma include "picking"

out vec4 v_color;
out float v_distanceScale;
out vec4 v_dash_array;

void main() {
  //dash输出
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_SizeDistanceAndTotalDistance.a;

  v_color = a_Color;
  v_distanceScale = a_SizeDistanceAndTotalDistance.b / a_SizeDistanceAndTotalDistance.a;
  v_color.a = v_color.a * opacity;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0), a_Position64Low);

  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况

  float lineHeight = a_SizeDistanceAndTotalDistance.y;
  // 兼容 mapbox 在线高度上的效果表现基本一致
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // 保持高度相对不变
    h *= 2.0 / pow(2.0, 20.0 - u_Zoom);
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
  gl_PointSize = 10.0;

}
`;class bQ extends Me{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:e,lineType:i="solid",dashArray:n=[10,5,0,0],vertexHeightScale:a=20}=this.layer.getLayerConfig();let o=n;i!=="dash"&&(o=[0,0,0,0]),o.length===2&&o.push(0,0);let s=0,l=[0,0,0,0],u=[0,0,0,0];t&&e&&(l=Pe(t),u=Pe(e),s=1);const c={u_sourceColor:l,u_targetColor:u,u_dash_array:o,u_vertexScale:a,u_linearColor:s};return this.getUniformsBufferInfo(c)}initModels(){var t=this;return Z(function*(){return t.buildModels()})()}getShaders(){return{frag:AQ,vert:TQ,type:"lineSimpleNormal"}}buildModels(){var t=this;return Z(function*(){t.initUniformsBuffer();const{frag:e,vert:i,type:n}=t.getShaders();return[yield t.layer.buildLayerModel({moduleName:n,vertexShader:i,fragmentShader:e,triangulation:CK,defines:t.getDefines(),inject:t.getInject(),primitive:w.LINES,depth:{enable:!1},pick:!1})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"sizeDistanceAndTotalDistance",type:pt.Attribute,descriptor:{name:"a_SizeDistanceAndTotalDistance",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:4,update:(t,e,i)=>{const{size:n=1}=t,a=Array.isArray(n)?[n[0],n[1]]:[n,0];return[a[0],a[1],i[3],i[5]]}}})}}const wQ=`#define Animate 0.0
#define LineTexture 1.0

// line texture

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed;
  float u_linearColor: 0;
  float u_line_texture;
  float u_textureBlend;
  float u_iconStepCount;
  float u_time;
};


in vec2 v_iconMapUV;
in vec4 v_color;
in float v_blur;
in vec4 v_dataset;

out vec4 outputColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // 运动速度
  float d_distance_ratio = v_dataset.r; // 当前点位距离占线总长的比例
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // 使用渐变颜色
    outputColor = mix(u_sourceColor, u_targetColor, v);
  } else { // 使用 color 方法传入的颜色
     outputColor = v_color;
  }

  outputColor.a *= v_color.a; // 全局透明度
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // 当前顶点的距离
    float d_texPixelLen = v_dataset.b;  // 贴图的像素长度，根据地图层级缩放
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // 线图层贴图部分的 v 坐标值

    // 计算纹理间隔 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // 计算纹理间隔 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    // Tip: 判断纹理间隔
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
  }


  // blur - AA
  if(v < v_blur) {
    outputColor.a = mix(0.0, outputColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  outputColor = filterColor(outputColor);
}
`,RQ=`#define Animate 0.0
layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec2 a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;
layout(location = ATTRIBUTE_LOCATION_DISTANCE_MITER_TOTAL) in vec3 a_Distance_Total_Miter;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed;
  float u_linearColor: 0;
  float u_line_texture;
  float u_textureBlend;
  float u_iconStepCount;
  float u_time;
};

// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）
out vec2 v_iconMapUV;
out vec4 v_color;
out float v_blur;
out vec4 v_dataset;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  float a_Distance = a_Distance_Total_Miter.x;
  float a_Miter = a_Distance_Total_Miter.y;
  float a_Total_Distance = a_Distance_Total_Miter.z;

  float d_distance_ratio; // 当前点位距离占线总长的比例
  float d_texPixelLen; // 贴图的像素长度，根据地图层级缩放

  v_iconMapUV = a_iconMapUV;
  if (u_heightfixed < 1.0) {
    // 高度随 zoom 调整
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }

  if (u_animate.x == Animate || u_linearColor == 1.0) {
    d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0) / 2.0;
  // 设置数据集的参数
  v_dataset[0] = d_distance_ratio; // 当前点位距离占线总长的比例
  v_dataset[1] = a_Distance; // 当前顶点的距离
  v_dataset[2] = d_texPixelLen; // 贴图的像素长度，根据地图层级缩放
  v_dataset[3] = miter; // 线图层贴图部分的 v 坐标值 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0), a_Position64Low);

  float originSize = a_Size.x; // 固定高度
  if (u_heightfixed < 1.0) {
    originSize = project_float_meter(a_Size.x); // 高度随 zoom 调整
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  // 兼容 mapbox 在线高度上的效果表现基本一致
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // mapbox
    // 保持高度相对不变
    float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
    if (u_heightfixed > 0.0) {
      wallHeight *= mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));

  setPickingColor(a_PickingColor);
}
`;class MQ extends Me{constructor(...t){super(...t),E(this,"texture",void 0),E(this,"updateTexture",()=>{const{createTexture2D:e}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=e({data:this.iconService.getCanvas(),mag:w.NEAREST,min:w.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,NORMAL:12,UV:13,DISTANCE_MITER_TOTAL:15})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:e,textureBlend:i="normal",heightfixed:n=!1,lineTexture:a=!1,iconStep:o=100,iconStepCount:s=1}=this.layer.getLayerConfig(),{animateOption:l}=this.layer.getLayerConfig();if(this.rendererService.getDirty()){var u;(u=this.texture)===null||u===void 0||u.bind()}let c=0,h=[0,0,0,0],f=[0,0,0,0];t&&e&&(h=Pe(t),f=Pe(e),c=1);const d={u_animate:this.animateOption2Array(l),u_sourceColor:h,u_targetColor:f,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:o,u_heightfixed:Number(n),u_linearColor:c,u_line_texture:a?1:0,u_textureBlend:i==="normal"?0:1,u_iconStepCount:s,u_time:this.layer.getLayerAnimateTime()||0};return this.getUniformsBufferInfo(d)}initModels(){var t=this;return Z(function*(){return t.initUniformsBuffer(),t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var t=this;return Z(function*(){return[yield t.layer.buildLayerModel({moduleName:"lineWall",vertexShader:RQ,fragmentShader:wQ,triangulation:yx,defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1},blend:t.getBlend()})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"size",type:pt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:2,update:t=>{const{size:e=1}=t;return Array.isArray(e)?[e[0],e[1]]:[e,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:pt.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:3,update:(t,e,i,n,a)=>a}}),this.styleAttributeService.registerStyleAttribute({name:"distanceAndTotalAndMiter",type:pt.Attribute,descriptor:{name:"a_Distance_Total_Miter",shaderLocation:this.attributeLocation.DISTANCE_MITER_TOTAL,buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:3,update:(t,e,i)=>[i[3],i[4],i[5]]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:pt.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:2,update:t=>{const e=this.iconService.getIconMap(),{texture:i}=t,{x:n,y:a}=e[i]||{x:0,y:0};return[n,a]}}})}}const IQ={arc:eQ,arc3d:ER,greatcircle:CQ,wall:MQ,line:hD,simple:bQ,flowline:mQ,earthArc3d:ER},LQ=IQ;class Oc extends Fu{constructor(...t){super(...t),E(this,"type","LineLayer"),E(this,"enableShaderEncodeStyles",["stroke","offsets","opacity","thetaOffset"]),E(this,"arrowInsertCount",0),E(this,"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}})}buildModels(){var t=this;return Z(function*(){const e=t.getModelType();t.layerModel=new LQ[e](t),yield t.initLayerModels()})()}getDefaultConfig(){const t=this.getModelType();return{line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{},arrow:{}}[t]}getModelType(){var t;if(this.layerType)return this.layerType;const e=this.styleAttributeService.getLayerStyleAttribute("shape");return(e==null||(t=e.scale)===null||t===void 0?void 0:t.field)||"line"}processData(t){if(this.getModelType()!=="simple")return t;const e=[];return t.map(i=>{if(Array.isArray(i.coordinates)&&Array.isArray(i.coordinates[0])&&Array.isArray(i.coordinates[0][0])){const n=G({},i);i.coordinates.map(a=>{e.push(G(G({},n),{},{coordinates:a}))})}else e.push(i)}),e}}const OQ=`
layout(std140) uniform commonUniorm {
  vec4 u_stroke_color;
  float u_additive;
  float u_stroke_opacity;
  float u_stroke_width;
};

in vec4 v_color;
in float v_blur;
in float v_innerRadius;

out vec4 outputColor;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  // Tip: 片元到中心点的距离 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: 片元的剪切成圆形
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // 当存在 stroke 且 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      outputColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      outputColor = mix(v_color, stroke, mixR);
    } else {
      outputColor = v_color;
    }
  } else {
    // 当不存在 stroke 或 stroke <= 0.01
    outputColor = v_color;
  }

  outputColor = filterColor(outputColor);
  
  if(u_additive > 0.0) {
    outputColor *= circleClipOpacity;
  } else {
    outputColor.a *= circleClipOpacity;
  }

}
`,PQ=`
layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;

layout(std140) uniform commonUniorm {
  vec4 u_stroke_color;
  float u_additive;
  float u_stroke_opacity;
  float u_stroke_width;
};

out vec4 v_color;
out float v_blur;
out float v_innerRadius;

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_blur = 1.0 - max(2.0 / a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  vec2 offset = project_pixel(u_offsets);

  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function bR(r){const t=r.coordinates;return{vertices:[...t],indices:[0],size:t.length}}class FQ extends Me{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9})}getDefaultStyle(){return{blend:"additive"}}getCommonUniformsInfo(){const{blend:t,strokeOpacity:e=1,strokeWidth:i=0,stroke:n="#fff"}=this.layer.getLayerConfig(),a={u_stroke_color:Pe(n),u_additive:t==="additive"?1:0,u_stroke_opacity:e,u_stroke_width:i};return this.getUniformsBufferInfo(a)}initModels(){var t=this;return Z(function*(){return t.buildModels()})()}buildModels(){var t=this;return Z(function*(){return t.layer.triangulation=bR,t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:PQ,fragmentShader:OQ,defines:t.getDefines(),inject:t.getInject(),triangulation:bR,depth:{enable:!1},primitive:w.POINTS})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"size",type:pt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:1,update:t=>{const{size:e=1}=t;return Array.isArray(e)?[e[0]]:[e]}}})}}const BQ=`precision highp float;
in vec4 v_color;

#pragma include "picking"

layout(std140) uniform commonUniform {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor: 0;
  float u_heightfixed: 0.0; // 默认不固定
  float u_globel;
  float u_r;
  float u_pickLight: 0.0;
  float u_opacitylinear: 0.0;
  float u_opacitylinear_dir: 1.0;
  float u_lightEnable: 1.0;
};
in float v_lightWeight;
in float v_barLinearZ;
out vec4 outputColor;
void main() {

   outputColor = v_color;

  // 开启透明度渐变
  if(u_opacitylinear > 0.0) {
    outputColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,DQ=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec3 a_Size;
layout(location = ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

layout(std140) uniform commonUniform {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor: 0;
  float u_heightfixed: 0.0; // 默认不固定
  float u_globel;
  float u_r;
  float u_pickLight: 0.0;
  float u_opacitylinear: 0.0;
  float u_opacitylinear_dir: 1.0;
  float u_lightEnable: 1.0;
};

out vec4 v_color;
out float v_lightWeight;
out float v_barLinearZ;
// 用于将在顶点着色器中计算好的样式值传递给片元


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) +
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - 数据纹理映射部分的计算
  vec3 size = a_Size * a_Position;

  // a_Position.z 是在构建网格的时候传入的标准值 0 - 1，在插值器插值可以获取 0～1 线性渐变的值
  v_barLinearZ =  a_Position.z;

  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移
  if(u_heightfixed < 1.0) { // 圆柱体不固定高度
    //
  } else {// 圆柱体固定高度 （ 处理 mapbox ）
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r 控制圆柱的生长
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // 圆柱光照效果
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // 取消三元表达式，增强健壮性
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;
  // 设置圆柱的底色
  if(u_linearColor == 1.0) { // 使用渐变颜色
    v_color = mix(u_sourceColor, u_targetColor, v_barLinearZ);
    v_color.rgb *= lightWeight;
  } else { // 使用 color 方法传入的颜色
     v_color = a_Color;
  }
  v_color.a *= u_opacity;


  // 在地球模式下，将原本垂直于 xy 平面的圆柱调整姿态到适应圆的角度
  //旋转矩阵mx，创建绕x轴旋转矩阵
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//求解旋转角度余弦值
  float xsin = sin(xRadian);//求解旋转角度正弦值
  mat4 mx = mat4(
    1,0,0,0,
    0,xcos,-xsin,0,
    0,xsin,xcos,0,
    0,0,0,1);

  //旋转矩阵my，创建绕y轴旋转矩阵
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//求解旋转角度余弦值
  float ysin = sin(yRadian);//求解旋转角度正弦值
  mat4 my = mat4(
    ycos,0,-ysin,0,
    0,1,0,0,
    ysin,0,ycos,0,
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);


  setPickingColor(a_PickingColor);
}
`,{isNumber:NQ}=er;let kQ=class extends Me{constructor(...t){super(...t),E(this,"raiseCount",0),E(this,"raiseRepeat",0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,POS:10,NORMAL:11})}getCommonUniformsInfo(){const{animateOption:t={enable:!1,speed:.01,repeat:!1},opacity:e=1,sourceColor:i,targetColor:n,pickLight:a=!1,heightfixed:o=!0,opacityLinear:s={enable:!1,dir:"up"},lightEnable:l=!0}=this.layer.getLayerConfig();let u=0,c=[0,0,0,0],h=[0,0,0,0];if(i&&n&&(c=Pe(i),h=Pe(n),u=1),this.raiseCount<1&&this.raiseRepeat>0&&t.enable){const{speed:v=.01}=t;this.raiseCount+=v,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}const f={u_sourceColor:c,u_targetColor:h,u_linearColor:u,u_pickLight:Number(a),u_heightfixed:Number(o),u_r:t.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:NQ(e)?e:1,u_opacitylinear:Number(s.enable),u_opacitylinear_dir:s.dir==="up"?1:0,u_lightEnable:Number(l)};return this.getUniformsBufferInfo(f)}initModels(){var t=this;return Z(function*(){return t.initUniformsBuffer(),t.buildModels()})()}buildModels(){var t=this;return Z(function*(){const{animateOption:{repeat:e=1}}=t.layer.getLayerConfig();return t.raiseRepeat=e,[yield t.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:DQ,fragmentShader:BQ,triangulation:aS,depth:{enable:!0},defines:t.getDefines(),inject:t.getInject(),cull:{enable:!0,face:w.FRONT},blend:t.getBlend()})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:pt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:3,update:t=>{const{size:e}=t;if(e){let i=[];return Array.isArray(e)&&(i=e.length===2?[e[0],e[0],e[1]]:e),Array.isArray(e)||(i=[e,e,e]),i}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:pt.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:3,update:(t,e,i,n,a)=>a}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:pt.Attribute,descriptor:{name:"a_Pos",shaderLocation:this.attributeLocation.POS,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:3,update:t=>{const e=cu(t.coordinates);return oD([e[0],e[1]])}}})}};const UQ=`in vec4 v_data;
in vec4 v_color;
in float v_radius;

layout(std140) uniform commonUniform {
  float u_additive;
  float u_stroke_opacity : 1;
  float u_stroke_width : 2;
  float u_blur : 0.0;
};
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 strokeColor = u_stroke == vec4(0.0) ? v_color : u_stroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(u_stroke_width < 0.01) {
    outputColor = vec4(v_color.rgb, v_color.a * u_opacity);
  } else {
    outputColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor = filterColor(outputColor);
  }
}
`,zQ=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_SHAPE) in float a_Shape;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;

layout(std140) uniform commonUniform {
  float u_additive;
  float u_stroke_opacity : 1;
  float u_stroke_width : 2;
  float u_blur : 0.0;
};
out vec4 v_data;
out vec4 v_color;
out float v_radius;

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize 设置拾取大小
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) 是为了兼容地球模式
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + vec3(u_offsets,0.0), 1.0);

  setPickingColor(a_PickingColor);
}
`;let HQ=class extends Me{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,SHAPE:10,EXTRUDE:11})}getCommonUniformsInfo(){const{strokeOpacity:t=1,strokeWidth:e=0,blend:i,blur:n=0}=this.layer.getLayerConfig();this.layer.getLayerConfig();const a={u_additive:i==="additive"?1:0,u_stroke_opacity:t,u_stroke_width:e,u_blur:n};return this.getUniformsBufferInfo(a)}initModels(){var t=this;return Z(function*(){return t.initUniformsBuffer(),t.buildModels()})()}buildModels(){var t=this;return Z(function*(){return t.layer.triangulation=yR,[yield t.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:zQ,fragmentShader:UQ,triangulation:yR,defines:t.getDefines(),inject:t.getInject(),depth:{enable:!0},blend:t.getBlend()})]})()}animateOption2Array(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:pt.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:3,update:(t,e,i,n)=>{const[a,o,s]=i,l=Yr(0,0,1),u=Yr(a,0,s),c=a>=0?g2(l,u):Math.PI*2-g2(l,u),h=Math.PI*2-Math.asin(o/100),f=Ou();vv(f,f,c),Sh(f,f,h);const d=Yr(1,1,0);mp(d,d,f),Mf(d,d);const v=Yr(-1,1,0);mp(v,v,f),Mf(v,v);const p=Yr(-1,-1,0);mp(p,p,f),Mf(p,p);const g=Yr(1,-1,0);mp(g,g,f),Mf(g,g);const m=[...d,...v,...p,...g],y=n%4*3;return[m[y],m[y+1],m[y+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:pt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:1,update:t=>{const{size:e=5}=t;return Array.isArray(e)?[e[0]]:[e]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:pt.Attribute,descriptor:{name:"a_Shape",shaderLocation:this.attributeLocation.SHAPE,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:1,update:t=>{const{shape:e=2}=t;return[this.layer.getLayerConfig().shape2d.indexOf(e)]}}})}};const $Q=`
in vec4 v_color;
in float v_lightWeight;
out vec4 outputColor;

layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};

#pragma include "scene_uniforms"
#pragma include "picking"

void main() {

  outputColor = v_color;
  // 开启透明度渐变
  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,WQ=`#define pi (3.1415926535)

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec3 a_Size;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec4 a_Extrude;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};
out vec4 v_color;
out float v_lightWeight;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if (x > 0.0 && z > 0.0) {
    return atan(x / z);
  } else if (x > 0.0 && z <= 0.0) {
    return atan(-z / x) + pi / 2.0;
  } else if (x <= 0.0 && z <= 0.0) {
    return pi + atan(x / z); //atan(x/z) +
  } else {
    return atan(z / -x) + pi * 3.0 / 2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y / r);
}

void main() {
  vec3 size = a_Size * a_Position;

  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移

  if (u_heightfixed < 1.0) {
    // 圆柱体不固定高度
  } else {
    // 圆柱体固定高度 （ 处理 mapbox ）
    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      offset *= 4.0 / pow(2.0, 21.0 - u_Zoom);
    }
  }

  vec2 positions = a_Extrude.xy;
  vec2 positions64Low = a_Extrude.zw;
  vec4 project_pos = project_position(vec4(positions, 0.0, 1.0), positions64Low);

  // u_r 控制圆柱的生长
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // // 圆柱光照效果
  float lightWeight = 1.0;

  if (u_lightEnable > 0.0) {
    // 取消三元表达式，增强健壮性
    lightWeight = calc_lighting(pos);
  }

  v_lightWeight = lightWeight;

  v_color = a_Color;

  // 设置圆柱的底色
  if (u_linearColor == 1.0) {
    // 使用渐变颜色
    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);
    v_color.a = v_color.a * opacity;
  } else {
    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);
  }

  if (u_opacitylinear > 0.0) {
    v_color.a *= u_opacitylinear_dir > 0.0 ? 1.0 - a_Position.z : a_Position.z;
  }

  gl_Position = project_common_position_to_clipspace(pos);

  setPickingColor(a_PickingColor);
}
`;let fD=class extends Me{constructor(...t){super(...t),E(this,"raiseCount",0),E(this,"raiseRepeat",0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,EXTRUDE:10,NORMAL:11})}getCommonUniformsInfo(){const{animateOption:t={enable:!1,speed:.01,repeat:!1},sourceColor:e,targetColor:i,pickLight:n=!1,heightfixed:a=!1,opacityLinear:o={enable:!1,dir:"up"},lightEnable:s=!0}=this.layer.getLayerConfig();let l=0,u=[0,0,0,0],c=[0,0,0,0];if(e&&i&&(u=Pe(e),c=Pe(i),l=1),this.raiseCount<1&&this.raiseRepeat>0&&t.enable){const{speed:d=.01}=t;this.raiseCount+=d,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}const h={u_pickLight:Number(n),u_heightfixed:Number(a),u_r:t.enable&&this.raiseRepeat>0?this.raiseCount:1,u_linearColor:l,u_sourceColor:u,u_targetColor:c,u_opacitylinear:Number(o.enable),u_opacitylinear_dir:o.dir==="up"?1:0,u_lightEnable:Number(s)};return this.getUniformsBufferInfo(h)}initModels(){var t=this;return Z(function*(){return t.buildModels()})()}buildModels(){var t=this;return Z(function*(){const{depth:e=!0,animateOption:{repeat:i=1}}=t.layer.getLayerConfig();return t.raiseRepeat=i,t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:WQ,fragmentShader:$Q,triangulation:aS,defines:t.getDefines(),inject:t.getInject(),cull:{enable:!0,face:w.FRONT},depth:{enable:e}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:pt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:3,update:t=>{const{size:e}=t;if(e){let i=[];return Array.isArray(e)&&(i=e.length===2?[e[0],e[0],e[1]]:e),Array.isArray(e)||(i=[e,e,e]),i}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:pt.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:3,update:(t,e,i,n,a)=>a}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:pt.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:4,update:t=>{const e=cu(t.coordinates);return[e[0],e[1],_r(e[0]),_r(e[1])]}}})}};const VQ=`
layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
  float u_time;
  vec4 u_animate;
};

in vec4 v_color;
in vec4 v_stroke;
in vec4 v_data;
in float v_radius;

#pragma include "scene_uniforms"
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));
  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  if(u_stroke_width < 0.01) {
    outputColor = v_color;
  } else {
    outputColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);
  }
  float intensity = 1.0;
  if(u_time!=-1.0){
    //wave相关逻辑
    float d = length(v_data.xy);
    if(d > 0.5) {
      discard;
    }
    intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor *= intensity;//wave
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor.a *= intensity;//wave 
    outputColor = filterColor(outputColor);
  }
   // 作为 mask 模板时需要丢弃透明的像素
  if(outputColor.a < 0.01) {
    discard;
  } 
}
`,GQ=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_SHAPE) in float a_Shape;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;

layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
  float u_time;
  vec4 u_animate;
};

out vec4 v_color;
out vec4 v_stroke;
out vec4 v_data;
out float v_radius;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // 透明度计算
   v_stroke = stroke;
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize 设置拾取大小
  *  u_meter2coord 在等面积大小的时候设置单位
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;



  // unpack color(vec2)
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if(u_size_unit == 1.0) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

   v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);

  offset = project_pixel(offset);
  offset = rotate_matrix(offset,rotation);

  // TODP: /abs(extrude.x) 是为了兼容地球模式
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0), a_Position64Low);
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_blur_height_fixed.y;

  if(u_blur_height_fixed.z < 1.0) { // false
    raisingHeight = project_pixel(u_blur_height_fixed.y);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  setPickingColor(a_PickingColor);
}
`;let dD=class extends Me{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,SHAPE:10,EXTRUDE:11})}getCommonUniformsInfo(){const{strokeOpacity:t=1,strokeWidth:e=0,blend:i,blur:n=0,raisingHeight:a=0,heightfixed:o=!1,unit:s="pixel"}=this.layer.getLayerConfig();let l=this.getAnimateUniforms().u_time;isNaN(l)&&(l=-1);const u={u_blur_height_fixed:[n,Number(a),Number(o)],u_stroke_width:e,u_additive:i==="additive"?1:0,u_stroke_opacity:t,u_size_unit:nS[s],u_time:l,u_animate:this.getAnimateUniforms().u_animate};return this.getUniformsBufferInfo(u)}getAnimateUniforms(){const{animateOption:t={enable:!1}}=this.layer.getLayerConfig();return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}getAttribute(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Ql)}initModels(){var t=this;return Z(function*(){return t.buildModels()})()}buildModels(){var t=this;return Z(function*(){const{frag:e,vert:i,type:n}=t.getShaders();return t.layer.triangulation=Ql,t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:n,vertexShader:i,fragmentShader:e,defines:t.getDefines(),inject:t.getInject(),triangulation:Ql,depth:{enable:!1}})]})()}getShaders(){return{frag:VQ,vert:GQ,type:"pointFill"}}animateOption2Array(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}registerBuiltinAttributes(){const t=this.layer.getLayerConfig().shape2d;this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:pt.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:3,update:(e,i,n,a)=>{const o=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],s=a%4*3;return[o[s],o[s+1],o[s+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:pt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:1,update:e=>{const{size:i=5}=e;return Array.isArray(i)?[i[0]]:[i]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:pt.Attribute,descriptor:{name:"a_Shape",shaderLocation:this.attributeLocation.SHAPE,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:1,update:e=>{const{shape:i=2}=e;return[t.indexOf(i)]}}})}};const XQ=`in vec2 v_uv;// 本身的 uv 坐标
in vec2 v_Iconuv;
in float v_opacity;
out vec4 outputColor;

uniform sampler2D u_texture;
layout(std140) uniform commonUniform {
  vec2 u_textSize;
  float u_heightfixed: 0.0;
  float u_raisingHeight: 0.0;
  float u_size_unit;
};

#pragma include "scene_uniforms"
#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  outputColor = texture(SAMPLER_2D(u_texture), pos);
  outputColor.a *= v_opacity;
  outputColor = filterColor(outputColor);
}
`,YQ=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniform {
  vec2 u_textSize;
  float u_heightfixed;
  float u_raisingHeight;
  float u_size_unit;
};

out vec2 v_uv;
out vec2 v_Iconuv;
out float v_opacity;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  vec3 extrude = a_Extrude;
  v_uv = (a_Extrude.xy + 1.0) / 2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;
  v_opacity = opacity;
  float newSize = a_Size;
  if (u_size_unit == 1.0) {
    newSize = newSize * u_PixelsPerMeter.z;
  }

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = extrude.xy * newSize + offsets;

  offset = rotate_matrix(offset, rotation);

  offset = project_pixel(offset);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`;class jQ extends Me{constructor(...t){super(...t),E(this,"meter2coord",1),E(this,"texture",void 0),E(this,"isMeter",!1),E(this,"radian",0),E(this,"updateTexture",()=>{const{createTexture2D:e}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),this.layerService.throttleRenderLayers();return}this.texture=e({data:this.iconService.getCanvas(),mag:w.LINEAR,min:w.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128,mipmap:!0}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,EXTRUDE:10,UV:11})}getCommonUniformsInfo(){const{raisingHeight:t=0,heightfixed:e=!1,unit:i="pixel"}=this.layer.getLayerConfig();if(this.rendererService.getDirty()){var n;(n=this.texture)===null||n===void 0||n.bind()}const a={u_textSize:[1024,this.iconService.canvasHeight||128],u_heightfixed:Number(e),u_raisingHeight:Number(t),u_size_unit:nS[i]};return this.getUniformsBufferInfo(a)}getAttribute(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Ql)}initModels(){var t=this;return Z(function*(){return t.iconService.on("imageUpdate",t.updateTexture),t.updateTexture(),t.buildModels()})()}buildModels(){var t=this;return Z(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:YQ,fragmentShader:XQ,triangulation:Ql,depth:{enable:!1},defines:t.getDefines(),inject:t.getInject(),cull:{enable:!0,face:w.FRONT}})]})()}clearModels(){var t;this.iconService.off("imageUpdate",this.updateTexture),(t=this.texture)===null||t===void 0||t.destroy()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:pt.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:2,update:t=>{const e=this.iconService.getIconMap(),{shape:i}=t,{x:n,y:a}=e[i]||{x:-64,y:-64};return[n,a]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:pt.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:3,update:(t,e,i,n)=>{const a=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=n%4*3;return[a[o],a[o+1],a[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:pt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:1,update:t=>{const{size:e=5}=t;return Array.isArray(e)?[e[0]]:[e]}}})}}const ZQ=`layout(std140) uniform commonUniforms {
  vec2 u_textSize;
  float u_raisingHeight;
  float u_heightfixed;
};

uniform sampler2D u_texture;

in vec4 v_color;
in vec2 v_uv;
in float v_opacity;

#pragma include "picking"

out vec4 outputColor;

void main(){
  vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
  vec4 textureColor;

  // Y = 0.299R + 0.587G + 0.114B // 亮度提取
  
  textureColor = texture(SAMPLER_2D(u_texture), pos);

  // Tip: 去除边缘部分 mipmap 导致的混合变暗
  float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
  if(fragmengTocenter >= 0.5) {
        float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
        textureColor.a *= luma;
  }
  
  if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
        outputColor= textureColor;
  }else {
        outputColor= step(0.01, textureColor.z) * v_color;
  }
  outputColor.a *= v_opacity;
  if (outputColor.a < 0.01) {
      discard;
  }
  outputColor = filterColor(outputColor);
}
`,qQ=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_textSize;
  float u_raisingHeight;
  float u_heightfixed;
};

out vec4 v_color;
out vec2 v_uv;
out float v_opacity;

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - 数据纹理映射部分的计算
  v_color = a_Color;
  v_opacity = opacity;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);

  vec2 offset = project_pixel(offsets);

  float raisingHeight = u_raisingHeight;
  if (u_heightfixed < 1.0) {
    // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;class vD extends Me{constructor(...t){super(...t),E(this,"texture",void 0),E(this,"updateTexture",()=>{const{createTexture2D:e}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),setTimeout(()=>{this.layerService.throttleRenderLayers()});return}this.texture=e({data:this.iconService.getCanvas(),mag:w.LINEAR,min:w.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128,mipmap:!0})})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,UV:10})}getUninforms(){if(this.rendererService.getDirty()){var t;(t=this.texture)===null||t===void 0||t.bind()}const e=this.getCommonUniformsInfo(),i=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),G(G({},e.uniformsOption),i.uniformsOption)}getCommonUniformsInfo(){const{raisingHeight:t=0,heightfixed:e=!1}=this.layer.getLayerConfig(),i={u_textSize:[1024,this.iconService.canvasHeight||128],u_raisingHeight:Number(t),u_heightfixed:Number(e),u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(i)}initModels(){var t=this;return Z(function*(){return t.iconService.on("imageUpdate",t.updateTexture),t.updateTexture(),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var t=this;return Z(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointImage",vertexShader:qQ,fragmentShader:ZQ,triangulation:xK,defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1},primitive:w.POINTS})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"size",type:pt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:1,update:t=>{const{size:e=5}=t;return Array.isArray(e)?[e[0]]:[e]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:pt.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:2,update:t=>{const e=this.iconService.getIconMap(),{shape:i}=t,{x:n,y:a}=e[i]||{x:-64,y:-64};return[n,a]}}})}}const KQ=`in vec4 v_color;
out vec4 outputColor;
void main() {
  outputColor = v_color;
}`,QQ=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;

layout(std140) uniform u_Common {
  float u_size_scale;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(project_pos);

  gl_PointSize = a_Size * u_size_scale * 2.0 * u_DevicePixelRatio;
}
`;function wR(r){const t=r.coordinates;return{vertices:[...t],indices:[0],size:t.length}}class pD extends Me{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9})}getDefaultStyle(){return{blend:"additive"}}getCommonUniformsInfo(){const t={u_size_scale:.5};return this.getUniformsBufferInfo(t)}initModels(){var t=this;return Z(function*(){return t.buildModels()})()}buildModels(){var t=this;return Z(function*(){return t.layer.triangulation=wR,t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:QQ,fragmentShader:KQ,triangulation:wR,defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1},primitive:w.POINTS,pick:!1})]})()}clearModels(){}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"size",type:pt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:1,update:t=>{const{size:e=1}=t;return Array.isArray(e)?[e[0]]:[e]}}})}}const JQ=`
layout(std140) uniform commonUniorm{
  float u_additive;
  float u_size_unit;
  float u_speed: 1.0;
  float u_time;
};
in vec4 v_data;
in vec4 v_color;
in float v_radius;
in vec2 v_extrude;
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  outputColor = vec4(v_color.rgb, v_color.a);

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
  } else {
    outputColor.a *= opacity_t;
  }

  if(outputColor.a > 0.0) {
    outputColor = filterColor(outputColor);
  }

  vec2 extrude =  v_extrude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  outputColor.a *= radar_v;
}
`,tJ=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;

layout(std140) uniform commonUniorm {
  float u_additive;
  float u_size_unit;
  float u_speed: 1.0;
  float u_time;
};

out vec4 v_data;
out vec4 v_color;
out float v_radius;
out vec2 v_extrude;

#pragma include "projection"
#pragma include "picking"

void main() {
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2(
    cos(time), sin(time),
    -sin(time), cos(time)
  );
  v_extrude = rotateMatrix * a_Extrude.xy;

  v_color = a_Color;
  v_color.a *= opacity;

  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  if(u_size_unit == 1.) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  v_radius = newSize;

  vec2 offset = (a_Extrude.xy * (newSize));

  offset = project_pixel(offset);

  v_data = vec4(a_Extrude.x, a_Extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  setPickingColor(a_PickingColor);
}
`;class eJ extends Me{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,EXTRUDE:10})}getCommonUniformsInfo(){const{blend:t,speed:e=1,unit:i="pixel"}=this.layer.getLayerConfig(),n={u_additive:t==="additive"?1:0,u_size_unit:nS[i],u_speed:e,u_time:this.layer.getLayerAnimateTime()};return this.getUniformsBufferInfo(n)}getAnimateUniforms(){return{}}getAttribute(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Ql)}initModels(){var t=this;return Z(function*(){return t.buildModels()})()}buildModels(){var t=this;return Z(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:tJ,fragmentShader:JQ,triangulation:Ql,defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1}})]})()}animateOption2Array(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:pt.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:3,update:(t,e,i,n)=>{const a=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=n%4*3;return[a[o],a[o+1],a[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:pt.Attribute,descriptor:{shaderLocation:this.attributeLocation.SIZE,name:"a_Size",buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:1,update:t=>{const{size:e=5}=t;return Array.isArray(e)?[e[0]]:[e]}}})}}class rJ{constructor(t,e,i){E(this,"boxCells",[]),E(this,"xCellCount",void 0),E(this,"yCellCount",void 0),E(this,"boxKeys",void 0),E(this,"bboxes",void 0),E(this,"width",void 0),E(this,"height",void 0),E(this,"xScale",void 0),E(this,"yScale",void 0),E(this,"boxUid",void 0);const n=this.boxCells;this.xCellCount=Math.ceil(t/i),this.yCellCount=Math.ceil(e/i);for(let a=0;a<this.xCellCount*this.yCellCount;a++)n.push([]);this.boxKeys=[],this.bboxes=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0}insert(t,e,i,n,a){this.forEachCell(e,i,n,a,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(a)}query(t,e,i,n,a){return this.queryHitTest(t,e,i,n,!1,a)}hitTest(t,e,i,n,a){return this.queryHitTest(t,e,i,n,!0,a)}insertBoxCell(t,e,i,n,a,o){this.boxCells[a].push(o)}queryHitTest(t,e,i,n,a,o){if(i<0||t>this.width||n<0||e>this.height)return a?!1:[];const s=[];if(t<=0&&e<=0&&this.width<=i&&this.height<=n){if(a)return!0;for(let u=0;u<this.boxKeys.length;u++)s.push({key:this.boxKeys[u],x1:this.bboxes[u*4],y1:this.bboxes[u*4+1],x2:this.bboxes[u*4+2],y2:this.bboxes[u*4+3]});return o?s.filter(o):s}const l={hitTest:a,seenUids:{box:{},circle:{}}};return this.forEachCell(t,e,i,n,this.queryCell,s,l,o),a?s.length>0:s}queryCell(t,e,i,n,a,o,s,l){const u=s.seenUids,c=this.boxCells[a];if(c!==null){const h=this.bboxes;for(const f of c)if(!u.box[f]){u.box[f]=!0;const d=f*4;if(t<=h[d+2]&&e<=h[d+3]&&i>=h[d+0]&&n>=h[d+1]&&(!l||l(this.boxKeys[f]))){if(s.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[f],x1:h[d],y1:h[d+1],x2:h[d+2],y2:h[d+3]})}}}return!1}forEachCell(t,e,i,n,a,o,s,l){const u=this.convertToXCellCoord(t),c=this.convertToYCellCoord(e),h=this.convertToXCellCoord(i),f=this.convertToYCellCoord(n);for(let d=u;d<=h;d++)for(let v=c;v<=f;v++){const p=this.xCellCount*v+d;if(a.call(this,t,e,i,n,p,o,s,l))return}}convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}const iJ=rJ;class nJ{constructor(t,e){E(this,"width",void 0),E(this,"height",void 0),E(this,"grid",void 0),E(this,"viewportPadding",100),E(this,"screenRightBoundary",void 0),E(this,"screenBottomBoundary",void 0),E(this,"gridRightBoundary",void 0),E(this,"gridBottomBoundary",void 0),this.width=t,this.height=e,this.viewportPadding=Math.max(t,e),this.grid=new iJ(t+this.viewportPadding,e+this.viewportPadding,25),this.screenRightBoundary=t+this.viewportPadding,this.screenBottomBoundary=e+this.viewportPadding,this.gridRightBoundary=t+2*this.viewportPadding,this.gridBottomBoundary=e+2*this.viewportPadding}placeCollisionBox(t){const e=t.x1+t.anchorPointX+this.viewportPadding,i=t.y1+t.anchorPointY+this.viewportPadding,n=t.x2+t.anchorPointX+this.viewportPadding,a=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(e,i,n,a)||this.grid.hitTest(e,i,n,a)?{box:[]}:{box:[e,i,n,a]}}insertCollisionBox(t,e){const i={featureIndex:e};this.grid.insert(i,t[0],t[1],t[2],t[3])}project(t,e,i){const n=U$(e,i,0,1),a=z$(),o=H$(...t);return Nl(a,n,o),{x:(a[0]/a[3]+1)/2*this.width+this.viewportPadding,y:(-a[1]/a[3]+1)/2*this.height+this.viewportPadding}}isInsideGrid(t,e,i,n){return i>=0&&t<this.gridRightBoundary&&n>=0&&e<this.gridBottomBoundary}}function gD(r){let t=.5,e=.5;switch(r){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0;break;default:t=.5}switch(r){case"bottom":case"bottom-right":case"bottom-left":e=1;break;case"top":case"top-right":case"top-left":e=0;break;default:e=.5}return{horizontalAlign:t,verticalAlign:e}}function mD(r,t,e,i,n){if(!n)return;const a=r[i],o=a.glyph;if(o){const s=t[o].advance*a.scale,l=(r[i].x+s)*n;for(let u=e;u<=i;u++)r[u].x-=l}}function yD(r,t,e,i,n,a,o){const s=(t-e)*n,l=(-i*o+.5)*a;for(const u of r)u.x+=s,u.y+=l}function aJ(r,t,e,i,n,a,o){let l=0,u=-8,c=0;const h=r.positionedGlyphs,f=a==="right"?1:a==="left"?0:.5,d=h.length;e.forEach(m=>{if(m.split("").forEach(y=>{const _=t[y],x=0;_&&(h.push({glyph:y,x:l,y:u+x,vertical:!1,scale:1,metrics:_}),l+=_.advance+o)}),h.length!==d){const y=l-o;c=Math.max(y,c),mD(h,t,d,h.length-1,f)}l=0,u-=i+5});const{horizontalAlign:v,verticalAlign:p}=gD(n);yD(h,f,v,p,c,i,e.length);const g=u- -8;r.top+=-p*g,r.bottom=r.top-g,r.left+=-v*c,r.right=r.left+c}function oJ(r,t,e,i,n,a,o){let l=0,u=-8,c=0;const h=r.positionedGlyphs,f=a==="right"?1:a==="left"?0:.5,d=h.length;e.forEach(m=>{const y=t[m],_=0;if(y&&(h.push({glyph:m,x:y.advance/2,y:u+_,vertical:!1,scale:1,metrics:y}),l+=y.advance+o),h.length!==d){const x=l-o;c=Math.max(x,c),mD(h,t,d,h.length-1,f)}l=0,u-=i+5});const{horizontalAlign:v,verticalAlign:p}=gD(n);yD(h,f,v,p,c,i,e.length);const g=u- -8;r.top+=-p*g,r.bottom=r.top-g,r.left+=-v*c,r.right=r.left+c}function sJ(r,t,e,i,n,a,o=[0,0],s){const l=r.split(`
`),u=[],c={positionedGlyphs:u,top:o[1],bottom:o[1],left:o[0],right:o[0],lineCount:l.length,text:r};return s?oJ(c,t,l,e,i,n,a):aJ(c,t,l,e,i,n,a),u.length?c:!1}function lJ(r,t=[0,0],e){const{positionedGlyphs:i=[]}=r,n=[];for(const a of i){const o=a.metrics,s=4,l=o.advance*a.scale/2,u=e?[a.x+l,a.y]:[0,0],c=e?[0,0]:[a.x+l+t[0],a.y+t[1]],h=(0-s)*a.scale-l+c[0],f=(0-s)*a.scale+c[1],d=h+o.width*a.scale,v=f+o.height*a.scale,p={x:h,y:f},g={x:d,y:f},m={x:h,y:v},y={x:d,y:v};n.push({tl:p,tr:g,bl:m,br:y,tex:o,glyphOffset:u})}return n}const RR=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0

uniform sampler2D u_sdf_map;
layout(std140) uniform commonUniforms {
  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
  vec2 u_sdf_map_size;
  float u_raisingHeight: 0.0;
  float u_stroke_width : 2;
  float u_gamma_scale : 0.5;
  float u_halo_blur : 0.5;
};

in vec2 v_uv;
in float v_gamma_scale;
in vec4 v_color;
in vec4 v_stroke_color;
in float v_fontScale;

out vec4 outputColor;

#pragma include "picking"
void main() {
  // get style data mapping

  // get sdf from atlas
  float dist = texture(SAMPLER_2D(u_sdf_map), v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);

  outputColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));

  outputColor.a *= alpha;
   // 作为 mask 模板时需要丢弃透明的像素
  if (outputColor.a < 0.01) {
    discard;
  }
  outputColor = filterColor(outputColor);
}
`,MR=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_TEXT_OFFSETS) in vec2 a_textOffsets;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_tex;

layout(std140) uniform commonUniforms {
  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
  vec2 u_sdf_map_size;
  float u_raisingHeight: 0.0;
  float u_stroke_width : 2;
  float u_gamma_scale : 0.5;
  float u_halo_blur : 0.5;
};

out vec2 v_uv;
out float v_gamma_scale;
out vec4 v_color;
out vec4 v_stroke_color;
out float v_fontScale;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // cal style mapping - 数据纹理映射部分的计算

  v_uv = a_tex / u_sdf_map_size;



  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);

  // 文本缩放比例
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  vec2 offset = rotate_matrix(a_textOffsets,rotation);

  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));

  gl_Position = vec4(
    projected_position.xy / projected_position.w + offset * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`,{isEqual:lf}=er;function IR(r){const t=this,e=r.id,i=[],n=[];if(!t.glyphInfoMap||!t.glyphInfoMap[e])return{vertices:[],indices:[],size:7};const a=t.glyphInfoMap[e].centroid,o=a.length===2?[a[0],a[1],0]:a;return t.glyphInfoMap[e].glyphQuads.forEach((s,l)=>{i.push(...o,s.tex.x,s.tex.y+s.tex.height,s.tl.x,s.tl.y,...o,s.tex.x+s.tex.width,s.tex.y+s.tex.height,s.tr.x,s.tr.y,...o,s.tex.x+s.tex.width,s.tex.y,s.br.x,s.br.y,...o,s.tex.x,s.tex.y,s.bl.x,s.bl.y),n.push(0+l*4,1+l*4,2+l*4,2+l*4,3+l*4,0+l*4)}),{vertices:i,indices:n,size:7}}class _D extends Me{constructor(...t){var e;super(...t),e=this,E(this,"glyphInfo",void 0),E(this,"glyphInfoMap",{}),E(this,"rawEncodeData",void 0),E(this,"texture",void 0),E(this,"currentZoom",-1),E(this,"extent",void 0),E(this,"textureHeight",0),E(this,"textCount",0),E(this,"preTextStyle",{}),E(this,"mapping",Z(function*(){e.initGlyph(),e.updateTexture(),yield e.reBuildModel()}))}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,TEXT_OFFSETS:10,UV:11})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),G(G(G({},t.uniformsOption),e.uniformsOption),{u_sdf_map:this.textures[0]})}getCommonUniformsInfo(){const{stroke:t="#fff",strokeWidth:e=0,halo:i=.5,gamma:n=2,raisingHeight:a=0}=this.layer.getLayerConfig(),o=this.getFontServiceMapping(),s=this.getFontServiceCanvas();o&&Object.keys(o).length!==this.textCount&&s&&(this.updateTexture(),this.textCount=Object.keys(o).length),this.preTextStyle=this.getTextStyle();const l={u_stroke_color:Pe(t),u_sdf_map_size:[(s==null?void 0:s.width)||1,(s==null?void 0:s.height)||1],u_raisingHeight:Number(a),u_stroke_width:e,u_gamma_scale:n,u_halo_blur:i};return this.getUniformsBufferInfo(l)}initModels(){var t=this;return Z(function*(){return t.bindEvent(),t.extent=t.textExtent(),t.rawEncodeData=t.layer.getEncodedData(),t.preTextStyle=t.getTextStyle(),t.initUniformsBuffer(),t.buildModels()})()}buildModels(){var t=this;return Z(function*(){const{textAllowOverlap:e=!1}=t.layer.getLayerConfig();return t.initGlyph(),t.updateTexture(),e||t.filterGlyphs(),[yield t.layer.buildLayerModel({moduleName:"pointText",vertexShader:MR,fragmentShader:RR,defines:t.getDefines(),inject:t.getInject(),triangulation:IR.bind(t),depth:{enable:!1}})]})()}needUpdate(){var t=this;return Z(function*(){const{textAllowOverlap:e=!1,textAnchor:i="center",textOffset:n,padding:a,fontFamily:o,fontWeight:s}=t.getTextStyle();if(!lf(a,t.preTextStyle.padding)||!lf(n,t.preTextStyle.textOffset)||!lf(i,t.preTextStyle.textAnchor)||!lf(o,t.preTextStyle.fontFamily)||!lf(s,t.preTextStyle.fontWeight))return yield t.mapping(),!0;if(e)return!1;const l=t.mapService.getZoom(),u=t.mapService.getBounds(),c=hB(t.extent,u);return Math.abs(t.currentZoom-l)>.5||!c||e!==t.preTextStyle.textAllowOverlap?(yield t.reBuildModel(),!0):!1})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.layer.off("remapping",this.mapping)}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:pt.Attribute,descriptor:{shaderLocation:this.attributeLocation.TEXT_OFFSETS,name:"a_textOffsets",buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:2,update:(t,e,i)=>[i[5],i[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:pt.Attribute,descriptor:{name:"a_tex",shaderLocation:this.attributeLocation.UV,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:2,update:(t,e,i)=>[i[3],i[4]]}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:pt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:1,update:t=>{const{size:e=12}=t;return Array.isArray(e)?[e[0]]:[e]}}})}bindEvent(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}textExtent(){const t=this.mapService.getBounds();return KE(t,.5)}initTextFont(){const{fontWeight:t,fontFamily:e}=this.getTextStyle(),i=this.rawEncodeData,n=[];i.forEach(a=>{let{shape:o=""}=a;o=o.toString();for(const s of o)n.indexOf(s)===-1&&n.push(s)}),this.fontService.setFontOptions({characterSet:n,fontWeight:t,fontFamily:e,iconfont:!1})}initIconFontTex(){const{fontWeight:t,fontFamily:e}=this.getTextStyle(),i=this.rawEncodeData,n=[];i.forEach(a=>{let{shape:o=""}=a;o=`${o}`,n.indexOf(o)===-1&&n.push(o)}),this.fontService.setFontOptions({characterSet:n,fontWeight:t,fontFamily:e,iconfont:!0})}getTextStyle(){const{fontWeight:t="400",fontFamily:e="sans-serif",textAllowOverlap:i=!1,padding:n=[0,0],textAnchor:a="center",textOffset:o=[0,0],opacity:s=1,strokeOpacity:l=1,strokeWidth:u=0,stroke:c="#000"}=this.layer.getLayerConfig();return{fontWeight:t,fontFamily:e,textAllowOverlap:i,padding:n,textAnchor:a,textOffset:o,opacity:s,strokeOpacity:l,strokeWidth:u,stroke:c}}generateGlyphLayout(t){const e=this.getFontServiceMapping(),{spacing:i=2,textAnchor:n="center",textOffset:a}=this.layer.getLayerConfig(),o=this.rawEncodeData;this.glyphInfo=o.map(s=>{const{shape:l="",id:u,size:c=1}=s,h=s.textOffset?s.textOffset:a||[0,0],f=s.textAnchor?s.textAnchor:n||"center",d=sJ(l.toString(),e,c,f,"left",i,h,t),v=lJ(d,h,!1);return s.shaping=d,s.glyphQuads=v,s.centroid=cu(s.coordinates),this.glyphInfoMap[u]={shaping:d,glyphQuads:v,centroid:cu(s.coordinates)},s})}getFontServiceMapping(){const{fontWeight:t="400",fontFamily:e="sans-serif"}=this.layer.getLayerConfig();return this.fontService.getMappingByKey(`${e}_${t}`)}getFontServiceCanvas(){const{fontWeight:t="400",fontFamily:e="sans-serif"}=this.layer.getLayerConfig();return this.fontService.getCanvasByKey(`${e}_${t}`)}filterGlyphs(){const{padding:t=[0,0],textAllowOverlap:e=!1}=this.layer.getLayerConfig();if(e)return;this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();const{width:i,height:n}=this.rendererService.getViewportSize(),a=new nJ(i,n);this.glyphInfo.filter(s=>{const{shaping:l,id:u=0}=s,c=s.centroid,f=s.size/16,d=this.mapService.lngLatToContainer(c),{box:v}=a.placeCollisionBox({x1:l.left*f-t[0],x2:l.right*f+t[0],y1:l.top*f-t[1],y2:l.bottom*f+t[1],anchorPointX:d.x,anchorPointY:d.y});return v&&v.length?(a.insertCollisionBox(v,u),!0):!1}).forEach(s=>{this.glyphInfoMap[s.id]=s})}initGlyph(){const{iconfont:t=!1}=this.layer.getLayerConfig();t?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(t)}updateTexture(){const{createTexture2D:t}=this.rendererService,e=this.getFontServiceCanvas();this.textureHeight=e.height,this.texture&&this.texture.destroy(),this.texture=t({data:e,mag:w.LINEAR,min:w.LINEAR,width:e.width,height:e.height}),this.textures=[this.texture]}reBuildModel(){var t=this;return Z(function*(){t.filterGlyphs();const e=yield t.layer.buildLayerModel({moduleName:"pointText",vertexShader:MR,fragmentShader:RR,triangulation:IR.bind(t),defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1}});t.layer.models=[e]})()}}const uJ={fillImage:jQ,fill:dD,radar:eJ,image:vD,normal:pD,simplePoint:FQ,extrude:fD,text:_D,earthFill:HQ,earthExtrude:kQ},cJ=uJ;class Ed extends Fu{constructor(...t){super(...t),E(this,"type","PointLayer"),E(this,"enableShaderEncodeStyles",["stroke","offsets","opacity","rotation"]),E(this,"enableDataEncodeStyles",["textOffset","textAnchor"]),E(this,"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}})}buildModels(){var t=this;return Z(function*(){const e=t.getModelType();t.layerModel&&t.layerModel.clearModels(),t.layerModel=new cJ[e](t),yield t.initLayerModels()})()}rebuildModels(){var t=this;return Z(function*(){yield t.buildModels()})()}getModelTypeWillEmptyData(){if(this.shapeOption){const{field:t,values:e}=this.shapeOption,{shape2d:i}=this.getLayerConfig(),n=this.iconService.getIconMap();if(t&&(i==null?void 0:i.indexOf(t))!==-1)return"fill";if(e==="text")return"text";if(e&&e instanceof Array){for(const a of e)if(typeof a=="string"&&n.hasOwnProperty(a))return"image"}}return"normal"}getDefaultConfig(){const t=this.getModelType();return{fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}}[t]}getModelType(){const t=this.getEncodedData(),{shape2d:e,shape3d:i,billboard:n=!0}=this.getLayerConfig(),a=this.iconService.getIconMap(),o=t.find(s=>s.hasOwnProperty("shape"));if(o){const s=o.shape;return s==="dot"?"normal":s==="simple"?"simplePoint":s==="radar"?"radar":this.layerType==="fillImage"||n===!1?"fillImage":(e==null?void 0:e.indexOf(s))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(i==null?void 0:i.indexOf(s))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":a.hasOwnProperty(s)?"image":"text"}else return this.getModelTypeWillEmptyData()}}function hJ(r){return _x.apply(this,arguments)}function _x(){return _x=Z(function*(r){if(window.createImageBitmap){const t=yield fetch(r);return yield createImageBitmap(yield t.blob())}else{const t=new window.Image;return new Promise(e=>{t.onload=()=>e(t),t.src=r,t.crossOrigin="Anonymous"})}}),_x.apply(this,arguments)}const fJ=`layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // 默认不固定
  float u_raisingHeight;
};

in vec4 v_Color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    outputColor = v_Color;
  
  outputColor = filterColor(outputColor);
}
`,dJ=`
layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // 默认不固定
  float u_raisingHeight;
};

in vec4 v_Color;
in vec3 v_uvs;
in vec2 v_texture_data;
out vec4 outputColor;

#pragma include "scene_uniforms"
#pragma include "picking"

void main() {
  float isSide =  v_texture_data.x;
  float sidey = v_uvs[2];
  float lightWeight = v_texture_data.y;

  // Tip: 部分机型 GPU 计算精度兼容
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      outputColor = linearColor;
    } else {
      // side notuse linear
       outputColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    outputColor = v_Color;
  }

  outputColor = filterColorAlpha(outputColor, lightWeight);
}
`,vJ=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec3 a_uvs;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // 默认不固定
  float u_raisingHeight;
};

out vec4 v_Color;
out vec3 v_uvs;
out vec2 v_texture_data;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_uvs = a_uvs;
  // cal style mapping - 数据纹理映射部分的计算
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos, a_Position64Low);

  if (u_heightfixed > 0.0) {
    // 判断几何体是否固定高度
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  float lightWeight = calc_lighting(project_pos);
  v_texture_data = vec2(a_Position.z, lightWeight);

  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  setPickingColor(a_PickingColor);
}
`,pJ=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec3 a_uvs;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // 默认不固定
  float u_raisingHeight;
};

out vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  float isSide = a_Position.z;
  float topU = a_uvs[0];
  float topV = 1.0 - a_uvs[1];
  float sidey = a_uvs[2];

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);

  vec4 project_pos = project_position(pos, a_Position64Low);
  float lightWeight = calc_lighting(project_pos);

  if (u_heightfixed > 0.0) {
    // 判断几何体是否固定高度
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

 gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  // Tip: 部分机型 GPU 计算精度兼容
  if (isSide < 0.999) {
    // side face
    // if(u_sidesurface < 1.0) {
    //   discard;
    // }

    if (u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      v_Color = linearColor;
    } else {
      v_Color = a_Color;
    }

  } else {
    v_Color = a_Color;
  }

  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);

  setPickingColor(a_PickingColor);
}
`,gJ=`uniform sampler2D u_texture;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // 默认不固定
  float u_raisingHeight;
};

in vec4 v_Color;
in vec3 v_uvs;
in vec2 v_texture_data;

#pragma include "scene_uniforms"
#pragma include "picking"

out vec4 outputColor;

void main() {
  float opacity = u_opacity;
  float isSide = v_texture_data.x;
  float lightWeight = v_texture_data.y;
  float topU = v_uvs[0];
  float topV = 1.0 - v_uvs[1];
  float sidey = v_uvs[2];

  outputColor = texture(SAMPLER_2D(u_texture), vec2(topU, topV));
  // Tip: 部分机型 GPU 计算精度兼容
  if (isSide < 0.999) {// 是否是边缘
    // side face
    if (u_sidesurface < 1.0) {
      discard;
    }

    if (u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      outputColor = linearColor;
    } else {
      outputColor = v_Color;
    }
  } else {
     // top face
    if (u_topsurface < 1.0) {
      discard;
    }
  }
  
  outputColor.a *= opacity;
  outputColor = filterColor(outputColor);
}
`,mJ=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec3 a_uvs;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // 默认不固定
  float u_raisingHeight;
};

out vec4 v_Color;
out vec3 v_uvs;
out vec2 v_texture_data;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos, a_Position64Low);
  float lightWeight = calc_lighting(project_pos);
  v_uvs = a_uvs;
  v_Color = a_Color;
  v_Color.a *= opacity;

  v_texture_data = vec2(a_Position.z, lightWeight);

  if (u_heightfixed > 0.0) {
    // 判断几何体是否固定高度
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}
`;class yJ extends Me{constructor(...t){super(...t),E(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,NORMAL:10,UV:11})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),G(G({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{mapTexture:t,heightfixed:e=!1,raisingHeight:i=0,topsurface:n=!0,sidesurface:a=!0,sourceColor:o,targetColor:s}=this.layer.getLayerConfig();let l=0,u=[1,1,1,1],c=[1,1,1,1];o&&s&&(u=Pe(o),c=Pe(s),l=1);const h={u_sourceColor:u,u_targetColor:c,u_linearColor:l,u_topsurface:Number(n),u_sidesurface:Number(a),u_heightfixed:Number(e),u_raisingHeight:Number(i)};return t&&this.texture&&(h.u_texture=this.texture,this.textures=[this.texture]),this.getUniformsBufferInfo(h)}initModels(){var t=this;return Z(function*(){return yield t.loadTexture(),t.buildModels()})()}buildModels(){var t=this;return Z(function*(){const{frag:e,vert:i,type:n}=t.getShaders();return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:n,vertexShader:i,fragmentShader:e,depth:{enable:!0},defines:t.getDefines(),inject:t.getInject(),triangulation:lD})]})()}getShaders(){const{pickLight:t,mapTexture:e}=this.layer.getLayerConfig();return e?{frag:gJ,vert:mJ,type:"polygonExtrudeTexture"}:t?{frag:dJ,vert:vJ,type:"polygonExtrudePickLight"}:{frag:fJ,vert:pJ,type:"polygonExtrude"}}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.textures=[]}registerBuiltinAttributes(){const t=this.layer.getSource().extent,e=t[2]-t[0],i=t[3]-t[1];this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uvs",type:pt.Attribute,descriptor:{name:"a_uvs",shaderLocation:this.attributeLocation.UV,buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:3,update:(n,a,o)=>{const s=o[0],l=o[1];return[(s-t[0])/e,(l-t[1])/i,o[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:pt.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:3,update:(n,a,o,s,l)=>l}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:pt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:1,update:n=>{const{size:a=10}=n;return Array.isArray(a)?[a[0]]:[a]}}})}loadTexture(){var t=this;return Z(function*(){const{mapTexture:e}=t.layer.getLayerConfig(),{createTexture2D:i}=t.rendererService;if(t.texture=i({height:1,width:1}),e){const n=yield hJ(e);t.texture=i({data:n,width:n.width,height:n.height,wrapS:w.CLAMP_TO_EDGE,wrapT:w.CLAMP_TO_EDGE,min:w.LINEAR,mag:w.LINEAR})}})()}}const _J=`
in vec4 v_Color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {

  outputColor = v_Color;
  outputColor = filterColor(outputColor);
}
`,xJ=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

out vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size + (1.0 - a_Position.z) * extrusionBase, 1.0);

  vec4 project_pos = project_position(pos, a_Position64Low);
  float lightWeight = calc_lighting(project_pos);
  v_Color = a_Color;
  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}
`;class CJ extends Me{constructor(...t){super(...t),E(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,NORMAL:10,EXTRUSION_BASE:11})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),G(G({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const t={};return this.getUniformsBufferInfo(t)}initModels(){var t=this;return Z(function*(){return t.buildModels()})()}buildModels(){var t=this;return Z(function*(){const{frag:e,vert:i,type:n}=t.getShaders();return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:n,vertexShader:i,fragmentShader:e,defines:t.getDefines(),inject:t.getInject(),triangulation:lD,depth:{enable:!0}})]})()}getShaders(){return{frag:_J,vert:xJ,type:"polygonExtrude"}}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"normal",type:pt.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:3,update:(t,e,i,n,a)=>a}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:pt.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:1,update:t=>{const{size:e=10}=t;return Array.isArray(e)?[e[0]]:[e]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrusionBase",type:pt.Attribute,descriptor:{name:"a_ExtrusionBase",shaderLocation:this.attributeLocation.EXTRUSION_BASE,buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:1,update:t=>{const{extrusionBase:e=0}=t;return[e]}}})}}const EJ=`in vec4 v_color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,SJ=`
layout(std140) uniform commonUniforms {
  float u_raisingHeight;
  float u_opacitylinear;
  float u_dir;
};

in vec4 v_color;
in vec3 v_linear;
in vec2 v_pos;
out vec4 outputColor;
#pragma include "scene_uniforms"
#pragma include "picking"

void main() {
  outputColor = v_color;
  if (u_opacitylinear > 0.0) {
    outputColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }
  outputColor = filterColor(outputColor);
}
`,AJ=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_LINEAR) in vec3 a_linear;

layout(std140) uniform commonUniforms {
  float u_raisingHeight;
  float u_opacitylinear;
  float u_dir;
};

out vec4 v_color;
out vec3 v_linear;
out vec2 v_pos;

#pragma include "projection"
#pragma include "picking"

void main() {
  if (u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  project_pos.z += u_raisingHeight;

  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  setPickingColor(a_PickingColor);
}
`,TJ=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;

layout(std140) uniform commonUniforms {
  float u_raisingHeight;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - 数据纹理映射部分的计算

  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);

  project_pos.z += u_raisingHeight;

  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}

`;class bJ extends Me{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,LINEAR:9})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),G(G({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{raisingHeight:t=0,opacityLinear:e={enable:!1,dir:"in"}}=this.layer.getLayerConfig(),i={u_raisingHeight:Number(t),u_opacitylinear:Number(e.enable),u_dir:e.dir==="in"?1:0};return this.getUniformsBufferInfo(i)}initModels(){var t=this;return Z(function*(){return t.buildModels()})()}buildModels(){var t=this;return Z(function*(){const{frag:e,vert:i,triangulation:n,type:a}=t.getModelParams();return t.initUniformsBuffer(),t.layer.triangulation=n,[yield t.layer.buildLayerModel({moduleName:a,vertexShader:i,fragmentShader:e,defines:t.getDefines(),inject:t.getInject(),triangulation:n,primitive:w.TRIANGLES,depth:{enable:!1}})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute();const{opacityLinear:t={enable:!1,dir:"in"}}=this.layer.getLayerConfig();t.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:pt.Attribute,descriptor:{name:"a_linear",shaderLocation:this.attributeLocation.LINEAR,buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:3,update:(e,i,n)=>[n[3],n[4],n[5]]}})}getModelParams(){const{opacityLinear:t={enable:!1}}=this.layer.getLayerConfig();return t.enable?{frag:SJ,vert:AJ,type:"polygonLinear",triangulation:SK}:{frag:EJ,vert:TJ,type:"polygonFill",triangulation:xv}}}const wJ=`
layout(std140) uniform commonUniforms {
  vec4 u_watercolor;
  vec4 u_watercolor2;
  float u_time;
};

in vec2 v_uv;
in float v_opacity;
out vec4 outputColor;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;

vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture(SAMPLER_2D(u_texture2),p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture(SAMPLER_2D(u_texture1),fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture(SAMPLER_2D(u_texture3), fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    
  outputColor = vec4(col, v_opacity);  
}
`,RJ=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_uv;

layout(std140) uniform commonUniforms {
  vec4 u_watercolor;
  vec4 u_watercolor2;
  float u_time;
};

out vec2 v_uv;
out float v_opacity;

#pragma include "projection"

void main() {
  v_uv = a_uv;
  v_opacity = opacity;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
}

`;class MJ extends Me{constructor(...t){super(...t),E(this,"texture1",void 0),E(this,"texture2",void 0),E(this,"texture3",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),G(G({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{watercolor:t="#6D99A8",watercolor2:e="#0F121C"}=this.layer.getLayerConfig(),i={u_watercolor:Pe(t),u_watercolor2:Pe(e),u_time:this.layer.getLayerAnimateTime(),u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3};return this.textures=[this.texture1,this.texture2,this.texture3],this.getUniformsBufferInfo(i)}getAnimateUniforms(){return{u_time:this.layer.getLayerAnimateTime()}}initModels(){var t=this;return Z(function*(){return t.loadTexture(),t.buildModels()})()}buildModels(){var t=this;return Z(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:RJ,fragmentShader:wJ,defines:t.getDefines(),inject:t.getInject(),triangulation:xv,primitive:w.TRIANGLES,depth:{enable:!1}})]})()}clearModels(){var t,e,i;(t=this.texture1)===null||t===void 0||t.destroy(),(e=this.texture2)===null||e===void 0||e.destroy(),(i=this.texture3)===null||i===void 0||i.destroy()}registerBuiltinAttributes(){const t=this.layer.getSource().extent,[e,i,n,a]=t,o=n-e,s=a-i;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:pt.Attribute,descriptor:{name:"a_uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:2,update:(l,u,c)=>{const[h,f]=c;return[(h-e)/o,(f-i)/s]}}})}loadTexture(){const{createTexture2D:t}=this.rendererService,e={height:0,width:0};this.texture1=t(e),this.texture2=t(e),this.texture3=t(e),i(a=>{this.texture1=n(a[0]),this.texture2=n(a[1]),this.texture3=n(a[2]),this.layerService.reRender()});function i(a){let o=0;const s=[];["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"].map(u=>{const c=new Image;c.crossOrigin="",c.src=u,s.push(c),c.onload=()=>{o++,o===3&&a(s)}})}function n(a){return t({data:a,width:a.width,height:a.height,wrapS:w.MIRRORED_REPEAT,wrapT:w.MIRRORED_REPEAT,min:w.LINEAR,mag:w.LINEAR})}}}const IJ=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
  float u_speed;
  float u_time;
};

out vec4 outputColor;


in vec4 v_Color;
in vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {

  outputColor = v_Color;
  float spc = calSpc();
  outputColor += spc * 0.4;
}
`,LJ=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_uv;

layout(std140) uniform commonUniforms {
  float u_speed;
  float u_time;
};
out vec4 v_Color;
out vec2 v_uv;

#pragma include "projection"

void main() {
  v_uv = a_uv;
  v_Color = a_Color;
  v_Color.a *= opacity;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
}

`;class OJ extends Me{constructor(...t){super(...t),E(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),G(G({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{speed:t=.5}=this.layer.getLayerConfig(),e={u_speed:t,u_time:this.layer.getLayerAnimateTime(),u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(e)}getAnimateUniforms(){return{u_time:this.layer.getLayerAnimateTime()}}initModels(){var t=this;return Z(function*(){return t.loadTexture(),t.buildModels()})()}buildModels(){var t=this;return Z(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:LJ,fragmentShader:IJ,triangulation:xv,defines:t.getDefines(),inject:t.getInject(),primitive:w.TRIANGLES,depth:{enable:!1},pickingEnabled:!1,diagnosticDerivativeUniformityEnabled:!1})]})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}registerBuiltinAttributes(){const t=this.layer.getSource().extent,[e,i,n,a]=t,o=n-e,s=a-i;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:pt.Attribute,descriptor:{name:"a_uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:w.STATIC_DRAW,data:[],type:w.FLOAT},size:2,update:(l,u,c)=>{const[h,f]=c;return[(h-e)/o,(f-i)/s]}}})}loadTexture(){const{waterTexture:t}=this.layer.getLayerConfig(),{createTexture2D:e}=this.rendererService;this.texture=e({height:1,width:1});const i=new Image;i.crossOrigin="",t?(console.warn("L7 recommend：https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),i.src=t):i.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",i.onload=()=>{this.texture=e({data:i,width:i.width,height:i.height,wrapS:w.MIRRORED_REPEAT,wrapT:w.MIRRORED_REPEAT,min:w.LINEAR,mag:w.LINEAR}),this.layerService.reRender()}}}const PJ={fill:bJ,line:hD,extrude:yJ,text:_D,point_fill:dD,point_image:vD,point_normal:pD,point_extrude:fD,water:OJ,ocean:MJ,extrusion:CJ},FJ=PJ;class M0 extends Fu{constructor(...t){super(...t),E(this,"type","PolygonLayer"),E(this,"enableShaderEncodeStyles",["opacity","extrusionBase","rotation","offsets","stroke"])}buildModels(){var t=this;return Z(function*(){const e=t.getModelType();t.layerModel=new FJ[e](t),yield t.initLayerModels()})()}getModelType(){var t;const e=this.styleAttributeService.getLayerStyleAttribute("shape"),i=e==null||(t=e.scale)===null||t===void 0?void 0:t.field;return i==="fill"||!i?"fill":i==="extrude"?"extrude":i==="extrusion"?"extrusion":i==="water"?"water":i==="ocean"?"ocean":i==="line"?"line":this.getPointModelType()}getPointModelType(){const t=this.getEncodedData(),{shape2d:e,shape3d:i}=this.getLayerConfig(),n=this.iconService.getIconMap(),a=t.find(o=>o.hasOwnProperty("shape"));if(a){const o=a.shape;return o==="dot"?"point_normal":(e==null?void 0:e.indexOf(o))!==-1?"point_fill":(i==null?void 0:i.indexOf(o))!==-1?"point_extrude":n.hasOwnProperty(o)?"point_image":"text"}else return"fill"}}const BJ=`layout(std140) uniform commonUniforms {
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  float u_clampLow;
  float u_clampHigh;
};

uniform sampler2D u_rasterTexture;
uniform sampler2D u_colorTexture;

in vec2 v_texCoord;

bool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }

out vec4 outputColor;

void main() {
  // Can use any component here since u_rasterTexture is under luminance format.
  float value = texture(SAMPLER_2D(u_rasterTexture), vec2(v_texCoord.x, v_texCoord.y)).r;
  if (value == u_noDataValue || isnan_emu(value)) {
    discard;
  } else if ((u_clampLow < 0.5 && value < u_domain[0]) || (u_clampHigh < 0.5 && value > u_domain[1])) {
    discard;
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(normalisedValue, 0));
    
    outputColor = color;
    outputColor.a = outputColor.a * u_opacity ;
    if (outputColor.a < 0.01)
      discard;
  }
}
`,DJ=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  float u_clampLow;
  float u_clampHigh;
};

out vec2 v_texCoord;

#pragma include "projection"

void main() {
  v_texCoord = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
}
`;let LR=class extends Me{constructor(...t){super(...t),E(this,"texture",void 0),E(this,"colorTexture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),G(G({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{opacity:t=1,clampLow:e=!0,clampHigh:i=!0,noDataValue:n=-9999999,domain:a,rampColors:o}=this.layer.getLayerConfig(),s=a||jE(o);this.colorTexture=this.layer.textureService.getColorTexture(o,s);const l={u_domain:s,u_opacity:t||1,u_noDataValue:n,u_clampLow:e?1:0,u_clampHigh:(typeof i<"u"?i:e)?1:0,u_rasterTexture:this.texture,u_colorTexture:this.colorTexture};return this.textures=[this.texture,this.colorTexture],this.getUniformsBufferInfo(l)}getRasterData(t){return Z(function*(){if(Array.isArray(t.data))return{data:t.data,width:t.width,height:t.height};{const{rasterData:e,width:i,height:n}=yield t.data;return{data:Array.from(e),width:i,height:n}}})()}initModels(){var t=this;return Z(function*(){return t.buildModels()})()}buildModels(){var t=this;return Z(function*(){t.initUniformsBuffer();const e=t.layer.getSource(),{createTexture2D:i,queryVerdorInfo:n}=t.rendererService,a=e.data.dataArray[0],{data:o,width:s,height:l}=yield t.getRasterData(a);return t.texture=i({data:new Float32Array(o),width:s,height:l,format:n()==="WebGL1"?w.LUMINANCE:w.RED,type:w.FLOAT,alignment:1}),[yield t.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:DJ,fragmentShader:BJ,defines:t.getDefines(),triangulation:Vm,primitive:w.TRIANGLES,depth:{enable:!1},pickingEnabled:!1})]})()}clearModels(){var t,e;(t=this.texture)===null||t===void 0||t.destroy(),(e=this.colorTexture)===null||e===void 0||e.destroy()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:pt.Attribute,descriptor:{shaderLocation:this.attributeLocation.UV,name:"a_Uv",buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:2,update:(t,e,i)=>[i[3],i[4]]}})}};const NJ=["data"],kJ=["rasterData"],UJ=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
 vec2 u_rminmax;
 vec2 u_gminmax;
 vec2 u_bminmax;
 float u_opacity;
 float u_noDataValue;
};

in vec2 v_texCoord;

out vec4 outputColor;

void main() {

  vec3 rgb = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y)).rgb;

  if(rgb == vec3(u_noDataValue)) {
    outputColor = vec4(0.0, 0, 0, 0.0);
  } else {
    outputColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);
  }

  if(outputColor.a < 0.01)
    discard;
 
}`,zJ=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_rminmax;
  vec2 u_gminmax;
  vec2 u_bminmax;
  float u_opacity;
  float u_noDataValue;
};

out vec2 v_texCoord;

#pragma include "projection"

void main() {
  v_texCoord = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
}
`;class HJ extends Me{constructor(...t){super(...t),E(this,"texture",void 0),E(this,"dataOption",{})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),G(G({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{opacity:t=1,noDataValue:e=0}=this.layer.getLayerConfig(),{rMinMax:i=[0,255],gMinMax:n=[0,255],bMinMax:a=[0,255]}=this.dataOption,o={u_rminmax:i,u_gminmax:n,u_bminmax:a,u_opacity:t||1,u_noDataValue:e,u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(o)}getRasterData(t){var e=this;return Z(function*(){if(Array.isArray(t.data)){const{data:o}=t,s=An(t,NJ);return e.dataOption=s,G({data:o},s)}const i=yield t.data,{rasterData:n}=i,a=An(i,kJ);return e.dataOption=a,Array.isArray(n)?G({data:n},a):G({data:Array.from(n)},a)})()}initModels(){var t=this;return Z(function*(){t.initUniformsBuffer();const e=t.layer.getSource(),{createTexture2D:i}=t.rendererService,n=e.data.dataArray[0],{data:a,width:o,height:s}=yield t.getRasterData(n);return t.texture=i({data:new Float32Array(a),width:o,height:s,format:w.RGB,type:w.FLOAT}),[yield t.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:zJ,fragmentShader:UJ,defines:t.getDefines(),triangulation:Vm,primitive:w.TRIANGLES,depth:{enable:!1},pickingEnabled:!1})]})()}buildModels(){var t=this;return Z(function*(){return t.initModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:pt.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:2,update:(t,e,i)=>[i[3],i[4]]}})}}const $J=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

layout(std140) uniform commonUniforms {
 vec4 u_unpack;
 vec2 u_domain;
 float u_opacity;
 float u_noDataValue;
 float u_clampLow;
 float u_clampHigh;
};

in vec2 v_texCoord;
out vec4 outputColor;


float getElevation(vec2 coord, float bias) {
    // Convert encoded elevation value to meters
    vec4 data =  texture(SAMPLER_2D(u_texture), coord,bias) * 255.0;
    data.a = -1.0;
    return dot(data, u_unpack);
}

vec4 getColor(float value) {
   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec2 coord = vec2(normalisedValue, 0);
    return  texture(SAMPLER_2D(u_colorTexture), coord);
}

void main() {
  float value = getElevation(v_texCoord,0.0);
  if (value == u_noDataValue) {
    outputColor = vec4(0.0, 0, 0, 0.0);
  } else if ((u_clampLow < 0.5 && value < u_domain[0]) || (u_clampHigh < 0.5 && value > u_domain[1])) {
     outputColor = vec4(0.0, 0, 0, 0.0);
  } else {
   
    outputColor = getColor(value);
    outputColor.a =  outputColor.a * u_opacity ;
      if(outputColor.a < 0.01)
      discard;
  }
}
`,WJ=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec4 u_unpack;
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  float u_clampLow;
  float u_clampHigh;
};
out vec2 v_texCoord;
#pragma include "projection"

void main() {
  v_texCoord = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
}
`;class VJ extends Me{constructor(...t){super(...t),E(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getCommonUniformsInfo(){const{opacity:t,clampLow:e=!0,clampHigh:i=!0,noDataValue:n=-9999999,domain:a,rampColors:o,colorTexture:s,rScaler:l=6553.6,gScaler:u=25.6,bScaler:c=.1,offset:h=1e4}=this.layer.getLayerConfig(),f=a||jE(o);let d=s;s?this.layer.textureService.setColorTexture(s,o,f):d=this.layer.textureService.getColorTexture(o,f);const v={u_unpack:[l,u,c,h],u_domain:f,u_opacity:t||1,u_noDataValue:n,u_clampLow:e,u_clampHigh:typeof i<"u"?i:e,u_texture:this.texture,u_colorTexture:d};return this.textures=[this.texture,d],this.getUniformsBufferInfo(v)}initModels(){var t=this;return Z(function*(){t.initUniformsBuffer();const e=t.layer.getSource(),{createTexture2D:i}=t.rendererService,n=yield e.data.images;return t.texture=i({data:n[0],width:n[0].width,height:n[0].height,min:w.LINEAR,mag:w.LINEAR}),[yield t.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:WJ,fragmentShader:$J,defines:t.getDefines(),triangulation:Vm,primitive:w.TRIANGLES,depth:{enable:!1}})]})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}buildModels(){var t=this;return Z(function*(){return t.initModels()})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:pt.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:w.DYNAMIC_DRAW,data:[],type:w.FLOAT},size:2,update:(t,e,i)=>[i[3],i[4]]}})}}const GJ={raster:LR,rasterRgb:HJ,raster3d:LR,rasterTerrainRgb:VJ},XJ=GJ;class sS extends Fu{constructor(...t){super(...t),E(this,"type","RasterLayer")}buildModels(){var t=this;return Z(function*(){const e=t.getModelType();t.layerModel=new XJ[e](t),yield t.initLayerModels()})()}getDefaultConfig(){const t=this.getModelType();return{raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}}[t]}getModelType(){switch(this.layerSource.getParserType()){case"raster":case"ndi":return"raster";case"rasterRgb":return"rasterRgb";case"rgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}getLegend(t){if(t!=="color")return{type:void 0,field:void 0,items:[]};const e=this.getLayerConfig().rampColors;return cD(e,t)}}class YJ{constructor({rendererService:t,layerService:e,parent:i}){E(this,"tileResource",new Map),E(this,"rendererService",void 0),E(this,"layerService",void 0),E(this,"parent",void 0),E(this,"layerTiles",[]),this.rendererService=t,this.layerService=e,this.parent=i}get tiles(){return this.layerTiles}hasTile(t){return this.layerTiles.some(e=>e.key===t)}addTile(t){this.layerTiles.push(t)}getTile(t){return this.layerTiles.find(e=>e.key===t)}getVisibleTileBylngLat(t){return this.layerTiles.find(e=>e.isLoaded&&e.visible&&e.lnglatInBounds(t))}removeTile(t){const e=this.layerTiles.findIndex(n=>n.key===t),i=this.layerTiles.splice(e,1);i[0]&&i[0].destroy()}updateTileVisible(t){const e=this.getTile(t.key);if(t.isVisible)if(t.parent){const i=this.isChildrenLoaded(t.parent);e==null||e.updateVisible(i)}else e==null||e.updateVisible(!0);else if(t.parent){const i=this.isChildrenLoaded(t.parent);e==null||e.updateVisible(!i)}else e==null||e.updateVisible(!1)}isParentLoaded(t){const e=t.parent;if(!e)return!0;const i=this.getTile(e==null?void 0:e.key);return!!(i!=null&&i.isLoaded)}isChildrenLoaded(t){const e=t==null?void 0:t.children;return e.length===0?!0:e.every(i=>{const n=this.getTile(i==null?void 0:i.key);return n?(n==null?void 0:n.isLoaded)===!0:!0})}render(){var t=this;return Z(function*(){const i=t.getRenderLayers().map(function(){var n=Z(function*(a){yield t.layerService.renderTileLayer(a)});return function(a){return n.apply(this,arguments)}}());yield Promise.all(i)})()}getRenderLayers(){const t=this.layerTiles.filter(i=>i.visible&&i.isLoaded),e=[];return t.map(i=>e.push(...i.getLayers())),e}getLayers(){const t=this.layerTiles.filter(i=>i.isLoaded),e=[];return t.map(i=>e.push(...i.getLayers())),e}getTiles(){return this.layerTiles}destroy(){this.layerTiles.forEach(t=>t.destroy()),this.tileResource.clear()}}class jJ{getCombineFeature(t){let e=null;const i=t[0];return t.map(n=>{const a=wW(n.coordinates);e===null?e=a:e=RW(e,a)}),i&&(e.properties=G({},i)),e}}const uf="select",cf="active";class ZJ{constructor({layerService:t,tileLayerService:e,parent:i}){E(this,"layerService",void 0),E(this,"tileLayerService",void 0),E(this,"tileSourceService",void 0),E(this,"parent",void 0),E(this,"tilePickID",new Map),this.layerService=t,this.tileLayerService=e,this.parent=i,this.tileSourceService=new jJ}pickRender(t){const e=this.tileLayerService.getVisibleTileBylngLat(t.lngLat);if(e){const i=e.getMainLayer();i==null||i.layerPickService.pickRender(t)}}pick(t,e){var i=this;return Z(function*(){const a=i.parent.getContainer().pickingService;if(t.type==="RasterLayer"){const o=i.tileLayerService.getVisibleTileBylngLat(e.lngLat);if(o&&o.getMainLayer()!==void 0){const s=o.getMainLayer();return s.layerPickService.pickRasterLayer(s,e,i.parent)}return!1}return i.pickRender(e),a.pickFromPickingFBO(t,e)})()}selectFeature(t){const[e,i,n]=t,a=this.color2PickId(e,i,n);this.tilePickID.set(uf,a),this.updateHighLight(e,i,n,uf)}highlightPickedFeature(t){const[e,i,n]=t,a=this.color2PickId(e,i,n);this.tilePickID.set(cf,a),this.updateHighLight(e,i,n,cf)}updateHighLight(t,e,i,n){this.tileLayerService.tiles.map(a=>{const o=a.getMainLayer();switch(n){case uf:o==null||o.hooks.beforeSelect.call([t,e,i]);break;case cf:o==null||o.hooks.beforeHighlight.call([t,e,i]);break}})}setPickState(){const t=this.tilePickID.get(uf),e=this.tilePickID.get(cf);if(t){const[i,n,a]=this.pickId2Color(t);this.updateHighLight(i,n,a,uf);return}if(e){const[i,n,a]=this.pickId2Color(e);this.updateHighLight(i,n,a,cf);return}}color2PickId(t,e,i){return Kl(new Uint8Array([t,e,i]))}pickId2Color(t){return jc(t)}getFeatureById(t){const e=this.tileLayerService.getTiles().filter(n=>n.visible),i=[];return e.forEach(n=>{i.push(...n.getFeatureById(t))}),i}pickRasterLayer(){return!1}}function qJ(r){return r==="PolygonLayer"?M0:r==="LineLayer"?Oc:Ed}function KJ(r){return["PolygonLayer","LineLayer"].indexOf(r)!==-1}class Bu extends Li.EventEmitter{constructor(t,e){super(),E(this,"x",void 0),E(this,"y",void 0),E(this,"z",void 0),E(this,"key",void 0),E(this,"parent",void 0),E(this,"sourceTile",void 0),E(this,"visible",!0),E(this,"layers",[]),E(this,"isLoaded",!1),E(this,"tileMaskLayers",[]),E(this,"tileMask",void 0),this.parent=e,this.sourceTile=t,this.x=t.x,this.y=t.y,this.z=t.z,this.key=`${this.x}_${this.y}_${this.z}`}getLayers(){return this.layers}styleUpdate(...t){}lnglatInBounds(t){const[e,i,n,a]=this.sourceTile.bounds,{lng:o,lat:s}=t;return o>=e&&o<=n&&s>=i&&s<=a}getLayerOptions(){var t;const e=this.parent.getLayerConfig();return G(G({},e),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:KJ(this.parent.type),mask:e.mask||((t=e.maskLayers)===null||t===void 0?void 0:t.length)!==0&&e.enableMask})}getMaskLayer(){const{maskLayers:t}=this.parent.getLayerConfig(),e=[];return t==null||t.forEach(i=>{if(!i.tileLayer)return e.push(i),i;const a=i.tileLayer.getTile(this.sourceTile.key),o=a==null?void 0:a.getLayers()[0];o&&e.push(o)}),e}addTileMask(){var t=this;return Z(function*(){const e=new M0({name:"mask",visible:!0,enablePicking:!1}).source({type:"FeatureCollection",features:[t.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill").color("#0f0").style({opacity:.5}),i=Zf(t.parent.container);e.setContainer(i),yield e.init(),t.tileMask=e;const n=t.getMainLayer();return n!==void 0&&(n.tileMask=e),e})()}addMask(t,e){var i=this;return Z(function*(){const n=Zf(i.parent.container);e.setContainer(n),yield e.init(),t.addMask(e),i.tileMaskLayers.push(e)})()}addLayer(t){var e=this;return Z(function*(){t.isTileLayer=!0;const i=Zf(e.parent.container);t.setContainer(i),e.layers.push(t),yield t.init()})()}updateVisible(t){this.visible=t,this.updateOptions("visible",t)}updateOptions(t,e){this.layers.forEach(i=>{i.updateLayerConfig({[t]:e})})}getMainLayer(){return this.layers[0]}getFeatures(t){return[]}getFeatureById(t){return[]}destroy(){var t;(t=this.tileMask)===null||t===void 0||t.destroy(),this.layers.forEach(e=>e.destroy())}}class QJ extends Bu{initTileLayer(){var t=this;return Z(function*(){const e=t.getSourceOption(),i=e.data.features[0].properties,n=new Oc().source(e.data,e.options).size(1).shape("line").color("red"),a=new Ed({minZoom:t.z-1,maxZoom:t.z+1,textAllowOverlap:!0}).source([i],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(t.key).style({stroke:"#fff",strokeWidth:2});yield t.addLayer(n),yield t.addLayer(a),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource();return{data:{type:"FeatureCollection",features:this.sourceTile.data.layers.testTile.features},options:{parser:{type:"geojson"},transforms:t.transforms}}}}class JJ extends Bu{initTileLayer(){var t=this;return Z(function*(){const e=t.parent.getLayerAttributeConfig(),i=t.getLayerOptions(),n=t.getSourceOption(),a=new KK(G({},i)).source(n.data,n.options);e&&Object.keys(e).forEach(o=>{var s,l;const u=o;a[u]((s=e[u])===null||s===void 0?void 0:s.field,(l=e[u])===null||l===void 0?void 0:l.values)}),yield t.addLayer(a),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}const ttt=`layout(std140) uniform commonUniorm {
  vec4 u_color;
  float u_opacity;
};

out vec4 outputColor;

void main() {
  outputColor = u_color;
  outputColor.a *= u_opacity;
}
`,ett=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;

layout(std140) uniform commonUniorm {
  vec4 u_color;
  float u_opacity;
};

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
}

`;class rtt extends Me{getUninforms(){const t=this.getCommonUniformsInfo(),e=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),G(G({},t.uniformsOption),e.uniformsOption)}getCommonUniformsInfo(){const{opacity:t=1,color:e="#000"}=this.layer.getLayerConfig(),i={u_color:Pe(e),u_opacity:t||1};return this.getUniformsBufferInfo(i)}initModels(){var t=this;return Z(function*(){return t.buildModels()})()}buildModels(){var t=this;return Z(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"mask",vertexShader:ett,fragmentShader:ttt,defines:t.getDefines(),triangulation:xv,depth:{enable:!1},pick:!1})]})()}clearModels(t=!0){t&&this.layerService.clear()}registerBuiltinAttributes(){return""}}const itt={fill:rtt},ntt=itt;class xD extends Fu{constructor(...t){super(...t),E(this,"type","MaskLayer")}buildModels(){var t=this;return Z(function*(){const e=t.getModelType();t.layerModel=new ntt[e](t),yield t.initLayerModels()})()}getModelType(){return"fill"}}class att extends Bu{initTileLayer(){var t=this;return Z(function*(){const e=t.parent.getLayerAttributeConfig(),i=t.getLayerOptions(),n=t.getSourceOption(),a=new xD(G({},i)).source(n.data,n.options);e&&Object.keys(e).forEach(o=>{var s,l;const u=o;a[u]((s=e[u])===null||s===void 0?void 0:s.field,(l=e[u])===null||l===void 0?void 0:l.values)}),yield t.addLayer(a),t.isLoaded=!0})()}getFeatures(t){return t?this.sourceTile.data.getTileData(t):[]}getSourceOption(){const t=this.parent.getSource(),{sourceLayer:e,featureId:i}=this.parent.getLayerConfig();return{data:{type:"FeatureCollection",features:this.getFeatures(e)},options:{parser:{type:"geojson",featureId:i},transforms:t.transforms}}}}const ott=["rasterData"];let stt=class extends Bu{initTileLayer(){var t=this;return Z(function*(){const e=t.parent.getLayerAttributeConfig(),i=t.getLayerOptions(),n=t.getSourceOption(),a=new sS(G({},i)).source(n.data,n.options);e&&Object.keys(e).forEach(o=>{var s,l;const u=o;a[u]((s=e[u])===null||s===void 0?void 0:s.field,(l=e[u])===null||l===void 0?void 0:l.values)}),yield t.addLayer(a),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource(),e=this.sourceTile.data.data,{rasterData:i}=e,n=An(e,ott);return{data:i,options:{parser:G({type:"rasterRgb",extent:this.sourceTile.bounds},n),transforms:t.transforms}}}};class ltt extends Bu{initTileLayer(){var t=this;return Z(function*(){const e=t.parent.getLayerAttributeConfig(),i=t.getLayerOptions(),n=t.getSourceOption(),a=new sS(G({},i)).source(n.data,n.options);e&&Object.keys(e).forEach(o=>{var s,l;const u=o;a[u]((s=e[u])===null||s===void 0?void 0:s.field,(l=e[u])===null||l===void 0?void 0:l.values)}),yield t.addLayer(a),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}const utt=["rasterData"],ctt={positions:[0,1],colors:["#000","#fff"]};class htt extends Bu{constructor(...t){super(...t),E(this,"colorTexture",void 0)}initTileLayer(){var t=this;return Z(function*(){const e=t.parent.getLayerAttributeConfig(),i=t.getLayerOptions(),n=t.getSourceOption(),{rampColors:a,domain:o}=t.getLayerOptions();t.colorTexture=t.parent.textureService.getColorTexture(a,o);const s=new sS(G(G({},i),{},{colorTexture:t.colorTexture})).source(n.data,n.options);e&&Object.keys(e).forEach(l=>{var u,c;const h=l;s[h]((u=e[h])===null||u===void 0?void 0:u.field,(c=e[h])===null||c===void 0?void 0:c.values)}),yield t.addLayer(s),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource(),e=this.sourceTile.data.data,{rasterData:i}=e,n=An(e,utt);return{data:i,options:{parser:G({type:"raster",extent:this.sourceTile.bounds},n),transforms:t.transforms}}}styleUpdate(...t){const{rampColors:e=ctt,domain:i}=t;this.colorTexture=this.parent.textureService.getColorTexture(e,i||jE(e)),this.layers.forEach(n=>n.style({colorTexture:this.colorTexture}))}destroy(){this.layers.forEach(t=>t.destroy())}}class Tp extends Bu{initTileLayer(){var t=this;return Z(function*(){const e=t.parent.getLayerAttributeConfig(),i=t.getLayerOptions(),n=qJ(t.parent.type),a=t.getSourceOption();if(!a){t.isLoaded=!0,t.emit("loaded");return}const o=new n(G({},i)).source(a.data,a.options);Object.keys(e).forEach(s=>{var l,u;const c=s;o[c]((l=e[c])===null||l===void 0?void 0:l.field,(u=e[c])===null||u===void 0?void 0:u.values)}),yield t.addLayer(o),i.tileMask&&(yield t.addTileMask()),t.setLayerMinMaxZoom(o),t.isLoaded=!0,t.emit("loaded")})()}getSourceOption(){const t=this.parent.getSource(),{sourceLayer:e="defaultLayer",featureId:i="id"}=this.parent.getLayerConfig();return{data:{type:"FeatureCollection",features:this.getFeatures(e)},options:{parser:{type:"geojson",featureId:i},transforms:t.transforms}}}setLayerMinMaxZoom(t){t.getModelType()==="text"&&t.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}getFeatures(t){return this.sourceTile.data.getTileData(t)}getFeatureById(t){const e=this.getMainLayer();return e?e.getSource().data.dataArray.filter(n=>n._id===t):[]}}function ftt(r){switch(r.type){case"PolygonLayer":return Tp;case"LineLayer":return Tp;case"PointLayer":return Tp;case"TileDebugLayer":return QJ;case"MaskLayer":return att;case"RasterLayer":const{dataType:e}=r.getSource().parser;switch(e){case Xr.RGB:case Xr.CUSTOMRGB:return stt;case Xr.ARRAYBUFFER:case Xr.CUSTOMARRAYBUFFER:return htt;case Xr.TERRAINRGB:case Xr.CUSTOMTERRAINRGB:return ltt;default:return JJ}default:return Tp}}const dtt=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask","addMask","removeMask"],{debounce:vtt}=er;class ptt{constructor(t){E(this,"parent",void 0),E(this,"tileLayerService",void 0),E(this,"mapService",void 0),E(this,"layerService",void 0),E(this,"rendererService",void 0),E(this,"pickingService",void 0),E(this,"tilePickService",void 0),E(this,"tilesetManager",void 0),E(this,"initedTileset",!1),E(this,"lastViewStates",void 0),E(this,"mapchange",()=>{var i;if(this.parent.isVisible()===!1)return;const{latLonBounds:n,zoom:a}=this.getCurrentView();this.lastViewStates&&this.lastViewStates.zoom===a&&this.lastViewStates.latLonBounds.toString()===n.toString()||(this.lastViewStates={zoom:a,latLonBounds:n},(i=this.tilesetManager)===null||i===void 0||i.throttleUpdate(a,n))}),E(this,"viewchange",vtt(this.mapchange,24)),this.parent=t;const e=this.parent.getContainer();this.rendererService=e.rendererService,this.layerService=e.layerService,this.mapService=e.mapService,this.pickingService=e.pickingService,this.tileLayerService=new YJ({rendererService:this.rendererService,layerService:this.layerService,parent:t}),this.tilePickService=new ZJ({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:t}),this.parent.setLayerPickService(this.tilePickService),this.proxy(t),this.initTileSetManager()}initTileSetManager(){var t;const e=this.parent.getSource();if(this.tilesetManager=e.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0),this.parent.isVisible()===!1)return;const{latLonBounds:i,zoom:n}=this.getCurrentView();(t=this.tilesetManager)===null||t===void 0||t.update(n,i)}getCurrentView(){const t=this.mapService.getBounds(),e=[t[0][0],t[0][1],t[1][0],t[1][1]],i=this.mapService.getZoom();return{latLonBounds:e,zoom:i}}bindTilesetEvent(){this.tilesetManager.on("tile-loaded",t=>{}),this.tilesetManager.on("tile-unload",t=>{this.tileUnLoad(t)}),this.tilesetManager.on("tile-error",(t,e)=>{this.tileError(t)}),this.tilesetManager.on("tile-update",()=>{this.tileUpdate()}),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}render(){this.tileLayerService.render()}getLayers(){return this.tileLayerService.getLayers()}getTiles(){return this.tileLayerService.getTiles()}getTile(t){return this.tileLayerService.getTile(t)}tileLoaded(t){}tileError(t){console.warn("error:",t)}destroy(){var t;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),(t=this.tilesetManager)===null||t===void 0||t.destroy(),this.tileLayerService.destroy()}reload(){var t;this.tilesetManager.clear();const{latLonBounds:e,zoom:i}=this.getCurrentView();(t=this.tilesetManager)===null||t===void 0||t.update(i,e)}tileUnLoad(t){this.tileLayerService.removeTile(t.key)}tileUpdate(){var t=this;return Z(function*(){if(!t.tilesetManager)return;const e=t.parent.getMinZoom(),i=t.parent.getMaxZoom(),n=t.tilesetManager.tiles.filter(a=>a.isLoaded).filter(a=>a.isVisibleChange).filter(a=>a.data).filter(a=>a.z>=e&&a.z<i);yield Promise.all(n.map(function(){var a=Z(function*(o){if(t.tileLayerService.hasTile(o.key))t.tileLayerService.updateTileVisible(o),t.tilePickService.setPickState(),t.layerService.reRender();else{const s=ftt(t.parent),l=new s(o,t.parent);yield l.initTileLayer(),t.tilePickService.setPickState(),l.getLayers().length!==0&&(t.tileLayerService.addTile(l),t.tileLayerService.updateTileVisible(o),t.layerService.reRender())}});return function(o){return a.apply(this,arguments)}}())),t.tilesetManager.isLoaded&&t.parent.emit("tiles-loaded",t.tilesetManager.currentTiles)})()}setPickState(t){}pickRender(t){this.tilePickService.pickRender(t)}selectFeature(t){this.tilePickService.selectFeature(t)}highlightPickedFeature(t){this.tilePickService.highlightPickedFeature(t)}proxy(t){dtt.forEach(e=>{const i=t[e].bind(t);t[e]=(...n)=>(i(...n),this.getLayers().map(a=>{a[e](...n)}),e==="style"&&this.getTiles().forEach(a=>a.styleUpdate(...n)),t)})}}class gtt extends ns{constructor(...t){super(...t),E(this,"disabled",void 0),E(this,"zoomInButton",void 0),E(this,"zoomOutButton",void 0),E(this,"zoomNumDiv",void 0),E(this,"zoomIn",()=>{!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}),E(this,"zoomOut",()=>{!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}),E(this,"updateDisabled",()=>{const e=this.mapsService;this.zoomInButton.removeAttribute("disabled"),this.zoomOutButton.removeAttribute("disabled"),(this.disabled||e.getZoom()<=e.getMinZoom())&&this.zoomOutButton.setAttribute("disabled","true"),this.controlOption.showZoom&&this.zoomNumDiv&&(this.zoomNumDiv.innerText=String(Math.floor(e.getZoom()))),(this.disabled||e.getZoom()>=e.getMaxZoom())&&this.zoomInButton.setAttribute("disabled","true")})}getDefault(t){return G(G({},super.getDefault(t)),{},{position:qc.BOTTOMRIGHT,name:"zoom",zoomInText:R0("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:R0("l7-icon-narrow"),zoomOutTitle:"Zoom out",showZoom:!1})}setOptions(t){super.setOptions(t),this.checkUpdateOption(t,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","showZoom"])&&this.resetButtonGroup(this.container)}onAdd(){const t=we("div","l7-control-zoom");return this.resetButtonGroup(t),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),t}onRemove(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}disable(){return this.disabled=!0,this.updateDisabled(),this}enable(){return this.disabled=!1,this.updateDisabled(),this}resetButtonGroup(t){mv(t),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",t,this.zoomIn),this.controlOption.showZoom&&(this.zoomNumDiv=this.createButton("0","","l7-button-control l7-control-zoom__number",t)),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",t,this.zoomOut),this.updateDisabled()}createButton(t,e,i,n,a){const o=we("button",i,n);return typeof t=="string"?o.innerHTML=t:o.append(t),o.title=e,a&&o.addEventListener("click",a),o}}class mtt extends Li.EventEmitter{get lngLat(){var t;return(t=this.popupOption.lngLat)!==null&&t!==void 0?t:{lng:0,lat:0}}set lngLat(t){this.popupOption.lngLat=t}constructor(t){super(),E(this,"popupOption",void 0),E(this,"mapsService",void 0),E(this,"sceneService",void 0),E(this,"layerService",void 0),E(this,"scene",void 0),E(this,"closeButton",void 0),E(this,"container",void 0),E(this,"content",void 0),E(this,"contentTitle",void 0),E(this,"contentPanel",void 0),E(this,"tip",void 0),E(this,"isShow",!0),E(this,"onMouseMove",i=>{var n;const a=this.mapsService.getMapContainer(),{left:o=0,top:s=0}=(n=a==null?void 0:a.getBoundingClientRect())!==null&&n!==void 0?n:{};this.setPopupPosition(i.clientX-o,i.clientY-s)}),E(this,"updateLngLatPosition",()=>{if(!this.mapsService||this.popupOption.followCursor)return;const{lng:i,lat:n}=this.lngLat,{x:a,y:o}=this.mapsService.lngLatToContainer([i,n]);this.setPopupPosition(a,o)}),E(this,"updateLngLatPositionWhenZoom",i=>{if(!this.mapsService||this.popupOption.followCursor)return;const n=i.map,a=n.getSize();a.x=a.x/2,a.y=a.y/2;const o=i.center,s=i.zoom,l=n.DE(this.lngLat,s,o);l.x=Math.round(l.x),l.y=Math.round(l.y),this.setPopupPosition(l.x,l.y,!0)}),E(this,"onKeyDown",i=>{i.keyCode===27&&this.remove()}),E(this,"onCloseButtonClick",i=>{i.stopPropagation&&i.stopPropagation(),this.hide()}),E(this,"updatePosition",(i,n=!0)=>{const a=!!this.lngLat,{className:o,style:s,maxWidth:l,anchor:u,stopPropagation:c}=this.popupOption;if(!this.mapsService||!a||!this.content)return;const h=this.mapsService.getMarkerContainer();if(!this.container&&h&&(this.container=we("div",`l7-popup ${o??""} ${this.isShow?"":"l7-popup-hide"}`,h),s&&this.container.setAttribute("style",s),this.tip=we("div","l7-popup-tip",this.container),this.container.appendChild(this.content),c&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(f=>{this.container.addEventListener(f,d=>{d.stopPropagation()})}),this.container.style.whiteSpace="nowrap"),n?this.updateLngLatPositionWhenZoom(i):this.updateLngLatPosition(),uB(this.container,`${y0[u]}`),iB(this.container,u,"popup"),l){const{width:f}=this.container.getBoundingClientRect();f>parseFloat(l)&&(this.container.style.width=l)}else this.container.style.removeProperty("width")}),E(this,"updateWhenZoom",i=>{this.updatePosition(i,!0)}),E(this,"update",()=>{this.updatePosition(null,!1)}),this.popupOption=G(G({},this.getDefault(t??{})),t);const{lngLat:e}=this.popupOption;e&&(this.lngLat=e)}getIsShow(){return this.isShow}addTo(t){this.mapsService=t.mapService,this.sceneService=t.sceneService,this.layerService=t.layerService,this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=t,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();const{html:e,text:i,title:n}=this.popupOption;return e?this.setHTML(e):i&&this.setText(i),n&&this.setTitle(n),this.emit("open"),this}remove(){if(this!==null&&this!==void 0&&this.isOpen())return this.content&&xn(this.content),this.container&&(xn(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}getOptions(){return this.popupOption}setOptions(t){this.show();const{className:e}=this.popupOption;if(this.popupOption=G(G({},this.popupOption),t),this.checkUpdateOption(t,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","lngLat","offsets"])&&(this.container&&(xn(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(t,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(t,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(t,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(t,["html"])&&t.html?this.setHTML(t.html):this.checkUpdateOption(t,["text"])&&t.text&&this.setText(t.text),this.checkUpdateOption(t,["className"])){var i;e&&this.container.classList.remove(e??""),this.container.classList.add((i=t.className)!==null&&i!==void 0?i:"")}if(this.checkUpdateOption(t,["style"])){var n;qE(this.container,(n=t.style)!==null&&n!==void 0?n:"")}return this.checkUpdateOption(t,["lngLat"])&&t.lngLat&&this.setLnglat(t.lngLat),this}open(){return this.addTo(this.scene),this}close(){return this.remove(),this}show(){if(!this.isShow)return this.container&&Zc(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}hide(){if(this.isShow)return this.container&&fo(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}setHTML(t){return this.popupOption.html=t,this.setDOMContent(t)}setText(t){return this.popupOption.text=t,this.setDOMContent(window.document.createTextNode(t))}setTitle(t){this.show(),this.popupOption.title=t,t?(this.contentTitle||(this.contentTitle=we("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),mv(this.contentTitle),kl(this.contentTitle,t)):this.contentTitle&&(xn(this.contentTitle),this.contentTitle=void 0)}panToPopup(){const{lng:t,lat:e}=this.lngLat;return this.popupOption.autoPan&&this.mapsService.panTo([t,e]),this}setLngLat(t){return this.setLnglat(t)}setLnglat(t){return this.show(),this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout(()=>{this.panToPopup()},0),this}getLnglat(){return this.lngLat}setMaxWidth(t){return this.popupOption.maxWidth=t,this.update(),this}isOpen(){return!!this.mapsService}getDefault(t){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:Um.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}setDOMContent(t){return this.show(),this.createContent(),kl(this.contentPanel,t),this.update(),this}updateCloseOnClick(t){const e=this.mapsService;e&&(e==null||e.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!t&&requestAnimationFrame(()=>{e==null||e.on("click",this.onCloseButtonClick)}))}updateCloseOnEsc(t){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!t&&window.addEventListener("keydown",this.onKeyDown)}updateFollowCursor(t){var e;const i=(e=this.mapsService)===null||e===void 0?void 0:e.getContainer();i&&(i==null||i.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!t&&(i==null||i.addEventListener("mousemove",this.onMouseMove)))}createContent(){if(this.content&&xn(this.content),this.contentTitle=void 0,this.content=we("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){const t=R0("l7-icon-guanbi");fo(t,"l7-popup-close-button"),this.content.appendChild(t),this.popupOption.closeButtonOffsets&&(t.style.right=this.popupOption.closeButtonOffsets[0]+"px",t.style.top=this.popupOption.closeButtonOffsets[1]+"px"),t.setAttribute("aria-label","Close popup"),t.addEventListener("click",()=>{this.hide()}),t.addEventListener("pointerup",e=>{e.stopPropagation()}),t.addEventListener("pointerdown",e=>{e.stopPropagation()}),this.closeButton=t}else this.closeButton=void 0;this.contentPanel=we("div","l7-popup-content__panel",this.content)}setPopupPosition(t,e,i=!1){if(this.container){const{offsets:n}=this.popupOption;this.container.style.left=t+n[0]+"px",this.container.style.top=e-n[1]+"px",i?this.container.style.transition="left 0.25s cubic-bezier(0,0,0.25,1), top 0.25s cubic-bezier(0,0,0.25,1)":this.container.style.transition=""}}checkUpdateOption(t,e){return e.some(i=>i in t)}}const{get:ytt}=er;class TWt extends mtt{constructor(...t){super(...t),E(this,"layerClickCountByFrame",0),E(this,"layerConfigMap",new WeakMap),E(this,"displayFeatureInfo",void 0),E(this,"onLayerClick",(e,i)=>{requestAnimationFrame(()=>{if(this.popupOption.closeOnClick&&this.layerClickCountByFrame++,this.isShow&&this.isSameFeature(e,i.featureId))this.hide();else{const{title:n,content:a}=this.getLayerInfoFrag(e,i);this.setDOMContent(a),this.setLnglat(i.lngLat),this.setTitle(n),this.setDisplayFeatureInfo({layer:e,featureId:i.featureId}),this.show()}})}),E(this,"onSceneClick",()=>{this.layerClickCountByFrame=0,requestAnimationFrame(()=>{this.layerClickCountByFrame||this.hide()})}),E(this,"onLayerHide",()=>{this.hide(),this.setDisplayFeatureInfo(void 0)}),E(this,"updateCloseOnClick",()=>{})}get layerConfigItems(){var t;const{config:e,items:i}=this.popupOption;return(t=e??i)!==null&&t!==void 0?t:[]}addTo(t){return super.addTo(t),this.bindLayerEvent(),this.hide(),this}remove(){return super.remove(),this.unbindLayerEvent(),this}setOptions(t){this.unbindLayerEvent();const e=G({},t),i=e.trigger||this.popupOption.trigger,n=e.items||this.popupOption.items,a=(n==null?void 0:n.length)===0;e.followCursor=i==="hover"&&!a;const o=this.isShow;return super.setOptions(e),this.bindLayerEvent(),(a||!o)&&this.hide(),this}getDefault(t){const e=t.trigger!=="click";return G(G({},super.getDefault(t)),{},{trigger:"hover",followCursor:e,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!0,autoClose:!1,closeOnEsc:!1})}bindLayerEvent(){const{trigger:t,closeOnClick:e}=this.popupOption;this.layerConfigItems.forEach(i=>{var n;const a=this.getLayerByConfig(i);if(!a)return;const o=G({},i);if(t==="hover"){const c=this.onLayerMouseMove.bind(this,a),h=this.onLayerMouseOut.bind(this,a);o.onMouseMove=c,o.onMouseOut=h,a==null||a.on("mousemove",c),a==null||a.on("mouseout",h)}else{var s;const c=this.onLayerClick.bind(this,a);o.onClick=c,a==null||a.on("click",c);const h=(s=this.mapsService)===null||s===void 0?void 0:s.getMapContainer();h&&e&&h.addEventListener("click",this.onSceneClick)}const l=a==null||(n=a.getSource)===null||n===void 0?void 0:n.call(a),u=this.onSourceUpdate.bind(this);l==null||l.on("update",u),o.onSourceUpdate=u,this.layerConfigMap.set(a,o)})}unbindLayerEvent(){this.layerConfigItems.forEach(t=>{var e;const i=this.getLayerByConfig(t),n=i&&this.layerConfigMap.get(i);if(!n)return;const{onMouseMove:a,onMouseOut:o,onClick:s,onSourceUpdate:l}=n;if(a&&i.off("mousemove",a),o&&i.off("mouseout",o),s&&i.off("click",s),l){var u;i==null||(u=i.getSource())===null||u===void 0||u.off("update",l)}const c=(e=this.mapsService)===null||e===void 0?void 0:e.getMapContainer();c&&c.removeEventListener("click",this.onSceneClick)})}onLayerMouseMove(t,e){if(!this.isSameFeature(t,e.featureId)){const{title:i,content:n}=this.getLayerInfoFrag(t,e);this.setDOMContent(n),this.setTitle(i),this.setDisplayFeatureInfo({layer:t,featureId:e.featureId}),this.show()}}onLayerMouseOut(t,e){this.setDisplayFeatureInfo(void 0),this.isShow&&this.hide()}onSourceUpdate(){this.hide(),this.setDisplayFeatureInfo(void 0)}getLayerInfoFrag(t,e){const i=this.layerConfigMap.get(t);let n;const a=document.createDocumentFragment();if(i){let o=e.feature;o.type==="Feature"&&"properties"in o&&"geometry"in o&&(o=o.properties);const{title:s,fields:l,customContent:u}=i;if(s){n=document.createDocumentFragment();const c=s instanceof Function?s(o):s;kl(n,c)}if(u){const c=u instanceof Function?u(o):u;kl(a,c)}else l!=null&&l.length&&(l==null||l.forEach(c=>{var h,f;const{field:d,formatField:v,formatValue:p,getValue:g}=typeof c=="string"?{field:c}:c,m=we("div","l7-layer-popup__row"),y=g?g(e.feature):ytt(o,d),_=(h=v instanceof Function?v(d,o):v)!==null&&h!==void 0?h:d;let x=(f=p instanceof Function?p(y,o):p)!==null&&f!==void 0?f:y;const C=we("span","l7-layer-popup__key",m);kl(C,_),kl(C,document.createTextNode("："));const A=we("span","l7-layer-popup__value",m);Array.isArray(x)&&x.every(b=>!(b instanceof Object))&&(x=x.map(b=>String(b)).join(",")),kl(A,x),a.appendChild(m)}))}return{title:n,content:a}}getLayerByConfig(t){const e=t.layer;if(e instanceof Object)return e;if(typeof e=="string")return this.layerService.getLayer(e)||this.layerService.getLayerByName(e)}isSameFeature(t,e){const i=this.displayFeatureInfo;return i&&t===i.layer&&e===i.featureId}setDisplayFeatureInfo(t){const e=this.displayFeatureInfo;e&&e.layer.off("hide",this.onLayerHide),t&&t.layer.on("hide",this.onLayerHide),this.displayFeatureInfo=t}}function _tt(r,t){var e=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,i=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(e||i)&&(t||(t=document),!!t)){var n=t.head||t.getElementsByTagName("head")[0];if(!n){n=t.createElement("head");var a=t.body||t.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(n,a):t.documentElement.appendChild(n)}var o=t.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=r:o.appendChild(t.createTextNode(r)),n.appendChild(o),o}}_tt(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}
.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgba(181, 226, 140, 0.6);
  background-clip: padding-box;
  border-radius: 20px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font:
    12px 'Helvetica Neue',
    Arial,
    Helvetica,
    sans-serif;
  text-align: center;
  background-color: rgba(110, 204, 57, 0.6);
  border-radius: 15px;
}
.l7-marker-cluster span {
  line-height: 30px;
}
.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgba(0, 0, 0, 0.2);
}
.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}
.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 999;
  box-sizing: border-box;
}
.l7-control-container {
  font:
    12px/1.5 'Helvetica Neue',
    Arial,
    Helvetica,
    sans-serif;
}
.l7-control-container .l7-control {
  position: relative;
  z-index: 999;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblePainted;
  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control-container .l7-control.l7-control--hide {
  display: none;
}
.l7-control-container .l7-top {
  top: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}
.l7-control-container .l7-right {
  right: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}
.l7-control-container .l7-bottom {
  bottom: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}
.l7-control-container .l7-left {
  left: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}
.l7-control-container .l7-center {
  position: absolute;
  display: flex;
  justify-content: center;
}
.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}
.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}
.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}
.l7-control-container .l7-row {
  flex-direction: row;
}
.l7-control-container .l7-row.l7-top {
  align-items: flex-start;
}
.l7-control-container .l7-row.l7-bottom {
  align-items: flex-end;
}
.l7-control-container .l7-column {
  flex-direction: column;
}
.l7-control-container .l7-column.l7-left {
  align-items: flex-start;
}
.l7-control-container .l7-column.l7-right {
  align-items: flex-end;
}
.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 0 6px;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  line-height: 16px;
}
.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}
.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}
.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}
.l7-button-control.l7-button-control--column {
  height: 44px;
  flex-direction: column;
}
.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}
.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}
.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}
.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}
.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}
.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}
.l7-button-control:disabled:hover {
  background-color: #fafafa;
}
.l7-button-control:disabled:active {
  background-color: #fafafa;
}
.l7-popper {
  position: absolute;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 5;
  color: #595959;
}
.l7-popper.l7-popper-hide {
  display: none;
}
.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-left-color: transparent;
  border-right-color: transparent;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper.l7-popper-left {
  flex-direction: row;
}
.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-right {
  flex-direction: row-reverse;
}
.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-top {
  flex-direction: column;
}
.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-bottom {
  flex-direction: column-reverse;
}
.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-start {
  align-items: flex-start;
}
.l7-popper.l7-popper-end {
  align-items: flex-end;
}
.l7-select-control--normal {
  padding: 4px 0;
}
.l7-select-control--normal .l7-select-control-item {
  display: flex;
  align-items: center;
  height: 24px;
  padding: 0 16px;
  font-size: 12px;
  line-height: 24px;
}
.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}
.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  width: 14px;
  height: 14px;
}
.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}
.l7-select-control--image {
  display: flex;
  flex-wrap: wrap;
  align-items: flex-start;
  box-sizing: content-box;
  max-width: 460px;
  max-height: 400px;
  margin: 12px 0 0 12px;
  overflow-x: hidden;
  overflow-y: auto;
}
.l7-select-control--image .l7-select-control-item {
  position: relative;
  display: flex;
  flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);
  flex-direction: column;
  justify-content: center;
  box-sizing: content-box;
  margin-right: 12px;
  margin-bottom: 12px;
  overflow: hidden;
  font-size: 12px;
  border: 1px solid #fff;
  border-radius: 2px;
}
.l7-select-control--image .l7-select-control-item img {
  width: 100%;
  height: 80px;
}
.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  top: 0;
  right: 0;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: flex;
  align-items: center;
  justify-content: center;
  line-height: 26px;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}
.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}
.l7-select-control-item {
  cursor: pointer;
}
.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}
.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}
.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.l7-control-logo img {
  height: 100%;
  width: 100%;
}
.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}
.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}
.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  padding: 2px 4px;
  min-width: 130px;
}
.l7-control-zoom {
  overflow: hidden;
  border-radius: 2px;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-control-zoom .l7-button-control {
  font-size: 16px;
  border-bottom: 1px solid #f0f0f0;
  border-radius: 0;
  box-shadow: 0 0 0;
}
.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}
.l7-control-zoom .l7-button-control:last-child {
  border-bottom: 0;
}
.l7-control-zoom .l7-control-zoom__number {
  color: #595959;
  padding: 0;
}
.l7-control-zoom .l7-control-zoom__number:hover {
  background-color: #fff;
}
.l7-control-scale {
  display: flex;
  flex-direction: column;
}
.l7-control-scale .l7-control-scale-line {
  box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  transition: width 0.1s;
}
.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}
.l7-right .l7-control-scale {
  display: flex;
  align-items: flex-end;
}
.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: flex;
  will-change: transform;
  pointer-events: none;
}
.l7-popup.l7-popup-hide {
  display: none;
}
.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  font-size: 14px;
  background: #fff;
  border-radius: 3px;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.l7-popup .l7-popup-content .l7-popup-content__title {
  margin-bottom: 8px;
  font-weight: bold;
}
.l7-popup .l7-popup-content .l7-popup-close-button,
.l7-popup .l7-popup-content .l7-popup-content__title,
.l7-popup .l7-popup-content .l7-popup-content__panel {
  white-space: normal;
  -webkit-user-select: text;
     -moz-user-select: text;
      -ms-user-select: text;
          user-select: text;
  pointer-events: initial;
}
.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  padding: 0;
  font-size: 14px;
  line-height: 18px;
  text-align: center;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
}
.l7-popup .l7-popup-tip {
  position: relative;
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}
.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  flex-direction: column-reverse;
}
.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {
  bottom: 1px;
}
.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  flex-direction: column;
}
.l7-popup.l7-popup-anchor-top .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {
  top: 1px;
}
.l7-popup.l7-popup-anchor-left {
  flex-direction: row;
}
.l7-popup.l7-popup-anchor-right {
  flex-direction: row-reverse;
}
.l7-popup-anchor-top .l7-popup-tip {
  position: relative;
  align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-tip {
  align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}
.l7-popup-anchor-top-right .l7-popup-tip {
  align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-bottom .l7-popup-tip {
  align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}
.l7-popup-anchor-bottom-left .l7-popup-tip {
  align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}
.l7-popup-anchor-bottom-right .l7-popup-tip {
  align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}
.l7-popup-anchor-left .l7-popup-tip {
  align-self: center;
  border-right-color: #fff;
  border-left: none;
}
.l7-popup-anchor-right .l7-popup-tip {
  right: 1px;
  align-self: center;
  border-right: none;
  border-left-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}
.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}
.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}
.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}
.l7-popup-track-pointer {
  display: none;
}
.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}
.l7-map:hover .l7-popup-track-pointer {
  display: flex;
}
.l7-map:active .l7-popup-track-pointer {
  display: none;
}
.l7-layer-popup__row {
  font-size: 12px;
}
.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}
.l7-control-swipe {
  position: absolute;
  top: 50%;
  left: 50%;
  z-index: 6;
  -webkit-transform: translate(-50%, -50%);
          transform: translate(-50%, -50%);
  touch-action: none;
}
.l7-control-swipe_hide {
  display: none;
}
.l7-control-swipe:before {
  position: absolute;
  top: -5000px;
  bottom: -5000px;
  left: 50%;
  z-index: -1;
  width: 4px;
  background: #fff;
  -webkit-transform: translate(-2px, 0);
          transform: translate(-2px, 0);
  content: '';
}
.l7-control-swipe.horizontal:before {
  top: 50%;
  right: -5000px;
  bottom: auto;
  left: -5000px;
  width: auto;
  height: 4px;
}
.l7-control-swipe__button {
  display: block;
  width: 28px;
  height: 28px;
  margin: 0;
  padding: 0;
  color: #595959;
  font-weight: bold;
  font-size: inherit;
  text-align: center;
  text-decoration: none;
  background-color: #fff;
  border: none;
  border-radius: 2px;
  outline: none;
}
.l7-control-swipe,
.l7-control-swipe__button {
  cursor: ew-resize;
}
.l7-control-swipe.horizontal,
.l7-control-swipe.horizontal button {
  cursor: ns-resize;
}
.l7-control-swipe:after,
.l7-control-swipe__button:before,
.l7-control-swipe__button:after {
  position: absolute;
  top: 25%;
  bottom: 25%;
  left: 50%;
  width: 2px;
  background: currentColor;
  -webkit-transform: translate(-1px, 0);
          transform: translate(-1px, 0);
  content: '';
}
.l7-control-swipe__button:after {
  -webkit-transform: translateX(4px);
          transform: translateX(4px);
}
.l7-control-swipe__button:before {
  -webkit-transform: translateX(-6px);
          transform: translateX(-6px);
}
`);class Cv{constructor(t){E(this,"configService",void 0),E(this,"config",void 0),this.config=t}setContainer(t,e){this.configService=t.globalConfigService,t.mapConfig=G(G({},this.config),{},{id:e}),t.mapService=new(this.getServiceConstructor())(t)}getServiceConstructor(){throw new Error("Method not implemented.")}}let CD=class{constructor(t){E(this,"size",1e4),this.size=t||1e4}setSize(t){this.size=t}getSize(){return[this.size,this.size]}mercatorXfromLng(t){return(180+t)/360*this.size}mercatorYfromLat(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}lngFromMercatorX(t){return t/this.size*360-180}latFromMercatorY(t){const e=180-(1-t/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90}project(t){const e=this.mercatorXfromLng(t[0]),i=this.mercatorYfromLat(t[1]);return[e,i]}unproject(t){const e=this.lngFromMercatorX(t[0]),i=this.latFromMercatorY(t[1]);return[e,i]}};const xtt=12;class Ctt{constructor(t){E(this,"map",void 0),E(this,"simpleMapCoord",new CD),E(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),E(this,"config",void 0),E(this,"configService",void 0),E(this,"coordinateSystemService",void 0),E(this,"eventEmitter",void 0),E(this,"markerContainer",void 0),E(this,"mapContainer",void 0),E(this,"cameraChangedCallback",void 0),this.config=t.mapConfig,this.configService=t.globalConfigService,this.coordinateSystemService=t.coordinateSystemService,this.eventEmitter=new Li.EventEmitter}onCameraChanged(t){this.cameraChangedCallback=t}updateView(t){var e;this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:t.bearing,center:t.center,viewportHeight:t.viewportHeight,pitch:t.pitch,viewportWidth:t.viewportWidth,zoom:t.zoom}),this.updateCoordinateSystemService(),(e=this.cameraChangedCallback)===null||e===void 0||e.call(this,this.viewport)}updateCoordinateSystemService(){const{offsetCoordinate:t=!0}=this.config;this.viewport.getZoom()>xtt&&t?this.coordinateSystemService.setCoordinateSystem(Kc.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(Kc.LNGLAT)}creatMapContainer(t){let e;return typeof t=="string"?e=document.getElementById(t):e=t,e}getMapStyleValue(t){var e;return(e=this.getMapStyleConfig()[t])!==null&&e!==void 0?e:t}setBgColor(t){this.bgColor=t}getMapContainer(){return this.mapContainer}getMarkerContainer(){return this.markerContainer}getOverlayContainer(){}getCanvasOverlays(){}emit(t,...e){this.eventEmitter.emit(t,...e)}once(t,e){this.eventEmitter.once(t,e)}meterToCoord(t,e){return 1}destroy(){this.eventEmitter.removeAllListeners()}}class Ev{constructor(){E(this,"viewport",new A2)}syncWithMapCamera(t){const{center:e,zoom:i,pitch:n,bearing:a,viewportHeight:o,viewportWidth:s}=t,l={width:this.viewport.width,height:this.viewport.height,longitude:this.viewport.center[0],latitude:this.viewport.center[1],zoom:this.viewport.zoom,pitch:this.viewport.pitch,bearing:this.viewport.bearing};this.viewport=new A2(G(G({},l),{},{width:s,height:o,longitude:e&&e[0],latitude:e&&e[1],zoom:i,pitch:n,bearing:a}))}getZoom(){return this.viewport.zoom}getZoomScale(){return Math.pow(2,this.getZoom())}getCenter(){return[this.viewport.longitude,this.viewport.latitude]}getProjectionMatrix(){return this.viewport.projectionMatrix}getModelMatrix(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}getViewMatrix(){return this.viewport.viewMatrix}getViewMatrixUncentered(){return this.viewport.viewMatrixUncentered}getViewProjectionMatrix(){return this.viewport.viewProjectionMatrix}getViewProjectionMatrixUncentered(){return this.viewport.viewProjectionMatrix}getFocalDistance(){return 1}projectFlat(t,e){return this.viewport.projectFlat(t,e)}}let ED=function(r){return r.GAODE="GAODE",r.MAPBOX="MAPBOX",r.DEFAULT="DEFAUlTMAP",r.SIMPLE="SIMPLE",r.GLOBEL="GLOBEL",r}({});function OR(r={}){const t={top:0,right:0,bottom:0,left:0};if(typeof r=="number")return{top:r,right:r,bottom:r,left:r};if(Array.isArray(r)){if(r.length===4)return{top:r[0],right:r[1],bottom:r[2],left:r[3]};if(r.length===2)return{top:r[0],right:r[1],bottom:r[0],left:r[1]}}return G(G({},t),r)}const Ett={normal:"amap://styles/normal",light:"amap://styles/c422f5c0cfced5be9fe3a83f05f28a68?isPublic=true",dark:"amap://styles/c9f1d10cae34f8ab05e425462c5a58d7?isPublic=true",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true",fresh:"amap://styles/fresh",grey:"amap://styles/grey",graffiti:"amap://styles/graffiti",macaron:"amap://styles/macaron",darkblue:"amap://styles/darkblue",wine:"amap://styles/wine"},Stt=["id","style","minZoom","maxZoom","token","mapInstance","plugin"];function Att(r,t){var e=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,i=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(e||i)&&(t||(t=document),!!t)){var n=t.head||t.getElementsByTagName("head")[0];if(!n){n=t.createElement("head");var a=t.body||t.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(n,a):t.documentElement.appendChild(n)}var o=t.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=r:o.appendChild(t.createTextNode(r)),n.appendChild(o),o}}Att(`.amap-logo {
  display: none !important;
}

.amap-copyright {
  display: none !important;
}

.amap-overlays {
  z-index: 3 !important;
}
`);const Ttt="2.0",PR="f59bcf249433f8b05caaee19f349b3d7",Tl=1;window.forceWebGL=!0;const FR={contextmenu:"rightclick",camerachange:"viewchange"};class btt extends Ctt{constructor(...t){super(...t),E(this,"viewport",new Ev),E(this,"version",ED.GAODE),E(this,"handleCameraChanged",()=>{const e=this.getViewState();this.updateView(e)})}getType(){return"amap"}init(){var t=this;return Z(function*(){const e=t.config,{id:i,style:n="light",minZoom:a=0,maxZoom:o=24,token:s=PR,mapInstance:l,plugin:u=[]}=e,c=An(e,Stt);if(window.AMap||l||(u.push("Map3D"),yield vW.load({key:s,version:Ttt,plugins:u})),l)t.map=l,t.mapContainer=t.map.getContainer(),t.map.on("viewchange",t.handleCameraChanged);else{const h=G({mapStyle:t.getMapStyleValue(n),zooms:[a,o],viewMode:"3D"},c);if(h.zoom&&(h.zoom+=Tl),s===PR&&(window._AMapSecurityConfig={securityJsCode:"2653011adeb04230b3a26cc9a780a800"},console.warn(`%c${t.configService.getSceneWarninfo("MapToken")}!`,"color: #873bf4;font-weigh:900;font-size: 16px;")),!i)throw Error("No container id specified");window.forceWebGL=!0,t.mapContainer=t.creatMapContainer(i);const f=new AMap.Map(t.mapContainer,h);t.map=f,f.on("viewchange",t.handleCameraChanged)}t.syncInitViewPort()})()}syncInitViewPort(){const t=this.getViewState();this.updateView(t)}getViewState(){const{center:t,zoom:e}=wtt(this.map);return{center:t,viewportWidth:this.map.getContainer().clientWidth,viewportHeight:this.map.getContainer().clientHeight,bearing:-this.map.getRotation(),pitch:this.map.getPitch(),zoom:e-Tl}}creatMapContainer(t){const e=super.creatMapContainer(t),i=document.createElement("div");return i.style.cssText+=`
       position: absolute;
       top: 0;
       height: 100%;
       width: 100%;
     `,i.id=er.uniqueId("l7_amap_div"),e.appendChild(i),i}getContainer(){return this.map.getContainer()}addMarkerContainer(){if(!this.map)return;const t=this.map.getContainer();if(t!==null){const e=t.getElementsByClassName("amap-maps")[0];e.style.zIndex="auto",this.markerContainer=we("div","l7-marker-container2",e)}}getMarkerContainer(){return this.markerContainer}getCanvasOverlays(){var t;return(t=this.mapContainer)===null||t===void 0?void 0:t.querySelector(".amap-overlays")}on(t,e){hu.indexOf(t)!==-1?this.eventEmitter.on(t,e):this.map.on(FR[t]||t,e)}off(t,e){hu.indexOf(t)!==-1?this.eventEmitter.off(t,e):this.map.off(FR[t]||t,e)}getSize(){const t=this.map.getSize();return[t.getWidth(),t.getHeight()]}getMinZoom(){return this.map.getZooms()[0]-Tl}getMaxZoom(){return this.map.getZooms()[1]-Tl}getZoom(){return this.map.getZoom()-Tl}getCenter(t){if(t!=null&&t.padding){const i=this.getCenter(),n=OR(t.padding),a=this.lngLatToPixel([i.lng,i.lat]),o=[(n.right-n.left)/2,(n.bottom-n.top)/2];return this.pixelToLngLat([a.x-o[0],a.y-o[1]])}const e=this.map.getCenter();return{lng:e.getLng(),lat:e.getLat()}}getPitch(){return this.map.getPitch()}getRotation(){return 360-this.map.getRotation()}getBounds(){const t=this.map.getBounds(),e=t.getNorthEast(),i=t.getSouthWest(),n=this.getCenter(),a=n.lng>e.getLng()||n.lng<i.getLng()?180-e.getLng():e.getLng();return[[n.lng<i.getLng()?i.getLng()-180:i.getLng(),i.getLat()],[a,e.getLat()]]}getMapContainer(){return this.mapContainer}getMapCanvasContainer(){var t;return(t=this.map.getContainer())===null||t===void 0?void 0:t.getElementsByClassName("amap-maps")[0]}getMapStyleConfig(){return Ett}getMapStyleValue(t){return this.getMapStyleConfig()[t]||t}getMapStyle(){return this.map.getMapStyle()}setMapStyle(t){this.map.setMapStyle(this.getMapStyleValue(t))}setRotation(t){return this.map.setRotation(t)}zoomIn(){this.map.zoomIn()}zoomOut(){this.map.zoomOut()}panTo(t){this.map.panTo(t)}panBy(t=0,e=0){this.map.panBy(t,e)}fitBounds(t){this.map.setBounds(new AMap.Bounds([t[0][0],t[0][1],t[1][0],t[1][1]]),!0)}setZoomAndCenter(t,e){this.map.setZoomAndCenter(t+Tl,e)}setCenter(t,e){if(e!=null&&e.padding){const i=OR(e.padding),n=this.lngLatToPixel(t),a=[(i.right-i.left)/2,(i.bottom-i.top)/2],o=this.pixelToLngLat([n.x+a[0],n.y+a[1]]);this.map.setCenter([o.lng,o.lat])}else this.map.setCenter(t)}setPitch(t){return this.map.setPitch(t)}setZoom(t){return this.map.setZoom(t+Tl)}setMaxZoom(t){throw new Error("Method not implemented.")}setMinZoom(t){throw new Error("Method not implemented.")}setMapStatus(t){this.map.setStatus(t)}meterToCoord(t,e){const i=AMap.GeometryUtil.distance(new AMap.LngLat(...t),new AMap.LngLat(...e)),[n,a]=b_(...t),[o,s]=b_(...e);return Math.sqrt(Math.pow(n-o,2)+Math.pow(a-s,2))/i}pixelToLngLat(t){const e=this.map.pixelToLngLat(new AMap.Pixel(t[0],t[1]));return{lng:e.getLng(),lat:e.getLat()}}lngLatToPixel(t){const e=this.map.lnglatToPixel(t);return{x:e.getX(),y:e.getY()}}containerToLngLat(t){const e=new AMap.Pixel(t[0],t[1]),i=this.map.containerToLngLat(e);return{lng:i==null?void 0:i.getLng(),lat:i==null?void 0:i.getLat()}}lngLatToContainer(t){const e=this.map.lngLatToContainer(t);return{x:e.getX(),y:e.getY()}}lngLatToMercator([t,e],i){const[n,a]=b_(t,e);return{x:n,y:a,z:i}}getModelMatrix(t,e,i,n=[1,1,1]){const a=this.viewport.projectFlat(t),o=Ou();return qa(o,o,Yr(a[0],a[1],e)),Ka(o,o,Yr(n[0],n[1],n[2])),Sh(o,o,i[0]),vv(o,o,i[1]),pv(o,o,i[2]),o}exportMap(t){var e;const i=(e=this.getContainer())===null||e===void 0?void 0:e.getElementsByClassName("amap-layer")[0];return t==="jpg"?i==null?void 0:i.toDataURL("image/jpeg"):i==null?void 0:i.toDataURL("image/png")}destroy(){var t;super.destroy(),(t=this.mapContainer)===null||t===void 0||(t=t.parentNode)===null||t===void 0||t.removeChild(this.mapContainer),delete window.initAMap;const e=document.getElementById("amap-script");e&&document.head.removeChild(e),this.map.destroy()}}function wtt(r){const t=r._view.getOptions(),e=t.center,i=t.zoom;return{center:e,zoom:i}}class lS extends Cv{getServiceConstructor(){return btt}}const Rtt={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},BR={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},Mtt=12;class Gm{constructor(t){E(this,"version","DEFAUlTMAP"),E(this,"map",void 0),E(this,"simpleMapCoord",new CD),E(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),E(this,"config",void 0),E(this,"configService",void 0),E(this,"coordinateSystemService",void 0),E(this,"eventEmitter",void 0),E(this,"markerContainer",void 0),E(this,"cameraChangedCallback",void 0),E(this,"$mapContainer",void 0),E(this,"handleCameraChanged",e=>{const{lat:i,lng:n}=this.map.getCenter();this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:this.map.getBearing(),center:[n,i],viewportHeight:this.map.transform.height,pitch:this.map.getPitch(),viewportWidth:this.map.transform.width,zoom:this.map.getZoom(),cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}),this.config=t.mapConfig,this.configService=t.globalConfigService,this.coordinateSystemService=t.coordinateSystemService,this.eventEmitter=new Li.EventEmitter}setBgColor(t){this.bgColor=t}addMarkerContainer(){const t=this.map.getCanvasContainer();this.markerContainer=we("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}getMarkerContainer(){return this.markerContainer}getOverlayContainer(){}getCanvasOverlays(){}on(t,e){hu.indexOf(t)!==-1?this.eventEmitter.on(t,e):this.map.on(BR[t]||t,e)}off(t,e){this.map.off(BR[t]||t,e),this.eventEmitter.off(t,e)}getContainer(){return this.map.getContainer()}getMapCanvasContainer(){return this.map.getCanvasContainer()}getSize(){if(this.version==="SIMPLE")return this.simpleMapCoord.getSize();const t=this.map.transform;return[t.width,t.height]}getType(){return"default"}getZoom(){return this.map.getZoom()}setZoom(t){return this.map.setZoom(t)}getCenter(){return this.map.getCenter()}setCenter(t){this.map.setCenter(t)}getPitch(){return this.map.getPitch()}getRotation(){return this.map.getBearing()}getBounds(){return this.map.getBounds().toArray()}getMinZoom(){return this.map.getMinZoom()}getMaxZoom(){return this.map.getMaxZoom()}setRotation(t){this.map.setBearing(t)}zoomIn(t,e){this.map.zoomIn(t,e)}zoomOut(t,e){this.map.zoomOut(t,e)}setPitch(t){return this.map.setPitch(t)}panTo(t){this.map.panTo(t)}panBy(t=0,e=0){this.map.panBy([t,e])}fitBounds(t,e){this.map.fitBounds(t,e)}setMaxZoom(t){this.map.setMaxZoom(t)}setMinZoom(t){this.map.setMinZoom(t)}setMapStatus(t){t.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),t.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),t.dragEnable===!1&&this.map.dragPan.disable(),t.dragEnable===!0&&this.map.dragPan.enable(),t.rotateEnable===!1&&this.map.dragRotate.disable(),t.dragEnable===!0&&this.map.dragRotate.enable(),t.keyboardEnable===!1&&this.map.keyboard.disable(),t.keyboardEnable===!0&&this.map.keyboard.enable(),t.zoomEnable===!1&&this.map.scrollZoom.disable(),t.zoomEnable===!0&&this.map.scrollZoom.enable()}setZoomAndCenter(t,e){this.map.flyTo({zoom:t,center:e})}setMapStyle(t){var e;(e=this.map)===null||e===void 0||e.setStyle(this.getMapStyleValue(t))}meterToCoord(t,e){return 1}pixelToLngLat(t){return this.map.unproject(t)}lngLatToPixel(t){return this.map.project(t)}containerToLngLat(t){return this.map.unproject(t)}lngLatToContainer(t){return this.map.project(t)}getMapStyle(){try{var t;const e=(t=this.map.getStyle().sprite)!==null&&t!==void 0?t:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(e)?e==null?void 0:e.replace(/\/\w+$/,"").replace(/sprites/,"styles"):e}catch{return""}}getMapStyleConfig(){return Rtt}getMapStyleValue(t){var e;return(e=this.getMapStyleConfig()[t])!==null&&e!==void 0?e:t}destroy(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}emit(t,...e){this.eventEmitter.emit(t,...e)}once(t,...e){this.eventEmitter.once(t,...e)}getMapContainer(){return this.$mapContainer}exportMap(t){var e;const i=(e=this.map)===null||e===void 0?void 0:e.getCanvas();return t==="jpg"?i==null?void 0:i.toDataURL("image/jpeg"):i==null?void 0:i.toDataURL("image/png")}onCameraChanged(t){this.cameraChangedCallback=t}creatMapContainer(t){let e=t;return typeof t=="string"&&(e=document.getElementById(t)),e}updateView(t){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:t.bearing,center:t.center,viewportHeight:t.viewportHeight,pitch:t.pitch,viewportWidth:t.viewportWidth,zoom:t.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}updateCoordinateSystemService(){const{offsetCoordinate:t=!0}=this.config;this.viewport.getZoom()>Mtt&&t?this.coordinateSystemService.setCoordinateSystem(Kc.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(Kc.LNGLAT)}}const Xn={number:function(t,e,i){return t+i*(e-t)}};function ro(r,t,e){return Math.min(e,Math.max(t,r))}function mc(r,t,e){const i=e-t,n=((r-t)%i+i)%i+t;return n===t?e:n}let Itt=1;function Ltt(){return Itt++}function rr(r,...t){for(const e of t)for(const i in e)r[i]=e[i];return r}function Ott(r,t){const e={};for(let i=0;i<t.length;i++){const n=t[i];n in r&&(e[n]=r[n])}return e}function uS(r,t,e,i){const n=new F$(r,t,e,i);return a=>n.solve(a)}const xx=uS(.25,.1,.25,1),DR={};function Ptt(r){DR[r]||(typeof console<"u"&&console.warn(r),DR[r]=!0)}function NR(r){return r*Math.PI/180}const SD=63710088e-1;class ge{constructor(t,e){if(E(this,"lng",void 0),E(this,"lat",void 0),isNaN(t)||isNaN(e))throw new Error(`Invalid LngLat object: (${t}, ${e})`);if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ge(mc(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const e=Math.PI/180,i=this.lat*e,n=t.lat*e,a=Math.sin(i)*Math.sin(n)+Math.cos(i)*Math.cos(n)*Math.cos((t.lng-this.lng)*e);return SD*Math.acos(Math.min(a,1))}static convert(t){if(t instanceof ge)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new ge(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new ge(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const AD=2*Math.PI*SD;function TD(r){return AD*Math.cos(r*Math.PI/180)}function Hg(r){return(180+r)/360}function $g(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function bD(r,t){return r/TD(t)}function Ftt(r){return r*360-180}function Cx(r){const t=180-r*360;return 360/Math.PI*Math.atan(Math.exp(t*Math.PI/180))-90}function Btt(r,t){return r*TD(Cx(t))}function Dtt(r){return 1/Math.cos(r*Math.PI/180)}class jn{constructor(t,e,i=0){E(this,"x",void 0),E(this,"y",void 0),E(this,"z",void 0),this.x=+t,this.y=+e,this.z=+i}static fromLngLat(t,e=0){const i=ge.convert(t);return new jn(Hg(i.lng),$g(i.lat),bD(e,i.lat))}toLngLat(){return new ge(Ftt(this.x),Cx(this.y))}toAltitude(){return Btt(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/AD*Dtt(Cx(this.y))}}class xa{constructor(t,e){E(this,"_ne",void 0),E(this,"_sw",void 0),t&&(e?this.setSouthWest(t).setNorthEast(e):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof ge?new ge(t.lng,t.lat):ge.convert(t),this}setSouthWest(t){return this._sw=t instanceof ge?new ge(t.lng,t.lat):ge.convert(t),this}extend(t){const e=this._sw,i=this._ne;let n,a;if(t instanceof ge)n=t,a=t;else if(t instanceof xa){if(n=t._sw,a=t._ne,!n||!a)return this}else{if(Array.isArray(t))if(t.length===4||t.every(Array.isArray)){const o=t;return this.extend(xa.convert(o))}else{const o=t;return this.extend(ge.convert(o))}else if(t&&("lng"in t||"lon"in t)&&"lat"in t)return this.extend(ge.convert(t));return this}return!e&&!i?(this._sw=new ge(n.lng,n.lat),this._ne=new ge(a.lng,a.lat)):(e.lng=Math.min(n.lng,e.lng),e.lat=Math.min(n.lat,e.lat),i.lng=Math.max(a.lng,i.lng),i.lat=Math.max(a.lat,i.lat)),this}getCenter(){return new ge((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ge(this.getWest(),this.getNorth())}getSouthEast(){return new ge(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:e,lat:i}=ge.convert(t),n=this._sw.lat<=i&&i<=this._ne.lat;let a=this._sw.lng<=e&&e<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=e&&e>=this._ne.lng),n&&a}static convert(t){return t instanceof xa?t:new xa(t)}static fromLngLat(t,e=0){const n=360*e/40075017,a=n/Math.cos(Math.PI/180*t.lat);return new xa(new ge(t.lng-a,t.lat-n),new ge(t.lng+a,t.lat+n))}}const Ntt="AbortError";function ktt(){return new Error(Ntt)}const Utt=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date);let P_;const Zn={now:Utt,frameAsync(r){return new Promise((t,e)=>{const i=requestAnimationFrame(t);r.signal.addEventListener("abort",()=>{cancelAnimationFrame(i),e(ktt())})})},get prefersReducedMotion(){return window.matchMedia?(P_==null&&(P_=window.matchMedia("(prefers-reduced-motion: reduce)")),P_.matches):!1}};function kR(r,t,e){e[r]&&e[r].indexOf(t)!==-1||(e[r]=e[r]||[],e[r].push(t))}function F_(r,t,e){if(e&&e[r]){const i=e[r].indexOf(t);i!==-1&&e[r].splice(i,1)}}let re=class{constructor(t,e={}){E(this,"type",void 0),rr(this,e),this.type=t}};class ztt extends re{constructor(t,e={}){super("error",e),E(this,"error",void 0),this.error=t}}class Htt{constructor(){E(this,"_listeners",void 0),E(this,"_oneTimeListeners",void 0),E(this,"_eventedParent",void 0),E(this,"_eventedParentData",void 0)}on(t,e){return this._listeners=this._listeners||{},kR(t,e,this._listeners),this}off(t,e){return F_(t,e,this._listeners),F_(t,e,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},kR(t,e,this._oneTimeListeners),this):new Promise(i=>this.once(t,i))}fire(t,e){typeof t=="string"&&(t=new re(t,e||{}));const i=t.type;if(this.listens(i)){t.target=this;const n=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const s of n)s.call(this,t);const a=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const s of a)F_(i,s,this._oneTimeListeners),s.call(this,t);const o=this._eventedParent;o&&(rr(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),o.fire(t))}else t instanceof ztt&&console.error(t.error);return this}emit(t,e){return this.fire(t,e)}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,e){return t&&(this._eventedParent=t),this._eventedParentData=e,this}}class $tt extends Htt{constructor(t,e){super(),E(this,"transform",void 0),E(this,"handlers",void 0),E(this,"_moving",void 0),E(this,"_zooming",void 0),E(this,"_rotating",void 0),E(this,"_pitching",void 0),E(this,"_padding",void 0),E(this,"_bearingSnap",void 0),E(this,"_easeStart",void 0),E(this,"_easeOptions",void 0),E(this,"_easeId",void 0),E(this,"_onEaseFrame",void 0),E(this,"_onEaseEnd",void 0),E(this,"_easeFrameId",void 0),E(this,"_requestedCameraState",void 0),E(this,"transformCameraUpdate",void 0),E(this,"_renderFrameCallback",()=>{const i=Math.min((Zn.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(i)),i<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=e.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new ge(this.transform.center.lng,this.transform.center.lat)}setCenter(t,e){return this.jumpTo({center:t},e)}panBy(t,e,i){return t=he.convert(t).mult(-1),this.panTo(this.transform.center,rr({offset:t},e),i)}panTo(t,e,i){return this.easeTo(rr({center:t},e),i)}getZoom(){return this.transform.zoom}setZoom(t,e){return this.jumpTo({zoom:t},e),this}zoomTo(t,e,i){return this.easeTo(rr({zoom:t},e),i)}zoomIn(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}zoomOut(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}getBearing(){return this.transform.bearing}setBearing(t,e){return this.jumpTo({bearing:t},e),this}getPadding(){return this.transform.padding}setPadding(t,e){return this.jumpTo({padding:t},e),this}rotateTo(t,e,i){return this.easeTo(rr({bearing:t},e),i)}resetNorth(t,e){return this.rotateTo(0,rr({duration:1e3},t),e),this}resetNorthPitch(t,e){return this.easeTo(rr({bearing:0,pitch:0,duration:1e3},t),e),this}snapToNorth(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this}getPitch(){return this.transform.pitch}setPitch(t,e){return this.jumpTo({pitch:t},e),this}cameraForBounds(t,e){t=xa.convert(t);const i=e&&e.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),i,e)}_cameraForBoxAndBearing(t,e,i,n){const a={top:0,bottom:0,right:0,left:0};if(n=rr({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},n),typeof n.padding=="number"){const k=n.padding;n.padding={top:k,bottom:k,right:k,left:k}}n.padding=rr(a,n.padding);const o=this.transform,s=o.padding,l=new xa(t,e),u=o.project(l.getNorthWest()),c=o.project(l.getNorthEast()),h=o.project(l.getSouthEast()),f=o.project(l.getSouthWest()),d=NR(-i),v=u.rotate(d),p=c.rotate(d),g=h.rotate(d),m=f.rotate(d),y=new he(Math.max(v.x,p.x,m.x,g.x),Math.max(v.y,p.y,m.y,g.y)),_=new he(Math.min(v.x,p.x,m.x,g.x),Math.min(v.y,p.y,m.y,g.y)),x=y.sub(_),C=(o.width-(s.left+s.right+n.padding.left+n.padding.right))/x.x,A=(o.height-(s.top+s.bottom+n.padding.top+n.padding.bottom))/x.y;if(A<0||C<0){Ptt("Map cannot fit within canvas with the given bounds, padding, and/or offset.");return}const b=Math.min(o.scaleZoom(o.scale*Math.min(C,A)),n.maxZoom),R=he.convert(n.offset),M=(n.padding.left-n.padding.right)/2,O=(n.padding.top-n.padding.bottom)/2,D=new he(M,O).rotate(NR(i)),j=R.add(D).mult(o.scale/o.zoomScale(b));return{center:o.unproject(u.add(h).div(2).sub(j)),zoom:b,bearing:i}}fitBounds(t,e,i){return this._fitInternal(this.cameraForBounds(t,e),e,i)}fitScreenCoordinates(t,e,i,n,a){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(he.convert(t)),this.transform.pointLocation(he.convert(e)),i,n),n,a)}_fitInternal(t,e,i){return t?(e=rr(t,e),delete e.padding,e.linear?this.easeTo(e,i):this.flyTo(e,i)):this}jumpTo(t,e){this.stop();const i=this._getTransformForUpdate();let n=!1,a=!1,o=!1;return"zoom"in t&&i.zoom!==+t.zoom&&(n=!0,i.zoom=+t.zoom),t.center!==void 0&&(i.center=ge.convert(t.center)),"bearing"in t&&i.bearing!==+t.bearing&&(a=!0,i.bearing=+t.bearing),"pitch"in t&&i.pitch!==+t.pitch&&(o=!0,i.pitch=+t.pitch),t.padding!=null&&!i.isPaddingEqual(t.padding)&&(i.padding=t.padding),this._applyUpdatedTransform(i),this.fire(new re("movestart",e)).fire(new re("move",e)),n&&this.fire(new re("zoomstart",e)).fire(new re("zoom",e)).fire(new re("zoomend",e)),a&&this.fire(new re("rotatestart",e)).fire(new re("rotate",e)).fire(new re("rotateend",e)),o&&this.fire(new re("pitchstart",e)).fire(new re("pitch",e)).fire(new re("pitchend",e)),this.fire(new re("moveend",e))}calculateCameraOptionsFromTo(t,e,i,n=0){const a=jn.fromLngLat(t,e),o=jn.fromLngLat(i,n),s=o.x-a.x,l=o.y-a.y,u=o.z-a.z,c=Math.hypot(s,l,u);if(c===0)throw new Error("Can't calculate camera options with same From and To");const h=Math.hypot(s,l),f=this.transform.scaleZoom(this.transform.cameraToCenterDistance/c/this.transform.tileSize),d=Math.atan2(s,-l)*180/Math.PI;let v=Math.acos(h/c)*180/Math.PI;return v=u<0?90-v:90+v,{center:o.toLngLat(),zoom:f,pitch:v,bearing:d}}easeTo(t,e){var i;this._stop(!1,t.easeId),t=rr({offset:[0,0],duration:500,easing:xx},t),(t.animate===!1||!t.essential&&Zn.prefersReducedMotion)&&(t.duration=0);const n=this._getTransformForUpdate(),a=this.getZoom(),o=this.getBearing(),s=this.getPitch(),l=this.getPadding(),u="bearing"in t?this._normalizeBearing(t.bearing,o):o,c="pitch"in t?+t.pitch:s,h="padding"in t?t.padding:n.padding,f=he.convert(t.offset);let d=n.centerPoint.add(f);const v=n.pointLocation(d),{center:p,zoom:g}=n.getConstrained(ge.convert(t.center||v),(i=t.zoom)!==null&&i!==void 0?i:a);this._normalizeCenter(p);const m=n.project(v),y=n.project(p).sub(m),_=n.zoomScale(g-a);let x,C;t.around&&(x=ge.convert(t.around),C=n.locationPoint(x));const A={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||g!==a,this._rotating=this._rotating||o!==u,this._pitching=this._pitching||c!==s,this._padding=!n.isPaddingEqual(h),this._easeId=t.easeId,this._prepareEase(e,t.noMoveStart,A),this._ease(b=>{if(this._zooming&&(n.zoom=Xn.number(a,g,b)),this._rotating&&(n.bearing=Xn.number(o,u,b)),this._pitching&&(n.pitch=Xn.number(s,c,b)),this._padding&&(n.interpolatePadding(l,h,b),d=n.centerPoint.add(f)),x)n.setLocationAtPoint(x,C);else{const R=n.zoomScale(n.zoom-a),M=g>a?Math.min(2,_):Math.max(.5,_),O=Math.pow(M,1-b),F=n.unproject(m.add(y.mult(b*O)).mult(R));n.setLocationAtPoint(n.renderWorldCopies?F.wrap():F,d)}this._applyUpdatedTransform(n),this._fireMoveEvents(e)},b=>{this._afterEase(e,b)},t),this}_prepareEase(t,e,i={}){this._moving=!0,!e&&!i.moving&&this.fire(new re("movestart",t)),this._zooming&&!i.zooming&&this.fire(new re("zoomstart",t)),this._rotating&&!i.rotating&&this.fire(new re("rotatestart",t)),this._pitching&&!i.pitching&&this.fire(new re("pitchstart",t))}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const e=t.clone(),{center:i,zoom:n,pitch:a,bearing:o,elevation:s}=this.transformCameraUpdate(e);i&&(e.center=i),n!==void 0&&(e.zoom=n),a!==void 0&&(e.pitch=a),o!==void 0&&(e.bearing=o),s!==void 0&&(e.elevation=s),this.transform.apply(e)}_fireMoveEvents(t){this.fire(new re("move",t)),this._zooming&&this.fire(new re("zoom",t)),this._rotating&&this.fire(new re("rotate",t)),this._pitching&&this.fire(new re("pitch",t))}_afterEase(t,e){if(this._easeId&&e&&this._easeId===e)return;delete this._easeId;const i=this._zooming,n=this._rotating,a=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,i&&this.fire(new re("zoomend",t)),n&&this.fire(new re("rotateend",t)),a&&this.fire(new re("pitchend",t)),this.fire(new re("moveend",t))}flyTo(t,e){var i;if(!t.essential&&Zn.prefersReducedMotion){const V=Ott(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(V,e)}this.stop(),t=rr({offset:[0,0],speed:1.2,curve:1.42,easing:xx},t);const n=this._getTransformForUpdate(),a=this.getZoom(),o=this.getBearing(),s=this.getPitch(),l=this.getPadding(),u="bearing"in t?this._normalizeBearing(t.bearing,o):o,c="pitch"in t?+t.pitch:s,h="padding"in t?t.padding:n.padding,f=he.convert(t.offset);let d=n.centerPoint.add(f);const v=n.pointLocation(d),{center:p,zoom:g}=n.getConstrained(ge.convert(t.center||v),(i=t.zoom)!==null&&i!==void 0?i:a);this._normalizeCenter(p);const m=n.zoomScale(g-a),y=n.project(v),_=n.project(p).sub(y);let x=t.curve;const C=Math.max(n.width,n.height),A=C/m,b=_.mag();if("minZoom"in t){const V=ro(Math.min(t.minZoom,a,g),n.minZoom,n.maxZoom),Q=C/n.zoomScale(V-a);x=Math.sqrt(Q/b*2)}const R=x*x;function M(V){const Q=(A*A-C*C+(V?-1:1)*R*R*b*b)/(2*(V?A:C)*R*b);return Math.log(Math.sqrt(Q*Q+1)-Q)}function O(V){return(Math.exp(V)-Math.exp(-V))/2}function F(V){return(Math.exp(V)+Math.exp(-V))/2}function D(V){return O(V)/F(V)}const H=M(!1);let j=function(V){return F(H)/F(H+x*V)},$=function(V){return C*((F(H)*D(H+x*V)-O(H))/R)/b},k=(M(!0)-H)/x;if(Math.abs(b)<1e-6||!isFinite(k)){if(Math.abs(C-A)<1e-6)return this.easeTo(t,e);const V=A<C?-1:1;k=Math.abs(Math.log(A/C))/x,$=()=>0,j=Q=>Math.exp(V*x*Q)}if("duration"in t)t.duration=+t.duration;else{const V="screenSpeed"in t?+t.screenSpeed/x:+t.speed;t.duration=1e3*k/V}return t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=o!==u,this._pitching=c!==s,this._padding=!n.isPaddingEqual(h),this._prepareEase(e,!1),this._ease(V=>{const Q=V*k,Y=1/j(Q);n.zoom=V===1?g:a+n.scaleZoom(Y),this._rotating&&(n.bearing=Xn.number(o,u,V)),this._pitching&&(n.pitch=Xn.number(s,c,V)),this._padding&&(n.interpolatePadding(l,h,V),d=n.centerPoint.add(f));const tt=V===1?p:n.unproject(y.add(_.mult($(Q))).mult(Y));n.setLocationAtPoint(n.renderWorldCopies?tt.wrap():tt,d),this._applyUpdatedTransform(n),this._fireMoveEvents(e)},()=>{this._afterEase(e)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const n=this._onEaseEnd;delete this._onEaseEnd,n.call(this,e)}if(!t){var i;(i=this.handlers)===null||i===void 0||i.stop(!1)}return this}_ease(t,e,i){i.animate===!1||i.duration===0?(t(1),e()):(this._easeStart=Zn.now(),this._easeOptions=i,this._onEaseFrame=t,this._onEaseEnd=e,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,e){t=mc(t,-180,180);const i=Math.abs(t-e);return Math.abs(t-360-e)<i&&(t-=360),Math.abs(t+360-e)<i&&(t+=360),t}_normalizeCenter(t){const e=this.transform;if(!e.renderWorldCopies||e.lngRange)return;const i=t.lng-e.center.lng;t.lng+=i>180?-360:i<-180?360:0}}class cS{constructor(t=0,e=0,i=0,n=0){if(E(this,"top",void 0),E(this,"bottom",void 0),E(this,"left",void 0),E(this,"right",void 0),isNaN(t)||t<0||isNaN(e)||e<0||isNaN(i)||i<0||isNaN(n)||n<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=i,this.right=n}interpolate(t,e,i){return e.top!=null&&t.top!=null&&(this.top=Xn.number(t.top,e.top,i)),e.bottom!=null&&t.bottom!=null&&(this.bottom=Xn.number(t.bottom,e.bottom,i)),e.left!=null&&t.left!=null&&(this.left=Xn.number(t.left,e.left,i)),e.right!=null&&t.right!=null&&(this.right=Xn.number(t.right,e.right,i)),this}getCenter(t,e){const i=ro((this.left+t-this.right)/2,0,t),n=ro((this.top+e-this.bottom)/2,0,e);return new he(i,n)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new cS(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const bp=85.051129;class hS{constructor(t,e,i,n,a){E(this,"tileSize",void 0),E(this,"tileZoom",void 0),E(this,"lngRange",void 0),E(this,"latRange",void 0),E(this,"scale",void 0),E(this,"width",void 0),E(this,"height",void 0),E(this,"angle",void 0),E(this,"rotationMatrix",void 0),E(this,"pixelsToGLUnits",void 0),E(this,"cameraToCenterDistance",void 0),E(this,"mercatorMatrix",void 0),E(this,"projMatrix",void 0),E(this,"invProjMatrix",void 0),E(this,"alignedProjMatrix",void 0),E(this,"pixelMatrix",void 0),E(this,"pixelMatrix3D",void 0),E(this,"pixelMatrixInverse",void 0),E(this,"glCoordMatrix",void 0),E(this,"labelPlaneMatrix",void 0),E(this,"minElevationForCurrentTile",void 0),E(this,"_fov",void 0),E(this,"_pitch",void 0),E(this,"_zoom",void 0),E(this,"_unmodified",void 0),E(this,"_renderWorldCopies",void 0),E(this,"_minZoom",void 0),E(this,"_maxZoom",void 0),E(this,"_minPitch",void 0),E(this,"_maxPitch",void 0),E(this,"_center",void 0),E(this,"_elevation",void 0),E(this,"_pixelPerMeter",void 0),E(this,"_edgeInsets",void 0),E(this,"_constraining",void 0),E(this,"_posMatrixCache",void 0),E(this,"_alignedPosMatrixCache",void 0),this.tileSize=512,this._renderWorldCopies=a===void 0?!0:!!a,this._minZoom=t||0,this._maxZoom=e||22,this._minPitch=i??0,this._maxPitch=n??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new ge(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new cS,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const t=new hS(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this.minElevationForCurrentTile=t.minElevationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new he(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const e=-mc(t,-180,180)*Math.PI/180;this.angle!==e&&(this._unmodified=!1,this.angle=e,this._calcMatrices(),this.rotationMatrix=$$(),W$(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const e=ro(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==e&&(this._unmodified=!1,this._pitch=e,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.tileZoom=Math.max(0,Math.floor(e)),this.scale=this.zoomScale(e),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,e,i){this._unmodified=!1,this._edgeInsets.interpolate(t,e,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)}resize(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const e=ro(t.lat,-bp,bp);return new he(Hg(t.lng)*this.worldSize,$g(e)*this.worldSize)}unproject(t){return new jn(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){const t=this.pointLocation(this.getCameraPoint()),e=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter;return{lngLat:t,altitude:e+this.elevation}}setLocationAtPoint(t,e){const i=this.pointCoordinate(e),n=this.pointCoordinate(this.centerPoint),a=this.locationCoordinate(t),o=new jn(a.x-(i.x-n.x),a.y-(i.y-n.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t){return this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}locationCoordinate(t){return jn.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t){const i=[t.x,t.y,0,1],n=[t.x,t.y,1,1];Nl(i,i,this.pixelMatrixInverse),Nl(n,n,this.pixelMatrixInverse);const a=i[3],o=n[3],s=i[0]/a,l=n[0]/o,u=i[1]/a,c=n[1]/o,h=i[2]/a,f=n[2]/o,d=h===f?0:(0-h)/(f-h);return new jn(Xn.number(s,l,d)/this.worldSize,Xn.number(u,c,d)/this.worldSize)}coordinatePoint(t,e=0,i=this.pixelMatrix){const n=[t.x*this.worldSize,t.y*this.worldSize,e,1];return Nl(n,n,i),new he(n[0]/n[3],n[1]/n[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new xa().extend(this.pointLocation(new he(0,t))).extend(this.pointLocation(new he(this.width,t))).extend(this.pointLocation(new he(this.width,this.height))).extend(this.pointLocation(new he(0,this.height)))}getMaxBounds(){return!this.latRange||this.latRange.length!==2||!this.lngRange||this.lngRange.length!==2?null:new xa([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]])}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-bp,bp])}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(t,e){e=ro(+e,this.minZoom,this.maxZoom);const i={center:new ge(t.lng,t.lat),zoom:e};let n=this.lngRange;if(!this._renderWorldCopies&&n===null){const C=179.9999999999;n=[-C,C]}const a=this.tileSize*this.zoomScale(i.zoom);let o=0,s=a,l=0,u=a,c=0,h=0;const{x:f,y:d}=this.size;if(this.latRange){const C=this.latRange;o=$g(C[1])*a,s=$g(C[0])*a,s-o<d&&(c=d/(s-o))}n&&(l=mc(Hg(n[0])*a,0,a),u=mc(Hg(n[1])*a,0,a),u<l&&(u+=a),u-l<f&&(h=f/(u-l)));const{x:v,y:p}=this.project.call({worldSize:a},t);let g,m;const y=Math.max(h||0,c||0);if(y){const C=new he(h?(u+l)/2:v,c?(s+o)/2:p);return i.center=this.unproject.call({worldSize:a},C).wrap(),i.zoom+=this.scaleZoom(y),i}if(this.latRange){const C=d/2;p-C<o&&(m=o+C),p+C>s&&(m=s-C)}if(n){const C=(l+u)/2;let A=v;this._renderWorldCopies&&(A=mc(v,C-a/2,C+a/2));const b=f/2;A-b<l&&(g=l+b),A+b>u&&(g=u-b)}if(g!==void 0||m!==void 0){var _,x;const C=new he((_=g)!==null&&_!==void 0?_:v,(x=m)!==null&&x!==void 0?x:p);i.center=this.unproject.call({worldSize:a},C).wrap()}return i}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:e,zoom:i}=this.getConstrained(this.center,this.zoom);this.center=e,this.zoom=i,this._unmodified=t,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this._fov/2,e=this.centerOffset,i=this.point.x,n=this.point.y;this.cameraToCenterDistance=.5/Math.tan(t)*this.height,this._pixelPerMeter=bD(1,this.center.lat)*this.worldSize;let a=m2(new Float64Array(16));Ka(a,a,[this.width/2,-this.height/2,1]),qa(a,a,[1,-1,0]),this.labelPlaneMatrix=a,a=m2(new Float64Array(16)),Ka(a,a,[1,-1,1]),qa(a,a,[-1,-1,0]),Ka(a,a,[2/this.width,2/this.height,1]),this.glCoordMatrix=a;const o=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),s=Math.min(this.elevation,this.minElevationForCurrentTile),l=o-s*this._pixelPerMeter/Math.cos(this._pitch),u=s<0?l:o,c=Math.PI/2+this._pitch,h=this._fov*(.5+e.y/this.height),f=Math.sin(h)*u/Math.sin(ro(Math.PI-c-h,.01,Math.PI-.01)),d=this.getHorizon(),p=2*Math.atan(d/this.cameraToCenterDistance)*(.5+e.y/(d*2)),g=Math.sin(p)*u/Math.sin(ro(Math.PI-c-p,.01,Math.PI-.01)),m=Math.min(f,g),y=(Math.cos(Math.PI/2-this._pitch)*m+u)*1.01,_=this.height/50;a=new Float64Array(16),V$(a,this._fov,this.width/this.height,_,y),a[8]=-e.x*2/this.width,a[9]=e.y*2/this.height,Ka(a,a,[1,-1,1]),qa(a,a,[0,0,-this.cameraToCenterDistance]),Sh(a,a,this._pitch),pv(a,a,this.angle),qa(a,a,[-i,-n,0]),this.mercatorMatrix=Ka([],a,[this.worldSize,this.worldSize,this.worldSize]),Ka(a,a,[1,1,this._pixelPerMeter]),this.pixelMatrix=Xf(new Float64Array(16),this.labelPlaneMatrix,a),qa(a,a,[0,0,-this.elevation]),this.projMatrix=a,this.invProjMatrix=g0([],a),this.pixelMatrix3D=Xf(new Float64Array(16),this.labelPlaneMatrix,a);const x=this.width%2/2,C=this.height%2/2,A=Math.cos(this.angle),b=Math.sin(this.angle),R=i-Math.round(i)+A*x+b*C,M=n-Math.round(n)+A*C+b*x,O=new Float64Array(a);if(qa(O,O,[R>.5?R-1:R,M>.5?M-1:M,0]),this.alignedProjMatrix=O,a=g0(new Float64Array(16),this.pixelMatrix),!a)throw new Error("failed to invert matrix");this.pixelMatrixInverse=a,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new he(0,0)),e=[t.x*this.worldSize,t.y*this.worldSize,0,1];return Nl(e,e,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=this._pitch,e=Math.tan(t)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new he(0,e))}getCameraQueryGeometry(t){const e=this.getCameraPoint();if(t.length===1)return[t[0],e];{let i=e.x,n=e.y,a=e.x,o=e.y;for(const s of t)i=Math.min(i,s.x),n=Math.min(n,s.y),a=Math.max(a,s.x),o=Math.max(o,s.y);return[new he(i,n),new he(a,n),new he(a,o),new he(i,o),new he(i,n)]}}lngLatToCameraDepth(t,e){const i=this.locationCoordinate(t),n=[i.x*this.worldSize,i.y*this.worldSize,e,1];return Nl(n,n,this.projMatrix),n[2]/n[3]}}var fS;class Ot{static testProp(t){if(!Ot.docStyle)return t[0];for(let e=0;e<t.length;e++)if(t[e]in Ot.docStyle)return t[e];return t[0]}static create(t,e,i){const n=window.document.createElement(t);return e!==void 0&&(n.className=e),i&&i.appendChild(n),n}static createNS(t,e){return window.document.createElementNS(t,e)}static disableDrag(){Ot.docStyle&&Ot.selectProp&&(Ot.userSelect=Ot.docStyle[Ot.selectProp],Ot.docStyle[Ot.selectProp]="none")}static enableDrag(){Ot.docStyle&&Ot.selectProp&&(Ot.docStyle[Ot.selectProp]=Ot.userSelect)}static setTransform(t,e){t.style[Ot.transformProp]=e}static addEventListener(t,e,i,n={}){"passive"in n?t.addEventListener(e,i,n):t.addEventListener(e,i,n.capture)}static removeEventListener(t,e,i,n={}){"passive"in n?t.removeEventListener(e,i,n):t.removeEventListener(e,i,n.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",Ot.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Ot.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",Ot.suppressClickInternal,!0)},0)}static getScale(t){const e=t.getBoundingClientRect();return{x:e.width/t.offsetWidth||1,y:e.height/t.offsetHeight||1,boundingClientRect:e}}static getPoint(t,e,i){const n=e.boundingClientRect;return new he((i.clientX-n.left)/e.x-t.clientLeft,(i.clientY-n.top)/e.y-t.clientTop)}static mousePos(t,e){const i=Ot.getScale(t);return Ot.getPoint(t,i,e)}static touchPos(t,e){const i=[],n=Ot.getScale(t);for(let a=0;a<e.length;a++)i.push(Ot.getPoint(t,n,e[a]));return i}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}fS=Ot;E(Ot,"docStyle",typeof window<"u"&&window.document&&window.document.documentElement.style);E(Ot,"userSelect",void 0);E(Ot,"selectProp",fS.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]));E(Ot,"transformProp",fS.testProp(["transform","WebkitTransform"]));class Sv{constructor(t){E(this,"_map",void 0),this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(he.convert(t))}}class Wtt{constructor(t,e){E(this,"_map",void 0),E(this,"_tr",void 0),E(this,"_el",void 0),E(this,"_container",void 0),E(this,"_enabled",void 0),E(this,"_active",void 0),E(this,"_startPos",void 0),E(this,"_lastPos",void 0),E(this,"_box",void 0),E(this,"_clickTolerance",void 0),this._map=t,this._tr=new Sv(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,e){this.isEnabled()&&t.shiftKey&&t.button===0&&(Ot.disableDrag(),this._startPos=this._lastPos=e,this._active=!0)}mousemoveWindow(t,e){if(!this._active)return;const i=e;if(this._lastPos.equals(i)||!this._box&&i.dist(this._startPos)<this._clickTolerance)return;const n=this._startPos;this._lastPos=i,this._box||(this._box=Ot.create("div","l7-boxzoom",this._container),this._container.classList.add("l7-crosshair"),this._fireEvent("boxzoomstart",t));const a=Math.min(n.x,i.x),o=Math.max(n.x,i.x),s=Math.min(n.y,i.y),l=Math.max(n.y,i.y);Ot.setTransform(this._box,`translate(${a}px,${s}px)`),this._box.style.width=`${o-a}px`,this._box.style.height=`${l-s}px`}mouseupWindow(t,e){if(!this._active||t.button!==0)return;const i=this._startPos,n=e;if(this.reset(),Ot.suppressClick(),i.x===n.x&&i.y===n.y)this._fireEvent("boxzoomcancel",t);else return this._map.fire(new re("boxzoomend",{originalEvent:t})),{cameraAnimation:a=>a.fitScreenCoordinates(i,n,this._tr.bearing,{linear:!0})}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("l7-crosshair"),this._box&&(Ot.remove(this._box),this._box=null),Ot.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,e){return this._map.fire(new re(t,{originalEvent:e}))}}class Vtt{constructor(t){E(this,"_tr",void 0),E(this,"_enabled",void 0),E(this,"_active",void 0),this._tr=new Sv(t),this.reset()}reset(){this._active=!1}dblclick(t,e){return t.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(e)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gtt{constructor(t,e){E(this,"_options",void 0),E(this,"_map",void 0),E(this,"_container",void 0),E(this,"_bypassKey",navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey"),E(this,"_enabled",void 0),this._map=t,this._options=e,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("l7-cooperative-gestures"),this._container=Ot.create("div","l7-cooperative-gesture-screen",t);const e=document.createElement("div");e.className="l7-desktop-message",e.textContent="Missing UI string",this._container.appendChild(e);const i=document.createElement("div");i.className="l7-mobile-message",i.textContent="Missing UI string",this._container.appendChild(i),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(Ot.remove(this._container),this._map.getCanvasContainer().classList.remove("l7-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(t){this._onCooperativeGesture(t.touches.length===1)}wheel(t){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!t[this._bypassKey])}_onCooperativeGesture(t){!this._enabled||!t||(this._container.classList.add("l7-show"),setTimeout(()=>{this._container.classList.remove("l7-show")},100))}}const Xtt={panStep:100,bearingStep:15,pitchStep:10};class Ytt{constructor(t){E(this,"_tr",void 0),E(this,"_enabled",void 0),E(this,"_active",void 0),E(this,"_panStep",void 0),E(this,"_bearingStep",void 0),E(this,"_pitchStep",void 0),E(this,"_rotationDisabled",void 0),this._tr=new Sv(t);const e=Xtt;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let e=0,i=0,n=0,a=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?i=-1:(t.preventDefault(),a=-1);break;case 39:t.shiftKey?i=1:(t.preventDefault(),a=1);break;case 38:t.shiftKey?n=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?n=-1:(t.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(i=0,n=0),{cameraAnimation:s=>{const l=this._tr;s.easeTo({duration:300,easeId:"keyboardHandler",easing:jtt,zoom:e?Math.round(l.zoom)+e*(t.shiftKey?2:1):l.zoom,bearing:l.bearing+i*this._bearingStep,pitch:l.pitch+n*this._pitchStep,offset:[-a*this._panStep,-o*this._panStep],center:l.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function jtt(r){return r*(2-r)}class Ztt{constructor(t){E(this,"size",1e4),this.size=t||1e4}setSize(t){this.size=t}getSize(){return[this.size,this.size]}mercatorXfromLng(t){return(180+t)/360*this.size}mercatorYfromLat(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}lngFromMercatorX(t){return t/this.size*360-180}latFromMercatorY(t){const e=180-(1-t/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90}project(t){const e=this.mercatorXfromLng(t[0]),i=this.mercatorYfromLat(t[1]);return[e,i]}unproject(t){const e=this.lngFromMercatorX(t[0]),i=this.latFromMercatorY(t[1]);return[e,i]}}class Ho extends re{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,i,n={}){super(t,n),E(this,"target",void 0),E(this,"originalEvent",void 0),E(this,"point",void 0),E(this,"lngLat",void 0),E(this,"_defaultPrevented",void 0);const a=Ot.mousePos(e.getCanvasContainer(),i),o=e.unproject(a);if(this.point=a,this.lngLat=o,this.originalEvent=i,this._defaultPrevented=!1,this.target=e,e.version==="SIMPLE"){const s=new Ztt(e.mapSize),[l,u]=s.project([o.lng,o.lat]);this.lngLat={lng:l,lat:u}}}}class wp extends re{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,i){super(t),E(this,"target",void 0),E(this,"originalEvent",void 0),E(this,"lngLat",void 0),E(this,"point",void 0),E(this,"points",void 0),E(this,"lngLats",void 0),E(this,"_defaultPrevented",void 0);const n=t==="touchend"?i.changedTouches:i.touches,a=Ot.touchPos(e.getCanvasContainer(),n),o=a.map(u=>e.unproject(u)),s=a.reduce((u,c,h,f)=>u.add(c.div(f.length)),new he(0,0)),l=e.unproject(s);this.target=e,this.points=a,this.point=s,this.lngLats=o,this.lngLat=l,this.originalEvent=i,this._defaultPrevented=!1}}class qtt extends re{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,i){super(t),E(this,"target",void 0),E(this,"originalEvent",void 0),E(this,"_defaultPrevented",void 0),this.target=e,this._defaultPrevented=!1,this.originalEvent=i}}class Ktt{constructor(t,e){E(this,"_mousedownPos",void 0),E(this,"_clickTolerance",void 0),E(this,"_map",void 0),this._map=t,this._clickTolerance=e.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new qtt(t.type,this._map,t))}mousedown(t,e){return this._mousedownPos=e,this._firePreventable(new Ho(t.type,this._map,t))}mouseup(t){this._map.fire(new Ho(t.type,this._map,t))}click(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||this._map.fire(new Ho(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Ho(t.type,this._map,t))}mouseover(t){this._map.fire(new Ho(t.type,this._map,t))}mouseout(t){this._map.fire(new Ho(t.type,this._map,t))}touchstart(t){return this._firePreventable(new wp(t.type,this._map,t))}touchmove(t){this._map.fire(new wp(t.type,this._map,t))}touchend(t){this._map.fire(new wp(t.type,this._map,t))}touchcancel(t){this._map.fire(new wp(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qtt{constructor(t){E(this,"_map",void 0),E(this,"_delayContextMenu",void 0),E(this,"_ignoreContextMenu",void 0),E(this,"_contextMenuEvent",void 0),this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Ho(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ho("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Ho(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class dS{constructor(t){E(this,"contextmenu",void 0),E(this,"mousedown",void 0),E(this,"mousemoveWindow",void 0),E(this,"mouseup",void 0),E(this,"touchstart",void 0),E(this,"touchmoveWindow",void 0),E(this,"touchend",void 0),E(this,"_clickTolerance",void 0),E(this,"_moveFunction",void 0),E(this,"_activateOnStart",void 0),E(this,"_active",void 0),E(this,"_enabled",void 0),E(this,"_moved",void 0),E(this,"_lastPoint",void 0),E(this,"_moveStateManager",void 0),this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const e=this._moveFunction(...t);if(e.bearingDelta||e.pitchDelta||e.around||e.panDelta)return this._active=!0,e}dragStart(t,e){!this.isEnabled()||this._lastPoint||this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=e.length?e[0]:e,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,e){if(!this.isEnabled())return;const i=this._lastPoint;if(!i)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t)){this.reset(t);return}const n=e.length?e[0]:e;if(!(!this._moved&&n.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=n,this._move(i,n)}dragEnd(t){!this.isEnabled()||!this._lastPoint||this._moveStateManager.isValidEndEvent(t)&&(this._moved&&Ot.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Jtt=0,tet=2,eet={[Jtt]:1,[tet]:2};function ret(r,t){const e=eet[t];return r.buttons===void 0||(r.buttons&e)!==e}class vS{constructor(t){E(this,"_eventButton",void 0),E(this,"_correctEvent",void 0),this._correctEvent=t.checkCorrectEvent}startMove(t){const e=Ot.mouseButton(t);this._eventButton=e}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!ret(t,this._eventButton)}isValidEndEvent(t){return Ot.mouseButton(t)===this._eventButton}}const pS=0,wD=2,gS=r=>{r.mousedown=r.dragStart,r.mousemoveWindow=r.dragMove,r.mouseup=r.dragEnd,r.contextmenu=t=>{t.preventDefault()}},iet=({enable:r,clickTolerance:t})=>{const e=new vS({checkCorrectEvent:i=>Ot.mouseButton(i)===pS&&!i.ctrlKey});return new dS({clickTolerance:t,move:(i,n)=>({around:n,panDelta:n.sub(i)}),activateOnStart:!0,moveStateManager:e,enable:r,assignEvents:gS})},net=({enable:r,clickTolerance:t,bearingDegreesPerPixelMoved:e=.8})=>{const i=new vS({checkCorrectEvent:n=>Ot.mouseButton(n)===pS&&n.ctrlKey||Ot.mouseButton(n)===wD});return new dS({clickTolerance:t,move:(n,a)=>({bearingDelta:(a.x-n.x)*e}),moveStateManager:i,enable:r,assignEvents:gS})},aet=({enable:r,clickTolerance:t,pitchDegreesPerPixelMoved:e=-.5})=>{const i=new vS({checkCorrectEvent:n=>Ot.mouseButton(n)===pS&&n.ctrlKey||Ot.mouseButton(n)===wD});return new dS({clickTolerance:t,move:(n,a)=>({pitchDelta:(a.y-n.y)*e}),moveStateManager:i,enable:r,assignEvents:gS})},UR=4.000244140625,oet=1/100,set=1/450,uet=2;class cet{constructor(t,e){E(this,"_map",void 0),E(this,"_tr",void 0),E(this,"_enabled",void 0),E(this,"_active",void 0),E(this,"_zooming",void 0),E(this,"_aroundCenter",void 0),E(this,"_around",void 0),E(this,"_aroundPoint",void 0),E(this,"_type",void 0),E(this,"_lastValue",void 0),E(this,"_timeout",void 0),E(this,"_finishTimeout",void 0),E(this,"_lastWheelEvent",void 0),E(this,"_lastWheelEventTime",void 0),E(this,"_startZoom",void 0),E(this,"_targetZoom",void 0),E(this,"_delta",void 0),E(this,"_easing",void 0),E(this,"_prevEase",void 0),E(this,"_frameId",void 0),E(this,"_triggerRenderFrame",void 0),E(this,"_defaultZoomRate",void 0),E(this,"_wheelZoomRate",void 0),E(this,"_onTimeout",i=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}),this._map=t,this._tr=new Sv(t),this._triggerRenderFrame=e,this._delta=0,this._defaultZoomRate=oet,this._wheelZoomRate=set}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!t[this._map.cooperativeGestures._bypassKey])return;let e=t.deltaMode===WheelEvent.DOM_DELTA_LINE?t.deltaY*40:t.deltaY;const i=Zn.now(),n=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,e!==0&&e%UR===0?this._type="wheel":e!==0&&Math.abs(e)<4?this._type="trackpad":n>400?(this._type=null,this._lastValue=e,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(n*e)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,e+=this._lastValue)),t.shiftKey&&e&&(e=e/4),this._type&&(this._lastWheelEvent=t,this._delta-=e,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const e=Ot.mousePos(this._map.getCanvasContainer(),t),i=this._tr;e.y>i.transform.height/2-i.transform.getHorizon()?this._around=ge.convert(this._aroundCenter?i.center:i.unproject(e)):this._around=ge.convert(i.center),this._aroundPoint=i.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const s=this._type==="wheel"&&Math.abs(this._delta)>UR?this._wheelZoomRate:this._defaultZoomRate;let l=uet/(1+Math.exp(-Math.abs(this._delta*s)));this._delta<0&&l!==0&&(l=1/l);const u=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(u*l))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const e=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,i=this._startZoom,n=this._easing;let a=!1,o;if(this._type==="wheel"&&i&&n){const s=Math.min((Zn.now()-this._lastWheelEventTime)/200,1),l=n(s);o=Xn.number(i,e,l),s<1?this._frameId||(this._frameId=!0):a=!0}else o=e,a=!0;return this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!a,zoomDelta:o-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let e=xx;if(this._prevEase){const i=this._prevEase,n=(Zn.now()-i.start)/i.duration,a=i.easing(n+.01)-i.easing(n),o=.27/Math.sqrt(a*a+1e-4)*.01,s=Math.sqrt(.27*.27-o*o);e=uS(o,s,.25,1)}return this._prevEase={start:Zn.now(),duration:t,easing:e},e}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class het{constructor(t,e){E(this,"_clickZoom",void 0),E(this,"_tapZoom",void 0),this._clickZoom=t,this._tapZoom=e}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class fet{constructor(t,e,i){E(this,"_el",void 0),E(this,"_mousePan",void 0),E(this,"_touchPan",void 0),E(this,"_inertiaOptions",void 0),this._el=t,this._mousePan=e,this._touchPan=i}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("l7-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("l7-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class det{constructor(t,e,i){E(this,"_mouseRotate",void 0),E(this,"_mousePitch",void 0),E(this,"_pitchWithRotate",void 0),this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class vet{constructor(t,e,i,n){E(this,"_el",void 0),E(this,"_touchZoom",void 0),E(this,"_touchRotate",void 0),E(this,"_tapDragZoom",void 0),E(this,"_rotationDisabled",void 0),E(this,"_enabled",void 0),this._el=t,this._touchZoom=e,this._touchRotate=i,this._tapDragZoom=n,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("l7-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("l7-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}function Ex(r,t){if(r.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${r.length}, points ${t.length}`);const e={};for(let i=0;i<r.length;i++)e[r[i].identifier]=t[i];return e}function pet(r){const t=new he(0,0);for(const e of r)t._add(e);return t.div(r.length)}const RD=500,get=500,mS=30;class met{constructor(t){E(this,"numTouches",void 0),E(this,"centroid",void 0),E(this,"startTime",void 0),E(this,"aborted",void 0),E(this,"touches",void 0),this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,e,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),!this.aborted&&(this.startTime===void 0&&(this.startTime=t.timeStamp),i.length===this.numTouches&&(this.centroid=pet(e),this.touches=Ex(i,e)))}touchmove(t,e,i){if(this.aborted||!this.centroid)return;const n=Ex(i,e);for(const a in this.touches){const o=this.touches[a],s=n[a];(!s||s.dist(o)>mS)&&(this.aborted=!0)}}touchend(t,e,i){if((!this.centroid||t.timeStamp-this.startTime>get)&&(this.aborted=!0),i.length===0){const n=!this.aborted&&this.centroid;if(this.reset(),n)return n}}}class Sx{constructor(t){E(this,"singleTap",void 0),E(this,"numTaps",void 0),E(this,"lastTime",void 0),E(this,"lastTap",void 0),E(this,"count",void 0),this.singleTap=new met(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,e,i){this.singleTap.touchstart(t,e,i)}touchmove(t,e,i){this.singleTap.touchmove(t,e,i)}touchend(t,e,i){const n=this.singleTap.touchend(t,e,i);if(n){const a=t.timeStamp-this.lastTime<RD,o=!this.lastTap||this.lastTap.dist(n)<mS;if((!a||!o)&&this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=n,this.count===this.numTaps)return this.reset(),n}}}class yet{constructor(){E(this,"_enabled",void 0),E(this,"_active",void 0),E(this,"_swipePoint",void 0),E(this,"_swipeTouch",void 0),E(this,"_tapTime",void 0),E(this,"_tapPoint",void 0),E(this,"_tap",void 0),this._tap=new Sx({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,e,i){if(!this._swipePoint)if(!this._tapTime)this._tap.touchstart(t,e,i);else{const n=e[0],a=t.timeStamp-this._tapTime<RD,o=this._tapPoint.dist(n)<mS;!a||!o?this.reset():i.length>0&&(this._swipePoint=n,this._swipeTouch=i[0].identifier)}}touchmove(t,e,i){if(!this._tapTime)this._tap.touchmove(t,e,i);else if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const n=e[0],a=n.y-this._swipePoint.y;return this._swipePoint=n,t.preventDefault(),this._active=!0,{zoomDelta:a/128}}}touchend(t,e,i){if(this._tapTime)this._swipePoint&&i.length===0&&this.reset();else{const n=this._tap.touchend(t,e,i);n&&(this._tapTime=t.timeStamp,this._tapPoint=n)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _et{constructor(t){E(this,"_tr",void 0),E(this,"_enabled",void 0),E(this,"_active",void 0),E(this,"_zoomIn",void 0),E(this,"_zoomOut",void 0),this._tr=new Sv(t),this._zoomIn=new Sx({numTouches:1,numTaps:2}),this._zoomOut=new Sx({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,e,i){this._zoomIn.touchstart(t,e,i),this._zoomOut.touchstart(t,e,i)}touchmove(t,e,i){this._zoomIn.touchmove(t,e,i),this._zoomOut.touchmove(t,e,i)}touchend(t,e,i){const n=this._zoomIn.touchend(t,e,i),a=this._zoomOut.touchend(t,e,i),o=this._tr;if(n)return this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:s=>s.easeTo({duration:300,zoom:o.zoom+1,around:o.unproject(n)},{originalEvent:t})};if(a)return this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:s=>s.easeTo({duration:300,zoom:o.zoom-1,around:o.unproject(a)},{originalEvent:t})}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xet{constructor(t,e){E(this,"_enabled",void 0),E(this,"_active",void 0),E(this,"_touches",void 0),E(this,"_clickTolerance",void 0),E(this,"_sum",void 0),E(this,"_map",void 0),this._clickTolerance=t.clickTolerance||1,this._map=e,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new he(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(t,e,i){return this._calculateTransform(t,e,i)}touchmove(t,e,i){if(!(!this._active||i.length<this.minTouchs()))return t.preventDefault(),this._calculateTransform(t,e,i)}touchend(t,e,i){this._calculateTransform(t,e,i),this._active&&i.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,e,i){i.length>0&&(this._active=!0);const n=Ex(i,e),a=new he(0,0),o=new he(0,0);let s=0;for(const c in n){const h=n[c],f=this._touches[c];f&&(a._add(h),o._add(h.sub(f)),s++,n[c]=h)}if(this._touches=n,s<this.minTouchs()||!o.mag())return;const l=o.div(s);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:a.div(s),panDelta:l}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yS{constructor(){E(this,"_enabled",void 0),E(this,"_active",void 0),E(this,"_firstTwoTouches",void 0),E(this,"_vector",void 0),E(this,"_startVector",void 0),E(this,"_aroundCenter",void 0),this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,e,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([e[0],e[1]]))}touchmove(t,e,i){if(!this._firstTwoTouches)return;t.preventDefault();const[n,a]=this._firstTwoTouches,o=Rp(i,e,n),s=Rp(i,e,a);if(!o||!s)return;const l=this._aroundCenter?null:o.add(s).div(2);return this._move([o,s],l,t)}touchend(t,e,i){if(!this._firstTwoTouches)return;const[n,a]=this._firstTwoTouches,o=Rp(i,e,n),s=Rp(i,e,a);o&&s||(this._active&&Ot.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Rp(r,t,e){for(let i=0;i<r.length;i++)if(r[i].identifier===e)return t[i]}const Cet=.1;function zR(r,t){return Math.log(r/t)/Math.LN2}class Eet extends yS{constructor(...t){super(...t),E(this,"_distance",void 0),E(this,"_startDistance",void 0)}reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,e){const i=this._distance;if(this._distance=t[0].dist(t[1]),!(!this._active&&Math.abs(zR(this._distance,this._startDistance))<Cet))return this._active=!0,{zoomDelta:zR(this._distance,i),pinchAround:e}}}const Aet=25;function HR(r,t){return r.angleWith(t)*180/Math.PI}class Tet extends yS{constructor(...t){super(...t),E(this,"_minDiameter",void 0)}reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,e,i){const n=this._vector;if(this._vector=t[0].sub(t[1]),!(!this._active&&this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:HR(this._vector,n),pinchAround:e}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const e=Math.PI*this._minDiameter,i=Aet/e*360,n=HR(t,this._startVector);return Math.abs(n)<i}}function B_(r){return Math.abs(r.y)>Math.abs(r.x)}const bet=100;class wet extends yS{constructor(t){super(),E(this,"_valid",void 0),E(this,"_firstMove",void 0),E(this,"_lastPoints",void 0),E(this,"_map",void 0),E(this,"_currentTouchCount",0),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,e,i){super.touchstart(t,e,i),this._currentTouchCount=i.length}_start(t){this._lastPoints=t,B_(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,e,i){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const n=t[0].sub(this._lastPoints[0]),a=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(n,a,i.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(n.y+a.y)/2*-.5}):void 0}gestureBeginsVertically(t,e,i){if(this._valid!==void 0)return this._valid;const n=2,a=t.mag()>=n,o=e.mag()>=n;if(!a&&!o)return;if(!a||!o)return this._firstMove===void 0&&(this._firstMove=i),i-this._firstMove<bet?void 0:!1;const s=t.y>0==e.y>0;return B_(t)&&B_(e)&&s}}const Xm={linearity:.3,easing:uS(0,0,.3,1)},Ret=rr({deceleration:2500,maxSpeed:1400},Xm),Met=rr({deceleration:20,maxSpeed:1400},Xm),Iet=rr({deceleration:1e3,maxSpeed:360},Xm),Let=rr({deceleration:1e3,maxSpeed:90},Xm);class Oet{constructor(t){E(this,"_map",void 0),E(this,"_inertiaBuffer",void 0),this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Zn.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,e=Zn.now(),i=160;for(;t.length>0&&e-t[0].time>i;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const e={zoom:0,bearing:0,pitch:0,pan:new he(0,0),pinchAround:void 0,around:void 0};for(const{settings:o}of this._inertiaBuffer)e.zoom+=o.zoomDelta||0,e.bearing+=o.bearingDelta||0,e.pitch+=o.pitchDelta||0,o.panDelta&&e.pan._add(o.panDelta),o.around&&(e.around=o.around),o.pinchAround&&(e.pinchAround=o.pinchAround);const n=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,a={};if(e.pan.mag()){const o=Ip(e.pan.mag(),n,rr({},Ret,t||{}));a.offset=e.pan.mult(o.amount/e.pan.mag()),a.center=this._map.transform.center,Mp(a,o)}if(e.zoom){const o=Ip(e.zoom,n,Met);a.zoom=this._map.transform.zoom+o.amount,Mp(a,o)}if(e.bearing){const o=Ip(e.bearing,n,Iet);a.bearing=this._map.transform.bearing+ro(o.amount,-179,179),Mp(a,o)}if(e.pitch){const o=Ip(e.pitch,n,Let);a.pitch=this._map.transform.pitch+o.amount,Mp(a,o)}if(a.zoom||a.bearing){const o=e.pinchAround===void 0?e.around:e.pinchAround;a.around=o?this._map.unproject(o):this._map.getCenter()}return this.clear(),rr(a,{noMoveStart:!0})}}function Mp(r,t){(!r.duration||r.duration<t.duration)&&(r.duration=t.duration,r.easing=t.easing)}function Ip(r,t,e){const{maxSpeed:i,linearity:n,deceleration:a}=e,o=ro(r*n/(t/1e3),-i,i),s=Math.abs(o)/(a*n);return{easing:e.easing,duration:s*1e3,amount:o*(s/2)}}const Lp=r=>r.zoom||r.drag||r.pitch||r.rotate;class Pet extends re{constructor(t,e){super(t),E(this,"type","renderFrame"),E(this,"timeStamp",void 0),this.timeStamp=e}}function D_(r){return r.panDelta&&r.panDelta.mag()||r.zoomDelta||r.bearingDelta||r.pitchDelta}class Fet{constructor(t,e){E(this,"_map",void 0),E(this,"_el",void 0),E(this,"_handlers",void 0),E(this,"_eventsInProgress",void 0),E(this,"_frameId",void 0),E(this,"_inertia",void 0),E(this,"_bearingSnap",void 0),E(this,"_handlersById",void 0),E(this,"_updatingCamera",void 0),E(this,"_changes",void 0),E(this,"_zoom",void 0),E(this,"_previousActiveHandlers",void 0),E(this,"_listeners",void 0),E(this,"handleWindowEvent",n=>{this.handleEvent(n,`${n.type}Window`)}),E(this,"handleEvent",(n,a)=>{if(n.type==="blur"){this.stop(!0);return}this._updatingCamera=!0;const o=n.type==="renderFrame"?void 0:n,s={needsRenderFrame:!1},l={},u={},c=n.touches,h=c?this._getMapTouches(c):void 0,f=h?Ot.touchPos(this._map.getCanvasContainer(),h):Ot.mousePos(this._map.getCanvasContainer(),n);for(const{handlerName:p,handler:g,allowed:m}of this._handlers){if(!g.isEnabled())continue;let y;this._blockedByActive(u,m,p)?g.reset():g[a||n.type]&&(y=g[a||n.type](n,f,h),this.mergeHandlerResult(s,l,y,p,o),y&&y.needsRenderFrame&&this._triggerRenderFrame()),(y||g.isActive())&&(u[p]=g)}const d={};for(const p in this._previousActiveHandlers)u[p]||(d[p]=o);this._previousActiveHandlers=u,(Object.keys(d).length||D_(s))&&(this._changes.push([s,l,d]),this._triggerRenderFrame()),(Object.keys(u).length||D_(s))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:v}=s;v&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],v(this._map))}),this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Oet(t),this._bearingSnap=e.bearingSnap||7,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(e);const i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];for(const[n,a,o]of this._listeners)Ot.addEventListener(n,a,n===document?this.handleWindowEvent:this.handleEvent,o)}destroy(){for(const[t,e,i]of this._listeners)Ot.removeEventListener(t,e,t===document?this.handleWindowEvent:this.handleEvent,i)}_addDefaultHandlers(t){const e=this._map,i=e.getCanvasContainer();this._add("mapEvent",new Ktt(e,t));const n=e.boxZoom=new Wtt(e,t);this._add("boxZoom",n),t.interactive&&t.boxZoom&&n.enable();const a=e.cooperativeGestures=new Gtt(e,t.cooperativeGestures);this._add("cooperativeGestures",a),t.cooperativeGestures&&a.enable();const o=new _et(e),s=new Vtt(e);e.doubleClickZoom=new het(s,o),this._add("tapZoom",o),this._add("clickZoom",s),t.interactive&&t.doubleClickZoom&&e.doubleClickZoom.enable();const l=new yet;this._add("tapDragZoom",l);const u=e.touchPitch=new wet(e);this._add("touchPitch",u),t.interactive&&t.touchPitch&&e.touchPitch.enable(t.touchPitch);const c=net(t),h=aet(t);e.dragRotate=new det(t,c,h),this._add("mouseRotate",c,["mousePitch"]),this._add("mousePitch",h,["mouseRotate"]),t.interactive&&t.dragRotate&&e.dragRotate.enable();const f=iet(t),d=new xet(t,e);e.dragPan=new fet(i,f,d),this._add("mousePan",f),this._add("touchPan",d,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&e.dragPan.enable(t.dragPan);const v=new Tet,p=new Eet;e.touchZoomRotate=new vet(i,p,v,l),this._add("touchRotate",v,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&e.touchZoomRotate.enable(t.touchZoomRotate);const g=e.scrollZoom=new cet(e,()=>this._triggerRenderFrame());this._add("scrollZoom",g,["mousePan"]),t.interactive&&t.scrollZoom&&e.scrollZoom.enable(t.scrollZoom);const m=e.keyboard=new Ytt(e);this._add("keyboard",m),t.interactive&&t.keyboard&&e.keyboard.enable(),this._add("blockableMapEvent",new Qtt(e))}_add(t,e,i){this._handlers.push({handlerName:t,handler:e,allowed:i}),this._handlersById[t]=e}stop(t){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Lp(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,e,i){for(const n in t)if(n!==i&&(!e||e.indexOf(n)<0))return!0;return!1}_getMapTouches(t){const e=[];for(const i of t){const n=i.target;this._el.contains(n)&&e.push(i)}return e}mergeHandlerResult(t,e,i,n,a){if(!i)return;rr(t,i);const o={handlerName:n,originalEvent:i.originalEvent||a};i.zoomDelta!==void 0&&(e.zoom=o),i.panDelta!==void 0&&(e.drag=o),i.pitchDelta!==void 0&&(e.pitch=o),i.bearingDelta!==void 0&&(e.rotate=o)}_applyChanges(){const t={},e={},i={};for(const[n,a,o]of this._changes)n.panDelta&&(t.panDelta=(t.panDelta||new he(0,0))._add(n.panDelta)),n.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+n.zoomDelta),n.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+n.bearingDelta),n.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+n.pitchDelta),n.around!==void 0&&(t.around=n.around),n.pinchAround!==void 0&&(t.pinchAround=n.pinchAround),n.noInertia&&(t.noInertia=n.noInertia),rr(e,a),rr(i,o);this._updateMapTransform(t,e,i),this._changes=[]}_updateMapTransform(t,e,i){const n=this._map,a=n._getTransformForUpdate();if(!D_(t))return this._fireEvents(e,i,!0);const{panDelta:o,zoomDelta:s,bearingDelta:l,pitchDelta:u,pinchAround:c}=t;let{around:h}=t;c!==void 0&&(h=c),n._stop(!0),h=h||n.transform.centerPoint;const f=a.pointLocation(o?h.sub(o):h);l&&(a.bearing+=l),u&&(a.pitch+=u),s&&(a.zoom+=s),a.setLocationAtPoint(f,h),n._applyUpdatedTransform(a),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(e,i,!0)}_fireEvents(t,e,i){const n=Lp(this._eventsInProgress),a=Lp(t),o={};for(const h in t){const{originalEvent:f}=t[h];this._eventsInProgress[h]||(o[`${h}start`]=f),this._eventsInProgress[h]=t[h]}!n&&a&&this._fireEvent("movestart",a.originalEvent);for(const h in o)this._fireEvent(h,o[h]);a&&this._fireEvent("move",a.originalEvent);for(const h in t){const{originalEvent:f}=t[h];this._fireEvent(h,f)}const s={};let l;for(const h in this._eventsInProgress){const{handlerName:f,originalEvent:d}=this._eventsInProgress[h];this._handlersById[f].isActive()||(delete this._eventsInProgress[h],l=e[f]||d,s[`${h}end`]=l)}for(const h in s)this._fireEvent(h,s[h]);const u=Lp(this._eventsInProgress);if(i&&((n||a)&&!u)){this._updatingCamera=!0;const h=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),f=d=>d!==0&&-this._bearingSnap<d&&d<this._bearingSnap;h&&(h.essential||!Zn.prefersReducedMotion)?(f(h.bearing||this._map.getBearing())&&(h.bearing=0),h.freezeElevation=!0,this._map.easeTo(h,{originalEvent:l})):(this._map.fire(new re("moveend",{originalEvent:l})),f(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,e){this._map.fire(new re(t,e?{originalEvent:e}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new Pet("renderFrame",t)),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Bet{constructor(){E(this,"_queue",void 0),E(this,"_id",void 0),E(this,"_cleared",void 0),E(this,"_currentlyRunning",void 0),this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e}remove(t){const e=this._currentlyRunning,i=e?this._queue.concat(e):this._queue;for(const n of i)if(n.id===t){n.cancelled=!0;return}}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const e=this._currentlyRunning=this._queue;this._queue=[];for(const i of e)if(!i.cancelled&&(i.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Det(r,t){var e=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,i=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(e||i)&&(t||(t=document),!!t)){var n=t.head||t.getElementsByTagName("head")[0];if(!n){n=t.createElement("head");var a=t.body||t.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(n,a):t.documentElement.appendChild(n)}var o=t.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=r:o.appendChild(t.createTextNode(r)),n.appendChild(o),o}}Det(`.l7-map {
  font:
    12px/20px 'Helvetica Neue',
    Arial,
    Helvetica,
    sans-serif;
  overflow: hidden;
  position: relative;
  -webkit-tap-highlight-color: rgb(0 0 0 / 0%);
}

.l7-canvas {
  position: absolute;
  left: 0;
  top: 0;
}

.l7-map:full-screen {
  width: 100%;
  height: 100%;
}

.l7-canary {
  background-color: salmon;
}

.l7-canvas-container.l7-interactive,
.l7-ctrl-group button.l7-ctrl-compass {
  cursor: grab;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-canvas-container.l7-interactive.l7-track-pointer {
  cursor: pointer;
}

.l7-canvas-container.l7-interactive:active,
.l7-ctrl-group button.l7-ctrl-compass:active {
  cursor: grabbing;
}

.l7-canvas-container.l7-touch-zoom-rotate,
.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {
  touch-action: pan-x pan-y;
}

.l7-canvas-container.l7-touch-drag-pan,
.l7-canvas-container.l7-touch-drag-pan .l7-canvas {
  touch-action: pinch-zoom;
}

.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,
.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {
  touch-action: none;
}

.l7-canvas-container.l7-touch-drag-pan.l7-cooperative-gestures,
.l7-canvas-container.l7-touch-drag-pan.l7-cooperative-gestures .l7-canvas {
  touch-action: pan-x pan-y;
}

.l7-cooperative-gesture-screen {
  background: rgba(0 0 0 / 40%);
  position: absolute;
  inset: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  color: white;
  padding: 1rem;
  font-size: 1.4em;
  line-height: 1.2;
  opacity: 0;
  pointer-events: none;
  transition: opacity 1s ease 1s;
  z-index: 99999;
}

.l7-cooperative-gesture-screen.l7-show {
  opacity: 1;
  transition: opacity 0.05s;
}

.l7-cooperative-gesture-screen .l7-mobile-message {
  display: none;
}

@media (hover: none), (width <= 480px) {
  .l7-cooperative-gesture-screen .l7-desktop-message {
    display: none;
  }

  .l7-cooperative-gesture-screen .l7-mobile-message {
    display: block;
  }
}

.l7-ctrl-top-left,
.l7-ctrl-top-right,
.l7-ctrl-bottom-left,
.l7-ctrl-bottom-right {
  position: absolute;
  pointer-events: none;
  z-index: 2;
}

.l7-ctrl-top-left {
  top: 0;
  left: 0;
}

.l7-ctrl-top-right {
  top: 0;
  right: 0;
}

.l7-ctrl-bottom-left {
  bottom: 0;
  left: 0;
}

.l7-ctrl-bottom-right {
  right: 0;
  bottom: 0;
}

.l7-ctrl {
  clear: both;
  pointer-events: auto;

  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */
  -webkit-transform: translate(0, 0);
          transform: translate(0, 0);
}

.l7-ctrl-top-left .l7-ctrl {
  margin: 10px 0 0 10px;
  float: left;
}

.l7-ctrl-top-right .l7-ctrl {
  margin: 10px 10px 0 0;
  float: right;
}

.l7-ctrl-bottom-left .l7-ctrl {
  margin: 0 0 10px 10px;
  float: left;
}

.l7-ctrl-bottom-right .l7-ctrl {
  margin: 0 10px 10px 0;
  float: right;
}

.l7-crosshair,
.l7-crosshair .l7-interactive,
.l7-crosshair .l7-interactive:active {
  cursor: crosshair;
}

.l7-boxzoom {
  position: absolute;
  top: 0;
  left: 0;
  width: 0;
  height: 0;
  background: #fff;
  border: 2px dotted #202020;
  opacity: 0.5;
  z-index: 10;
}
`);const Wg=-2,MD=22,Rs=0,ID=60,Op=85,Net={interactive:!0,bearingSnap:7,scrollZoom:!0,minZoom:Wg,maxZoom:MD,minPitch:Rs,maxPitch:ID,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,fadeDuration:300,clickTolerance:3,pitchWithRotate:!0};let ket=class extends $tt{constructor(t){const e=G(G({},Net),t);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<Rs)throw new Error(`minPitch must be greater than or equal to ${Rs}`);if(e.maxPitch!=null&&e.maxPitch>Op)throw new Error(`maxPitch must be less than or equal to ${Op}`);const i=new hS(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies);if(super(i,{bearingSnap:e.bearingSnap}),E(this,"_container",void 0),E(this,"_canvasContainer",void 0),E(this,"_interactive",void 0),E(this,"_frameRequest",void 0),E(this,"_loaded",void 0),E(this,"_idleTriggered",!1),E(this,"_fullyLoaded",void 0),E(this,"_trackResize",void 0),E(this,"_resizeObserver",void 0),E(this,"_preserveDrawingBuffer",void 0),E(this,"_failIfMajorPerformanceCaveat",void 0),E(this,"_fadeDuration",void 0),E(this,"_crossSourceCollisions",void 0),E(this,"_crossFadingFactor",1),E(this,"_collectResourceTiming",void 0),E(this,"_renderTaskQueue",new Bet),E(this,"_mapId",Ltt()),E(this,"_removed",void 0),E(this,"_clickTolerance",void 0),E(this,"version",void 0),E(this,"mapSize",void 0),E(this,"scrollZoom",void 0),E(this,"boxZoom",void 0),E(this,"dragRotate",void 0),E(this,"dragPan",void 0),E(this,"keyboard",void 0),E(this,"doubleClickZoom",void 0),E(this,"touchZoomRotate",void 0),E(this,"touchPitch",void 0),E(this,"cooperativeGestures",void 0),E(this,"_onMapScroll",n=>{if(n.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}),this._interactive=e.interactive,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._fadeDuration=e.fadeDuration,this._clickTolerance=e.clickTolerance,this.version=t.version,this.mapSize=t.mapSize,typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else if(e.container instanceof HTMLElement)this._container=e.container;else throw new Error("Invalid type: 'container' must be a String or HTMLElement.");if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this.on("move",()=>this._update()).on("moveend",()=>this._update()).on("zoom",()=>this._update()).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){let n=!1;const a=er.throttle(o=>{this._trackResize&&!this._removed&&this.resize(o)._update()},50);this._resizeObserver=new ResizeObserver(o=>{if(!n){n=!0;return}a(o)}),this._resizeObserver.observe(this._container)}this.handlers=new Fet(this,e),this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,rr({},e.fitBoundsOptions,{duration:0}))),this.resize()}_getMapId(){return this._mapId}calculateCameraOptionsFromTo(t,e,i,n){return super.calculateCameraOptionsFromTo(t,e,i,n)}resize(t){var e;const i=this._containerDimensions(),n=i[0],a=i[1];this.transform.resize(n,a),(e=this._requestedCameraState)===null||e===void 0||e.resize(n,a);const o=!this._moving;return o&&(this.stop(),this.fire(new re("movestart",t)).fire(new re("move",t))),this.fire(new re("resize",t)),o&&this.fire(new re("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(t){return this.transform.setMaxBounds(t&&xa.convert(t)),this._update()}setMinZoom(t){if(t=t??Wg,t>=Wg&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error(`minZoom must be between ${Wg} and the current maxZoom, inclusive`)}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if(t=t??MD,t>=this.transform.minZoom)return this.transform.maxZoom=t,this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if(t=t??Rs,t<Rs)throw new Error(`minPitch must be greater than or equal to ${Rs}`);if(t>=Rs&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this.getPitch()<t&&this.setPitch(t),this;throw new Error(`minPitch must be between ${Rs} and the current maxPitch, inclusive`)}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if(t=t??ID,t>Op)throw new Error(`maxPitch must be less than or equal to ${Op}`);if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){this.transform.renderWorldCopies=t}project(t){return this.transform.locationPoint(ge.convert(t))}unproject(t){return this.transform.pointLocation(he.convert(t))}isMoving(){var t;return this._moving||((t=this.handlers)===null||t===void 0?void 0:t.isMoving())}isZooming(){var t;return this._zooming||((t=this.handlers)===null||t===void 0?void 0:t.isZooming())}isRotating(){var t;return this._rotating||((t=this.handlers)===null||t===void 0?void 0:t.isRotating())}on(t,e){return super.on(t,e)}once(t,e){return super.once(t,e)}off(t,e){return super.off(t,e)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}_containerDimensions(){let t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]}_setupContainer(){const t=this._container;t.classList.add("l7-map");const e=this._canvasContainer=Ot.create("div","l7-canvas-container",t);this._interactive&&e.classList.add("l7-interactive"),this._container.addEventListener("scroll",this._onMapScroll,!1)}_update(){return this.triggerRepaint(),this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_render(t){if(this._renderTaskQueue.run(t),!this._removed)return this.fire(new re("render")),this.isMoving()||this.fire(new re("idle")),this}remove(){var t;this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.handlers.destroy(),delete this.handlers,(t=this._resizeObserver)===null||t===void 0||t.disconnect(),Ot.remove(this._canvasContainer),this._container.classList.remove("l7-map"),this._removed=!0,this.fire(new re("remove"))}triggerRepaint(){this._frameRequest||(this._frameRequest=new AbortController,Zn.frameAsync(this._frameRequest).then(t=>{this._frameRequest=null,this._render(t)}).catch(()=>{}))}getCameraTargetElevation(){return this.transform.elevation}};const Uet=["id","style","rotation","mapInstance","version","mapSize","interactive"];class zet extends Gm{constructor(...t){super(...t),E(this,"version",ED.DEFAULT),E(this,"viewport",void 0)}lngLatToCoord(t,e={x:0,y:0,z:0}){const{x:i,y:n}=this.lngLatToMercator(t,0);return[i-e.x,n-e.y]}lngLatToMercator(t,e){const{x:i=0,y:n=0,z:a=0}=jn.fromLngLat(t,e);return{x:i,y:n,z:a}}getModelMatrix(t,e,i,n=[1,1,1],a={x:0,y:0,z:0}){const o=jn.fromLngLat(t,e),s=o.meterInMercatorCoordinateUnits(),l=Ou();return qa(l,l,Yr(o.x-a.x,o.y-a.y,o.z||0-a.z)),Ka(l,l,Yr(s*n[0],-s*n[1],s*n[2])),Sh(l,l,i[0]),vv(l,l,i[1]),pv(l,l,i[2]),l}init(){var t=this;return Z(function*(){const e=t.config,{id:i="map",style:n="light",rotation:a=0,mapInstance:o,version:s="DEFAULTMAP",mapSize:l=1e4,interactive:u=!0}=e,c=An(e,Uet);t.viewport=new Ev,t.version=s,t.simpleMapCoord.setSize(l),s==="SIMPLE"&&c.center&&(c.center=t.simpleMapCoord.unproject(c.center)),o?(t.map=o,t.$mapContainer=t.map.getContainer()):(t.$mapContainer=t.creatMapContainer(i),t.map=new ket(G({container:t.$mapContainer,bearing:a,version:s,mapSize:l},c))),t.map.on("load",()=>{t.handleCameraChanged()}),u&&t.map.on("move",t.handleCameraChanged),setTimeout(()=>{t.handleCameraChanged()},100),t.handleCameraChanged()})()}creatMapContainer(t){let e=t;typeof t=="string"&&(e=document.getElementById(t));const i=document.createElement("div");return i.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,e.appendChild(i),i}exportMap(t){return""}setMapStyle(t){}getCanvasOverlays(){return this.getContainer()}}let Het=class extends Cv{getServiceConstructor(){return zet}};const $et=["id","attributionControl","style","token","rotation","mapInstance"];function Wet(r,t){var e=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,i=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(e||i)&&(t||(t=document),!!t)){var n=t.head||t.getElementsByTagName("head")[0];if(!n){n=t.createElement("head");var a=t.body||t.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(n,a):t.documentElement.appendChild(n)}var o=t.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=r:o.appendChild(t.createTextNode(r)),n.appendChild(o),o}}Wet(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{flex-direction:column-reverse}.mapboxgl-popup-anchor-left{flex-direction:row}.mapboxgl-popup-anchor-right{flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;box-sizing:border-box;box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`);window.mapboxgl=If;let Vet=0;const $R="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg";class Get extends Gm{constructor(...t){super(...t),E(this,"version","MAPBOX"),E(this,"viewport",void 0)}getType(){return"mapbox"}lngLatToCoord(t,e={x:0,y:0,z:0}){const{x:i,y:n}=this.lngLatToMercator(t,0);return[i-e.x,n-e.y]}lngLatToMercator(t,e){const{x:i=0,y:n=0,z:a=0}=window.mapboxgl.MercatorCoordinate.fromLngLat(t,e);return{x:i,y:n,z:a}}getModelMatrix(t,e,i,n=[1,1,1],a={x:0,y:0,z:0}){const o=window.mapboxgl.MercatorCoordinate.fromLngLat(t,e),s=o.meterInMercatorCoordinateUnits(),l=Ou();return qa(l,l,Yr(o.x-a.x,o.y-a.y,o.z||0-a.z)),Ka(l,l,Yr(s*n[0],-s*n[1],s*n[2])),Sh(l,l,i[0]),vv(l,l,i[1]),pv(l,l,i[2]),l}init(){var t=this;return Z(function*(){const e=t.config,{id:i="map",attributionControl:n=!1,style:a="light",token:o=$R,rotation:s=0,mapInstance:l}=e,u=An(e,$et);t.viewport=new Ev,!l&&!window.mapboxgl&&console.error(t.configService.getSceneWarninfo("SDK")),o===$R&&a!=="blank"&&!window.mapboxgl.accessToken&&!l&&console.warn(t.configService.getSceneWarninfo("MapToken")),!l&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=o),l?(t.map=l,t.$mapContainer=t.map.getContainer()):(t.$mapContainer=t.creatMapContainer(i),t.map=new window.mapboxgl.Map(G({container:t.$mapContainer,style:t.getMapStyleValue(a),attributionControl:n,bearing:s},u))),t.map.on("load",()=>{t.handleCameraChanged()}),t.map.on("move",t.handleCameraChanged),t.handleCameraChanged()})()}destroy(){var t;(t=this.$mapContainer)===null||t===void 0||(t=t.parentNode)===null||t===void 0||t.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}emit(t,...e){this.eventEmitter.emit(t,...e)}once(t,...e){this.eventEmitter.once(t,...e)}getMapContainer(){return this.$mapContainer}getCanvasOverlays(){var t;return(t=this.getMapContainer())===null||t===void 0?void 0:t.querySelector(".mapboxgl-canvas-container")}meterToCoord(t,e){const i=new If.LngLat(t[0],t[1]),n=new If.LngLat(e[0],e[1]),a=i.distanceTo(n),o=If.MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),s=If.MercatorCoordinate.fromLngLat({lng:e[0],lat:e[1]}),{x:l,y:u}=o,{x:c,y:h}=s;return Math.sqrt(Math.pow(l-c,2)+Math.pow(u-h,2))*4194304*2/a}exportMap(t){const e=this.map.getCanvas();return t==="jpg"?e==null?void 0:e.toDataURL("image/jpeg"):e==null?void 0:e.toDataURL("image/png")}creatMapContainer(t){let e=t;typeof t=="string"&&(e=document.getElementById(t));const i=document.createElement("div");return i.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,i.id="l7_mapbox_div"+Vet++,e.appendChild(i),i}}function Xet(r,t){var e=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,i=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(e||i)&&(t||(t=document),!!t)){var n=t.head||t.getElementsByTagName("head")[0];if(!n){n=t.createElement("head");var a=t.body||t.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(n,a):t.documentElement.appendChild(n)}var o=t.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=r:o.appendChild(t.createTextNode(r)),n.appendChild(o),o}}Xet(`.mapboxgl-ctrl-logo {
  display: none !important;
}
`);class Yet extends Cv{getServiceConstructor(){return Get}}const jet=r=>{const{tk:t}=r;return new Promise(e=>{const i=document.createElement("script");i.type="text/javascript",i.src=`https://api.tianditu.gov.cn/api?v=4.0&tk=${t}`,i.onload=function(){console.log("TianDiTu API script loaded."),e(!0)},i.onerror=function(){console.error("Failed to load TianDiTu API script."),e(!1)},document.head.appendChild(i)})};let Zet=0;const tc={zoomchange:["Ge"]};class qet extends Gm{constructor(...t){super(...t),E(this,"viewport",null),E(this,"evtCbProxyMap",new Map),E(this,"sceneContainer",void 0),E(this,"handleCameraChanged",()=>{this.emit("mapchange");const e=this.map,{lng:i,lat:n}=this.map.getCenter(),a={center:[i,n],viewportHeight:e.getContainer().clientHeight,viewportWidth:e.getContainer().clientWidth,bearing:360,pitch:0,zoom:e.getZoom()-1};this.viewport&&(this.viewport.syncWithMapCamera(a),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport))})}addMarkerContainer(){const t=this.map.getContainer(),e=this.markerContainer=document.createElement("div");t.appendChild(e),e.setAttribute("tabindex","-1"),e.id="tdt-L7-marker",e.style.position="absolute",e.style.left="",e.style.top="",e.style.zIndex="600",e.style.width="0px",e.style.height="0px",e.style.overflow="visible"}getMarkerContainer(){return this.markerContainer}onCameraChanged(t){this.cameraChangedCallback=t}resize(t){this.sceneContainer.style.width=t.newSize.x+"px",this.sceneContainer.style.height=t.newSize.y+"px"}update(){const t=this.map.getBounds(),{x:e,y:i}=this.map.lngLatToLayerPoint({lng:t.getSouthWest().lng,lat:t.getNorthEast().lat});this.sceneContainer.style.transition="",this.sceneContainer.style.transformOrigin="center",this.sceneContainer.style.transform=`translate3d(${e}px, ${i}px, 0px) scale(1)`,this.markerContainer.style.transition="",this.markerContainer.style.transformOrigin="center",this.markerContainer.style.transform=`translate3d(${-e}px, ${-i}px, 0px) scale(1)`,this.sceneContainer._tdt_pos=new T.Point(e,i),this.handleCameraChanged()}getZoomScale(t,e){const i=this.map.options.IW;return e=e===void 0?this.map.getZoom():e,i.scale(t)/i.scale(e)}zoomStartUpdate(t){const e=t.center,i=t.zoom,n=this.getZoomScale(i,this.map.getZoom()),a=T._Q.getPosition(this.sceneContainer),o=this.map.getSize().GQ(.5),s=this.map.options.IW.qW(this.map.getCenter(),i),u=this.map.options.IW.qW(e,i).DQ(s),c=new T.Point(o.x,o.y).GQ(-n);c.aQ(a),c.aQ(o),c.DQ(u),this.sceneContainer.style.transform=`translate3d(${c.x}px,${c.y}px,0px) scale(${n})`,this.sceneContainer.style.transformOrigin="0 0",this.sceneContainer.style.transition="transform 0.25s cubic-bezier(0,0,0.25,1)",this.handleCameraChanged()}getOverlayContainer(){var t;const e=(t=this.map.getPanes())===null||t===void 0?void 0:t.overlayPane,i=document.createElement("div");e.parentElement.appendChild(i),i.id="tdt-L7";const n=this.map.getSize();return i.style.zIndex="200",i.style.width=`${n.x}px`,i.style.height=`${n.y}px`,this.sceneContainer=i,i}init(){var t=this;return Z(function*(){t.viewport=new Ev;const{id:e,mapInstance:i,center:n=[121.30654632240122,31.25744185633306],token:a="b15e548080c79819617367d3f6095c69",minZoom:o=1,maxZoom:s=18,zoom:l=3}=t.config;if(window.T||(yield jet({tk:a})),i){t.map=i,t.map.centerAndZoom(new window.T.LngLat(n[0],n[1]),l),t.$mapContainer=t.map.getContainer();const h=new window.T.LngLat(n[0],n[1]);t.map.centerAndZoom(h,l),t.setMinZoom(o),t.setMaxZoom(s)}else{if(!e)throw Error("No container id specified");t.$mapContainer=t.creatMapContainer(e);const h=new T.Map(t.$mapContainer,{center:window.T.LngLat(n[0],n[1]),minZoom:o,maxZoom:s,zoom:l,projection:"EPSG:900913"});t.map=h;const f=new window.T.Control.Zoom;h.addControl(f)}const c=t.map.getContainer().querySelector(".tdt-pane");c.style.zIndex=1,t.handleCameraChanged(),t.map.on("move",t.update,t),t.map.on("Ge",t.zoomStartUpdate,t),t.map.on("resize",t.resize,t)})()}destroy(){}on(t,e){if(hu.indexOf(t)!==-1)this.eventEmitter.on(t,e);else{const i=n=>{let a=this.evtCbProxyMap.get(n);if(a||this.evtCbProxyMap.set(n,a=new Map),a.get(e))return;const o=(...s)=>{s[0]&&typeof s[0]=="object"&&!s[0].lngLat&&!s[0].lnglat&&(s[0].lngLat=s[0].latlng||s[0].latLng,s[0].map=this.map),e(...s)};a.set(e,o),this.map.on(n,o)};Array.isArray(tc[t])?tc[t].forEach(n=>{i(n||t)}):i(tc[t]||t)}}off(t,e){if(hu.indexOf(t)!==-1){this.eventEmitter.off(t,e);return}const i=n=>{var a,o;const s=(a=this.evtCbProxyMap.get(t))===null||a===void 0?void 0:a.get(e);s&&((o=this.evtCbProxyMap.get(n))===null||o===void 0||o.delete(e),this.map.off(n,s))};Array.isArray(tc[t])?tc[t].forEach(n=>{i(n||t)}):i(tc[t]||t)}once(t,e){throw new Error("Method not implemented.")}getMapContainer(){return this.map.getContainer()}getType(){return"tdtmap"}getMapCanvasContainer(){var t;return(t=this.map.getContainer())===null||t===void 0?void 0:t.getElementsByClassName("tdt-container")[0]}getSize(){const t=this.map.getSize();return[t.x,t.y]}getZoom(){return this.map.getZoom()}setZoom(t){return this.map.setZoom(t)}getCenter(){return this.map.getCenter()}setCenter(t){const e=window.T.LngLat(t[0],t[1]);this.map.centerAndZoom(e,this.map.getZoom())}setZoomAndCenter(t,e){const i=window.T.LngLat(e[0],e[1]);this.map.centerAndZoom(i,t)}getPitch(){return 0}getRotation(){return 0}setRotation(t){this.map.setBearing(t)}zoomIn(t,e){this.map.zoomIn(t,e)}zoomOut(t,e){this.map.zoomOut(t,e)}panTo(t){this.map.panTo(t)}panBy(t=0,e=0){this.map.panBy([t,e])}fitBounds(t){const[e,i]=t;this.map.setViewport([new window.T.LngLat(e[0],e[1]),new window.T.LngLat(i[0],i[1])])}setMaxZoom(t){this.map.setMaxZoom(t)}setMinZoom(t){this.map.setMinZoom(t)}setMapStatus(t){t.doubleClickZoom===!0&&this.map.enableDoubleClickZoom(),t.doubleClickZoom===!1&&this.map.disableDoubleClickZoom(),t.dragEnable===!1&&this.map.disableDrag(),t.dragEnable===!0&&this.map.enableDrag(),t.keyboardEnable===!1&&this.map.disableKeyboard(),t.keyboardEnable===!0&&this.map.enableKeyboard(),t.zoomEnable===!1&&this.map.disableScrollWheelZoom(),t.zoomEnable===!0&&this.map.enableScrollWheelZoom()}getModelMatrix(){throw new Error("Method not implemented.")}pixelToLngLat([t,e]){const i=this.map.layerPointToLngLat({x:t,y:e});return{lng:i.lng,lat:i.lat}}lngLatToPixel([t,e]){const i=this.map.lngLatToLayerPoint({lng:t,lat:e});return{x:i.x,y:i.y}}containerToLngLat([t,e]){const i=this.map.containerPointToLngLat({x:t,y:e});return{lng:i.lng,lat:i.lat}}lngLatToContainer([t,e]){const i=this.map.lngLatToContainerPoint({lat:e,lng:t});return{x:i.x,y:i.y}}lngLatToCoord([t,e]){const i=this.lngLatToPixel([t,e]);return[i.x,i.y]}lngLatToCoords(t){return t.map(e=>Array.isArray(e[0])?this.lngLatToCoords(e):this.lngLatToCoord(e))}getBounds(){const t=this.map.getBounds(),e=t.getSouthWest(),i=t.getNorthEast();return[[e.lng,e.lat],[i.lng,i.lat]]}lngLatToMercator(t,e){const{x:i=0,y:n=0,z:a=0}=jn.fromLngLat(t,e);return{x:i,y:n,z:a}}getCustomCoordCenter(){throw new Error("Method not implemented.")}creatMapContainer(t){let e=t;typeof t=="string"&&(e=document.getElementById(t));const i=document.createElement("div");return i.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,i.id="l7_tdt_div"+Zet++,e.appendChild(i),i}}class IWt extends Cv{getServiceConstructor(){return qet}}if(!window)throw Error("TMap JSAPI can only be used in Browser.");var ya=function(r){return r.notload="notload",r.loading="loading",r.loaded="loaded",r.failed="failed",r}(ya||{});const Bo={key:"",version:"1.exp",libraries:[]};let zo={TMap:ya.notload};const Ax=[],WR=r=>{if(typeof r=="function"){if(zo.TMap===ya.loaded){r(window.TMap);return}Ax.push(r)}},Ket=r=>new Promise((t,e)=>{if(zo.TMap===ya.failed)e("");else if(zo.TMap===ya.notload){const{key:i,version:n,libraries:a}=r;if(!i){e("请填写key");return}Bo.key=i,Bo.version=n||Bo.version,Bo.libraries=a||Bo.libraries,zo.TMap=ya.loading,window._onTMapAPILoaded=l=>{if(delete window._onTMapAPILoaded,l)zo.TMap=ya.failed,e(l);else for(zo.TMap=ya.loaded;Ax.length;)Ax.splice(0,1)[0](window.TMap)};const o=document.createElement("script");o.type="text/javascript",o.async=!1,o.src="https://map.qq.com/api/gljs?callback=_onTMapAPILoaded&v="+Bo.version+"&key="+i+"&plugin="+Bo.libraries.join(","),o.onerror=l=>{zo.TMap=ya.failed,e(l)},(document.body||document.head).appendChild(o),WR(t)}else if(zo.TMap===ya.loaded){if(r.key&&r.key!==Bo.key){e("多个不一致的 key");return}if(r.version&&r.version!==Bo.version){e("不允许多个版本 JSAPI 混用");return}WR(t)}}),Qet=()=>{delete window.TMap,zo={TMap:ya.notload}},Jet={load:Ket,reset:Qet},trt=["id","mapInstance","center","token","version","libraries","minZoom","maxZoom","rotation","pitch","mapSize","logoVisible"];function ert(r,t){var e=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,i=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(e||i)&&(t||(t=document),!!t)){var n=t.head||t.getElementsByTagName("head")[0];if(!n){n=t.createElement("head");var a=t.body||t.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(n,a):t.documentElement.appendChild(n)}var o=t.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=r:o.appendChild(t.createTextNode(r)),n.appendChild(o),o}}ert(`img[src*='//mapapi.qq.com/web/jsapi/logo/logo_def.png'],.logo-text
{
  display: none !important;
}

.tencent-map > canvas + div {
  z-index: 3 !important;
}
`);const rrt="OB4BZ-D4W3U-B7VVO-4PJWW-6TKDJ-WPB77",irt="1.exp",ec={mapmove:"center_changed",camerachange:["drag","pan","rotate","pitch","zoom"],zoomchange:"zoom",dragging:"drag"};class nrt extends Gm{constructor(...t){super(...t),E(this,"viewport",null),E(this,"evtCbProxyMap",new Map),E(this,"handleCameraChanged",()=>{this.emit("mapchange");const e=this.map,{lng:i,lat:n}=e.getCenter(),a={center:[i,n],viewportHeight:e.getContainer().clientHeight,viewportWidth:e.getContainer().clientWidth,bearing:e.getHeading(),pitch:e.getPitch(),zoom:e.getZoom()-1};this.viewport.syncWithMapCamera(a),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)})}init(){var t=this;return Z(function*(){var e;t.viewport=new Ev;const i=t.config,{id:n,mapInstance:a,center:o=[121.30654632240122,31.25744185633306],token:s=rrt,version:l=irt,libraries:u=[],minZoom:c=3,maxZoom:h=18,rotation:f=0,pitch:d=0,mapSize:v=1e4,logoVisible:p=!0}=i,g=An(i,trt);if(window.TMap||a||(yield Jet.load({key:s,version:l,libraries:u})),a)t.map=a,t.$mapContainer=t.map.getContainer(),p===!1&&t.hideLogo();else{if(!n)throw Error("No container id specified");const y=aB(n),_=new TMap.Map(y,G({maxZoom:h,minZoom:c,rotation:f,pitch:d,showControl:!1,center:new TMap.LatLng(o[1],o[0])},g));t.map=_,t.$mapContainer=_.getContainer(),p===!1&&t.hideLogo()}t.map.canvasContainer.style.position="absolute",t.map.drawContainer.classList.add("tencent-map");const m=(e=t.map.controlManager.controlContainer)===null||e===void 0?void 0:e.parentNode;m&&(m.style.zIndex=2),t.simpleMapCoord.setSize(v),t.map.on("drag",t.handleCameraChanged),t.map.on("pan",t.handleCameraChanged),t.map.on("rotate",t.handleCameraChanged),t.map.on("pitch",t.handleCameraChanged),t.map.on("zoom",t.handleCameraChanged),t.handleCameraChanged()})()}destroy(){this.map.destroy()}onCameraChanged(t){this.cameraChangedCallback=t}addMarkerContainer(){const t=this.map.getContainer();this.markerContainer=we("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1"),this.markerContainer.style.zIndex="2"}getMarkerContainer(){return this.markerContainer}on(t,e){if(hu.indexOf(t)!==-1)this.eventEmitter.on(t,e);else{const i=n=>{let a=this.evtCbProxyMap.get(n);if(a||this.evtCbProxyMap.set(n,a=new Map),a.get(e))return;const o=(...s)=>{s[0]&&typeof s[0]=="object"&&!s[0].lngLat&&!s[0].lnglat&&(s[0].lngLat=s[0].latlng||s[0].latLng),e(...s)};a.set(e,o),this.map.on(n,o)};Array.isArray(ec[t])?ec[t].forEach(n=>{i(n||t)}):i(ec[t]||t)}}off(t,e){if(hu.indexOf(t)!==-1){this.eventEmitter.off(t,e);return}const i=n=>{var a,o;const s=(a=this.evtCbProxyMap.get(t))===null||a===void 0?void 0:a.get(e);s&&((o=this.evtCbProxyMap.get(n))===null||o===void 0||o.delete(e),this.map.off(n,s))};Array.isArray(ec[t])?ec[t].forEach(n=>{i(n||t)}):i(ec[t]||t)}once(){throw new Error("Method not implemented.")}getContainer(){return this.map.getContainer()}getSize(){return[this.map.width,this.map.height]}getMinZoom(){return this.map.transform._minZoom}getMaxZoom(){return this.map.transform._maxZoom}getType(){return"tmap"}getZoom(){return this.map.getZoom()}getCenter(){const{lng:t,lat:e}=this.map.getCenter();return{lng:t,lat:e}}getPitch(){return this.map.getPitch()}getRotation(){return this.map.getRotation()}getBounds(){const t=this.map.getBounds().getNorthEast(),e=this.map.getBounds().getSouthWest();return[[e.lng,e.lat],[t.lng,t.lat]]}getMapContainer(){return this.map.getContainer()}getMapCanvasContainer(){var t;return(t=this.map.getContainer())===null||t===void 0?void 0:t.getElementsByTagName("canvas")[0]}getCanvasOverlays(){var t;return(t=this.getMapCanvasContainer())===null||t===void 0||(t=t.nextSibling)===null||t===void 0?void 0:t.firstChild}getMapStyleConfig(){throw new Error("Method not implemented.")}setBgColor(t){this.bgColor=t}setMapStyle(t){this.map.setMapStyleId(t)}setRotation(t){this.map.setRotation(t)}zoomIn(){this.map.setZoom(this.getZoom()+1)}zoomOut(){this.map.setZoom(this.getZoom()-1)}panTo([t,e]){this.map.panTo(new TMap.LatLng(e,t))}panBy(t,e){this.map.panBy([t,e])}fitBounds(t,e){const[i,n]=t,a=new TMap.LatLng(i[1],i[0]),o=new TMap.LatLng(n[1],n[0]),s=new TMap.LatLngBounds(a,o);this.map.fitBounds(s,e)}setZoomAndCenter(t,[e,i]){this.map.setCenter(new TMap.LatLng(i,e)),this.map.setZoom(t)}setCenter([t,e]){this.map.setCenter(new TMap.LatLng(e,t))}setPitch(t){this.map.setPitch(t)}setZoom(t){this.map.setZoom(t)}setMapStatus(t){Object.keys(t).map(e=>{switch(e){case"doubleClickZoom":this.map.setDoubleClickZoom(!!t.doubleClickZoom);break;case"dragEnable":this.map.setDraggable(!!t.dragEnable);break;case"rotateEnable":this.map.setRotatable(!!t.rotateEnable);break;case"zoomEnable":this.map.setDoubleClickZoom(!!t.zoomEnable),this.map.setScrollable(!!t.zoomEnable);break;case"keyboardEnable":case"resizeEnable":case"showIndoorMap":throw Error("Options may bot be supported")}})}meterToCoord([t,e],[i,n]){const a=TMap.geometry.computeDistance([new TMap.LatLng(e,t),new TMap.LatLng(n,i)]),[o,s]=this.lngLatToCoord([t,e]),[l,u]=this.lngLatToCoord([i,n]);return Math.sqrt(Math.pow(o-l,2)+Math.pow(s-u,2))/a}pixelToLngLat([t,e]){const{lng:i,lat:n}=this.map.getCenter(),{x:a,y:o}=this.lngLatToPixel([i,n]),{x:s,y:l}=this.lngLatToContainer([i,n]),{lng:u,lat:c}=this.map.unprojectFromContainer(new TMap.Point(s+(t-a),l+(e-o)));return this.containerToLngLat([u,c])}lngLatToPixel([t,e]){const{x:i,y:n}=this.map.projectToWorldPlane(new TMap.LatLng(e,t));return{x:i,y:n}}containerToLngLat([t,e]){const{lng:i,lat:n}=this.map.unprojectFromContainer(new TMap.Point(t,e));return{lng:i,lat:n}}lngLatToContainer([t,e]){const{x:i,y:n}=this.map.projectToContainer(new TMap.LatLng(e,t));return{x:i,y:n}}lngLatToCoord([t,e]){const{x:i,y:n}=this.lngLatToPixel([t,e]);return[i,-n]}lngLatToCoords(t){return t.map(e=>Array.isArray(e[0])?this.lngLatToCoords(e):this.lngLatToCoord(e))}lngLatToMercator(t,e){const{x:i=0,y:n=0,z:a=0}=jn.fromLngLat(t,e);return{x:i,y:n,z:a}}getModelMatrix(t,e,i,n=[1,1,1]){const a=this.viewport.projectFlat(t),o=Ou();return qa(o,o,Yr(a[0],a[1],e)),Ka(o,o,Yr(n[0],n[1],n[2])),Sh(o,o,i[0]),vv(o,o,i[1]),pv(o,o,i[2]),o}getCustomCoordCenter(){throw new Error("Method not implemented.")}exportMap(t){const e=this.getMapCanvasContainer();return t==="jpg"?e==null?void 0:e.toDataURL("image/jpeg"):e==null?void 0:e.toDataURL("image/png")}rotateY(){throw new Error("Method not implemented.")}hideLogo(){const t=this.map.getContainer();t&&fo(t,"tmap-contianer--hide-logo")}}class LWt extends Cv{getServiceConstructor(){return nrt}}const art=lS,ort=lS,srt=lS;function qn(r){return r==null}var lrt=function(r,t,e){return r<t?t:r>e?e:r};const urt=lrt;function yc(r){return typeof r=="number"}var LD={exports:{}};(function(r){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function n(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function a(l,u,c,h,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var d=new n(c,h||l,f),v=e?e+u:u;return l._events[v]?l._events[v].fn?l._events[v]=[l._events[v],d]:l._events[v].push(d):(l._events[v]=d,l._eventsCount++),l}function o(l,u){--l._eventsCount===0?l._events=new i:delete l._events[u]}function s(){this._events=new i,this._eventsCount=0}s.prototype.eventNames=function(){var u=[],c,h;if(this._eventsCount===0)return u;for(h in c=this._events)t.call(c,h)&&u.push(e?h.slice(1):h);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},s.prototype.listeners=function(u){var c=e?e+u:u,h=this._events[c];if(!h)return[];if(h.fn)return[h.fn];for(var f=0,d=h.length,v=new Array(d);f<d;f++)v[f]=h[f].fn;return v},s.prototype.listenerCount=function(u){var c=e?e+u:u,h=this._events[c];return h?h.fn?1:h.length:0},s.prototype.emit=function(u,c,h,f,d,v){var p=e?e+u:u;if(!this._events[p])return!1;var g=this._events[p],m=arguments.length,y,_;if(g.fn){switch(g.once&&this.removeListener(u,g.fn,void 0,!0),m){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,c),!0;case 3:return g.fn.call(g.context,c,h),!0;case 4:return g.fn.call(g.context,c,h,f),!0;case 5:return g.fn.call(g.context,c,h,f,d),!0;case 6:return g.fn.call(g.context,c,h,f,d,v),!0}for(_=1,y=new Array(m-1);_<m;_++)y[_-1]=arguments[_];g.fn.apply(g.context,y)}else{var x=g.length,C;for(_=0;_<x;_++)switch(g[_].once&&this.removeListener(u,g[_].fn,void 0,!0),m){case 1:g[_].fn.call(g[_].context);break;case 2:g[_].fn.call(g[_].context,c);break;case 3:g[_].fn.call(g[_].context,c,h);break;case 4:g[_].fn.call(g[_].context,c,h,f);break;default:if(!y)for(C=1,y=new Array(m-1);C<m;C++)y[C-1]=arguments[C];g[_].fn.apply(g[_].context,y)}}return!0},s.prototype.on=function(u,c,h){return a(this,u,c,h,!1)},s.prototype.once=function(u,c,h){return a(this,u,c,h,!0)},s.prototype.removeListener=function(u,c,h,f){var d=e?e+u:u;if(!this._events[d])return this;if(!c)return o(this,d),this;var v=this._events[d];if(v.fn)v.fn===c&&(!f||v.once)&&(!h||v.context===h)&&o(this,d);else{for(var p=0,g=[],m=v.length;p<m;p++)(v[p].fn!==c||f&&!v[p].once||h&&v[p].context!==h)&&g.push(v[p]);g.length?this._events[d]=g.length===1?g[0]:g:o(this,d)}return this},s.prototype.removeAllListeners=function(u){var c;return u?(c=e?e+u:u,this._events[c]&&o(this,c)):(this._events=new i,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=e,s.EventEmitter=s,r.exports=s})(LD);var crt=LD.exports;const OD=pW(crt);var B;(function(r){r[r.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",r[r.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",r[r.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r[r.ZERO=0]="ZERO",r[r.ONE=1]="ONE",r[r.SRC_COLOR=768]="SRC_COLOR",r[r.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",r[r.SRC_ALPHA=770]="SRC_ALPHA",r[r.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",r[r.DST_ALPHA=772]="DST_ALPHA",r[r.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",r[r.DST_COLOR=774]="DST_COLOR",r[r.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",r[r.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",r[r.CONSTANT_COLOR=32769]="CONSTANT_COLOR",r[r.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",r[r.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",r[r.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",r[r.FUNC_ADD=32774]="FUNC_ADD",r[r.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",r[r.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",r[r.BLEND_EQUATION=32777]="BLEND_EQUATION",r[r.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",r[r.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",r[r.BLEND_DST_RGB=32968]="BLEND_DST_RGB",r[r.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",r[r.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",r[r.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",r[r.BLEND_COLOR=32773]="BLEND_COLOR",r[r.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",r[r.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",r[r.LINE_WIDTH=2849]="LINE_WIDTH",r[r.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",r[r.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",r[r.CULL_FACE_MODE=2885]="CULL_FACE_MODE",r[r.FRONT_FACE=2886]="FRONT_FACE",r[r.DEPTH_RANGE=2928]="DEPTH_RANGE",r[r.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",r[r.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",r[r.DEPTH_FUNC=2932]="DEPTH_FUNC",r[r.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",r[r.STENCIL_FUNC=2962]="STENCIL_FUNC",r[r.STENCIL_FAIL=2964]="STENCIL_FAIL",r[r.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",r[r.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",r[r.STENCIL_REF=2967]="STENCIL_REF",r[r.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",r[r.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",r[r.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",r[r.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",r[r.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",r[r.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",r[r.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",r[r.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",r[r.VIEWPORT=2978]="VIEWPORT",r[r.SCISSOR_BOX=3088]="SCISSOR_BOX",r[r.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",r[r.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",r[r.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",r[r.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",r[r.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",r[r.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",r[r.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",r[r.RED_BITS=3410]="RED_BITS",r[r.GREEN_BITS=3411]="GREEN_BITS",r[r.BLUE_BITS=3412]="BLUE_BITS",r[r.ALPHA_BITS=3413]="ALPHA_BITS",r[r.DEPTH_BITS=3414]="DEPTH_BITS",r[r.STENCIL_BITS=3415]="STENCIL_BITS",r[r.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",r[r.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",r[r.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",r[r.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",r[r.SAMPLES=32937]="SAMPLES",r[r.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",r[r.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",r[r.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",r[r.VENDOR=7936]="VENDOR",r[r.RENDERER=7937]="RENDERER",r[r.VERSION=7938]="VERSION",r[r.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",r[r.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",r[r.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",r[r.STATIC_DRAW=35044]="STATIC_DRAW",r[r.STREAM_DRAW=35040]="STREAM_DRAW",r[r.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.BUFFER_SIZE=34660]="BUFFER_SIZE",r[r.BUFFER_USAGE=34661]="BUFFER_USAGE",r[r.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",r[r.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",r[r.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",r[r.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",r[r.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",r[r.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",r[r.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",r[r.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",r[r.CULL_FACE=2884]="CULL_FACE",r[r.FRONT=1028]="FRONT",r[r.BACK=1029]="BACK",r[r.FRONT_AND_BACK=1032]="FRONT_AND_BACK",r[r.BLEND=3042]="BLEND",r[r.DEPTH_TEST=2929]="DEPTH_TEST",r[r.DITHER=3024]="DITHER",r[r.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",r[r.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",r[r.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",r[r.SCISSOR_TEST=3089]="SCISSOR_TEST",r[r.STENCIL_TEST=2960]="STENCIL_TEST",r[r.NO_ERROR=0]="NO_ERROR",r[r.INVALID_ENUM=1280]="INVALID_ENUM",r[r.INVALID_VALUE=1281]="INVALID_VALUE",r[r.INVALID_OPERATION=1282]="INVALID_OPERATION",r[r.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",r[r.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",r[r.CW=2304]="CW",r[r.CCW=2305]="CCW",r[r.DONT_CARE=4352]="DONT_CARE",r[r.FASTEST=4353]="FASTEST",r[r.NICEST=4354]="NICEST",r[r.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",r[r.BYTE=5120]="BYTE",r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.SHORT=5122]="SHORT",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.INT=5124]="INT",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.FLOAT=5126]="FLOAT",r[r.DOUBLE=5130]="DOUBLE",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.ALPHA=6406]="ALPHA",r[r.RGB=6407]="RGB",r[r.RGBA=6408]="RGBA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",r[r.VERTEX_SHADER=35633]="VERTEX_SHADER",r[r.COMPILE_STATUS=35713]="COMPILE_STATUS",r[r.DELETE_STATUS=35712]="DELETE_STATUS",r[r.LINK_STATUS=35714]="LINK_STATUS",r[r.VALIDATE_STATUS=35715]="VALIDATE_STATUS",r[r.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",r[r.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",r[r.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",r[r.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",r[r.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",r[r.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",r[r.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",r[r.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",r[r.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",r[r.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",r[r.SHADER_TYPE=35663]="SHADER_TYPE",r[r.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",r[r.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",r[r.NEVER=512]="NEVER",r[r.ALWAYS=519]="ALWAYS",r[r.LESS=513]="LESS",r[r.EQUAL=514]="EQUAL",r[r.LEQUAL=515]="LEQUAL",r[r.GREATER=516]="GREATER",r[r.GEQUAL=518]="GEQUAL",r[r.NOTEQUAL=517]="NOTEQUAL",r[r.KEEP=7680]="KEEP",r[r.REPLACE=7681]="REPLACE",r[r.INCR=7682]="INCR",r[r.DECR=7683]="DECR",r[r.INVERT=5386]="INVERT",r[r.INCR_WRAP=34055]="INCR_WRAP",r[r.DECR_WRAP=34056]="DECR_WRAP",r[r.NEAREST=9728]="NEAREST",r[r.LINEAR=9729]="LINEAR",r[r.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",r[r.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",r[r.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",r[r.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",r[r.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",r[r.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",r[r.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",r[r.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE=5890]="TEXTURE",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r[r.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",r[r.TEXTURE0=33984]="TEXTURE0",r[r.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",r[r.REPEAT=10497]="REPEAT",r[r.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r[r.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",r[r.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",r[r.FLOAT_VEC2=35664]="FLOAT_VEC2",r[r.FLOAT_VEC3=35665]="FLOAT_VEC3",r[r.FLOAT_VEC4=35666]="FLOAT_VEC4",r[r.INT_VEC2=35667]="INT_VEC2",r[r.INT_VEC3=35668]="INT_VEC3",r[r.INT_VEC4=35669]="INT_VEC4",r[r.BOOL=35670]="BOOL",r[r.BOOL_VEC2=35671]="BOOL_VEC2",r[r.BOOL_VEC3=35672]="BOOL_VEC3",r[r.BOOL_VEC4=35673]="BOOL_VEC4",r[r.FLOAT_MAT2=35674]="FLOAT_MAT2",r[r.FLOAT_MAT3=35675]="FLOAT_MAT3",r[r.FLOAT_MAT4=35676]="FLOAT_MAT4",r[r.SAMPLER_2D=35678]="SAMPLER_2D",r[r.SAMPLER_CUBE=35680]="SAMPLER_CUBE",r[r.LOW_FLOAT=36336]="LOW_FLOAT",r[r.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",r[r.HIGH_FLOAT=36338]="HIGH_FLOAT",r[r.LOW_INT=36339]="LOW_INT",r[r.MEDIUM_INT=36340]="MEDIUM_INT",r[r.HIGH_INT=36341]="HIGH_INT",r[r.FRAMEBUFFER=36160]="FRAMEBUFFER",r[r.RENDERBUFFER=36161]="RENDERBUFFER",r[r.RGBA4=32854]="RGBA4",r[r.RGB5_A1=32855]="RGB5_A1",r[r.RGB565=36194]="RGB565",r[r.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",r[r.STENCIL_INDEX=6401]="STENCIL_INDEX",r[r.STENCIL_INDEX8=36168]="STENCIL_INDEX8",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r[r.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",r[r.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",r[r.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",r[r.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",r[r.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",r[r.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",r[r.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",r[r.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",r[r.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",r[r.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",r[r.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",r[r.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",r[r.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",r[r.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",r[r.NONE=0]="NONE",r[r.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",r[r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",r[r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",r[r.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",r[r.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",r[r.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",r[r.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",r[r.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",r[r.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",r[r.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",r[r.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",r[r.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",r[r.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",r[r.READ_BUFFER=3074]="READ_BUFFER",r[r.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",r[r.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",r[r.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",r[r.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",r[r.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",r[r.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",r[r.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",r[r.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",r[r.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",r[r.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",r[r.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",r[r.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",r[r.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",r[r.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",r[r.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",r[r.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",r[r.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",r[r.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",r[r.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",r[r.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",r[r.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",r[r.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",r[r.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",r[r.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",r[r.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",r[r.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",r[r.RED=6403]="RED",r[r.RGB8=32849]="RGB8",r[r.RGBA8=32856]="RGBA8",r[r.RGB10_A2=32857]="RGB10_A2",r[r.TEXTURE_3D=32879]="TEXTURE_3D",r[r.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",r[r.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",r[r.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",r[r.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",r[r.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",r[r.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",r[r.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",r[r.SRGB=35904]="SRGB",r[r.SRGB8=35905]="SRGB8",r[r.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",r[r.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",r[r.RGBA32F=34836]="RGBA32F",r[r.RGB32F=34837]="RGB32F",r[r.RGBA16F=34842]="RGBA16F",r[r.RGB16F=34843]="RGB16F",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",r[r.R11F_G11F_B10F=35898]="R11F_G11F_B10F",r[r.RGB9_E5=35901]="RGB9_E5",r[r.RGBA32UI=36208]="RGBA32UI",r[r.RGB32UI=36209]="RGB32UI",r[r.RGBA16UI=36214]="RGBA16UI",r[r.RGB16UI=36215]="RGB16UI",r[r.RGBA8UI=36220]="RGBA8UI",r[r.RGB8UI=36221]="RGB8UI",r[r.RGBA32I=36226]="RGBA32I",r[r.RGB32I=36227]="RGB32I",r[r.RGBA16I=36232]="RGBA16I",r[r.RGB16I=36233]="RGB16I",r[r.RGBA8I=36238]="RGBA8I",r[r.RGB8I=36239]="RGB8I",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.R8=33321]="R8",r[r.RG8=33323]="RG8",r[r.R16F=33325]="R16F",r[r.R32F=33326]="R32F",r[r.RG16F=33327]="RG16F",r[r.RG32F=33328]="RG32F",r[r.R8I=33329]="R8I",r[r.R8UI=33330]="R8UI",r[r.R16I=33331]="R16I",r[r.R16UI=33332]="R16UI",r[r.R32I=33333]="R32I",r[r.R32UI=33334]="R32UI",r[r.RG8I=33335]="RG8I",r[r.RG8UI=33336]="RG8UI",r[r.RG16I=33337]="RG16I",r[r.RG16UI=33338]="RG16UI",r[r.RG32I=33339]="RG32I",r[r.RG32UI=33340]="RG32UI",r[r.R8_SNORM=36756]="R8_SNORM",r[r.RG8_SNORM=36757]="RG8_SNORM",r[r.RGB8_SNORM=36758]="RGB8_SNORM",r[r.RGBA8_SNORM=36759]="RGBA8_SNORM",r[r.RGB10_A2UI=36975]="RGB10_A2UI",r[r.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",r[r.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.HALF_FLOAT=5131]="HALF_FLOAT",r[r.RG=33319]="RG",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",r[r.CURRENT_QUERY=34917]="CURRENT_QUERY",r[r.QUERY_RESULT=34918]="QUERY_RESULT",r[r.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",r[r.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",r[r.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",r[r.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",r[r.DRAW_BUFFER0=34853]="DRAW_BUFFER0",r[r.DRAW_BUFFER1=34854]="DRAW_BUFFER1",r[r.DRAW_BUFFER2=34855]="DRAW_BUFFER2",r[r.DRAW_BUFFER3=34856]="DRAW_BUFFER3",r[r.DRAW_BUFFER4=34857]="DRAW_BUFFER4",r[r.DRAW_BUFFER5=34858]="DRAW_BUFFER5",r[r.DRAW_BUFFER6=34859]="DRAW_BUFFER6",r[r.DRAW_BUFFER7=34860]="DRAW_BUFFER7",r[r.DRAW_BUFFER8=34861]="DRAW_BUFFER8",r[r.DRAW_BUFFER9=34862]="DRAW_BUFFER9",r[r.DRAW_BUFFER10=34863]="DRAW_BUFFER10",r[r.DRAW_BUFFER11=34864]="DRAW_BUFFER11",r[r.DRAW_BUFFER12=34865]="DRAW_BUFFER12",r[r.DRAW_BUFFER13=34866]="DRAW_BUFFER13",r[r.DRAW_BUFFER14=34867]="DRAW_BUFFER14",r[r.DRAW_BUFFER15=34868]="DRAW_BUFFER15",r[r.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",r[r.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",r[r.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",r[r.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",r[r.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",r[r.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",r[r.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",r[r.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",r[r.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",r[r.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",r[r.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",r[r.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",r[r.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",r[r.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",r[r.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",r[r.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",r[r.SAMPLER_3D=35679]="SAMPLER_3D",r[r.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",r[r.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",r[r.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",r[r.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",r[r.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",r[r.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",r[r.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",r[r.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",r[r.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",r[r.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",r[r.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",r[r.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",r[r.MAX_SAMPLES=36183]="MAX_SAMPLES",r[r.SAMPLER_BINDING=35097]="SAMPLER_BINDING",r[r.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",r[r.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",r[r.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",r[r.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",r[r.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",r[r.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",r[r.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",r[r.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",r[r.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",r[r.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",r[r.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",r[r.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",r[r.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",r[r.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",r[r.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",r[r.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",r[r.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",r[r.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",r[r.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",r[r.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",r[r.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",r[r.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",r[r.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",r[r.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",r[r.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",r[r.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",r[r.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",r[r.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",r[r.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",r[r.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",r[r.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",r[r.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",r[r.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",r[r.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",r[r.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",r[r.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",r[r.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",r[r.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",r[r.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",r[r.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",r[r.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",r[r.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",r[r.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",r[r.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",r[r.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",r[r.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",r[r.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",r[r.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",r[r.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",r[r.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",r[r.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",r[r.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",r[r.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",r[r.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",r[r.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",r[r.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",r[r.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",r[r.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",r[r.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",r[r.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",r[r.UNIFORM_TYPE=35383]="UNIFORM_TYPE",r[r.UNIFORM_SIZE=35384]="UNIFORM_SIZE",r[r.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",r[r.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",r[r.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",r[r.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",r[r.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",r[r.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",r[r.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",r[r.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",r[r.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",r[r.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",r[r.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",r[r.OBJECT_TYPE=37138]="OBJECT_TYPE",r[r.SYNC_CONDITION=37139]="SYNC_CONDITION",r[r.SYNC_STATUS=37140]="SYNC_STATUS",r[r.SYNC_FLAGS=37141]="SYNC_FLAGS",r[r.SYNC_FENCE=37142]="SYNC_FENCE",r[r.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",r[r.UNSIGNALED=37144]="UNSIGNALED",r[r.SIGNALED=37145]="SIGNALED",r[r.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",r[r.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",r[r.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",r[r.WAIT_FAILED=37149]="WAIT_FAILED",r[r.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",r[r.COLOR=6144]="COLOR",r[r.DEPTH=6145]="DEPTH",r[r.STENCIL=6146]="STENCIL",r[r.MIN=32775]="MIN",r[r.MAX=32776]="MAX",r[r.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",r[r.STREAM_READ=35041]="STREAM_READ",r[r.STREAM_COPY=35042]="STREAM_COPY",r[r.STATIC_READ=35045]="STATIC_READ",r[r.STATIC_COPY=35046]="STATIC_COPY",r[r.DYNAMIC_READ=35049]="DYNAMIC_READ",r[r.DYNAMIC_COPY=35050]="DYNAMIC_COPY",r[r.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",r[r.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",r[r.INVALID_INDEX=4294967295]="INVALID_INDEX",r[r.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",r[r.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",r[r.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",r[r.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",r[r.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",r[r.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",r[r.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",r[r.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",r[r.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",r[r.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",r[r.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",r[r.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",r[r.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",r[r.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",r[r.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",r[r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",r[r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",r[r.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",r[r.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",r[r.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",r[r.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",r[r.RGBA32F_EXT=34836]="RGBA32F_EXT",r[r.RGB32F_EXT=34837]="RGB32F_EXT",r[r.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",r[r.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",r[r.MIN_EXT=32775]="MIN_EXT",r[r.MAX_EXT=32776]="MAX_EXT",r[r.SRGB_EXT=35904]="SRGB_EXT",r[r.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",r[r.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",r[r.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",r[r.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",r[r.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",r[r.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",r[r.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",r[r.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",r[r.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",r[r.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",r[r.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",r[r.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",r[r.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",r[r.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",r[r.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",r[r.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",r[r.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",r[r.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",r[r.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",r[r.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",r[r.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",r[r.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",r[r.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",r[r.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",r[r.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",r[r.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",r[r.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",r[r.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",r[r.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",r[r.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",r[r.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",r[r.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",r[r.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",r[r.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",r[r.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",r[r.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",r[r.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",r[r.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",r[r.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",r[r.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",r[r.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",r[r.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",r[r.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",r[r.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",r[r.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",r[r.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT"})(B||(B={}));var oe;(function(r){r[r.Buffer=0]="Buffer",r[r.Texture=1]="Texture",r[r.RenderTarget=2]="RenderTarget",r[r.Sampler=3]="Sampler",r[r.Program=4]="Program",r[r.Bindings=5]="Bindings",r[r.InputLayout=6]="InputLayout",r[r.RenderPipeline=7]="RenderPipeline",r[r.ComputePipeline=8]="ComputePipeline",r[r.Readback=9]="Readback",r[r.QueryPool=10]="QueryPool",r[r.RenderBundle=11]="RenderBundle"})(oe||(oe={}));var ve;(function(r){r[r.NEVER=512]="NEVER",r[r.LESS=513]="LESS",r[r.EQUAL=514]="EQUAL",r[r.LEQUAL=515]="LEQUAL",r[r.GREATER=516]="GREATER",r[r.NOTEQUAL=517]="NOTEQUAL",r[r.GEQUAL=518]="GEQUAL",r[r.ALWAYS=519]="ALWAYS"})(ve||(ve={}));var Sd;(function(r){r[r.CCW=2305]="CCW",r[r.CW=2304]="CW"})(Sd||(Sd={}));var Gi;(function(r){r[r.NONE=0]="NONE",r[r.FRONT=1]="FRONT",r[r.BACK=2]="BACK",r[r.FRONT_AND_BACK=3]="FRONT_AND_BACK"})(Gi||(Gi={}));var jt;(function(r){r[r.ZERO=0]="ZERO",r[r.ONE=1]="ONE",r[r.SRC=768]="SRC",r[r.ONE_MINUS_SRC=769]="ONE_MINUS_SRC",r[r.DST=774]="DST",r[r.ONE_MINUS_DST=775]="ONE_MINUS_DST",r[r.SRC_ALPHA=770]="SRC_ALPHA",r[r.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",r[r.DST_ALPHA=772]="DST_ALPHA",r[r.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",r[r.CONST=32769]="CONST",r[r.ONE_MINUS_CONSTANT=32770]="ONE_MINUS_CONSTANT",r[r.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"})(jt||(jt={}));var br;(function(r){r[r.ADD=32774]="ADD",r[r.SUBSTRACT=32778]="SUBSTRACT",r[r.REVERSE_SUBSTRACT=32779]="REVERSE_SUBSTRACT",r[r.MIN=32775]="MIN",r[r.MAX=32776]="MAX"})(br||(br={}));var bi;(function(r){r[r.CLAMP_TO_EDGE=0]="CLAMP_TO_EDGE",r[r.REPEAT=1]="REPEAT",r[r.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"})(bi||(bi={}));var Ke;(function(r){r[r.POINT=0]="POINT",r[r.BILINEAR=1]="BILINEAR"})(Ke||(Ke={}));var mr;(function(r){r[r.NO_MIP=0]="NO_MIP",r[r.NEAREST=1]="NEAREST",r[r.LINEAR=2]="LINEAR"})(mr||(mr={}));var sr;(function(r){r[r.POINTS=0]="POINTS",r[r.TRIANGLES=1]="TRIANGLES",r[r.TRIANGLE_STRIP=2]="TRIANGLE_STRIP",r[r.LINES=3]="LINES",r[r.LINE_STRIP=4]="LINE_STRIP"})(sr||(sr={}));var Te;(function(r){r[r.MAP_READ=1]="MAP_READ",r[r.MAP_WRITE=2]="MAP_WRITE",r[r.COPY_SRC=4]="COPY_SRC",r[r.COPY_DST=8]="COPY_DST",r[r.INDEX=16]="INDEX",r[r.VERTEX=32]="VERTEX",r[r.UNIFORM=64]="UNIFORM",r[r.STORAGE=128]="STORAGE",r[r.INDIRECT=256]="INDIRECT",r[r.QUERY_RESOLVE=512]="QUERY_RESOLVE"})(Te||(Te={}));var wa;(function(r){r[r.STATIC=1]="STATIC",r[r.DYNAMIC=2]="DYNAMIC"})(wa||(wa={}));var vu;(function(r){r[r.VERTEX=1]="VERTEX",r[r.INSTANCE=2]="INSTANCE"})(vu||(vu={}));var VR;(function(r){r.LOADED="loaded"})(VR||(VR={}));var Zt;(function(r){r[r.TEXTURE_2D=0]="TEXTURE_2D",r[r.TEXTURE_2D_ARRAY=1]="TEXTURE_2D_ARRAY",r[r.TEXTURE_3D=2]="TEXTURE_3D",r[r.TEXTURE_CUBE_MAP=3]="TEXTURE_CUBE_MAP"})(Zt||(Zt={}));var ci;(function(r){r[r.SAMPLED=1]="SAMPLED",r[r.RENDER_TARGET=2]="RENDER_TARGET",r[r.STORAGE=4]="STORAGE"})(ci||(ci={}));var Er;(function(r){r[r.NONE=0]="NONE",r[r.RED=1]="RED",r[r.GREEN=2]="GREEN",r[r.BLUE=4]="BLUE",r[r.ALPHA=8]="ALPHA",r[r.RGB=7]="RGB",r[r.ALL=15]="ALL"})(Er||(Er={}));var Ze;(function(r){r[r.KEEP=7680]="KEEP",r[r.ZERO=0]="ZERO",r[r.REPLACE=7681]="REPLACE",r[r.INVERT=5386]="INVERT",r[r.INCREMENT_CLAMP=7682]="INCREMENT_CLAMP",r[r.DECREMENT_CLAMP=7683]="DECREMENT_CLAMP",r[r.INCREMENT_WRAP=34055]="INCREMENT_WRAP",r[r.DECREMENT_WRAP=34056]="DECREMENT_WRAP"})(Ze||(Ze={}));var je;(function(r){r[r.Float=0]="Float",r[r.UnfilterableFloat=1]="UnfilterableFloat",r[r.Uint=2]="Uint",r[r.Sint=3]="Sint",r[r.Depth=4]="Depth"})(je||(je={}));var Sa;(function(r){r[r.LOWER_LEFT=0]="LOWER_LEFT",r[r.UPPER_LEFT=1]="UPPER_LEFT"})(Sa||(Sa={}));var Qc;(function(r){r[r.NEGATIVE_ONE=0]="NEGATIVE_ONE",r[r.ZERO=1]="ZERO"})(Qc||(Qc={}));var I0;(function(r){r[r.OcclusionConservative=0]="OcclusionConservative"})(I0||(I0={}));var J;(function(r){r[r.U8=1]="U8",r[r.U16=2]="U16",r[r.U32=3]="U32",r[r.S8=4]="S8",r[r.S16=5]="S16",r[r.S32=6]="S32",r[r.F16=7]="F16",r[r.F32=8]="F32",r[r.BC1=65]="BC1",r[r.BC2=66]="BC2",r[r.BC3=67]="BC3",r[r.BC4_UNORM=68]="BC4_UNORM",r[r.BC4_SNORM=69]="BC4_SNORM",r[r.BC5_UNORM=70]="BC5_UNORM",r[r.BC5_SNORM=71]="BC5_SNORM",r[r.U16_PACKED_5551=97]="U16_PACKED_5551",r[r.U16_PACKED_565=98]="U16_PACKED_565",r[r.D24=129]="D24",r[r.D32F=130]="D32F",r[r.D24S8=131]="D24S8",r[r.D32FS8=132]="D32FS8"})(J||(J={}));var gt;(function(r){r[r.R=1]="R",r[r.RG=2]="RG",r[r.RGB=3]="RGB",r[r.RGBA=4]="RGBA",r[r.A=5]="A"})(gt||(gt={}));var lt;(function(r){r[r.None=0]="None",r[r.Normalized=1]="Normalized",r[r.sRGB=2]="sRGB",r[r.Depth=4]="Depth",r[r.Stencil=8]="Stencil",r[r.RenderTarget=16]="RenderTarget",r[r.Luminance=32]="Luminance"})(lt||(lt={}));function St(r,t,e){return r<<16|t<<8|e}var z;(function(r){r[r.ALPHA=St(J.U8,gt.A,lt.None)]="ALPHA",r[r.U8_LUMINANCE=St(J.U8,gt.A,lt.Luminance)]="U8_LUMINANCE",r[r.F16_LUMINANCE=St(J.F16,gt.A,lt.Luminance)]="F16_LUMINANCE",r[r.F32_LUMINANCE=St(J.F32,gt.A,lt.Luminance)]="F32_LUMINANCE",r[r.F16_R=St(J.F16,gt.R,lt.None)]="F16_R",r[r.F16_RG=St(J.F16,gt.RG,lt.None)]="F16_RG",r[r.F16_RGB=St(J.F16,gt.RGB,lt.None)]="F16_RGB",r[r.F16_RGBA=St(J.F16,gt.RGBA,lt.None)]="F16_RGBA",r[r.F32_R=St(J.F32,gt.R,lt.None)]="F32_R",r[r.F32_RG=St(J.F32,gt.RG,lt.None)]="F32_RG",r[r.F32_RGB=St(J.F32,gt.RGB,lt.None)]="F32_RGB",r[r.F32_RGBA=St(J.F32,gt.RGBA,lt.None)]="F32_RGBA",r[r.U8_R=St(J.U8,gt.R,lt.None)]="U8_R",r[r.U8_R_NORM=St(J.U8,gt.R,lt.Normalized)]="U8_R_NORM",r[r.U8_RG=St(J.U8,gt.RG,lt.None)]="U8_RG",r[r.U8_RG_NORM=St(J.U8,gt.RG,lt.Normalized)]="U8_RG_NORM",r[r.U8_RGB=St(J.U8,gt.RGB,lt.None)]="U8_RGB",r[r.U8_RGB_NORM=St(J.U8,gt.RGB,lt.Normalized)]="U8_RGB_NORM",r[r.U8_RGB_SRGB=St(J.U8,gt.RGB,lt.sRGB|lt.Normalized)]="U8_RGB_SRGB",r[r.U8_RGBA=St(J.U8,gt.RGBA,lt.None)]="U8_RGBA",r[r.U8_RGBA_NORM=St(J.U8,gt.RGBA,lt.Normalized)]="U8_RGBA_NORM",r[r.U8_RGBA_SRGB=St(J.U8,gt.RGBA,lt.sRGB|lt.Normalized)]="U8_RGBA_SRGB",r[r.U16_R=St(J.U16,gt.R,lt.None)]="U16_R",r[r.U16_R_NORM=St(J.U16,gt.R,lt.Normalized)]="U16_R_NORM",r[r.U16_RG_NORM=St(J.U16,gt.RG,lt.Normalized)]="U16_RG_NORM",r[r.U16_RGBA_NORM=St(J.U16,gt.RGBA,lt.Normalized)]="U16_RGBA_NORM",r[r.U16_RGBA=St(J.U16,gt.RGBA,lt.None)]="U16_RGBA",r[r.U16_RGB=St(J.U16,gt.RGB,lt.None)]="U16_RGB",r[r.U16_RG=St(J.U16,gt.RG,lt.None)]="U16_RG",r[r.U32_R=St(J.U32,gt.R,lt.None)]="U32_R",r[r.U32_RG=St(J.U32,gt.RG,lt.None)]="U32_RG",r[r.U32_RGB=St(J.U32,gt.RGB,lt.None)]="U32_RGB",r[r.U32_RGBA=St(J.U32,gt.RGBA,lt.None)]="U32_RGBA",r[r.S8_R=St(J.S8,gt.R,lt.None)]="S8_R",r[r.S8_R_NORM=St(J.S8,gt.R,lt.Normalized)]="S8_R_NORM",r[r.S8_RG_NORM=St(J.S8,gt.RG,lt.Normalized)]="S8_RG_NORM",r[r.S8_RGB_NORM=St(J.S8,gt.RGB,lt.Normalized)]="S8_RGB_NORM",r[r.S8_RGBA_NORM=St(J.S8,gt.RGBA,lt.Normalized)]="S8_RGBA_NORM",r[r.S16_R=St(J.S16,gt.R,lt.None)]="S16_R",r[r.S16_RG=St(J.S16,gt.RG,lt.None)]="S16_RG",r[r.S16_RG_NORM=St(J.S16,gt.RG,lt.Normalized)]="S16_RG_NORM",r[r.S16_RGB_NORM=St(J.S16,gt.RGB,lt.Normalized)]="S16_RGB_NORM",r[r.S16_RGBA=St(J.S16,gt.RGBA,lt.None)]="S16_RGBA",r[r.S16_RGBA_NORM=St(J.S16,gt.RGBA,lt.Normalized)]="S16_RGBA_NORM",r[r.S32_R=St(J.S32,gt.R,lt.None)]="S32_R",r[r.S32_RG=St(J.S32,gt.RG,lt.None)]="S32_RG",r[r.S32_RGB=St(J.S32,gt.RGB,lt.None)]="S32_RGB",r[r.S32_RGBA=St(J.S32,gt.RGBA,lt.None)]="S32_RGBA",r[r.U16_RGBA_5551=St(J.U16_PACKED_5551,gt.RGBA,lt.Normalized)]="U16_RGBA_5551",r[r.U16_RGB_565=St(J.U16_PACKED_565,gt.RGB,lt.Normalized)]="U16_RGB_565",r[r.BC1=St(J.BC1,gt.RGBA,lt.Normalized)]="BC1",r[r.BC1_SRGB=St(J.BC1,gt.RGBA,lt.Normalized|lt.sRGB)]="BC1_SRGB",r[r.BC2=St(J.BC2,gt.RGBA,lt.Normalized)]="BC2",r[r.BC2_SRGB=St(J.BC2,gt.RGBA,lt.Normalized|lt.sRGB)]="BC2_SRGB",r[r.BC3=St(J.BC3,gt.RGBA,lt.Normalized)]="BC3",r[r.BC3_SRGB=St(J.BC3,gt.RGBA,lt.Normalized|lt.sRGB)]="BC3_SRGB",r[r.BC4_UNORM=St(J.BC4_UNORM,gt.R,lt.Normalized)]="BC4_UNORM",r[r.BC4_SNORM=St(J.BC4_SNORM,gt.R,lt.Normalized)]="BC4_SNORM",r[r.BC5_UNORM=St(J.BC5_UNORM,gt.RG,lt.Normalized)]="BC5_UNORM",r[r.BC5_SNORM=St(J.BC5_SNORM,gt.RG,lt.Normalized)]="BC5_SNORM",r[r.D24=St(J.D24,gt.R,lt.Depth)]="D24",r[r.D24_S8=St(J.D24S8,gt.RG,lt.Depth|lt.Stencil)]="D24_S8",r[r.D32F=St(J.D32F,gt.R,lt.Depth)]="D32F",r[r.D32F_S8=St(J.D32FS8,gt.RG,lt.Depth|lt.Stencil)]="D32F_S8",r[r.U8_RGB_RT=St(J.U8,gt.RGB,lt.RenderTarget|lt.Normalized)]="U8_RGB_RT",r[r.U8_RGBA_RT=St(J.U8,gt.RGBA,lt.RenderTarget|lt.Normalized)]="U8_RGBA_RT",r[r.U8_RGBA_RT_SRGB=St(J.U8,gt.RGBA,lt.RenderTarget|lt.Normalized|lt.sRGB)]="U8_RGBA_RT_SRGB"})(z||(z={}));function _S(r){return r>>>8&255}function bo(r){return r>>>16&255}function Jc(r){return r&255}function PD(r){switch(r){case J.F32:case J.U32:case J.S32:return 4;case J.U16:case J.S16:case J.F16:return 2;case J.U8:case J.S8:return 1;default:throw new Error("whoops")}}function FD(r){return PD(bo(r))}function hrt(r){var t=PD(bo(r)),e=_S(r);return t*e}function BD(r){var t=Jc(r);if(t&lt.Depth)return je.Depth;if(t&lt.Normalized)return je.Float;var e=bo(r);if(e===J.F16||e===J.F32)return je.Float;if(e===J.U8||e===J.U16||e===J.U32)return je.Uint;if(e===J.S8||e===J.S16||e===J.S32)return je.Sint;throw new Error("whoops")}function Dt(r,t){if(t===void 0&&(t=""),!r)throw new Error("Assert fail: ".concat(t))}function Hl(r){if(r!=null)return r;throw new Error("Missing object")}function DD(r,t){return r.r===t.r&&r.g===t.g&&r.b===t.b&&r.a===t.a}function ND(r,t){r.r=t.r,r.g=t.g,r.b=t.b,r.a=t.a}function kD(r){var t=r.r,e=r.g,i=r.b,n=r.a;return{r:t,g:e,b:i,a:n}}function Av(r,t,e,i){return i===void 0&&(i=1),{r,g:t,b:e,a:i}}var Ym=Av(0,0,0,0);Av(0,0,0,1);var frt=Av(1,1,1,0);Av(1,1,1,1);function L0(r){return!!(r&&!(r&r-1))}function Cs(r,t){return r??t}function drt(r){return r===void 0?null:r}function O0(r,t){var e=t-1;return r+e&~e}function vrt(r,t){for(var e=new Array(r),i=0;i<r;i++)e[i]=t();return e}function prt(r,t){t===void 0&&(t=1);var e=r.split(`
`);return e.map(function(i,n){return"".concat(grt(""+(t+n),4," "),"  ").concat(i)}).join(`
`)}function grt(r,t,e){for(e===void 0&&(e="0");r.length<t;)r="".concat(e).concat(r);return r}function GR(r,t){r.blendDstFactor=t.blendDstFactor,r.blendSrcFactor=t.blendSrcFactor,r.blendMode=t.blendMode}function P0(r,t){return r===void 0&&(r={}),r.compare=t.compare,r.depthFailOp=t.depthFailOp,r.passOp=t.passOp,r.failOp=t.failOp,r.mask=t.mask,r}function UD(r,t){return r===void 0&&(r={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),GR(r.rgbBlendState,t.rgbBlendState),GR(r.alphaBlendState,t.alphaBlendState),r.channelWriteMask=t.channelWriteMask,r}function zD(r,t){r.length!==t.length&&(r.length=t.length);for(var e=0;e<t.length;e++)r[e]=UD(r[e],t[e])}function mrt(r,t){t.attachmentsState!==void 0&&zD(r.attachmentsState,t.attachmentsState),r.blendConstant&&t.blendConstant&&ND(r.blendConstant,t.blendConstant),r.depthCompare=Cs(t.depthCompare,r.depthCompare),r.depthWrite=Cs(t.depthWrite,r.depthWrite),r.stencilWrite=Cs(t.stencilWrite,r.stencilWrite),r.stencilFront&&t.stencilFront&&P0(r.stencilFront,t.stencilFront),r.stencilBack&&t.stencilBack&&P0(r.stencilBack,t.stencilBack),r.cullMode=Cs(t.cullMode,r.cullMode),r.frontFace=Cs(t.frontFace,r.frontFace),r.polygonOffset=Cs(t.polygonOffset,r.polygonOffset),r.polygonOffsetFactor=Cs(t.polygonOffsetFactor,r.polygonOffsetFactor),r.polygonOffsetUnits=Cs(t.polygonOffsetUnits,r.polygonOffsetUnits)}function th(r){var t=Object.assign({},r);return t.attachmentsState=[],zD(t.attachmentsState,r.attachmentsState),t.blendConstant=t.blendConstant&&kD(t.blendConstant),t.stencilFront=P0(void 0,r.stencilFront),t.stencilBack=P0(void 0,r.stencilBack),t}var XR={blendMode:br.ADD,blendSrcFactor:jt.ONE,blendDstFactor:jt.ZERO},eh={attachmentsState:[{channelWriteMask:Er.ALL,rgbBlendState:XR,alphaBlendState:XR}],blendConstant:kD(Ym),depthWrite:!0,depthCompare:ve.LEQUAL,stencilWrite:!1,stencilFront:{compare:ve.ALWAYS,passOp:Ze.KEEP,depthFailOp:Ze.KEEP,failOp:Ze.KEEP},stencilBack:{compare:ve.ALWAYS,passOp:Ze.KEEP,depthFailOp:Ze.KEEP,failOp:Ze.KEEP},cullMode:Gi.NONE,frontFace:Sd.CCW,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0};function yrt(r,t){r===void 0&&(r=null),t===void 0&&(t=eh);var e=th(t);return r!==null&&mrt(e,r),e}yrt({depthCompare:ve.ALWAYS,depthWrite:!1},eh);var HD={texture:null,sampler:null,formatKind:je.Float,dimension:Zt.TEXTURE_2D};function ks(r,t,e){if(r.length!==t.length)return!1;for(var i=0;i<r.length;i++)if(!e(r[i],t[i]))return!1;return!0}function _c(r,t){for(var e=Array(r.length),i=0;i<r.length;i++)e[i]=t(r[i]);return e}function _rt(r,t){return r.texture===t.texture&&r.binding===t.binding}function YR(r,t){return r.buffer===t.buffer&&r.size===t.size&&r.binding===t.binding&&r.offset===t.offset}function xrt(r,t){return r===null?t===null:t===null?!1:r.sampler===t.sampler&&r.texture===t.texture&&r.dimension===t.dimension&&r.formatKind===t.formatKind&&r.comparison===t.comparison}function Crt(r,t){return r.samplerBindings=r.samplerBindings||[],r.uniformBufferBindings=r.uniformBufferBindings||[],r.storageBufferBindings=r.storageBufferBindings||[],r.storageTextureBindings=r.storageTextureBindings||[],t.samplerBindings=t.samplerBindings||[],t.uniformBufferBindings=t.uniformBufferBindings||[],t.storageBufferBindings=t.storageBufferBindings||[],t.storageTextureBindings=t.storageTextureBindings||[],!(r.samplerBindings.length!==t.samplerBindings.length||!ks(r.samplerBindings,t.samplerBindings,xrt)||!ks(r.uniformBufferBindings,t.uniformBufferBindings,YR)||!ks(r.storageBufferBindings,t.storageBufferBindings,YR)||!ks(r.storageTextureBindings,t.storageTextureBindings,_rt))}function jR(r,t){return r.blendMode==t.blendMode&&r.blendSrcFactor===t.blendSrcFactor&&r.blendDstFactor===t.blendDstFactor}function Ert(r,t){return!(!jR(r.rgbBlendState,t.rgbBlendState)||!jR(r.alphaBlendState,t.alphaBlendState)||r.channelWriteMask!==t.channelWriteMask)}function F0(r,t){return r.compare==t.compare&&r.depthFailOp===t.depthFailOp&&r.failOp===t.failOp&&r.passOp===t.passOp&&r.mask===t.mask}function Srt(r,t){return!ks(r.attachmentsState,t.attachmentsState,Ert)||r.blendConstant&&t.blendConstant&&!DD(r.blendConstant,t.blendConstant)||r.stencilFront&&t.stencilFront&&!F0(r.stencilFront,t.stencilFront)||r.stencilBack&&t.stencilBack&&!F0(r.stencilBack,t.stencilBack)?!1:r.depthCompare===t.depthCompare&&r.depthWrite===t.depthWrite&&r.stencilWrite===t.stencilWrite&&r.cullMode===t.cullMode&&r.frontFace===t.frontFace&&r.polygonOffset===t.polygonOffset&&r.polygonOffsetFactor===t.polygonOffsetFactor&&r.polygonOffsetUnits===t.polygonOffsetUnits}function $D(r,t){return r.id===t.id}function Art(r,t){return r===t}function Trt(r,t){return!(r.topology!==t.topology||r.inputLayout!==t.inputLayout||r.sampleCount!==t.sampleCount||r.megaStateDescriptor&&t.megaStateDescriptor&&!Srt(r.megaStateDescriptor,t.megaStateDescriptor)||!$D(r.program,t.program)||!ks(r.colorAttachmentFormats,t.colorAttachmentFormats,Art)||r.depthStencilAttachmentFormat!==t.depthStencilAttachmentFormat)}function brt(r,t){return r.offset===t.offset&&r.shaderLocation===t.shaderLocation&&r.format===t.format&&r.divisor===t.divisor}function wrt(r,t){return qn(r)?qn(t):qn(t)?!1:r.arrayStride===t.arrayStride&&r.stepMode===t.stepMode&&ks(r.attributes,t.attributes,brt)}function Rrt(r,t){return!(r.indexBufferFormat!==t.indexBufferFormat||!ks(r.vertexBufferDescriptors,t.vertexBufferDescriptors,wrt)||!$D(r.program,t.program))}function Mrt(r){var t=r.sampler,e=r.texture,i=r.dimension,n=r.formatKind,a=r.comparison;return{sampler:t,texture:e,dimension:i,formatKind:n,comparison:a}}function ZR(r){var t=r.buffer,e=r.size,i=r.binding,n=r.offset;return{binding:i,buffer:t,offset:n,size:e}}function Irt(r){var t=r.binding,e=r.texture;return{binding:t,texture:e}}function Lrt(r){var t=r.samplerBindings&&_c(r.samplerBindings,Mrt),e=r.uniformBufferBindings&&_c(r.uniformBufferBindings,ZR),i=r.storageBufferBindings&&_c(r.storageBufferBindings,ZR),n=r.storageTextureBindings&&_c(r.storageTextureBindings,Irt);return{samplerBindings:t,uniformBufferBindings:e,storageBufferBindings:i,storageTextureBindings:n,pipeline:r.pipeline}}function Ort(r){var t=r.inputLayout,e=r.program,i=r.topology,n=r.megaStateDescriptor&&th(r.megaStateDescriptor),a=r.colorAttachmentFormats.slice(),o=r.depthStencilAttachmentFormat,s=r.sampleCount;return{inputLayout:t,megaStateDescriptor:n,program:e,topology:i,colorAttachmentFormats:a,depthStencilAttachmentFormat:o,sampleCount:s}}function Prt(r){var t=r.shaderLocation,e=r.format,i=r.offset,n=r.divisor;return{shaderLocation:t,format:e,offset:i,divisor:n}}function Frt(r){if(qn(r))return r;var t=r.arrayStride,e=r.stepMode,i=_c(r.attributes,Prt);return{arrayStride:t,stepMode:e,attributes:i}}function Brt(r){var t=_c(r.vertexBufferDescriptors,Frt),e=r.indexBufferFormat,i=r.program;return{vertexBufferDescriptors:t,indexBufferFormat:e,program:i}}var Jt,Drt=/([^[]*)(\[[0-9]+\])?/;function Nrt(r){if(r[r.length-1]!=="]")return{name:r,length:1,isArray:!1};var t=r.match(Drt);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(r));return{name:t[1],length:Number(t[2])||1,isArray:!!t[2]}}function mi(){var r=null;return function(t,e,i){var n=r!==i;return n&&(t.uniform1i(e,i),r=i),n}}function Ge(r,t,e,i){var n=null,a=null;return function(o,s,l){var u=t(l,e),c=u.length,h=!1;if(n===null)n=new Float32Array(c),a=c,h=!0;else{Dt(a===c,"Uniform length cannot change.");for(var f=0;f<c;++f)if(u[f]!==n[f]){h=!0;break}}return h&&(i(o,r,s,u),n.set(u)),h}}function ni(r,t,e,i){r[t](e,i)}function Do(r,t,e,i){r[t](e,!1,i)}var krt={},Urt={},zrt={},qR=[0];function xS(r,t,e,i){t===1&&typeof r=="boolean"&&(r=r?1:0),Number.isFinite(r)&&(qR[0]=r,r=qR);var n=r.length;if(r instanceof e)return r;var a=i[n];a||(a=new e(n),i[n]=a);for(var o=0;o<n;o++)a[o]=r[o];return a}function vn(r,t){return xS(r,t,Float32Array,krt)}function Es(r,t){return xS(r,t,Int32Array,Urt)}function Pp(r,t){return xS(r,t,Uint32Array,zrt)}var Hrt=(Jt={},Jt[B.FLOAT]=Ge.bind(null,"uniform1fv",vn,1,ni),Jt[B.FLOAT_VEC2]=Ge.bind(null,"uniform2fv",vn,2,ni),Jt[B.FLOAT_VEC3]=Ge.bind(null,"uniform3fv",vn,3,ni),Jt[B.FLOAT_VEC4]=Ge.bind(null,"uniform4fv",vn,4,ni),Jt[B.INT]=Ge.bind(null,"uniform1iv",Es,1,ni),Jt[B.INT_VEC2]=Ge.bind(null,"uniform2iv",Es,2,ni),Jt[B.INT_VEC3]=Ge.bind(null,"uniform3iv",Es,3,ni),Jt[B.INT_VEC4]=Ge.bind(null,"uniform4iv",Es,4,ni),Jt[B.BOOL]=Ge.bind(null,"uniform1iv",Es,1,ni),Jt[B.BOOL_VEC2]=Ge.bind(null,"uniform2iv",Es,2,ni),Jt[B.BOOL_VEC3]=Ge.bind(null,"uniform3iv",Es,3,ni),Jt[B.BOOL_VEC4]=Ge.bind(null,"uniform4iv",Es,4,ni),Jt[B.FLOAT_MAT2]=Ge.bind(null,"uniformMatrix2fv",vn,4,Do),Jt[B.FLOAT_MAT3]=Ge.bind(null,"uniformMatrix3fv",vn,9,Do),Jt[B.FLOAT_MAT4]=Ge.bind(null,"uniformMatrix4fv",vn,16,Do),Jt[B.UNSIGNED_INT]=Ge.bind(null,"uniform1uiv",Pp,1,ni),Jt[B.UNSIGNED_INT_VEC2]=Ge.bind(null,"uniform2uiv",Pp,2,ni),Jt[B.UNSIGNED_INT_VEC3]=Ge.bind(null,"uniform3uiv",Pp,3,ni),Jt[B.UNSIGNED_INT_VEC4]=Ge.bind(null,"uniform4uiv",Pp,4,ni),Jt[B.FLOAT_MAT2x3]=Ge.bind(null,"uniformMatrix2x3fv",vn,6,Do),Jt[B.FLOAT_MAT2x4]=Ge.bind(null,"uniformMatrix2x4fv",vn,8,Do),Jt[B.FLOAT_MAT3x2]=Ge.bind(null,"uniformMatrix3x2fv",vn,6,Do),Jt[B.FLOAT_MAT3x4]=Ge.bind(null,"uniformMatrix3x4fv",vn,12,Do),Jt[B.FLOAT_MAT4x2]=Ge.bind(null,"uniformMatrix4x2fv",vn,8,Do),Jt[B.FLOAT_MAT4x3]=Ge.bind(null,"uniformMatrix4x3fv",vn,12,Do),Jt[B.SAMPLER_2D]=mi,Jt[B.SAMPLER_CUBE]=mi,Jt[B.SAMPLER_3D]=mi,Jt[B.SAMPLER_2D_SHADOW]=mi,Jt[B.SAMPLER_2D_ARRAY]=mi,Jt[B.SAMPLER_2D_ARRAY_SHADOW]=mi,Jt[B.SAMPLER_CUBE_SHADOW]=mi,Jt[B.INT_SAMPLER_2D]=mi,Jt[B.INT_SAMPLER_3D]=mi,Jt[B.INT_SAMPLER_CUBE]=mi,Jt[B.INT_SAMPLER_2D_ARRAY]=mi,Jt[B.UNSIGNED_INT_SAMPLER_2D]=mi,Jt[B.UNSIGNED_INT_SAMPLER_3D]=mi,Jt[B.UNSIGNED_INT_SAMPLER_CUBE]=mi,Jt[B.UNSIGNED_INT_SAMPLER_2D_ARRAY]=mi,Jt);function KR(r,t,e){var i=Hrt[e.type];if(!i)throw new Error("Unknown GLSL uniform type ".concat(e.type));return i().bind(null,r,t)}var $rt={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function Wrt(r){return Object.prototype.toString.call(r)in $rt}function hf(r,t){return"#define ".concat(r," ").concat(t)}function Vrt(r){var t={};return r.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,function(e,i,n){var a=Number(n);return t[i]=isNaN(a)?n:a,""}),t}function Grt(r,t){var e=[];return r.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,function(i,n,a){var o=Number(n);return e.push({location:isNaN(o)?t[n]:o,name:a}),""}),e}function QR(r){if(r===void 0)return null;var t=/binding\s*=\s*(\d+)/.exec(r);if(t!==null){var e=parseInt(t[1],10);if(!Number.isNaN(e))return e}return null}function JR(r){var t="",e=r;return[e,t]}function rh(r,t,e,i,n){var a;i===void 0&&(i=null),n===void 0&&(n=!0);var o=r.glslVersion==="#version 100",s=t==="frag"&&((a=e.match(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm))===null||a===void 0?void 0:a.length)>1,l=e.replace(`\r
`,`
`).split(`
`).map(function(A){return A.replace(/[/][/].*$/,"")}).filter(function(A){var b=!A||/^\s+$/.test(A);return!b}),u="";i!==null&&(u=Object.keys(i).map(function(A){return hf(A,i[A])}).join(`
`));var c=l.find(function(A){return A.startsWith("precision")})||"precision mediump float;",h=n?l.filter(function(A){return!A.startsWith("precision")}).join(`
`):l.join(`
`),f="";if(r.viewportOrigin===Sa.UPPER_LEFT&&(f+="".concat(hf("VIEWPORT_ORIGIN_TL","1"),`
`)),r.clipSpaceNearZ===Qc.ZERO&&(f+="".concat(hf("CLIPSPACE_NEAR_ZERO","1"),`
`)),r.explicitBindingLocations){var d=0,v=0,p=0;h=h.replace(/^\s*(layout\((.*)\))?\s*uniform(.+{)$/gm,function(A,b,R,M){var O=R?"".concat(R,", "):"";return"layout(".concat(O,"set = ").concat(d,", binding = ").concat(v++,") uniform ").concat(M)}),d++,v=0,Dt(r.separateSamplerTextures),h=h.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(A,b,R,M,O){var F=QR(R);F===null&&(F=v++);var D=ct(JR(M),2),H=D[0],j=D[1];return t==="frag"?`
layout(set = `.concat(d,", binding = ").concat(F*2+0,") uniform texture").concat(H," T_").concat(O,`;
layout(set = `).concat(d,", binding = ").concat(F*2+1,") uniform sampler").concat(j," S_").concat(O,";").trim():""}),h=h.replace(t==="frag"?/^\s*\b(varying|in)\b/gm:/^\s*\b(varying|out)\b/gm,function(A,b){return"layout(location = ".concat(p++,") ").concat(b)}),f+="".concat(hf("gl_VertexID","gl_VertexIndex"),`
`),f+="".concat(hf("gl_InstanceID","gl_InstanceIndex"),`
`),c=c.replace(/^precision (.*) sampler(.*);$/gm,"")}else{var g=0;h=h.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(A,b,R,M,O){var F=QR(R);return F===null&&(F=g++),"uniform sampler".concat(M," ").concat(O,"; // BINDING=").concat(F)})}if(h=h.replace(/\bPU_SAMPLER_(\w+)\((.*?)\)/g,function(A,b,R){return"SAMPLER_".concat(b,"(P_").concat(R,")")}),h=h.replace(/\bPF_SAMPLER_(\w+)\((.*?)\)/g,function(A,b,R){return"PP_SAMPLER_".concat(b,"(P_").concat(R,")")}),h=h.replace(/\bPU_TEXTURE\((.*?)\)/g,function(A,b){return"TEXTURE(P_".concat(b,")")}),r.separateSamplerTextures)h=h.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,function(A,b,R){var M=ct(JR(b),2),O=M[0],F=M[1];return"texture".concat(O," T_P_").concat(R,", sampler").concat(F," S_P_").concat(R)}),h=h.replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,function(A,b,R){return"T_".concat(R,", S_").concat(R)}),h=h.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(A,b,R){return"sampler".concat(b,"(T_").concat(R,", S_").concat(R,")")}),h=h.replace(/\bTEXTURE\((.*?)\)/g,function(A,b){return"T_".concat(b)});else{var m=[];h=h.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,function(A,b,R){return"sampler".concat(b," P_").concat(R)}),h=h.replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,function(A,b,R){return R}),h=h.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(A,b,R){return m.push([R,b]),R}),o&&m.forEach(function(A){var b=ct(A,2),R=b[0],M=b[1];h=h.replace(new RegExp("texture\\(".concat(R),"g"),function(){return"texture".concat(M,"(").concat(R)})}),h=h.replace(/\bTEXTURE\((.*?)\)/g,function(A,b){return b})}var y="".concat(o?"":r.glslVersion,`
`).concat(o&&s?`#extension GL_EXT_draw_buffers : require
`:"",`
`).concat(o&&t==="frag"?`#extension GL_OES_standard_derivatives : enable
`:"").concat(n?c:"",`
`).concat(f||"").concat(u?u+`
`:"",`
`).concat(h,`
`).trim();if(r.explicitBindingLocations&&t==="frag"&&(y=y.replace(/^\b(out)\b/g,function(A,b){return"layout(location = 0) ".concat(b)})),o){if(t==="frag"&&(y=y.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,function(A,b,R){return"varying ".concat(b," ").concat(R,`;
`)})),t==="vert"&&(y=y.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(A,b,R){return"varying ".concat(b," ").concat(R,`;
`)}),y=y.replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,function(A,b,R){return"attribute ".concat(b," ").concat(R,`;
`)})),y=y.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,function(A,b){return b.trim().replace(/^.*$/gm,function(R){var M=R.trim();return M.startsWith("#")?M:R?"uniform ".concat(M):""})}),t==="frag")if(s){var _=[];y=y.replace(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm,function(A,b){return _.push(b),"vec4 ".concat(b,`;
`)});var x=y.lastIndexOf("}");y=y.substring(0,x)+`
    `.concat(_.map(function(A,b){return"gl_FragData[".concat(b,"] = ").concat(A,`;
    `)}).join(`
`))+y.substring(x)}else{var C;if(y=y.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(A,b,R){return C=R,"".concat(b," ").concat(R,`;
`)}),C){var x=y.lastIndexOf("}");y=y.substring(0,x)+`
  gl_FragColor = vec4(`.concat(C,`);
`)+y.substring(x)}}y=y.replace(/^\s*layout\((.*)\)/gm,"")}return y}var la=function(r){N(t,r);function t(e){var i=e.id,n=e.device,a=r.call(this)||this;return a.id=i,a.device=n,a.device.resourceCreationTracker!==null&&a.device.resourceCreationTracker.trackResourceCreated(a),a}return t.prototype.destroy=function(){this.device.resourceCreationTracker!==null&&this.device.resourceCreationTracker.trackResourceDestroyed(this)},t}(OD),Xrt=function(r){N(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o=r.call(this,{id:i,device:n})||this;o.type=oe.Bindings;var s=a.uniformBufferBindings,l=a.samplerBindings;return o.uniformBufferBindings=s||[],o.samplerBindings=l||[],o.bindingLayouts=o.createBindingLayouts(),o}return t.prototype.createBindingLayouts=function(){var e=0,i=0,n=[],a=this.uniformBufferBindings.length,o=this.samplerBindings.length;return n.push({firstUniformBuffer:e,numUniformBuffers:a,firstSampler:i,numSamplers:o}),e+=a,i+=o,{numUniformBuffers:e,numSamplers:i,bindingLayoutTables:n}},t}(la),ff;function _t(r){return ff!==void 0?ff:typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?(ff=!0,!0):(ff=!!(r&&r._version===2),ff)}function WD(r){var t=bo(r);switch(t){case J.BC1:case J.BC2:case J.BC3:case J.BC4_UNORM:case J.BC4_SNORM:case J.BC5_UNORM:case J.BC5_SNORM:return!0;default:return!1}}function VD(r){var t=Jc(r);if(t&lt.Normalized)return!1;var e=bo(r);return e===J.S8||e===J.S16||e===J.S32||e===J.U8||e===J.U16||e===J.U32}function Yrt(r){switch(r){case wa.STATIC:return B.STATIC_DRAW;case wa.DYNAMIC:return B.DYNAMIC_DRAW}}function tM(r){if(r&Te.INDEX)return B.ELEMENT_ARRAY_BUFFER;if(r&Te.VERTEX)return B.ARRAY_BUFFER;if(r&Te.UNIFORM)return B.UNIFORM_BUFFER}function jrt(r){switch(r){case sr.TRIANGLES:return B.TRIANGLES;case sr.POINTS:return B.POINTS;case sr.TRIANGLE_STRIP:return B.TRIANGLE_STRIP;case sr.LINES:return B.LINES;case sr.LINE_STRIP:return B.LINE_STRIP;default:throw new Error("Unknown primitive topology mode")}}function Zrt(r){switch(r){case J.U8:return B.UNSIGNED_BYTE;case J.U16:return B.UNSIGNED_SHORT;case J.U32:return B.UNSIGNED_INT;case J.S8:return B.BYTE;case J.S16:return B.SHORT;case J.S32:return B.INT;case J.F16:return B.HALF_FLOAT;case J.F32:return B.FLOAT;default:throw new Error("whoops")}}function qrt(r){switch(r){case gt.R:return 1;case gt.RG:return 2;case gt.RGB:return 3;case gt.RGBA:return 4;default:return 1}}function Krt(r){var t=bo(r),e=_S(r),i=Jc(r),n=Zrt(t),a=qrt(e),o=!!(i&lt.Normalized);return{size:a,type:n,normalized:o}}function Qrt(r){switch(r){case z.U8_R:return B.UNSIGNED_BYTE;case z.U16_R:return B.UNSIGNED_SHORT;case z.U32_R:return B.UNSIGNED_INT;default:throw new Error("whoops")}}function df(r){switch(r){case bi.CLAMP_TO_EDGE:return B.CLAMP_TO_EDGE;case bi.REPEAT:return B.REPEAT;case bi.MIRRORED_REPEAT:return B.MIRRORED_REPEAT;default:throw new Error("whoops")}}function Fp(r,t){if(t===mr.LINEAR&&r===Ke.BILINEAR)return B.LINEAR_MIPMAP_LINEAR;if(t===mr.LINEAR&&r===Ke.POINT)return B.NEAREST_MIPMAP_LINEAR;if(t===mr.NEAREST&&r===Ke.BILINEAR)return B.LINEAR_MIPMAP_NEAREST;if(t===mr.NEAREST&&r===Ke.POINT)return B.NEAREST_MIPMAP_NEAREST;if(t===mr.NO_MIP&&r===Ke.BILINEAR)return B.LINEAR;if(t===mr.NO_MIP&&r===Ke.POINT)return B.NEAREST;throw new Error("Unknown texture filter mode")}function Pc(r,t){t===void 0&&(t=0);var e=r;return e.gl_buffer_pages[t/e.pageByteSize|0]}function hc(r){var t=r;return t.gl_texture}function Tx(r){var t=r;return t.gl_sampler}function vf(r,t){r.name=t,r.__SPECTOR_Metadata={name:t}}function eM(r,t){for(var e=[];;){var i=t.exec(r);if(!i)break;e.push(i)}return e}function Ss(r){return r.blendMode==br.ADD&&r.blendSrcFactor==jt.ONE&&r.blendDstFactor===jt.ZERO}function Jrt(r){switch(r){case I0.OcclusionConservative:return B.ANY_SAMPLES_PASSED_CONSERVATIVE;default:throw new Error("whoops")}}function tit(r){if(r===Zt.TEXTURE_2D)return B.TEXTURE_2D;if(r===Zt.TEXTURE_2D_ARRAY)return B.TEXTURE_2D_ARRAY;if(r===Zt.TEXTURE_CUBE_MAP)return B.TEXTURE_CUBE_MAP;if(r===Zt.TEXTURE_3D)return B.TEXTURE_3D;throw new Error("whoops")}function N_(r,t,e,i){return!(r%e!==0||t%i!==0)}var eit=function(r){N(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o=r.call(this,{id:i,device:n})||this;o.type=oe.Buffer;var s=a.viewOrSize,l=a.usage,u=a.hint,c=u===void 0?wa.STATIC:u,h=n.uniformBufferMaxPageByteSize,f=n.gl,d=l&Te.UNIFORM;d||(_t(f)?f.bindVertexArray(null):n.OES_vertex_array_object.bindVertexArrayOES(null));var v=yc(s)?O0(s,4):O0(s.byteLength,4);o.gl_buffer_pages=[];var p;if(d){for(var g=v;g>0;)o.gl_buffer_pages.push(o.createBufferPage(Math.min(g,h),l,c)),g-=h;p=h}else o.gl_buffer_pages.push(o.createBufferPage(v,l,c)),p=v;return o.pageByteSize=p,o.byteSize=v,o.usage=l,o.gl_target=tM(l),yc(s)||o.setSubData(0,new Uint8Array(s.buffer)),d||(_t(f)?f.bindVertexArray(o.device.currentBoundVAO):n.OES_vertex_array_object.bindVertexArrayOES(o.device.currentBoundVAO)),o}return t.prototype.setSubData=function(e,i,n,a){n===void 0&&(n=0),a===void 0&&(a=i.byteLength-n);for(var o=this.device.gl,s=this.pageByteSize,l=e+a,u=e,c=e%s;u<l;){var h=_t(o)?o.COPY_WRITE_BUFFER:this.gl_target,f=Pc(this,u);if(f.ubo)return;o.bindBuffer(h,f),_t(o)?o.bufferSubData(h,c,i,n,Math.min(l-u,s)):o.bufferSubData(h,c,i),u+=s,c=0,n+=s,this.device.debugGroupStatisticsBufferUpload()}},t.prototype.destroy=function(){r.prototype.destroy.call(this);for(var e=0;e<this.gl_buffer_pages.length;e++)this.gl_buffer_pages[e].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[e]);this.gl_buffer_pages=[]},t.prototype.createBufferPage=function(e,i,n){var a=this.device.gl,o=i&Te.UNIFORM;if(!_t(a)&&o)return{ubo:!0};var s=this.device.ensureResourceExists(a.createBuffer()),l=tM(i),u=Yrt(n);return a.bindBuffer(l,s),a.bufferData(l,e,u),s},t}(la),rit=function(r){N(t,r);function t(e){var i,n,a,o,s=e.id,l=e.device,u=e.descriptor,c,h=r.call(this,{id:s,device:l})||this;h.type=oe.InputLayout;var f=u.vertexBufferDescriptors,d=u.indexBufferFormat,v=u.program;Dt(d===z.U16_R||d===z.U32_R||d===null);var p=d!==null?Qrt(d):null,g=d!==null?FD(d):null,m=h.device.gl,y=h.device.ensureResourceExists(_t(m)?m.createVertexArray():l.OES_vertex_array_object.createVertexArrayOES());_t(m)?m.bindVertexArray(y):l.OES_vertex_array_object.bindVertexArrayOES(y),m.bindBuffer(m.ARRAY_BUFFER,Pc(h.device.fallbackVertexBuffer));try{for(var _=Qt(u.vertexBufferDescriptors),x=_.next();!x.done;x=_.next()){var C=x.value,A=C.stepMode,b=C.attributes;try{for(var R=(a=void 0,Qt(b)),M=R.next();!M.done;M=R.next()){var O=M.value,F=O.shaderLocation,D=O.format,H=O.divisor,j=H===void 0?1:H,$=_t(m)?F:(c=v.attributes[F])===null||c===void 0?void 0:c.location,k=Krt(D);if(O.vertexFormat=k,!qn($)){VD(D);var V=k.size,Q=k.type,Y=k.normalized;m.vertexAttribPointer($,V,Q,Y,0,0),A===vu.INSTANCE&&(_t(m)?m.vertexAttribDivisor($,j):l.ANGLE_instanced_arrays.vertexAttribDivisorANGLE($,j)),m.enableVertexAttribArray($)}}}catch(tt){a={error:tt}}finally{try{M&&!M.done&&(o=R.return)&&o.call(R)}finally{if(a)throw a.error}}}}catch(tt){i={error:tt}}finally{try{x&&!x.done&&(n=_.return)&&n.call(_)}finally{if(i)throw i.error}}return _t(m)?m.bindVertexArray(null):l.OES_vertex_array_object.bindVertexArrayOES(null),h.vertexBufferDescriptors=f,h.vao=y,h.indexBufferFormat=d,h.indexBufferType=p,h.indexBufferCompByteSize=g,h.program=v,h}return t.prototype.destroy=function(){r.prototype.destroy.call(this),this.device.currentBoundVAO===this.vao&&(_t(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)},t}(la),bx=function(r){N(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o=e.fake,s=r.call(this,{id:i,device:n})||this;s.type=oe.Texture,a=S({dimension:Zt.TEXTURE_2D,depthOrArrayLayers:1,mipLevelCount:1},a);var l=s.device.gl,u,c,h=s.clampmipLevelCount(a);if(s.immutable=a.usage===ci.RENDER_TARGET,s.pixelStore=a.pixelStore,s.format=a.format,s.dimension=a.dimension,s.formatKind=BD(a.format),s.width=a.width,s.height=a.height,s.depthOrArrayLayers=a.depthOrArrayLayers,s.mipmaps=h>=1,!o){c=s.device.ensureResourceExists(l.createTexture());var f=s.device.translateTextureType(a.format),d=s.device.translateTextureInternalFormat(a.format);if(s.device.setActiveTexture(l.TEXTURE0),s.device.currentTextures[0]=null,s.preprocessImage(),a.dimension===Zt.TEXTURE_2D){if(u=B.TEXTURE_2D,l.bindTexture(u,c),s.immutable)if(_t(l))l.texStorage2D(u,h,d,a.width,a.height);else{var v=(d===B.DEPTH_COMPONENT||s.isNPOT(),0);(s.format===z.D32F||s.format===z.D24_S8)&&!_t(l)&&!n.WEBGL_depth_texture||(l.texImage2D(u,v,d,a.width,a.height,0,d,f,null),s.mipmaps&&(s.mipmaps=!1,l.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,B.LINEAR),l.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),l.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE)))}Dt(a.depthOrArrayLayers===1)}else if(a.dimension===Zt.TEXTURE_2D_ARRAY)u=B.TEXTURE_2D_ARRAY,l.bindTexture(u,c),s.immutable&&_t(l)&&l.texStorage3D(u,h,d,a.width,a.height,a.depthOrArrayLayers);else if(a.dimension===Zt.TEXTURE_3D)u=B.TEXTURE_3D,l.bindTexture(u,c),s.immutable&&_t(l)&&l.texStorage3D(u,h,d,a.width,a.height,a.depthOrArrayLayers);else if(a.dimension===Zt.TEXTURE_CUBE_MAP)u=B.TEXTURE_CUBE_MAP,l.bindTexture(u,c),s.immutable&&_t(l)&&l.texStorage2D(u,h,d,a.width,a.height),Dt(a.depthOrArrayLayers===6);else throw new Error("whoops")}return s.gl_texture=c,s.gl_target=u,s.mipLevelCount=h,s}return t.prototype.setImageData=function(e,i){i===void 0&&(i=0);var n=this.device.gl;WD(this.format);var a=this.gl_target===B.TEXTURE_3D||this.gl_target===B.TEXTURE_2D_ARRAY,o=this.gl_target===B.TEXTURE_CUBE_MAP,s=Wrt(e[0]);this.device.setActiveTexture(n.TEXTURE0),this.device.currentTextures[0]=null;var l=e[0],u,c;s?(u=this.width,c=this.height):(u=l.width,c=l.height,this.width=u,this.height=c),n.bindTexture(this.gl_target,this.gl_texture);var h=this.device.translateTextureFormat(this.format),f=_t(n)?this.device.translateInternalTextureFormat(this.format):h,d=this.device.translateTextureType(this.format);this.preprocessImage();for(var v=0;v<this.depthOrArrayLayers;v++){var p=e[v],g=this.gl_target;o&&(g=B.TEXTURE_CUBE_MAP_POSITIVE_X+v%6),this.immutable?n.texSubImage2D(g,i,0,0,u,c,h,d,p):_t(n)?a?n.texImage3D(g,i,f,u,c,this.depthOrArrayLayers,0,h,d,p):n.texImage2D(g,i,f,u,c,0,h,d,p):s?n.texImage2D(g,i,h,u,c,0,h,d,p):n.texImage2D(g,i,h,h,d,p)}this.mipmaps&&this.generateMipmap(a)},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.device.gl.deleteTexture(hc(this))},t.prototype.clampmipLevelCount=function(e){if(e.dimension===Zt.TEXTURE_2D_ARRAY&&e.depthOrArrayLayers>1){var i=bo(e.format);if(i===J.BC1)for(var n=e.width,a=e.height,o=0;o<e.mipLevelCount;o++){if(n<=2||a<=2)return o-1;n=Math.max(n/2|0,1),a=Math.max(a/2|0,1)}}return e.mipLevelCount},t.prototype.preprocessImage=function(){var e=this.device.gl;this.pixelStore&&(this.pixelStore.unpackFlipY&&e.pixelStorei(B.UNPACK_FLIP_Y_WEBGL,!0),this.pixelStore.packAlignment&&e.pixelStorei(B.PACK_ALIGNMENT,this.pixelStore.packAlignment),this.pixelStore.unpackAlignment&&e.pixelStorei(B.UNPACK_ALIGNMENT,this.pixelStore.unpackAlignment))},t.prototype.generateMipmap=function(e){e===void 0&&(e=!1);var i=this.device.gl;return!_t(i)&&this.isNPOT()?this:(this.gl_texture&&this.gl_target&&(i.bindTexture(this.gl_target,this.gl_texture),e?(i.texParameteri(this.gl_target,B.TEXTURE_BASE_LEVEL,0),i.texParameteri(this.gl_target,B.TEXTURE_MAX_LEVEL,Math.log2(this.width)),i.texParameteri(this.gl_target,B.TEXTURE_MIN_FILTER,B.LINEAR_MIPMAP_LINEAR),i.texParameteri(this.gl_target,B.TEXTURE_MAG_FILTER,B.LINEAR)):i.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,B.NEAREST_MIPMAP_LINEAR),i.generateMipmap(this.gl_target),i.bindTexture(this.gl_target,null)),this)},t.prototype.isNPOT=function(){var e=this.device.gl;return _t(e)?!1:!L0(this.width)||!L0(this.height)},t}(la),iit=function(r){N(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o=r.call(this,{id:i,device:n})||this;o.type=oe.RenderTarget,o.gl_renderbuffer=null,o.texture=null;var s=o.device.gl,l=a.format,u=a.width,c=a.height,h=a.sampleCount,f=h===void 0?1:h,d=a.texture,v=!1;if((l===z.D32F||l===z.D24_S8)&&d&&!_t(s)&&!n.WEBGL_depth_texture&&(d.destroy(),o.texture=null,v=!0),!v&&d)o.texture=d;else{o.gl_renderbuffer=o.device.ensureResourceExists(s.createRenderbuffer()),s.bindRenderbuffer(s.RENDERBUFFER,o.gl_renderbuffer);var p=o.device.translateTextureInternalFormat(l,!0);_t(s)&&f>1?s.renderbufferStorageMultisample(B.RENDERBUFFER,f,p,u,c):s.renderbufferStorage(B.RENDERBUFFER,p,u,c)}return o.format=l,o.width=u,o.height=c,o.sampleCount=f,o}return t.prototype.destroy=function(){r.prototype.destroy.call(this),this.gl_renderbuffer!==null&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer),this.texture&&this.texture.destroy()},t}(la),Ui;(function(r){r[r.NeedsCompile=0]="NeedsCompile",r[r.Compiling=1]="Compiling",r[r.NeedsBind=2]="NeedsBind",r[r.ReadyToUse=3]="ReadyToUse"})(Ui||(Ui={}));var nit=function(r){N(t,r);function t(e,i){var n=e.id,a=e.device,o=e.descriptor,s=r.call(this,{id:n,device:a})||this;s.rawVertexGLSL=i,s.type=oe.Program,s.uniformSetters={},s.attributes=[];var l=s.device.gl;return s.descriptor=o,s.gl_program=s.device.ensureResourceExists(l.createProgram()),s.gl_shader_vert=null,s.gl_shader_frag=null,s.compileState=Ui.NeedsCompile,s.tryCompileProgram(),s}return t.prototype.destroy=function(){r.prototype.destroy.call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)},t.prototype.tryCompileProgram=function(){Dt(this.compileState===Ui.NeedsCompile);var e=this.descriptor,i=e.vertex,n=e.fragment,a=this.device.gl;i!=null&&i.glsl&&(n!=null&&n.glsl)&&(this.gl_shader_vert=this.compileShader(i.postprocess?i.postprocess(i.glsl):i.glsl,a.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(n.postprocess?n.postprocess(n.glsl):n.glsl,a.FRAGMENT_SHADER),a.attachShader(this.gl_program,this.gl_shader_vert),a.attachShader(this.gl_program,this.gl_shader_frag),a.linkProgram(this.gl_program),this.compileState=Ui.Compiling,_t(a)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromLinkedProgram()))},t.prototype.readAttributesFromLinkedProgram=function(){for(var e,i=this.device.gl,n=i.getProgramParameter(this.gl_program,i.ACTIVE_ATTRIBUTES),a=Vrt(this.descriptor.vertex.glsl),o=Grt(this.rawVertexGLSL,a),s=function(c){var h=i.getActiveAttrib(l.gl_program,c),f=h.name,d=h.type,v=h.size,p=i.getAttribLocation(l.gl_program,f),g=(e=o.find(function(m){return m.name===f}))===null||e===void 0?void 0:e.location;p>=0&&!qn(g)&&(l.attributes[g]={name:f,location:p,type:d,size:v})},l=this,u=0;u<n;u++)s(u)},t.prototype.readUniformLocationsFromLinkedProgram=function(){for(var e=this.device.gl,i=e.getProgramParameter(this.gl_program,e.ACTIVE_UNIFORMS),n=0;n<i;n++){var a=e.getActiveUniform(this.gl_program,n),o=Nrt(a.name).name,s=e.getUniformLocation(this.gl_program,o);if(this.uniformSetters[o]=KR(e,s,a),a&&a.size>1)for(var l=0;l<a.size;l++)s=e.getUniformLocation(this.gl_program,"".concat(o,"[").concat(l,"]")),this.uniformSetters["".concat(o,"[").concat(l,"]")]=KR(e,s,a)}},t.prototype.compileShader=function(e,i){var n=this.device.gl,a=this.device.ensureResourceExists(n.createShader(i));return n.shaderSource(a,e),n.compileShader(a),a},t.prototype.setUniformsLegacy=function(e){e===void 0&&(e={});var i=this.device.gl;if(!_t(i)){var n=!1;for(var a in e){n||(i.useProgram(this.gl_program),n=!0);var o=e[a],s=this.uniformSetters[a];if(s){var l=o;l instanceof bx&&(l=l.textureIndex),s(l)}}}return this},t}(la),ait=function(r){N(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o=r.call(this,{id:i,device:n})||this;o.type=oe.QueryPool;var s=o.device.gl;if(_t(s)){var l=a.elemCount,u=a.type;o.gl_query=vrt(l,function(){return o.device.ensureResourceExists(s.createQuery())}),o.gl_query_type=Jrt(u)}return o}return t.prototype.queryResultOcclusion=function(e){var i=this.device.gl;if(_t(i)){var n=this.gl_query[e];return i.getQueryParameter(n,i.QUERY_RESULT_AVAILABLE)?!!i.getQueryParameter(n,i.QUERY_RESULT):null}return null},t.prototype.destroy=function(){r.prototype.destroy.call(this);var e=this.device.gl;if(_t(e))for(var i=0;i<this.gl_query.length;i++)e.deleteQuery(this.gl_query[i])},t}(la),oit=function(r){N(t,r);function t(e){var i=e.id,n=e.device,a=r.call(this,{id:i,device:n})||this;return a.type=oe.Readback,a.gl_pbo=null,a.gl_sync=null,a}return t.prototype.clientWaitAsync=function(e,i,n){i===void 0&&(i=0),n===void 0&&(n=10);var a=this.device.gl;return new Promise(function(o,s){function l(){var u=a.clientWaitSync(e,i,0);if(u==a.WAIT_FAILED){s();return}if(u==a.TIMEOUT_EXPIRED){setTimeout(l,urt(n,0,a.MAX_CLIENT_WAIT_TIMEOUT_WEBGL));return}o()}l()})},t.prototype.getBufferSubDataAsync=function(e,i,n,a,o,s){return Ti(this,void 0,void 0,function(){var l;return ba(this,function(u){switch(u.label){case 0:return l=this.device.gl,_t(l)?(this.gl_sync=l.fenceSync(l.SYNC_GPU_COMMANDS_COMPLETE,0),l.flush(),[4,this.clientWaitAsync(this.gl_sync,0,10)]):[3,2];case 1:return u.sent(),l.bindBuffer(e,i),l.getBufferSubData(e,n,a,o,s),l.bindBuffer(e,null),[2,a];case 2:return[2]}})})},t.prototype.readTexture=function(e,i,n,a,o,s,l,u){return l===void 0&&(l=0),u===void 0&&(u=s.byteLength||0),Ti(this,void 0,void 0,function(){var c,h,f,d,v;return ba(this,function(p){return c=this.device.gl,h=e,f=this.device.translateTextureFormat(h.format),d=this.device.translateTextureType(h.format),v=hrt(h.format),_t(c)?(this.gl_pbo=this.device.ensureResourceExists(c.createBuffer()),c.bindBuffer(c.PIXEL_PACK_BUFFER,this.gl_pbo),c.bufferData(c.PIXEL_PACK_BUFFER,u,c.STREAM_READ),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),c.bindFramebuffer(B.READ_FRAMEBUFFER,this.device.readbackFramebuffer),c.framebufferTexture2D(B.READ_FRAMEBUFFER,B.COLOR_ATTACHMENT0,B.TEXTURE_2D,h.gl_texture,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,this.gl_pbo),c.readPixels(i,n,a,o,f,d,l*v),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),[2,this.getBufferSubDataAsync(c.PIXEL_PACK_BUFFER,this.gl_pbo,0,s,l,0)]):[2,this.readTextureSync(e,i,n,a,o,s,l,u)]})})},t.prototype.readTextureSync=function(e,i,n,a,o,s,l,u){u===void 0&&(u=s.byteLength||0);var c=this.device.gl,h=e,f=this.device.translateTextureType(h.format);return c.bindFramebuffer(B.FRAMEBUFFER,this.device.readbackFramebuffer),c.framebufferTexture2D(B.FRAMEBUFFER,B.COLOR_ATTACHMENT0,B.TEXTURE_2D,h.gl_texture,0),c.pixelStorei(c.PACK_ALIGNMENT,4),c.readPixels(i,n,a,o,c.RGBA,f,s),s},t.prototype.readBuffer=function(e,i,n,a,o){return Ti(this,void 0,void 0,function(){var s;return ba(this,function(l){return s=this.device.gl,_t(s)?[2,this.getBufferSubDataAsync(s.ARRAY_BUFFER,Pc(e,i),i,n,a,o)]:[2,Promise.reject()]})})},t.prototype.destroy=function(){r.prototype.destroy.call(this),_t(this.device.gl)&&(this.gl_sync!==null&&this.device.gl.deleteSync(this.gl_sync),this.gl_pbo!==null&&this.device.gl.deleteBuffer(this.gl_pbo))},t}(la),sit=function(r){N(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o,s,l=r.call(this,{id:i,device:n})||this;return l.type=oe.RenderPipeline,l.drawMode=jrt((o=a.topology)!==null&&o!==void 0?o:sr.TRIANGLES),l.program=a.program,l.inputLayout=a.inputLayout,l.megaState=S(S({},th(eh)),a.megaStateDescriptor),l.colorAttachmentFormats=a.colorAttachmentFormats.slice(),l.depthStencilAttachmentFormat=a.depthStencilAttachmentFormat,l.sampleCount=(s=a.sampleCount)!==null&&s!==void 0?s:1,l}return t}(la),lit=function(r){N(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o=r.call(this,{id:i,device:n})||this;return o.type=oe.ComputePipeline,o.descriptor=a,o}return t}(la),uit=function(){function r(){this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}return r.prototype.trackResourceCreated=function(t){this.creationStacks.set(t,new Error().stack),this.liveObjects.add(t)},r.prototype.trackResourceDestroyed=function(t){this.deletionStacks.has(t)&&console.warn("Object double freed:",t,`

Creation stack: `,this.creationStacks.get(t),`

Deletion stack: `,this.deletionStacks.get(t),`

This stack: `,new Error().stack),this.deletionStacks.set(t,new Error().stack),this.liveObjects.delete(t)},r.prototype.checkForLeaks=function(){var t,e;try{for(var i=Qt(this.liveObjects.values()),n=i.next();!n.done;n=i.next()){var a=n.value;console.warn("Object leaked:",a,"Creation stack:",this.creationStacks.get(a))}}catch(o){t={error:o}}finally{try{n&&!n.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}},r.prototype.setResourceLeakCheck=function(t,e){e?this.liveObjects.add(t):this.liveObjects.delete(t)},r}(),cit=function(r){N(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o,s,l=r.call(this,{id:i,device:n})||this;l.type=oe.Sampler;var u=l.device.gl;if(_t(u)){var c=l.device.ensureResourceExists(u.createSampler());u.samplerParameteri(c,B.TEXTURE_WRAP_S,df(a.addressModeU)),u.samplerParameteri(c,B.TEXTURE_WRAP_T,df(a.addressModeV)),u.samplerParameteri(c,B.TEXTURE_WRAP_R,df((o=a.addressModeW)!==null&&o!==void 0?o:a.addressModeU)),u.samplerParameteri(c,B.TEXTURE_MIN_FILTER,Fp(a.minFilter,a.mipmapFilter)),u.samplerParameteri(c,B.TEXTURE_MAG_FILTER,Fp(a.magFilter,mr.NO_MIP)),a.lodMinClamp!==void 0&&u.samplerParameterf(c,B.TEXTURE_MIN_LOD,a.lodMinClamp),a.lodMaxClamp!==void 0&&u.samplerParameterf(c,B.TEXTURE_MAX_LOD,a.lodMaxClamp),a.compareFunction!==void 0&&(u.samplerParameteri(c,u.TEXTURE_COMPARE_MODE,u.COMPARE_REF_TO_TEXTURE),u.samplerParameteri(c,u.TEXTURE_COMPARE_FUNC,a.compareFunction));var h=(s=a.maxAnisotropy)!==null&&s!==void 0?s:1;h>1&&l.device.EXT_texture_filter_anisotropic!==null&&(Dt(a.minFilter===Ke.BILINEAR&&a.magFilter===Ke.BILINEAR&&a.mipmapFilter===mr.LINEAR),u.samplerParameterf(c,l.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,h)),l.gl_sampler=c}else l.descriptor=a;return l}return t.prototype.setTextureParameters=function(e,i,n){var a,o=this.device.gl,s=this.descriptor;this.isNPOT(i,n)?o.texParameteri(B.TEXTURE_2D,B.TEXTURE_MIN_FILTER,B.LINEAR):o.texParameteri(e,B.TEXTURE_MIN_FILTER,Fp(s.minFilter,s.mipmapFilter)),o.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_S,df(s.addressModeU)),o.texParameteri(B.TEXTURE_2D,B.TEXTURE_WRAP_T,df(s.addressModeV)),o.texParameteri(e,B.TEXTURE_MAG_FILTER,Fp(s.magFilter,mr.NO_MIP));var l=(a=s.maxAnisotropy)!==null&&a!==void 0?a:1;l>1&&this.device.EXT_texture_filter_anisotropic!==null&&(Dt(s.minFilter===Ke.BILINEAR&&s.magFilter===Ke.BILINEAR&&s.mipmapFilter===mr.LINEAR),o.texParameteri(e,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l))},t.prototype.destroy=function(){r.prototype.destroy.call(this),_t(this.device.gl)&&this.device.gl.deleteSampler(Tx(this))},t.prototype.isNPOT=function(e,i){return!L0(e)||!L0(i)},t}(la),hit=function(){function r(){}return r.prototype.dispatchWorkgroups=function(t,e,i){},r.prototype.dispatchWorkgroupsIndirect=function(t,e){},r.prototype.setPipeline=function(t){},r.prototype.setBindings=function(t){},r.prototype.pushDebugGroup=function(t){},r.prototype.popDebugGroup=function(){},r.prototype.insertDebugMarker=function(t){},r}(),fit=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type=oe.RenderBundle,e.commands=[],e}return t.prototype.push=function(e){this.commands.push(e)},t.prototype.replay=function(){this.commands.forEach(function(e){return e()})},t}(la),rM=65536,dit=/uniform(?:\s+)(\w+)(?:\s?){([^]*?)}/g,vit=function(){function r(t,e){e===void 0&&(e={}),this.shaderDebug=!1,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_draw_buffers=null,this.WEBGL_depth_texture=null,this.WEBGL_color_buffer_float=null,this.EXT_color_buffer_half_float=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.EXT_color_buffer_float=null,this.OES_texture_float_linear=null,this.OES_texture_half_float_linear=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorAttachmentLevels=[],this.currentColorResolveTos=[],this.currentColorResolveToLevels=[],this.currentSampleCount=-1,this.currentIndexBufferByteOffset=null,this.currentMegaState=th(eh),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.currentRenderPassDescriptorStack=[],this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveDepthStencilAttachmentsChanged=!1,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=Sa.LOWER_LEFT,this.clipSpaceNearZ=Qc.NEGATIVE_ONE,this.supportMRT=!1,this.inBlitRenderPass=!1,this.supportedSampleCounts=[],this.occlusionQueriesRecommended=!1,this.computeShadersSupported=!1,this.gl=t,this.contextAttributes=Hl(t.getContextAttributes()),_t(t)?(this.EXT_texture_norm16=t.getExtension("EXT_texture_norm16"),this.EXT_color_buffer_float=t.getExtension("EXT_color_buffer_float")):(this.OES_vertex_array_object=t.getExtension("OES_vertex_array_object"),this.ANGLE_instanced_arrays=t.getExtension("ANGLE_instanced_arrays"),this.OES_texture_float=t.getExtension("OES_texture_float"),this.WEBGL_draw_buffers=t.getExtension("WEBGL_draw_buffers"),this.WEBGL_depth_texture=t.getExtension("WEBGL_depth_texture"),this.WEBGL_color_buffer_float=t.getExtension("WEBGL_color_buffer_float"),this.EXT_color_buffer_half_float=t.getExtension("EXT_color_buffer_half_float"),t.getExtension("EXT_frag_depth"),t.getExtension("OES_element_index_uint"),t.getExtension("OES_standard_derivatives")),this.WEBGL_compressed_texture_s3tc=t.getExtension("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb=t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.EXT_texture_compression_rgtc=t.getExtension("EXT_texture_compression_rgtc"),this.EXT_texture_filter_anisotropic=t.getExtension("EXT_texture_filter_anisotropic"),this.EXT_texture_norm16=t.getExtension("EXT_texture_norm16"),this.OES_texture_float_linear=t.getExtension("OES_texture_float_linear"),this.OES_texture_half_float_linear=t.getExtension("OES_texture_half_float_linear"),this.KHR_parallel_shader_compile=t.getExtension("KHR_parallel_shader_compile"),_t(t)?(this.platformString="WebGL2",this.glslVersion="#version 300 es"):(this.platformString="WebGL1",this.glslVersion="#version 100"),this.scTexture=new bx({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depthOrArrayLayers:1,dimension:Zt.TEXTURE_2D,mipLevelCount:1,usage:ci.RENDER_TARGET,format:this.contextAttributes.alpha===!1?z.U8_RGB_RT:z.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=je.Float,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(Zt.TEXTURE_2D,je.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(Zt.TEXTURE_2D,je.Depth),this.fallbackVertexBuffer=this.createBuffer({viewOrSize:1,usage:Te.VERTEX,hint:wa.STATIC}),_t(t)&&(this.fallbackTexture2DArray=this.createFallbackTexture(Zt.TEXTURE_2D_ARRAY,je.Float),this.fallbackTexture3D=this.createFallbackTexture(Zt.TEXTURE_3D,je.Float),this.fallbackTextureCube=this.createFallbackTexture(Zt.TEXTURE_CUBE_MAP,je.Float)),this.currentMegaState.depthCompare=ve.LESS,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=Er.ALL,t.enable(t.DEPTH_TEST),t.enable(t.STENCIL_TEST),this.checkLimits(),e.shaderDebug&&(this.shaderDebug=!0),e.trackResources&&(this.resourceCreationTracker=new uit)}return r.prototype.destroy=function(){this.blitBindings&&this.blitBindings.destroy(),this.blitInputLayout&&this.blitInputLayout.destroy(),this.blitRenderPipeline&&this.blitRenderPipeline.destroy(),this.blitVertexBuffer&&this.blitVertexBuffer.destroy(),this.blitProgram&&this.blitProgram.destroy()},r.prototype.createFallbackTexture=function(t,e){var i=t===Zt.TEXTURE_CUBE_MAP?6:1,n=e===je.Depth?z.D32F:z.U8_RGBA_NORM,a=this.createTexture({dimension:t,format:n,usage:ci.SAMPLED,width:1,height:1,depthOrArrayLayers:i,mipLevelCount:1});return e===je.Float&&a.setImageData([new Uint8Array(4*i)]),hc(a)},r.prototype.getNextUniqueId=function(){return++this.resourceUniqueId},r.prototype.checkLimits=function(){var t=this.gl;if(this.maxVertexAttribs=t.getParameter(B.MAX_VERTEX_ATTRIBS),_t(t)){this.uniformBufferMaxPageByteSize=Math.min(t.getParameter(B.MAX_UNIFORM_BLOCK_SIZE),rM),this.uniformBufferWordAlignment=t.getParameter(t.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var e=t.getInternalformatParameter(t.RENDERBUFFER,t.DEPTH32F_STENCIL8,t.SAMPLES);this.supportedSampleCounts=e?xt([],ct(e),!1):[],this.occlusionQueriesRecommended=!0}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=rM;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort(function(i,n){return i-n})},r.prototype.configureSwapChain=function(t,e,i){var n=this.scTexture;n.width=t,n.height=e,this.scPlatformFramebuffer=drt(i)},r.prototype.getDevice=function(){return this},r.prototype.getCanvas=function(){return this.gl.canvas},r.prototype.getOnscreenTexture=function(){return this.scTexture},r.prototype.beginFrame=function(){},r.prototype.endFrame=function(){},r.prototype.translateTextureInternalFormat=function(t,e){switch(e===void 0&&(e=!1),t){case z.ALPHA:return B.ALPHA;case z.U8_LUMINANCE:case z.F16_LUMINANCE:case z.F32_LUMINANCE:return B.LUMINANCE;case z.F16_R:return B.R16F;case z.F16_RG:return B.RG16F;case z.F16_RGB:return B.RGB16F;case z.F16_RGBA:return B.RGBA16F;case z.F32_R:return B.R32F;case z.F32_RG:return B.RG32F;case z.F32_RGB:return B.RGB32F;case z.F32_RGBA:return _t(this.gl)?B.RGBA32F:e?this.WEBGL_color_buffer_float.RGBA32F_EXT:B.RGBA;case z.U8_R_NORM:return B.R8;case z.U8_RG_NORM:return B.RG8;case z.U8_RGB_NORM:case z.U8_RGB_RT:return B.RGB8;case z.U8_RGB_SRGB:return B.SRGB8;case z.U8_RGBA_NORM:case z.U8_RGBA_RT:return _t(this.gl)?B.RGBA8:e?B.RGBA4:B.RGBA;case z.U8_RGBA:return B.RGBA;case z.U8_RGBA_SRGB:case z.U8_RGBA_RT_SRGB:return B.SRGB8_ALPHA8;case z.U16_R:return B.R16UI;case z.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case z.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case z.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case z.U16_RGBA_5551:return B.RGB5_A1;case z.U16_RGB_565:return B.RGB565;case z.U32_R:return B.R32UI;case z.S8_RGBA_NORM:return B.RGBA8_SNORM;case z.S8_RG_NORM:return B.RG8_SNORM;case z.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case z.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case z.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case z.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case z.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case z.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case z.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case z.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case z.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case z.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case z.D32F_S8:return _t(this.gl)?B.DEPTH32F_STENCIL8:this.WEBGL_depth_texture?B.DEPTH_STENCIL:B.DEPTH_COMPONENT16;case z.D24_S8:return _t(this.gl)?B.DEPTH24_STENCIL8:this.WEBGL_depth_texture?B.DEPTH_STENCIL:B.DEPTH_COMPONENT16;case z.D32F:return _t(this.gl)?B.DEPTH_COMPONENT32F:this.WEBGL_depth_texture?B.DEPTH_COMPONENT:B.DEPTH_COMPONENT16;case z.D24:return _t(this.gl)?B.DEPTH_COMPONENT24:this.WEBGL_depth_texture?B.DEPTH_COMPONENT:B.DEPTH_COMPONENT16;default:throw new Error("whoops")}},r.prototype.translateTextureType=function(t){var e=bo(t);switch(e){case J.U8:return B.UNSIGNED_BYTE;case J.U16:return B.UNSIGNED_SHORT;case J.U32:return B.UNSIGNED_INT;case J.S8:return B.BYTE;case J.F16:return B.HALF_FLOAT;case J.F32:return B.FLOAT;case J.U16_PACKED_5551:return B.UNSIGNED_SHORT_5_5_5_1;case J.D32F:return _t(this.gl)?B.FLOAT:this.WEBGL_depth_texture?B.UNSIGNED_INT:B.UNSIGNED_BYTE;case J.D24:return _t(this.gl)?B.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?B.UNSIGNED_SHORT:B.UNSIGNED_BYTE;case J.D24S8:return _t(this.gl)?B.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?B.UNSIGNED_INT_24_8_WEBGL:B.UNSIGNED_BYTE;case J.D32FS8:return B.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw new Error("whoops")}},r.prototype.translateInternalTextureFormat=function(t){switch(t){case z.F32_R:return B.R32F;case z.F32_RG:return B.RG32F;case z.F32_RGB:return B.RGB32F;case z.F32_RGBA:return B.RGBA32F;case z.F16_R:return B.R16F;case z.F16_RG:return B.RG16F;case z.F16_RGB:return B.RGB16F;case z.F16_RGBA:return B.RGBA16F}return this.translateTextureFormat(t)},r.prototype.translateTextureFormat=function(t){if(WD(t)||t===z.F32_LUMINANCE||t===z.U8_LUMINANCE)return this.translateTextureInternalFormat(t);var e=_t(this.gl)||!_t(this.gl)&&!!this.WEBGL_depth_texture;switch(t){case z.D24_S8:case z.D32F_S8:return e?B.DEPTH_STENCIL:B.RGBA;case z.D24:case z.D32F:return e?B.DEPTH_COMPONENT:B.RGBA}var i=VD(t),n=_S(t);switch(n){case gt.A:return B.ALPHA;case gt.R:return i?B.RED_INTEGER:B.RED;case gt.RG:return i?B.RG_INTEGER:B.RG;case gt.RGB:return i?B.RGB_INTEGER:B.RGB;case gt.RGBA:return B.RGBA}},r.prototype.setActiveTexture=function(t){this.currentActiveTexture!==t&&(this.gl.activeTexture(t),this.currentActiveTexture=t)},r.prototype.bindVAO=function(t){this.currentBoundVAO!==t&&(_t(this.gl)?this.gl.bindVertexArray(t):this.OES_vertex_array_object.bindVertexArrayOES(t),this.currentBoundVAO=t)},r.prototype.programCompiled=function(t){Dt(t.compileState!==Ui.NeedsCompile),t.compileState===Ui.Compiling&&(t.compileState=Ui.NeedsBind,this.shaderDebug&&this.checkProgramCompilationForErrors(t))},r.prototype.useProgram=function(t){this.currentProgram!==t&&(this.programCompiled(t),this.gl.useProgram(t.gl_program),this.currentProgram=t)},r.prototype.ensureResourceExists=function(t){if(t===null){var e=this.gl.getError();throw new Error("Created resource is null; GL error encountered: ".concat(e))}else return t},r.prototype.createBuffer=function(t){return new eit({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createTexture=function(t){return new bx({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createSampler=function(t){return new cit({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createRenderTarget=function(t){return new iit({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createRenderTargetFromTexture=function(t){var e=t,i=e.format,n=e.width,a=e.height,o=e.mipLevelCount;return Dt(o===1),this.createRenderTarget({format:i,width:n,height:a,sampleCount:1,texture:t})},r.prototype.createProgram=function(t){var e,i,n,a=(e=t.vertex)===null||e===void 0?void 0:e.glsl;return!((i=t.vertex)===null||i===void 0)&&i.glsl&&(t.vertex.glsl=rh(this.queryVendorInfo(),"vert",t.vertex.glsl)),!((n=t.fragment)===null||n===void 0)&&n.glsl&&(t.fragment.glsl=rh(this.queryVendorInfo(),"frag",t.fragment.glsl)),this.createProgramSimple(t,a)},r.prototype.createProgramSimple=function(t,e){var i=new nit({id:this.getNextUniqueId(),device:this,descriptor:t},e);return i},r.prototype.createBindings=function(t){return new Xrt({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createInputLayout=function(t){return new rit({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createRenderPipeline=function(t){return new sit({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createComputePass=function(){return new hit},r.prototype.createComputePipeline=function(t){return new lit({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createReadback=function(){return new oit({id:this.getNextUniqueId(),device:this})},r.prototype.createQueryPool=function(t,e){return new ait({id:this.getNextUniqueId(),device:this,descriptor:{type:t,elemCount:e}})},r.prototype.formatRenderPassDescriptor=function(t){var e,i,n,a,o,s,l=t.colorAttachment;t.depthClearValue=(e=t.depthClearValue)!==null&&e!==void 0?e:"load",t.stencilClearValue=(i=t.stencilClearValue)!==null&&i!==void 0?i:"load";for(var u=0;u<l.length;u++)t.colorAttachmentLevel||(t.colorAttachmentLevel=[]),t.colorAttachmentLevel[u]=(n=t.colorAttachmentLevel[u])!==null&&n!==void 0?n:0,t.colorResolveToLevel||(t.colorResolveToLevel=[]),t.colorResolveToLevel[u]=(a=t.colorResolveToLevel[u])!==null&&a!==void 0?a:0,t.colorClearColor||(t.colorClearColor=[]),t.colorClearColor[u]=(o=t.colorClearColor[u])!==null&&o!==void 0?o:"load",t.colorStore||(t.colorStore=[]),t.colorStore[u]=(s=t.colorStore[u])!==null&&s!==void 0?s:!1},r.prototype.createRenderBundle=function(){return new fit({id:this.getNextUniqueId(),device:this})},r.prototype.beginBundle=function(t){this.renderBundle=t},r.prototype.endBundle=function(){this.renderBundle=void 0},r.prototype.executeBundles=function(t){t.forEach(function(e){e.replay()})},r.prototype.createRenderPass=function(t){this.currentRenderPassDescriptor!==null&&this.currentRenderPassDescriptorStack.push(this.currentRenderPassDescriptor),this.currentRenderPassDescriptor=t,this.formatRenderPassDescriptor(t);var e=t.colorAttachment,i=t.colorAttachmentLevel,n=t.colorClearColor,a=t.colorResolveTo,o=t.colorResolveToLevel,s=t.depthStencilAttachment,l=t.depthClearValue,u=t.stencilClearValue,c=t.depthStencilResolveTo,h=a&&a.length===1&&a[0]===this.scTexture;this.setRenderPassParametersBegin(e.length,h);for(var f=0;f<e.length;f++)this.setRenderPassParametersColor(f,e[f],i[f],a[f],o[f],h);this.setRenderPassParametersDepthStencil(s,c,h),this.validateCurrentAttachments();for(var f=0;f<e.length;f++){var d=n[f];d!=="load"&&this.setRenderPassParametersClearColor(f,d.r,d.g,d.b,d.a)}return this.setRenderPassParametersClearDepthStencil(l,u),this},r.prototype.submitPass=function(t){Dt(this.currentRenderPassDescriptor!==null),this.endPass(),this.currentRenderPassDescriptorStack.length?this.currentRenderPassDescriptor=this.currentRenderPassDescriptorStack.pop():this.currentRenderPassDescriptor=null},r.prototype.copySubTexture2D=function(t,e,i,n,a,o){var s=this.gl,l=t,u=n;if(Dt(u.mipLevelCount===1),Dt(l.mipLevelCount===1),_t(s))l===this.scTexture?s.bindFramebuffer(s.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(s.bindFramebuffer(s.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0,l,0)),s.bindFramebuffer(s.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(s.READ_FRAMEBUFFER,s.COLOR_ATTACHMENT0,u,0),s.blitFramebuffer(a,o,a+u.width,o+u.height,e,i,e+u.width,i+u.height,s.COLOR_BUFFER_BIT,s.LINEAR),s.bindFramebuffer(s.READ_FRAMEBUFFER,null),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,null);else if(l===this.scTexture){var c=this.createRenderTargetFromTexture(n);this.submitBlitRenderPass(c,l)}},r.prototype.queryLimits=function(){return this},r.prototype.queryTextureFormatSupported=function(t,e,i){switch(t){case z.BC1_SRGB:case z.BC2_SRGB:case z.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb!==null?N_(e,i,4,4):!1;case z.BC1:case z.BC2:case z.BC3:return this.WEBGL_compressed_texture_s3tc!==null?N_(e,i,4,4):!1;case z.BC4_UNORM:case z.BC4_SNORM:case z.BC5_UNORM:case z.BC5_SNORM:return this.EXT_texture_compression_rgtc!==null?N_(e,i,4,4):!1;case z.U16_R_NORM:case z.U16_RG_NORM:case z.U16_RGBA_NORM:return this.EXT_texture_norm16!==null;case z.F32_R:case z.F32_RG:case z.F32_RGB:case z.F32_RGBA:return this.OES_texture_float_linear!==null;case z.F16_R:case z.F16_RG:case z.F16_RGB:case z.F16_RGBA:return this.OES_texture_half_float_linear!==null;default:return!0}},r.prototype.queryProgramReady=function(t){var e=this.gl;if(t.compileState===Ui.NeedsCompile)throw new Error("whoops");if(t.compileState===Ui.Compiling){var i=void 0;return this.KHR_parallel_shader_compile!==null?i=e.getProgramParameter(t.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR):i=!0,i&&this.programCompiled(t),i}return t.compileState===Ui.NeedsBind||t.compileState===Ui.ReadyToUse},r.prototype.queryPlatformAvailable=function(){return this.gl.isContextLost()},r.prototype.queryVendorInfo=function(){return this},r.prototype.queryRenderPass=function(t){return this.currentRenderPassDescriptor},r.prototype.queryRenderTarget=function(t){var e=t;return e},r.prototype.setResourceName=function(t,e){if(t.name=e,t.type===oe.Buffer)for(var i=t.gl_buffer_pages,n=0;n<i.length;n++)vf(i[n],"".concat(e," Page ").concat(n));else if(t.type===oe.Texture)vf(hc(t),e);else if(t.type===oe.Sampler)vf(Tx(t),e);else if(t.type===oe.RenderTarget){var a=t.gl_renderbuffer;a!==null&&vf(a,e)}else t.type===oe.InputLayout&&vf(t.vao,e)},r.prototype.setResourceLeakCheck=function(t,e){this.resourceCreationTracker!==null&&this.resourceCreationTracker.setResourceLeakCheck(t,e)},r.prototype.checkForLeaks=function(){this.resourceCreationTracker!==null&&this.resourceCreationTracker.checkForLeaks()},r.prototype.pushDebugGroup=function(t){},r.prototype.popDebugGroup=function(){},r.prototype.insertDebugMarker=function(t){},r.prototype.programPatched=function(t,e){Dt(this.shaderDebug)},r.prototype.getBufferData=function(t,e,i){i===void 0&&(i=0);var n=this.gl;_t(n)&&(n.bindBuffer(n.COPY_READ_BUFFER,Pc(t,i*4)),n.getBufferSubData(n.COPY_READ_BUFFER,i*4,e))},r.prototype.debugGroupStatisticsDrawCall=function(t){t===void 0&&(t=1);for(var e=this.debugGroupStack.length-1;e>=0;e--)this.debugGroupStack[e].drawCallCount+=t},r.prototype.debugGroupStatisticsBufferUpload=function(t){t===void 0&&(t=1);for(var e=this.debugGroupStack.length-1;e>=0;e--)this.debugGroupStack[e].bufferUploadCount+=t},r.prototype.debugGroupStatisticsTextureBind=function(t){t===void 0&&(t=1);for(var e=this.debugGroupStack.length-1;e>=0;e--)this.debugGroupStack[e].textureBindCount+=t},r.prototype.debugGroupStatisticsTriangles=function(t){for(var e=this.debugGroupStack.length-1;e>=0;e--)this.debugGroupStack[e].triangleCount+=t},r.prototype.reportShaderError=function(t,e){var i=this.gl,n=i.getShaderParameter(t,i.COMPILE_STATUS);if(!n){console.error(prt(e));var a=i.getExtension("WEBGL_debug_shaders");a&&console.error(a.getTranslatedShaderSource(t)),console.error(i.getShaderInfoLog(t))}return n},r.prototype.checkProgramCompilationForErrors=function(t){var e=this.gl,i=t.gl_program;if(!e.getProgramParameter(i,e.LINK_STATUS)){var n=t.descriptor;if(!this.reportShaderError(t.gl_shader_vert,n.vertex.glsl)||!this.reportShaderError(t.gl_shader_frag,n.fragment.glsl))return;console.error(e.getProgramInfoLog(t.gl_program))}},r.prototype.bindFramebufferAttachment=function(t,e,i,n){var a=this.gl;if(qn(i))a.framebufferRenderbuffer(t,e,a.RENDERBUFFER,null);else if(i.type===oe.RenderTarget)i.gl_renderbuffer!==null?a.framebufferRenderbuffer(t,e,a.RENDERBUFFER,i.gl_renderbuffer):i.texture!==null&&a.framebufferTexture2D(t,e,B.TEXTURE_2D,hc(i.texture),n);else if(i.type===oe.Texture){var o=hc(i);i.dimension===Zt.TEXTURE_2D?a.framebufferTexture2D(t,e,B.TEXTURE_2D,o,n):_t(a)&&(i.dimension,Zt.TEXTURE_2D_ARRAY)}},r.prototype.bindFramebufferDepthStencilAttachment=function(t,e){var i=this.gl,n=qn(e)?lt.Depth|lt.Stencil:Jc(e.format),a=!!(n&lt.Depth),o=!!(n&lt.Stencil);if(a&&o){var s=_t(this.gl)||!_t(this.gl)&&!!this.WEBGL_depth_texture;s?this.bindFramebufferAttachment(t,i.DEPTH_STENCIL_ATTACHMENT,e,0):this.bindFramebufferAttachment(t,i.DEPTH_ATTACHMENT,e,0)}else a?(this.bindFramebufferAttachment(t,i.DEPTH_ATTACHMENT,e,0),this.bindFramebufferAttachment(t,i.STENCIL_ATTACHMENT,null,0)):o&&(this.bindFramebufferAttachment(t,i.STENCIL_ATTACHMENT,e,0),this.bindFramebufferAttachment(t,i.DEPTH_ATTACHMENT,null,0))},r.prototype.validateCurrentAttachments=function(){for(var t=-1,e=-1,i=-1,n=0;n<this.currentColorAttachments.length;n++){var a=this.currentColorAttachments[n];a!==null&&(t===-1?(t=a.sampleCount,e=a.width,i=a.height):(Dt(t===a.sampleCount),Dt(e===a.width),Dt(i===a.height)))}this.currentDepthStencilAttachment&&(t===-1?t=this.currentDepthStencilAttachment.sampleCount:(Dt(t===this.currentDepthStencilAttachment.sampleCount),Dt(e===this.currentDepthStencilAttachment.width),Dt(i===this.currentDepthStencilAttachment.height))),this.currentSampleCount=t},r.prototype.setRenderPassParametersBegin=function(t,e){e===void 0&&(e=!1);var i=this.gl;if(e)i.bindFramebuffer(B.FRAMEBUFFER,null);else if(_t(i)?i.bindFramebuffer(B.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):this.inBlitRenderPass||i.bindFramebuffer(B.FRAMEBUFFER,this.renderPassDrawFramebuffer),_t(i)?i.drawBuffers([B.COLOR_ATTACHMENT0,B.COLOR_ATTACHMENT1,B.COLOR_ATTACHMENT2,B.COLOR_ATTACHMENT3]):!this.inBlitRenderPass&&this.WEBGL_draw_buffers&&this.WEBGL_draw_buffers.drawBuffersWEBGL([B.COLOR_ATTACHMENT0_WEBGL,B.COLOR_ATTACHMENT1_WEBGL,B.COLOR_ATTACHMENT2_WEBGL,B.COLOR_ATTACHMENT3_WEBGL]),!this.inBlitRenderPass)for(var n=t;n<this.currentColorAttachments.length;n++){var a=_t(i)?B.DRAW_FRAMEBUFFER:B.FRAMEBUFFER,o=_t(i)?B.COLOR_ATTACHMENT0:B.COLOR_ATTACHMENT0_WEBGL;i.framebufferRenderbuffer(a,o+n,B.RENDERBUFFER,null),i.framebufferTexture2D(a,o+n,B.TEXTURE_2D,null,0)}this.currentColorAttachments.length=t},r.prototype.setRenderPassParametersColor=function(t,e,i,n,a,o){o===void 0&&(o=!1);var s=this.gl,l=_t(s);(this.currentColorAttachments[t]!==e||this.currentColorAttachmentLevels[t]!==i)&&(this.currentColorAttachments[t]=e,this.currentColorAttachmentLevels[t]=i,!o&&(l||!l&&this.WEBGL_draw_buffers)&&this.bindFramebufferAttachment(l?B.DRAW_FRAMEBUFFER:B.FRAMEBUFFER,(l?B.COLOR_ATTACHMENT0:B.COLOR_ATTACHMENT0_WEBGL)+t,e,i),this.resolveColorAttachmentsChanged=!0),(this.currentColorResolveTos[t]!==n||this.currentColorResolveToLevels[t]!==a)&&(this.currentColorResolveTos[t]=n,this.currentColorResolveToLevels[t]=a,n!==null&&(this.resolveColorAttachmentsChanged=!0))},r.prototype.setRenderPassParametersDepthStencil=function(t,e,i){i===void 0&&(i=!1);var n=this.gl;this.currentDepthStencilAttachment!==t&&(this.currentDepthStencilAttachment=t,!i&&!this.inBlitRenderPass&&this.bindFramebufferDepthStencilAttachment(_t(n)?B.DRAW_FRAMEBUFFER:B.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==e&&(this.currentDepthStencilResolveTo=e,e&&(this.resolveDepthStencilAttachmentsChanged=!0))},r.prototype.setRenderPassParametersClearColor=function(t,e,i,n,a){var o=this.gl;if(this.OES_draw_buffers_indexed!==null){var s=this.currentMegaState.attachmentsState[t];s&&s.channelWriteMask!==Er.ALL&&(this.OES_draw_buffers_indexed.colorMaskiOES(t,!0,!0,!0,!0),s.channelWriteMask=Er.ALL)}else{var s=this.currentMegaState.attachmentsState[0];s&&s.channelWriteMask!==Er.ALL&&(o.colorMask(!0,!0,!0,!0),s.channelWriteMask=Er.ALL)}this.setScissorRectEnabled(!1),_t(o)?o.clearBufferfv(o.COLOR,t,[e,i,n,a]):(o.clearColor(e,i,n,a),o.clear(o.COLOR_BUFFER_BIT))},r.prototype.setRenderPassParametersClearDepthStencil=function(t,e){t===void 0&&(t="load"),e===void 0&&(e="load");var i=this.gl;t!=="load"&&(Dt(!!this.currentDepthStencilAttachment),this.currentMegaState.depthWrite||(i.depthMask(!0),this.currentMegaState.depthWrite=!0),_t(i)?i.clearBufferfv(i.DEPTH,0,[t]):(i.clearDepth(t),i.clear(i.DEPTH_BUFFER_BIT))),e!=="load"&&(Dt(!!this.currentDepthStencilAttachment),this.currentMegaState.stencilWrite||(i.enable(i.STENCIL_TEST),i.stencilMask(255),this.currentMegaState.stencilWrite=!0),_t(i)?i.clearBufferiv(i.STENCIL,0,[e]):(i.clearStencil(e),i.clear(i.STENCIL_BUFFER_BIT)))},r.prototype.setBindings=function(t){var e=this,i;if(this.renderBundle){this.renderBundle.push(function(){return e.setBindings(t)});return}var n=this.gl,a=t,o=a.uniformBufferBindings,s=a.samplerBindings,l=a.bindingLayouts;Dt(0<l.bindingLayoutTables.length);var u=l.bindingLayoutTables[0];Dt(o.length>=u.numUniformBuffers),Dt(s.length>=u.numSamplers);for(var c=0;c<o.length;c++){var h=o[c];if(h.size!==0){var f=u.firstUniformBuffer+c,d=h.buffer,v=h.offset||0,p=h.size||d.byteSize;if(d!==this.currentUniformBuffers[f]||v!==this.currentUniformBufferByteOffsets[f]||p!==this.currentUniformBufferByteSizes[f]){var g=v%d.pageByteSize,m=d.gl_buffer_pages[v/d.pageByteSize|0];Dt(g+p<=d.pageByteSize),_t(n)&&n.bindBufferRange(n.UNIFORM_BUFFER,f,m,g,p),this.currentUniformBuffers[f]=d,this.currentUniformBufferByteOffsets[f]=v,this.currentUniformBufferByteSizes[f]=p}}}for(var c=0;c<u.numSamplers;c++){var h=s[c],y=u.firstSampler+c,_=h!==null&&h.sampler!==null?Tx(h.sampler):null,x=h!==null&&h.texture!==null?hc(h.texture):null;if(this.currentSamplers[y]!==_&&(_t(n)&&n.bindSampler(y,_),this.currentSamplers[y]=_),this.currentTextures[y]!==x){if(this.setActiveTexture(n.TEXTURE0+y),x!==null){var C=Hl(h).texture,A=C.gl_target,b=C.width,R=C.height;h.texture.textureIndex=y,n.bindTexture(A,x),_t(n)||(i=h.sampler)===null||i===void 0||i.setTextureParameters(A,b,R),this.debugGroupStatisticsTextureBind()}else{var M=S(S({},h),HD),O=M.dimension,F=M.formatKind,A=tit(O);n.bindTexture(A,this.getFallbackTexture(S({gl_target:A,formatKind:F},M)))}this.currentTextures[y]=x}}},r.prototype.setViewport=function(t,e,i,n){var a=this.gl;a.viewport(t,e,i,n)},r.prototype.setScissorRect=function(t,e,i,n){var a=this.gl;this.setScissorRectEnabled(!0),a.scissor(t,e,i,n)},r.prototype.applyAttachmentStateIndexed=function(t,e,i){var n=this.gl,a=this.OES_draw_buffers_indexed;e.channelWriteMask!==i.channelWriteMask&&(a.colorMaskiOES(t,!!(i.channelWriteMask&Er.RED),!!(i.channelWriteMask&Er.GREEN),!!(i.channelWriteMask&Er.BLUE),!!(i.channelWriteMask&Er.ALPHA)),e.channelWriteMask=i.channelWriteMask);var o=e.rgbBlendState.blendMode!==i.rgbBlendState.blendMode||e.alphaBlendState.blendMode!==i.alphaBlendState.blendMode,s=e.rgbBlendState.blendSrcFactor!==i.rgbBlendState.blendSrcFactor||e.alphaBlendState.blendSrcFactor!==i.alphaBlendState.blendSrcFactor||e.rgbBlendState.blendDstFactor!==i.rgbBlendState.blendDstFactor||e.alphaBlendState.blendDstFactor!==i.alphaBlendState.blendDstFactor;(s||o)&&(Ss(e.rgbBlendState)&&Ss(e.alphaBlendState)?a.enableiOES(t,n.BLEND):Ss(i.rgbBlendState)&&Ss(i.alphaBlendState)&&a.disableiOES(t,n.BLEND)),o&&(a.blendEquationSeparateiOES(t,i.rgbBlendState.blendMode,i.alphaBlendState.blendMode),e.rgbBlendState.blendMode=i.rgbBlendState.blendMode,e.alphaBlendState.blendMode=i.alphaBlendState.blendMode),s&&(a.blendFuncSeparateiOES(t,i.rgbBlendState.blendSrcFactor,i.rgbBlendState.blendDstFactor,i.alphaBlendState.blendSrcFactor,i.alphaBlendState.blendDstFactor),e.rgbBlendState.blendSrcFactor=i.rgbBlendState.blendSrcFactor,e.alphaBlendState.blendSrcFactor=i.alphaBlendState.blendSrcFactor,e.rgbBlendState.blendDstFactor=i.rgbBlendState.blendDstFactor,e.alphaBlendState.blendDstFactor=i.alphaBlendState.blendDstFactor)},r.prototype.applyAttachmentState=function(t,e){var i=this.gl;t.channelWriteMask!==e.channelWriteMask&&(i.colorMask(!!(e.channelWriteMask&Er.RED),!!(e.channelWriteMask&Er.GREEN),!!(e.channelWriteMask&Er.BLUE),!!(e.channelWriteMask&Er.ALPHA)),t.channelWriteMask=e.channelWriteMask);var n=t.rgbBlendState.blendMode!==e.rgbBlendState.blendMode||t.alphaBlendState.blendMode!==e.alphaBlendState.blendMode,a=t.rgbBlendState.blendSrcFactor!==e.rgbBlendState.blendSrcFactor||t.alphaBlendState.blendSrcFactor!==e.alphaBlendState.blendSrcFactor||t.rgbBlendState.blendDstFactor!==e.rgbBlendState.blendDstFactor||t.alphaBlendState.blendDstFactor!==e.alphaBlendState.blendDstFactor;(a||n)&&(Ss(t.rgbBlendState)&&Ss(t.alphaBlendState)?i.enable(i.BLEND):Ss(e.rgbBlendState)&&Ss(e.alphaBlendState)&&i.disable(i.BLEND)),n&&(i.blendEquationSeparate(e.rgbBlendState.blendMode,e.alphaBlendState.blendMode),t.rgbBlendState.blendMode=e.rgbBlendState.blendMode,t.alphaBlendState.blendMode=e.alphaBlendState.blendMode),a&&(i.blendFuncSeparate(e.rgbBlendState.blendSrcFactor,e.rgbBlendState.blendDstFactor,e.alphaBlendState.blendSrcFactor,e.alphaBlendState.blendDstFactor),t.rgbBlendState.blendSrcFactor=e.rgbBlendState.blendSrcFactor,t.alphaBlendState.blendSrcFactor=e.alphaBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor=e.rgbBlendState.blendDstFactor,t.alphaBlendState.blendDstFactor=e.alphaBlendState.blendDstFactor)},r.prototype.setMegaState=function(t){var e=this.gl,i=this.currentMegaState;if(this.OES_draw_buffers_indexed!==null)for(var n=0;n<t.attachmentsState.length;n++)this.applyAttachmentStateIndexed(n,i.attachmentsState[0],t.attachmentsState[0]);else Dt(t.attachmentsState.length===1),this.applyAttachmentState(i.attachmentsState[0],t.attachmentsState[0]);DD(i.blendConstant,t.blendConstant)||(e.blendColor(t.blendConstant.r,t.blendConstant.g,t.blendConstant.b,t.blendConstant.a),ND(i.blendConstant,t.blendConstant)),i.depthCompare!==t.depthCompare&&(e.depthFunc(t.depthCompare),i.depthCompare=t.depthCompare),!!i.depthWrite!=!!t.depthWrite&&(e.depthMask(t.depthWrite),i.depthWrite=t.depthWrite),!!i.stencilWrite!=!!t.stencilWrite&&(e.stencilMask(t.stencilWrite?255:0),i.stencilWrite=t.stencilWrite);var a=!1;if(!F0(i.stencilFront,t.stencilFront)){a=!0;var o=t.stencilFront,s=o.passOp,l=o.failOp,u=o.depthFailOp,c=o.compare;(i.stencilFront.passOp!==s||i.stencilFront.failOp!==l||i.stencilFront.depthFailOp!==u)&&(e.stencilOpSeparate(e.FRONT,l,u,s),i.stencilFront.passOp=s,i.stencilFront.failOp=l,i.stencilFront.depthFailOp=u),i.stencilFront.compare!==c&&(this.setStencilReference(0),i.stencilFront.compare=c)}if(!F0(i.stencilBack,t.stencilBack)){a=!0;var h=t.stencilBack,s=h.passOp,l=h.failOp,u=h.depthFailOp,c=h.compare;(i.stencilBack.passOp!==s||i.stencilBack.failOp!==l||i.stencilBack.depthFailOp!==u)&&(e.stencilOpSeparate(e.BACK,l,u,s),i.stencilBack.passOp=s,i.stencilBack.failOp=l,i.stencilBack.depthFailOp=u),i.stencilBack.compare!==c&&(this.setStencilReference(0),i.stencilBack.compare=c)}(i.stencilFront.mask!==t.stencilFront.mask||i.stencilBack.mask!==t.stencilBack.mask)&&(a=!0,i.stencilFront.mask=t.stencilFront.mask,i.stencilBack.mask=t.stencilBack.mask),a&&this.applyStencil(),i.cullMode!==t.cullMode&&(i.cullMode===Gi.NONE?e.enable(e.CULL_FACE):t.cullMode===Gi.NONE&&e.disable(e.CULL_FACE),t.cullMode===Gi.BACK?e.cullFace(e.BACK):t.cullMode===Gi.FRONT?e.cullFace(e.FRONT):t.cullMode===Gi.FRONT_AND_BACK&&e.cullFace(e.FRONT_AND_BACK),i.cullMode=t.cullMode),i.frontFace!==t.frontFace&&(e.frontFace(t.frontFace),i.frontFace=t.frontFace),i.polygonOffset!==t.polygonOffset&&(t.polygonOffset?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),i.polygonOffset=t.polygonOffset),(i.polygonOffsetFactor!==t.polygonOffsetFactor||i.polygonOffsetUnits!==t.polygonOffsetUnits)&&(e.polygonOffset(t.polygonOffsetFactor,t.polygonOffsetUnits),i.polygonOffsetFactor=t.polygonOffsetFactor,i.polygonOffsetUnits=t.polygonOffsetUnits)},r.prototype.validatePipelineFormats=function(t){for(var e=0;e<this.currentColorAttachments.length;e++)var i=this.currentColorAttachments[e];this.currentDepthStencilAttachment&&Dt(this.currentDepthStencilAttachment.format===t.depthStencilAttachmentFormat),this.currentSampleCount!==-1&&Dt(this.currentSampleCount===t.sampleCount)},r.prototype.setPipeline=function(t){var e=this;if(this.renderBundle){this.renderBundle.push(function(){return e.setPipeline(t)});return}this.currentPipeline=t,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var i=this.currentPipeline.program;if(this.useProgram(i),i.compileState===Ui.NeedsBind){var n=this.gl,a=i.gl_program,o=i.descriptor,s=eM(o.vertex.glsl,dit);if(_t(n))for(var l=0;l<s.length;l++){var u=ct(s[l],2),c=u[1],h=n.getUniformBlockIndex(a,c);h!==-1&&h!==4294967295&&n.uniformBlockBinding(a,h,l)}for(var f=eM(o.fragment.glsl,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm),l=0;l<f.length;l++){var d=ct(f[l],3),v=d[1],p=d[2],g=n.getUniformLocation(a,v);n.uniform1i(g,parseInt(p))}i.compileState=Ui.ReadyToUse}},r.prototype.setVertexInput=function(t,e,i){var n,a,o=this,s;if(this.renderBundle){this.renderBundle.push(function(){return o.setVertexInput(t,e,i)});return}if(t!==null){Dt(this.currentPipeline.inputLayout===t);var l=t;this.bindVAO(l.vao);for(var u=this.gl,c=0;c<l.vertexBufferDescriptors.length;c++){var h=l.vertexBufferDescriptors[c],f=h.arrayStride,d=h.attributes;try{for(var v=(n=void 0,Qt(d)),p=v.next();!p.done;p=v.next()){var g=p.value,m=g.shaderLocation,y=g.offset,_=_t(u)?m:(s=l.program.attributes[m])===null||s===void 0?void 0:s.location;if(!qn(_)){var x=e[c];if(x===null)continue;var C=g.vertexFormat;u.bindBuffer(u.ARRAY_BUFFER,Pc(x.buffer));var A=(x.offset||0)+y;u.vertexAttribPointer(_,C.size,C.type,C.normalized,f,A)}}}catch(R){n={error:R}}finally{try{p&&!p.done&&(a=v.return)&&a.call(v)}finally{if(n)throw n.error}}}if(Dt(i!==null==(l.indexBufferFormat!==null)),i!==null){var b=i.buffer;Dt(b.usage===Te.INDEX),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,Pc(b)),this.currentIndexBufferByteOffset=i.offset||0}else this.currentIndexBufferByteOffset=null}else Dt(this.currentPipeline.inputLayout===null),Dt(i===null),this.bindVAO(null),this.currentIndexBufferByteOffset=0},r.prototype.setStencilReference=function(t){this.currentStencilRef!==t&&(this.currentStencilRef=t,this.applyStencil())},r.prototype.draw=function(t,e,i,n){var a,o=this;if(this.renderBundle){this.renderBundle.push(function(){return o.draw(t,e,i,n)});return}var s=this.gl,l=this.currentPipeline;if(e){var u=[l.drawMode,i||0,t,e];_t(s)?s.drawArraysInstanced.apply(s,xt([],ct(u),!1)):(a=this.ANGLE_instanced_arrays).drawArraysInstancedANGLE.apply(a,xt([],ct(u),!1))}else s.drawArrays(l.drawMode,i,t);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(t/3*Math.max(e,1))},r.prototype.drawIndexed=function(t,e,i,n,a){var o,s=this;if(this.renderBundle){this.renderBundle.push(function(){return s.drawIndexed(t,e,i,n,a)});return}var l=this.gl,u=this.currentPipeline,c=Hl(u.inputLayout),h=Hl(this.currentIndexBufferByteOffset)+i*c.indexBufferCompByteSize;if(e){var f=[u.drawMode,t,c.indexBufferType,h,e];_t(l)?l.drawElementsInstanced.apply(l,xt([],ct(f),!1)):(o=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(o,xt([],ct(f),!1))}else l.drawElements(u.drawMode,t,c.indexBufferType,h);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(t/3*Math.max(e,1))},r.prototype.drawIndirect=function(t,e){},r.prototype.drawIndexedIndirect=function(t,e){},r.prototype.beginOcclusionQuery=function(t){var e=this.gl;if(_t(e)){var i=this.currentRenderPassDescriptor.occlusionQueryPool;e.beginQuery(i.gl_query_type,i.gl_query[t])}},r.prototype.endOcclusionQuery=function(){var t=this.gl;if(_t(t)){var e=this.currentRenderPassDescriptor.occlusionQueryPool;t.endQuery(e.gl_query_type)}},r.prototype.pipelineQueryReady=function(t){var e=t;return this.queryProgramReady(e.program)},r.prototype.pipelineForceReady=function(t){},r.prototype.endPass=function(){for(var t=this.gl,e=_t(t),i=this.currentColorResolveTos.length===1&&this.currentColorResolveTos[0]===this.scTexture,n=!1,a=0;a<this.currentColorAttachments.length;a++){var o=this.currentColorAttachments[a];if(o!==null){var s=this.currentColorResolveTos[a],l=!1;s!==null&&(Dt(o.width===s.width&&o.height===s.height),this.setScissorRectEnabled(!1),i||(e&&t.bindFramebuffer(t.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&e&&this.bindFramebufferAttachment(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,o,this.currentColorAttachmentLevels[a])),l=!0,i||(s===this.scTexture?t.bindFramebuffer(e?B.DRAW_FRAMEBUFFER:B.FRAMEBUFFER,this.scPlatformFramebuffer):(t.bindFramebuffer(e?B.DRAW_FRAMEBUFFER:B.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&t.framebufferTexture2D(e?B.DRAW_FRAMEBUFFER:B.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s.gl_texture,this.currentColorResolveToLevels[a]))),i||(e?(t.blitFramebuffer(0,0,o.width,o.height,0,0,s.width,s.height,t.COLOR_BUFFER_BIT,t.LINEAR),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null)):this.submitBlitRenderPass(o,s)),n=!0),this.currentRenderPassDescriptor.colorStore[a]||!i&&!l&&(t.bindFramebuffer(e?B.READ_FRAMEBUFFER:B.FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&this.bindFramebufferAttachment(e?B.READ_FRAMEBUFFER:B.FRAMEBUFFER,t.COLOR_ATTACHMENT0,o,this.currentColorAttachmentLevels[a])),i||t.bindFramebuffer(e?B.READ_FRAMEBUFFER:B.FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var u=this.currentDepthStencilAttachment;if(u){var c=this.currentDepthStencilResolveTo,l=!1;c&&(Dt(u.width===c.width&&u.height===c.height),this.setScissorRectEnabled(!1),i||(t.bindFramebuffer(e?B.READ_FRAMEBUFFER:B.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),t.bindFramebuffer(e?B.DRAW_FRAMEBUFFER:B.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(e?B.READ_FRAMEBUFFER:B.FRAMEBUFFER,u),this.bindFramebufferDepthStencilAttachment(e?B.DRAW_FRAMEBUFFER:B.FRAMEBUFFER,c))),l=!0,i||(e&&t.blitFramebuffer(0,0,u.width,u.height,0,0,c.width,c.height,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(e?B.DRAW_FRAMEBUFFER:B.FRAMEBUFFER,null)),n=!0),!i&&!this.currentRenderPassDescriptor.depthStencilStore&&(l||(t.bindFramebuffer(e?B.READ_FRAMEBUFFER:B.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),this.resolveDepthStencilAttachmentsChanged&&this.bindFramebufferDepthStencilAttachment(e?B.READ_FRAMEBUFFER:B.FRAMEBUFFER,u),l=!0),e&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[t.DEPTH_STENCIL_ATTACHMENT])),!i&&l&&t.bindFramebuffer(e?B.READ_FRAMEBUFFER:B.FRAMEBUFFER,null),this.resolveDepthStencilAttachmentsChanged=!1}!i&&!n&&t.bindFramebuffer(e?B.DRAW_FRAMEBUFFER:B.FRAMEBUFFER,null)},r.prototype.setScissorRectEnabled=function(t){if(this.currentScissorEnabled!==t){var e=this.gl;t?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),this.currentScissorEnabled=t}},r.prototype.applyStencil=function(){qn(this.currentStencilRef)||(this.gl.stencilFuncSeparate(B.FRONT,this.currentMegaState.stencilFront.compare,this.currentStencilRef,this.currentMegaState.stencilFront.mask||255),this.gl.stencilFuncSeparate(B.BACK,this.currentMegaState.stencilBack.compare,this.currentStencilRef,this.currentMegaState.stencilBack.mask||255))},r.prototype.getFallbackTexture=function(t){var e=t.gl_target,i=t.formatKind;if(e===B.TEXTURE_2D)return i===je.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(e===B.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(e===B.TEXTURE_3D)return this.fallbackTexture3D;if(e===B.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},r.prototype.submitBlitRenderPass=function(t,e){this.blitRenderPipeline||(this.blitProgram=this.createProgram({vertex:{glsl:`layout(location = 0) in vec2 a_Position;
out vec2 v_TexCoord;
void main() {
  v_TexCoord = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);

  #ifdef VIEWPORT_ORIGIN_TL
    v_TexCoord.y = 1.0 - v_TexCoord.y;
  #endif
}`},fragment:{glsl:`uniform sampler2D u_Texture;
in vec2 v_TexCoord;
out vec4 outputColor;
void main() {
  outputColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);
}`}}),this.blitVertexBuffer=this.createBuffer({usage:Te.VERTEX|Te.COPY_DST,viewOrSize:new Float32Array([-4,-4,4,-4,0,4])}),this.blitInputLayout=this.createInputLayout({vertexBufferDescriptors:[{arrayStride:4*2,stepMode:vu.VERTEX,attributes:[{format:z.F32_RG,offset:4*0,shaderLocation:0}]}],indexBufferFormat:null,program:this.blitProgram}),this.blitRenderPipeline=this.createRenderPipeline({topology:sr.TRIANGLES,sampleCount:1,program:this.blitProgram,colorAttachmentFormats:[z.U8_RGBA_RT],depthStencilAttachmentFormat:null,inputLayout:this.blitInputLayout,megaStateDescriptor:th(eh)}),this.blitBindings=this.createBindings({samplerBindings:[{sampler:null,texture:t.texture}],uniformBufferBindings:[]}),this.blitProgram.setUniformsLegacy({u_Texture:t}));var i=this.currentRenderPassDescriptor;this.currentRenderPassDescriptor=null,this.inBlitRenderPass=!0;var n=this.createRenderPass({colorAttachment:[t],colorResolveTo:[e],colorClearColor:[frt]}),a=this.getCanvas(),o=a.width,s=a.height;n.setPipeline(this.blitRenderPipeline),n.setBindings(this.blitBindings),n.setVertexInput(this.blitInputLayout,[{buffer:this.blitVertexBuffer}],null),n.setViewport(0,0,o,s),this.gl.disable(this.gl.BLEND),n.draw(3,0),this.gl.enable(this.gl.BLEND),this.currentRenderPassDescriptor=i,this.inBlitRenderPass=!1},r}(),pit=function(){function r(t){this.pluginOptions=t}return r.prototype.createSwapChain=function(t){return Ti(this,void 0,void 0,function(){var e,i,n,a,o,s,l,u,c,h,f,d,v;return ba(this,function(p){return e=this.pluginOptions,i=e.targets,n=e.xrCompatible,a=e.antialias,o=a===void 0?!1:a,s=e.preserveDrawingBuffer,l=s===void 0?!1:s,u=e.premultipliedAlpha,c=u===void 0?!0:u,h=e.shaderDebug,f=e.trackResources,d={antialias:o,preserveDrawingBuffer:l,stencil:!0,premultipliedAlpha:c,xrCompatible:n},this.handleContextEvents(t),i.includes("webgl2")&&(v=t.getContext("webgl2",d)||t.getContext("experimental-webgl2",d)),!v&&i.includes("webgl1")&&(v=t.getContext("webgl",d)||t.getContext("experimental-webgl",d)),[2,new vit(v,{shaderDebug:h,trackResources:f})]})})},r.prototype.handleContextEvents=function(t){var e=this.pluginOptions,i=e.onContextLost,n=e.onContextRestored,a=e.onContextCreationError;a&&t.addEventListener("webglcontextcreationerror",a,!1),i&&t.addEventListener("webglcontextlost",i,!1),n&&t.addEventListener("webglcontextrestored",n,!1)},r}();let Ye;const GD=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&GD.decode();let Ff=null;function Vg(){return(Ff===null||Ff.byteLength===0)&&(Ff=new Uint8Array(Ye.memory.buffer)),Ff}function B0(r,t){return r=r>>>0,GD.decode(Vg().subarray(r,r+t))}const Wo=new Array(128).fill(void 0);Wo.push(void 0,null,!0,!1);let qf=Wo.length;function git(r){qf===Wo.length&&Wo.push(Wo.length+1);const t=qf;return qf=Wo[t],Wo[t]=r,t}function Gg(r){return Wo[r]}function mit(r){r<132||(Wo[r]=qf,qf=r)}function yit(r){const t=Gg(r);return mit(r),t}let ih=0;const Xg=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},_it=typeof Xg.encodeInto=="function"?function(r,t){return Xg.encodeInto(r,t)}:function(r,t){const e=Xg.encode(r);return t.set(e),{read:r.length,written:e.length}};function D0(r,t,e){if(e===void 0){const s=Xg.encode(r),l=t(s.length,1)>>>0;return Vg().subarray(l,l+s.length).set(s),ih=s.length,l}let i=r.length,n=t(i,1)>>>0;const a=Vg();let o=0;for(;o<i;o++){const s=r.charCodeAt(o);if(s>127)break;a[n+o]=s}if(o!==i){o!==0&&(r=r.slice(o)),n=e(n,i,i=o+r.length*3,1)>>>0;const s=Vg().subarray(n+o,n+i),l=_it(r,s);o+=l.written}return ih=o,n}let Bf=null;function N0(){return(Bf===null||Bf.byteLength===0)&&(Bf=new Int32Array(Ye.memory.buffer)),Bf}function xit(r,t,e){let i,n;try{const s=Ye.__wbindgen_add_to_stack_pointer(-16),l=D0(r,Ye.__wbindgen_malloc,Ye.__wbindgen_realloc),u=ih,c=D0(t,Ye.__wbindgen_malloc,Ye.__wbindgen_realloc),h=ih;Ye.glsl_compile(s,l,u,c,h,e);var a=N0()[s/4+0],o=N0()[s/4+1];return i=a,n=o,B0(a,o)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(i,n,1)}}class Ad{static __wrap(t){t=t>>>0;const e=Object.create(Ad.prototype);return e.__wbg_ptr=t,e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();Ye.__wbg_wgslcomposer_free(t)}constructor(){const t=Ye.wgslcomposer_new();return Ad.__wrap(t)}load_composable(t){const e=D0(t,Ye.__wbindgen_malloc,Ye.__wbindgen_realloc),i=ih;Ye.wgslcomposer_load_composable(this.__wbg_ptr,e,i)}wgsl_compile(t){let e,i;try{const o=Ye.__wbindgen_add_to_stack_pointer(-16),s=D0(t,Ye.__wbindgen_malloc,Ye.__wbindgen_realloc),l=ih;Ye.wgslcomposer_wgsl_compile(o,this.__wbg_ptr,s,l);var n=N0()[o/4+0],a=N0()[o/4+1];return e=n,i=a,B0(n,a)}finally{Ye.__wbindgen_add_to_stack_pointer(16),Ye.__wbindgen_free(e,i,1)}}}async function Cit(r,t){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,t)}catch(i){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const e=await r.arrayBuffer();return await WebAssembly.instantiate(e,t)}else{const e=await WebAssembly.instantiate(r,t);return e instanceof WebAssembly.Instance?{instance:e,module:r}:e}}function Eit(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(t,e){const i=B0(t,e);return git(i)},r.wbg.__wbindgen_object_drop_ref=function(t){yit(t)},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(t){console.log(Gg(t))},r.wbg.__wbg_log_576ca876af0d4a77=function(t,e){console.log(Gg(t),Gg(e))},r.wbg.__wbindgen_throw=function(t,e){throw new Error(B0(t,e))},r}function Sit(r,t){return Ye=r.exports,XD.__wbindgen_wasm_module=t,Bf=null,Ff=null,Ye}async function XD(r){if(Ye!==void 0)return Ye;const t=Eit();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:e,module:i}=await Cit(await r,t);return Sit(e,i)}var pr;(function(r){r[r.COPY_SRC=1]="COPY_SRC",r[r.COPY_DST=2]="COPY_DST",r[r.TEXTURE_BINDING=4]="TEXTURE_BINDING",r[r.STORAGE_BINDING=8]="STORAGE_BINDING",r[r.STORAGE=8]="STORAGE",r[r.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"})(pr||(pr={}));var Rx;(function(r){r[r.READ=1]="READ",r[r.WRITE=2]="WRITE"})(Rx||(Rx={}));function Ait(r){var t=0;return r&ci.SAMPLED&&(t|=pr.TEXTURE_BINDING|pr.COPY_DST|pr.COPY_SRC),r&ci.STORAGE&&(t|=pr.TEXTURE_BINDING|pr.STORAGE_BINDING|pr.COPY_SRC|pr.COPY_DST),r&ci.RENDER_TARGET&&(t|=pr.RENDER_ATTACHMENT|pr.TEXTURE_BINDING|pr.COPY_SRC|pr.COPY_DST),t}function CS(r){if(r===z.U8_R_NORM)return"r8unorm";if(r===z.S8_R_NORM)return"r8snorm";if(r===z.U8_RG_NORM)return"rg8unorm";if(r===z.S8_RG_NORM)return"rg8snorm";if(r===z.U32_R)return"r32uint";if(r===z.S32_R)return"r32sint";if(r===z.F32_R)return"r32float";if(r===z.U16_RG)return"rg16uint";if(r===z.S16_RG)return"rg16sint";if(r===z.F16_RG)return"rg16float";if(r===z.U8_RGBA_RT)return"bgra8unorm";if(r===z.U8_RGBA_RT_SRGB)return"bgra8unorm-srgb";if(r===z.U8_RGBA_NORM)return"rgba8unorm";if(r===z.U8_RGBA_SRGB)return"rgba8unorm-srgb";if(r===z.S8_RGBA_NORM)return"rgba8snorm";if(r===z.U32_RG)return"rg32uint";if(r===z.S32_RG)return"rg32sint";if(r===z.F32_RG)return"rg32float";if(r===z.U16_RGBA)return"rgba16uint";if(r===z.S16_RGBA)return"rgba16sint";if(r===z.F16_RGBA)return"rgba16float";if(r===z.F32_RGBA)return"rgba32float";if(r===z.U32_RGBA)return"rgba32uint";if(r===z.S32_RGBA)return"rgba32sint";if(r===z.D24)return"depth24plus";if(r===z.D24_S8)return"depth24plus-stencil8";if(r===z.D32F)return"depth32float";if(r===z.D32F_S8)return"depth32float-stencil8";if(r===z.BC1)return"bc1-rgba-unorm";if(r===z.BC1_SRGB)return"bc1-rgba-unorm-srgb";if(r===z.BC2)return"bc2-rgba-unorm";if(r===z.BC2_SRGB)return"bc2-rgba-unorm-srgb";if(r===z.BC3)return"bc3-rgba-unorm";if(r===z.BC3_SRGB)return"bc3-rgba-unorm-srgb";if(r===z.BC4_SNORM)return"bc4-r-snorm";if(r===z.BC4_UNORM)return"bc4-r-unorm";if(r===z.BC5_SNORM)return"bc5-rg-snorm";if(r===z.BC5_UNORM)return"bc5-rg-unorm";throw"whoops"}function Tit(r){if(r===Zt.TEXTURE_2D)return"2d";if(r===Zt.TEXTURE_CUBE_MAP)return"2d";if(r===Zt.TEXTURE_2D_ARRAY)return"2d";if(r===Zt.TEXTURE_3D)return"3d";throw new Error("whoops")}function bit(r){if(r===Zt.TEXTURE_2D)return"2d";if(r===Zt.TEXTURE_CUBE_MAP)return"cube";if(r===Zt.TEXTURE_2D_ARRAY)return"2d-array";if(r===Zt.TEXTURE_3D)return"3d";throw new Error("whoops")}function wit(r){var t=0;return r&Te.INDEX&&(t|=GPUBufferUsage.INDEX),r&Te.VERTEX&&(t|=GPUBufferUsage.VERTEX),r&Te.UNIFORM&&(t|=GPUBufferUsage.UNIFORM),r&Te.STORAGE&&(t|=GPUBufferUsage.STORAGE),r&Te.COPY_SRC&&(t|=GPUBufferUsage.COPY_SRC),r&Te.INDIRECT&&(t|=GPUBufferUsage.INDIRECT),t|=GPUBufferUsage.COPY_DST,t}function k_(r){if(r===bi.CLAMP_TO_EDGE)return"clamp-to-edge";if(r===bi.REPEAT)return"repeat";if(r===bi.MIRRORED_REPEAT)return"mirror-repeat";throw new Error("whoops")}function iM(r){if(r===Ke.BILINEAR)return"linear";if(r===Ke.POINT)return"nearest";throw new Error("whoops")}function Rit(r){if(r===mr.LINEAR)return"linear";if(r===mr.NEAREST)return"nearest";if(r===mr.NO_MIP)return"nearest";throw new Error("whoops")}function xc(r){var t=r;return t.gpuBuffer}function Mit(r){var t=r;return t.gpuSampler}function Iit(r){var t=r;return t.querySet}function Lit(r){if(r===I0.OcclusionConservative)return"occlusion";throw new Error("whoops")}function Oit(r){switch(r){case sr.TRIANGLES:return"triangle-list";case sr.POINTS:return"point-list";case sr.TRIANGLE_STRIP:return"triangle-strip";case sr.LINES:return"line-list";case sr.LINE_STRIP:return"line-strip";default:throw new Error("Unknown primitive topology mode")}}function Pit(r){if(r===Gi.NONE)return"none";if(r===Gi.FRONT)return"front";if(r===Gi.BACK)return"back";throw new Error("whoops")}function Fit(r){if(r===Sd.CCW)return"ccw";if(r===Sd.CW)return"cw";throw new Error("whoops")}function Bit(r,t){return{topology:Oit(r),cullMode:Pit(t.cullMode),frontFace:Fit(t.frontFace)}}function nM(r){if(r===jt.ZERO)return"zero";if(r===jt.ONE)return"one";if(r===jt.SRC)return"src";if(r===jt.ONE_MINUS_SRC)return"one-minus-src";if(r===jt.DST)return"dst";if(r===jt.ONE_MINUS_DST)return"one-minus-dst";if(r===jt.SRC_ALPHA)return"src-alpha";if(r===jt.ONE_MINUS_SRC_ALPHA)return"one-minus-src-alpha";if(r===jt.DST_ALPHA)return"dst-alpha";if(r===jt.ONE_MINUS_DST_ALPHA)return"one-minus-dst-alpha";if(r===jt.CONST)return"constant";if(r===jt.ONE_MINUS_CONSTANT)return"one-minus-constant";if(r===jt.SRC_ALPHA_SATURATE)return"src-alpha-saturated";throw new Error("whoops")}function Dit(r){if(r===br.ADD)return"add";if(r===br.SUBSTRACT)return"subtract";if(r===br.REVERSE_SUBSTRACT)return"reverse-subtract";if(r===br.MIN)return"min";if(r===br.MAX)return"max";throw new Error("whoops")}function aM(r){return{operation:Dit(r.blendMode),srcFactor:nM(r.blendSrcFactor),dstFactor:nM(r.blendDstFactor)}}function oM(r){return r.blendMode===br.ADD&&r.blendSrcFactor===jt.ONE&&r.blendDstFactor===jt.ZERO}function Nit(r){if(!(oM(r.rgbBlendState)&&oM(r.alphaBlendState)))return{color:aM(r.rgbBlendState),alpha:aM(r.alphaBlendState)}}function kit(r,t){return{format:CS(t),blend:Nit(r),writeMask:r.channelWriteMask}}function Uit(r,t){return t.attachmentsState.map(function(e,i){return kit(e,r[i])})}function Yg(r){if(r===ve.NEVER)return"never";if(r===ve.LESS)return"less";if(r===ve.EQUAL)return"equal";if(r===ve.LEQUAL)return"less-equal";if(r===ve.GREATER)return"greater";if(r===ve.NOTEQUAL)return"not-equal";if(r===ve.GEQUAL)return"greater-equal";if(r===ve.ALWAYS)return"always";throw new Error("whoops")}function rc(r){if(r===Ze.KEEP)return"keep";if(r===Ze.REPLACE)return"replace";if(r===Ze.ZERO)return"zero";if(r===Ze.DECREMENT_CLAMP)return"decrement-clamp";if(r===Ze.DECREMENT_WRAP)return"decrement-wrap";if(r===Ze.INCREMENT_CLAMP)return"increment-clamp";if(r===Ze.INCREMENT_WRAP)return"increment-wrap";if(r===Ze.INVERT)return"invert";throw new Error("whoops")}function zit(r,t){if(!qn(r))return{format:CS(r),depthWriteEnabled:!!t.depthWrite,depthCompare:Yg(t.depthCompare),depthBias:t.polygonOffset?t.polygonOffsetUnits:0,depthBiasSlopeScale:t.polygonOffset?t.polygonOffsetFactor:0,stencilFront:{compare:Yg(t.stencilFront.compare),passOp:rc(t.stencilFront.passOp),failOp:rc(t.stencilFront.failOp),depthFailOp:rc(t.stencilFront.depthFailOp)},stencilBack:{compare:Yg(t.stencilBack.compare),passOp:rc(t.stencilBack.passOp),failOp:rc(t.stencilBack.failOp),depthFailOp:rc(t.stencilBack.depthFailOp)},stencilReadMask:4294967295,stencilWriteMask:4294967295}}function Hit(r){if(r!==null){if(r===z.U16_R)return"uint16";if(r===z.U32_R)return"uint32";throw new Error("whoops")}}function $it(r){if(r===vu.VERTEX)return"vertex";if(r===vu.INSTANCE)return"instance";throw new Error("whoops")}function Wit(r){if(r===z.U8_R)return"uint8x2";if(r===z.U8_RG)return"uint8x2";if(r===z.U8_RGB)return"uint8x4";if(r===z.U8_RGBA)return"uint8x4";if(r===z.U8_RG_NORM)return"unorm8x2";if(r===z.U8_RGBA_NORM)return"unorm8x4";if(r===z.S8_RGB_NORM)return"snorm8x4";if(r===z.S8_RGBA_NORM)return"snorm8x4";if(r===z.U16_RG_NORM)return"unorm16x2";if(r===z.U16_RGBA_NORM)return"unorm16x4";if(r===z.S16_RG_NORM)return"snorm16x2";if(r===z.S16_RGBA_NORM)return"snorm16x4";if(r===z.S16_RG)return"uint16x2";if(r===z.F16_RG)return"float16x2";if(r===z.F16_RGBA)return"float16x4";if(r===z.F32_R)return"float32";if(r===z.F32_RG)return"float32x2";if(r===z.F32_RGB)return"float32x3";if(r===z.F32_RGBA)return"float32x4";throw"whoops"}function Vit(r){var t=bo(r);switch(t){case J.BC1:case J.BC2:case J.BC3:case J.BC4_SNORM:case J.BC4_UNORM:case J.BC5_SNORM:case J.BC5_UNORM:return!0;default:return!1}}function Git(r){var t=bo(r);switch(t){case J.BC1:case J.BC2:case J.BC3:case J.BC4_SNORM:case J.BC4_UNORM:case J.BC5_SNORM:case J.BC5_UNORM:return 4;default:return 1}}function sM(r,t,e,i){switch(e===void 0&&(e=!1),r){case z.S8_R:case z.S8_R_NORM:case z.S8_RG_NORM:case z.S8_RGB_NORM:case z.S8_RGBA_NORM:{var n=t instanceof ArrayBuffer?new Int8Array(t):new Int8Array(t);return i&&n.set(new Int8Array(i)),n}case z.U8_R:case z.U8_R_NORM:case z.U8_RG:case z.U8_RG_NORM:case z.U8_RGB:case z.U8_RGB_NORM:case z.U8_RGB_SRGB:case z.U8_RGBA:case z.U8_RGBA_NORM:case z.U8_RGBA_SRGB:{var a=t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t);return i&&a.set(new Uint8Array(i)),a}case z.S16_R:case z.S16_RG:case z.S16_RG_NORM:case z.S16_RGB_NORM:case z.S16_RGBA:case z.S16_RGBA_NORM:{var o=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(e?t/2:t);return i&&o.set(new Int16Array(i)),o}case z.U16_R:case z.U16_RGB:case z.U16_RGBA_5551:case z.U16_RGBA_NORM:case z.U16_RG_NORM:case z.U16_R_NORM:{var s=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(e?t/2:t);return i&&s.set(new Uint16Array(i)),s}case z.S32_R:{var l=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(e?t/4:t);return i&&l.set(new Int32Array(i)),l}case z.U32_R:case z.U32_RG:{var u=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(e?t/4:t);return i&&u.set(new Uint32Array(i)),u}case z.F32_R:case z.F32_RG:case z.F32_RGB:case z.F32_RGBA:{var c=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(e?t/4:t);return i&&c.set(new Float32Array(i)),c}}var h=t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t);return i&&h.set(new Uint8Array(i)),h}function Xit(r){var t=(r&32768)>>15,e=(r&31744)>>10,i=r&1023;return e===0?(t?-1:1)*Math.pow(2,-14)*(i/Math.pow(2,10)):e==31?i?NaN:(t?-1:1)*(1/0):(t?-1:1)*Math.pow(2,e-15)*(1+i/Math.pow(2,10))}function YD(r){switch(r){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2unorm":case"rg11b10ufloat":return{width:1,height:1,length:4};case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw new Error("No fixed size for Stencil8 format!");case"depth16unorm":return{width:1,height:1,length:2};case"depth24plus":throw new Error("No fixed size for Depth24Plus format!");case"depth24plus-stencil8":throw new Error("No fixed size for Depth24PlusStencil8 format!");case"depth32float":return{width:1,height:1,length:4};case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc5-rg-unorm":case"bc5-rg-snorm":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":return{width:4,height:4,length:8};default:return{width:1,height:1,length:4}}}var Ua=function(r){N(t,r);function t(e){var i=e.id,n=e.device,a=r.call(this)||this;return a.id=i,a.device=n,a}return t.prototype.destroy=function(){},t}(OD),Yit=function(r){N(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o,s,l=r.call(this,{id:i,device:n})||this;l.type=oe.Bindings;var u=a.pipeline;Dt(!!u);var c=a.uniformBufferBindings,h=a.storageBufferBindings,f=a.samplerBindings,d=a.storageTextureBindings;l.numUniformBuffers=(c==null?void 0:c.length)||0;var v=[[],[],[],[]],p=0;if(c&&c.length)for(var g=0;g<c.length;g++){var m=a.uniformBufferBindings[g],y=m.binding,_=m.size,x=m.offset,C=m.buffer,A={buffer:xc(C),offset:x??0,size:_};v[0].push({binding:y??p++,resource:A})}if(f&&f.length){p=0;for(var g=0;g<f.length;g++){var b=S(S({},f[g]),HD),y=a.samplerBindings[g],R=y.texture!==null?y.texture:l.device.getFallbackTexture(b);b.dimension=R.dimension,b.formatKind=BD(R.format);var M=R.gpuTextureView;if(v[1].push({binding:(o=y.textureBinding)!==null&&o!==void 0?o:p++,resource:M}),y.samplerBinding!==-1){var O=y.sampler!==null?y.sampler:l.device.getFallbackSampler(b),F=Mit(O);v[1].push({binding:(s=y.samplerBinding)!==null&&s!==void 0?s:p++,resource:F})}}}if(h&&h.length){p=0;for(var g=0;g<h.length;g++){var D=a.storageBufferBindings[g],y=D.binding,_=D.size,x=D.offset,C=D.buffer,A={buffer:xc(C),offset:x??0,size:_};v[2].push({binding:y??p++,resource:A})}}if(d&&d.length){p=0;for(var g=0;g<d.length;g++){var H=a.storageTextureBindings[g],y=H.binding,R=H.texture,M=R.gpuTextureView;v[3].push({binding:y??p++,resource:M})}}var j=v.findLastIndex(function($){return!!$.length});return l.gpuBindGroup=v.map(function($,k){return k<=j&&l.device.device.createBindGroup({layout:u.getBindGroupLayout(k),entries:$})}),l}return t}(Ua),jit=function(r){N(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o=r.call(this,{id:i,device:n})||this;o.type=oe.Buffer;var s=a.usage,l=a.viewOrSize,u=!!(s&Te.MAP_READ);o.usage=wit(s),u&&(o.usage=Te.MAP_READ|Te.COPY_DST);var c=!yc(l);if(o.view=yc(l)?null:l,o.size=yc(l)?O0(l,4):O0(l.byteLength,4),yc(l))o.gpuBuffer=o.device.device.createBuffer({usage:o.usage,size:o.size,mappedAtCreation:u?c:!1});else{o.gpuBuffer=o.device.device.createBuffer({usage:o.usage,size:o.size,mappedAtCreation:!0});var h=l&&l.constructor||Float32Array;new h(o.gpuBuffer.getMappedRange()).set(l),o.gpuBuffer.unmap()}return o}return t.prototype.setSubData=function(e,i,n,a){n===void 0&&(n=0),a===void 0&&(a=0);var o=this.gpuBuffer;a=a||i.byteLength,a=Math.min(a,this.size-e);var s=i.byteOffset+n,l=s+a,u=a+3&-4;if(u!==a){var c=new Uint8Array(i.buffer.slice(s,l));i=new Uint8Array(u),i.set(c),n=0,s=0,l=u,a=u}for(var h=1024*1024*15,f=0;l-(s+f)>h;)this.device.device.queue.writeBuffer(o,e+f,i.buffer,s+f,h),f+=h;this.device.device.queue.writeBuffer(o,e+f,i.buffer,s+f,a-f)},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.gpuBuffer.destroy()},t}(Ua),lM=function(){function r(){this.gpuComputePassEncoder=null}return r.prototype.dispatchWorkgroups=function(t,e,i){this.gpuComputePassEncoder.dispatchWorkgroups(t,e,i)},r.prototype.dispatchWorkgroupsIndirect=function(t,e){this.gpuComputePassEncoder.dispatchWorkgroupsIndirect(t.gpuBuffer,e)},r.prototype.finish=function(){this.gpuComputePassEncoder.end(),this.gpuComputePassEncoder=null,this.frameCommandEncoder=null},r.prototype.beginComputePass=function(t){Dt(this.gpuComputePassEncoder===null),this.frameCommandEncoder=t,this.gpuComputePassEncoder=this.frameCommandEncoder.beginComputePass(this.gpuComputePassDescriptor)},r.prototype.setPipeline=function(t){var e=t,i=Hl(e.gpuComputePipeline);this.gpuComputePassEncoder.setPipeline(i)},r.prototype.setBindings=function(t){var e=this,i=t;i.gpuBindGroup.forEach(function(n,a){n&&e.gpuComputePassEncoder.setBindGroup(a,i.gpuBindGroup[a])})},r.prototype.pushDebugGroup=function(t){this.gpuComputePassEncoder.pushDebugGroup(t)},r.prototype.popDebugGroup=function(){this.gpuComputePassEncoder.popDebugGroup()},r.prototype.insertDebugMarker=function(t){this.gpuComputePassEncoder.insertDebugMarker(t)},r}(),Zit=function(r){N(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o=r.call(this,{id:i,device:n})||this;o.type=oe.ComputePipeline,o.gpuComputePipeline=null,o.descriptor=a;var s=a.program,l=s.computeStage;if(l===null)return o;var u={layout:"auto",compute:S({},l)};return o.gpuComputePipeline=o.device.device.createComputePipeline(u),o.name!==void 0&&(o.gpuComputePipeline.label=o.name),o}return t.prototype.getBindGroupLayout=function(e){return this.gpuComputePipeline.getBindGroupLayout(e)},t}(Ua),qit=function(r){N(t,r);function t(e){var i,n,a,o,s=e.id,l=e.device,u=e.descriptor,c=r.call(this,{id:s,device:l})||this;c.type=oe.InputLayout;var h=[];try{for(var f=Qt(u.vertexBufferDescriptors),d=f.next();!d.done;d=f.next()){var v=d.value,p=v.arrayStride,g=v.stepMode,m=v.attributes;h.push({arrayStride:p,stepMode:$it(g),attributes:[]});try{for(var y=(a=void 0,Qt(m)),_=y.next();!_.done;_=y.next()){var x=_.value,C=x.shaderLocation,A=x.format,b=x.offset;h[h.length-1].attributes.push({shaderLocation:C,format:Wit(A),offset:b})}}catch(R){a={error:R}}finally{try{_&&!_.done&&(o=y.return)&&o.call(y)}finally{if(a)throw a.error}}}}catch(R){i={error:R}}finally{try{d&&!d.done&&(n=f.return)&&n.call(f)}finally{if(i)throw i.error}}return c.indexFormat=Hit(u.indexBufferFormat),c.buffers=h,c}return t}(Ua),uM=function(r){N(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o=r.call(this,{id:i,device:n})||this;return o.type=oe.Program,o.vertexStage=null,o.fragmentStage=null,o.computeStage=null,o.descriptor=a,a.vertex&&(o.vertexStage=o.createShaderStage(a.vertex,"vertex")),a.fragment&&(o.fragmentStage=o.createShaderStage(a.fragment,"fragment")),a.compute&&(o.computeStage=o.createShaderStage(a.compute,"compute")),o}return t.prototype.setUniformsLegacy=function(e){},t.prototype.createShaderStage=function(e,i){var n,a,o=e.glsl,s=e.wgsl,l=e.entryPoint,u=e.postprocess,c=!1,h=s;if(!h)try{h=this.device.glsl_compile(o,i,c)}catch(m){throw console.error(m,o),new Error("whoops")}var f=function(m){if(!h.includes(m))return"continue";h=h.replace("var T_".concat(m,": texture_2d<f32>;"),"var T_".concat(m,": texture_depth_2d;")),h=h.replace(new RegExp("textureSample\\(T_".concat(m,"(.*)\\);$"),"gm"),function(y,_){return"vec4<f32>(textureSample(T_".concat(m).concat(_,"), 0.0, 0.0, 0.0);")})};try{for(var d=Qt(["u_TextureFramebufferDepth"]),v=d.next();!v.done;v=d.next()){var p=v.value;f(p)}}catch(m){n={error:m}}finally{try{v&&!v.done&&(a=d.return)&&a.call(d)}finally{if(n)throw n.error}}u&&(h=u(h));var g=this.device.device.createShaderModule({code:h});return{module:g,entryPoint:l||"main"}},t}(Ua),Kit=function(r){N(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o=r.call(this,{id:i,device:n})||this;o.type=oe.QueryPool;var s=a.elemCount,l=a.type;return o.querySet=o.device.device.createQuerySet({type:Lit(l),count:s}),o.resolveBuffer=o.device.device.createBuffer({size:s*8,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),o.cpuBuffer=o.device.device.createBuffer({size:s*8,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),o.results=null,o}return t.prototype.queryResultOcclusion=function(e){return this.results===null?null:this.results[e]!==BigInt(0)},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.querySet.destroy(),this.resolveBuffer.destroy(),this.cpuBuffer.destroy()},t}(Ua),Qit=function(r){N(t,r);function t(e){var i=e.id,n=e.device,a=r.call(this,{id:i,device:n})||this;return a.type=oe.Readback,a}return t.prototype.readTexture=function(e,i,n,a,o,s,l,u){return l===void 0&&(l=0),Ti(this,void 0,void 0,function(){var c,h,f,d,v,p,g,m;return ba(this,function(y){return c=e,h=0,f=YD(c.gpuTextureformat),d=Math.ceil(a/f.width)*f.length,v=Math.ceil(d/256)*256,p=v*o,g=this.device.createBuffer({usage:Te.STORAGE|Te.MAP_READ|Te.COPY_DST,hint:wa.STATIC,viewOrSize:p}),m=this.device.device.createCommandEncoder(),m.copyTextureToBuffer({texture:c.gpuTexture,mipLevel:0,origin:{x:i,y:n,z:Math.max(h,0)}},{buffer:g.gpuBuffer,offset:0,bytesPerRow:v},{width:a,height:o,depthOrArrayLayers:1}),this.device.device.queue.submit([m.finish()]),[2,this.readBuffer(g,0,s.byteLength===p?s:null,l,p,c.format,!0,!1,d,v,o)]})})},t.prototype.readTextureSync=function(e,i,n,a,o,s,l,u){throw new Error("ERROR_MSG_METHOD_NOT_IMPLEMENTED")},t.prototype.readBuffer=function(e,i,n,a,o,s,l,u,c,h,f){var d=this;i===void 0&&(i=0),n===void 0&&(n=null),o===void 0&&(o=0),s===void 0&&(s=z.U8_RGB),l===void 0&&(l=!1),c===void 0&&(c=0),h===void 0&&(h=0),f===void 0&&(f=0);var v=e,p=o||v.size,g=n||v.view,m=g&&g.constructor&&g.constructor.BYTES_PER_ELEMENT||FD(s),y=v;if(!(v.usage&Te.MAP_READ&&v.usage&Te.COPY_DST)){var _=this.device.device.createCommandEncoder();y=this.device.createBuffer({usage:Te.STORAGE|Te.MAP_READ|Te.COPY_DST,hint:wa.STATIC,viewOrSize:p}),_.copyBufferToBuffer(v.gpuBuffer,i,y.gpuBuffer,0,p),this.device.device.queue.submit([_.finish()])}return new Promise(function(x,C){y.gpuBuffer.mapAsync(Rx.READ,i,p).then(function(){var A=y.gpuBuffer.getMappedRange(i,p),b=g;if(l)b===null?b=sM(s,p,!0,A):b=sM(s,b.buffer,void 0,A);else if(b===null)switch(m){case 1:b=new Uint8Array(p),b.set(new Uint8Array(A));break;case 2:b=d.getHalfFloatAsFloatRGBAArrayBuffer(p/2,A);break;case 4:b=new Float32Array(p/4),b.set(new Float32Array(A));break}else switch(m){case 1:b=new Uint8Array(b.buffer),b.set(new Uint8Array(A));break;case 2:b=d.getHalfFloatAsFloatRGBAArrayBuffer(p/2,A,g);break;case 4:var R=g&&g.constructor||Float32Array;b=new R(b.buffer),b.set(new R(A));break}if(c!==h){m===1&&!l&&(c*=2,h*=2);for(var M=new Uint8Array(b.buffer),O=c,F=0,D=1;D<f;++D){F=D*h;for(var H=0;H<c;++H)M[O++]=M[F++]}m!==0&&!l?b=new Float32Array(M.buffer,0,O/4):b=new Uint8Array(M.buffer,0,O)}y.gpuBuffer.unmap(),x(b)},function(A){return C(A)})})},t.prototype.getHalfFloatAsFloatRGBAArrayBuffer=function(e,i,n){n||(n=new Float32Array(e));for(var a=new Uint16Array(i);e--;)n[e]=Xit(a[e]);return n},t}(Ua),cM=function(){function r(t){this.device=t,this.gpuRenderPassEncoder=null,this.gfxColorAttachment=[],this.gfxColorAttachmentLevel=[],this.gfxColorResolveTo=[],this.gfxColorResolveToLevel=[],this.gfxDepthStencilAttachment=null,this.gfxDepthStencilResolveTo=null,this.gpuColorAttachments=[],this.gpuDepthStencilAttachment={view:null,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"},this.gpuRenderPassDescriptor={colorAttachments:this.gpuColorAttachments,depthStencilAttachment:this.gpuDepthStencilAttachment}}return r.prototype.getEncoder=function(){var t;return((t=this.renderBundle)===null||t===void 0?void 0:t.renderBundleEncoder)||this.gpuRenderPassEncoder},r.prototype.getTextureView=function(t,e){return Dt(e<t.mipLevelCount),t.mipLevelCount===1?t.gpuTextureView:t.gpuTexture.createView({baseMipLevel:e,mipLevelCount:1})},r.prototype.setRenderPassDescriptor=function(t){var e,i,n,a,o,s;this.descriptor=t,this.gpuRenderPassDescriptor.colorAttachments=this.gpuColorAttachments;var l=t.colorAttachment.length;this.gfxColorAttachment.length=l,this.gfxColorResolveTo.length=l;for(var u=0;u<t.colorAttachment.length;u++){var c=t.colorAttachment[u],h=t.colorResolveTo[u];if(c===null&&h!==null&&(c=h,h=null),this.gfxColorAttachment[u]=c,this.gfxColorResolveTo[u]=h,this.gfxColorAttachmentLevel[u]=((e=t.colorAttachmentLevel)===null||e===void 0?void 0:e[u])||0,this.gfxColorResolveToLevel[u]=((i=t.colorResolveToLevel)===null||i===void 0?void 0:i[u])||0,c!==null){this.gpuColorAttachments[u]===void 0&&(this.gpuColorAttachments[u]={});var f=this.gpuColorAttachments[u];f.view=this.getTextureView(c,((n=this.gfxColorAttachmentLevel)===null||n===void 0?void 0:n[u])||0);var d=(o=(a=t.colorClearColor)===null||a===void 0?void 0:a[u])!==null&&o!==void 0?o:"load";d==="load"?f.loadOp="load":(f.loadOp="clear",f.clearValue=d),f.storeOp=!((s=t.colorStore)===null||s===void 0)&&s[u]?"store":"discard",f.resolveTarget=void 0,h!==null&&(c.sampleCount>1?f.resolveTarget=this.getTextureView(h,this.gfxColorResolveToLevel[u]):f.storeOp="store")}else{this.gpuColorAttachments.length=u,this.gfxColorAttachment.length=u,this.gfxColorResolveTo.length=u;break}}if(this.gfxDepthStencilAttachment=t.depthStencilAttachment,this.gfxDepthStencilResolveTo=t.depthStencilResolveTo,t.depthStencilAttachment){var v=t.depthStencilAttachment,f=this.gpuDepthStencilAttachment;f.view=v.gpuTextureView;var p=!!(Jc(v.format)&lt.Depth);p?(t.depthClearValue==="load"?f.depthLoadOp="load":(f.depthLoadOp="clear",f.depthClearValue=t.depthClearValue),t.depthStencilStore||this.gfxDepthStencilResolveTo!==null?f.depthStoreOp="store":f.depthStoreOp="discard"):(f.depthLoadOp=void 0,f.depthStoreOp=void 0);var g=!!(Jc(v.format)&lt.Stencil);g?(t.stencilClearValue==="load"?f.stencilLoadOp="load":(f.stencilLoadOp="clear",f.stencilClearValue=t.stencilClearValue),t.depthStencilStore||this.gfxDepthStencilResolveTo!==null?f.stencilStoreOp="store":f.stencilStoreOp="discard"):(f.stencilLoadOp=void 0,f.stencilStoreOp=void 0),this.gpuRenderPassDescriptor.depthStencilAttachment=this.gpuDepthStencilAttachment}else this.gpuRenderPassDescriptor.depthStencilAttachment=void 0;this.gpuRenderPassDescriptor.occlusionQuerySet=qn(t.occlusionQueryPool)?void 0:Iit(t.occlusionQueryPool)},r.prototype.beginRenderPass=function(t,e){Dt(this.gpuRenderPassEncoder===null),this.setRenderPassDescriptor(e),this.frameCommandEncoder=t,this.gpuRenderPassEncoder=this.frameCommandEncoder.beginRenderPass(this.gpuRenderPassDescriptor)},r.prototype.flipY=function(t,e){var i=this.device.swapChainHeight;return i-t-e},r.prototype.setViewport=function(t,e,i,n,a,o){a===void 0&&(a=0),o===void 0&&(o=1),this.gpuRenderPassEncoder.setViewport(t,this.flipY(e,n),i,n,a,o)},r.prototype.setScissorRect=function(t,e,i,n){this.gpuRenderPassEncoder.setScissorRect(t,this.flipY(e,n),i,n)},r.prototype.setPipeline=function(t){var e=t,i=Hl(e.gpuRenderPipeline);this.getEncoder().setPipeline(i)},r.prototype.setVertexInput=function(t,e,i){if(t!==null){var n=this.getEncoder(),a=t;i!==null&&n.setIndexBuffer(xc(i.buffer),Hl(a.indexFormat),i.offset);for(var o=0;o<e.length;o++){var s=e[o];s!==null&&n.setVertexBuffer(o,xc(s.buffer),s.offset)}}},r.prototype.setBindings=function(t){var e=t,i=this.getEncoder();e.gpuBindGroup.forEach(function(n,a){n&&i.setBindGroup(a,e.gpuBindGroup[a])})},r.prototype.setStencilReference=function(t){this.gpuRenderPassEncoder.setStencilReference(t)},r.prototype.draw=function(t,e,i,n){this.getEncoder().draw(t,e,i,n)},r.prototype.drawIndexed=function(t,e,i,n,a){this.getEncoder().drawIndexed(t,e,i,n,a)},r.prototype.drawIndirect=function(t,e){this.getEncoder().drawIndirect(xc(t),e)},r.prototype.drawIndexedIndirect=function(t,e){this.getEncoder().drawIndexedIndirect(xc(t),e)},r.prototype.beginOcclusionQuery=function(t){this.gpuRenderPassEncoder.beginOcclusionQuery(t)},r.prototype.endOcclusionQuery=function(){this.gpuRenderPassEncoder.endOcclusionQuery()},r.prototype.pushDebugGroup=function(t){this.gpuRenderPassEncoder.pushDebugGroup(t)},r.prototype.popDebugGroup=function(){this.gpuRenderPassEncoder.popDebugGroup()},r.prototype.insertDebugMarker=function(t){this.gpuRenderPassEncoder.insertDebugMarker(t)},r.prototype.beginBundle=function(t){this.renderBundle=t},r.prototype.endBundle=function(){this.renderBundle.finish()},r.prototype.executeBundles=function(t){this.gpuRenderPassEncoder.executeBundles(t.map(function(e){return e.renderBundle}))},r.prototype.finish=function(){var t;(t=this.gpuRenderPassEncoder)===null||t===void 0||t.end(),this.gpuRenderPassEncoder=null;for(var e=0;e<this.gfxColorAttachment.length;e++){var i=this.gfxColorAttachment[e],n=this.gfxColorResolveTo[e];i!==null&&n!==null&&i.sampleCount===1&&this.copyAttachment(n,this.gfxColorAttachmentLevel[e],i,this.gfxColorResolveToLevel[e])}this.gfxDepthStencilAttachment&&this.gfxDepthStencilResolveTo&&(this.gfxDepthStencilAttachment.sampleCount>1||this.copyAttachment(this.gfxDepthStencilResolveTo,0,this.gfxDepthStencilAttachment,0)),this.frameCommandEncoder=null},r.prototype.copyAttachment=function(t,e,i,n){Dt(i.sampleCount===1);var a={texture:i.gpuTexture,mipLevel:n},o={texture:t.gpuTexture,mipLevel:e};Dt(i.width>>>n===t.width>>>e),Dt(i.height>>>n===t.height>>>e),Dt(!!(i.usage&pr.COPY_SRC)),Dt(!!(t.usage&pr.COPY_DST)),this.frameCommandEncoder.copyTextureToTexture(a,o,[t.width,t.height,1])},r}(),Jit=function(r){N(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o=r.call(this,{id:i,device:n})||this;return o.type=oe.RenderPipeline,o.isCreatingAsync=!1,o.gpuRenderPipeline=null,o.descriptor=a,o.device.createRenderPipelineInternal(o,!1),o}return t.prototype.getBindGroupLayout=function(e){return this.gpuRenderPipeline.getBindGroupLayout(e)},t}(Ua),tnt=function(r){N(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o,s,l=r.call(this,{id:i,device:n})||this;l.type=oe.Sampler;var u=a.lodMinClamp,c=a.mipmapFilter===mr.NO_MIP?a.lodMinClamp:a.lodMaxClamp,h=(o=a.maxAnisotropy)!==null&&o!==void 0?o:1;return h>1&&Dt(a.minFilter===Ke.BILINEAR&&a.magFilter===Ke.BILINEAR&&a.mipmapFilter===mr.LINEAR),l.gpuSampler=l.device.device.createSampler({addressModeU:k_(a.addressModeU),addressModeV:k_(a.addressModeV),addressModeW:k_((s=a.addressModeW)!==null&&s!==void 0?s:a.addressModeU),lodMinClamp:u,lodMaxClamp:c,minFilter:iM(a.minFilter),magFilter:iM(a.magFilter),mipmapFilter:Rit(a.mipmapFilter),compare:a.compareFunction!==void 0?Yg(a.compareFunction):void 0,maxAnisotropy:h}),l}return t}(Ua),Bp=function(r){N(t,r);function t(e){var i=e.id,n=e.device,a=e.descriptor,o=e.skipCreate,s=e.sampleCount,l=r.call(this,{id:i,device:n})||this;l.type=oe.Texture,l.flipY=!1;var u=a.format,c=a.dimension,h=a.width,f=a.height,d=a.depthOrArrayLayers,v=a.mipLevelCount,p=a.usage,g=a.pixelStore;return l.flipY=!!(g!=null&&g.unpackFlipY),l.device.createTextureShared({format:u,dimension:c??Zt.TEXTURE_2D,width:h,height:f,depthOrArrayLayers:d??1,mipLevelCount:v??1,usage:p,sampleCount:s??1},l,o),l}return t.prototype.textureFromImageBitmapOrCanvas=function(e,i,n){for(var a=i[0].width,o=i[0].height,s={size:{width:a,height:o,depthOrArrayLayers:n},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT},l=e.createTexture(s),u=0;u<i.length;u++)e.queue.copyExternalImageToTexture({source:i[u],flipY:this.flipY},{texture:l,origin:[0,0,u]},[a,o]);return[l,a,o]},t.prototype.isImageBitmapOrCanvases=function(e){var i=e[0];return i instanceof ImageBitmap||i instanceof HTMLCanvasElement||i instanceof OffscreenCanvas},t.prototype.isVideo=function(e){var i=e[0];return i instanceof HTMLVideoElement},t.prototype.setImageData=function(e,i){var n,a=this,o=this.device.device,s,l,u;if(this.isImageBitmapOrCanvases(e))n=ct(this.textureFromImageBitmapOrCanvas(o,e,this.depthOrArrayLayers),3),s=n[0],l=n[1],u=n[2];else if(this.isVideo(e))s=o.importExternalTexture({source:e[0]});else{var c=YD(this.gpuTextureformat),h=Math.ceil(this.width/c.width)*c.length;e.forEach(function(f){o.queue.writeTexture({texture:a.gpuTexture},f,{bytesPerRow:h},{width:a.width,height:a.height})})}this.width=l,this.height=u,s&&(this.gpuTexture=s),this.gpuTextureView=this.gpuTexture.createView({dimension:bit(this.dimension)})},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.gpuTexture.destroy()},t}(Ua),ent=function(r){N(t,r);function t(e){var i=e.id,n=e.device,a=r.call(this,{id:i,device:n})||this;return a.type=oe.RenderBundle,a.renderBundleEncoder=a.device.device.createRenderBundleEncoder({colorFormats:[a.device.swapChainFormat]}),a}return t.prototype.finish=function(){this.renderBundle=this.renderBundleEncoder.finish()},t}(Ua),rnt=function(){function r(t,e,i,n,a,o){this.swapChainWidth=0,this.swapChainHeight=0,this.swapChainTextureUsage=pr.RENDER_ATTACHMENT|pr.COPY_DST,this._resourceUniqueId=0,this.renderPassPool=[],this.computePassPool=[],this.frameCommandEncoderPool=[],this.featureTextureCompressionBC=!1,this.platformString="WebGPU",this.glslVersion="#version 440",this.explicitBindingLocations=!0,this.separateSamplerTextures=!0,this.viewportOrigin=Sa.UPPER_LEFT,this.clipSpaceNearZ=Qc.ZERO,this.supportsSyncPipelineCompilation=!1,this.supportMRT=!0,this.device=e,this.canvas=i,this.canvasContext=n,this.glsl_compile=a,this.WGSLComposer=o,this.fallbackTexture2D=this.createFallbackTexture(Zt.TEXTURE_2D,je.Float),this.setResourceName(this.fallbackTexture2D,"Fallback Texture2D"),this.fallbackTexture2DDepth=this.createFallbackTexture(Zt.TEXTURE_2D,je.Depth),this.setResourceName(this.fallbackTexture2DDepth,"Fallback Depth Texture2D"),this.fallbackTexture2DArray=this.createFallbackTexture(Zt.TEXTURE_2D_ARRAY,je.Float),this.setResourceName(this.fallbackTexture2DArray,"Fallback Texture2DArray"),this.fallbackTexture3D=this.createFallbackTexture(Zt.TEXTURE_3D,je.Float),this.setResourceName(this.fallbackTexture3D,"Fallback Texture3D"),this.fallbackTextureCube=this.createFallbackTexture(Zt.TEXTURE_CUBE_MAP,je.Float),this.setResourceName(this.fallbackTextureCube,"Fallback TextureCube"),this.fallbackSamplerFiltering=this.createSampler({addressModeU:bi.REPEAT,addressModeV:bi.REPEAT,minFilter:Ke.POINT,magFilter:Ke.POINT,mipmapFilter:mr.NEAREST}),this.setResourceName(this.fallbackSamplerFiltering,"Fallback Sampler Filtering"),this.fallbackSamplerComparison=this.createSampler({addressModeU:bi.REPEAT,addressModeV:bi.REPEAT,minFilter:Ke.POINT,magFilter:Ke.POINT,mipmapFilter:mr.NEAREST,compareFunction:ve.ALWAYS}),this.setResourceName(this.fallbackSamplerComparison,"Fallback Sampler Comparison Filtering"),this.device.features&&(this.featureTextureCompressionBC=this.device.features.has("texture-compression-bc")),this.device.onuncapturederror=function(s){console.error(s.error)},this.swapChainFormat=navigator.gpu.getPreferredCanvasFormat(),this.canvasContext.configure({device:this.device,format:this.swapChainFormat,usage:this.swapChainTextureUsage,alphaMode:"premultiplied"})}return r.prototype.destroy=function(){},r.prototype.configureSwapChain=function(t,e){this.swapChainWidth===t&&this.swapChainHeight===e||(this.swapChainWidth=t,this.swapChainHeight=e)},r.prototype.getOnscreenTexture=function(){var t=this.canvasContext.getCurrentTexture(),e=t.createView(),i=new Bp({id:0,device:this,descriptor:{format:z.U8_RGBA_RT,width:this.swapChainWidth,height:this.swapChainHeight,depthOrArrayLayers:0,dimension:Zt.TEXTURE_2D,mipLevelCount:1,usage:this.swapChainTextureUsage},skipCreate:!0});return i.depthOrArrayLayers=1,i.sampleCount=1,i.gpuTexture=t,i.gpuTextureView=e,i.name="Onscreen",this.setResourceName(i,"Onscreen Texture"),i},r.prototype.getDevice=function(){return this},r.prototype.getCanvas=function(){return this.canvas},r.prototype.beginFrame=function(){Dt(this.frameCommandEncoderPool.length===0)},r.prototype.endFrame=function(){Dt(this.frameCommandEncoderPool.every(function(t){return t!==null})),this.device.queue.submit(this.frameCommandEncoderPool.map(function(t){return t.finish()})),this.frameCommandEncoderPool=[]},r.prototype.getNextUniqueId=function(){return++this._resourceUniqueId},r.prototype.createBuffer=function(t){return new jit({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createTexture=function(t){return new Bp({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createSampler=function(t){return new tnt({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createRenderTarget=function(t){var e=new Bp({id:this.getNextUniqueId(),device:this,descriptor:S(S({},t),{dimension:Zt.TEXTURE_2D,mipLevelCount:1,depthOrArrayLayers:1,usage:ci.RENDER_TARGET}),sampleCount:t.sampleCount});return e.depthOrArrayLayers=1,e.type=oe.RenderTarget,e},r.prototype.createRenderTargetFromTexture=function(t){var e=t,i=e.format,n=e.width,a=e.height,o=e.depthOrArrayLayers,s=e.sampleCount,l=e.mipLevelCount,u=e.gpuTexture,c=e.gpuTextureView,h=e.usage;Dt(!!(h&pr.RENDER_ATTACHMENT));var f=new Bp({id:this.getNextUniqueId(),device:this,descriptor:{format:i,width:n,height:a,depthOrArrayLayers:o,dimension:Zt.TEXTURE_2D,mipLevelCount:l,usage:h},skipCreate:!0});return f.depthOrArrayLayers=o,f.sampleCount=s,f.gpuTexture=u,f.gpuTextureView=c,f},r.prototype.createProgram=function(t){var e,i;return!((e=t.vertex)===null||e===void 0)&&e.glsl&&(t.vertex.glsl=rh(this.queryVendorInfo(),"vert",t.vertex.glsl)),!((i=t.fragment)===null||i===void 0)&&i.glsl&&(t.fragment.glsl=rh(this.queryVendorInfo(),"frag",t.fragment.glsl)),new uM({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createProgramSimple=function(t){return new uM({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createTextureShared=function(t,e,i){var n={width:t.width,height:t.height,depthOrArrayLayers:t.depthOrArrayLayers},a=t.mipLevelCount,o=CS(t.format),s=Tit(t.dimension),l=Ait(t.usage);if(e.gpuTextureformat=o,e.dimension=t.dimension,e.format=t.format,e.width=t.width,e.height=t.height,e.depthOrArrayLayers=t.depthOrArrayLayers,e.mipLevelCount=a,e.usage=l,e.sampleCount=t.sampleCount,!i){var u=this.device.createTexture({size:n,mipLevelCount:a,format:o,dimension:s,sampleCount:t.sampleCount,usage:l}),c=u.createView();e.gpuTexture=u,e.gpuTextureView=c}},r.prototype.getFallbackSampler=function(t){var e=t.formatKind;return e===je.Depth&&t.comparison?this.fallbackSamplerComparison:this.fallbackSamplerFiltering},r.prototype.getFallbackTexture=function(t){var e=t.dimension,i=t.formatKind;if(e===Zt.TEXTURE_2D)return i===je.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(e===Zt.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(e===Zt.TEXTURE_3D)return this.fallbackTexture3D;if(e===Zt.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},r.prototype.createFallbackTexture=function(t,e){var i=t===Zt.TEXTURE_CUBE_MAP?6:1,n=e===je.Float?z.U8_RGBA_NORM:z.D24;return this.createTexture({dimension:t,format:n,usage:ci.SAMPLED,width:1,height:1,depthOrArrayLayers:i,mipLevelCount:1})},r.prototype.createBindings=function(t){return new Yit({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createInputLayout=function(t){return new qit({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createComputePipeline=function(t){return new Zit({id:this.getNextUniqueId(),device:this,descriptor:t})},r.prototype.createRenderPipeline=function(t){return new Jit({id:this.getNextUniqueId(),device:this,descriptor:S({},t)})},r.prototype.createQueryPool=function(t,e){return new Kit({id:this.getNextUniqueId(),device:this,descriptor:{type:t,elemCount:e}})},r.prototype.createRenderPipelineInternal=function(t,e){var i;if(t.gpuRenderPipeline===null){var n=t.descriptor,a=n.program,o=a.vertexStage,s=a.fragmentStage;if(!(o===null||s===null)){var l=n.megaStateDescriptor||{},u=l.stencilBack,c=l.stencilFront,h=zt(l,["stencilBack","stencilFront"]),f=th(eh);n.megaStateDescriptor=S(S(S({},f),{stencilBack:S(S({},f.stencilBack),u),stencilFront:S(S({},f.stencilFront),c)}),h);var d=n.megaStateDescriptor.attachmentsState[0];n.colorAttachmentFormats.forEach(function(x,C){n.megaStateDescriptor.attachmentsState[C]||(n.megaStateDescriptor.attachmentsState[C]=UD(void 0,d))});var v=Bit((i=n.topology)!==null&&i!==void 0?i:sr.TRIANGLES,n.megaStateDescriptor),p=Uit(n.colorAttachmentFormats,n.megaStateDescriptor),g=zit(n.depthStencilAttachmentFormat,n.megaStateDescriptor),m=void 0;n.inputLayout!==null&&(m=n.inputLayout.buffers);var y=n.sampleCount,_={layout:"auto",vertex:S(S({},o),{buffers:m}),primitive:v,depthStencil:g,multisample:{count:y},fragment:S(S({},s),{targets:p})};t.gpuRenderPipeline=this.device.createRenderPipeline(_)}}},r.prototype.createReadback=function(){return new Qit({id:this.getNextUniqueId(),device:this})},r.prototype.createRenderBundle=function(){return new ent({id:this.getNextUniqueId(),device:this})},r.prototype.createRenderPass=function(t){var e=this.renderPassPool.pop();e===void 0&&(e=new cM(this));var i=this.frameCommandEncoderPool.pop();return i===void 0&&(i=this.device.createCommandEncoder()),e.beginRenderPass(i,t),e},r.prototype.createComputePass=function(){var t=this.computePassPool.pop();t===void 0&&(t=new lM);var e=this.frameCommandEncoderPool.pop();return e===void 0&&(e=this.device.createCommandEncoder()),t.beginComputePass(e),t},r.prototype.submitPass=function(t){var e=t;e instanceof cM?(this.frameCommandEncoderPool.push(e.frameCommandEncoder),e.finish(),this.renderPassPool.push(e)):e instanceof lM&&(this.frameCommandEncoderPool.push(e.frameCommandEncoder),e.finish(),this.computePassPool.push(e))},r.prototype.copySubTexture2D=function(t,e,i,n,a,o,s){var l=this.device.createCommandEncoder(),u=t,c=n,h={texture:c.gpuTexture,origin:[a,o,0],mipLevel:0,aspect:"all"},f={texture:u.gpuTexture,origin:[e,i,0],mipLevel:0,aspect:"all"};Dt(!!(c.usage&pr.COPY_SRC)),Dt(!!(u.usage&pr.COPY_DST)),l.copyTextureToTexture(h,f,[c.width,c.height,s||1]),this.device.queue.submit([l.finish()])},r.prototype.queryLimits=function(){return{uniformBufferMaxPageWordSize:this.device.limits.maxUniformBufferBindingSize>>>2,uniformBufferWordAlignment:this.device.limits.minUniformBufferOffsetAlignment>>>2,supportedSampleCounts:[1],occlusionQueriesRecommended:!0,computeShadersSupported:!0}},r.prototype.queryTextureFormatSupported=function(t,e,i){if(Vit(t)){if(!this.featureTextureCompressionBC)return!1;var n=Git(t);return e%n!==0||i%n!==0?!1:this.featureTextureCompressionBC}switch(t){case z.U16_RGBA_NORM:return!1;case z.F32_RGBA:return!1}return!0},r.prototype.queryPlatformAvailable=function(){return!0},r.prototype.queryVendorInfo=function(){return this},r.prototype.queryRenderPass=function(t){var e=t;return e.descriptor},r.prototype.queryRenderTarget=function(t){var e=t;return e},r.prototype.setResourceName=function(t,e){if(t.name=e,t.type===oe.Buffer){var i=t;i.gpuBuffer.label=e}else if(t.type===oe.Texture){var i=t;i.gpuTexture.label=e,i.gpuTextureView.label=e}else if(t.type===oe.RenderTarget){var i=t;i.gpuTexture.label=e,i.gpuTextureView.label=e}else if(t.type===oe.Sampler){var i=t;i.gpuSampler.label=e}else if(t.type===oe.RenderPipeline){var i=t;i.gpuRenderPipeline!==null&&(i.gpuRenderPipeline.label=e)}},r.prototype.setResourceLeakCheck=function(t,e){},r.prototype.checkForLeaks=function(){},r.prototype.programPatched=function(t){},r.prototype.pipelineQueryReady=function(t){var e=t;return e.gpuRenderPipeline!==null},r.prototype.pipelineForceReady=function(t){var e=t;this.createRenderPipelineInternal(e,!1)},r}(),int=function(){function r(t){this.pluginOptions=t}return r.prototype.createSwapChain=function(t){return Ti(this,void 0,void 0,function(){var e,i,n,a,o,s,l,u;return ba(this,function(c){switch(c.label){case 0:if(globalThis.navigator.gpu===void 0)return[2,null];e=null,c.label=1;case 1:return c.trys.push([1,3,,4]),i=this.pluginOptions.xrCompatible,[4,globalThis.navigator.gpu.requestAdapter({xrCompatible:i})];case 2:return e=c.sent(),[3,4];case 3:return n=c.sent(),console.log(n),[3,4];case 4:return e===null?[2,null]:(a=["depth32float-stencil8","texture-compression-bc","float32-filterable"],o=a.filter(function(h){return e.features.has(h)}),[4,e.requestDevice({requiredFeatures:o})]);case 5:if(s=c.sent(),s&&(l=this.pluginOptions.onContextLost,s.lost.then(function(){l&&l()})),s===null)return[2,null];if(u=t.getContext("webgpu"),!u)return[2,null];c.label=6;case 6:return c.trys.push([6,8,,9]),[4,XD(this.pluginOptions.shaderCompilerPath)];case 7:return c.sent(),[3,9];case 8:return c.sent(),[3,9];case 9:return[2,new rnt(e,s,t,u,xit,Ad&&new Ad)]}})})},r}(),nnt=class{constructor(r,t){const{buffer:e,offset:i,stride:n,normalized:a,size:o,divisor:s,shaderLocation:l}=t;this.buffer=e,this.attribute={shaderLocation:l,buffer:e.get(),offset:i||0,stride:n||0,normalized:a||!1,divisor:s||0},o&&(this.attribute.size=o)}get(){return this.buffer}updateBuffer(r){this.buffer.subData(r)}destroy(){this.buffer.destroy()}},k0={[w.FLOAT]:Float32Array,[w.UNSIGNED_BYTE]:Uint8Array,[w.SHORT]:Int16Array,[w.UNSIGNED_SHORT]:Uint16Array,[w.INT]:Int32Array,[w.UNSIGNED_INT]:Uint32Array},ant={[w.POINTS]:sr.POINTS,[w.LINES]:sr.LINES,[w.LINE_LOOP]:sr.LINES,[w.LINE_STRIP]:sr.LINE_STRIP,[w.TRIANGLES]:sr.TRIANGLES,[w.TRIANGLE_FAN]:sr.TRIANGLES,[w.TRIANGLE_STRIP]:sr.TRIANGLE_STRIP},ont={1:z.F32_R,2:z.F32_RG,3:z.F32_RGB,4:z.F32_RGBA},snt={[w.STATIC_DRAW]:wa.STATIC,[w.DYNAMIC_DRAW]:wa.DYNAMIC,[w.STREAM_DRAW]:wa.DYNAMIC},hM={[w.REPEAT]:bi.REPEAT,[w.CLAMP_TO_EDGE]:bi.CLAMP_TO_EDGE,[w.MIRRORED_REPEAT]:bi.MIRRORED_REPEAT},lnt={[w.NEVER]:ve.NEVER,[w.ALWAYS]:ve.ALWAYS,[w.LESS]:ve.LESS,[w.LEQUAL]:ve.LEQUAL,[w.GREATER]:ve.GREATER,[w.GEQUAL]:ve.GEQUAL,[w.EQUAL]:ve.EQUAL,[w.NOTEQUAL]:ve.NOTEQUAL},unt={[w.FRONT]:Gi.FRONT,[w.BACK]:Gi.BACK},fM={[w.FUNC_ADD]:br.ADD,[w.MIN_EXT]:br.MIN,[w.MAX_EXT]:br.MAX,[w.FUNC_SUBTRACT]:br.SUBSTRACT,[w.FUNC_REVERSE_SUBTRACT]:br.REVERSE_SUBSTRACT},Dp={[w.ZERO]:jt.ZERO,[w.ONE]:jt.ONE,[w.SRC_COLOR]:jt.SRC,[w.ONE_MINUS_SRC_COLOR]:jt.ONE_MINUS_SRC,[w.SRC_ALPHA]:jt.SRC_ALPHA,[w.ONE_MINUS_SRC_ALPHA]:jt.ONE_MINUS_SRC_ALPHA,[w.DST_COLOR]:jt.DST,[w.ONE_MINUS_DST_COLOR]:jt.ONE_MINUS_DST,[w.DST_ALPHA]:jt.DST_ALPHA,[w.ONE_MINUS_DST_ALPHA]:jt.ONE_MINUS_DST_ALPHA,[w.CONSTANT_COLOR]:jt.CONST,[w.ONE_MINUS_CONSTANT_COLOR]:jt.ONE_MINUS_CONSTANT,[w.CONSTANT_ALPHA]:jt.CONST,[w.ONE_MINUS_CONSTANT_ALPHA]:jt.ONE_MINUS_CONSTANT,[w.SRC_ALPHA_SATURATE]:jt.SRC_ALPHA_SATURATE},ic={[w.REPLACE]:Ze.REPLACE,[w.KEEP]:Ze.KEEP,[w.ZERO]:Ze.ZERO,[w.INVERT]:Ze.INVERT,[w.INCR]:Ze.INCREMENT_CLAMP,[w.DECR]:Ze.DECREMENT_CLAMP,[w.INCR_WRAP]:Ze.INCREMENT_WRAP,[w.DECR_WRAP]:Ze.DECREMENT_WRAP},cnt={[w.ALWAYS]:ve.ALWAYS,[w.EQUAL]:ve.EQUAL,[w.GEQUAL]:ve.GEQUAL,[w.GREATER]:ve.GREATER,[w.LEQUAL]:ve.LEQUAL,[w.LESS]:ve.LESS,[w.NEVER]:ve.NEVER,[w.NOTEQUAL]:ve.NOTEQUAL},hnt={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function U0(r){return Object.prototype.toString.call(r)in hnt}function fnt(r,t){const e=r.length,i=Math.ceil(e/3),n=e+i,a=new Float32Array(n);for(let o=0;o<n;o+=4)a[o]=r[o/4*3],a[o+1]=r[o/4*3+1],a[o+2]=r[o/4*3+2],a[o+3]=t;return a}var dnt=class{constructor(r,t){this.isDestroyed=!1;const{data:e,usage:i,type:n,isUBO:a,label:o}=t;let s;U0(e)?s=e:s=new k0[this.type||w.FLOAT](e),this.type=n,this.size=s.byteLength,this.buffer=r.createBuffer({viewOrSize:s,usage:a?Te.UNIFORM:Te.VERTEX,hint:snt[i||w.STATIC_DRAW]}),o&&r.setResourceName(this.buffer,o)}get(){return this.buffer}destroy(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}subData({data:r,offset:t}){let e;U0(r)?e=r:e=new k0[this.type||w.FLOAT](r),this.buffer.setSubData(t,new Uint8Array(e.buffer))}};function me(r,t=0){return r+=t,r+=r<<10,r+=r>>>6,r>>>0}function jD(r){return r+=r<<3,r^=r>>>11,r+=r<<15,r>>>0}function dM(){return 0}var vnt=class{constructor(){this.keys=[],this.values=[]}},Np=class{constructor(r,t){this.keyEqualFunc=r,this.keyHashFunc=t,this.buckets=new Map}findBucketIndex(r,t){for(let e=0;e<r.keys.length;e++)if(this.keyEqualFunc(t,r.keys[e]))return e;return-1}findBucket(r){const t=this.keyHashFunc(r);return this.buckets.get(t)}get(r){const t=this.findBucket(r);if(t===void 0)return null;const e=this.findBucketIndex(t,r);return e<0?null:t.values[e]}add(r,t){const e=this.keyHashFunc(r);this.buckets.get(e)===void 0&&this.buckets.set(e,new vnt);const i=this.buckets.get(e);i.keys.push(r),i.values.push(t)}delete(r){const t=this.findBucket(r);if(t===void 0)return;const e=this.findBucketIndex(t,r);e!==-1&&(t.keys.splice(e,1),t.values.splice(e,1))}clear(){this.buckets.clear()}size(){let r=0;for(const t of this.buckets.values())r+=t.values.length;return r}*values(){for(const r of this.buckets.values())for(let t=r.values.length-1;t>=0;t--)yield r.values[t]}};function vM(r,t){return r=me(r,t.blendMode),r=me(r,t.blendSrcFactor),r=me(r,t.blendDstFactor),r}function pnt(r,t){return r=vM(r,t.rgbBlendState),r=vM(r,t.alphaBlendState),r=me(r,t.channelWriteMask),r}function gnt(r,t){return r=me(r,t.r<<24|t.g<<16|t.b<<8|t.a),r}function mnt(r,t){var e,i,n,a,o,s,l,u;for(let c=0;c<t.attachmentsState.length;c++)r=pnt(r,t.attachmentsState[c]);return r=gnt(r,t.blendConstant||Ym),r=me(r,t.depthCompare),r=me(r,t.depthWrite?1:0),r=me(r,(e=t.stencilFront)==null?void 0:e.compare),r=me(r,(i=t.stencilFront)==null?void 0:i.passOp),r=me(r,(n=t.stencilFront)==null?void 0:n.failOp),r=me(r,(a=t.stencilFront)==null?void 0:a.depthFailOp),r=me(r,(o=t.stencilBack)==null?void 0:o.compare),r=me(r,(s=t.stencilBack)==null?void 0:s.passOp),r=me(r,(l=t.stencilBack)==null?void 0:l.failOp),r=me(r,(u=t.stencilBack)==null?void 0:u.depthFailOp),r=me(r,t.stencilWrite?1:0),r=me(r,t.cullMode),r=me(r,t.frontFace?1:0),r=me(r,t.polygonOffset?1:0),r}function ynt(r){let t=0;t=me(t,r.program.id),r.inputLayout!==null&&(t=me(t,r.inputLayout.id)),t=mnt(t,r.megaStateDescriptor);for(let e=0;e<r.colorAttachmentFormats.length;e++)t=me(t,r.colorAttachmentFormats[e]||0);return t=me(t,r.depthStencilAttachmentFormat||0),jD(t)}function _nt(r){let t=0;if(r.samplerBindings)for(let e=0;e<r.samplerBindings.length;e++){const i=r.samplerBindings[e];i!==null&&i.texture!==null&&(t=me(t,i.texture.id))}if(r.uniformBufferBindings)for(let e=0;e<r.uniformBufferBindings.length;e++){const i=r.uniformBufferBindings[e];i!==null&&i.buffer!==null&&(t=me(t,i.buffer.id),t=me(t,i.binding),t=me(t,i.offset),t=me(t,i.size))}if(r.storageBufferBindings)for(let e=0;e<r.storageBufferBindings.length;e++){const i=r.storageBufferBindings[e];i!==null&&i.buffer!==null&&(t=me(t,i.buffer.id),t=me(t,i.binding),t=me(t,i.offset),t=me(t,i.size))}if(r.storageTextureBindings)for(let e=0;e<r.storageTextureBindings.length;e++){const i=r.storageTextureBindings[e];i!==null&&i.texture!==null&&(t=me(t,i.texture.id),t=me(t,i.binding))}return jD(t)}function xnt(r,t){var e,i,n,a;return((e=r.vertex)==null?void 0:e.glsl)===((i=t.vertex)==null?void 0:i.glsl)&&((n=r.fragment)==null?void 0:n.glsl)===((a=t.fragment)==null?void 0:a.glsl)}function Cnt(r){var t,e;return{vertex:{glsl:(t=r.vertex)==null?void 0:t.glsl},fragment:{glsl:(e=r.fragment)==null?void 0:e.glsl}}}var Ent=class{constructor(r){this.device=r,this.bindingsCache=new Np(Crt,_nt),this.renderPipelinesCache=new Np(Trt,ynt),this.inputLayoutsCache=new Np(Rrt,dM),this.programCache=new Np(xnt,dM)}createBindings(r){var t;let e=this.bindingsCache.get(r);if(e===null){const i=Lrt(r);i.uniformBufferBindings=(t=i.uniformBufferBindings)==null?void 0:t.filter(({size:n})=>n&&n>0),e=this.device.createBindings(i),this.bindingsCache.add(i,e)}return e}createRenderPipeline(r){let t=this.renderPipelinesCache.get(r);if(t===null){const e=Ort(r);e.colorAttachmentFormats=e.colorAttachmentFormats.filter(i=>i),t=this.device.createRenderPipeline(e),this.renderPipelinesCache.add(e,t)}return t}createInputLayout(r){r.vertexBufferDescriptors=r.vertexBufferDescriptors.filter(e=>!!e);let t=this.inputLayoutsCache.get(r);if(t===null){const e=Brt(r);t=this.device.createInputLayout(e),this.inputLayoutsCache.add(e,t)}return t}createProgram(r){let t=this.programCache.get(r);if(t===null){const e=Cnt(r);t=this.device.createProgram(r),this.programCache.add(e,t)}return t}destroy(){for(const r of this.bindingsCache.values())r.destroy();for(const r of this.renderPipelinesCache.values())r.destroy();for(const r of this.inputLayoutsCache.values())r.destroy();for(const r of this.programCache.values())r.destroy();this.bindingsCache.clear(),this.renderPipelinesCache.clear(),this.inputLayoutsCache.clear(),this.programCache.clear()}},Snt=class{constructor(r,t){const{data:e,type:i,count:n=0}=t;let a;U0(e)?a=e:a=new k0[this.type||w.UNSIGNED_INT](e),this.type=i,this.count=n,this.indexBuffer=r.createBuffer({viewOrSize:a,usage:Te.INDEX})}get(){return this.indexBuffer}subData({data:r}){let t;U0(r)?t=r:t=new k0[this.type||w.UNSIGNED_INT](r),this.indexBuffer.setSubData(0,new Uint8Array(t.buffer))}destroy(){this.indexBuffer.destroy()}};function pM(r){return!!(r&&r.texture)}var ZD=class{constructor(r,t){this.device=r,this.options=t,this.isDestroy=!1;const{wrapS:e=w.CLAMP_TO_EDGE,wrapT:i=w.CLAMP_TO_EDGE,aniso:n,mag:a=w.NEAREST,min:o=w.NEAREST}=t;this.createTexture(t),this.sampler=r.createSampler({addressModeU:hM[e],addressModeV:hM[i],minFilter:o===w.NEAREST?Ke.POINT:Ke.BILINEAR,magFilter:a===w.NEAREST?Ke.POINT:Ke.BILINEAR,mipmapFilter:mr.NO_MIP,maxAnisotropy:n})}createTexture(r){const{type:t=w.UNSIGNED_BYTE,width:e,height:i,flipY:n=!1,format:a=w.RGBA,alignment:o=1,usage:s=fu.SAMPLED,unorm:l=!1,label:u}=r;let{data:c}=r;this.width=e,this.height=i;let h=z.U8_RGBA_RT;if(t===w.UNSIGNED_BYTE&&a===w.RGBA)h=l?z.U8_RGBA_NORM:z.U8_RGBA_RT;else if(t===w.UNSIGNED_BYTE&&a===w.LUMINANCE)h=z.U8_LUMINANCE;else if(t===w.FLOAT&&a===w.LUMINANCE)h=z.F32_LUMINANCE;else if(t===w.FLOAT&&a===w.RGB)this.device.queryVendorInfo().platformString==="WebGPU"?(c&&(c=fnt(c,0)),h=z.F32_RGBA):h=z.F32_RGB;else if(t===w.FLOAT&&a===w.RGBA)h=z.F32_RGBA;else if(t===w.FLOAT&&a===w.RED)h=z.F32_R;else throw new Error(`create texture error, type: ${t}, format: ${a}`);this.texture=this.device.createTexture({format:h,width:e,height:i,usage:s===fu.SAMPLED?ci.SAMPLED:ci.RENDER_TARGET,pixelStore:{unpackFlipY:n,packAlignment:o},mipLevelCount:1}),u&&this.device.setResourceName(this.texture,u),c&&this.texture.setImageData([c])}get(){return this.texture}update(r){const{data:t}=r;this.texture.setImageData([t])}bind(){}resize({width:r,height:t}){(this.width!==r||this.height!==t)&&this.destroy(),this.options.width=r,this.options.height=t,this.createTexture(this.options),this.isDestroy=!1}getSize(){return[this.width,this.height]}destroy(){var r;!this.isDestroy&&!this.texture.destroyed&&((r=this.texture)==null||r.destroy()),this.isDestroy=!0}},qD=class{constructor(r,t){this.device=r,this.options=t,this.createColorRenderTarget(),this.createDepthRenderTarget()}createColorRenderTarget(r=!1){const{width:t,height:e,color:i}=this.options;i&&(pM(i)?(r&&i.resize({width:t,height:e}),this.colorTexture=i.get(),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=i.width,this.height=i.height):t&&e&&(this.colorTexture=this.device.createTexture({format:z.U8_RGBA_RT,usage:ci.RENDER_TARGET,width:t,height:e}),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=t,this.height=e))}createDepthRenderTarget(r=!1){const{width:t,height:e,depth:i}=this.options;i&&(pM(i)?(r&&i.resize({width:t,height:e}),this.depthTexture=i.get(),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=i.width,this.height=i.height):t&&e&&(this.depthTexture=this.device.createTexture({format:z.D24_S8,usage:ci.RENDER_TARGET,width:t,height:e}),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=t,this.height=e))}get(){return this.colorRenderTarget}destroy(){var r,t;(r=this.colorRenderTarget)==null||r.destroy(),(t=this.depthRenderTarget)==null||t.destroy()}resize({width:r,height:t}){(this.width!==r||this.height!==t)&&(this.destroy(),this.colorTexture.destroyed=!0,this.depthTexture.destroyed=!0,this.options.width=r,this.options.height=t,this.createColorRenderTarget(!0),this.createDepthRenderTarget(!0))}},Ant=Object.defineProperty,Tnt=Object.defineProperties,bnt=Object.getOwnPropertyDescriptors,gM=Object.getOwnPropertySymbols,wnt=Object.prototype.hasOwnProperty,Rnt=Object.prototype.propertyIsEnumerable,mM=(r,t,e)=>t in r?Ant(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,bl=(r,t)=>{for(var e in t||(t={}))wnt.call(t,e)&&mM(r,e,t[e]);if(gM)for(var e of gM(t))Rnt.call(t,e)&&mM(r,e,t[e]);return r},Mnt=(r,t)=>Tnt(r,bnt(t)),{isPlainObject:Int,isTypedArray:Lnt,isNil:yM}=er,Ont=class{constructor(r,t,e){this.device=r,this.options=t,this.service=e,this.destroyed=!1,this.uniforms={},this.vertexBuffers=[];const{vs:i,fs:n,attributes:a,uniforms:o,count:s,elements:l,diagnosticDerivativeUniformityEnabled:u}=t;this.options=t;const c=u?"":this.service.viewportOrigin===Sa.UPPER_LEFT?"diagnostic(off,derivative_uniformity);":"";this.program=e.renderCache.createProgram({vertex:{glsl:i},fragment:{glsl:n,postprocess:v=>c+v}}),o&&(this.uniforms=this.extractUniforms(o));const h=[];let f=0;Object.keys(a).forEach(v=>{const p=a[v],g=p.get();this.vertexBuffers.push(g.get());const{offset:m=0,stride:y=0,size:_=1,divisor:x=0,shaderLocation:C=0}=p.attribute;h.push({arrayStride:y||_*4,stepMode:vu.VERTEX,attributes:[{format:ont[_],shaderLocation:C,offset:m,divisor:x}]}),f=g.size/_}),s||(this.options.count=f),l&&(this.indexBuffer=l.get());const d=e.renderCache.createInputLayout({vertexBufferDescriptors:h,indexBufferFormat:l?z.U32_R:null,program:this.program});this.inputLayout=d,this.pipeline=this.createPipeline(t)}createPipeline(r,t){var e;const{primitive:i=w.TRIANGLES,depth:n,cull:a,blend:o,stencil:s}=r,l=this.initDepthDrawParams({depth:n}),u=!!(l&&l.enable),c=this.initCullDrawParams({cull:a}),h=!!(c&&c.enable),f=this.getBlendDrawParams({blend:o}),d=!!(f&&f.enable),v=this.getStencilDrawParams({stencil:s}),p=!!(v&&v.enable),g=this.device.createRenderPipeline({inputLayout:this.inputLayout,program:this.program,topology:ant[i],colorAttachmentFormats:[z.U8_RGBA_RT],depthStencilAttachmentFormat:z.D24_S8,megaStateDescriptor:{attachmentsState:[t?{channelWriteMask:Er.ALL,rgbBlendState:{blendMode:br.ADD,blendSrcFactor:jt.ONE,blendDstFactor:jt.ZERO},alphaBlendState:{blendMode:br.ADD,blendSrcFactor:jt.ONE,blendDstFactor:jt.ZERO}}:{channelWriteMask:p&&v.opFront.zpass===Ze.REPLACE?Er.NONE:Er.ALL,rgbBlendState:{blendMode:d&&f.equation.rgb||br.ADD,blendSrcFactor:d&&f.func.srcRGB||jt.SRC_ALPHA,blendDstFactor:d&&f.func.dstRGB||jt.ONE_MINUS_SRC_ALPHA},alphaBlendState:{blendMode:d&&f.equation.alpha||br.ADD,blendSrcFactor:d&&f.func.srcAlpha||jt.ONE,blendDstFactor:d&&f.func.dstAlpha||jt.ONE}}],blendConstant:d?Ym:void 0,depthWrite:u,depthCompare:u&&l.func||ve.LESS,cullMode:h&&c.face||Gi.NONE,stencilWrite:p,stencilFront:{compare:p?v.func.cmp:ve.ALWAYS,passOp:v.opFront.zpass,failOp:v.opFront.fail,depthFailOp:v.opFront.zfail,mask:v.opFront.mask},stencilBack:{compare:p?v.func.cmp:ve.ALWAYS,passOp:v.opBack.zpass,failOp:v.opBack.fail,depthFailOp:v.opBack.zfail,mask:v.opBack.mask}}});return p&&!yM((e=s==null?void 0:s.func)==null?void 0:e.ref)&&(g.stencilFuncReference=s.func.ref),g}updateAttributesAndElements(){}updateAttributes(){}addUniforms(r){this.uniforms=bl(bl({},this.uniforms),this.extractUniforms(r))}draw(r,t){const e=bl(bl({},this.options),r),{count:i=0,instances:n,elements:a,uniforms:o={},uniformBuffers:s,textures:l}=e;this.uniforms=bl(bl({},this.uniforms),this.extractUniforms(o));const{renderPass:u,currentFramebuffer:c,width:h,height:f}=this.service;this.pipeline=this.createPipeline(e,t);const d=this.service.device,v=d.swapChainHeight;if(d.swapChainHeight=(c==null?void 0:c.height)||f,u.setViewport(0,0,(c==null?void 0:c.width)||h,(c==null?void 0:c.height)||f),d.swapChainHeight=v,u.setPipeline(this.pipeline),yM(this.pipeline.stencilFuncReference)||u.setStencilReference(this.pipeline.stencilFuncReference),u.setVertexInput(this.inputLayout,this.vertexBuffers.map(p=>({buffer:p})),a?{buffer:this.indexBuffer,offset:0}:null),s&&(this.bindings=d.createBindings({pipeline:this.pipeline,uniformBufferBindings:s.map((p,g)=>{const m=p;return{binding:g,buffer:m.get(),size:m.size}}),samplerBindings:l==null?void 0:l.map(p=>({texture:p.texture,sampler:p.sampler}))})),this.bindings&&(u.setBindings(this.bindings),Object.keys(this.uniforms).forEach(p=>{const g=this.uniforms[p];g instanceof ZD?this.uniforms[p]=g.get():g instanceof qD&&(this.uniforms[p]=g.get().texture)}),this.program.setUniformsLegacy(this.uniforms)),a){const p=a.count;p===0?u.draw(i,n):u.drawIndexed(p,n)}else u.draw(i,n)}destroy(){var r,t,e;(r=this.vertexBuffers)==null||r.forEach(i=>i.destroy()),(t=this.indexBuffer)==null||t.destroy(),(e=this.bindings)==null||e.destroy(),this.pipeline.destroy(),this.destroyed=!0}initDepthDrawParams({depth:r}){if(r)return{enable:r.enable===void 0?!0:!!r.enable,mask:r.mask===void 0?!0:!!r.mask,func:lnt[r.func||w.LESS],range:r.range||[0,1]}}getBlendDrawParams({blend:r}){const{enable:t,func:e,equation:i,color:n=[0,0,0,0]}=r||{};return{enable:!!t,func:{srcRGB:Dp[e&&e.srcRGB||w.SRC_ALPHA],srcAlpha:Dp[e&&e.srcAlpha||w.SRC_ALPHA],dstRGB:Dp[e&&e.dstRGB||w.ONE_MINUS_SRC_ALPHA],dstAlpha:Dp[e&&e.dstAlpha||w.ONE_MINUS_SRC_ALPHA]},equation:{rgb:fM[i&&i.rgb||w.FUNC_ADD],alpha:fM[i&&i.alpha||w.FUNC_ADD]},color:n}}getStencilDrawParams({stencil:r}){const{enable:t,mask:e=4294967295,func:i={cmp:w.ALWAYS,ref:0,mask:4294967295},opFront:n={fail:w.KEEP,zfail:w.KEEP,zpass:w.KEEP},opBack:a={fail:w.KEEP,zfail:w.KEEP,zpass:w.KEEP}}=r||{};return{enable:!!t,mask:e,func:Mnt(bl({},i),{cmp:cnt[i.cmp]}),opFront:{fail:ic[n.fail],zfail:ic[n.zfail],zpass:ic[n.zpass],mask:i.mask},opBack:{fail:ic[a.fail],zfail:ic[a.zfail],zpass:ic[a.zpass],mask:i.mask}}}initCullDrawParams({cull:r}){if(r){const{enable:t,face:e=w.BACK}=r;return{enable:!!t,face:unt[e]}}}extractUniforms(r){const t={};return Object.keys(r).forEach(e=>{this.extractUniformsRecursively(e,r[e],t,"")}),t}extractUniformsRecursively(r,t,e,i){if(t===null||typeof t=="number"||typeof t=="boolean"||Array.isArray(t)&&typeof t[0]=="number"||Lnt(t)||t===""||"resize"in t){e[`${i&&i+"."}${r}`]=t;return}Int(t)&&Object.keys(t).forEach(n=>{this.extractUniformsRecursively(n,t[n],e,`${i&&i+"."}${r}`)}),Array.isArray(t)&&t.forEach((n,a)=>{Object.keys(n).forEach(o=>{this.extractUniformsRecursively(o,n[o],e,`${i&&i+"."}${r}[${a}]`)})})}};function Pnt(r){return typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext?!0:!!(r&&r._version===2)}var U_=(r,t,e)=>new Promise((i,n)=>{var a=l=>{try{s(e.next(l))}catch(u){n(u)}},o=l=>{try{s(e.throw(l))}catch(u){n(u)}},s=l=>l.done?i(l.value):Promise.resolve(l.value).then(a,o);s((e=e.apply(r,t)).next())}),{isUndefined:kp}=er,Fnt=class{constructor(){this.uniformBuffers=[],this.queryVerdorInfo=()=>this.device.queryVendorInfo().platformString,this.createModel=r=>new Ont(this.device,r,this),this.createAttribute=r=>new nnt(this.device,r),this.createBuffer=r=>new dnt(this.device,r),this.createElements=r=>new Snt(this.device,r),this.createTexture2D=r=>new ZD(this.device,r),this.createFramebuffer=r=>new qD(this.device,r),this.useFramebuffer=(r,t)=>{this.currentFramebuffer=r,this.beginFrame(),t(),this.endFrame(),this.currentFramebuffer=null},this.useFramebufferAsync=(r,t)=>U_(this,null,function*(){this.currentFramebuffer=r,this.preRenderPass=this.renderPass,this.beginFrame(),yield t(),this.endFrame(),this.currentFramebuffer=null,this.renderPass=this.preRenderPass}),this.clear=r=>{const{color:t,depth:e,stencil:i,framebuffer:n=null}=r;if(n)n.clearOptions={color:t,depth:e,stencil:i};else{const a=this.queryVerdorInfo();if(a==="WebGL1"){const o=this.getGLContext();kp(i)?kp(e)||(o.clearDepth(e),o.clear(o.DEPTH_BUFFER_BIT)):(o.clearStencil(i),o.clear(o.STENCIL_BUFFER_BIT))}else if(a==="WebGL2"){const o=this.getGLContext();kp(i)?kp(e)||o.clearBufferfv(o.DEPTH,0,[e]):o.clearBufferiv(o.STENCIL,0,[i])}}},this.viewport=({width:r,height:t})=>{this.swapChain.configureSwapChain(r,t),this.createMainColorDepthRT(r,t),this.width=r,this.height=t},this.readPixels=r=>{const{framebuffer:t,x:e,y:i,width:n,height:a}=r,o=this.device.createReadback(),s=t.colorTexture,l=o.readTextureSync(s,e,this.viewportOrigin===Sa.LOWER_LEFT?i:this.height-i,n,a,new Uint8Array(n*a*4));if(this.viewportOrigin!==Sa.LOWER_LEFT)for(let u=0;u<l.length;u+=4){const c=l[u];l[u]=l[u+2],l[u+2]=c}return o.destroy(),l},this.readPixelsAsync=r=>U_(this,null,function*(){const{framebuffer:t,x:e,y:i,width:n,height:a}=r,o=this.device.createReadback(),s=t.colorTexture,l=yield o.readTexture(s,e,this.viewportOrigin===Sa.LOWER_LEFT?i:this.height-i,n,a,new Uint8Array(n*a*4));if(this.viewportOrigin!==Sa.LOWER_LEFT)for(let u=0;u<l.length;u+=4){const c=l[u];l[u]=l[u+2],l[u+2]=c}return o.destroy(),l}),this.getViewportSize=()=>({width:this.width,height:this.height}),this.getContainer=()=>{var r;return(r=this.canvas)==null?void 0:r.parentElement},this.getCanvas=()=>this.canvas,this.getGLContext=()=>this.device.gl,this.destroy=()=>{var r;this.canvas=null,(r=this.uniformBuffers)==null||r.forEach(t=>{t.destroy()}),this.device.destroy(),this.renderCache.destroy()}}init(r,t){return U_(this,null,function*(){const{enableWebGPU:e,shaderCompilerPath:i,antialias:n}=t;this.canvas=r;const o=yield(e?new int({shaderCompilerPath:i}):new pit({targets:["webgl2","webgl1"],antialias:n,onContextLost(l){console.warn("context lost",l)},onContextCreationError(l){console.warn("context creation error",l)},onContextRestored(l){console.warn("context restored",l)}})).createSwapChain(r);o.configureSwapChain(r.width,r.height),this.device=o.getDevice(),this.swapChain=o,this.renderCache=new Ent(this.device),this.currentFramebuffer=null,this.viewportOrigin=this.device.queryVendorInfo().viewportOrigin;const s=this.device.gl;this.extensionObject={OES_texture_float:!Pnt(s)&&this.device.OES_texture_float},this.createMainColorDepthRT(r.width,r.height)})}createMainColorDepthRT(r,t){this.mainColorRT&&this.mainColorRT.destroy(),this.mainDepthRT&&this.mainDepthRT.destroy(),this.mainColorRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:z.U8_RGBA_RT,width:r,height:t,usage:ci.RENDER_TARGET})),this.mainDepthRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:z.D24_S8,width:r,height:t,usage:ci.RENDER_TARGET}))}beginFrame(){this.device.beginFrame();const{currentFramebuffer:r,swapChain:t,mainColorRT:e,mainDepthRT:i}=this,n=r?r.colorRenderTarget:e,a=r?null:t.getOnscreenTexture(),o=r?r.depthRenderTarget:i,{color:s=[0,0,0,0],depth:l=1,stencil:u=0}=(r==null?void 0:r.clearOptions)||{},c=n?Av(s[0]*255,s[1]*255,s[2]*255,s[3]):Ym,h=o?l:void 0,f=o?u:void 0,d=this.device.createRenderPass({colorAttachment:[n],colorResolveTo:[a],colorClearColor:[c],colorStore:[!0],depthStencilAttachment:o,depthClearValue:h,stencilClearValue:f});this.renderPass=d}endFrame(){this.device.submitPass(this.renderPass),this.device.endFrame()}getPointSizeRange(){const r=this.device.gl;return r.getParameter(r.ALIASED_POINT_SIZE_RANGE)}testExtension(r){return!!this.getGLContext().getExtension(r)}setState(){}setBaseState(){}setCustomLayerDefaults(){}setDirty(r){this.isDirty=r}getDirty(){return this.isDirty}},Bnt=class{constructor(r,t){const{buffer:e,offset:i,stride:n,normalized:a,size:o,divisor:s}=t;this.buffer=e,this.attribute={buffer:e.get(),offset:i||0,stride:n||0,normalized:a||!1,divisor:s||0},o&&(this.attribute.size=o)}get(){return this.attribute}updateBuffer(r){this.buffer.subData(r)}destroy(){this.buffer.destroy()}},Dnt={[w.POINTS]:"points",[w.LINES]:"lines",[w.LINE_LOOP]:"line loop",[w.LINE_STRIP]:"line strip",[w.TRIANGLES]:"triangles",[w.TRIANGLE_FAN]:"triangle fan",[w.TRIANGLE_STRIP]:"triangle strip"},KD={[w.STATIC_DRAW]:"static",[w.DYNAMIC_DRAW]:"dynamic",[w.STREAM_DRAW]:"stream"},ES={[w.BYTE]:"int8",[w.INT]:"int32",[w.UNSIGNED_BYTE]:"uint8",[w.UNSIGNED_SHORT]:"uint16",[w.UNSIGNED_INT]:"uint32",[w.FLOAT]:"float"},Nnt={[w.ALPHA]:"alpha",[w.LUMINANCE]:"luminance",[w.LUMINANCE_ALPHA]:"luminance alpha",[w.RGB]:"rgb",[w.RGBA]:"rgba",[w.RGBA4]:"rgba4",[w.RGB5_A1]:"rgb5 a1",[w.RGB565]:"rgb565",[w.DEPTH_COMPONENT]:"depth",[w.DEPTH_STENCIL]:"depth stencil"},knt={[w.DONT_CARE]:"dont care",[w.NICEST]:"nice",[w.FASTEST]:"fast"},_M={[w.NEAREST]:"nearest",[w.LINEAR]:"linear",[w.LINEAR_MIPMAP_LINEAR]:"mipmap",[w.NEAREST_MIPMAP_LINEAR]:"nearest mipmap linear",[w.LINEAR_MIPMAP_NEAREST]:"linear mipmap nearest",[w.NEAREST_MIPMAP_NEAREST]:"nearest mipmap nearest"},xM={[w.REPEAT]:"repeat",[w.CLAMP_TO_EDGE]:"clamp",[w.MIRRORED_REPEAT]:"mirror"},Unt={[w.NONE]:"none",[w.BROWSER_DEFAULT_WEBGL]:"browser"},znt={[w.NEVER]:"never",[w.ALWAYS]:"always",[w.LESS]:"less",[w.LEQUAL]:"lequal",[w.GREATER]:"greater",[w.GEQUAL]:"gequal",[w.EQUAL]:"equal",[w.NOTEQUAL]:"notequal"},CM={[w.FUNC_ADD]:"add",[w.MIN_EXT]:"min",[w.MAX_EXT]:"max",[w.FUNC_SUBTRACT]:"subtract",[w.FUNC_REVERSE_SUBTRACT]:"reverse subtract"},Up={[w.ZERO]:"zero",[w.ONE]:"one",[w.SRC_COLOR]:"src color",[w.ONE_MINUS_SRC_COLOR]:"one minus src color",[w.SRC_ALPHA]:"src alpha",[w.ONE_MINUS_SRC_ALPHA]:"one minus src alpha",[w.DST_COLOR]:"dst color",[w.ONE_MINUS_DST_COLOR]:"one minus dst color",[w.DST_ALPHA]:"dst alpha",[w.ONE_MINUS_DST_ALPHA]:"one minus dst alpha",[w.CONSTANT_COLOR]:"constant color",[w.ONE_MINUS_CONSTANT_COLOR]:"one minus constant color",[w.CONSTANT_ALPHA]:"constant alpha",[w.ONE_MINUS_CONSTANT_ALPHA]:"one minus constant alpha",[w.SRC_ALPHA_SATURATE]:"src alpha saturate"},Hnt={[w.NEVER]:"never",[w.ALWAYS]:"always",[w.LESS]:"less",[w.LEQUAL]:"lequal",[w.GREATER]:"greater",[w.GEQUAL]:"gequal",[w.EQUAL]:"equal",[w.NOTEQUAL]:"notequal"},nc={[w.ZERO]:"zero",[w.KEEP]:"keep",[w.REPLACE]:"replace",[w.INVERT]:"invert",[w.INCR]:"increment",[w.DECR]:"decrement",[w.INCR_WRAP]:"increment wrap",[w.DECR_WRAP]:"decrement wrap"},$nt={[w.FRONT]:"front",[w.BACK]:"back"},Wnt=class{constructor(r,t){this.isDestroyed=!1;const{data:e,usage:i,type:n}=t;this.buffer=r.buffer({data:e,usage:KD[i||w.STATIC_DRAW],type:ES[n||w.UNSIGNED_BYTE]})}get(){return this.buffer}destroy(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}subData({data:r,offset:t}){this.buffer.subdata(r,t)}},Vnt=class{constructor(r,t){const{data:e,usage:i,type:n,count:a}=t;this.elements=r.elements({data:e,usage:KD[i||w.STATIC_DRAW],type:ES[n||w.UNSIGNED_BYTE],count:a})}get(){return this.elements}subData({data:r}){this.elements.subdata(r)}destroy(){}},Gnt=class{constructor(r,t){const{width:e,height:i,color:n,colors:a}=t,o={width:e,height:i};Array.isArray(a)&&(o.colors=a.map(s=>s.get())),n&&typeof n!="boolean"&&(o.color=n.get()),this.framebuffer=r.framebuffer(o)}get(){return this.framebuffer}destroy(){this.framebuffer.destroy()}resize({width:r,height:t}){this.framebuffer.resize(r,t)}},Xnt=Object.defineProperty,Ynt=Object.defineProperties,jnt=Object.getOwnPropertyDescriptors,EM=Object.getOwnPropertySymbols,Znt=Object.prototype.hasOwnProperty,qnt=Object.prototype.propertyIsEnumerable,SM=(r,t,e)=>t in r?Xnt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,pf=(r,t)=>{for(var e in t||(t={}))Znt.call(t,e)&&SM(r,e,t[e]);if(EM)for(var e of EM(t))qnt.call(t,e)&&SM(r,e,t[e]);return r},Knt=(r,t)=>Ynt(r,jnt(t)),{isPlainObject:Qnt,isTypedArray:Jnt}=er,tat=class{constructor(r,t){this.destroyed=!1,this.uniforms={},this.reGl=r;const{vs:e,fs:i,attributes:n,uniforms:a,primitive:o,count:s,elements:l,depth:u,cull:c,instances:h}=t,f={platformString:"WebGL1",glslVersion:"#version 100",explicitBindingLocations:!1,separateSamplerTextures:!1,viewportOrigin:Sa.LOWER_LEFT,clipSpaceNearZ:Qc.NEGATIVE_ONE,supportMRT:!1},d={};this.options=t,a&&(this.uniforms=this.extractUniforms(a),Object.keys(a).forEach(y=>{d[y]=r.prop(y)}));const v={};Object.keys(n).forEach(y=>{v[y]=n[y].get()});const p=ow(rh(f,"frag",i,null,!1)),g=ow(rh(f,"vert",e,null,!1)),m={attributes:v,frag:p,uniforms:d,vert:g,colorMask:r.prop("colorMask"),lineWidth:1,blend:{enable:r.prop("blend.enable"),func:r.prop("blend.func"),equation:r.prop("blend.equation"),color:r.prop("blend.color")},stencil:{enable:r.prop("stencil.enable"),mask:r.prop("stencil.mask"),func:r.prop("stencil.func"),opFront:r.prop("stencil.opFront"),opBack:r.prop("stencil.opBack")},primitive:Dnt[o===void 0?w.TRIANGLES:o]};h&&(m.instances=h),s?m.count=s:l&&(m.elements=l.get()),this.initDepthDrawParams({depth:u},m),this.initCullDrawParams({cull:c},m),this.drawCommand=r(m),this.drawParams=m}updateAttributesAndElements(r,t){const e={};Object.keys(r).forEach(i=>{e[i]=r[i].get()}),this.drawParams.attributes=e,this.drawParams.elements=t.get(),this.drawCommand=this.reGl(this.drawParams)}updateAttributes(r){const t={};Object.keys(r).forEach(e=>{t[e]=r[e].get()}),this.drawParams.attributes=t,this.drawCommand=this.reGl(this.drawParams)}addUniforms(r){this.uniforms=pf(pf({},this.uniforms),this.extractUniforms(r))}draw(r,t){if(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)return;const e=pf(pf({},this.uniforms),this.extractUniforms(r.uniforms||{})),i={};Object.keys(e).forEach(n=>{const a=typeof e[n];a==="boolean"||a==="number"||Array.isArray(e[n])||e[n].BYTES_PER_ELEMENT?i[n]=e[n]:i[n]=e[n].get()}),i.blend=t?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(r),i.stencil=this.getStencilDrawParams(r),i.colorMask=this.getColorMaskDrawParams(r,t),this.drawCommand(i)}destroy(){var r,t;(t=(r=this.drawParams)==null?void 0:r.elements)==null||t.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(e=>{e==null||e.destroy()}),this.destroyed=!0}initDepthDrawParams({depth:r},t){r&&(t.depth={enable:r.enable===void 0?!0:!!r.enable,mask:r.mask===void 0?!0:!!r.mask,func:znt[r.func||w.LESS],range:r.range||[0,1]})}getBlendDrawParams({blend:r}){const{enable:t,func:e,equation:i,color:n=[0,0,0,0]}=r||{};return{enable:!!t,func:{srcRGB:Up[e&&e.srcRGB||w.SRC_ALPHA],srcAlpha:Up[e&&e.srcAlpha||w.SRC_ALPHA],dstRGB:Up[e&&e.dstRGB||w.ONE_MINUS_SRC_ALPHA],dstAlpha:Up[e&&e.dstAlpha||w.ONE_MINUS_SRC_ALPHA]},equation:{rgb:CM[i&&i.rgb||w.FUNC_ADD],alpha:CM[i&&i.alpha||w.FUNC_ADD]},color:n}}getStencilDrawParams({stencil:r}){const{enable:t,mask:e=-1,func:i={cmp:w.ALWAYS,ref:0,mask:-1},opFront:n={fail:w.KEEP,zfail:w.KEEP,zpass:w.KEEP},opBack:a={fail:w.KEEP,zfail:w.KEEP,zpass:w.KEEP}}=r||{};return{enable:!!t,mask:e,func:Knt(pf({},i),{cmp:Hnt[i.cmp]}),opFront:{fail:nc[n.fail],zfail:nc[n.zfail],zpass:nc[n.zpass]},opBack:{fail:nc[a.fail],zfail:nc[a.zfail],zpass:nc[a.zpass]}}}getColorMaskDrawParams({stencil:r},t){return r!=null&&r.enable&&r.opFront&&!t?[!1,!1,!1,!1]:[!0,!0,!0,!0]}initCullDrawParams({cull:r},t){if(r){const{enable:e,face:i=w.BACK}=r;t.cull={enable:!!e,face:$nt[i]}}}extractUniforms(r){const t={};return Object.keys(r).forEach(e=>{this.extractUniformsRecursively(e,r[e],t,"")}),t}extractUniformsRecursively(r,t,e,i){if(t===null||typeof t=="number"||typeof t=="boolean"||Array.isArray(t)&&typeof t[0]=="number"||Jnt(t)||t===""||"resize"in t){e[`${i&&i+"."}${r}`]=t;return}Qnt(t)&&Object.keys(t).forEach(n=>{this.extractUniformsRecursively(n,t[n],e,`${i&&i+"."}${r}`)}),Array.isArray(t)&&t.forEach((n,a)=>{Object.keys(n).forEach(o=>{this.extractUniformsRecursively(o,n[o],e,`${i&&i+"."}${r}[${a}]`)})})}},eat=class{constructor(r,t){this.isDestroy=!1;const{data:e,type:i=w.UNSIGNED_BYTE,width:n,height:a,flipY:o=!1,format:s=w.RGBA,mipmap:l=!1,wrapS:u=w.CLAMP_TO_EDGE,wrapT:c=w.CLAMP_TO_EDGE,aniso:h=0,alignment:f=1,premultiplyAlpha:d=!1,mag:v=w.NEAREST,min:p=w.NEAREST,colorSpace:g=w.BROWSER_DEFAULT_WEBGL,x:m=0,y=0,copy:_=!1}=t;this.width=n,this.height=a;const x={width:n,height:a,type:ES[i],format:Nnt[s],wrapS:xM[u],wrapT:xM[c],mag:_M[v],min:_M[p],alignment:f,flipY:o,colorSpace:Unt[g],premultiplyAlpha:d,aniso:h,x:m,y,copy:_};e&&(x.data=e),typeof l=="number"?x.mipmap=knt[l]:typeof l=="boolean"&&(x.mipmap=l),this.texture=r.texture(x)}get(){return this.texture}update(r={}){this.texture(r)}bind(){this.texture._texture.bind()}resize({width:r,height:t}){this.texture.resize(r,t),this.width=r,this.height=t}getSize(){return[this.width,this.height]}destroy(){var r;this.isDestroy||(r=this.texture)==null||r.destroy(),this.isDestroy=!0}},z_=(r,t,e)=>new Promise((i,n)=>{var a=l=>{try{s(e.next(l))}catch(u){n(u)}},o=l=>{try{s(e.throw(l))}catch(u){n(u)}},s=l=>l.done?i(l.value):Promise.resolve(l.value).then(a,o);s((e=e.apply(r,t)).next())}),rat=class{constructor(){this.uniformBuffers=[],this.queryVerdorInfo=()=>"WebGL1",this.createModel=r=>new tat(this.gl,r),this.createAttribute=r=>new Bnt(this.gl,r),this.createBuffer=r=>new Wnt(this.gl,r),this.createElements=r=>new Vnt(this.gl,r),this.createTexture2D=r=>new eat(this.gl,r),this.createFramebuffer=r=>new Gnt(this.gl,r),this.useFramebuffer=(r,t)=>{this.gl({framebuffer:r?r.get():null})(t)},this.useFramebufferAsync=(r,t)=>z_(this,null,function*(){this.gl({framebuffer:r?r.get():null})(t)}),this.clear=r=>{var t;const{color:e,depth:i,stencil:n,framebuffer:a=null}=r,o={color:e,depth:i,stencil:n};o.framebuffer=a===null?a:a.get(),(t=this.gl)==null||t.clear(o)},this.viewport=({x:r,y:t,width:e,height:i})=>{this.gl._gl.viewport(r,t,e,i),this.width=e,this.height=i,this.gl._refresh()},this.readPixels=r=>{const{framebuffer:t,x:e,y:i,width:n,height:a}=r,o={x:e,y:i,width:n,height:a};return t&&(o.framebuffer=t.get()),this.gl.read(o)},this.readPixelsAsync=r=>z_(this,null,function*(){return this.readPixels(r)}),this.getViewportSize=()=>({width:this.gl._gl.drawingBufferWidth,height:this.gl._gl.drawingBufferHeight}),this.getContainer=()=>{var r;return(r=this.canvas)==null?void 0:r.parentElement},this.getCanvas=()=>this.canvas,this.getGLContext=()=>this.gl._gl,this.destroy=()=>{var r,t,e;this.canvas=null,(e=(t=(r=this.gl)==null?void 0:r._gl)==null?void 0:t.getExtension("WEBGL_lose_context"))==null||e.loseContext(),this.gl.destroy(),this.gl=null}}init(r,t,e){return z_(this,null,function*(){this.canvas=r,e?this.gl=e:this.gl=yield new Promise((i,n)=>{UW({canvas:this.canvas,attributes:{alpha:!0,antialias:t.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,stencil:t.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:(a,o)=>{(a||!o)&&n(a),i(o)}})}),this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")}})}getPointSizeRange(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}testExtension(r){return!!this.getGLContext().getExtension(r)}setState(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}setBaseState(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}setCustomLayerDefaults(){const r=this.getGLContext();r.disable(r.CULL_FACE)}setDirty(r){this.isDirty=r}getDirty(){return this.isDirty}beginFrame(){}endFrame(){}},H_=["selectstart","selecting","selectend"],iat=class extends Li.EventEmitter{constructor(r,t={}){super(),this.isEnable=!1,this.onDragStart=e=>{this.box.style.display="block",this.startEvent=this.endEvent=e,this.syncBoxBound(),this.emit("selectstart",this.getLngLatBox(),this.startEvent,this.endEvent)},this.onDragging=e=>{this.endEvent=e,this.syncBoxBound(),this.emit("selecting",this.getLngLatBox(),this.startEvent,this.endEvent)},this.onDragEnd=e=>{this.endEvent=e,this.box.style.display="none",this.emit("selectend",this.getLngLatBox(),this.startEvent,this.endEvent)},this.scene=r,this.options=t}get container(){return this.scene.getMapService().getMarkerContainer()}enable(){if(this.isEnable)return;const{className:r}=this.options;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){const t=we("div",void 0,this.container);t.classList.add("l7-select-box"),r&&t.classList.add(r),t.style.display="none",this.box=t}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}disable(){this.isEnable&&(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}syncBoxBound(){const{x:r,y:t}=this.startEvent,{x:e,y:i}=this.endEvent,n=Math.min(r,e),a=Math.min(t,i),o=Math.abs(r-e),s=Math.abs(t-i);this.box.style.top=`${a}px`,this.box.style.left=`${n}px`,this.box.style.width=`${o}px`,this.box.style.height=`${s}px`}getLngLatBox(){const{lngLat:{lng:r,lat:t}}=this.startEvent,{lngLat:{lng:e,lat:i}}=this.endEvent;return wV([[r,t],[e,i]])}},nat=Object.defineProperty,aat=Object.defineProperties,oat=Object.getOwnPropertyDescriptors,AM=Object.getOwnPropertySymbols,sat=Object.prototype.hasOwnProperty,lat=Object.prototype.propertyIsEnumerable,TM=(r,t,e)=>t in r?nat(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,uat=(r,t)=>{for(var e in t||(t={}))sat.call(t,e)&&TM(r,e,t[e]);if(AM)for(var e of AM(t))lat.call(t,e)&&TM(r,e,t[e]);return r},cat=(r,t)=>aat(r,oat(t)),gf=(r,t,e)=>new Promise((i,n)=>{var a=l=>{try{s(e.next(l))}catch(u){n(u)}},o=l=>{try{s(e.throw(l))}catch(u){n(u)}},s=l=>l.done?i(l.value):Promise.resolve(l.value).then(a,o);s((e=e.apply(r,t)).next())}),hat=class{constructor(r){const{id:t,map:e,renderer:i="device"}=r,n=Tj();this.container=n,e.setContainer(n,t),i==="regl"?n.rendererService=new rat:n.rendererService=new Fnt,this.sceneService=n.sceneService,this.mapService=n.mapService,this.iconService=n.iconService,this.fontService=n.fontService,this.controlService=n.controlService,this.layerService=n.layerService,this.debugService=n.debugService,this.debugService.setEnable(r.debug),this.markerService=n.markerService,this.interactionService=n.interactionService,this.popupService=n.popupService,this.boxSelect=new iat(this,{}),this.initComponent(t),this.sceneService.init(r),this.initControl()}get map(){return this.mapService.map}get loaded(){return this.sceneService.loaded}getServiceContainer(){return this.container}getSize(){return this.mapService.getSize()}getMinZoom(){return this.mapService.getMinZoom()}getMaxZoom(){return this.mapService.getMaxZoom()}getType(){return this.mapService.getType()}getMapContainer(){return this.mapService.getMapContainer()}getMapCanvasContainer(){return this.mapService.getMapCanvasContainer()}getMapService(){return this.mapService}getDebugService(){return this.debugService}exportPng(r){return gf(this,null,function*(){return this.sceneService.exportPng(r)})}exportMap(r){return gf(this,null,function*(){return this.sceneService.exportPng(r)})}registerRenderService(r){this.sceneService.loaded?new r(this).init():this.on("loaded",()=>{new r(this).init()})}setBgColor(r){this.mapService.setBgColor(r)}addLayer(r){this.loaded?this.preAddLayer(r):this.once("loaded",()=>{this.preAddLayer(r)})}preAddLayer(r){const t=Zf(this.container);if(r.setContainer(t),this.sceneService.addLayer(r),r.inited){this.initTileLayer(r);const e=this.initMask(r);this.addMask(e,r.id)}else r.on("inited",()=>{this.initTileLayer(r);const e=this.initMask(r);this.addMask(e,r.id)})}initMask(r){const{mask:t,maskfence:e,maskColor:i="#000",maskOpacity:n=0}=r.getLayerConfig();return!t||!e?void 0:new xD().source(e).shape("fill").style({color:i,opacity:n})}addMask(r,t){if(!r)return;const e=this.getLayer(t);if(e){const i=Zf(this.container);r.setContainer(i),e.addMaskLayer(r),this.sceneService.addMask(r)}else console.warn("parent layer not find!")}getPickedLayer(){return this.layerService.pickedLayerId}getLayers(){return this.layerService.getLayers()}getLayer(r){return this.layerService.getLayer(r)}getLayerByName(r){return this.layerService.getLayerByName(r)}removeLayer(r,t){return gf(this,null,function*(){yield this.layerService.remove(r,t)})}removeAllLayer(){return gf(this,null,function*(){yield this.layerService.removeAllLayers()})}render(){this.sceneService.render()}setEnableRender(r){this.layerService.setEnableRender(r)}addIconFont(r,t){this.fontService.addIconFont(r,t)}addIconFonts(r){r.forEach(([t,e])=>{this.fontService.addIconFont(t,e)})}addFontFace(r,t){this.fontService.once("fontloaded",e=>{this.emit("fontloaded",e)}),this.fontService.addFontFace(r,t)}addImage(r,t){return gf(this,null,function*(){yield this.iconService.addImage(r,t)})}hasImage(r){return this.iconService.hasImage(r)}removeImage(r){this.iconService.removeImage(r)}addIconFontGlyphs(r,t){this.fontService.addIconGlyphs(t)}addControl(r){this.controlService.addControl(r,this.container)}removeControl(r){this.controlService.removeControl(r)}getControlByName(r){return this.controlService.getControlByName(r)}addMarker(r){this.markerService.addMarker(r)}addMarkerLayer(r){this.markerService.addMarkerLayer(r)}removeMarkerLayer(r){this.markerService.removeMarkerLayer(r)}removeAllMarkers(){this.markerService.removeAllMarkers()}removeAllMakers(){console.warn("removeAllMakers 已废弃，请使用 removeAllMarkers"),this.markerService.removeAllMarkers()}addPopup(r){this.popupService.addPopup(r)}removePopup(r){this.popupService.removePopup(r)}on(r,t){var e;H_.includes(r)?(e=this.boxSelect)==null||e.on(r,t):_p.includes(r)?this.sceneService.on(r,t):this.mapService.on(r,t)}once(r,t){var e;H_.includes(r)?(e=this.boxSelect)==null||e.once(r,t):_p.includes(r)?this.sceneService.once(r,t):this.mapService.once(r,t)}emit(r,t){_p.indexOf(r)===-1?this.mapService.on(r,t):this.sceneService.emit(r,t)}off(r,t){var e;H_.includes(r)?(e=this.boxSelect)==null||e.off(r,t):_p.includes(r)?this.sceneService.off(r,t):this.mapService.off(r,t)}getZoom(){return this.mapService.getZoom()}getCenter(r){return this.mapService.getCenter(r)}setCenter(r,t){return this.mapService.setCenter(r,t)}getPitch(){return this.mapService.getPitch()}setPitch(r){return this.mapService.setPitch(r)}getRotation(){return this.mapService.getRotation()}getBounds(){return this.mapService.getBounds()}setRotation(r){this.mapService.setRotation(r)}zoomIn(){this.mapService.zoomIn()}zoomOut(){this.mapService.zoomOut()}panTo(r){this.mapService.panTo(r)}panBy(r,t){this.mapService.panBy(r,t)}getContainer(){return this.mapService.getContainer()}setZoom(r){this.mapService.setZoom(r)}fitBounds(r,t){const{fitBoundsOptions:e,animate:i}=this.sceneService.getSceneConfig();this.mapService.fitBounds(r,t||cat(uat({},e),{animate:i}))}setZoomAndCenter(r,t){this.mapService.setZoomAndCenter(r,t)}setMapStyle(r){this.mapService.setMapStyle(r)}setMapStatus(r){this.mapService.setMapStatus(r)}pixelToLngLat(r){return this.mapService.pixelToLngLat(r)}lngLatToPixel(r){return this.mapService.lngLatToPixel(r)}containerToLngLat(r){return this.mapService.containerToLngLat(r)}lngLatToContainer(r){return this.mapService.lngLatToContainer(r)}destroy(){this.sceneService.destroy()}registerPostProcessingPass(r){this.container.postProcessingPass.name=new r}enableShaderPick(){this.layerService.enableShaderPick()}diasbleShaderPick(){this.layerService.disableShaderPick()}enableBoxSelect(r=!0){this.boxSelect.enable(),r&&this.boxSelect.once("selectend",()=>{this.disableBoxSelect()})}disableBoxSelect(){this.boxSelect.disable()}static addProtocol(r,t){kg.REGISTERED_PROTOCOLS[r]=t}static removeProtocol(r){delete kg.REGISTERED_PROTOCOLS[r]}getProtocol(r){return kg.REGISTERED_PROTOCOLS[r]}startAnimate(){this.layerService.startAnimate()}stopAnimate(){this.layerService.stopAnimate()}getPointSizeRange(){return this.sceneService.getPointSizeRange()}initComponent(r){this.controlService.init({container:aB(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}initControl(){const{logoVisible:r,logoPosition:t}=this.sceneService.getSceneConfig();r&&this.addControl(new Sq({position:t}))}initTileLayer(r){r.getSource().isTile&&(r.tileLayer=new ptt(r))}},tn=function(r){return r!==null&&typeof r!="function"&&isFinite(r.length)},io=function(r,t){return tn(r)?r.indexOf(t)>-1:!1},Fr=function(r,t){if(!tn(r))return r;for(var e=[],i=0;i<r.length;i++){var n=r[i];t(n,i)&&e.push(n)}return e},QD=function(r,t){return t===void 0&&(t=[]),Fr(r,function(e){return!io(t,e)})},fat={}.toString,ua=function(r,t){return fat.call(r)==="[object "+t+"]"};const ot=function(r){return ua(r,"Function")};var K=function(r){return r==null};const q=function(r){return Array.isArray?Array.isArray(r):ua(r,"Array")},ie=function(r){var t=typeof r;return r!==null&&t==="object"||t==="function"};function I(r,t){if(r){var e;if(q(r))for(var i=0,n=r.length;i<n&&(e=t(r[i],i),e!==!1);i++);else if(ie(r)){for(var a in r)if(r.hasOwnProperty(a)&&(e=t(r[a],a),e===!1))break}}}var Du=Object.keys?function(r){return Object.keys(r)}:function(r){var t=[];return I(r,function(e,i){ot(r)&&i==="prototype"||t.push(i)}),t};function SS(r,t){var e=Du(t),i=e.length;if(K(r))return!i;for(var n=0;n<i;n+=1){var a=e[n];if(t[a]!==r[a]||!(a in r))return!1}return!0}var z0=function(r){return typeof r=="object"&&r!==null},Ra=function(r){if(!z0(r)||!ua(r,"Object"))return!1;if(Object.getPrototypeOf(r)===null)return!0;for(var t=r;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(r)===t};function Qn(r,t){if(!q(r))return null;var e;if(ot(t)&&(e=t),Ra(t)&&(e=function(n){return SS(n,t)}),e){for(var i=0;i<r.length;i+=1)if(e(r[i]))return r[i]}return null}function AS(r,t,e){e===void 0&&(e=0);for(var i=e;i<r.length;i++)if(t(r[i],i))return i;return-1}var JD=function(r,t){for(var e=null,i=0;i<r.length;i++){var n=r[i],a=n[t];if(!K(a)){q(a)?e=a[0]:e=a;break}}return e},en=function(r){if(!q(r))return[];for(var t=[],e=0;e<r.length;e++)t=t.concat(r[e]);return t},t5=function(r,t){if(t===void 0&&(t=[]),!q(r))t.push(r);else for(var e=0;e<r.length;e+=1)t5(r[e],t);return t};const rn=function(r){if(q(r))return r.reduce(function(t,e){return Math.max(t,e)},r[0])},Tn=function(r){if(q(r))return r.reduce(function(t,e){return Math.min(t,e)},r[0])};var TS=function(r){var t=r.filter(function(o){return!isNaN(o)});if(!t.length)return{min:0,max:0};if(q(r[0])){for(var e=[],i=0;i<r.length;i++)e=e.concat(r[i]);t=e}var n=rn(t),a=Tn(t);return{min:a,max:n}},e5=Array.prototype,dat=e5.splice,vat=e5.indexOf,pat=function(r){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];for(var i=0;i<t.length;i++)for(var n=t[i],a=-1;(a=vat.call(r,n))>-1;)dat.call(r,a,1);return r},gat=Array.prototype.splice,r5=function(t,e){if(!tn(t))return[];for(var i=t?e.length:0,n=i-1;i--;){var a=void 0,o=e[i];(i===n||o!==a)&&(a=o,gat.call(t,o,1))}return t},Qr=function(r,t,e){if(!q(r)&&!Ra(r))return r;var i=e;return I(r,function(n,a){i=t(i,n,a)}),i},i5=function(r,t){var e=[];if(!tn(r))return e;for(var i=-1,n=[],a=r.length;++i<a;){var o=r[i];t(o,i,r)&&(e.push(o),n.push(i))}return r5(r,n),e};const mt=function(r){return ua(r,"String")};function n5(r,t){var e;if(ot(t))e=function(n,a){return t(n)-t(a)};else{var i=[];mt(t)?i.push(t):q(t)&&(i=t),e=function(n,a){for(var o=0;o<i.length;o+=1){var s=i[o];if(n[s]>a[s])return 1;if(n[s]<a[s])return-1}return 0}}return r.sort(e),r}function as(r,t){t===void 0&&(t=new Map);var e=[];if(Array.isArray(r))for(var i=0,n=r.length;i<n;i++){var a=r[i];t.has(a)||(e.push(a),t.set(a,!0))}return e}var mat=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return as([].concat.apply([],r))};const ea=function(r,t){for(var e=[],i={},n=0;n<r.length;n++){var a=r[n],o=a[t];if(!K(o)){q(o)||(o=[o]);for(var s=0;s<o.length;s++){var l=o[s];i[l]||(e.push(l),i[l]=!0)}}}return e};function Ki(r){if(tn(r))return r[0]}function cr(r){if(tn(r)){var t=r;return t[t.length-1]}}function yat(r,t){return q(r)||mt(r)?r[0]===t:!1}function _at(r,t){return q(r)||mt(r)?r[r.length-1]===t:!1}var jm=function(r,t){for(var e=0;e<r.length;e++)if(!t(r[e],e))return!1;return!0},Tv=function(r,t){for(var e=0;e<r.length;e++)if(t(r[e],e))return!0;return!1},xat=Object.prototype.hasOwnProperty;function Qi(r,t){if(!t||!q(r))return{};for(var e={},i=ot(t)?t:function(s){return s[t]},n,a=0;a<r.length;a++){var o=r[a];n=i(o),xat.call(e,n)?e[n].push(o):e[n]=[o]}return e}function bS(r,t){if(!t)return{0:r};if(!ot(t)){var e=q(t)?t:t.replace(/\s+/g,"").split("*");t=function(i){for(var n="_",a=0,o=e.length;a<o;a++)n+=i[e[a]]&&i[e[a]].toString();return n}}return Qi(r,t)}const a5=function(r,t){if(!t)return[r];var e=bS(r,t),i=[];for(var n in e)i.push(e[n]);return i};function Cat(r,t){return r["_wrap_"+t]}function Eat(r,t){if(r["_wrap_"+t])return r["_wrap_"+t];var e=function(i){r[t](i)};return r["_wrap_"+t]=e,e}var bM={};function Sat(r){var t=bM[r];if(!t){for(var e=r.toString(16),i=e.length;i<6;i++)e="0"+e;t="#"+e,bM[r]=t}return t}function Aat(r){var t=0,e=0,i=0,n=0;return q(r)?r.length===1?t=e=i=n=r[0]:r.length===2?(t=i=r[0],e=n=r[1]):r.length===3?(t=r[0],e=n=r[1],i=r[2]):(t=r[0],e=r[1],i=r[2],n=r[3]):t=e=i=n=r,{r1:t,r2:e,r3:i,r4:n}}var Oe=function(r,t,e){return r<t?t:r>e?e:r},jg=function(r,t){var e=t.toString(),i=e.indexOf(".");if(i===-1)return Math.round(r);var n=e.substr(i+1).length;return n>20&&(n=20),parseFloat(r.toFixed(n))},Tt=function(r){return ua(r,"Number")},Tat=function(r){return Tt(r)&&r%1!==0},bat=function(r){return Tt(r)&&r%2===0},wat=Number.isInteger?Number.isInteger:function(r){return Tt(r)&&r%1===0},Rat=function(r){return Tt(r)&&r<0},Mat=1e-5;function wr(r,t,e){return e===void 0&&(e=Mat),Math.abs(r-t)<e}var Iat=function(r){return Tt(r)&&r%2!==0},Lat=function(r){return Tt(r)&&r>0};const wS=function(r,t){if(q(r)){for(var e,i=-1/0,n=0;n<r.length;n++){var a=r[n],o=ot(t)?t(a):a[t];o>i&&(e=a,i=o)}return e}},o5=function(r,t){if(q(r)){for(var e,i=1/0,n=0;n<r.length;n++){var a=r[n],o=ot(t)?t(a):a[t];o<i&&(e=a,i=o)}return e}};var bv=function(r,t){return(r%t+t)%t},Oat=180/Math.PI,Pat=function(r){return Oat*r};const Fat=parseInt;var Bat=Math.PI/180,wv=function(r){return Bat*r};const _o=function(r,t){return r.hasOwnProperty(t)};var wh=Object.values?function(r){return Object.values(r)}:function(r){var t=[];return I(r,function(e,i){ot(r)&&i==="prototype"||t.push(e)}),t};const Dat=function(r,t){return io(wh(r),t)},cl=function(r){return K(r)?"":r.toString()};var hl=function(r){return cl(r).toLowerCase()},Nat=function(r){var t=cl(r);return t.charAt(0).toLowerCase()+t.substring(1)},kat=function(r){return cl(r).toUpperCase()},fl=function(r){var t=cl(r);return t.charAt(0).toUpperCase()+t.substring(1)},Uat={}.toString,s5=function(r){return Uat.call(r).replace(/^\[object /,"").replace(/]$/,"")},zat=function(r){return ua(r,"Arguments")},os=function(r){return ua(r,"Boolean")},RS=function(r){return ua(r,"Date")},Hat=function(r){return ua(r,"Error")};function $at(r){return Tt(r)&&isFinite(r)}var l5=function(r){return r===null},Wat=Object.prototype,u5=function(r){var t=r&&r.constructor,e=typeof t=="function"&&t.prototype||Wat;return r===e},Vat=function(r){return ua(r,"RegExp")},zr=function(r){return r===void 0},MS=function(r){return r instanceof Element||r instanceof HTMLDocument};function c5(r){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,16)};return t(r)}function h5(r){var t=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||clearTimeout;t(r)}function $_(r,t){for(var e in t)t.hasOwnProperty(e)&&e!=="constructor"&&t[e]!==void 0&&(r[e]=t[e])}function ne(r,t,e,i){return t&&$_(r,t),e&&$_(r,e),i&&$_(r,i),r}var Gat=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];for(var e=r[0],i=1;i<r.length;i++){var n=r[i];ot(n)&&(n=n.prototype),ne(e.prototype,n)}},Rr=function(r){if(typeof r!="object"||r===null)return r;var t;if(q(r)){t=[];for(var e=0,i=r.length;e<i;e++)typeof r[e]=="object"&&r[e]!=null?t[e]=Rr(r[e]):t[e]=r[e]}else{t={};for(var n in r)typeof r[n]=="object"&&r[n]!=null?t[n]=Rr(r[n]):t[n]=r[n]}return t};function IS(r,t,e){var i;return function(){var n=this,a=arguments,o=function(){i=null,e||r.apply(n,a)},s=e&&!i;clearTimeout(i),i=setTimeout(o,t),s&&r.apply(n,a)}}const Nu=function(r,t){if(!ot(r))throw new TypeError("Expected a function");var e=function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];var a=t?t.apply(this,i):i[0],o=e.cache;if(o.has(a))return o.get(a);var s=r.apply(this,i);return o.set(a,s),s};return e.cache=new Map,e};var Xat=5;function f5(r,t,e,i){e=e||0,i=i||Xat;for(var n in t)if(t.hasOwnProperty(n)){var a=t[n];a!==null&&Ra(a)?(Ra(r[n])||(r[n]={}),e<i?f5(r[n],a,e+1,i):r[n]=t[n]):q(a)?(r[n]=[],r[n]=r[n].concat(a)):a!==void 0&&(r[n]=a)}}var at=function(r){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];for(var i=0;i<t.length;i+=1)f5(r,t[i]);return r},Yat=function(r,t,e,i){ot(t)||(e=t,t=r,r=function(){});var n=Object.create?function(o,s){return Object.create(o,{constructor:{value:s}})}:function(o,s){function l(){}l.prototype=o;var u=new l;return u.constructor=s,u},a=n(t.prototype,r);return r.prototype=ne(a,r.prototype),r.superclass=n(t.prototype,t),ne(a,e),ne(r,i),r},LS=function(r,t){if(!tn(r))return-1;var e=Array.prototype.indexOf;if(e)return e.call(r,t);for(var i=-1,n=0;n<r.length;n++)if(r[n]===t){i=n;break}return i},jat=Object.prototype.hasOwnProperty;function Mi(r){if(K(r))return!0;if(tn(r))return!r.length;var t=s5(r);if(t==="Map"||t==="Set")return!r.size;if(u5(r))return!Object.keys(r).length;for(var e in r)if(jat.call(r,e))return!1;return!0}var qt=function(r,t){if(r===t)return!0;if(!r||!t||mt(r)||mt(t))return!1;if(tn(r)||tn(t)){if(r.length!==t.length)return!1;for(var e=!0,i=0;i<r.length&&(e=qt(r[i],t[i]),!!e);i++);return e}if(z0(r)||z0(t)){var n=Object.keys(r),a=Object.keys(t);if(n.length!==a.length)return!1;for(var e=!0,i=0;i<n.length&&(e=qt(r[n[i]],t[n[i]]),!!e);i++);return e}return!1};const Zat=function(r,t,e){return ot(e)?!!e(r,t):qt(r,t)};var Ne=function(r,t){if(!tn(r))return r;for(var e=[],i=0;i<r.length;i++){var n=r[i];e.push(t(n,i))}return e},qat=function(r){return r};const d5=function(r,t){t===void 0&&(t=qat);var e={};return ie(r)&&!K(r)&&Object.keys(r).forEach(function(i){e[i]=t(r[i],i)}),e},P=function(r,t,e){for(var i=0,n=mt(t)?t.split("."):t;r&&i<n.length;)r=r[n[i++]];return r===void 0||i<n.length?e:r},or=function(r,t,e){var i=r,n=mt(t)?t.split("."):t;return n.forEach(function(a,o){o<n.length-1?(ie(i[a])||(i[a]=Tt(n[o+1])?[]:{}),i=i[a]):i[a]=e}),r};var Kat=Object.prototype.hasOwnProperty;const Ma=function(r,t){if(r===null||!Ra(r))return{};var e={};return I(t,function(i){Kat.call(r,i)&&(e[i]=r[i])}),e},Rv=function(r,t){return Qr(r,function(e,i,n){return t.includes(n)||(e[n]=i),e},{})},Zm=function(r,t,e){var i,n,a,o,s=0;e||(e={});var l=function(){s=e.leading===!1?0:Date.now(),i=null,o=r.apply(n,a),i||(n=a=null)},u=function(){var c=Date.now();!s&&e.leading===!1&&(s=c);var h=t-(c-s);return n=this,a=arguments,h<=0||h>t?(i&&(clearTimeout(i),i=null),s=c,o=r.apply(n,a),i||(n=a=null)):!i&&e.trailing!==!1&&(i=setTimeout(l,h)),o};return u.cancel=function(){clearTimeout(i),s=0,i=n=a=null},u},v5=function(r){return tn(r)?Array.prototype.slice.call(r):[]};var zp={};const ln=function(r){return r=r||"g",zp[r]?zp[r]+=1:zp[r]=1,r+zp[r]},Go=function(){},Qat=function(r){return r};function xr(r){return K(r)?0:tn(r)?r.length:Object.keys(r).length}var Hp;const Df=Nu(function(r,t){t===void 0&&(t={});var e=t.fontSize,i=t.fontFamily,n=t.fontWeight,a=t.fontStyle,o=t.fontVariant;return Hp||(Hp=document.createElement("canvas").getContext("2d")),Hp.font=[a,o,n,e+"px",i].join(" "),Hp.measureText(mt(r)?r:"").width},function(r,t){return t===void 0&&(t={}),md([r],wh(t)).join("")}),p5=function(r,t,e,i){i===void 0&&(i="...");var n=16,a=Df(i,e),o=mt(r)?r:cl(r),s=t,l=[],u,c;if(Df(r,e)<=t)return r;for(;u=o.substr(0,n),c=Df(u,e),!(c+a>s&&c>s);)if(l.push(u),s-=c,o=o.substr(n),!o)return l.join("");for(;u=o.substr(0,1),c=Df(u,e),!(c+a>s);)if(l.push(u),s-=c,o=o.substr(1),!o)return l.join("");return""+l.join("")+i};var g5=function(){function r(){this.map={}}return r.prototype.has=function(t){return this.map[t]!==void 0},r.prototype.get=function(t,e){var i=this.map[t];return i===void 0?e:i},r.prototype.set=function(t,e){this.map[t]=e},r.prototype.clear=function(){this.map={}},r.prototype.delete=function(t){delete this.map[t]},r.prototype.size=function(){return Object.keys(this.map).length},r}();const Jat=Object.freeze(Object.defineProperty({__proto__:null,Cache:g5,assign:ne,augment:Gat,clamp:Oe,clearAnimationFrame:h5,clone:Rr,contains:io,debounce:IS,deepMix:at,difference:QD,each:I,endsWith:_at,every:jm,extend:Yat,filter:Fr,find:Qn,findIndex:AS,firstValue:JD,fixedBase:jg,flatten:en,flattenDeep:t5,forIn:I,get:P,getEllipsisText:p5,getRange:TS,getType:s5,getWrapBehavior:Cat,group:a5,groupBy:Qi,groupToMap:bS,has:_o,hasKey:_o,hasValue:Dat,head:Ki,identity:Qat,includes:io,indexOf:LS,isArguments:zat,isArray:q,isArrayLike:tn,isBoolean:os,isDate:RS,isDecimal:Tat,isElement:MS,isEmpty:Mi,isEqual:qt,isEqualWith:Zat,isError:Hat,isEven:bat,isFinite:$at,isFunction:ot,isInteger:wat,isMatch:SS,isNegative:Rat,isNil:K,isNull:l5,isNumber:Tt,isNumberEqual:wr,isObject:ie,isObjectLike:z0,isOdd:Iat,isPlainObject:Ra,isPositive:Lat,isPrototype:u5,isRegExp:Vat,isString:mt,isType:ua,isUndefined:zr,keys:Du,last:cr,lowerCase:hl,lowerFirst:Nat,map:Ne,mapValues:d5,max:rn,maxBy:wS,measureTextWidth:Df,memoize:Nu,min:Tn,minBy:o5,mix:ne,mod:bv,noop:Go,number2color:Sat,omit:Rv,parseRadius:Aat,pick:Ma,pull:pat,pullAt:r5,reduce:Qr,remove:i5,requestAnimationFrame:c5,set:or,size:xr,some:Tv,sortBy:n5,startsWith:yat,substitute:Ah,throttle:Zm,toArray:v5,toDegree:Pat,toInteger:Fat,toRadian:wv,toString:cl,union:mat,uniq:as,uniqueId:ln,upperCase:kat,upperFirst:fl,values:wh,valuesOfKey:ea,wrapBehavior:Eat},Symbol.toStringTag,{value:"Module"}));var ir;(function(r){r.FORE="fore",r.MID="mid",r.BG="bg"})(ir||(ir={}));var nt;(function(r){r.TOP="top",r.TOP_LEFT="top-left",r.TOP_RIGHT="top-right",r.RIGHT="right",r.RIGHT_TOP="right-top",r.RIGHT_BOTTOM="right-bottom",r.LEFT="left",r.LEFT_TOP="left-top",r.LEFT_BOTTOM="left-bottom",r.BOTTOM="bottom",r.BOTTOM_LEFT="bottom-left",r.BOTTOM_RIGHT="bottom-right",r.RADIUS="radius",r.CIRCLE="circle",r.NONE="none"})(nt||(nt={}));var Ar;(function(r){r.AXIS="axis",r.GRID="grid",r.LEGEND="legend",r.TOOLTIP="tooltip",r.ANNOTATION="annotation",r.SLIDER="slider",r.SCROLLBAR="scrollbar",r.OTHER="other"})(Ar||(Ar={}));var Fc={FORE:3,MID:2,BG:1},Ut;(function(r){r.BEFORE_RENDER="beforerender",r.AFTER_RENDER="afterrender",r.BEFORE_PAINT="beforepaint",r.AFTER_PAINT="afterpaint",r.BEFORE_CHANGE_DATA="beforechangedata",r.AFTER_CHANGE_DATA="afterchangedata",r.BEFORE_CLEAR="beforeclear",r.AFTER_CLEAR="afterclear",r.BEFORE_DESTROY="beforedestroy",r.BEFORE_CHANGE_SIZE="beforechangesize",r.AFTER_CHANGE_SIZE="afterchangesize"})(Ut||(Ut={}));var Vs;(function(r){r.BEFORE_DRAW_ANIMATE="beforeanimate",r.AFTER_DRAW_ANIMATE="afteranimate",r.BEFORE_RENDER_LABEL="beforerenderlabel",r.AFTER_RENDER_LABEL="afterrenderlabel"})(Vs||(Vs={}));var Bi;(function(r){r.MOUSE_ENTER="plot:mouseenter",r.MOUSE_DOWN="plot:mousedown",r.MOUSE_MOVE="plot:mousemove",r.MOUSE_UP="plot:mouseup",r.MOUSE_LEAVE="plot:mouseleave",r.TOUCH_START="plot:touchstart",r.TOUCH_MOVE="plot:touchmove",r.TOUCH_END="plot:touchend",r.TOUCH_CANCEL="plot:touchcancel",r.CLICK="plot:click",r.DBLCLICK="plot:dblclick",r.CONTEXTMENU="plot:contextmenu",r.LEAVE="plot:leave",r.ENTER="plot:enter"})(Bi||(Bi={}));var H0;(function(r){r.ACTIVE="active",r.INACTIVE="inactive",r.SELECTED="selected",r.DEFAULT="default"})(H0||(H0={}));var Cc=["color","shape","size"],Se="_origin",wM=1,RM=1,MM=.25,m5={};function tot(r){var t=m5[r];if(!t)throw new Error("G engine '".concat(r,"' is not exist, please register it at first."));return t}function y5(r,t){m5[r]=t}function ac(r,t,e){if(r){if(typeof r.addEventListener=="function")return r.addEventListener(t,e,!1),{remove:function(){r.removeEventListener(t,e,!1)}};if(typeof r.attachEvent=="function")return r.attachEvent("on"+t,e),{remove:function(){r.detachEvent("on"+t,e)}}}}function Wi(r,t,e){var i;try{i=window.getComputedStyle?window.getComputedStyle(r,null)[t]:r.style[t]}catch{}finally{i=i===void 0?e:i}return i}function eot(r,t){var e=Wi(r,"height",t);return e==="auto"&&(e=r.offsetHeight),parseFloat(e)}function rot(r,t){var e=eot(r,t),i=parseFloat(Wi(r,"borderTopWidth"))||0,n=parseFloat(Wi(r,"paddingTop"))||0,a=parseFloat(Wi(r,"paddingBottom"))||0,o=parseFloat(Wi(r,"borderBottomWidth"))||0,s=parseFloat(Wi(r,"marginTop"))||0,l=parseFloat(Wi(r,"marginBottom"))||0;return e+i+o+n+a+s+l}function iot(r,t){var e=Wi(r,"width",t);return e==="auto"&&(e=r.offsetWidth),parseFloat(e)}function not(r,t){var e=iot(r,t),i=parseFloat(Wi(r,"borderLeftWidth"))||0,n=parseFloat(Wi(r,"paddingLeft"))||0,a=parseFloat(Wi(r,"paddingRight"))||0,o=parseFloat(Wi(r,"borderRightWidth"))||0,s=parseFloat(Wi(r,"marginRight"))||0,l=parseFloat(Wi(r,"marginLeft"))||0;return e+i+o+n+a+l+s}function be(r,t){if(r)for(var e in t)t.hasOwnProperty(e)&&(r.style[e]=t[e]);return r}function aot(r){var t=getComputedStyle(r);return{width:(r.clientWidth||parseInt(t.width,10))-parseInt(t.paddingLeft,10)-parseInt(t.paddingRight,10),height:(r.clientHeight||parseInt(t.height,10))-parseInt(t.paddingTop,10)-parseInt(t.paddingBottom,10)}}function IM(r){return typeof r=="number"&&!isNaN(r)}function LM(r,t,e,i){var n=e,a=i;if(t){var o=aot(r);n=o.width?o.width:n,a=o.height?o.height:a}return{width:Math.max(IM(n)?n:wM,wM),height:Math.max(IM(a)?a:RM,RM)}}function oot(r){var t=r.parentNode;t&&t.removeChild(r)}var sot="*",ku=function(){function r(){this._events={}}return r.prototype.on=function(t,e,i){return this._events[t]||(this._events[t]=[]),this._events[t].push({callback:e,once:!!i}),this},r.prototype.once=function(t,e){return this.on(t,e,!0)},r.prototype.emit=function(t){for(var e=this,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var a=this._events[t]||[],o=this._events[sot]||[],s=function(l){for(var u=l.length,c=0;c<u;c++)if(l[c]){var h=l[c],f=h.callback,d=h.once;d&&(l.splice(c,1),l.length===0&&delete e._events[t],u--,c--),f.apply(e,i)}};s(a),s(o)},r.prototype.off=function(t,e){if(!t)this._events={};else if(!e)delete this._events[t];else{for(var i=this._events[t]||[],n=i.length,a=0;a<n;a++)i[a].callback===e&&(i.splice(a,1),n--,a--);i.length===0&&delete this._events[t]}return this},r.prototype.getEvents=function(){return this._events},r}(),OS=function(r){N(t,r);function t(e){var i=r.call(this)||this;i.destroyed=!1;var n=e.visible,a=n===void 0?!0:n;return i.visible=a,i}return t.prototype.show=function(){var e=this.visible;e||this.changeVisible(!0)},t.prototype.hide=function(){var e=this.visible;e&&this.changeVisible(!1)},t.prototype.destroy=function(){this.off(),this.destroyed=!0},t.prototype.changeVisible=function(e){this.visible!==e&&(this.visible=e)},t}(ku),Kf=`	
\v\f\r   ᠎             　\u2028\u2029`,lot=new RegExp("([a-z])["+Kf+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+Kf+"]*,?["+Kf+"]*)+)","ig"),uot=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+Kf+"]*,?["+Kf+"]*","ig"),Ec=function(r){if(!r)return null;if(q(r))return r;var t={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},e=[];return String(r).replace(lot,function(i,n,a){var o=[],s=n.toLowerCase();if(a.replace(uot,function(l,u){u&&o.push(+u)}),s==="m"&&o.length>2&&(e.push([n].concat(o.splice(0,2))),s="l",n=n==="m"?"l":"L"),s==="o"&&o.length===1&&e.push([n,o[0]]),s==="r")e.push([n].concat(o));else for(;o.length>=t[s]&&(e.push([n].concat(o.splice(0,t[s]))),!!t[s]););return r}),e},Mx=function(r,t){for(var e=[],i=0,n=r.length;n-2*!t>i;i+=2){var a=[{x:+r[i-2],y:+r[i-1]},{x:+r[i],y:+r[i+1]},{x:+r[i+2],y:+r[i+3]},{x:+r[i+4],y:+r[i+5]}];t?i?n-4===i?a[3]={x:+r[0],y:+r[1]}:n-2===i&&(a[2]={x:+r[0],y:+r[1]},a[3]={x:+r[2],y:+r[3]}):a[0]={x:+r[n-2],y:+r[n-1]}:n-4===i?a[3]=a[2]:i||(a[0]={x:+r[i],y:+r[i+1]}),e.push(["C",(-a[0].x+6*a[1].x+a[2].x)/6,(-a[0].y+6*a[1].y+a[2].y)/6,(a[1].x+6*a[2].x-a[3].x)/6,(a[1].y+6*a[2].y-a[3].y)/6,a[2].x,a[2].y])}return e},$p=function(r,t,e,i,n){var a=[];if(n===null&&i===null&&(i=e),r=+r,t=+t,e=+e,i=+i,n!==null){var o=Math.PI/180,s=r+e*Math.cos(-i*o),l=r+e*Math.cos(-n*o),u=t+e*Math.sin(-i*o),c=t+e*Math.sin(-n*o);a=[["M",s,u],["A",e,e,0,+(n-i>180),0,l,c]]}else a=[["M",r,t],["m",0,-i],["a",e,i,0,1,1,0,2*i],["a",e,i,0,1,1,0,-2*i],["z"]];return a},Ix=function(r){if(r=Ec(r),!r||!r.length)return[["M",0,0]];var t=[],e=0,i=0,n=0,a=0,o=0,s,l;r[0][0]==="M"&&(e=+r[0][1],i=+r[0][2],n=e,a=i,o++,t[0]=["M",e,i]);for(var u=r.length===3&&r[0][0]==="M"&&r[1][0].toUpperCase()==="R"&&r[2][0].toUpperCase()==="Z",c=void 0,h=void 0,f=o,d=r.length;f<d;f++){if(t.push(c=[]),h=r[f],s=h[0],s!==s.toUpperCase())switch(c[0]=s.toUpperCase(),c[0]){case"A":c[1]=h[1],c[2]=h[2],c[3]=h[3],c[4]=h[4],c[5]=h[5],c[6]=+h[6]+e,c[7]=+h[7]+i;break;case"V":c[1]=+h[1]+i;break;case"H":c[1]=+h[1]+e;break;case"R":l=[e,i].concat(h.slice(1));for(var v=2,p=l.length;v<p;v++)l[v]=+l[v]+e,l[++v]=+l[v]+i;t.pop(),t=t.concat(Mx(l,u));break;case"O":t.pop(),l=$p(e,i,h[1],h[2]),l.push(l[0]),t=t.concat(l);break;case"U":t.pop(),t=t.concat($p(e,i,h[1],h[2],h[3])),c=["U"].concat(t[t.length-1].slice(-2));break;case"M":n=+h[1]+e,a=+h[2]+i;break;default:for(var v=1,p=h.length;v<p;v++)c[v]=+h[v]+(v%2?e:i)}else if(s==="R")l=[e,i].concat(h.slice(1)),t.pop(),t=t.concat(Mx(l,u)),c=["R"].concat(h.slice(-2));else if(s==="O")t.pop(),l=$p(e,i,h[1],h[2]),l.push(l[0]),t=t.concat(l);else if(s==="U")t.pop(),t=t.concat($p(e,i,h[1],h[2],h[3])),c=["U"].concat(t[t.length-1].slice(-2));else for(var g=0,m=h.length;g<m;g++)c[g]=h[g];if(s=s.toUpperCase(),s!=="O")switch(c[0]){case"Z":e=+n,i=+a;break;case"H":e=c[1];break;case"V":i=c[1];break;case"M":n=c[c.length-2],a=c[c.length-1];break;default:e=c[c.length-2],i=c[c.length-1]}}return t},Wp=function(r,t,e,i){return[r,t,e,i,e,i]},OM=function(r,t,e,i,n,a){var o=.3333333333333333,s=2/3;return[o*r+s*e,o*t+s*i,o*n+s*e,o*a+s*i,n,a]},_5=function(r,t,e,i,n,a,o,s,l,u){e===i&&(e+=1);var c=Math.PI*120/180,h=Math.PI/180*(+n||0),f=[],d,v,p,g,m,y=function(ce,_e,Ve){var Fi=ce*Math.cos(Ve)-_e*Math.sin(Ve),dn=ce*Math.sin(Ve)+_e*Math.cos(Ve);return{x:Fi,y:dn}};if(u)v=u[0],p=u[1],g=u[2],m=u[3];else{d=y(r,t,-h),r=d.x,t=d.y,d=y(s,l,-h),s=d.x,l=d.y,r===s&&t===l&&(s+=1,l+=1);var _=(r-s)/2,x=(t-l)/2,C=_*_/(e*e)+x*x/(i*i);C>1&&(C=Math.sqrt(C),e=C*e,i=C*i);var A=e*e,b=i*i,R=(a===o?-1:1)*Math.sqrt(Math.abs((A*b-A*x*x-b*_*_)/(A*x*x+b*_*_)));g=R*e*x/i+(r+s)/2,m=R*-i*_/e+(t+l)/2,v=Math.asin(((t-m)/i).toFixed(9)),p=Math.asin(((l-m)/i).toFixed(9)),v=r<g?Math.PI-v:v,p=s<g?Math.PI-p:p,v<0&&(v=Math.PI*2+v),p<0&&(p=Math.PI*2+p),o&&v>p&&(v=v-Math.PI*2),!o&&p>v&&(p=p-Math.PI*2)}var M=p-v;if(Math.abs(M)>c){var O=p,F=s,D=l;p=v+c*(o&&p>v?1:-1),s=g+e*Math.cos(p),l=m+i*Math.sin(p),f=_5(s,l,e,i,n,0,o,F,D,[p,O,g,m])}M=p-v;var H=Math.cos(v),j=Math.sin(v),$=Math.cos(p),k=Math.sin(p),V=Math.tan(M/4),Q=4/3*e*V,Y=4/3*i*V,tt=[r,t],et=[r+Q*j,t-Y*H],dt=[s+Q*k,l-Y*$],Et=[s,l];if(et[0]=2*tt[0]-et[0],et[1]=2*tt[1]-et[1],u)return[et,dt,Et].concat(f);f=[et,dt,Et].concat(f).join().split(",");for(var ht=[],vt=0,It=f.length;vt<It;vt++)ht[vt]=vt%2?y(f[vt-1],f[vt],h).y:y(f[vt],f[vt+1],h).x;return ht},Lx=function(r,t){var e=Ix(r),i=t&&Ix(t),n={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},a={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},o=[],s=[],l="",u="",c,h=function(_,x,C){var A,b;if(!_)return["C",x.x,x.y,x.x,x.y,x.x,x.y];switch(!(_[0]in{T:1,Q:1})&&(x.qx=x.qy=null),_[0]){case"M":x.X=_[1],x.Y=_[2];break;case"A":_=["C"].concat(_5.apply(0,[x.x,x.y].concat(_.slice(1))));break;case"S":C==="C"||C==="S"?(A=x.x*2-x.bx,b=x.y*2-x.by):(A=x.x,b=x.y),_=["C",A,b].concat(_.slice(1));break;case"T":C==="Q"||C==="T"?(x.qx=x.x*2-x.qx,x.qy=x.y*2-x.qy):(x.qx=x.x,x.qy=x.y),_=["C"].concat(OM(x.x,x.y,x.qx,x.qy,_[1],_[2]));break;case"Q":x.qx=_[1],x.qy=_[2],_=["C"].concat(OM(x.x,x.y,_[1],_[2],_[3],_[4]));break;case"L":_=["C"].concat(Wp(x.x,x.y,_[1],_[2]));break;case"H":_=["C"].concat(Wp(x.x,x.y,_[1],x.y));break;case"V":_=["C"].concat(Wp(x.x,x.y,x.x,_[1]));break;case"Z":_=["C"].concat(Wp(x.x,x.y,x.X,x.Y));break}return _},f=function(_,x){if(_[x].length>7){_[x].shift();for(var C=_[x];C.length;)o[x]="A",i&&(s[x]="A"),_.splice(x++,0,["C"].concat(C.splice(0,6)));_.splice(x,1),c=Math.max(e.length,i&&i.length||0)}},d=function(_,x,C,A,b){_&&x&&_[b][0]==="M"&&x[b][0]!=="M"&&(x.splice(b,0,["M",A.x,A.y]),C.bx=0,C.by=0,C.x=_[b][1],C.y=_[b][2],c=Math.max(e.length,i&&i.length||0))};c=Math.max(e.length,i&&i.length||0);for(var v=0;v<c;v++){e[v]&&(l=e[v][0]),l!=="C"&&(o[v]=l,v&&(u=o[v-1])),e[v]=h(e[v],n,u),o[v]!=="A"&&l==="C"&&(o[v]="C"),f(e,v),i&&(i[v]&&(l=i[v][0]),l!=="C"&&(s[v]=l,v&&(u=s[v-1])),i[v]=h(i[v],a,u),s[v]!=="A"&&l==="C"&&(s[v]="C"),f(i,v)),d(e,i,n,a,v),d(i,e,a,n,v);var p=e[v],g=i&&i[v],m=p.length,y=i&&g.length;n.x=p[m-2],n.y=p[m-1],n.bx=parseFloat(p[m-4])||n.x,n.by=parseFloat(p[m-3])||n.y,a.bx=i&&(parseFloat(g[y-4])||a.x),a.by=i&&(parseFloat(g[y-3])||a.y),a.x=i&&g[y-2],a.y=i&&g[y-1]}return i?[e,i]:e},cot=/,?([a-z]),?/gi,x5=function(r){return r.join(",").replace(cot,"$1")},PM=function(r,t,e,i,n){var a=-3*t+9*e-9*i+3*n,o=r*a+6*t-12*e+6*i;return r*o-3*t+3*e},FM=function(r,t,e,i,n,a,o,s,l){l===null&&(l=1),l=l>1?1:l<0?0:l;for(var u=l/2,c=12,h=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],f=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],d=0,v=0;v<c;v++){var p=u*h[v]+u,g=PM(p,r,e,n,o),m=PM(p,t,i,a,s),y=g*g+m*m;d+=f[v]*Math.sqrt(y)}return u*d},hot=function(r,t,e,i,n,a,o,s){for(var l=[],u=[[],[]],c,h,f,d,v=0;v<2;++v){if(v===0?(h=6*r-12*e+6*n,c=-3*r+9*e-9*n+3*o,f=3*e-3*r):(h=6*t-12*i+6*a,c=-3*t+9*i-9*a+3*s,f=3*i-3*t),Math.abs(c)<1e-12){if(Math.abs(h)<1e-12)continue;d=-f/h,d>0&&d<1&&l.push(d);continue}var p=h*h-4*f*c,g=Math.sqrt(p);if(!(p<0)){var m=(-h+g)/(2*c);m>0&&m<1&&l.push(m);var y=(-h-g)/(2*c);y>0&&y<1&&l.push(y)}}for(var _=l.length,x=_,C;_--;)d=l[_],C=1-d,u[0][_]=C*C*C*r+3*C*C*d*e+3*C*d*d*n+d*d*d*o,u[1][_]=C*C*C*t+3*C*C*d*i+3*C*d*d*a+d*d*d*s;return u[0][x]=r,u[1][x]=t,u[0][x+1]=o,u[1][x+1]=s,u[0].length=u[1].length=x+2,{min:{x:Math.min.apply(0,u[0]),y:Math.min.apply(0,u[1])},max:{x:Math.max.apply(0,u[0]),y:Math.max.apply(0,u[1])}}},fot=function(r,t,e,i,n,a,o,s){if(!(Math.max(r,e)<Math.min(n,o)||Math.min(r,e)>Math.max(n,o)||Math.max(t,i)<Math.min(a,s)||Math.min(t,i)>Math.max(a,s))){var l=(r*i-t*e)*(n-o)-(r-e)*(n*s-a*o),u=(r*i-t*e)*(a-s)-(t-i)*(n*s-a*o),c=(r-e)*(a-s)-(t-i)*(n-o);if(c){var h=l/c,f=u/c,d=+h.toFixed(2),v=+f.toFixed(2);if(!(d<+Math.min(r,e).toFixed(2)||d>+Math.max(r,e).toFixed(2)||d<+Math.min(n,o).toFixed(2)||d>+Math.max(n,o).toFixed(2)||v<+Math.min(t,i).toFixed(2)||v>+Math.max(t,i).toFixed(2)||v<+Math.min(a,s).toFixed(2)||v>+Math.max(a,s).toFixed(2)))return{x:h,y:f}}}},As=function(r,t,e){return t>=r.x&&t<=r.x+r.width&&e>=r.y&&e<=r.y+r.height},C5=function(r,t,e,i,n){if(n)return[["M",+r+ +n,t],["l",e-n*2,0],["a",n,n,0,0,1,n,n],["l",0,i-n*2],["a",n,n,0,0,1,-n,n],["l",n*2-e,0],["a",n,n,0,0,1,-n,-n],["l",0,n*2-i],["a",n,n,0,0,1,n,-n],["z"]];var a=[["M",r,t],["l",e,0],["l",0,i],["l",-e,0],["z"]];return a.parsePathArray=x5,a},Ox=function(r,t,e,i){return r===null&&(r=t=e=i=0),t===null&&(t=r.y,e=r.width,i=r.height,r=r.x),{x:r,y:t,width:e,w:e,height:i,h:i,x2:r+e,y2:t+i,cx:r+e/2,cy:t+i/2,r1:Math.min(e,i)/2,r2:Math.max(e,i)/2,r0:Math.sqrt(e*e+i*i)/2,path:C5(r,t,e,i),vb:[r,t,e,i].join(" ")}},dot=function(r,t){return r=Ox(r),t=Ox(t),As(t,r.x,r.y)||As(t,r.x2,r.y)||As(t,r.x,r.y2)||As(t,r.x2,r.y2)||As(r,t.x,t.y)||As(r,t.x2,t.y)||As(r,t.x,t.y2)||As(r,t.x2,t.y2)||(r.x<t.x2&&r.x>t.x||t.x<r.x2&&t.x>r.x)&&(r.y<t.y2&&r.y>t.y||t.y<r.y2&&t.y>r.y)},BM=function(r,t,e,i,n,a,o,s){q(r)||(r=[r,t,e,i,n,a,o,s]);var l=hot.apply(null,r);return Ox(l.min.x,l.min.y,l.max.x-l.min.x,l.max.y-l.min.y)},DM=function(r,t,e,i,n,a,o,s,l){var u=1-l,c=Math.pow(u,3),h=Math.pow(u,2),f=l*l,d=f*l,v=c*r+h*3*l*e+u*3*l*l*n+d*o,p=c*t+h*3*l*i+u*3*l*l*a+d*s,g=r+2*l*(e-r)+f*(n-2*e+r),m=t+2*l*(i-t)+f*(a-2*i+t),y=e+2*l*(n-e)+f*(o-2*n+e),_=i+2*l*(a-i)+f*(s-2*a+i),x=u*r+l*e,C=u*t+l*i,A=u*n+l*o,b=u*a+l*s,R=90-Math.atan2(g-y,m-_)*180/Math.PI;return{x:v,y:p,m:{x:g,y:m},n:{x:y,y:_},start:{x,y:C},end:{x:A,y:b},alpha:R}},vot=function(r,t,e){var i=BM(r),n=BM(t);if(!dot(i,n))return e?0:[];for(var a=FM.apply(0,r),o=FM.apply(0,t),s=~~(a/8),l=~~(o/8),u=[],c=[],h={},f=e?0:[],d=0;d<s+1;d++){var v=DM.apply(0,r.concat(d/s));u.push({x:v.x,y:v.y,t:d/s})}for(var d=0;d<l+1;d++){var v=DM.apply(0,t.concat(d/l));c.push({x:v.x,y:v.y,t:d/l})}for(var d=0;d<s;d++)for(var p=0;p<l;p++){var g=u[d],m=u[d+1],y=c[p],_=c[p+1],x=Math.abs(m.x-g.x)<.001?"y":"x",C=Math.abs(_.x-y.x)<.001?"y":"x",A=fot(g.x,g.y,m.x,m.y,y.x,y.y,_.x,_.y);if(A){if(h[A.x.toFixed(4)]===A.y.toFixed(4))continue;h[A.x.toFixed(4)]=A.y.toFixed(4);var b=g.t+Math.abs((A[x]-g[x])/(m[x]-g[x]))*(m.t-g.t),R=y.t+Math.abs((A[C]-y[C])/(_[C]-y[C]))*(_.t-y.t);b>=0&&b<=1&&R>=0&&R<=1&&(e?f+=1:f.push({x:A.x,y:A.y,t1:b,t2:R}))}}return f},pot=function(r,t,e){r=Lx(r),t=Lx(t);for(var i,n,a,o,s,l,u,c,h,f,d=e?0:[],v=0,p=r.length;v<p;v++){var g=r[v];if(g[0]==="M")i=s=g[1],n=l=g[2];else{g[0]==="C"?(h=[i,n].concat(g.slice(1)),i=h[6],n=h[7]):(h=[i,n,i,n,s,l,s,l],i=s,n=l);for(var m=0,y=t.length;m<y;m++){var _=t[m];if(_[0]==="M")a=u=_[1],o=c=_[2];else{_[0]==="C"?(f=[a,o].concat(_.slice(1)),a=f[6],o=f[7]):(f=[a,o,a,o,u,c,u,c],a=u,o=c);var x=vot(h,f,e);if(e)d+=x;else{for(var C=0,A=x.length;C<A;C++)x[C].segment1=v,x[C].segment2=m,x[C].bez1=h,x[C].bez2=f;d=d.concat(x)}}}}}return d},got=function(r,t){return pot(r,t)};function mot(r,t){var e=[],i=[];function n(a,o){if(a.length===1)e.push(a[0]),i.push(a[0]);else{for(var s=[],l=0;l<a.length-1;l++)l===0&&e.push(a[0]),l===a.length-2&&i.push(a[l+1]),s[l]=[(1-o)*a[l][0]+o*a[l+1][0],(1-o)*a[l][1]+o*a[l+1][1]];n(s,o)}}return r.length&&n(r,t),{left:e,right:i.reverse()}}function yot(r,t,e){var i=[[r[1],r[2]]];e=e||2;var n=[];t[0]==="A"?(i.push(t[6]),i.push(t[7])):t[0]==="C"?(i.push([t[1],t[2]]),i.push([t[3],t[4]]),i.push([t[5],t[6]])):t[0]==="S"||t[0]==="Q"?(i.push([t[1],t[2]]),i.push([t[3],t[4]])):i.push([t[1],t[2]]);for(var a=i,o=1/e,s=0;s<e-1;s++){var l=o/(1-o*s),u=mot(a,l);n.push(u.left),a=u.right}n.push(a);var c=n.map(function(h){var f=[];return h.length===4&&(f.push("C"),f=f.concat(h[2])),h.length>=3&&(h.length===3&&f.push("Q"),f=f.concat(h[1])),h.length===2&&f.push("L"),f=f.concat(h[h.length-1]),f});return c}var _ot=function(r,t,e){if(e===1)return[[].concat(r)];var i=[];if(t[0]==="L"||t[0]==="C"||t[0]==="Q")i=i.concat(yot(r,t,e));else{var n=[].concat(r);n[0]==="M"&&(n[0]="L");for(var a=0;a<=e-1;a++)i.push(n)}return i},xot=function(r,t){if(r.length===1)return r;var e=r.length-1,i=t.length-1,n=e/i,a=[];if(r.length===1&&r[0][0]==="M"){for(var o=0;o<i-e;o++)r.push(r[0]);return r}for(var o=0;o<i;o++){var s=Math.floor(n*o);a[s]=(a[s]||0)+1}var l=a.reduce(function(u,c,h){return h===e?u.concat(r[e]):u.concat(_ot(r[h],r[h+1],c))},[]);return l.unshift(r[0]),(t[i]==="Z"||t[i]==="z")&&l.push("Z"),l},Cot=function(r,t){if(r.length!==t.length)return!1;var e=!0;return I(r,function(i,n){if(i!==t[n])return e=!1,!1}),e};function Eot(r,t,e){var i=null,n=e;return t<n&&(n=t,i="add"),r<n&&(n=r,i="del"),{type:i,min:n}}var Sot=function(r,t){var e=r.length,i=t.length,n,a,o=0;if(e===0||i===0)return null;for(var s=[],l=0;l<=e;l++)s[l]=[],s[l][0]={min:l};for(var u=0;u<=i;u++)s[0][u]={min:u};for(var l=1;l<=e;l++){n=r[l-1];for(var u=1;u<=i;u++){a=t[u-1],Cot(n,a)?o=0:o=1;var c=s[l-1][u].min+1,h=s[l][u-1].min+1,f=s[l-1][u-1].min+o;s[l][u]=Eot(c,h,f)}}return s},E5=function(r,t){var e=Sot(r,t),i=r.length,n=t.length,a=[],o=1,s=1;if(e[i][n].min!==i){for(var l=1;l<=i;l++){var u=e[l][l].min;s=l;for(var c=o;c<=n;c++)e[l][c].min<u&&(u=e[l][c].min,s=c);o=s,e[l][o].type&&a.push({index:l-1,type:e[l][o].type})}for(var l=a.length-1;l>=0;l--)o=a[l].index,a[l].type==="add"?r.splice(o,0,[].concat(r[o])):r.splice(o,1)}i=r.length;var h=n-i;if(i<n)for(var l=0;l<h;l++)r[i-1][0]==="z"||r[i-1][0]==="Z"?r.splice(i-2,0,r[i-2]):r.push(r[i-1]),i+=1;return r};function W_(r,t,e){for(var i=[].concat(r),n,a=1/(e+1),o=S5(t)[0],s=1;s<=e;s++)a*=s,n=Math.floor(r.length*a),n===0?i.unshift([o[0]*a+r[n][0]*(1-a),o[1]*a+r[n][1]*(1-a)]):i.splice(n,0,[o[0]*a+r[n][0]*(1-a),o[1]*a+r[n][1]*(1-a)]);return i}function S5(r){var t=[];switch(r[0]){case"M":t.push([r[1],r[2]]);break;case"L":t.push([r[1],r[2]]);break;case"A":t.push([r[6],r[7]]);break;case"Q":t.push([r[3],r[4]]),t.push([r[1],r[2]]);break;case"T":t.push([r[1],r[2]]);break;case"C":t.push([r[5],r[6]]),t.push([r[1],r[2]]),t.push([r[3],r[4]]);break;case"S":t.push([r[3],r[4]]),t.push([r[1],r[2]]);break;case"H":t.push([r[1],r[1]]);break;case"V":t.push([r[1],r[1]]);break}return t}var Px=function(r,t){if(r.length<=1)return r;for(var e,i=0;i<t.length;i++)if(r[i][0]!==t[i][0])switch(e=S5(r[i]),t[i][0]){case"M":r[i]=["M"].concat(e[0]);break;case"L":r[i]=["L"].concat(e[0]);break;case"A":r[i]=[].concat(t[i]),r[i][6]=e[0][0],r[i][7]=e[0][1];break;case"Q":if(e.length<2)if(i>0)e=W_(e,r[i-1],1);else{r[i]=t[i];break}r[i]=["Q"].concat(e.reduce(function(n,a){return n.concat(a)},[]));break;case"T":r[i]=["T"].concat(e[0]);break;case"C":if(e.length<3)if(i>0)e=W_(e,r[i-1],2);else{r[i]=t[i];break}r[i]=["C"].concat(e.reduce(function(n,a){return n.concat(a)},[]));break;case"S":if(e.length<2)if(i>0)e=W_(e,r[i-1],1);else{r[i]=t[i];break}r[i]=["S"].concat(e.reduce(function(n,a){return n.concat(a)},[]));break;default:r[i]=t[i]}return r};const qm=Object.freeze(Object.defineProperty({__proto__:null,catmullRomToBezier:Mx,fillPath:xot,fillPathByDiff:E5,formatPath:Px,intersection:got,parsePathArray:x5,parsePathString:Ec,pathToAbsolute:Ix,pathToCurve:Lx,rectPath:C5},Symbol.toStringTag,{value:"Module"}));var Rh=function(){function r(t,e){this.bubbles=!0,this.target=null,this.currentTarget=null,this.delegateTarget=null,this.delegateObject=null,this.defaultPrevented=!1,this.propagationStopped=!1,this.shape=null,this.fromShape=null,this.toShape=null,this.propagationPath=[],this.type=t,this.name=t,this.originalEvent=e,this.timeStamp=e.timeStamp}return r.prototype.preventDefault=function(){this.defaultPrevented=!0,this.originalEvent.preventDefault&&this.originalEvent.preventDefault()},r.prototype.stopPropagation=function(){this.propagationStopped=!0},r.prototype.toString=function(){var t=this.type;return"[Event (type="+t+")]"},r.prototype.save=function(){},r.prototype.restore=function(){},r}();function A5(r,t){var e=r.indexOf(t);e!==-1&&r.splice(e,1)}var NM=typeof window<"u"&&typeof window.document<"u";function T5(r,t){if(r.isCanvas())return!0;for(var e=t.getParent(),i=!1;e;){if(e===r){i=!0;break}e=e.getParent()}return i}function nh(r){return r.cfg.visible&&r.cfg.capture}var Mv=function(r){N(t,r);function t(e){var i=r.call(this)||this;i.destroyed=!1;var n=i.getDefaultCfg();return i.cfg=ne(n,e),i}return t.prototype.getDefaultCfg=function(){return{}},t.prototype.get=function(e){return this.cfg[e]},t.prototype.set=function(e,i){this.cfg[e]=i},t.prototype.destroy=function(){this.cfg={destroyed:!0},this.off(),this.destroyed=!0},t}(ku);function fc(r,t,e){var i=[0,0,0,0,0,0,0,0,0];return G$(i,e),Dm(r,i,t)}function PS(r,t,e){var i=[0,0,0,0,0,0,0,0,0];return X$(i,e),Dm(r,i,t)}function b5(r,t,e){var i=[0,0,0,0,0,0,0,0,0];return Y$(i,e),Dm(r,i,t)}function Aot(r,t,e){return Dm(r,e,t)}function dr(r,t){for(var e=r?[].concat(r):[1,0,0,0,1,0,0,0,1],i=0,n=t.length;i<n;i++){var a=t[i];switch(a[0]){case"t":fc(e,e,[a[1],a[2]]);break;case"s":b5(e,e,[a[1],a[2]]);break;case"r":PS(e,e,a[1]);break;case"m":Aot(e,e,a[1]);break}}return e}function Tot(r,t){return r[0]*t[1]-t[0]*r[1]}function FS(r,t,e){var i=K1(r,t),n=Tot(r,t)>=0;return e?n?Math.PI*2-i:i:n?i:Math.PI*2-i}function kM(r,t){var e=[],i=r[0],n=r[1],a=r[2],o=r[3],s=r[4],l=r[5],u=r[6],c=r[7],h=r[8],f=t[0],d=t[1],v=t[2],p=t[3],g=t[4],m=t[5],y=t[6],_=t[7],x=t[8];return e[0]=f*i+d*o+v*u,e[1]=f*n+d*s+v*c,e[2]=f*a+d*l+v*h,e[3]=p*i+g*o+m*u,e[4]=p*n+g*s+m*c,e[5]=p*a+g*l+m*h,e[6]=y*i+_*o+x*u,e[7]=y*n+_*s+x*c,e[8]=y*a+_*l+x*h,e}function ao(r,t){var e=[],i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e}function Iv(r){var t=[],e=r[0],i=r[1],n=r[2],a=r[3],o=r[4],s=r[5],l=r[6],u=r[7],c=r[8],h=c*o-s*u,f=-c*a+s*l,d=u*a-o*l,v=e*h+i*f+n*d;return v?(v=1/v,t[0]=h*v,t[1]=(-c*i+n*u)*v,t[2]=(s*i-n*o)*v,t[3]=f*v,t[4]=(c*e-n*l)*v,t[5]=(-s*e+n*a)*v,t[6]=d*v,t[7]=(-u*e+i*l)*v,t[8]=(o*e-i*a)*v,t):null}var mf=dr,V_="matrix",bot=["zIndex","capture","visible","type"],wot=["repeat"],Rot=":",Mot="*";function Iot(r){for(var t=[],e=0;e<r.length;e++)q(r[e])?t.push([].concat(r[e])):t.push(r[e]);return t}function Lot(r,t){var e={},i=t.attrs;for(var n in r)e[n]=i[n];return e}function Oot(r,t){var e={},i=t.attr();return I(r,function(n,a){wot.indexOf(a)===-1&&!qt(i[a],n)&&(e[a]=n)}),e}function Pot(r,t){if(t.onFrame)return r;var e=t.startTime,i=t.delay,n=t.duration,a=Object.prototype.hasOwnProperty;return I(r,function(o){e+i<o.startTime+o.delay+o.duration&&n>o.delay&&I(t.toAttrs,function(s,l){a.call(o.toAttrs,l)&&(delete o.toAttrs[l],delete o.fromAttrs[l])})}),r}var w5=function(r){N(t,r);function t(e){var i=r.call(this,e)||this;i.attrs={};var n=i.getDefaultAttrs();return ne(n,e.attrs),i.attrs=n,i.initAttrs(n),i.initAnimate(),i}return t.prototype.getDefaultCfg=function(){return{visible:!0,capture:!0,zIndex:0}},t.prototype.getDefaultAttrs=function(){return{matrix:this.getDefaultMatrix(),opacity:1}},t.prototype.onCanvasChange=function(e){},t.prototype.initAttrs=function(e){},t.prototype.initAnimate=function(){this.set("animable",!0),this.set("animating",!1)},t.prototype.isGroup=function(){return!1},t.prototype.getParent=function(){return this.get("parent")},t.prototype.getCanvas=function(){return this.get("canvas")},t.prototype.attr=function(){for(var e,i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];var a=i[0],o=i[1];if(!a)return this.attrs;if(ie(a)){for(var s in a)this.setAttr(s,a[s]);return this.afterAttrsChange(a),this}return i.length===2?(this.setAttr(a,o),this.afterAttrsChange((e={},e[a]=o,e)),this):this.attrs[a]},t.prototype.isClipped=function(e,i){var n=this.getClip();return n&&!n.isHit(e,i)},t.prototype.setAttr=function(e,i){var n=this.attrs[e];n!==i&&(this.attrs[e]=i,this.onAttrChange(e,i,n))},t.prototype.onAttrChange=function(e,i,n){e==="matrix"&&this.set("totalMatrix",null)},t.prototype.afterAttrsChange=function(e){if(this.cfg.isClipShape){var i=this.cfg.applyTo;i&&i.onCanvasChange("clip")}else this.onCanvasChange("attr")},t.prototype.show=function(){return this.set("visible",!0),this.onCanvasChange("show"),this},t.prototype.hide=function(){return this.set("visible",!1),this.onCanvasChange("hide"),this},t.prototype.setZIndex=function(e){this.set("zIndex",e);var i=this.getParent();return i&&i.sort(),this},t.prototype.toFront=function(){var e=this.getParent();if(e){var i=e.getChildren();this.get("el");var n=i.indexOf(this);i.splice(n,1),i.push(this),this.onCanvasChange("zIndex")}},t.prototype.toBack=function(){var e=this.getParent();if(e){var i=e.getChildren();this.get("el");var n=i.indexOf(this);i.splice(n,1),i.unshift(this),this.onCanvasChange("zIndex")}},t.prototype.remove=function(e){e===void 0&&(e=!0);var i=this.getParent();i?(A5(i.getChildren(),this),i.get("clearing")||this.onCanvasChange("remove")):this.onCanvasChange("remove"),e&&this.destroy()},t.prototype.resetMatrix=function(){this.attr(V_,this.getDefaultMatrix()),this.onCanvasChange("matrix")},t.prototype.getMatrix=function(){return this.attr(V_)},t.prototype.setMatrix=function(e){this.attr(V_,e),this.onCanvasChange("matrix")},t.prototype.getTotalMatrix=function(){var e=this.cfg.totalMatrix;if(!e){var i=this.attr("matrix"),n=this.cfg.parentMatrix;n&&i?e=kM(n,i):e=i||n,this.set("totalMatrix",e)}return e},t.prototype.applyMatrix=function(e){var i=this.attr("matrix"),n=null;e&&i?n=kM(e,i):n=i||e,this.set("totalMatrix",n),this.set("parentMatrix",e)},t.prototype.getDefaultMatrix=function(){return null},t.prototype.applyToMatrix=function(e){var i=this.attr("matrix");return i?ao(i,e):e},t.prototype.invertFromMatrix=function(e){var i=this.attr("matrix");if(i){var n=Iv(i);if(n)return ao(n,e)}return e},t.prototype.setClip=function(e){var i=this.getCanvas(),n=null;if(e){var a=this.getShapeBase(),o=fl(e.type),s=a[o];s&&(n=new s({type:e.type,isClipShape:!0,applyTo:this,attrs:e.attrs,canvas:i}))}return this.set("clipShape",n),this.onCanvasChange("clip"),n},t.prototype.getClip=function(){var e=this.cfg.clipShape;return e||null},t.prototype.clone=function(){var e=this,i=this.attrs,n={};I(i,function(s,l){q(i[l])?n[l]=Iot(i[l]):n[l]=i[l]});var a=this.constructor,o=new a({attrs:n});return I(bot,function(s){o.set(s,e.get(s))}),o},t.prototype.destroy=function(){var e=this.destroyed;e||(this.attrs={},r.prototype.destroy.call(this))},t.prototype.isAnimatePaused=function(){return this.get("_pause").isPaused},t.prototype.animate=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];if(!(!this.get("timeline")&&!this.get("canvas"))){this.set("animating",!0);var n=this.get("timeline");n||(n=this.get("canvas").get("timeline"),this.set("timeline",n));var a=this.get("animations")||[];n.timer||n.initTimer();var o=e[0],s=e[1],l=e[2],u=l===void 0?"easeLinear":l,c=e[3],h=c===void 0?Go:c,f=e[4],d=f===void 0?0:f,v,p,g,m,y;ot(o)?(v=o,o={}):ie(o)&&o.onFrame&&(v=o.onFrame,p=o.repeat),ie(s)?(y=s,s=y.duration,u=y.easing||"easeLinear",d=y.delay||0,p=y.repeat||p||!1,h=y.callback||Go,g=y.pauseCallback||Go,m=y.resumeCallback||Go):(Tt(h)&&(d=h,h=null),ot(u)?(h=u,u="easeLinear"):u=u||"easeLinear");var _=Oot(o,this),x={fromAttrs:Lot(_,this),toAttrs:_,duration:s,easing:u,repeat:p,callback:h,pauseCallback:g,resumeCallback:m,delay:d,startTime:n.getTime(),id:ln(),onFrame:v,pathFormatted:!1};a.length>0?a=Pot(a,x):n.addAnimator(this),a.push(x),this.set("animations",a),this.set("_pause",{isPaused:!1})}},t.prototype.stopAnimate=function(e){var i=this;e===void 0&&(e=!0);var n=this.get("animations");I(n,function(a){e&&(a.onFrame?i.attr(a.onFrame(1)):i.attr(a.toAttrs)),a.callback&&a.callback()}),this.set("animating",!1),this.set("animations",[])},t.prototype.pauseAnimate=function(){var e=this.get("timeline"),i=this.get("animations"),n=e.getTime();return I(i,function(a){a._paused=!0,a._pauseTime=n,a.pauseCallback&&a.pauseCallback()}),this.set("_pause",{isPaused:!0,pauseTime:n}),this},t.prototype.resumeAnimate=function(){var e=this.get("timeline"),i=e.getTime(),n=this.get("animations"),a=this.get("_pause").pauseTime;return I(n,function(o){o.startTime=o.startTime+(i-a),o._paused=!1,o._pauseTime=null,o.resumeCallback&&o.resumeCallback()}),this.set("_pause",{isPaused:!1}),this.set("animations",n),this},t.prototype.emitDelegation=function(e,i){var n=this,a=i.propagationPath;this.getEvents();var o;e==="mouseenter"?o=i.fromShape:e==="mouseleave"&&(o=i.toShape);for(var s=function(h){var f=a[h],d=f.get("name");if(d){if((f.isGroup()||f.isCanvas&&f.isCanvas())&&o&&T5(f,o))return"break";q(d)?I(d,function(v){n.emitDelegateEvent(f,v,i)}):l.emitDelegateEvent(f,d,i)}},l=this,u=0;u<a.length;u++){var c=s(u);if(c==="break")break}},t.prototype.emitDelegateEvent=function(e,i,n){var a=this.getEvents(),o=i+Rot+n.type;(a[o]||a[Mot])&&(n.name=o,n.currentTarget=e,n.delegateTarget=this,n.delegateObject=e.get("delegateObject"),this.emit(o,n))},t.prototype.translate=function(e,i){e===void 0&&(e=0),i===void 0&&(i=0);var n=this.getMatrix(),a=mf(n,[["t",e,i]]);return this.setMatrix(a),this},t.prototype.move=function(e,i){var n=this.attr("x")||0,a=this.attr("y")||0;return this.translate(e-n,i-a),this},t.prototype.moveTo=function(e,i){return this.move(e,i)},t.prototype.scale=function(e,i){var n=this.getMatrix(),a=mf(n,[["s",e,i||e]]);return this.setMatrix(a),this},t.prototype.rotate=function(e){var i=this.getMatrix(),n=mf(i,[["r",e]]);return this.setMatrix(n),this},t.prototype.rotateAtStart=function(e){var i=this.attr(),n=i.x,a=i.y,o=this.getMatrix(),s=mf(o,[["t",-n,-a],["r",e],["t",n,a]]);return this.setMatrix(s),this},t.prototype.rotateAtPoint=function(e,i,n){var a=this.getMatrix(),o=mf(a,[["t",-e,-i],["r",n],["t",e,i]]);return this.setMatrix(o),this},t}(Mv),UM={},Fx="_INDEX";function R5(r,t){if(r.set("canvas",t),r.isGroup()){var e=r.get("children");e.length&&e.forEach(function(i){R5(i,t)})}}function M5(r,t){if(r.set("timeline",t),r.isGroup()){var e=r.get("children");e.length&&e.forEach(function(i){M5(i,t)})}}function Fot(r,t,e){e===void 0&&(e=!0),e?t.destroy():(t.set("parent",null),t.set("canvas",null)),A5(r.getChildren(),t)}function Bot(r){return function(t,e){var i=r(t,e);return i===0?t[Fx]-e[Fx]:i}}var I5=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.isCanvas=function(){return!1},t.prototype.getBBox=function(){var e=1/0,i=-1/0,n=1/0,a=-1/0,o=this.getChildren().filter(function(l){return l.get("visible")&&(!l.isGroup()||l.isGroup()&&l.getChildren().length>0)});o.length>0?I(o,function(l){var u=l.getBBox(),c=u.minX,h=u.maxX,f=u.minY,d=u.maxY;c<e&&(e=c),h>i&&(i=h),f<n&&(n=f),d>a&&(a=d)}):(e=0,i=0,n=0,a=0);var s={x:e,y:n,minX:e,minY:n,maxX:i,maxY:a,width:i-e,height:a-n};return s},t.prototype.getCanvasBBox=function(){var e=1/0,i=-1/0,n=1/0,a=-1/0,o=this.getChildren().filter(function(l){return l.get("visible")&&(!l.isGroup()||l.isGroup()&&l.getChildren().length>0)});o.length>0?I(o,function(l){var u=l.getCanvasBBox(),c=u.minX,h=u.maxX,f=u.minY,d=u.maxY;c<e&&(e=c),h>i&&(i=h),f<n&&(n=f),d>a&&(a=d)}):(e=0,i=0,n=0,a=0);var s={x:e,y:n,minX:e,minY:n,maxX:i,maxY:a,width:i-e,height:a-n};return s},t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return e.children=[],e},t.prototype.onAttrChange=function(e,i,n){if(r.prototype.onAttrChange.call(this,e,i,n),e==="matrix"){var a=this.getTotalMatrix();this._applyChildrenMarix(a)}},t.prototype.applyMatrix=function(e){var i=this.getTotalMatrix();r.prototype.applyMatrix.call(this,e);var n=this.getTotalMatrix();n!==i&&this._applyChildrenMarix(n)},t.prototype._applyChildrenMarix=function(e){var i=this.getChildren();I(i,function(n){n.applyMatrix(e)})},t.prototype.addShape=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=e[0],a=e[1];ie(n)?a=n:a.type=n;var o=UM[a.type];o||(o=fl(a.type),UM[a.type]=o);var s=this.getShapeBase(),l=new s[o](a);return this.add(l),l},t.prototype.addGroup=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=e[0],a=e[1],o;if(ot(n))a?o=new n(a):o=new n({parent:this});else{var s=n||{},l=this.getGroupBase();o=new l(s)}return this.add(o),o},t.prototype.getCanvas=function(){var e;return this.isCanvas()?e=this:e=this.get("canvas"),e},t.prototype.getShape=function(e,i,n){if(!nh(this))return null;var a=this.getChildren(),o;if(this.isCanvas())o=this._findShape(a,e,i,n);else{var s=[e,i,1];s=this.invertFromMatrix(s),this.isClipped(s[0],s[1])||(o=this._findShape(a,s[0],s[1],n))}return o},t.prototype._findShape=function(e,i,n,a){for(var o=null,s=e.length-1;s>=0;s--){var l=e[s];if(nh(l)&&(l.isGroup()?o=l.getShape(i,n,a):l.isHit(i,n)&&(o=l)),o)break}return o},t.prototype.add=function(e){var i=this.getCanvas(),n=this.getChildren(),a=this.get("timeline"),o=e.getParent();o&&Fot(o,e,!1),e.set("parent",this),i&&R5(e,i),a&&M5(e,a),n.push(e),e.onCanvasChange("add"),this._applyElementMatrix(e)},t.prototype._applyElementMatrix=function(e){var i=this.getTotalMatrix();i&&e.applyMatrix(i)},t.prototype.getChildren=function(){return this.get("children")||[]},t.prototype.sort=function(){var e=this.getChildren();I(e,function(i,n){return i[Fx]=n,i}),e.sort(Bot(function(i,n){return i.get("zIndex")-n.get("zIndex")})),this.onCanvasChange("sort")},t.prototype.clear=function(){if(this.set("clearing",!0),!this.destroyed){for(var e=this.getChildren(),i=e.length-1;i>=0;i--)e[i].destroy();this.set("children",[]),this.onCanvasChange("clear"),this.set("clearing",!1)}},t.prototype.destroy=function(){this.get("destroyed")||(this.clear(),r.prototype.destroy.call(this))},t.prototype.getFirst=function(){return this.getChildByIndex(0)},t.prototype.getLast=function(){var e=this.getChildren();return this.getChildByIndex(e.length-1)},t.prototype.getChildByIndex=function(e){var i=this.getChildren();return i[e]},t.prototype.getCount=function(){var e=this.getChildren();return e.length},t.prototype.contain=function(e){var i=this.getChildren();return i.indexOf(e)>-1},t.prototype.removeChild=function(e,i){i===void 0&&(i=!0),this.contain(e)&&e.remove(i)},t.prototype.findAll=function(e){var i=[],n=this.getChildren();return I(n,function(a){e(a)&&i.push(a),a.isGroup()&&(i=i.concat(a.findAll(e)))}),i},t.prototype.find=function(e){var i=null,n=this.getChildren();return I(n,function(a){if(e(a)?i=a:a.isGroup()&&(i=a.find(e)),i)return!1}),i},t.prototype.findById=function(e){return this.find(function(i){return i.get("id")===e})},t.prototype.findByClassName=function(e){return this.find(function(i){return i.get("className")===e})},t.prototype.findAllByName=function(e){return this.findAll(function(i){return i.get("name")===e})},t}(w5),L5={};function Dot(r){return L5[r.toLowerCase()]||gW[r]}function BS(r,t){L5[r.toLowerCase()]=t}var Not=function(r){return["fill","stroke","fillStyle","strokeStyle"].includes(r)},kot=function(r){return/^[r,R,L,l]{1}[\s]*\(/.test(r)},zM=[1,0,0,0,1,0,0,0,1];function Uot(r,t,e){var i={},n=t.fromAttrs,a=t.toAttrs;if(!r.destroyed){var o;for(var s in a)if(!qt(n[s],a[s]))if(s==="path"){var l=a[s],u=n[s];l.length>u.length?(l=Ec(a[s]),u=Ec(n[s]),u=E5(u,l),u=Px(u,l),t.fromAttrs.path=u,t.toAttrs.path=l):t.pathFormatted||(l=Ec(a[s]),u=Ec(n[s]),u=Px(u,l),t.fromAttrs.path=u,t.toAttrs.path=l,t.pathFormatted=!0),i[s]=[];for(var c=0;c<l.length;c++){for(var h=l[c],f=u[c],d=[],v=0;v<h.length;v++)Tt(h[v])&&f&&Tt(f[v])?(o=S2(f[v],h[v]),d.push(o(e))):d.push(h[v]);i[s].push(d)}}else if(s==="matrix"){var p=mW(n[s]||zM,a[s]||zM),g=p(e);i[s]=g}else Not(s)&&kot(a[s])?i[s]=a[s]:ot(a[s])||(o=S2(n[s],a[s]),i[s]=o(e));r.attr(i)}}function zot(r,t,e){var i=t.startTime,n=t.delay;if(e<i+n||t._paused)return!1;var a,o=t.duration,s=t.easing,l=Dot(s);if(e=e-i-t.delay,t.repeat)a=e%o/o,a=l(a);else if(a=e/o,a<1)a=l(a);else return t.onFrame?r.attr(t.onFrame(1)):r.attr(t.toAttrs),!0;if(t.onFrame){var u=t.onFrame(a);r.attr(u)}else Uot(r,t,a);return!1}var Hot=function(){function r(t){this.animators=[],this.current=0,this.timer=null,this.canvas=t}return r.prototype.initTimer=function(){var t=this,e=!1,i,n,a;this.timer=yW(function(o){if(t.current=o,t.animators.length>0){for(var s=t.animators.length-1;s>=0;s--){if(i=t.animators[s],i.destroyed){t.removeAnimator(s);continue}if(!i.isAnimatePaused()){n=i.get("animations");for(var l=n.length-1;l>=0;l--)a=n[l],e=zot(i,a,o),e&&(n.splice(l,1),e=!1,a.callback&&a.callback())}n.length===0&&t.removeAnimator(s)}var u=t.canvas.get("autoDraw");u||t.canvas.draw()}})},r.prototype.addAnimator=function(t){this.animators.push(t)},r.prototype.removeAnimator=function(t){this.animators.splice(t,1)},r.prototype.isAnimating=function(){return!!this.animators.length},r.prototype.stop=function(){this.timer&&this.timer.stop()},r.prototype.stopAllAnimations=function(t){t===void 0&&(t=!0),this.animators.forEach(function(e){e.stopAnimate(t)}),this.animators=[],this.canvas.draw()},r.prototype.getTime=function(){return this.current},r}(),$ot=40,HM=0,$M=["mousedown","mouseup","dblclick","mouseout","mouseover","mousemove","mouseleave","mouseenter","touchstart","touchmove","touchend","dragenter","dragover","dragleave","drop","contextmenu","mousewheel"];function WM(r,t,e){e.name=t,e.target=r,e.currentTarget=r,e.delegateTarget=r,r.emit(t,e)}function Wot(r,t,e){if(e.bubbles){var i=void 0,n=!1;if(t==="mouseenter"?(i=e.fromShape,n=!0):t==="mouseleave"&&(n=!0,i=e.toShape),r.isCanvas()&&n)return;if(i&&T5(r,i)){e.bubbles=!1;return}e.name=t,e.currentTarget=r,e.delegateTarget=r,r.emit(t,e)}}var Vot=function(){function r(t){var e=this;this.draggingShape=null,this.dragging=!1,this.currentShape=null,this.mousedownShape=null,this.mousedownPoint=null,this._eventCallback=function(i){var n=i.type;e._triggerEvent(n,i)},this._onDocumentMove=function(i){var n=e.canvas,a=n.get("el");if(a!==i.target&&(e.dragging||e.currentShape)){var o=e._getPointInfo(i);e.dragging&&e._emitEvent("drag",i,o,e.draggingShape)}},this._onDocumentMouseUp=function(i){var n=e.canvas,a=n.get("el");if(a!==i.target&&e.dragging){var o=e._getPointInfo(i);e.draggingShape&&e._emitEvent("drop",i,o,null),e._emitEvent("dragend",i,o,e.draggingShape),e._afterDrag(e.draggingShape,o,i)}},this.canvas=t.canvas}return r.prototype.init=function(){this._bindEvents()},r.prototype._bindEvents=function(){var t=this,e=this.canvas.get("el");I($M,function(i){e.addEventListener(i,t._eventCallback)}),document&&(document.addEventListener("mousemove",this._onDocumentMove),document.addEventListener("mouseup",this._onDocumentMouseUp))},r.prototype._clearEvents=function(){var t=this,e=this.canvas.get("el");I($M,function(i){e.removeEventListener(i,t._eventCallback)}),document&&(document.removeEventListener("mousemove",this._onDocumentMove),document.removeEventListener("mouseup",this._onDocumentMouseUp))},r.prototype._getEventObj=function(t,e,i,n,a,o){var s=new Rh(t,e);return s.fromShape=a,s.toShape=o,s.x=i.x,s.y=i.y,s.clientX=i.clientX,s.clientY=i.clientY,s.propagationPath.push(n),s},r.prototype._getShape=function(t,e){return this.canvas.getShape(t.x,t.y,e)},r.prototype._getPointInfo=function(t){var e=this.canvas,i=e.getClientByEvent(t),n=e.getPointByEvent(t);return{x:n.x,y:n.y,clientX:i.x,clientY:i.y}},r.prototype._triggerEvent=function(t,e){var i=this._getPointInfo(e),n=this._getShape(i,e),a=this["_on"+t],o=!1;if(a)a.call(this,i,n,e);else{var s=this.currentShape;t==="mouseenter"||t==="dragenter"||t==="mouseover"?(this._emitEvent(t,e,i,null,null,n),n&&this._emitEvent(t,e,i,n,null,n),t==="mouseenter"&&this.draggingShape&&this._emitEvent("dragenter",e,i,null)):t==="mouseleave"||t==="dragleave"||t==="mouseout"?(o=!0,s&&this._emitEvent(t,e,i,s,s,null),this._emitEvent(t,e,i,null,s,null),t==="mouseleave"&&this.draggingShape&&this._emitEvent("dragleave",e,i,null)):this._emitEvent(t,e,i,n,null,null)}if(o||(this.currentShape=n),n&&!n.get("destroyed")){var l=this.canvas,u=l.get("el");u.style.cursor=n.attr("cursor")||l.get("cursor")}},r.prototype._onmousedown=function(t,e,i){i.button===HM&&(this.mousedownShape=e,this.mousedownPoint=t,this.mousedownTimeStamp=i.timeStamp),this._emitEvent("mousedown",i,t,e,null,null)},r.prototype._emitMouseoverEvents=function(t,e,i,n){var a=this.canvas.get("el");i!==n&&(i&&(this._emitEvent("mouseout",t,e,i,i,n),this._emitEvent("mouseleave",t,e,i,i,n),(!n||n.get("destroyed"))&&(a.style.cursor=this.canvas.get("cursor"))),n&&(this._emitEvent("mouseover",t,e,n,i,n),this._emitEvent("mouseenter",t,e,n,i,n)))},r.prototype._emitDragoverEvents=function(t,e,i,n,a){n?(n!==i&&(i&&this._emitEvent("dragleave",t,e,i,i,n),this._emitEvent("dragenter",t,e,n,i,n)),a||this._emitEvent("dragover",t,e,n)):i&&this._emitEvent("dragleave",t,e,i,i,n),a&&this._emitEvent("dragover",t,e,n)},r.prototype._afterDrag=function(t,e,i){t&&(t.set("capture",!0),this.draggingShape=null),this.dragging=!1;var n=this._getShape(e,i);n!==t&&this._emitMouseoverEvents(i,e,t,n),this.currentShape=n},r.prototype._onmouseup=function(t,e,i){if(i.button===HM){var n=this.draggingShape;this.dragging?(n&&this._emitEvent("drop",i,t,e),this._emitEvent("dragend",i,t,n),this._afterDrag(n,t,i)):(this._emitEvent("mouseup",i,t,e),e===this.mousedownShape&&this._emitEvent("click",i,t,e),this.mousedownShape=null,this.mousedownPoint=null)}},r.prototype._ondragover=function(t,e,i){i.preventDefault();var n=this.currentShape;this._emitDragoverEvents(i,t,n,e,!0)},r.prototype._onmousemove=function(t,e,i){var n=this.canvas,a=this.currentShape,o=this.draggingShape;if(this.dragging)o&&this._emitDragoverEvents(i,t,a,e,!1),this._emitEvent("drag",i,t,o);else{var s=this.mousedownPoint;if(s){var l=this.mousedownShape,u=i.timeStamp,c=u-this.mousedownTimeStamp,h=s.clientX-t.clientX,f=s.clientY-t.clientY,d=h*h+f*f;c>120||d>$ot?l&&l.get("draggable")?(o=this.mousedownShape,o.set("capture",!1),this.draggingShape=o,this.dragging=!0,this._emitEvent("dragstart",i,t,o),this.mousedownShape=null,this.mousedownPoint=null):!l&&n.get("draggable")?(this.dragging=!0,this._emitEvent("dragstart",i,t,null),this.mousedownShape=null,this.mousedownPoint=null):(this._emitMouseoverEvents(i,t,a,e),this._emitEvent("mousemove",i,t,e)):(this._emitMouseoverEvents(i,t,a,e),this._emitEvent("mousemove",i,t,e))}else this._emitMouseoverEvents(i,t,a,e),this._emitEvent("mousemove",i,t,e)}},r.prototype._emitEvent=function(t,e,i,n,a,o){var s=this._getEventObj(t,e,i,n,a,o);if(n){s.shape=n,WM(n,t,s);for(var l=n.getParent();l;)l.emitDelegation(t,s),s.propagationStopped||Wot(l,t,s),s.propagationPath.push(l),l=l.getParent()}else{var u=this.canvas;WM(u,t,s)}},r.prototype.destroy=function(){this._clearEvents(),this.canvas=null,this.currentShape=null,this.draggingShape=null,this.mousedownPoint=null,this.mousedownShape=null,this.mousedownTimeStamp=null},r}(),VM="px",GM=VF(),Got=GM&&GM.name==="firefox",Lv=function(r){N(t,r);function t(e){var i=r.call(this,e)||this;return i.initContainer(),i.initDom(),i.initEvents(),i.initTimeline(),i}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return e.cursor="default",e.supportCSSTransform=!1,e},t.prototype.initContainer=function(){var e=this.get("container");mt(e)&&(e=document.getElementById(e),this.set("container",e))},t.prototype.initDom=function(){var e=this.createDom();this.set("el",e);var i=this.get("container");i.appendChild(e),this.setDOMSize(this.get("width"),this.get("height"))},t.prototype.initEvents=function(){var e=new Vot({canvas:this});e.init(),this.set("eventController",e)},t.prototype.initTimeline=function(){var e=new Hot(this);this.set("timeline",e)},t.prototype.setDOMSize=function(e,i){var n=this.get("el");NM&&(n.style.width=e+VM,n.style.height=i+VM)},t.prototype.changeSize=function(e,i){this.setDOMSize(e,i),this.set("width",e),this.set("height",i),this.onCanvasChange("changeSize")},t.prototype.getRenderer=function(){return this.get("renderer")},t.prototype.getCursor=function(){return this.get("cursor")},t.prototype.setCursor=function(e){this.set("cursor",e);var i=this.get("el");NM&&i&&(i.style.cursor=e)},t.prototype.getPointByEvent=function(e){var i=this.get("supportCSSTransform");if(i){if(Got&&!K(e.layerX)&&e.layerX!==e.offsetX)return{x:e.layerX,y:e.layerY};if(!K(e.offsetX))return{x:e.offsetX,y:e.offsetY}}var n=this.getClientByEvent(e),a=n.x,o=n.y;return this.getPointByClient(a,o)},t.prototype.getClientByEvent=function(e){var i=e;return e.touches&&(e.type==="touchend"?i=e.changedTouches[0]:i=e.touches[0]),{x:i.clientX,y:i.clientY}},t.prototype.getPointByClient=function(e,i){var n=this.get("el"),a=n.getBoundingClientRect();return{x:e-a.left,y:i-a.top}},t.prototype.getClientByPoint=function(e,i){var n=this.get("el"),a=n.getBoundingClientRect();return{x:e+a.left,y:i+a.top}},t.prototype.draw=function(){},t.prototype.removeDom=function(){var e=this.get("el");e.parentNode.removeChild(e)},t.prototype.clearEvents=function(){var e=this.get("eventController");e.destroy()},t.prototype.isCanvas=function(){return!0},t.prototype.getParent=function(){return null},t.prototype.destroy=function(){var e=this.get("timeline");this.get("destroyed")||(this.clear(),e&&e.stop(),this.clearEvents(),this.removeDom(),r.prototype.destroy.call(this))},t}(I5),Ov=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.isGroup=function(){return!0},t.prototype.isEntityGroup=function(){return!1},t.prototype.clone=function(){for(var e=r.prototype.clone.call(this),i=this.getChildren(),n=0;n<i.length;n++){var a=i[n];e.add(a.clone())}return e},t}(I5),Pv=function(r){N(t,r);function t(e){return r.call(this,e)||this}return t.prototype._isInBBox=function(e,i){var n=this.getBBox();return n.minX<=e&&n.maxX>=e&&n.minY<=i&&n.maxY>=i},t.prototype.afterAttrsChange=function(e){r.prototype.afterAttrsChange.call(this,e),this.clearCacheBBox()},t.prototype.getBBox=function(){var e=this.cfg.bbox;return e||(e=this.calculateBBox(),this.set("bbox",e)),e},t.prototype.getCanvasBBox=function(){var e=this.cfg.canvasBBox;return e||(e=this.calculateCanvasBBox(),this.set("canvasBBox",e)),e},t.prototype.applyMatrix=function(e){r.prototype.applyMatrix.call(this,e),this.set("canvasBBox",null)},t.prototype.calculateCanvasBBox=function(){var e=this.getBBox(),i=this.getTotalMatrix(),n=e.minX,a=e.minY,o=e.maxX,s=e.maxY;if(i){var l=ao(i,[e.minX,e.minY]),u=ao(i,[e.maxX,e.minY]),c=ao(i,[e.minX,e.maxY]),h=ao(i,[e.maxX,e.maxY]);n=Math.min(l[0],u[0],c[0],h[0]),o=Math.max(l[0],u[0],c[0],h[0]),a=Math.min(l[1],u[1],c[1],h[1]),s=Math.max(l[1],u[1],c[1],h[1])}var f=this.attrs;if(f.shadowColor){var d=f.shadowBlur,v=d===void 0?0:d,p=f.shadowOffsetX,g=p===void 0?0:p,m=f.shadowOffsetY,y=m===void 0?0:m,_=n-v+g,x=o+v+g,C=a-v+y,A=s+v+y;n=Math.min(n,_),o=Math.max(o,x),a=Math.min(a,C),s=Math.max(s,A)}return{x:n,y:a,minX:n,minY:a,maxX:o,maxY:s,width:o-n,height:s-a}},t.prototype.clearCacheBBox=function(){this.set("bbox",null),this.set("canvasBBox",null)},t.prototype.isClipShape=function(){return this.get("isClipShape")},t.prototype.isInShape=function(e,i){return!1},t.prototype.isOnlyHitBox=function(){return!1},t.prototype.isHit=function(e,i){var n=this.get("startArrowShape"),a=this.get("endArrowShape"),o=[e,i,1];o=this.invertFromMatrix(o);var s=o[0],l=o[1],u=this._isInBBox(s,l);return this.isOnlyHitBox()?u:!!(u&&!this.isClipped(s,l)&&(this.isInShape(s,l)||n&&n.isHit(s,l)||a&&a.isHit(s,l)))},t}(w5),O5=new Map;function Ln(r,t){O5.set(r,t)}function Fv(r){return O5.get(r)}function P5(r){var t=r.attr(),e=t.x,i=t.y,n=t.width,a=t.height;return{x:e,y:i,width:n,height:a}}function F5(r){var t=r.attr(),e=t.x,i=t.y,n=t.r;return{x:e-n,y:i-n,width:n*2,height:n*2}}function hi(r,t,e,i){var n=r-e,a=t-i;return Math.sqrt(n*n+a*a)}function Zg(r,t){return Math.abs(r-t)<.001}function Mh(r,t){var e=Tn(r),i=Tn(t),n=rn(r),a=rn(t);return{x:e,y:i,width:n-e,height:a-i}}function Km(r){return(r+Math.PI*2)%(Math.PI*2)}const Hr={box:function(r,t,e,i){return Mh([r,e],[t,i])},length:function(r,t,e,i){return hi(r,t,e,i)},pointAt:function(r,t,e,i,n){return{x:(1-n)*r+n*e,y:(1-n)*t+n*i}},pointDistance:function(r,t,e,i,n,a){var o=(e-r)*(n-r)+(i-t)*(a-t);if(o<0)return hi(r,t,n,a);var s=(e-r)*(e-r)+(i-t)*(i-t);return o>s?hi(e,i,n,a):this.pointToLine(r,t,e,i,n,a)},pointToLine:function(r,t,e,i,n,a){var o=[e-r,i-t];if(j$(o,[0,0]))return Math.sqrt((n-r)*(n-r)+(a-t)*(a-t));var s=[-o[1],o[0]];Xc(s,s);var l=[n-r,a-t];return Math.abs(m0(l,s))},tangentAngle:function(r,t,e,i){return Math.atan2(i-t,e-r)}};var Xot=1e-4;function B5(r,t,e,i,n,a){var o,s=1/0,l=[e,i],u=20;a&&a>200&&(u=a/10);for(var c=1/u,h=c/10,f=0;f<=u;f++){var d=f*c,v=[n.apply(null,r.concat([d])),n.apply(null,t.concat([d]))],p=hi(l[0],l[1],v[0],v[1]);p<s&&(o=d,s=p)}if(o===0)return{x:r[0],y:t[0]};if(o===1){var g=r.length;return{x:r[g-1],y:t[g-1]}}s=1/0;for(var f=0;f<32&&!(h<Xot);f++){var m=o-h,y=o+h,v=[n.apply(null,r.concat([m])),n.apply(null,t.concat([m]))],p=hi(l[0],l[1],v[0],v[1]);if(m>=0&&p<s)o=m,s=p;else{var _=[n.apply(null,r.concat([y])),n.apply(null,t.concat([y]))],x=hi(l[0],l[1],_[0],_[1]);y<=1&&x<s?(o=y,s=x):h*=.5}}return{x:n.apply(null,r.concat([o])),y:n.apply(null,t.concat([o]))}}function Yot(r,t){for(var e=0,i=r.length,n=0;n<i;n++){var a=r[n],o=t[n],s=r[(n+1)%i],l=t[(n+1)%i];e+=hi(a,o,s,l)}return e/2}function Is(r,t,e,i){var n=1-i;return n*n*r+2*i*n*t+i*i*e}function XM(r,t,e){var i=r+e-2*t;if(Zg(i,0))return[.5];var n=(r-t)/i;return n<=1&&n>=0?[n]:[]}function YM(r,t,e,i){return 2*(1-i)*(t-r)+2*i*(e-t)}function D5(r,t,e,i,n,a,o){var s=Is(r,e,n,o),l=Is(t,i,a,o),u=Hr.pointAt(r,t,e,i,o),c=Hr.pointAt(e,i,n,a,o);return[[r,t,u.x,u.y,s,l],[s,l,c.x,c.y,n,a]]}function Bx(r,t,e,i,n,a,o){if(o===0)return(hi(r,t,e,i)+hi(e,i,n,a)+hi(r,t,n,a))/2;var s=D5(r,t,e,i,n,a,.5),l=s[0],u=s[1];return l.push(o-1),u.push(o-1),Bx.apply(null,l)+Bx.apply(null,u)}const N5={box:function(r,t,e,i,n,a){var o=XM(r,e,n)[0],s=XM(t,i,a)[0],l=[r,n],u=[t,a];return o!==void 0&&l.push(Is(r,e,n,o)),s!==void 0&&u.push(Is(t,i,a,s)),Mh(l,u)},length:function(r,t,e,i,n,a){return Bx(r,t,e,i,n,a,3)},nearestPoint:function(r,t,e,i,n,a,o,s){return B5([r,e,n],[t,i,a],o,s,Is)},pointDistance:function(r,t,e,i,n,a,o,s){var l=this.nearestPoint(r,t,e,i,n,a,o,s);return hi(l.x,l.y,o,s)},interpolationAt:Is,pointAt:function(r,t,e,i,n,a,o){return{x:Is(r,e,n,o),y:Is(t,i,a,o)}},divide:function(r,t,e,i,n,a,o){return D5(r,t,e,i,n,a,o)},tangentAngle:function(r,t,e,i,n,a,o){var s=YM(r,e,n,o),l=YM(t,i,a,o),u=Math.atan2(l,s);return Km(u)}};function Ls(r,t,e,i,n){var a=1-n;return a*a*a*r+3*t*n*a*a+3*e*n*n*a+i*n*n*n}function jM(r,t,e,i,n){var a=1-n;return 3*(a*a*(t-r)+2*a*n*(e-t)+n*n*(i-e))}function G_(r,t,e,i){var n=-3*r+9*t-9*e+3*i,a=6*r-12*t+6*e,o=3*t-3*r,s=[],l,u,c;if(Zg(n,0))Zg(a,0)||(l=-o/a,l>=0&&l<=1&&s.push(l));else{var h=a*a-4*n*o;Zg(h,0)?s.push(-a/(2*n)):h>0&&(c=Math.sqrt(h),l=(-a+c)/(2*n),u=(-a-c)/(2*n),l>=0&&l<=1&&s.push(l),u>=0&&u<=1&&s.push(u))}return s}function k5(r,t,e,i,n,a,o,s,l){var u=Ls(r,e,n,o,l),c=Ls(t,i,a,s,l),h=Hr.pointAt(r,t,e,i,l),f=Hr.pointAt(e,i,n,a,l),d=Hr.pointAt(n,a,o,s,l),v=Hr.pointAt(h.x,h.y,f.x,f.y,l),p=Hr.pointAt(f.x,f.y,d.x,d.y,l);return[[r,t,h.x,h.y,v.x,v.y,u,c],[u,c,p.x,p.y,d.x,d.y,o,s]]}function Dx(r,t,e,i,n,a,o,s,l){if(l===0)return Yot([r,e,n,o],[t,i,a,s]);var u=k5(r,t,e,i,n,a,o,s,.5),c=u[0],h=u[1];return c.push(l-1),h.push(l-1),Dx.apply(null,c)+Dx.apply(null,h)}const Qf={extrema:G_,box:function(r,t,e,i,n,a,o,s){for(var l=[r,o],u=[t,s],c=G_(r,e,n,o),h=G_(t,i,a,s),f=0;f<c.length;f++)l.push(Ls(r,e,n,o,c[f]));for(var f=0;f<h.length;f++)u.push(Ls(t,i,a,s,h[f]));return Mh(l,u)},length:function(r,t,e,i,n,a,o,s){return Dx(r,t,e,i,n,a,o,s,3)},nearestPoint:function(r,t,e,i,n,a,o,s,l,u,c){return B5([r,e,n,o],[t,i,a,s],l,u,Ls,c)},pointDistance:function(r,t,e,i,n,a,o,s,l,u,c){var h=this.nearestPoint(r,t,e,i,n,a,o,s,l,u,c);return hi(h.x,h.y,l,u)},interpolationAt:Ls,pointAt:function(r,t,e,i,n,a,o,s,l){return{x:Ls(r,e,n,o,l),y:Ls(t,i,a,s,l)}},divide:function(r,t,e,i,n,a,o,s,l){return k5(r,t,e,i,n,a,o,s,l)},tangentAngle:function(r,t,e,i,n,a,o,s,l){var u=jM(r,e,n,o,l),c=jM(t,i,a,s,l);return Km(Math.atan2(c,u))}};function ZM(r,t){var e=Math.abs(r);return t>0?e:e*-1}const jot={box:function(r,t,e,i){return{x:r-e,y:t-i,width:e*2,height:i*2}},length:function(r,t,e,i){return Math.PI*(3*(e+i)-Math.sqrt((3*e+i)*(e+3*i)))},nearestPoint:function(r,t,e,i,n,a){var o=e,s=i;if(o===0||s===0)return{x:r,y:t};for(var l=n-r,u=a-t,c=Math.abs(l),h=Math.abs(u),f=o*o,d=s*s,v=Math.PI/4,p,g,m=0;m<4;m++){p=o*Math.cos(v),g=s*Math.sin(v);var y=(f-d)*Math.pow(Math.cos(v),3)/o,_=(d-f)*Math.pow(Math.sin(v),3)/s,x=p-y,C=g-_,A=c-y,b=h-_,R=Math.hypot(C,x),M=Math.hypot(b,A),O=R*Math.asin((x*b-C*A)/(R*M)),F=O/Math.sqrt(f+d-p*p-g*g);v+=F,v=Math.min(Math.PI/2,Math.max(0,v))}return{x:r+ZM(p,l),y:t+ZM(g,u)}},pointDistance:function(r,t,e,i,n,a){var o=this.nearestPoint(r,t,e,i,n,a);return hi(o.x,o.y,n,a)},pointAt:function(r,t,e,i,n){var a=2*Math.PI*n;return{x:r+e*Math.cos(a),y:t+i*Math.sin(a)}},tangentAngle:function(r,t,e,i,n){var a=2*Math.PI*n,o=Math.atan2(i*Math.cos(a),-e*Math.sin(a));return Km(o)}};function Zot(r,t,e,i,n,a,o,s){return-1*e*Math.cos(n)*Math.sin(s)-i*Math.sin(n)*Math.cos(s)}function qot(r,t,e,i,n,a,o,s){return-1*e*Math.sin(n)*Math.sin(s)+i*Math.cos(n)*Math.cos(s)}function Kot(r,t,e){return Math.atan(-t/r*Math.tan(e))}function Qot(r,t,e){return Math.atan(t/(r*Math.tan(e)))}function qM(r,t,e,i,n,a){return e*Math.cos(n)*Math.cos(a)-i*Math.sin(n)*Math.sin(a)+r}function KM(r,t,e,i,n,a){return e*Math.sin(n)*Math.cos(a)+i*Math.cos(n)*Math.sin(a)+t}function Jot(r,t,e,i){var n=Math.atan2(i*r,e*t);return(n+Math.PI*2)%(Math.PI*2)}function QM(r,t,e){return{x:r*Math.cos(e),y:t*Math.sin(e)}}function JM(r,t,e){var i=Math.cos(e),n=Math.sin(e);return[r*i-t*n,r*n+t*i]}const tst={box:function(r,t,e,i,n,a,o){for(var s=Kot(e,i,n),l=1/0,u=-1/0,c=[a,o],h=-Math.PI*2;h<=Math.PI*2;h+=Math.PI){var f=s+h;a<o?a<f&&f<o&&c.push(f):o<f&&f<a&&c.push(f)}for(var h=0;h<c.length;h++){var d=qM(r,t,e,i,n,c[h]);d<l&&(l=d),d>u&&(u=d)}for(var v=Qot(e,i,n),p=1/0,g=-1/0,m=[a,o],h=-Math.PI*2;h<=Math.PI*2;h+=Math.PI){var y=v+h;a<o?a<y&&y<o&&m.push(y):o<y&&y<a&&m.push(y)}for(var h=0;h<m.length;h++){var _=KM(r,t,e,i,n,m[h]);_<p&&(p=_),_>g&&(g=_)}return{x:l,y:p,width:u-l,height:g-p}},length:function(r,t,e,i,n,a,o){},nearestPoint:function(r,t,e,i,n,a,o,s,l){var u=JM(s-r,l-t,-n),c=u[0],h=u[1],f=jot.nearestPoint(0,0,e,i,c,h),d=Jot(e,i,f.x,f.y);d<a?f=QM(e,i,a):d>o&&(f=QM(e,i,o));var v=JM(f.x,f.y,n);return{x:v[0]+r,y:v[1]+t}},pointDistance:function(r,t,e,i,n,a,o,s,l){var u=this.nearestPoint(r,t,e,i,s,l);return hi(u.x,u.y,s,l)},pointAt:function(r,t,e,i,n,a,o,s){var l=(o-a)*s+a;return{x:qM(r,t,e,i,n,l),y:KM(r,t,e,i,n,l)}},tangentAngle:function(r,t,e,i,n,a,o,s){var l=(o-a)*s+a,u=Zot(r,t,e,i,n,a,o,l),c=qot(r,t,e,i,n,a,o,l);return Km(Math.atan2(c,u))}};function U5(r){for(var t=0,e=[],i=0;i<r.length-1;i++){var n=r[i],a=r[i+1],o=hi(n[0],n[1],a[0],a[1]),s={from:n,to:a,length:o};e.push(s),t+=o}return{segments:e,totalLength:t}}function est(r){if(r.length<2)return 0;for(var t=0,e=0;e<r.length-1;e++){var i=r[e],n=r[e+1];t+=hi(i[0],i[1],n[0],n[1])}return t}function rst(r,t){if(t>1||t<0||r.length<2)return null;var e=U5(r),i=e.segments,n=e.totalLength;if(n===0)return{x:r[0][0],y:r[0][1]};for(var a=0,o=null,s=0;s<i.length;s++){var l=i[s],u=l.from,c=l.to,h=l.length/n;if(t>=a&&t<=a+h){var f=(t-a)/h;o=Hr.pointAt(u[0],u[1],c[0],c[1],f);break}a+=h}return o}function ist(r,t){if(t>1||t<0||r.length<2)return 0;for(var e=U5(r),i=e.segments,n=e.totalLength,a=0,o=0,s=0;s<i.length;s++){var l=i[s],u=l.from,c=l.to,h=l.length/n;if(t>=a&&t<=a+h){o=Math.atan2(c[1]-u[1],c[0]-u[0]);break}a+=h}return o}function nst(r,t,e){for(var i=1/0,n=0;n<r.length-1;n++){var a=r[n],o=r[n+1],s=Hr.pointDistance(a[0],a[1],o[0],o[1],t,e);s<i&&(i=s)}return i}const z5={box:function(r){for(var t=[],e=[],i=0;i<r.length;i++){var n=r[i];t.push(n[0]),e.push(n[1])}return Mh(t,e)},length:function(r){return est(r)},pointAt:function(r,t){return rst(r,t)},pointDistance:function(r,t,e){return nst(r,t,e)},tangentAngle:function(r,t){return ist(r,t)}};function t3(r,t){return!r||!t?r||t:{minX:Math.min(r.minX,t.minX),minY:Math.min(r.minY,t.minY),maxX:Math.max(r.maxX,t.maxX),maxY:Math.max(r.maxY,t.maxY)}}function DS(r,t){var e=r.get("startArrowShape"),i=r.get("endArrowShape"),n=null,a=null;return e&&(n=e.getCanvasBBox(),t=t3(t,n)),i&&(a=i.getCanvasBBox(),t=t3(t,a)),t}function ast(r){for(var t=r.attr(),e=t.points,i=[],n=[],a=0;a<e.length;a++){var o=e[a];i.push(o[0]),n.push(o[1])}var s=Mh(i,n),l=s.x,u=s.y,c=s.width,h=s.height,f={minX:l,minY:u,maxX:l+c,maxY:u+h};return f=DS(r,f),{x:f.minX,y:f.minY,width:f.maxX-f.minX,height:f.maxY-f.minY}}function ost(r){for(var t=r.attr(),e=t.points,i=[],n=[],a=0;a<e.length;a++){var o=e[a];i.push(o[0]),n.push(o[1])}return Mh(i,n)}var X_=null;function Bv(){if(!X_){var r=document.createElement("canvas");r.width=1,r.height=1,X_=r.getContext("2d")}return X_}function Dv(r,t,e){var i=1;if(mt(r)&&(i=r.split(`
`).length),i>1){var n=sst(t,e);return t*i+n*(i-1)}return t}function sst(r,t){return t?t-r:r*.14}function lst(r,t){var e=Bv(),i=0;if(K(r)||r==="")return i;if(e.save(),e.font=t,mt(r)&&r.includes(`
`)){var n=r.split(`
`);I(n,function(a){var o=e.measureText(a).width;i<o&&(i=o)})}else i=e.measureText(r).width;return e.restore(),i}function Nv(r){var t=r.fontSize,e=r.fontFamily,i=r.fontWeight,n=r.fontStyle,a=r.fontVariant;return[n,a,i,t+"px",e].join(" ").trim()}function ust(r){var t=r.attr(),e=t.x,i=t.y,n=t.text,a=t.fontSize,o=t.lineHeight,s=t.font;s||(s=Nv(t));var l=lst(n,s),u;if(!l)u={x:e,y:i,width:0,height:0};else{var c=t.textAlign,h=t.textBaseline,f=Dv(n,a,o),d={x:e,y:i-f};c&&(c==="end"||c==="right"?d.x-=l:c==="center"&&(d.x-=l/2)),h&&(h==="top"?d.y+=f:h==="middle"&&(d.y+=f/2)),u={x:d.x,y:d.y,width:l,height:f}}return u}var cst=/[MLHVQTCSAZ]([^MLHVQTCSAZ]*)/ig,hst=/[^\s\,]+/ig;function fst(r){var t=r||[];if(q(t))return t;if(mt(t))return t=t.match(cst),I(t,function(e,i){if(e=e.match(hst),e[0].length>1){var n=e[0].charAt(0);e.splice(1,0,e[0].substr(1)),e[0]=n}I(e,function(a,o){isNaN(a)||(e[o]=+a)}),t[i]=e}),t}function Vp(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Nx(r,t){return Vp(r)*Vp(t)?(r[0]*t[0]+r[1]*t[1])/(Vp(r)*Vp(t)):1}function e3(r,t){return(r[0]*t[1]<r[1]*t[0]?-1:1)*Math.acos(Nx(r,t))}function kx(r,t){return r[0]===t[0]&&r[1]===t[1]}function dst(r,t){var e=t[1],i=t[2],n=bv(wv(t[3]),Math.PI*2),a=t[4],o=t[5],s=r[0],l=r[1],u=t[6],c=t[7],h=Math.cos(n)*(s-u)/2+Math.sin(n)*(l-c)/2,f=-1*Math.sin(n)*(s-u)/2+Math.cos(n)*(l-c)/2,d=h*h/(e*e)+f*f/(i*i);d>1&&(e*=Math.sqrt(d),i*=Math.sqrt(d));var v=e*e*(f*f)+i*i*(h*h),p=v?Math.sqrt((e*e*(i*i)-v)/v):1;a===o&&(p*=-1),isNaN(p)&&(p=0);var g=i?p*e*f/i:0,m=e?p*-i*h/e:0,y=(s+u)/2+Math.cos(n)*g-Math.sin(n)*m,_=(l+c)/2+Math.sin(n)*g+Math.cos(n)*m,x=[(h-g)/e,(f-m)/i],C=[(-1*h-g)/e,(-1*f-m)/i],A=e3([1,0],x),b=e3(x,C);return Nx(x,C)<=-1&&(b=Math.PI),Nx(x,C)>=1&&(b=0),o===0&&b>0&&(b=b-2*Math.PI),o===1&&b<0&&(b=b+2*Math.PI),{cx:y,cy:_,rx:kx(r,[u,c])?0:e,ry:kx(r,[u,c])?0:i,startAngle:A,endAngle:A+b,xRotation:n,arcFlag:a,sweepFlag:o}}function r3(r,t){return[t[0]+(t[0]-r[0]),t[1]+(t[1]-r[1])]}function vst(r){r=fst(r);for(var t=[],e=null,i=null,n=null,a=0,o=r.length,s=0;s<o;s++){var l=r[s];i=r[s+1];var u=l[0],c={command:u,prePoint:e,params:l,startTangent:null,endTangent:null};switch(u){case"M":n=[l[1],l[2]],a=s;break;case"A":var h=dst(e,l);c.arcParams=h;break}if(u==="Z")e=n,i=r[a+1];else{var f=l.length;e=[l[f-2],l[f-1]]}i&&i[0]==="Z"&&(i=r[a],t[a]&&(t[a].prePoint=e)),c.currentPoint=e,t[a]&&kx(e,t[a].currentPoint)&&(t[a].prePoint=c.prePoint);var d=i?[i[i.length-2],i[i.length-1]]:null;c.nextPoint=d;var v=c.prePoint;if(["L","H","V"].includes(u))c.startTangent=[v[0]-e[0],v[1]-e[1]],c.endTangent=[e[0]-v[0],e[1]-v[1]];else if(u==="Q"){var p=[l[1],l[2]];c.startTangent=[v[0]-p[0],v[1]-p[1]],c.endTangent=[e[0]-p[0],e[1]-p[1]]}else if(u==="T"){var g=t[s-1],p=r3(g.currentPoint,v);g.command==="Q"?(c.command="Q",c.startTangent=[v[0]-p[0],v[1]-p[1]],c.endTangent=[e[0]-p[0],e[1]-p[1]]):(c.command="TL",c.startTangent=[v[0]-e[0],v[1]-e[1]],c.endTangent=[e[0]-v[0],e[1]-v[1]])}else if(u==="C"){var m=[l[1],l[2]],y=[l[3],l[4]];c.startTangent=[v[0]-m[0],v[1]-m[1]],c.endTangent=[e[0]-y[0],e[1]-y[1]],c.startTangent[0]===0&&c.startTangent[1]===0&&(c.startTangent=[m[0]-y[0],m[1]-y[1]]),c.endTangent[0]===0&&c.endTangent[1]===0&&(c.endTangent=[y[0]-m[0],y[1]-m[1]])}else if(u==="S"){var g=t[s-1],m=r3(g.currentPoint,v),y=[l[1],l[2]];g.command==="C"?(c.command="C",c.startTangent=[v[0]-m[0],v[1]-m[1]],c.endTangent=[e[0]-y[0],e[1]-y[1]]):(c.command="SQ",c.startTangent=[v[0]-y[0],v[1]-y[1]],c.endTangent=[e[0]-y[0],e[1]-y[1]])}else if(u==="A"){var _=.001,x=c.arcParams||{},C=x.cx,A=C===void 0?0:C,b=x.cy,R=b===void 0?0:b,M=x.rx,O=M===void 0?0:M,F=x.ry,D=F===void 0?0:F,H=x.sweepFlag,j=H===void 0?0:H,$=x.startAngle,k=$===void 0?0:$,V=x.endAngle,Q=V===void 0?0:V;j===0&&(_*=-1);var Y=O*Math.cos(k-_)+A,tt=D*Math.sin(k-_)+R;c.startTangent=[Y-n[0],tt-n[1]];var et=O*Math.cos(k+Q+_)+A,dt=D*Math.sin(k+Q-_)+R;c.endTangent=[v[0]-et,v[1]-dt]}t.push(c)}return t}function pst(r,t){for(var e=[],i=[],n=[],a=0;a<r.length;a++){var o=r[a],s=o.currentPoint,l=o.params,u=o.prePoint,c=void 0;switch(o.command){case"Q":c=N5.box(u[0],u[1],l[1],l[2],l[3],l[4]);break;case"C":c=Qf.box(u[0],u[1],l[1],l[2],l[3],l[4],l[5],l[6]);break;case"A":var h=o.arcParams;c=tst.box(h.cx,h.cy,h.rx,h.ry,h.xRotation,h.startAngle,h.endAngle);break;default:e.push(s[0]),i.push(s[1]);break}c&&(o.box=c,e.push(c.x,c.x+c.width),i.push(c.y,c.y+c.height)),t&&(o.command==="L"||o.command==="M")&&o.prePoint&&o.nextPoint&&n.push(o)}e=e.filter(function(m){return!Number.isNaN(m)&&m!==1/0&&m!==-1/0}),i=i.filter(function(m){return!Number.isNaN(m)&&m!==1/0&&m!==-1/0});var f=Tn(e),d=Tn(i),v=rn(e),p=rn(i);if(n.length===0)return{x:f,y:d,width:v-f,height:p-d};for(var a=0;a<n.length;a++){var o=n[a],s=o.currentPoint,g=void 0;s[0]===f?(g=Gp(o,t),f=f-g.xExtra):s[0]===v&&(g=Gp(o,t),v=v+g.xExtra),s[1]===d?(g=Gp(o,t),d=d-g.yExtra):s[1]===p&&(g=Gp(o,t),p=p+g.yExtra)}return{x:f,y:d,width:v-f,height:p-d}}function Gp(r,t){var e=r.prePoint,i=r.currentPoint,n=r.nextPoint,a=Math.pow(i[0]-e[0],2)+Math.pow(i[1]-e[1],2),o=Math.pow(i[0]-n[0],2)+Math.pow(i[1]-n[1],2),s=Math.pow(e[0]-n[0],2)+Math.pow(e[1]-n[1],2),l=Math.acos((a+o-s)/(2*Math.sqrt(a)*Math.sqrt(o)));if(!l||Math.sin(l)===0||wr(l,0))return{xExtra:0,yExtra:0};var u=Math.abs(Math.atan2(n[1]-i[1],n[0]-i[0])),c=Math.abs(Math.atan2(n[0]-i[0],n[1]-i[1]));u=u>Math.PI/2?Math.PI-u:u,c=c>Math.PI/2?Math.PI-c:c;var h={xExtra:Math.cos(l/2-u)*(t/2*(1/Math.sin(l/2)))-t/2||0,yExtra:Math.cos(c-l/2)*(t/2*(1/Math.sin(l/2)))-t/2||0};return h}function gst(r){var t=r.attr(),e=t.path,i=t.stroke,n=i?t.lineWidth:0,a=r.get("segments")||vst(e),o=pst(a,n),s=o.x,l=o.y,u=o.width,c=o.height,h={minX:s,minY:l,maxX:s+u,maxY:l+c};return h=DS(r,h),{x:h.minX,y:h.minY,width:h.maxX-h.minX,height:h.maxY-h.minY}}function mst(r){var t=r.attr(),e=t.x1,i=t.y1,n=t.x2,a=t.y2,o=Math.min(e,n),s=Math.max(e,n),l=Math.min(i,a),u=Math.max(i,a),c={minX:o,maxX:s,minY:l,maxY:u};return c=DS(r,c),{x:c.minX,y:c.minY,width:c.maxX-c.minX,height:c.maxY-c.minY}}function yst(r){var t=r.attr(),e=t.x,i=t.y,n=t.rx,a=t.ry;return{x:e-n,y:i-a,width:n*2,height:a*2}}Ln("rect",P5);Ln("image",P5);Ln("circle",F5);Ln("marker",F5);Ln("polyline",ast);Ln("polygon",ost);Ln("text",ust);Ln("path",gst);Ln("line",mst);Ln("ellipse",yst);var _st="0.5.11";const xst=Object.freeze(Object.defineProperty({__proto__:null,AbstractCanvas:Lv,AbstractGroup:Ov,AbstractShape:Pv,Base:Mv,Event:Rh,PathUtil:qm,assembleFont:Nv,getBBoxMethod:Fv,getOffScreenContext:Bv,getTextHeight:Dv,invert:Iv,isAllowCapture:nh,multiplyVec2:ao,registerBBox:Ln,registerEasing:BS,version:_st},Symbol.toStringTag,{value:"Module"}));var i3=0,Cst=1/2,Est=1/2,Sst=.05,kv=function(){function r(t){var e=t.xField,i=t.yField,n=t.adjustNames,a=n===void 0?["x","y"]:n,o=t.dimValuesMap;this.adjustNames=a,this.xField=e,this.yField=i,this.dimValuesMap=o}return r.prototype.isAdjust=function(t){return this.adjustNames.indexOf(t)>=0},r.prototype.getAdjustRange=function(t,e,i){var n=this.yField,a=i.indexOf(e),o=i.length,s,l;return!n&&this.isAdjust("y")?(s=0,l=1):o>1?(s=i[a===0?0:a-1],l=i[a===o-1?o-1:a+1],a!==0?s+=(e-s)/2:s-=(l-e)/2,a!==o-1?l-=(l-e)/2:l+=(e-i[o-2])/2):(s=e===0?0:e-.5,l=e===0?1:e+.5),{pre:s,next:l}},r.prototype.adjustData=function(t,e){var i=this,n=this.getDimValues(e);I(t,function(a,o){I(n,function(s,l){i.adjustDim(l,s,a,o)})})},r.prototype.groupData=function(t,e){return I(t,function(i){i[e]===void 0&&(i[e]=i3)}),Qi(t,e)},r.prototype.adjustDim=function(t,e,i,n){},r.prototype.getDimValues=function(t){var e=this,i=e.xField,n=e.yField,a=ne({},this.dimValuesMap),o=[];if(i&&this.isAdjust("x")&&o.push(i),n&&this.isAdjust("y")&&o.push(n),o.forEach(function(l){a&&a[l]||(a[l]=ea(t,l).sort(function(u,c){return u-c}))}),!n&&this.isAdjust("y")){var s="y";a[s]=[i3,1]}return a},r}(),H5={},NS=function(r){return H5[r.toLowerCase()]},Uv=function(r,t){if(NS(r))throw new Error("Adjust type '"+r+"' existed.");H5[r.toLowerCase()]=t};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Ux=function(r,t){return Ux=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)i.hasOwnProperty(n)&&(e[n]=i[n])},Ux(r,t)};function Qm(r,t){Ux(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var oo=function(){return oo=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++){e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t},oo.apply(this,arguments)},Ast=function(r){Qm(t,r);function t(e){var i=r.call(this,e)||this;i.cacheMap={},i.adjustDataArray=[],i.mergeData=[];var n=e.marginRatio,a=n===void 0?Cst:n,o=e.dodgeRatio,s=o===void 0?Est:o,l=e.dodgeBy,u=e.intervalPadding,c=e.dodgePadding,h=e.xDimensionLength,f=e.groupNum,d=e.defaultSize,v=e.maxColumnWidth,p=e.minColumnWidth,g=e.columnWidthRatio,m=e.customOffset;return i.marginRatio=a,i.dodgeRatio=s,i.dodgeBy=l,i.intervalPadding=u,i.dodgePadding=c,i.xDimensionLegenth=h,i.groupNum=f,i.defaultSize=d,i.maxColumnWidth=v,i.minColumnWidth=p,i.columnWidthRatio=g,i.customOffset=m,i}return t.prototype.process=function(e){var i=Rr(e),n=en(i),a=this.dodgeBy,o=a?a5(n,a):i;return this.cacheMap={},this.adjustDataArray=o,this.mergeData=n,this.adjustData(o,n),this.adjustDataArray=[],this.mergeData=[],i},t.prototype.adjustDim=function(e,i,n,a){var o=this,s=this.customOffset,l=this.getDistribution(e),u=this.groupData(n,e);return I(u,function(c,h){var f;i.length===1?f={pre:i[0]-1,next:i[0]+1}:f=o.getAdjustRange(e,parseFloat(h),i),I(c,function(d){var v=d[e],p=l[v],g=p.indexOf(a);if(K(s))d[e]=o.getDodgeOffset(f,g,p.length);else{var m=f.pre,y=f.next;d[e]=ot(s)?s(d,f):(m+y)/2+s}})}),[]},t.prototype.getDodgeOffset=function(e,i,n){var a=this,o=a.dodgeRatio,s=a.marginRatio,l=a.intervalPadding,u=a.dodgePadding,c=e.pre,h=e.next,f=h-c,d;if(!K(l)&&K(u)&&l>=0){var v=this.getIntervalOnlyOffset(n,i);d=c+v}else if(!K(u)&&K(l)&&u>=0){var v=this.getDodgeOnlyOffset(n,i);d=c+v}else if(!K(l)&&!K(u)&&l>=0&&u>=0){var v=this.getIntervalAndDodgeOffset(n,i);d=c+v}else{var p=f*o/n,g=s*p,v=1/2*(f-n*p-(n-1)*g)+((i+1)*p+i*g)-1/2*p-1/2*f;d=(c+h)/2+v}return d},t.prototype.getIntervalOnlyOffset=function(e,i){var n=this,a=n.defaultSize,o=n.intervalPadding,s=n.xDimensionLegenth,l=n.groupNum,u=n.dodgeRatio,c=n.maxColumnWidth,h=n.minColumnWidth,f=n.columnWidthRatio,d=o/s,v=(1-(l-1)*d)/l*u/(e-1),p=((1-d*(l-1))/l-v*(e-1))/e;if(p=K(f)?p:1/l/e*f,!K(c)){var g=c/s;p=Math.min(p,g)}if(!K(h)){var m=h/s;p=Math.max(p,m)}p=a?a/s:p,v=((1-(l-1)*d)/l-e*p)/(e-1);var y=((1/2+i)*p+i*v+1/2*d)*l-d/2;return y},t.prototype.getDodgeOnlyOffset=function(e,i){var n=this,a=n.defaultSize,o=n.dodgePadding,s=n.xDimensionLegenth,l=n.groupNum,u=n.marginRatio,c=n.maxColumnWidth,h=n.minColumnWidth,f=n.columnWidthRatio,d=o/s,v=1*u/(l-1),p=((1-v*(l-1))/l-d*(e-1))/e;if(p=f?1/l/e*f:p,!K(c)){var g=c/s;p=Math.min(p,g)}if(!K(h)){var m=h/s;p=Math.max(p,m)}p=a?a/s:p,v=(1-(p*e+d*(e-1))*l)/(l-1);var y=((1/2+i)*p+i*d+1/2*v)*l-v/2;return y},t.prototype.getIntervalAndDodgeOffset=function(e,i){var n=this,a=n.intervalPadding,o=n.dodgePadding,s=n.xDimensionLegenth,l=n.groupNum,u=a/s,c=o/s,h=((1-u*(l-1))/l-c*(e-1))/e,f=((1/2+i)*h+i*c+1/2*u)*l-u/2;return f},t.prototype.getDistribution=function(e){var i=this.adjustDataArray,n=this.cacheMap,a=n[e];return a||(a={},I(i,function(o,s){var l=ea(o,e);l.length||l.push(0),I(l,function(u){a[u]||(a[u]=[]),a[u].push(s)})}),n[e]=a),a},t}(kv);function Tst(r,t){return(t-r)*Math.random()+r}var bst=function(r){Qm(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.process=function(e){var i=Rr(e),n=en(i);return this.adjustData(i,n),i},t.prototype.adjustDim=function(e,i,n){var a=this,o=this.groupData(n,e);return I(o,function(s,l){return a.adjustGroup(s,e,parseFloat(l),i)})},t.prototype.getAdjustOffset=function(e){var i=e.pre,n=e.next,a=(n-i)*Sst;return Tst(i+a,n-a)},t.prototype.adjustGroup=function(e,i,n,a){var o=this,s=this.getAdjustRange(i,n,a);return I(e,function(l){l[i]=o.getAdjustOffset(s)}),e},t}(kv),Y_=g5,wst=function(r){Qm(t,r);function t(e){var i=r.call(this,e)||this,n=e.adjustNames,a=n===void 0?["y"]:n,o=e.height,s=o===void 0?NaN:o,l=e.size,u=l===void 0?10:l,c=e.reverseOrder,h=c===void 0?!1:c;return i.adjustNames=a,i.height=s,i.size=u,i.reverseOrder=h,i}return t.prototype.process=function(e){var i=this,n=i.yField,a=i.reverseOrder,o=n?this.processStack(e):this.processOneDimStack(e);return a?this.reverse(o):o},t.prototype.reverse=function(e){return e.slice(0).reverse()},t.prototype.processStack=function(e){var i=this,n=i.xField,a=i.yField,o=i.reverseOrder,s=o?this.reverse(e):e,l=new Y_,u=new Y_;return s.map(function(c){return c.map(function(h){var f,d=P(h,n,0),v=P(h,[a]),p=d.toString();if(v=q(v)?v[1]:v,!K(v)){var g=v>=0?l:u;g.has(p)||g.set(p,0);var m=g.get(p),y=v+m;return g.set(p,y),oo(oo({},h),(f={},f[a]=[m,y],f))}return h})})},t.prototype.processOneDimStack=function(e){var i=this,n=this,a=n.xField,o=n.height,s=n.reverseOrder,l="y",u=s?this.reverse(e):e,c=new Y_;return u.map(function(h){return h.map(function(f){var d,v=i.size,p=f[a],g=v*2/o;c.has(p)||c.set(p,g/2);var m=c.get(p);return c.set(p,m+g),oo(oo({},f),(d={},d[l]=m,d))})})},t}(kv),Rst=function(r){Qm(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.process=function(e){var i=en(e),n=this,a=n.xField,o=n.yField,s=this.getXValuesMaxMap(i),l=Math.max.apply(Math,Object.keys(s).map(function(u){return s[u]}));return Ne(e,function(u){return Ne(u,function(c){var h,f,d=c[o],v=c[a];if(q(d)){var p=(l-s[v])/2;return oo(oo({},c),(h={},h[o]=Ne(d,function(m){return p+m}),h))}var g=(l-d)/2;return oo(oo({},c),(f={},f[o]=[g,d+g],f))})})},t.prototype.getXValuesMaxMap=function(e){var i=this,n=this,a=n.xField,o=n.yField,s=Qi(e,function(l){return l[a]});return d5(s,function(l){return i.getDimMaxValue(l,o)})},t.prototype.getDimMaxValue=function(e,i){var n=Ne(e,function(o){return P(o,i,[])}),a=en(n);return Math.max.apply(Math,a)},t}(kv);Uv("Dodge",Ast);Uv("Jitter",bst);Uv("Stack",wst);Uv("Symmetric",Rst);const Mst=Object.freeze(Object.defineProperty({__proto__:null,Adjust:kv,getAdjust:NS,registerAdjust:Uv},Symbol.toStringTag,{value:"Module"}));var n3=function(r,t){return mt(t)?t:r.invert(r.scale(t))},Ih=function(){function r(t){this.names=[],this.scales=[],this.linear=!1,this.values=[],this.callback=function(){return[]},this._parseCfg(t)}return r.prototype.mapping=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=e.map(function(a,o){return t._toOriginParam(a,t.scales[o])});return this.callback.apply(this,n)},r.prototype.getLinearValue=function(t){var e=this.values.length-1,i=Math.floor(e*t),n=e*t-i,a=this.values[i],o=i===e?a:this.values[i+1];return a+(o-a)*n},r.prototype.getNames=function(){for(var t=this.scales,e=this.names,i=Math.min(t.length,e.length),n=[],a=0;a<i;a+=1)n.push(e[a]);return n},r.prototype.getFields=function(){return this.scales.map(function(t){return t.field})},r.prototype.getScale=function(t){return this.scales[this.names.indexOf(t)]},r.prototype.defaultCallback=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return e.length===0?this.values:e.map(function(n,a){var o=t.scales[a];return o.type==="identity"?o.values[0]:t._getAttributeValue(o,n)})},r.prototype._parseCfg=function(t){var e=this,i=t.type,n=i===void 0?"base":i,a=t.names,o=a===void 0?[]:a,s=t.scales,l=s===void 0?[]:s,u=t.values,c=u===void 0?[]:u,h=t.callback;this.type=n,this.scales=l,this.values=c,this.names=o,this.callback=function(){for(var f=[],d=0;d<arguments.length;d++)f[d]=arguments[d];if(h){var v=h.apply(void 0,f);if(!K(v))return[v]}return e.defaultCallback.apply(e,f)}},r.prototype._getAttributeValue=function(t,e){if(t.isCategory&&!this.linear){var i=t.translate(e);return this.values[i%this.values.length]}var n=t.scale(e);return this.getLinearValue(n)},r.prototype._toOriginParam=function(t,e){return e.isLinear?t:q(t)?t.map(function(i){return n3(e,i)}):n3(e,t)},r}(),Ist=/rgba?\(([\s.,0-9]+)\)/,Lst=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,Ost=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,Pst=/[\d.]+:(#[^\s]+|[^\)]+\))/gi,Fst=function(r){return/^[r,R,L,l]{1}[\s]*\(/.test(r)},Bst=function(){var r=document.createElement("i");return r.title="Web Colour Picker",r.style.display="none",document.body.appendChild(r),r},j_=function(r,t,e,i){return r[i]+(t[i]-r[i])*e};function $5(r){return"#"+Z_(r[0])+Z_(r[1])+Z_(r[2])}var W5=function(r){return[parseInt(r.substr(1,2),16),parseInt(r.substr(3,2),16),parseInt(r.substr(5,2),16)]},Z_=function(r){var t=Math.round(r).toString(16);return t.length===1?"0"+t:t},Dst=function(r,t){var e=isNaN(Number(t))||t<0?0:t>1?1:Number(t),i=r.length-1,n=Math.floor(i*e),a=i*e-n,o=r[n],s=n===i?o:r[n+1];return $5([j_(o,s,a,0),j_(o,s,a,1),j_(o,s,a,2)])},Xp,V5=function(r){if(r[0]==="#"&&r.length===7)return r;Xp||(Xp=Bst()),Xp.style.color=r;var t=document.defaultView.getComputedStyle(Xp,"").getPropertyValue("color"),e=Ist.exec(t),i=e[1].split(/\s*,\s*/).map(function(n){return Number(n)});return t=$5(i),t},Nst=function(r){var t=mt(r)?r.split("-"):r,e=Ne(t,function(i){return W5(i.indexOf("#")===-1?V5(i):i)});return function(i){return Dst(e,i)}},kst=function(r){if(Fst(r)){var t,e=void 0;if(r[0]==="l"){var i=Lst.exec(r),n=+i[1]+90;e=i[2],t="linear-gradient("+n+"deg, "}else if(r[0]==="r"){t="radial-gradient(";var i=Ost.exec(r);e=i[4]}var a=e.match(Pst);return I(a,function(o,s){var l=o.split(":");t+=l[1]+" "+l[0]*100+"%",s!==a.length-1&&(t+=", ")}),t+=")",t}return r};const Gs={rgb2arr:W5,gradient:Nst,toRGB:Nu(V5),toCSSGradient:kst};var G5=function(r){N(t,r);function t(e){var i=r.call(this,e)||this;return i.type="color",i.names=["color"],mt(i.values)&&(i.linear=!0),i.gradient=Gs.gradient(i.values),i}return t.prototype.getLinearValue=function(e){return this.gradient(e)},t}(Ih),X5=function(r){N(t,r);function t(e){var i=r.call(this,e)||this;return i.type="opacity",i.names=["opacity"],i}return t}(Ih),Y5=function(r){N(t,r);function t(e){var i=r.call(this,e)||this;return i.names=["x","y"],i.type="position",i}return t.prototype.mapping=function(e,i){var n=this.scales,a=n[0],o=n[1];return K(e)||K(i)?[]:[q(e)?e.map(function(s){return a.scale(s)}):a.scale(e),q(i)?i.map(function(s){return o.scale(s)}):o.scale(i)]},t}(Ih),j5=function(r){N(t,r);function t(e){var i=r.call(this,e)||this;return i.type="shape",i.names=["shape"],i}return t.prototype.getLinearValue=function(e){var i=Math.round((this.values.length-1)*e);return this.values[i]},t}(Ih),Z5=function(r){N(t,r);function t(e){var i=r.call(this,e)||this;return i.type="size",i.names=["size"],i}return t}(Ih),q5={};function K5(r){return q5[r]}function za(r,t){q5[r]=t}var zv=function(){function r(t){this.type="base",this.isCategory=!1,this.isLinear=!1,this.isContinuous=!1,this.isIdentity=!1,this.values=[],this.range=[0,1],this.ticks=[],this.__cfg__=t,this.initCfg(),this.init()}return r.prototype.translate=function(t){return t},r.prototype.change=function(t){ne(this.__cfg__,t),this.init()},r.prototype.clone=function(){return this.constructor(this.__cfg__)},r.prototype.getTicks=function(){var t=this;return Ne(this.ticks,function(e,i){return ie(e)?e:{text:t.getText(e,i),tickValue:e,value:t.scale(e)}})},r.prototype.getText=function(t,e){var i=this.formatter,n=i?i(t,e):t;return K(n)||!ot(n.toString)?"":n.toString()},r.prototype.getConfig=function(t){return this.__cfg__[t]},r.prototype.init=function(){ne(this,this.__cfg__),this.setDomain(),Mi(this.getConfig("ticks"))&&(this.ticks=this.calculateTicks())},r.prototype.initCfg=function(){},r.prototype.setDomain=function(){},r.prototype.calculateTicks=function(){var t=this.tickMethod,e=[];if(mt(t)){var i=K5(t);if(!i)throw new Error("There is no method to to calculate ticks!");e=i(this)}else ot(t)&&(e=t(this));return e},r.prototype.rangeMin=function(){return this.range[0]},r.prototype.rangeMax=function(){return this.range[1]},r.prototype.calcPercent=function(t,e,i){return Tt(t)?(t-e)/(i-e):NaN},r.prototype.calcValue=function(t,e,i){return e+t*(i-e)},r}(),Hv=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="cat",e.isCategory=!0,e}return t.prototype.buildIndexMap=function(){if(!this.translateIndexMap){this.translateIndexMap=new Map;for(var e=0;e<this.values.length;e++)this.translateIndexMap.set(this.values[e],e)}},t.prototype.translate=function(e){this.buildIndexMap();var i=this.translateIndexMap.get(e);return i===void 0&&(i=Tt(e)?e:NaN),i},t.prototype.scale=function(e){var i=this.translate(e),n=this.calcPercent(i,this.min,this.max);return this.calcValue(n,this.rangeMin(),this.rangeMax())},t.prototype.invert=function(e){var i=this.max-this.min,n=this.calcPercent(e,this.rangeMin(),this.rangeMax()),a=Math.round(i*n)+this.min;return a<this.min||a>this.max?NaN:this.values[a]},t.prototype.getText=function(e){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var a=e;return Tt(e)&&!this.values.includes(e)&&(a=this.values[a]),r.prototype.getText.apply(this,md([a],i))},t.prototype.initCfg=function(){this.tickMethod="cat"},t.prototype.setDomain=function(){if(K(this.getConfig("min"))&&(this.min=0),K(this.getConfig("max"))){var e=this.values.length;this.max=e>1?e-1:e}this.translateIndexMap&&(this.translateIndexMap=void 0)},t}(zv);function Ust(r){return function(t,e,i,n){for(var a=K(i)?0:i,o=K(n)?t.length:n;a<o;){var s=a+o>>>1;r(t[s])>e?o=s:a=s+1}return a}}var a3="format";function Q5(r,t){var e=_W[a3]||xW[a3];return e(r,t)}function $0(r){return mt(r)&&(r.indexOf("T")>0?r=new Date(r).getTime():r=new Date(r.replace(/-/gi,"/")).getTime()),RS(r)&&(r=r.getTime()),r}var _a=1e3,Jl=60*_a,tu=60*Jl,Xo=24*tu,Jf=Xo*31,o3=Xo*365,yf=[["HH:mm:ss",_a],["HH:mm:ss",_a*10],["HH:mm:ss",_a*30],["HH:mm",Jl],["HH:mm",Jl*10],["HH:mm",Jl*30],["HH",tu],["HH",tu*6],["HH",tu*12],["YYYY-MM-DD",Xo],["YYYY-MM-DD",Xo*4],["YYYY-WW",Xo*7],["YYYY-MM",Jf],["YYYY-MM",Jf*4],["YYYY-MM",Jf*6],["YYYY",Xo*380]];function zst(r,t,e){var i=(t-r)/e,n=Ust(function(o){return o[1]})(yf,i)-1,a=yf[n];return n<0?a=yf[0]:n>=yf.length&&(a=cr(yf)),a}var J5=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="timeCat",e}return t.prototype.translate=function(e){e=$0(e);var i=this.values.indexOf(e);return i===-1&&(Tt(e)&&e<this.values.length?i=e:i=NaN),i},t.prototype.getText=function(e,i){var n=this.translate(e);if(n>-1){var a=this.values[n],o=this.formatter;return a=o?o(a,i):Q5(a,this.mask),a}return e},t.prototype.initCfg=function(){this.tickMethod="time-cat",this.mask="YYYY-MM-DD",this.tickCount=7},t.prototype.setDomain=function(){var e=this.values;I(e,function(i,n){e[n]=$0(i)}),e.sort(function(i,n){return i-n}),r.prototype.setDomain.call(this)},t}(Hv),Jm=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.isContinuous=!0,e}return t.prototype.scale=function(e){if(K(e))return NaN;var i=this.rangeMin(),n=this.rangeMax(),a=this.max,o=this.min;if(a===o)return i;var s=this.getScalePercent(e);return i+s*(n-i)},t.prototype.init=function(){r.prototype.init.call(this);var e=this.ticks,i=Ki(e),n=cr(e);i<this.min&&(this.min=i),n>this.max&&(this.max=n),K(this.minLimit)||(this.min=i),K(this.maxLimit)||(this.max=n)},t.prototype.setDomain=function(){var e=TS(this.values),i=e.min,n=e.max;K(this.min)&&(this.min=i),K(this.max)&&(this.max=n),this.min>this.max&&(this.min=i,this.max=n)},t.prototype.calculateTicks=function(){var e=this,i=r.prototype.calculateTicks.call(this);return this.nice||(i=Fr(i,function(n){return n>=e.min&&n<=e.max})),i},t.prototype.getScalePercent=function(e){var i=this.max,n=this.min;return(e-n)/(i-n)},t.prototype.getInvertPercent=function(e){return(e-this.rangeMin())/(this.rangeMax()-this.rangeMin())},t}(zv),$v=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="linear",e.isLinear=!0,e}return t.prototype.invert=function(e){var i=this.getInvertPercent(e);return this.min+i*(this.max-this.min)},t.prototype.initCfg=function(){this.tickMethod="wilkinson-extended",this.nice=!1},t}(Jm);function Os(r,t){var e=Math.E,i;return t>=0?i=Math.pow(e,Math.log(t)/r):i=Math.pow(e,Math.log(-t)/r)*-1,i}function $n(r,t){return r===1?1:Math.log(t)/Math.log(r)}function t4(r,t,e){K(e)&&(e=Math.max.apply(null,r));var i=e;return I(r,function(n){n>0&&n<i&&(i=n)}),i===e&&(i=e/t),i>1&&(i=1),i}var e4=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="log",e}return t.prototype.invert=function(e){var i=this.base,n=$n(i,this.max),a=this.rangeMin(),o=this.rangeMax()-a,s,l=this.positiveMin;if(l){if(e===0)return 0;s=$n(i,l/i);var u=1/(n-s)*o;if(e<u)return e/u*l}else s=$n(i,this.min);var c=(e-a)/o,h=c*(n-s)+s;return Math.pow(i,h)},t.prototype.initCfg=function(){this.tickMethod="log",this.base=10,this.tickCount=6,this.nice=!0},t.prototype.setDomain=function(){r.prototype.setDomain.call(this);var e=this.min;if(e<0)throw new Error("When you use log scale, the minimum value must be greater than zero!");e===0&&(this.positiveMin=t4(this.values,this.base,this.max))},t.prototype.getScalePercent=function(e){var i=this.max,n=this.min;if(i===n||e<=0)return 0;var a=this.base,o=this.positiveMin;o&&(n=o*1/a);var s;return e<o?s=e/o/($n(a,i)-$n(a,n)):s=($n(a,e)-$n(a,n))/($n(a,i)-$n(a,n)),s},t}(Jm),r4=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="pow",e}return t.prototype.invert=function(e){var i=this.getInvertPercent(e),n=this.exponent,a=Os(n,this.max),o=Os(n,this.min),s=i*(a-o)+o,l=s>=0?1:-1;return Math.pow(s,n)*l},t.prototype.initCfg=function(){this.tickMethod="pow",this.exponent=2,this.tickCount=5,this.nice=!0},t.prototype.getScalePercent=function(e){var i=this.max,n=this.min;if(i===n)return 0;var a=this.exponent,o=(Os(a,e)-Os(a,n))/(Os(a,i)-Os(a,n));return o},t}(Jm),i4=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="time",e}return t.prototype.getText=function(e,i){var n=this.translate(e),a=this.formatter;return a?a(n,i):Q5(n,this.mask)},t.prototype.scale=function(e){var i=e;return(mt(i)||RS(i))&&(i=this.translate(i)),r.prototype.scale.call(this,i)},t.prototype.translate=function(e){return $0(e)},t.prototype.initCfg=function(){this.tickMethod="time-pretty",this.mask="YYYY-MM-DD",this.tickCount=7,this.nice=!1},t.prototype.setDomain=function(){var e=this.values,i=this.getConfig("min"),n=this.getConfig("max");if((!K(i)||!Tt(i))&&(this.min=this.translate(this.min)),(!K(n)||!Tt(n))&&(this.max=this.translate(this.max)),e&&e.length){var a=[],o=1/0,s=o,l=0;I(e,function(u){var c=$0(u);if(isNaN(c))throw new TypeError("Invalid Time: "+u+" in time scale!");o>c?(s=o,o=c):s>c&&(s=c),l<c&&(l=c),a.push(c)}),e.length>1&&(this.minTickInterval=s-o),K(i)&&(this.min=o),K(n)&&(this.max=l)}},t}($v),kS=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="quantize",e}return t.prototype.invert=function(e){var i=this.ticks,n=i.length,a=this.getInvertPercent(e),o=Math.floor(a*(n-1));if(o>=n-1)return cr(i);if(o<0)return Ki(i);var s=i[o],l=i[o+1],u=o/(n-1),c=(o+1)/(n-1);return s+(a-u)/(c-u)*(l-s)},t.prototype.initCfg=function(){this.tickMethod="r-pretty",this.tickCount=5,this.nice=!0},t.prototype.calculateTicks=function(){var e=r.prototype.calculateTicks.call(this);return this.nice||(cr(e)!==this.max&&e.push(this.max),Ki(e)!==this.min&&e.unshift(this.min)),e},t.prototype.getScalePercent=function(e){var i=this.ticks;if(e<Ki(i))return 0;if(e>cr(i))return 1;var n=0;return I(i,function(a,o){if(e>=a)n=o;else return!1}),n/(i.length-1)},t}(Jm),n4=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="quantile",e}return t.prototype.initCfg=function(){this.tickMethod="quantile",this.tickCount=5,this.nice=!0},t}(kS),a4={};function W0(r){return a4[r]}function Ha(r,t){if(W0(r))throw new Error("type '"+r+"' existed.");a4[r]=t}var o4=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="identity",e.isIdentity=!0,e}return t.prototype.calculateTicks=function(){return this.values},t.prototype.scale=function(e){return this.values[0]!==e&&Tt(e)?e:this.range[0]},t.prototype.invert=function(e){var i=this.range;return e<i[0]||e>i[1]?NaN:this.values[0]},t}(zv);function s4(r){var t=r.values,e=r.tickInterval,i=r.tickCount,n=r.showLast;if(Tt(e)){var a=Fr(t,function(v,p){return p%e===0}),o=cr(t);return n&&cr(a)!==o&&a.push(o),a}var s=t.length,l=r.min,u=r.max;if(K(l)&&(l=0),K(u)&&(u=t.length-1),!Tt(i)||i>=s)return t.slice(l,u+1);if(i<=0||u<=0)return[];for(var c=i===1?s:Math.floor(s/(i-1)),h=[],f=l,d=0;d<i&&!(f>=u);d++)f=Math.min(l+d*c,u),d===i-1&&n?h.push(t[u]):h.push(t[f]);return h}function Hst(r){var t=r.min,e=r.max,i=r.nice,n=r.tickCount,a=new $st;return a.domain([t,e]),i&&a.nice(n),a.ticks(n)}var q_=5,s3=Math.sqrt(50),l3=Math.sqrt(10),u3=Math.sqrt(2),$st=function(){function r(){this._domain=[0,1]}return r.prototype.domain=function(t){return t?(this._domain=Array.from(t,Number),this):this._domain.slice()},r.prototype.nice=function(t){var e,i;t===void 0&&(t=q_);var n=this._domain.slice(),a=0,o=this._domain.length-1,s=this._domain[a],l=this._domain[o],u;return l<s&&(e=[l,s],s=e[0],l=e[1],i=[o,a],a=i[0],o=i[1]),u=qg(s,l,t),u>0?(s=Math.floor(s/u)*u,l=Math.ceil(l/u)*u,u=qg(s,l,t)):u<0&&(s=Math.ceil(s*u)/u,l=Math.floor(l*u)/u,u=qg(s,l,t)),u>0?(n[a]=Math.floor(s/u)*u,n[o]=Math.ceil(l/u)*u,this.domain(n)):u<0&&(n[a]=Math.ceil(s*u)/u,n[o]=Math.floor(l*u)/u,this.domain(n)),this},r.prototype.ticks=function(t){return t===void 0&&(t=q_),Wst(this._domain[0],this._domain[this._domain.length-1],t||q_)},r}();function Wst(r,t,e){var i,n=-1,a,o,s;if(t=+t,r=+r,e=+e,r===t&&e>0)return[r];if((i=t<r)&&(a=r,r=t,t=a),(s=qg(r,t,e))===0||!isFinite(s))return[];if(s>0)for(r=Math.ceil(r/s),t=Math.floor(t/s),o=new Array(a=Math.ceil(t-r+1));++n<a;)o[n]=(r+n)*s;else for(r=Math.floor(r*s),t=Math.ceil(t*s),o=new Array(a=Math.ceil(r-t+1));++n<a;)o[n]=(r-n)/s;return i&&o.reverse(),o}function qg(r,t,e){var i=(t-r)/Math.max(0,e),n=Math.floor(Math.log(i)/Math.LN10),a=i/Math.pow(10,n);return n>=0?(a>=s3?10:a>=l3?5:a>=u3?2:1)*Math.pow(10,n):-Math.pow(10,-n)/(a>=s3?10:a>=l3?5:a>=u3?2:1)}function c3(r,t,e){var i;return e==="ceil"?i=Math.ceil(r/t):e==="floor"?i=Math.floor(r/t):i=Math.round(r/t),i*t}function US(r,t,e){var i=c3(r,e,"floor"),n=c3(t,e,"ceil");i=jg(i,e),n=jg(n,e);for(var a=[],o=Math.max((n-i)/(Math.pow(2,12)-1),e),s=i;s<=n;s=s+o){var l=jg(s,o);a.push(l)}return{min:i,max:n,ticks:a}}function zS(r,t,e){var i,n=r.minLimit,a=r.maxLimit,o=r.min,s=r.max,l=r.tickCount,u=l===void 0?5:l,c=K(n)?K(t)?o:t:n,h=K(a)?K(e)?s:e:a;if(c>h&&(i=[c,h],h=i[0],c=i[1]),u<=2)return[c,h];for(var f=(h-c)/(u-1),d=[],v=0;v<u;v++)d.push(c+f*v);return d}function Vst(r){var t=r.min,e=r.max,i=r.tickInterval,n=r.minLimit,a=r.maxLimit,o=Hst(r);return!K(n)||!K(a)?zS(r,Ki(o),cr(o)):i?US(t,e,i).ticks:o}function Ol(r){return Math.abs(r)<1e-15?r:parseFloat(r.toFixed(15))}var Gst=[1,5,2,2.5,4,3],h3=Number.EPSILON*100;function Xst(r,t){return(r%t+t)%t}function Yst(r){return Math.round(r*1e12)/1e12}function jst(r,t,e,i,n,a){var o=xr(t),s=LS(t,r),l=0,u=Xst(i,a);return(u<h3||a-u<h3)&&i<=0&&n>=0&&(l=1),1-s/(o-1)-e+l}function Zst(r,t,e){var i=xr(t),n=LS(t,r),a=1;return 1-n/(i-1)-e+a}function qst(r,t,e,i,n,a){var o=(r-1)/(a-n),s=(t-1)/(Math.max(a,i)-Math.min(e,n));return 2-Math.max(o/s,s/o)}function Kst(r,t){return r>=t?2-(r-1)/(t-1):1}function Qst(r,t,e,i){var n=t-r;return 1-.5*(Math.pow(t-i,2)+Math.pow(r-e,2))/Math.pow(.1*n,2)}function Jst(r,t,e){var i=t-r;if(e>i){var n=(e-i)/2;return 1-Math.pow(n,2)/Math.pow(.1*i,2)}return 1}function tlt(){return 1}function elt(r,t,e,i,n,a){e===void 0&&(e=5),i===void 0&&(i=!0),n===void 0&&(n=Gst),a===void 0&&(a=[.25,.2,.5,.05]);var o=e<0?0:Math.round(e);if(Number.isNaN(r)||Number.isNaN(t)||typeof r!="number"||typeof t!="number"||!o)return{min:0,max:0,ticks:[]};if(t-r<1e-15||o===1)return{min:r,max:t,ticks:[r]};if(t-r>1e148){var s=e||5,l=(t-r)/s;return{min:r,max:t,ticks:Array(s).fill(null).map(function(et,dt){return Ol(r+l*dt)})}}for(var u={score:-2,lmin:0,lmax:0,lstep:0},c=1;c<1/0;){for(var h=0;h<n.length;h+=1){var f=n[h],d=Zst(f,n,c);if(a[0]*d+a[1]+a[2]+a[3]<u.score){c=1/0;break}for(var v=2;v<1/0;){var p=Kst(v,o);if(a[0]*d+a[1]+a[2]*p+a[3]<u.score)break;for(var g=(t-r)/(v+1)/c/f,m=Math.ceil(Math.log10(g));m<1/0;){var y=c*f*Math.pow(10,m),_=Jst(r,t,y*(v-1));if(a[0]*d+a[1]*_+a[2]*p+a[3]<u.score)break;var x=Math.floor(t/y)*c-(v-1)*c,C=Math.ceil(r/y)*c;if(x<=C)for(var s=C-x,A=0;A<=s;A+=1){var b=x+A,R=b*(y/c),M=R+y*(v-1),O=y,F=jst(f,n,c,R,M,O),D=Qst(r,t,R,M),H=qst(v,o,r,t,R,M),j=tlt(),$=a[0]*F+a[1]*D+a[2]*H+a[3]*j;$>u.score&&(!i||R<=r&&M>=t)&&(u.lmin=R,u.lmax=M,u.lstep=O,u.score=$)}m+=1}v+=1}}c+=1}var k=Ol(u.lmax),V=Ol(u.lmin),Q=Ol(u.lstep),Y=Math.floor(Yst((k-V)/Q))+1,tt=new Array(Y);tt[0]=Ol(V);for(var h=1;h<Y;h++)tt[h]=Ol(tt[h-1]+Q);return{min:Math.min(r,Ki(tt)),max:Math.max(t,cr(tt)),ticks:tt}}function rlt(r){var t=r.min,e=r.max,i=r.tickCount,n=r.nice,a=r.tickInterval,o=r.minLimit,s=r.maxLimit,l=elt(t,e,i,n).ticks;return!K(o)||!K(s)?zS(r,Ki(l),cr(l)):a?US(t,e,a).ticks:l}function ilt(r){var t=r.base,e=r.tickCount,i=r.min,n=r.max,a=r.values,o,s=$n(t,n);if(i>0)o=Math.floor($n(t,i));else{var l=t4(a,t,n);o=Math.floor($n(t,l))}for(var u=s-o,c=Math.ceil(u/e),h=[],f=o;f<s+c;f=f+c)h.push(Math.pow(t,f));return i<=0&&h.unshift(0),h}function l4(r,t,e){if(e===void 0&&(e=5),r===t)return{max:t,min:r,ticks:[r]};var i=e<0?0:Math.round(e);if(i===0)return{max:t,min:r,ticks:[]};var n=1.5,a=.5+1.5*n,o=t-r,s=o/i,l=Math.pow(10,Math.floor(Math.log10(s))),u=l;2*l-s<n*(s-u)&&(u=2*l,5*l-s<a*(s-u)&&(u=5*l,10*l-s<n*(s-u)&&(u=10*l)));for(var c=Math.ceil(t/u),h=Math.floor(r/u),f=Math.max(c*u,t),d=Math.min(h*u,r),v=Math.floor((f-d)/u)+1,p=new Array(v),g=0;g<v;g++)p[g]=Ol(d+g*u);return{min:d,max:f,ticks:p}}function nlt(r){var t=r.exponent,e=r.tickCount,i=Math.ceil(Os(t,r.max)),n=Math.floor(Os(t,r.min)),a=l4(n,i,e).ticks;return a.map(function(o){var s=o>=0?1:-1;return Math.pow(o,t)*s})}function alt(r,t){var e=r.length*t;return t===1?r[r.length-1]:t===0?r[0]:e%1!==0?r[Math.ceil(e)-1]:r.length%2===0?(r[e-1]+r[e])/2:r[e]}function olt(r){var t=r.tickCount,e=r.values;if(!e||!e.length)return[];for(var i=e.slice().sort(function(s,l){return s-l}),n=[],a=0;a<t;a++){var o=a/(t-1);n.push(alt(i,o))}return n}function slt(r){var t=r.min,e=r.max,i=r.tickCount,n=r.tickInterval,a=r.minLimit,o=r.maxLimit,s=l4(t,e,i).ticks;return!K(a)||!K(o)?zS(r,Ki(s),cr(s)):n?US(t,e,n).ticks:s}function llt(r){var t=r.min,e=r.max,i=r.minTickInterval,n=r.tickInterval,a=r.tickCount;if(n)a=Math.ceil((e-t)/n);else{n=zst(t,e,a)[1];var o=(e-t)/n,s=o/a;s>1&&(n=n*Math.ceil(s)),i&&n<i&&(n=i)}n=Math.max(Math.floor((e-t)/(Math.pow(2,12)-1)),n);for(var l=[],u=t;u<e+n;u+=n)l.push(u);return l}function ult(r){var t=s4(S({showLast:!0},r));return t}function V0(r){return new Date(r).getFullYear()}function clt(r){return new Date(r,0,1).getTime()}function zx(r){return new Date(r).getMonth()}function hlt(r,t){var e=V0(r),i=V0(t),n=zx(r),a=zx(t);return(i-e)*12+(a-n)%12}function flt(r,t){return new Date(r,t,1).getTime()}function dlt(r,t){return Math.ceil((t-r)/Xo)}function vlt(r,t){return Math.ceil((t-r)/tu)}function plt(r,t){return Math.ceil((t-r)/(60*1e3))}function glt(r){var t=r.min,e=r.max,i=r.minTickInterval,n=r.tickCount,a=r.tickInterval,o=[];a||(a=(e-t)/n,i&&a<i&&(a=i)),a=Math.max(Math.floor((e-t)/(Math.pow(2,12)-1)),a);var s=V0(t);if(a>o3)for(var l=V0(e),u=Math.ceil(a/o3),c=s;c<=l+u;c=c+u)o.push(clt(c));else if(a>Jf)for(var h=Math.ceil(a/Jf),f=zx(t),d=hlt(t,e),c=0;c<=d+h;c=c+h)o.push(flt(s,c+f));else if(a>Xo)for(var v=new Date(t),p=v.getFullYear(),g=v.getMonth(),m=v.getDate(),y=Math.ceil(a/Xo),_=dlt(t,e),c=0;c<_+y;c=c+y)o.push(new Date(p,g,m+c).getTime());else if(a>tu)for(var v=new Date(t),p=v.getFullYear(),g=v.getMonth(),y=v.getDate(),x=v.getHours(),C=Math.ceil(a/tu),A=vlt(t,e),c=0;c<=A+C;c=c+C)o.push(new Date(p,g,y,x+c).getTime());else if(a>Jl)for(var b=plt(t,e),R=Math.ceil(a/Jl),c=0;c<=b+R;c=c+R)o.push(t+c*Jl);else{var M=a;M<_a&&(M=_a);for(var O=Math.floor(t/_a)*_a,F=Math.ceil((e-t)/_a),D=Math.ceil(M/_a),c=0;c<F+D;c=c+D)o.push(O+c*_a)}return o.length>=512&&console.warn("Notice: current ticks length("+o.length+') >= 512, may cause performance issues, even out of memory. Because of the configure "tickInterval"(in milliseconds, current is '+a+") is too small, increase the value to solve the problem!"),o}za("cat",s4);za("time-cat",ult);za("wilkinson-extended",rlt);za("r-pretty",slt);za("time",llt);za("time-pretty",glt);za("log",ilt);za("pow",nlt);za("quantile",olt);za("d3-linear",Vst);Ha("cat",Hv);Ha("category",Hv);Ha("identity",o4);Ha("linear",$v);Ha("log",e4);Ha("pow",r4);Ha("time",i4);Ha("timeCat",J5);Ha("quantize",kS);Ha("quantile",n4);const mlt=Object.freeze(Object.defineProperty({__proto__:null,Category:Hv,Identity:o4,Linear:$v,Log:e4,Pow:r4,Quantile:n4,Quantize:kS,Scale:zv,Time:i4,TimeCat:J5,getScale:W0,getTickMethod:K5,registerScale:Ha,registerTickMethod:za},Symbol.toStringTag,{value:"Module"}));var u4={},HS=function(r){return u4[r.toLowerCase()]},Lh=function(r,t){if(HS(r))throw new Error("Attribute type '".concat(r,"' existed."));u4[r.toLowerCase()]=t};Lh("Color",G5);Lh("Opacity",X5);Lh("Position",Y5);Lh("Shape",j5);Lh("Size",Z5);const ylt=Object.freeze(Object.defineProperty({__proto__:null,Attribute:Ih,Color:G5,Opacity:X5,Position:Y5,Scale:zv,Shape:j5,Size:Z5,getAttribute:HS,registerAttribute:Lh},Symbol.toStringTag,{value:"Module"}));var ty=function(){function r(t){this.type="coordinate",this.isRect=!1,this.isHelix=!1,this.isPolar=!1,this.isReflectX=!1,this.isReflectY=!1;var e=t.start,i=t.end,n=t.matrix,a=n===void 0?[1,0,0,0,1,0,0,0,1]:n,o=t.isTransposed,s=o===void 0?!1:o;this.start=e,this.end=i,this.matrix=a,this.originalMatrix=xt([],a),this.isTransposed=s}return r.prototype.initial=function(){this.center={x:(this.start.x+this.end.x)/2,y:(this.start.y+this.end.y)/2},this.width=Math.abs(this.end.x-this.start.x),this.height=Math.abs(this.end.y-this.start.y)},r.prototype.update=function(t){ne(this,t),this.initial()},r.prototype.convertDim=function(t,e){var i,n=this[e],a=n.start,o=n.end;return this.isReflect(e)&&(i=[o,a],a=i[0],o=i[1]),a+t*(o-a)},r.prototype.invertDim=function(t,e){var i,n=this[e],a=n.start,o=n.end;return this.isReflect(e)&&(i=[o,a],a=i[0],o=i[1]),(t-a)/(o-a)},r.prototype.applyMatrix=function(t,e,i){i===void 0&&(i=0);var n=this.matrix,a=[t,e,i];return gd(a,a,n),a},r.prototype.invertMatrix=function(t,e,i){i===void 0&&(i=0);var n=this.matrix,a=Z$([0,0,0,0,0,0,0,0,0],n),o=[t,e,i];return a&&gd(o,o,a),o},r.prototype.convert=function(t){var e=this.convertPoint(t),i=e.x,n=e.y,a=this.applyMatrix(i,n,1);return{x:a[0],y:a[1]}},r.prototype.invert=function(t){var e=this.invertMatrix(t.x,t.y,1);return this.invertPoint({x:e[0],y:e[1]})},r.prototype.rotate=function(t){var e=this.matrix,i=this.center;return fc(e,e,[-i.x,-i.y]),PS(e,e,t),fc(e,e,[i.x,i.y]),this},r.prototype.reflect=function(t){return t==="x"?this.isReflectX=!this.isReflectX:this.isReflectY=!this.isReflectY,this},r.prototype.scale=function(t,e){var i=this.matrix,n=this.center;return fc(i,i,[-n.x,-n.y]),b5(i,i,[t,e]),fc(i,i,[n.x,n.y]),this},r.prototype.translate=function(t,e){var i=this.matrix;return fc(i,i,[t,e]),this},r.prototype.transpose=function(){return this.isTransposed=!this.isTransposed,this},r.prototype.getCenter=function(){return this.center},r.prototype.getWidth=function(){return this.width},r.prototype.getHeight=function(){return this.height},r.prototype.getRadius=function(){return this.radius},r.prototype.isReflect=function(t){return t==="x"?this.isReflectX:this.isReflectY},r.prototype.resetMatrix=function(t){this.matrix=t||xt([],this.originalMatrix)},r}(),c4=function(r){N(t,r);function t(e){var i=r.call(this,e)||this;return i.isRect=!0,i.type="cartesian",i.initial(),i}return t.prototype.initial=function(){r.prototype.initial.call(this);var e=this.start,i=this.end;this.x={start:e.x,end:i.x},this.y={start:e.y,end:i.y}},t.prototype.convertPoint=function(e){var i,n=e.x,a=e.y;return this.isTransposed&&(i=[a,n],n=i[0],a=i[1]),{x:this.convertDim(n,"x"),y:this.convertDim(a,"y")}},t.prototype.invertPoint=function(e){var i,n=this.invertDim(e.x,"x"),a=this.invertDim(e.y,"y");return this.isTransposed&&(i=[a,n],n=i[0],a=i[1]),{x:n,y:a}},t}(ty),_lt=function(r){N(t,r);function t(e){var i=r.call(this,e)||this;i.isHelix=!0,i.type="helix";var n=e.startAngle,a=n===void 0?1.25*Math.PI:n,o=e.endAngle,s=o===void 0?7.25*Math.PI:o,l=e.innerRadius,u=l===void 0?0:l,c=e.radius;return i.startAngle=a,i.endAngle=s,i.innerRadius=u,i.radius=c,i.initial(),i}return t.prototype.initial=function(){r.prototype.initial.call(this);var e=(this.endAngle-this.startAngle)/(2*Math.PI)+1,i=Math.min(this.width,this.height)/2;this.radius&&this.radius>=0&&this.radius<=1&&(i=i*this.radius),this.d=Math.floor(i*(1-this.innerRadius)/e),this.a=this.d/(Math.PI*2),this.x={start:this.startAngle,end:this.endAngle},this.y={start:this.innerRadius*i,end:this.innerRadius*i+this.d*.99}},t.prototype.convertPoint=function(e){var i,n=e.x,a=e.y;this.isTransposed&&(i=[a,n],n=i[0],a=i[1]);var o=this.convertDim(n,"x"),s=this.a*o,l=this.convertDim(a,"y");return{x:this.center.x+Math.cos(o)*(s+l),y:this.center.y+Math.sin(o)*(s+l)}},t.prototype.invertPoint=function(e){var i,n=this.d+this.y.start,a=q1([0,0],[e.x,e.y],[this.center.x,this.center.y]),o=FS(a,[1,0],!0),s=o*this.a;gc(a)<s&&(s=gc(a));var l=Math.floor((gc(a)-s)/n);o=2*l*Math.PI+o;var u=this.a*o,c=gc(a)-u;c=wr(c,0)?0:c;var h=this.invertDim(o,"x"),f=this.invertDim(c,"y");return h=wr(h,0)?0:h,f=wr(f,0)?0:f,this.isTransposed&&(i=[f,h],h=i[0],f=i[1]),{x:h,y:f}},t}(ty),xlt=function(r){N(t,r);function t(e){var i=r.call(this,e)||this;i.isPolar=!0,i.type="polar";var n=e.startAngle,a=n===void 0?-Math.PI/2:n,o=e.endAngle,s=o===void 0?Math.PI*3/2:o,l=e.innerRadius,u=l===void 0?0:l,c=e.radius;return i.startAngle=a,i.endAngle=s,i.innerRadius=u,i.radius=c,i.initial(),i}return t.prototype.initial=function(){for(r.prototype.initial.call(this);this.endAngle<this.startAngle;)this.endAngle+=Math.PI*2;var e=this.getOneBox(),i=e.maxX-e.minX,n=e.maxY-e.minY,a=Math.abs(e.minX)/i,o=Math.abs(e.minY)/n,s;this.height/n>this.width/i?(s=this.width/i,this.circleCenter={x:this.center.x-(.5-a)*this.width,y:this.center.y-(.5-o)*s*n}):(s=this.height/n,this.circleCenter={x:this.center.x-(.5-a)*s*i,y:this.center.y-(.5-o)*this.height}),this.polarRadius=this.radius,this.radius?this.radius>0&&this.radius<=1?this.polarRadius=s*this.radius:(this.radius<=0||this.radius>s)&&(this.polarRadius=s):this.polarRadius=s,this.x={start:this.startAngle,end:this.endAngle},this.y={start:this.innerRadius*this.polarRadius,end:this.polarRadius}},t.prototype.getRadius=function(){return this.polarRadius},t.prototype.convertPoint=function(e){var i,n=this.getCenter(),a=e.x,o=e.y;return this.isTransposed&&(i=[o,a],a=i[0],o=i[1]),a=this.convertDim(a,"x"),o=this.convertDim(o,"y"),{x:n.x+Math.cos(a)*o,y:n.y+Math.sin(a)*o}},t.prototype.invertPoint=function(e){var i,n=this.getCenter(),a=[e.x-n.x,e.y-n.y],o=this,s=o.startAngle,l=o.endAngle;this.isReflect("x")&&(i=[l,s],s=i[0],l=i[1]);var u=[1,0,0,0,1,0,0,0,1];PS(u,u,s);var c=[1,0,0];gd(c,c,u);var h=[c[0],c[1]],f=FS(h,a,l<s);wr(f,Math.PI*2)&&(f=0);var d=gc(a),v=f/(l-s);v=l-s>0?v:-v;var p=this.invertDim(d,"y"),g={x:0,y:0};return g.x=this.isTransposed?p:v,g.y=this.isTransposed?v:p,g},t.prototype.getCenter=function(){return this.circleCenter},t.prototype.getOneBox=function(){var e=this.startAngle,i=this.endAngle;if(Math.abs(i-e)>=Math.PI*2)return{minX:-1,maxX:1,minY:-1,maxY:1};for(var n=[0,Math.cos(e),Math.cos(i)],a=[0,Math.sin(e),Math.sin(i)],o=Math.min(e,i);o<Math.max(e,i);o+=Math.PI/18)n.push(Math.cos(o)),a.push(Math.sin(o));return{minX:Math.min.apply(Math,n),maxX:Math.max.apply(Math,n),minY:Math.min.apply(Math,a),maxY:Math.max.apply(Math,a)}},t}(ty),h4={},f4=function(r){return h4[r.toLowerCase()]},Wv=function(r,t){h4[r.toLowerCase()]=t};Wv("rect",c4);Wv("cartesian",c4);Wv("polar",xlt);Wv("helix",_lt);const Clt=Object.freeze(Object.defineProperty({__proto__:null,Coordinate:ty,getCoordinate:f4,registerCoordinate:Wv},Symbol.toStringTag,{value:"Module"}));function $S(r,t,e){var i=new Rh(t,e);i.target=r,i.propagationPath.push(r),r.emitDelegation(t,i);for(var n=r.getParent();n;)n.emitDelegation(t,i),i.propagationPath.push(n),n=n.getParent()}var d4=[1,0,0,0,1,0,0,0,1];function pu(r,t,e){if(e===void 0&&(e=d4),!t)return null;var i=dr(e,[["t",-r.x,-r.y],["r",t],["t",r.x,r.y]]);return i}function WS(r,t){return!r.x&&!r.y?null:dr(t||d4,[["t",r.x,r.y]])}function Elt(r){var t=[1,0,0],e=[0,0,0];return gd(e,t,r),Math.atan2(e[1],e[0])}function Yp(r,t){var e=[0,0];return q$(e,t,r),e}function Slt(r,t){var e=Yp(r,[t.minX,t.minY]),i=Yp(r,[t.maxX,t.minY]),n=Yp(r,[t.minX,t.maxY]),a=Yp(r,[t.maxX,t.maxY]),o=Math.min(e[0],i[0],n[0],a[0]),s=Math.max(e[0],i[0],n[0],a[0]),l=Math.min(e[1],i[1],n[1],a[1]),u=Math.max(e[1],i[1],n[1],a[1]);return{x:o,y:l,minX:o,minY:l,maxX:s,maxY:u,width:s-o,height:u-l}}function v4(r,t,e,i){if(t){var n=pu({x:e,y:i},t,r.getMatrix());r.setMatrix(n)}}function VS(r,t,e){var i=WS({x:t,y:e});r.attr("matrix",i)}function G0(r){var t=0,e=0,i=0,n=0;return Tt(r)?t=e=i=n=r:q(r)&&(t=r[0],i=K(r[1])?r[0]:r[1],n=K(r[2])?r[0]:r[2],e=K(r[3])?i:r[3]),[t,i,n,e]}function GS(r){for(var t=r.childNodes,e=t.length,i=e-1;i>=0;i--)r.removeChild(t[i])}function Alt(r,t){return!!r.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function Td(r){var t=r.start,e=r.end,i=Math.min(t.x,e.x),n=Math.min(t.y,e.y),a=Math.max(t.x,e.x),o=Math.max(t.y,e.y);return{x:i,y:n,minX:i,minY:n,maxX:a,maxY:o,width:a-i,height:o-n}}function Tlt(r){var t=r.map(function(s){return s.x}),e=r.map(function(s){return s.y}),i=Math.min.apply(Math,t),n=Math.min.apply(Math,e),a=Math.max.apply(Math,t),o=Math.max.apply(Math,e);return{x:i,y:n,minX:i,minY:n,maxX:a,maxY:o,width:a-i,height:o-n}}function ey(r,t,e,i){var n=r+e,a=t+i;return{x:r,y:t,width:e,height:i,minX:r,minY:t,maxX:isNaN(n)?0:n,maxY:isNaN(a)?0:a}}function eu(r,t,e){return(1-e)*r+t*e}function Bc(r,t,e){return{x:r.x+Math.cos(e)*t,y:r.y+Math.sin(e)*t}}function blt(r,t){var e=t.x-r.x,i=t.y-r.y;return Math.sqrt(e*e+i*i)}var X0=function(r,t,e){return e===void 0&&(e=Math.pow(Number.EPSILON,.5)),[r,t].includes(1/0)?Math.abs(r)===Math.abs(t):Math.abs(r-t)<e};function wlt(r,t){var e=Math.max(r.minX,t.minX),i=Math.max(r.minY,t.minY),n=Math.min(r.maxX,t.maxX),a=Math.min(r.maxY,t.maxY);return ey(e,i,n-e,a-i)}function p4(r){var t=r.getClip(),e=t&&t.getBBox(),i;if(!r.isGroup())i=r.getBBox();else{var n=1/0,a=-1/0,o=1/0,s=-1/0,l=r.getChildren();l.length>0?I(l,function(u){if(u.get("visible")){if(u.isGroup()&&u.get("children").length===0)return!0;var c=p4(u),h=u.applyToMatrix([c.minX,c.minY,1]),f=u.applyToMatrix([c.minX,c.maxY,1]),d=u.applyToMatrix([c.maxX,c.minY,1]),v=u.applyToMatrix([c.maxX,c.maxY,1]),p=Math.min(h[0],f[0],d[0],v[0]),g=Math.max(h[0],f[0],d[0],v[0]),m=Math.min(h[1],f[1],d[1],v[1]),y=Math.max(h[1],f[1],d[1],v[1]);p<n&&(n=p),g>a&&(a=g),m<o&&(o=m),y>s&&(s=y)}}):(n=0,a=0,o=0,s=0),i=ey(n,o,a-n,s-o)}return e?wlt(i,e):i}function Rlt(r,t){if(!(!r.getClip()&&!t.getClip())){var e=t.getClip();if(!e){r.setClip(null);return}var i={type:e.get("type"),attrs:e.attr()};r.setClip(i)}}function Hi(r){return r+"px"}function g4(r,t,e,i){var n=blt(r,t),a=i/n,o=0;return e==="start"?o=0-a:e==="end"&&(o=1+a),{x:eu(r.x,t.x,o),y:eu(r.y,t.y,o)}}var Mlt={none:[],point:["x","y"],region:["start","end"],points:["points"],circle:["center","radius","startAngle","endAngle"]},XS=function(r){N(t,r);function t(e){var i=r.call(this,e)||this;return i.initCfg(),i}return t.prototype.getDefaultCfg=function(){return{id:"",name:"",type:"",locationType:"none",offsetX:0,offsetY:0,animate:!1,capture:!0,updateAutoRender:!1,animateOption:{appear:null,update:{duration:400,easing:"easeQuadInOut"},enter:{duration:400,easing:"easeQuadInOut"},leave:{duration:350,easing:"easeQuadIn"}},events:null,defaultCfg:{},visible:!0}},t.prototype.clear=function(){},t.prototype.update=function(e){var i=this,n=this.get("defaultCfg")||{};I(e,function(a,o){var s=i.get(o),l=a;s!==a&&(ie(a)&&n[o]&&(l=at({},n[o],a)),i.set(o,l))}),this.updateInner(e),this.afterUpdate(e)},t.prototype.updateInner=function(e){},t.prototype.afterUpdate=function(e){_o(e,"visible")&&(e.visible?this.show():this.hide()),_o(e,"capture")&&this.setCapture(e.capture)},t.prototype.getLayoutBBox=function(){return this.getBBox()},t.prototype.getLocationType=function(){return this.get("locationType")},t.prototype.getOffset=function(){return{offsetX:this.get("offsetX"),offsetY:this.get("offsetY")}},t.prototype.setOffset=function(e,i){this.update({offsetX:e,offsetY:i})},t.prototype.setLocation=function(e){var i=S({},e);this.update(i)},t.prototype.getLocation=function(){var e=this,i={},n=this.get("locationType"),a=Mlt[n];return I(a,function(o){i[o]=e.get(o)}),i},t.prototype.isList=function(){return!1},t.prototype.isSlider=function(){return!1},t.prototype.init=function(){},t.prototype.initCfg=function(){var e=this,i=this.get("defaultCfg");I(i,function(n,a){var o=e.get(a);if(ie(o)){var s=at({},n,o);e.set(a,s)}})},t}(Mv),wl="update_status",Ilt=["visible","tip","delegateObject"],Llt=["container","group","shapesMap","isRegister","isUpdating","destroyed"],Wr=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{container:null,shapesMap:{},group:null,capture:!0,isRegister:!1,isUpdating:!1,isInit:!0})},t.prototype.remove=function(){this.clear();var e=this.get("group");e.remove()},t.prototype.clear=function(){var e=this.get("group");e.clear(),this.set("shapesMap",{}),this.clearOffScreenCache(),this.set("isInit",!0)},t.prototype.getChildComponentById=function(e){var i=this.getElementById(e),n=i&&i.get("component");return n},t.prototype.getElementById=function(e){return this.get("shapesMap")[e]},t.prototype.getElementByLocalId=function(e){var i=this.getElementId(e);return this.getElementById(i)},t.prototype.getElementsByName=function(e){var i=[];return I(this.get("shapesMap"),function(n){n.get("name")===e&&i.push(n)}),i},t.prototype.getContainer=function(){return this.get("container")},t.prototype.updateInner=function(e){this.offScreenRender(),this.get("updateAutoRender")&&this.render()},t.prototype.render=function(){var e=this.get("offScreenGroup");e||(e=this.offScreenRender());var i=this.get("group");this.updateElements(e,i),this.deleteElements(),this.applyOffset(),this.get("eventInitted")||(this.initEvent(),this.set("eventInitted",!0)),this.set("isInit",!1)},t.prototype.show=function(){var e=this.get("group");e.show(),this.set("visible",!0)},t.prototype.hide=function(){var e=this.get("group");e.hide(),this.set("visible",!1)},t.prototype.setCapture=function(e){var i=this.get("group");i.set("capture",e),this.set("capture",e)},t.prototype.destroy=function(){this.removeEvent(),this.remove(),r.prototype.destroy.call(this)},t.prototype.getBBox=function(){return this.get("group").getCanvasBBox()},t.prototype.getLayoutBBox=function(){var e=this.get("group"),i=this.getInnerLayoutBBox(),n=e.getTotalMatrix();return n&&(i=Slt(n,i)),i},t.prototype.on=function(e,i,n){var a=this.get("group");return a.on(e,i,n),this},t.prototype.off=function(e,i){var n=this.get("group");return n&&n.off(e,i),this},t.prototype.emit=function(e,i){var n=this.get("group");n.emit(e,i)},t.prototype.init=function(){r.prototype.init.call(this),this.get("group")||this.initGroup(),this.offScreenRender()},t.prototype.getInnerLayoutBBox=function(){return this.get("offScreenBBox")||this.get("group").getBBox()},t.prototype.delegateEmit=function(e,i){var n=this.get("group");i.target=n,n.emit(e,i),$S(n,e,i)},t.prototype.createOffScreenGroup=function(){var e=this.get("group"),i=e.getGroupBase(),n=new i({delegateObject:this.getDelegateObject()});return n},t.prototype.applyOffset=function(){var e=this.get("offsetX"),i=this.get("offsetY");this.moveElementTo(this.get("group"),{x:e,y:i})},t.prototype.initGroup=function(){var e=this.get("container");this.set("group",e.addGroup({id:this.get("id"),name:this.get("name"),capture:this.get("capture"),visible:this.get("visible"),isComponent:!0,component:this,delegateObject:this.getDelegateObject()}))},t.prototype.offScreenRender=function(){this.clearOffScreenCache();var e=this.createOffScreenGroup();return this.renderInner(e),this.set("offScreenGroup",e),this.set("offScreenBBox",p4(e)),e},t.prototype.addGroup=function(e,i){this.appendDelegateObject(e,i);var n=e.addGroup(i);return this.get("isRegister")&&this.registerElement(n),n},t.prototype.addShape=function(e,i){this.appendDelegateObject(e,i);var n=e.addShape(i);return this.get("isRegister")&&this.registerElement(n),n},t.prototype.addComponent=function(e,i){var n=i.id,a=i.component,o=zt(i,["id","component"]),s=new a(S(S({},o),{id:n,container:e,updateAutoRender:this.get("updateAutoRender")}));return s.init(),s.render(),this.get("isRegister")&&this.registerElement(s.get("group")),s},t.prototype.initEvent=function(){},t.prototype.removeEvent=function(){var e=this.get("group");e.off()},t.prototype.getElementId=function(e){var i=this.get("id"),n=this.get("name");return i+"-"+n+"-"+e},t.prototype.registerElement=function(e){var i=e.get("id");this.get("shapesMap")[i]=e},t.prototype.unregisterElement=function(e){var i=e.get("id");delete this.get("shapesMap")[i]},t.prototype.moveElementTo=function(e,i){var n=WS(i);e.attr("matrix",n)},t.prototype.addAnimation=function(e,i,n){var a=i.attr("opacity");K(a)&&(a=1),i.attr("opacity",0),i.animate({opacity:a},n)},t.prototype.removeAnimation=function(e,i,n){i.animate({opacity:0},n)},t.prototype.updateAnimation=function(e,i,n,a){i.animate(n,a)},t.prototype.updateElements=function(e,i){var n=this,a=this.get("animate"),o=this.get("animateOption"),s=e.getChildren().slice(0),l;I(s,function(u){var c=u.get("id"),h=n.getElementById(c),f=u.get("name");if(h)if(u.get("isComponent")){var d=u.get("component"),v=h.get("component"),p=Ma(d.cfg,QD(Du(d.cfg),Llt));v.update(p),h.set(wl,"update")}else{var g=n.getReplaceAttrs(h,u);a&&o.update?n.updateAnimation(f,h,g,o.update):h.attr(g),u.isGroup()&&n.updateElements(u,h),I(Ilt,function(x){h.set(x,u.get(x))}),Rlt(h,u),l=h,h.set(wl,"update")}else{i.add(u);var m=i.getChildren();if(m.splice(m.length-1,1),l){var y=m.indexOf(l);m.splice(y+1,0,u)}else m.unshift(u);if(n.registerElement(u),u.set(wl,"add"),u.get("isComponent")){var d=u.get("component");d.set("container",i)}else u.isGroup()&&n.registerNewGroup(u);if(l=u,a){var _=n.get("isInit")?o.appear:o.enter;_&&n.addAnimation(f,u,_)}}})},t.prototype.clearUpdateStatus=function(e){var i=e.getChildren();I(i,function(n){n.set(wl,null)})},t.prototype.clearOffScreenCache=function(){var e=this.get("offScreenGroup");e&&e.destroy(),this.set("offScreenGroup",null),this.set("offScreenBBox",null)},t.prototype.getDelegateObject=function(){var e,i=this.get("name"),n=(e={},e[i]=this,e.component=this,e);return n},t.prototype.appendDelegateObject=function(e,i){var n=e.get("delegateObject");i.delegateObject||(i.delegateObject={}),ne(i.delegateObject,n)},t.prototype.getReplaceAttrs=function(e,i){var n=e.attr(),a=i.attr();return I(n,function(o,s){a[s]===void 0&&(a[s]=void 0)}),a},t.prototype.registerNewGroup=function(e){var i=this,n=e.getChildren();I(n,function(a){i.registerElement(a),a.set(wl,"add"),a.isGroup()&&i.registerNewGroup(a)})},t.prototype.deleteElements=function(){var e=this,i=this.get("shapesMap"),n=[];I(i,function(s,l){!s.get(wl)||s.destroyed?n.push([l,s]):s.set(wl,null)});var a=this.get("animate"),o=this.get("animateOption");I(n,function(s){var l=s[0],u=s[1];if(!u.destroyed){var c=u.get("name");if(a&&o.leave){var h=ne({callback:function(){e.removeElement(u)}},o.leave);e.removeAnimation(c,u,h)}else e.removeElement(u)}delete i[l]})},t.prototype.removeElement=function(e){if(e.get("isGroup")){var i=e.get("component");i&&i.destroy()}e.remove()},t}(XS),K_="…";function Olt(r){for(var t=0,e=0;e<r.length;e++)t+=Pl(r,e);return t}function Pl(r,t){return r.charCodeAt(t)>0&&r.charCodeAt(t)<128?1:2}function Plt(r,t,e){e===void 0&&(e="tail");var i=r.length,n="";if(e==="tail"){for(var a=0,o=0;a<t;){var s=Pl(r,o);if(a+s<=t)n+=r[o],a+=Pl(r,o),o++;else break}n+=K_}else if(e==="head"){for(var a=0,o=i-1;a<t;){var s=Pl(r,o);if(a+s<=t)n+=r[o],a+=Pl(r,o),o--;else break}n=K_+n}else{for(var l="",u="",a=0,c=0,h=i-1;a<t;){var f=Pl(r,c),d=!1;f+a<=t&&(l+=r[c],c++,a+=f,d=!0);var v=Pl(r,h);if(v+a<=t&&(u=r[h]+u,a+=v,h--,d=!0),!d)break}n=l+K_+u}return n}var Flt="…",Blt=2,Dlt=400;function Nlt(r){for(var t=r.map(function(l){var u=l.attr("text");return K(u)?"":""+u}),e=0,i=0,n=0;n<t.length;n+=1){for(var a=0,o=0;o<=t[n].length;o+=1){var s=t[n].charCodeAt(o);s>=19968&&s<=40869?a+=2:a+=1}a>e&&(e=a,i=n)}return r[i].getBBox().width}function Hx(r){if(r.length>Dlt)return Nlt(r);var t=0;return I(r,function(e){var i=e.getBBox(),n=i.width;t<n&&(t=n)}),t}function klt(r,t){var e=t.getCanvasBBox();return r?e.width:e.height}function td(r,t,e,i){var n;i===void 0&&(i="tail");var a=(n=t.attr("text"))!==null&&n!==void 0?n:"";if(i==="tail"){var o=Ma(t.attr(),["fontSize","fontFamily","fontWeight","fontStyle","fontVariant"]),s=p5(a,e,o,"…");return a!==s?(t.attr("text",s),t.set("tip",a),!0):(t.set("tip",null),!1)}var l=klt(r,t),u=Olt(a),c=!1;if(e<l){var h=Math.floor(e/l*u)-Blt,f=void 0;h>=0?f=Plt(a,h,i):f=Flt,f&&(t.attr("text",f),c=!0)}return c?t.set("tip",a):t.set("tip",null),c}function ry(r,t){var e=t.x,i=t.y,n=t.content,a=t.style,o=t.id,s=t.name,l=t.rotate,u=t.maxLength,c=t.autoEllipsis,h=t.isVertical,f=t.ellipsisPosition,d=t.background,v=r.addGroup({id:o+"-group",name:s+"-group",attrs:{x:e,y:i}}),p=v.addShape({type:"text",id:o,name:s,attrs:S({x:0,y:0,text:n},a)}),g=G0(P(d,"padding",0));if(u&&c){var m=u-(g[1]+g[3]);td(!h,p,m,f)}if(d){var y=P(d,"style",{}),_=p.getCanvasBBox(),x=_.minX,C=_.minY,A=_.width,b=_.height,R=v.addShape("rect",{id:o+"-bg",name:o+"-bg",attrs:S({x:x-g[3],y:C-g[0],width:A+g[1]+g[3],height:b+g[0]+g[2]},y)});R.toBack()}VS(v,e,i),v4(v,l,e,i)}const Xt={fontFamily:`
  BlinkMacSystemFont, "Segoe UI", Roboto,"Helvetica Neue",
  Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei",
  SimSun, "sans-serif"`,textColor:"#2C3542",activeTextColor:"#333333",uncheckedColor:"#D8D8D8",lineColor:"#416180",regionColor:"#CCD7EB",verticalAxisRotate:-Math.PI/4,horizontalAxisRotate:Math.PI/4,descriptionIconStroke:"#fff",descriptionIconFill:"rgba(58, 73, 101, .25)"};var Ult=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"annotation",type:"line",locationType:"region",start:null,end:null,style:{},text:null,defaultCfg:{style:{fill:Xt.textColor,fontSize:12,textAlign:"center",textBaseline:"bottom",fontFamily:Xt.fontFamily},text:{position:"center",autoRotate:!0,content:null,offsetX:0,offsetY:0,style:{stroke:Xt.lineColor,lineWidth:1}}}})},t.prototype.renderInner=function(e){this.renderLine(e),this.get("text")&&this.renderLabel(e)},t.prototype.renderLine=function(e){var i=this.get("start"),n=this.get("end"),a=this.get("style");this.addShape(e,{type:"line",id:this.getElementId("line"),name:"annotation-line",attrs:S({x1:i.x,y1:i.y,x2:n.x,y2:n.y},a)})},t.prototype.getLabelPoint=function(e,i,n){var a;return n==="start"?a=0:n==="center"?a=.5:mt(n)&&n.indexOf("%")!==-1?a=parseInt(n,10)/100:Tt(n)?a=n:a=1,(a>1||a<0)&&(a=1),{x:eu(e.x,i.x,a),y:eu(e.y,i.y,a)}},t.prototype.renderLabel=function(e){var i=this.get("text"),n=this.get("start"),a=this.get("end"),o=i.position,s=i.content,l=i.style,u=i.offsetX,c=i.offsetY,h=i.autoRotate,f=i.maxLength,d=i.autoEllipsis,v=i.ellipsisPosition,p=i.background,g=i.isVertical,m=g===void 0?!1:g,y=this.getLabelPoint(n,a,o),_=y.x+u,x=y.y+c,C={id:this.getElementId("line-text"),name:"annotation-line-text",x:_,y:x,content:s,style:l,maxLength:f,autoEllipsis:d,ellipsisPosition:v,background:p,isVertical:m};if(h){var A=[a.x-n.x,a.y-n.y];C.rotate=Math.atan2(A[1],A[0])}ry(e,C)},t}(Wr),zlt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"annotation",type:"text",locationType:"point",x:0,y:0,content:"",rotate:null,style:{},background:null,maxLength:null,autoEllipsis:!0,isVertical:!1,ellipsisPosition:"tail",defaultCfg:{style:{fill:Xt.textColor,fontSize:12,textAlign:"center",textBaseline:"middle",fontFamily:Xt.fontFamily}}})},t.prototype.setLocation=function(e){this.set("x",e.x),this.set("y",e.y),this.resetLocation()},t.prototype.renderInner=function(e){var i=this.getLocation(),n=i.x,a=i.y,o=this.get("content"),s=this.get("style"),l=this.getElementId("text"),u=this.get("name")+"-text",c=this.get("maxLength"),h=this.get("autoEllipsis"),f=this.get("isVertical"),d=this.get("ellipsisPosition"),v=this.get("background"),p=this.get("rotate"),g={id:l,name:u,x:n,y:a,content:o,style:s,maxLength:c,autoEllipsis:h,isVertical:f,ellipsisPosition:d,background:v,rotate:p};ry(e,g)},t.prototype.resetLocation=function(){var e=this.getElementByLocalId("text-group");if(e){var i=this.getLocation(),n=i.x,a=i.y,o=this.get("rotate");VS(e,n,a),v4(e,o,n,a)}},t}(Wr),Hlt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"annotation",type:"arc",locationType:"circle",center:null,radius:100,startAngle:-Math.PI/2,endAngle:Math.PI*3/2,style:{stroke:"#999",lineWidth:1}})},t.prototype.renderInner=function(e){this.renderArc(e)},t.prototype.getArcPath=function(){var e=this.getLocation(),i=e.center,n=e.radius,a=e.startAngle,o=e.endAngle,s=Bc(i,n,a),l=Bc(i,n,o),u=o-a>Math.PI?1:0,c=[["M",s.x,s.y]];if(o-a===Math.PI*2){var h=Bc(i,n,a+Math.PI);c.push(["A",n,n,0,u,1,h.x,h.y]),c.push(["A",n,n,0,u,1,l.x,l.y])}else c.push(["A",n,n,0,u,1,l.x,l.y]);return c},t.prototype.renderArc=function(e){var i=this.getArcPath(),n=this.get("style");this.addShape(e,{type:"path",id:this.getElementId("arc"),name:"annotation-arc",attrs:S({path:i},n)})},t}(Wr),$lt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"annotation",type:"region",locationType:"region",start:null,end:null,style:{},defaultCfg:{style:{lineWidth:0,fill:Xt.regionColor,opacity:.4}}})},t.prototype.renderInner=function(e){this.renderRegion(e)},t.prototype.renderRegion=function(e){var i=this.get("start"),n=this.get("end"),a=this.get("style"),o=Td({start:i,end:n});this.addShape(e,{type:"rect",id:this.getElementId("region"),name:"annotation-region",attrs:S({x:o.x,y:o.y,width:o.width,height:o.height},a)})},t}(Wr),Wlt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"annotation",type:"image",locationType:"region",start:null,end:null,src:null,style:{}})},t.prototype.renderInner=function(e){this.renderImage(e)},t.prototype.getImageAttrs=function(){var e=this.get("start"),i=this.get("end"),n=this.get("style"),a=Td({start:e,end:i}),o=this.get("src");return S({x:a.x,y:a.y,img:o,width:a.width,height:a.height},n)},t.prototype.renderImage=function(e){this.addShape(e,{type:"image",id:this.getElementId("image"),name:"annotation-image",attrs:this.getImageAttrs()})},t}(Wr),Vlt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"annotation",type:"dataMarker",locationType:"point",x:0,y:0,point:{},line:{},text:{},direction:"upward",autoAdjust:!0,coordinateBBox:null,defaultCfg:{point:{display:!0,style:{r:3,fill:"#FFFFFF",stroke:"#1890FF",lineWidth:2}},line:{display:!0,length:20,style:{stroke:Xt.lineColor,lineWidth:1}},text:{content:"",display:!0,style:{fill:Xt.textColor,opacity:.65,fontSize:12,textAlign:"start",fontFamily:Xt.fontFamily}}}})},t.prototype.renderInner=function(e){P(this.get("line"),"display")&&this.renderLine(e),P(this.get("text"),"display")&&this.renderText(e),P(this.get("point"),"display")&&this.renderPoint(e),this.get("autoAdjust")&&this.autoAdjust(e)},t.prototype.applyOffset=function(){this.moveElementTo(this.get("group"),{x:this.get("x")+this.get("offsetX"),y:this.get("y")+this.get("offsetY")})},t.prototype.renderPoint=function(e){var i=this.getShapeAttrs().point;this.addShape(e,{type:"circle",id:this.getElementId("point"),name:"annotation-point",attrs:i})},t.prototype.renderLine=function(e){var i=this.getShapeAttrs().line;this.addShape(e,{type:"path",id:this.getElementId("line"),name:"annotation-line",attrs:i})},t.prototype.renderText=function(e){var i=this.getShapeAttrs().text,n=i.x,a=i.y,o=i.text,s=zt(i,["x","y","text"]),l=this.get("text"),u=l.background,c=l.maxLength,h=l.autoEllipsis,f=l.isVertival,d=l.ellipsisPosition,v={x:n,y:a,id:this.getElementId("text"),name:"annotation-text",content:o,style:s,background:u,maxLength:c,autoEllipsis:h,isVertival:f,ellipsisPosition:d};ry(e,v)},t.prototype.autoAdjust=function(e){var i=this.get("direction"),n=this.get("x"),a=this.get("y"),o=P(this.get("line"),"length",0),s=this.get("coordinateBBox"),l=e.getBBox(),u=l.minX,c=l.maxX,h=l.minY,f=l.maxY,d=e.findById(this.getElementId("text-group")),v=e.findById(this.getElementId("text")),p=e.findById(this.getElementId("line"));if(s&&d){var g=d.attr("x"),m=d.attr("y"),y=v.getCanvasBBox(),_=y.width,x=y.height,C=0,A=0;if(n+u<=s.minX)if(i==="leftward")C=1;else{var b=s.minX-(n+u);g=d.attr("x")+b}else if(n+c>=s.maxX)if(i==="rightward")C=-1;else{var b=n+c-s.maxX;g=d.attr("x")-b}if(C&&(p&&p.attr("path",[["M",0,0],["L",o*C,0]]),g=(o+2+_)*C),a+h<=s.minY)if(i==="upward")A=1;else{var b=s.minY-(a+h);m=d.attr("y")+b}else if(a+f>=s.maxY)if(i==="downward")A=-1;else{var b=a+f-s.maxY;m=d.attr("y")-b}A&&(p&&p.attr("path",[["M",0,0],["L",0,o*A]]),m=(o+2+x)*A),(g!==d.attr("x")||m!==d.attr("y"))&&VS(d,g,m)}},t.prototype.getShapeAttrs=function(){var e=P(this.get("line"),"display"),i=P(this.get("point"),"style",{}),n=P(this.get("line"),"style",{}),a=P(this.get("text"),"style",{}),o=this.get("direction"),s=e?P(this.get("line"),"length",0):0,l=0,u=0,c="top",h="start";switch(o){case"upward":u=-1,c="bottom";break;case"downward":u=1,c="top";break;case"leftward":l=-1,h="end";break;case"rightward":l=1,h="start";break}return{point:S({x:0,y:0},i),line:S({path:[["M",0,0],["L",s*l,s*u]]},n),text:S({x:(s+2)*l,y:(s+2)*u,text:P(this.get("text"),"content",""),textBaseline:c,textAlign:h},a)}},t}(Wr),Glt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"annotation",type:"dataRegion",locationType:"points",points:[],lineLength:0,region:{},text:{},defaultCfg:{region:{style:{lineWidth:0,fill:Xt.regionColor,opacity:.4}},text:{content:"",style:{textAlign:"center",textBaseline:"bottom",fontSize:12,fill:Xt.textColor,fontFamily:Xt.fontFamily}}}})},t.prototype.renderInner=function(e){var i=P(this.get("region"),"style",{});P(this.get("text"),"style",{});var n=this.get("lineLength")||0,a=this.get("points");if(a.length){var o=Tlt(a),s=[];s.push(["M",a[0].x,o.minY-n]),a.forEach(function(u){s.push(["L",u.x,u.y])}),s.push(["L",a[a.length-1].x,a[a.length-1].y-n]),this.addShape(e,{type:"path",id:this.getElementId("region"),name:"annotation-region",attrs:S({path:s},i)});var l=S({id:this.getElementId("text"),name:"annotation-text",x:(o.minX+o.maxX)/2,y:o.minY-n},this.get("text"));ry(e,l)}},t}(Wr),Xlt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"annotation",type:"regionFilter",locationType:"region",start:null,end:null,color:null,shape:[]})},t.prototype.renderInner=function(e){var i=this,n=this.get("start"),a=this.get("end"),o=this.addGroup(e,{id:this.getElementId("region-filter"),capture:!1});I(this.get("shapes"),function(l,u){var c=l.get("type"),h=Rr(l.attr());i.adjustShapeAttrs(h),i.addShape(o,{id:i.getElementId("shape-"+c+"-"+u),capture:!1,type:c,attrs:h})});var s=Td({start:n,end:a});o.setClip({type:"rect",attrs:{x:s.minX,y:s.minY,width:s.width,height:s.height}})},t.prototype.adjustShapeAttrs=function(e){var i=this.get("color");e.fill&&(e.fill=e.fillStyle=i),e.stroke=e.strokeStyle=i},t}(Wr),Ylt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"annotation",type:"shape",draw:Go})},t.prototype.renderInner=function(e){var i=this.get("render");ot(i)&&i(e)},t}(Wr),iy=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{container:null,containerTpl:"<div></div>",updateAutoRender:!0,containerClassName:"",parent:null})},t.prototype.getContainer=function(){return this.get("container")},t.prototype.show=function(){var e=this.get("container");e.style.display="",this.set("visible",!0)},t.prototype.hide=function(){var e=this.get("container");e.style.display="none",this.set("visible",!1)},t.prototype.setCapture=function(e){var i=this.getContainer(),n=e?"auto":"none";i.style.pointerEvents=n,this.set("capture",e)},t.prototype.getBBox=function(){var e=this.getContainer(),i=parseFloat(e.style.left)||0,n=parseFloat(e.style.top)||0;return ey(i,n,e.clientWidth,e.clientHeight)},t.prototype.clear=function(){var e=this.get("container");GS(e)},t.prototype.destroy=function(){this.removeEvent(),this.removeDom(),r.prototype.destroy.call(this)},t.prototype.init=function(){r.prototype.init.call(this),this.initContainer(),this.initDom(),this.resetStyles(),this.applyStyles(),this.initEvent(),this.initCapture(),this.initVisible()},t.prototype.initCapture=function(){this.setCapture(this.get("capture"))},t.prototype.initVisible=function(){this.get("visible")?this.show():this.hide()},t.prototype.initDom=function(){},t.prototype.initContainer=function(){var e=this.get("container");if(K(e)){e=this.createDom();var i=this.get("parent");mt(i)&&(i=document.getElementById(i),this.set("parent",i)),i.appendChild(e),this.get("containerId")&&e.setAttribute("id",this.get("containerId")),this.set("container",e)}else mt(e)&&(e=document.getElementById(e),this.set("container",e));this.get("parent")||this.set("parent",e.parentNode)},t.prototype.resetStyles=function(){var e=this.get("domStyles"),i=this.get("defaultStyles");e?e=at({},i,e):e=i,this.set("domStyles",e)},t.prototype.applyStyles=function(){var e=this.get("domStyles");if(e){var i=this.getContainer();this.applyChildrenStyles(i,e);var n=this.get("containerClassName");if(n&&Alt(i,n)){var a=e[n];be(i,a)}}},t.prototype.applyChildrenStyles=function(e,i){I(i,function(n,a){var o=e.getElementsByClassName(a);I(o,function(s){be(s,n)})})},t.prototype.applyStyle=function(e,i){var n=this.get("domStyles");be(i,n[e])},t.prototype.createDom=function(){var e=this.get("containerTpl");return Qo(e)},t.prototype.initEvent=function(){},t.prototype.removeDom=function(){var e=this.get("container");e&&e.parentNode&&e.parentNode.removeChild(e)},t.prototype.removeEvent=function(){},t.prototype.updateInner=function(e){_o(e,"domStyles")&&(this.resetStyles(),this.applyStyles()),this.resetPosition()},t.prototype.resetPosition=function(){},t}(XS),jlt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"annotation",type:"html",locationType:"point",x:0,y:0,containerTpl:'<div class="g2-html-annotation" style="position:absolute"></div>',alignX:"left",alignY:"top",html:"",zIndex:7})},t.prototype.render=function(){var e=this.getContainer(),i=this.get("html");GS(e);var n=ot(i)?i(e):i;if(MS(n))e.appendChild(n);else if(mt(n)||Tt(n)){var a=Qo(""+n);a&&e.appendChild(a)}this.resetPosition()},t.prototype.resetPosition=function(){var e=this.getContainer(),i=this.getLocation(),n=i.x,a=i.y,o=this.get("alignX"),s=this.get("alignY"),l=this.get("offsetX"),u=this.get("offsetY"),c=not(e),h=rot(e),f={x:n,y:a};o==="middle"?f.x-=Math.round(c/2):o==="right"&&(f.x-=Math.round(c)),s==="middle"?f.y-=Math.round(h/2):s==="bottom"&&(f.y-=Math.round(h)),l&&(f.x+=l),u&&(f.y+=u),be(e,{position:"absolute",left:f.x+"px",top:f.y+"px",zIndex:this.get("zIndex")})},t}(iy);const m4=Object.freeze(Object.defineProperty({__proto__:null,Arc:Hlt,DataMarker:Vlt,DataRegion:Glt,Html:jlt,Image:Wlt,Line:Ult,Region:$lt,RegionFilter:Xlt,Shape:Ylt,Text:zlt},Symbol.toStringTag,{value:"Module"}));function Nf(r,t,e){var i=t+"Style",n=null;return I(e,function(a,o){r[o]&&a[i]&&(n||(n={}),ne(n,a[i]))}),n}var YS=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"axis",ticks:[],line:{},tickLine:{},subTickLine:null,title:null,label:{},verticalFactor:1,verticalLimitLength:null,overlapOrder:["autoRotate","autoEllipsis","autoHide"],tickStates:{},optimize:{},defaultCfg:{line:{style:{lineWidth:1,stroke:Xt.lineColor}},tickLine:{style:{lineWidth:1,stroke:Xt.lineColor},alignTick:!0,length:5,displayWithLabel:!0},subTickLine:{style:{lineWidth:1,stroke:Xt.lineColor},count:4,length:2},label:{autoRotate:!0,autoHide:!1,autoEllipsis:!1,style:{fontSize:12,fill:Xt.textColor,fontFamily:Xt.fontFamily,fontWeight:"normal"},offset:10,offsetX:0,offsetY:0},title:{autoRotate:!0,spacing:5,position:"center",style:{fontSize:12,fill:Xt.textColor,textBaseline:"middle",fontFamily:Xt.fontFamily,textAlign:"center"},iconStyle:{fill:Xt.descriptionIconFill,stroke:Xt.descriptionIconStroke},description:""},tickStates:{active:{labelStyle:{fontWeight:500},tickLineStyle:{lineWidth:2}},inactive:{labelStyle:{fill:Xt.uncheckedColor}}},optimize:{enable:!0,threshold:400}},theme:{}})},t.prototype.renderInner=function(e){this.get("line")&&this.drawLine(e),this.drawTicks(e),this.get("title")&&this.drawTitle(e)},t.prototype.isList=function(){return!0},t.prototype.getItems=function(){return this.get("ticks")},t.prototype.setItems=function(e){this.update({ticks:e})},t.prototype.updateItem=function(e,i){ne(e,i),this.clear(),this.render()},t.prototype.clearItems=function(){var e=this.getElementByLocalId("label-group");e&&e.clear()},t.prototype.setItemState=function(e,i,n){e[i]=n,this.updateTickStates(e)},t.prototype.hasState=function(e,i){return!!e[i]},t.prototype.getItemStates=function(e){var i=this.get("tickStates"),n=[];return I(i,function(a,o){e[o]&&n.push(o)}),n},t.prototype.clearItemsState=function(e){var i=this,n=this.getItemsByState(e);I(n,function(a){i.setItemState(a,e,!1)})},t.prototype.getItemsByState=function(e){var i=this,n=this.getItems();return Fr(n,function(a){return i.hasState(a,e)})},t.prototype.getSidePoint=function(e,i){var n=this,a=n.getSideVector(i,e);return{x:e.x+a[0],y:e.y+a[1]}},t.prototype.getTextAnchor=function(e){var i;return wr(e[0],0)?i="center":e[0]>0?i="start":e[0]<0&&(i="end"),i},t.prototype.getTextBaseline=function(e){var i;return wr(e[1],0)?i="middle":e[1]>0?i="top":e[1]<0&&(i="bottom"),i},t.prototype.processOverlap=function(e){},t.prototype.drawLine=function(e){var i=this.getLinePath(),n=this.get("line");this.addShape(e,{type:"path",id:this.getElementId("line"),name:"axis-line",attrs:ne({path:i},n.style)})},t.prototype.getTickLineItems=function(e){var i=this,n=[],a=this.get("tickLine"),o=a.alignTick,s=a.length,l=1,u=e.length;return u>=2&&(l=e[1].value-e[0].value),I(e,function(c){var h=c.point;o||(h=i.getTickPoint(c.value-l/2));var f=i.getSidePoint(h,s);n.push({startPoint:h,tickValue:c.value,endPoint:f,tickId:c.id,id:"tickline-"+c.id})}),n},t.prototype.getSubTickLineItems=function(e){var i=[],n=this.get("subTickLine"),a=n.count,o=e.length;if(o>=2)for(var s=0;s<o-1;s++)for(var l=e[s],u=e[s+1],c=0;c<a;c++){var h=(c+1)/(a+1),f=(1-h)*l.tickValue+h*u.tickValue,d=this.getTickPoint(f),v=this.getSidePoint(d,n.length);i.push({startPoint:d,endPoint:v,tickValue:f,id:"sub-"+l.id+"-"+c})}return i},t.prototype.getTickLineAttrs=function(e,i,n,a){var o=this.get(i).style,s={points:[e.startPoint,e.endPoint]},l=P(this.get("theme"),["tickLine","style"],{});o=ot(o)?ne({},l,o(s,n,a)):o;var u=e.startPoint,c=e.endPoint;return S({x1:u.x,y1:u.y,x2:c.x,y2:c.y},o)},t.prototype.drawTick=function(e,i,n,a,o){this.addShape(i,{type:"line",id:this.getElementId(e.id),name:"axis-"+n,attrs:this.getTickLineAttrs(e,n,a,o)})},t.prototype.drawTickLines=function(e){var i=this,n=this.get("ticks"),a=this.get("subTickLine"),o=this.getTickLineItems(n),s=this.addGroup(e,{name:"axis-tickline-group",id:this.getElementId("tickline-group")}),l=this.get("tickLine");if(I(o,function(c,h){if(l.displayWithLabel){var f=i.getElementId("label-"+c.tickId);e.findById(f)&&i.drawTick(c,s,"tickLine",h,o)}else i.drawTick(c,s,"tickLine",h,o)}),a){var u=this.getSubTickLineItems(o);I(u,function(c,h){i.drawTick(c,s,"subTickLine",h,u)})}},t.prototype.processTicks=function(){var e=this,i=this.get("ticks");I(i,function(n){n.point=e.getTickPoint(n.value),K(n.id)&&(n.id=n.name)})},t.prototype.drawTicks=function(e){var i=this;this.optimizeTicks(),this.processTicks(),this.get("label")&&this.drawLabels(e),this.get("tickLine")&&this.drawTickLines(e);var n=this.get("ticks");I(n,function(a){i.applyTickStates(a,e)})},t.prototype.optimizeTicks=function(){var e=this.get("optimize"),i=this.get("ticks");if(e&&e.enable&&e.threshold>0){var n=xr(i);if(n>e.threshold){var a=Math.ceil(n/e.threshold),o=i.filter(function(s,l){return l%a===0});this.set("ticks",o),this.set("originalTicks",i)}}},t.prototype.getLabelAttrs=function(e,i,n){var a=this.get("label"),o=a.offset,s=a.offsetX,l=a.offsetY,u=a.rotate,c=a.formatter,h=this.getSidePoint(e.point,o),f=this.getSideVector(o,h),d=c?c(e.name,e,i):e.name,v=a.style;v=ot(v)?P(this.get("theme"),["label","style"],{}):v;var p=ne({x:h.x+s,y:h.y+l,text:d,textAlign:this.getTextAnchor(f),textBaseline:this.getTextBaseline(f)},v);return u&&(p.matrix=pu(h,u)),p},t.prototype.drawLabels=function(e){var i=this,n=this.get("ticks"),a=this.addGroup(e,{name:"axis-label-group",id:this.getElementId("label-group")});I(n,function(f,d){i.addShape(a,{type:"text",name:"axis-label",id:i.getElementId("label-"+f.id),attrs:i.getLabelAttrs(f,d,n),delegateObject:{tick:f,item:f,index:d}})}),this.processOverlap(a);var o=a.getChildren(),s=P(this.get("theme"),["label","style"],{}),l=this.get("label"),u=l.style,c=l.formatter;if(ot(u)){var h=o.map(function(f){return P(f.get("delegateObject"),"tick")});I(o,function(f,d){var v=f.get("delegateObject").tick,p=c?c(v.name,v,d):v.name,g=ne({},s,u(p,d,h));f.attr(g)})}},t.prototype.getTitleAttrs=function(){var e=this.get("title"),i=e.style,n=e.position,a=e.offset,o=e.spacing,s=o===void 0?0:o,l=e.autoRotate,u=i.fontSize,c=.5;n==="start"?c=0:n==="end"&&(c=1);var h=this.getTickPoint(c),f=this.getSidePoint(h,a||s+u/2),d=ne({x:f.x,y:f.y,text:e.text},i),v=e.rotate,p=v;if(K(v)&&l){var g=this.getAxisVector(h),m=[1,0];p=FS(g,m,!0)}if(p){var y=pu(f,p);d.matrix=y}return d},t.prototype.drawTitle=function(e){var i,n=this.getTitleAttrs(),a=this.addShape(e,{type:"text",id:this.getElementId("title"),name:"axis-title",attrs:n});!((i=this.get("title"))===null||i===void 0)&&i.description&&this.drawDescriptionIcon(e,a,n.matrix)},t.prototype.drawDescriptionIcon=function(e,i,n){var a=this.addGroup(e,{name:"axis-description",id:this.getElementById("description")}),o=i.getBBox(),s=o.maxX,l=o.maxY,u=o.height,c=this.get("title").iconStyle,h=4,f=u/2,d=f/6,v=s+h,p=l-u/2,g=[v+f,p-f],m=g[0],y=g[1],_=[m+f,y+f],x=_[0],C=_[1],A=[m,C+f],b=A[0],R=A[1],M=[v,y+f],O=M[0],F=M[1],D=[v+f,p-u/4],H=D[0],j=D[1],$=[H,j+d],k=$[0],V=$[1],Q=[k,V+d],Y=Q[0],tt=Q[1],et=[Y,tt+f*3/4],dt=et[0],Et=et[1];this.addShape(a,{type:"path",id:this.getElementId("title-description-icon"),name:"axis-title-description-icon",attrs:S({path:[["M",m,y],["A",f,f,0,0,1,x,C],["A",f,f,0,0,1,b,R],["A",f,f,0,0,1,O,F],["A",f,f,0,0,1,m,y],["M",H,j],["L",k,V],["M",Y,tt],["L",dt,Et]],lineWidth:d,matrix:n},c)}),this.addShape(a,{type:"rect",id:this.getElementId("title-description-rect"),name:"axis-title-description-rect",attrs:{x:v,y:p-u/2,width:u,height:u,stroke:"#000",fill:"#000",opacity:0,matrix:n,cursor:"pointer"}})},t.prototype.applyTickStates=function(e,i){var n=this.getItemStates(e);if(n.length){var a=this.get("tickStates"),o=this.getElementId("label-"+e.id),s=i.findById(o);if(s){var l=Nf(e,"label",a);l&&s.attr(l)}var u=this.getElementId("tickline-"+e.id),c=i.findById(u);if(c){var h=Nf(e,"tickLine",a);h&&c.attr(h)}}},t.prototype.updateTickStates=function(e){var i=this.getItemStates(e),n=this.get("tickStates"),a=this.get("label"),o=this.getElementByLocalId("label-"+e.id),s=this.get("tickLine"),l=this.getElementByLocalId("tickline-"+e.id);if(i.length){if(o){var u=Nf(e,"label",n);u&&o.attr(u)}if(l){var c=Nf(e,"tickLine",n);c&&l.attr(c)}}else o&&o.attr(a.style),l&&l.attr(s.style)},t}(Wr);function jS(r,t,e,i){var n=t.getChildren(),a=!1;return I(n,function(o){var s=td(r,o,e,i);a=a||s}),a}function Zlt(){return y4}function qlt(r,t,e){return jS(r,t,e,"head")}function y4(r,t,e){return jS(r,t,e,"tail")}function Klt(r,t,e){return jS(r,t,e,"middle")}const Qlt=Object.freeze(Object.defineProperty({__proto__:null,ellipsisHead:qlt,ellipsisMiddle:Klt,ellipsisTail:y4,getDefault:Zlt},Symbol.toStringTag,{value:"Module"}));function Jlt(r){var t=r.attr("matrix");return t&&t[0]!==1}function _4(r){var t=Jlt(r)?Elt(r.attr("matrix")):0;return t%360}function $x(r,t,e,i){var n=!1,a=_4(t),o=Math.abs(r?e.attr("y")-t.attr("y"):e.attr("x")-t.attr("x")),s=(r?e.attr("y")>t.attr("y"):e.attr("x")>t.attr("x"))?t.getBBox():e.getBBox();if(r){var l=Math.abs(Math.cos(a));X0(l,0,Math.PI/180)?n=s.width+i>o:n=s.height/l+i>o}else{var l=Math.abs(Math.sin(a));X0(l,0,Math.PI/180)?n=s.width+i>o:n=s.height/l+i>o}return n}function bd(r,t,e,i){var n=(i==null?void 0:i.minGap)||0,a=t.getChildren().slice().filter(function(d){return d.get("visible")});if(!a.length)return!1;var o=!1;e&&a.reverse();for(var s=a.length,l=a[0],u=l,c=1;c<s;c++){var h=a[c];h.getBBox();var f=$x(r,u,h,n);f?(h.hide(),o=!0):u=h}return o}function x4(r,t,e){var i=(e==null?void 0:e.minGap)||0,n=t.getChildren().slice();if(n.length<2)return!1;var a=!1,o=n[0],s=o.getBBox(),l=n[1],u=n.length,c=_4(o),h=Math.abs(r?l.attr("y")-o.attr("y"):l.attr("x")-o.attr("x")),f=0;if(r){var d=Math.abs(Math.cos(c));if(X0(d,0,Math.PI/180)){var v=Hx(n);f=(v+i)/h}else f=(s.height/d+i)/h}else{var d=Math.abs(Math.sin(c));if(X0(d,0,Math.PI/180)){var v=Hx(n);f=(v+i)/h}else f=(s.height/d+i)/h}if(f>1){f=Math.ceil(f);for(var p=0;p<u;p++)p%f!==0&&(n[p].hide(),a=!0)}return a}function tut(){return C4}function eut(r,t,e,i){return bd(r,t,!1,i)}function rut(r,t,e,i){return bd(r,t,!0,i)}function iut(r,t,e,i){var n=(i==null?void 0:i.minGap)||0,a=t.getChildren().slice();if(a.length<=2)return!1;for(var o=!1,s=a.length,l=a[0],u=a[s-1],c=l,h=1;h<s-1;h++){var f=a[h];f.getBBox();var d=$x(r,c,f,n);d?(f.hide(),o=!0):c=f}var v=$x(r,c,u,n);return v&&(c.hide(),o=!0),o}function C4(r,t,e,i){var n=x4(r,t,i);return bd(r,t,!1)&&(n=!0),n}function nut(r,t,e,i){var n=t.getChildren().slice(),a=x4(r,t,i);if(n.length>2){var o=n[0],s=n[n.length-1];o.get("visible")||(o.show(),bd(r,t,!1,i)&&(a=!0)),s.get("visible")||(s.show(),bd(r,t,!0,i)&&(a=!0))}return a}const aut=Object.freeze(Object.defineProperty({__proto__:null,equidistance:C4,equidistanceWithReverseBoth:nut,getDefault:tut,reserveBoth:iut,reserveFirst:eut,reserveLast:rut},Symbol.toStringTag,{value:"Module"}));function out(r,t){I(r,function(e){var i=e.attr("x"),n=e.attr("y"),a=pu({x:i,y:n},t);e.attr("matrix",a)})}function E4(r,t,e,i){var n=t.getChildren();if(!n.length||!r&&n.length<2)return!1;var a=Hx(n),o=!1;if(r)o=!!e&&a>e;else{var s=Math.abs(n[1].attr("x")-n[0].attr("x"));o=a>s}if(o){var l=i(e,a);out(n,l)}return o}function sut(){return S4}function S4(r,t,e,i){return E4(r,t,e,function(){return Tt(i)?i:r?Xt.verticalAxisRotate:Xt.horizontalAxisRotate})}function lut(r,t,e){return E4(r,t,e,function(i,n){if(!i)return r?Xt.verticalAxisRotate:Xt.horizontalAxisRotate;if(r)return-Math.acos(i/n);var a=0;return i>n?a=Math.PI/4:(a=Math.asin(i/n),a>Math.PI/4&&(a=Math.PI/4)),a})}const uut=Object.freeze(Object.defineProperty({__proto__:null,fixedAngle:S4,getDefault:sut,unfixedAngle:lut},Symbol.toStringTag,{value:"Module"})),A4=Object.freeze(Object.defineProperty({__proto__:null,autoEllipsis:Qlt,autoHide:aut,autoRotate:uut},Symbol.toStringTag,{value:"Module"}));var T4=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{type:"line",locationType:"region",start:null,end:null})},t.prototype.getLinePath=function(){var e=this.get("start"),i=this.get("end"),n=[];return n.push(["M",e.x,e.y]),n.push(["L",i.x,i.y]),n},t.prototype.getInnerLayoutBBox=function(){var e=this.get("start"),i=this.get("end"),n=r.prototype.getInnerLayoutBBox.call(this),a=Math.min(e.x,i.x,n.x),o=Math.min(e.y,i.y,n.y),s=Math.max(e.x,i.x,n.maxX),l=Math.max(e.y,i.y,n.maxY);return{x:a,y:o,minX:a,minY:o,maxX:s,maxY:l,width:s-a,height:l-o}},t.prototype.isVertical=function(){var e=this.get("start"),i=this.get("end");return wr(e.x,i.x)},t.prototype.isHorizontal=function(){var e=this.get("start"),i=this.get("end");return wr(e.y,i.y)},t.prototype.getTickPoint=function(e){var i=this,n=i.get("start"),a=i.get("end"),o=a.x-n.x,s=a.y-n.y;return{x:n.x+o*e,y:n.y+s*e}},t.prototype.getSideVector=function(e){var i=this.getAxisVector(),n=Xc([0,0],i),a=this.get("verticalFactor"),o=[n[1],n[0]*-1];return Ai([0,0],o,e*a)},t.prototype.getAxisVector=function(){var e=this.get("start"),i=this.get("end");return[i.x-e.x,i.y-e.y]},t.prototype.processOverlap=function(e){var i=this,n=this.isVertical(),a=this.isHorizontal();if(!(!n&&!a)){var o=this.get("label"),s=this.get("title"),l=this.get("verticalLimitLength"),u=o.offset,c=l,h=0,f=0;s&&(h=s.style.fontSize,f=s.spacing),c&&(c=c-u-f-h);var d=this.get("overlapOrder");if(I(d,function(g){o[g]&&i.canProcessOverlap(g)&&i.autoProcessOverlap(g,o[g],e,c)}),s&&K(s.offset)){var v=e.getCanvasBBox(),p=n?v.width:v.height;s.offset=u+p+f+h/2}}},t.prototype.canProcessOverlap=function(e){var i=this.get("label");return e==="autoRotate"?K(i.rotate):!0},t.prototype.autoProcessOverlap=function(e,i,n,a){var o=this,s=this.isVertical(),l=!1,u=A4[e];if(i===!0)this.get("label"),l=u.getDefault()(s,n,a);else if(ot(i))l=i(s,n,a);else if(ie(i)){var c=i;u[c.type]&&(l=u[c.type](s,n,a,c.cfg))}else u[i]&&(l=u[i](s,n,a));if(e==="autoRotate"){if(l){var h=n.getChildren(),f=this.get("verticalFactor");I(h,function(v){var p=v.attr("textAlign");if(p==="center"){var g=f>0?"end":"start";v.attr("textAlign",g)}})}}else if(e==="autoHide"){var d=n.getChildren().slice(0);I(d,function(v){v.get("visible")||(o.get("isRegister")&&o.unregisterElement(v),v.remove())})}},t}(YS),b4=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{type:"circle",locationType:"circle",center:null,radius:null,startAngle:-Math.PI/2,endAngle:Math.PI*3/2})},t.prototype.getLinePath=function(){var e=this.get("center"),i=e.x,n=e.y,a=this.get("radius"),o=a,s=this.get("startAngle"),l=this.get("endAngle"),u=[];if(Math.abs(l-s)===Math.PI*2)u=[["M",i,n-o],["A",a,o,0,1,1,i,n+o],["A",a,o,0,1,1,i,n-o],["Z"]];else{var c=this.getCirclePoint(s),h=this.getCirclePoint(l),f=Math.abs(l-s)>Math.PI?1:0,d=s>l?0:1;u=[["M",i,n],["L",c.x,c.y],["A",a,o,0,f,d,h.x,h.y],["L",i,n]]}return u},t.prototype.getTickPoint=function(e){var i=this.get("startAngle"),n=this.get("endAngle"),a=i+(n-i)*e;return this.getCirclePoint(a)},t.prototype.getSideVector=function(e,i){var n=this.get("center"),a=[i.x-n.x,i.y-n.y],o=this.get("verticalFactor"),s=gc(a);return Ai(a,a,o*e/s),a},t.prototype.getAxisVector=function(e){var i=this.get("center"),n=[e.x-i.x,e.y-i.y];return[n[1],-1*n[0]]},t.prototype.getCirclePoint=function(e,i){var n=this.get("center");return i=i||this.get("radius"),{x:n.x+Math.cos(e)*i,y:n.y+Math.sin(e)*i}},t.prototype.canProcessOverlap=function(e){var i=this.get("label");return e==="autoRotate"?K(i.rotate):!0},t.prototype.processOverlap=function(e){var i=this,n=this.get("label"),a=this.get("title"),o=this.get("verticalLimitLength"),s=n.offset,l=o,u=0,c=0;a&&(u=a.style.fontSize,c=a.spacing),l&&(l=l-s-c-u);var h=this.get("overlapOrder");if(I(h,function(d){n[d]&&i.canProcessOverlap(d)&&i.autoProcessOverlap(d,n[d],e,l)}),a&&K(a.offset)){var f=e.getCanvasBBox().height;a.offset=s+f+c+u/2}},t.prototype.autoProcessOverlap=function(e,i,n,a){var o=this,s=!1,l=A4[e];if(a>0)if(i===!0)s=l.getDefault()(!1,n,a);else if(ot(i))s=i(!1,n,a);else if(ie(i)){var u=i;l[u.type]&&(s=l[u.type](!1,n,a,u.cfg))}else l[i]&&(s=l[i](!1,n,a));if(e==="autoRotate"){if(s){var c=n.getChildren(),h=this.get("verticalFactor");I(c,function(d){var v=d.attr("textAlign");if(v==="center"){var p=h>0?"end":"start";d.attr("textAlign",p)}})}}else if(e==="autoHide"){var f=n.getChildren().slice(0);I(f,function(d){d.get("visible")||(o.get("isRegister")&&o.unregisterElement(d),d.remove())})}},t}(YS);const cut=Object.freeze(Object.defineProperty({__proto__:null,Base:YS,Circle:b4,Line:T4},Symbol.toStringTag,{value:"Module"}));var ZS=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"crosshair",type:"base",line:{},text:null,textBackground:{},capture:!1,defaultCfg:{line:{style:{lineWidth:1,stroke:Xt.lineColor}},text:{position:"start",offset:10,autoRotate:!1,content:null,style:{fill:Xt.textColor,textAlign:"center",textBaseline:"middle",fontFamily:Xt.fontFamily}},textBackground:{padding:5,style:{stroke:Xt.lineColor}}}})},t.prototype.renderInner=function(e){this.get("line")&&this.renderLine(e),this.get("text")&&(this.renderText(e),this.renderBackground(e))},t.prototype.renderText=function(e){var i=this.get("text"),n=i.style,a=i.autoRotate,o=i.content;if(!K(o)){var s=this.getTextPoint(),l=null;if(a){var u=this.getRotateAngle();l=pu(s,u)}this.addShape(e,{type:"text",name:"crosshair-text",id:this.getElementId("text"),attrs:S(S(S({},s),{text:o,matrix:l}),n)})}},t.prototype.renderLine=function(e){var i=this.getLinePath(),n=this.get("line"),a=n.style;this.addShape(e,{type:"path",name:"crosshair-line",id:this.getElementId("line"),attrs:S({path:i},a)})},t.prototype.renderBackground=function(e){var i=this.getElementId("text"),n=e.findById(i),a=this.get("textBackground");if(a&&n){var o=n.getBBox(),s=G0(a.padding),l=a.style,u=this.addShape(e,{type:"rect",name:"crosshair-text-background",id:this.getElementId("text-background"),attrs:S({x:o.x-s[3],y:o.y-s[0],width:o.width+s[1]+s[3],height:o.height+s[0]+s[2],matrix:n.attr("matrix")},l)});u.toBack()}},t}(Wr),w4=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{type:"line",locationType:"region",start:null,end:null})},t.prototype.getRotateAngle=function(){var e=this.getLocation(),i=e.start,n=e.end,a=this.get("text").position,o=Math.atan2(n.y-i.y,n.x-i.x),s=a==="start"?o-Math.PI/2:o+Math.PI/2;return s},t.prototype.getTextPoint=function(){var e=this.getLocation(),i=e.start,n=e.end,a=this.get("text"),o=a.position,s=a.offset;return g4(i,n,o,s)},t.prototype.getLinePath=function(){var e=this.getLocation(),i=e.start,n=e.end;return[["M",i.x,i.y],["L",n.x,n.y]]},t}(ZS),hut=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{type:"circle",locationType:"circle",center:null,radius:100,startAngle:-Math.PI/2,endAngle:Math.PI*3/2})},t.prototype.getRotateAngle=function(){var e=this.getLocation(),i=e.startAngle,n=e.endAngle,a=this.get("text").position,o=a==="start"?i+Math.PI/2:n-Math.PI/2;return o},t.prototype.getTextPoint=function(){var e=this.get("text"),i=e.position,n=e.offset,a=this.getLocation(),o=a.center,s=a.radius,l=a.startAngle,u=a.endAngle,c=i==="start"?l:u,h=this.getRotateAngle()-Math.PI,f=Bc(o,s,c),d=Math.cos(h)*n,v=Math.sin(h)*n;return{x:f.x+d,y:f.y+v}},t.prototype.getLinePath=function(){var e=this.getLocation(),i=e.center,n=e.radius,a=e.startAngle,o=e.endAngle,s=null;if(o-a===Math.PI*2){var l=i.x,u=i.y;s=[["M",l,u-n],["A",n,n,0,1,1,l,u+n],["A",n,n,0,1,1,l,u-n],["Z"]]}else{var c=Bc(i,n,a),h=Bc(i,n,o),f=Math.abs(o-a)>Math.PI?1:0,d=a>o?0:1;s=[["M",c.x,c.y],["A",n,n,0,f,d,h.x,h.y]]}return s},t}(ZS),wd="g2-crosshair",Wx=wd+"-line",Vx=wd+"-text",_f;const fut=(_f={},_f[""+wd]={position:"relative"},_f[""+Wx]={position:"absolute",backgroundColor:"rgba(0, 0, 0, 0.25)"},_f[""+Vx]={position:"absolute",color:Xt.textColor,fontFamily:Xt.fontFamily},_f);var dut=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"crosshair",type:"html",locationType:"region",start:{x:0,y:0},end:{x:0,y:0},capture:!1,text:null,containerTpl:'<div class="'+wd+'"></div>',crosshairTpl:'<div class="'+Wx+'"></div>',textTpl:'<span class="'+Vx+'">{content}</span>',domStyles:null,containerClassName:wd,defaultStyles:fut,defaultCfg:{text:{position:"start",content:null,align:"center",offset:10}}})},t.prototype.render=function(){this.resetText(),this.resetPosition()},t.prototype.initCrossHair=function(){var e=this.getContainer(),i=this.get("crosshairTpl"),n=Qo(i);e.appendChild(n),this.applyStyle(Wx,n),this.set("crosshairEl",n)},t.prototype.getTextPoint=function(){var e=this.getLocation(),i=e.start,n=e.end,a=this.get("text"),o=a.position,s=a.offset;return g4(i,n,o,s)},t.prototype.resetText=function(){var e=this.get("text"),i=this.get("textEl");if(e){var n=e.content;if(!i){var a=this.getContainer(),o=Ah(this.get("textTpl"),e);i=Qo(o),a.appendChild(i),this.applyStyle(Vx,i),this.set("textEl",i)}i.innerHTML=n}else i&&i.remove()},t.prototype.isVertical=function(e,i){return e.x===i.x},t.prototype.resetPosition=function(){var e=this.get("crosshairEl");e||(this.initCrossHair(),e=this.get("crosshairEl"));var i=this.get("start"),n=this.get("end"),a=Math.min(i.x,n.x),o=Math.min(i.y,n.y);this.isVertical(i,n)?be(e,{width:"1px",height:Hi(Math.abs(n.y-i.y))}):be(e,{height:"1px",width:Hi(Math.abs(n.x-i.x))}),be(e,{top:Hi(o),left:Hi(a)}),this.alignText()},t.prototype.alignText=function(){var e=this.get("textEl");if(e){var i=this.get("text").align,n=e.clientWidth,a=this.getTextPoint();switch(i){case"center":a.x=a.x-n/2;break;case"right":a.x=a.x-n}be(e,{top:Hi(a.y),left:Hi(a.x)})}},t.prototype.updateInner=function(e){_o(e,"text")&&this.resetText(),r.prototype.updateInner.call(this,e)},t}(iy);const Gx=Object.freeze(Object.defineProperty({__proto__:null,Base:ZS,Circle:hut,Html:dut,Line:w4},Symbol.toStringTag,{value:"Module"}));var qS=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"grid",line:{},alternateColor:null,capture:!1,items:[],closed:!1,defaultCfg:{line:{type:"line",style:{lineWidth:1,stroke:Xt.lineColor}}}})},t.prototype.getLineType=function(){var e=this.get("line")||this.get("defaultCfg").line;return e.type},t.prototype.renderInner=function(e){this.drawGrid(e)},t.prototype.getAlternatePath=function(e,i){var n=this.getGridPath(e),a=i.slice(0).reverse(),o=this.getGridPath(a,!0),s=this.get("closed");return s?n=n.concat(o):(o[0][0]="L",n=n.concat(o),n.push(["Z"])),n},t.prototype.getPathStyle=function(){return this.get("line").style},t.prototype.drawGrid=function(e){var i=this,n=this.get("line"),a=this.get("items"),o=this.get("alternateColor"),s=null;I(a,function(l,u){var c=l.id||u;if(n){var h=i.getPathStyle();h=ot(h)?h(l,u,a):h;var f=i.getElementId("line-"+c),d=i.getGridPath(l.points);i.addShape(e,{type:"path",name:"grid-line",id:f,attrs:ne({path:d},h)})}if(o&&u>0){var v=i.getElementId("region-"+c),p=u%2===0;if(mt(o))p&&i.drawAlternateRegion(v,e,s.points,l.points,o);else{var g=p?o[1]:o[0];i.drawAlternateRegion(v,e,s.points,l.points,g)}}s=l})},t.prototype.drawAlternateRegion=function(e,i,n,a,o){var s=this.getAlternatePath(n,a);this.addShape(i,{type:"path",id:e,name:"grid-region",attrs:{path:s,fill:o}})},t}(Wr);function vut(r,t,e,i){var n=e-r,a=i-t;return Math.sqrt(n*n+a*a)}var R4=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{type:"circle",center:null,closed:!0})},t.prototype.getGridPath=function(e,i){var n=this.getLineType(),a=this.get("closed"),o=[];if(e.length)if(n==="circle"){var s=this.get("center"),l=e[0],u=vut(s.x,s.y,l.x,l.y),c=i?0:1;a?(o.push(["M",s.x,s.y-u]),o.push(["A",u,u,0,0,c,s.x,s.y+u]),o.push(["A",u,u,0,0,c,s.x,s.y-u]),o.push(["Z"])):I(e,function(h,f){f===0?o.push(["M",h.x,h.y]):o.push(["A",u,u,0,0,c,h.x,h.y])})}else I(e,function(h,f){f===0?o.push(["M",h.x,h.y]):o.push(["L",h.x,h.y])}),a&&o.push(["Z"]);return o},t}(qS),M4=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{type:"line"})},t.prototype.getGridPath=function(e){var i=[];return I(e,function(n,a){a===0?i.push(["M",n.x,n.y]):i.push(["L",n.x,n.y])}),i},t}(qS);const put=Object.freeze(Object.defineProperty({__proto__:null,Base:qS,Circle:R4,Line:M4},Symbol.toStringTag,{value:"Module"}));var KS=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"legend",layout:"horizontal",locationType:"point",x:0,y:0,offsetX:0,offsetY:0,title:null,background:null})},t.prototype.getLayoutBBox=function(){var e=r.prototype.getLayoutBBox.call(this),i=this.get("maxWidth"),n=this.get("maxHeight"),a=e.width,o=e.height;return i&&(a=Math.min(a,i)),n&&(o=Math.min(o,n)),ey(e.minX,e.minY,a,o)},t.prototype.setLocation=function(e){this.set("x",e.x),this.set("y",e.y),this.resetLocation()},t.prototype.resetLocation=function(){var e=this.get("x"),i=this.get("y"),n=this.get("offsetX"),a=this.get("offsetY");this.moveElementTo(this.get("group"),{x:e+n,y:i+a})},t.prototype.applyOffset=function(){this.resetLocation()},t.prototype.getDrawPoint=function(){return this.get("currentPoint")},t.prototype.setDrawPoint=function(e){return this.set("currentPoint",e)},t.prototype.renderInner=function(e){this.resetDraw(),this.get("title")&&this.drawTitle(e),this.drawLegendContent(e),this.get("background")&&this.drawBackground(e)},t.prototype.drawBackground=function(e){var i=this.get("background"),n=e.getBBox(),a=G0(i.padding),o=S({x:0,y:0,width:n.width+a[1]+a[3],height:n.height+a[0]+a[2]},i.style),s=this.addShape(e,{type:"rect",id:this.getElementId("background"),name:"legend-background",attrs:o});s.toBack()},t.prototype.drawTitle=function(e){var i=this.get("currentPoint"),n=this.get("title"),a=n.spacing,o=n.style,s=n.text,l=this.addShape(e,{type:"text",id:this.getElementId("title"),name:"legend-title",attrs:S({text:s,x:i.x,y:i.y},o)}),u=l.getBBox();this.set("currentPoint",{x:i.x,y:u.maxY+a})},t.prototype.resetDraw=function(){var e=this.get("background"),i={x:0,y:0};if(e){var n=G0(e.padding);i.x=n[3],i.y=n[0]}this.set("currentPoint",i)},t}(Wr),Q_={marker:{style:{inactiveFill:"#000",inactiveOpacity:.45,fill:"#000",opacity:1,size:12}},text:{style:{fill:"#ccc",fontSize:12}}},jp={fill:Xt.textColor,fontSize:12,textAlign:"start",textBaseline:"middle",fontFamily:Xt.fontFamily,fontWeight:"normal",lineHeight:12},J_="navigation-arrow-right",t1="navigation-arrow-left",f3={right:90*Math.PI/180,left:(360-90)*Math.PI/180,up:0,down:180*Math.PI/180},I4=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.currentPageIndex=1,e.totalPagesCnt=1,e.pageWidth=0,e.pageHeight=0,e.startX=0,e.startY=0,e.onNavigationBack=function(){var i=e.getElementByLocalId("item-group");if(e.currentPageIndex>1){e.currentPageIndex-=1,e.updateNavigation();var n=e.getCurrentNavigationMatrix();e.get("animate")?i.animate({matrix:n},100):i.attr({matrix:n})}},e.onNavigationAfter=function(){var i=e.getElementByLocalId("item-group");if(e.currentPageIndex<e.totalPagesCnt){e.currentPageIndex+=1,e.updateNavigation();var n=e.getCurrentNavigationMatrix();e.get("animate")?i.animate({matrix:n},100):i.attr({matrix:n})}},e}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"legend",type:"category",itemSpacing:24,itemMarginBottom:8,maxItemWidth:null,itemWidth:null,itemHeight:null,itemName:{},itemValue:null,maxWidth:null,maxHeight:null,marker:{},radio:null,items:[],itemStates:{},itemBackground:{},pageNavigator:{},defaultCfg:{title:{spacing:5,style:{fill:Xt.textColor,fontSize:12,textAlign:"start",textBaseline:"top"}},background:{padding:5,style:{stroke:Xt.lineColor}},itemBackground:{style:{opacity:0,fill:"#fff"}},pageNavigator:Q_,itemName:{spacing:16,style:jp},marker:{spacing:8,style:{r:6,symbol:"circle"}},itemValue:{alignRight:!1,formatter:null,style:jp,spacing:6},itemStates:{active:{nameStyle:{opacity:.8}},unchecked:{nameStyle:{fill:Xt.uncheckedColor},markerStyle:{fill:Xt.uncheckedColor,stroke:Xt.uncheckedColor}},inactive:{nameStyle:{fill:Xt.uncheckedColor},markerStyle:{opacity:.2}}}}})},t.prototype.isList=function(){return!0},t.prototype.getItems=function(){return this.get("items")},t.prototype.setItems=function(e){this.update({items:e})},t.prototype.updateItem=function(e,i){ne(e,i),this.clear(),this.render()},t.prototype.clearItems=function(){var e=this.getElementByLocalId("item-group");e&&e.clear()},t.prototype.setItemState=function(e,i,n){e[i]=n;var a=this.getElementByLocalId("item-"+e.id);if(a){var o=this.getItems(),s=o.indexOf(e),l=this.createOffScreenGroup(),u=this.drawItem(e,s,this.getItemHeight(),l);this.updateElements(u,a),this.clearUpdateStatus(a)}},t.prototype.hasState=function(e,i){return!!e[i]},t.prototype.getItemStates=function(e){var i=this.get("itemStates"),n=[];return I(i,function(a,o){e[o]&&n.push(o)}),n},t.prototype.clearItemsState=function(e){var i=this,n=this.getItemsByState(e);I(n,function(a){i.setItemState(a,e,!1)})},t.prototype.getItemsByState=function(e){var i=this,n=this.getItems();return Fr(n,function(a){return i.hasState(a,e)})},t.prototype.drawLegendContent=function(e){this.processItems(),this.drawItems(e)},t.prototype.processItems=function(){var e=this.get("items");I(e,function(i){i.id||(i.id=i.name)})},t.prototype.drawItems=function(e){var i=this,n=this.addGroup(e,{id:this.getElementId("item-container-group"),name:"legend-item-container-group"}),a=this.addGroup(n,{id:this.getElementId("item-group"),name:"legend-item-group"}),o=this.getItemHeight(),s=this.get("itemWidth"),l=this.get("itemSpacing"),u=this.get("itemMarginBottom"),c=this.get("currentPoint"),h=c.x,f=c.y,d=this.get("layout"),v=this.get("items"),p=!1,g=0,m=this.get("maxWidth"),y=this.get("maxHeight");I(v,function(_,x){var C=i.drawItem(_,x,o,a),A=C.getBBox(),b=s||A.width;b>g&&(g=b),d==="horizontal"?(m&&m<c.x+b-h&&(p=!0,c.x=h,c.y+=o+u),i.moveElementTo(C,c),c.x+=b+l):(y&&y<c.y+o+u-f&&(p=!0,c.x+=g+l,c.y=f,g=0),i.moveElementTo(C,c),c.y+=o+u)}),p&&this.get("flipPage")&&(this.pageHeight=0,this.pageWidth=0,this.totalPagesCnt=1,this.startX=h,this.startY=f,this.adjustNavigation(e,a))},t.prototype.getItemHeight=function(){var e=this.get("itemHeight");if(!e){var i=(this.get("itemName")||{}).style;if(ot(i)){var n=this.getItems();n.forEach(function(a,o){var s=S(S({},jp),i(a,o,n)).fontSize;e<s&&(e=s)})}else i&&(e=i.fontSize)}return e},t.prototype.drawMarker=function(e,i,n,a){var o=S(S(S({x:0,y:a/2},i.style),{symbol:P(n.marker,"symbol","circle")}),P(n.marker,"style",{})),s=this.addShape(e,{type:"marker",id:this.getElementId("item-"+n.id+"-marker"),name:"legend-item-marker",attrs:o}),l=s.getBBox();s.attr("x",l.width/2);var u=s.attr(),c=u.stroke,h=u.fill;return c&&s.set("isStroke",!0),h&&s.set("isFill",!0),s},t.prototype.drawItemText=function(e,i,n,a,o,s,l){var u=n.formatter,c=n.style,h=S(S({x:s,y:o/2,text:u?u(a[i],a,l):a[i]},jp),ot(c)?c(a,l,this.getItems()):c);return this.addShape(e,{type:"text",id:this.getElementId("item-"+a.id+"-"+i),name:"legend-item-"+i,attrs:h})},t.prototype.drawRadio=function(e,i,n,a,o){var s,l,u=i.style||{},c=(s=u.r)!==null&&s!==void 0?s:a/2,h=c*3.6/8,f=[o+c,a/2-c],d=f[0],v=f[1],p=[d+c,v+c],g=p[0],m=p[1],y=[d,m+c],_=y[0],x=y[1],C=[o,v+c],A=C[0],b=C[1],R=n.showRadio,M=S(S({path:[["M",d,v],["A",c,c,0,0,1,g,m],["L",g-h,m],["L",g,m],["A",c,c,0,0,1,_,x],["L",_,x-h],["L",_,x],["A",c,c,0,0,1,A,b],["L",A+h,b],["L",A,b],["A",c,c,0,0,1,d,v],["L",d,v+h]],stroke:"#000000",fill:"#ffffff"},u),{opacity:R?(l=u==null?void 0:u.opacity)!==null&&l!==void 0?l:.45:0}),O=this.addShape(e,{type:"path",id:this.getElementId("item-"+n.id+"-radio"),name:"legend-item-radio",attrs:M});return O.set("tip",i.tip),O},t.prototype.drawItem=function(e,i,n,a){var o="item-"+e.id,s=this.addGroup(a,{name:"legend-item-container",id:this.getElementId("item-container-"+o),delegateObject:{item:e,index:i}}),l=this.addGroup(s,{name:"legend-item",id:this.getElementId(o),delegateObject:{item:e,index:i}}),u=this.get("marker"),c=this.get("itemName"),h=this.get("itemValue"),f=this.get("itemBackground"),d=this.get("radio"),v=this.getLimitItemWidth(),p=0;if(u){var g=this.drawMarker(l,u,e,n),m=u.spacing,y=P(e,["marker","spacing"]);Tt(y)&&(m=y),p=g.getBBox().maxX+m}if(c){var _=this.drawItemText(l,"name",c,e,n,p,i);v&&td(!0,_,Oe(v-p,0,v)),p=_.getBBox().maxX+c.spacing}if(h){var x=this.drawItemText(l,"value",h,e,n,p,i);v&&(h.alignRight?(x.attr({textAlign:"right",x:v}),td(!0,x,Oe(v-p,0,v),"head")):td(!0,x,Oe(v-p,0,v))),p=x.getBBox().maxX+h.spacing}if(d&&this.drawRadio(l,d,e,n,p),f){var C=l.getBBox(),A=this.addShape(l,{type:"rect",name:"legend-item-background",id:this.getElementId(o+"-background"),attrs:S({x:0,y:0,width:C.width,height:n},f.style)});A.toBack()}return this.applyItemStates(e,l),l},t.prototype.adjustNavigation=function(e,i){var n=this,a=this.startX,o=this.startY,s=this.get("layout"),l=i.findAll(function(D){return D.get("name")==="legend-item"}),u=this.get("maxWidth"),c=this.get("maxHeight"),h=this.get("itemWidth"),f=this.get("itemSpacing"),d=this.getItemHeight(),v=at({},Q_,this.get("pageNavigator")),p=this.drawNavigation(e,s,"00/00",v),g=p.getBBox(),m={x:a,y:o},y=1,_=0,x=0,C=0,A=this.get("itemMarginBottom");function b(D,H){var j=D.getBBox(),$=h||j.width,k=H.x+$+f+g.width;return k>u}if(s==="horizontal"){var R=this.get("maxRow")||1,M=d+(R===1?0:A),O=u-f-g.width-g.minX;this.pageHeight=M*R,this.pageWidth=O,I(l,function(D){var H=D.getBBox(),j=h||H.width;(_&&_<m.x+j+f||b(D,m))&&(y===1&&(_=m.x+f,n.moveElementTo(p,{x:O,y:m.y+d/2-g.height/2-g.minY})),y+=1,m.x=a,m.y+=M),n.moveElementTo(D,m),D.getParent().setClip({type:"rect",attrs:{x:m.x,y:m.y,width:j+f,height:d}}),m.x+=j+f})}else{I(l,function(D){var H=D.getBBox();H.width>x&&(x=H.width)}),C=x,x+=f,u&&(x=Math.min(u,x),C=Math.min(u,C)),this.pageWidth=x,this.pageHeight=c-Math.max(g.height,d+A);var F=Math.floor(this.pageHeight/(d+A));I(l,function(D,H){H!==0&&H%F===0&&(y+=1,m.x+=x,m.y=o),n.moveElementTo(D,m),D.getParent().setClip({type:"rect",attrs:{x:m.x,y:m.y,width:x,height:d}}),m.y+=d+A}),this.totalPagesCnt=y,this.moveElementTo(p,{x:a+C/2-g.width/2-g.minX,y:c-g.height-g.minY})}this.pageHeight&&this.pageWidth&&i.getParent().setClip({type:"rect",attrs:{x:this.startX,y:this.startY,width:this.pageWidth,height:this.pageHeight}}),s==="horizontal"&&this.get("maxRow")?this.totalPagesCnt=Math.ceil(y/this.get("maxRow")):this.totalPagesCnt=y,this.currentPageIndex>this.totalPagesCnt&&(this.currentPageIndex=1),this.updateNavigation(p),i.attr("matrix",this.getCurrentNavigationMatrix())},t.prototype.drawNavigation=function(e,i,n,a){var o={x:0,y:0},s=this.addGroup(e,{id:this.getElementId("navigation-group"),name:"legend-navigation"}),l=P(a.marker,"style",{}),u=l.size,c=u===void 0?12:u,h=zt(l,["size"]),f=this.drawArrow(s,o,t1,i==="horizontal"?"up":"left",c,h);f.on("click",this.onNavigationBack);var d=f.getBBox();o.x+=d.width+2;var v=this.addShape(s,{type:"text",id:this.getElementId("navigation-text"),name:"navigation-text",attrs:S({x:o.x,y:o.y+c/2,text:n,textBaseline:"middle"},P(a.text,"style"))}),p=v.getBBox();o.x+=p.width+2;var g=this.drawArrow(s,o,J_,i==="horizontal"?"down":"right",c,h);return g.on("click",this.onNavigationAfter),s},t.prototype.updateNavigation=function(e){var i=at({},Q_,this.get("pageNavigator")),n=i.marker.style,a=n.fill,o=n.opacity,s=n.inactiveFill,l=n.inactiveOpacity,u=this.currentPageIndex+"/"+this.totalPagesCnt,c=e?e.getChildren()[1]:this.getElementByLocalId("navigation-text"),h=e?e.findById(this.getElementId(t1)):this.getElementByLocalId(t1),f=e?e.findById(this.getElementId(J_)):this.getElementByLocalId(J_);c.attr("text",u),h.attr("opacity",this.currentPageIndex===1?l:o),h.attr("fill",this.currentPageIndex===1?s:a),h.attr("cursor",this.currentPageIndex===1?"not-allowed":"pointer"),f.attr("opacity",this.currentPageIndex===this.totalPagesCnt?l:o),f.attr("fill",this.currentPageIndex===this.totalPagesCnt?s:a),f.attr("cursor",this.currentPageIndex===this.totalPagesCnt?"not-allowed":"pointer");var d=h.getBBox().maxX+2;c.attr("x",d),d+=c.getBBox().width+2,this.updateArrowPath(f,{x:d,y:0})},t.prototype.drawArrow=function(e,i,n,a,o,s){var l=i.x,u=i.y,c=this.addShape(e,{type:"path",id:this.getElementId(n),name:n,attrs:S({size:o,direction:a,path:[["M",l+o/2,u],["L",l,u+o],["L",l+o,u+o],["Z"]],cursor:"pointer"},s)});return c.attr("matrix",pu({x:l+o/2,y:u+o/2},f3[a])),c},t.prototype.updateArrowPath=function(e,i){var n=i.x,a=i.y,o=e.attr(),s=o.size,l=o.direction,u=pu({x:n+s/2,y:a+s/2},f3[l]);e.attr("path",[["M",n+s/2,a],["L",n,a+s],["L",n+s,a+s],["Z"]]),e.attr("matrix",u)},t.prototype.getCurrentNavigationMatrix=function(){var e=this,i=e.currentPageIndex,n=e.pageWidth,a=e.pageHeight,o=this.get("layout"),s=o==="horizontal"?{x:0,y:a*(1-i)}:{x:n*(1-i),y:0};return WS(s)},t.prototype.applyItemStates=function(e,i){var n=this.getItemStates(e),a=n.length>0;if(a){var o=i.getChildren(),s=this.get("itemStates");I(o,function(l){var u=l.get("name"),c=u.split("-")[2],h=Nf(e,c,s);h&&(l.attr(h),c==="marker"&&!(l.get("isStroke")&&l.get("isFill"))&&(l.get("isStroke")&&l.attr("fill",null),l.get("isFill")&&l.attr("stroke",null)))})}},t.prototype.getLimitItemWidth=function(){var e=this.get("itemWidth"),i=this.get("maxItemWidth");return i?e&&(i=e<=i?e:i):e&&(i=e),i},t}(KS),gut=1.4,d3=.4,L4=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{type:"continue",min:0,max:100,value:null,colors:[],track:{},rail:{},label:{},handler:{},slidable:!0,tip:null,step:null,maxWidth:null,maxHeight:null,defaultCfg:{label:{align:"rail",spacing:5,formatter:null,style:{fontSize:12,fill:Xt.textColor,textBaseline:"middle",fontFamily:Xt.fontFamily}},handler:{size:10,style:{fill:"#fff",stroke:"#333"}},track:{},rail:{type:"color",size:20,defaultLength:100,style:{fill:"#DCDEE2"}},title:{spacing:5,style:{fill:Xt.textColor,fontSize:12,textAlign:"start",textBaseline:"top"}}}})},t.prototype.isSlider=function(){return!0},t.prototype.getValue=function(){return this.getCurrentValue()},t.prototype.getRange=function(){return{min:this.get("min"),max:this.get("max")}},t.prototype.setRange=function(e,i){this.update({min:e,max:i})},t.prototype.setValue=function(e){var i=this.getValue();this.set("value",e);var n=this.get("group");this.resetTrackClip(),this.get("slidable")&&this.resetHandlers(n),this.delegateEmit("valuechanged",{originValue:i,value:e})},t.prototype.initEvent=function(){var e=this.get("group");this.bindSliderEvent(e),this.bindRailEvent(e),this.bindTrackEvent(e)},t.prototype.drawLegendContent=function(e){this.drawRail(e),this.drawLabels(e),this.fixedElements(e),this.resetTrack(e),this.resetTrackClip(e),this.get("slidable")&&this.resetHandlers(e)},t.prototype.bindSliderEvent=function(e){this.bindHandlersEvent(e)},t.prototype.bindHandlersEvent=function(e){var i=this;e.on("legend-handler-min:drag",function(n){var a=i.getValueByCanvasPoint(n.x,n.y),o=i.getCurrentValue(),s=o[1];s<a&&(s=a),i.setValue([a,s])}),e.on("legend-handler-max:drag",function(n){var a=i.getValueByCanvasPoint(n.x,n.y),o=i.getCurrentValue(),s=o[0];s>a&&(s=a),i.setValue([s,a])})},t.prototype.bindRailEvent=function(e){},t.prototype.bindTrackEvent=function(e){var i=this,n=null;e.on("legend-track:dragstart",function(a){n={x:a.x,y:a.y}}),e.on("legend-track:drag",function(a){if(n){var o=i.getValueByCanvasPoint(n.x,n.y),s=i.getValueByCanvasPoint(a.x,a.y),l=i.getCurrentValue(),u=l[1]-l[0],c=i.getRange(),h=s-o;h<0?l[0]+h>c.min?i.setValue([l[0]+h,l[1]+h]):i.setValue([c.min,c.min+u]):h>0&&(h>0&&l[1]+h<c.max?i.setValue([l[0]+h,l[1]+h]):i.setValue([c.max-u,c.max])),n={x:a.x,y:a.y}}}),e.on("legend-track:dragend",function(a){n=null})},t.prototype.drawLabels=function(e){this.drawLabel("min",e),this.drawLabel("max",e)},t.prototype.drawLabel=function(e,i){var n=this.get("label"),a=n.style,o=n.align,s=n.formatter,l=this.get(e),u=this.getLabelAlignAttrs(e,o),c="label-"+e;this.addShape(i,{type:"text",id:this.getElementId(c),name:"legend-label-"+e,attrs:S(S({x:0,y:0,text:ot(s)?s(l):l},a),u)})},t.prototype.getLabelAlignAttrs=function(e,i){var n=this.isVertical(),a="center",o="middle";return n?(a="start",i!=="rail"?e==="min"?o="top":o="bottom":o="top"):i!=="rail"?(o="top",e==="min"?a="start":a="end"):(a="start",o="middle"),{textAlign:a,textBaseline:o}},t.prototype.getRailPath=function(e,i,n,a){var o=this.get("rail"),s=o.size,l=o.defaultLength,u=o.type,c=this.isVertical(),h=l,f=n,d=a;f||(f=c?s:h),d||(d=c?h:s);var v=[];return u==="color"?(v.push(["M",e,i]),v.push(["L",e+f,i]),v.push(["L",e+f,i+d]),v.push(["L",e,i+d]),v.push(["Z"])):(v.push(["M",e+f,i]),v.push(["L",e+f,i+d]),v.push(["L",e,i+d]),v.push(["Z"])),v},t.prototype.drawRail=function(e){var i=this.get("rail"),n=i.style;this.addShape(e,{type:"path",id:this.getElementId("rail"),name:"legend-rail",attrs:S({path:this.getRailPath(0,0)},n)})},t.prototype.getTrackColor=function(e){var i=e.length;if(!i)return null;if(i===1)return e[0];var n;this.isVertical()?n="l(90)":n="l(0)";for(var a=0;a<i;a++){var o=a/(i-1);n+=" "+o+":"+e[a]}return n},t.prototype.getTrackPath=function(e){var i=this.getRailShape(e),n=i.attr("path");return Rr(n)},t.prototype.getClipTrackAttrs=function(e){var i=this.getCurrentValue(),n=i[0],a=i[1],o=this.getRailBBox(e),s=this.getPointByValue(n,e),l=this.getPointByValue(a,e),u=this.isVertical(),c,h,f,d;return u?(c=o.minX,h=s.y,f=o.width,d=l.y-s.y):(c=s.x,h=o.minY,f=l.x-s.x,d=o.height),{x:c,y:h,width:f,height:d}},t.prototype.getTrackAttrs=function(e){var i=this.get("track"),n=this.get("colors"),a=this.getTrackPath(e);return ne({path:a,fill:this.getTrackColor(n)},i.style)},t.prototype.resetTrackClip=function(e){var i=e||this.get("group"),n=this.getElementId("track"),a=i.findById(n),o=a.getClip(),s=this.getClipTrackAttrs(e);o?o.attr(s):a.setClip({type:"rect",attrs:s})},t.prototype.resetTrack=function(e){var i=this.getElementId("track"),n=e.findById(i),a=this.getTrackAttrs(e);n?n.attr(a):this.addShape(e,{type:"path",id:i,draggable:this.get("slidable"),name:"legend-track",attrs:a})},t.prototype.getPointByValue=function(e,i){var n=this.getRange(),a=n.min,o=n.max,s=(e-a)/(o-a),l=this.getRailBBox(i),u=this.isVertical(),c={x:0,y:0};return u?(c.x=l.minX+l.width/2,c.y=eu(l.minY,l.maxY,s)):(c.x=eu(l.minX,l.maxX,s),c.y=l.minY+l.height/2),c},t.prototype.getRailShape=function(e){var i=e||this.get("group");return i.findById(this.getElementId("rail"))},t.prototype.getRailBBox=function(e){var i=this.getRailShape(e),n=i.getBBox();return n},t.prototype.getRailCanvasBBox=function(){var e=this.get("group"),i=e.findById(this.getElementId("rail")),n=i.getCanvasBBox();return n},t.prototype.isVertical=function(){return this.get("layout")==="vertical"},t.prototype.getValueByCanvasPoint=function(e,i){var n=this.getRange(),a=n.min,o=n.max,s=this.getRailCanvasBBox(),l=this.isVertical(),u=this.get("step"),c;l?c=(i-s.minY)/s.height:c=(e-s.minX)/s.width;var h=eu(a,o,c);if(u){var f=Math.round((h-a)/u);h=a+f*u}return h>o&&(h=o),h<a&&(h=a),h},t.prototype.getCurrentValue=function(){var e=this.get("value");if(!e){var i=this.get("values");return i?[Math.max(Math.min.apply(Math,md(i,[this.get("max")])),this.get("min")),Math.min(Math.max.apply(Math,md(i,[this.get("min")])),this.get("max"))]:[this.get("min"),this.get("max")]}return e},t.prototype.resetHandlers=function(e){var i=this.getCurrentValue(),n=i[0],a=i[1];this.resetHandler(e,"min",n),this.resetHandler(e,"max",a)},t.prototype.getHandlerPath=function(e,i){var n=this.isVertical(),a=[],o=e.size,s=i.x,l=i.y,u=o*gut,c=o/2,h=o/6;if(n){var f=s+u*d3;a.push(["M",s,l]),a.push(["L",f,l+c]),a.push(["L",s+u,l+c]),a.push(["L",s+u,l-c]),a.push(["L",f,l-c]),a.push(["Z"]),a.push(["M",f,l+h]),a.push(["L",s+u-2,l+h]),a.push(["M",f,l-h]),a.push(["L",s+u-2,l-h])}else{var d=l+u*d3;a.push(["M",s,l]),a.push(["L",s-c,d]),a.push(["L",s-c,l+u]),a.push(["L",s+c,l+u]),a.push(["L",s+c,d]),a.push(["Z"]),a.push(["M",s-h,d]),a.push(["L",s-h,l+u-2]),a.push(["M",s+h,d]),a.push(["L",s+h,l+u-2])}return a},t.prototype.resetHandler=function(e,i,n){var a=this.getPointByValue(n,e),o=this.get("handler"),s=this.getHandlerPath(o,a),l=this.getElementId("handler-"+i),u=e.findById(l),c=this.isVertical();u?u.attr("path",s):this.addShape(e,{type:"path",name:"legend-handler-"+i,draggable:!0,id:l,attrs:S(S({path:s},o.style),{cursor:c?"ns-resize":"ew-resize"})})},t.prototype.fixedElements=function(e){var i=e.findById(this.getElementId("rail")),n=e.findById(this.getElementId("label-min")),a=e.findById(this.getElementId("label-max")),o=this.getDrawPoint();this.isVertical()?this.fixedVertail(n,a,i,o):this.fixedHorizontal(n,a,i,o)},t.prototype.fitRailLength=function(e,i,n,a){var o=this.isVertical(),s=o?"height":"width",l=this.get("label"),u=l.align,c=l.spacing,h=this.get("max"+fl(s));if(h){var f=u==="rail"?n[s]+e[s]+i[s]+c*2:n[s],d=f-h;d>0&&this.changeRailLength(a,s,n[s]-d)}},t.prototype.changeRailLength=function(e,i,n){var a=e.getBBox(),o;i==="height"?o=this.getRailPath(a.x,a.y,a.width,n):o=this.getRailPath(a.x,a.y,n,a.height),e.attr("path",o)},t.prototype.changeRailPosition=function(e,i,n){var a=e.getBBox(),o=this.getRailPath(i,n,a.width,a.height);e.attr("path",o)},t.prototype.fixedHorizontal=function(e,i,n,a){var o=this.get("label"),s=o.align,l=o.spacing,u=n.getBBox(),c=e.getBBox(),h=i.getBBox(),f=u.height;this.fitRailLength(c,h,u,n),u=n.getBBox(),s==="rail"?(e.attr({x:a.x,y:a.y+f/2}),this.changeRailPosition(n,a.x+c.width+l,a.y),i.attr({x:a.x+c.width+u.width+l*2,y:a.y+f/2})):s==="top"?(e.attr({x:a.x,y:a.y}),i.attr({x:a.x+u.width,y:a.y}),this.changeRailPosition(n,a.x,a.y+c.height+l)):(this.changeRailPosition(n,a.x,a.y),e.attr({x:a.x,y:a.y+u.height+l}),i.attr({x:a.x+u.width,y:a.y+u.height+l}))},t.prototype.fixedVertail=function(e,i,n,a){var o=this.get("label"),s=o.align,l=o.spacing,u=n.getBBox(),c=e.getBBox(),h=i.getBBox();if(this.fitRailLength(c,h,u,n),u=n.getBBox(),s==="rail")e.attr({x:a.x,y:a.y}),this.changeRailPosition(n,a.x,a.y+c.height+l),i.attr({x:a.x,y:a.y+c.height+u.height+l*2});else if(s==="right")e.attr({x:a.x+u.width+l,y:a.y}),this.changeRailPosition(n,a.x,a.y),i.attr({x:a.x+u.width+l,y:a.y+u.height});else{var f=Math.max(c.width,h.width);e.attr({x:a.x,y:a.y}),this.changeRailPosition(n,a.x+f+l,a.y),i.attr({x:a.x,y:a.y+u.height})}},t}(KS);const mut=Object.freeze(Object.defineProperty({__proto__:null,Base:KS,Category:I4,Continuous:L4},Symbol.toStringTag,{value:"Module"}));var ss="g2-tooltip",ls="g2-tooltip-title",Rd="g2-tooltip-list",ny="g2-tooltip-list-item",ay="g2-tooltip-marker",oy="g2-tooltip-value",O4="g2-tooltip-name",QS="g2-tooltip-crosshair-x",JS="g2-tooltip-crosshair-y";const P4=Object.freeze(Object.defineProperty({__proto__:null,CONTAINER_CLASS:ss,CROSSHAIR_X:QS,CROSSHAIR_Y:JS,LIST_CLASS:Rd,LIST_ITEM_CLASS:ny,MARKER_CLASS:ay,NAME_CLASS:O4,TITLE_CLASS:ls,VALUE_CLASS:oy},Symbol.toStringTag,{value:"Module"}));var Ya;const yut=(Ya={},Ya[""+ss]={position:"absolute",visibility:"visible",zIndex:8,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)",backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"0px 0px 10px #aeaeae",borderRadius:"3px",color:"rgb(87, 87, 87)",fontSize:"12px",fontFamily:Xt.fontFamily,lineHeight:"20px",padding:"10px 10px 6px 10px"},Ya[""+ls]={marginBottom:"4px"},Ya[""+Rd]={margin:"0px",listStyleType:"none",padding:"0px"},Ya[""+ny]={listStyleType:"none",marginBottom:"4px"},Ya[""+ay]={width:"8px",height:"8px",borderRadius:"50%",display:"inline-block",marginRight:"8px"},Ya[""+oy]={display:"inline-block",float:"right",marginLeft:"30px"},Ya[""+QS]={position:"absolute",width:"1px",backgroundColor:"rgba(0, 0, 0, 0.25)"},Ya[""+JS]={position:"absolute",height:"1px",backgroundColor:"rgba(0, 0, 0, 0.25)"},Ya);function _ut(r,t,e,i,n){var a={left:r<n.x,right:r+e>n.x+n.width,top:t<n.y,bottom:t+i>n.y+n.height};return a}function xut(r,t,e,i,n,a){var o=r,s=t;switch(a){case"left":o=r-i-e,s=t-n/2;break;case"right":o=r+e,s=t-n/2;break;case"top":o=r-i/2,s=t-n-e;break;case"bottom":o=r-i/2,s=t+e;break;default:o=r+e,s=t-n-e;break}return{x:o,y:s}}function Cut(r,t,e,i,n,a,o){var s=xut(r,t,e,i,n,a);if(o){var l=_ut(s.x,s.y,i,n,o);a==="auto"?(l.right&&(s.x=Math.max(0,r-i-e)),l.top&&(s.y=Math.max(0,t-n-e))):a==="top"||a==="bottom"?(l.left&&(s.x=o.x),l.right&&(s.x=o.x+o.width-i),a==="top"&&l.top&&(s.y=t+e),a==="bottom"&&l.bottom&&(s.y=t-n-e)):(l.top&&(s.y=o.y),l.bottom&&(s.y=o.y+o.height-n),a==="left"&&l.left&&(s.x=r+e),a==="right"&&l.right&&(s.x=r-i-e))}return s}function Eut(r,t){var e=!1;return I(t,function(i){if(_o(r,i))return e=!0,!1}),e}var F4=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"tooltip",type:"html",x:0,y:0,items:[],customContent:null,containerTpl:'<div class="'+ss+'"><div class="'+ls+'"></div><ul class="'+Rd+'"></ul></div>',itemTpl:'<li class="'+ny+`" data-index={index}>
          <span class="`+ay+`" style="background:{color}"></span>
          <span class="`+O4+`">{name}</span>:
          <span class="`+oy+`">{value}</span>
        </li>`,xCrosshairTpl:'<div class="'+QS+'"></div>',yCrosshairTpl:'<div class="'+JS+'"></div>',title:null,showTitle:!0,region:null,crosshairsRegion:null,containerClassName:ss,crosshairs:null,offset:10,position:"right",domStyles:null,defaultStyles:yut})},t.prototype.render=function(){this.get("customContent")?this.renderCustomContent():(this.resetTitle(),this.renderItems()),this.resetPosition()},t.prototype.clear=function(){this.clearCrosshairs(),this.setTitle(""),this.clearItemDoms()},t.prototype.show=function(){var e=this.getContainer();!e||this.destroyed||(this.set("visible",!0),be(e,{visibility:"visible"}),this.setCrossHairsVisible(!0))},t.prototype.hide=function(){var e=this.getContainer();!e||this.destroyed||(this.set("visible",!1),be(e,{visibility:"hidden"}),this.setCrossHairsVisible(!1))},t.prototype.getLocation=function(){return{x:this.get("x"),y:this.get("y")}},t.prototype.setLocation=function(e){this.set("x",e.x),this.set("y",e.y),this.resetPosition()},t.prototype.setCrossHairsVisible=function(e){var i=e?"":"none",n=this.get("xCrosshairDom"),a=this.get("yCrosshairDom");n&&be(n,{display:i}),a&&be(a,{display:i})},t.prototype.initContainer=function(){if(r.prototype.initContainer.call(this),this.get("customContent")){this.get("container")&&this.get("container").remove();var e=this.getHtmlContentNode();this.get("parent").appendChild(e),this.set("container",e),this.resetStyles(),this.applyStyles()}},t.prototype.updateInner=function(e){this.get("customContent")?this.renderCustomContent():(Eut(e,["title","showTitle"])&&this.resetTitle(),_o(e,"items")&&this.renderItems()),r.prototype.updateInner.call(this,e)},t.prototype.initDom=function(){this.cacheDoms()},t.prototype.removeDom=function(){r.prototype.removeDom.call(this),this.clearCrosshairs()},t.prototype.resetPosition=function(){var e=this.get("x"),i=this.get("y"),n=this.get("offset"),a=this.getOffset(),o=a.offsetX,s=a.offsetY,l=this.get("position"),u=this.get("region"),c=this.getContainer(),h=this.getBBox(),f=h.width,d=h.height,v;u&&(v=Td(u));var p=Cut(e,i,n,f,d,l,v);be(c,{left:Hi(p.x+o),top:Hi(p.y+s)}),this.resetCrosshairs()},t.prototype.renderCustomContent=function(){var e=this.getHtmlContentNode(),i=this.get("parent"),n=this.get("container");n&&n.parentNode===i?i.replaceChild(e,n):i.appendChild(e),this.set("container",e),this.resetStyles(),this.applyStyles()},t.prototype.getHtmlContentNode=function(){var e,i=this.get("customContent");if(i){var n=i(this.get("title"),this.get("items"));MS(n)?e=n:e=Qo(n)}return e},t.prototype.cacheDoms=function(){var e=this.getContainer(),i=e.getElementsByClassName(ls)[0],n=e.getElementsByClassName(Rd)[0];this.set("titleDom",i),this.set("listDom",n)},t.prototype.resetTitle=function(){var e=this.get("title"),i=this.get("showTitle");i&&e?this.setTitle(e):this.setTitle("")},t.prototype.setTitle=function(e){var i=this.get("titleDom");i&&(i.innerText=e)},t.prototype.resetCrosshairs=function(){var e=this.get("crosshairsRegion"),i=this.get("crosshairs");if(!e||!i)this.clearCrosshairs();else{var n=Td(e),a=this.get("xCrosshairDom"),o=this.get("yCrosshairDom");i==="x"?(this.resetCrosshair("x",n),o&&(o.remove(),this.set("yCrosshairDom",null))):i==="y"?(this.resetCrosshair("y",n),a&&(a.remove(),this.set("xCrosshairDom",null))):(this.resetCrosshair("x",n),this.resetCrosshair("y",n)),this.setCrossHairsVisible(this.get("visible"))}},t.prototype.resetCrosshair=function(e,i){var n=this.checkCrosshair(e),a=this.get(e);e==="x"?be(n,{left:Hi(a),top:Hi(i.y),height:Hi(i.height)}):be(n,{top:Hi(a),left:Hi(i.x),width:Hi(i.width)})},t.prototype.checkCrosshair=function(e){var i=e+"CrosshairDom",n=e+"CrosshairTpl",a="CROSSHAIR_"+e.toUpperCase(),o=P4[a],s=this.get(i),l=this.get("parent");return s||(s=Qo(this.get(n)),this.applyStyle(o,s),l.appendChild(s),this.set(i,s)),s},t.prototype.renderItems=function(){this.clearItemDoms();var e=this.get("items"),i=this.get("itemTpl"),n=this.get("listDom");n&&(I(e,function(a){var o=Gs.toCSSGradient(a.color),s=S(S({},a),{color:o}),l=Ah(i,s),u=Qo(l);n.appendChild(u)}),this.applyChildrenStyles(n,this.get("domStyles")))},t.prototype.clearItemDoms=function(){this.get("listDom")&&GS(this.get("listDom"))},t.prototype.clearCrosshairs=function(){var e=this.get("xCrosshairDom"),i=this.get("yCrosshairDom");e&&e.remove(),i&&i.remove(),this.set("xCrosshairDom",null),this.set("yCrosshairDom",null)},t}(iy);const Sut=Object.freeze(Object.defineProperty({__proto__:null,Html:F4},Symbol.toStringTag,{value:"Module"}));var Aut={opacity:0},Tut={stroke:"#C5C5C5",strokeOpacity:.85},but={fill:"#CACED4",opacity:.85};function wut(r,t,e,i){var n=[],a=!!i,o,s,l,u,c,h,f;if(a){l=i[0],u=i[1];for(var d=0,v=r.length;d<v;d+=1){var p=r[d];l=kr([0,0],l,p),u=Ur([0,0],u,p)}}for(var d=0,g=r.length;d<g;d+=1){var p=r[d];if(d===0&&!e)f=p;else if(d===g-1&&!e)h=p,n.push(f),n.push(h);else{var m=[d?d-1:g-1,d-1][e?0:1];o=r[m],s=r[e?(d+1)%g:d+1];var y=[0,0];y=Ko(y,s,o),y=Ai(y,y,t);var _=Yc(p,o),x=Yc(p,s),C=_+x;C!==0&&(_/=C,x/=C);var A=Ai([0,0],y,-_),b=Ai([0,0],y,x);h=si([0,0],p,A),c=si([0,0],p,b),c=kr([0,0],c,Ur([0,0],s,p)),c=Ur([0,0],c,kr([0,0],s,p)),A=Ko([0,0],c,p),A=Ai([0,0],A,-_/x),h=si([0,0],p,A),h=kr([0,0],h,Ur([0,0],o,p)),h=Ur([0,0],h,kr([0,0],o,p)),b=Ko([0,0],p,h),b=Ai([0,0],b,x/_),c=si([0,0],p,b),a&&(h=Ur([0,0],h,l),h=kr([0,0],h,u),c=Ur([0,0],c,l),c=kr([0,0],c,u)),n.push(f),n.push(h),f=c}}return e&&n.push(n.shift()),n}function Rut(r,t,e){t===void 0&&(t=!1),e===void 0&&(e=[[0,0],[1,1]]);for(var i=!!t,n=[],a=0,o=r.length;a<o;a+=2)n.push([r[a],r[a+1]]);for(var s=wut(n,.4,i,e),l=n.length,u=[],c,h,f,a=0;a<l-1;a+=1)c=s[a*2],h=s[a*2+1],f=n[a+1],u.push(["C",c[0],c[1],h[0],h[1],f[0],f[1]]);return i&&(c=s[l],h=s[l+1],f=n[0],u.push(["C",c[0],c[1],h[0],h[1],f[0],f[1]])),u}function Mut(r){return Ne(r,function(t,e){var i=e===0?"M":"L",n=t[0],a=t[1];return[i,n,a]})}function B4(r){return Mut(r)}function Iut(r){if(r.length<=2)return B4(r);var t=[];I(r,function(o){qt(o,t.slice(t.length-2))||t.push(o[0],o[1])});var e=Rut(t,!1),i=Ki(r),n=i[0],a=i[1];return e.unshift(["M",n,a]),e}function Lut(r,t,e,i){i===void 0&&(i=!0);var n=new $v({values:r}),a=new Hv({values:Ne(r,function(s,l){return l})}),o=Ne(r,function(s,l){return[a.scale(l)*t,e-n.scale(s)*e]});return i?Iut(o):B4(o)}function Out(r,t){var e=new $v({values:r}),i=e.max<0?e.max:Math.max(0,e.min);return t-e.scale(i)*t}function Put(r,t,e,i){var n=md(r),a=Out(i,e);return n.push(["L",t,a]),n.push(["L",0,a]),n.push(["Z"]),n}var Fut=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"trend",x:0,y:0,width:200,height:16,smooth:!0,isArea:!1,data:[],backgroundStyle:Aut,lineStyle:Tut,areaStyle:but})},t.prototype.renderInner=function(e){var i=this.cfg,n=i.width,a=i.height,o=i.data,s=i.smooth,l=i.isArea,u=i.backgroundStyle,c=i.lineStyle,h=i.areaStyle;this.addShape(e,{id:this.getElementId("background"),type:"rect",attrs:S({x:0,y:0,width:n,height:a},u)});var f=Lut(o,n,a,s);if(this.addShape(e,{id:this.getElementId("line"),type:"path",attrs:S({path:f},c)}),l){var d=Put(f,n,a,o);this.addShape(e,{id:this.getElementId("area"),type:"path",attrs:S({path:d},h)})}},t.prototype.applyOffset=function(){var e=this.cfg,i=e.x,n=e.y;this.moveElementTo(this.get("group"),{x:i,y:n})},t}(Wr),D4={fill:"#F7F7F7",stroke:"#BFBFBF",radius:2,opacity:1,cursor:"ew-resize",highLightFill:"#FFF"},v3=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"handler",x:0,y:0,width:10,height:24,style:D4})},t.prototype.renderInner=function(e){var i=this.cfg,n=i.width,a=i.height,o=i.style,s=o.fill,l=o.stroke,u=o.radius,c=o.opacity,h=o.cursor;this.addShape(e,{type:"rect",id:this.getElementId("background"),attrs:{x:0,y:0,width:n,height:a,fill:s,stroke:l,radius:u,opacity:c,cursor:h}});var f=1/3*n,d=2/3*n,v=1/4*a,p=3/4*a;this.addShape(e,{id:this.getElementId("line-left"),type:"line",attrs:{x1:f,y1:v,x2:f,y2:p,stroke:l,cursor:h}}),this.addShape(e,{id:this.getElementId("line-right"),type:"line",attrs:{x1:d,y1:v,x2:d,y2:p,stroke:l,cursor:h}})},t.prototype.applyOffset=function(){this.moveElementTo(this.get("group"),{x:this.get("x"),y:this.get("y")})},t.prototype.initEvent=function(){this.bindEvents()},t.prototype.bindEvents=function(){var e=this;this.get("group").on("mouseenter",function(){var i=e.get("style").highLightFill;e.getElementByLocalId("background").attr("fill",i),e.draw()}),this.get("group").on("mouseleave",function(){var i=e.get("style").fill;e.getElementByLocalId("background").attr("fill",i),e.draw()})},t.prototype.draw=function(){var e=this.get("container").get("canvas");e&&e.draw()},t}(Wr),But={fill:"#416180",opacity:.05},Dut={fill:"#5B8FF9",opacity:.15,cursor:"move"},Kg=10,Nut={width:Kg,height:24},kut={textBaseline:"middle",fill:"#000",opacity:.45},Uut="sliderchange",N4=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.onMouseDown=function(i){return function(n){e.currentTarget=i;var a=n.originalEvent;a.stopPropagation(),a.preventDefault(),e.prevX=P(a,"touches.0.pageX",a.pageX),e.prevY=P(a,"touches.0.pageY",a.pageY);var o=e.getContainerDOM();o.addEventListener("mousemove",e.onMouseMove),o.addEventListener("mouseup",e.onMouseUp),o.addEventListener("mouseleave",e.onMouseUp),o.addEventListener("touchmove",e.onMouseMove),o.addEventListener("touchend",e.onMouseUp),o.addEventListener("touchcancel",e.onMouseUp)}},e.onMouseMove=function(i){var n=e.cfg.width,a=[e.get("start"),e.get("end")];i.stopPropagation(),i.preventDefault();var o=P(i,"touches.0.pageX",i.pageX),s=P(i,"touches.0.pageY",i.pageY),l=o-e.prevX,u=e.adjustOffsetRange(l/n);e.updateStartEnd(u),e.updateUI(e.getElementByLocalId("foreground"),e.getElementByLocalId("minText"),e.getElementByLocalId("maxText")),e.prevX=o,e.prevY=s,e.draw(),e.emit(Uut,[e.get("start"),e.get("end")].sort()),e.delegateEmit("valuechanged",{originValue:a,value:[e.get("start"),e.get("end")]})},e.onMouseUp=function(){e.currentTarget&&(e.currentTarget=void 0);var i=e.getContainerDOM();i&&(i.removeEventListener("mousemove",e.onMouseMove),i.removeEventListener("mouseup",e.onMouseUp),i.removeEventListener("mouseleave",e.onMouseUp),i.removeEventListener("touchmove",e.onMouseMove),i.removeEventListener("touchend",e.onMouseUp),i.removeEventListener("touchcancel",e.onMouseUp))},e}return t.prototype.setRange=function(e,i){this.set("minLimit",e),this.set("maxLimit",i);var n=this.get("start"),a=this.get("end"),o=Oe(n,e,i),s=Oe(a,e,i);!this.get("isInit")&&(n!==o||a!==s)&&this.setValue([o,s])},t.prototype.getRange=function(){return{min:this.get("minLimit")||0,max:this.get("maxLimit")||1}},t.prototype.setValue=function(e){var i=this.getRange();if(q(e)&&e.length===2){var n=[this.get("start"),this.get("end")];this.update({start:Oe(e[0],i.min,i.max),end:Oe(e[1],i.min,i.max)}),this.get("updateAutoRender")||this.render(),this.delegateEmit("valuechanged",{originValue:n,value:e})}},t.prototype.getValue=function(){return[this.get("start"),this.get("end")]},t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"slider",x:0,y:0,width:100,height:16,backgroundStyle:{},foregroundStyle:{},handlerStyle:{},textStyle:{},defaultCfg:{backgroundStyle:But,foregroundStyle:Dut,handlerStyle:Nut,textStyle:kut}})},t.prototype.update=function(e){var i=e.start,n=e.end,a=S({},e);K(i)||(a.start=Oe(i,0,1)),K(n)||(a.end=Oe(n,0,1)),r.prototype.update.call(this,a),this.minHandler=this.getChildComponentById(this.getElementId("minHandler")),this.maxHandler=this.getChildComponentById(this.getElementId("maxHandler")),this.trend=this.getChildComponentById(this.getElementId("trend"))},t.prototype.init=function(){this.set("start",Oe(this.get("start"),0,1)),this.set("end",Oe(this.get("end"),0,1)),r.prototype.init.call(this)},t.prototype.render=function(){r.prototype.render.call(this),this.updateUI(this.getElementByLocalId("foreground"),this.getElementByLocalId("minText"),this.getElementByLocalId("maxText"))},t.prototype.renderInner=function(e){var i=this.cfg;i.start,i.end;var n=i.width,a=i.height,o=i.trendCfg,s=o===void 0?{}:o,l=i.minText,u=i.maxText,c=i.backgroundStyle,h=c===void 0?{}:c,f=i.foregroundStyle,d=f===void 0?{}:f,v=i.textStyle,p=v===void 0?{}:v,g=at({},D4,this.cfg.handlerStyle);xr(P(s,"data"))&&(this.trend=this.addComponent(e,S({component:Fut,id:this.getElementId("trend"),x:0,y:0,width:n,height:a},s))),this.addShape(e,{id:this.getElementId("background"),type:"rect",attrs:S({x:0,y:0,width:n,height:a},h)}),this.addShape(e,{id:this.getElementId("minText"),type:"text",attrs:S({y:a/2,textAlign:"right",text:l,silent:!1},p)}),this.addShape(e,{id:this.getElementId("maxText"),type:"text",attrs:S({y:a/2,textAlign:"left",text:u,silent:!1},p)}),this.addShape(e,{id:this.getElementId("foreground"),name:"foreground",type:"rect",attrs:S({y:0,height:a},d)});var m=P(g,"width",Kg),y=P(g,"height",24);this.minHandler=this.addComponent(e,{component:v3,id:this.getElementId("minHandler"),name:"handler-min",x:0,y:(a-y)/2,width:m,height:y,cursor:"ew-resize",style:g}),this.maxHandler=this.addComponent(e,{component:v3,id:this.getElementId("maxHandler"),name:"handler-max",x:0,y:(a-y)/2,width:m,height:y,cursor:"ew-resize",style:g})},t.prototype.applyOffset=function(){this.moveElementTo(this.get("group"),{x:this.get("x"),y:this.get("y")})},t.prototype.initEvent=function(){this.bindEvents()},t.prototype.updateUI=function(e,i,n){var a=this.cfg,o=a.start,s=a.end,l=a.width,u=a.minText,c=a.maxText,h=a.handlerStyle,f=a.height,d=o*l,v=s*l;this.trend&&(this.trend.update({width:l,height:f}),this.get("updateAutoRender")||this.trend.render()),e.attr("x",d),e.attr("width",v-d);var p=P(h,"width",Kg);i.attr("text",u),n.attr("text",c);var g=this._dodgeText([d,v],i,n),m=g[0],y=g[1];this.minHandler&&(this.minHandler.update({x:d-p/2}),this.get("updateAutoRender")||this.minHandler.render()),I(m,function(_,x){return i.attr(x,_)}),this.maxHandler&&(this.maxHandler.update({x:v-p/2}),this.get("updateAutoRender")||this.maxHandler.render()),I(y,function(_,x){return n.attr(x,_)})},t.prototype.bindEvents=function(){var e=this.get("group");e.on("handler-min:mousedown",this.onMouseDown("minHandler")),e.on("handler-min:touchstart",this.onMouseDown("minHandler")),e.on("handler-max:mousedown",this.onMouseDown("maxHandler")),e.on("handler-max:touchstart",this.onMouseDown("maxHandler"));var i=e.findById(this.getElementId("foreground"));i.on("mousedown",this.onMouseDown("foreground")),i.on("touchstart",this.onMouseDown("foreground"))},t.prototype.adjustOffsetRange=function(e){var i=this.cfg,n=i.start,a=i.end;switch(this.currentTarget){case"minHandler":{var o=0-n,s=1-n;return Math.min(s,Math.max(o,e))}case"maxHandler":{var o=0-a,s=1-a;return Math.min(s,Math.max(o,e))}case"foreground":{var o=0-n,s=1-a;return Math.min(s,Math.max(o,e))}}},t.prototype.updateStartEnd=function(e){var i=this.cfg,n=i.start,a=i.end;switch(this.currentTarget){case"minHandler":n+=e;break;case"maxHandler":a+=e;break;case"foreground":n+=e,a+=e;break}this.set("start",n),this.set("end",a)},t.prototype._dodgeText=function(e,i,n){var a,o,s=this.cfg,l=s.handlerStyle,u=s.width,c=2,h=P(l,"width",Kg),f=e[0],d=e[1],v=!1;f>d&&(a=[d,f],f=a[0],d=a[1],o=[n,i],i=o[0],n=o[1],v=!0);var p=i.getBBox(),g=n.getBBox(),m=p.width>f-c?{x:f+h/2+c,textAlign:"left"}:{x:f-h/2-c,textAlign:"right"},y=g.width>u-d-c?{x:d-h/2-c,textAlign:"right"}:{x:d+h/2+c,textAlign:"left"};return v?[y,m]:[m,y]},t.prototype.draw=function(){var e=this.get("container"),i=e&&e.get("canvas");i&&i.draw()},t.prototype.getContainerDOM=function(){var e=this.get("container"),i=e&&e.get("canvas");return i&&i.get("container")},t}(Wr),zut={trackColor:"rgba(0,0,0,0)",thumbColor:"rgba(0,0,0,0.15)",size:8,lineCap:"round"},e1={default:zut,hover:{thumbColor:"rgba(0,0,0,0.2)"}},k4=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.clearEvents=Go,e.onStartEvent=function(i){return function(n){e.isMobile=i,n.originalEvent.preventDefault();var a=i?P(n.originalEvent,"touches.0.clientX"):n.clientX,o=i?P(n.originalEvent,"touches.0.clientY"):n.clientY;e.startPos=e.cfg.isHorizontal?a:o,e.bindLaterEvent()}},e.bindLaterEvent=function(){var i=e.getContainerDOM(),n=[];e.isMobile?n=[ac(i,"touchmove",e.onMouseMove),ac(i,"touchend",e.onMouseUp),ac(i,"touchcancel",e.onMouseUp)]:n=[ac(i,"mousemove",e.onMouseMove),ac(i,"mouseup",e.onMouseUp),ac(i,"mouseleave",e.onMouseUp)],e.clearEvents=function(){n.forEach(function(a){a.remove()})}},e.onMouseMove=function(i){var n=e.cfg,a=n.isHorizontal,o=n.thumbOffset;i.preventDefault();var s=e.isMobile?P(i,"touches.0.clientX"):i.clientX,l=e.isMobile?P(i,"touches.0.clientY"):i.clientY,u=a?s:l,c=u-e.startPos;e.startPos=u,e.updateThumbOffset(o+c)},e.onMouseUp=function(i){i.preventDefault(),e.clearEvents()},e.onTrackClick=function(i){var n=e.cfg,a=n.isHorizontal,o=n.x,s=n.y,l=n.thumbLen,u=e.getContainerDOM(),c=u.getBoundingClientRect(),h=i.clientX,f=i.clientY,d=a?h-c.left-o-l/2:f-c.top-s-l/2,v=e.validateRange(d);e.updateThumbOffset(v)},e.onThumbMouseOver=function(){var i=e.cfg.theme.hover.thumbColor;e.getElementByLocalId("thumb").attr("stroke",i),e.draw()},e.onThumbMouseOut=function(){var i=e.cfg.theme.default.thumbColor;e.getElementByLocalId("thumb").attr("stroke",i),e.draw()},e}return t.prototype.setRange=function(e,i){this.set("minLimit",e),this.set("maxLimit",i);var n=this.getValue(),a=Oe(n,e,i);n!==a&&!this.get("isInit")&&this.setValue(a)},t.prototype.getRange=function(){var e=this.get("minLimit")||0,i=this.get("maxLimit")||1;return{min:e,max:i}},t.prototype.setValue=function(e){var i=this.getRange(),n=this.getValue();this.update({thumbOffset:(this.get("trackLen")-this.get("thumbLen"))*Oe(e,i.min,i.max)}),this.delegateEmit("valuechange",{originalValue:n,value:this.getValue()})},t.prototype.getValue=function(){return Oe(this.get("thumbOffset")/(this.get("trackLen")-this.get("thumbLen")),0,1)},t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return S(S({},e),{name:"scrollbar",isHorizontal:!0,minThumbLen:20,thumbOffset:0,theme:e1})},t.prototype.renderInner=function(e){this.renderTrackShape(e),this.renderThumbShape(e)},t.prototype.applyOffset=function(){this.moveElementTo(this.get("group"),{x:this.get("x"),y:this.get("y")})},t.prototype.initEvent=function(){this.bindEvents()},t.prototype.renderTrackShape=function(e){var i=this.cfg,n=i.trackLen,a=i.theme,o=a===void 0?{default:{}}:a,s=at({},e1,o).default,l=s.lineCap,u=s.trackColor,c=s.size,h=P(this.cfg,"size",c),f=this.get("isHorizontal")?{x1:0+h/2,y1:h/2,x2:n-h/2,y2:h/2,lineWidth:h,stroke:u,lineCap:l}:{x1:h/2,y1:0+h/2,x2:h/2,y2:n-h/2,lineWidth:h,stroke:u,lineCap:l};return this.addShape(e,{id:this.getElementId("track"),name:"track",type:"line",attrs:f})},t.prototype.renderThumbShape=function(e){var i=this.cfg,n=i.thumbOffset,a=i.thumbLen,o=i.theme,s=at({},e1,o).default,l=s.size,u=s.lineCap,c=s.thumbColor,h=P(this.cfg,"size",l),f=this.get("isHorizontal")?{x1:n+h/2,y1:h/2,x2:n+a-h/2,y2:h/2,lineWidth:h,stroke:c,lineCap:u,cursor:"default"}:{x1:h/2,y1:n+h/2,x2:h/2,y2:n+a-h/2,lineWidth:h,stroke:c,lineCap:u,cursor:"default"};return this.addShape(e,{id:this.getElementId("thumb"),name:"thumb",type:"line",attrs:f})},t.prototype.bindEvents=function(){var e=this.get("group");e.on("mousedown",this.onStartEvent(!1)),e.on("mouseup",this.onMouseUp),e.on("touchstart",this.onStartEvent(!0)),e.on("touchend",this.onMouseUp);var i=e.findById(this.getElementId("track"));i.on("click",this.onTrackClick);var n=e.findById(this.getElementId("thumb"));n.on("mouseover",this.onThumbMouseOver),n.on("mouseout",this.onThumbMouseOut)},t.prototype.getContainerDOM=function(){var e=this.get("container"),i=e&&e.get("canvas");return i&&i.get("container")},t.prototype.validateRange=function(e){var i=this.cfg,n=i.thumbLen,a=i.trackLen,o=e;return e+n>a?o=a-n:e+n<n&&(o=0),o},t.prototype.draw=function(){var e=this.get("container"),i=e&&e.get("canvas");i&&i.draw()},t.prototype.updateThumbOffset=function(e){var i=this.cfg,n=i.thumbOffset,a=i.isHorizontal,o=i.thumbLen,s=i.size,l=this.validateRange(e);if(l!==n){var u=this.getElementByLocalId("thumb");a?u.attr({x1:l+s/2,x2:l+o-s/2}):u.attr({y1:l+s/2,y2:l+o-s/2}),this.emitOffsetChange(l)}},t.prototype.emitOffsetChange=function(e){var i=this.cfg,n=i.thumbOffset,a=i.trackLen,o=i.thumbLen;this.cfg.thumbOffset=e,this.emit("scrollchange",{thumbOffset:e,ratio:Oe(e/(a-o),0,1)}),this.delegateEmit("valuechange",{originalValue:n,value:e})},t}(Wr);const Hut=Object.freeze(Object.defineProperty({__proto__:null,Annotation:m4,Axis:cut,Component:XS,Crosshair:Gx,Grid:put,GroupComponent:Wr,HtmlComponent:iy,Legend:mut,Scrollbar:k4,Slider:N4,TOOLTIP_CSS_CONST:P4,Tooltip:Sut,propagationDelegate:$S},Symbol.toStringTag,{value:"Module"}));var $ut=T4,Wut=b4,Vut=M4,Gut=R4,p3=I4,Xut=L4,sy=F4;function Yut(r){if(Mi(r))return null;var t=r[0].x,e=r[0].x,i=r[0].y,n=r[0].y;return I(r,function(a){t=t>a.x?a.x:t,e=e<a.x?a.x:e,i=i>a.y?a.y:i,n=n<a.y?a.y:n}),{minX:t,maxX:e,minY:i,maxY:n,centerX:(t+e)/2,centerY:(i+n)/2}}function g3(r){return Array.from(new Set(r)).length===1}function m3(r){return(Tn(r)+rn(r))/2}function ur(r,t,e,i){return{x:r+e*Math.cos(i),y:t+e*Math.sin(i)}}function Xs(r,t,e,i,n,a){a===void 0&&(a=0);var o=ur(r,t,e,i),s=ur(r,t,e,n),l=ur(r,t,a,i),u=ur(r,t,a,n);if(n-i===Math.PI*2){var c=ur(r,t,e,i+Math.PI),h=ur(r,t,a,i+Math.PI),f=[["M",o.x,o.y],["A",e,e,0,1,1,c.x,c.y],["A",e,e,0,1,1,s.x,s.y],["M",l.x,l.y]];return a&&(f.push(["A",a,a,0,1,0,h.x,h.y]),f.push(["A",a,a,0,1,0,u.x,u.y])),f.push(["M",o.x,o.y]),f.push(["Z"]),f}var d=n-i<=Math.PI?0:1,v=[["M",o.x,o.y],["A",e,e,0,d,1,s.x,s.y],["L",u.x,u.y]];return a&&v.push(["A",a,a,0,d,0,l.x,l.y]),v.push(["L",o.x,o.y]),v.push(["Z"]),v}function U4(r,t,e,i,n){var a=ur(r,t,e,i),o=ur(r,t,e,n);if(wr(n-i,Math.PI*2)){var s=ur(r,t,e,i+Math.PI);return[["M",a.x,a.y],["A",e,e,0,1,1,s.x,s.y],["A",e,e,0,1,1,a.x,a.y],["A",e,e,0,1,0,s.x,s.y],["A",e,e,0,1,0,a.x,a.y],["Z"]]}var l=n-i<=Math.PI?0:1;return[["M",a.x,a.y],["A",e,e,0,l,1,o.x,o.y]]}function Md(r,t){var e=r.points,i=Yut(e),n,a,o=t.startAngle,s=t.endAngle,l=s-o;return t.isTransposed?(n=i.maxY*l,a=i.minY*l):(n=i.maxX*l,a=i.minX*l),n+=o,a+=o,{startAngle:a,endAngle:n}}function jut(r,t){if(Tt(r)&&Tt(t))return[r,t];if(r=r,t=t,g3(r)||g3(t))return[m3(r),m3(t)];for(var e=-1,i=0,n=0,a,o=r.length-1,s,l=0;++e<r.length;)a=o,o=e,l+=s=r[a]*t[o]-r[o]*t[a],i+=(r[a]+r[o])*s,n+=(t[a]+t[o])*s;return l*=3,[i/l,n/l]}function z4(r,t){var e=r.attr(),i=t.attr();return I(e,function(n,a){i[a]===void 0&&(i[a]=void 0)}),i}function Sc(r,t,e){var i=Math.min(t,e),n=Math.max(t,e);return r>=i&&r<=n}function Zut(r,t,e){if(mt(r))return r.padEnd(t,e);if(q(r)){var i=r.length;if(i<t)for(var n=t-i,a=0;a<n;a++)r.push(e)}return r}function $i(r,t){return typeof r=="object"&&t.forEach(function(e){delete r[e]}),r}function Ds(r,t,e){var i,n;t===void 0&&(t=[]),e===void 0&&(e=new Map);try{for(var a=Qt(r),o=a.next();!o.done;o=a.next()){var s=o.value;e.has(s)||(t.push(s),e.set(s,!0))}}catch(l){i={error:l}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return t}var Ri=function(){function r(t,e,i,n){t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=0),n===void 0&&(n=0),this.x=t,this.y=e,this.height=n,this.width=i}return r.fromRange=function(t,e,i,n){return new r(t,e,i-t,n-e)},r.fromObject=function(t){return new r(t.minX,t.minY,t.width,t.height)},Object.defineProperty(r.prototype,"minX",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"maxX",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"minY",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"maxY",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"tl",{get:function(){return{x:this.x,y:this.y}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"tr",{get:function(){return{x:this.maxX,y:this.y}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"bl",{get:function(){return{x:this.x,y:this.maxY}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"br",{get:function(){return{x:this.maxX,y:this.maxY}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"top",{get:function(){return{x:this.x+this.width/2,y:this.minY}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"right",{get:function(){return{x:this.maxX,y:this.y+this.height/2}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"bottom",{get:function(){return{x:this.x+this.width/2,y:this.maxY}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"left",{get:function(){return{x:this.minX,y:this.y+this.height/2}},enumerable:!1,configurable:!0}),r.prototype.isEqual=function(t){return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},r.prototype.contains=function(t){return t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY},r.prototype.clone=function(){return new r(this.x,this.y,this.width,this.height)},r.prototype.add=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this.clone();return I(t,function(n){i.x=Math.min(n.x,i.x),i.y=Math.min(n.y,i.y),i.width=Math.max(n.maxX,i.maxX)-i.x,i.height=Math.max(n.maxY,i.maxY)-i.y}),i},r.prototype.merge=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this.clone();return I(t,function(n){i.x=Math.max(n.x,i.x),i.y=Math.max(n.y,i.y),i.width=Math.min(n.maxX,i.maxX)-i.x,i.height=Math.min(n.maxY,i.maxY)-i.y}),i},r.prototype.cut=function(t,e){var i=t.width,n=t.height;switch(e){case nt.TOP:case nt.TOP_LEFT:case nt.TOP_RIGHT:return r.fromRange(this.minX,this.minY+n,this.maxX,this.maxY);case nt.RIGHT:case nt.RIGHT_TOP:case nt.RIGHT_BOTTOM:return r.fromRange(this.minX,this.minY,this.maxX-i,this.maxY);case nt.BOTTOM:case nt.BOTTOM_LEFT:case nt.BOTTOM_RIGHT:return r.fromRange(this.minX,this.minY,this.maxX,this.maxY-n);case nt.LEFT:case nt.LEFT_TOP:case nt.LEFT_BOTTOM:return r.fromRange(this.minX+i,this.minY,this.maxX,this.maxY);default:return this}},r.prototype.shrink=function(t){var e=ct(t,4),i=e[0],n=e[1],a=e[2],o=e[3];return new r(this.x+o,this.y+i,this.width-o-n,this.height-i-a)},r.prototype.expand=function(t){var e=ct(t,4),i=e[0],n=e[1],a=e[2],o=e[3];return new r(this.x-o,this.y-i,this.width+o+n,this.height+i+a)},r.prototype.exceed=function(t){return[Math.max(-this.minY+t.minY,0),Math.max(this.maxX-t.maxX,0),Math.max(this.maxY-t.maxY,0),Math.max(-this.minX+t.minX,0)]},r.prototype.collide=function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},r.prototype.size=function(){return this.width*this.height},r.prototype.isPointIn=function(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY},r}();function qut(r){return[[r.minX,r.minY],[r.maxX,r.minY],[r.maxX,r.maxY],[r.minX,r.maxY]]}function Vv(r){if(r.isPolar&&!r.isTransposed)return(r.endAngle-r.startAngle)*r.getRadius();var t=r.convert({x:0,y:0}),e=r.convert({x:1,y:0});return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Kut(r){if(r.isPolar){var t=r.startAngle,e=r.endAngle;return e-t===Math.PI*2}return!1}function ly(r,t){var e=r.getCenter();return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function Qut(r,t){var e=!1;if(r)if(r.type==="theta"){var i=r.start,n=r.end;e=Sc(t.x,i.x,n.x)&&Sc(t.y,i.y,n.y)}else{var a=r.invert(t);e=Sc(a.x,0,1)&&Sc(a.y,0,1)}return e}function ah(r,t){var e=r.getCenter();return Math.atan2(t.y-e.y,t.x-e.x)}function tA(r,t){t===void 0&&(t=0);var e=r.start,i=r.end,n=r.getWidth(),a=r.getHeight();if(r.isPolar){var o=r.startAngle,s=r.endAngle,l=r.getCenter(),u=r.getRadius();return{type:"path",startState:{path:Xs(l.x,l.y,u+t,o,o)},endState:function(h){var f=(s-o)*h+o,d=Xs(l.x,l.y,u+t,o,f);return{path:d}},attrs:{path:Xs(l.x,l.y,u+t,o,s)}}}var c;return r.isTransposed?c={height:a+t*2}:c={width:n+t*2},{type:"rect",startState:{x:e.x-t,y:i.y-t,width:r.isTransposed?n+t*2:0,height:r.isTransposed?0:a+t*2},endState:c,attrs:{x:e.x-t,y:i.y-t,width:n+t*2,height:a+t*2}}}function Jut(r,t){t===void 0&&(t=0);var e=r.start,i=r.end,n=r.getWidth(),a=r.getHeight(),o=Math.min(e.x,i.x),s=Math.min(e.y,i.y);return Ri.fromRange(o-t,s-t,o+n+t,s+a+t)}var tct=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]+)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/;function ect(r){var t="linear";return tct.test(r)?t="timeCat":mt(r)&&(t="cat"),t}function H4(r,t,e,i){return t===void 0&&(t={}),t.type?t.type:r.type!=="identity"&&Cc.includes(e)&&["interval"].includes(i)||r.isCategory?"cat":r.type}function rct(r,t,e){var i=t||[];if(Tt(r)||K(JD(i,r))&&Mi(e)){var n=W0("identity");return new n({field:r.toString(),values:[r]})}var a=ea(i,r),o=P(e,"type",ect(a[0])),s=W0(o);return new s(S({field:r,values:a},e))}function ict(r,t){if(r.type!=="identity"&&t.type!=="identity"){var e={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);r.change(e)}}function Id(r){return r.alias||r.field}function $4(r,t,e){var i=r.values,n=i.length,a;if(n===1)a=[.5,1];else{var o=1,s=0;Kut(t)?t.isTransposed?(o=P(e,"widthRatio.multiplePie",1/1.3),s=1/n*o,a=[s/2,1-s/2]):a=[0,1-1/n]:(s=1/n/2,a=[s,1-s])}return a}function nct(r){var t=r.values.filter(function(e){return!K(e)&&!isNaN(e)});return Math.max.apply(Math,xt(xt([],ct(t),!1),[K(r.max)?-1/0:r.max],!1))}function act(r){var t,e;switch(r){case nt.TOP:t={x:0,y:1},e={x:1,y:1};break;case nt.RIGHT:t={x:1,y:0},e={x:1,y:1};break;case nt.BOTTOM:t={x:0,y:0},e={x:1,y:0};break;case nt.LEFT:t={x:0,y:0},e={x:0,y:1};break;default:t=e={x:0,y:0}}return{start:t,end:e}}function oct(r){var t,e;return r.isTransposed?(t={x:0,y:0},e={x:1,y:0}):(t={x:0,y:0},e={x:0,y:1}),{start:t,end:e}}function Zp(r,t){var e={start:{x:0,y:0},end:{x:0,y:0}};r.isRect?e=act(t):r.isPolar&&(e=oct(r));var i=e.start,n=e.end;return{start:r.convert(i),end:r.convert(n)}}function W4(r){var t=r.start,e=r.end;return t.x===e.x}function y3(r,t){var e=r.start,i=r.end,n=W4(r);return n?(e.y-i.y)*(t.x-e.x)>0?1:-1:(i.x-e.x)*(e.y-t.y)>0?-1:1}function qp(r,t){var e=P(r,["components","axis"],{});return at({},P(e,["common"],{}),at({},P(e,[t],{})))}function _3(r,t,e){var i=P(r,["components","axis"],{});return at({},P(i,["common","title"],{}),at({},P(i,[t,"title"],{})),e)}function r1(r){var t=r.x,e=r.y,i=r.circleCenter,n=e.start>e.end,a=r.isTransposed?r.convert({x:n?0:1,y:0}):r.convert({x:0,y:n?0:1}),o=[a.x-i.x,a.y-i.y],s=[1,0],l=a.y>i.y?K1(o,s):K1(o,s)*-1,u=l+(t.end-t.start),c=Math.sqrt(Math.pow(a.x-i.x,2)+Math.pow(a.y-i.y,2));return{center:i,radius:c,startAngle:l,endAngle:u}}function Y0(r,t){return os(r)?r===!1?!1:{}:P(r,[t])}function x3(r,t){return P(r,"position",t)}function C3(r,t){return P(t,["title","text"],Id(r))}var Oh=function(){function r(t,e){this.destroyed=!1,this.facets=[],this.view=t,this.cfg=at({},this.getDefaultCfg(),e)}return r.prototype.init=function(){this.container||(this.container=this.createContainer());var t=this.view.getData();this.facets=this.generateFacets(t)},r.prototype.render=function(){this.renderViews()},r.prototype.update=function(){},r.prototype.clear=function(){this.clearFacetViews()},r.prototype.destroy=function(){this.clear(),this.container&&(this.container.remove(!0),this.container=void 0),this.destroyed=!0,this.view=void 0,this.facets=[]},r.prototype.facetToView=function(t){var e=t.region,i=t.data,n=t.padding,a=n===void 0?this.cfg.padding:n,o=this.view.createView({region:e,padding:a});o.data(i||[]),t.view=o,this.beforeEachView(o,t);var s=this.cfg.eachView;return s&&s(o,t),this.afterEachView(o,t),o},r.prototype.createContainer=function(){var t=this.view.getLayer(ir.FORE);return t.addGroup()},r.prototype.renderViews=function(){this.createFacetViews()},r.prototype.createFacetViews=function(){var t=this;return this.facets.map(function(e){return t.facetToView(e)})},r.prototype.clearFacetViews=function(){var t=this;I(this.facets,function(e){e.view&&(t.view.removeView(e.view),e.view=void 0)})},r.prototype.parseSpacing=function(){var t=this.view.viewBBox,e=t.width,i=t.height,n=this.cfg.spacing;return n.map(function(a,o){return Tt(a)?a/(o===0?e:i):parseFloat(a)/100})},r.prototype.getFieldValues=function(t,e){var i=[],n={};return I(t,function(a){var o=a[e];!K(o)&&!n[o]&&(i.push(o),n[o]=!0)}),i},r.prototype.getRegion=function(t,e,i,n){var a=ct(this.parseSpacing(),2),o=a[0],s=a[1],l=(1+o)/(e===0?1:e)-o,u=(1+s)/(t===0?1:t)-s,c={x:(l+o)*i,y:(u+s)*n},h={x:c.x+l,y:c.y+u};return{start:c,end:h}},r.prototype.getDefaultCfg=function(){return{eachView:void 0,showTitle:!0,spacing:[0,0],padding:10,fields:[]}},r.prototype.getDefaultTitleCfg=function(){var t=this.view.getTheme().fontFamily;return{style:{fontSize:14,fill:"#666",fontFamily:t}}},r.prototype.processAxis=function(t,e){var i=t.getOptions(),n=i.coordinate,a=t.geometries,o=P(n,"type","rect");if(o==="rect"&&a.length){K(i.axes)&&(i.axes={});var s=i.axes,l=ct(a[0].getXYFields(),2),u=l[0],c=l[1],h=Y0(s,u),f=Y0(s,c);h!==!1&&(i.axes[u]=this.getXAxisOption(u,s,h,e)),f!==!1&&(i.axes[c]=this.getYAxisOption(c,s,f,e))}},r.prototype.getFacetDataFilter=function(t){return function(e){return jm(t,function(i){var n=i.field,a=i.value;return!K(a)&&n?e[n]===a:!0})}},r}(),V4={},sct=function(r){return V4[hl(r)]},Ph=function(r,t){V4[hl(r)]=t},De=function(){function r(t,e){this.context=t,this.cfg=e,t.addAction(this)}return r.prototype.applyCfg=function(t){ne(this,t)},r.prototype.init=function(){this.applyCfg(this.cfg)},r.prototype.destroy=function(){this.context.removeAction(this),this.context=null},r}(),lct=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.execute=function(){this.callback&&this.callback(this.context)},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.callback=null},t}(De),eA={};function uct(r,t){var e=eA[r],i=null;if(e){var n=e.ActionClass,a=e.cfg;i=new n(t,a),i.name=r,i.init()}return i}function uy(r){var t=eA[r];return P(t,"ActionClass")}function Ct(r,t,e){eA[r]={ActionClass:t,cfg:e}}function cct(r,t){var e=new lct(t);return e.callback=r,e.name="callback",e}function hct(r,t){var e=[];if(r.length){e.push(["M",r[0].x,r[0].y]);for(var i=1,n=r.length;i<n;i+=1){var a=r[i];e.push(["L",a.x,a.y])}t&&e.push(["Z"])}return e}function Xx(r,t){for(var e=[r[0]],i=1,n=r.length;i<n;i=i+2){var a=t.convert({x:r[i],y:r[i+1]});e.push(a.x,a.y)}return e}function G4(r,t){var e=t.isTransposed,i=r[1],n=r[6],a=r[7],o=t.convert({x:n,y:a}),s=e?0:1;return["A",i,i,0,0,s,o.x,o.y]}function fct(r,t,e){var i=e.isTransposed,n=e.startAngle,a=e.endAngle,o=r[0].toLowerCase()==="a"?{x:r[6],y:r[7]}:{x:r[1],y:r[2]},s={x:t[1],y:t[2]},l=[],u=i?"y":"x",c=Math.abs(s[u]-o[u])*(a-n),h=s[u]>=o[u]?1:0,f=c>Math.PI?1:0,d=e.convert(s),v=ly(e,d);if(v>=.5)if(c===Math.PI*2){var p={x:(s.x+o.x)/2,y:(s.y+o.y)/2},g=e.convert(p);l.push(["A",v,v,0,f,h,g.x,g.y]),l.push(["A",v,v,0,f,h,d.x,d.y])}else l.push(["A",v,v,0,f,h,d.x,d.y]);return l}function dct(r){I(r,function(t,e){var i=t;if(i[0].toLowerCase()==="a"){var n=r[e-1],a=r[e+1];a&&a[0].toLowerCase()==="a"?n&&n[0].toLowerCase()==="l"&&(n[0]="M"):n&&n[0].toLowerCase()==="a"&&a&&a[0].toLowerCase()==="l"&&(a[0]="M")}})}var vct=function(r,t,e,i){var n,a=[],o=!!i,s,l,u,c,h,f,d;if(o){n=ct(i,2),u=n[0],c=n[1];for(var v=0,p=r.length;v<p;v++){var g=r[v];u=kr([0,0],u,g),c=Ur([0,0],c,g)}}for(var v=0,m=r.length;v<m;v++){var g=r[v];if(v===0&&!e)d=g;else if(v===m-1&&!e)f=g,a.push(d),a.push(f);else{s=r[e?v?v-1:m-1:v-1],l=r[e?(v+1)%m:v+1];var y=[0,0];y=Ko(y,l,s),y=Ai(y,y,t);var _=Yc(g,s),x=Yc(g,l),C=_+x;C!==0&&(_/=C,x/=C);var A=Ai([0,0],y,-_),b=Ai([0,0],y,x);f=si([0,0],g,A),h=si([0,0],g,b),h=kr([0,0],h,Ur([0,0],l,g)),h=Ur([0,0],h,kr([0,0],l,g)),A=Ko([0,0],h,g),A=Ai([0,0],A,-_/x),f=si([0,0],g,A),f=kr([0,0],f,Ur([0,0],s,g)),f=Ur([0,0],f,kr([0,0],s,g)),b=Ko([0,0],g,f),b=Ai([0,0],b,x/_),h=si([0,0],g,b),o&&(f=Ur([0,0],f,u),f=kr([0,0],f,c),h=Ur([0,0],h,u),h=kr([0,0],h,c)),a.push(d),a.push(f),d=h}}return e&&a.push(a.shift()),a};function X4(r,t,e){for(var i=!!t,n=[],a=0,o=r.length;a<o;a+=2)n.push([r[a],r[a+1]]);for(var s=vct(n,.4,i,e),l=n.length,u=[],c,h,f,a=0;a<l-1;a++)c=s[a*2],h=s[a*2+1],f=n[a+1],u.push(["C",c[0],c[1],h[0],h[1],f[0],f[1]]);return i&&(c=s[l],h=s[l+1],f=n[0],u.push(["C",c[0],c[1],h[0],h[1],f[0],f[1]])),u}function Gv(r,t){return hct(r,t)}function j0(r,t,e){var i=[],n=r[0],a=null;if(r.length<=2)return Gv(r,t);for(var o=0,s=r.length;o<s;o++){var l=r[o];(!a||!(a.x===l.x&&a.y===l.y))&&(i.push(l.x),i.push(l.y),a=l)}var u=e||[[0,0],[1,1]],c=X4(i,t,u);return c.unshift(["M",n.x,n.y]),c}function pct(r,t){var e=[];return I(t,function(i){var n=i[0];switch(n.toLowerCase()){case"m":case"l":case"c":e.push(Xx(i,r));break;case"a":e.push(G4(i,r));break;case"z":default:e.push(i);break}}),e}function gct(r,t){var e=[],i,n,a,o;return I(t,function(s,l){var u=s[0];switch(u.toLowerCase()){case"m":case"c":case"q":e.push(Xx(s,r));break;case"l":i=t[l-1],n=s,a=r.isTransposed,o=a?i[i.length-2]===n[1]:i[i.length-1]===n[2],o?e=e.concat(fct(i,n,r)):e.push(Xx(s,r));break;case"a":e.push(G4(s,r));break;case"z":default:e.push(s);break}}),dct(e),e}var ed=`	
\v\f\r   ᠎             　\u2028\u2029`,mct=new RegExp("([a-z])["+ed+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+ed+"]*,?["+ed+"]*)+)","ig"),yct=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+ed+"]*,?["+ed+"]*","ig");function _ct(r){if(!r)return null;if(q(r))return r;var t={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},e=[];return String(r).replace(mct,function(i,n,a){var o=[],s=n.toLowerCase();if(a.replace(yct,function(l,u){u&&o.push(+u)}),s==="m"&&o.length>2&&(e.push([n].concat(o.splice(0,2))),s="l",n=n==="m"?"l":"L"),s==="o"&&o.length===1&&e.push([n,o[0]]),s==="r")e.push([n].concat(o));else for(;o.length>=t[s]&&(e.push([n].concat(o.splice(0,t[s]))),!!t[s]););return""}),e}var E3=function(r,t,e){return r>=t&&r<=e};function xct(r,t,e,i){var n=.001,a={x:e.x-r.x,y:e.y-r.y},o={x:t.x-r.x,y:t.y-r.y},s={x:i.x-e.x,y:i.y-e.y},l=o.x*s.y-o.y*s.x,u=l*l,c=o.x*o.x+o.y*o.y,h=s.x*s.x+s.y*s.y,f=null;if(u>n*c*h){var d=(a.x*s.y-a.y*s.x)/l,v=(a.x*o.y-a.y*o.x)/l;E3(d,0,1)&&E3(v,0,1)&&(f={x:r.x+d*o.x,y:r.y+d*o.y})}return f}var Cct=1e-6;function i1(r){return Math.abs(r)<Cct?0:r<0?-1:1}function Ect(r,t,e){return(e[0]-r[0])*(t[1]-r[1])===(t[0]-r[0])*(e[1]-r[1])&&Math.min(r[0],t[0])<=e[0]&&e[0]<=Math.max(r[0],t[0])&&Math.min(r[1],t[1])<=e[1]&&e[1]<=Math.max(r[1],t[1])}function S3(r,t,e){var i=!1,n=r.length;if(n<=2)return!1;for(var a=0;a<n;a++){var o=r[a],s=r[(a+1)%n];if(Ect(o,s,[t,e]))return!0;i1(o[1]-e)>0!=i1(s[1]-e)>0&&i1(t-(e-o[1])*(o[0]-s[0])/(o[1]-s[1])-o[0])<0&&(i=!i)}return i}function A3(r){for(var t=[],e=r.length,i=0;i<e-1;i++){var n=r[i],a=r[i+1];t.push({from:{x:n[0],y:n[1]},to:{x:a[0],y:a[1]}})}if(t.length>1){var o=r[0],s=r[e-1];t.push({from:{x:s[0],y:s[1]},to:{x:o[0],y:o[1]}})}return t}function Sct(r,t){var e=!1;return I(r,function(i){if(xct(i.from,i.to,t.from,t.to))return e=!0,!1}),e}function T3(r){var t=r.map(function(i){return i[0]}),e=r.map(function(i){return i[1]});return{minX:Math.min.apply(null,t),maxX:Math.max.apply(null,t),minY:Math.min.apply(null,e),maxY:Math.max.apply(null,e)}}function Act(r,t){return!(t.minX>r.maxX||t.maxX<r.minX||t.minY>r.maxY||t.maxY<r.minY)}function Tct(r,t){if(r.length<2||t.length<2)return!1;var e=T3(r),i=T3(t);if(!Act(e,i))return!1;var n=!1;if(I(t,function(l){if(S3(r,l[0],l[1]))return n=!0,!1}),n||(I(r,function(l){if(S3(t,l[0],l[1]))return n=!0,!1}),n))return!0;var a=A3(r),o=A3(t),s=!1;return I(o,function(l){if(Sct(a,l))return s=!0,!1}),s}function Y4(r,t){var e=r.event,i=e.target;return Z4(i,t)}function j4(r,t){var e=r.getCanvasBBox(),i=e.width,n=e.height;return i>0&&n>0&&(i>=t||n>=t)}function Z4(r,t){var e=r.getCanvasBBox();return j4(r,t)?e:null}function q4(r,t){var e=r.event.maskShapes;return e.map(function(i){return Z4(i,t)}).filter(function(i){return!!i})}function bct(r,t){var e=r.event,i=e.target;return K4(i,t)}function K4(r,t){return j4(r,t)?r.attr("path"):null}function wct(r,t){var e=r.event.maskShapes;return e.map(function(i){return K4(i,t)})}function qs(r){var t=r.event,e,i=t.target;return i&&(e=i.get("element")),e}function gu(r){var t=r.event,e=t.target,i;return e&&(i=e.get("delegateObject")),i}function Q4(r){var t=r.event.gEvent;return!(t&&t.fromShape&&t.toShape&&t.fromShape.get("element")===t.toShape.get("element"))}function Ld(r){return r&&r.component&&r.component.isList()}function J4(r){return r&&r.component&&r.component.isSlider()}function Od(r){var t=r.event,e=t.target;return e&&(e==null?void 0:e.get("name"))==="mask"||cy(r)}function cy(r){var t;return((t=r.event.target)===null||t===void 0?void 0:t.get("name"))==="multi-mask"}function rA(r,t){var e=r.event.target;if(cy(r))return Rct(r,t);if(e.get("type")==="path"){var i=bct(r,t);return i?iN(r.view,i):void 0}var n=Y4(r,t);return n?hy(r.view,n):null}function Rct(r,t){var e=r.event.target;if(e.get("type")==="path"){var i=wct(r,t);return i.length>0?i.flatMap(function(a){return iN(r.view,a)}):null}var n=q4(r,t);return n.length>0?n.flatMap(function(a){return hy(r.view,a)}):null}function tN(r,t,e){if(cy(r))return Mct(r,t,e);var i=Y4(r,e);return i?eN(i,r,t):null}function eN(r,t,e){var i=t.view,n=Yx(i,e,{x:r.x,y:r.y}),a=Yx(i,e,{x:r.maxX,y:r.maxY}),o={minX:n.x,minY:n.y,maxX:a.x,maxY:a.y};return hy(e,o)}function Mct(r,t,e){var i=q4(r,e);return i.length>0?i.flatMap(function(n){return eN(n,r,t)}):null}function $r(r){var t=r.geometries,e=[];return I(t,function(i){var n=i.elements;e=e.concat(n)}),r.views&&r.views.length&&I(r.views,function(i){e=e.concat($r(i))}),e}function Ict(r,t,e){var i=$r(r);return i.filter(function(n){return Fa(n,t)===e})}function rN(r,t){var e=r.geometries,i=[];return I(e,function(n){var a=n.getElementsBy(function(o){return o.hasState(t)});i=i.concat(a)}),i}function Fa(r,t){var e=r.getModel(),i=e.data,n;return q(i)?n=i[0][t]:n=i[t],n}function Lct(r,t){return!(t.minX>r.maxX||t.maxX<r.minX||t.minY>r.maxY||t.maxY<r.minY)}function hy(r,t){var e=$r(r),i=[];return I(e,function(n){var a=n.shape,o=a.getCanvasBBox();Lct(t,o)&&i.push(n)}),i}function b3(r){var t=[];return I(r,function(e){var i=e[0];if(i!=="A")for(var n=1;n<e.length;n=n+2)t.push([e[n],e[n+1]]);else{var a=e.length;t.push([e[a-2],e[a-1]])}}),t}function iN(r,t){var e=$r(r),i=b3(t),n=e.filter(function(a){var o=a.shape,s;if(o.get("type")==="path")s=b3(o.attr("path"));else{var l=o.getCanvasBBox();s=qut(l)}return Tct(i,s)});return n}function nN(r){return r.getComponents().map(function(t){return t.component})}function iA(r,t){var e=t.x-r.x,i=t.y-r.y;return Math.sqrt(e*e+i*i)}function Oct(r,t){if(r.length<=2)return Gv(r,!1);var e=r[0],i=[];I(r,function(a){i.push(a.x),i.push(a.y)});var n=X4(i,t,null);return n.unshift(["M",e.x,e.y]),n}function w3(r,t){return r.x<=t.x&&r.maxX>=t.x&&r.y<=t.y&&r.maxY>t.y}function vo(r){var t=r.parent,e=null;return t&&(e=t.views.filter(function(i){return i!==r})),e}function Pct(r,t){var e=r.getCoordinate();return e.invert(t)}function Yx(r,t,e){var i=Pct(r,e);return t.getCoordinate().convert(i)}function aN(r,t,e,i){var n=!1;return I(r,function(a){if(a[e]===t[e]&&a[i]===t[i])return n=!0,!1}),n}function oh(r,t){var e=r.getScaleByField(t);return!e&&r.views&&I(r.views,function(i){if(e=oh(i,t),e)return!1}),e}var Fct=function(){function r(t){this.actions=[],this.event=null,this.cacheMap={},this.view=t}return r.prototype.cache=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(t.length===1)return this.cacheMap[t[0]];t.length===2&&(this.cacheMap[t[0]]=t[1])},r.prototype.getAction=function(t){return this.actions.find(function(e){return e.name===t})},r.prototype.addAction=function(t){this.actions.push(t)},r.prototype.removeAction=function(t){var e=this.actions,i=this.actions.indexOf(t);i>=0&&e.splice(i,1)},r.prototype.getCurrentPoint=function(){var t=this.event;if(t)if(t.target instanceof HTMLElement){var e=this.view.getCanvas(),i=e.getPointByClient(t.clientX,t.clientY);return i}else return{x:t.x,y:t.y};return null},r.prototype.getCurrentShape=function(){return P(this.event,["gEvent","shape"])},r.prototype.isInPlot=function(){var t=this.getCurrentPoint();return t?this.view.isPointInPlot(t):!1},r.prototype.isInShape=function(t){var e=this.getCurrentShape();return e?e.get("name")===t:!1},r.prototype.isInComponent=function(t){var e=nN(this.view),i=this.getCurrentPoint();return i?!!e.find(function(n){var a=n.getBBox();return t?n.get("name")===t&&w3(a,i):w3(a,i)}):!1},r.prototype.destroy=function(){I(this.actions.slice(),function(t){t.destroy()}),this.view=null,this.event=null,this.actions=null,this.cacheMap=null},r}(),Bct=function(){function r(t,e){this.view=t,this.cfg=e}return r.prototype.init=function(){this.initEvents()},r.prototype.initEvents=function(){},r.prototype.clearEvents=function(){},r.prototype.destroy=function(){this.clearEvents()},r}();function R3(r,t,e){var i=r.split(":"),n=i[0],a=t.getAction(n)||uct(n,t);if(!a)throw new Error("There is no action named ".concat(n));var o=i[1];return{action:a,methodName:o,arg:e}}function M3(r){var t=r.action,e=r.methodName,i=r.arg;if(t[e])t[e](i);else throw new Error("Action(".concat(t.name,") doesn't have a method called ").concat(e))}var pn={START:"start",SHOW_ENABLE:"showEnable",END:"end",ROLLBACK:"rollback",PROCESSING:"processing"},Dct=function(r){N(t,r);function t(e,i){var n=r.call(this,e,i)||this;return n.callbackCaches={},n.emitCaches={},n.steps=i,n}return t.prototype.init=function(){this.initContext(),r.prototype.init.call(this)},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.steps=null,this.context&&(this.context.destroy(),this.context=null),this.callbackCaches=null,this.view=null},t.prototype.initEvents=function(){var e=this;I(this.steps,function(i,n){I(i,function(a){var o=e.getActionCallback(n,a);o&&e.bindEvent(a.trigger,o)})})},t.prototype.clearEvents=function(){var e=this;I(this.steps,function(i,n){I(i,function(a){var o=e.getActionCallback(n,a);o&&e.offEvent(a.trigger,o)})})},t.prototype.initContext=function(){var e=this.view,i=new Fct(e);this.context=i;var n=this.steps;I(n,function(a){I(a,function(o){if(ot(o.action))o.actionObject={action:cct(o.action,i),methodName:"execute"};else if(mt(o.action))o.actionObject=R3(o.action,i,o.arg);else if(q(o.action)){var s=o.action,l=q(o.arg)?o.arg:[o.arg];o.actionObject=[],I(s,function(u,c){o.actionObject.push(R3(u,i,l[c]))})}})})},t.prototype.isAllowStep=function(e){var i=this.currentStepName,n=this.steps;if(i===e||e===pn.SHOW_ENABLE)return!0;if(e===pn.PROCESSING)return i===pn.START;if(e===pn.START)return i!==pn.PROCESSING;if(e===pn.END)return i===pn.PROCESSING||i===pn.START;if(e===pn.ROLLBACK){if(n[pn.END])return i===pn.END;if(i===pn.START)return!0}return!1},t.prototype.isAllowExecute=function(e,i){if(this.isAllowStep(e)){var n=this.getKey(e,i);return i.once&&this.emitCaches[n]?!1:i.isEnable?i.isEnable(this.context):!0}return!1},t.prototype.enterStep=function(e){this.currentStepName=e,this.emitCaches={}},t.prototype.afterExecute=function(e,i){e!==pn.SHOW_ENABLE&&this.currentStepName!==e&&this.enterStep(e);var n=this.getKey(e,i);this.emitCaches[n]=!0},t.prototype.getKey=function(e,i){return e+i.trigger+i.action},t.prototype.getActionCallback=function(e,i){var n=this,a=this.context,o=this.callbackCaches,s=i.actionObject;if(i.action&&s){var l=this.getKey(e,i);if(!o[l]){var u=function(c){a.event=c,n.isAllowExecute(e,i)?(q(s)?I(s,function(h){a.event=c,M3(h)}):(a.event=c,M3(s)),n.afterExecute(e,i),i.callback&&(a.event=c,i.callback(a))):a.event=null};i.debounce?o[l]=IS(u,i.debounce.wait,i.debounce.immediate):i.throttle?o[l]=Zm(u,i.throttle.wait,{leading:i.throttle.leading,trailing:i.throttle.trailing}):o[l]=u}return o[l]}return null},t.prototype.bindEvent=function(e,i){var n=e.split(":");n[0]==="window"?window.addEventListener(n[1],i):n[0]==="document"?document.addEventListener(n[1],i):this.view.on(e,i)},t.prototype.offEvent=function(e,i){var n=e.split(":");n[0]==="window"?window.removeEventListener(n[1],i):n[0]==="document"?document.removeEventListener(n[1],i):this.view.off(e,i)},t}(Bct),oN={};function Nct(r){return oN[hl(r)]}function Pt(r,t){oN[hl(r)]=t}function kct(r,t,e){var i=Nct(r);if(!i)return null;if(Ra(i)){var n=ne(Rr(i),e);return new Dct(t,n)}else{var a=i;return new a(t,e)}}function Uct(r){return{title:{autoRotate:!0,position:"center",spacing:r.axisTitleSpacing,style:{fill:r.axisTitleTextFillColor,fontSize:r.axisTitleTextFontSize,lineHeight:r.axisTitleTextLineHeight,textBaseline:"middle",fontFamily:r.fontFamily},iconStyle:{fill:r.axisDescriptionIconFillColor}},label:{autoRotate:!1,autoEllipsis:!1,autoHide:{type:"equidistance",cfg:{minGap:6}},offset:r.axisLabelOffset,style:{fill:r.axisLabelFillColor,fontSize:r.axisLabelFontSize,lineHeight:r.axisLabelLineHeight,fontFamily:r.fontFamily}},line:{style:{lineWidth:r.axisLineBorder,stroke:r.axisLineBorderColor}},grid:{line:{type:"line",style:{stroke:r.axisGridBorderColor,lineWidth:r.axisGridBorder,lineDash:r.axisGridLineDash}},alignTick:!0,animate:!0},tickLine:{style:{lineWidth:r.axisTickLineBorder,stroke:r.axisTickLineBorderColor},alignTick:!0,length:r.axisTickLineLength},subTickLine:null,animate:!0}}function zct(r){return{title:null,marker:{symbol:"circle",spacing:r.legendMarkerSpacing,style:{r:r.legendCircleMarkerSize,fill:r.legendMarkerColor}},itemName:{spacing:5,style:{fill:r.legendItemNameFillColor,fontFamily:r.fontFamily,fontSize:r.legendItemNameFontSize,lineHeight:r.legendItemNameLineHeight,fontWeight:r.legendItemNameFontWeight,textAlign:"start",textBaseline:"middle"}},itemStates:{active:{nameStyle:{opacity:.8}},unchecked:{nameStyle:{fill:"#D8D8D8"},markerStyle:{fill:"#D8D8D8",stroke:"#D8D8D8"}},inactive:{nameStyle:{fill:"#D8D8D8"},markerStyle:{opacity:.2}}},flipPage:!0,pageNavigator:{marker:{style:{size:r.legendPageNavigatorMarkerSize,inactiveFill:r.legendPageNavigatorMarkerInactiveFillColor,inactiveOpacity:r.legendPageNavigatorMarkerInactiveFillOpacity,fill:r.legendPageNavigatorMarkerFillColor,opacity:r.legendPageNavigatorMarkerFillOpacity}},text:{style:{fill:r.legendPageNavigatorTextFillColor,fontSize:r.legendPageNavigatorTextFontSize}}},animate:!1,maxItemWidth:200,itemSpacing:r.legendItemSpacing,itemMarginBottom:r.legendItemMarginBottom,padding:r.legendPadding}}function sN(r){var t,e={point:{default:{fill:r.pointFillColor,r:r.pointSize,stroke:r.pointBorderColor,lineWidth:r.pointBorder,fillOpacity:r.pointFillOpacity},active:{stroke:r.pointActiveBorderColor,lineWidth:r.pointActiveBorder},selected:{stroke:r.pointSelectedBorderColor,lineWidth:r.pointSelectedBorder},inactive:{fillOpacity:r.pointInactiveFillOpacity,strokeOpacity:r.pointInactiveBorderOpacity}},hollowPoint:{default:{fill:r.hollowPointFillColor,lineWidth:r.hollowPointBorder,stroke:r.hollowPointBorderColor,strokeOpacity:r.hollowPointBorderOpacity,r:r.hollowPointSize},active:{stroke:r.hollowPointActiveBorderColor,strokeOpacity:r.hollowPointActiveBorderOpacity},selected:{lineWidth:r.hollowPointSelectedBorder,stroke:r.hollowPointSelectedBorderColor,strokeOpacity:r.hollowPointSelectedBorderOpacity},inactive:{strokeOpacity:r.hollowPointInactiveBorderOpacity}},area:{default:{fill:r.areaFillColor,fillOpacity:r.areaFillOpacity,stroke:null},active:{fillOpacity:r.areaActiveFillOpacity},selected:{fillOpacity:r.areaSelectedFillOpacity},inactive:{fillOpacity:r.areaInactiveFillOpacity}},hollowArea:{default:{fill:null,stroke:r.hollowAreaBorderColor,lineWidth:r.hollowAreaBorder,strokeOpacity:r.hollowAreaBorderOpacity},active:{fill:null,lineWidth:r.hollowAreaActiveBorder},selected:{fill:null,lineWidth:r.hollowAreaSelectedBorder},inactive:{strokeOpacity:r.hollowAreaInactiveBorderOpacity}},interval:{default:{fill:r.intervalFillColor,fillOpacity:r.intervalFillOpacity},active:{stroke:r.intervalActiveBorderColor,lineWidth:r.intervalActiveBorder},selected:{stroke:r.intervalSelectedBorderColor,lineWidth:r.intervalSelectedBorder},inactive:{fillOpacity:r.intervalInactiveFillOpacity,strokeOpacity:r.intervalInactiveBorderOpacity}},hollowInterval:{default:{fill:r.hollowIntervalFillColor,stroke:r.hollowIntervalBorderColor,lineWidth:r.hollowIntervalBorder,strokeOpacity:r.hollowIntervalBorderOpacity},active:{stroke:r.hollowIntervalActiveBorderColor,lineWidth:r.hollowIntervalActiveBorder,strokeOpacity:r.hollowIntervalActiveBorderOpacity},selected:{stroke:r.hollowIntervalSelectedBorderColor,lineWidth:r.hollowIntervalSelectedBorder,strokeOpacity:r.hollowIntervalSelectedBorderOpacity},inactive:{stroke:r.hollowIntervalInactiveBorderColor,lineWidth:r.hollowIntervalInactiveBorder,strokeOpacity:r.hollowIntervalInactiveBorderOpacity}},line:{default:{stroke:r.lineBorderColor,lineWidth:r.lineBorder,strokeOpacity:r.lineBorderOpacity,fill:null,lineAppendWidth:10,lineCap:"round",lineJoin:"round"},active:{lineWidth:r.lineActiveBorder},selected:{lineWidth:r.lineSelectedBorder},inactive:{strokeOpacity:r.lineInactiveBorderOpacity}}},i=Uct(r),n=zct(r);return{background:r.backgroundColor,defaultColor:r.brandColor,subColor:r.subColor,semanticRed:r.paletteSemanticRed,semanticGreen:r.paletteSemanticGreen,padding:"auto",fontFamily:r.fontFamily,columnWidthRatio:1/2,maxColumnWidth:null,minColumnWidth:null,roseWidthRatio:.9999999,multiplePieWidthRatio:1/1.3,colors10:r.paletteQualitative10,colors20:r.paletteQualitative20,sequenceColors:r.paletteSequence,shapes:{point:["hollow-circle","hollow-square","hollow-bowtie","hollow-diamond","hollow-hexagon","hollow-triangle","hollow-triangle-down","circle","square","bowtie","diamond","hexagon","triangle","triangle-down","cross","tick","plus","hyphen","line"],line:["line","dash","dot","smooth"],area:["area","smooth","line","smooth-line"],interval:["rect","hollow-rect","line","tick"]},sizes:[1,10],geometries:{interval:{rect:{default:{style:e.interval.default},active:{style:e.interval.active},inactive:{style:e.interval.inactive},selected:{style:function(a){var o=a.geometry.coordinate;if(o.isPolar&&o.isTransposed){var s=Md(a.getModel(),o),l=s.startAngle,u=s.endAngle,c=(l+u)/2,h=7.5,f=h*Math.cos(c),d=h*Math.sin(c);return{matrix:dr(null,[["t",f,d]])}}return e.interval.selected}}},"hollow-rect":{default:{style:e.hollowInterval.default},active:{style:e.hollowInterval.active},inactive:{style:e.hollowInterval.inactive},selected:{style:e.hollowInterval.selected}},line:{default:{style:e.hollowInterval.default},active:{style:e.hollowInterval.active},inactive:{style:e.hollowInterval.inactive},selected:{style:e.hollowInterval.selected}},tick:{default:{style:e.hollowInterval.default},active:{style:e.hollowInterval.active},inactive:{style:e.hollowInterval.inactive},selected:{style:e.hollowInterval.selected}},funnel:{default:{style:e.interval.default},active:{style:e.interval.active},inactive:{style:e.interval.inactive},selected:{style:e.interval.selected}},pyramid:{default:{style:e.interval.default},active:{style:e.interval.active},inactive:{style:e.interval.inactive},selected:{style:e.interval.selected}}},line:{line:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},dot:{default:{style:S(S({},e.line.default),{lineCap:null,lineDash:[1,1]})},active:{style:S(S({},e.line.active),{lineCap:null,lineDash:[1,1]})},inactive:{style:S(S({},e.line.inactive),{lineCap:null,lineDash:[1,1]})},selected:{style:S(S({},e.line.selected),{lineCap:null,lineDash:[1,1]})}},dash:{default:{style:S(S({},e.line.default),{lineCap:null,lineDash:[5.5,1]})},active:{style:S(S({},e.line.active),{lineCap:null,lineDash:[5.5,1]})},inactive:{style:S(S({},e.line.inactive),{lineCap:null,lineDash:[5.5,1]})},selected:{style:S(S({},e.line.selected),{lineCap:null,lineDash:[5.5,1]})}},smooth:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},hv:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},vh:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},hvh:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},vhv:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}}},polygon:{polygon:{default:{style:e.interval.default},active:{style:e.interval.active},inactive:{style:e.interval.inactive},selected:{style:e.interval.selected}}},point:{circle:{default:{style:e.point.default},active:{style:e.point.active},inactive:{style:e.point.inactive},selected:{style:e.point.selected}},square:{default:{style:e.point.default},active:{style:e.point.active},inactive:{style:e.point.inactive},selected:{style:e.point.selected}},bowtie:{default:{style:e.point.default},active:{style:e.point.active},inactive:{style:e.point.inactive},selected:{style:e.point.selected}},diamond:{default:{style:e.point.default},active:{style:e.point.active},inactive:{style:e.point.inactive},selected:{style:e.point.selected}},hexagon:{default:{style:e.point.default},active:{style:e.point.active},inactive:{style:e.point.inactive},selected:{style:e.point.selected}},triangle:{default:{style:e.point.default},active:{style:e.point.active},inactive:{style:e.point.inactive},selected:{style:e.point.selected}},"triangle-down":{default:{style:e.point.default},active:{style:e.point.active},inactive:{style:e.point.inactive},selected:{style:e.point.selected}},"hollow-circle":{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},"hollow-square":{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},"hollow-bowtie":{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},"hollow-diamond":{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},"hollow-hexagon":{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},"hollow-triangle":{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},"hollow-triangle-down":{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},cross:{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},tick:{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},plus:{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},hyphen:{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},line:{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}}},area:{area:{default:{style:e.area.default},active:{style:e.area.active},inactive:{style:e.area.inactive},selected:{style:e.area.selected}},smooth:{default:{style:e.area.default},active:{style:e.area.active},inactive:{style:e.area.inactive},selected:{style:e.area.selected}},line:{default:{style:e.hollowArea.default},active:{style:e.hollowArea.active},inactive:{style:e.hollowArea.inactive},selected:{style:e.hollowArea.selected}},"smooth-line":{default:{style:e.hollowArea.default},active:{style:e.hollowArea.active},inactive:{style:e.hollowArea.inactive},selected:{style:e.hollowArea.selected}}},schema:{candle:{default:{style:e.hollowInterval.default},active:{style:e.hollowInterval.active},inactive:{style:e.hollowInterval.inactive},selected:{style:e.hollowInterval.selected}},box:{default:{style:e.hollowInterval.default},active:{style:e.hollowInterval.active},inactive:{style:e.hollowInterval.inactive},selected:{style:e.hollowInterval.selected}}},edge:{line:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},vhv:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},smooth:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},arc:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}}},violin:{violin:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},smooth:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},hollow:{default:{style:e.hollowArea.default},active:{style:e.hollowArea.active},inactive:{style:e.hollowArea.inactive},selected:{style:e.hollowArea.selected}},"hollow-smooth":{default:{style:e.hollowArea.default},active:{style:e.hollowArea.active},inactive:{style:e.hollowArea.inactive},selected:{style:e.hollowArea.selected}}}},components:{axis:{common:i,top:{position:"top",grid:null,title:null,verticalLimitLength:1/2},bottom:{position:"bottom",grid:null,title:null,verticalLimitLength:1/2},left:{position:"left",title:null,line:null,tickLine:null,verticalLimitLength:1/3},right:{position:"right",title:null,line:null,tickLine:null,verticalLimitLength:1/3},circle:{title:null,grid:at({},i.grid,{line:{type:"line"}})},radius:{title:null,grid:at({},i.grid,{line:{type:"circle"}})}},legend:{common:n,right:{layout:"vertical",padding:r.legendVerticalPadding},left:{layout:"vertical",padding:r.legendVerticalPadding},top:{layout:"horizontal",padding:r.legendHorizontalPadding},bottom:{layout:"horizontal",padding:r.legendHorizontalPadding},continuous:{title:null,background:null,track:{},rail:{type:"color",size:r.sliderRailHeight,defaultLength:r.sliderRailWidth,style:{fill:r.sliderRailFillColor,stroke:r.sliderRailBorderColor,lineWidth:r.sliderRailBorder}},label:{align:"rail",spacing:4,formatter:null,style:{fill:r.sliderLabelTextFillColor,fontSize:r.sliderLabelTextFontSize,lineHeight:r.sliderLabelTextLineHeight,textBaseline:"middle",fontFamily:r.fontFamily}},handler:{size:r.sliderHandlerWidth,style:{fill:r.sliderHandlerFillColor,stroke:r.sliderHandlerBorderColor}},slidable:!0,padding:n.padding}},tooltip:{showContent:!0,follow:!0,showCrosshairs:!1,showMarkers:!0,shared:!1,enterable:!1,position:"auto",marker:{symbol:"circle",stroke:"#fff",shadowBlur:10,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(0,0,0,0.09)",lineWidth:2,r:4},crosshairs:{line:{style:{stroke:r.tooltipCrosshairsBorderColor,lineWidth:r.tooltipCrosshairsBorder}},text:null,textBackground:{padding:2,style:{fill:"rgba(0, 0, 0, 0.25)",lineWidth:0,stroke:null}},follow:!1},domStyles:(t={},t["".concat(ss)]={position:"absolute",visibility:"hidden",zIndex:8,transition:"left 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s, top 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s",backgroundColor:r.tooltipContainerFillColor,opacity:r.tooltipContainerFillOpacity,boxShadow:r.tooltipContainerShadow,borderRadius:"".concat(r.tooltipContainerBorderRadius,"px"),color:r.tooltipTextFillColor,fontSize:"".concat(r.tooltipTextFontSize,"px"),fontFamily:r.fontFamily,lineHeight:"".concat(r.tooltipTextLineHeight,"px"),padding:"0 12px 0 12px"},t["".concat(ls)]={marginBottom:"12px",marginTop:"12px"},t["".concat(Rd)]={margin:0,listStyleType:"none",padding:0},t["".concat(ny)]={listStyleType:"none",padding:0,marginBottom:"12px",marginTop:"12px",marginLeft:0,marginRight:0},t["".concat(ay)]={width:"8px",height:"8px",borderRadius:"50%",display:"inline-block",marginRight:"8px"},t["".concat(oy)]={display:"inline-block",float:"right",marginLeft:"30px"},t)},annotation:{arc:{style:{stroke:r.annotationArcBorderColor,lineWidth:r.annotationArcBorder},animate:!0},line:{style:{stroke:r.annotationLineBorderColor,lineDash:r.annotationLineDash,lineWidth:r.annotationLineBorder},text:{position:"start",autoRotate:!0,style:{fill:r.annotationTextFillColor,stroke:r.annotationTextBorderColor,lineWidth:r.annotationTextBorder,fontSize:r.annotationTextFontSize,textAlign:"start",fontFamily:r.fontFamily,textBaseline:"bottom"}},animate:!0},text:{style:{fill:r.annotationTextFillColor,stroke:r.annotationTextBorderColor,lineWidth:r.annotationTextBorder,fontSize:r.annotationTextFontSize,textBaseline:"middle",textAlign:"start",fontFamily:r.fontFamily},animate:!0},region:{top:!1,style:{lineWidth:r.annotationRegionBorder,stroke:r.annotationRegionBorderColor,fill:r.annotationRegionFillColor,fillOpacity:r.annotationRegionFillOpacity},animate:!0},image:{top:!1,animate:!0},dataMarker:{top:!0,point:{style:{r:3,stroke:r.brandColor,lineWidth:2}},line:{style:{stroke:r.annotationLineBorderColor,lineWidth:r.annotationLineBorder},length:r.annotationDataMarkerLineLength},text:{style:{textAlign:"start",fill:r.annotationTextFillColor,stroke:r.annotationTextBorderColor,lineWidth:r.annotationTextBorder,fontSize:r.annotationTextFontSize,fontFamily:r.fontFamily}},direction:"upward",autoAdjust:!0,animate:!0},dataRegion:{style:{region:{fill:r.annotationRegionFillColor,fillOpacity:r.annotationRegionFillOpacity},text:{textAlign:"center",textBaseline:"bottom",fill:r.annotationTextFillColor,stroke:r.annotationTextBorderColor,lineWidth:r.annotationTextBorder,fontSize:r.annotationTextFontSize,fontFamily:r.fontFamily}},animate:!0}},slider:{common:{padding:[8,8,8,8],backgroundStyle:{fill:r.cSliderBackgroundFillColor,opacity:r.cSliderBackgroundFillOpacity},foregroundStyle:{fill:r.cSliderForegroundFillColor,opacity:r.cSliderForegroundFillOpacity},handlerStyle:{width:r.cSliderHandlerWidth,height:r.cSliderHandlerHeight,fill:r.cSliderHandlerFillColor,opacity:r.cSliderHandlerFillOpacity,stroke:r.cSliderHandlerBorderColor,lineWidth:r.cSliderHandlerBorder,radius:r.cSliderHandlerBorderRadius,highLightFill:r.cSliderHandlerHighlightFillColor},textStyle:{fill:r.cSliderTextFillColor,opacity:r.cSliderTextFillOpacity,fontSize:r.cSliderTextFontSize,lineHeight:r.cSliderTextLineHeight,fontWeight:r.cSliderTextFontWeight,stroke:r.cSliderTextBorderColor,lineWidth:r.cSliderTextBorder}}},scrollbar:{common:{padding:[8,8,8,8]},default:{style:{trackColor:r.scrollbarTrackFillColor,thumbColor:r.scrollbarThumbFillColor}},hover:{style:{thumbColor:r.scrollbarThumbHighlightFillColor}}}},labels:{offset:12,style:{fill:r.labelFillColor,fontSize:r.labelFontSize,fontFamily:r.fontFamily,stroke:r.labelBorderColor,lineWidth:r.labelBorder},fillColorDark:r.labelFillColorDark,fillColorLight:r.labelFillColorLight,autoRotate:!0},innerLabels:{style:{fill:r.innerLabelFillColor,fontSize:r.innerLabelFontSize,fontFamily:r.fontFamily,stroke:r.innerLabelBorderColor,lineWidth:r.innerLabelBorder},autoRotate:!0},overflowLabels:{style:{fill:r.overflowLabelFillColor,fontSize:r.overflowLabelFontSize,fontFamily:r.fontFamily,stroke:r.overflowLabelBorderColor,lineWidth:r.overflowLabelBorder}},pieLabels:{labelHeight:14,offset:10,labelLine:{style:{lineWidth:r.labelLineBorder}},autoRotate:!0}}}var pe={100:"#000",95:"#0D0D0D",85:"#262626",65:"#595959",45:"#8C8C8C",25:"#BFBFBF",15:"#D9D9D9",6:"#F0F0F0"},oc={100:"#FFFFFF",95:"#F2F2F2",85:"#D9D9D9",65:"#A6A6A6",45:"#737373",25:"#404040",15:"#262626",6:"#0F0F0F"},Hct=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#6F5EF9","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],$ct=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#6F5EF9","#D3CEFD","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],Wct=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"],lN=function(r){r===void 0&&(r={});var t=r.paletteQualitative10,e=t===void 0?Hct:t,i=r.paletteQualitative20,n=i===void 0?$ct:i,a=r.brandColor,o=a===void 0?e[0]:a,s={backgroundColor:"transparent",brandColor:o,subColor:"rgba(0,0,0,0.05)",paletteQualitative10:e,paletteQualitative20:n,paletteSemanticRed:"#F4664A",paletteSemanticGreen:"#30BF78",paletteSemanticYellow:"#FAAD14",paletteSequence:Wct,fontFamily:`"Segoe UI", Roboto, "Helvetica Neue", Arial,
    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
    "Noto Color Emoji"`,axisLineBorderColor:pe[25],axisLineBorder:1,axisLineDash:null,axisTitleTextFillColor:pe[65],axisTitleTextFontSize:12,axisTitleTextLineHeight:12,axisTitleTextFontWeight:"normal",axisTitleSpacing:12,axisDescriptionIconFillColor:oc[85],axisTickLineBorderColor:pe[25],axisTickLineLength:4,axisTickLineBorder:1,axisSubTickLineBorderColor:pe[15],axisSubTickLineLength:2,axisSubTickLineBorder:1,axisLabelFillColor:pe[45],axisLabelFontSize:12,axisLabelLineHeight:12,axisLabelFontWeight:"normal",axisLabelOffset:8,axisGridBorderColor:pe[15],axisGridBorder:1,axisGridLineDash:null,legendTitleTextFillColor:pe[45],legendTitleTextFontSize:12,legendTitleTextLineHeight:21,legendTitleTextFontWeight:"normal",legendMarkerColor:o,legendMarkerSpacing:8,legendMarkerSize:4,legendCircleMarkerSize:4,legendSquareMarkerSize:4,legendLineMarkerSize:5,legendItemNameFillColor:pe[65],legendItemNameFontSize:12,legendItemNameLineHeight:12,legendItemNameFontWeight:"normal",legendItemSpacing:24,legendItemMarginBottom:12,legendPadding:[8,8,8,8],legendHorizontalPadding:[8,0,8,0],legendVerticalPadding:[0,8,0,8],legendPageNavigatorMarkerSize:12,legendPageNavigatorMarkerInactiveFillColor:pe[100],legendPageNavigatorMarkerInactiveFillOpacity:.45,legendPageNavigatorMarkerFillColor:pe[100],legendPageNavigatorMarkerFillOpacity:1,legendPageNavigatorTextFillColor:pe[45],legendPageNavigatorTextFontSize:12,sliderRailFillColor:pe[15],sliderRailBorder:0,sliderRailBorderColor:null,sliderRailWidth:100,sliderRailHeight:12,sliderLabelTextFillColor:pe[45],sliderLabelTextFontSize:12,sliderLabelTextLineHeight:12,sliderLabelTextFontWeight:"normal",sliderHandlerFillColor:pe[6],sliderHandlerWidth:10,sliderHandlerHeight:14,sliderHandlerBorder:1,sliderHandlerBorderColor:pe[25],annotationArcBorderColor:pe[15],annotationArcBorder:1,annotationLineBorderColor:pe[25],annotationLineBorder:1,annotationLineDash:null,annotationTextFillColor:pe[65],annotationTextFontSize:12,annotationTextLineHeight:12,annotationTextFontWeight:"normal",annotationTextBorderColor:null,annotationTextBorder:0,annotationRegionFillColor:pe[100],annotationRegionFillOpacity:.06,annotationRegionBorder:0,annotationRegionBorderColor:null,annotationDataMarkerLineLength:16,tooltipCrosshairsBorderColor:pe[25],tooltipCrosshairsBorder:1,tooltipCrosshairsLineDash:null,tooltipContainerFillColor:"rgb(255, 255, 255)",tooltipContainerFillOpacity:.95,tooltipContainerShadow:"0px 0px 10px #aeaeae",tooltipContainerBorderRadius:3,tooltipTextFillColor:pe[65],tooltipTextFontSize:12,tooltipTextLineHeight:12,tooltipTextFontWeight:"bold",labelFillColor:pe[65],labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,labelLineHeight:12,labelFontWeight:"normal",labelBorderColor:null,labelBorder:0,innerLabelFillColor:oc[100],innerLabelFontSize:12,innerLabelLineHeight:12,innerLabelFontWeight:"normal",innerLabelBorderColor:null,innerLabelBorder:0,overflowLabelFillColor:pe[65],overflowLabelFontSize:12,overflowLabelLineHeight:12,overflowLabelFontWeight:"normal",overflowLabelBorderColor:oc[100],overflowLabelBorder:1,labelLineBorder:1,labelLineBorderColor:pe[25],cSliderRailHieght:16,cSliderBackgroundFillColor:"#416180",cSliderBackgroundFillOpacity:.05,cSliderForegroundFillColor:"#5B8FF9",cSliderForegroundFillOpacity:.15,cSliderHandlerHeight:24,cSliderHandlerWidth:10,cSliderHandlerFillColor:"#F7F7F7",cSliderHandlerFillOpacity:1,cSliderHandlerHighlightFillColor:"#FFF",cSliderHandlerBorderColor:"#BFBFBF",cSliderHandlerBorder:1,cSliderHandlerBorderRadius:2,cSliderTextFillColor:"#000",cSliderTextFillOpacity:.45,cSliderTextFontSize:12,cSliderTextLineHeight:12,cSliderTextFontWeight:"normal",cSliderTextBorderColor:null,cSliderTextBorder:0,scrollbarTrackFillColor:"rgba(0,0,0,0)",scrollbarThumbFillColor:"rgba(0,0,0,0.15)",scrollbarThumbHighlightFillColor:"rgba(0,0,0,0.2)",pointFillColor:o,pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:oc[100],pointBorderOpacity:1,pointActiveBorderColor:pe[100],pointSelectedBorder:2,pointSelectedBorderColor:pe[100],pointInactiveFillOpacity:.3,pointInactiveBorderOpacity:.3,hollowPointSize:4,hollowPointBorder:1,hollowPointBorderColor:o,hollowPointBorderOpacity:.95,hollowPointFillColor:oc[100],hollowPointActiveBorder:1,hollowPointActiveBorderColor:pe[100],hollowPointActiveBorderOpacity:1,hollowPointSelectedBorder:2,hollowPointSelectedBorderColor:pe[100],hollowPointSelectedBorderOpacity:1,hollowPointInactiveBorderOpacity:.3,lineBorder:2,lineBorderColor:o,lineBorderOpacity:1,lineActiveBorder:3,lineSelectedBorder:3,lineInactiveBorderOpacity:.3,areaFillColor:o,areaFillOpacity:.25,areaActiveFillColor:o,areaActiveFillOpacity:.5,areaSelectedFillColor:o,areaSelectedFillOpacity:.5,areaInactiveFillOpacity:.3,hollowAreaBorderColor:o,hollowAreaBorder:2,hollowAreaBorderOpacity:1,hollowAreaActiveBorder:3,hollowAreaActiveBorderColor:pe[100],hollowAreaSelectedBorder:3,hollowAreaSelectedBorderColor:pe[100],hollowAreaInactiveBorderOpacity:.3,intervalFillColor:o,intervalFillOpacity:.95,intervalActiveBorder:1,intervalActiveBorderColor:pe[100],intervalActiveBorderOpacity:1,intervalSelectedBorder:2,intervalSelectedBorderColor:pe[100],intervalSelectedBorderOpacity:1,intervalInactiveBorderOpacity:.3,intervalInactiveFillOpacity:.3,hollowIntervalBorder:2,hollowIntervalBorderColor:o,hollowIntervalBorderOpacity:1,hollowIntervalFillColor:oc[100],hollowIntervalActiveBorder:2,hollowIntervalActiveBorderColor:pe[100],hollowIntervalSelectedBorder:3,hollowIntervalSelectedBorderColor:pe[100],hollowIntervalSelectedBorderOpacity:1,hollowIntervalInactiveBorderOpacity:.3};return S(S({},s),r)};lN();function Z0(r){var t=r.styleSheet,e=t===void 0?{}:t,i=zt(r,["styleSheet"]),n=lN(e);return at({},sN(n),i)}var Vct=Z0({}),jx={default:Vct};function rd(r){return P(jx,hl(r),jx.default)}function Gct(r,t){jx[hl(r)]=Z0(t)}function I3(r,t,e){var i=e.translate(r),n=e.translate(t);return wr(i,n)}function Xct(r,t){var e=t.coordinate,i=t.getXScale(),n=i.range,a=n[n.length-1],o=n[0],s=e.invert(r),l=s.x;return e.isPolar&&l>(1+a)/2&&(l=o),i.translate(i.invert(l))}function L3(r,t,e){var i=e.coordinate,n=e.getYScale(),a=n.field,o=i.invert(t),s=n.invert(o.y),l=Qn(r,function(u){var c=u[Se];return c[a][0]<=s&&c[a][1]>=s});return l||r[r.length-1]}var Yct=Nu(function(r){if(r.isCategory)return 1;for(var t=r.values,e=t.length,i=r.translate(t[0]),n=i,a=0;a<e;a++){var o=t[a],s=r.translate(o);s<i&&(i=s),s>n&&(n=s)}return(n-i)/(e-1)});function jct(r,t,e){var i=t.getAttribute("position"),n=i.getFields(),a=t.scales,o=ot(e)||!e?n[0]:e,s=a[o],l=s?s.getText(r[o]):r[o]||o;return ot(e)?e(l,r):l}function Zct(r){var t=wh(r.attributes);return Fr(t,function(e){return io(Cc,e.type)})}function uN(r){var t,e,i=Zct(r),n;try{for(var a=Qt(i),o=a.next();!o.done;o=a.next()){var s=o.value,l=s.getScale(s.type);if(l&&l.isLinear){var u=P(r.scaleDefs,l.field),c=H4(l,u,s.type,r.type);if(c!=="cat"){n=l;break}}}}catch(d){t={error:d}}finally{try{o&&!o.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}var h=r.getXScale(),f=r.getYScale();return n||f||h}function qct(r,t){var e=t.field,i=r[e];if(q(i)){var n=i.map(function(a){return t.getText(a)});return n.join("-")}return t.getText(i)}function Kct(r,t){var e,i=t.getGroupScales();if(i.length&&(e=i[0]),e){var n=e.field;return e.getText(r[n])}var a=uN(t);return Id(a)}function cN(r,t,e){if(t.length===0)return null;var i=e.type,n=e.getXScale(),a=e.getYScale(),o=n.field,s=a.field,l=null;if(i==="heatmap"||i==="point"){for(var u=e.coordinate,c=u.invert(r),h=n.invert(c.x),f=a.invert(c.y),d=1/0,v=0;v<t.length;v++){var p=t[v],g=p[Se],m=Math.pow(g[o]-h,2)+Math.pow(g[s]-f,2);m<d&&(d=m,l=p)}return l}var y=t[0],_=t[t.length-1],x=Xct(r,e),C=y[Se][o],A=y[Se][s],b=_[Se][o],R=a.isLinear&&q(A);if(q(C)){for(var v=0;v<t.length;v++){var M=t[v],g=M[Se];if(n.translate(g[o][0])<=x&&n.translate(g[o][1])>=x)if(R)q(l)||(l=[]),l.push(M);else{l=M;break}}q(l)&&(l=L3(l,r,e))}else{var O=void 0;if(!n.isLinear&&n.type!=="timeCat"){for(var v=0;v<t.length;v++){var M=t[v],g=M[Se];if(I3(g[o],x,n))if(R)q(l)||(l=[]),l.push(M);else{l=M;break}else n.translate(g[o])<=x&&(_=M,O=t[v+1])}q(l)&&(l=L3(l,r,e))}else{if((x>n.translate(b)||x<n.translate(C))&&(x>n.max||x<n.min))return null;for(var F=0,D=t.length-1,H=void 0;F<=D;){H=Math.floor((F+D)/2);var j=t[H][Se][o];if(I3(j,x,n))return t[H];n.translate(j)<=n.translate(x)?(F=H+1,_=t[H],O=t[H+1]):(D===0&&(_=t[0]),D=H-1)}}_&&O&&Math.abs(n.translate(_[Se][o])-x)>Math.abs(n.translate(O[Se][o])-x)&&(_=O)}var $=Yct(e.getXScale());return!l&&Math.abs(n.translate(_[Se][o])-x)<=$/2&&(l=_),l}function nA(r,t,e,i){var n,a;e===void 0&&(e=""),i===void 0&&(i=!1);var o=r[Se],s=jct(o,t,e),l=t.tooltipOption,u=t.theme.defaultColor,c=[],h,f;function d(M,O){if(i||!K(O)&&O!==""){var F={title:s,data:o,mappingData:r,name:M,value:O,color:r.color||u,marker:!0};c.push(F)}}if(ie(l)){var v=l.fields,p=l.callback;if(p){var g=v.map(function(M){return r[Se][M]}),m=p.apply(void 0,xt([],ct(g),!1)),y=S({data:r[Se],mappingData:r,title:s,color:r.color||u,marker:!0},m);c.push(y)}else{var _=t.scales;try{for(var x=Qt(v),C=x.next();!C.done;C=x.next()){var A=C.value;if(!K(o[A])){var b=_[A];h=Id(b),f=b.getText(o[A]),d(h,f)}}}catch(M){n={error:M}}finally{try{C&&!C.done&&(a=x.return)&&a.call(x)}finally{if(n)throw n.error}}}}else{var R=uN(t);f=qct(o,R),h=Kct(o,t),d(h,f)}return c}function O3(r,t,e,i){var n,a,o=i.showNil,s=[],l=r.dataArray;if(!Mi(l)){r.sort(l);try{for(var u=Qt(l),c=u.next();!c.done;c=u.next()){var h=c.value,f=cN(t,h,r);if(f){var d=r.getElementId(f),v=r.elementsMap[d];if(r.type==="heatmap"||v.visible){var p=nA(f,r,e,o);p.length&&s.push(p)}}}}catch(g){n={error:g}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}}return s}function P3(r,t,e,i){var n=i.showNil,a=[],o=r.container,s=o.getShape(t.x,t.y);if(s&&s.get("visible")&&s.get("origin")){var l=s.get("origin").mappingData,u=nA(l,r,e,n);u.length&&a.push(u)}return a}function Zx(r,t,e){var i,n,a=[],o=r.geometries,s=e.shared,l=e.title,u=e.reversed;try{for(var c=Qt(o),h=c.next();!h.done;h=c.next()){var f=h.value;if(f.visible&&f.tooltipOption!==!1){var d=f.type,v=void 0;["point","edge","polygon"].includes(d)?v=P3(f,t,l,e):["area","line","path","heatmap"].includes(d)||s!==!1?v=O3(f,t,l,e):v=P3(f,t,l,e),v.length&&(u&&v.reverse(),a.push(v))}}}catch(p){i={error:p}}finally{try{h&&!h.done&&(n=c.return)&&n.call(c)}finally{if(i)throw i.error}}return a}function Qct(r,t,e){var i,n,a=Zx(r,t,e);try{for(var o=Qt(r.views),s=o.next();!s.done;s=o.next()){var l=s.value;a=a.concat(Zx(l,t,e))}}catch(u){i={error:u}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function Jct(r){return!Tt(r)&&!q(r)}function aA(r){r===void 0&&(r=0);var t=q(r)?r:[r];switch(t.length){case 0:t=[0,0,0,0];break;case 1:t=new Array(4).fill(t[0]);break;case 2:t=xt(xt([],ct(t),!1),ct(t),!1);break;case 3:t=xt(xt([],ct(t),!1),[t[1]],!1);break;default:t=t.slice(0,4);break}return t}var oA={};function Uu(r,t){oA[r]=t}function tht(){return Object.keys(oA)}function eht(r){return oA[r]}var rht=function(){function r(t){this.option=this.wrapperOption(t)}return r.prototype.update=function(t){return this.option=this.wrapperOption(t),this},r.prototype.hasAction=function(t){var e=this.option.actions;return Tv(e,function(i){return i[0]===t})},r.prototype.create=function(t,e){var i=this.option,n=i.type,a=i.cfg,o=n==="theta",s=S({start:t,end:e},a),l=f4(o?"polar":n);return this.coordinate=new l(s),this.coordinate.type=n,o&&(this.hasAction("transpose")||this.transpose()),this.execActions(),this.coordinate},r.prototype.adjust=function(t,e){return this.coordinate.update({start:t,end:e}),this.coordinate.resetMatrix(),this.execActions(["scale","rotate","translate"]),this.coordinate},r.prototype.rotate=function(t){return this.option.actions.push(["rotate",t]),this},r.prototype.reflect=function(t){return this.option.actions.push(["reflect",t]),this},r.prototype.scale=function(t,e){return this.option.actions.push(["scale",t,e]),this},r.prototype.transpose=function(){return this.option.actions.push(["transpose"]),this},r.prototype.getOption=function(){return this.option},r.prototype.getCoordinate=function(){return this.coordinate},r.prototype.wrapperOption=function(t){return S({type:"rect",actions:[],cfg:{}},t)},r.prototype.execActions=function(t){var e=this,i=this.option.actions;I(i,function(n){var a,o=ct(n),s=o[0],l=o.slice(1),u=K(t)?!0:t.includes(s);u&&(a=e.coordinate)[s].apply(a,xt([],ct(l),!1))})},r}(),$e=function(){function r(t,e,i){this.view=t,this.gEvent=e,this.data=i,this.type=e.type}return r.fromData=function(t,e,i){return new r(t,new Rh(e,{}),i)},Object.defineProperty(r.prototype,"target",{get:function(){return this.gEvent.target},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"event",{get:function(){return this.gEvent.originalEvent},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"x",{get:function(){return this.gEvent.x},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this.gEvent.y},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"clientX",{get:function(){return this.gEvent.clientX},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"clientY",{get:function(){return this.gEvent.clientY},enumerable:!1,configurable:!0}),r.prototype.toString=function(){return"[Event (type=".concat(this.type,")]")},r.prototype.clone=function(){return new r(this.view,this.gEvent,this.data)},r}();function iht(r){var t=r.getController("axis"),e=r.getController("legend"),i=r.getController("annotation"),n=r.getController("slider"),a=r.getController("scrollbar");[t,n,a,e,i].forEach(function(o){o&&o.layout()})}var nht=function(){function r(){this.scales=new Map,this.syncScales=new Map}return r.prototype.createScale=function(t,e,i,n){var a=i,o=this.getScaleMeta(n);if(e.length===0&&o){var s=o.scale,l={type:s.type};s.isCategory&&(l.values=s.values),a=at(l,o.scaleDef,i)}var u=rct(t,e,a);return this.cacheScale(u,i,n),u},r.prototype.sync=function(t,e){var i=this;this.syncScales.forEach(function(n,a){var o=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER,l=[];I(n,function(u){var c=i.getScale(u);s=Tt(c.max)?Math.max(s,c.max):s,o=Tt(c.min)?Math.min(o,c.min):o,I(c.values,function(h){l.includes(h)||l.push(h)})}),I(n,function(u){var c=i.getScale(u);if(c.isContinuous)c.change({min:o,max:s,values:l});else if(c.isCategory){var h=c.range,f=i.getScaleMeta(u);l&&!P(f,["scaleDef","range"])&&(h=$4(at({},c,{values:l}),t,e)),c.change({values:l,range:h})}})})},r.prototype.cacheScale=function(t,e,i){var n=this.getScaleMeta(i);n&&n.scale.type===t.type?(ict(n.scale,t),n.scaleDef=e):(n={key:i,scale:t,scaleDef:e},this.scales.set(i,n));var a=this.getSyncKey(n);if(n.syncKey=a,this.removeFromSyncScales(i),a){var o=this.syncScales.get(a);o||(o=[],this.syncScales.set(a,o)),o.push(i)}},r.prototype.getScale=function(t){var e=this.getScaleMeta(t);if(!e){var i=cr(t.split("-")),n=this.syncScales.get(i);n&&n.length&&(e=this.getScaleMeta(n[0]))}return e&&e.scale},r.prototype.deleteScale=function(t){var e=this.getScaleMeta(t);if(e){var i=e.syncKey,n=this.syncScales.get(i);if(n&&n.length){var a=n.indexOf(t);a!==-1&&n.splice(a,1)}}this.scales.delete(t)},r.prototype.clear=function(){this.scales.clear(),this.syncScales.clear()},r.prototype.removeFromSyncScales=function(t){var e=this;this.syncScales.forEach(function(i,n){var a=i.indexOf(t);if(a!==-1)return i.splice(a,1),i.length===0&&e.syncScales.delete(n),!1})},r.prototype.getSyncKey=function(t){var e=t.scale,i=t.scaleDef,n=e.field,a=P(i,["sync"]);return a===!0?n:a===!1?void 0:a},r.prototype.getScaleMeta=function(t){return this.scales.get(t)},r}(),Qg=function(){function r(t,e,i,n){t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=0),n===void 0&&(n=0),this.top=t,this.right=e,this.bottom=i,this.left=n}return r.instance=function(t,e,i,n){return t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=0),n===void 0&&(n=0),new r(t,e,i,n)},r.prototype.max=function(t){var e=ct(t,4),i=e[0],n=e[1],a=e[2],o=e[3];return this.top=Math.max(this.top,i),this.right=Math.max(this.right,n),this.bottom=Math.max(this.bottom,a),this.left=Math.max(this.left,o),this},r.prototype.shrink=function(t){var e=ct(t,4),i=e[0],n=e[1],a=e[2],o=e[3];return this.top+=i,this.right+=n,this.bottom+=a,this.left+=o,this},r.prototype.inc=function(t,e){var i=t.width,n=t.height;switch(e){case nt.TOP:case nt.TOP_LEFT:case nt.TOP_RIGHT:this.top+=n;break;case nt.RIGHT:case nt.RIGHT_TOP:case nt.RIGHT_BOTTOM:this.right+=i;break;case nt.BOTTOM:case nt.BOTTOM_LEFT:case nt.BOTTOM_RIGHT:this.bottom+=n;break;case nt.LEFT:case nt.LEFT_TOP:case nt.LEFT_BOTTOM:this.left+=i;break}return this},r.prototype.getPadding=function(){return[this.top,this.right,this.bottom,this.left]},r.prototype.clone=function(){return new(r.bind.apply(r,xt([void 0],ct(this.getPadding()),!1)))},r}();function aht(r){var t=r.padding;if(!Jct(t))return new(Qg.bind.apply(Qg,xt([void 0],ct(aA(t)),!1)));var e=r.viewBBox,i=new Qg,n=[],a=[],o=[];return I(r.getComponents(),function(s){var l=s.type;l===Ar.AXIS?n.push(s):[Ar.LEGEND,Ar.SLIDER,Ar.SCROLLBAR].includes(l)?a.push(s):l!==Ar.GRID&&l!==Ar.TOOLTIP&&o.push(s)}),I(n,function(s){var l=s.component,u=l.getLayoutBBox(),c=new Ri(u.x,u.y,u.width,u.height),h=c.exceed(e);i.max(h)}),I(a,function(s){var l=s.component,u=s.direction,c=l.getLayoutBBox(),h=l.get("padding"),f=new Ri(c.x,c.y,c.width,c.height).expand(h);i.inc(f,u)}),I(o,function(s){var l=s.component,u=s.direction,c=l.getLayoutBBox(),h=new Ri(c.x,c.y,c.width,c.height);i.inc(h,u)}),i}function oht(r,t,e){var i=e.instance();t.forEach(function(n){n.autoPadding=i.max(n.autoPadding.getPadding())})}var hN=function(r){N(t,r);function t(e){var i=r.call(this,{visible:e.visible})||this;i.views=[],i.geometries=[],i.controllers=[],i.interactions={},i.limitInPlot=!1,i.options={data:[],animate:!0},i.usedControllers=tht(),i.scalePool=new nht,i.layoutFunc=iht,i.isPreMouseInPlot=!1,i.isDataChanged=!1,i.isCoordinateChanged=!1,i.createdScaleKeys=new Map,i.onCanvasEvent=function(_){var x=_.name;if(!x.includes(":")){var C=i.createViewEvent(_);i.doPlotEvent(C),i.emit(x,C)}},i.onDelegateEvents=function(_){var x=_.name;if(x.includes(":")){var C=i.createViewEvent(_);i.emit(x,C)}};var n=e.id,a=n===void 0?ln("view"):n,o=e.parent,s=e.canvas,l=e.backgroundGroup,u=e.middleGroup,c=e.foregroundGroup,h=e.region,f=h===void 0?{start:{x:0,y:0},end:{x:1,y:1}}:h,d=e.padding,v=e.appendPadding,p=e.theme,g=e.options,m=e.limitInPlot,y=e.syncViewPadding;return i.parent=o,i.canvas=s,i.backgroundGroup=l,i.middleGroup=u,i.foregroundGroup=c,i.region=f,i.padding=d,i.appendPadding=v,i.options=S(S({},i.options),g),i.limitInPlot=m,i.id=a,i.syncViewPadding=y,i.themeObject=ie(p)?at({},rd("default"),Z0(p)):rd(p),i.init(),i}return t.prototype.setLayout=function(e){this.layoutFunc=e},t.prototype.init=function(){this.calculateViewBBox(),this.initEvents(),this.initComponentController(),this.initOptions()},t.prototype.render=function(e,i){e===void 0&&(e=!1),this.emit(Ut.BEFORE_RENDER,$e.fromData(this,Ut.BEFORE_RENDER,i)),this.paint(e),this.emit(Ut.AFTER_RENDER,$e.fromData(this,Ut.AFTER_RENDER,i)),this.visible===!1&&this.changeVisible(!1)},t.prototype.clear=function(){var e=this;this.emit(Ut.BEFORE_CLEAR),this.filteredData=[],this.coordinateInstance=void 0,this.isDataChanged=!1,this.isCoordinateChanged=!1;for(var i=this.geometries,n=0;n<i.length;n++)i[n].clear(),i[n].container.remove(!0),i[n].labelsContainer.remove(!0);this.geometries=[];for(var a=this.controllers,n=0;n<a.length;n++)a[n].name==="annotation"?a[n].clear(!0):a[n].clear();this.createdScaleKeys.forEach(function(s,l){e.getRootView().scalePool.deleteScale(l)}),this.createdScaleKeys.clear();for(var o=this.views,n=0;n<o.length;n++)o[n].clear();this.emit(Ut.AFTER_CLEAR)},t.prototype.destroy=function(){this.emit(Ut.BEFORE_DESTROY);var e=this.interactions;I(e,function(s){s&&s.destroy()}),this.clear();for(var i=this.controllers,n=0,a=i.length;n<a;n++){var o=i[n];o.destroy()}this.backgroundGroup.remove(!0),this.middleGroup.remove(!0),this.foregroundGroup.remove(!0),r.prototype.destroy.call(this)},t.prototype.changeVisible=function(e){r.prototype.changeVisible.call(this,e);for(var i=this.geometries,n=0,a=i.length;n<a;n++){var o=i[n];o.changeVisible(e)}for(var s=this.controllers,n=0,a=s.length;n<a;n++){var l=s[n];l.changeVisible(e)}return this.foregroundGroup.set("visible",e),this.middleGroup.set("visible",e),this.backgroundGroup.set("visible",e),this.getCanvas().draw(),this},t.prototype.data=function(e){return or(this.options,"data",e),this.isDataChanged=!0,this},t.prototype.source=function(e){return console.warn("This method will be removed at G2 V4.1. Please use chart.data() instead."),this.data(e)},t.prototype.filter=function(e,i){return ot(i)?(or(this.options,["filters",e],i),this):(!i&&P(this.options,["filters",e])&&delete this.options.filters[e],this)},t.prototype.axis=function(e,i){return os(e)?or(this.options,["axes"],e):or(this.options,["axes",e],i),this},t.prototype.legend=function(e,i){return os(e)?or(this.options,["legends"],e):mt(e)?(or(this.options,["legends",e],i),Ra(i)&&(i!=null&&i.selected)&&or(this.options,["filters",e],function(n){var a;return(a=i==null?void 0:i.selected[n])!==null&&a!==void 0?a:!0})):or(this.options,["legends"],e),this},t.prototype.scale=function(e,i){var n=this;return mt(e)?or(this.options,["scales",e],i):ie(e)&&I(e,function(a,o){or(n.options,["scales",o],a)}),this},t.prototype.tooltip=function(e){return or(this.options,"tooltip",e),this},t.prototype.annotation=function(){return this.getController("annotation")},t.prototype.guide=function(){return console.warn("This method will be removed at G2 V4.1. Please use chart.annotation() instead."),this.annotation()},t.prototype.coordinate=function(e,i){return mt(e)?or(this.options,"coordinate",{type:e,cfg:i}):or(this.options,"coordinate",e),this.coordinateController.update(this.options.coordinate),this.coordinateController},t.prototype.coord=function(e,i){return console.warn("This method will be removed at G2 V4.1. Please use chart.coordinate() instead."),this.coordinate(e,i)},t.prototype.facet=function(e,i){this.facetInstance&&this.facetInstance.destroy();var n=sct(e);if(!n)throw new Error("facet '".concat(e,"' is not exist!"));return this.facetInstance=new n(this,S(S({},i),{type:e})),this},t.prototype.animate=function(e){return or(this.options,"animate",e),this},t.prototype.updateOptions=function(e){return this.clear(),ne(this.options,e),this.views.forEach(function(i){return i.destroy()}),this.views=[],this.initOptions(),this.coordinateBBox=this.viewBBox,this},t.prototype.option=function(e,i){if(t.prototype[e])throw new Error(`Can't use built in variable name "`.concat(e,'", please change another one.'));return or(this.options,e,i),this},t.prototype.theme=function(e){return this.themeObject=ie(e)?at({},this.themeObject,Z0(e)):rd(e),this},t.prototype.interaction=function(e,i){var n=this.interactions[e];n&&n.destroy();var a=kct(e,this,i);return a&&(a.init(),this.interactions[e]=a),this},t.prototype.removeInteraction=function(e){var i=this.interactions[e];i&&(i.destroy(),this.interactions[e]=void 0)},t.prototype.changeData=function(e){this.isDataChanged=!0,this.emit(Ut.BEFORE_CHANGE_DATA,$e.fromData(this,Ut.BEFORE_CHANGE_DATA,null)),this.data(e),this.paint(!0);for(var i=this.views,n=0,a=i.length;n<a;n++){var o=i[n];o.changeData(e)}this.emit(Ut.AFTER_CHANGE_DATA,$e.fromData(this,Ut.AFTER_CHANGE_DATA,null))},t.prototype.createView=function(e){this.parent&&this.parent.parent&&console.warn("The view nesting recursive feature will be removed at G2 V4.1. Please avoid to use it.");var i={data:this.options.data,scales:Rr(this.options.scales),axes:Rr(this.options.axes),coordinate:Rr(this.coordinateController.getOption()),tooltip:Rr(this.options.tooltip),legends:Rr(this.options.legends),animate:this.options.animate,visible:this.visible},n=new t(S(S({parent:this,canvas:this.canvas,backgroundGroup:this.backgroundGroup.addGroup({zIndex:Fc.BG}),middleGroup:this.middleGroup.addGroup({zIndex:Fc.MID}),foregroundGroup:this.foregroundGroup.addGroup({zIndex:Fc.FORE}),theme:this.themeObject,padding:this.padding},e),{options:S(S({},i),P(e,"options",{}))}));return this.views.push(n),n},t.prototype.view=function(e){return console.warn("This method will be removed at G2 V4.1. Please use chart.createView() instead."),this.createView(e)},t.prototype.removeView=function(e){var i=i5(this.views,function(n){return n===e})[0];return i&&i.destroy(),i},t.prototype.getCoordinate=function(){return this.coordinateInstance},t.prototype.getTheme=function(){return this.themeObject},t.prototype.getXScale=function(){var e=this.geometries[0];return e?e.getXScale():null},t.prototype.getYScales=function(){var e={},i=[];return this.geometries.forEach(function(n){var a=n.getYScale(),o=a.field;e[o]||(e[o]=!0,i.push(a))}),i},t.prototype.getScalesByDim=function(e){for(var i=this.geometries,n={},a=0,o=i.length;a<o;a++){var s=i[a],l=e==="x"?s.getXScale():s.getYScale();l&&!n[l.field]&&(n[l.field]=l)}return n},t.prototype.getScale=function(e,i){var n=i||this.getScaleKey(e);return this.getRootView().scalePool.getScale(n)},t.prototype.getScaleByField=function(e,i){return this.getScale(e,i)},t.prototype.getOptions=function(){return this.options},t.prototype.getData=function(){return this.filteredData},t.prototype.getOriginalData=function(){return this.options.data},t.prototype.getPadding=function(){return this.autoPadding.getPadding()},t.prototype.getGeometries=function(){return this.geometries},t.prototype.getElements=function(){return Qr(this.geometries,function(e,i){return e.concat(i.getElements())},[])},t.prototype.getElementsBy=function(e){return this.getElements().filter(function(i){return e(i)})},t.prototype.getLayer=function(e){return e===ir.BG?this.backgroundGroup:e===ir.MID?this.middleGroup:e===ir.FORE?this.foregroundGroup:this.foregroundGroup},t.prototype.isPointInPlot=function(e){return Qut(this.getCoordinate(),e)},t.prototype.getLegendAttributes=function(){return en(this.geometries.map(function(e){return e.getGroupAttributes()}))},t.prototype.getGroupScales=function(){var e=this.geometries.map(function(i){return i.getGroupScales()});return Ds(en(e))},t.prototype.getCanvas=function(){return this.getRootView().canvas},t.prototype.getRootView=function(){for(var e=this;;){if(e.parent){e=e.parent;continue}break}return e},t.prototype.getXY=function(e){var i=this.getCoordinate(),n=this.getScalesByDim("x"),a=this.getScalesByDim("y"),o,s;if(I(e,function(l,u){n[u]&&(o=n[u].scale(l)),a[u]&&(s=a[u].scale(l))}),!K(o)&&!K(s))return i.convert({x:o,y:s})},t.prototype.getController=function(e){return Qn(this.controllers,function(i){return i.name===e})},t.prototype.showTooltip=function(e){var i=this.getController("tooltip");return i&&i.showTooltip(e),this},t.prototype.hideTooltip=function(){var e=this.getController("tooltip");return e&&e.hideTooltip(),this},t.prototype.lockTooltip=function(){var e=this.getController("tooltip");return e&&e.lockTooltip(),this},t.prototype.unlockTooltip=function(){var e=this.getController("tooltip");return e&&e.unlockTooltip(),this},t.prototype.isTooltipLocked=function(){var e=this.getController("tooltip");return e&&e.isTooltipLocked()},t.prototype.getTooltipItems=function(e){var i=this.getController("tooltip");return i?i.getTooltipItems(e):[]},t.prototype.getSnapRecords=function(e){for(var i=this.geometries,n=[],a=0,o=i.length;a<o;a++){var s=i[a],l=s.dataArray;s.sort(l);for(var u=void 0,c=0,h=l.length;c<h;c++){var f=l[c];u=cN(e,f,s),u&&n.push(u)}}for(var d=this.views,a=0,o=d.length;a<o;a++){var v=d[a],p=v.getSnapRecords(e);n=n.concat(p)}return n},t.prototype.getComponents=function(){for(var e=[],i=this.controllers,n=0,a=i.length;n<a;n++){var o=i[n];e=e.concat(o.getComponents())}return e},t.prototype.filterData=function(e){var i=this.options.filters;return xr(i)===0?e:Fr(e,function(n,a){var o=Object.keys(i);return o.every(function(s){var l=i[s];return l(n[s],n,a)})})},t.prototype.filterFieldData=function(e,i){var n=this.options.filters,a=P(n,e);return zr(a)?i:i.filter(function(o,s){return a(o[e],o,s)})},t.prototype.adjustCoordinate=function(){var e=this.getCoordinate(),i=e.start,n=e.end,a=this.coordinateBBox.bl,o=this.coordinateBBox.tr;if(qt(i,a)&&qt(n,o)){this.isCoordinateChanged=!1;return}this.isCoordinateChanged=!0,this.coordinateInstance=this.coordinateController.adjust(a,o)},t.prototype.paint=function(e){this.renderDataRecursive(e),this.syncScale(),this.emit(Ut.BEFORE_PAINT),this.renderPaddingRecursive(e),this.renderLayoutRecursive(e),this.renderBackgroundStyleShape(),this.renderPaintRecursive(e),this.emit(Ut.AFTER_PAINT),this.isDataChanged=!1},t.prototype.renderBackgroundStyleShape=function(){if(!this.parent){var e=P(this.themeObject,"background");if(e){this.backgroundStyleRectShape||(this.backgroundStyleRectShape=this.backgroundGroup.addShape("rect",{attrs:{},zIndex:-1,capture:!1}),this.backgroundStyleRectShape.toBack());var i=this.viewBBox,n=i.x,a=i.y,o=i.width,s=i.height;this.backgroundStyleRectShape.attr({fill:e,x:n,y:a,width:o,height:s})}else this.backgroundStyleRectShape&&(this.backgroundStyleRectShape.remove(!0),this.backgroundStyleRectShape=void 0)}},t.prototype.renderPaddingRecursive=function(e){this.calculateViewBBox(),this.adjustCoordinate(),this.initComponents(e),this.autoPadding=aht(this).shrink(aA(this.appendPadding)),this.coordinateBBox=this.viewBBox.shrink(this.autoPadding.getPadding()),this.adjustCoordinate();var i=this.controllers.find(function(l){return l.name==="tooltip"});i.update();for(var n=this.views,a=0,o=n.length;a<o;a++){var s=n[a];s.renderPaddingRecursive(e)}},t.prototype.renderLayoutRecursive=function(e){var i=this.syncViewPadding===!0?oht:ot(this.syncViewPadding)?this.syncViewPadding:void 0;i&&(i(this,this.views,Qg),this.views.forEach(function(l){l.coordinateBBox=l.viewBBox.shrink(l.autoPadding.getPadding()),l.adjustCoordinate()})),this.doLayout();for(var n=this.views,a=0,o=n.length;a<o;a++){var s=n[a];s.renderLayoutRecursive(e)}},t.prototype.renderPaintRecursive=function(e){var i=this.middleGroup;if(this.limitInPlot){var n=tA(this.coordinateInstance),a=n.type,o=n.attrs;i.setClip({type:a,attrs:o})}else i.setClip(void 0);this.paintGeometries(e),this.renderComponents(e);for(var s=this.views,l=0,u=s.length;l<u;l++){var c=s[l];c.renderPaintRecursive(e)}},t.prototype.createScale=function(e,i,n,a){var o=P(this.options.scales,[e]),s=S(S({},o),n);return this.parent?this.parent.createScale(e,i,s,a):this.scalePool.createScale(e,i,s,a)},t.prototype.renderDataRecursive=function(e){this.doFilterData(),this.createCoordinate(),this.initGeometries(e),this.renderFacet(e);for(var i=this.views,n=0,a=i.length;n<a;n++){var o=i[n];o.renderDataRecursive(e)}},t.prototype.calculateViewBBox=function(){var e,i,n,a;if(this.parent){var o=this.parent.coordinateBBox;e=o.x,i=o.y,n=o.width,a=o.height}else e=0,i=0,n=this.canvas.get("width"),a=this.canvas.get("height");var s=this.region,l=s.start,u=s.end,c=new Ri(e+n*l.x,i+a*l.y,n*(u.x-l.x),a*(u.y-l.y));(!this.viewBBox||!this.viewBBox.isEqual(c))&&(this.viewBBox=new Ri(e+n*l.x,i+a*l.y,n*(u.x-l.x),a*(u.y-l.y))),this.coordinateBBox=this.viewBBox},t.prototype.initEvents=function(){this.foregroundGroup.on("*",this.onDelegateEvents),this.middleGroup.on("*",this.onDelegateEvents),this.backgroundGroup.on("*",this.onDelegateEvents),this.canvas.on("*",this.onCanvasEvent)},t.prototype.initComponentController=function(){for(var e=this.usedControllers,i=0,n=e.length;i<n;i++){var a=e[i],o=eht(a);o&&this.controllers.push(new o(this))}},t.prototype.createViewEvent=function(e){var i=e.shape,n=e.name,a=i?i.get("origin"):null,o=new $e(this,e,a);return o.type=n,o},t.prototype.doPlotEvent=function(e){var i=e.type,n=e.x,a=e.y,o={x:n,y:a},s=["mousedown","mouseup","mousemove","mouseleave","mousewheel","touchstart","touchmove","touchend","touchcancel","click","dblclick","contextmenu"];if(s.includes(i)){var l=this.isPointInPlot(o),u=e.clone();if(l){var c="plot:".concat(i);u.type=c,this.emit(c,u),(i==="mouseleave"||i==="touchend")&&(this.isPreMouseInPlot=!1)}i==="mousemove"||i==="touchmove"?(this.isPreMouseInPlot&&!l?(i==="mousemove"&&(u.type=Bi.MOUSE_LEAVE,this.emit(Bi.MOUSE_LEAVE,u)),u.type=Bi.LEAVE,this.emit(Bi.LEAVE,u)):!this.isPreMouseInPlot&&l&&(i==="mousemove"&&(u.type=Bi.MOUSE_ENTER,this.emit(Bi.MOUSE_ENTER,u)),u.type=Bi.ENTER,this.emit(Bi.ENTER,u)),this.isPreMouseInPlot=l):(i==="mouseleave"||i==="touchend")&&this.isPreMouseInPlot&&(i==="mouseleave"&&(u.type=Bi.MOUSE_LEAVE,this.emit(Bi.MOUSE_LEAVE,u)),u.type=Bi.LEAVE,this.emit(Bi.LEAVE,u),this.isPreMouseInPlot=!1)}},t.prototype.doFilterData=function(){var e=this.options.data;this.filteredData=this.filterData(e)},t.prototype.initGeometries=function(e){this.createOrUpdateScales();for(var i=this.getCoordinate(),n=P(this.options,"scales",{}),a=this.geometries,o=0,s=a.length;o<s;o++){var l=a[o];l.scales=this.getGeometryScales();var u={coordinate:i,scaleDefs:n,data:this.filteredData,theme:this.themeObject,isDataChanged:this.isDataChanged,isCoordinateChanged:this.isCoordinateChanged};e?l.update(u):l.init(u)}this.adjustScales()},t.prototype.createOrUpdateScales=function(){for(var e=this.getScaleFields(),i=this.getGroupedFields(),n=this.getOptions(),a=n.data,o=n.scales,s=o===void 0?{}:o,l=this.filteredData,u=0,c=e.length;u<c;u++){var h=e[u],f=s[h],d=this.getScaleKey(h);this.createScale(h,i.includes(h)?a:l,f,d),this.createdScaleKeys.set(d,!0)}},t.prototype.syncScale=function(){this.getRootView().scalePool.sync(this.getCoordinate(),this.theme)},t.prototype.getGeometryScales=function(){for(var e=this.getScaleFields(),i={},n=0;n<e.length;n++){var a=e[n];i[a]=this.getScaleByField(a)}return i},t.prototype.getScaleFields=function(){for(var e=[],i=new Map,n=this.geometries,a=0;a<n.length;a++){var o=n[a],s=o.getScaleFields();Ds(s,e,i)}return e},t.prototype.getGroupedFields=function(){for(var e=[],i=new Map,n=this.geometries,a=0;a<n.length;a++){var o=n[a],s=o.getGroupFields();Ds(s,e,i)}return e},t.prototype.adjustScales=function(){this.adjustCategoryScaleRange()},t.prototype.adjustCategoryScaleRange=function(){var e=this,i=xt([this.getXScale()],ct(this.getYScales()),!1).filter(function(o){return!!o}),n=this.getCoordinate(),a=this.options.scales;I(i,function(o){var s=o.field,l=o.values,u=o.isCategory,c=o.isIdentity;(u||c)&&l&&!P(a,[s,"range"])&&(o.range=$4(o,n,e.theme))})},t.prototype.initComponents=function(e){for(var i=this.controllers,n=0;n<i.length;n++){var a=i[n];e?a.update():(a.clear(),a.render())}},t.prototype.doLayout=function(){this.layoutFunc(this)},t.prototype.createCoordinate=function(){var e=this.coordinateBBox.bl,i=this.coordinateBBox.tr;this.coordinateInstance=this.coordinateController.create(e,i)},t.prototype.paintGeometries=function(e){for(var i=this.options.animate,n=this.getCoordinate(),a={x:this.viewBBox.x,y:this.viewBBox.y,minX:this.viewBBox.minX,minY:this.viewBBox.minY,maxX:this.viewBBox.maxX,maxY:this.viewBBox.maxY,width:this.viewBBox.width,height:this.viewBBox.height},o=this.geometries,s=0;s<o.length;s++){var l=o[s];l.coordinate=n,l.canvasRegion=a,i||l.animate(!1),l.paint(e)}},t.prototype.renderComponents=function(e){for(var i=this.getComponents(),n=0;n<i.length;n++){var a=i[n];a.component.render()}},t.prototype.renderFacet=function(e){this.facetInstance&&(e?this.facetInstance.update():(this.facetInstance.clear(),this.facetInstance.init(),this.facetInstance.render()))},t.prototype.initOptions=function(){var e=this,i=this.options,n=i.geometries,a=n===void 0?[]:n,o=i.interactions,s=o===void 0?[]:o,l=i.views,u=l===void 0?[]:l,c=i.annotations,h=c===void 0?[]:c,f=i.coordinate,d=i.events,v=i.facets;this.coordinateController?f&&this.coordinateController.update(f):this.coordinateController=new rht(f);for(var p=0;p<a.length;p++){var g=a[p];this.createGeometry(g)}for(var m=0;m<s.length;m++){var y=s[m],_=y.type,x=y.cfg;this.interaction(_,x)}for(var C=0;C<u.length;C++){var A=u[C];this.createView(A)}for(var b=this.getController("annotation"),R=0;R<h.length;R++){var M=h[R];b.annotation(M)}d&&I(d,function(O,F){e.on(F,O)}),v&&I(v,function(O){var F=O.type,D=zt(O,["type"]);e.facet(F,D)})},t.prototype.createGeometry=function(e){var i=e.type,n=e.cfg,a=n===void 0?{}:n;if(this[i]){var o=this[i](a);I(e,function(s,l){ot(o[l])&&o[l](s)})}},t.prototype.getScaleKey=function(e){return"".concat(this.id,"-").concat(e)},t}(OS);function wo(r,t){hN.prototype[r.toLowerCase()]=function(e){e===void 0&&(e={});var i=S({container:this.middleGroup.addGroup(),labelsContainer:this.foregroundGroup.addGroup()},e),n=new t(i);return this.geometries.push(n),n}}var sht=function(r){N(t,r);function t(e){var i=this,n=e.container,a=e.width,o=e.height,s=e.autoFit,l=s===void 0?!1:s,u=e.padding,c=e.appendPadding,h=e.renderer,f=h===void 0?"canvas":h,d=e.pixelRatio,v=e.localRefresh,p=v===void 0?!0:v,g=e.visible,m=g===void 0?!0:g,y=e.supportCSSTransform,_=y===void 0?!1:y,x=e.defaultInteractions,C=x===void 0?["tooltip","legend-filter","legend-active","continuous-filter","ellipsis-text","axis-description"]:x,A=e.options,b=e.limitInPlot,R=e.theme,M=e.syncViewPadding,O=mt(n)?document.getElementById(n):n,F=Qo('<div style="position:relative;"></div>');O.appendChild(F);var D=LM(O,l,a,o),H=tot(f),j=new H.Canvas(S({container:F,pixelRatio:d,localRefresh:p,supportCSSTransform:_},D));return i=r.call(this,{parent:null,canvas:j,backgroundGroup:j.addGroup({zIndex:Fc.BG}),middleGroup:j.addGroup({zIndex:Fc.MID}),foregroundGroup:j.addGroup({zIndex:Fc.FORE}),padding:u,appendPadding:c,visible:m,options:A,limitInPlot:b,theme:R,syncViewPadding:M})||this,i.onResize=IS(function(){i.forceFit()},300),i.ele=O,i.canvas=j,i.width=D.width,i.height=D.height,i.autoFit=l,i.localRefresh=p,i.renderer=f,i.wrapperElement=F,i.updateCanvasStyle(),i.bindAutoFit(),i.initDefaultInteractions(C),i}return t.prototype.initDefaultInteractions=function(e){var i=this;I(e,function(n){i.interaction(n)})},t.prototype.aria=function(e){var i="aria-label";e===!1?this.ele.removeAttribute(i):this.ele.setAttribute(i,e.label)},t.prototype.changeSize=function(e,i){return this.width===e&&this.height===i?this:(this.emit(Ut.BEFORE_CHANGE_SIZE),this.width=e,this.height=i,this.canvas.changeSize(e,i),this.render(!0),this.emit(Ut.AFTER_CHANGE_SIZE),this)},t.prototype.clear=function(){r.prototype.clear.call(this),this.aria(!1)},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.unbindAutoFit(),this.canvas.destroy(),oot(this.wrapperElement),this.wrapperElement=null},t.prototype.changeVisible=function(e){return r.prototype.changeVisible.call(this,e),this.wrapperElement.style.display=e?"":"none",this},t.prototype.forceFit=function(){if(!this.destroyed){var e=LM(this.ele,!0,this.width,this.height),i=e.width,n=e.height;this.changeSize(i,n)}},t.prototype.updateCanvasStyle=function(){be(this.canvas.get("el"),{display:"inline-block",verticalAlign:"middle"})},t.prototype.bindAutoFit=function(){this.autoFit&&window.addEventListener("resize",this.onResize)},t.prototype.unbindAutoFit=function(){this.autoFit&&window.removeEventListener("resize",this.onResize)},t}(hN),Fh=function(){function r(t){this.visible=!0,this.components=[],this.view=t}return r.prototype.clear=function(t){I(this.components,function(e){e.component.destroy()}),this.components=[]},r.prototype.destroy=function(){this.clear()},r.prototype.getComponents=function(){return this.components},r.prototype.changeVisible=function(t){this.visible!==t&&(this.components.forEach(function(e){t?e.component.show():e.component.hide()}),this.visible=t)},r}();function lht(r){for(var t=[],e=function(n){var a=r[n],o=Qn(t,function(s){return s.color===a.color&&s.name===a.name&&s.value===a.value&&s.title===a.title});o||t.push(a)},i=0;i<r.length;i++)e(i);return t}var fN=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.isLocked=!1,e}return Object.defineProperty(t.prototype,"name",{get:function(){return"tooltip"},enumerable:!1,configurable:!0}),t.prototype.init=function(){},t.prototype.isVisible=function(){var e=this.view.getOptions().tooltip;return e!==!1},t.prototype.render=function(){},t.prototype.showTooltip=function(e){if(this.point=e,!!this.isVisible()){var i=this.view,n=this.getTooltipItems(e);if(!n.length){this.hideTooltip();return}var a=this.getTitle(n),o={x:n[0].x,y:n[0].y};i.emit("tooltip:show",$e.fromData(i,"tooltip:show",S({items:n,title:a},e)));var s=this.getTooltipCfg(),l=s.follow,u=s.showMarkers,c=s.showCrosshairs,h=s.showContent,f=s.marker,d=this.items,v=this.title;if(!qt(v,a)||!qt(d,n)?(i.emit("tooltip:change",$e.fromData(i,"tooltip:change",S({items:n,title:a},e))),(ot(h)?h(n):h)&&(this.tooltip||this.renderTooltip(),this.tooltip.update(ne({},s,{items:this.getItemsAfterProcess(n),title:a},l?e:{})),this.tooltip.show()),u&&this.renderTooltipMarkers(n,f)):(this.tooltip&&l&&(this.tooltip.update(e),this.tooltip.show()),this.tooltipMarkersGroup&&this.tooltipMarkersGroup.show()),this.items=n,this.title=a,c){var p=P(s,["crosshairs","follow"],!1);this.renderCrosshairs(p?e:o,s)}}},t.prototype.hideTooltip=function(){var e=this.getTooltipCfg().follow;if(!e){this.point=null;return}var i=this.tooltipMarkersGroup;i&&i.hide();var n=this.xCrosshair,a=this.yCrosshair;n&&n.hide(),a&&a.hide();var o=this.tooltip;o&&o.hide(),this.view.emit("tooltip:hide",$e.fromData(this.view,"tooltip:hide",{})),this.point=null},t.prototype.lockTooltip=function(){this.isLocked=!0,this.tooltip&&this.tooltip.setCapture(!0)},t.prototype.unlockTooltip=function(){this.isLocked=!1;var e=this.getTooltipCfg();this.tooltip&&this.tooltip.setCapture(e.capture)},t.prototype.isTooltipLocked=function(){return this.isLocked},t.prototype.clear=function(){var e=this,i=e.tooltip,n=e.xCrosshair,a=e.yCrosshair,o=e.tooltipMarkersGroup;i&&(i.hide(),i.clear()),n&&n.clear(),a&&a.clear(),o&&o.clear(),i!=null&&i.get("customContent")&&(this.tooltip.destroy(),this.tooltip=null),this.title=null,this.items=null},t.prototype.destroy=function(){this.tooltip&&this.tooltip.destroy(),this.xCrosshair&&this.xCrosshair.destroy(),this.yCrosshair&&this.yCrosshair.destroy(),this.guideGroup&&this.guideGroup.remove(!0),this.reset()},t.prototype.reset=function(){this.items=null,this.title=null,this.tooltipMarkersGroup=null,this.tooltipCrosshairsGroup=null,this.xCrosshair=null,this.yCrosshair=null,this.tooltip=null,this.guideGroup=null,this.isLocked=!1,this.point=null},t.prototype.changeVisible=function(e){if(this.visible!==e){var i=this,n=i.tooltip,a=i.tooltipMarkersGroup,o=i.xCrosshair,s=i.yCrosshair;e?(n&&n.show(),a&&a.show(),o&&o.show(),s&&s.show()):(n&&n.hide(),a&&a.hide(),o&&o.hide(),s&&s.hide()),this.visible=e}},t.prototype.getTooltipItems=function(e){var i,n,a,o,s,l,u=this.findItemsFromView(this.view,e);if(u.length){u=en(u);try{for(var c=Qt(u),h=c.next();!h.done;h=c.next()){var f=h.value;try{for(var d=(a=void 0,Qt(f)),v=d.next();!v.done;v=d.next()){var p=v.value,g=p.mappingData,m=g.x,y=g.y;p.x=q(m)?m[m.length-1]:m,p.y=q(y)?y[y.length-1]:y}}catch(O){a={error:O}}finally{try{v&&!v.done&&(o=d.return)&&o.call(d)}finally{if(a)throw a.error}}}}catch(O){i={error:O}}finally{try{h&&!h.done&&(n=c.return)&&n.call(c)}finally{if(i)throw i.error}}var _=this.getTooltipCfg().shared;if(_===!1&&u.length>1){var x=u[0],C=Math.abs(e.y-x[0].y);try{for(var A=Qt(u),b=A.next();!b.done;b=A.next()){var R=b.value,M=Math.abs(e.y-R[0].y);M<=C&&(x=R,C=M)}}catch(O){s={error:O}}finally{try{b&&!b.done&&(l=A.return)&&l.call(A)}finally{if(s)throw s.error}}u=[x]}return lht(en(u))}return[]},t.prototype.layout=function(){},t.prototype.update=function(){if(this.point&&this.showTooltip(this.point),this.tooltip){var e=this.view.getCanvas();this.tooltip.set("region",{start:{x:0,y:0},end:{x:e.get("width"),y:e.get("height")}})}},t.prototype.isCursorEntered=function(e){if(this.tooltip){var i=this.tooltip.getContainer(),n=this.tooltip.get("capture");if(i&&n){var a=i.getBoundingClientRect(),o=a.x,s=a.y,l=a.width,u=a.height;return new Ri(o,s,l,u).isPointIn(e)}}return!1},t.prototype.getTooltipCfg=function(){var e=this.view,i=e.getOptions().tooltip,n=this.processCustomContent(i),a=e.getTheme(),o=P(a,["components","tooltip"],{}),s=P(n,"enterable",o.enterable);return at({},o,n,{capture:!!(s||this.isLocked)})},t.prototype.processCustomContent=function(e){if(os(e)||!P(e,"customContent"))return e;var i=e.customContent,n=function(a,o){var s=i(a,o)||"";return mt(s)?'<div class="g2-tooltip">'+s+"</div>":s};return S(S({},e),{customContent:n})},t.prototype.getTitle=function(e){var i=e[0].title||e[0].name;return this.title=i,i},t.prototype.renderTooltip=function(){var e=this.view.getCanvas(),i={start:{x:0,y:0},end:{x:e.get("width"),y:e.get("height")}},n=this.getTooltipCfg(),a=new sy(S(S({parent:e.get("el").parentNode,region:i},n),{visible:!1,crosshairs:null}));a.init(),this.tooltip=a},t.prototype.renderTooltipMarkers=function(e,i){var n,a,o=this.getTooltipMarkersGroup(),s=this.view.getRootView(),l=s.limitInPlot;try{for(var u=Qt(e),c=u.next();!c.done;c=u.next()){var h=c.value,f=h.x,d=h.y;if(l||o!=null&&o.getClip()){var v=tA(s.getCoordinate()),p=v.type,g=v.attrs;o==null||o.setClip({type:p,attrs:g})}else o==null||o.setClip(void 0);var m=this.view.getTheme(),y=P(m,["components","tooltip","marker"],{}),_=S(S({fill:h.color,symbol:"circle",shadowColor:h.color},ot(i)?S(S({},y),i(h)):i),{x:f,y:d});o.addShape("marker",{attrs:_})}}catch(x){n={error:x}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}},t.prototype.renderCrosshairs=function(e,i){var n=P(i,["crosshairs","type"],"x");n==="x"?(this.yCrosshair&&this.yCrosshair.hide(),this.renderXCrosshairs(e,i)):n==="y"?(this.xCrosshair&&this.xCrosshair.hide(),this.renderYCrosshairs(e,i)):n==="xy"&&(this.renderXCrosshairs(e,i),this.renderYCrosshairs(e,i))},t.prototype.renderXCrosshairs=function(e,i){var n=this.getViewWithGeometry(this.view).getCoordinate(),a,o;if(n.isRect)n.isTransposed?(a={x:n.start.x,y:e.y},o={x:n.end.x,y:e.y}):(a={x:e.x,y:n.end.y},o={x:e.x,y:n.start.y});else{var s=ah(n,e),l=n.getCenter(),u=n.getRadius();o=ur(l.x,l.y,u,s),a=l}var c=at({start:a,end:o,container:this.getTooltipCrosshairsGroup()},P(i,"crosshairs",{}),this.getCrosshairsText("x",e,i));delete c.type;var h=this.xCrosshair;h?h.update(c):(h=new w4(c),h.init()),h.render(),h.show(),this.xCrosshair=h},t.prototype.renderYCrosshairs=function(e,i){var n=this.getViewWithGeometry(this.view).getCoordinate(),a,o;if(n.isRect){var s=void 0,l=void 0;n.isTransposed?(s={x:e.x,y:n.end.y},l={x:e.x,y:n.start.y}):(s={x:n.start.x,y:e.y},l={x:n.end.x,y:e.y}),a={start:s,end:l},o="Line"}else a={center:n.getCenter(),radius:ly(n,e),startAngle:n.startAngle,endAngle:n.endAngle},o="Circle";a=at({container:this.getTooltipCrosshairsGroup()},a,P(i,"crosshairs",{}),this.getCrosshairsText("y",e,i)),delete a.type;var u=this.yCrosshair;u?n.isRect&&u.get("type")==="circle"||!n.isRect&&u.get("type")==="line"?(u=new Gx[o](a),u.init()):u.update(a):(u=new Gx[o](a),u.init()),u.render(),u.show(),this.yCrosshair=u},t.prototype.getCrosshairsText=function(e,i,n){var a=P(n,["crosshairs","text"]),o=P(n,["crosshairs","follow"]),s=this.items;if(a){var l=this.getViewWithGeometry(this.view),u=s[0],c=l.getXScale(),h=l.getYScales()[0],f=void 0,d=void 0;if(o){var v=this.view.getCoordinate().invert(i);f=c.invert(v.x),d=h.invert(v.y)}else f=u.data[c.field],d=u.data[h.field];var p=e==="x"?f:d;return ot(a)?a=a(e,p,s,i):a.content=p,{text:a}}},t.prototype.getGuideGroup=function(){if(!this.guideGroup){var e=this.view.foregroundGroup;this.guideGroup=e.addGroup({name:"tooltipGuide",capture:!1})}return this.guideGroup},t.prototype.getTooltipMarkersGroup=function(){var e=this.tooltipMarkersGroup;return e&&!e.destroyed?(e.clear(),e.show()):(e=this.getGuideGroup().addGroup({name:"tooltipMarkersGroup"}),e.toFront(),this.tooltipMarkersGroup=e),e},t.prototype.getTooltipCrosshairsGroup=function(){var e=this.tooltipCrosshairsGroup;return e||(e=this.getGuideGroup().addGroup({name:"tooltipCrosshairsGroup",capture:!1}),e.toBack(),this.tooltipCrosshairsGroup=e),e},t.prototype.findItemsFromView=function(e,i){var n,a;if(e.getOptions().tooltip===!1)return[];var o=this.getTooltipCfg(),s=Zx(e,i,o);try{for(var l=Qt(e.views),u=l.next();!u.done;u=l.next()){var c=u.value;s=s.concat(this.findItemsFromView(c,i))}}catch(h){n={error:h}}finally{try{u&&!u.done&&(a=l.return)&&a.call(l)}finally{if(n)throw n.error}}return s},t.prototype.getViewWithGeometry=function(e){var i=this;return e.geometries.length?e:Qn(e.views,function(n){return i.getViewWithGeometry(n)})},t.prototype.getItemsAfterProcess=function(e){var i=this.getTooltipCfg().customItems,n=i||function(a){return a};return n(e)},t}(Fh),dN={};function vN(r){return dN[r.toLowerCase()]}function On(r,t){dN[r.toLowerCase()]=t}var sh={appear:{duration:450,easing:"easeQuadOut"},update:{duration:400,easing:"easeQuadInOut"},enter:{duration:400,easing:"easeQuadInOut"},leave:{duration:350,easing:"easeQuadIn"}},uht={interval:function(r){return{enter:{animation:r.isRect?r.isTransposed?"scale-in-x":"scale-in-y":"fade-in"},update:{animation:r.isPolar&&r.isTransposed?"sector-path-update":null},leave:{animation:"fade-out"}}},line:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},path:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},point:{appear:{animation:"zoom-in"},enter:{animation:"zoom-in"},leave:{animation:"zoom-out"}},area:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},polygon:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},schema:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},edge:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},label:{appear:{animation:"fade-in",delay:450},enter:{animation:"fade-in"},update:{animation:"position-update"},leave:{animation:"fade-out"}}},F3={line:function(){return{animation:"wave-in"}},area:function(){return{animation:"wave-in"}},path:function(){return{animation:"fade-in"}},interval:function(r){var t;return r.isRect?t=r.isTransposed?"grow-in-x":"grow-in-y":(t="grow-in-xy",r.isPolar&&r.isTransposed&&(t="wave-in")),{animation:t}},schema:function(r){var t;return r.isRect?t=r.isTransposed?"grow-in-x":"grow-in-y":t="grow-in-xy",{animation:t}},polygon:function(){return{animation:"fade-in",duration:500}},edge:function(){return{animation:"fade-in"}}};function cht(r,t){return{delay:ot(r.delay)?r.delay(t):r.delay,easing:ot(r.easing)?r.easing(t):r.easing,duration:ot(r.duration)?r.duration(t):r.duration,callback:r.callback,repeat:r.repeat}}function pN(r,t,e){var i=uht[r];return i&&(ot(i)&&(i=i(t)),i=at({},sh,i),e)?i[e]:i}function Dc(r,t,e){var i=P(r.get("origin"),"data",Se),n=t.animation,a=cht(t,i);if(n){var o=vN(n);o&&o(r,a,e)}else r.animate(e.toAttrs,a)}function hht(r,t,e,i,n){if(F3[e]){var a=F3[e](i),o=vN(P(a,"animation",""));if(o){var s=S(S(S({},sh.appear),a),t);r.stopAnimate(),o(r,s,{coordinate:i,minYPoint:n,toAttrs:null})}}}var sA="element-background",gN=function(r){N(t,r);function t(e){var i=r.call(this,e)||this;i.labelShape=[],i.states=[];var n=e.shapeFactory,a=e.container,o=e.offscreenGroup,s=e.elementIndex,l=e.visible,u=l===void 0?!0:l;return i.shapeFactory=n,i.container=a,i.offscreenGroup=o,i.visible=u,i.elementIndex=s,i}return t.prototype.draw=function(e,i){i===void 0&&(i=!1),this.model=e,this.data=e.data,this.shapeType=this.getShapeType(e),this.drawShape(e,i),this.visible===!1&&this.changeVisible(!1)},t.prototype.update=function(e){var i=this,n=i.shapeFactory,a=i.shape;if(a){this.model=e,this.data=e.data,this.shapeType=this.getShapeType(e),this.setShapeInfo(a,e);var o=this.getOffscreenGroup(),s=n.drawShape(this.shapeType,e,o);s.cfg.data=this.data,s.cfg.origin=e,s.cfg.element=this,this.syncShapeStyle(a,s,this.getStates(),this.getAnimateCfg("update"))}},t.prototype.destroy=function(){var e=this,i=e.shapeFactory,n=e.shape;if(n){var a=this.getAnimateCfg("leave");a?Dc(n,a,{coordinate:i.coordinate,toAttrs:S({},n.attr())}):n.remove(!0)}this.states=[],this.shapeFactory=void 0,this.container=void 0,this.shape=void 0,this.animate=void 0,this.geometry=void 0,this.labelShape=[],this.model=void 0,this.data=void 0,this.offscreenGroup=void 0,this.statesStyle=void 0,r.prototype.destroy.call(this)},t.prototype.changeVisible=function(e){r.prototype.changeVisible.call(this,e),e?(this.shape&&this.shape.show(),this.labelShape&&this.labelShape.forEach(function(i){i.show()})):(this.shape&&this.shape.hide(),this.labelShape&&this.labelShape.forEach(function(i){i.hide()}))},t.prototype.setState=function(e,i){var n=this,a=n.states,o=n.shapeFactory,s=n.model,l=n.shape,u=n.shapeType,c=a.indexOf(e);if(i){if(c>-1)return;a.push(e),(e==="active"||e==="selected")&&(l==null||l.toFront())}else{if(c===-1)return;if(a.splice(c,1),e==="active"||e==="selected"){var h=this.geometry,f=h.sortZIndex,d=h.zIndexReversed,v=d?this.geometry.elements.length-this.elementIndex:this.elementIndex;f?l.setZIndex(v):l.set("zIndex",v)}}var p=o.drawShape(u,s,this.getOffscreenGroup());a.length?this.syncShapeStyle(l,p,a,null):this.syncShapeStyle(l,p,["reset"],null),p.remove(!0);var g={state:e,stateStatus:i,element:this,target:this.container};this.container.emit("statechange",g),$S(this.shape,"statechange",g)},t.prototype.clearStates=function(){var e=this,i=this.states;I(i,function(n){e.setState(n,!1)}),this.states=[]},t.prototype.hasState=function(e){return this.states.includes(e)},t.prototype.getStates=function(){return this.states},t.prototype.getData=function(){return this.data},t.prototype.getModel=function(){return this.model},t.prototype.getBBox=function(){var e=this,i=e.shape,n=e.labelShape,a={x:0,y:0,minX:0,minY:0,maxX:0,maxY:0,width:0,height:0};return i&&(a=i.getCanvasBBox()),n&&n.forEach(function(o){var s=o.getCanvasBBox();a.x=Math.min(s.x,a.x),a.y=Math.min(s.y,a.y),a.minX=Math.min(s.minX,a.minX),a.minY=Math.min(s.minY,a.minY),a.maxX=Math.max(s.maxX,a.maxX),a.maxY=Math.max(s.maxY,a.maxY)}),a.width=a.maxX-a.minX,a.height=a.maxY-a.minY,a},t.prototype.getStatesStyle=function(){if(!this.statesStyle){var e=this,i=e.shapeType,n=e.geometry,a=e.shapeFactory,o=n.stateOption,s=a.defaultShapeType,l=a.theme[i]||a.theme[s];this.statesStyle=at({},l,o)}return this.statesStyle},t.prototype.getStateStyle=function(e,i){var n=this.getStatesStyle(),a=P(n,[e,"style"],{}),o=a[i]||a;return ot(o)?o(this):o},t.prototype.getAnimateCfg=function(e){var i=this,n=this.animate;if(n){var a=n[e];return a&&S(S({},a),{callback:function(){var o;ot(a.callback)&&a.callback(),(o=i.geometry)===null||o===void 0||o.emit(Vs.AFTER_DRAW_ANIMATE)}})}return null},t.prototype.drawShape=function(e,i){var n;i===void 0&&(i=!1);var a=this,o=a.shapeFactory,s=a.container,l=a.shapeType;if(this.shape=o.drawShape(l,e,s),this.shape){this.setShapeInfo(this.shape,e);var u=this.shape.cfg.name;u?mt(u)&&(this.shape.cfg.name=["element",u]):this.shape.cfg.name=["element",this.shapeFactory.geometryType];var c=i?"enter":"appear",h=this.getAnimateCfg(c);h&&((n=this.geometry)===null||n===void 0||n.emit(Vs.BEFORE_DRAW_ANIMATE),Dc(this.shape,h,{coordinate:o.coordinate,toAttrs:S({},this.shape.attr())}))}},t.prototype.getOffscreenGroup=function(){if(!this.offscreenGroup){var e=this.container.getGroupBase();this.offscreenGroup=new e({})}return this.offscreenGroup},t.prototype.setShapeInfo=function(e,i){var n=this;if(e.cfg.origin=i,e.cfg.element=this,e.isGroup()){var a=e.get("children");a.forEach(function(o){n.setShapeInfo(o,i)})}},t.prototype.syncShapeStyle=function(e,i,n,a,o){var s=this,l;if(n===void 0&&(n=[]),o===void 0&&(o=0),!(!e||!i)){var u=e.get("clipShape"),c=i.get("clipShape");if(this.syncShapeStyle(u,c,n,a),e.isGroup())for(var h=e.get("children"),f=i.get("children"),d=0;d<h.length;d++)this.syncShapeStyle(h[d],f[d],n,a,o+d);else{if(!Mi(n)&&!qt(n,["reset"])){var v=e.get("name");q(v)&&(v=v[1]),I(n,function(g){if(i.get("name")!==sA){var m=s.getStateStyle(g,v||o);i.attr(m)}})}var p=z4(e,i);this.animate?a?((l=this.geometry)===null||l===void 0||l.emit(Vs.BEFORE_DRAW_ANIMATE),Dc(e,a,{coordinate:this.shapeFactory.coordinate,toAttrs:p,shapeModel:this.model})):Mi(n)?e.attr(p):(e.stopAnimate(),e.animate(p,{duration:300})):e.attr(p)}}},t.prototype.getShapeType=function(e){var i=P(e,"shape");return q(i)?i[0]:i},t}(OS),mN={},yN={};function fht(r){return mN[r.toLowerCase()]}function Xv(r,t){mN[r.toLowerCase()]=t}function dht(r){return yN[r.toLowerCase()]}function un(r,t){yN[r.toLowerCase()]=t}var vht={coordinate:null,defaultShapeType:null,theme:null,getShapePoints:function(r,t){var e=this.getShape(r);return e.getPoints?e.getPoints(t):this.getDefaultPoints(t)},getShape:function(r){var t=this[r]||this[this.defaultShapeType];return t.coordinate=this.coordinate,t},getDefaultPoints:function(){return[]},getDefaultStyle:function(r){return P(r,[this.defaultShapeType,"default","style"],{})},getMarker:function(r,t){var e=this.getShape(r);if(!e.getMarker){var i=this.defaultShapeType;e=this.getShape(i)}var n=this.theme,a=P(n,[r,"default"],{}),o=e.getMarker(t);return at({},a,o)},drawShape:function(r,t,e){var i=this.getShape(r);return i.draw(t,e)}},pht={coordinate:null,parsePath:function(r){var t=this.coordinate,e=_ct(r);return t.isPolar?e=gct(t,e):e=pct(t,e),e},parsePoint:function(r){var t=this.coordinate;return t.convert(r)},parsePoints:function(r){var t=this.coordinate;return r.map(function(e){return t.convert(e)})},draw:function(r,t){}},lA={};function dl(r,t){var e=fl(r),i=S(S(S({},vht),t),{geometryType:r});return lA[e]=i,i}function de(r,t,e){var i=fl(r),n=lA[i],a=S(S({},pht),e);return n[t]=a,a}function B3(r){var t=fl(r);return lA[t]}function ght(r,t,e){var i,n;if(e===void 0&&(e={}),!t)return[r];var a=bS(r,t),o=[];if(t.length===1&&e[t[0]]){var s=e[t[0]];try{for(var l=Qt(s),u=l.next();!u.done;u=l.next()){var c=u.value,h=a["_".concat(c)];h&&o.push(h)}}catch(v){i={error:v}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(i)throw i.error}}}else for(var f in a)if(a.hasOwnProperty(f)){var d=a[f];o.push(d)}return o}function _N(r,t){return Tv(["color","shape","size","x","y","isInCircle","data","style","defaultStyle","points","mappingData"],function(e){return!qt(r[e],t[e])})}function xf(r){return q(r)?r:r.split("*")}function xN(r,t){for(var e=[],i=[],n=[],a=new Map,o=0;o<t.length;o++){var s=t[o];r[s]?i.push(s):e.push(s),a.set(s,!0)}return Object.keys(r).forEach(function(l){a.has(l)||n.push(l)}),{added:e,updated:i,removed:n}}var vl=function(r){N(t,r);function t(e){var i=r.call(this,e)||this;i.type="base",i.attributes={},i.elements=[],i.elementsMap={},i.animateOption=!0,i.attributeOption={},i.lastElementsMap={},i.generatePoints=!1,i.beforeMappingData=null,i.adjusts={},i.idFields=[],i.hasSorted=!1,i.isCoordinateChanged=!1;var n=e.container,a=e.labelsContainer,o=e.coordinate,s=e.data,l=e.sortable,u=l===void 0?!1:l,c=e.visible,h=c===void 0?!0:c,f=e.theme,d=e.scales,v=d===void 0?{}:d,p=e.scaleDefs,g=p===void 0?{}:p,m=e.intervalPadding,y=e.dodgePadding,_=e.maxColumnWidth,x=e.minColumnWidth,C=e.columnWidthRatio,A=e.roseWidthRatio,b=e.multiplePieWidthRatio,R=e.zIndexReversed,M=e.sortZIndex,O=e.useDeferredLabel;return i.container=n,i.labelsContainer=a,i.coordinate=o,i.data=s,i.sortable=u,i.visible=h,i.userTheme=f,i.scales=v,i.scaleDefs=g,i.intervalPadding=m,i.dodgePadding=y,i.maxColumnWidth=_,i.minColumnWidth=x,i.columnWidthRatio=C,i.roseWidthRatio=A,i.multiplePieWidthRatio=b,i.zIndexReversed=R,i.sortZIndex=M,i.useDeferredLabel=O?typeof O=="number"?O:1/0:null,i}return t.prototype.position=function(e){var i=e;Ra(e)||(i={fields:xf(e)});var n=P(i,"fields");return n.length===1&&(n.unshift("1"),or(i,"fields",n)),or(this.attributeOption,"position",i),this},t.prototype.color=function(e,i){return this.createAttrOption("color",e,i),this},t.prototype.shape=function(e,i){return this.createAttrOption("shape",e,i),this},t.prototype.size=function(e,i){return this.createAttrOption("size",e,i),this},t.prototype.adjust=function(e){var i=e;return(mt(e)||Ra(e))&&(i=[e]),I(i,function(n,a){ie(n)||(i[a]={type:n})}),this.adjustOption=i,this},t.prototype.style=function(e,i){if(mt(e)){var n=xf(e);this.styleOption={fields:n,callback:i}}else{var a=e,n=a.fields,o=a.callback,s=a.cfg;n||o||s?this.styleOption=e:this.styleOption={cfg:e}}return this},t.prototype.tooltip=function(e,i){if(mt(e)){var n=xf(e);this.tooltipOption={fields:n,callback:i}}else this.tooltipOption=e;return this},t.prototype.animate=function(e){return this.animateOption=e,this},t.prototype.label=function(e,i,n){if(mt(e)){var a={},o=xf(e);a.fields=o,ot(i)?a.callback=i:Ra(i)&&(a.cfg=i),n&&(a.cfg=n),this.labelOption=a}else this.labelOption=e;return this},t.prototype.state=function(e){return this.stateOption=e,this},t.prototype.customInfo=function(e){return this.customOption=e,this},t.prototype.init=function(e){e===void 0&&(e={}),this.setCfg(e),this.initAttributes(),this.processData(this.data),this.adjustScale()},t.prototype.update=function(e){e===void 0&&(e={});var i=e.data,n=e.isDataChanged,a=e.isCoordinateChanged,o=this,s=o.attributeOption,l=o.lastAttributeOption;qt(s,l)?i&&(n||!qt(i,this.data))?(this.setCfg(e),this.initAttributes(),this.processData(i)):this.setCfg(e):this.init(e),this.adjustScale(),this.isCoordinateChanged=a},t.prototype.paint=function(e){var i=this;e===void 0&&(e=!1),this.animateOption&&(this.animateOption=at({},pN(this.type,this.coordinate),this.animateOption)),this.defaultSize=void 0,this.elementsMap={},this.elements=[];var n=this.getOffscreenGroup();n.clear();var a=this.beforeMappingData,o=this.beforeMapping(a);this.dataArray=new Array(o.length);for(var s=0;s<o.length;s++){var l=o[s];this.dataArray[s]=this.mapping(l)}if(this.updateElements(this.dataArray,e),this.lastElementsMap=this.elementsMap,this.canDoGroupAnimation(e)){var u=this.container,c=this.type,h=this.coordinate,f=P(this.animateOption,"appear"),d=this.getYScale(),v=h.convert({x:0,y:d.scale(this.getYMinValue())});hht(u,f,c,h,v)}if(this.labelOption){var p=this.useDeferredLabel,g=(function(){return i.renderLabels(en(i.dataArray),e)}).bind(this);if(typeof p=="number"){var m=typeof p=="number"&&p!==1/0?p:0;if(!window.requestIdleCallback)setTimeout(g,m);else{var y=m&&m!==1/0?{timeout:m}:void 0;window.requestIdleCallback(g,y)}}else g()}this.lastAttributeOption=S({},this.attributeOption),this.visible===!1&&this.changeVisible(!1)},t.prototype.clear=function(){var e=this,i=e.container,n=e.geometryLabel,a=e.offscreenGroup;i&&i.clear(),n&&n.clear(),a&&a.clear(),this.scaleDefs=void 0,this.attributes={},this.scales={},this.elementsMap={},this.lastElementsMap={},this.elements=[],this.adjusts={},this.dataArray=null,this.beforeMappingData=null,this.lastAttributeOption=void 0,this.defaultSize=void 0,this.idFields=[],this.groupScales=void 0,this.hasSorted=!1,this.isCoordinateChanged=!1},t.prototype.destroy=function(){this.clear();var e=this.container;e.remove(!0),this.offscreenGroup&&(this.offscreenGroup.remove(!0),this.offscreenGroup=null),this.geometryLabel&&(this.geometryLabel.destroy(),this.geometryLabel=null),this.theme=void 0,this.shapeFactory=void 0,r.prototype.destroy.call(this)},t.prototype.getGroupScales=function(){return this.groupScales},t.prototype.getAttribute=function(e){return this.attributes[e]},t.prototype.getXScale=function(){return this.getAttribute("position").scales[0]},t.prototype.getYScale=function(){return this.getAttribute("position").scales[1]},t.prototype.getGroupAttributes=function(){var e=[];return I(this.attributes,function(i){Cc.includes(i.type)&&e.push(i)}),e},t.prototype.getDefaultValue=function(e){var i,n=this.getAttribute(e);return n&&Mi(n.scales)&&(i=n.values[0]),i},t.prototype.getAttributeValues=function(e,i){for(var n=[],a=e.scales,o=0,s=a.length;o<s;o++){var l=a[o],u=l.field;l.isIdentity?n.push(l.values):n.push(i[u])}return e.mapping.apply(e,xt([],ct(n),!1))},t.prototype.getAdjust=function(e){return this.adjusts[e]},t.prototype.getCoordinate=function(){return this.coordinate},t.prototype.getData=function(){return this.data},t.prototype.getShapeMarker=function(e,i){var n=this.getShapeFactory();return n.getMarker(e,i)},t.prototype.getElementsBy=function(e){return this.elements.filter(function(i){return e(i)})},t.prototype.getElements=function(){return this.elements},t.prototype.getElementId=function(e){e=q(e)?e[0]:e;var i=e[Se];if(this.idFields.length){for(var n=i[this.idFields[0]],a=1;a<this.idFields.length;a++)n+="-"+i[this.idFields[a]];return n}var o=this.type,s=this.getXScale(),l=this.getYScale(),u=s.field||"x",c=l.field||"y",h=i[c],f;s.type==="identity"?f=s.values[0]:f=i[u];var d;o==="interval"||o==="schema"?d="".concat(f):o==="line"||o==="area"||o==="path"?d=o:d="".concat(f,"-").concat(h);for(var v=this.groupScales,a=0,p=v.length;a<p;a++){var g=v[a],m=g.field;d="".concat(d,"-").concat(i[m])}var y=this.getAdjust("dodge");if(y){var _=y.dodgeBy;_&&(d="".concat(d,"-").concat(i[_]))}return this.getAdjust("jitter")&&(d="".concat(d,"-").concat(e.x,"-").concat(e.y)),d},t.prototype.getScaleFields=function(){var e=[],i=new Map,n=this,a=n.attributeOption,o=n.labelOption,s=n.tooltipOption;for(var l in a)if(a.hasOwnProperty(l)){var u=a[l];u.fields?Ds(u.fields,e,i):u.values&&Ds(u.values,e,i)}return o&&o.fields&&Ds(o.fields,e,i),ie(s)&&s.fields&&Ds(s.fields,e,i),e},t.prototype.changeVisible=function(e){r.prototype.changeVisible.call(this,e);for(var i=this.elements,n=0,a=i.length;n<a;n++){var o=i[n];o.changeVisible(e)}e?(this.container&&this.container.show(),this.labelsContainer&&this.labelsContainer.show()):(this.container&&this.container.hide(),this.labelsContainer&&this.labelsContainer.hide())},t.prototype.getFields=function(){var e=new Map,i=[];return Object.values(this.attributeOption).forEach(function(n){var a=(n==null?void 0:n.fields)||[];a.forEach(function(o){e.has(o)||i.push(o),e.set(o,!0)})},[]),i},t.prototype.getGroupFields=function(){for(var e=[],i=new Map,n=0,a=Cc.length;n<a;n++){var o=Cc[n],s=this.attributeOption[o];s&&s.fields&&Ds(s.fields,e,i)}return e},t.prototype.getXYFields=function(){var e=ct(this.attributeOption.position.fields,2),i=e[0],n=e[1];return[i,n]},t.prototype.getXField=function(){return P(this.getXYFields(),[0])},t.prototype.getYField=function(){return P(this.getXYFields(),[1])},t.prototype.getShapes=function(){return this.elements.map(function(e){return e.shape})},t.prototype.getOffscreenGroup=function(){if(!this.offscreenGroup){var e=this.container.getGroupBase();this.offscreenGroup=new e({})}return this.offscreenGroup},t.prototype.sort=function(e){if(!this.hasSorted)for(var i=this.getXScale(),n=i.field,a=0;a<e.length;a++){var o=e[a];o.sort(function(s,l){return i.translate(s[Se][n])-i.translate(l[Se][n])})}this.hasSorted=!0},t.prototype.adjustScale=function(){var e=this.getYScale();e&&this.getAdjust("stack")&&this.updateStackRange(e,this.beforeMappingData)},t.prototype.getShapeFactory=function(){var e=this.shapeType;if(B3(e))return this.shapeFactory||(this.shapeFactory=Rr(B3(e))),this.shapeFactory.coordinate=this.coordinate,this.shapeFactory.theme=this.theme.geometries[e]||{},this.shapeFactory},t.prototype.createShapePointsCfg=function(e){var i=this.getXScale(),n=this.getYScale(),a=this.normalizeValues(e[i.field],i),o;return n?o=this.normalizeValues(e[n.field],n):o=e.y?e.y:.1,{x:a,y:o,y0:n?n.scale(this.getYMinValue()):void 0}},t.prototype.createElement=function(e,i,n){n===void 0&&(n=!1);var a=this.container,o=this.getDrawCfg(e),s=this.getShapeFactory(),l=new gN({shapeFactory:s,container:a,offscreenGroup:this.getOffscreenGroup(),elementIndex:i});return l.animate=this.animateOption,l.geometry=this,l.draw(o,n),l},t.prototype.getDrawCfg=function(e){var i=e[Se],n={mappingData:e,data:i,x:e.x,y:e.y,color:e.color,size:e.size,isInCircle:this.coordinate.isPolar,customInfo:this.customOption},a=e.shape;!a&&this.getShapeFactory()&&(a=this.getShapeFactory().defaultShapeType),n.shape=a;var o=this.theme.geometries[this.shapeType];n.defaultStyle=P(o,[a,"default"],{}).style,!n.defaultStyle&&this.getShapeFactory()&&(n.defaultStyle=this.getShapeFactory().getDefaultStyle(o));var s=this.styleOption;return s&&(n.style=this.getStyleCfg(s,i)),this.generatePoints&&(n.points=e.points,n.nextPoints=e.nextPoints),n},t.prototype.updateElements=function(e,i){var n,a,o,s,l,u;i===void 0&&(i=!1);for(var c=new Map,h=[],f=new Map,d=0,v=0;v<e.length;v++)for(var p=e[v],g=0;g<p.length;g++){var m=p[g],y=this.getElementId(m),_=c.has(y)?"".concat(y,"-").concat(v,"-").concat(g):y;h.push(_),c.set(_,m),f.set(_,d),d++}this.elements=new Array(d);var x=xN(this.lastElementsMap,h),C=x.added,A=x.updated,b=x.removed;try{for(var R=Qt(C),M=R.next();!M.done;M=R.next()){var y=M.value,m=c.get(y),v=f.get(y),O=this.createElement(m,v,i);this.elements[v]=O,this.elementsMap[y]=O,O.shape&&O.shape.set("zIndex",this.zIndexReversed?this.elements.length-v:v)}}catch(V){n={error:V}}finally{try{M&&!M.done&&(a=R.return)&&a.call(R)}finally{if(n)throw n.error}}try{for(var F=Qt(A),D=F.next();!D.done;D=F.next()){var y=D.value,O=this.lastElementsMap[y],m=c.get(y),H=this.getDrawCfg(m),j=O.getModel(),v=f.get(y);(this.isCoordinateChanged||_N(H,j))&&(O.animate=this.animateOption,O.update(H)),this.elements[v]=O,this.elementsMap[y]=O,O.shape&&O.shape.set("zIndex",this.zIndexReversed?this.elements.length-v:v)}}catch(V){o={error:V}}finally{try{D&&!D.done&&(s=F.return)&&s.call(F)}finally{if(o)throw o.error}}this.container&&this.container.sort();try{for(var $=Qt(b),k=$.next();!k.done;k=$.next()){var y=k.value,O=this.lastElementsMap[y];O.animate=this.animateOption,O.destroy()}}catch(V){l={error:V}}finally{try{k&&!k.done&&(u=$.return)&&u.call($)}finally{if(l)throw l.error}}},t.prototype.getLabelType=function(){var e=this,i=e.labelOption,n=e.coordinate,a=e.type,o=n.type,s=n.isTransposed,l=P(i,["cfg","type"]);return l||(o==="polar"?l=s?"pie":"polar":o==="theta"?l="pie":a==="interval"||a==="polygon"?l="interval":l="base"),l},t.prototype.getYMinValue=function(){var e=this.getYScale(),i=e.min,n=e.max,a;return i>=0?a=i:n<=0?a=n:a=0,a},t.prototype.createAttrOption=function(e,i,n){if(K(i)||ie(i))ie(i)&&qt(Object.keys(i),["values"])?or(this.attributeOption,e,{fields:i.values}):or(this.attributeOption,e,i);else{var a={};Tt(i)?a.values=[i]:a.fields=xf(i),n&&(ot(n)?a.callback=n:a.values=n),or(this.attributeOption,e,a)}},t.prototype.initAttributes=function(){var e=this,i=this,n=i.attributes,a=i.attributeOption,o=i.theme,s=i.shapeType;this.groupScales=[];var l={},u=function(f){if(a.hasOwnProperty(f)){var d=a[f];if(!d)return{value:void 0};var v=S({},d),p=v.callback,g=v.values,m=v.fields,y=m===void 0?[]:m,_=y.map(function(C){var A=e.scales[C];if(!l[C]&&Cc.includes(f)){var b=H4(A,P(e.scaleDefs,C),f,e.type);b==="cat"&&(e.groupScales.push(A),l[C]=!0)}return A});v.scales=_,f!=="position"&&_.length===1&&_[0].type==="identity"?v.values=_[0].values:!p&&!g&&(f==="size"?v.values=o.sizes:f==="shape"?v.values=o.shapes[s]||[]:f==="color"&&(_.length?v.values=_[0].values.length<=10?o.colors10:o.colors20:v.values=o.colors10));var x=HS(f);n[f]=new x(v)}};for(var c in a){var h=u(c);if(typeof h=="object")return h.value}},t.prototype.processData=function(e){var i,n;this.hasSorted=!1;for(var a=this.getAttribute("position").scales,o=a.filter(function(b){return b.isCategory}),s=this.groupData(e),l=[],u=0,c=s.length;u<c;u++){for(var h=s[u],f=[],d=0,v=h.length;d<v;d++){var p=h[d],g={};for(var m in p)g[m]=p[m];g[Se]=p;try{for(var y=(i=void 0,Qt(o)),_=y.next();!_.done;_=y.next()){var x=_.value,C=x.field;g[C]=x.translate(g[C])}}catch(b){i={error:b}}finally{try{_&&!_.done&&(n=y.return)&&n.call(y)}finally{if(i)throw i.error}}f.push(g)}l.push(f)}var A=this.adjustData(l);return this.beforeMappingData=A,A},t.prototype.adjustData=function(e){var i=this.adjustOption,n=this,a=n.intervalPadding,o=n.dodgePadding,s=n.theme,l=this.maxColumnWidth||s.maxColumnWidth,u=this.minColumnWidth||s.minColumnWidth,c=this.columnWidthRatio||s.columnWidthRatio,h=e;if(i){var f=this.getXScale(),d=this.getYScale(),v=f.field,p=d?d.field:null,g=Vv(this.coordinate),m=f.values.length,y=this.getAttribute("size"),_=void 0;y&&(_=y.values[0]);for(var x=0,C=i.length;x<C;x++){var A=i[x],b=S({xField:v,yField:p,intervalPadding:a,dodgePadding:o,xDimensionLength:g,groupNum:m,defaultSize:_,maxColumnWidth:l,minColumnWidth:u,columnWidthRatio:c},A),R=A.type;if(R==="dodge"){var M=[];if(f.isCategory||f.type==="identity")M.push("x");else if(!d)M.push("y");else throw new Error("dodge is not support linear attribute, please use category attribute!");b.adjustNames=M,b.dodgeRatio=c}else if(R==="stack"){var O=this.coordinate;if(!d){b.height=O.getHeight();var F=this.getDefaultValue("size")||3;b.size=F}!O.isTransposed&&K(b.reverseOrder)&&(b.reverseOrder=!0)}var D=NS(R);b.dimValuesMap={},f&&f.values&&(b.dimValuesMap[f.field]=f.values.map(function(j){return f.translate(j)}));var H=new D(b);h=H.process(h),this.adjusts[R]=H}}return h},t.prototype.groupData=function(e){for(var i=this.getGroupScales(),n=this.scaleDefs,a={},o=[],s=0;s<i.length;s++){var l=i[s],u=l.field;o.push(u),P(n,[u,"values"])&&(a[u]=n[u].values)}return ght(e,o,a)},t.prototype.updateStackRange=function(e,i){for(var n=en(i),a=e.field,o=e.min,s=e.max,l=0;l<n.length;l++){var u=n[l],c=Math.min.apply(null,u[a]),h=Math.max.apply(null,u[a]);c<o&&(o=c),h>s&&(s=h)}var f=this.scaleDefs,d={};o<e.min&&!P(f,[a,"min"])&&(d.min=o),s>e.max&&!P(f,[a,"max"])&&(d.max=s),e.change(d)},t.prototype.beforeMapping=function(e){var i=e;if(this.sortable&&this.sort(i),this.generatePoints)for(var n=0,a=i.length;n<a;n++){var o=i[n];this.generateShapePoints(o);var s=i[n+1];s&&(this.generateShapePoints(s),o[0].nextPoints=s[0].points)}return i},t.prototype.generateShapePoints=function(e){for(var i=this.getShapeFactory(),n=this.getAttribute("shape"),a=0;a<e.length;a++){var o=e[a],s=this.createShapePointsCfg(o),l=n?this.getAttributeValues(n,o):null,u=i.getShapePoints(l,s);o.points=u}},t.prototype.normalizeValues=function(e,i){var n=[];if(q(e))for(var a=0;a<e.length;a++){var o=e[a];n.push(i.scale(o))}else n=i.scale(e);return n},t.prototype.mapping=function(e){for(var i=this.attributes,n=[],a=0;a<e.length;a++){var o=e[a],s={_origin:o[Se],points:o.points,nextPoints:o.nextPoints};for(var l in i)if(i.hasOwnProperty(l)){var u=i[l],c=u.names,h=this.getAttributeValues(u,o);if(c.length>1)for(var f=0;f<h.length;f+=1){var d=h[f],v=c[f];s[v]=q(d)&&d.length===1?d[0]:d}else s[c[0]]=h.length===1?h[0]:h}this.convertPoint(s),n.push(s)}return n},t.prototype.convertPoint=function(e){var i=e.x,n=e.y,a,o,s,l=this.coordinate;if(q(i)&&q(n)){a=[],o=[];for(var u=0,c=0,h=i.length,f=n.length;u<h&&c<f;u+=1,c+=1)s=l.convert({x:i[u],y:n[c]}),a.push(s.x),o.push(s.y)}else if(q(n)){o=[];for(var d=0;d<n.length;d++){var v=n[d];s=l.convert({x:i,y:v}),a&&a!==s.x?(q(a)||(a=[a]),a.push(s.x)):a=s.x,o.push(s.y)}}else if(q(i)){a=[];for(var d=0;d<i.length;d++){var p=i[d];s=l.convert({x:p,y:n}),o&&o!==s.y?(q(o)||(o=[o]),o.push(s.y)):o=s.y,a.push(s.x)}}else{var g=l.convert({x:i,y:n});a=g.x,o=g.y}e.x=a,e.y=o},t.prototype.getStyleCfg=function(e,i){var n=e.fields,a=n===void 0?[]:n,o=e.callback,s=e.cfg;if(s)return s;var l=a.map(function(u){return i[u]});return o.apply(void 0,xt([],ct(l),!1))},t.prototype.setCfg=function(e){var i=this,n=e.coordinate,a=e.data,o=e.theme,s=e.scaleDefs;n&&(this.coordinate=n),a&&(this.data=a),s&&(this.scaleDefs=s,this.idFields=[],I(s,function(l,u){l&&l.key&&i.idFields.push(u)})),o&&(this.theme=this.userTheme?at({},o,this.userTheme):o)},t.prototype.renderLabels=function(e,i){return i===void 0&&(i=!1),Ti(this,void 0,void 0,function(){var n,a,o,s,l,u,c,h,f,d,v,p,g=this;return ba(this,function(m){switch(m.label){case 0:return n=this.geometryLabel,this.emit(Vs.BEFORE_RENDER_LABEL),n||(a=this.getLabelType(),o=fht(a),n=new o(this),this.geometryLabel=n),[4,n.render(e,i)];case 1:m.sent(),s=n.labelsRenderer.shapesMap,l=new Map,I(s,function(y,_){for(var x=y.getChildren()||[],C=0;C<x.length;C++){var A=x[C],b=g.elementsMap[A.get("elementId")||_.split(" ")[0]];if(b){A.cfg.name=["element","label"],A.cfg.element=b;var R=l.get(b)||new Set;R.add(y),l.set(b,R)}}});try{for(u=Qt(l.entries()),c=u.next();!c.done;c=u.next())h=ct(c.value,2),f=h[0],d=h[1],f.labelShape=xt([],ct(d),!1)}catch(y){v={error:y}}finally{try{c&&!c.done&&(p=u.return)&&p.call(u)}finally{if(v)throw v.error}}return this.emit(Vs.AFTER_RENDER_LABEL),[2]}})})},t.prototype.canDoGroupAnimation=function(e){return!e&&this.animateOption&&(P(this.animateOption,"appear")===void 0||P(this.animateOption,"appear")&&P(this.animateOption,["appear","animation"])===void 0)},t}(OS),fy=dr;function Yv(r,t,e){var i=fy(r.getMatrix(),[["t",t,e]]);r.setMatrix(i)}function mht(r,t){var e=r.attr(),i=e.x,n=e.y,a=fy(r.getMatrix(),[["t",-i,-n],["r",t],["t",i,n]]);return a}function uA(r,t){var e=mht(r,t);r.setMatrix(e)}function yht(r,t){var e=r.getBBox(),i=(e.minX+e.maxX)/2,n=(e.minY+e.maxY)/2;r.applyToMatrix([i,n,1]);var a=fy(r.getMatrix(),[["t",-i,-n],["s",t,t],["t",i,n]]);r.setMatrix(a)}function Ks(r){return r.find(function(t){return t.get("type")==="text"})}function CN(r,t,e){e===void 0&&(e=[0,0,0,0]);var i=r&&r.getChildren()[0];if(i){var n=i.clone();t!=null&&t.rotate&&uA(n,-t.rotate);var a=n.getCanvasBBox(),o=a.x,s=a.y,l=a.width,u=a.height;n.destroy();var c=e;return K(c)?c=[2,2,2,2]:Tt(c)&&(c=new Array(4).fill(c)),{x:o-c[3],y:s-c[0],width:l+c[1]+c[3],height:u+c[0]+c[2],rotation:(t==null?void 0:t.rotate)||0}}return{x:0,y:0,width:0,height:0,rotation:0}}function _ht(r,t,e){e===void 0&&(e=0);var i=Math.max(0,Math.min(r.x+r.width+e,t.x+t.width+e)-Math.max(r.x-e,t.x-e)),n=Math.max(0,Math.min(r.y+r.height+e,t.y+t.height+e)-Math.max(r.y-e,t.y-e));return i*n}function xht(r,t){var e=r.getBBox();return Tv(t,function(i){var n=i.getBBox();return _ht(e,n,2)>0})}function EN(r,t,e){var i=e.data,n=e.origin,a=e.animateCfg,o=e.coordinate,s=P(a,"update");r.set("data",i),r.set("origin",n),r.set("animateCfg",a),r.set("coordinate",o),r.set("visible",t.get("visible")),(r.getChildren()||[]).forEach(function(l,u){var c=t.getChildByIndex(u);if(!c)r.removeChild(l),l.remove(!0);else{l.set("data",i),l.set("origin",n),l.set("animateCfg",a),l.set("coordinate",o);var h=z4(l,c);s?Dc(l,s,{toAttrs:h,coordinate:o}):l.attr(h),c.isGroup()&&EN(l,c,e)}}),I(t.getChildren(),function(l,u){q(r.getChildren())&&u>=r.getCount()&&(l.destroyed||r.add(l))})}var Cht=function(){function r(t){this.shapesMap={};var e=t.layout,i=t.container;this.layout=e,this.container=i}return r.prototype.render=function(t,e,i){return i===void 0&&(i=!1),Ti(this,void 0,void 0,function(){var n,a,o,s,l,u,c,h,f=this;return ba(this,function(d){switch(d.label){case 0:if(n={},a=this.createOffscreenGroup(),!t.length)return[3,2];try{for(o=Qt(t),s=o.next();!s.done;s=o.next())l=s.value,l&&(n[l.id]=this.renderLabel(l,a))}catch(v){c={error:v}}finally{try{s&&!s.done&&(h=o.return)&&h.call(o)}finally{if(c)throw c.error}}return[4,this.doLayout(t,e,n)];case 1:d.sent(),this.renderLabelLine(t,n),this.renderLabelBackground(t,n),this.adjustLabel(t,n),d.label=2;case 2:return u=this.shapesMap,I(n,function(v,p){if(v.destroyed)delete n[p];else{if(u[p]){var g=v.get("data"),m=v.get("origin"),y=v.get("coordinate"),_=v.get("animateCfg"),x=u[p];EN(x,n[p],{data:g,origin:m,animateCfg:_,coordinate:y}),n[p]=x}else{if(f.container.destroyed)return;f.container.add(v);var C=P(v.get("animateCfg"),i?"enter":"appear");C&&Dc(v,C,{toAttrs:S({},v.attr()),coordinate:v.get("coordinate")})}delete u[p]}}),I(u,function(v){var p=P(v.get("animateCfg"),"leave");p?Dc(v,p,{toAttrs:null,coordinate:v.get("coordinate")}):v.remove(!0)}),this.shapesMap=n,a.destroy(),[2]}})})},r.prototype.clear=function(){this.container.clear(),this.shapesMap={}},r.prototype.destroy=function(){this.container.destroy(),this.shapesMap=null},r.prototype.renderLabel=function(t,e){var i=t.id,n=t.elementId,a=t.data,o=t.mappingData,s=t.coordinate,l=t.animate,u=t.content,c=t.capture,h={id:i,elementId:n,capture:c,data:a,origin:S(S({},o),{data:o[Se]}),coordinate:s},f=e.addGroup(S({name:"label",animateCfg:this.animate===!1||l===null||l===!1?!1:at({},this.animate,l)},h)),d;if(u.isGroup&&u.isGroup()||u.isShape&&u.isShape()){var v=u.getCanvasBBox(),p=v.width,g=v.height,m=P(t,"textAlign","left"),y=t.x,_=t.y-g/2;m==="center"?y=y-p/2:(m==="right"||m==="end")&&(y=y-p),Yv(u,y,_),d=u,f.add(u)}else{var x=P(t,["style","fill"]);d=f.addShape("text",S({attrs:S(S({x:t.x,y:t.y,textAlign:t.textAlign,textBaseline:P(t,"textBaseline","middle"),text:t.content},t.style),{fill:l5(x)?t.color:x})},h))}return t.rotate&&uA(d,t.rotate),f},r.prototype.doLayout=function(t,e,i){return Ti(this,void 0,void 0,function(){var n,a=this;return ba(this,function(o){switch(o.label){case 0:return this.layout?(n=q(this.layout)?this.layout:[this.layout],[4,Promise.all(n.map(function(s){var l=dht(P(s,"type",""));if(l){var u=[],c=[];return I(i,function(h,f){u.push(h),c.push(e[h.get("elementId")])}),l(t,u,c,a.region,s.cfg)}}))]):[3,2];case 1:o.sent(),o.label=2;case 2:return[2]}})})},r.prototype.renderLabelLine=function(t,e){I(t,function(i){var n=P(i,"coordinate");if(!(!i||!n)){var a=n.getCenter(),o=n.getRadius();if(i.labelLine){var s=P(i,"labelLine",{}),l=i.id,u=s.path;if(!u){var c=ur(a.x,a.y,o,i.angle);u=[["M",c.x,c.y],["L",i.x,i.y]]}var h=e[l];h.destroyed||h.addShape("path",{capture:!1,attrs:S({path:u,stroke:i.color?i.color:P(i,["style","fill"],"#000"),fill:null},s.style),id:l,origin:i.mappingData,data:i.data,coordinate:i.coordinate})}}})},r.prototype.renderLabelBackground=function(t,e){I(t,function(i){var n=P(i,"coordinate"),a=P(i,"background");if(!(!a||!n)){var o=i.id,s=e[o];if(!s.destroyed){var l=s.getChildren()[0];if(l){var u=CN(s,i,a.padding),c=u.rotation,h=zt(u,["rotation"]),f=s.addShape("rect",{attrs:S(S({},h),a.style||{}),id:o,origin:i.mappingData,data:i.data,coordinate:i.coordinate});if(f.setZIndex(-1),c){var d=l.getMatrix();f.setMatrix(d)}}}}})},r.prototype.createOffscreenGroup=function(){var t=this.container,e=t.getGroupBase(),i=new e({});return i},r.prototype.adjustLabel=function(t,e){I(t,function(i){if(i){var n=i.id,a=e[n];if(!a.destroyed){var o=a.findAll(function(s){return s.get("type")!=="path"});I(o,function(s){s&&(i.offsetX&&s.attr("x",s.attr("x")+i.offsetX),i.offsetY&&s.attr("y",s.attr("y")+i.offsetY))})}}})},r}();function D3(r){var t=0;return I(r,function(e){t+=e}),t/r.length}var dy=function(){function r(t){this.geometry=t}return r.prototype.getLabelItems=function(t){var e=this,i=[],n=this.getLabelCfgs(t);return I(t,function(a,o){var s=n[o];if(!s||K(a.x)||K(a.y)){i.push(null);return}var l=q(s.content)?s.content:[s.content];s.content=l;var u=l.length;I(l,function(c,h){if(K(c)||c===""){i.push(null);return}var f=S(S({},s),e.getLabelPoint(s,a,h));f.textAlign||(f.textAlign=e.getLabelAlign(f,h,u)),f.offset<=0&&(f.labelLine=null),i.push(f)})}),i},r.prototype.render=function(t,e){return e===void 0&&(e=!1),Ti(this,void 0,void 0,function(){var i,n,a;return ba(this,function(o){switch(o.label){case 0:return i=this.getLabelItems(t),n=this.getLabelsRenderer(),a=this.getGeometryShapes(),[4,n.render(i,a,e)];case 1:return o.sent(),[2]}})})},r.prototype.clear=function(){var t=this.labelsRenderer;t&&t.clear()},r.prototype.destroy=function(){var t=this.labelsRenderer;t&&t.destroy(),this.labelsRenderer=null},r.prototype.getCoordinate=function(){return this.geometry.coordinate},r.prototype.getDefaultLabelCfg=function(t,e){var i=this.geometry,n=i.type,a=i.theme;return n==="polygon"||n==="interval"&&e==="middle"||t<0&&!["line","point","path"].includes(n)?P(a,"innerLabels",{}):P(a,"labels",{})},r.prototype.getThemedLabelCfg=function(t){var e=this.geometry,i=this.getDefaultLabelCfg(),n=e.type,a=e.theme,o;return n==="polygon"||t.offset<0&&!["line","point","path"].includes(n)?o=at({},i,a.innerLabels,t):o=at({},i,a.labels,t),o},r.prototype.setLabelPosition=function(t,e,i,n){},r.prototype.getLabelOffset=function(t){var e=this.getCoordinate(),i=this.getOffsetVector(t);return e.isTransposed?i[0]:i[1]},r.prototype.getLabelOffsetPoint=function(t,e,i){var n=t.offset,a=this.getCoordinate(),o=a.isTransposed,s=o?"x":"y",l=o?1:-1,u={x:0,y:0};return e>0||i===1?u[s]=n*l:u[s]=n*l*-1,u},r.prototype.getLabelPoint=function(t,e,i){var n=this.getCoordinate(),a=t.content.length;function o(g,m,y){y===void 0&&(y=!1);var _=g;return q(_)&&(t.content.length===1?y?_=D3(_):_.length<=2?_=_[g.length-1]:_=D3(_):_=_[m]),_}var s={content:t.content[i],x:0,y:0,start:{x:0,y:0},color:"#fff"},l=q(e.shape)?e.shape[0]:e.shape,u=l==="funnel"||l==="pyramid";if(this.geometry.type==="polygon"){var c=jut(e.x,e.y);s.x=c[0],s.y=c[1]}else this.geometry.type==="interval"&&!u?(s.x=o(e.x,i,!0),s.y=o(e.y,i)):(s.x=o(e.x,i),s.y=o(e.y,i));if(u){var h=P(e,"nextPoints"),f=P(e,"points");if(h){var d=n.convert(f[1]),v=n.convert(h[1]);s.x=(d.x+v.x)/2,s.y=(d.y+v.y)/2}else if(l==="pyramid"){var d=n.convert(f[1]),v=n.convert(f[2]);s.x=(d.x+v.x)/2,s.y=(d.y+v.y)/2}}t.position&&this.setLabelPosition(s,e,i,t.position);var p=this.getLabelOffsetPoint(t,i,a);return s.start={x:s.x,y:s.y},s.x+=p.x,s.y+=p.y,s.color=e.color,s},r.prototype.getLabelAlign=function(t,e,i){var n="center",a=this.getCoordinate();if(a.isTransposed){var o=t.offset;o<0?n="right":o===0?n="center":n="left",i>1&&e===0&&(n==="right"?n="left":n==="left"&&(n="right"))}return n},r.prototype.getLabelId=function(t){var e=this.geometry,i=e.type,n=e.getXScale(),a=e.getYScale(),o=t[Se],s=e.getElementId(t);return i==="line"||i==="area"?s+=" ".concat(o[n.field]):i==="path"&&(s+=" ".concat(o[n.field],"-").concat(o[a.field])),s},r.prototype.getLabelsRenderer=function(){var t=this.geometry,e=t.labelsContainer,i=t.labelOption,n=t.canvasRegion,a=t.animateOption,o=this.geometry.coordinate,s=this.labelsRenderer;return s||(s=new Cht({container:e,layout:P(i,["cfg","layout"],{type:this.defaultLayout})}),this.labelsRenderer=s),s.region=n,s.animate=a?pN("label",o):!1,s},r.prototype.getLabelCfgs=function(t){var e=this,i=this.geometry,n=i.labelOption,a=i.scales,o=i.coordinate,s=n,l=s.fields,u=s.callback,c=s.cfg,h=l.map(function(d){return a[d]}),f=[];return I(t,function(d,v){var p=d[Se],g=e.getLabelText(p,h),m;if(u){var y=l.map(function(b){return p[b]});if(m=u.apply(void 0,xt([],ct(y),!1)),K(m)){f.push(null);return}}var _=S(S({id:e.getLabelId(d),elementId:e.geometry.getElementId(d),data:p,mappingData:d,coordinate:o},c),m);ot(_.position)&&(_.position=_.position(p,d,v));var x=e.getLabelOffset(_.offset||0),C=e.getDefaultLabelCfg(x,_.position);_=at({},C,_),_.offset=e.getLabelOffset(_.offset||0);var A=_.content;ot(A)?_.content=A(p,d,v):zr(A)&&(_.content=g[0]),f.push(_)}),f},r.prototype.getLabelText=function(t,e){var i=[];return I(e,function(n){var a=t[n.field];q(a)?a=a.map(function(o){return n.getText(o)}):a=n.getText(a),K(a)||a===""?i.push(null):i.push(a)}),i},r.prototype.getOffsetVector=function(t){t===void 0&&(t=0);var e=this.getCoordinate(),i=0;return Tt(t)&&(i=t),e.isTransposed?e.applyMatrix(i,0):e.applyMatrix(0,i)},r.prototype.getGeometryShapes=function(){var t=this.geometry,e={};return I(t.elementsMap,function(i,n){e[n]=i.shape}),I(t.getOffscreenGroup().getChildren(),function(i){var n=t.getElementId(i.get("origin").mappingData);e[n]=i}),e},r}();function qx(r,t,e){if(!r)return e;var i;if(r.callback&&r.callback.length>1){var n=Array(r.callback.length-1).fill("");i=r.mapping.apply(r,xt([t],ct(n),!1)).join("")}else i=r.mapping(t).join("");return i||e}var mu={hexagon:function(r,t,e){var i=e/2*Math.sqrt(3);return[["M",r,t-e],["L",r+i,t-e/2],["L",r+i,t+e/2],["L",r,t+e],["L",r-i,t+e/2],["L",r-i,t-e/2],["Z"]]},bowtie:function(r,t,e){var i=e-1.5;return[["M",r-e,t-i],["L",r+e,t+i],["L",r+e,t-i],["L",r-e,t+i],["Z"]]},cross:function(r,t,e){return[["M",r-e,t-e],["L",r+e,t+e],["M",r+e,t-e],["L",r-e,t+e]]},tick:function(r,t,e){return[["M",r-e/2,t-e],["L",r+e/2,t-e],["M",r,t-e],["L",r,t+e],["M",r-e/2,t+e],["L",r+e/2,t+e]]},plus:function(r,t,e){return[["M",r-e,t],["L",r+e,t],["M",r,t-e],["L",r,t+e]]},hyphen:function(r,t,e){return[["M",r-e,t],["L",r+e,t]]},line:function(r,t,e){return[["M",r,t-e],["L",r,t+e]]}},Eht=["line","cross","tick","plus","hyphen"];function Sht(r,t){return ot(t)?t(r):at({},r,t)}function Aht(r,t){var e=r.symbol;if(mt(e)&&Eht.indexOf(e)!==-1){var i=P(r,"style",{}),n=P(i,"lineWidth",1),a=i.stroke||i.fill||t;r.style=at({},r.style,{lineWidth:n,stroke:a,fill:null})}}function SN(r){var t=r.symbol;mt(t)&&mu[t]&&(r.symbol=mu[t])}function n1(r){return r.startsWith(nt.LEFT)||r.startsWith(nt.RIGHT)?"vertical":"horizontal"}function AN(r,t,e,i,n){var a=e.getScale(e.type);if(a.isCategory){var o=a.field,s=t.getAttribute("color"),l=t.getAttribute("shape"),u=r.getTheme().defaultColor,c=t.coordinate.isPolar;return a.getTicks().map(function(h,f){var d,v=h.text,p=h.value,g=v,m=a.invert(p),y=r.filterFieldData(o,[(d={},d[o]=m,d)]).length===0;I(r.views,function(b){var R;b.filterFieldData(o,[(R={},R[o]=m,R)]).length||(y=!0)});var _=qx(s,m,u),x=qx(l,m,"point"),C=t.getShapeMarker(x,{color:_,isInPolar:c}),A=n;return ot(A)&&(A=A(g,f,S({name:g,value:m},at({},i,C)))),C=at({},i,C,$i(S({},A),["style"])),Aht(C,_),A&&A.style&&(C.style=Sht(C.style,A.style)),SN(C),{id:m,name:g,value:m,marker:C,unchecked:y}})}return[]}function Tht(r,t,e){return e.map(function(i,n){var a=t;ot(a)&&(a=a(i.name,n,at({},r,i)));var o=ot(i.marker)?i.marker(i.name,n,at({},r,i)):i.marker,s=at({},r,a,o);return SN(s),i.marker=s,i})}function N3(r,t){var e=P(r,["components","legend"],{});return at({},P(e,["common"],{}),at({},P(e,[t],{})))}function a1(r){return r?!1:r==null||isNaN(r)}function k3(r){if(q(r))return a1(r[1].y);var t=r.y;return q(t)?a1(t[0]):a1(t)}function vy(r,t,e){if(t===void 0&&(t=!1),e===void 0&&(e=!0),!r.length||r.length===1&&!e)return[];if(t){for(var i=[],n=0,a=r.length;n<a;n++){var o=r[n];k3(o)||i.push(o)}return[i]}for(var s=[],l=[],n=0,a=r.length;n<a;n++){var o=r[n];k3(o)?l.length&&(l.length===1&&!e||s.push(l),l=[]):l.push(o)}return l.length&&s.push(l),s}function TN(r){for(var t=[],e=0;e<r.length;e++){var i=r[e];if(i){var n=e===0?"M":"L";t.push([n,i.x,i.y])}}var a=r[0];return a&&(t.push(["L",a.x,a.y]),t.push(["z"])),t}function bN(r){for(var t=r.length/2,e=[],i=[],n=0;n<r.length;n++)n<t?e.push(r[n]):i.push(r[n]);var a=j0(e,!1),o=j0(i,!1);i.length&&a.push(["L",i[0].x,i[0].y]),o.shift();var s=a.concat(o);return e.length&&s.push(["L",e[0].x,e[0].y]),s.push(["z"]),s}function nr(r,t,e,i){i===void 0&&(i="");var n=r.style,a=n===void 0?{}:n,o=r.defaultStyle,s=r.color,l=r.size,u=S(S({},o),a);return s&&(t&&(a.stroke||(u.stroke=s)),e&&(a.fill||(u.fill=s))),i&&K(a[i])&&!K(l)&&(u[i]=l),u}function wN(r){return at({},{fill:"#CCD6EC",fillOpacity:.3},P(r,["background","style"]))}function cA(r){var t=r.x,e=q(r.y)?r.y:[r.y];return e.map(function(i,n){return{x:q(t)?t[n]:t,y:i}})}var bht={line:function(r,t,e){return[["M",r-e,t],["L",r+e,t]]},dot:function(r,t,e){return[["M",r-e,t],["L",r+e,t]]},dash:function(r,t,e){return[["M",r-e,t],["L",r+e,t]]},smooth:function(r,t,e){return[["M",r-e,t],["A",e/2,e/2,0,1,1,r,t],["A",e/2,e/2,0,1,0,r+e,t]]},hv:function(r,t,e){return[["M",r-e-1,t-2.5],["L",r,t-2.5],["L",r,t+2.5],["L",r+e+1,t+2.5]]},vh:function(r,t,e){return[["M",r-e-1,t+2.5],["L",r,t+2.5],["L",r,t-2.5],["L",r+e+1,t-2.5]]},hvh:function(r,t,e){return[["M",r-(e+1),t+2.5],["L",r-e/2,t+2.5],["L",r-e/2,t-2.5],["L",r+e/2,t-2.5],["L",r+e/2,t+2.5],["L",r+e+1,t+2.5]]},vhv:function(r,t){return[["M",r-5,t+2.5],["L",r-5,t],["L",r,t],["L",r,t-3],["L",r,t+3],["L",r+6.5,t+3]]}};function RN(r,t){var e=r.color;return{symbol:bht[t],style:{lineWidth:2,r:6,stroke:e}}}function wht(r,t,e){for(var i=r.isStack,n=r.connectNulls,a=r.isInCircle,o=r.showSinglePoint,s=nr(r,!0,!1,"lineWidth"),l=vy(r.points,n,o),u=[],c=0,h=l.length;c<h;c++){var f=l[c];u=u.concat(MN(f,a,i,t,e,s))}return s.path=u,s}function Kx(r,t,e,i,n){if(r.length===1)return[["M",r[0].x,r[0].y-n.lineWidth/2],["L",r[0].x,r[0].y],["L",r[0].x,r[0].y+n.lineWidth/2]];var a;return e?(t&&r.length&&r.push({x:r[0].x,y:r[0].y}),a=j0(r,!1,i)):(a=Gv(r,!1),t&&a.push(["Z"])),a}function Rht(r,t,e,i,n,a){var o=[],s=[];I(r,function(c){var h=cA(c);o.push(h[1]),s.push(h[0])});var l=Kx(o,t,i,n,a),u=Kx(s,t,i,n,a);return e?l:l.concat(u)}function MN(r,t,e,i,n,a){if(r.length){var o=r[0];return q(o.y)?Rht(r,t,e,i,n,a):Kx(r,t,i,n,a)}return[]}dl("line",{defaultShapeType:"line"});I(["line","dot","dash","smooth"],function(r){de("line",r,{draw:function(t,e){var i=r==="smooth",n;if(i){var a=this.coordinate,o=a.start,s=a.end;n=[[o.x,s.y],[s.x,o.y]]}var l=wht(t,i,n),u=e.addShape({type:"path",attrs:l,name:"line",capture:!i});return u},getMarker:function(t){return RN(t,r)}})});var nn={getLegendItems:AN,translate:Yv,rotate:uA,zoom:yht,transform:fy,getAngle:Md,getSectorPath:Xs,polarToCartesian:ur,getDelegationObject:gu,getTooltipItems:nA,getMappingValue:qx,getPath:MN,getPathPoints:vy},Ts={100:"#000",95:"#0D0D0D",85:"#262626",65:"#595959",45:"#8C8C8C",25:"#BFBFBF",15:"#D9D9D9",6:"#F0F0F0"},Ee={100:"#FFFFFF",95:"#F2F2F2",85:"#D9D9D9",65:"#A6A6A6",45:"#737373",25:"#404040",15:"#262626",6:"#0F0F0F"},va=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#E86452","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],Mht=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#E86452","#F8D0CB","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],Iht=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"],Lht=function(r){r===void 0&&(r={});var t=r.paletteQualitative10,e=t===void 0?va:t,i=r.paletteQualitative20,n=i===void 0?Mht:i,a=r.brandColor,o=a===void 0?e[0]:a,s={backgroundColor:"#141414",brandColor:o,subColor:"rgba(255,255,255,0.05)",paletteQualitative10:e,paletteQualitative20:n,paletteSemanticRed:"#F4664A",paletteSemanticGreen:"#30BF78",paletteSemanticYellow:"#FAAD14",paletteSequence:Iht,fontFamily:`"Segoe UI", Roboto, "Helvetica Neue", Arial,
    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
    "Noto Color Emoji"`,axisLineBorderColor:Ee[25],axisLineBorder:1,axisLineDash:null,axisTitleTextFillColor:Ee[65],axisTitleTextFontSize:12,axisTitleTextLineHeight:12,axisTitleTextFontWeight:"normal",axisTitleSpacing:12,axisDescriptionIconFillColor:Ts[85],axisTickLineBorderColor:Ee[25],axisTickLineLength:4,axisTickLineBorder:1,axisSubTickLineBorderColor:Ee[15],axisSubTickLineLength:2,axisSubTickLineBorder:1,axisLabelFillColor:Ee[45],axisLabelFontSize:12,axisLabelLineHeight:12,axisLabelFontWeight:"normal",axisLabelOffset:8,axisGridBorderColor:Ee[15],axisGridBorder:1,axisGridLineDash:null,legendTitleTextFillColor:Ee[45],legendTitleTextFontSize:12,legendTitleTextLineHeight:21,legendTitleTextFontWeight:"normal",legendMarkerColor:va[0],legendMarkerSpacing:8,legendMarkerSize:4,legendCircleMarkerSize:4,legendSquareMarkerSize:4,legendLineMarkerSize:5,legendItemNameFillColor:Ee[65],legendItemNameFontSize:12,legendItemNameLineHeight:12,legendItemNameFontWeight:"normal",legendItemSpacing:24,legendItemMarginBottom:12,legendSpacing:16,legendPadding:[8,8,8,8],legendHorizontalPadding:[8,0,8,0],legendVerticalPadding:[0,8,0,8],legendPageNavigatorMarkerSize:12,legendPageNavigatorMarkerInactiveFillColor:Ee[45],legendPageNavigatorMarkerInactiveFillOpacity:.45,legendPageNavigatorMarkerFillColor:Ee[45],legendPageNavigatorMarkerFillOpacity:1,legendPageNavigatorTextFillColor:Ee[65],legendPageNavigatorTextFontSize:12,sliderRailFillColor:Ee[15],sliderRailBorder:0,sliderRailBorderColor:null,sliderRailWidth:100,sliderRailHeight:12,sliderLabelTextFillColor:Ee[45],sliderLabelTextFontSize:12,sliderLabelTextLineHeight:12,sliderLabelTextFontWeight:"normal",sliderHandlerFillColor:Ts[6],sliderHandlerWidth:10,sliderHandlerHeight:14,sliderHandlerBorder:1,sliderHandlerBorderColor:Ts[25],annotationArcBorderColor:Ee[15],annotationArcBorder:1,annotationLineBorderColor:Ee[25],annotationLineBorder:1,annotationLineDash:null,annotationTextFillColor:Ee[65],annotationTextFontSize:12,annotationTextLineHeight:12,annotationTextFontWeight:"normal",annotationTextBorderColor:null,annotationTextBorder:0,annotationRegionFillColor:Ee[100],annotationRegionFillOpacity:.06,annotationRegionBorder:0,annotationRegionBorderColor:null,annotationDataMarkerLineLength:16,tooltipCrosshairsBorderColor:Ee[25],tooltipCrosshairsBorder:1,tooltipCrosshairsLineDash:null,tooltipContainerFillColor:"#1f1f1f",tooltipContainerFillOpacity:.95,tooltipContainerShadow:"0px 2px 4px rgba(0,0,0,.5)",tooltipContainerBorderRadius:3,tooltipTextFillColor:Ee[65],tooltipTextFontSize:12,tooltipTextLineHeight:12,tooltipTextFontWeight:"bold",labelFillColor:Ee[65],labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,labelLineHeight:12,labelFontWeight:"normal",labelBorderColor:null,labelBorder:0,innerLabelFillColor:Ts[100],innerLabelFontSize:12,innerLabelLineHeight:12,innerLabelFontWeight:"normal",innerLabelBorderColor:null,innerLabelBorder:0,overflowLabelFillColor:Ee[65],overflowLabelFillColorDark:"#2c3542",overflowLabelFillColorLight:"#ffffff",overflowLabelFontSize:12,overflowLabelLineHeight:12,overflowLabelFontWeight:"normal",overflowLabelBorderColor:Ts[100],overflowLabelBorder:1,labelLineBorder:1,labelLineBorderColor:Ee[25],cSliderRailHieght:16,cSliderBackgroundFillColor:"#416180",cSliderBackgroundFillOpacity:.05,cSliderForegroundFillColor:"#5B8FF9",cSliderForegroundFillOpacity:.15,cSliderHandlerHeight:24,cSliderHandlerWidth:10,cSliderHandlerFillColor:"#F7F7F7",cSliderHandlerFillOpacity:1,cSliderHandlerHighlightFillColor:"#FFF",cSliderHandlerBorderColor:"#BFBFBF",cSliderHandlerBorder:1,cSliderHandlerBorderRadius:2,cSliderTextFillColor:"#fff",cSliderTextFillOpacity:.45,cSliderTextFontSize:12,cSliderTextLineHeight:12,cSliderTextFontWeight:"normal",cSliderTextBorderColor:null,cSliderTextBorder:0,scrollbarTrackFillColor:"rgba(255,255,255,0.65)",scrollbarThumbFillColor:"rgba(0,0,0,0.35)",scrollbarThumbHighlightFillColor:"rgba(0,0,0,0.45)",pointFillColor:va[0],pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:Ts[100],pointBorderOpacity:1,pointActiveBorderColor:Ee[100],pointSelectedBorder:2,pointSelectedBorderColor:Ee[100],pointInactiveFillOpacity:.3,pointInactiveBorderOpacity:.3,hollowPointSize:4,hollowPointBorder:1,hollowPointBorderColor:va[0],hollowPointBorderOpacity:.95,hollowPointFillColor:Ts[100],hollowPointActiveBorder:1,hollowPointActiveBorderColor:Ee[100],hollowPointActiveBorderOpacity:1,hollowPointSelectedBorder:2,hollowPointSelectedBorderColor:Ee[100],hollowPointSelectedBorderOpacity:1,hollowPointInactiveBorderOpacity:.3,lineBorder:2,lineBorderColor:va[0],lineBorderOpacity:1,lineActiveBorder:3,lineSelectedBorder:3,lineInactiveBorderOpacity:.3,areaFillColor:va[0],areaFillOpacity:.25,areaActiveFillColor:va[0],areaActiveFillOpacity:.5,areaSelectedFillColor:va[0],areaSelectedFillOpacity:.5,areaInactiveFillOpacity:.3,hollowAreaBorderColor:va[0],hollowAreaBorder:2,hollowAreaBorderOpacity:1,hollowAreaActiveBorder:3,hollowAreaActiveBorderColor:Ee[100],hollowAreaSelectedBorder:3,hollowAreaSelectedBorderColor:Ee[100],hollowAreaInactiveBorderOpacity:.3,intervalFillColor:va[0],intervalFillOpacity:.95,intervalActiveBorder:1,intervalActiveBorderColor:Ee[100],intervalActiveBorderOpacity:1,intervalSelectedBorder:2,intervalSelectedBorderColor:Ee[100],intervalSelectedBorderOpacity:1,intervalInactiveBorderOpacity:.3,intervalInactiveFillOpacity:.3,hollowIntervalBorder:2,hollowIntervalBorderColor:va[0],hollowIntervalBorderOpacity:1,hollowIntervalFillColor:Ts[100],hollowIntervalActiveBorder:2,hollowIntervalActiveBorderColor:Ee[100],hollowIntervalSelectedBorder:3,hollowIntervalSelectedBorderColor:Ee[100],hollowIntervalSelectedBorderOpacity:1,hollowIntervalInactiveBorderOpacity:.3};return S(S({},s),r)},Oht=Lht();function Pht(){return window?window.devicePixelRatio:1}function IN(r,t,e,i){var n=r-e,a=t-i;return Math.sqrt(n*n+a*a)}function $l(r,t,e,i,n,a){return n>=r&&n<=r+e&&a>=t&&a<=t+i}function Pd(r,t){return!(t.minX>r.maxX||t.maxX<r.minX||t.minY>r.maxY||t.maxY<r.minY)}function Fht(r,t){return!r||!t?r||t:{minX:Math.min(r.minX,t.minX),minY:Math.min(r.minY,t.minY),maxX:Math.max(r.maxX,t.maxX),maxY:Math.max(r.maxY,t.maxY)}}function U3(r,t){return r[0]===t[0]&&r[1]===t[1]}var Bht=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,Dht=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,Nht=/^p\s*\(\s*([axyn])\s*\)\s*(.*)/i,LN=/[\d.]+:(#[^\s]+|[^\)]+\))/gi;function ON(r,t){var e=r.match(LN);I(e,function(i){var n=i.split(":");t.addColorStop(n[0],n[1])})}function kht(r,t,e){var i=Bht.exec(e),n=parseFloat(i[1])%360*(Math.PI/180),a=i[2],o=t.getBBox(),s,l;n>=0&&n<1/2*Math.PI?(s={x:o.minX,y:o.minY},l={x:o.maxX,y:o.maxY}):1/2*Math.PI<=n&&n<Math.PI?(s={x:o.maxX,y:o.minY},l={x:o.minX,y:o.maxY}):Math.PI<=n&&n<3/2*Math.PI?(s={x:o.maxX,y:o.maxY},l={x:o.minX,y:o.minY}):(s={x:o.minX,y:o.maxY},l={x:o.maxX,y:o.minY});var u=Math.tan(n),c=u*u,h=(l.x-s.x+u*(l.y-s.y))/(c+1)+s.x,f=u*(l.x-s.x+u*(l.y-s.y))/(c+1)+s.y,d=r.createLinearGradient(s.x,s.y,h,f);return ON(a,d),d}function Uht(r,t,e){var i=Dht.exec(e),n=parseFloat(i[1]),a=parseFloat(i[2]),o=parseFloat(i[3]),s=i[4];if(o===0){var l=s.match(LN);return l[l.length-1].split(":")[1]}var u=t.getBBox(),c=u.maxX-u.minX,h=u.maxY-u.minY,f=Math.sqrt(c*c+h*h)/2,d=r.createRadialGradient(u.minX+c*n,u.minY+h*a,0,u.minX+c/2,u.minY+h/2,o*f);return ON(s,d),d}function zht(r,t,e){if(t.get("patternSource")&&t.get("patternSource")===e)return t.get("pattern");var i,n,a=Nht.exec(e),o=a[1],s=a[2];function l(){i=r.createPattern(n,o),t.set("pattern",i),t.set("patternSource",e)}switch(o){case"a":o="repeat";break;case"x":o="repeat-x";break;case"y":o="repeat-y";break;case"n":o="no-repeat";break;default:o="no-repeat"}return n=new Image,s.match(/^data:/i)||(n.crossOrigin="Anonymous"),n.src=s,n.complete?l():(n.onload=l,n.src=n.src),i}function Hht(r,t,e){var i=t.getBBox();if(isNaN(i.x)||isNaN(i.y)||isNaN(i.width)||isNaN(i.height))return e;if(mt(e)){if(e[1]==="("||e[2]==="("){if(e[0]==="l")return kht(r,t,e);if(e[0]==="r")return Uht(r,t,e);if(e[0]==="p")return zht(r,t,e)}return e}if(e instanceof CanvasPattern)return e}function $ht(r){var t=0,e=0,i=0,n=0;return q(r)?r.length===1?t=e=i=n=r[0]:r.length===2?(t=i=r[0],e=n=r[1]):r.length===3?(t=r[0],e=n=r[1],i=r[2]):(t=r[0],e=r[1],i=r[2],n=r[3]):t=e=i=n=r,[t,e,i,n]}function Kp(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Qx(r,t){return Kp(r)*Kp(t)?(r[0]*t[0]+r[1]*t[1])/(Kp(r)*Kp(t)):1}function z3(r,t){return(r[0]*t[1]<r[1]*t[0]?-1:1)*Math.acos(Qx(r,t))}function q0(r,t){var e=t[1],i=t[2],n=bv(wv(t[3]),Math.PI*2),a=t[4],o=t[5],s=r[0],l=r[1],u=t[6],c=t[7],h=Math.cos(n)*(s-u)/2+Math.sin(n)*(l-c)/2,f=-1*Math.sin(n)*(s-u)/2+Math.cos(n)*(l-c)/2,d=h*h/(e*e)+f*f/(i*i);d>1&&(e*=Math.sqrt(d),i*=Math.sqrt(d));var v=e*e*(f*f)+i*i*(h*h),p=v?Math.sqrt((e*e*(i*i)-v)/v):1;a===o&&(p*=-1),isNaN(p)&&(p=0);var g=i?p*e*f/i:0,m=e?p*-i*h/e:0,y=(s+u)/2+Math.cos(n)*g-Math.sin(n)*m,_=(l+c)/2+Math.sin(n)*g+Math.cos(n)*m,x=[(h-g)/e,(f-m)/i],C=[(-1*h-g)/e,(-1*f-m)/i],A=z3([1,0],x),b=z3(x,C);return Qx(x,C)<=-1&&(b=Math.PI),Qx(x,C)>=1&&(b=0),o===0&&b>0&&(b=b-2*Math.PI),o===1&&b<0&&(b=b+2*Math.PI),{cx:y,cy:_,rx:U3(r,[u,c])?0:e,ry:U3(r,[u,c])?0:i,startAngle:A,endAngle:A+b,xRotation:n,arcFlag:a,sweepFlag:o}}var K0=Math.sin,Q0=Math.cos,hA=Math.atan2,Qp=Math.PI;function PN(r,t,e,i,n,a,o){var s=t.stroke,l=t.lineWidth,u=e-n,c=i-a,h=hA(c,u),f=new gA({type:"path",canvas:r.get("canvas"),isArrowShape:!0,attrs:{path:"M"+10*Q0(Qp/6)+","+10*K0(Qp/6)+" L0,0 L"+10*Q0(Qp/6)+",-"+10*K0(Qp/6),stroke:s,lineWidth:l}});f.translate(n,a),f.rotateAtPoint(n,a,h),r.set(o?"startArrowShape":"endArrowShape",f)}function FN(r,t,e,i,n,a,o){var s=t.startArrow,l=t.endArrow,u=t.stroke,c=t.lineWidth,h=o?s:l,f=h.d,d=h.fill,v=h.stroke,p=h.lineWidth,g=zt(h,["d","fill","stroke","lineWidth"]),m=e-n,y=i-a,_=hA(y,m);f&&(n=n-Q0(_)*f,a=a-K0(_)*f);var x=new gA({type:"path",canvas:r.get("canvas"),isArrowShape:!0,attrs:S(S({},g),{stroke:v||u,lineWidth:p||c,fill:d})});x.translate(n,a),x.rotateAtPoint(n,a,_),r.set(o?"startArrowShape":"endArrowShape",x)}function ru(r,t,e,i,n){var a=hA(i-t,e-r);return{dx:Q0(a)*n,dy:K0(a)*n}}function fA(r,t,e,i,n,a){typeof t.startArrow=="object"?FN(r,t,e,i,n,a,!0):t.startArrow?PN(r,t,e,i,n,a,!0):r.set("startArrowShape",null)}function dA(r,t,e,i,n,a){typeof t.endArrow=="object"?FN(r,t,e,i,n,a,!1):t.endArrow?PN(r,t,e,i,n,a,!1):r.set("startArrowShape",null)}var H3={fill:"fillStyle",stroke:"strokeStyle",opacity:"globalAlpha"};function lh(r,t){var e=t.attr();for(var i in e){var n=e[i],a=H3[i]?H3[i]:i;a==="matrix"&&n?r.transform(n[0],n[1],n[3],n[4],n[6],n[7]):a==="lineDash"&&r.setLineDash?q(n)&&r.setLineDash(n):(a==="strokeStyle"||a==="fillStyle"?n=Hht(r,t,n):a==="globalAlpha"&&(n=n*r.globalAlpha),r[a]=n)}}function Jx(r,t,e){for(var i=0;i<t.length;i++){var n=t[i];n.cfg.visible?n.draw(r,e):n.skipDraw()}}function Wht(r,t,e){var i=r.get("refreshElements");I(i,function(n){if(n!==r)for(var a=n.cfg.parent;a&&a!==r&&!a.cfg.refresh;)a.cfg.refresh=!0,a=a.cfg.parent}),i[0]===r?vA(t):tC(t,e)}function tC(r,t){for(var e=0;e<r.length;e++){var i=r[e];if(i.cfg.visible)if(i.cfg.hasChanged)i.cfg.refresh=!0,i.isGroup()&&vA(i.cfg.children);else if(i.cfg.refresh)i.isGroup()&&tC(i.cfg.children,t);else{var n=Vht(i,t);i.cfg.refresh=n,n&&i.isGroup()&&tC(i.cfg.children,t)}}}function BN(r){for(var t=0;t<r.length;t++){var e=r[t];e.cfg.hasChanged=!1,e.isGroup()&&!e.destroyed&&BN(e.cfg.children)}}function vA(r,t){for(var e=0;e<r.length;e++){var i=r[e];i.cfg.visible&&(i.cfg.refresh=!0,i.isGroup()&&vA(i.get("children")))}}function Vht(r,t){var e=r.cfg.cacheCanvasBBox,i=r.cfg.isInView&&e&&Pd(e,t);return i}function DN(r,t,e,i){var n=e.path,a=e.startArrow,o=e.endArrow;if(n){var s=[0,0],l=[0,0],u={dx:0,dy:0};t.beginPath();for(var c=0;c<n.length;c++){var h=n[c],f=h[0];if(c===0&&a&&a.d){var d=r.getStartTangent();u=ru(d[0][0],d[0][1],d[1][0],d[1][1],a.d)}else if(c===n.length-2&&n[c+1][0]==="Z"&&o&&o.d){var v=n[c+1];if(v[0]==="Z"){var d=r.getEndTangent();u=ru(d[0][0],d[0][1],d[1][0],d[1][1],o.d)}}else if(c===n.length-1&&o&&o.d&&n[0]!=="Z"){var d=r.getEndTangent();u=ru(d[0][0],d[0][1],d[1][0],d[1][1],o.d)}var p=u.dx,g=u.dy;switch(f){case"M":t.moveTo(h[1]-p,h[2]-g),l=[h[1],h[2]];break;case"L":t.lineTo(h[1]-p,h[2]-g);break;case"Q":t.quadraticCurveTo(h[1],h[2],h[3]-p,h[4]-g);break;case"C":t.bezierCurveTo(h[1],h[2],h[3],h[4],h[5]-p,h[6]-g);break;case"A":{var m=void 0;i?(m=i[c],m||(m=q0(s,h),i[c]=m)):m=q0(s,h);var y=m.cx,_=m.cy,x=m.rx,C=m.ry,A=m.startAngle,b=m.endAngle,R=m.xRotation,M=m.sweepFlag;if(t.ellipse)t.ellipse(y,_,x,C,R,A,b,1-M);else{var O=x>C?x:C,F=x>C?1:x/C,D=x>C?C/x:1;t.translate(y,_),t.rotate(R),t.scale(F,D),t.arc(0,0,O,A,b,1-M),t.scale(1/F,1/D),t.rotate(-R),t.translate(-y,-_)}break}case"Z":t.closePath();break}if(f==="Z")s=l;else{var H=h.length;s=[h[H-2],h[H-1]]}}}}function NN(r,t){var e=r.get("canvas");e&&(t==="remove"&&(r._cacheCanvasBBox=r.get("cacheCanvasBBox")),r.get("hasChanged")||(r.set("hasChanged",!0),r.cfg.parent&&r.cfg.parent.get("hasChanged")||(e.refreshElement(r,t,e),e.get("autoDraw")&&e.draw())))}function Ght(r){var t;if(r.destroyed)t=r._cacheCanvasBBox;else{var e=r.get("cacheCanvasBBox"),i=e&&!!(e.width&&e.height),n=r.getCanvasBBox(),a=n&&!!(n.width&&n.height);i&&a?t=Fht(e,n):i?t=e:a&&(t=n)}return t}function Xht(r){if(!r.length)return null;var t=[],e=[],i=[],n=[];return I(r,function(a){var o=Ght(a);o&&(t.push(o.minX),e.push(o.minY),i.push(o.maxX),n.push(o.maxY))}),{minX:Tn(t),minY:Tn(e),maxX:rn(i),maxY:rn(n)}}function Yht(r,t){return!r||!t||!Pd(r,t)?null:{minX:Math.max(r.minX,t.minX),minY:Math.max(r.minY,t.minY),maxX:Math.min(r.maxX,t.maxX),maxY:Math.min(r.maxY,t.maxY)}}var pA=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.onCanvasChange=function(e){NN(this,e)},t.prototype.getShapeBase=function(){return Nm},t.prototype.getGroupBase=function(){return t},t.prototype._applyClip=function(e,i){i&&(e.save(),lh(e,i),i.createPath(e),e.restore(),e.clip(),i._afterDraw())},t.prototype.cacheCanvasBBox=function(){var e=this.cfg.children,i=[],n=[];I(e,function(f){var d=f.cfg.cacheCanvasBBox;d&&f.cfg.isInView&&(i.push(d.minX,d.maxX),n.push(d.minY,d.maxY))});var a=null;if(i.length){var o=Tn(i),s=rn(i),l=Tn(n),u=rn(n);a={minX:o,minY:l,x:o,y:l,maxX:s,maxY:u,width:s-o,height:u-l};var c=this.cfg.canvas;if(c){var h=c.getViewRange();this.set("isInView",Pd(a,h))}}else this.set("isInView",!1);this.set("cacheCanvasBBox",a)},t.prototype.draw=function(e,i){var n=this.cfg.children,a=i?this.cfg.refresh:!0;n.length&&a&&(e.save(),lh(e,this),this._applyClip(e,this.getClip()),Jx(e,n,i),e.restore(),this.cacheCanvasBBox()),this.cfg.refresh=null,this.set("hasChanged",!1)},t.prototype.skipDraw=function(){this.set("cacheCanvasBBox",null),this.set("hasChanged",!1)},t}(Ov),$a=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{lineWidth:1,lineAppendWidth:0,strokeOpacity:1,fillOpacity:1})},t.prototype.getShapeBase=function(){return Nm},t.prototype.getGroupBase=function(){return pA},t.prototype.onCanvasChange=function(e){NN(this,e)},t.prototype.calculateBBox=function(){var e=this.get("type"),i=this.getHitLineWidth(),n=Fv(e),a=n(this),o=i/2,s=a.x-o,l=a.y-o,u=a.x+a.width+o,c=a.y+a.height+o;return{x:s,minX:s,y:l,minY:l,width:a.width+i,height:a.height+i,maxX:u,maxY:c}},t.prototype.isFill=function(){return!!this.attrs.fill||this.isClipShape()},t.prototype.isStroke=function(){return!!this.attrs.stroke},t.prototype._applyClip=function(e,i){i&&(e.save(),lh(e,i),i.createPath(e),e.restore(),e.clip(),i._afterDraw())},t.prototype.draw=function(e,i){var n=this.cfg.clipShape;if(i){if(this.cfg.refresh===!1){this.set("hasChanged",!1);return}var a=this.getCanvasBBox();if(!Pd(i,a)){this.set("hasChanged",!1),this.cfg.isInView&&this._afterDraw();return}}e.save(),lh(e,this),this._applyClip(e,n),this.drawPath(e),e.restore(),this._afterDraw()},t.prototype.getCanvasViewBox=function(){var e=this.cfg.canvas;return e?e.getViewRange():null},t.prototype.cacheCanvasBBox=function(){var e=this.getCanvasViewBox();if(e){var i=this.getCanvasBBox(),n=Pd(i,e);this.set("isInView",n),n?this.set("cacheCanvasBBox",i):this.set("cacheCanvasBBox",null)}},t.prototype._afterDraw=function(){this.cacheCanvasBBox(),this.set("hasChanged",!1),this.set("refresh",null)},t.prototype.skipDraw=function(){this.set("cacheCanvasBBox",null),this.set("isInView",null),this.set("hasChanged",!1)},t.prototype.drawPath=function(e){this.createPath(e),this.strokeAndFill(e),this.afterDrawPath(e)},t.prototype.fill=function(e){e.fill()},t.prototype.stroke=function(e){e.stroke()},t.prototype.strokeAndFill=function(e){var i=this.attrs,n=i.lineWidth,a=i.opacity,o=i.strokeOpacity,s=i.fillOpacity;this.isFill()&&(!K(s)&&s!==1?(e.globalAlpha=s,this.fill(e),e.globalAlpha=a):this.fill(e)),this.isStroke()&&n>0&&(!K(o)&&o!==1&&(e.globalAlpha=o),this.stroke(e)),this.afterDrawPath(e)},t.prototype.createPath=function(e){},t.prototype.afterDrawPath=function(e){},t.prototype.isInShape=function(e,i){var n=this.isStroke(),a=this.isFill(),o=this.getHitLineWidth();return this.isInStrokeOrPath(e,i,n,a,o)},t.prototype.isInStrokeOrPath=function(e,i,n,a,o){return!1},t.prototype.getHitLineWidth=function(){if(!this.isStroke())return 0;var e=this.attrs;return e.lineWidth+e.lineAppendWidth},t}(Pv),jht=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{x:0,y:0,r:0})},t.prototype.isInStrokeOrPath=function(e,i,n,a,o){var s=this.attr(),l=s.x,u=s.y,c=s.r,h=o/2,f=IN(l,u,e,i);return a&&n?f<=c+h:a?f<=c:n?f>=c-h&&f<=c+h:!1},t.prototype.createPath=function(e){var i=this.attr(),n=i.x,a=i.y,o=i.r;e.beginPath(),e.arc(n,a,o,0,Math.PI*2,!1),e.closePath()},t}($a);function Jp(r,t,e,i){return r/(e*e)+t/(i*i)}var Zht=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{x:0,y:0,rx:0,ry:0})},t.prototype.isInStrokeOrPath=function(e,i,n,a,o){var s=this.attr(),l=o/2,u=s.x,c=s.y,h=s.rx,f=s.ry,d=(e-u)*(e-u),v=(i-c)*(i-c);return a&&n?Jp(d,v,h+l,f+l)<=1:a?Jp(d,v,h,f)<=1:n?Jp(d,v,h-l,f-l)>=1&&Jp(d,v,h+l,f+l)<=1:!1},t.prototype.createPath=function(e){var i=this.attr(),n=i.x,a=i.y,o=i.rx,s=i.ry;if(e.beginPath(),e.ellipse)e.ellipse(n,a,o,s,0,0,Math.PI*2,!1);else{var l=o>s?o:s,u=o>s?1:o/s,c=o>s?s/o:1;e.save(),e.translate(n,a),e.scale(u,c),e.arc(0,0,l,0,Math.PI*2),e.restore(),e.closePath()}},t}($a);function $3(r){return r instanceof HTMLElement&&mt(r.nodeName)&&r.nodeName.toUpperCase()==="CANVAS"}var qht=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{x:0,y:0,width:0,height:0})},t.prototype.initAttrs=function(e){this._setImage(e.img)},t.prototype.isStroke=function(){return!1},t.prototype.isOnlyHitBox=function(){return!0},t.prototype._afterLoading=function(){if(this.get("toDraw")===!0){var e=this.get("canvas");e?e.draw():this.createPath(this.get("context"))}},t.prototype._setImage=function(e){var i=this,n=this.attrs;if(mt(e)){var a=new Image;a.onload=function(){if(i.destroyed)return!1;i.attr("img",a),i.set("loading",!1),i._afterLoading();var o=i.get("callback");o&&o.call(i)},a.crossOrigin="Anonymous",a.src=e,this.set("loading",!0)}else e instanceof Image?(n.width||(n.width=e.width),n.height||(n.height=e.height)):$3(e)&&(n.width||(n.width=Number(e.getAttribute("width"))),n.height||(n.height,Number(e.getAttribute("height"))))},t.prototype.onAttrChange=function(e,i,n){r.prototype.onAttrChange.call(this,e,i,n),e==="img"&&this._setImage(i)},t.prototype.createPath=function(e){if(this.get("loading")){this.set("toDraw",!0),this.set("context",e);return}var i=this.attr(),n=i.x,a=i.y,o=i.width,s=i.height,l=i.sx,u=i.sy,c=i.swidth,h=i.sheight,f=i.img;(f instanceof Image||$3(f))&&(!K(l)&&!K(u)&&!K(c)&&!K(h)?e.drawImage(f,l,u,c,h,n,a,o,s):e.drawImage(f,n,a,o,s))},t}($a);function Us(r,t,e,i,n,a,o){var s=Math.min(r,e),l=Math.max(r,e),u=Math.min(t,i),c=Math.max(t,i),h=n/2;return a>=s-h&&a<=l+h&&o>=u-h&&o<=c+h?Hr.pointToLine(r,t,e,i,a,o)<=n/2:!1}var Kht=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{x1:0,y1:0,x2:0,y2:0,startArrow:!1,endArrow:!1})},t.prototype.initAttrs=function(e){this.setArrow()},t.prototype.onAttrChange=function(e,i,n){r.prototype.onAttrChange.call(this,e,i,n),this.setArrow()},t.prototype.setArrow=function(){var e=this.attr(),i=e.x1,n=e.y1,a=e.x2,o=e.y2,s=e.startArrow,l=e.endArrow;s&&fA(this,e,a,o,i,n),l&&dA(this,e,i,n,a,o)},t.prototype.isInStrokeOrPath=function(e,i,n,a,o){if(!n||!o)return!1;var s=this.attr(),l=s.x1,u=s.y1,c=s.x2,h=s.y2;return Us(l,u,c,h,o,e,i)},t.prototype.createPath=function(e){var i=this.attr(),n=i.x1,a=i.y1,o=i.x2,s=i.y2,l=i.startArrow,u=i.endArrow,c={dx:0,dy:0},h={dx:0,dy:0};l&&l.d&&(c=ru(n,a,o,s,i.startArrow.d)),u&&u.d&&(h=ru(n,a,o,s,i.endArrow.d)),e.beginPath(),e.moveTo(n+c.dx,a+c.dy),e.lineTo(o-h.dx,s-h.dy)},t.prototype.afterDrawPath=function(e){var i=this.get("startArrowShape"),n=this.get("endArrowShape");i&&i.draw(e),n&&n.draw(e)},t.prototype.getTotalLength=function(){var e=this.attr(),i=e.x1,n=e.y1,a=e.x2,o=e.y2;return Hr.length(i,n,a,o)},t.prototype.getPoint=function(e){var i=this.attr(),n=i.x1,a=i.y1,o=i.x2,s=i.y2;return Hr.pointAt(n,a,o,s,e)},t}($a),Qht=/[MLHVQTCSAZ]([^MLHVQTCSAZ]*)/ig,Jht=/[^\s\,]+/ig;function tft(r){var t=r||[];if(q(t))return t;if(mt(t))return t=t.match(Qht),I(t,function(e,i){if(e=e.match(Jht),e[0].length>1){var n=e[0].charAt(0);e.splice(1,0,e[0].substr(1)),e[0]=n}I(e,function(a,o){isNaN(a)||(e[o]=+a)}),t[i]=e}),t}var id=`	
\v\f\r   ᠎             　\u2028\u2029`,eft=new RegExp("([a-z])["+id+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+id+"]*,?["+id+"]*)+)","ig"),rft=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+id+"]*,?["+id+"]*","ig");function ift(r){if(!r)return null;if(q(r))return r;var t={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},e=[];return String(r).replace(eft,function(i,n,a){var o=[],s=n.toLowerCase();if(a.replace(rft,function(l,u){u&&o.push(+u)}),s==="m"&&o.length>2&&(e.push([n].concat(o.splice(0,2))),s="l",n=n==="m"?"l":"L"),s==="o"&&o.length===1&&e.push([n,o[0]]),s==="r")e.push([n].concat(o));else for(;o.length>=t[s]&&(e.push([n].concat(o.splice(0,t[s]))),!!t[s]););return""}),e}var nft=/[a-z]/;function W3(r,t){return[t[0]+(t[0]-r[0]),t[1]+(t[1]-r[1])]}function kN(r){var t=ift(r);if(!t||!t.length)return[["M",0,0]];for(var e=!1,i=0;i<t.length;i++){var n=t[i][0];if(nft.test(n)||["V","H","T","S"].indexOf(n)>=0){e=!0;break}}if(!e)return t;var a=[],o=0,s=0,l=0,u=0,c=0,h=t[0];(h[0]==="M"||h[0]==="m")&&(o=+h[1],s=+h[2],l=o,u=s,c++,a[0]=["M",o,s]);for(var i=c,f=t.length;i<f;i++){var d=t[i],v=a[i-1],p=[],n=d[0],g=n.toUpperCase();if(n!==g)switch(p[0]=g,g){case"A":p[1]=d[1],p[2]=d[2],p[3]=d[3],p[4]=d[4],p[5]=d[5],p[6]=+d[6]+o,p[7]=+d[7]+s;break;case"V":p[1]=+d[1]+s;break;case"H":p[1]=+d[1]+o;break;case"M":l=+d[1]+o,u=+d[2]+s,p[1]=l,p[2]=u;break;default:for(var m=1,y=d.length;m<y;m++)p[m]=+d[m]+(m%2?o:s)}else p=t[i];switch(g){case"Z":o=+l,s=+u;break;case"H":o=p[1],p=["L",o,s];break;case"V":s=p[1],p=["L",o,s];break;case"T":o=p[1],s=p[2];var _=W3([v[1],v[2]],[v[3],v[4]]);p=["Q",_[0],_[1],o,s];break;case"S":o=p[p.length-2],s=p[p.length-1];var x=v.length,C=W3([v[x-4],v[x-3]],[v[x-2],v[x-1]]);p=["C",C[0],C[1],p[1],p[2],o,s];break;case"M":l=p[p.length-2],u=p[p.length-1];break;default:o=p[p.length-2],s=p[p.length-1]}a.push(p)}return a}function tg(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function eC(r,t){return tg(r)*tg(t)?(r[0]*t[0]+r[1]*t[1])/(tg(r)*tg(t)):1}function V3(r,t){return(r[0]*t[1]<r[1]*t[0]?-1:1)*Math.acos(eC(r,t))}function rC(r,t){return r[0]===t[0]&&r[1]===t[1]}function aft(r,t){var e=t[1],i=t[2],n=bv(wv(t[3]),Math.PI*2),a=t[4],o=t[5],s=r[0],l=r[1],u=t[6],c=t[7],h=Math.cos(n)*(s-u)/2+Math.sin(n)*(l-c)/2,f=-1*Math.sin(n)*(s-u)/2+Math.cos(n)*(l-c)/2,d=h*h/(e*e)+f*f/(i*i);d>1&&(e*=Math.sqrt(d),i*=Math.sqrt(d));var v=e*e*(f*f)+i*i*(h*h),p=v?Math.sqrt((e*e*(i*i)-v)/v):1;a===o&&(p*=-1),isNaN(p)&&(p=0);var g=i?p*e*f/i:0,m=e?p*-i*h/e:0,y=(s+u)/2+Math.cos(n)*g-Math.sin(n)*m,_=(l+c)/2+Math.sin(n)*g+Math.cos(n)*m,x=[(h-g)/e,(f-m)/i],C=[(-1*h-g)/e,(-1*f-m)/i],A=V3([1,0],x),b=V3(x,C);return eC(x,C)<=-1&&(b=Math.PI),eC(x,C)>=1&&(b=0),o===0&&b>0&&(b=b-2*Math.PI),o===1&&b<0&&(b=b+2*Math.PI),{cx:y,cy:_,rx:rC(r,[u,c])?0:e,ry:rC(r,[u,c])?0:i,startAngle:A,endAngle:A+b,xRotation:n,arcFlag:a,sweepFlag:o}}function G3(r,t){return[t[0]+(t[0]-r[0]),t[1]+(t[1]-r[1])]}function oft(r){r=tft(r);for(var t=[],e=null,i=null,n=null,a=0,o=r.length,s=0;s<o;s++){var l=r[s];i=r[s+1];var u=l[0],c={command:u,prePoint:e,params:l,startTangent:null,endTangent:null};switch(u){case"M":n=[l[1],l[2]],a=s;break;case"A":var h=aft(e,l);c.arcParams=h;break}if(u==="Z")e=n,i=r[a+1];else{var f=l.length;e=[l[f-2],l[f-1]]}i&&i[0]==="Z"&&(i=r[a],t[a]&&(t[a].prePoint=e)),c.currentPoint=e,t[a]&&rC(e,t[a].currentPoint)&&(t[a].prePoint=c.prePoint);var d=i?[i[i.length-2],i[i.length-1]]:null;c.nextPoint=d;var v=c.prePoint;if(["L","H","V"].includes(u))c.startTangent=[v[0]-e[0],v[1]-e[1]],c.endTangent=[e[0]-v[0],e[1]-v[1]];else if(u==="Q"){var p=[l[1],l[2]];c.startTangent=[v[0]-p[0],v[1]-p[1]],c.endTangent=[e[0]-p[0],e[1]-p[1]]}else if(u==="T"){var g=t[s-1],p=G3(g.currentPoint,v);g.command==="Q"?(c.command="Q",c.startTangent=[v[0]-p[0],v[1]-p[1]],c.endTangent=[e[0]-p[0],e[1]-p[1]]):(c.command="TL",c.startTangent=[v[0]-e[0],v[1]-e[1]],c.endTangent=[e[0]-v[0],e[1]-v[1]])}else if(u==="C"){var m=[l[1],l[2]],y=[l[3],l[4]];c.startTangent=[v[0]-m[0],v[1]-m[1]],c.endTangent=[e[0]-y[0],e[1]-y[1]],c.startTangent[0]===0&&c.startTangent[1]===0&&(c.startTangent=[m[0]-y[0],m[1]-y[1]]),c.endTangent[0]===0&&c.endTangent[1]===0&&(c.endTangent=[y[0]-m[0],y[1]-m[1]])}else if(u==="S"){var g=t[s-1],m=G3(g.currentPoint,v),y=[l[1],l[2]];g.command==="C"?(c.command="C",c.startTangent=[v[0]-m[0],v[1]-m[1]],c.endTangent=[e[0]-y[0],e[1]-y[1]]):(c.command="SQ",c.startTangent=[v[0]-y[0],v[1]-y[1]],c.endTangent=[e[0]-y[0],e[1]-y[1]])}else if(u==="A"){var _=.001,x=c.arcParams||{},C=x.cx,A=C===void 0?0:C,b=x.cy,R=b===void 0?0:b,M=x.rx,O=M===void 0?0:M,F=x.ry,D=F===void 0?0:F,H=x.sweepFlag,j=H===void 0?0:H,$=x.startAngle,k=$===void 0?0:$,V=x.endAngle,Q=V===void 0?0:V;j===0&&(_*=-1);var Y=O*Math.cos(k-_)+A,tt=D*Math.sin(k-_)+R;c.startTangent=[Y-n[0],tt-n[1]];var et=O*Math.cos(k+Q+_)+A,dt=D*Math.sin(k+Q-_)+R;c.endTangent=[v[0]-et,v[1]-dt]}t.push(c)}return t}var sft={circle:function(r,t,e){return[["M",r-e,t],["A",e,e,0,1,0,r+e,t],["A",e,e,0,1,0,r-e,t]]},square:function(r,t,e){return[["M",r-e,t-e],["L",r+e,t-e],["L",r+e,t+e],["L",r-e,t+e],["Z"]]},diamond:function(r,t,e){return[["M",r-e,t],["L",r,t-e],["L",r+e,t],["L",r,t+e],["Z"]]},triangle:function(r,t,e){var i=e*Math.sin(.3333333333333333*Math.PI);return[["M",r-e,t+i],["L",r,t-i],["L",r+e,t+i],["Z"]]},"triangle-down":function(r,t,e){var i=e*Math.sin(.3333333333333333*Math.PI);return[["M",r-e,t-i],["L",r+e,t-i],["L",r,t+i],["Z"]]}},lft=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.initAttrs=function(e){this._resetParamsCache()},t.prototype._resetParamsCache=function(){this.set("paramsCache",{})},t.prototype.onAttrChange=function(e,i,n){r.prototype.onAttrChange.call(this,e,i,n),["symbol","x","y","r","radius"].indexOf(e)!==-1&&this._resetParamsCache()},t.prototype.isOnlyHitBox=function(){return!0},t.prototype._getR=function(e){return K(e.r)?e.radius:e.r},t.prototype._getPath=function(){var e=this.attr(),i=e.x,n=e.y,a=e.symbol||"circle",o=this._getR(e),s,l;if(ot(a))s=a,l=s(i,n,o),l=kN(l);else{if(s=t.Symbols[a],!s)return console.warn(a+" marker is not supported."),null;l=s(i,n,o)}return l},t.prototype.createPath=function(e){var i=this._getPath(),n=this.get("paramsCache");DN(this,e,{path:i},n)},t.Symbols=sft,t}($a);function UN(r,t,e){var i=Bv();return r.createPath(i),i.isPointInPath(t,e)}var uft=1e-6;function o1(r){return Math.abs(r)<uft?0:r<0?-1:1}function cft(r,t,e){return(e[0]-r[0])*(t[1]-r[1])===(t[0]-r[0])*(e[1]-r[1])&&Math.min(r[0],t[0])<=e[0]&&e[0]<=Math.max(r[0],t[0])&&Math.min(r[1],t[1])<=e[1]&&e[1]<=Math.max(r[1],t[1])}function zN(r,t,e){var i=!1,n=r.length;if(n<=2)return!1;for(var a=0;a<n;a++){var o=r[a],s=r[(a+1)%n];if(cft(o,s,[t,e]))return!0;o1(o[1]-e)>0!=o1(s[1]-e)>0&&o1(t-(e-o[1])*(o[0]-s[0])/(o[1]-s[1])-o[0])<0&&(i=!i)}return i}function kf(r,t,e,i,n,a,o,s){var l=(Math.atan2(s-t,o-r)+Math.PI*2)%(Math.PI*2);if(l<i||l>n)return!1;var u={x:r+e*Math.cos(l),y:t+e*Math.sin(l)};return IN(u.x,u.y,o,s)<=a/2}var hft=dr;function fft(r){for(var t=!1,e=r.length,i=0;i<e;i++){var n=r[i],a=n[0];if(a==="C"||a==="A"||a==="Q"){t=!0;break}}return t}function dft(r,t,e,i,n){for(var a=!1,o=t/2,s=0;s<r.length;s++){var l=r[s],u=l.currentPoint,c=l.params,h=l.prePoint,f=l.box;if(!(f&&!$l(f.x-o,f.y-o,f.width+t,f.height+t,e,i))){switch(l.command){case"L":case"Z":a=Us(h[0],h[1],u[0],u[1],t,e,i);break;case"Q":var d=N5.pointDistance(h[0],h[1],c[1],c[2],c[3],c[4],e,i);a=d<=t/2;break;case"C":var v=Qf.pointDistance(h[0],h[1],c[1],c[2],c[3],c[4],c[5],c[6],e,i,n);a=v<=t/2;break;case"A":var p=l.arcParams,g=p.cx,m=p.cy,y=p.rx,_=p.ry,x=p.startAngle,C=p.endAngle,A=p.xRotation,b=[e,i,1],R=y>_?y:_,M=y>_?1:y/_,O=y>_?_/y:1,F=hft(null,[["t",-g,-m],["r",-A],["s",1/M,1/O]]);gd(b,b,F),a=kf(0,0,R,x,C,t,b[0],b[1]);break}if(a)break}}return a}function vft(r){for(var t=r.length,e=[],i=[],n=[],a=0;a<t;a++){var o=r[a],s=o[0];s==="M"?(n.length&&(i.push(n),n=[]),n.push([o[1],o[2]])):s==="Z"?n.length&&(e.push(n),n=[]):n.push([o[1],o[2]])}return n.length>0&&i.push(n),{polygons:e,polylines:i}}const eg=S({hasArc:fft,extractPolygons:vft,isPointInStroke:dft},qm);function X3(r,t,e){for(var i=!1,n=0;n<r.length;n++){var a=r[n];if(i=zN(a,t,e),i)break}return i}var gA=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{startArrow:!1,endArrow:!1})},t.prototype.initAttrs=function(e){this._setPathArr(e.path),this.setArrow()},t.prototype.onAttrChange=function(e,i,n){r.prototype.onAttrChange.call(this,e,i,n),e==="path"&&this._setPathArr(i),this.setArrow()},t.prototype._setPathArr=function(e){this.attrs.path=kN(e);var i=eg.hasArc(e);this.set("hasArc",i),this.set("paramsCache",{}),this.set("segments",null),this.set("curve",null),this.set("tCache",null),this.set("totalLength",null)},t.prototype.getSegments=function(){var e=this.get("segements");return e||(e=oft(this.attr("path")),this.set("segments",e)),e},t.prototype.setArrow=function(){var e=this.attr(),i=e.startArrow,n=e.endArrow;if(i){var a=this.getStartTangent();fA(this,e,a[0][0],a[0][1],a[1][0],a[1][1])}if(n){var a=this.getEndTangent();dA(this,e,a[0][0],a[0][1],a[1][0],a[1][1])}},t.prototype.isInStrokeOrPath=function(e,i,n,a,o){var s=this.getSegments(),l=this.get("hasArc"),u=!1;if(n){var c=this.getTotalLength();u=eg.isPointInStroke(s,o,e,i,c)}if(!u&&a)if(l)u=UN(this,e,i);else{var h=this.attr("path"),f=eg.extractPolygons(h);u=X3(f.polygons,e,i)||X3(f.polylines,e,i)}return u},t.prototype.createPath=function(e){var i=this.attr(),n=this.get("paramsCache");DN(this,e,i,n)},t.prototype.afterDrawPath=function(e){var i=this.get("startArrowShape"),n=this.get("endArrowShape");i&&i.draw(e),n&&n.draw(e)},t.prototype.getTotalLength=function(){var e=this.get("totalLength");return K(e)?(this._calculateCurve(),this._setTcache(),this.get("totalLength")):e},t.prototype.getPoint=function(e){var i=this.get("tCache");i||(this._calculateCurve(),this._setTcache(),i=this.get("tCache"));var n,a,o=this.get("curve");if(!i||i.length===0)return o?{x:o[0][1],y:o[0][2]}:null;I(i,function(c,h){e>=c[0]&&e<=c[1]&&(n=(e-c[0])/(c[1]-c[0]),a=h)});var s=o[a];if(K(s)||K(a))return null;var l=s.length,u=o[a+1];return Qf.pointAt(s[l-2],s[l-1],u[1],u[2],u[3],u[4],u[5],u[6],n)},t.prototype._calculateCurve=function(){var e=this.attr().path;this.set("curve",eg.pathToCurve(e))},t.prototype._setTcache=function(){var e=0,i=0,n=[],a,o,s,l,u=this.get("curve");if(u){if(I(u,function(c,h){s=u[h+1],l=c.length,s&&(e+=Qf.length(c[l-2],c[l-1],s[1],s[2],s[3],s[4],s[5],s[6])||0)}),this.set("totalLength",e),e===0){this.set("tCache",[]);return}I(u,function(c,h){s=u[h+1],l=c.length,s&&(a=[],a[0]=i/e,o=Qf.length(c[l-2],c[l-1],s[1],s[2],s[3],s[4],s[5],s[6]),i+=o||0,a[1]=i/e,n.push(a))}),this.set("tCache",n)}},t.prototype.getStartTangent=function(){var e=this.getSegments(),i;if(e.length>1){var n=e[0].currentPoint,a=e[1].currentPoint,o=e[1].startTangent;i=[],o?(i.push([n[0]-o[0],n[1]-o[1]]),i.push([n[0],n[1]])):(i.push([a[0],a[1]]),i.push([n[0],n[1]]))}return i},t.prototype.getEndTangent=function(){var e=this.getSegments(),i=e.length,n;if(i>1){var a=e[i-2].currentPoint,o=e[i-1].currentPoint,s=e[i-1].endTangent;n=[],s?(n.push([o[0]-s[0],o[1]-s[1]]),n.push([o[0],o[1]])):(n.push([a[0],a[1]]),n.push([o[0],o[1]]))}return n},t}($a);function HN(r,t,e,i,n){var a=r.length;if(a<2)return!1;for(var o=0;o<a-1;o++){var s=r[o][0],l=r[o][1],u=r[o+1][0],c=r[o+1][1];if(Us(s,l,u,c,t,e,i))return!0}if(n){var h=r[0],f=r[a-1];if(Us(h[0],h[1],f[0],f[1],t,e,i))return!0}return!1}var pft=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.isInStrokeOrPath=function(e,i,n,a,o){var s=this.attr().points,l=!1;return n&&(l=HN(s,o,e,i,!0)),!l&&a&&(l=zN(s,e,i)),l},t.prototype.createPath=function(e){var i=this.attr(),n=i.points;if(!(n.length<2)){e.beginPath();for(var a=0;a<n.length;a++){var o=n[a];a===0?e.moveTo(o[0],o[1]):e.lineTo(o[0],o[1])}e.closePath()}},t}($a),gft=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{startArrow:!1,endArrow:!1})},t.prototype.initAttrs=function(e){this.setArrow()},t.prototype.onAttrChange=function(e,i,n){r.prototype.onAttrChange.call(this,e,i,n),this.setArrow(),["points"].indexOf(e)!==-1&&this._resetCache()},t.prototype._resetCache=function(){this.set("totalLength",null),this.set("tCache",null)},t.prototype.setArrow=function(){var e=this.attr(),i=this.attrs,n=i.points,a=i.startArrow,o=i.endArrow,s=n.length,l=n[0][0],u=n[0][1],c=n[s-1][0],h=n[s-1][1];a&&fA(this,e,n[1][0],n[1][1],l,u),o&&dA(this,e,n[s-2][0],n[s-2][1],c,h)},t.prototype.isFill=function(){return!1},t.prototype.isInStrokeOrPath=function(e,i,n,a,o){if(!n||!o)return!1;var s=this.attr().points;return HN(s,o,e,i,!1)},t.prototype.isStroke=function(){return!0},t.prototype.createPath=function(e){var i=this.attr(),n=i.points,a=i.startArrow,o=i.endArrow,s=n.length;if(!(n.length<2)){var l=n[0][0],u=n[0][1],c=n[s-1][0],h=n[s-1][1];if(a&&a.d){var f=ru(l,u,n[1][0],n[1][1],a.d);l+=f.dx,u+=f.dy}if(o&&o.d){var f=ru(n[s-2][0],n[s-2][1],c,h,o.d);c-=f.dx,h-=f.dy}e.beginPath(),e.moveTo(l,u);for(var d=0;d<s-1;d++){var v=n[d];e.lineTo(v[0],v[1])}e.lineTo(c,h)}},t.prototype.afterDrawPath=function(e){var i=this.get("startArrowShape"),n=this.get("endArrowShape");i&&i.draw(e),n&&n.draw(e)},t.prototype.getTotalLength=function(){var e=this.attr().points,i=this.get("totalLength");return K(i)?(this.set("totalLength",z5.length(e)),this.get("totalLength")):i},t.prototype.getPoint=function(e){var i=this.attr().points,n=this.get("tCache");n||(this._setTcache(),n=this.get("tCache"));var a,o;return I(n,function(s,l){e>=s[0]&&e<=s[1]&&(a=(e-s[0])/(s[1]-s[0]),o=l)}),Hr.pointAt(i[o][0],i[o][1],i[o+1][0],i[o+1][1],a)},t.prototype._setTcache=function(){var e=this.attr().points;if(!(!e||e.length===0)){var i=this.getTotalLength();if(!(i<=0)){var n=0,a=[],o,s;I(e,function(l,u){e[u+1]&&(o=[],o[0]=n/i,s=Hr.length(l[0],l[1],e[u+1][0],e[u+1][1]),n+=s,o[1]=n/i,a.push(o))}),this.set("tCache",a)}}},t.prototype.getStartTangent=function(){var e=this.attr().points,i=[];return i.push([e[1][0],e[1][1]]),i.push([e[0][0],e[0][1]]),i},t.prototype.getEndTangent=function(){var e=this.attr().points,i=e.length-1,n=[];return n.push([e[i-1][0],e[i-1][1]]),n.push([e[i][0],e[i][1]]),n},t}($a);function mft(r,t,e,i,n,a,o){var s=n/2;return $l(r-s,t-s,e,n,a,o)||$l(r+e-s,t-s,n,i,a,o)||$l(r+s,t+i-s,e,n,a,o)||$l(r-s,t+s,n,i,a,o)}function yft(r,t,e,i,n,a,o,s){return Us(r+n,t,r+e-n,t,a,o,s)||Us(r+e,t+n,r+e,t+i-n,a,o,s)||Us(r+e-n,t+i,r+n,t+i,a,o,s)||Us(r,t+i-n,r,t+n,a,o,s)||kf(r+e-n,t+n,n,1.5*Math.PI,2*Math.PI,a,o,s)||kf(r+e-n,t+i-n,n,0,.5*Math.PI,a,o,s)||kf(r+n,t+i-n,n,.5*Math.PI,Math.PI,a,o,s)||kf(r+n,t+n,n,Math.PI,1.5*Math.PI,a,o,s)}var _ft=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{x:0,y:0,width:0,height:0,radius:0})},t.prototype.isInStrokeOrPath=function(e,i,n,a,o){var s=this.attr(),l=s.x,u=s.y,c=s.width,h=s.height,f=s.radius;if(f){var v=!1;return n&&(v=yft(l,u,c,h,f,o,e,i)),!v&&a&&(v=UN(this,e,i)),v}else{var d=o/2;if(a&&n)return $l(l-d,u-d,c+d,h+d,e,i);if(a)return $l(l,u,c,h,e,i);if(n)return mft(l,u,c,h,o,e,i)}},t.prototype.createPath=function(e){var i=this.attr(),n=i.x,a=i.y,o=i.width,s=i.height,l=i.radius;if(e.beginPath(),l===0)e.rect(n,a,o,s);else{var u=$ht(l),c=u[0],h=u[1],f=u[2],d=u[3];e.moveTo(n+c,a),e.lineTo(n+o-h,a),h!==0&&e.arc(n+o-h,a+h,h,-Math.PI/2,0),e.lineTo(n+o,a+s-f),f!==0&&e.arc(n+o-f,a+s-f,f,0,Math.PI/2),e.lineTo(n+d,a+s),d!==0&&e.arc(n+d,a+s-d,d,Math.PI/2,Math.PI),e.lineTo(n,a+c),c!==0&&e.arc(n+c,a+c,c,Math.PI,Math.PI*1.5),e.closePath()}},t}($a),xft=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{x:0,y:0,text:null,fontSize:12,fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"normal",fontVariant:"normal",textAlign:"start",textBaseline:"bottom"})},t.prototype.isOnlyHitBox=function(){return!0},t.prototype.initAttrs=function(e){this._assembleFont(),e.text&&this._setText(e.text)},t.prototype._assembleFont=function(){var e=this.attrs;e.font=Nv(e)},t.prototype._setText=function(e){var i=null;mt(e)&&e.indexOf(`
`)!==-1&&(i=e.split(`
`)),this.set("textArr",i)},t.prototype.onAttrChange=function(e,i,n){r.prototype.onAttrChange.call(this,e,i,n),e.startsWith("font")&&this._assembleFont(),e==="text"&&this._setText(i)},t.prototype._getSpaceingY=function(){var e=this.attrs,i=e.lineHeight,n=e.fontSize*1;return i?i-n:n*.14},t.prototype._drawTextArr=function(e,i,n){var a=this.attrs,o=a.textBaseline,s=a.x,l=a.y,u=a.fontSize*1,c=this._getSpaceingY(),h=Dv(a.text,a.fontSize,a.lineHeight),f;I(i,function(d,v){f=l+v*(c+u)-h+u,o==="middle"&&(f+=h-u-(h-u)/2),o==="top"&&(f+=h-u),K(d)||(n?e.fillText(d,s,f):e.strokeText(d,s,f))})},t.prototype._drawText=function(e,i){var n=this.attr(),a=n.x,o=n.y,s=this.get("textArr");if(s)this._drawTextArr(e,s,i);else{var l=n.text;K(l)||(i?e.fillText(l,a,o):e.strokeText(l,a,o))}},t.prototype.strokeAndFill=function(e){var i=this.attrs,n=i.lineWidth,a=i.opacity,o=i.strokeOpacity,s=i.fillOpacity;this.isStroke()&&n>0&&(!K(o)&&o!==1&&(e.globalAlpha=a),this.stroke(e)),this.isFill()&&(!K(s)&&s!==1?(e.globalAlpha=s,this.fill(e),e.globalAlpha=a):this.fill(e)),this.afterDrawPath(e)},t.prototype.fill=function(e){this._drawText(e,!0)},t.prototype.stroke=function(e){this._drawText(e,!1)},t}($a);function Cft(r,t){if(t){var e=Iv(t);return ao(e,r)}return r}function $N(r,t,e){var i=r.getTotalMatrix();if(i){var n=Cft([t,e,1],i),a=n[0],o=n[1];return[a,o]}return[t,e]}function Y3(r,t,e){if(r.isCanvas&&r.isCanvas())return!0;if(!nh(r)||r.cfg.isInView===!1)return!1;if(r.cfg.clipShape){var i=$N(r,t,e),n=i[0],a=i[1];if(r.isClipped(n,a))return!1}var o=r.cfg.cacheCanvasBBox||r.getCanvasBBox();return t>=o.minX&&t<=o.maxX&&e>=o.minY&&e<=o.maxY}function WN(r,t,e){if(!Y3(r,t,e))return null;for(var i=null,n=r.getChildren(),a=n.length,o=a-1;o>=0;o--){var s=n[o];if(s.isGroup())i=WN(s,t,e);else if(Y3(s,t,e)){var l=s,u=$N(s,t,e),c=u[0],h=u[1];l.isInShape(c,h)&&(i=s)}if(i)break}return i}var Eft=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return e.renderer="canvas",e.autoDraw=!0,e.localRefresh=!0,e.refreshElements=[],e.clipView=!0,e.quickHit=!1,e},t.prototype.onCanvasChange=function(e){(e==="attr"||e==="sort"||e==="changeSize")&&(this.set("refreshElements",[this]),this.draw())},t.prototype.getShapeBase=function(){return Nm},t.prototype.getGroupBase=function(){return pA},t.prototype.getPixelRatio=function(){var e=this.get("pixelRatio")||Pht();return e>=1?Math.ceil(e):1},t.prototype.getViewRange=function(){return{minX:0,minY:0,maxX:this.cfg.width,maxY:this.cfg.height}},t.prototype.createDom=function(){var e=document.createElement("canvas"),i=e.getContext("2d");return this.set("context",i),e},t.prototype.setDOMSize=function(e,i){r.prototype.setDOMSize.call(this,e,i);var n=this.get("context"),a=this.get("el"),o=this.getPixelRatio();a.width=o*e,a.height=o*i,o>1&&n.scale(o,o)},t.prototype.clear=function(){r.prototype.clear.call(this),this._clearFrame();var e=this.get("context"),i=this.get("el");e.clearRect(0,0,i.width,i.height)},t.prototype.getShape=function(e,i){var n;return this.get("quickHit")?n=WN(this,e,i):n=r.prototype.getShape.call(this,e,i,null),n},t.prototype._getRefreshRegion=function(){var e=this.get("refreshElements"),i=this.getViewRange(),n;if(e.length&&e[0]===this)n=i;else if(n=Xht(e),n){n.minX=Math.floor(n.minX),n.minY=Math.floor(n.minY),n.maxX=Math.ceil(n.maxX),n.maxY=Math.ceil(n.maxY),n.maxY+=1;var a=this.get("clipView");a&&(n=Yht(n,i))}return n},t.prototype.refreshElement=function(e){var i=this.get("refreshElements");i.push(e)},t.prototype._clearFrame=function(){var e=this.get("drawFrame");e&&(h5(e),this.set("drawFrame",null),this.set("refreshElements",[]))},t.prototype.draw=function(){var e=this.get("drawFrame");this.get("autoDraw")&&e||this._startDraw()},t.prototype._drawAll=function(){var e=this.get("context"),i=this.get("el"),n=this.getChildren();e.clearRect(0,0,i.width,i.height),lh(e,this),Jx(e,n),this.set("refreshElements",[])},t.prototype._drawRegion=function(){var e=this.get("context"),i=this.get("refreshElements"),n=this.getChildren(),a=this._getRefreshRegion();a?(e.clearRect(a.minX,a.minY,a.maxX-a.minX,a.maxY-a.minY),e.save(),e.beginPath(),e.rect(a.minX,a.minY,a.maxX-a.minX,a.maxY-a.minY),e.clip(),lh(e,this),Wht(this,n,a),Jx(e,n,a),e.restore()):i.length&&BN(i),I(i,function(o){o.get("hasChanged")&&o.set("hasChanged",!1)}),this.set("refreshElements",[])},t.prototype._startDraw=function(){var e=this,i=this.get("drawFrame"),n=this.get("drawFrameCallback");i||(i=c5(function(){e.get("localRefresh")?e._drawRegion():e._drawAll(),e.set("drawFrame",null),n&&n()}),this.set("drawFrame",i))},t.prototype.skipDraw=function(){},t.prototype.removeDom=function(){var e=this.get("el");e.width=0,e.height=0,e.parentNode.removeChild(e)},t}(Lv),Sft="0.5.12";const Aft=Object.freeze(Object.defineProperty({__proto__:null,AbstractCanvas:Lv,AbstractGroup:Ov,AbstractShape:Pv,Base:Mv,Canvas:Eft,Event:Rh,Group:pA,PathUtil:qm,Shape:Nm,assembleFont:Nv,getArcParams:q0,getBBoxMethod:Fv,getOffScreenContext:Bv,getTextHeight:Dv,invert:Iv,isAllowCapture:nh,multiplyVec2:ao,registerBBox:Ln,registerEasing:BS,version:Sft},Symbol.toStringTag,{value:"Module"}));var iC={rect:"path",circle:"circle",line:"line",path:"path",marker:"path",text:"text",polyline:"polyline",polygon:"polygon",image:"image",ellipse:"ellipse",dom:"foreignObject"},le={opacity:"opacity",fillStyle:"fill",fill:"fill",fillOpacity:"fill-opacity",strokeStyle:"stroke",strokeOpacity:"stroke-opacity",stroke:"stroke",x:"x",y:"y",r:"r",rx:"rx",ry:"ry",width:"width",height:"height",x1:"x1",x2:"x2",y1:"y1",y2:"y2",lineCap:"stroke-linecap",lineJoin:"stroke-linejoin",lineWidth:"stroke-width",lineDash:"stroke-dasharray",lineDashOffset:"stroke-dashoffset",miterLimit:"stroke-miterlimit",font:"font",fontSize:"font-size",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",fontFamily:"font-family",startArrow:"marker-start",endArrow:"marker-end",path:"d",class:"class",id:"id",style:"style",preserveAspectRatio:"preserveAspectRatio"};function ra(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function VN(r){var t=iC[r.type],e=r.getParent();if(!t)throw new Error("the type "+r.type+" is not supported by svg");var i=ra(t);if(r.get("id")&&(i.id=r.get("id")),r.set("el",i),r.set("attrs",{}),e){var n=e.get("el");n||(n=e.createDom(),e.set("el",n)),n.appendChild(i)}return i}function GN(r,t){var e=r.get("el"),i=v5(e.children).sort(t),n=document.createDocumentFragment();i.forEach(function(a){n.appendChild(a)}),e.appendChild(n)}function Tft(r,t){var e=r.parentNode,i=Array.from(e.childNodes).filter(function(s){return s.nodeType===1&&s.nodeName.toLowerCase()!=="defs"}),n=i[t],a=i.indexOf(r);if(n){if(a>t)e.insertBefore(r,n);else if(a<t){var o=i[t+1];o?e.insertBefore(r,o):e.appendChild(r)}}else e.appendChild(r)}function bft(r,t){var e=r.cfg.el,i=r.attr(),n={dx:i.shadowOffsetX,dy:i.shadowOffsetY,blur:i.shadowBlur,color:i.shadowColor};if(!n.dx&&!n.dy&&!n.blur&&!n.color)e.removeAttribute("filter");else{var a=t.find("filter",n);a||(a=t.addShadow(n)),e.setAttribute("filter","url(#"+a+")")}}function jv(r){var t=r.attr().matrix;if(t){for(var e=r.cfg.el,i=[],n=0;n<9;n+=3)i.push(t[n]+","+t[n+1]);i=i.join(","),i.indexOf("NaN")===-1?e.setAttribute("transform","matrix("+i+")"):console.warn("invalid matrix:",t)}}function Fd(r,t){var e=r.getClip(),i=r.get("el");if(!e)i.removeAttribute("clip-path");else if(e&&!i.hasAttribute("clip-path")){VN(e),e.createPath(t);var n=t.addClip(e);i.setAttribute("clip-path","url(#"+n+")")}}function XN(r,t){t.forEach(function(e){e.draw(r)})}function YN(r,t){var e=r.get("canvas");if(e&&e.get("autoDraw")){var i=e.get("context"),n=r.getParent(),a=n?n.getChildren():[e],o=r.get("el");if(t==="remove"){var s=r.get("isClipShape");if(s){var l=o&&o.parentNode,u=l&&l.parentNode;l&&u&&u.removeChild(l)}else o&&o.parentNode&&o.parentNode.removeChild(o)}else if(t==="show")o.setAttribute("visibility","visible");else if(t==="hide")o.setAttribute("visibility","hidden");else if(t==="zIndex")Tft(o,a.indexOf(r));else if(t==="sort"){var c=r.get("children");c&&c.length&&GN(r,function(h,f){return c.indexOf(h)-c.indexOf(f)?1:0})}else t==="clear"?o&&(o.innerHTML=""):t==="matrix"?jv(r):t==="clip"?Fd(r,i):t==="attr"||t==="add"&&r.draw(i)}}var mA=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.isEntityGroup=function(){return!0},t.prototype.createDom=function(){var e=ra("g");this.set("el",e);var i=this.getParent();if(i){var n=i.get("el");n||(n=i.createDom(),i.set("el",n)),n.appendChild(e)}return e},t.prototype.afterAttrsChange=function(e){r.prototype.afterAttrsChange.call(this,e);var i=this.get("canvas");if(i&&i.get("autoDraw")){var n=i.get("context");this.createPath(n,e)}},t.prototype.onCanvasChange=function(e){YN(this,e)},t.prototype.getShapeBase=function(){return km},t.prototype.getGroupBase=function(){return t},t.prototype.draw=function(e){var i=this.getChildren(),n=this.get("el");this.get("destroyed")?n&&n.parentNode.removeChild(n):(n||this.createDom(),Fd(this,e),this.createPath(e),i.length&&XN(e,i))},t.prototype.createPath=function(e,i){var n=this.attr(),a=this.get("el");I(i||n,function(o,s){le[s]&&a.setAttribute(le[s],o)}),jv(this)},t}(Ov),ca=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="svg",e.canFill=!1,e.canStroke=!1,e}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{lineWidth:1,lineAppendWidth:0,strokeOpacity:1,fillOpacity:1})},t.prototype.afterAttrsChange=function(e){r.prototype.afterAttrsChange.call(this,e);var i=this.get("canvas");if(i&&i.get("autoDraw")){var n=i.get("context");this.draw(n,e)}},t.prototype.getShapeBase=function(){return km},t.prototype.getGroupBase=function(){return mA},t.prototype.onCanvasChange=function(e){YN(this,e)},t.prototype.calculateBBox=function(){var e=this.get("el"),i=null;if(e)i=e.getBBox();else{var n=Fv(this.get("type"));n&&(i=n(this))}if(i){var a=i.x,o=i.y,s=i.width,l=i.height,u=this.getHitLineWidth(),c=u/2,h=a-c,f=o-c,d=a+s+c,v=o+l+c;return{x:h,y:f,minX:h,minY:f,maxX:d,maxY:v,width:s+u,height:l+u}}return{x:0,y:0,minX:0,minY:0,maxX:0,maxY:0,width:0,height:0}},t.prototype.isFill=function(){var e=this.attr(),i=e.fill,n=e.fillStyle;return(i||n||this.isClipShape())&&this.canFill},t.prototype.isStroke=function(){var e=this.attr(),i=e.stroke,n=e.strokeStyle;return(i||n)&&this.canStroke},t.prototype.draw=function(e,i){var n=this.get("el");this.get("destroyed")?n&&n.parentNode.removeChild(n):(n||VN(this),Fd(this,e),this.createPath(e,i),this.shadow(e,i),this.strokeAndFill(e,i),this.transform(i))},t.prototype.createPath=function(e,i){},t.prototype.strokeAndFill=function(e,i){var n=i||this.attr(),a=n.fill,o=n.fillStyle,s=n.stroke,l=n.strokeStyle,u=n.fillOpacity,c=n.strokeOpacity,h=n.lineWidth,f=this.get("el");this.canFill&&(i?"fill"in n?this._setColor(e,"fill",a):"fillStyle"in n&&this._setColor(e,"fill",o):this._setColor(e,"fill",a||o),u&&f.setAttribute(le.fillOpacity,u)),this.canStroke&&h>0&&(i?"stroke"in n?this._setColor(e,"stroke",s):"strokeStyle"in n&&this._setColor(e,"stroke",l):this._setColor(e,"stroke",s||l),c&&f.setAttribute(le.strokeOpacity,c),h&&f.setAttribute(le.lineWidth,h))},t.prototype._setColor=function(e,i,n){var a=this.get("el");if(!n){a.setAttribute(le[i],"none");return}if(n=n.trim(),/^[r,R,L,l]{1}[\s]*\(/.test(n)){var o=e.find("gradient",n);o||(o=e.addGradient(n)),a.setAttribute(le[i],"url(#"+o+")")}else if(/^[p,P]{1}[\s]*\(/.test(n)){var o=e.find("pattern",n);o||(o=e.addPattern(n)),a.setAttribute(le[i],"url(#"+o+")")}else a.setAttribute(le[i],n)},t.prototype.shadow=function(e,i){var n=this.attr(),a=i||n,o=a.shadowOffsetX,s=a.shadowOffsetY,l=a.shadowBlur,u=a.shadowColor;(o||s||l||u)&&bft(this,e)},t.prototype.transform=function(e){var i=this.attr(),n=(e||i).matrix;n&&jv(this)},t.prototype.isInShape=function(e,i){return this.isPointInPath(e,i)},t.prototype.isPointInPath=function(e,i){var n=this.get("el"),a=this.get("canvas"),o=a.get("el").getBoundingClientRect(),s=e+o.left,l=i+o.top,u=document.elementFromPoint(s,l);return!!(u&&u.isEqualNode(n))},t.prototype.getHitLineWidth=function(){var e=this.attrs,i=e.lineWidth,n=e.lineAppendWidth;return this.isStroke()?i+n:0},t}(Pv),wft=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="circle",e.canFill=!0,e.canStroke=!0,e}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{x:0,y:0,r:0})},t.prototype.createPath=function(e,i){var n=this.attr(),a=this.get("el");I(i||n,function(o,s){s==="x"||s==="y"?a.setAttribute("c"+s,o):le[s]&&a.setAttribute(le[s],o)})},t}(ca),Rft=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="dom",e.canFill=!1,e.canStroke=!1,e}return t.prototype.createPath=function(e,i){var n=this.attr(),a=this.get("el");if(I(i||n,function(u,c){le[c]&&a.setAttribute(le[c],u)}),typeof n.html=="function"){var o=n.html.call(this,n);if(o instanceof Element||o instanceof HTMLDocument){for(var s=a.childNodes,l=s.length-1;l>=0;l--)a.removeChild(s[l]);a.appendChild(o)}else a.innerHTML=o}else a.innerHTML=n.html},t}(ca),Mft=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="ellipse",e.canFill=!0,e.canStroke=!0,e}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{x:0,y:0,rx:0,ry:0})},t.prototype.createPath=function(e,i){var n=this.attr(),a=this.get("el");I(i||n,function(o,s){s==="x"||s==="y"?a.setAttribute("c"+s,o):le[s]&&a.setAttribute(le[s],o)})},t}(ca),Ift=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="image",e.canFill=!1,e.canStroke=!1,e}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{x:0,y:0,width:0,height:0})},t.prototype.createPath=function(e,i){var n=this,a=this.attr(),o=this.get("el");I(i||a,function(s,l){l==="img"?n._setImage(a.img):le[l]&&o.setAttribute(le[l],s)})},t.prototype.setAttr=function(e,i){this.attrs[e]=i,e==="img"&&this._setImage(i)},t.prototype._setImage=function(e){var i=this.attr(),n=this.get("el");if(mt(e))n.setAttribute("href",e);else if(e instanceof window.Image)i.width||(n.setAttribute("width",e.width),this.attr("width",e.width)),i.height||(n.setAttribute("height",e.height),this.attr("height",e.height)),n.setAttribute("href",e.src);else if(e instanceof HTMLElement&&mt(e.nodeName)&&e.nodeName.toUpperCase()==="CANVAS")n.setAttribute("href",e.toDataURL());else if(e instanceof ImageData){var a=document.createElement("canvas");a.setAttribute("width",""+e.width),a.setAttribute("height",""+e.height),a.getContext("2d").putImageData(e,0,0),i.width||(n.setAttribute("width",""+e.width),this.attr("width",e.width)),i.height||(n.setAttribute("height",""+e.height),this.attr("height",e.height)),n.setAttribute("href",a.toDataURL())}},t}(ca),Lft=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="line",e.canFill=!1,e.canStroke=!0,e}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{x1:0,y1:0,x2:0,y2:0,startArrow:!1,endArrow:!1})},t.prototype.createPath=function(e,i){var n=this.attr(),a=this.get("el");I(i||n,function(o,s){if(s==="startArrow"||s==="endArrow")if(o){var l=ie(o)?e.addArrow(n,le[s]):e.getDefaultArrow(n,le[s]);a.setAttribute(le[s],"url(#"+l+")")}else a.removeAttribute(le[s]);else le[s]&&a.setAttribute(le[s],o)})},t.prototype.getTotalLength=function(){var e=this.attr(),i=e.x1,n=e.y1,a=e.x2,o=e.y2;return Hr.length(i,n,a,o)},t.prototype.getPoint=function(e){var i=this.attr(),n=i.x1,a=i.y1,o=i.x2,s=i.y2;return Hr.pointAt(n,a,o,s,e)},t}(ca),rg={circle:function(r,t,e){return[["M",r,t],["m",-e,0],["a",e,e,0,1,0,e*2,0],["a",e,e,0,1,0,-e*2,0]]},square:function(r,t,e){return[["M",r-e,t-e],["L",r+e,t-e],["L",r+e,t+e],["L",r-e,t+e],["Z"]]},diamond:function(r,t,e){return[["M",r-e,t],["L",r,t-e],["L",r+e,t],["L",r,t+e],["Z"]]},triangle:function(r,t,e){var i=e*Math.sin(.3333333333333333*Math.PI);return[["M",r-e,t+i],["L",r,t-i],["L",r+e,t+i],["z"]]},triangleDown:function(r,t,e){var i=e*Math.sin(.3333333333333333*Math.PI);return[["M",r-e,t-i],["L",r+e,t-i],["L",r,t+i],["Z"]]}};const j3={get:function(r){return rg[r]},register:function(r,t){rg[r]=t},remove:function(r){delete rg[r]},getAll:function(){return rg}};var Oft=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="marker",e.canFill=!0,e.canStroke=!0,e}return t.prototype.createPath=function(e){var i=this.get("el");i.setAttribute("d",this._assembleMarker())},t.prototype._assembleMarker=function(){var e=this._getPath();return q(e)?e.map(function(i){return i.join(" ")}).join(""):e},t.prototype._getPath=function(){var e=this.attr(),i=e.x,n=e.y,a=e.r||e.radius,o=e.symbol||"circle",s;return ot(o)?s=o:s=j3.get(o),s?s(i,n,a):(console.warn(s+" symbol is not exist."),null)},t.symbolsFactory=j3,t}(ca),Pft=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="path",e.canFill=!0,e.canStroke=!0,e}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{startArrow:!1,endArrow:!1})},t.prototype.createPath=function(e,i){var n=this,a=this.attr(),o=this.get("el");I(i||a,function(s,l){if(l==="path"&&q(s))o.setAttribute("d",n._formatPath(s));else if(l==="startArrow"||l==="endArrow")if(s){var u=ie(s)?e.addArrow(a,le[l]):e.getDefaultArrow(a,le[l]);o.setAttribute(le[l],"url(#"+u+")")}else o.removeAttribute(le[l]);else le[l]&&o.setAttribute(le[l],s)})},t.prototype._formatPath=function(e){var i=e.map(function(n){return n.join(" ")}).join("");return~i.indexOf("NaN")?"":i},t.prototype.getTotalLength=function(){var e=this.get("el");return e?e.getTotalLength():null},t.prototype.getPoint=function(e){var i=this.get("el"),n=this.getTotalLength();if(n===0)return null;var a=i?i.getPointAtLength(e*n):null;return a?{x:a.x,y:a.y}:null},t}(ca),Fft=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="polygon",e.canFill=!0,e.canStroke=!0,e}return t.prototype.createPath=function(e,i){var n=this.attr(),a=this.get("el");I(i||n,function(o,s){s==="points"&&q(o)&&o.length>=2?a.setAttribute("points",o.map(function(l){return l[0]+","+l[1]}).join(" ")):le[s]&&a.setAttribute(le[s],o)})},t}(ca),Bft=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="polyline",e.canFill=!0,e.canStroke=!0,e}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{startArrow:!1,endArrow:!1})},t.prototype.onAttrChange=function(e,i,n){r.prototype.onAttrChange.call(this,e,i,n),["points"].indexOf(e)!==-1&&this._resetCache()},t.prototype._resetCache=function(){this.set("totalLength",null),this.set("tCache",null)},t.prototype.createPath=function(e,i){var n=this.attr(),a=this.get("el");I(i||n,function(o,s){s==="points"&&q(o)&&o.length>=2?a.setAttribute("points",o.map(function(l){return l[0]+","+l[1]}).join(" ")):le[s]&&a.setAttribute(le[s],o)})},t.prototype.getTotalLength=function(){var e=this.attr().points,i=this.get("totalLength");return K(i)?(this.set("totalLength",z5.length(e)),this.get("totalLength")):i},t.prototype.getPoint=function(e){var i=this.attr().points,n=this.get("tCache");n||(this._setTcache(),n=this.get("tCache"));var a,o;return I(n,function(s,l){e>=s[0]&&e<=s[1]&&(a=(e-s[0])/(s[1]-s[0]),o=l)}),Hr.pointAt(i[o][0],i[o][1],i[o+1][0],i[o+1][1],a)},t.prototype._setTcache=function(){var e=this.attr().points;if(!(!e||e.length===0)){var i=this.getTotalLength();if(!(i<=0)){var n=0,a=[],o,s;I(e,function(l,u){e[u+1]&&(o=[],o[0]=n/i,s=Hr.length(l[0],l[1],e[u+1][0],e[u+1][1]),n+=s,o[1]=n/i,a.push(o))}),this.set("tCache",a)}}},t.prototype.getStartTangent=function(){var e=this.attr().points,i=[];return i.push([e[1][0],e[1][1]]),i.push([e[0][0],e[0][1]]),i},t.prototype.getEndTangent=function(){var e=this.attr().points,i=e.length-1,n=[];return n.push([e[i-1][0],e[i-1][1]]),n.push([e[i][0],e[i][1]]),n},t}(ca);function Dft(r){var t=0,e=0,i=0,n=0;return q(r)?r.length===1?t=e=i=n=r[0]:r.length===2?(t=i=r[0],e=n=r[1]):r.length===3?(t=r[0],e=n=r[1],i=r[2]):(t=r[0],e=r[1],i=r[2],n=r[3]):t=e=i=n=r,{r1:t,r2:e,r3:i,r4:n}}var Nft=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="rect",e.canFill=!0,e.canStroke=!0,e}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{x:0,y:0,width:0,height:0,radius:0})},t.prototype.createPath=function(e,i){var n=this,a=this.attr(),o=this.get("el"),s=!1,l=["x","y","width","height","radius"];I(i||a,function(u,c){l.indexOf(c)!==-1&&!s?(o.setAttribute("d",n._assembleRect(a)),s=!0):l.indexOf(c)===-1&&le[c]&&o.setAttribute(le[c],u)})},t.prototype._assembleRect=function(e){var i=e.x,n=e.y,a=e.width,o=e.height,s=e.radius;if(!s)return"M "+i+","+n+" l "+a+",0 l 0,"+o+" l"+-a+" 0 z";var l=Dft(s);q(s)?s.length===1?l.r1=l.r2=l.r3=l.r4=s[0]:s.length===2?(l.r1=l.r3=s[0],l.r2=l.r4=s[1]):s.length===3?(l.r1=s[0],l.r2=l.r4=s[1],l.r3=s[2]):(l.r1=s[0],l.r2=s[1],l.r3=s[2],l.r4=s[3]):l.r1=l.r2=l.r3=l.r4=s;var u=[["M "+(i+l.r1)+","+n],["l "+(a-l.r1-l.r2)+",0"],["a "+l.r2+","+l.r2+",0,0,1,"+l.r2+","+l.r2],["l 0,"+(o-l.r2-l.r3)],["a "+l.r3+","+l.r3+",0,0,1,"+-l.r3+","+l.r3],["l "+(l.r3+l.r4-a)+",0"],["a "+l.r4+","+l.r4+",0,0,1,"+-l.r4+","+-l.r4],["l 0,"+(l.r4+l.r1-o)],["a "+l.r1+","+l.r1+",0,0,1,"+l.r1+","+-l.r1],["z"]];return u.join(" ")},t}(ca),Z3=.3,kft={top:"before-edge",middle:"central",bottom:"after-edge",alphabetic:"baseline",hanging:"hanging"},Uft={top:"text-before-edge",middle:"central",bottom:"text-after-edge",alphabetic:"alphabetic",hanging:"hanging"},zft={left:"left",start:"left",center:"middle",right:"end",end:"end"},Hft=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="text",e.canFill=!0,e.canStroke=!0,e}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return S(S({},e),{x:0,y:0,text:null,fontSize:12,fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"normal",fontVariant:"normal",textAlign:"start",textBaseline:"bottom"})},t.prototype.createPath=function(e,i){var n=this,a=this.attr(),o=this.get("el");this._setFont(),I(i||a,function(s,l){l==="text"?n._setText(""+s):l==="matrix"&&s?jv(n):le[l]&&o.setAttribute(le[l],s)}),o.setAttribute("paint-order","stroke"),o.setAttribute("style","stroke-linecap:butt; stroke-linejoin:miter;")},t.prototype._setFont=function(){var e=this.get("el"),i=this.attr(),n=i.textBaseline,a=i.textAlign,o=VF();o&&o.name==="firefox"?e.setAttribute("dominant-baseline",Uft[n]||"alphabetic"):e.setAttribute("alignment-baseline",kft[n]||"baseline"),e.setAttribute("text-anchor",zft[a]||"left")},t.prototype._setText=function(e){var i=this.get("el"),n=this.attr(),a=n.x,o=n.textBaseline,s=o===void 0?"bottom":o;if(!e)i.innerHTML="";else if(~e.indexOf(`
`)){var l=e.split(`
`),u=l.length-1,c="";I(l,function(h,f){f===0?s==="alphabetic"?c+='<tspan x="'+a+'" dy="'+-u+'em">'+h+"</tspan>":s==="top"?c+='<tspan x="'+a+'" dy="0.9em">'+h+"</tspan>":s==="middle"?c+='<tspan x="'+a+'" dy="'+-(u-1)/2+'em">'+h+"</tspan>":s==="bottom"?c+='<tspan x="'+a+'" dy="-'+(u+Z3)+'em">'+h+"</tspan>":s==="hanging"&&(c+='<tspan x="'+a+'" dy="'+(-(u-1)-Z3)+'em">'+h+"</tspan>"):c+='<tspan x="'+a+'" dy="1em">'+h+"</tspan>"}),i.innerHTML=c}else i.innerHTML=e},t}(ca),$ft=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,Wft=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,Vft=/[\d.]+:(#[^\s]+|[^)]+\))/gi;function jN(r){var t=r.match(Vft);if(!t)return"";var e="";return t.sort(function(i,n){return i=i.split(":"),n=n.split(":"),Number(i[0])-Number(n[0])}),I(t,function(i){i=i.split(":"),e+='<stop offset="'+i[0]+'" stop-color="'+i[1]+'"></stop>'}),e}function Gft(r,t){var e=$ft.exec(r),i=bv(wv(parseFloat(e[1])),Math.PI*2),n=e[2],a,o;i>=0&&i<.5*Math.PI?(a={x:0,y:0},o={x:1,y:1}):.5*Math.PI<=i&&i<Math.PI?(a={x:1,y:0},o={x:0,y:1}):Math.PI<=i&&i<1.5*Math.PI?(a={x:1,y:1},o={x:0,y:0}):(a={x:0,y:1},o={x:1,y:0});var s=Math.tan(i),l=s*s,u=(o.x-a.x+s*(o.y-a.y))/(l+1)+a.x,c=s*(o.x-a.x+s*(o.y-a.y))/(l+1)+a.y;t.setAttribute("x1",a.x),t.setAttribute("y1",a.y),t.setAttribute("x2",u),t.setAttribute("y2",c),t.innerHTML=jN(n)}function Xft(r,t){var e=Wft.exec(r),i=parseFloat(e[1]),n=parseFloat(e[2]),a=parseFloat(e[3]),o=e[4];t.setAttribute("cx",i),t.setAttribute("cy",n),t.setAttribute("r",a),t.innerHTML=jN(o)}var Yft=function(){function r(t){this.cfg={};var e=null,i=ln("gradient_");return t.toLowerCase()[0]==="l"?(e=ra("linearGradient"),Gft(t,e)):(e=ra("radialGradient"),Xft(t,e)),e.setAttribute("id",i),this.el=e,this.id=i,this.cfg=t,this}return r.prototype.match=function(t,e){return this.cfg===e},r}(),jft={shadowColor:"color",shadowOpacity:"opacity",shadowBlur:"blur",shadowOffsetX:"dx",shadowOffsetY:"dy"},Zft={x:"-40%",y:"-40%",width:"200%",height:"200%"},qft=function(){function r(t){this.type="filter",this.cfg={},this.type="filter";var e=ra("filter");return I(Zft,function(i,n){e.setAttribute(n,i)}),this.el=e,this.id=ln("filter_"),this.el.id=this.id,this.cfg=t,this._parseShadow(t,e),this}return r.prototype.match=function(t,e){if(this.type!==t)return!1;var i=!0,n=this.cfg;return I(Object.keys(n),function(a){if(n[a]!==e[a])return i=!1,!1}),i},r.prototype.update=function(t,e){var i=this.cfg;return i[jft[t]]=e,this._parseShadow(i,this.el),this},r.prototype._parseShadow=function(t,e){var i=`<feDropShadow
      dx="`+(t.dx||0)+`"
      dy="`+(t.dy||0)+`"
      stdDeviation="`+(t.blur?t.blur/10:0)+`"
      flood-color="`+(t.color?t.color:"#000")+`"
      flood-opacity="`+(t.opacity?t.opacity:1)+`"
      />`;e.innerHTML=i},r}(),q3=function(){function r(t,e){this.cfg={};var i=ra("marker"),n=ln("marker_");i.setAttribute("id",n);var a=ra("path");a.setAttribute("stroke",t.stroke||"none"),a.setAttribute("fill",t.fill||"none"),i.appendChild(a),i.setAttribute("overflow","visible"),i.setAttribute("orient","auto-start-reverse"),this.el=i,this.child=a,this.id=n;var o=t[e==="marker-start"?"startArrow":"endArrow"];return this.stroke=t.stroke||"#000",o===!0?this._setDefaultPath(e,a):(this.cfg=o,this._setMarker(t.lineWidth,a)),this}return r.prototype.match=function(){return!1},r.prototype._setDefaultPath=function(t,e){var i=this.el;e.setAttribute("d","M0,0 L"+10*Math.cos(Math.PI/6)+",5 L0,10"),i.setAttribute("refX",""+10*Math.cos(Math.PI/6)),i.setAttribute("refY","5")},r.prototype._setMarker=function(t,e){var i=this.el,n=this.cfg.path,a=this.cfg.d;q(n)&&(n=n.map(function(o){return o.join(" ")}).join("")),e.setAttribute("d",n),i.appendChild(e),a&&i.setAttribute("refX",""+a/t)},r.prototype.update=function(t){var e=this.child;e.attr?e.attr("fill",t):e.setAttribute("fill",t)},r}(),Kft=function(){function r(t){this.type="clip",this.cfg={};var e=ra("clipPath");this.el=e,this.id=ln("clip_"),e.id=this.id;var i=t.cfg.el;return e.appendChild(i),this.cfg=t,this}return r.prototype.match=function(){return!1},r.prototype.remove=function(){var t=this.el;t.parentNode.removeChild(t)},r}(),Qft=/^p\s*\(\s*([axyn])\s*\)\s*(.*)/i,Jft=function(){function r(t){this.cfg={};var e=ra("pattern");e.setAttribute("patternUnits","userSpaceOnUse");var i=ra("image");e.appendChild(i);var n=ln("pattern_");e.id=n,this.el=e,this.id=n,this.cfg=t;var a=Qft.exec(t),o=a[2];i.setAttribute("href",o);var s=new Image;o.match(/^data:/i)||(s.crossOrigin="Anonymous"),s.src=o;function l(){e.setAttribute("width",""+s.width),e.setAttribute("height",""+s.height)}return s.complete?l():(s.onload=l,s.src=s.src),this}return r.prototype.match=function(t,e){return this.cfg===e},r}(),tdt=function(){function r(t){var e=ra("defs"),i=ln("defs_");e.id=i,t.appendChild(e),this.children=[],this.defaultArrow={},this.el=e,this.canvas=t}return r.prototype.find=function(t,e){for(var i=this.children,n=null,a=0;a<i.length;a++)if(i[a].match(t,e)){n=i[a].id;break}return n},r.prototype.findById=function(t){for(var e=this.children,i=null,n=0;n<e.length;n++)if(e[n].id===t){i=e[n];break}return i},r.prototype.add=function(t){this.children.push(t),t.canvas=this.canvas,t.parent=this},r.prototype.getDefaultArrow=function(t,e){var i=t.stroke||t.strokeStyle;if(this.defaultArrow[i])return this.defaultArrow[i].id;var n=new q3(t,e);return this.defaultArrow[i]=n,this.el.appendChild(n.el),this.add(n),n.id},r.prototype.addGradient=function(t){var e=new Yft(t);return this.el.appendChild(e.el),this.add(e),e.id},r.prototype.addArrow=function(t,e){var i=new q3(t,e);return this.el.appendChild(i.el),this.add(i),i.id},r.prototype.addShadow=function(t){var e=new qft(t);return this.el.appendChild(e.el),this.add(e),e.id},r.prototype.addPattern=function(t){var e=new Jft(t);return this.el.appendChild(e.el),this.add(e),e.id},r.prototype.addClip=function(t){var e=new Kft(t);return this.el.appendChild(e.el),this.add(e),e.id},r}(),edt=function(r){N(t,r);function t(e){return r.call(this,S(S({},e),{autoDraw:!0,renderer:"svg"}))||this}return t.prototype.getShapeBase=function(){return km},t.prototype.getGroupBase=function(){return mA},t.prototype.getShape=function(e,i,n){var a=n.target||n.srcElement;if(!iC[a.tagName]){for(var o=a.parentNode;o&&!iC[o.tagName];)o=o.parentNode;a=o}return this.find(function(s){return s.get("el")===a})},t.prototype.createDom=function(){var e=ra("svg"),i=new tdt(e);return e.setAttribute("width",""+this.get("width")),e.setAttribute("height",""+this.get("height")),this.set("context",i),e},t.prototype.onCanvasChange=function(e){var i=this.get("context"),n=this.get("el");if(e==="sort"){var a=this.get("children");a&&a.length&&GN(this,function(s,l){return a.indexOf(s)-a.indexOf(l)?1:0})}else if(e==="clear"){if(n){n.innerHTML="";var o=i.el;o.innerHTML="",n.appendChild(o)}}else e==="matrix"?jv(this):e==="clip"?Fd(this,i):e==="changeSize"&&(n.setAttribute("width",""+this.get("width")),n.setAttribute("height",""+this.get("height")))},t.prototype.draw=function(){var e=this.get("context"),i=this.getChildren();Fd(this,e),i.length&&XN(e,i)},t}(Lv),rdt="0.5.6";const idt=Object.freeze(Object.defineProperty({__proto__:null,AbstractCanvas:Lv,AbstractGroup:Ov,AbstractShape:Pv,Base:Mv,Canvas:edt,Event:Rh,Group:mA,PathUtil:qm,Shape:km,assembleFont:Nv,getBBoxMethod:Fv,getOffScreenContext:Bv,getTextHeight:Dv,invert:Iv,isAllowCapture:nh,multiplyVec2:ao,registerBBox:Ln,registerEasing:BS,version:rdt},Symbol.toStringTag,{value:"Module"}));var yA=function(r){N(t,r);function t(e){var i=r.call(this,e)||this;i.type="path",i.shapeType="line";var n=e.connectNulls,a=n===void 0?!1:n,o=e.showSinglePoint,s=o===void 0?!0:o;return i.connectNulls=a,i.showSinglePoint=s,i}return t.prototype.updateElements=function(e,i){var n,a,o,s,l,u;i===void 0&&(i=!1);for(var c=new Map,h=new Map,f=[],d=0,v=0;v<e.length;v++){var p=e[v],g=this.getElementId(p);f.push(g),c.set(g,p),h.set(g,d),d++}this.elements=new Array(d);var m=xN(this.lastElementsMap,f),y=m.added,_=m.updated,x=m.removed;try{for(var C=Qt(y),A=C.next();!A.done;A=C.next()){var g=A.value,p=c.get(g),b=this.getShapeFactory(),R=this.getShapeInfo(p),v=h.get(g),M=new gN({shapeFactory:b,container:this.container,offscreenGroup:this.getOffscreenGroup(),elementIndex:v});M.geometry=this,M.animate=this.animateOption,M.draw(R,i),this.elementsMap[g]=M,this.elements[v]=M}}catch($){n={error:$}}finally{try{A&&!A.done&&(a=C.return)&&a.call(C)}finally{if(n)throw n.error}}try{for(var O=Qt(_),F=O.next();!F.done;F=O.next()){var g=F.value,p=c.get(g),M=this.lastElementsMap[g],v=h.get(g),R=this.getShapeInfo(p),D=M.getModel();(this.isCoordinateChanged||_N(D,R))&&(M.animate=this.animateOption,M.update(R)),this.elementsMap[g]=M,this.elements[v]=M}}catch($){o={error:$}}finally{try{F&&!F.done&&(s=O.return)&&s.call(O)}finally{if(o)throw o.error}}try{for(var H=Qt(x),j=H.next();!j.done;j=H.next()){var g=j.value,M=this.lastElementsMap[g];M.animate=this.animateOption,M.destroy()}}catch($){l={error:$}}finally{try{j&&!j.done&&(u=H.return)&&u.call(H)}finally{if(l)throw l.error}}},t.prototype.getPointsAndData=function(e){for(var i=[],n=[],a=0,o=e.length;a<o;a++){var s=e[a];i.push({x:s.x,y:s.y}),n.push(s[Se])}return{points:i,data:n}},t.prototype.getShapeInfo=function(e){var i=this.getDrawCfg(e[0]),n=this.getPointsAndData(e),a=n.points,o=n.data;return i.mappingData=e,i.data=o,i.isStack=!!this.getAdjust("stack"),i.points=a,i.connectNulls=this.connectNulls,i.showSinglePoint=this.showSinglePoint,i},t}(vl);function ndt(r,t,e,i,n){var a=[];if(r.length){for(var o=[],s=[],l=0,u=r.length;l<u;l++){var c=r[l];o.push(c[1]),s.push(c[0])}s=s.reverse(),I([o,s],function(h,f){var d=[],v=i.parsePoints(h),p=v[0];o.length===1&&s.length===1?d=f===0?[["M",p.x-.5,p.y],["L",p.x+.5,p.y]]:[["L",p.x+.5,p.y],["L",p.x-.5,p.y]]:(t&&v.push({x:p.x,y:p.y}),e?d=j0(v,!1,n):d=Gv(v,!1),f>0&&(d[0][0]="L")),a=a.concat(d)}),a.push(["Z"])}return a}function py(r,t,e,i,n){for(var a=nr(r,t,!t,"lineWidth"),o=r.connectNulls,s=r.isInCircle,l=r.points,u=r.showSinglePoint,c=vy(l,o,u),h=[],f=0,d=c.length;f<d;f++){var v=c[f];h=h.concat(ndt(v,s,e,i,n))}return a.path=h,a}function ZN(r){var t=r.start,e=r.end;return[[t.x,e.y],[e.x,t.y]]}dl("area",{defaultShapeType:"area",getDefaultPoints:function(r){var t=r.x,e=r.y0,i=q(r.y)?r.y:[e,r.y];return i.map(function(n){return{x:t,y:n}})}});de("area","area",{draw:function(r,t){var e=py(r,!1,!1,this),i=t.addShape({type:"path",attrs:e,name:"area"});return i},getMarker:function(r){var t=r.color;return{symbol:function(e,i,n){return n===void 0&&(n=5.5),[["M",e-n,i-4],["L",e+n,i-4],["L",e+n,i+4],["L",e-n,i+4],["Z"]]},style:{r:5,fill:t,fillOpacity:1}}}});var adt=function(r){N(t,r);function t(e){var i=r.call(this,e)||this;i.type="area",i.shapeType="area",i.generatePoints=!0,i.startOnZero=!0;var n=e.startOnZero,a=n===void 0?!0:n,o=e.sortable,s=o===void 0?!1:o,l=e.showSinglePoint,u=l===void 0?!1:l;return i.startOnZero=a,i.sortable=s,i.showSinglePoint=u,i}return t.prototype.getPointsAndData=function(e){for(var i=[],n=[],a=0,o=e.length;a<o;a++){var s=e[a];i.push(s.points),n.push(s[Se])}return{points:i,data:n}},t.prototype.getYMinValue=function(){if(this.startOnZero)return r.prototype.getYMinValue.call(this);var e=this.getYScale();return e.min},t}(yA);dl("edge",{defaultShapeType:"line",getDefaultPoints:function(r){return cA(r)}});de("edge","line",{draw:function(r,t){var e=nr(r,!0,!1,"lineWidth"),i=Gv(this.parsePoints(r.points),this.coordinate.isPolar);return t.addShape("path",{attrs:S(S({},e),{path:i})})},getMarker:function(r){return{symbol:"circle",style:{r:4.5,fill:r.color}}}});var odt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="edge",e.shapeType="edge",e.generatePoints=!0,e}return t}(vl),sdt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="heatmap",e.paletteCache={},e}return t.prototype.updateElements=function(e,i){for(var n=0;n<e.length;n++){var a=e[n],o=this.prepareRange(a),s=this.prepareSize(),l=P(this.styleOption,["cfg","shadowBlur"]);Tt(l)||(l=s/2),this.prepareGreyScaleBlurredCircle(s,l),this.drawWithRange(a,o,s,l)}},t.prototype.color=function(e,i){return this.createAttrOption("color",e,typeof i!="function"?i:""),this},t.prototype.clear=function(){r.prototype.clear.call(this),this.clearShadowCanvasCtx(),this.paletteCache={}},t.prototype.prepareRange=function(e){var i=this.getAttribute("color"),n=i.getFields()[0],a=1/0,o=-1/0;return e.forEach(function(s){var l=s[Se][n];l>o&&(o=l),l<a&&(a=l)}),a===o&&(a=o-1),[a,o]},t.prototype.prepareSize=function(){var e=this.getDefaultValue("size");return Tt(e)||(e=this.getDefaultSize()),e},t.prototype.prepareGreyScaleBlurredCircle=function(e,i){var n=this.getGrayScaleBlurredCanvas(),a=e+i,o=n.getContext("2d");n.width=n.height=a*2,o.clearRect(0,0,n.width,n.height),o.shadowOffsetX=o.shadowOffsetY=a*2,o.shadowBlur=i,o.shadowColor="black",o.beginPath(),o.arc(-a,-a,e,0,Math.PI*2,!0),o.closePath(),o.fill()},t.prototype.drawWithRange=function(e,i,n,a){var o,s,l=this.coordinate,u=l.start,c=l.end,h=this.coordinate.getWidth(),f=this.coordinate.getHeight(),d=this.getAttribute("color"),v=d.getFields()[0];this.clearShadowCanvasCtx();var p=this.getShadowCanvasCtx();i&&(e=e.filter(function(O){return O[Se][v]<=i[1]&&O[Se][v]>=i[0]}));var g=this.scales[v];try{for(var m=Qt(e),y=m.next();!y.done;y=m.next()){var _=y.value,x=this.getDrawCfg(_),C=x.x,A=x.y,b=g.scale(_[Se][v]);this.drawGrayScaleBlurredCircle(C-u.x,A-c.y,n+a,b,p)}}catch(O){o={error:O}}finally{try{y&&!y.done&&(s=m.return)&&s.call(m)}finally{if(o)throw o.error}}var R=p.getImageData(0,0,h,f);this.clearShadowCanvasCtx(),this.colorize(R),p.putImageData(R,0,0);var M=this.getImageShape();M.attr("x",u.x),M.attr("y",c.y),M.attr("width",h),M.attr("height",f),M.attr("img",p.canvas),M.set("origin",this.getShapeInfo(e))},t.prototype.getDefaultSize=function(){var e=this.getAttribute("position"),i=this.coordinate;return Math.min(i.getWidth()/(e.scales[0].ticks.length*4),i.getHeight()/(e.scales[1].ticks.length*4))},t.prototype.clearShadowCanvasCtx=function(){var e=this.getShadowCanvasCtx();e.clearRect(0,0,e.canvas.width,e.canvas.height)},t.prototype.getShadowCanvasCtx=function(){var e=this.shadowCanvas;return e||(e=document.createElement("canvas"),this.shadowCanvas=e),e.width=this.coordinate.getWidth(),e.height=this.coordinate.getHeight(),e.getContext("2d")},t.prototype.getGrayScaleBlurredCanvas=function(){return this.grayScaleBlurredCanvas||(this.grayScaleBlurredCanvas=document.createElement("canvas")),this.grayScaleBlurredCanvas},t.prototype.drawGrayScaleBlurredCircle=function(e,i,n,a,o){var s=this.getGrayScaleBlurredCanvas();o.globalAlpha=a,o.drawImage(s,e-n,i-n)},t.prototype.colorize=function(e){for(var i=this.getAttribute("color"),n=e.data,a=this.paletteCache,o=3;o<n.length;o+=4){var s=n[o];if(Tt(s)){var l=a[s]?a[s]:Gs.rgb2arr(i.gradient(s/256));n[o-3]=l[0],n[o-2]=l[1],n[o-1]=l[2],n[o]=s}}},t.prototype.getImageShape=function(){var e=this.imageShape;if(e)return e;var i=this.container;return e=i.addShape({type:"image",attrs:{}}),this.imageShape=e,e},t.prototype.getShapeInfo=function(e){var i=this.getDrawCfg(e[0]),n=e.map(function(a){return a[Se]});return S(S({},i),{mappingData:e,data:n})},t}(vl);function _A(r){var t,e,i=r.x,n=r.y,a=r.y0,o=r.size,s,l;q(n)?(t=ct(n,2),s=t[0],l=t[1]):(s=a,l=n);var u,c;q(i)?(e=ct(i,2),u=e[0],c=e[1]):(u=i-o/2,c=i+o/2);var h=[{x:u,y:s},{x:u,y:l}];return h.push({x:c,y:l},{x:c,y:s}),h}function xA(r,t){t===void 0&&(t=!0);var e=[],i=r[0];e.push(["M",i.x,i.y]);for(var n=1,a=r.length;n<a;n++)e.push(["L",r[n].x,r[n].y]);return t&&(e.push(["L",i.x,i.y]),e.push(["z"])),e}function qN(r,t){var e=0,i=0,n=0,a=0;return q(r)?r.length===1?e=i=n=a=r[0]:r.length===2?(e=n=r[0],i=a=r[1]):r.length===3?(e=r[0],i=a=r[1],n=r[2]):(e=r[0],i=r[1],n=r[2],a=r[3]):e=i=n=a=r,e+i>t&&(e=e?t/(1+i/e):0,i=t-e),n+a>t&&(n=n?t/(1+a/n):0,a=t-n),[e||0,i||0,n||0,a||0]}function KN(r,t,e){var i=[];if(e.isRect){var n=e.isTransposed?{x:e.start.x,y:t[0].y}:{x:t[0].x,y:e.start.y},a=e.isTransposed?{x:e.end.x,y:t[2].y}:{x:t[3].x,y:e.end.y},o=P(r,["background","style","radius"]);if(o){var s=e.isTransposed?Math.abs(t[0].y-t[2].y):t[2].x-t[1].x,l=e.isTransposed?e.getWidth():e.getHeight(),u=ct(qN(o,Math.min(s,l)),4),c=u[0],h=u[1],f=u[2],d=u[3],v=e.isTransposed&&e.isReflect("y"),p=v?0:1,g=function(A){return v?-A:A};i.push(["M",n.x,a.y+g(c)]),c!==0&&i.push(["A",c,c,0,0,p,n.x+c,a.y]),i.push(["L",a.x-h,a.y]),h!==0&&i.push(["A",h,h,0,0,p,a.x,a.y+g(h)]),i.push(["L",a.x,n.y-g(f)]),f!==0&&i.push(["A",f,f,0,0,p,a.x-f,n.y]),i.push(["L",n.x+d,n.y]),d!==0&&i.push(["A",d,d,0,0,p,n.x,n.y-g(d)])}else i.push(["M",n.x,n.y]),i.push(["L",a.x,n.y]),i.push(["L",a.x,a.y]),i.push(["L",n.x,a.y]),i.push(["L",n.x,n.y]);i.push(["z"])}if(e.isPolar){var m=e.getCenter(),y=Md(r,e),_=y.startAngle,x=y.endAngle;if(e.type!=="theta"&&!e.isTransposed)i=Xs(m.x,m.y,e.getRadius(),_,x);else{var C=function(R){return Math.pow(R,2)},c=Math.sqrt(C(m.x-t[0].x)+C(m.y-t[0].y)),h=Math.sqrt(C(m.x-t[2].x)+C(m.y-t[2].y));i=Xs(m.x,m.y,c,e.startAngle,e.endAngle,h)}}return i}function ldt(r,t,e){var i=e.getWidth(),n=e.getHeight(),a=e.type==="rect",o=[],s=(r[2].x-r[1].x)/2,l=e.isTransposed?s*n/i:s*i/n;return t==="round"?(a?(o.push(["M",r[0].x,r[0].y+l]),o.push(["L",r[1].x,r[1].y-l]),o.push(["A",s,s,0,0,1,r[2].x,r[2].y-l]),o.push(["L",r[3].x,r[3].y+l]),o.push(["A",s,s,0,0,1,r[0].x,r[0].y+l])):(o.push(["M",r[0].x,r[0].y]),o.push(["L",r[1].x,r[1].y]),o.push(["A",s,s,0,0,1,r[2].x,r[2].y]),o.push(["L",r[3].x,r[3].y]),o.push(["A",s,s,0,0,1,r[0].x,r[0].y])),o.push(["z"])):o=xA(r),o}function QN(r,t,e){var i=[];return K(t)?e?i.push(["M",r[0].x,r[0].y],["L",r[1].x,r[1].y],["L",(r[2].x+r[3].x)/2,(r[2].y+r[3].y)/2],["Z"]):i.push(["M",r[0].x,r[0].y],["L",r[1].x,r[1].y],["L",r[2].x,r[2].y],["L",r[3].x,r[3].y],["Z"]):i.push(["M",r[0].x,r[0].y],["L",r[1].x,r[1].y],["L",t[1].x,t[1].y],["L",t[0].x,t[0].y],["Z"]),i}function Cf(r,t){return[t,r]}function udt(r,t,e){var i,n,a,o,s,l,u,c=ct(xt([],ct(r),!1),4),h=c[0],f=c[1],d=c[2],v=c[3],p=ct(typeof e=="number"?Array(4).fill(e):e,4),g=p[0],m=p[1],y=p[2],_=p[3];t.isTransposed&&(i=ct(Cf(f,v),2),f=i[0],v=i[1]),t.isReflect("y")&&(n=ct(Cf(h,f),2),h=n[0],f=n[1],a=ct(Cf(d,v),2),d=a[0],v=a[1]),t.isReflect("x")&&(o=ct(Cf(h,v),2),h=o[0],v=o[1],s=ct(Cf(f,d),2),f=s[0],d=s[1]);var x=[],C=function(A){return Math.abs(A)};return l=ct(qN([g,m,y,_],Math.min(C(v.x-h.x),C(f.y-h.y))).map(function(A){return C(A)}),4),g=l[0],m=l[1],y=l[2],_=l[3],t.isTransposed&&(u=ct([_,g,m,y],4),g=u[0],m=u[1],y=u[2],_=u[3]),h.y<f.y?(x.push(["M",v.x,v.y+y]),y!==0&&x.push(["A",y,y,0,0,0,v.x-y,v.y]),x.push(["L",h.x+_,h.y]),_!==0&&x.push(["A",_,_,0,0,0,h.x,h.y+_]),x.push(["L",f.x,f.y-g]),g!==0&&x.push(["A",g,g,0,0,0,f.x+g,f.y]),x.push(["L",d.x-m,d.y]),m!==0&&x.push(["A",m,m,0,0,0,d.x,d.y-m]),x.push(["L",v.x,v.y+y]),x.push(["z"])):v.x<h.x?(x.push(["M",d.x+m,d.y]),m!==0&&x.push(["A",m,m,0,0,0,d.x,d.y+m]),x.push(["L",v.x,v.y-y]),y!==0&&x.push(["A",y,y,0,0,0,v.x+y,v.y]),x.push(["L",h.x-_,h.y]),_!==0&&x.push(["A",_,_,0,0,0,h.x,h.y-_]),x.push(["L",f.x,f.y+g]),g!==0&&x.push(["A",g,g,0,0,0,f.x-g,f.y]),x.push(["L",d.x+m,d.y]),x.push(["z"])):(x.push(["M",f.x,f.y+g]),g!==0&&x.push(["A",g,g,0,0,1,f.x+g,f.y]),x.push(["L",d.x-m,d.y]),m!==0&&x.push(["A",m,m,0,0,1,d.x,d.y+m]),x.push(["L",v.x,v.y-y]),y!==0&&x.push(["A",y,y,0,0,1,v.x-y,v.y]),x.push(["L",h.x+_,h.y]),_!==0&&x.push(["A",_,_,0,0,1,h.x,h.y-_]),x.push(["L",f.x,f.y+g]),x.push(["z"])),x}dl("interval",{defaultShapeType:"rect",getDefaultPoints:function(r){return _A(r)}});de("interval","rect",{draw:function(r,t){var e=nr(r,!1,!0),i=t,n=r==null?void 0:r.background;if(n){i=t.addGroup({name:"interval-group"});var a=wN(r),o=KN(r,this.parsePoints(r.points),this.coordinate);i.addShape("path",{attrs:S(S({},a),{path:o}),capture:!1,zIndex:-1,name:sA})}var s;e.radius&&this.coordinate.isRect?s=udt(this.parsePoints(r.points),this.coordinate,e.radius):s=this.parsePath(ldt(r.points,e.lineCap,this.coordinate));var l=i.addShape("path",{attrs:S(S({},e),{path:s}),name:"interval"});return n?i:l},getMarker:function(r){var t=r.color,e=r.isInPolar;return e?{symbol:"circle",style:{r:4.5,fill:t}}:{symbol:"square",style:{r:4,fill:t}}}});function cdt(r,t){var e=r.length,i=r;mt(i[0])&&(i=r.map(function(s){return t.translate(s)}));for(var n=i[1]-i[0],a=2;a<e;a++){var o=i[a]-i[a-1];n>o&&(n=o)}return n}function hdt(r,t){if(t){var e=en(r),i=ea(e,t);return i.length}return r.length}function CA(r){var t=r.theme,e=r.coordinate,i=r.getXScale(),n=i.values,a=r.beforeMappingData,o=n.length,s=Vv(r.coordinate),l=r.intervalPadding,u=r.dodgePadding,c=r.maxColumnWidth||t.maxColumnWidth,h=r.minColumnWidth||t.minColumnWidth,f=r.columnWidthRatio||t.columnWidthRatio,d=r.multiplePieWidthRatio||t.multiplePieWidthRatio,v=r.roseWidthRatio||t.roseWidthRatio;if(i.isLinear&&n.length>1){n.sort();var p=cdt(n,i);o=(i.max-i.min)/p,n.length>o&&(o=n.length)}var g=i.range,m=1/o,y=1;if(e.isPolar?e.isTransposed&&o>1?y=d:y=v:(i.isLinear&&(m*=g[1]-g[0]),y=f),!K(l)&&l>=0){var _=l/s;m=(1-(o-1)*_)/o}else m*=y;if(r.getAdjust("dodge")){var x=r.getAdjust("dodge"),C=x.dodgeBy,A=hdt(a,C);if(!K(u)&&u>=0){var b=u/s;m=(m-b*(A-1))/A}else!K(l)&&l>=0&&(m*=y),m=m/A;m=m>=0?m:0}if(!K(c)&&c>=0){var R=c/s;m>R&&(m=R)}if(!K(h)&&h>=0){var M=h/s;m<M&&(m=M)}return m}var fdt=function(r){N(t,r);function t(e){var i=r.call(this,e)||this;i.type="interval",i.shapeType="interval",i.generatePoints=!0;var n=e.background;return i.background=n,i}return t.prototype.createShapePointsCfg=function(e){var i=r.prototype.createShapePointsCfg.call(this,e),n,a=this.getAttribute("size");if(a){n=this.getAttributeValues(a,e)[0];var o=this.coordinate,s=Vv(o);n=n/s}else this.defaultSize||(this.defaultSize=CA(this)),n=this.defaultSize;return i.size=n,i},t.prototype.adjustScale=function(){r.prototype.adjustScale.call(this);var e=this.getYScale();if(this.coordinate.type==="theta")e.change({nice:!1,min:0,max:nct(e)});else{var i=this.scaleDefs,n=e.field,a=e.min,o=e.max,s=e.type;s!=="time"&&(a>0&&!P(i,[n,"min"])&&e.change({min:0}),o<=0&&!P(i,[n,"max"])&&e.change({max:0}))}},t.prototype.getDrawCfg=function(e){var i=r.prototype.getDrawCfg.call(this,e);return i.background=this.background,i},t}(vl),ddt=function(r){N(t,r);function t(e){var i=r.call(this,e)||this;i.type="line";var n=e.sortable,a=n===void 0?!1:n;return i.sortable=a,i}return t}(yA),JN=["circle","square","bowtie","diamond","hexagon","triangle","triangle-down"],vdt=["cross","tick","plus","hyphen","line"];function EA(r,t,e,i,n){var a,o,s=nr(t,n,!n,"r"),l=r.parsePoints(t.points),u=l[0];if(t.isStack)u=l[1];else if(l.length>1){var c=e.addGroup();try{for(var h=Qt(l),f=h.next();!f.done;f=h.next()){var d=f.value;c.addShape({type:"marker",attrs:S(S(S({},s),{symbol:mu[i]||i}),d)})}}catch(v){a={error:v}}finally{try{f&&!f.done&&(o=h.return)&&o.call(h)}finally{if(a)throw a.error}}return c}return e.addShape({type:"marker",attrs:S(S(S({},s),{symbol:mu[i]||i}),u)})}dl("point",{defaultShapeType:"hollow-circle",getDefaultPoints:function(r){return cA(r)}});I(JN,function(r){de("point","hollow-".concat(r),{draw:function(t,e){return EA(this,t,e,r,!0)},getMarker:function(t){var e=t.color;return{symbol:mu[r]||r,style:{r:4.5,stroke:e,fill:null}}}})});var pdt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="point",e.shapeType="point",e.generatePoints=!0,e}return t.prototype.getDrawCfg=function(e){var i=r.prototype.getDrawCfg.call(this,e);return S(S({},i),{isStack:!!this.getAdjust("stack")})},t}(vl);function gdt(r){for(var t=r[0],e=1,i=[["M",t.x,t.y]];e<r.length;){var n=r[e];(n.x!==r[e-1].x||n.y!==r[e-1].y)&&(i.push(["L",n.x,n.y]),n.x===t.x&&n.y===t.y&&e<r.length-1&&(t=r[e+1],i.push(["Z"]),i.push(["M",t.x,t.y]),e++)),e++}return qt(cr(i),t)||i.push(["L",t.x,t.y]),i.push(["Z"]),i}dl("polygon",{defaultShapeType:"polygon",getDefaultPoints:function(r){var t=[];return I(r.x,function(e,i){var n=r.y[i];t.push({x:e,y:n})}),t}});de("polygon","polygon",{draw:function(r,t){if(!Mi(r.points)){var e=nr(r,!0,!0),i=this.parsePath(gdt(r.points));return t.addShape("path",{attrs:S(S({},e),{path:i}),name:"polygon"})}},getMarker:function(r){var t=r.color;return{symbol:"square",style:{r:4,fill:t}}}});var mdt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="polygon",e.shapeType="polygon",e.generatePoints=!0,e}return t.prototype.createShapePointsCfg=function(e){var i=r.prototype.createShapePointsCfg.call(this,e),n=i.x,a=i.y,o;if(!(q(n)&&q(a))){var s=this.getXScale(),l=this.getYScale(),u=s.values.length,c=l.values.length,h=.5*1/u,f=.5*1/c;s.isCategory&&l.isCategory?(n=[n-h,n-h,n+h,n+h],a=[a-f,a+f,a+f,a-f]):q(n)?(o=n,n=[o[0],o[0],o[1],o[1]],a=[a-f/2,a+f/2,a+f/2,a-f/2]):q(a)&&(o=a,a=[o[0],o[1],o[1],o[0]],n=[n-h/2,n-h/2,n+h/2,n+h/2]),i.x=n,i.y=a}return i},t}(vl);dl("schema",{defaultShapeType:""});var ydt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="schema",e.shapeType="schema",e.generatePoints=!0,e}return t.prototype.createShapePointsCfg=function(e){var i=r.prototype.createShapePointsCfg.call(this,e),n,a=this.getAttribute("size");if(a){n=this.getAttributeValues(a,e)[0];var o=this.coordinate,s=Vv(o);n=n/s}else this.defaultSize||(this.defaultSize=CA(this)),n=this.defaultSize;return i.size=n,i},t}(vl);function _dt(r){if(!q(r))return[];var t=rn(r);return Ne(r,function(e){return e/t})}dl("violin",{defaultShapeType:"violin",getDefaultPoints:function(r){var t=r.size/2,e=[],i=_dt(r._size);return I(r.y,function(n,a){var o=i[a]*t,s=a===0,l=a===r.y.length-1;e.push({isMin:s,isMax:l,x:r.x-o,y:n}),e.unshift({isMin:s,isMax:l,x:r.x+o,y:n})}),e}});de("violin","violin",{draw:function(r,t){var e=nr(r,!0,!0),i=this.parsePath(TN(r.points));return t.addShape("path",{attrs:S(S({},e),{path:i}),name:"violin"})},getMarker:function(r){var t=r.color;return{symbol:"circle",style:{r:4,fill:t}}}});var xdt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="violin",e.shapeType="violin",e.generatePoints=!0,e}return t.prototype.createShapePointsCfg=function(e){var i=r.prototype.createShapePointsCfg.call(this,e),n,a=this.getAttribute("size");if(a){n=this.getAttributeValues(a,e)[0];var o=this.coordinate,s=Vv(o);n=n/s}else this.defaultSize||(this.defaultSize=CA(this)),n=this.defaultSize;return i.size=n,i._size=P(e[Se],[this._sizeField]),i},t.prototype.initAttributes=function(){var e=this.attributeOption,i=e.size?e.size.fields[0]:this._sizeField?this._sizeField:"size";this._sizeField=i,delete e.size,r.prototype.initAttributes.call(this)},t}(vl);de("area","line",{draw:function(r,t){var e=py(r,!0,!1,this),i=t.addShape({type:"path",attrs:e,name:"area"});return i},getMarker:function(r){var t=r.color;return{symbol:function(e,i,n){return n===void 0&&(n=5.5),[["M",e-n,i-4],["L",e+n,i-4],["L",e+n,i+4],["L",e-n,i+4],["Z"]]},style:{r:5,stroke:t,fill:null}}}});de("area","smooth",{draw:function(r,t){var e=this.coordinate,i=py(r,!1,!0,this,ZN(e)),n=t.addShape({type:"path",attrs:i,name:"area"});return n},getMarker:function(r){var t=r.color;return{symbol:function(e,i,n){return n===void 0&&(n=5.5),[["M",e-n,i-4],["L",e+n,i-4],["L",e+n,i+4],["L",e-n,i+4],["Z"]]},style:{r:5,fill:t,fillOpacity:1}}}});de("area","smooth-line",{draw:function(r,t){var e=this.coordinate,i=py(r,!0,!0,this,ZN(e)),n=t.addShape({type:"path",attrs:i,name:"area"});return n},getMarker:function(r){var t=r.color;return{symbol:function(e,i,n){return n===void 0&&(n=5.5),[["M",e-n,i-4],["L",e+n,i-4],["L",e+n,i+4],["L",e-n,i+4],["Z"]]},style:{r:5,stroke:t,fill:null}}}});function nC(r,t){return["C",r.x*1/2+t.x*1/2,r.y,r.x*1/2+t.x*1/2,t.y,t.x,t.y]}function aC(r,t){var e=[];e.push({x:t.x,y:t.y}),e.push(r);var i=["Q"];return I(e,function(n){i.push(n.x,n.y)}),i}function Cdt(r,t,e){var i=aC(t,e),n=[["M",r.x,r.y]];return n.push(i),n}function Edt(r,t){var e=aC(r[1],t),i=aC(r[3],t),n=[["M",r[0].x,r[0].y]];return n.push(i),n.push(["L",r[3].x,r[3].y]),n.push(["L",r[2].x,r[2].y]),n.push(e),n.push(["L",r[1].x,r[1].y]),n.push(["L",r[0].x,r[0].y]),n.push(["Z"]),n}de("edge","arc",{draw:function(r,t){var e=nr(r,!0,!1,"lineWidth"),i=r.points,n=i.length>2?"weight":"normal",a;if(r.isInCircle){var o={x:0,y:1};return n==="normal"?a=Cdt(i[0],i[1],o):(e.fill=e.stroke,a=Edt(i,o)),a=this.parsePath(a),t.addShape("path",{attrs:S(S({},e),{path:a})})}else{if(n==="normal")return i=this.parsePoints(i),a=U4((i[1].x+i[0].x)/2,i[0].y,Math.abs(i[1].x-i[0].x)/2,Math.PI,Math.PI*2),t.addShape("path",{attrs:S(S({},e),{path:a})});var s=nC(i[1],i[3]),l=nC(i[2],i[0]);return a=[["M",i[0].x,i[0].y],["L",i[1].x,i[1].y],s,["L",i[3].x,i[3].y],["L",i[2].x,i[2].y],l,["Z"]],a=this.parsePath(a),e.fill=e.stroke,t.addShape("path",{attrs:S(S({},e),{path:a})})}},getMarker:function(r){return{symbol:"circle",style:{r:4.5,fill:r.color}}}});function Sdt(r,t){var e=nC(r,t),i=[["M",r.x,r.y]];return i.push(e),i}de("edge","smooth",{draw:function(r,t){var e=nr(r,!0,!1,"lineWidth"),i=r.points,n=this.parsePath(Sdt(i[0],i[1]));return t.addShape("path",{attrs:S(S({},e),{path:n})})},getMarker:function(r){return{symbol:"circle",style:{r:4.5,fill:r.color}}}});var ig=1/3;function Adt(r,t){var e=[];e.push({x:r.x,y:r.y*(1-ig)+t.y*ig}),e.push({x:t.x,y:r.y*(1-ig)+t.y*ig}),e.push(t);var i=[["M",r.x,r.y]];return I(e,function(n){i.push(["L",n.x,n.y])}),i}de("edge","vhv",{draw:function(r,t){var e=nr(r,!0,!1,"lineWidth"),i=r.points,n=this.parsePath(Adt(i[0],i[1]));return t.addShape("path",{attrs:S(S({},e),{path:n})})},getMarker:function(r){return{symbol:"circle",style:{r:4.5,fill:r.color}}}});de("interval","funnel",{getPoints:function(r){return r.size=r.size*2,_A(r)},draw:function(r,t){var e=nr(r,!1,!0),i=this.parsePath(QN(r.points,r.nextPoints,!1)),n=t.addShape("path",{attrs:S(S({},e),{path:i}),name:"interval"});return n},getMarker:function(r){var t=r.color;return{symbol:"square",style:{r:4,fill:t}}}});de("interval","hollow-rect",{draw:function(r,t){var e=nr(r,!0,!1),i=t,n=r==null?void 0:r.background;if(n){i=t.addGroup();var a=wN(r),o=KN(r,this.parsePoints(r.points),this.coordinate);i.addShape("path",{attrs:S(S({},a),{path:o}),capture:!1,zIndex:-1,name:sA})}var s=this.parsePath(xA(r.points)),l=i.addShape("path",{attrs:S(S({},e),{path:s}),name:"interval"});return n?i:l},getMarker:function(r){var t=r.color,e=r.isInPolar;return e?{symbol:"circle",style:{r:4.5,stroke:t,fill:null}}:{symbol:"square",style:{r:4,stroke:t,fill:null}}}});function Tdt(r){var t=r.x,e=r.y,i=r.y0;return q(e)?e.map(function(n,a){return{x:q(t)?t[a]:t,y:n}}):[{x:t,y:i},{x:t,y:e}]}de("interval","line",{getPoints:function(r){return Tdt(r)},draw:function(r,t){var e=nr(r,!0,!1,"lineWidth"),i=$i(S({},e),["fill"]),n=this.parsePath(xA(r.points,!1)),a=t.addShape("path",{attrs:S(S({},i),{path:n}),name:"interval"});return a},getMarker:function(r){var t=r.color;return{symbol:function(e,i,n){return[["M",e,i-n],["L",e,i+n]]},style:{r:5,stroke:t}}}});de("interval","pyramid",{getPoints:function(r){return r.size=r.size*2,_A(r)},draw:function(r,t){var e=nr(r,!1,!0),i=this.parsePath(QN(r.points,r.nextPoints,!0)),n=t.addShape("path",{attrs:S(S({},e),{path:i}),name:"interval"});return n},getMarker:function(r){var t=r.color;return{symbol:"square",style:{r:4,fill:t}}}});function bdt(r){var t,e=r.x,i=r.y,n=r.y0,a=r.size,o,s;q(i)?(t=ct(i,2),o=t[0],s=t[1]):(o=n,s=i);var l=e+a/2,u=e-a/2;return[{x:e,y:o},{x:e,y:s},{x:u,y:o},{x:l,y:o},{x:u,y:s},{x:l,y:s}]}function wdt(r){return[["M",r[0].x,r[0].y],["L",r[1].x,r[1].y],["M",r[2].x,r[2].y],["L",r[3].x,r[3].y],["M",r[4].x,r[4].y],["L",r[5].x,r[5].y]]}de("interval","tick",{getPoints:function(r){return bdt(r)},draw:function(r,t){var e=nr(r,!0,!1),i=this.parsePath(wdt(r.points)),n=t.addShape("path",{attrs:S(S({},e),{path:i}),name:"interval"});return n},getMarker:function(r){var t=r.color;return{symbol:function(e,i,n){return[["M",e-n/2,i-n],["L",e+n/2,i-n],["M",e,i-n],["L",e,i+n],["M",e-n/2,i+n],["L",e+n/2,i+n]]},style:{r:5,stroke:t}}}});var Rdt=function(r,t,e){var i=r.x,n=r.y,a=t.x,o=t.y,s;switch(e){case"hv":s=[{x:a,y:n}];break;case"vh":s=[{x:i,y:o}];break;case"hvh":var l=(a+i)/2;s=[{x:l,y:n},{x:l,y:o}];break;case"vhv":var u=(n+o)/2;s=[{x:i,y:u},{x:a,y:u}];break}return s};function Mdt(r,t){var e=[];return I(r,function(i,n){var a=r[n+1];if(e.push(i),a){var o=Rdt(i,a,t);e=e.concat(o)}}),e}function Idt(r){return r.map(function(t,e){return e===0?["M",t.x,t.y]:["L",t.x,t.y]})}function Ldt(r,t){var e=vy(r.points,r.connectNulls,r.showSinglePoint),i=[];return I(e,function(n){var a=Mdt(n,t);i=i.concat(Idt(a))}),S(S({},nr(r,!0,!1,"lineWidth")),{path:i})}I(["hv","vh","hvh","vhv"],function(r){de("line",r,{draw:function(t,e){var i=Ldt(t,r),n=e.addShape({type:"path",attrs:i,name:"line"});return n},getMarker:function(t){return RN(t,r)}})});I(vdt,function(r){de("point",r,{draw:function(t,e){return EA(this,t,e,r,!0)},getMarker:function(t){var e=t.color;return{symbol:mu[r],style:{r:4.5,stroke:e,fill:null}}}})});de("point","image",{draw:function(r,t){var e,i,n=nr(r,!1,!1,"r").r,a=this.parsePoints(r.points),o=a[0];if(r.isStack)o=a[1];else if(a.length>1){var s=t.addGroup();try{for(var l=Qt(a),u=l.next();!u.done;u=l.next()){var c=u.value;s.addShape("image",{attrs:{x:c.x-n/2,y:c.y-n,width:n,height:n,img:r.shape[1]}})}}catch(h){e={error:h}}finally{try{u&&!u.done&&(i=l.return)&&i.call(l)}finally{if(e)throw e.error}}return s}return t.addShape("image",{attrs:{x:o.x-n/2,y:o.y-n,width:n,height:n,img:r.shape[1]}})},getMarker:function(r){var t=r.color;return{symbol:"circle",style:{r:4.5,fill:t}}}});I(JN,function(r){de("point",r,{draw:function(t,e){return EA(this,t,e,r,!1)},getMarker:function(t){var e=t.color;return{symbol:mu[r]||r,style:{r:4.5,fill:e}}}})});function K3(r){var t=q(r)?r:[r],e=t[0],i=t[t.length-1],n=t.length>1?t[1]:e,a=t.length>3?t[3]:i,o=t.length>2?t[2]:n;return{min:e,max:i,min1:n,max1:a,median:o}}function Q3(r,t,e){var i=e/2,n;if(q(t)){var a=K3(t),o=a.min,s=a.max,l=a.median,u=a.min1,c=a.max1,h=r-i,f=r+i;n=[[h,s],[f,s],[r,s],[r,c],[h,u],[h,c],[f,c],[f,u],[r,u],[r,o],[h,o],[f,o],[h,l],[f,l]]}else{t=K(t)?.5:t;var d=K3(r),o=d.min,s=d.max,l=d.median,u=d.min1,c=d.max1,v=t-i,p=t+i;n=[[o,v],[o,p],[o,t],[u,t],[u,v],[u,p],[c,p],[c,v],[c,t],[s,t],[s,v],[s,p],[l,v],[l,p]]}return n.map(function(g){return{x:g[0],y:g[1]}})}function Odt(r){return[["M",r[0].x,r[0].y],["L",r[1].x,r[1].y],["M",r[2].x,r[2].y],["L",r[3].x,r[3].y],["M",r[4].x,r[4].y],["L",r[5].x,r[5].y],["L",r[6].x,r[6].y],["L",r[7].x,r[7].y],["L",r[4].x,r[4].y],["Z"],["M",r[8].x,r[8].y],["L",r[9].x,r[9].y],["M",r[10].x,r[10].y],["L",r[11].x,r[11].y],["M",r[12].x,r[12].y],["L",r[13].x,r[13].y]]}de("schema","box",{getPoints:function(r){var t=r.x,e=r.y,i=r.size;return Q3(t,e,i)},draw:function(r,t){var e=nr(r,!0,!1),i=this.parsePath(Odt(r.points)),n=t.addShape("path",{attrs:S(S({},e),{path:i,name:"schema"})});return n},getMarker:function(r){var t=r.color;return{symbol:function(e,i,n){var a=[i-6,i-3,i,i+3,i+6],o=Q3(e,a,n);return[["M",o[0].x+1,o[0].y],["L",o[1].x-1,o[1].y],["M",o[2].x,o[2].y],["L",o[3].x,o[3].y],["M",o[4].x,o[4].y],["L",o[5].x,o[5].y],["L",o[6].x,o[6].y],["L",o[7].x,o[7].y],["L",o[4].x,o[4].y],["Z"],["M",o[8].x,o[8].y],["L",o[9].x,o[9].y],["M",o[10].x+1,o[10].y],["L",o[11].x-1,o[11].y],["M",o[12].x,o[12].y],["L",o[13].x,o[13].y]]},style:{r:6,lineWidth:1,stroke:t}}}});function Pdt(r){var t=q(r)?r:[r],e=t.sort(function(i,n){return n-i});return Zut(e,4,e[e.length-1])}function J3(r,t,e){var i=Pdt(t);return[{x:r,y:i[0]},{x:r,y:i[1]},{x:r-e/2,y:i[2]},{x:r-e/2,y:i[1]},{x:r+e/2,y:i[1]},{x:r+e/2,y:i[2]},{x:r,y:i[2]},{x:r,y:i[3]}]}function Fdt(r){return[["M",r[0].x,r[0].y],["L",r[1].x,r[1].y],["M",r[2].x,r[2].y],["L",r[3].x,r[3].y],["L",r[4].x,r[4].y],["L",r[5].x,r[5].y],["Z"],["M",r[6].x,r[6].y],["L",r[7].x,r[7].y]]}de("schema","candle",{getPoints:function(r){var t=r.x,e=r.y,i=r.size;return J3(t,e,i)},draw:function(r,t){var e=nr(r,!0,!0),i=this.parsePath(Fdt(r.points)),n=t.addShape("path",{attrs:S(S({},e),{path:i,name:"schema"})});return n},getMarker:function(r){var t=r.color;return{symbol:function(e,i,n){var a=[i+7.5,i+3,i-3,i-7.5],o=J3(e,a,n);return[["M",o[0].x,o[0].y],["L",o[1].x,o[1].y],["M",o[2].x,o[2].y],["L",o[3].x,o[3].y],["L",o[4].x,o[4].y],["L",o[5].x,o[5].y],["Z"],["M",o[6].x,o[6].y],["L",o[7].x,o[7].y]]},style:{lineWidth:1,stroke:t,fill:t,r:6}}}});function Bdt(r,t){var e=Math.abs(r[0].x-r[2].x),i=Math.abs(r[0].y-r[2].y),n=Math.min(e,i);t&&(n=Oe(t,0,Math.min(e,i))),n=n/2;var a=(r[0].x+r[2].x)/2,o=(r[0].y+r[2].y)/2;return{x:a-n,y:o-n,width:n*2,height:n*2}}de("polygon","square",{draw:function(r,t){if(!Mi(r.points)){var e=nr(r,!0,!0),i=this.parsePoints(r.points);return t.addShape("rect",{attrs:S(S({},e),Bdt(i,r.size)),name:"polygon"})}},getMarker:function(r){var t=r.color;return{symbol:"square",style:{r:4,fill:t}}}});de("violin","smooth",{draw:function(r,t){var e=nr(r,!0,!0),i=this.parsePath(bN(r.points));return t.addShape("path",{attrs:S(S({},e),{path:i})})},getMarker:function(r){var t=r.color;return{symbol:"circle",style:{stroke:null,r:4,fill:t}}}});de("violin","hollow",{draw:function(r,t){var e=nr(r,!0,!1),i=this.parsePath(TN(r.points));return t.addShape("path",{attrs:S(S({},e),{path:i})})},getMarker:function(r){var t=r.color;return{symbol:"circle",style:{r:4,fill:null,stroke:t}}}});de("violin","hollow-smooth",{draw:function(r,t){var e=nr(r,!0,!1),i=this.parsePath(bN(r.points));return t.addShape("path",{attrs:S(S({},e),{path:i})})},getMarker:function(r){var t=r.color;return{symbol:"circle",style:{r:4,fill:null,stroke:t}}}});var Ddt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getLabelValueDir=function(e){var i="y",n=e.points;return n[0][i]<=n[2][i]?1:-1},t.prototype.getLabelOffsetPoint=function(e,i,n,a){var o,s=r.prototype.getLabelOffsetPoint.call(this,e,i,n),l=this.getCoordinate(),u=l.isTransposed,c=u?"x":"y",h=this.getLabelValueDir(e.mappingData);return s=S(S({},s),(o={},o[c]=s[c]*h,o)),l.isReflect("x")&&(s=S(S({},s),{x:s.x*-1})),l.isReflect("y")&&(s=S(S({},s),{y:s.y*-1})),s},t.prototype.getThemedLabelCfg=function(e){var i=this.geometry,n=this.getDefaultLabelCfg(),a=i.theme;return at({},n,a.labels,e.position==="middle"?{offset:0}:{},e)},t.prototype.setLabelPosition=function(e,i,n,a){var o=this.getCoordinate(),s=o.isTransposed,l=i.points,u=o.convert(l[0]),c=o.convert(l[2]),h=this.getLabelValueDir(i),f,d,v,p,g=q(i.shape)?i.shape[0]:i.shape;if(g==="funnel"||g==="pyramid"){var m=P(i,"nextPoints"),y=P(i,"points");if(m){var _=o.convert(y[0]),x=o.convert(y[1]),C=o.convert(m[0]),A=o.convert(m[1]);s?(f=Math.min(C.y,_.y),v=Math.max(C.y,_.y),d=(x.x+A.x)/2,p=(_.x+C.x)/2):(f=Math.min((x.y+A.y)/2,(_.y+C.y)/2),v=Math.max((x.y+A.y)/2,(_.y+C.y)/2),d=A.x,p=_.x)}else f=Math.min(c.y,u.y),v=Math.max(c.y,u.y),d=c.x,p=u.x}else f=Math.min(c.y,u.y),v=Math.max(c.y,u.y),d=c.x,p=u.x;switch(a){case"right":e.x=d,e.y=(f+v)/2,e.textAlign=P(e,"textAlign",h>0?"left":"right");break;case"left":e.x=p,e.y=(f+v)/2,e.textAlign=P(e,"textAlign",h>0?"left":"right");break;case"bottom":s&&(e.x=(d+p)/2),e.y=v,e.textAlign=P(e,"textAlign","center"),e.textBaseline=P(e,"textBaseline",h>0?"bottom":"top");break;case"middle":s&&(e.x=(d+p)/2),e.y=(f+v)/2,e.textAlign=P(e,"textAlign","center"),e.textBaseline=P(e,"textBaseline","middle");break;case"top":s&&(e.x=(d+p)/2),e.y=f,e.textAlign=P(e,"textAlign","center"),e.textBaseline=P(e,"textBaseline",h>0?"bottom":"top");break}},t}(dy),ng=Math.PI/2,t6=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getLabelOffset=function(e){var i=this.getCoordinate(),n=0;if(Tt(e))n=e;else if(mt(e)&&e.indexOf("%")!==-1){var a=i.getRadius();i.innerRadius>0&&(a=a*(1-i.innerRadius)),n=parseFloat(e)*.01*a}return n},t.prototype.getLabelItems=function(e){var i=r.prototype.getLabelItems.call(this,e),n=this.geometry.getYScale();return Ne(i,function(a){if(a&&n){var o=n.scale(P(a.data,n.field));return S(S({},a),{percent:o})}return a})},t.prototype.getLabelAlign=function(e){var i=this.getCoordinate(),n;if(e.labelEmit)n=e.angle<=Math.PI/2&&e.angle>=-Math.PI/2?"left":"right";else if(!i.isTransposed)n="center";else{var a=i.getCenter(),o=e.offset;Math.abs(e.x-a.x)<1?n="center":e.angle>Math.PI||e.angle<=0?n=o>0?"left":"right":n=o>0?"right":"left"}return n},t.prototype.getLabelPoint=function(e,i,n){var a=1,o,s=e.content[n];this.isToMiddle(i)?o=this.getMiddlePoint(i.points):(e.content.length===1&&n===0?n=1:n===0&&(a=-1),o=this.getArcPoint(i,n));var l=e.offset*a,u=this.getPointAngle(o),c=e.labelEmit,h=this.getCirclePoint(u,l,o,c);return h.r===0?h.content="":(h.content=s,h.angle=u,h.color=i.color),h.rotate=e.autoRotate?this.getLabelRotate(u,l,c):e.rotate,h.start={x:o.x,y:o.y},h},t.prototype.getArcPoint=function(e,i){return i===void 0&&(i=0),!q(e.x)&&!q(e.y)?{x:e.x,y:e.y}:{x:q(e.x)?e.x[i]:e.x,y:q(e.y)?e.y[i]:e.y}},t.prototype.getPointAngle=function(e){return ah(this.getCoordinate(),e)},t.prototype.getCirclePoint=function(e,i,n,a){var o=this.getCoordinate(),s=o.getCenter(),l=ly(o,n);if(l===0)return S(S({},s),{r:l});var u=e;if(o.isTransposed&&l>i&&!a){var c=Math.asin(i/(2*l));u=e+c*2}else l=l+i;return{x:s.x+l*Math.cos(u),y:s.y+l*Math.sin(u),r:l}},t.prototype.getLabelRotate=function(e,i,n){var a=e+ng;return n&&(a-=ng),a&&(a>ng?a=a-Math.PI:a<-ng&&(a=a+Math.PI)),a},t.prototype.getMiddlePoint=function(e){var i=this.getCoordinate(),n=e.length,a={x:0,y:0};return I(e,function(o){a.x+=o.x,a.y+=o.y}),a.x/=n,a.y/=n,a=i.convert(a),a},t.prototype.isToMiddle=function(e){return e.x.length>2},t}(dy),Ndt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.defaultLayout="distribute",e}return t.prototype.getDefaultLabelCfg=function(e,i){var n=r.prototype.getDefaultLabelCfg.call(this,e,i);return at({},n,P(this.geometry.theme,"pieLabels",{}))},t.prototype.getLabelOffset=function(e){return r.prototype.getLabelOffset.call(this,e)||0},t.prototype.getLabelRotate=function(e,i,n){var a;return i<0&&(a=e,a>Math.PI/2&&(a=a-Math.PI),a<-Math.PI/2&&(a=a+Math.PI)),a},t.prototype.getLabelAlign=function(e){var i=this.getCoordinate(),n=i.getCenter(),a;return e.angle<=Math.PI/2&&e.x>=n.x?a="left":a="right",e.offset<=0&&(a==="right"?a="left":a="right"),a},t.prototype.getArcPoint=function(e){return e},t.prototype.getPointAngle=function(e){var i=this.getCoordinate(),n={x:q(e.x)?e.x[0]:e.x,y:e.y[0]},a={x:q(e.x)?e.x[1]:e.x,y:e.y[1]},o,s=ah(i,n);if(e.points&&e.points[0].y===e.points[1].y)o=s;else{var l=ah(i,a);s>=l&&(l=l+Math.PI*2),o=s+(l-s)/2}return o},t.prototype.getCirclePoint=function(e,i){var n=this.getCoordinate(),a=n.getCenter(),o=n.getRadius()+i;return S(S({},ur(a.x,a.y,o,e)),{angle:e,r:o})},t}(t6),tI=4;function kdt(r,t,e,i,n,a){var o,s,l=!0,u=i.start,c=i.end,h=Math.min(u.y,c.y),f=Math.abs(u.y-c.y),d,v=0,p=Number.MIN_VALUE,g=t.map(function(b){return b.y>v&&(v=b.y),b.y<p&&(p=b.y),{size:e,targets:[b.y-h]}});for(p-=h,v-h>f&&(f=v-h);l;)for(g.forEach(function(b){var R=(Math.min.apply(p,b.targets)+Math.max.apply(p,b.targets))/2;b.pos=Math.min(Math.max(p,R-b.size/2),f-b.size)}),l=!1,d=g.length;d--;)if(d>0){var m=g[d-1],y=g[d];m.pos+m.size>y.pos&&(m.size+=y.size,m.targets=m.targets.concat(y.targets),m.pos+m.size>f&&(m.pos=f-m.size),g.splice(d,1),l=!0)}d=0,g.forEach(function(b){var R=h+e/2;b.targets.forEach(function(){t[d].y=b.pos+R,R+=e,d++})});var _={};try{for(var x=Qt(r),C=x.next();!C.done;C=x.next()){var A=C.value;_[A.get("id")]=A}}catch(b){o={error:b}}finally{try{C&&!C.done&&(s=x.return)&&s.call(x)}finally{if(o)throw o.error}}t.forEach(function(b){var R=b.r*b.r,M=Math.pow(Math.abs(b.y-n.y),2);if(R<M)b.x=n.x;else{var O=Math.sqrt(R-M);a?b.x=n.x+O:b.x=n.x-O}var F=_[b.id];F.attr("x",b.x),F.attr("y",b.y);var D=Qn(F.getChildren(),function(H){return H.get("type")==="text"});D&&(D.attr("y",b.y),D.attr("x",b.x))})}function Udt(r,t,e,i){if(!(!r.length||!t.length)){var n=r[0]?r[0].offset:0,a=t[0].get("coordinate"),o=a.getRadius(),s=a.getCenter();if(n>0){var l=14,u=o+n,c=u*2+l*2,h={start:a.start,end:a.end},f=[[],[]];r.forEach(function(d){d&&(d.textAlign==="right"?f[0].push(d):f[1].push(d))}),f.forEach(function(d,v){var p=c/l;d.length>p&&(d.sort(function(g,m){return m["..percent"]-g["..percent"]}),d.splice(p,d.length-p)),d.sort(function(g,m){return g.y-m.y}),kdt(t,d,l,h,s,v)})}I(r,function(d){if(d&&d.labelLine){var v=d.offset,p=d.angle,g=ur(s.x,s.y,o,p),m=ur(s.x,s.y,o+v/2,p),y=d.x+P(d,"offsetX",0),_=d.y+P(d,"offsetY",0),x={x:y-Math.cos(p)*tI,y:_-Math.sin(p)*tI};ie(d.labelLine)||(d.labelLine={}),d.labelLine.path=["M ".concat(g.x),"".concat(g.y," Q").concat(m.x),"".concat(m.y," ").concat(x.x),x.y].join(",")}})}}function e6(r,t,e){var i=r.filter(function(v){return!v.invisible});i.sort(function(v,p){return v.y-p.y});var n=!0,a=e.minY,o=e.maxY,s=Math.abs(a-o),l,u=0,c=Number.MIN_VALUE,h=i.map(function(v){return v.y>u&&(u=v.y),v.y<c&&(c=v.y),{content:v.content,size:t,targets:[v.y-a],pos:null}});for(c-=a,u-a>s&&(s=u-a);n;)for(h.forEach(function(v){var p=(Math.min.apply(c,v.targets)+Math.max.apply(c,v.targets))/2;v.pos=Math.min(Math.max(c,p-v.size/2),s-v.size),v.pos=Math.max(0,v.pos)}),n=!1,l=h.length;l--;)if(l>0){var f=h[l-1],d=h[l];f.pos+f.size>d.pos&&(f.size+=d.size,f.targets=f.targets.concat(d.targets),f.pos+f.size>s&&(f.pos=s-f.size),h.splice(l,1),n=!0)}l=0,h.forEach(function(v){var p=a+t/2;v.targets.forEach(function(){i[l].y=v.pos+p,p+=t,l++})})}var eI=4;function zdt(r,t){var e=t.getCenter(),i=t.getRadius();if(r&&r.labelLine){var n=r.angle,a=r.offset,o=ur(e.x,e.y,i,n),s=r.x+P(r,"offsetX",0)*(Math.cos(n)>0?1:-1),l=r.y+P(r,"offsetY",0)*(Math.sin(n)>0?1:-1),u={x:s-Math.cos(n)*eI,y:l-Math.sin(n)*eI},c=r.labelLine.smooth,h=[],f=u.x-e.x,d=u.y-e.y,v=Math.atan(d/f);if(f<0&&(v+=Math.PI),c===!1){ie(r.labelLine)||(r.labelLine={});var p=0;(n<0&&n>-Math.PI/2||n>Math.PI*1.5)&&u.y>o.y&&(p=1),n>=0&&n<Math.PI/2&&u.y>o.y&&(p=1),n>=Math.PI/2&&n<Math.PI&&o.y>u.y&&(p=1),(n<-Math.PI/2||n>=Math.PI&&n<Math.PI*1.5)&&o.y>u.y&&(p=1);var g=a/2>4?4:Math.max(a/2-1,0),m=ur(e.x,e.y,i+g,n),y=ur(e.x,e.y,i+a/2,v),_=0;h.push("M ".concat(o.x," ").concat(o.y)),h.push("L ".concat(m.x," ").concat(m.y)),h.push("A ".concat(e.x," ").concat(e.y," 0 ").concat(_," ").concat(p," ").concat(y.x," ").concat(y.y)),h.push("L ".concat(u.x," ").concat(u.y))}else{var m=ur(e.x,e.y,i+(a/2>4?4:Math.max(a/2-1,0)),n),x=o.x<e.x?1:-1;h.push("M ".concat(u.x," ").concat(u.y));var C=(o.y-e.y)/(o.x-e.x),A=(u.y-e.y)/(u.x-e.x);Math.abs(C-A)>Math.pow(Math.E,-16)&&h.push.apply(h,["C",u.x+x*4,u.y,2*m.x-o.x,2*m.y-o.y,o.x,o.y]),h.push("L ".concat(o.x," ").concat(o.y))}r.labelLine.path=h.join(" ")}}function Hdt(r,t,e,i){var n,a,o=Fr(r,function(R){return!K(R)}),s=t[0]&&t[0].get("coordinate");if(s){var l=s.getCenter(),u=s.getRadius(),c={};try{for(var h=Qt(t),f=h.next();!f.done;f=h.next()){var d=f.value;c[d.get("id")]=d}}catch(R){n={error:R}}finally{try{f&&!f.done&&(a=h.return)&&a.call(h)}finally{if(n)throw n.error}}var v=P(o[0],"labelHeight",14),p=P(o[0],"offset",0);if(!(p<=0)){var g="left",m="right",y=Qi(o,function(R){return R.x<l.x?g:m}),_=s.start,x=s.end,C=Math.min((u+p+v)*2,s.getHeight()),A=C/2,b={minX:_.x,maxX:x.x,minY:l.y-A,maxY:l.y+A};I(y,function(R,M){var O=Math.floor(C/v);R.length>O&&(R.sort(function(F,D){return D.percent-F.percent}),I(R,function(F,D){D+1>O&&(c[F.id].set("visible",!1),F.invisible=!0)})),e6(R,v,b)}),I(y,function(R,M){I(R,function(O){var F=M===m,D=c[O.id],H=D.getChildByIndex(0);if(H){var j=u+p,$=O.y-l.y,k=Math.pow(j,2),V=Math.pow($,2),Q=k-V>0?k-V:0,Y=Math.sqrt(Q),tt=Math.abs(Math.cos(O.angle)*j);F?O.x=l.x+Math.max(Y,tt):O.x=l.x-Math.max(Y,tt)}H&&(H.attr("y",O.y),H.attr("x",O.x)),zdt(O,s)})})}}}var oC=4,$dt=4,rI=4;function Wdt(r,t,e){var i=t.getCenter(),n=t.getRadius(),a={x:r.x-(e?rI:-rI),y:r.y},o=ur(i.x,i.y,n+oC,r.angle),s={x:a.x,y:a.y},l={x:o.x,y:o.y},u=ur(i.x,i.y,n,r.angle),c="";if(a.y!==o.y){var h=e?4:-4;s.y=a.y,r.angle<0&&r.angle>=-Math.PI/2&&(s.x=Math.max(o.x,a.x-h),a.y<o.y?l.y=s.y:(l.y=o.y,l.x=Math.max(l.x,s.x-h))),r.angle>0&&r.angle<Math.PI/2&&(s.x=Math.max(o.x,a.x-h),a.y>o.y?l.y=s.y:(l.y=o.y,l.x=Math.max(l.x,s.x-h))),r.angle>Math.PI/2&&(s.x=Math.min(o.x,a.x-h),a.y>o.y?l.y=s.y:(l.y=o.y,l.x=Math.min(l.x,s.x-h))),r.angle<-Math.PI/2&&(s.x=Math.min(o.x,a.x-h),a.y<o.y?l.y=s.y:(l.y=o.y,l.x=Math.min(l.x,s.x-h)))}c=["M ".concat(a.x,",").concat(a.y),"L ".concat(s.x,",").concat(s.y),"L ".concat(l.x,",").concat(l.y),"L ".concat(o.x,",").concat(o.y),"L ".concat(u.x,",").concat(u.y)].join(" "),r.labelLine=at({},r.labelLine,{path:c})}function Vdt(r,t,e,i){var n,a,o=t[0]&&t[0].get("coordinate");if(o){var s=o.getCenter(),l=o.getRadius(),u={};try{for(var c=Qt(t),h=c.next();!h.done;h=c.next()){var f=h.value;u[f.get("id")]=f}}catch(R){n={error:R}}finally{try{h&&!h.done&&(a=c.return)&&a.call(c)}finally{if(n)throw n.error}}var d=P(r[0],"labelHeight",14),v=Math.max(P(r[0],"offset",0),oC);I(r,function(R){if(R){var M=P(u,[R.id]);if(M){var O=R.x>s.x||R.x===s.x&&R.y>s.y,F=K(R.offsetX)?$dt:R.offsetX,D=ur(s.x,s.y,l+oC,R.angle),H=v+F;R.x=s.x+(O?1:-1)*(l+H),R.y=D.y}}});var p=o.start,g=o.end,m="left",y="right",_=Qi(r,function(R){return R.x<s.x?m:y}),x=(l+v)*2+d;I(_,function(R){var M=R.length*d;M>x&&(x=Math.min(M,Math.abs(p.y-g.y)))});var C={minX:p.x,maxX:g.x,minY:s.y-x/2,maxY:s.y+x/2};I(_,function(R,M){var O=x/d;R.length>O&&(R.sort(function(F,D){return D.percent-F.percent}),I(R,function(F,D){D>O&&(u[F.id].set("visible",!1),F.invisible=!0)})),e6(R,d,C)});var A=C.minY,b=C.maxY;I(_,function(R,M){var O=M===y;I(R,function(F){var D=P(u,F&&[F.id]);if(D){if(F.y<A||F.y>b){D.set("visible",!1);return}var H=D.getChildByIndex(0),j=H.getCanvasBBox(),$={x:O?j.x:j.maxX,y:j.y+j.height/2};Yv(H,F.x-$.x,F.y-$.y),F.labelLine&&Wdt(F,o,O)}})})}}function Gdt(r,t,e,i){I(t,function(n){var a=i.minX,o=i.minY,s=i.maxX,l=i.maxY,u=n.getCanvasBBox(),c=u.minX,h=u.minY,f=u.maxX,d=u.maxY,v=u.x,p=u.y,g=u.width,m=u.height,y=v,_=p;(c<a||f<a)&&(y=a),(h<o||d<o)&&(_=o),c>s?y=s-g:f>s&&(y=y-(f-s)),h>l?_=l-m:d>l&&(_=_-(d-l)),(y!==v||_!==p)&&Yv(n,y-v,_-p)})}function Xdt(r,t,e,i){I(t,function(n,a){var o=n.getCanvasBBox(),s=e[a].getBBox();(o.minX<s.minX||o.minY<s.minY||o.maxX>s.maxX||o.maxY>s.maxY)&&n.remove(!0)})}var Ydt=100,r6=function(){function r(t){t===void 0&&(t={}),this.bitmap={};var e=t.xGap,i=e===void 0?1:e,n=t.yGap,a=n===void 0?8:n;this.xGap=i,this.yGap=a}return r.prototype.hasGap=function(t){for(var e=!0,i=this.bitmap,n=Math.round(t.minX),a=Math.round(t.maxX),o=Math.round(t.minY),s=Math.round(t.maxY),l=n;l<=a;l+=1){if(!i[l]){i[l]={};continue}if(l===n||l===a){for(var u=o;u<=s;u++)if(i[l][u]){e=!1;break}}else if(i[l][o]||i[l][s]){e=!1;break}}return e},r.prototype.fillGap=function(t){for(var e=this.bitmap,i=Math.round(t.minX),n=Math.round(t.maxX),a=Math.round(t.minY),o=Math.round(t.maxY),s=i;s<=n;s+=1)e[s]||(e[s]={});for(var s=i;s<=n;s+=this.xGap){for(var l=a;l<=o;l+=this.yGap)e[s][l]=!0;e[s][o]=!0}if(this.yGap!==1)for(var s=a;s<=o;s+=1)e[i][s]=!0,e[n][s]=!0;if(this.xGap!==1)for(var s=i;s<=n;s+=1)e[s][a]=!0,e[s][o]=!0},r.prototype.destroy=function(){this.bitmap={}},r}();function jdt(r,t,e){e===void 0&&(e=Ydt);var i=-1,n=r.attr(),a=n.x,o=n.y,s=r.getCanvasBBox(),l=Math.sqrt(s.width*s.width+s.height*s.height),u,c=-i,h=0,f=0,d=function(m){var y=m*.1;return[y*Math.cos(y),y*Math.sin(y)]};if(t.hasGap(s))return t.fillGap(s),!0;for(var v=!1,p=0,g={};Math.min(Math.abs(h),Math.abs(f))<l&&p<e;)if(u=d(c+=i),h=~~u[0],f=~~u[1],!(!h&&!f||g["".concat(h,"-").concat(f)])&&(r.attr({x:a+h,y:o+f}),h+f<0&&r.attr("textAlign","right"),p++,t.hasGap(r.getCanvasBBox()))){t.fillGap(r.getCanvasBBox()),v=!0,g["".concat(h,"-").concat(f)]=!0;break}return v}function Zdt(r,t,e,i){var n=r.getCanvasBBox(),a=n.width,o=n.height,s={x:t,y:e,textAlign:"center"};switch(i){case 0:s.y-=o+1,s.x+=1,s.textAlign="left";break;case 1:s.y-=o+1,s.x-=1,s.textAlign="right";break;case 2:s.y+=o+1,s.x-=1,s.textAlign="right";break;case 3:s.y+=o+1,s.x+=1,s.textAlign="left";break;case 5:s.y-=o*2+2;break;case 6:s.y+=o*2+2;break;case 7:s.x+=a+1,s.textAlign="left";break;case 8:s.x-=a+1,s.textAlign="right";break}return r.attr(s),r.getCanvasBBox()}function qdt(r,t,e,i){var n=new r6;I(t,function(a){var o=a.find(function(s){return s.get("type")==="text"});jdt(o,n)||a.remove(!0)}),n.destroy()}function Kdt(r,t,e,i){var n=new r6;I(t,function(a){for(var o=a.find(function(d){return d.get("type")==="text"}),s=o.attr(),l=s.x,u=s.y,c=!1,h=0;h<=8;h++){var f=Zdt(o,l,u,h);if(n.hasGap(f)){n.fillGap(f),c=!0;break}}c||a.remove(!0)}),n.destroy()}function Qdt(r,t){return(r[0]||0)*(t[0]||0)+(r[1]||0)*(t[1]||0)+(r[2]||0)*(t[2]||0)}function iI(r){if(r.length>4)return[];var t=function(n,a){return[a.x-n.x,a.y-n.y]},e=t(r[0],r[1]),i=t(r[1],r[2]);return[e,i]}function ag(r,t,e){t===void 0&&(t=0),e===void 0&&(e={x:0,y:0});var i=r.x,n=r.y;return{x:(i-e.x)*Math.cos(-t)+(n-e.y)*Math.sin(-t)+e.x,y:(e.x-i)*Math.sin(-t)+(n-e.y)*Math.cos(-t)+e.y}}function nI(r){var t=[{x:r.x,y:r.y},{x:r.x+r.width,y:r.y},{x:r.x+r.width,y:r.y+r.height},{x:r.x,y:r.y+r.height}],e=r.rotation;return e?[ag(t[0],e,t[0]),ag(t[1],e,t[0]),ag(t[2],e,t[0]),ag(t[3],e,t[0])]:t}function aI(r,t){if(r.length>4)return{min:0,max:0};var e=[];return r.forEach(function(i){e.push(Qdt([i.x,i.y],t))}),{min:Math.min.apply(Math,xt([],ct(e),!1)),max:Math.max.apply(Math,xt([],ct(e),!1))}}function Jdt(r,t){return r.max>t.min&&r.min<t.max}function tvt(r){return typeof r=="number"&&!Number.isNaN(r)&&r!==1/0&&r!==-1/0}function oI(r){return["x","y","width","height"].every(function(t){return tvt(r[t])})}function evt(r,t,e){return e===void 0&&(e=0),!(t.x>r.x+r.width+e||t.x+t.width<r.x-e||t.y>r.y+r.height+e||t.y+t.height<r.y-e)}function rvt(r,t,e){if(e===void 0&&(e=0),!oI(r)||!oI(t))return!1;if(!r.rotation&&!t.rotation)return evt(r,t,e);for(var i=nI(r),n=nI(t),a=iI(i).concat(iI(n)),o=0;o<a.length;o++){var s=a[o],l=aI(i,s),u=aI(n,s);if(!Jdt(l,u))return!1}return!0}var ivt=function(){function r(t){var e=this;this.queue=[],this.worker=new Worker(t),this.worker.onmessage=function(i){var n;(n=e.queue.shift())===null||n===void 0||n.resolve(i)},this.worker.onmessageerror=function(i){var n;console.warn("[AntV G2] Web worker is not available"),(n=e.queue.shift())===null||n===void 0||n.reject(i)}}return r.prototype.post=function(t,e){var i=this;return new Promise(function(n,a){i.queue.push({resolve:n,reject:a});try{i.worker.postMessage(t)}catch{console.warn("[AntV G2] Web worker is not available"),ot(e)&&e()}})},r.prototype.destroy=function(){this.worker.terminate()},r}();function nvt(r){if(!(typeof window>"u")){var t;try{t=new Blob([r.toString()],{type:"application/javascript"})}catch{t=new window.BlobBuilder,t.append(r.toString()),t=t.getBlob()}return new ivt(URL.createObjectURL(t))}}var avt=function(r){function t(){function u(_,x){return(_[0]||0)*(x[0]||0)+(_[1]||0)*(x[1]||0)+(_[2]||0)*(x[2]||0)}function c(_){if(_.length>4)return[];var x=function(b,R){return[R.x-b.x,R.y-b.y]},C=x(_[0],_[1]),A=x(_[1],_[2]);return[C,A]}function h(_,x,C){x===void 0&&(x=0),C===void 0&&(C={x:0,y:0});var A=_.x,b=_.y;return{x:(A-C.x)*Math.cos(-x)+(b-C.y)*Math.sin(-x)+C.x,y:(C.x-A)*Math.sin(-x)+(b-C.y)*Math.cos(-x)+C.y}}function f(_){var x=[{x:_.x,y:_.y},{x:_.x+_.width,y:_.y},{x:_.x+_.width,y:_.y+_.height},{x:_.x,y:_.y+_.height}],C=_.rotation;return C?[h(x[0],C,x[0]),h(x[1],C,x[0]),h(x[2],C,x[0]),h(x[3],C,x[0])]:x}function d(_,x){if(_.length>4)return{min:0,max:0};var C=[];return _.forEach(function(A){C.push(u([A.x,A.y],x))}),{min:Math.min.apply(null,C),max:Math.max.apply(null,C)}}function v(_,x){return _.max>x.min&&_.min<x.max}function p(_){return typeof _=="number"&&!Number.isNaN(_)&&_!==1/0&&_!==-1/0}function g(_){return["x","y","width","height"].every(function(x){return p(_[x])})}function m(_,x,C){return C===void 0&&(C=0),!(x.x>_.x+_.width+C||x.x+x.width<_.x-C||x.y>_.y+_.height+C||x.y+x.height<_.y-C)}function y(_,x,C){if(C===void 0&&(C=0),!g(_)||!g(x))return!1;if(!_.rotation&&!x.rotation)return m(_,x,C);for(var A=f(_),b=f(x),R=c(A).concat(c(b)),M=0;M<R.length;M++){var O=R[M],F=d(A,O),D=d(b,O);if(!v(F,D))return!1}return!0}return{intersect:y}}var e=t().intersect;function i(u){for(var c=u.slice(),h=0;h<c.length;h++){var f=c[h];if(f.visible)for(var d=h+1;d<c.length;d++){var v=c[d];f!==v&&v.visible&&e(f,v)&&(v.visible=!1)}}return c}var n={"hide-overlap":i};try{var a=JSON.parse(r.data);if(!a||!a.type||!n[a.type])return;var o=a.type,s=a.items,l=n[o](s);self.postMessage(l)}catch(u){throw u}},ovt=`
   self.onmessage = `.concat(avt.toString(),`
`),s1=function(r){for(var t=r.slice(),e=0;e<t.length;e++){var i=t[e];if(i.visible)for(var n=e+1;n<t.length;n++){var a=t[n];i!==a&&a.visible&&rvt(i,a)&&(a.visible=!1)}}return t},l1=new Map,sI=nvt(ovt);function svt(r,t,e,i){return Ti(this,void 0,void 0,function(){var n,a,o,s,l,u;return ba(this,function(c){switch(c.label){case 0:return n=t.map(function(h,f){return S(S({},CN(h,r[f],P(r[f],"background.padding"))),{visible:!0})}),a=JSON.stringify(n),o=function(h){return l1.set(a,h),I(h,function(f,d){var v=f.visible,p=t[d];v?p==null||p.show():p==null||p.hide()}),h},l1.get(a)?(o(l1.get(a)),[3,7]):[3,1];case 1:if(!sI)return[3,6];c.label=2;case 2:return c.trys.push([2,4,,5]),s=JSON.stringify({type:"hide-overlap",items:n}),[4,sI.post(s,function(){return o(s1(n))})];case 3:return l=c.sent(),o(Array.isArray(l.data)?l.data:[]),[3,5];case 4:return u=c.sent(),console.error(u),o(s1(n)),[3,5];case 5:return[3,7];case 6:o(s1(n)),c.label=7;case 7:return[2]}})})}var lI={"#5B8FF9":!0},lvt=function(r){var t=Gs.toRGB(r).toUpperCase();if(lI[t])return lI[t];var e=ct(Gs.rgb2arr(t),3),i=e[0],n=e[1],a=e[2],o=(i*299+n*587+a*114)/1e3<128;return o};function uvt(r,t,e){if(e.length!==0){var i=e[0].get("element"),n=i.geometry.theme,a=n.labels||{},o=a.fillColorLight,s=a.fillColorDark;e.forEach(function(l,u){var c=t[u],h=c.find(function(m){return m.get("type")==="text"}),f=Ri.fromObject(l.getBBox()),d=Ri.fromObject(h.getCanvasBBox()),v=!f.contains(d),p=l.attr("fill"),g=lvt(p);v?h.attr(n.overflowLabels.style):g?o&&h.attr("fill",o):s&&h.attr("fill",s)})}}function cvt(r,t,e){var i=r.coordinate,n=Ks(t),a=Ri.fromObject(n.getCanvasBBox()),o=Ri.fromObject(e.getBBox());return i.isTransposed?o.height>=a.height:o.width>=a.width}function hvt(r,t,e){var i=!!r.getAdjust("stack");return i||t.every(function(n,a){var o=e[a];return cvt(r,n,o)})}function fvt(r,t,e){var i=r.coordinate,n=Ri.fromObject(e.getBBox()),a=Ks(t);i.isTransposed?a.attr({x:n.minX+n.width/2,textAlign:"center"}):a.attr({y:n.minY+n.height/2,textBaseline:"middle"})}function dvt(r,t,e){var i;if(e.length!==0){var n=(i=e[0])===null||i===void 0?void 0:i.get("element"),a=n==null?void 0:n.geometry;if(!(!a||a.type!=="interval")){var o=hvt(a,t,e);o&&e.forEach(function(s,l){var u=t[l];fvt(a,u,s)})}}}function vvt(r){var t=500,e=[],i=Math.max(Math.floor(r.length/t),1);return I(r,function(n,a){a%i===0?e.push(n):n.set("visible",!1)}),e}function pvt(r,t,e){var i;if(e.length!==0){var n=(i=e[0])===null||i===void 0?void 0:i.get("element"),a=n==null?void 0:n.geometry;if(!(!a||a.type!=="interval")){var o=vvt(t),s=ct(a.getXYFields(),1),l=s[0],u=[],c=[],h=Qi(o,function(g){return g.get("data")[l]}),f=as(Ne(o,function(g){return g.get("data")[l]})),d;o.forEach(function(g){g.set("visible",!0)});var v=function(g){g&&(g.length&&c.push(g.pop()),c.push.apply(c,xt([],ct(g),!1)))};for(xr(f)>0&&(d=f.shift(),v(h[d])),xr(f)>0&&(d=f.pop(),v(h[d])),I(f.reverse(),function(g){v(h[g])});c.length>0;){var p=c.shift();p.get("visible")&&(xht(p,u)?p.set("visible",!1):u.push(p))}}}}function gvt(r,t){var e=r.getXYFields()[1],i=[],n=t.sort(function(a,o){return a.get("data")[e]-a.get("data")[e]});return n.length>0&&i.push(n.shift()),n.length>0&&i.push(n.pop()),i.push.apply(i,xt([],ct(n),!1)),i}function i6(r,t,e){return r.some(function(i){return e(i,t)})}function mvt(r,t,e){e===void 0&&(e=0);var i=Math.max(0,Math.min(r.x+r.width+e,t.x+t.width+e)-Math.max(r.x-e,t.x-e)),n=Math.max(0,Math.min(r.y+r.height+e,t.y+t.height+e)-Math.max(r.y-e,t.y-e));return i*n}function uI(r,t){return i6(r,t,function(e,i){var n=Ks(e),a=Ks(i);return mvt(n.getCanvasBBox(),a.getCanvasBBox(),2)>0})}function yvt(r,t,e,i,n){var a,o;if(e.length!==0){var s=(a=e[0])===null||a===void 0?void 0:a.get("element"),l=s==null?void 0:s.geometry;if(!(!l||l.type!=="point")){var u=ct(l.getXYFields(),2),c=u[0],h=u[1],f=Qi(t,function(p){return p.get("data")[c]}),d=[],v=n&&n.offset||((o=r[0])===null||o===void 0?void 0:o.offset)||12;Ne(Du(f).reverse(),function(p){for(var g=gvt(l,f[p]);g.length;){var m=g.shift(),y=Ks(m);if(i6(d,m,function(C,A){return C.get("data")[c]===A.get("data")[c]&&C.get("data")[h]===A.get("data")[h]})){y.set("visible",!1);continue}var _=uI(d,m),x=!1;if(_&&(y.attr("y",y.attr("y")+2*v),x=uI(d,m)),x){y.set("visible",!1);continue}d.push(m)}})}}}function _vt(r,t){var e=r.getXYFields()[1],i=[],n=t.sort(function(a,o){return a.get("data")[e]-a.get("data")[e]});return n.length>0&&i.push(n.shift()),n.length>0&&i.push(n.pop()),i.push.apply(i,xt([],ct(n),!1)),i}function n6(r,t,e){return r.some(function(i){return e(i,t)})}function xvt(r,t,e){e===void 0&&(e=0);var i=Math.max(0,Math.min(r.x+r.width+e,t.x+t.width+e)-Math.max(r.x-e,t.x-e)),n=Math.max(0,Math.min(r.y+r.height+e,t.y+t.height+e)-Math.max(r.y-e,t.y-e));return i*n}function cI(r,t){return n6(r,t,function(e,i){var n=Ks(e),a=Ks(i);return xvt(n.getCanvasBBox(),a.getCanvasBBox(),2)>0})}function Cvt(r,t,e,i,n){var a,o;if(e.length!==0){var s=(a=e[0])===null||a===void 0?void 0:a.get("element"),l=s==null?void 0:s.geometry;if(!(!l||["path","line","area"].indexOf(l.type)<0)){var u=ct(l.getXYFields(),2),c=u[0],h=u[1],f=Qi(t,function(p){return p.get("data")[c]}),d=[],v=n&&n.offset||((o=r[0])===null||o===void 0?void 0:o.offset)||12;Ne(Du(f).reverse(),function(p){for(var g=_vt(l,f[p]);g.length;){var m=g.shift(),y=Ks(m);if(n6(d,m,function(C,A){return C.get("data")[c]===A.get("data")[c]&&C.get("data")[h]===A.get("data")[h]})){y.set("visible",!1);continue}var _=cI(d,m),x=!1;if(_&&(y.attr("y",y.attr("y")+2*v),x=cI(d,m)),x){y.set("visible",!1);continue}d.push(m)}})}}}var u1;function Evt(){return u1||(u1=document.createElement("canvas").getContext("2d")),u1}var og=Nu(function(r,t){t===void 0&&(t={});var e=t.fontSize,i=t.fontFamily,n=t.fontWeight,a=t.fontStyle,o=t.fontVariant,s=Evt();return s.font=[a,o,n,"".concat(e,"px"),i].join(" "),s.measureText(mt(r)?r:"").width},function(r,t){return t===void 0&&(t={}),xt([r],ct(wh(t)),!1).join("")}),Svt=function(r,t,e){var i=16,n=og("...",e),a;mt(r)?a=r:a=cl(r);var o=t,s=[],l,u;if(og(r,e)<=t)return r;for(;l=a.substr(0,i),u=og(l,e),!(u+n>o&&u>o);)if(s.push(l),o-=u,a=a.substr(i),!a)return s.join("");for(;l=a.substr(0,1),u=og(l,e),!(u+n>o);)if(s.push(l),o-=u,a=a.substr(1),!a)return s.join("");return"".concat(s.join(""),"...")};function Avt(r,t,e,i,n){if(!(t.length<=0)){var a=(n==null?void 0:n.direction)||["top","right","bottom","left"],o=(n==null?void 0:n.action)||"translate",s=(n==null?void 0:n.margin)||0,l=t[0].get("coordinate");if(l){var u=Jut(l,s),c=u.minX,h=u.minY,f=u.maxX,d=u.maxY;I(t,function(v){var p=v.getCanvasBBox(),g=p.minX,m=p.minY,y=p.maxX,_=p.maxY,x=p.x,C=p.y,A=p.width,b=p.height,R=x,M=C;if(a.indexOf("left")>=0&&(g<c||y<c)&&(R=c),a.indexOf("top")>=0&&(m<h||_<h)&&(M=h),a.indexOf("right")>=0&&(g>f?R=f-A:y>f&&(R=R-(y-f))),a.indexOf("bottom")>=0&&(m>d?M=d-b:_>d&&(M=M-(_-d))),R!==x||M!==C){var O=R-x;if(o==="translate")Yv(v,O,M-C);else if(o==="ellipsis"){var F=v.findAll(function(D){return D.get("type")==="text"});F.forEach(function(D){var H=Ma(D.attr(),["fontSize","fontFamily","fontWeight","fontStyle","fontVariant"]),j=D.getCanvasBBox(),$=Svt(D.attr("text"),j.width-Math.abs(O),H);D.attr("text",$)})}else v.hide()}})}}}function Tvt(r,t,e){var i={fillOpacity:K(r.attr("fillOpacity"))?1:r.attr("fillOpacity"),strokeOpacity:K(r.attr("strokeOpacity"))?1:r.attr("strokeOpacity"),opacity:K(r.attr("opacity"))?1:r.attr("opacity")};r.attr({fillOpacity:0,strokeOpacity:0,opacity:0}),r.animate(i,t)}function bvt(r,t,e){var i={fillOpacity:0,strokeOpacity:0,opacity:0},n=t.easing,a=t.duration,o=t.delay;r.animate(i,a,n,function(){r.remove(!0)},o)}function wvt(r,t,e){var i,n=ct(t,2),a=n[0],o=n[1];return r.applyToMatrix([a,o,1]),e==="x"?(r.setMatrix(dr(r.getMatrix(),[["t",-a,-o],["s",.01,1],["t",a,o]])),i=dr(r.getMatrix(),[["t",-a,-o],["s",100,1],["t",a,o]])):e==="y"?(r.setMatrix(dr(r.getMatrix(),[["t",-a,-o],["s",1,.01],["t",a,o]])),i=dr(r.getMatrix(),[["t",-a,-o],["s",1,100],["t",a,o]])):e==="xy"&&(r.setMatrix(dr(r.getMatrix(),[["t",-a,-o],["s",.01,.01],["t",a,o]])),i=dr(r.getMatrix(),[["t",-a,-o],["s",100,100],["t",a,o]])),i}function SA(r,t,e,i,n){var a=e.start,o=e.end,s=e.getWidth(),l=e.getHeight(),u,c;n==="y"?(u=a.x+s/2,c=i.y<a.y?i.y:a.y):n==="x"?(u=i.x>a.x?i.x:a.x,c=a.y+l/2):n==="xy"&&(e.isPolar?(u=e.getCenter().x,c=e.getCenter().y):(u=(a.x+o.x)/2,c=(a.y+o.y)/2));var h=wvt(r,[u,c],n);r.animate({matrix:h},t)}function Rvt(r,t,e){var i=e.coordinate,n=e.minYPoint;SA(r,t,i,n,"x")}function Mvt(r,t,e){var i=e.coordinate,n=e.minYPoint;SA(r,t,i,n,"y")}function Ivt(r,t,e){var i=e.coordinate,n=e.minYPoint;SA(r,t,i,n,"xy")}function Lvt(r,t,e){var i=r.getTotalLength();r.attr("lineDash",[i]),r.animate(function(n){return{lineDashOffset:(1-n)*i}},t)}function Ovt(r,t,e){var i=e.toAttrs,n=i.x,a=i.y;delete i.x,delete i.y,r.attr(i),r.animate({x:n,y:a},t)}function Pvt(r,t,e){var i=r.getBBox(),n=r.get("origin").mappingData,a=n.points,o=a[0].y-a[1].y>0?i.maxX:i.minX,s=(i.minY+i.maxY)/2;r.applyToMatrix([o,s,1]);var l=dr(r.getMatrix(),[["t",-o,-s],["s",.01,1],["t",o,s]]);r.setMatrix(l),r.animate({matrix:dr(r.getMatrix(),[["t",-o,-s],["s",100,1],["t",o,s]])},t)}function Fvt(r,t,e){var i=r.getBBox(),n=r.get("origin").mappingData,a=(i.minX+i.maxX)/2,o=n.points,s=o[0].y-o[1].y<=0?i.maxY:i.minY;r.applyToMatrix([a,s,1]);var l=dr(r.getMatrix(),[["t",-a,-s],["s",1,.01],["t",a,s]]);r.setMatrix(l),r.animate({matrix:dr(r.getMatrix(),[["t",-a,-s],["s",1,100],["t",a,s]])},t)}function hI(r,t){var e,i=q0(r,t),n=i.startAngle,a=i.endAngle;return!wr(n,-Math.PI*.5)&&n<-Math.PI*.5&&(n+=Math.PI*2),!wr(a,-Math.PI*.5)&&a<-Math.PI*.5&&(a+=Math.PI*2),t[5]===0&&(e=ct([a,n],2),n=e[0],a=e[1]),wr(n,Math.PI*1.5)&&(n=Math.PI*-.5),wr(a,Math.PI*-.5)&&!wr(n,a)&&(a=Math.PI*1.5),{startAngle:n,endAngle:a}}function fI(r){var t;return r[0]==="M"||r[0]==="L"?t=[r[1],r[2]]:(r[0]==="a"||r[0]==="A"||r[0]==="C")&&(t=[r[r.length-2],r[r.length-1]]),t}function dI(r){var t,e,i,n=r.filter(function(_){return _[0]==="A"||_[0]==="a"});if(n.length===0)return{startAngle:0,endAngle:0,radius:0,innerRadius:0};var a=n[0],o=n.length>1?n[1]:n[0],s=r.indexOf(a),l=r.indexOf(o),u=fI(r[s-1]),c=fI(r[l-1]),h=hI(u,a),f=h.startAngle,d=h.endAngle,v=hI(c,o),p=v.startAngle,g=v.endAngle;wr(f,p)&&wr(d,g)?(e=f,i=d):(e=Math.min(f,p),i=Math.max(d,g));var m=a[1],y=n[n.length-1][1];return m<y?(t=ct([y,m],2),m=t[0],y=t[1]):m===y&&(y=0),{startAngle:e,endAngle:i,radius:m,innerRadius:y}}function Bvt(r,t,e){var i=e.toAttrs,n=e.coordinate,a=i.path||[],o=a.map(function(y){return y[0]});if(!(a.length<1)){var s=dI(a),l=s.startAngle,u=s.endAngle,c=s.radius,h=s.innerRadius,f=dI(r.attr("path")),d=f.startAngle,v=f.endAngle,p=n.getCenter(),g=l-d,m=u-v;if(g===0&&m===0){r.attr(i);return}r.animate(function(y){var _=d+y*g,x=v+y*m;return S(S({},i),{path:qt(o,["M","A","A","Z"])?U4(p.x,p.y,c,_,x):Xs(p.x,p.y,c,_,x,h)})},S(S({},t),{callback:function(){r.attr("path",a),ot(t.callback)&&t.callback()}}))}}function Dvt(r,t,e){var i=tA(e.coordinate,20),n=i.type,a=i.startState,o=i.endState,s=r.setClip({type:n,attrs:a});e.toAttrs&&r.attr(e.toAttrs),s.animate(o,S(S({},t),{callback:function(){r&&!r.get("destroyed")&&r.set("clipShape",null),s.remove(!0),ot(t.callback)&&t.callback()}}))}function AA(r,t,e){if(r.isGroup())I(r.getChildren(),function(s){AA(s,t,e)});else{var i=r.getBBox(),n=(i.minX+i.maxX)/2,a=(i.minY+i.maxY)/2;if(r.applyToMatrix([n,a,1]),e==="zoomIn"){var o=dr(r.getMatrix(),[["t",-n,-a],["s",.01,.01],["t",n,a]]);r.setMatrix(o),r.animate({matrix:dr(r.getMatrix(),[["t",-n,-a],["s",100,100],["t",n,a]])},t)}else r.animate({matrix:dr(r.getMatrix(),[["t",-n,-a],["s",.01,.01],["t",n,a]])},S(S({},t),{callback:function(){r.remove(!0),ot(t.callback)&&t.callback()}}))}}function Nvt(r,t,e){AA(r,t,"zoomIn")}function kvt(r,t,e){AA(r,t,"zoomOut")}function us(r){return[nt.TOP,nt.BOTTOM].includes(r)?{offsetX:0,offsetY:r===nt.TOP?-8:8,style:{textAlign:"center",textBaseline:r===nt.TOP?"bottom":"top"}}:[nt.LEFT,nt.RIGHT].includes(r)?{offsetX:r===nt.LEFT?-8:8,offsetY:0,style:{textAlign:r===nt.LEFT?"right":"left",textBaseline:"middle",rotate:Math.PI/2}}:{}}function c1(r,t,e){return{x:r.x+t*Math.cos(e),y:r.y+t*Math.sin(e)}}var Uvt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){return at({},r.prototype.getDefaultCfg.call(this),{type:"circle",showTitle:!0,title:r.prototype.getDefaultTitleCfg.call(this)})},t.prototype.render=function(){r.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},t.prototype.getRegion=function(e,i){var n=.5,a={x:.5,y:.5},o=Math.PI*2/e,s=-1*Math.PI/2+o*i,l=n/(1+1/Math.sin(o/2)),u=c1(a,n-l,s),c=Math.PI*5/4,h=Math.PI*1/4;return{start:c1(u,l,c),end:c1(u,l,h)}},t.prototype.afterEachView=function(e,i){this.processAxis(e,i)},t.prototype.beforeEachView=function(e,i){},t.prototype.generateFacets=function(e){var i=this,n=this.cfg,a=n.fields,o=n.type,s=ct(a,1),l=s[0];if(!l)throw new Error("No `fields` specified!");var u=this.getFieldValues(e,l),c=u.length,h=[];return u.forEach(function(f,d){var v=[{field:l,value:f,values:u}],p=Fr(e,i.getFacetDataFilter(v)),g={type:o,data:p,region:i.getRegion(c,d),columnValue:f,columnField:l,columnIndex:d,columnValuesLength:c,rowValue:null,rowField:null,rowIndex:0,rowValuesLength:1};h.push(g)}),h},t.prototype.getXAxisOption=function(e,i,n,a){return n},t.prototype.getYAxisOption=function(e,i,n,a){return n},t.prototype.renderTitle=function(){var e=this;I(this.facets,function(i){var n=i.columnValue,a=i.view,o=P(e.cfg.title,"formatter"),s=at({position:["50%","0%"],content:o?o(n):n},us(nt.TOP),e.cfg.title);a.annotation().text(s)})},t}(Oh),zvt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){return at({},r.prototype.getDefaultCfg.call(this),{type:"list",cols:null,showTitle:!0,title:r.prototype.getDefaultTitleCfg.call(this)})},t.prototype.render=function(){r.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},t.prototype.afterEachView=function(e,i){this.processAxis(e,i)},t.prototype.beforeEachView=function(e,i){},t.prototype.generateFacets=function(e){var i=this,n=this.cfg.fields,a=this.cfg.cols,o=ct(n,1),s=o[0];if(!s)throw new Error("No `fields` specified!");var l=this.getFieldValues(e,s),u=l.length;a=a||u;var c=this.getPageCount(u,a),h=[];return l.forEach(function(f,d){var v=i.getRowCol(d,a),p=v.row,g=v.col,m=[{field:s,value:f,values:l}],y=Fr(e,i.getFacetDataFilter(m)),_={type:i.cfg.type,data:y,region:i.getRegion(c,a,g,p),columnValue:f,rowValue:f,columnField:s,rowField:null,columnIndex:g,rowIndex:p,columnValuesLength:a,rowValuesLength:c,total:u};h.push(_)}),h},t.prototype.getXAxisOption=function(e,i,n,a){return a.rowIndex!==a.rowValuesLength-1&&a.columnValuesLength*a.rowIndex+a.columnIndex+1+a.columnValuesLength<=a.total?S(S({},n),{label:null,title:null}):n},t.prototype.getYAxisOption=function(e,i,n,a){return a.columnIndex!==0?S(S({},n),{title:null,label:null}):n},t.prototype.renderTitle=function(){var e=this;I(this.facets,function(i){var n=i.columnValue,a=i.view,o=P(e.cfg.title,"formatter"),s=at({position:["50%","0%"],content:o?o(n):n},us(nt.TOP),e.cfg.title);a.annotation().text(s)})},t.prototype.getPageCount=function(e,i){return Math.floor((e+i-1)/i)},t.prototype.getRowCol=function(e,i){var n=Math.floor(e/i),a=e%i;return{row:n,col:a}},t}(Oh),Hvt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){return at({},r.prototype.getDefaultCfg.call(this),{type:"matrix",showTitle:!1,columnTitle:S({},r.prototype.getDefaultTitleCfg.call(this)),rowTitle:S({},r.prototype.getDefaultTitleCfg.call(this))})},t.prototype.render=function(){r.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},t.prototype.afterEachView=function(e,i){this.processAxis(e,i)},t.prototype.beforeEachView=function(e,i){},t.prototype.generateFacets=function(e){for(var i=this.cfg,n=i.fields,a=i.type,o=n.length,s=o,l=[],u=0;u<s;u++)for(var c=n[u],h=0;h<o;h++){var f=n[h],d={type:a,data:e,region:this.getRegion(o,s,u,h),columnValue:c,rowValue:f,columnField:c,rowField:f,columnIndex:u,rowIndex:h,columnValuesLength:s,rowValuesLength:o};l.push(d)}return l},t.prototype.getXAxisOption=function(e,i,n,a){return a.rowIndex!==a.rowValuesLength-1?S(S({},n),{label:null,title:null}):n},t.prototype.getYAxisOption=function(e,i,n,a){return a.columnIndex!==0?S(S({},n),{title:null,label:null}):n},t.prototype.renderTitle=function(){var e=this;I(this.facets,function(i,n){var a=i.columnIndex,o=i.rowIndex,s=i.columnValuesLength;i.rowValuesLength;var l=i.columnValue,u=i.rowValue,c=i.view;if(o===0){var h=P(e.cfg.columnTitle,"formatter"),f=at({position:["50%","0%"],content:h?h(l):l},us(nt.TOP),e.cfg.columnTitle);c.annotation().text(f)}if(a===s-1){var h=P(e.cfg.rowTitle,"formatter"),f=at({position:["100%","50%"],content:h?h(u):u},us(nt.RIGHT),e.cfg.rowTitle);c.annotation().text(f)}})},t}(Oh),$vt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){return at({},r.prototype.getDefaultCfg.call(this),{type:"mirror",showTitle:!0,title:r.prototype.getDefaultTitleCfg.call(this),transpose:!1})},t.prototype.render=function(){r.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},t.prototype.beforeEachView=function(e,i){this.cfg.transpose?i.columnIndex%2===0?e.coordinate().transpose().reflect("x"):e.coordinate().transpose():i.rowIndex%2!==0&&e.coordinate().reflect("y")},t.prototype.afterEachView=function(e,i){this.processAxis(e,i)},t.prototype.generateFacets=function(e){var i=this,n=ct(this.cfg.fields,1),a=n[0],o=[],s=1,l=1,u=[""],c=[""],h,f;return this.cfg.transpose?(h=a,u=this.getFieldValues(e,h).slice(0,2),s=u.length):(f=a,c=this.getFieldValues(e,f).slice(0,2),l=c.length),u.forEach(function(d,v){c.forEach(function(p,g){var m=[{field:h,value:d,values:u},{field:f,value:p,values:c}],y=Fr(e,i.getFacetDataFilter(m)),_={type:i.cfg.type,data:y,region:i.getRegion(l,s,v,g),columnValue:d,rowValue:p,columnField:h,rowField:f,columnIndex:v,rowIndex:g,columnValuesLength:s,rowValuesLength:l};o.push(_)})}),o},t.prototype.getXAxisOption=function(e,i,n,a){return a.columnIndex===1||a.rowIndex===1?S(S({},n),{label:null,title:null}):n},t.prototype.getYAxisOption=function(e,i,n,a){return n},t.prototype.renderTitle=function(){var e=this;I(this.facets,function(i,n){var a=i.columnValue,o=i.rowValue,s=i.view,l=P(e.cfg.title,"formatter");if(e.cfg.transpose){var u=at({position:["50%","0%"],content:l?l(a):a},us(nt.TOP),e.cfg.title);s.annotation().text(u)}else{var u=at({position:["100%","50%"],content:l?l(o):o},us(nt.RIGHT),e.cfg.title);s.annotation().text(u)}})},t}(Oh),Wvt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.afterEachView=function(e,i){this.processAxis(e,i)},t.prototype.beforeEachView=function(e,i){},t.prototype.getDefaultCfg=function(){return at({},r.prototype.getDefaultCfg.call(this),{type:"rect",columnTitle:S({},r.prototype.getDefaultTitleCfg.call(this)),rowTitle:S({},r.prototype.getDefaultTitleCfg.call(this))})},t.prototype.render=function(){r.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},t.prototype.generateFacets=function(e){var i=this,n=ct(this.cfg.fields,2),a=n[0],o=n[1],s=[],l=1,u=1,c=[""],h=[""];return a&&(c=this.getFieldValues(e,a),l=c.length),o&&(h=this.getFieldValues(e,o),u=h.length),c.forEach(function(f,d){h.forEach(function(v,p){var g=[{field:a,value:f,values:c},{field:o,value:v,values:h}],m=Fr(e,i.getFacetDataFilter(g)),y={type:i.cfg.type,data:m,region:i.getRegion(u,l,d,p),columnValue:f,rowValue:v,columnField:a,rowField:o,columnIndex:d,rowIndex:p,columnValuesLength:l,rowValuesLength:u};s.push(y)})}),s},t.prototype.renderTitle=function(){var e=this;I(this.facets,function(i,n){var a=i.columnIndex,o=i.rowIndex,s=i.columnValuesLength,l=i.columnValue,u=i.rowValue,c=i.view;if(o===0){var h=P(e.cfg.columnTitle,"formatter"),f=at({position:["50%","0%"],content:h?h(l):l},us(nt.TOP),e.cfg.columnTitle);c.annotation().text(f)}if(a===s-1){var h=P(e.cfg.rowTitle,"formatter"),f=at({position:["100%","50%"],content:h?h(u):u},us(nt.RIGHT),e.cfg.rowTitle);c.annotation().text(f)}})},t.prototype.getXAxisOption=function(e,i,n,a){return a.rowIndex!==a.rowValuesLength-1?S(S({},n),{title:null,label:null}):a.columnIndex!==Math.floor((a.columnValuesLength-1)/2)?S(S({},n),{title:null}):n},t.prototype.getYAxisOption=function(e,i,n,a){return a.columnIndex!==0?S(S({},n),{title:null,label:null}):a.rowIndex!==Math.floor((a.rowValuesLength-1)/2)?S(S({},n),{title:null}):n},t}(Oh),Vvt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.afterChartRender=function(){e.facets&&e.cfg.line&&(e.container.clear(),e.drawLines(e.facets))},e}return t.prototype.afterEachView=function(e,i){this.processAxis(e,i)},t.prototype.beforeEachView=function(e,i){},t.prototype.init=function(){r.prototype.init.call(this),this.view.on(Ut.AFTER_RENDER,this.afterChartRender)},t.prototype.getDefaultCfg=function(){return at({},r.prototype.getDefaultCfg.call(this),{type:"tree",line:{style:{lineWidth:1,stroke:"#ddd"},smooth:!1},showTitle:!0,title:r.prototype.getDefaultTitleCfg.call(this)})},t.prototype.generateFacets=function(e){var i=this.cfg.fields;if(!i.length)throw new Error("Please specify for the fields for rootFacet!");var n=[],a={type:this.cfg.type,data:e,region:null,rowValuesLength:this.getRows(),columnValuesLength:1,rowIndex:0,columnIndex:0,rowField:"",columnField:"",rowValue:"",columnValue:""};return n.push(a),a.children=this.getChildFacets(e,1,n),this.setRegion(n),n},t.prototype.setRegion=function(e){var i=this;this.forceColIndex(e),e.forEach(function(n){n.region=i.getRegion(n.rowValuesLength,n.columnValuesLength,n.columnIndex,n.rowIndex)})},t.prototype.getRegion=function(e,i,n,a){var o=1/i,s=1/e,l={x:o*n,y:s*a},u={x:l.x+o,y:l.y+s*2/3};return{start:l,end:u}},t.prototype.forceColIndex=function(e){var i,n,a=this,o=[],s=0;e.forEach(function(v){a.isLeaf(v)&&(o.push(v),v.columnIndex=s,s++)}),o.forEach(function(v){v.columnValuesLength=o.length});for(var l=this.cfg.fields.length,u=l-1;u>=0;u--){var c=this.getFacetsByLevel(e,u);try{for(var h=(i=void 0,Qt(c)),f=h.next();!f.done;f=h.next()){var d=f.value;this.isLeaf(d)||(d.originColIndex=d.columnIndex,d.columnIndex=this.getRegionIndex(d.children),d.columnValuesLength=o.length)}}catch(v){i={error:v}}finally{try{f&&!f.done&&(n=h.return)&&n.call(h)}finally{if(i)throw i.error}}}},t.prototype.getFacetsByLevel=function(e,i){var n=[];return e.forEach(function(a){a.rowIndex===i&&n.push(a)}),n},t.prototype.getRegionIndex=function(e){var i=e[0],n=e[e.length-1];return(n.columnIndex-i.columnIndex)/2+i.columnIndex},t.prototype.isLeaf=function(e){return!e.children||!e.children.length},t.prototype.getRows=function(){return this.cfg.fields.length+1},t.prototype.getChildFacets=function(e,i,n){var a=this,o=this.cfg.fields,s=o.length;if(!(s<i)){var l=[],u=o[i-1],c=this.getFieldValues(e,u);return c.forEach(function(h,f){var d=[{field:u,value:h,values:c}],v=e.filter(a.getFacetDataFilter(d));if(v.length){var p={type:a.cfg.type,data:v,region:null,columnValue:h,rowValue:"",columnField:u,rowField:"",columnIndex:f,rowValuesLength:a.getRows(),columnValuesLength:1,rowIndex:i,children:a.getChildFacets(v,i+1,n)};l.push(p),n.push(p)}}),l}},t.prototype.render=function(){r.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},t.prototype.renderTitle=function(){var e=this;I(this.facets,function(i){var n=i.columnValue,a=i.view,o=P(e.cfg.title,"formatter"),s=at({position:["50%","0%"],content:o?o(n):n},us(nt.TOP),e.cfg.title);a.annotation().text(s)})},t.prototype.drawLines=function(e){var i=this;e.forEach(function(n){if(!i.isLeaf(n)){var a=n.children;i.addFacetLines(n,a)}})},t.prototype.addFacetLines=function(e,i){var n=this,a=e.view,o=a.coordinateBBox,s={x:o.x+o.width/2,y:o.y+o.height};i.forEach(function(l){var u=l.view.coordinateBBox,c={x:u.bl.x+(u.tr.x-u.bl.x)/2,y:u.tr.y},h={x:s.x,y:s.y+(c.y-s.y)/2},f={x:c.x,y:h.y};n.drawLine([s,h,f,c])})},t.prototype.getPath=function(e){var i=[],n=this.cfg.line.smooth;return n?(i.push(["M",e[0].x,e[0].y]),i.push(["C",e[1].x,e[1].y,e[2].x,e[2].y,e[3].x,e[3].y])):e.forEach(function(a,o){o===0?i.push(["M",a.x,a.y]):i.push(["L",a.x,a.y])}),i},t.prototype.drawLine=function(e){var i=this.getPath(e),n=this.cfg.line.style;this.container.addShape("path",{attrs:ne({path:i},n)})},t.prototype.getXAxisOption=function(e,i,n,a){return a.rowIndex!==a.rowValuesLength-1?S(S({},n),{title:null,label:null}):n},t.prototype.getYAxisOption=function(e,i,n,a){return a.originColIndex!==0&&a.columnIndex!==0?S(S({},n),{title:null,label:null}):n},t}(Oh);function vI(r){var t=xt([],ct(r),!1);t.sort(function(i,n){return i-n});var e=t.length;return e===0?0:e%2===1?t[(e-1)/2]:(t[e/2]+t[e/2-1])/2}function Gvt(r){var t=Qr(r,function(e,i){return e+=isNaN(i)||!Tt(i)?0:i},0);return r.length===0?0:t/r.length}function sg(r,t){if(!t)return null;var e;switch(r){case"start":return 0;case"center":return .5;case"end":return 1;case"median":{e=t.isCategory?vI(t.values.map(function(i,n){return n})):vI(t.values);break}case"mean":{e=t.isCategory?(t.values.length-1)/2:Gvt(t.values);break}case"min":e=t.isCategory?0:t[r];break;case"max":e=t.isCategory?t.values.length-1:t[r];break;default:e=r;break}return t.scale(e)}var lg=["regionFilter","shape"],Xvt=function(r){N(t,r);function t(e){var i=r.call(this,e)||this;return i.cache=new Map,i.foregroundContainer=i.view.getLayer(ir.FORE).addGroup(),i.backgroundContainer=i.view.getLayer(ir.BG).addGroup(),i.option=[],i}return Object.defineProperty(t.prototype,"name",{get:function(){return"annotation"},enumerable:!1,configurable:!0}),t.prototype.init=function(){},t.prototype.layout=function(){this.update()},t.prototype.render=function(){},t.prototype.update=function(){var e=this;this.onAfterRender(function(){var n=new Map;I(e.option,function(a){if(io(lg,a.type)){var o=e.updateOrCreate(a);o&&n.set(e.getCacheKey(a),o)}}),e.cache=e.syncCache(n)});var i=new Map;I(this.option,function(n){if(!io(lg,n.type)){var a=e.updateOrCreate(n);a&&i.set(e.getCacheKey(n),a)}}),this.cache=this.syncCache(i)},t.prototype.clear=function(e){e===void 0&&(e=!1),r.prototype.clear.call(this),this.clearComponents(),this.foregroundContainer.clear(),this.backgroundContainer.clear(),e&&(this.option=[])},t.prototype.destroy=function(){this.clear(!0),this.foregroundContainer.remove(!0),this.backgroundContainer.remove(!0)},t.prototype.getComponents=function(){var e=[];return this.cache.forEach(function(i){e.push(i)}),e},t.prototype.clearComponents=function(){this.getComponents().forEach(function(e){e.component.destroy()}),this.cache.clear()},t.prototype.onAfterRender=function(e){var i=!1;this.view.getOptions().animate&&this.view.geometries.forEach(function(n){n.animateOption&&(n.once(Vs.AFTER_DRAW_ANIMATE,function(){e()}),i=!0)}),i||this.view.getRootView().once(Ut.AFTER_RENDER,function(){e()})},t.prototype.createAnnotation=function(e){var i=e.type,n=m4[fl(i)];if(n){var a=this.getAnnotationTheme(i),o=this.getAnnotationCfg(i,e,a);if(!o)return null;var s=new n(o);return{component:s,layer:this.isTop(o)?ir.FORE:ir.BG,direction:nt.NONE,type:Ar.ANNOTATION,extra:e}}},t.prototype.annotation=function(e){this.option.push(e)},t.prototype.arc=function(e){return this.annotation(S({type:"arc"},e)),this},t.prototype.image=function(e){return this.annotation(S({type:"image"},e)),this},t.prototype.line=function(e){return this.annotation(S({type:"line"},e)),this},t.prototype.region=function(e){return this.annotation(S({type:"region"},e)),this},t.prototype.text=function(e){return this.annotation(S({type:"text"},e)),this},t.prototype.dataMarker=function(e){return this.annotation(S({type:"dataMarker"},e)),this},t.prototype.dataRegion=function(e){this.annotation(S({type:"dataRegion"},e))},t.prototype.regionFilter=function(e){this.annotation(S({type:"regionFilter"},e))},t.prototype.shape=function(e){this.annotation(S({type:"shape"},e))},t.prototype.html=function(e){this.annotation(S({type:"html"},e))},t.prototype.parsePosition=function(e){var i,n,a=this.view.getXScale(),o=this.view.getScalesByDim("y"),s=ot(e)?e.call(null,a,o):e,l=0,u=0;if(q(s)){var c=ct(s,2),h=c[0],f=c[1];if(mt(h)&&h.indexOf("%")!==-1&&!isNaN(h.slice(0,-1)))return this.parsePercentPosition(s);l=sg(h,a),u=sg(f,Object.values(o)[0])}else if(!K(s))try{for(var d=Qt(Du(s)),v=d.next();!v.done;v=d.next()){var p=v.value,g=s[p];p===a.field&&(l=sg(g,a)),o[p]&&(u=sg(g,o[p]))}}catch(m){i={error:m}}finally{try{v&&!v.done&&(n=d.return)&&n.call(d)}finally{if(i)throw i.error}}return isNaN(l)||isNaN(u)?null:this.view.getCoordinate().convert({x:l,y:u})},t.prototype.getRegionPoints=function(e,i){var n=this,a=this.view.getXScale(),o=this.view.getScalesByDim("y"),s=Object.values(o)[0],l=a.field,u=this.view.getData(),c=q(e)?e[0]:e[l],h=q(i)?i[0]:i[l],f=[],d;return I(u,function(v,p){if(v[l]===c&&(d=p),p>=d){var g=n.parsePosition([v[l],v[s.field]]);g&&f.push(g)}if(v[l]===h)return!1}),f},t.prototype.parsePercentPosition=function(e){var i=parseFloat(e[0])/100,n=parseFloat(e[1])/100,a=this.view.getCoordinate(),o=a.start,s=a.end,l={x:Math.min(o.x,s.x),y:Math.min(o.y,s.y)},u=a.getWidth()*i+l.x,c=a.getHeight()*n+l.y;return{x:u,y:c}},t.prototype.getCoordinateBBox=function(){var e=this.view.getCoordinate(),i=e.start,n=e.end,a=e.getWidth(),o=e.getHeight(),s={x:Math.min(i.x,n.x),y:Math.min(i.y,n.y)};return{x:s.x,y:s.y,minX:s.x,minY:s.y,maxX:s.x+a,maxY:s.y+o,width:a,height:o}},t.prototype.getAnnotationCfg=function(e,i,n){var a=this,o=this.view.getCoordinate(),s=this.view.getCanvas(),l={};if(K(i))return null;var u=i.start,c=i.end,h=i.position,f=this.parsePosition(u),d=this.parsePosition(c),v=this.parsePosition(h);if(["arc","image","line","region","regionFilter"].includes(e)&&(!f||!d))return null;if(["text","dataMarker","html"].includes(e)&&!v)return null;if(e==="arc"){var p=i;p.start,p.end;var g=zt(p,["start","end"]),m=ah(o,f),y=ah(o,d);m>y&&(y=Math.PI*2+y),l=S(S({},g),{center:o.getCenter(),radius:ly(o,f),startAngle:m,endAngle:y})}else if(e==="image"){var _=i;_.start,_.end;var g=zt(_,["start","end"]);l=S(S({},g),{start:f,end:d,src:i.src})}else if(e==="line"){var x=i;x.start,x.end;var g=zt(x,["start","end"]);l=S(S({},g),{start:f,end:d,text:P(i,"text",null)})}else if(e==="region"){var C=i;C.start,C.end;var g=zt(C,["start","end"]);l=S(S({},g),{start:f,end:d})}else if(e==="text"){var A=this.view.getData(),b=i;b.position;var R=b.content,g=zt(b,["position","content"]),M=R;ot(R)&&(M=R(A)),l=S(S(S({},v),g),{content:M})}else if(e==="dataMarker"){var O=i;O.position;var F=O.point,D=O.line,H=O.text,j=O.autoAdjust,$=O.direction,g=zt(O,["position","point","line","text","autoAdjust","direction"]);l=S(S(S({},g),v),{coordinateBBox:this.getCoordinateBBox(),point:F,line:D,text:H,autoAdjust:j,direction:$})}else if(e==="dataRegion"){var k=i,V=k.start,Q=k.end,Y=k.region,H=k.text,tt=k.lineLength,g=zt(k,["start","end","region","text","lineLength"]);l=S(S({},g),{points:this.getRegionPoints(V,Q),region:Y,text:H,lineLength:tt})}else if(e==="regionFilter"){var et=i;et.start,et.end;var dt=et.apply,Et=et.color,g=zt(et,["start","end","apply","color"]),ht=this.view.geometries,vt=[],It=function(Xa){Xa&&(Xa.isGroup()?Xa.getChildren().forEach(function(Kh){return It(Kh)}):vt.push(Xa))};I(ht,function(Xa){dt?io(dt,Xa.type)&&I(Xa.elements,function(Kh){It(Kh.shape)}):I(Xa.elements,function(Kh){It(Kh.shape)})}),l=S(S({},g),{color:Et,shapes:vt,start:f,end:d})}else if(e==="shape"){var ce=i,_e=ce.render,Ve=zt(ce,["render"]),Fi=function(l$){if(ot(i.render))return _e(l$,a.view,{parsePosition:a.parsePosition.bind(a)})};l=S(S({},Ve),{render:Fi})}else if(e==="html"){var dn=i,da=dn.html;dn.position;var Ve=zt(dn,["html","position"]),Sl=function(Xa){return ot(da)?da(Xa,a.view):da};l=S(S(S({},Ve),v),{parent:s.get("el").parentNode,html:Sl})}var xs=at({},n,S(S({},l),{top:i.top,style:i.style,offsetX:i.offsetX,offsetY:i.offsetY}));return e!=="html"&&(xs.container=this.getComponentContainer(xs)),xs.animate=this.view.getOptions().animate&&xs.animate&&P(i,"animate",xs.animate),xs.animateOption=at({},sh,xs.animateOption,i.animateOption),xs},t.prototype.isTop=function(e){return P(e,"top",!0)},t.prototype.getComponentContainer=function(e){return this.isTop(e)?this.foregroundContainer:this.backgroundContainer},t.prototype.getAnnotationTheme=function(e){return P(this.view.getTheme(),["components","annotation",e],{})},t.prototype.updateOrCreate=function(e){var i=this.cache.get(this.getCacheKey(e));if(i){var n=e.type,a=this.getAnnotationTheme(n),o=this.getAnnotationCfg(n,e,a);o&&$i(o,["container"]),i.component.update(S(S({},o||{}),{visible:!!o})),io(lg,e.type)&&i.component.render()}else i=this.createAnnotation(e),i&&(i.component.init(),io(lg,e.type)&&i.component.render());return i},t.prototype.syncCache=function(e){var i=this,n=new Map(this.cache);return e.forEach(function(a,o){n.set(o,a)}),n.forEach(function(a,o){Qn(i.option,function(s){return o===i.getCacheKey(s)})||(a.component.destroy(),n.delete(o))}),n},t.prototype.getCacheKey=function(e){return e},t}(Fh);function pI(r,t){var e=at({},P(r,["components","axis","common"]),P(r,["components","axis",t]));return P(e,["grid"],{})}function ug(r,t,e,i){var n=[],a=t.getTicks();return r.isPolar&&a.push({value:1,text:"",tickValue:""}),a.reduce(function(o,s,l){var u=s.value;if(i)n.push({points:[r.convert(e==="y"?{x:0,y:u}:{x:u,y:0}),r.convert(e==="y"?{x:1,y:u}:{x:u,y:1})]});else if(l){var c=o.value,h=(c+u)/2;n.push({points:[r.convert(e==="y"?{x:0,y:h}:{x:h,y:0}),r.convert(e==="y"?{x:1,y:h}:{x:h,y:1})]})}return s},a[0]),n}function h1(r,t,e,i,n){var a=t.values.length,o=[],s=e.getTicks();return s.reduce(function(l,u){var c=l?l.value:u.value,h=u.value,f=(c+h)/2;return n==="x"?o.push({points:[r.convert({x:i?h:f,y:0}),r.convert({x:i?h:f,y:1})]}):o.push({points:Ne(Array(a+1),function(d,v){return r.convert({x:v/a,y:i?h:f})})}),u},s[0]),o}function gI(r,t){var e=P(t,"grid");if(e===null)return!1;var i=P(r,"grid");return!(e===void 0&&i===null)}var bs=["container"],mI=S(S({},sh),{appear:null}),Yvt=function(r){N(t,r);function t(e){var i=r.call(this,e)||this;return i.cache=new Map,i.gridContainer=i.view.getLayer(ir.BG).addGroup(),i.gridForeContainer=i.view.getLayer(ir.FORE).addGroup(),i.axisContainer=i.view.getLayer(ir.BG).addGroup(),i.axisForeContainer=i.view.getLayer(ir.FORE).addGroup(),i}return Object.defineProperty(t.prototype,"name",{get:function(){return"axis"},enumerable:!1,configurable:!0}),t.prototype.init=function(){},t.prototype.render=function(){this.update()},t.prototype.layout=function(){var e=this,i=this.view.getCoordinate();I(this.getComponents(),function(n){var a=n.component,o=n.direction,s=n.type,l=n.extra,u=l.dim,c=l.scale,h=l.alignTick,f;if(s===Ar.AXIS)i.isPolar?u==="x"?f=i.isTransposed?Zp(i,o):r1(i):u==="y"&&(f=i.isTransposed?r1(i):Zp(i,o)):f=Zp(i,o);else if(s===Ar.GRID)if(i.isPolar){var d=void 0;i.isTransposed?d=u==="x"?h1(i,e.view.getYScales()[0],c,h,u):ug(i,c,u,h):d=u==="x"?ug(i,c,u,h):h1(i,e.view.getXScale(),c,h,u),f={items:d,center:e.view.getCoordinate().getCenter()}}else f={items:ug(i,c,u,h)};a.update(f)})},t.prototype.update=function(){this.option=this.view.getOptions().axes;var e=new Map;this.updateXAxes(e),this.updateYAxes(e);var i=new Map;this.cache.forEach(function(n,a){e.has(a)?i.set(a,n):n.component.destroy()}),this.cache=i},t.prototype.clear=function(){r.prototype.clear.call(this),this.cache.clear(),this.gridContainer.clear(),this.gridForeContainer.clear(),this.axisContainer.clear(),this.axisForeContainer.clear()},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.gridContainer.remove(!0),this.gridForeContainer.remove(!0),this.axisContainer.remove(!0),this.axisForeContainer.remove(!0)},t.prototype.getComponents=function(){var e=[];return this.cache.forEach(function(i){e.push(i)}),e},t.prototype.updateXAxes=function(e){var i=this.view.getXScale();if(!(!i||i.isIdentity)){var n=Y0(this.option,i.field);if(n!==!1){var a=x3(n,nt.BOTTOM),o=ir.BG,s="x",l=this.view.getCoordinate(),u=this.getId("axis",i.field),c=this.getId("grid",i.field);if(l.isRect){var h=this.cache.get(u);if(h){var f=this.getLineAxisCfg(i,n,a);$i(f,bs),h.component.update(f),e.set(u,h)}else h=this.createLineAxis(i,n,o,a,s),this.cache.set(u,h),e.set(u,h);var d=this.cache.get(c);if(d){var f=this.getLineGridCfg(i,n,a,s);$i(f,bs),d.component.update(f),e.set(c,d)}else d=this.createLineGrid(i,n,o,a,s),d&&(this.cache.set(c,d),e.set(c,d))}else if(l.isPolar){var h=this.cache.get(u);if(h){var f=l.isTransposed?this.getLineAxisCfg(i,n,nt.RADIUS):this.getCircleAxisCfg(i,n,a);$i(f,bs),h.component.update(f),e.set(u,h)}else{if(l.isTransposed){if(zr(n))return;h=this.createLineAxis(i,n,o,nt.RADIUS,s)}else h=this.createCircleAxis(i,n,o,a,s);this.cache.set(u,h),e.set(u,h)}var d=this.cache.get(c);if(d){var f=l.isTransposed?this.getCircleGridCfg(i,n,nt.RADIUS,s):this.getLineGridCfg(i,n,nt.CIRCLE,s);$i(f,bs),d.component.update(f),e.set(c,d)}else{if(l.isTransposed){if(zr(n))return;d=this.createCircleGrid(i,n,o,nt.RADIUS,s)}else d=this.createLineGrid(i,n,o,nt.CIRCLE,s);d&&(this.cache.set(c,d),e.set(c,d))}}}}},t.prototype.updateYAxes=function(e){var i=this,n=this.view.getYScales();I(n,function(a,o){if(!(!a||a.isIdentity)){var s=a.field,l=Y0(i.option,s);if(l!==!1){var u=ir.BG,c="y",h=i.getId("axis",s),f=i.getId("grid",s),d=i.view.getCoordinate();if(d.isRect){var v=x3(l,o===0?nt.LEFT:nt.RIGHT),p=i.cache.get(h);if(p){var g=i.getLineAxisCfg(a,l,v);$i(g,bs),p.component.update(g),e.set(h,p)}else p=i.createLineAxis(a,l,u,v,c),i.cache.set(h,p),e.set(h,p);var m=i.cache.get(f);if(m){var g=i.getLineGridCfg(a,l,v,c);$i(g,bs),m.component.update(g),e.set(f,m)}else m=i.createLineGrid(a,l,u,v,c),m&&(i.cache.set(f,m),e.set(f,m))}else if(d.isPolar){var p=i.cache.get(h);if(p){var g=d.isTransposed?i.getCircleAxisCfg(a,l,nt.CIRCLE):i.getLineAxisCfg(a,l,nt.RADIUS);$i(g,bs),p.component.update(g),e.set(h,p)}else{if(d.isTransposed){if(zr(l))return;p=i.createCircleAxis(a,l,u,nt.CIRCLE,c)}else p=i.createLineAxis(a,l,u,nt.RADIUS,c);i.cache.set(h,p),e.set(h,p)}var m=i.cache.get(f);if(m){var g=d.isTransposed?i.getLineGridCfg(a,l,nt.CIRCLE,c):i.getCircleGridCfg(a,l,nt.RADIUS,c);$i(g,bs),m.component.update(g),e.set(f,m)}else{if(d.isTransposed){if(zr(l))return;m=i.createLineGrid(a,l,u,nt.CIRCLE,c)}else m=i.createCircleGrid(a,l,u,nt.RADIUS,c);m&&(i.cache.set(f,m),e.set(f,m))}}}}})},t.prototype.createLineAxis=function(e,i,n,a,o){var s={component:new $ut(this.getLineAxisCfg(e,i,a)),layer:n,direction:a===nt.RADIUS?nt.NONE:a,type:Ar.AXIS,extra:{dim:o,scale:e}};return s.component.set("field",e.field),s.component.init(),s},t.prototype.createLineGrid=function(e,i,n,a,o){var s=this.getLineGridCfg(e,i,a,o);if(s){var l={component:new Vut(s),layer:n,direction:nt.NONE,type:Ar.GRID,extra:{dim:o,scale:e,alignTick:P(s,"alignTick",!0)}};return l.component.init(),l}},t.prototype.createCircleAxis=function(e,i,n,a,o){var s={component:new Wut(this.getCircleAxisCfg(e,i,a)),layer:n,direction:a,type:Ar.AXIS,extra:{dim:o,scale:e}};return s.component.set("field",e.field),s.component.init(),s},t.prototype.createCircleGrid=function(e,i,n,a,o){var s=this.getCircleGridCfg(e,i,a,o);if(s){var l={component:new Gut(s),layer:n,direction:nt.NONE,type:Ar.GRID,extra:{dim:o,scale:e,alignTick:P(s,"alignTick",!0)}};return l.component.init(),l}},t.prototype.getLineAxisCfg=function(e,i,n){var a=P(i,["top"])?this.axisForeContainer:this.axisContainer,o=this.view.getCoordinate(),s=Zp(o,n),l=C3(e,i),u=qp(this.view.getTheme(),n),c=P(i,["title"])?at({title:{style:{text:l}}},{title:_3(this.view.getTheme(),n,i.title)},i):i,h=at(S(S({container:a},s),{ticks:e.getTicks().map(function(_){return{id:"".concat(_.tickValue),name:_.text,value:_.value}}),verticalFactor:o.isPolar?y3(s,o.getCenter())*-1:y3(s,o.getCenter()),theme:u}),u,c),f=this.getAnimateCfg(h),d=f.animate,v=f.animateOption;h.animateOption=v,h.animate=d;var p=W4(s),g=P(h,"verticalLimitLength",p?1/3:1/2);if(g<=1){var m=this.view.getCanvas().get("width"),y=this.view.getCanvas().get("height");h.verticalLimitLength=g*(p?m:y)}return h},t.prototype.getLineGridCfg=function(e,i,n,a){if(gI(qp(this.view.getTheme(),n),i)){var o=pI(this.view.getTheme(),n),s=at({container:P(i,["top"])?this.gridForeContainer:this.gridContainer},o,P(i,"grid"),this.getAnimateCfg(i));return s.items=ug(this.view.getCoordinate(),e,a,P(s,"alignTick",!0)),s}},t.prototype.getCircleAxisCfg=function(e,i,n){var a=P(i,["top"])?this.axisForeContainer:this.axisContainer,o=this.view.getCoordinate(),s=e.getTicks().map(function(p){return{id:"".concat(p.tickValue),name:p.text,value:p.value}});!e.isCategory&&Math.abs(o.endAngle-o.startAngle)===Math.PI*2&&s.length&&(s[s.length-1].name="");var l=C3(e,i),u=qp(this.view.getTheme(),nt.CIRCLE),c=P(i,["title"])?at({title:{style:{text:l}}},{title:_3(this.view.getTheme(),n,i.title)},i):i,h=at(S(S({container:a},r1(this.view.getCoordinate())),{ticks:s,verticalFactor:1,theme:u}),u,c),f=this.getAnimateCfg(h),d=f.animate,v=f.animateOption;return h.animate=d,h.animateOption=v,h},t.prototype.getCircleGridCfg=function(e,i,n,a){if(gI(qp(this.view.getTheme(),n),i)){var o=pI(this.view.getTheme(),nt.RADIUS),s=at({container:P(i,["top"])?this.gridForeContainer:this.gridContainer,center:this.view.getCoordinate().getCenter()},o,P(i,"grid"),this.getAnimateCfg(i)),l=P(s,"alignTick",!0),u=a==="x"?this.view.getYScales()[0]:this.view.getXScale();return s.items=h1(this.view.getCoordinate(),u,e,l,a),s}},t.prototype.getId=function(e,i){var n=this.view.getCoordinate();return"".concat(e,"-").concat(i,"-").concat(n.type)},t.prototype.getAnimateCfg=function(e){return{animate:this.view.getOptions().animate&&P(e,"animate"),animateOption:e&&e.animateOption?at({},mI,e.animateOption):mI}},t}(Fh);function zs(r,t,e){return e===nt.TOP?[r.minX+r.width/2-t.width/2,r.minY]:e===nt.BOTTOM?[r.minX+r.width/2-t.width/2,r.maxY-t.height]:e===nt.LEFT?[r.minX,r.minY+r.height/2-t.height/2]:e===nt.RIGHT?[r.maxX-t.width,r.minY+r.height/2-t.height/2]:e===nt.TOP_LEFT||e===nt.LEFT_TOP?[r.tl.x,r.tl.y]:e===nt.TOP_RIGHT||e===nt.RIGHT_TOP?[r.tr.x-t.width,r.tr.y]:e===nt.BOTTOM_LEFT||e===nt.LEFT_BOTTOM?[r.bl.x,r.bl.y-t.height]:e===nt.BOTTOM_RIGHT||e===nt.RIGHT_BOTTOM?[r.br.x-t.width,r.br.y-t.height]:[0,0]}function yI(r,t){return os(r)?r===!1?!1:{}:P(r,[t],r)}function cg(r){return P(r,"position",nt.BOTTOM)}var jvt=function(r){N(t,r);function t(e){var i=r.call(this,e)||this;return i.container=i.view.getLayer(ir.FORE).addGroup(),i}return Object.defineProperty(t.prototype,"name",{get:function(){return"legend"},enumerable:!1,configurable:!0}),t.prototype.init=function(){},t.prototype.render=function(){this.update()},t.prototype.layout=function(){var e=this;this.layoutBBox=this.view.viewBBox,I(this.components,function(i){var n=i.component,a=i.direction,o=n1(a),s=n.get("maxWidthRatio"),l=n.get("maxHeightRatio"),u=e.getCategoryLegendSizeCfg(o,s,l),c=n.get("maxWidth"),h=n.get("maxHeight");n.update({maxWidth:Math.min(u.maxWidth,c||0),maxHeight:Math.min(u.maxHeight,h||0)});var f=n.get("padding"),d=n.getLayoutBBox(),v=new Ri(d.x,d.y,d.width,d.height).expand(f),p=ct(zs(e.view.viewBBox,v,a),2),g=p[0],m=p[1],y=ct(zs(e.layoutBBox,v,a),2),_=y[0],x=y[1],C=0,A=0;a.startsWith("top")||a.startsWith("bottom")?(C=g,A=x):(C=_,A=m),n.setLocation({x:C+f[3],y:A+f[0]}),e.layoutBBox=e.layoutBBox.cut(v,a)})},t.prototype.update=function(){var e=this;this.option=this.view.getOptions().legends;var i={},n=function(f,d,v){var p=e.getId(v.field),g=e.getComponentById(p);if(g){var m=void 0,y=yI(e.option,v.field);y!==!1&&(P(y,"custom")?m=e.getCategoryCfg(f,d,v,y,!0):v.isLinear?m=e.getContinuousCfg(f,d,v,y):v.isCategory&&(m=e.getCategoryCfg(f,d,v,y))),m&&($i(m,["container"]),g.direction=cg(y),g.component.update(m),i[p]=!0)}else{var _=e.createFieldLegend(f,d,v);_&&(_.component.init(),e.components.push(_),i[p]=!0)}};if(P(this.option,"custom")){var a="global-custom",o=this.getComponentById(a);if(o){var s=this.getCategoryCfg(void 0,void 0,void 0,this.option,!0);$i(s,["container"]),o.component.update(s),i[a]=!0}else{var l=this.createCustomLegend(void 0,void 0,void 0,this.option);if(l){l.init();var u=ir.FORE,c=cg(this.option);this.components.push({id:a,component:l,layer:u,direction:c,type:Ar.LEGEND,extra:void 0}),i[a]=!0}}}else this.loopLegends(n);var h=[];I(this.getComponents(),function(f){i[f.id]?h.push(f):f.component.destroy()}),this.components=h},t.prototype.clear=function(){r.prototype.clear.call(this),this.container.clear()},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.container.remove(!0)},t.prototype.getGeometries=function(e){var i=this,n=e.geometries;return I(e.views,function(a){n=n.concat(i.getGeometries(a))}),n},t.prototype.loopLegends=function(e){var i=this.view.getRootView()===this.view;if(i){var n=this.getGeometries(this.view),a={};I(n,function(o){var s=o.getGroupAttributes();I(s,function(l){var u=l.getScale(l.type);!u||u.type==="identity"||a[u.field]||(e(o,l,u),a[u.field]=!0)})})}},t.prototype.createFieldLegend=function(e,i,n){var a,o=yI(this.option,n.field),s=ir.FORE,l=cg(o);if(o!==!1&&(P(o,"custom")?a=this.createCustomLegend(e,i,n,o):n.isLinear?a=this.createContinuousLegend(e,i,n,o):n.isCategory&&(a=this.createCategoryLegend(e,i,n,o))),a)return a.set("field",n.field),{id:this.getId(n.field),component:a,layer:s,direction:l,type:Ar.LEGEND,extra:{scale:n}}},t.prototype.createCustomLegend=function(e,i,n,a){var o=this.getCategoryCfg(e,i,n,a,!0);return new p3(o)},t.prototype.createContinuousLegend=function(e,i,n,a){var o=this.getContinuousCfg(e,i,n,$i(a,["value"]));return new Xut(o)},t.prototype.createCategoryLegend=function(e,i,n,a){var o=this.getCategoryCfg(e,i,n,a);return new p3(o)},t.prototype.getContinuousCfg=function(e,i,n,a){var o=n.getTicks(),s=Qn(o,function(p){return p.value===0}),l=Qn(o,function(p){return p.value===1}),u=o.map(function(p){var g=p.value,m=p.tickValue,y=i.mapping(n.invert(g)).join("");return{value:m,attrValue:y,color:y,scaleValue:g}});s||u.push({value:n.min,attrValue:i.mapping(n.invert(0)).join(""),color:i.mapping(n.invert(0)).join(""),scaleValue:0}),l||u.push({value:n.max,attrValue:i.mapping(n.invert(1)).join(""),color:i.mapping(n.invert(1)).join(""),scaleValue:1}),u.sort(function(p,g){return p.value-g.value});var c={min:Ki(u).value,max:cr(u).value,colors:[],rail:{type:i.type},track:{}};i.type==="size"&&(c.track={style:{fill:i.type==="size"?this.view.getTheme().defaultColor:void 0}}),i.type==="color"&&(c.colors=u.map(function(p){return p.attrValue}));var h=this.container,f=cg(a),d=n1(f),v=P(a,"title");return v&&(v=at({text:Id(n)},v)),c.container=h,c.layout=d,c.title=v,c.animateOption=sh,this.mergeLegendCfg(c,a,"continuous")},t.prototype.getCategoryCfg=function(e,i,n,a,o){var s=this.container,l=P(a,"position",nt.BOTTOM),u=N3(this.view.getTheme(),l),c=P(u,["marker"]),h=P(a,"marker"),f=n1(l),d=P(u,["pageNavigator"]),v=P(a,"pageNavigator"),p=o?Tht(c,h,a.items):AN(this.view,e,i,c,h),g=P(a,"title");g&&(g=at({text:n?Id(n):""},g));var m=P(a,"maxWidthRatio"),y=P(a,"maxHeightRatio"),_=this.getCategoryLegendSizeCfg(f,m,y);_.container=s,_.layout=f,_.items=p,_.title=g,_.animateOption=sh,_.pageNavigator=at({},d,v);var x=this.mergeLegendCfg(_,a,l);x.reversed&&x.items.reverse();var C=P(x,"maxItemWidth");return C&&C<=1&&(x.maxItemWidth=this.view.viewBBox.width*C),x},t.prototype.mergeLegendCfg=function(e,i,n){var a=n.split("-")[0],o=N3(this.view.getTheme(),a);return at({},o,e,i)},t.prototype.getId=function(e){return"".concat(this.name,"-").concat(e)},t.prototype.getComponentById=function(e){return Qn(this.components,function(i){return i.id===e})},t.prototype.getCategoryLegendSizeCfg=function(e,i,n){i===void 0&&(i=MM),n===void 0&&(n=MM);var a=this.view.viewBBox,o=a.width,s=a.height;return e==="vertical"?{maxWidth:o*i,maxHeight:s}:{maxWidth:o,maxHeight:s*n}},t}(Fh),Zvt=function(r){N(t,r);function t(e){var i=r.call(this,e)||this;return i.onChangeFn=Go,i.resetMeasure=function(){i.clear()},i.onValueChange=function(n){var a=ct(n,2),o=a[0],s=a[1];i.start=o,i.end=s,i.changeViewData(o,s)},i.container=i.view.getLayer(ir.FORE).addGroup(),i.onChangeFn=Zm(i.onValueChange,20,{leading:!0}),i.width=0,i.view.on(Ut.BEFORE_CHANGE_DATA,i.resetMeasure),i.view.on(Ut.BEFORE_CHANGE_SIZE,i.resetMeasure),i}return Object.defineProperty(t.prototype,"name",{get:function(){return"slider"},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){r.prototype.destroy.call(this),this.view.off(Ut.BEFORE_CHANGE_DATA,this.resetMeasure),this.view.off(Ut.BEFORE_CHANGE_SIZE,this.resetMeasure)},t.prototype.init=function(){},t.prototype.render=function(){this.option=this.view.getOptions().slider;var e=this.getSliderCfg(),i=e.start,n=e.end;K(this.start)&&(this.start=i,this.end=n);var a=this.view.getOptions().data;this.option&&!Mi(a)?this.slider?this.slider=this.updateSlider():(this.slider=this.createSlider(),this.slider.component.on("sliderchange",this.onChangeFn)):this.slider&&(this.slider.component.destroy(),this.slider=void 0)},t.prototype.layout=function(){var e=this;if(this.option&&!this.width&&(this.measureSlider(),setTimeout(function(){e.view.destroyed||e.changeViewData(e.start,e.end)},0)),this.slider){var i=this.view.coordinateBBox.width,n=this.slider.component.get("padding"),a=ct(n,4),o=a[0];a[1],a[2];var s=a[3],l=this.slider.component.getLayoutBBox(),u=new Ri(l.x,l.y,Math.min(l.width,i),l.height).expand(n),c=this.getMinMaxText(this.start,this.end),h=c.minText,f=c.maxText,d=ct(zs(this.view.viewBBox,u,nt.BOTTOM),2);d[0];var v=d[1],p=ct(zs(this.view.coordinateBBox,u,nt.BOTTOM),2),g=p[0];p[1],this.slider.component.update(S(S({},this.getSliderCfg()),{x:g+s,y:v+o,width:this.width,start:this.start,end:this.end,minText:h,maxText:f})),this.view.viewBBox=this.view.viewBBox.cut(u,nt.BOTTOM)}},t.prototype.update=function(){this.render()},t.prototype.createSlider=function(){var e=this.getSliderCfg(),i=new N4(S({container:this.container},e));return i.init(),{component:i,layer:ir.FORE,direction:nt.BOTTOM,type:Ar.SLIDER}},t.prototype.updateSlider=function(){var e=this.getSliderCfg();if(this.width){var i=this.getMinMaxText(this.start,this.end),n=i.minText,a=i.maxText;e=S(S({},e),{width:this.width,start:this.start,end:this.end,minText:n,maxText:a})}return this.slider.component.update(e),this.slider},t.prototype.measureSlider=function(){var e=this.getSliderCfg().width;this.width=e},t.prototype.getSliderCfg=function(){var e={height:16,start:0,end:1,minText:"",maxText:"",x:0,y:0,width:this.view.coordinateBBox.width};if(ie(this.option)){var i=S({data:this.getData()},P(this.option,"trendCfg",{}));e=at({},e,this.getThemeOptions(),this.option),e=S(S({},e),{trendCfg:i})}return e.start=Oe(Math.min(K(e.start)?0:e.start,K(e.end)?1:e.end),0,1),e.end=Oe(Math.max(K(e.start)?0:e.start,K(e.end)?1:e.end),0,1),e},t.prototype.getData=function(){var e=this.view.getOptions().data,i=ct(this.view.getYScales(),1),n=i[0],a=this.view.getGroupScales();if(a.length){var o=a[0],s=o.field,l=o.ticks;return e.reduce(function(u,c){return c[s]===l[0]&&u.push(c[n.field]),u},[])}return e.map(function(u){return u[n.field]||0})},t.prototype.getThemeOptions=function(){var e=this.view.getTheme();return P(e,["components","slider","common"],{})},t.prototype.getMinMaxText=function(e,i){var n=this.view.getOptions().data,a=this.view.getXScale(),o=ea(n,a.field);a.isLinear&&(o=o.sort());var s=o,l=xr(n);if(!a||!l)return{};var u=xr(s),c=Math.round(e*(u-1)),h=Math.round(i*(u-1)),f=P(s,[c]),d=P(s,[h]),v=this.getSliderCfg().formatter;return v&&(f=v(f,n[c],c),d=v(d,n[h],h)),{minText:f,maxText:d}},t.prototype.changeViewData=function(e,i){var n=this.view.getOptions().data,a=this.view.getXScale(),o=xr(n);if(!(!a||!o)){var s=ea(n,a.field),l=this.view.getXScale().isLinear?s.sort(function(d,v){return Number(d)-Number(v)}):s,u=l,c=xr(u),h=Math.round(e*(c-1)),f=Math.round(i*(c-1));this.view.filter(a.field,function(d,v){var p=u.indexOf(d);return p>-1?Sc(p,h,f):!0}),this.view.render(!0)}},t.prototype.getComponents=function(){return this.slider?[this.slider]:[]},t.prototype.clear=function(){this.slider&&(this.slider.component.destroy(),this.slider=void 0),this.width=0,this.start=void 0,this.end=void 0},t}(Fh),hg=0,_I=8,qvt=32,Kvt=20,Qvt=function(r){N(t,r);function t(e){var i=r.call(this,e)||this;return i.onChangeFn=Go,i.resetMeasure=function(){i.clear()},i.onValueChange=function(n){var a=n.ratio,o=i.getValidScrollbarCfg().animate;i.ratio=Oe(a,0,1);var s=i.view.getOptions().animate;o||i.view.animate(!1),i.changeViewData(i.getScrollRange(),!0),i.view.animate(s)},i.container=i.view.getLayer(ir.FORE).addGroup(),i.onChangeFn=Zm(i.onValueChange,20,{leading:!0}),i.trackLen=0,i.thumbLen=0,i.ratio=0,i.view.on(Ut.BEFORE_CHANGE_DATA,i.resetMeasure),i.view.on(Ut.BEFORE_CHANGE_SIZE,i.resetMeasure),i}return Object.defineProperty(t.prototype,"name",{get:function(){return"scrollbar"},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){r.prototype.destroy.call(this),this.view.off(Ut.BEFORE_CHANGE_DATA,this.resetMeasure),this.view.off(Ut.BEFORE_CHANGE_SIZE,this.resetMeasure)},t.prototype.init=function(){},t.prototype.render=function(){this.option=this.view.getOptions().scrollbar,this.option?this.scrollbar?this.scrollbar=this.updateScrollbar():(this.scrollbar=this.createScrollbar(),this.scrollbar.component.on("scrollchange",this.onChangeFn)):this.scrollbar&&(this.scrollbar.component.destroy(),this.scrollbar=void 0)},t.prototype.layout=function(){var e=this;if(this.option&&!this.trackLen&&(this.measureScrollbar(),setTimeout(function(){e.view.destroyed||e.changeViewData(e.getScrollRange(),!0)})),this.scrollbar){var i=this.view.coordinateBBox.width,n=this.scrollbar.component.get("padding"),a=this.scrollbar.component.getLayoutBBox(),o=new Ri(a.x,a.y,Math.min(a.width,i),a.height).expand(n),s=this.getScrollbarComponentCfg(),l=void 0,u=void 0;if(s.isHorizontal){var c=ct(zs(this.view.viewBBox,o,nt.BOTTOM),2);c[0];var h=c[1],f=ct(zs(this.view.coordinateBBox,o,nt.BOTTOM),2),d=f[0];f[1],l=d,u=h}else{var v=ct(zs(this.view.viewBBox,o,nt.RIGHT),2);v[0];var h=v[1],p=ct(zs(this.view.viewBBox,o,nt.RIGHT),2),d=p[0];p[1],l=d,u=h}l+=n[3],u+=n[0],this.trackLen?this.scrollbar.component.update(S(S({},s),{x:l,y:u,trackLen:this.trackLen,thumbLen:this.thumbLen,thumbOffset:(this.trackLen-this.thumbLen)*this.ratio})):this.scrollbar.component.update(S(S({},s),{x:l,y:u})),this.view.viewBBox=this.view.viewBBox.cut(o,s.isHorizontal?nt.BOTTOM:nt.RIGHT)}},t.prototype.update=function(){this.render()},t.prototype.getComponents=function(){return this.scrollbar?[this.scrollbar]:[]},t.prototype.clear=function(){this.scrollbar&&(this.scrollbar.component.destroy(),this.scrollbar=void 0),this.trackLen=0,this.thumbLen=0,this.ratio=0,this.cnt=0,this.step=0,this.data=void 0,this.xScaleCfg=void 0,this.yScalesCfg=[]},t.prototype.setValue=function(e){this.onValueChange({ratio:e})},t.prototype.getValue=function(){return this.ratio},t.prototype.getThemeOptions=function(){var e=this.view.getTheme();return P(e,["components","scrollbar","common"],{})},t.prototype.getScrollbarTheme=function(e){var i=P(this.view.getTheme(),["components","scrollbar"]),n=e||{},a=n.thumbHighlightColor,o=zt(n,["thumbHighlightColor"]);return{default:at({},P(i,["default","style"],{}),o),hover:at({},P(i,["hover","style"],{}),{thumbColor:a})}},t.prototype.measureScrollbar=function(){var e=this.view.getXScale(),i=this.view.getYScales().slice();this.data=this.getScrollbarData(),this.step=this.getStep(),this.cnt=this.getCnt();var n=this.getScrollbarComponentCfg(),a=n.trackLen,o=n.thumbLen;this.trackLen=a,this.thumbLen=o,this.xScaleCfg={field:e.field,values:e.values||[]},this.yScalesCfg=i},t.prototype.getScrollRange=function(){var e=Math.floor((this.cnt-this.step)*Oe(this.ratio,0,1)),i=Math.min(e+this.step-1,this.cnt-1);return[e,i]},t.prototype.changeViewData=function(e,i){var n=this,a=ct(e,2),o=a[0],s=a[1],l=this.getValidScrollbarCfg().type,u=l!=="vertical",c=ea(this.data,this.xScaleCfg.field),h=this.view.getXScale().isLinear?c.sort(function(d,v){return Number(d)-Number(v)}):c,f=u?h:h.reverse();this.yScalesCfg.forEach(function(d){n.view.scale(d.field,{formatter:d.formatter,type:d.type,min:d.min,max:d.max,tickMethod:d.tickMethod})}),this.view.filter(this.xScaleCfg.field,function(d){var v=f.indexOf(d);return v>-1?Sc(v,o,s):!0}),this.view.render(!0)},t.prototype.createScrollbar=function(){var e=this.getValidScrollbarCfg().type,i=e!=="vertical",n=new k4(S(S({container:this.container},this.getScrollbarComponentCfg()),{x:0,y:0}));return n.init(),{component:n,layer:ir.FORE,direction:i?nt.BOTTOM:nt.RIGHT,type:Ar.SCROLLBAR}},t.prototype.updateScrollbar=function(){var e=this.getScrollbarComponentCfg(),i=this.trackLen?S(S({},e),{trackLen:this.trackLen,thumbLen:this.thumbLen,thumbOffset:(this.trackLen-this.thumbLen)*this.ratio}):S({},e);return this.scrollbar.component.update(i),this.scrollbar},t.prototype.getStep=function(){if(this.step)return this.step;var e=this.view.coordinateBBox,i=this.getValidScrollbarCfg(),n=i.type,a=i.categorySize,o=n!=="vertical";return Math.floor((o?e.width:e.height)/a)},t.prototype.getCnt=function(){if(this.cnt)return this.cnt;var e=this.view.getXScale(),i=this.getScrollbarData(),n=ea(i,e.field);return xr(n)},t.prototype.getScrollbarComponentCfg=function(){var e=this.view,i=e.coordinateBBox,n=e.viewBBox,a=this.getValidScrollbarCfg(),o=a.type,s=a.padding,l=a.width,u=a.height,c=a.style,h=o!=="vertical",f=ct(s,4),d=f[0],v=f[1],p=f[2],g=f[3],m=h?{x:i.minX+g,y:n.maxY-u-p}:{x:n.maxX-l-v,y:i.minY+d},y=this.getStep(),_=this.getCnt(),x=h?i.width-g-v:i.height-d-p,C=Math.max(x*Oe(y/_,0,1),Kvt);return S(S({},this.getThemeOptions()),{x:m.x,y:m.y,size:h?u:l,isHorizontal:h,trackLen:x,thumbLen:C,thumbOffset:0,theme:this.getScrollbarTheme(c)})},t.prototype.getValidScrollbarCfg=function(){var e={type:"horizontal",categorySize:qvt,width:_I,height:_I,padding:[0,0,0,0],animate:!0,style:{}};return ie(this.option)&&(e=S(S({},e),this.option)),(!ie(this.option)||!this.option.padding)&&(e.padding=e.type==="horizontal"?[hg,0,hg,0]:[0,hg,0,hg]),e},t.prototype.getScrollbarData=function(){var e=this.view.getCoordinate(),i=this.getValidScrollbarCfg(),n=this.view.getOptions().data||[];return e.isReflect("y")&&i.type==="vertical"&&(n=xt([],ct(n),!1).reverse()),n},t}(Fh),Jvt={fill:"#CCD6EC",opacity:.3};function tpt(r,t,e){var i,n,a,o,s,l,u=Qct(r,t,e);if(u.length){u=en(u);try{for(var c=Qt(u),h=c.next();!h.done;h=c.next()){var f=h.value;try{for(var d=(a=void 0,Qt(f)),v=d.next();!v.done;v=d.next()){var p=v.value,g=p.mappingData,m=g.x,y=g.y;p.x=q(m)?m[m.length-1]:m,p.y=q(y)?y[y.length-1]:y}}catch(O){a={error:O}}finally{try{v&&!v.done&&(o=d.return)&&o.call(d)}finally{if(a)throw a.error}}}}catch(O){i={error:O}}finally{try{h&&!h.done&&(n=c.return)&&n.call(c)}finally{if(i)throw i.error}}var _=e.shared;if(_===!1&&u.length>1){var x=u[0],C=Math.abs(t.y-x[0].y);try{for(var A=Qt(u),b=A.next();!b.done;b=A.next()){var R=b.value,M=Math.abs(t.y-R[0].y);M<=C&&(x=R,C=M)}}catch(O){s={error:O}}finally{try{b&&!b.done&&(l=A.return)&&l.call(A)}finally{if(s)throw s.error}}u=[x]}return as(en(u))}return[]}var ept=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.show=function(e){var i=this.context.view,n=this.context.event,a=i.getController("tooltip").getTooltipCfg(),o=tpt(i,{x:n.x,y:n.y},a);if(!qt(o,this.items)&&(this.items=o,o.length)){var s=i.getXScale().field,l=o[0].data[s],u=[],c=i.geometries;if(I(c,function(Q){if(Q.type==="interval"||Q.type==="schema"){var Y=Q.getElementsBy(function(tt){var et=tt.getData();return et[s]===l});u=u.concat(Y)}}),u.length){var h=i.getCoordinate(),f=u[0].shape.getCanvasBBox(),d=u[0].shape.getCanvasBBox(),v=f;I(u,function(Q){var Y=Q.shape.getCanvasBBox();h.isTransposed?(Y.minY<f.minY&&(f=Y),Y.maxY>d.maxY&&(d=Y)):(Y.minX<f.minX&&(f=Y),Y.maxX>d.maxX&&(d=Y)),v.x=Math.min(Y.minX,v.minX),v.y=Math.min(Y.minY,v.minY),v.width=Math.max(Y.maxX,v.maxX)-v.x,v.height=Math.max(Y.maxY,v.maxY)-v.y});var p=i.backgroundGroup,g=i.coordinateBBox,m=void 0;if(h.isRect){var y=i.getXScale(),_=e||{},x=_.appendRatio,C=_.appendWidth;K(C)&&(x=K(x)?y.isLinear?0:.25:x,C=h.isTransposed?x*d.height:x*f.width);var A=void 0,b=void 0,R=void 0,M=void 0;h.isTransposed?(A=g.minX,b=Math.min(d.minY,f.minY)-C,R=g.width,M=v.height+C*2):(A=Math.min(f.minX,d.minX)-C,b=g.minY,R=v.width+C*2,M=g.height),m=[["M",A,b],["L",A+R,b],["L",A+R,b+M],["L",A,b+M],["Z"]]}else{var O=Ki(u),F=cr(u),D=Md(O.getModel(),h).startAngle,H=Md(F.getModel(),h).endAngle,j=h.getCenter(),$=h.getRadius(),k=h.innerRadius*$;m=Xs(j.x,j.y,$,D,H,k)}if(this.regionPath)this.regionPath.attr("path",m),this.regionPath.show();else{var V=P(e,"style",Jvt);this.regionPath=p.addShape({type:"path",name:"active-region",capture:!1,attrs:S(S({},V),{path:m})})}}}},t.prototype.hide=function(){this.regionPath&&this.regionPath.hide(),this.items=null},t.prototype.destroy=function(){this.hide(),this.regionPath&&this.regionPath.remove(!0),r.prototype.destroy.call(this)},t}(De),a6=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.timeStamp=0,e}return t.prototype.show=function(){var e=this.context,i=e.event,n=e.view,a=n.isTooltipLocked();if(!a){var o=this.timeStamp,s=+new Date,l=P(e.view.getOptions(),"tooltip.showDelay",16);if(s-o>l){var u=this.location,c={x:i.x,y:i.y};(!u||!qt(u,c))&&this.showTooltip(n,c),this.timeStamp=s,this.location=c}}},t.prototype.hide=function(){var e=this.context.view,i=e.getController("tooltip"),n=this.context.event,a=n.clientX,o=n.clientY;i.isCursorEntered({x:a,y:o})||e.isTooltipLocked()||(this.hideTooltip(e),this.location=null)},t.prototype.showTooltip=function(e,i){e.showTooltip(i)},t.prototype.hideTooltip=function(e){e.hideTooltip()},t}(De),rpt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.showTooltip=function(e,i){var n=vo(e);I(n,function(a){var o=Yx(e,a,i);a.showTooltip(o)})},t.prototype.hideTooltip=function(e){var i=vo(e);I(i,function(n){n.hideTooltip()})},t}(a6),ipt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.timeStamp=0,e}return t.prototype.destroy=function(){r.prototype.destroy.call(this),this.tooltip&&this.tooltip.destroy()},t.prototype.show=function(){var e=this.context,i=e.event,n=this.timeStamp,a=+new Date;if(a-n>16){var o=this.location,s={x:i.x,y:i.y};(!o||!qt(o,s))&&this.showTooltip(s),this.timeStamp=a,this.location=s}},t.prototype.hide=function(){this.hideTooltip(),this.location=null},t.prototype.showTooltip=function(e){var i=this.context,n=i.event,a=n.target;if(a&&a.get("tip")){if(!this.tooltip)this.renderTooltip();else{var o=i.view,s=o.canvas,l={start:{x:0,y:0},end:{x:s.get("width"),y:s.get("height")}};this.tooltip.set("region",l)}var u=a.get("tip");this.tooltip.update(S({title:u},e)),this.tooltip.show()}},t.prototype.hideTooltip=function(){this.tooltip&&this.tooltip.hide()},t.prototype.renderTooltip=function(){var e,i=this.context.view,n=i.canvas,a={start:{x:0,y:0},end:{x:n.get("width"),y:n.get("height")}},o=i.getTheme(),s=P(o,["components","tooltip","domStyles"],{}),l=new sy({parent:n.get("el").parentNode,region:a,visible:!1,crosshairs:null,domStyles:S({},at({},s,(e={},e[ss]={"max-width":"50%"},e[ls]={"word-break":"break-all"},e)))});l.init(),l.setCapture(!1),this.tooltip=l},t}(De),TA=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName="",e}return t.prototype.hasState=function(e){return e.hasState(this.stateName)},t.prototype.setElementState=function(e,i){e.setState(this.stateName,i)},t.prototype.setState=function(){this.setStateEnable(!0)},t.prototype.clear=function(){var e=this.context.view;this.clearViewState(e)},t.prototype.clearViewState=function(e){var i=this,n=rN(e,this.stateName);I(n,function(a){i.setElementState(a,!1)})},t}(De);function xI(r){return P(r.get("delegateObject"),"item")}var bA=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.ignoreListItemStates=["unchecked"],e}return t.prototype.isItemIgnore=function(e,i){var n=this.ignoreListItemStates,a=n.filter(function(o){return i.hasState(e,o)});return!!a.length},t.prototype.setStateByComponent=function(e,i,n){var a=this.context.view,o=e.get("field"),s=$r(a);this.setElementsStateByItem(s,o,i,n)},t.prototype.setStateByElement=function(e,i){this.setElementState(e,i)},t.prototype.isMathItem=function(e,i,n){var a=this.context.view,o=oh(a,i),s=Fa(e,i);return!K(s)&&n.name===o.getText(s)},t.prototype.setElementsStateByItem=function(e,i,n,a){var o=this;I(e,function(s){o.isMathItem(s,i,n)&&s.setState(o.stateName,a)})},t.prototype.setStateEnable=function(e){var i=qs(this.context);if(i)Q4(this.context)&&this.setStateByElement(i,e);else{var n=gu(this.context);if(Ld(n)){var a=n.item,o=n.component;if(a&&o&&!this.isItemIgnore(a,o)){var s=this.context.event.gEvent;if(s&&s.fromShape&&s.toShape&&xI(s.fromShape)===xI(s.toShape))return;this.setStateByComponent(o,a,e)}}}},t.prototype.toggle=function(){var e=qs(this.context);if(e){var i=e.hasState(this.stateName);this.setElementState(e,!i)}},t.prototype.reset=function(){this.setStateEnable(!1)},t}(TA),npt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName="active",e}return t.prototype.active=function(){this.setState()},t}(bA),apt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.cache={},e}return t.prototype.getColorScale=function(e,i){var n=i.geometry.getAttribute("color");if(!n)return null;var a=e.getScaleByField(n.getFields()[0]);return a},t.prototype.getLinkPath=function(e,i){var n=this.context.view,a=n.getCoordinate().isTransposed,o=e.shape.getCanvasBBox(),s=i.shape.getCanvasBBox(),l=a?[["M",o.minX,o.minY],["L",s.minX,s.maxY],["L",s.maxX,s.maxY],["L",o.maxX,o.minY],["Z"]]:[["M",o.maxX,o.minY],["L",s.minX,s.minY],["L",s.minX,s.maxY],["L",o.maxX,o.maxY],["Z"]];return l},t.prototype.addLinkShape=function(e,i,n,a){var o={opacity:.4,fill:i.shape.attr("fill")};e.addShape({type:"path",attrs:S(S({},at({},o,ot(a)?a(o,i):a)),{path:this.getLinkPath(i,n)})})},t.prototype.linkByElement=function(e,i){var n=this,a=this.context.view,o=this.getColorScale(a,e);if(o){var s=Fa(e,o.field);if(!this.cache[s]){var l=Ict(a,o.field,s),u=this.linkGroup,c=u.addGroup();this.cache[s]=c;var h=l.length;I(l,function(f,d){if(d<h-1){var v=l[d+1];n.addLinkShape(c,f,v,i)}})}}},t.prototype.removeLink=function(e){var i=this.getColorScale(this.context.view,e);if(i){var n=Fa(e,i.field);this.cache[n]&&(this.cache[n].remove(),this.cache[n]=null)}},t.prototype.link=function(e){var i=this.context;this.linkGroup||(this.linkGroup=i.view.foregroundGroup.addGroup({id:"link-by-color-group",capture:!1}));var n=qs(i);n&&this.linkByElement(n,e==null?void 0:e.style)},t.prototype.unlink=function(){var e=qs(this.context);e&&this.removeLink(e)},t.prototype.clear=function(){this.linkGroup&&this.linkGroup.clear(),this.cache={}},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.linkGroup&&this.linkGroup.remove()},t}(De),wA=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.startPoint=null,e.endPoint=null,e.isStarted=!1,e.effectSiblings=!1,e.effectByRecord=!1,e}return t.prototype.getCurrentPoint=function(){var e=this.context.event;return{x:e.x,y:e.y}},t.prototype.start=function(){this.clear(),this.startPoint=this.getCurrentPoint(),this.isStarted=!0},t.prototype.getIntersectElements=function(){var e=null;if(Od(this.context))e=rA(this.context,10);else{var i=this.startPoint,n=this.isStarted?this.getCurrentPoint():this.endPoint;if(!i||!n)return;var a={minX:Math.min(i.x,n.x),minY:Math.min(i.y,n.y),maxX:Math.max(i.x,n.x),maxY:Math.max(i.y,n.y)},o=this.context.view;e=hy(o,a)}return e},t.prototype.setStateEnable=function(e){if(this.effectSiblings&&!this.effectByRecord)this.setSiblingsState(e);else{var i=$r(this.context.view),n=this.getIntersectElements();n&&n.length?this.effectByRecord?this.setSiblingsStateByRecord(n,e):this.setElementsState(n,e,i):this.clear()}},t.prototype.setSiblingsStateByRecord=function(e,i){var n=this,a=this.context.view,o=vo(a),s=e.map(function(c){return c.getModel().data}),l=a.getXScale().field,u=a.getYScales()[0].field;I(o,function(c){var h=$r(c),f=h.filter(function(d){var v=d.getModel().data;return aN(s,v,l,u)});n.setElementsState(f,i,h)})},t.prototype.setSiblingsState=function(e){var i=this,n=this.context.view,a=vo(n);Od(this.context)&&I(a,function(o){var s=$r(o),l=tN(i.context,o,10);l&&l.length?i.setElementsState(l,e,s):i.clearViewState(o)})},t.prototype.setElementsState=function(e,i,n){var a=this;I(n,function(o){e.includes(o)?a.setElementState(o,i):a.setElementState(o,!1)})},t.prototype.end=function(){this.isStarted=!1,this.endPoint=this.getCurrentPoint()},t.prototype.clear=function(){var e=this,i=this.context.view;if(this.effectSiblings){var n=vo(i);I(n,function(a){e.clearViewState(a)})}else this.clearViewState(i)},t}(TA),opt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName="active",e}return t.prototype.active=function(){this.setState()},t}(wA),RA=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.setStateEnable=function(e){var i=qs(this.context);if(i){if(!Q4(this.context))return;e?(this.clear(),this.setElementState(i,!0)):this.hasState(i)&&this.setElementState(i,!1)}},t.prototype.toggle=function(){var e=qs(this.context);if(e){var i=this.hasState(e);i||this.clear(),this.setElementState(e,!i)}},t.prototype.reset=function(){this.setStateEnable(!1)},t}(TA),spt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName="active",e}return t.prototype.active=function(){this.setState()},t}(RA),nd="inactive",ad="active";function MA(r){var t=$r(r);I(t,function(e){e.hasState(ad)&&e.setState(ad,!1),e.hasState(nd)&&e.setState(nd,!1)})}function o6(r,t,e){I(r,function(i){t(i)?(i.hasState(nd)&&i.setState(nd,!1),i.setState(ad,e)):(i.hasState(ad)&&i.setState(ad,!1),i.setState(nd,e))})}var Wl=H0.INACTIVE,$o=H0.ACTIVE,IA=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName=$o,e}return t.prototype.setElementsStateByItem=function(e,i,n,a){var o=this,s=function(l){return o.isMathItem(l,i,n)};this.setHighlightBy(e,s,a)},t.prototype.setElementHighlight=function(e,i){i(e)?(e.hasState(Wl)&&e.setState(Wl,!1),e.setState($o,!0)):e.hasState($o)||e.setState(Wl,!0)},t.prototype.setHighlightBy=function(e,i,n){var a=this;if(n)I(e,function(l){a.setElementHighlight(l,i)});else{var o=rN(this.context.view,$o),s=!0;I(o,function(l){if(!i(l))return s=!1,!1}),s?this.clear():I(e,function(l){i(l)&&(l.hasState($o)&&l.setState($o,!1),l.setState(Wl,!0))})}},t.prototype.setElementState=function(e,i){var n=this.context.view,a=$r(n);this.setHighlightBy(a,function(o){return e===o},i)},t.prototype.highlight=function(){this.setState()},t.prototype.clear=function(){var e=this.context.view;MA(e)},t}(bA),lpt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.setStateByElement=function(e,i){var n=this.context.view,a=e.geometry.getAttribute("color");if(a){var o=n.getScaleByField(a.getFields()[0]),s=Fa(e,o.field),l=$r(n),u=l.filter(function(c){return Fa(c,o.field)===s});this.setHighlightBy(l,function(c){return u.includes(c)},i)}},t}(IA),upt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.setElementHighlight=function(e,i){i(e)?(e.hasState(Wl)&&e.setState(Wl,!1),e.setState($o,!0)):(e.setState(Wl,!0),e.hasState($o)&&e.setState($o,!1))},t.prototype.setStateByElement=function(e,i){var n=this.context.view,a=n.getXScale(),o=Fa(e,a.field),s=$r(n),l=s.filter(function(u){return Fa(u,a.field)===o});this.setHighlightBy(s,function(u){return l.includes(u)},i)},t.prototype.toggle=function(){var e=qs(this.context);if(e){var i=e.hasState(this.stateName);this.setStateByElement(e,!i)}},t}(IA),Za;(function(r){r.BEFORE_HIGHLIGHT="element-range-highlight:beforehighlight",r.AFTER_HIGHLIGHT="element-range-highlight:afterhighlight",r.BEFORE_CLEAR="element-range-highlight:beforeclear",r.AFTER_CLEAR="element-range-highlight:afterclear"})(Za||(Za={}));var s6=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName="active",e}return t.prototype.clearViewState=function(e){MA(e)},t.prototype.highlight=function(){var e=this.context,i=e.view,n=e.event,a=this.getIntersectElements(),o={view:i,event:n,highlightElements:a};i.emit(Za.BEFORE_HIGHLIGHT,$e.fromData(i,Za.BEFORE_HIGHLIGHT,o)),this.setState(),i.emit(Za.AFTER_HIGHLIGHT,$e.fromData(i,Za.AFTER_HIGHLIGHT,o))},t.prototype.clear=function(){var e=this.context.view;e.emit(Za.BEFORE_CLEAR,$e.fromData(e,Za.BEFORE_CLEAR,{})),r.prototype.clear.call(this),e.emit(Za.AFTER_CLEAR,$e.fromData(e,Za.AFTER_CLEAR,{}))},t.prototype.setElementsState=function(e,i,n){o6(n,function(a){return e.indexOf(a)>=0},i)},t}(wA),cpt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName="active",e}return t.prototype.highlight=function(){this.setState()},t.prototype.setElementState=function(e,i){var n=this.context.view,a=$r(n);o6(a,function(o){return e===o},i)},t.prototype.clear=function(){var e=this.context.view;MA(e)},t}(RA),hpt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName="selected",e}return t.prototype.selected=function(){this.setState()},t}(wA),fpt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName="selected",e}return t.prototype.selected=function(){this.setState()},t}(bA),dpt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName="selected",e}return t.prototype.selected=function(){this.setState()},t}(RA),zu=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName="",e.ignoreItemStates=[],e}return t.prototype.getTriggerListInfo=function(){var e=gu(this.context),i=null;return Ld(e)&&(i={item:e.item,list:e.component}),i},t.prototype.getAllowComponents=function(){var e=this,i=this.context.view,n=nN(i),a=[];return I(n,function(o){o.isList()&&e.allowSetStateByElement(o)&&a.push(o)}),a},t.prototype.hasState=function(e,i){return e.hasState(i,this.stateName)},t.prototype.clearAllComponentsState=function(){var e=this,i=this.getAllowComponents();I(i,function(n){n.clearItemsState(e.stateName)})},t.prototype.allowSetStateByElement=function(e){var i=e.get("field");if(!i)return!1;if(this.cfg&&this.cfg.componentNames){var n=e.get("name");if(this.cfg.componentNames.indexOf(n)===-1)return!1}var a=this.context.view,o=oh(a,i);return o&&o.isCategory},t.prototype.allowSetStateByItem=function(e,i){var n=this.ignoreItemStates;if(n.length){var a=n.filter(function(o){return i.hasState(e,o)});return a.length===0}return!0},t.prototype.setStateByElement=function(e,i,n){var a=e.get("field"),o=this.context.view,s=oh(o,a),l=Fa(i,a),u=s.getText(l);this.setItemsState(e,u,n)},t.prototype.setStateEnable=function(e){var i=this,n=qs(this.context);if(n){var a=this.getAllowComponents();I(a,function(u){i.setStateByElement(u,n,e)})}else{var o=gu(this.context);if(Ld(o)){var s=o.item,l=o.component;this.allowSetStateByElement(l)&&this.allowSetStateByItem(s,l)&&this.setItemState(l,s,e)}}},t.prototype.setItemsState=function(e,i,n){var a=this,o=e.getItems();I(o,function(s){s.name===i&&a.setItemState(e,s,n)})},t.prototype.setItemState=function(e,i,n){e.setItemState(i,this.stateName,n)},t.prototype.setState=function(){this.setStateEnable(!0)},t.prototype.reset=function(){this.setStateEnable(!1)},t.prototype.toggle=function(){var e=this.getTriggerListInfo();if(e&&e.item){var i=e.list,n=e.item,a=this.hasState(i,n);this.setItemState(i,n,!a)}},t.prototype.clear=function(){var e=this.getTriggerListInfo();e?e.list.clearItemsState(this.stateName):this.clearAllComponentsState()},t}(De),vpt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName="active",e}return t.prototype.active=function(){this.setState()},t}(zu),CI="inactive",EI="active";function ppt(r){var t=r.getItems();I(t,function(e){r.hasState(e,EI)&&r.setItemState(e,EI,!1),r.hasState(e,CI)&&r.setItemState(e,CI,!1)})}var Ef="inactive",Rl="active",LA=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName=Rl,e.ignoreItemStates=["unchecked"],e}return t.prototype.setItemsState=function(e,i,n){this.setHighlightBy(e,function(a){return a.name===i},n)},t.prototype.setItemState=function(e,i,n){e.getItems(),this.setHighlightBy(e,function(a){return a===i},n)},t.prototype.setHighlightBy=function(e,i,n){var a=e.getItems();if(n)I(a,function(l){i(l)?(e.hasState(l,Ef)&&e.setItemState(l,Ef,!1),e.setItemState(l,Rl,!0)):e.hasState(l,Rl)||e.setItemState(l,Ef,!0)});else{var o=e.getItemsByState(Rl),s=!0;I(o,function(l){if(!i(l))return s=!1,!1}),s?this.clear():I(a,function(l){i(l)&&(e.hasState(l,Rl)&&e.setItemState(l,Rl,!1),e.setItemState(l,Ef,!0))})}},t.prototype.highlight=function(){this.setState()},t.prototype.clear=function(){var e=this.getTriggerListInfo();if(e)ppt(e.list);else{var i=this.getAllowComponents();I(i,function(n){n.clearItemsState(Rl),n.clearItemsState(Ef)})}},t}(zu),gpt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName="selected",e}return t.prototype.selected=function(){this.setState()},t}(zu),mpt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName="unchecked",e}return t.prototype.unchecked=function(){this.setState()},t}(zu),sc="unchecked",fg="checked",ypt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.stateName=fg,e}return t.prototype.setItemState=function(e,i,n){this.setCheckedBy(e,function(a){return a===i},n)},t.prototype.setCheckedBy=function(e,i,n){var a=e.getItems();n&&I(a,function(o){i(o)?(e.hasState(o,sc)&&e.setItemState(o,sc,!1),e.setItemState(o,fg,!0)):e.hasState(o,fg)||e.setItemState(o,sc,!0)})},t.prototype.toggle=function(){var e=this.getTriggerListInfo();if(e&&e.item){var i=e.list,n=e.item,a=!Tv(i.getItems(),function(o){return i.hasState(o,sc)});a||i.hasState(n,sc)?this.setItemState(i,n,!0):this.reset()}},t.prototype.checked=function(){this.setState()},t.prototype.reset=function(){var e=this.getAllowComponents();I(e,function(i){i.clearItemsState(fg),i.clearItemsState(sc)})},t}(zu),lc="unchecked",_pt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.toggle=function(){var e,i,n,a,o,s,l,u,c=this.getTriggerListInfo();if(c!=null&&c.item){var h=c.list,f=c.item,d=h.getItems(),v=d.filter(function(O){return!h.hasState(O,lc)}),p=d.filter(function(O){return h.hasState(O,lc)}),g=v[0];if(d.length===v.length)try{for(var m=Qt(d),y=m.next();!y.done;y=m.next()){var _=y.value;h.setItemState(_,lc,_.id!==f.id)}}catch(O){e={error:O}}finally{try{y&&!y.done&&(i=m.return)&&i.call(m)}finally{if(e)throw e.error}}else if(d.length-p.length===1)if(g.id===f.id)try{for(var x=Qt(d),C=x.next();!C.done;C=x.next()){var _=C.value;h.setItemState(_,lc,!1)}}catch(O){n={error:O}}finally{try{C&&!C.done&&(a=x.return)&&a.call(x)}finally{if(n)throw n.error}}else try{for(var A=Qt(d),b=A.next();!b.done;b=A.next()){var _=b.value;h.setItemState(_,lc,_.id!==f.id)}}catch(O){o={error:O}}finally{try{b&&!b.done&&(s=A.return)&&s.call(A)}finally{if(o)throw o.error}}else try{for(var R=Qt(d),M=R.next();!M.done;M=R.next()){var _=M.value;h.setItemState(_,lc,_.id!==f.id)}}catch(O){l={error:O}}finally{try{M&&!M.done&&(u=R.return)&&u.call(R)}finally{if(l)throw l.error}}}},t}(zu),SI="showRadio",f1="legend-radio-tip",xpt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.timeStamp=0,e}return t.prototype.show=function(){var e=this.getTriggerListInfo();if(e!=null&&e.item){var i=e.list,n=e.item;i.setItemState(n,SI,!0)}},t.prototype.hide=function(){var e=this.getTriggerListInfo();if(e!=null&&e.item){var i=e.list,n=e.item;i.setItemState(n,SI,!1)}},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.tooltip&&this.tooltip.destroy()},t.prototype.showTip=function(){var e=this.context,i=e.event,n=this.timeStamp,a=+new Date,o=this.context.event.target;if(a-n>16&&o.get("name")==="legend-item-radio"){var s=this.location,l={x:i.x,y:i.y};this.timeStamp=a,this.location=l,(!s||!qt(s,l))&&this.showTooltip(l)}},t.prototype.hideTip=function(){this.hideTooltip(),this.location=null},t.prototype.showTooltip=function(e){var i=this.context,n=i.event,a=n.target;if(a&&a.get("tip")){this.tooltip||this.renderTooltip();var o=i.view.getCanvas().get("el").getBoundingClientRect(),s=o.x,l=o.y;this.tooltip.update(S(S({title:a.get("tip")},e),{x:e.x+s,y:e.y+l})),this.tooltip.show()}},t.prototype.hideTooltip=function(){this.tooltip&&this.tooltip.hide()},t.prototype.renderTooltip=function(){var e,i=(e={},e[ss]={padding:"6px 8px",transform:"translate(-50%, -80%)",background:"rgba(0,0,0,0.75)",color:"#fff","border-radius":"2px","z-index":100},e[ls]={"font-size":"12px","line-height":"14px","margin-bottom":0,"word-break":"break-all"},e);document.getElementById(f1)&&document.body.removeChild(document.getElementById(f1));var n=new sy({parent:document.body,region:null,visible:!1,crosshairs:null,domStyles:i,containerId:f1});n.init(),n.setCapture(!1),this.tooltip=n},t}(zu),OA=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.maskShape=null,e.points=[],e.starting=!1,e.moving=!1,e.preMovePoint=null,e.shapeType="path",e}return t.prototype.getCurrentPoint=function(){var e=this.context.event;return{x:e.x,y:e.y}},t.prototype.emitEvent=function(e){var i="mask:".concat(e),n=this.context.view,a=this.context.event;n.emit(i,{target:this.maskShape,shape:this.maskShape,points:this.points,x:a.x,y:a.y})},t.prototype.createMask=function(){var e=this.context.view,i=this.getMaskAttrs(),n=e.foregroundGroup.addShape({type:this.shapeType,name:"mask",draggable:!0,attrs:S({fill:"#C5D4EB",opacity:.3},i)});return n},t.prototype.getMaskPath=function(){return[]},t.prototype.show=function(){this.maskShape&&(this.maskShape.show(),this.emitEvent("show"))},t.prototype.start=function(e){this.starting=!0,this.moving=!1,this.points=[this.getCurrentPoint()],this.maskShape||(this.maskShape=this.createMask(),this.maskShape.set("capture",!1)),this.updateMask(e==null?void 0:e.maskStyle),this.emitEvent("start")},t.prototype.moveStart=function(){this.moving=!0,this.preMovePoint=this.getCurrentPoint()},t.prototype.move=function(){if(!(!this.moving||!this.maskShape)){var e=this.getCurrentPoint(),i=this.preMovePoint,n=e.x-i.x,a=e.y-i.y,o=this.points;I(o,function(s){s.x+=n,s.y+=a}),this.updateMask(),this.emitEvent("change"),this.preMovePoint=e}},t.prototype.updateMask=function(e){var i=at({},this.getMaskAttrs(),e);this.maskShape.attr(i)},t.prototype.moveEnd=function(){this.moving=!1,this.preMovePoint=null},t.prototype.end=function(){this.starting=!1,this.emitEvent("end"),this.maskShape&&this.maskShape.set("capture",!0)},t.prototype.hide=function(){this.maskShape&&(this.maskShape.hide(),this.emitEvent("hide"))},t.prototype.resize=function(){this.starting&&this.maskShape&&(this.points.push(this.getCurrentPoint()),this.updateMask(),this.emitEvent("change"))},t.prototype.destroy=function(){this.points=[],this.maskShape&&this.maskShape.remove(),this.maskShape=null,this.preMovePoint=null,r.prototype.destroy.call(this)},t}(De);function l6(r){var t=cr(r),e=0,i=0,n=0;if(r.length){var a=r[0];e=iA(a,t)/2,i=(t.x+a.x)/2,n=(t.y+a.y)/2}return{x:i,y:n,r:e}}var Cpt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.shapeType="circle",e}return t.prototype.getMaskAttrs=function(){return l6(this.points)},t}(OA);function u6(r){return{start:Ki(r),end:cr(r)}}function c6(r,t){var e=Math.min(r.x,t.x),i=Math.min(r.y,t.y),n=Math.abs(t.x-r.x),a=Math.abs(t.y-r.y);return{x:e,y:i,width:n,height:a}}var h6=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.shapeType="rect",e}return t.prototype.getRegion=function(){return u6(this.points)},t.prototype.getMaskAttrs=function(){var e=this.getRegion(),i=e.start,n=e.end;return c6(i,n)},t}(OA);function AI(r){r.x=Oe(r.x,0,1),r.y=Oe(r.y,0,1)}function f6(r,t,e,i){var n=null,a=null,o=i.invert(Ki(r)),s=i.invert(cr(r));return e&&(AI(o),AI(s)),t==="x"?(n=i.convert({x:o.x,y:0}),a=i.convert({x:s.x,y:1})):(n=i.convert({x:0,y:o.y}),a=i.convert({x:1,y:s.y})),{start:n,end:a}}var d6=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.dim="x",e.inPlot=!0,e}return t.prototype.getRegion=function(){var e=this.context.view.getCoordinate();return f6(this.points,this.dim,this.inPlot,e)},t}(h6);function PA(r){var t=[];return r.length&&(I(r,function(e,i){i===0?t.push(["M",e.x,e.y]):t.push(["L",e.x,e.y])}),t.push(["L",r[0].x,r[0].y])),t}function v6(r){return{path:PA(r)}}var p6=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getMaskPath=function(){return PA(this.points)},t.prototype.getMaskAttrs=function(){return v6(this.points)},t.prototype.addPoint=function(){this.resize()},t}(OA);function FA(r){return Oct(r,!0)}function g6(r){return{path:FA(r)}}var Ept=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getMaskPath=function(){return FA(this.points)},t.prototype.getMaskAttrs=function(){return g6(this.points)},t}(p6),BA=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.maskShapes=[],e.starting=!1,e.moving=!1,e.recordPoints=null,e.preMovePoint=null,e.shapeType="path",e.maskType="multi-mask",e}return t.prototype.getCurrentPoint=function(){var e=this.context.event;return{x:e.x,y:e.y}},t.prototype.emitEvent=function(e){var i="".concat(this.maskType,":").concat(e),n=this.context.view,a=this.context.event,o={type:this.shapeType,name:this.maskType,get:function(s){return o.hasOwnProperty(s)?o[s]:void 0}};n.emit(i,{target:o,maskShapes:this.maskShapes,multiPoints:this.recordPoints,x:a.x,y:a.y})},t.prototype.createMask=function(e){var i=this.context.view,n=this.recordPoints[e],a=this.getMaskAttrs(n),o=i.foregroundGroup.addShape({type:this.shapeType,name:"mask",draggable:!0,attrs:S({fill:"#C5D4EB",opacity:.3},a)});this.maskShapes.push(o)},t.prototype.getMaskPath=function(e){return[]},t.prototype.show=function(){this.maskShapes.length>0&&(this.maskShapes.forEach(function(e){return e.show()}),this.emitEvent("show"))},t.prototype.start=function(e){this.recordPointStart(),this.starting=!0,this.moving=!1;var i=this.recordPoints.length-1;this.createMask(i),this.updateShapesCapture(!1),this.updateMask(e==null?void 0:e.maskStyle),this.emitEvent("start")},t.prototype.moveStart=function(){this.moving=!0,this.preMovePoint=this.getCurrentPoint(),this.updateShapesCapture(!1)},t.prototype.move=function(){if(!(!this.moving||this.maskShapes.length===0)){var e=this.getCurrentPoint(),i=this.preMovePoint,n=e.x-i.x,a=e.y-i.y,o=this.getCurMaskShapeIndex();o>-1&&(this.recordPoints[o].forEach(function(s){s.x+=n,s.y+=a}),this.updateMask(),this.emitEvent("change"),this.preMovePoint=e)}},t.prototype.updateMask=function(e){var i=this;this.recordPoints.forEach(function(n,a){var o=at({},i.getMaskAttrs(n),e);i.maskShapes[a].attr(o)})},t.prototype.resize=function(){this.starting&&this.maskShapes.length>0&&(this.recordPointContinue(),this.updateMask(),this.emitEvent("change"))},t.prototype.moveEnd=function(){this.moving=!1,this.preMovePoint=null,this.updateShapesCapture(!0)},t.prototype.end=function(){this.starting=!1,this.emitEvent("end"),this.updateShapesCapture(!0)},t.prototype.hide=function(){this.maskShapes.length>0&&(this.maskShapes.forEach(function(e){return e.hide()}),this.emitEvent("hide"))},t.prototype.remove=function(){var e=this.getCurMaskShapeIndex();e>-1&&(this.recordPoints.splice(e,1),this.maskShapes[e].remove(),this.maskShapes.splice(e,1),this.preMovePoint=null,this.updateShapesCapture(!0),this.emitEvent("change"))},t.prototype.clearAll=function(){this.recordPointClear(),this.maskShapes.forEach(function(e){return e.remove()}),this.maskShapes=[],this.preMovePoint=null},t.prototype.clear=function(){var e=this.getCurMaskShapeIndex();e===-1?(this.recordPointClear(),this.maskShapes.forEach(function(i){return i.remove()}),this.maskShapes=[],this.emitEvent("clearAll")):(this.recordPoints.splice(e,1),this.maskShapes[e].remove(),this.maskShapes.splice(e,1),this.preMovePoint=null,this.emitEvent("clearSingle")),this.preMovePoint=null},t.prototype.destroy=function(){this.clear(),r.prototype.destroy.call(this)},t.prototype.getRecordPoints=function(){var e;return xt([],ct((e=this.recordPoints)!==null&&e!==void 0?e:[]),!1)},t.prototype.recordPointStart=function(){var e=this.getRecordPoints(),i=this.getCurrentPoint();this.recordPoints=xt(xt([],ct(e),!1),[[i]],!1)},t.prototype.recordPointContinue=function(){var e=this.getRecordPoints(),i=this.getCurrentPoint(),n=e.splice(-1,1)[0]||[];n.push(i),this.recordPoints=xt(xt([],ct(e),!1),[n],!1)},t.prototype.recordPointClear=function(){this.recordPoints=[]},t.prototype.updateShapesCapture=function(e){this.maskShapes.forEach(function(i){return i.set("capture",e)})},t.prototype.getCurMaskShapeIndex=function(){var e=this.getCurrentPoint();return this.maskShapes.findIndex(function(i){var n=i.attrs,a=n.width,o=n.height,s=n.r,l=a===0||o===0||s===0;return!l&&i.isHit(e.x,e.y)})},t}(De),m6=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.shapeType="rect",e}return t.prototype.getRegion=function(e){return u6(e)},t.prototype.getMaskAttrs=function(e){var i=this.getRegion(e),n=i.start,a=i.end;return c6(n,a)},t}(BA),y6=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.dim="x",e.inPlot=!0,e}return t.prototype.getRegion=function(e){var i=this.context.view.getCoordinate();return f6(e,this.dim,this.inPlot,i)},t}(m6),Spt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.shapeType="circle",e.getMaskAttrs=l6,e}return t}(BA),_6=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.getMaskPath=PA,e.getMaskAttrs=v6,e}return t.prototype.addPoint=function(){this.resize()},t}(BA),Apt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.getMaskPath=FA,e.getMaskAttrs=g6,e}return t}(_6),Tpt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.setCursor=function(e){var i=this.context.view;i.getCanvas().setCursor(e)},t.prototype.default=function(){this.setCursor("default")},t.prototype.pointer=function(){this.setCursor("pointer")},t.prototype.move=function(){this.setCursor("move")},t.prototype.crosshair=function(){this.setCursor("crosshair")},t.prototype.wait=function(){this.setCursor("wait")},t.prototype.help=function(){this.setCursor("help")},t.prototype.text=function(){this.setCursor("text")},t.prototype.eResize=function(){this.setCursor("e-resize")},t.prototype.wResize=function(){this.setCursor("w-resize")},t.prototype.nResize=function(){this.setCursor("n-resize")},t.prototype.sResize=function(){this.setCursor("s-resize")},t.prototype.neResize=function(){this.setCursor("ne-resize")},t.prototype.nwResize=function(){this.setCursor("nw-resize")},t.prototype.seResize=function(){this.setCursor("se-resize")},t.prototype.swResize=function(){this.setCursor("sw-resize")},t.prototype.nsResize=function(){this.setCursor("ns-resize")},t.prototype.ewResize=function(){this.setCursor("ew-resize")},t.prototype.zoomIn=function(){this.setCursor("zoom-in")},t.prototype.zoomOut=function(){this.setCursor("zoom-out")},t}(De),bpt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.filterView=function(e,i,n){var a=this;e.getScaleByField(i)&&e.filter(i,n),e.views&&e.views.length&&I(e.views,function(o){a.filterView(o,i,n)})},t.prototype.filter=function(){var e=gu(this.context);if(e){var i=this.context.view,n=e.component,a=n.get("field");if(Ld(e)){if(a){var o=n.getItemsByState("unchecked"),s=oh(i,a),l=o.map(function(d){return d.name});l.length?this.filterView(i,a,function(d){var v=s.getText(d);return!l.includes(v)}):this.filterView(i,a,null),i.render(!0)}}else if(J4(e)){var u=n.getValue(),c=ct(u,2),h=c[0],f=c[1];this.filterView(i,a,function(d){return d>=h&&d<=f}),i.render(!0)}}},t}(De);function TI(r,t,e,i){var n=Math.min(e[t],i[t]),a=Math.max(e[t],i[t]),o=ct(r.range,2),s=o[0],l=o[1];if(n<s&&(n=s),a>l&&(a=l),n===l&&a===l)return null;var u=r.invert(n),c=r.invert(a);if(r.isCategory){var h=r.values.indexOf(u),f=r.values.indexOf(c),d=r.values.slice(h,f+1);return function(v){return d.includes(v)}}else return function(v){return v>=u&&v<=c}}var Di;(function(r){r.FILTER="brush-filter-processing",r.RESET="brush-filter-reset",r.BEFORE_FILTER="brush-filter:beforefilter",r.AFTER_FILTER="brush-filter:afterfilter",r.BEFORE_RESET="brush-filter:beforereset",r.AFTER_RESET="brush-filter:afterreset"})(Di||(Di={}));var gy=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.dims=["x","y"],e.startPoint=null,e.isStarted=!1,e}return t.prototype.hasDim=function(e){return this.dims.includes(e)},t.prototype.start=function(){var e=this.context;this.isStarted=!0,this.startPoint=e.getCurrentPoint()},t.prototype.filter=function(){var e,i;if(Od(this.context)){var n=this.context.event.target,a=n.getCanvasBBox();e={x:a.x,y:a.y},i={x:a.maxX,y:a.maxY}}else{if(!this.isStarted)return;e=this.startPoint,i=this.context.getCurrentPoint()}if(!(Math.abs(e.x-i.x)<5||Math.abs(e.x-i.y)<5)){var o=this.context,s=o.view,l=o.event,u={view:s,event:l,dims:this.dims};s.emit(Di.BEFORE_FILTER,$e.fromData(s,Di.BEFORE_FILTER,u));var c=s.getCoordinate(),h=c.invert(i),f=c.invert(e);if(this.hasDim("x")){var d=s.getXScale(),v=TI(d,"x",h,f);this.filterView(s,d.field,v)}if(this.hasDim("y")){var p=s.getYScales()[0],v=TI(p,"y",h,f);this.filterView(s,p.field,v)}this.reRender(s,{source:Di.FILTER}),s.emit(Di.AFTER_FILTER,$e.fromData(s,Di.AFTER_FILTER,u))}},t.prototype.end=function(){this.isStarted=!1},t.prototype.reset=function(){var e=this.context.view;if(e.emit(Di.BEFORE_RESET,$e.fromData(e,Di.BEFORE_RESET,{})),this.isStarted=!1,this.hasDim("x")){var i=e.getXScale();this.filterView(e,i.field,null)}if(this.hasDim("y")){var n=e.getYScales()[0];this.filterView(e,n.field,null)}this.reRender(e,{source:Di.RESET}),e.emit(Di.AFTER_RESET,$e.fromData(e,Di.AFTER_RESET,{}))},t.prototype.filterView=function(e,i,n){e.filter(i,n)},t.prototype.reRender=function(e,i){e.render(!0,i)},t}(De),DA=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.filterView=function(e,i,n){var a=vo(e);I(a,function(o){o.filter(i,n)})},t.prototype.reRender=function(e){var i=vo(e);I(i,function(n){n.render(!0)})},t}(gy),wpt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.filter=function(){var e=gu(this.context),i=this.context.view,n=$r(i);if(Od(this.context)){var a=rA(this.context,10);a&&I(n,function(p){a.includes(p)?p.show():p.hide()})}else if(e){var o=e.component,s=o.get("field");if(Ld(e)){if(s){var l=o.getItemsByState("unchecked"),u=oh(i,s),c=l.map(function(p){return p.name});I(n,function(p){var g=Fa(p,s),m=u.getText(g);c.indexOf(m)>=0?p.hide():p.show()})}}else if(J4(e)){var h=o.getValue(),f=ct(h,2),d=f[0],v=f[1];I(n,function(p){var g=Fa(p,s);g>=d&&g<=v?p.show():p.hide()})}}},t.prototype.clear=function(){var e=$r(this.context.view);I(e,function(i){i.show()})},t.prototype.reset=function(){this.clear()},t}(De),x6=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.byRecord=!1,e}return t.prototype.filter=function(){Od(this.context)&&(this.byRecord?this.filterByRecord():this.filterByBBox())},t.prototype.filterByRecord=function(){var e=this.context.view,i=rA(this.context,10);if(i){var n=e.getXScale().field,a=e.getYScales()[0].field,o=i.map(function(l){return l.getModel().data}),s=vo(e);I(s,function(l){var u=$r(l);I(u,function(c){var h=c.getModel().data;aN(o,h,n,a)?c.show():c.hide()})})}},t.prototype.filterByBBox=function(){var e=this,i=this.context.view,n=vo(i);I(n,function(a){var o=tN(e.context,a,10),s=$r(a);o&&I(s,function(l){o.includes(l)?l.show():l.hide()})})},t.prototype.reset=function(){var e=vo(this.context.view);I(e,function(i){var n=$r(i);I(n,function(a){a.show()})})},t}(De),Rpt=10,Mpt=5,Ipt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.buttonGroup=null,e.buttonCfg={name:"button",text:"button",textStyle:{x:0,y:0,fontSize:12,fill:"#333333",cursor:"pointer"},padding:[8,10],style:{fill:"#f7f7f7",stroke:"#cccccc",cursor:"pointer"},activeStyle:{fill:"#e6e6e6"}},e}return t.prototype.getButtonCfg=function(){return at(this.buttonCfg,this.cfg)},t.prototype.drawButton=function(){var e=this.getButtonCfg(),i=this.context.view.foregroundGroup.addGroup({name:e.name}),n=i.addShape({type:"text",name:"button-text",attrs:S({text:e.text},e.textStyle)}),a=n.getBBox(),o=aA(e.padding),s=i.addShape({type:"rect",name:"button-rect",attrs:S({x:a.x-o[3],y:a.y-o[0],width:a.width+o[1]+o[3],height:a.height+o[0]+o[2]},e.style)});s.toBack(),i.on("mouseenter",function(){s.attr(e.activeStyle)}),i.on("mouseleave",function(){s.attr(e.style)}),this.buttonGroup=i},t.prototype.resetPosition=function(){var e=this.context.view,i=e.getCoordinate(),n=i.convert({x:1,y:1}),a=this.buttonGroup,o=a.getBBox(),s=dr(null,[["t",n.x-o.width-Rpt,n.y+o.height+Mpt]]);a.setMatrix(s)},t.prototype.show=function(){this.buttonGroup||this.drawButton(),this.resetPosition(),this.buttonGroup.show()},t.prototype.hide=function(){this.buttonGroup&&this.buttonGroup.hide()},t.prototype.destroy=function(){var e=this.buttonGroup;e&&e.remove(),r.prototype.destroy.call(this)},t}(De),Lpt=4,Opt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.starting=!1,e.dragStart=!1,e}return t.prototype.start=function(){this.starting=!0,this.startPoint=this.context.getCurrentPoint()},t.prototype.drag=function(){if(this.startPoint){var e=this.context.getCurrentPoint(),i=this.context.view,n=this.context.event;this.dragStart?i.emit("drag",{target:n.target,x:n.x,y:n.y}):iA(e,this.startPoint)>Lpt&&(i.emit("dragstart",{target:n.target,x:n.x,y:n.y}),this.dragStart=!0)}},t.prototype.end=function(){if(this.dragStart){var e=this.context.view,i=this.context.event;e.emit("dragend",{target:i.target,x:i.x,y:i.y})}this.starting=!1,this.dragStart=!1},t}(De),Ppt=5,Fpt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.starting=!1,e.isMoving=!1,e.startPoint=null,e.startMatrix=null,e}return t.prototype.start=function(){this.starting=!0,this.startPoint=this.context.getCurrentPoint(),this.startMatrix=this.context.view.middleGroup.getMatrix()},t.prototype.move=function(){if(this.starting){var e=this.startPoint,i=this.context.getCurrentPoint(),n=iA(e,i);if(n>Ppt&&!this.isMoving&&(this.isMoving=!0),this.isMoving){var a=this.context.view,o=dr(this.startMatrix,[["t",i.x-e.x,i.y-e.y]]);a.backgroundGroup.setMatrix(o),a.foregroundGroup.setMatrix(o),a.middleGroup.setMatrix(o)}}},t.prototype.end=function(){this.isMoving&&(this.isMoving=!1),this.startMatrix=null,this.starting=!1,this.startPoint=null},t.prototype.reset=function(){this.starting=!1,this.startPoint=null,this.isMoving=!1;var e=this.context.view;e.backgroundGroup.resetMatrix(),e.foregroundGroup.resetMatrix(),e.middleGroup.resetMatrix(),this.isMoving=!1},t}(De),bI="x",wI="y",C6=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.dims=[bI,wI],e.cfgFields=["dims"],e.cacheScaleDefs={},e}return t.prototype.hasDim=function(e){return this.dims.includes(e)},t.prototype.getScale=function(e){var i=this.context.view;return e==="x"?i.getXScale():i.getYScales()[0]},t.prototype.resetDim=function(e){var i=this.context.view;if(this.hasDim(e)&&this.cacheScaleDefs[e]){var n=this.getScale(e);i.scale(n.field,this.cacheScaleDefs[e]),this.cacheScaleDefs[e]=null}},t.prototype.reset=function(){this.resetDim(bI),this.resetDim(wI);var e=this.context.view;e.render(!0)},t}(De),Bpt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.startPoint=null,e.starting=!1,e.startCache={},e}return t.prototype.start=function(){var e=this;this.startPoint=this.context.getCurrentPoint(),this.starting=!0;var i=this.dims;I(i,function(n){var a=e.getScale(n),o=a.min,s=a.max,l=a.values;e.startCache[n]={min:o,max:s,values:l}})},t.prototype.end=function(){this.startPoint=null,this.starting=!1,this.startCache={}},t.prototype.translate=function(){var e=this;if(this.starting){var i=this.startPoint,n=this.context.view.getCoordinate(),a=this.context.getCurrentPoint(),o=n.invert(i),s=n.invert(a),l=s.x-o.x,u=s.y-o.y,c=this.context.view,h=this.dims;I(h,function(f){e.translateDim(f,{x:l*-1,y:u*-1})}),c.render(!0)}},t.prototype.translateDim=function(e,i){if(this.hasDim(e)){var n=this.getScale(e);n.isLinear&&this.translateLinear(e,n,i)}},t.prototype.translateLinear=function(e,i,n){var a=this.context.view,o=this.startCache[e],s=o.min,l=o.max,u=l-s,c=n[e]*u;this.cacheScaleDefs[e]||(this.cacheScaleDefs[e]={nice:i.nice,min:s,max:l}),a.scale(i.field,{nice:!1,min:s+c,max:l+c})},t.prototype.reset=function(){r.prototype.reset.call(this),this.startPoint=null,this.starting=!1},t}(C6),Dpt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.zoomRatio=.05,e}return t.prototype.zoomIn=function(){this.zoom(this.zoomRatio)},t.prototype.zoom=function(e){var i=this,n=this.dims;I(n,function(a){i.zoomDim(a,e)}),this.context.view.render(!0)},t.prototype.zoomOut=function(){this.zoom(-1*this.zoomRatio)},t.prototype.zoomDim=function(e,i){if(this.hasDim(e)){var n=this.getScale(e);n.isLinear&&this.zoomLinear(e,n,i)}},t.prototype.zoomLinear=function(e,i,n){var a=this.context.view;this.cacheScaleDefs[e]||(this.cacheScaleDefs[e]={nice:i.nice,min:i.min,max:i.max});var o=this.cacheScaleDefs[e],s=o.max-o.min,l=i.min,u=i.max,c=n*s,h=l-c,f=u+c,d=f-h,v=d/s;f>h&&v<100&&v>.01&&a.scale(i.field,{nice:!1,min:l-c,max:u+c})},t}(C6);function Npt(r){var t=r.gEvent.originalEvent;return t.deltaY>0}var kpt=1,Upt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.scroll=function(e){var i=this.context,n=i.view,a=i.event;if(n.getOptions().scrollbar){var o=(e==null?void 0:e.wheelDelta)||kpt,s=n.getController("scrollbar"),l=n.getXScale(),u=n.getOptions().data,c=xr(ea(u,l.field)),h=xr(l.values),f=s.getValue(),d=Math.floor((c-h)*f),v=d+(Npt(a)?o:-o),p=o/(c-h)/1e4,g=Oe(v/(c-h)+p,0,1);s.setValue(g)}},t}(De),zpt="aixs-description-tooltip",Hpt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.show=function(){var e=this.context,i=gu(e).axis,n=i.cfg.title,a=n.description,o=n.text,s=n.descriptionTooltipStyle,l=e.event,u=l.x,c=l.y;this.tooltip||this.renderTooltip(),this.tooltip.update({title:o||"",customContent:function(){return`
          <div class="`.concat(ss,'" style={').concat(s,`}>
            <div class="`).concat(ls,`">
              字段说明：`).concat(a,`
            </div>
          </div>
        `)},x:u,y:c}),this.tooltip.show()},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.tooltip&&this.tooltip.destroy()},t.prototype.hide=function(){this.tooltip&&this.tooltip.hide()},t.prototype.renderTooltip=function(){var e,i=this.context.view,n=i.canvas,a={start:{x:0,y:0},end:{x:n.get("width"),y:n.get("height")}},o=new sy({parent:n.get("el").parentNode,region:a,visible:!1,containerId:zpt,domStyles:S({},at({},(e={},e[ss]={"max-width":"50%",padding:"10px","line-height":"15px","font-size":"12px",color:"rgba(0, 0, 0, .65)"},e[ls]={"word-break":"break-all","margin-bottom":"3px"},e)))});o.init(),o.setCapture(!1),this.tooltip=o},t}(De);Gct("dark",sN(Oht));y5("canvas",Aft);y5("svg",idt);wo("Polygon",mdt);wo("Interval",fdt);wo("Schema",ydt);wo("Path",yA);wo("Point",pdt);wo("Line",ddt);wo("Area",adt);wo("Edge",odt);wo("Heatmap",sdt);wo("Violin",xdt);Xv("base",dy);Xv("interval",Ddt);Xv("pie",Ndt);Xv("polar",t6);un("overlap",Kdt);un("distribute",Udt);un("fixed-overlap",qdt);un("hide-overlap",svt);un("limit-in-shape",Xdt);un("limit-in-canvas",Gdt);un("limit-in-plot",Avt);un("pie-outer",Hdt);un("adjust-color",uvt);un("interval-adjust-position",dvt);un("interval-hide-overlap",pvt);un("point-adjust-position",yvt);un("pie-spider",Vdt);un("path-adjust-position",Cvt);On("fade-in",Tvt);On("fade-out",bvt);On("grow-in-x",Rvt);On("grow-in-xy",Ivt);On("grow-in-y",Mvt);On("scale-in-x",Pvt);On("scale-in-y",Fvt);On("wave-in",Dvt);On("zoom-in",Nvt);On("zoom-out",kvt);On("position-update",Ovt);On("sector-path-update",Bvt);On("path-in",Lvt);Ph("rect",Wvt);Ph("mirror",$vt);Ph("list",zvt);Ph("matrix",Hvt);Ph("circle",Uvt);Ph("tree",Vvt);Uu("axis",Yvt);Uu("legend",jvt);Uu("tooltip",fN);Uu("annotation",Xvt);Uu("slider",Zvt);Uu("scrollbar",Qvt);Ct("tooltip",a6);Ct("sibling-tooltip",rpt);Ct("ellipsis-text",ipt);Ct("element-active",npt);Ct("element-single-active",spt);Ct("element-range-active",opt);Ct("element-highlight",IA);Ct("element-highlight-by-x",upt);Ct("element-highlight-by-color",lpt);Ct("element-single-highlight",cpt);Ct("element-range-highlight",s6);Ct("element-sibling-highlight",s6,{effectSiblings:!0,effectByRecord:!0});Ct("element-selected",fpt);Ct("element-single-selected",dpt);Ct("element-range-selected",hpt);Ct("element-link-by-color",apt);Ct("active-region",ept);Ct("list-active",vpt);Ct("list-selected",gpt);Ct("list-highlight",LA);Ct("list-unchecked",mpt);Ct("list-checked",ypt);Ct("list-focus",_pt);Ct("list-radio",xpt);Ct("legend-item-highlight",LA,{componentNames:["legend"]});Ct("axis-label-highlight",LA,{componentNames:["axis"]});Ct("axis-description",Hpt);Ct("rect-mask",h6);Ct("x-rect-mask",d6,{dim:"x"});Ct("y-rect-mask",d6,{dim:"y"});Ct("circle-mask",Cpt);Ct("path-mask",p6);Ct("smooth-path-mask",Ept);Ct("rect-multi-mask",m6);Ct("x-rect-multi-mask",y6,{dim:"x"});Ct("y-rect-multi-mask",y6,{dim:"y"});Ct("circle-multi-mask",Spt);Ct("path-multi-mask",_6);Ct("smooth-path-multi-mask",Apt);Ct("cursor",Tpt);Ct("data-filter",bpt);Ct("brush",gy);Ct("brush-x",gy,{dims:["x"]});Ct("brush-y",gy,{dims:["y"]});Ct("sibling-filter",DA);Ct("sibling-x-filter",DA,{dims:"x"});Ct("sibling-y-filter",DA,{dims:"y"});Ct("element-filter",wpt);Ct("element-sibling-filter",x6);Ct("element-sibling-filter-record",x6,{byRecord:!0});Ct("view-drag",Opt);Ct("view-move",Fpt);Ct("scale-translate",Bpt);Ct("scale-zoom",Dpt);Ct("reset-button",Ipt,{name:"reset-button",text:"reset"});Ct("mousewheel-scroll",Upt);function ts(r){return r.isInPlot()}Pt("tooltip",{start:[{trigger:"plot:mousemove",action:"tooltip:show",throttle:{wait:50,leading:!0,trailing:!1}},{trigger:"plot:touchmove",action:"tooltip:show",throttle:{wait:50,leading:!0,trailing:!1}}],end:[{trigger:"plot:mouseleave",action:"tooltip:hide"},{trigger:"plot:leave",action:"tooltip:hide"},{trigger:"plot:touchend",action:"tooltip:hide"}]});Pt("ellipsis-text",{start:[{trigger:"legend-item-name:mousemove",action:"ellipsis-text:show",throttle:{wait:50,leading:!0,trailing:!1}},{trigger:"legend-item-name:touchstart",action:"ellipsis-text:show",throttle:{wait:50,leading:!0,trailing:!1}},{trigger:"axis-label:mousemove",action:"ellipsis-text:show",throttle:{wait:50,leading:!0,trailing:!1}},{trigger:"axis-label:touchstart",action:"ellipsis-text:show",throttle:{wait:50,leading:!0,trailing:!1}}],end:[{trigger:"legend-item-name:mouseleave",action:"ellipsis-text:hide"},{trigger:"legend-item-name:touchend",action:"ellipsis-text:hide"},{trigger:"axis-label:mouseleave",action:"ellipsis-text:hide"},{trigger:"axis-label:mouseout",action:"ellipsis-text:hide"},{trigger:"axis-label:touchend",action:"ellipsis-text:hide"}]});Pt("element-active",{start:[{trigger:"element:mouseenter",action:"element-active:active"}],end:[{trigger:"element:mouseleave",action:"element-active:reset"}]});Pt("element-selected",{start:[{trigger:"element:click",action:"element-selected:toggle"}]});Pt("element-highlight",{start:[{trigger:"element:mouseenter",action:"element-highlight:highlight"}],end:[{trigger:"element:mouseleave",action:"element-highlight:reset"}]});Pt("element-highlight-by-x",{start:[{trigger:"element:mouseenter",action:"element-highlight-by-x:highlight"}],end:[{trigger:"element:mouseleave",action:"element-highlight-by-x:reset"}]});Pt("element-highlight-by-color",{start:[{trigger:"element:mouseenter",action:"element-highlight-by-color:highlight"}],end:[{trigger:"element:mouseleave",action:"element-highlight-by-color:reset"}]});Pt("legend-active",{start:[{trigger:"legend-item:mouseenter",action:["list-active:active","element-active:active"]}],end:[{trigger:"legend-item:mouseleave",action:["list-active:reset","element-active:reset"]}]});Pt("legend-highlight",{start:[{trigger:"legend-item:mouseenter",action:["legend-item-highlight:highlight","element-highlight:highlight"]}],end:[{trigger:"legend-item:mouseleave",action:["legend-item-highlight:reset","element-highlight:reset"]}]});Pt("axis-label-highlight",{start:[{trigger:"axis-label:mouseenter",action:["axis-label-highlight:highlight","element-highlight:highlight"]}],end:[{trigger:"axis-label:mouseleave",action:["axis-label-highlight:reset","element-highlight:reset"]}]});Pt("element-list-highlight",{start:[{trigger:"element:mouseenter",action:["list-highlight:highlight","element-highlight:highlight"]}],end:[{trigger:"element:mouseleave",action:["list-highlight:reset","element-highlight:reset"]}]});Pt("element-range-highlight",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"mask:mouseenter",action:"cursor:move"},{trigger:"plot:mouseleave",action:"cursor:default"},{trigger:"mask:mouseleave",action:"cursor:crosshair"}],start:[{trigger:"plot:mousedown",isEnable:function(r){return!r.isInShape("mask")},action:["rect-mask:start","rect-mask:show"]},{trigger:"mask:dragstart",action:["rect-mask:moveStart"]}],processing:[{trigger:"plot:mousemove",action:["rect-mask:resize"]},{trigger:"mask:drag",action:["rect-mask:move"]},{trigger:"mask:change",action:["element-range-highlight:highlight"]}],end:[{trigger:"plot:mouseup",action:["rect-mask:end"]},{trigger:"mask:dragend",action:["rect-mask:moveEnd"]},{trigger:"document:mouseup",isEnable:function(r){return!r.isInPlot()},action:["element-range-highlight:clear","rect-mask:end","rect-mask:hide"]}],rollback:[{trigger:"dblclick",action:["element-range-highlight:clear","rect-mask:hide"]}]});Pt("brush",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:ts,action:["brush:start","rect-mask:start","rect-mask:show"]}],processing:[{trigger:"mousemove",isEnable:ts,action:["rect-mask:resize"]}],end:[{trigger:"mouseup",isEnable:ts,action:["brush:filter","brush:end","rect-mask:end","rect-mask:hide","reset-button:show"]}],rollback:[{trigger:"reset-button:click",action:["brush:reset","reset-button:hide","cursor:crosshair"]}]});Pt("brush-visible",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"plot:mousedown",action:["rect-mask:start","rect-mask:show"]}],processing:[{trigger:"plot:mousemove",action:["rect-mask:resize"]},{trigger:"mask:change",action:["element-range-highlight:highlight"]}],end:[{trigger:"plot:mouseup",action:["rect-mask:end","rect-mask:hide","element-filter:filter","element-range-highlight:clear"]}],rollback:[{trigger:"dblclick",action:["element-filter:clear"]}]});Pt("brush-x",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:ts,action:["brush-x:start","x-rect-mask:start","x-rect-mask:show"]}],processing:[{trigger:"mousemove",isEnable:ts,action:["x-rect-mask:resize"]}],end:[{trigger:"mouseup",isEnable:ts,action:["brush-x:filter","brush-x:end","x-rect-mask:end","x-rect-mask:hide"]}],rollback:[{trigger:"dblclick",action:["brush-x:reset"]}]});Pt("element-path-highlight",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:ts,action:"path-mask:start"},{trigger:"mousedown",isEnable:ts,action:"path-mask:show"}],processing:[{trigger:"mousemove",action:"path-mask:addPoint"}],end:[{trigger:"mouseup",action:"path-mask:end"}],rollback:[{trigger:"dblclick",action:"path-mask:hide"}]});Pt("brush-x-multi",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"mask:mouseenter",action:"cursor:move"},{trigger:"plot:mouseleave",action:"cursor:default"},{trigger:"mask:mouseleave",action:"cursor:crosshair"}],start:[{trigger:"mousedown",isEnable:ts,action:["x-rect-multi-mask:start","x-rect-multi-mask:show"]},{trigger:"mask:dragstart",action:["x-rect-multi-mask:moveStart"]}],processing:[{trigger:"mousemove",isEnable:function(r){return!cy(r)},action:["x-rect-multi-mask:resize"]},{trigger:"multi-mask:change",action:"element-range-highlight:highlight"},{trigger:"mask:drag",action:["x-rect-multi-mask:move"]}],end:[{trigger:"mouseup",action:["x-rect-multi-mask:end"]},{trigger:"mask:dragend",action:["x-rect-multi-mask:moveEnd"]}],rollback:[{trigger:"dblclick",action:["x-rect-multi-mask:clear","cursor:crosshair"]},{trigger:"multi-mask:clearAll",action:["element-range-highlight:clear"]},{trigger:"multi-mask:clearSingle",action:["element-range-highlight:highlight"]}]});Pt("element-single-selected",{start:[{trigger:"element:click",action:"element-single-selected:toggle"}]});Pt("legend-filter",{showEnable:[{trigger:"legend-item:mouseenter",action:["cursor:pointer","list-radio:show"]},{trigger:"legend-item:mouseleave",action:["cursor:default","list-radio:hide"]}],start:[{trigger:"legend-item:click",isEnable:function(r){return!r.isInShape("legend-item-radio")},action:["legend-item-highlight:reset","element-highlight:reset","list-unchecked:toggle","data-filter:filter","list-radio:show"]},{trigger:"legend-item-radio:mouseenter",action:["list-radio:showTip"]},{trigger:"legend-item-radio:mouseleave",action:["list-radio:hideTip"]},{trigger:"legend-item-radio:click",action:["list-focus:toggle","data-filter:filter","list-radio:show"]}]});Pt("continuous-filter",{start:[{trigger:"legend:valuechanged",action:"data-filter:filter"}]});Pt("continuous-visible-filter",{start:[{trigger:"legend:valuechanged",action:"element-filter:filter"}]});Pt("legend-visible-filter",{showEnable:[{trigger:"legend-item:mouseenter",action:"cursor:pointer"},{trigger:"legend-item:mouseleave",action:"cursor:default"}],start:[{trigger:"legend-item:click",action:["legend-item-highlight:reset","element-highlight:reset","list-unchecked:toggle","element-filter:filter"]}]});Pt("active-region",{start:[{trigger:"plot:mousemove",action:"active-region:show"}],end:[{trigger:"plot:mouseleave",action:"active-region:hide"}]});Pt("axis-description",{start:[{trigger:"axis-description:mousemove",action:"axis-description:show"}],end:[{trigger:"axis-description:mouseleave",action:"axis-description:hide"}]});function RI(r){return r.gEvent.preventDefault(),r.gEvent.originalEvent.deltaY>0}Pt("view-zoom",{start:[{trigger:"plot:mousewheel",isEnable:function(r){return RI(r.event)},action:"scale-zoom:zoomOut",throttle:{wait:100,leading:!0,trailing:!1}},{trigger:"plot:mousewheel",isEnable:function(r){return!RI(r.event)},action:"scale-zoom:zoomIn",throttle:{wait:100,leading:!0,trailing:!1}}]});Pt("sibling-tooltip",{start:[{trigger:"plot:mousemove",action:"sibling-tooltip:show"}],end:[{trigger:"plot:mouseleave",action:"sibling-tooltip:hide"}]});Pt("plot-mousewheel-scroll",{start:[{trigger:"plot:mousewheel",action:"mousewheel-scroll:scroll"}]});var Xi=["type","alias","tickCount","tickInterval","min","max","nice","minLimit","maxLimit","range","tickMethod","base","exponent","mask","sync"],Ba;(function(r){r.ERROR="error",r.WARN="warn",r.INFO="log"})(Ba||(Ba={}));var $pt="AntV/G2Plot";function Wpt(r){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];var i=0;return"".concat($pt,": ").concat(r.replace(/%s/g,function(){return"".concat(t[i++])}))}function cs(r,t,e){for(var i=[],n=3;n<arguments.length;n++)i[n-3]=arguments[n];t||console[r](Wpt.apply(void 0,xt([e],i,!1)))}function ye(r,t){var e={};return r!==null&&typeof r=="object"&&t.forEach(function(i){var n=r[i];n!==void 0&&(e[i]=n)}),e}function NA(r,t){if(!r)return{};var e=r.filter(function(a){var o=P(a,[t]);return Tt(o)&&!isNaN(o)}),i=e.every(function(a){return P(a,[t])>=0}),n=e.every(function(a){return P(a,[t])<=0});return i?{min:0}:n?{max:0}:{}}function E6(r,t,e,i,n){if(n===void 0&&(n=[]),!Array.isArray(r))return{nodes:[],links:[]};var a=[],o={},s=-1;return r.forEach(function(l){var u=l[t],c=l[e],h=l[i],f=ye(l,n);o[u]||(o[u]=S({id:++s,name:u},f)),o[c]||(o[c]=S({id:++s,name:c},f)),a.push(S({source:o[u].id,target:o[c].id,value:h},f))}),{nodes:Object.values(o).sort(function(l,u){return l.id-u.id}),links:a}}function uh(r,t){var e=Fr(r,function(i){var n=i[t];return n===null||typeof n=="number"&&!isNaN(n)});return cs(Ba.WARN,e.length===r.length,"illegal data existed in chart data."),e}var Vpt=5,Gpt={}.toString,S6=function(r,t){return Gpt.call(r)==="[object "+t+"]"},Xpt=function(r){return S6(r,"Array")},Ypt=function(r){return typeof r=="object"&&r!==null},MI=function(r){if(!Ypt(r)||!S6(r,"Object"))return!1;for(var t=r;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(r)===t},A6=function(r,t,e,i){e=e||0,i=i||Vpt;for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var a=t[n];a?MI(a)?(MI(r[n])||(r[n]={}),e<i?A6(r[n],a,e+1,i):r[n]=t[n]):Xpt(a)?(r[n]=[],r[n]=r[n].concat(a)):r[n]=a:r[n]=a}},W=function(r){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];for(var i=0;i<t.length;i+=1)A6(r,t[i]);return r};function sC(r){if(!r)return{width:0,height:0};var t=getComputedStyle(r);return{width:(r.clientWidth||parseInt(t.width,10))-parseInt(t.paddingLeft,10)-parseInt(t.paddingRight,10),height:(r.clientHeight||parseInt(t.height,10))-parseInt(t.paddingTop,10)-parseInt(t.paddingBottom,10)}}function Rt(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return function(e){return r.reduce(function(i,n){return n(i)},e)}}function ti(r,t){return r.geometries.find(function(e){return e.type===t})}function J0(r){return Qr(r.geometries,function(t,e){return t.concat(e.elements)},[])}function Bd(r){return P(r,["views","length"],0)<=0?J0(r):Qr(r.views,function(t,e){return t.concat(Bd(e))},J0(r))}function jpt(r){return P(r,["views","length"],0)<=0?r.geometries:Qr(r.views,function(t,e){return t.concat(e.geometries)},r.geometries)}function II(r){if(!r)return r;var t=r.match(/(([A-Z]{0,1}[a-z]*[^A-Z])|([A-Z]{1}))/g);return t.map(function(e){return e.toLowerCase()}).join("-")}function Lr(r){if(!ua(r,"Object"))return r;var t=S({},r);return t.formatter&&!t.content&&(t.content=t.formatter),t}var d1;function Zpt(){return d1||(d1=document.createElement("canvas").getContext("2d")),d1}Nu(function(r,t){t===void 0&&(t={});var e=t.fontSize,i=t.fontFamily,n=i===void 0?"sans-serif":i,a=t.fontWeight,o=t.fontStyle,s=t.fontVariant,l=Zpt();l.font=[o,a,s,"".concat(e,"px"),n].join(" ");var u=l.measureText(mt(r)?r:"");return u.width},function(r,t){return t===void 0&&(t={}),xt([r],wh(t),!0).join("")});function yu(r){return typeof r=="number"&&!isNaN(r)}function qpt(r,t,e){var i=Math.min(t,e),n=Math.max(t,e);return r>=i&&r<=n}function Qs(r){if(Tt(r))return[r,r,r,r];if(q(r)){var t=r.length;if(t===1)return[r[0],r[0],r[0],r[0]];if(t===2)return[r[0],r[1],r[0],r[1]];if(t===3)return[r[0],r[1],r[2],r[1]];if(t===4)return r}return[0,0,0,0]}function yy(r,t,e){t===void 0&&(t="bottom"),e===void 0&&(e=25);var i=Qs(r),n=[t.startsWith("top")?e:0,t.startsWith("right")?e:0,t.startsWith("bottom")?e:0,t.startsWith("left")?e:0];return[i[0]+n[0],i[1]+n[1],i[2]+n[2],i[3]+n[3]]}function kA(r){var t=r.map(function(i){return Qs(i)}),e=[0,0,0,0];return t.length>0&&(e=e.map(function(i,n){return t.forEach(function(a,o){i+=t[o][n]}),i})),e}function Kpt(r,t){var e=[];if(r.length){e.push(["M",r[0].x,r[0].y]);for(var i=1,n=r.length;i<n;i+=1){var a=r[i];e.push(["L",a.x,a.y])}t&&e.push(["Z"])}return e}var Qpt=function(r,t,e,i){var n=[],a,o,s=!!i,l,u;if(s){l=[1/0,1/0],u=[-1/0,-1/0];for(var c=0,h=r.length;c<h;c++){var f=r[c];l=kr([0,0],l,f),u=Ur([0,0],u,f)}l=kr([0,0],l,i[0]),u=Ur([0,0],u,i[1])}for(var c=0,d=r.length;c<d;c++){var f=r[c];if(e)a=r[c?c-1:d-1],o=r[(c+1)%d];else if(c===0||c===d-1){n.push(f);continue}else a=r[c-1],o=r[c+1];var v=[0,0];v=Ko(v,o,a),v=Ai(v,v,t);var p=Yc(f,a),g=Yc(f,o),m=p+g;m!==0&&(p/=m,g/=m);var y=Ai([0,0],v,-p),_=Ai([0,0],v,g),x=si([0,0],f,y),C=si([0,0],f,_);s&&(x=Ur([0,0],x,l),x=kr([0,0],x,u),C=Ur([0,0],C,l),C=kr([0,0],C,u)),n.push(x),n.push(C)}return e&&n.push(n.shift()),n};function Jpt(r,t,e){for(var i=!!t,n=[],a=0,o=r.length;a<o;a+=2)n.push([r[a],r[a+1]]);for(var s=Qpt(n,.4,i,e),l=n.length,u=[],c,h,f,a=0;a<l-1;a++)c=s[a*2],h=s[a*2+1],f=n[a+1],u.push(["C",c[0],c[1],h[0],h[1],f[0],f[1]]);return i&&(c=s[l],h=s[l+1],f=n[0],u.push(["C",c[0],c[1],h[0],h[1],f[0],f[1]])),u}function tgt(r,t,e){var i=[],n=r[0],a=null;if(r.length<=2)return Kpt(r,t);for(var o=0,s=r.length;o<s;o++){var l=r[o];(!a||!(a.x===l.x&&a.y===l.y))&&(i.push(l.x),i.push(l.y),a=l)}var u=e||[[0,0],[1,1]],c=Jpt(i,t,u);return c.unshift(["M",n.x,n.y]),c}function T6(r){var t={overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis",display:"flex",justifyContent:"center",alignItems:"center"},e=["stroke","lineWidth","shadowColor","strokeOpacity","shadowBlur","shadowOffsetX","shadowOffsetY","fill"];P(r,"fill")&&(t.color=r.fill);var i=ye(r,e),n=i.shadowColor,a=i.shadowBlur,o=a===void 0?0:a,s=i.shadowOffsetX,l=s===void 0?0:s,u=i.shadowOffsetY,c=u===void 0?0:u;t["text-shadow"]="".concat([n,"".concat(l,"px"),"".concat(c,"px"),"".concat(o,"px")].join(" "));var h=ye(r,e),f=h.stroke,d=h.lineWidth,v=d===void 0?0:d;return t["-webkit-text-stroke"]="".concat(["".concat(v,"px"),f].join(" ")),I(r,function(p,g){["fontSize"].includes(g)&&Tt(p)?t[II(g)]="".concat(p,"px"):g&&!e.includes(g)&&(t[II(g)]="".concat(p))}),t}function b6(r,t){r.style["pointer-events"]="none",I(t,function(e,i){i&&e&&(r.style[i]=e)})}var _y=function(r,t,e){var i=t.statistic,n=t.plotType,a=i.title,o=i.content;[a,o].forEach(function(s,l){if(s){var u="";l===0?u=o?"translate(-50%, -100%)":"translate(-50%, -50%)":u=a?"translate(-50%, 0)":"translate(-50%, -50%)";var c=ot(s.style)?s.style(e):s.style;r.annotation().html(S({position:["50%","50%"],html:function(h,f){var d=f.getCoordinate(),v=0;if(n==="pie"||n==="ring-progress")v=d.getRadius()*d.innerRadius*2;else if(n==="liquid"){var p=P(f.geometries,[0,"elements",0,"shape"]);if(p){var g=p.find(function(x){return x.get("name")==="wrap"}),m=g.getCanvasBBox().width;v=m}}else v||(v=d.getWidth());b6(h,S({width:"".concat(v,"px"),transform:u},T6(c)));var y=f.getData();if(s.customHtml)return s.customHtml(h,f,e,y);var _=s.content;return s.formatter&&(_=s.formatter(e,y)),_?mt(_)?_:"".concat(_):"<div></div>"},key:"".concat(l===0?"top":"bottom","-statistic")},ye(s,["offsetX","offsetY","rotate","style","formatter"])))}})},egt=function(r,t,e){var i=t.statistic,n=i.title,a=i.content;[n,a].forEach(function(o){if(o){var s=ot(o.style)?o.style(e):o.style;r.annotation().html(S({position:["50%","100%"],html:function(l,u){var c=u.getCoordinate(),h=u.views[0].getCoordinate(),f=h.getCenter(),d=h.getRadius(),v=Math.max(Math.sin(h.startAngle),Math.sin(h.endAngle))*d,p=f.y+v-c.y.start-parseFloat(P(s,"fontSize",0)),g=c.getRadius()*c.innerRadius*2;b6(l,S({width:"".concat(g,"px"),transform:"translate(-50%, ".concat(p,"px)")},T6(s)));var m=u.getData();if(o.customHtml)return o.customHtml(l,u,e,m);var y=o.content;return o.formatter&&(y=o.formatter(e,m)),y?mt(y)?y:"".concat(y):"<div></div>"}},ye(o,["offsetX","offsetY","rotate","style","formatter"])))}})};function w6(r,t){return t?Qr(t,function(e,i,n){return e.replace(new RegExp("{\\s*".concat(n,"\\s*}"),"g"),i)},r):r}function Ht(r,t){return r.views.find(function(e){return e.id===t})}function Uf(r){var t=r.parent;return t?t.views:[]}function LI(r){return Uf(r).filter(function(t){return t!==r})}function Zv(r,t,e){e===void 0&&(e=r.geometries),typeof t=="boolean"?r.animate(t):r.animate(!0),I(e,function(i){var n;ot(t)?n=t(i.type||i.shapeType,i)||!0:n=t,i.animate(n)})}function xy(){return typeof window=="object"?window==null?void 0:window.devicePixelRatio:2}function UA(r,t){t===void 0&&(t=r);var e=document.createElement("canvas"),i=xy();e.width=r*i,e.height=t*i,e.style.width="".concat(r,"px"),e.style.height="".concat(t,"px");var n=e.getContext("2d");return n.scale(i,i),e}function zA(r,t,e,i){i===void 0&&(i=e);var n=t.backgroundColor,a=t.opacity;r.globalAlpha=a,r.fillStyle=n,r.beginPath(),r.fillRect(0,0,e,i),r.closePath()}function R6(r,t,e){var i=r+t;return e?i*2:i}function M6(r,t){var e=t?[[r*.25,r*.25],[r*.75,r*.75]]:[[r*.5,r*.5]];return e}function HA(r,t){var e=t*Math.PI/180,i={a:Math.cos(e)*(1/r),b:Math.sin(e)*(1/r),c:-Math.sin(e)*(1/r),d:Math.cos(e)*(1/r),e:0,f:0};return i}var rgt={size:6,padding:2,backgroundColor:"transparent",opacity:1,rotation:0,fill:"#fff",fillOpacity:.5,stroke:"transparent",lineWidth:0,isStagger:!0};function igt(r,t,e,i){var n=t.size,a=t.fill,o=t.lineWidth,s=t.stroke,l=t.fillOpacity;r.beginPath(),r.globalAlpha=l,r.fillStyle=a,r.strokeStyle=s,r.lineWidth=o,r.arc(e,i,n/2,0,2*Math.PI,!1),r.fill(),o&&r.stroke(),r.closePath()}function ngt(r){var t=W({},rgt,r),e=t.size,i=t.padding,n=t.isStagger,a=t.rotation,o=R6(e,i,n),s=M6(o,n),l=UA(o,o),u=l.getContext("2d");zA(u,t,o);for(var c=0,h=s;c<h.length;c++){var f=h[c],d=f[0],v=f[1];igt(u,t,d,v)}var p=u.createPattern(l,"repeat");if(p){var g=xy(),m=HA(g,a);p.setTransform(m)}return p}var agt={rotation:45,spacing:5,opacity:1,backgroundColor:"transparent",strokeOpacity:.5,stroke:"#fff",lineWidth:2};function ogt(r,t,e){var i=t.stroke,n=t.lineWidth,a=t.strokeOpacity,o=new Path2D(e);r.globalAlpha=a,r.lineCap="square",r.strokeStyle=n?i:"transparent",r.lineWidth=n,r.stroke(o)}function sgt(r){var t=W({},agt,r),e=t.spacing,i=t.rotation,n=t.lineWidth,a=e+n||1,o=e+n||1,s=`
            M 0 0 L `.concat(a,` 0
            M 0 `).concat(o," L ").concat(a," ").concat(o,`
            `),l=UA(a,o),u=l.getContext("2d");zA(u,t,a,o),ogt(u,t,s);var c=u.createPattern(l,"repeat");if(c){var h=xy(),f=HA(h,i);c.setTransform(f)}return c}var lgt={size:6,padding:1,isStagger:!0,backgroundColor:"transparent",opacity:1,rotation:0,fill:"#fff",fillOpacity:.5,stroke:"transparent",lineWidth:0};function ugt(r,t,e,i){var n=t.stroke,a=t.size,o=t.fill,s=t.lineWidth,l=t.fillOpacity;r.globalAlpha=l,r.strokeStyle=n,r.lineWidth=s,r.fillStyle=o,r.strokeRect(e-a/2,i-a/2,a,a),r.fillRect(e-a/2,i-a/2,a,a)}function cgt(r){var t=W({},lgt,r),e=t.size,i=t.padding,n=t.isStagger,a=t.rotation,o=R6(e,i,n),s=M6(o,n),l=UA(o,o),u=l.getContext("2d");zA(u,t,o);for(var c=0,h=s;c<h.length;c++){var f=h[c],d=f[0],v=f[1];ugt(u,t,d,v)}var p=u.createPattern(l,"repeat");if(p){var g=xy(),m=HA(g,a);p.setTransform(m)}return p}function hgt(r){var t=r.type,e=r.cfg,i;switch(t){case"dot":i=ngt(e);break;case"line":i=sgt(e);break;case"square":i=cgt(e);break}return i}function Pn(r){var t=this;return function(e){var i,n=e.options,a=e.chart,o=n.pattern;if(!o)return e;var s=function(l){for(var u,c,h,f=[],d=1;d<arguments.length;d++)f[d-1]=arguments[d];var v=a.getTheme().defaultColor,p=v,g=(c=(u=a.geometries)===null||u===void 0?void 0:u[0])===null||c===void 0?void 0:c.getAttribute("color");if(g){var m=g.getFields()[0],y=P(l,m);p=nn.getMappingValue(g,y,((h=g.values)===null||h===void 0?void 0:h[0])||v)}var _=o;typeof o=="function"&&(_=o.call(t,l,p)),_ instanceof CanvasPattern||(_=hgt(W({},{cfg:{backgroundColor:p}},_)));var x=n[r];return S(S({},typeof x=="function"?x.call.apply(x,xt([t,l],f,!1)):x||{}),{fill:_||p})};return W({},e,{options:(i={},i[r]=s,i)})}}function Bh(r){var t=r.chart,e=r.options,i=e.legend,n=e.colorField,a=e.seriesField;return i===!1?t.legend(!1):(n||a)&&t.legend(n||a,i),r}function Cr(r){var t=r.chart,e=r.options,i=e.tooltip;return i!==void 0&&t.tooltip(i),r}function ze(r){var t=r.chart,e=r.options,i=e.interactions;return I(i,function(n){n.enable===!1?t.removeInteraction(n.type):t.interaction(n.type,n.cfg||{})}),r}function Ce(r){var t=r.chart,e=r.options,i=e.animation;return Zv(t,i),r}function se(r){var t=r.chart,e=r.options,i=e.theme;return i&&t.theme(i),r}function pl(r){var t=r.chart,e=r.options,i=e.state;return i&&I(t.geometries,function(n){n.state(i)}),r}function qv(r){var t=r.chart,e=r.options,i=e.slider;return t.option("slider",i),r}function $A(r){var t=r.chart,e=r.options,i=e.scrollbar;return t.option("scrollbar",i),r}function Je(r,t){return function(e){var i=e.chart,n=e.options,a={};return I(r,function(o,s){a[s]=ye(o,Xi)}),a=W({},t,n.meta,a),i.scale(a),e}}function We(r){return function(t){var e=t.chart,i=t.options,n=e.getController("annotation");return I(xt(xt([],i.annotations||[],!0),r||[],!0),function(a){n.annotation(a)}),t}}function _u(r){var t=r.chart,e=r.options,i=e.yAxis,n=e.limitInPlot,a=n;return ie(i)&&K(n)&&(Object.values(ye(i,["min","max","minLimit","maxLimit"])).some(function(o){return!K(o)})?a=!0:a=!1),t.limitInPlot=a,r}function I6(r){return r===void 0&&(r="rect"),function(t){var e=t.chart,i=t.options,n=i.coordinate,a=Array.from(n||[]).map(function(o){return o.type==="reflectX"?["reflect","x"]:o.type==="reflectY"?["reflect","y"]:o.type==="transpose"?["transpose"]:null}).filter(function(o){return!!o});return a.length!==0&&e.coordinate({type:r,actions:a}),t}}var fgt={locale:"en-US"},Jg={};function L6(r,t){Jg[r]=t}function Cy(r){return{get:function(t,e){return w6(P(Jg[r],t)||P(Jg[fgt.locale],t)||P(Jg["en-US"],t)||t,e)}}}var dgt={locale:"en-US",general:{increase:"Increase",decrease:"Decrease",root:"Root"},statistic:{total:"Total"},conversionTag:{label:"Rate"},legend:{},tooltip:{},slider:{},scrollbar:{},waterfall:{total:"Total"}},vgt={locale:"zh-CN",general:{increase:"增加",decrease:"减少",root:"初始"},statistic:{total:"总计"},conversionTag:{label:"转化率"},legend:{},tooltip:{},slider:{},scrollbar:{},waterfall:{total:"总计"}};function ha(r,t){if(r===!1)return{fields:!1};var e=P(r,"fields"),i=P(r,"formatter");return i&&!e&&(e=t),{fields:e,formatter:i}}function dg(r,t){var e=r.type,i=r.xField,n=r.yField,a=r.colorField,o=r.shapeField,s=r.sizeField,l=r.styleField,u=r.rawFields,c=[];if(u=(ot(u)?u(e,t):u)||[],t==="color")c=xt([a||i],u,!0);else if(t==="shape")c=xt([o||i],u,!0);else if(t==="size")c=xt([s||i],u,!0);else{c=xt([i,n,a,o,s,l],u,!0);var h=["x","y","color","shape","size","style"].indexOf(t),f=c[h];c.splice(h,1),c.unshift(f)}var d=as(c.filter(function(p){return!!p})),v=e==="line"&&[i,n].includes(d.join("*"))?"":d.join("*");return{mappingFields:d,tileMappingField:v}}function dc(r,t){if(t)return function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n={};return r.forEach(function(a,o){n[a]=e[o]}),delete n.undefined,t(n)}}function cn(r){var t=r.chart,e=r.options,i=e.type,n=e.args,a=e.mapping,o=e.xField,s=e.yField,l=e.colorField,u=e.shapeField,c=e.sizeField,h=e.tooltipFields,f=e.label,d=e.state,v=e.customInfo,p=e.customMappingField;if(!a)return r;var g=a.color,m=a.shape,y=a.size,_=a.style,x=a.tooltip,C=t[i](n).position("".concat(o,"*").concat(s));if(mt(g))l?C.color(l,g):C.color(g);else if(ot(g)){var A=dg(e,"color"),b=A.mappingFields,R=A.tileMappingField;C.color(p||R,dc(b,g))}else l&&C.color(l,g);if(mt(m))u?C.shape(u,[m]):C.shape(m);else if(ot(m)){var M=dg(e,"shape"),b=M.mappingFields,R=M.tileMappingField;C.shape(R,dc(b,m))}else u&&C.shape(u,m);if(Tt(y))c?C.size(c,y):C.size(y);else if(ot(y)){var O=dg(e,"size"),b=O.mappingFields,R=O.tileMappingField;C.size(R,dc(b,y))}else c&&C.size(c,y);if(ot(_)){var F=dg(e,"style"),b=F.mappingFields,R=F.tileMappingField;C.style(R,dc(b,_))}else ie(_)&&C.style(_);if(h===!1?C.tooltip(!1):Mi(h)||C.tooltip(h.join("*"),dc(h,x)),f===!1)C.label(!1);else if(f){var D=f.callback,H=f.fields,j=zt(f,["callback","fields"]);C.label({fields:H||[s],callback:D,cfg:Lr(j)})}return d&&C.state(d),v&&C.customInfo(v),[o,s].filter(function($){return $!==l}).forEach(function($){t.legend($,!1)}),S(S({},r),{ext:{geometry:C}})}function Ey(r){var t=r.options,e=t.area,i=t.xField,n=t.yField,a=t.seriesField,o=t.smooth,s=t.tooltip,l=t.useDeferredLabel,u=ha(s,[i,n,a]),c=u.fields,h=u.formatter;return e?cn(W({},r,{options:{type:"area",colorField:a,tooltipFields:c,mapping:at({shape:o?"smooth":"area",tooltip:h},e),args:{useDeferredLabel:l}}})):r}function O6(r){var t=r.options,e=t.edge,i=t.xField,n=t.yField,a=t.seriesField,o=t.tooltip,s=t.useDeferredLabel,l=ha(o,[i,n,a]),u=l.fields,c=l.formatter;return e?cn(W({},r,{options:{type:"edge",colorField:a,tooltipFields:u,mapping:S({tooltip:c},e),args:{useDeferredLabel:s}}})):r}function pgt(r){var t=r.chart,e=r.options,i=r.ext,n=e.seriesField,a=e.isGroup,o=e.isStack,s=e.marginRatio,l=e.widthRatio,u=e.groupField,c=e.theme,h=[];if(n&&(a&&h.push({type:"dodge",dodgeBy:u||n,marginRatio:s}),o&&h.push({type:"stack",marginRatio:s})),h.length&&(i!=null&&i.geometry)){var f=i==null?void 0:i.geometry;f.adjust(h)}return K(l)||t.theme(W({},ie(c)?c:rd(c),{columnWidthRatio:l})),r}function ei(r){var t=r.options,e=t.xField,i=t.yField,n=t.interval,a=t.seriesField,o=t.tooltip,s=t.minColumnWidth,l=t.maxColumnWidth,u=t.columnBackground,c=t.dodgePadding,h=t.intervalPadding,f=t.useDeferredLabel,d=ha(o,[e,i,a]),v=d.fields,p=d.formatter,g=(n?cn(W({},r,{options:{type:"interval",colorField:a,tooltipFields:v,mapping:S({tooltip:p},n),args:{dodgePadding:c,intervalPadding:h,minColumnWidth:s,maxColumnWidth:l,background:u,useDeferredLabel:f}}})):r).ext;return pgt(S(S({},r),{ext:g}))}function Dh(r){var t=r.options,e=t.line,i=t.stepType,n=t.xField,a=t.yField,o=t.seriesField,s=t.smooth,l=t.connectNulls,u=t.tooltip,c=t.useDeferredLabel,h=ha(u,[n,a,o]),f=h.fields,d=h.formatter;return e?cn(W({},r,{options:{type:"line",colorField:o,tooltipFields:f,mapping:at({shape:i||(s?"smooth":"line"),tooltip:d},e),args:{connectNulls:l,useDeferredLabel:c}}})):r}function Fn(r){var t=r.options,e=t.point,i=t.xField,n=t.yField,a=t.seriesField,o=t.sizeField,s=t.shapeField,l=t.tooltip,u=t.useDeferredLabel,c=ha(l,[i,n,a,o,s]),h=c.fields,f=c.formatter;return e?cn(W({},r,{options:{type:"point",colorField:a,shapeField:s,tooltipFields:h,mapping:S({tooltip:f},e),args:{useDeferredLabel:u}}})):r}function Sy(r){var t=r.options,e=t.polygon,i=t.xField,n=t.yField,a=t.seriesField,o=t.tooltip,s=t.useDeferredLabel,l=ha(o,[i,n,a]),u=l.fields,c=l.formatter;return e?cn(W({},r,{options:{type:"polygon",colorField:a,tooltipFields:u,mapping:S({tooltip:c},e),args:{useDeferredLabel:s}}})):r}function WA(r){var t=r.options,e=t.schema,i=t.xField,n=t.yField,a=t.seriesField,o=t.tooltip,s=t.useDeferredLabel,l=ha(o,[i,n,a]),u=l.fields,c=l.formatter;return e?cn(W({},r,{options:{type:"schema",colorField:a,tooltipFields:u,mapping:S({tooltip:c},e),args:{useDeferredLabel:s}}})):r}function ggt(r){var t=r.options,e=t.violin,i=t.xField,n=t.yField,a=t.seriesField,o=t.sizeField,s=t.tooltip,l=ha(s,[i,n,a,o]),u=l.fields,c=l.formatter;return e?cn(W({},r,{options:{type:"violin",colorField:a,tooltipFields:u,mapping:S({tooltip:c},e)}})):r}var OI="data-chart-source-type",P6=["padding","appendPadding","renderer","pixelRatio","syncViewPadding","supportCSSTransform","limitInPlot"],Bt=function(r){N(t,r);function t(e,i){var n=r.call(this)||this;return n.container=typeof e=="string"?document.getElementById(e):e,n.options=W({},n.getDefaultOptions(),i),n.createG2(),n.bindEvents(),n}return t.getDefaultOptions=function(){return{renderer:"canvas",xAxis:{nice:!0,label:{autoRotate:!1,autoHide:{type:"equidistance",cfg:{minGap:6}}}},yAxis:{nice:!0,label:{autoHide:!0,autoRotate:!1}},animation:!0}},t.prototype.createG2=function(){var e=this.options,i=e.width,n=e.height,a=e.defaultInteractions;this.chart=new sht(S(S(S(S({container:this.container,autoFit:!1},this.getChartSize(i,n)),{localRefresh:!1}),ye(this.options,P6)),{defaultInteractions:a})),this.container.setAttribute(OI,"G2Plot")},t.prototype.getChartSize=function(e,i){var n=sC(this.container);return{width:e||n.width||400,height:i||n.height||400}},t.prototype.bindEvents=function(){var e=this;this.chart&&this.chart.on("*",function(i){i!=null&&i.type&&e.emit(i.type,i)})},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.render=function(){this.chart.clear(),this.chart.options={data:[],animate:!0},this.chart.views=[],this.execAdaptor(),this.chart.render(),this.bindSizeSensor()},t.prototype.update=function(e){this.updateOption(e),this.render()},t.prototype.updateOption=function(e){this.options=W({},this.options,e)},t.prototype.setState=function(e,i,n){n===void 0&&(n=!0);var a=Bd(this.chart);I(a,function(o){i(o.getData())&&o.setState(e,n)})},t.prototype.getStates=function(){var e=Bd(this.chart),i=[];return I(e,function(n){var a=n.getData(),o=n.getStates();I(o,function(s){i.push({data:a,state:s,geometry:n.geometry,element:n})})}),i},t.prototype.changeData=function(e){this.update({data:e})},t.prototype.changeSize=function(e,i){this.chart.changeSize(e,i)},t.prototype.addAnnotations=function(e,i){i=i||this.chart;var n=xt([],e,!0),a=i.getController("annotation"),o=a.getComponents().map(function(u){return u.extra});a.clear(!0);for(var s=function(u){var c=o[u],h=n.findIndex(function(f){return f.id&&f.id===c.id});h!==-1&&(c=W({},c,n[h]),n.splice(h,1)),a.annotation(c)},l=0;l<o.length;l++)s(l);n.forEach(function(u){return a.annotation(u)}),i.render(!0)},t.prototype.removeAnnotations=function(e){var i=this.chart.getController("annotation"),n=i.getComponents().map(function(s){return s.extra});i.clear(!0);for(var a=function(s){var l=n[s];e.find(function(u){return u.id&&u.id===l.id})||i.annotation(l)},o=0;o<n.length;o++)a(o);this.chart.render(!0)},t.prototype.destroy=function(){this.unbindSizeSensor(),this.chart.destroy(),this.off(),this.container.removeAttribute(OI)},t.prototype.execAdaptor=function(){var e=this.getSchemaAdaptor(),i=this.options,n=i.padding,a=i.appendPadding;this.chart.padding=n,this.chart.appendPadding=a,e({chart:this.chart,options:this.options})},t.prototype.triggerResize=function(){this.chart.forceFit()},t.prototype.bindSizeSensor=function(){var e=this;if(!this.unbind){var i=this.options.autoFit,n=i===void 0?!0:i;n&&(this.unbind=K$(this.container,function(){var a=sC(e.container),o=a.width,s=a.height;(o!==e.chart.width||s!==e.chart.height)&&e.triggerResize()}))}},t.prototype.unbindSizeSensor=function(){this.unbind&&(this.unbind(),this.unbind=void 0)},t}(ku);function F6(r,t,e,i){var n=Qr(r,function(a,o){var s=o[e],l=a.has(s)?a.get(s):0,u=o[t];return l=yu(u)?l+u:l,a.set(s,l),a},new Map);return Ne(r,function(a){var o,s=a[t],l=a[e],u=yu(s)&&n.get(l)!==0?s/n.get(l):0;return S(S({},a),(o={},o[i]=u,o))})}function mgt(r,t,e,i){var n=Qr(r,function(a,o){var s=Qr(e,function(c,h){return"".concat(c).concat(o[h])},""),l=a.has(s)?a.get(s):0,u=o[t];return l=yu(u)?l+u:l,a.set(s,l),a},new Map);return Ne(r,function(a){var o,s=a[t],l=Qr(e,function(c,h){return"".concat(c).concat(a[h])},""),u=yu(s)&&n.get(l)!==0?s/n.get(l):0;return S(S({},a),(o={},o[i]=u,o))})}function Kv(r,t,e,i,n){return n?F6(r,t,e,i):r}function ygt(r){var t=r.chart,e=r.options,i=e.data,n=e.color,a=e.lineStyle,o=e.lineShape,s=e.point,l=e.area,u=e.seriesField,c=s==null?void 0:s.state,h=l==null?void 0:l.state;t.data(i);var f=W({},r,{options:{shapeField:u,line:{color:n,style:a,shape:o},point:s&&S({color:n,shape:"circle"},s),area:l&&S({color:n},l),label:void 0}}),d=W({},f,{options:{tooltip:!1,state:c}}),v=W({},f,{options:{tooltip:!1,state:h}});return Dh(f),Fn(d),Ey(v),r}function Ay(r){var t,e,i=r.options,n=i.xAxis,a=i.yAxis,o=i.xField,s=i.yField,l=i.data;return Rt(Je((t={},t[o]=n,t[s]=a,t),(e={},e[o]={type:"cat"},e[s]=NA(l,s),e)))(r)}function _gt(r){var t=r.chart,e=r.options,i=e.reflect;if(i){var n=i;q(n)||(n=[n]);var a=n.map(function(o){return["reflect",o]});t.coordinate({type:"rect",actions:a})}return r}function B6(r){var t=r.chart,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField,o=e.yField;return i===!1?t.axis(a,!1):t.axis(a,i),n===!1?t.axis(o,!1):t.axis(o,n),r}function D6(r){var t=r.chart,e=r.options,i=e.legend,n=e.seriesField;return i&&n?t.legend(n,i):i===!1&&t.legend(!1),r}function xgt(r){var t=r.chart,e=r.options,i=e.label,n=e.yField,a=ti(t,"line");if(!i)a.label(!1);else{var o=i.fields,s=i.callback,l=zt(i,["fields","callback"]);a.label({fields:o||[n],callback:s,cfg:S({layout:[{type:"limit-in-plot"},{type:"path-adjust-position"},{type:"point-adjust-position"},{type:"limit-in-plot",cfg:{action:"hide"}}]},Lr(l))})}return r}function Cgt(r){var t=r.chart,e=r.options,i=e.isStack;return i&&I(t.geometries,function(n){n.adjust("stack")}),r}function N6(r){return Rt(ygt,Ay,Cgt,se,_gt,B6,D6,Cr,xgt,qv,$A,ze,Ce,We(),_u)(r)}function Egt(r){var t=r.chart,e=r.options,i=e.data,n=e.areaStyle,a=e.areaShape,o=e.color,s=e.point,l=e.line,u=e.isPercent,c=e.xField,h=e.yField,f=e.tooltip,d=e.seriesField,v=e.startOnZero,p=s==null?void 0:s.state,g=Kv(i,h,c,h,u);t.data(g);var m=u?S({formatter:function(C){return{name:C[d]||C[c],value:(Number(C[h])*100).toFixed(2)+"%"}}},f):f,y=W({},r,{options:{area:{color:o,style:n,shape:a},point:s&&S({color:o},s),tooltip:m,label:void 0,args:{startOnZero:v}}}),_={chart:t,options:W({line:{size:2}},Rv(e,["state"]),{line:l&&S({color:o},l),sizeField:d,state:l==null?void 0:l.state,tooltip:!1,label:void 0,args:{startOnZero:v}})},x=W({},y,{options:{tooltip:!1,state:p}});return Ey(y),Dh(_),Fn(x),r}function Sgt(r){var t=r.chart,e=r.options,i=e.label,n=e.yField,a=ti(t,"area");if(!i)a.label(!1);else{var o=i.fields,s=i.callback,l=zt(i,["fields","callback"]);a.label({fields:o||[n],callback:s,cfg:S({layout:[{type:"limit-in-plot"},{type:"path-adjust-position"},{type:"point-adjust-position"},{type:"limit-in-plot",cfg:{action:"hide"}}]},Lr(l))})}return r}function Agt(r){var t=r.chart,e=r.options,i=e.isStack,n=e.isPercent,a=e.seriesField;return(n||i)&&a&&I(t.geometries,function(o){o.adjust("stack")}),r}function k6(r){return Rt(se,Pn("areaStyle"),I6("rect"),Egt,Ay,Agt,B6,D6,Cr,Sgt,qv,We(),ze,Ce,_u)(r)}var Tgt=W({},Bt.getDefaultOptions(),{tooltip:{shared:!0,showMarkers:!0,showCrosshairs:!0,crosshairs:{type:"x"}},isStack:!0,line:{},legend:{position:"top-left",radio:{}}}),U6=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="area",e}return t.getDefaultOptions=function(){return Tgt},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.changeData=function(e){this.updateOption({data:e});var i=this.options,n=i.isPercent,a=i.xField,o=i.yField,s=this,l=s.chart,u=s.options;Ay({chart:l,options:u}),this.chart.changeData(Kv(e,o,a,o,n))},t.prototype.getSchemaAdaptor=function(){return k6},t}(Bt);const OWt=Object.freeze(Object.defineProperty({__proto__:null,Area:U6},Symbol.toStringTag,{value:"Module"}));var bgt=10,wgt=5,Rgt={padding:[8,10],text:"reset",textStyle:{default:{x:0,y:0,fontSize:12,fill:"#333333",cursor:"pointer"}},buttonStyle:{default:{fill:"#f7f7f7",stroke:"#cccccc",cursor:"pointer"},active:{fill:"#e6e6e6"}}},Mgt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.buttonGroup=null,e.buttonCfg=S({name:"button"},Rgt),e}return t.prototype.getButtonCfg=function(){var e=this.context.view,i=P(e,["interactions","filter-action","cfg","buttonConfig"]);return W(this.buttonCfg,i,this.cfg)},t.prototype.drawButton=function(){var e=this.getButtonCfg(),i=this.context.view.foregroundGroup.addGroup({name:e.name}),n=this.drawText(i);this.drawBackground(i,n.getBBox()),this.buttonGroup=i},t.prototype.drawText=function(e){var i,n=this.getButtonCfg();return e.addShape({type:"text",name:"button-text",attrs:S({text:n.text},(i=n.textStyle)===null||i===void 0?void 0:i.default)})},t.prototype.drawBackground=function(e,i){var n,a=this.getButtonCfg(),o=Qs(a.padding),s=e.addShape({type:"rect",name:"button-rect",attrs:S({x:i.x-o[3],y:i.y-o[0],width:i.width+o[1]+o[3],height:i.height+o[0]+o[2]},(n=a.buttonStyle)===null||n===void 0?void 0:n.default)});return s.toBack(),e.on("mouseenter",function(){var l;s.attr((l=a.buttonStyle)===null||l===void 0?void 0:l.active)}),e.on("mouseleave",function(){var l;s.attr((l=a.buttonStyle)===null||l===void 0?void 0:l.default)}),s},t.prototype.resetPosition=function(){var e=this.context.view,i=e.getCoordinate(),n=i.convert({x:1,y:1}),a=this.buttonGroup,o=a.getBBox(),s=nn.transform(null,[["t",n.x-o.width-bgt,n.y+o.height+wgt]]);a.setMatrix(s)},t.prototype.show=function(){this.buttonGroup||this.drawButton(),this.resetPosition(),this.buttonGroup.show()},t.prototype.hide=function(){this.buttonGroup&&this.buttonGroup.hide()},t.prototype.destroy=function(){var e=this.buttonGroup;e&&e.remove(),r.prototype.destroy.call(this)},t}(De);Ct("brush-reset-button",Mgt,{name:"brush-reset-button"});Pt("filter-action",{});function No(r){return r.isInPlot()}function Hu(r,t,e){var i=e||{},n=i.mask,a=i.isStartEnable,o=t||"rect";switch(r){case"brush":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:a||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:a||No,action:["brush:start","".concat(o,"-mask:start"),"".concat(o,"-mask:show")],arg:[null,{maskStyle:n==null?void 0:n.style}]}],processing:[{trigger:"mousemove",isEnable:No,action:["".concat(o,"-mask:resize")]}],end:[{trigger:"mouseup",isEnable:No,action:["brush:filter","brush:end","".concat(o,"-mask:end"),"".concat(o,"-mask:hide"),"brush-reset-button:show"]}],rollback:[{trigger:"brush-reset-button:click",action:["brush:reset","brush-reset-button:hide","cursor:crosshair"]}]};case"brush-highlight":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:a||function(){return!0}},{trigger:"plot:mousemove",action:"cursor:crosshair",isEnable:a||function(){return!0}},{trigger:"plot:mousemove",action:"cursor:default",isEnable:function(s){return a?!a(s):!1}},{trigger:"mask:mouseenter",action:"cursor:move",isEnable:a||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"},{trigger:"mask:mouseleave",action:"cursor:crosshair"}],start:[{trigger:"plot:mousedown",isEnable:a||function(s){return!s.isInShape("mask")},action:["".concat(o,"-mask:start"),"".concat(o,"-mask:show")],arg:[{maskStyle:n==null?void 0:n.style}]},{trigger:"mask:dragstart",action:["".concat(o,"-mask:moveStart")]}],processing:[{trigger:"plot:mousemove",action:["".concat(o,"-mask:resize")]},{trigger:"mask:drag",action:["".concat(o,"-mask:move")]},{trigger:"mask:change",action:["element-range-highlight:highlight"]}],end:[{trigger:"plot:mouseup",action:["".concat(o,"-mask:end")]},{trigger:"mask:dragend",action:["".concat(o,"-mask:moveEnd")]},{trigger:"document:mouseup",isEnable:function(s){return!s.isInPlot()},action:["element-range-highlight:clear","".concat(o,"-mask:end"),"".concat(o,"-mask:hide")]}],rollback:[{trigger:"dblclick",action:["element-range-highlight:clear","".concat(o,"-mask:hide")]}]};case"brush-x":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:a||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:a||No,action:["brush-x:start","".concat(o,"-mask:start"),"".concat(o,"-mask:show")],arg:[null,{maskStyle:n==null?void 0:n.style}]}],processing:[{trigger:"mousemove",isEnable:No,action:["".concat(o,"-mask:resize")]}],end:[{trigger:"mouseup",isEnable:No,action:["brush-x:filter","brush-x:end","".concat(o,"-mask:end"),"".concat(o,"-mask:hide")]}],rollback:[{trigger:"dblclick",action:["brush-x:reset"]}]};case"brush-x-highlight":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:a||function(){return!0}},{trigger:"mask:mouseenter",action:"cursor:move",isEnable:a||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"},{trigger:"mask:mouseleave",action:"cursor:crosshair"}],start:[{trigger:"plot:mousedown",isEnable:a||function(s){return!s.isInShape("mask")},action:["".concat(o,"-mask:start"),"".concat(o,"-mask:show")],arg:[{maskStyle:n==null?void 0:n.style}]},{trigger:"mask:dragstart",action:["".concat(o,"-mask:moveStart")]}],processing:[{trigger:"plot:mousemove",action:["".concat(o,"-mask:resize")]},{trigger:"mask:drag",action:["".concat(o,"-mask:move")]},{trigger:"mask:change",action:["element-range-highlight:highlight"]}],end:[{trigger:"plot:mouseup",action:["".concat(o,"-mask:end")]},{trigger:"mask:dragend",action:["".concat(o,"-mask:moveEnd")]},{trigger:"document:mouseup",isEnable:function(s){return!s.isInPlot()},action:["element-range-highlight:clear","".concat(o,"-mask:end"),"".concat(o,"-mask:hide")]}],rollback:[{trigger:"dblclick",action:["element-range-highlight:clear","".concat(o,"-mask:hide")]}]};case"brush-y":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:a||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:a||No,action:["brush-y:start","".concat(o,"-mask:start"),"".concat(o,"-mask:show")],arg:[null,{maskStyle:n==null?void 0:n.style}]}],processing:[{trigger:"mousemove",isEnable:No,action:["".concat(o,"-mask:resize")]}],end:[{trigger:"mouseup",isEnable:No,action:["brush-y:filter","brush-y:end","".concat(o,"-mask:end"),"".concat(o,"-mask:hide")]}],rollback:[{trigger:"dblclick",action:["brush-y:reset"]}]};case"brush-y-highlight":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:a||function(){return!0}},{trigger:"mask:mouseenter",action:"cursor:move",isEnable:a||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"},{trigger:"mask:mouseleave",action:"cursor:crosshair"}],start:[{trigger:"plot:mousedown",isEnable:a||function(s){return!s.isInShape("mask")},action:["".concat(o,"-mask:start"),"".concat(o,"-mask:show")],arg:[{maskStyle:n==null?void 0:n.style}]},{trigger:"mask:dragstart",action:["".concat(o,"-mask:moveStart")]}],processing:[{trigger:"plot:mousemove",action:["".concat(o,"-mask:resize")]},{trigger:"mask:drag",action:["".concat(o,"-mask:move")]},{trigger:"mask:change",action:["element-range-highlight:highlight"]}],end:[{trigger:"plot:mouseup",action:["".concat(o,"-mask:end")]},{trigger:"mask:dragend",action:["".concat(o,"-mask:moveEnd")]},{trigger:"document:mouseup",isEnable:function(s){return!s.isInPlot()},action:["element-range-highlight:clear","".concat(o,"-mask:end"),"".concat(o,"-mask:hide")]}],rollback:[{trigger:"dblclick",action:["element-range-highlight:clear","".concat(o,"-mask:hide")]}]};default:return{}}}Pt("brush",Hu("brush"));Pt("brush-highlight",Hu("brush-highlight"));Pt("brush-x",Hu("brush-x","x-rect"));Pt("brush-y",Hu("brush-y","y-rect"));Pt("brush-x-highlight",Hu("brush-x-highlight","x-rect"));Pt("brush-y-highlight",Hu("brush-y-highlight","y-rect"));var PI=["brush","brush-x","brush-y","brush-highlight","brush-x-highlight","brush-y-highlight"];function z6(r){var t=r.options,e=t.brush,i=Fr(t.interactions||[],function(n){return PI.indexOf(n.type)===-1});return e!=null&&e.enabled&&(PI.forEach(function(n){var a=!1;switch(e.type){case"x-rect":a=n===(e.action==="highlight"?"brush-x-highlight":"brush-x");break;case"y-rect":a=n===(e.action==="highlight"?"brush-y-highlight":"brush-y");break;default:a=n===(e.action==="highlight"?"brush-highlight":"brush");break}var o={type:n,enable:a};e&&(o.cfg=Hu(n,e.type,e)),i.push(o)}),(e==null?void 0:e.action)!=="highlight"&&i.push({type:"filter-action",cfg:{buttonConfig:e.button}})),W({},r,{options:{interactions:i}})}var iu={hover:"__interval-connected-area-hover__",click:"__interval-connected-area-click__"},VA=function(r,t){return r==="hover"?[{trigger:"interval:mouseenter",action:["element-highlight-by-color:highlight","element-link-by-color:link"],arg:[null,{style:t}]}]:[{trigger:"interval:click",action:["element-highlight-by-color:clear","element-highlight-by-color:highlight","element-link-by-color:clear","element-link-by-color:unlink","element-link-by-color:link"],arg:[null,null,null,null,{style:t}]}]};Pt(iu.hover,{start:VA(iu.hover),end:[{trigger:"interval:mouseleave",action:["element-highlight-by-color:reset","element-link-by-color:unlink"]}]});Pt(iu.click,{start:VA(iu.click),end:[{trigger:"document:mousedown",action:["element-highlight-by-color:clear","element-link-by-color:clear"]}]});function Igt(r){return r===void 0&&(r=!1),function(t){var e=t.chart,i=t.options,n=i.connectedArea,a=function(){e.removeInteraction(iu.hover),e.removeInteraction(iu.click)};if(!r&&n){var o=n.trigger||"hover";a(),e.interaction(iu[o],{start:VA(o,n.style)})}else a();return t}}function H6(r,t){return!Tt(r)||!Tt(t)||r===0&&t===0?"-":r===t?"100%":r===0?"∞":"".concat((100*t/r).toFixed(2),"%")}function Lgt(r,t){return W({size:t?32:80,spacing:t?8:12,offset:t?32:0,arrow:r.arrow!==!1&&{headSize:12,style:{fill:"rgba(0, 0, 0, 0.05)"}},text:r.text!==!1&&{style:{fontSize:12,fill:"rgba(0, 0, 0, 0.85)",textAlign:"center",textBaseline:"middle"},formatter:H6}},r)}function tm(r,t){return Ne(t.getModel().points,function(e){return r.convertPoint(e)})}function Ogt(r,t,e){var i=r.view,n=r.geometry,a=r.group,o=r.options,s=r.horizontal,l=o.offset,u=o.size,c=o.arrow,h=i.getCoordinate(),f=tm(h,t)[3],d=tm(h,e)[0],v=d.y-f.y,p=d.x-f.x;if(typeof c!="boolean"){var g=c.headSize,m=o.spacing,y;s?(p-g)/2<m?(m=Math.max(1,(p-g)/2),y=[[f.x+m,f.y-l],[f.x+m,f.y-l-u],[d.x-m,d.y-l-u/2]]):y=[[f.x+m,f.y-l],[f.x+m,f.y-l-u],[d.x-m-g,d.y-l-u],[d.x-m,d.y-l-u/2],[d.x-m-g,d.y-l]]:(v-g)/2<m?(m=Math.max(1,(v-g)/2),y=[[f.x+l,f.y+m],[f.x+l+u,f.y+m],[d.x+l+u/2,d.y-m]]):y=[[f.x+l,f.y+m],[f.x+l+u,f.y+m],[d.x+l+u,d.y-m-g],[d.x+l+u/2,d.y-m],[d.x+l,d.y-m-g]],a.addShape("polygon",{id:"".concat(i.id,"-conversion-tag-arrow-").concat(n.getElementId(t.getModel().mappingData)),name:"conversion-tag-arrow",origin:{element:t,nextElement:e},attrs:S(S({},c.style||{}),{points:y})})}}function Pgt(r,t,e){var i,n,a,o=r.view,s=r.geometry,l=r.group,u=r.options,c=r.field,h=r.horizontal,f=u.offset,d=u.size;if(typeof u.text!="boolean"){var v=o.getCoordinate(),p=((i=u.text)===null||i===void 0?void 0:i.formatter)&&((n=u.text)===null||n===void 0?void 0:n.formatter(t.getData()[c],e.getData()[c])),g=tm(v,t)[h?3:0],m=tm(v,e)[h?0:3],y=l.addShape("text",{id:"".concat(o.id,"-conversion-tag-text-").concat(s.getElementId(t.getModel().mappingData)),name:"conversion-tag-text",origin:{element:t,nextElement:e},attrs:S(S({},((a=u.text)===null||a===void 0?void 0:a.style)||{}),{text:p,x:h?(g.x+m.x)/2:g.x+f+d/2,y:h?g.y-f-d/2:(g.y+m.y)/2})});if(h){var _=m.x-g.x,x=y.getBBox().width;if(x>_){var C=x/p.length,A=Math.max(1,Math.ceil(_/C)-1),b="".concat(p.slice(0,A),"...");y.attr("text",b)}}}}function Fgt(r,t,e){Ogt(r,t,e),Pgt(r,t,e)}function Bgt(r,t,e){return t===void 0&&(t=!0),e===void 0&&(e=!1),function(i){var n=i.options,a=i.chart,o=n.conversionTag,s=n.theme;return o&&!e&&(a.theme(W({},ie(s)?s:rd(s),{columnWidthRatio:1/3})),a.annotation().shape({render:function(l,u){var c=l.addGroup({id:"".concat(a.id,"-conversion-tag-group"),name:"conversion-tag-group"}),h=Qn(a.geometries,function(v){return v.type==="interval"}),f={view:u,geometry:h,group:c,field:r,horizontal:t,options:Lgt(o,t)},d=h.elements;I(d,function(v,p){p>0&&Fgt(f,d[p-1],v)})}})),i}}function Dgt(r){var t=r.options,e=t.legend,i=t.seriesField,n=t.isStack;return i?e!==!1&&(e=S({position:n?"right-top":"top-left"},e)):e=!1,r.options.legend=e,r}function Ngt(r){var t=r.chart,e=r.options,i=e.data,n=e.columnStyle,a=e.color,o=e.columnWidthRatio,s=e.isPercent,l=e.isGroup,u=e.isStack,c=e.xField,h=e.yField,f=e.seriesField,d=e.groupField,v=e.tooltip,p=e.shape,g=s&&l&&u?mgt(i,h,[c,d],h):Kv(i,h,c,h,s),m=[];u&&f&&!l?g.forEach(function(x){var C=m.find(function(A){return A[c]===x[c]&&A[f]===x[f]});C?C[h]+=x[h]||0:m.push(S({},x))}):m=g,t.data(m);var y=s?S({formatter:function(x){var C;return{name:l&&u?"".concat(x[f]," - ").concat(x[d]):(C=x[f])!==null&&C!==void 0?C:x[c],value:(Number(x[h])*100).toFixed(2)+"%"}}},v):v,_=W({},r,{options:{data:m,widthRatio:o,tooltip:y,interval:{shape:p,style:n,color:a}}});return ei(_),_}function GA(r){var t,e,i=r.options,n=i.xAxis,a=i.yAxis,o=i.xField,s=i.yField,l=i.data,u=i.isPercent,c=u?{max:1,min:0,minLimit:0,maxLimit:1}:{};return Rt(Je((t={},t[o]=n,t[s]=a,t),(e={},e[o]={type:"cat"},e[s]=S(S({},NA(l,s)),c),e)))(r)}function kgt(r){var t=r.chart,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField,o=e.yField;return i===!1?t.axis(a,!1):t.axis(a,i),n===!1?t.axis(o,!1):t.axis(o,n),r}function Ugt(r){var t=r.chart,e=r.options,i=e.legend,n=e.seriesField;return i&&n?t.legend(n,i):i===!1&&t.legend(!1),r}function zgt(r){var t=r.chart,e=r.options,i=e.label,n=e.yField,a=e.isRange,o=ti(t,"interval");if(!i)o.label(!1);else{var s=i.callback,l=zt(i,["callback"]);o.label({fields:[n],callback:s,cfg:S({layout:l!=null&&l.position?void 0:[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"},{type:"limit-in-plot",cfg:{action:"hide"}}]},Lr(a?S({content:function(u){var c;return(c=u[n])===null||c===void 0?void 0:c.join("-")}},l):l))})}return r}function Hgt(r){var t=r.chart,e=r.options,i=e.tooltip,n=e.isGroup,a=e.isStack,o=e.groupField,s=e.data,l=e.xField,u=e.yField,c=e.seriesField;if(i===!1)t.tooltip(!1);else{var h=i;if(n&&a){var f=h.customItems,d=(h==null?void 0:h.formatter)||function(v){return{name:"".concat(v[c]," - ").concat(v[o]),value:v[u]}};h=S(S({},h),{customItems:function(v){var p=[];return I(v,function(g){var m=Fr(s,function(y){return SS(y,ye(g.data,[l,c]))});m.forEach(function(y){p.push(S(S(S({},g),{value:y[u],data:y,mappingData:{_origin:y}}),d(y)))})}),f?f(p):p}})}t.tooltip(h)}return r}function Ty(r,t){t===void 0&&(t=!1);var e=r.options,i=e.seriesField;return Rt(Dgt,se,Pn("columnStyle"),pl,I6("rect"),Ngt,GA,kgt,Ugt,Hgt,qv,$A,zgt,z6,ze,Ce,We(),Bgt(e.yField,!t,!!i),Igt(!e.isStack),_u)(r)}function $gt(r){var t=r.options,e=t.xField,i=t.yField,n=t.xAxis,a=t.yAxis,o={left:"bottom",right:"top",top:"left",bottom:"right"},s=a!==!1?S({position:o[(a==null?void 0:a.position)||"left"]},a):!1,l=n!==!1?S({position:o[(n==null?void 0:n.position)||"bottom"]},n):!1;return S(S({},r),{options:S(S({},t),{xField:i,yField:e,xAxis:s,yAxis:l})})}function Wgt(r){var t=r.options,e=t.label;return e&&!e.position&&(e.position="left",e.layout||(e.layout=[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"},{type:"limit-in-plot",cfg:{action:"hide"}}])),W({},r,{options:{label:e}})}function Vgt(r){var t=r.options,e=t.seriesField,i=t.isStack,n=t.legend;return e?n!==!1&&(n=S({position:i?"top-left":"right-top"},n||{})):n=!1,W({},r,{options:{legend:n}})}function Ggt(r){var t=r.options,e=[{type:"transpose"},{type:"reflectY"}].concat(t.coordinate||[]);return W({},r,{options:{coordinate:e}})}function Xgt(r){var t=r.chart,e=r.options,i=e.barStyle,n=e.barWidthRatio,a=e.minBarWidth,o=e.maxBarWidth,s=e.barBackground;return Ty({chart:t,options:S(S({},e),{columnStyle:i,columnWidthRatio:n,minColumnWidth:a,maxColumnWidth:o,columnBackground:s})},!0)}function $6(r){return Rt($gt,Wgt,Vgt,Cr,Ggt,Xgt)(r)}var Ygt=W({},Bt.getDefaultOptions(),{barWidthRatio:.6,marginRatio:1/32,tooltip:{shared:!0,showMarkers:!1,offset:20},legend:{radio:{}},interactions:[{type:"active-region"}]}),W6=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="bar",e}return t.getDefaultOptions=function(){return Ygt},t.prototype.changeData=function(e){var i,n;this.updateOption({data:e});var a=this,o=a.chart,s=a.options,l=s.isPercent,u=s.xField,c=s.yField,h=s.xAxis,f=s.yAxis;i=[c,u],u=i[0],c=i[1],n=[f,h],h=n[0],f=n[1];var d=S(S({},s),{xField:u,yField:c,yAxis:f,xAxis:h});GA({chart:o,options:d}),o.changeData(Kv(e,u,c,u,l))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return $6},t}(Bt);const PWt=Object.freeze(Object.defineProperty({__proto__:null,Bar:W6},Symbol.toStringTag,{value:"Module"}));var jgt=W({},Bt.getDefaultOptions(),{columnWidthRatio:.6,marginRatio:1/32,tooltip:{shared:!0,showMarkers:!1,offset:20},legend:{radio:{}},interactions:[{type:"active-region"}]}),V6=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="column",e}return t.getDefaultOptions=function(){return jgt},t.prototype.changeData=function(e){this.updateOption({data:e});var i=this.options,n=i.yField,a=i.xField,o=i.isPercent,s=this,l=s.chart,u=s.options;GA({chart:l,options:u}),this.chart.changeData(Kv(e,n,a,n,o))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return Ty},t}(Bt);const FWt=Object.freeze(Object.defineProperty({__proto__:null,Column:V6},Symbol.toStringTag,{value:"Module"}));var v1,Js="$$percentage$$",tl="$$mappingValue$$",po="$$conversion$$",lC="$$totalPercentage$$",Dd="$$x$$",Nd="$$y$$",Zgt={appendPadding:[0,80],minSize:0,maxSize:1,meta:(v1={},v1[tl]={min:0,max:1,nice:!1},v1),label:{style:{fill:"#fff",fontSize:12}},tooltip:{showTitle:!1,showMarkers:!1,shared:!1},conversionTag:{offsetX:10,offsetY:0,style:{fontSize:12,fill:"rgba(0,0,0,0.45)"}}},G6="CONVERSION_TAG_NAME";function XA(r,t,e){var i=[],n=e.yField,a=e.maxSize,o=e.minSize,s=P(wS(t,n),[n]),l=Tt(a)?a:1,u=Tt(o)?o:0;return i=Ne(r,function(c,h){var f=(c[n]||0)/s;return c[Js]=f,c[tl]=(l-u)*f+u,c[po]=[P(r,[h-1,n]),c[n]],c}),i}function YA(r){return function(t){var e=t.chart,i=t.options,n=i.conversionTag,a=i.filteredData,o=a||e.getOptions().data;if(n){var s=n.formatter;o.forEach(function(l,u){if(!(u<=0||Number.isNaN(l[tl]))){var c=r(l,u,o,{top:!0,name:G6,text:{content:ot(s)?s(l,o):s,offsetX:n.offsetX,offsetY:n.offsetY,position:"end",autoRotate:!1,style:S({textAlign:"start",textBaseline:"middle"},n.style)}});e.annotation().line(c)}})}return t}}function qgt(r){var t=r.chart,e=r.options,i=e.data,n=i===void 0?[]:i,a=e.yField,o=e.maxSize,s=e.minSize,l=XA(n,n,{yField:a,maxSize:o,minSize:s});return t.data(l),r}function Kgt(r){var t=r.chart,e=r.options,i=e.xField,n=e.yField,a=e.color,o=e.tooltip,s=e.label,l=e.shape,u=l===void 0?"funnel":l,c=e.funnelStyle,h=e.state,f=ha(o,[i,n]),d=f.fields,v=f.formatter;cn({chart:t,options:{type:"interval",xField:i,yField:tl,colorField:i,tooltipFields:q(d)&&d.concat([Js,po]),mapping:{shape:u,tooltip:v,color:a,style:c},label:s,state:h}});var p=ti(r.chart,"interval");return p.adjust("symmetric"),r}function Qgt(r){var t=r.chart,e=r.options,i=e.isTransposed;return t.coordinate({type:"rect",actions:i?[]:[["transpose"],["scale",1,-1]]}),r}function X6(r){var t=r.options,e=r.chart,i=t.maxSize,n=P(e,["geometries","0","dataArray"],[]),a=P(e,["options","data","length"]),o=Ne(n,function(l){return P(l,["0","nextPoints","0","x"])*a-.5}),s=function(l,u,c,h){var f=i-(i-l[tl])/2;return S(S({},h),{start:[o[u-1]||u-.5,f],end:[o[u-1]||u-.5,f+.05]})};return YA(s)(r),r}function Y6(r){return Rt(qgt,Kgt,Qgt,X6)(r)}function Jgt(r){var t,e=r.chart,i=r.options,n=i.data,a=n===void 0?[]:n,o=i.yField;return e.data(a),e.scale((t={},t[o]={sync:!0},t)),r}function t0t(r){var t=r.chart,e=r.options,i=e.data,n=e.xField,a=e.yField,o=e.color,s=e.compareField,l=e.isTransposed,u=e.tooltip,c=e.maxSize,h=e.minSize,f=e.label,d=e.funnelStyle,v=e.state,p=e.showFacetTitle;return t.facet("mirror",{fields:[s],transpose:!l,padding:l?0:[32,0,0,0],showTitle:p,eachView:function(g,m){var y=l?m.rowIndex:m.columnIndex;l||g.coordinate({type:"rect",actions:[["transpose"],["scale",y===0?-1:1,-1]]});var _=XA(m.data,i,{yField:a,maxSize:c,minSize:h});g.data(_);var x=ha(u,[n,a,s]),C=x.fields,A=x.formatter,b=l?{offset:y===0?10:-23,position:y===0?"bottom":"top"}:{offset:10,position:"left",style:{textAlign:y===0?"end":"start"}};cn({chart:g,options:{type:"interval",xField:n,yField:tl,colorField:n,tooltipFields:q(C)&&C.concat([Js,po]),mapping:{shape:"funnel",tooltip:A,color:o,style:d},label:f===!1?!1:W({},b,f),state:v}})}}),r}function j6(r){var t=r.chart,e=r.index,i=r.options,n=i.conversionTag,a=i.isTransposed;(Tt(e)?[t]:t.views).forEach(function(o,s){var l=P(o,["geometries","0","dataArray"],[]),u=P(o,["options","data","length"]),c=Ne(l,function(f){return P(f,["0","nextPoints","0","x"])*u-.5}),h=function(f,d,v,p){var g=(e||s)===0?-1:1;return W({},p,{start:[c[d-1]||d-.5,f[tl]],end:[c[d-1]||d-.5,f[tl]+.05],text:a?{style:{textAlign:"start"}}:{offsetX:n!==!1?g*n.offsetX:0,style:{textAlign:(e||s)===0?"end":"start"}}})};YA(h)(W({},{chart:o,options:i}))})}function e0t(r){var t=r.chart;return t.once("beforepaint",function(){return j6(r)}),r}function r0t(r){return Rt(Jgt,t0t,e0t)(r)}function i0t(r){var t=r.chart,e=r.options,i=e.data,n=i===void 0?[]:i,a=e.yField,o=Qr(n,function(u,c){return u+(c[a]||0)},0),s=wS(n,a)[a],l=Ne(n,function(u,c){var h=[],f=[];if(u[lC]=(u[a]||0)/o,c){var d=n[c-1][Dd],v=n[c-1][Nd];h[0]=d[3],f[0]=v[3],h[1]=d[2],f[1]=v[2]}else h[0]=-.5,f[0]=1,h[1]=.5,f[1]=1;return f[2]=f[1]-u[lC],h[2]=(f[2]+1)/4,f[3]=f[2],h[3]=-h[2],u[Dd]=h,u[Nd]=f,u[Js]=(u[a]||0)/s,u[po]=[P(n,[c-1,a]),u[a]],u});return t.data(l),r}function n0t(r){var t=r.chart,e=r.options,i=e.xField,n=e.yField,a=e.color,o=e.tooltip,s=e.label,l=e.funnelStyle,u=e.state,c=ha(o,[i,n]),h=c.fields,f=c.formatter;return cn({chart:t,options:{type:"polygon",xField:Dd,yField:Nd,colorField:i,tooltipFields:q(h)&&h.concat([Js,po]),label:s,state:u,mapping:{tooltip:f,color:a,style:l}}}),r}function a0t(r){var t=r.chart,e=r.options,i=e.isTransposed;return t.coordinate({type:"rect",actions:i?[["transpose"],["reflect","x"]]:[]}),r}function o0t(r){var t=function(e,i,n,a){return S(S({},a),{start:[e[Dd][1],e[Nd][1]],end:[e[Dd][1]+.05,e[Nd][1]]})};return YA(t)(r),r}function s0t(r){return Rt(i0t,n0t,a0t,o0t)(r)}function l0t(r){var t,e=r.chart,i=r.options,n=i.data,a=n===void 0?[]:n,o=i.yField;return e.data(a),e.scale((t={},t[o]={sync:!0},t)),r}function u0t(r){var t=r.chart,e=r.options,i=e.seriesField,n=e.isTransposed,a=e.showFacetTitle;return t.facet("rect",{fields:[i],padding:[n?0:32,10,0,10],showTitle:a,eachView:function(o,s){Y6(W({},r,{chart:o,options:{data:s.data}}))}}),r}function c0t(r){return Rt(l0t,u0t)(r)}var h0t=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.rendering=!1,e}return t.prototype.change=function(e){var i=this;if(!this.rendering){var n=e.seriesField,a=e.compareField,o=a?j6:X6,s=this.context.view,l=n||a?s.views:[s];Ne(l,function(u,c){var h=u.getController("annotation"),f=Fr(P(h,["option"],[]),function(v){var p=v.name;return p!==G6});h.clear(!0),I(f,function(v){typeof v=="object"&&u.annotation()[v.type](v)});var d=P(u,["filteredData"],u.getOptions().data);o({chart:u,index:c,options:S(S({},e),{filteredData:XA(d,d,e)})}),u.filterData(d),i.rendering=!0,u.render(!0)})}this.rendering=!1},t}(De),Z6="funnel-conversion-tag",uC="funnel-afterrender",q6={trigger:"afterrender",action:"".concat(Z6,":change")};Ct(Z6,h0t);Pt(uC,{start:[q6]});function f0t(r){var t=r.options,e=t.compareField,i=t.xField,n=t.yField,a=t.locale,o=t.funnelStyle,s=t.data,l=Cy(a),u={label:e?{fields:[i,n,e,Js,po],formatter:function(h){return"".concat(h[n])}}:{fields:[i,n,Js,po],offset:0,position:"middle",formatter:function(h){return"".concat(h[i]," ").concat(h[n])}},tooltip:{title:i,formatter:function(h){return{name:h[i],value:h[n]}}},conversionTag:{formatter:function(h){return"".concat(l.get(["conversionTag","label"]),": ").concat(H6.apply(void 0,h[po]))}}},c;return(e||o)&&(c=function(h){return W({},e&&{lineWidth:1,stroke:"#fff"},ot(o)?o(h):o)}),W({options:u},r,{options:{funnelStyle:c,data:Rr(s)}})}function d0t(r){var t=r.options,e=t.compareField,i=t.dynamicHeight,n=t.seriesField;return n?c0t(r):e?r0t(r):i?s0t(r):Y6(r)}function v0t(r){var t,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField,o=e.yField;return Rt(Je((t={},t[a]=i,t[o]=n,t)))(r)}function p0t(r){var t=r.chart;return t.axis(!1),r}function g0t(r){var t=r.chart,e=r.options,i=e.legend;return i===!1?t.legend(!1):t.legend(i),r}function m0t(r){var t=r.chart,e=r.options,i=e.interactions,n=e.dynamicHeight;return I(i,function(a){a.enable===!1?t.removeInteraction(a.type):t.interaction(a.type,a.cfg||{})}),n?t.removeInteraction(uC):t.interaction(uC,{start:[S(S({},q6),{arg:e})]}),r}function K6(r){return Rt(f0t,d0t,v0t,p0t,Cr,m0t,g0t,Ce,se,We())(r)}var Q6=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="funnel",e}return t.getDefaultOptions=function(){return Zgt},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return K6},t.prototype.setState=function(e,i,n){n===void 0&&(n=!0);var a=Bd(this.chart);I(a,function(o){i(o.getData())&&o.setState(e,n)})},t.prototype.getStates=function(){var e=Bd(this.chart),i=[];return I(e,function(n){var a=n.getData(),o=n.getStates();I(o,function(s){i.push({data:a,state:s,geometry:n.geometry,element:n})})}),i},t.CONVERSATION_FIELD=po,t.PERCENT_FIELD=Js,t.TOTAL_PERCENT_FIELD=lC,t}(Bt);const BWt=Object.freeze(Object.defineProperty({__proto__:null,FUNNEL_CONVERSATION_FIELD:po,Funnel:Q6},Symbol.toStringTag,{value:"Module"}));var vg,jA="range",J6="type",Yo="percent",y0t="#f0f0f0",t7="indicator-view",e7="range-view",_0t={percent:0,range:{ticks:[]},innerRadius:.9,radius:.95,startAngle:-7/6*Math.PI,endAngle:1/6*Math.PI,syncViewPadding:!0,axis:{line:null,label:{offset:-24,style:{textAlign:"center",textBaseline:"middle"}},subTickLine:{length:-8},tickLine:{length:-12},grid:null},indicator:{pointer:{style:{lineWidth:5,lineCap:"round"}},pin:{style:{r:9.75,lineWidth:4.5,fill:"#fff"}}},statistic:{title:!1},meta:(vg={},vg[jA]={sync:"v"},vg[Yo]={sync:"v",tickCount:5,tickInterval:.2},vg),animation:!1};function x0t(r,t){return r.map(function(e,i){var n;return n={},n[jA]=e-(r[i-1]||0),n[J6]="".concat(i),n[Yo]=t,n})}function r7(r){var t;return[(t={},t[Yo]=Oe(r,0,1),t)]}function i7(r,t){var e=P(t,["ticks"],[]),i=xr(e)?as(e):[0,Oe(r,0,1),1];return i[0]||i.shift(),x0t(i,r)}function C0t(r){var t=r.chart,e=r.options,i=e.percent,n=e.range,a=e.radius,o=e.innerRadius,s=e.startAngle,l=e.endAngle,u=e.axis,c=e.indicator,h=e.gaugeStyle,f=e.type,d=e.meter,v=n.color,p=n.width;if(c){var g=r7(i),m=t.createView({id:t7});m.data(g),m.point().position("".concat(Yo,"*1")).shape(c.shape||"gauge-indicator").customInfo({defaultColor:t.getTheme().defaultColor,indicator:c}),m.coordinate("polar",{startAngle:s,endAngle:l,radius:o*a}),m.axis(Yo,u),m.scale(Yo,ye(u,Xi))}var y=i7(i,e.range),_=t.createView({id:e7});_.data(y);var x=mt(v)?[v,y0t]:v,C=ei({chart:_,options:{xField:"1",yField:jA,seriesField:J6,rawFields:[Yo],isStack:!0,interval:{color:x,style:h,shape:f==="meter"?"meter-gauge":null},args:{zIndexReversed:!0,sortZIndex:!0},minColumnWidth:p,maxColumnWidth:p}}).ext,A=C.geometry;return A.customInfo({meter:d}),_.coordinate("polar",{innerRadius:o,radius:a,startAngle:s,endAngle:l}).transpose(),r}function E0t(r){var t;return Rt(Je((t={range:{min:0,max:1,maxLimit:1,minLimit:0}},t[Yo]={},t)))(r)}function n7(r,t){var e=r.chart,i=r.options,n=i.statistic,a=i.percent;if(e.getController("annotation").clear(!0),n){var o=n.content,s=void 0;o&&(s=W({},{content:"".concat((a*100).toFixed(2),"%"),style:{opacity:.75,fontSize:"30px",lineHeight:1,textAlign:"center",color:"rgba(44,53,66,0.85)"}},o)),egt(e,{statistic:S(S({},n),{content:s})},{percent:a})}return t&&e.render(!0),r}function S0t(r){var t=r.chart,e=r.options,i=e.tooltip;return i?t.tooltip(W({showTitle:!1,showMarkers:!1,containerTpl:'<div class="g2-tooltip"><div class="g2-tooltip-list"></div></div>',domStyles:{"g2-tooltip":{padding:"4px 8px",fontSize:"10px"}},customContent:function(n,a){var o=P(a,[0,"data",Yo],0);return"".concat((o*100).toFixed(2),"%")}},i)):t.tooltip(!1),r}function A0t(r){var t=r.chart;return t.legend(!1),r}function a7(r){return Rt(se,Ce,C0t,E0t,S0t,n7,ze,We(),A0t)(r)}de("point","gauge-indicator",{draw:function(r,t){var e=r.customInfo,i=e.indicator,n=e.defaultColor,a=i,o=a.pointer,s=a.pin,l=t.addGroup(),u=this.parsePoint({x:0,y:0});return o&&l.addShape("line",{name:"pointer",attrs:S({x1:u.x,y1:u.y,x2:r.x,y2:r.y,stroke:n},o.style)}),s&&l.addShape("circle",{name:"pin",attrs:S({x:u.x,y:u.y,stroke:n},s.style)}),l}});de("interval","meter-gauge",{draw:function(r,t){var e=r.customInfo.meter,i=e===void 0?{}:e,n=i.steps,a=n===void 0?50:n,o=i.stepRatio,s=o===void 0?.5:o;a=a<1?1:a,s=Oe(s,0,1);var l=this.coordinate,u=l.startAngle,c=l.endAngle,h=0;if(s>0&&s<1){var f=c-u;h=f/a/(s/(1-s)+1-1/a)}for(var d=h/(1-s)*s,v=t.addGroup(),p=this.coordinate.getCenter(),g=this.coordinate.getRadius(),m=nn.getAngle(r,this.coordinate),y=m.startAngle,_=m.endAngle,x=y;x<_;){var C=void 0,A=(x-u)%(d+h);A<d?C=x+(d-A):(x+=d+h-A,C=x+d);var b=nn.getSectorPath(p.x,p.y,g,x,Math.min(C,_),g*this.coordinate.innerRadius);v.addShape("path",{name:"meter-gauge",attrs:{path:b,fill:r.color,stroke:r.color,lineWidth:.5}}),x=C+h}return v}});var o7=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="gauge",e}return t.getDefaultOptions=function(){return _0t},t.prototype.changeData=function(e){this.chart.emit(Ut.BEFORE_CHANGE_DATA,$e.fromData(this.chart,Ut.BEFORE_CHANGE_DATA,null)),this.updateOption({percent:e});var i=this.chart.views.find(function(a){return a.id===t7});i&&i.data(r7(e));var n=this.chart.views.find(function(a){return a.id===e7});n&&n.data(i7(e,this.options.range)),n7({chart:this.chart,options:this.options},!0),this.chart.emit(Ut.AFTER_CHANGE_DATA,$e.fromData(this.chart,Ut.AFTER_CHANGE_DATA,null))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return a7},t}(Bt);const DWt=Object.freeze(Object.defineProperty({__proto__:null,Gauge:o7},Symbol.toStringTag,{value:"Module"}));function FI(r,t,e){if(e===1)return[0,t];var i=Math.floor(r/t);return[t*i,t*(i+1)]}function T0t(r){return Math.ceil(Math.log(r.length)/Math.LN2)+1}function s7(r,t,e,i,n){var a=Rr(r);n5(a,t);var o=ea(a,t),s=TS(o),l=s.max-s.min,u=e;if(!e&&i&&(u=i>1?l/(i-1):s.max),!e&&!i){var c=T0t(o);u=l/c}var h={},f=Qi(a,n);Mi(f)?I(a,function(v){var p=v[t],g=FI(p,u,i),m="".concat(g[0],"-").concat(g[1]);_o(h,m)||(h[m]={range:g,count:0}),h[m].count+=1}):Object.keys(f).forEach(function(v){I(f[v],function(p){var g=p[t],m=FI(g,u,i),y="".concat(m[0],"-").concat(m[1]),_="".concat(y,"-").concat(v);_o(h,_)||(h[_]={range:m,count:0},h[_][n]=v),h[_].count+=1})});var d=[];return I(h,function(v){d.push(v)}),d}var em="range",kd="count",b0t=W({},Bt.getDefaultOptions(),{columnStyle:{stroke:"#FFFFFF"},tooltip:{shared:!0,showMarkers:!1},interactions:[{type:"active-region"}]});function w0t(r){var t=r.chart,e=r.options,i=e.data,n=e.binField,a=e.binNumber,o=e.binWidth,s=e.color,l=e.stackField,u=e.legend,c=e.columnStyle,h=s7(i,n,o,a,l);t.data(h);var f=W({},r,{options:{xField:em,yField:kd,seriesField:l,isStack:!0,interval:{color:s,style:c}}});return ei(f),u&&l?t.legend(l,u):t.legend(!1),r}function R0t(r){var t,e=r.options,i=e.xAxis,n=e.yAxis;return Rt(Je((t={},t[em]=i,t[kd]=n,t)))(r)}function M0t(r){var t=r.chart,e=r.options,i=e.xAxis,n=e.yAxis;return i===!1?t.axis(em,!1):t.axis(em,i),n===!1?t.axis(kd,!1):t.axis(kd,n),r}function I0t(r){var t=r.chart,e=r.options,i=e.label,n=ti(t,"interval");if(!i)n.label(!1);else{var a=i.callback,o=zt(i,["callback"]);n.label({fields:[kd],callback:a,cfg:Lr(o)})}return r}function l7(r){return Rt(se,Pn("columnStyle"),w0t,R0t,M0t,pl,I0t,Cr,ze,Ce)(r)}var L0t=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="histogram",e}return t.getDefaultOptions=function(){return b0t},t.prototype.changeData=function(e){this.updateOption({data:e});var i=this.options,n=i.binField,a=i.binNumber,o=i.binWidth,s=i.stackField;this.chart.changeData(s7(e,n,o,a,s))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return l7},t}(Bt),O0t=W({},Bt.getDefaultOptions(),{tooltip:{shared:!0,showMarkers:!0,showCrosshairs:!0,crosshairs:{type:"x"}},legend:{position:"top-left",radio:{}},isStack:!1}),P0t=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.active=function(){var e=this.getView(),i=this.context.event;if(i.data){var n=i.data.items,a=e.geometries.filter(function(o){return o.type==="point"});I(a,function(o){I(o.elements,function(s){var l=AS(n,function(u){return u.data===s.data})!==-1;s.setState("active",l)})})}},t.prototype.reset=function(){var e=this.getView(),i=e.geometries.filter(function(n){return n.type==="point"});I(i,function(n){I(n.elements,function(a){a.setState("active",!1)})})},t.prototype.getView=function(){return this.context.view},t}(De);Ct("marker-active",P0t);Pt("marker-active",{start:[{trigger:"tooltip:show",action:"marker-active:active"}],end:[{trigger:"tooltip:hide",action:"marker-active:reset"}]});var u7=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="line",e}return t.getDefaultOptions=function(){return O0t},t.prototype.changeData=function(e){this.updateOption({data:e});var i=this,n=i.chart,a=i.options;Ay({chart:n,options:a}),this.chart.changeData(e)},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return N6},t}(Bt);const NWt=Object.freeze(Object.defineProperty({__proto__:null,Line:u7},Symbol.toStringTag,{value:"Module"}));var c7=W({},Bt.getDefaultOptions(),{legend:{position:"right",radio:{}},tooltip:{shared:!1,showTitle:!1,showMarkers:!1},label:{layout:{type:"limit-in-plot",cfg:{action:"ellipsis"}}},pieStyle:{stroke:"white",lineWidth:1},statistic:{title:{style:{fontWeight:300,color:"#4B535E",textAlign:"center",fontSize:"20px",lineHeight:1}},content:{style:{fontWeight:"bold",color:"rgba(44,53,66,0.85)",textAlign:"center",fontSize:"32px",lineHeight:1}}},theme:{components:{annotation:{text:{animate:!1}}}}}),F0t=[1,0,0,0,1,0,0,0,1];function cC(r,t){var e=t?xt([],t,!0):xt([],F0t,!0);return nn.transform(e,r)}var B0t=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getActiveElements=function(){var e=nn.getDelegationObject(this.context);if(e){var i=this.context.view,n=e.component,a=e.item,o=n.get("field");if(o){var s=i.geometries[0].elements;return s.filter(function(l){return l.getModel().data[o]===a.value})}}return[]},t.prototype.getActiveElementLabels=function(){var e=this.context.view,i=this.getActiveElements(),n=e.geometries[0].labelsContainer.getChildren();return n.filter(function(a){return i.find(function(o){return qt(o.getData(),a.get("data"))})})},t.prototype.transfrom=function(e){e===void 0&&(e=7.5);var i=this.getActiveElements(),n=this.getActiveElementLabels();i.forEach(function(a,o){var s=n[o],l=a.geometry.coordinate;if(l.isPolar&&l.isTransposed){var u=nn.getAngle(a.getModel(),l),c=u.startAngle,h=u.endAngle,f=(c+h)/2,d=e,v=d*Math.cos(f),p=d*Math.sin(f);a.shape.setMatrix(cC([["t",v,p]])),s.setMatrix(cC([["t",v,p]]))}})},t.prototype.active=function(){this.transfrom()},t.prototype.reset=function(){this.transfrom(0)},t}(De);function D0t(r){var t=r.event,e,i=t.target;return i&&(e=i.get("element")),e}var N0t=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getAnnotations=function(e){var i=e||this.context.view;return i.getController("annotation").option},t.prototype.getInitialAnnotation=function(){return this.initialAnnotation},t.prototype.init=function(){var e=this,i=this.context.view;i.removeInteraction("tooltip"),i.on("afterchangesize",function(){var n=e.getAnnotations(i);e.initialAnnotation=n})},t.prototype.change=function(e){var i=this.context,n=i.view,a=i.event;this.initialAnnotation||(this.initialAnnotation=this.getAnnotations());var o=P(a,["data","data"]);if(a.type.match("legend-item")){var s=nn.getDelegationObject(this.context),l=n.getGroupedFields()[0];if(s&&l){var u=s.item;o=n.getData().find(function(d){return d[l]===u.value})}}if(o){var c=P(e,"annotations",[]),h=P(e,"statistic",{});n.getController("annotation").clear(!0),I(c,function(d){typeof d=="object"&&n.annotation()[d.type](d)}),_y(n,{statistic:h,plotType:"pie"},o),n.render(!0)}var f=D0t(this.context);f&&f.shape.toFront()},t.prototype.reset=function(){var e=this.context.view,i=e.getController("annotation");i.clear(!0);var n=this.getInitialAnnotation();I(n,function(a){e.annotation()[a.type](a)}),e.render(!0)},t}(De),h7="pie-statistic";Ct(h7,N0t);Pt("pie-statistic-active",{start:[{trigger:"element:mouseenter",action:"pie-statistic:change"}],end:[{trigger:"element:mouseleave",action:"pie-statistic:reset"}]});Ct("pie-legend",B0t);Pt("pie-legend-active",{start:[{trigger:"legend-item:mouseenter",action:"pie-legend:active"}],end:[{trigger:"legend-item:mouseleave",action:"pie-legend:reset"}]});function k0t(r,t){var e=null;return I(r,function(i){typeof i[t]=="number"&&(e+=i[t])}),e}function U0t(r,t){var e;switch(r){case"inner":return e="-30%",mt(t)&&t.endsWith("%")?parseFloat(t)*.01>0?e:t:t<0?t:e;case"outer":return e=12,mt(t)&&t.endsWith("%")?parseFloat(t)*.01<0?e:t:t>0?t:e;default:return t}}function rm(r,t){return jm(uh(r,t),function(e){return e[t]===0})}function z0t(r){var t=r.chart,e=r.options,i=e.data,n=e.angleField,a=e.colorField,o=e.color,s=e.pieStyle,l=e.shape,u=uh(i,n);if(rm(u,n)){var c="$$percentage$$";u=u.map(function(f){var d;return S(S({},f),(d={},d[c]=1/u.length,d))}),t.data(u);var h=W({},r,{options:{xField:"1",yField:c,seriesField:a,isStack:!0,interval:{color:o,shape:l,style:s},args:{zIndexReversed:!0,sortZIndex:!0}}});ei(h)}else{t.data(u);var h=W({},r,{options:{xField:"1",yField:n,seriesField:a,isStack:!0,interval:{color:o,shape:l,style:s},args:{zIndexReversed:!0,sortZIndex:!0}}});ei(h)}return r}function H0t(r){var t,e=r.chart,i=r.options,n=i.meta,a=i.colorField,o=W({},n);return e.scale(o,(t={},t[a]={type:"cat"},t)),r}function $0t(r){var t=r.chart,e=r.options,i=e.radius,n=e.innerRadius,a=e.startAngle,o=e.endAngle;return t.coordinate({type:"theta",cfg:{radius:i,innerRadius:n,startAngle:a,endAngle:o}}),r}function W0t(r){var t=r.chart,e=r.options,i=e.label,n=e.colorField,a=e.angleField,o=t.geometries[0];if(!i)o.label(!1);else{var s=i.callback,l=zt(i,["callback"]),u=Lr(l);if(u.content){var c=u.content;u.content=function(v,p,g){var m=v[n],y=v[a],_=t.getScaleByField(a),x=_==null?void 0:_.scale(y);return ot(c)?c(S(S({},v),{percent:x}),p,g):mt(c)?w6(c,{value:y,name:m,percentage:Tt(x)&&!K(y)?"".concat((x*100).toFixed(2),"%"):null}):c}}var h={inner:"",outer:"pie-outer",spider:"pie-spider"},f=u.type?h[u.type]:"pie-outer",d=u.layout?q(u.layout)?u.layout:[u.layout]:[];u.layout=(f?[{type:f}]:[]).concat(d),o.label({fields:n?[a,n]:[a],callback:s,cfg:S(S({},u),{offset:U0t(u.type,u.offset),type:"pie"})})}return r}function f7(r){var t=r.innerRadius,e=r.statistic,i=r.angleField,n=r.colorField,a=r.meta,o=r.locale,s=Cy(o);if(t&&e){var l=W({},c7.statistic,e),u=l.title,c=l.content;return u!==!1&&(u=W({},{formatter:function(h){var f=h?h[n]:K(u.content)?s.get(["statistic","total"]):u.content,d=P(a,[n,"formatter"])||function(v){return v};return d(f)}},u)),c!==!1&&(c=W({},{formatter:function(h,f){var d=h?h[i]:k0t(f,i),v=P(a,[i,"formatter"])||function(p){return p};return h||K(c.content)?v(d):c.content}},c)),W({},{statistic:{title:u,content:c}},r)}return r}function d7(r){var t=r.chart,e=r.options,i=f7(e),n=i.innerRadius,a=i.statistic;return t.getController("annotation").clear(!0),Rt(We())(r),n&&a&&_y(t,{statistic:a,plotType:"pie"}),r}function V0t(r){var t=r.chart,e=r.options,i=e.tooltip,n=e.colorField,a=e.angleField,o=e.data;if(i===!1)t.tooltip(i);else if(t.tooltip(W({},i,{shared:!1})),rm(o,a)){var s=P(i,"fields"),l=P(i,"formatter");Mi(P(i,"fields"))&&(s=[n,a],l=l||function(u){return{name:u[n],value:cl(u[a])}}),t.geometries[0].tooltip(s.join("*"),dc(s,l))}return r}function G0t(r){var t=r.chart,e=r.options,i=f7(e),n=i.interactions,a=i.statistic,o=i.annotations;return I(n,function(s){var l,u;if(s.enable===!1)t.removeInteraction(s.type);else if(s.type==="pie-statistic-active"){var c=[];!((l=s.cfg)===null||l===void 0)&&l.start||(c=[{trigger:"element:mouseenter",action:"".concat(h7,":change"),arg:{statistic:a,annotations:o}}]),I((u=s.cfg)===null||u===void 0?void 0:u.start,function(h){c.push(S(S({},h),{arg:{statistic:a,annotations:o}}))}),t.interaction(s.type,W({},s.cfg,{start:c}))}else t.interaction(s.type,s.cfg||{})}),r}function v7(r){return Rt(Pn("pieStyle"),z0t,H0t,se,$0t,Bh,V0t,W0t,pl,d7,G0t,Ce)(r)}var p7=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="pie",e}return t.getDefaultOptions=function(){return c7},t.prototype.changeData=function(e){this.chart.emit(Ut.BEFORE_CHANGE_DATA,$e.fromData(this.chart,Ut.BEFORE_CHANGE_DATA,null));var i=this.options,n=this.options.angleField,a=uh(i.data,n),o=uh(e,n);rm(a,n)||rm(o,n)?this.update({data:e}):(this.updateOption({data:e}),this.chart.data(o),d7({chart:this.chart,options:this.options}),this.chart.render(!0)),this.chart.emit(Ut.AFTER_CHANGE_DATA,$e.fromData(this.chart,Ut.AFTER_CHANGE_DATA,null))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return v7},t}(Bt);const kWt=Object.freeze(Object.defineProperty({__proto__:null,Pie:p7},Symbol.toStringTag,{value:"Module"}));var g7=["#FAAD14","#E8EDF3"],X0t={percent:.2,color:g7,animation:{}};function ZA(r){var t=Oe(yu(r)?r:0,0,1);return[{current:"".concat(t),type:"current",percent:t},{current:"".concat(t),type:"target",percent:1}]}function m7(r){var t=r.chart,e=r.options,i=e.percent,n=e.progressStyle,a=e.color,o=e.barWidthRatio;t.data(ZA(i));var s=W({},r,{options:{xField:"current",yField:"percent",seriesField:"type",widthRatio:o,interval:{style:n,color:mt(a)?[a,g7[1]]:a},args:{zIndexReversed:!0,sortZIndex:!0}}});return ei(s),t.tooltip(!1),t.axis(!1),t.legend(!1),r}function Y0t(r){var t=r.chart;return t.coordinate("rect").transpose(),r}function y7(r){return Rt(m7,Je({}),Y0t,Ce,se,We())(r)}var j0t=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="process",e}return t.getDefaultOptions=function(){return X0t},t.prototype.changeData=function(e){this.updateOption({percent:e}),this.chart.changeData(ZA(e))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return y7},t}(Bt);function Z0t(r){var t=r.chart,e=r.options,i=e.innerRadius,n=e.radius;return t.coordinate("theta",{innerRadius:i,radius:n}),r}function _7(r,t){var e=r.chart,i=r.options,n=i.innerRadius,a=i.statistic,o=i.percent,s=i.meta;if(e.getController("annotation").clear(!0),n&&a){var l=P(s,["percent","formatter"])||function(c){return"".concat((c*100).toFixed(2),"%")},u=a.content;u&&(u=W({},u,{content:K(u.content)?l(o):u.content})),_y(e,{statistic:S(S({},a),{content:u}),plotType:"ring-progress"},{percent:o})}return t&&e.render(!0),r}function x7(r){return Rt(m7,Je({}),Z0t,_7,Ce,se,We())(r)}var q0t={percent:.2,innerRadius:.8,radius:.98,color:["#FAAD14","#E8EDF3"],statistic:{title:!1,content:{style:{fontSize:"14px",fontWeight:300,fill:"#4D4D4D",textAlign:"center",textBaseline:"middle"}}},animation:{}},K0t=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="ring-process",e}return t.getDefaultOptions=function(){return q0t},t.prototype.changeData=function(e){this.chart.emit(Ut.BEFORE_CHANGE_DATA,$e.fromData(this.chart,Ut.BEFORE_CHANGE_DATA,null)),this.updateOption({percent:e}),this.chart.data(ZA(e)),_7({chart:this.chart,options:this.options},!0),this.chart.emit(Ut.AFTER_CHANGE_DATA,$e.fromData(this.chart,Ut.AFTER_CHANGE_DATA,null))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return x7},t}(Bt),Q0t={exp:Q$,linear:J$,loess:tW,log:eW,poly:rW,pow:iW,quad:nW};function J0t(r,t){var e=10,i={regionStyle:[{position:{start:[r,"max"],end:["max",t]},style:{fill:"#d8d0c0",opacity:.4}},{position:{start:["min","max"],end:[r,t]},style:{fill:"#a3dda1",opacity:.4}},{position:{start:["min",t],end:[r,"min"]},style:{fill:"#d8d0c0",opacity:.4}},{position:{start:[r,t],end:["max","min"]},style:{fill:"#a3dda1",opacity:.4}}],lineStyle:{stroke:"#9ba29a",lineWidth:1},labelStyle:[{position:["max",t],offsetX:-e,offsetY:-e,style:{textAlign:"right",textBaseline:"bottom",fontSize:14,fill:"#ccc"}},{position:["min",t],offsetX:e,offsetY:-e,style:{textAlign:"left",textBaseline:"bottom",fontSize:14,fill:"#ccc"}},{position:["min",t],offsetX:e,offsetY:e,style:{textAlign:"left",textBaseline:"top",fontSize:14,fill:"#ccc"}},{position:["max",t],offsetX:-e,offsetY:e,style:{textAlign:"right",textBaseline:"top",fontSize:14,fill:"#ccc"}}]};return i}var tmt=function(r,t){var e=t.view,i=t.options,n=i.xField,a=i.yField,o=e.getScaleByField(n),s=e.getScaleByField(a),l=r.map(function(u){return e.getCoordinate().convert({x:o.scale(u[0]),y:s.scale(u[1])})});return tgt(l,!1)},emt=function(r){var t=r.options,e=t.xField,i=t.yField,n=t.data,a=t.regressionLine,o=a.type,s=o===void 0?"linear":o,l=a.algorithm,u=a.equation,c,h=null;if(l)c=q(l)?l:l(n),h=u;else{var f=Q0t[s]().x(function(d){return d[e]}).y(function(d){return d[i]});c=f(n),h=imt(s,c)}return[tmt(c,r),h]},rmt=function(r){var t,e=r.meta,i=e===void 0?{}:e,n=r.xField,a=r.yField,o=r.data,s=o[0][n],l=o[0][a],u=s>0,c=l>0;function h(f,d){var v=P(i,[f]);function p(m){return P(v,m)}var g={};return d==="x"?(Tt(s)&&(Tt(p("min"))||(g.min=u?0:s*2),Tt(p("max"))||(g.max=u?s*2:0)),g):(Tt(l)&&(Tt(p("min"))||(g.min=c?0:l*2),Tt(p("max"))||(g.max=c?l*2:0)),g)}return S(S({},i),(t={},t[n]=S(S({},i[n]),h(n,"x")),t[a]=S(S({},i[a]),h(a,"y")),t))};function imt(r,t){var e,i,n,a=function(u,c){return c===void 0&&(c=4),Math.round(u*Math.pow(10,c))/Math.pow(10,c)},o=function(u){return Number.isFinite(u)?a(u):"?"};switch(r){case"linear":return"y = ".concat(o(t.a),"x + ").concat(o(t.b),", R^2 = ").concat(o(t.rSquared));case"exp":return"y = ".concat(o(t.a),"e^(").concat(o(t.b),"x), R^2 = ").concat(o(t.rSquared));case"log":return"y = ".concat(o(t.a),"ln(x) + ").concat(o(t.b),", R^2 = ").concat(o(t.rSquared));case"quad":return"y = ".concat(o(t.a),"x^2 + ").concat(o(t.b),"x + ").concat(o(t.c),", R^2 = ").concat(o(t.rSquared));case"poly":for(var s="y = ".concat(o((e=t.coefficients)===null||e===void 0?void 0:e[0])," + ").concat(o((i=t.coefficients)===null||i===void 0?void 0:i[1]),"x + ").concat(o((n=t.coefficients)===null||n===void 0?void 0:n[2]),"x^2"),l=3;l<t.coefficients.length;++l)s+=" + ".concat(o(t.coefficients[l]),"x^").concat(l);return"".concat(s,", R^2 = ").concat(o(t.rSquared));case"pow":return"y = ".concat(o(t.a),"x^").concat(o(t.b),", R^2 = ").concat(o(t.rSquared))}return null}function C7(r){var t=r.data,e=t===void 0?[]:t,i=r.xField,n=r.yField;if(e.length){for(var a=!0,o=!0,s=e[0],l=void 0,u=1;u<e.length&&(l=e[u],s[i]!==l[i]&&(a=!1),s[n]!==l[n]&&(o=!1),!(!a&&!o));u++)s=l;var c=[];a&&c.push(i),o&&c.push(n);var h=ye(rmt(r),c);return W({},r,{meta:h})}return r}function nmt(r){var t=r.chart,e=r.options,i=e.data,n=e.type,a=e.color,o=e.shape,s=e.pointStyle,l=e.shapeField,u=e.colorField,c=e.xField,h=e.yField,f=e.sizeField,d=e.size,v=e.tooltip;f&&(d||(d=[2,8]),Tt(d)&&(d=[d,d])),v&&!v.fields&&(v=S(S({},v),{fields:[c,h,u,f,l]})),t.data(i),Fn(W({},r,{options:{seriesField:u,point:{color:a,shape:o,size:d,style:s},tooltip:v}}));var p=ti(t,"point");return n&&p.adjust(n),r}function t0(r){var t,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField,o=e.yField,s=C7(e);return Rt(Je((t={},t[a]=i,t[o]=n,t)))(W({},r,{options:s}))}function amt(r){var t=r.chart,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField,o=e.yField;return t.axis(a,i),t.axis(o,n),r}function omt(r){var t=r.chart,e=r.options,i=e.legend,n=e.colorField,a=e.shapeField,o=e.sizeField,s=e.shapeLegend,l=e.sizeLegend,u=i!==!1;return n&&t.legend(n,u?i:!1),a&&(s?t.legend(a,s):t.legend(a,s===!1?!1:i)),o&&t.legend(o,l||!1),!u&&!s&&!l&&t.legend(!1),r}function smt(r){var t=r.chart,e=r.options,i=e.label,n=e.yField,a=ti(t,"point");if(!i)a.label(!1);else{var o=i.callback,s=zt(i,["callback"]);a.label({fields:[n],callback:o,cfg:Lr(s)})}return r}function lmt(r){var t=r.options,e=t.quadrant,i=[];if(e){var n=e.xBaseline,a=n===void 0?0:n,o=e.yBaseline,s=o===void 0?0:o,l=e.labels,u=e.regionStyle,c=e.lineStyle,h=J0t(a,s),f=new Array(4).join(",").split(",");f.forEach(function(d,v){i.push(S(S({type:"region",top:!1},h.regionStyle[v].position),{style:W({},h.regionStyle[v].style,u==null?void 0:u[v])}),S({type:"text",top:!0},W({},h.labelStyle[v],l==null?void 0:l[v])))}),i.push({type:"line",top:!1,start:["min",s],end:["max",s],style:W({},h.lineStyle,c)},{type:"line",top:!1,start:[a,"min"],end:[a,"max"],style:W({},h.lineStyle,c)})}return Rt(We(i))(r)}function umt(r){var t=r.options,e=r.chart,i=t.regressionLine;if(i){var n=i.style,a=i.equationStyle,o=a===void 0?{}:a,s=i.top,l=s===void 0?!1:s,u=i.showEquation,c=u===void 0?!1:u,h={stroke:"#9ba29a",lineWidth:2,opacity:.5},f={x:20,y:20,textAlign:"left",textBaseline:"middle",fontSize:14,fillOpacity:.5};e.annotation().shape({top:l,render:function(d,v){var p=d.addGroup({id:"".concat(e.id,"-regression-line"),name:"regression-line-group"}),g=emt({view:v,options:t}),m=g[0],y=g[1];p.addShape("path",{name:"regression-line",attrs:S(S({path:m},h),n)}),c&&p.addShape("text",{name:"regression-equation",attrs:S(S(S({},f),o),{text:y})})}})}return r}function cmt(r){var t=r.chart,e=r.options,i=e.tooltip;return i?t.tooltip(i):i===!1&&t.tooltip(!1),r}function E7(r){return Rt(nmt,t0,amt,omt,cmt,smt,z6,qv,$A,ze,lmt,Ce,se,umt)(r)}var hmt=W({},Bt.getDefaultOptions(),{size:4,tooltip:{showTitle:!1,showMarkers:!1,showCrosshairs:!0,crosshairs:{type:"xy"}}});Pt("drag-move",{start:[{trigger:"plot:mousedown",action:"scale-translate:start"}],processing:[{trigger:"plot:mousemove",action:"scale-translate:translate",throttle:{wait:100,leading:!0,trailing:!1}}],end:[{trigger:"plot:mouseup",action:"scale-translate:end"}]});var S7=function(r){N(t,r);function t(e,i){var n=r.call(this,e,i)||this;return n.type="scatter",n.on(Ut.BEFORE_RENDER,function(a){var o,s,l=n,u=l.options,c=l.chart;if(((o=a.data)===null||o===void 0?void 0:o.source)===Di.FILTER){var h=n.chart.filterData(n.chart.getData());t0({chart:c,options:S(S({},u),{data:h})})}((s=a.data)===null||s===void 0?void 0:s.source)===Di.RESET&&t0({chart:c,options:u})}),n}return t.getDefaultOptions=function(){return hmt},t.prototype.changeData=function(e){this.updateOption(C7(W({},this.options,{data:e})));var i=this,n=i.options,a=i.chart;t0({chart:a,options:n}),this.chart.changeData(e)},t.prototype.getSchemaAdaptor=function(){return E7},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t}(Bt);const UWt=Object.freeze(Object.defineProperty({__proto__:null,Scatter:S7},Symbol.toStringTag,{value:"Module"}));var Ud="$$stock-range$$",by="trend",A7="up",T7="down",fmt={showMarkers:!1,showCrosshairs:!0,shared:!0,crosshairs:{type:"xy",follow:!0,text:function(r,t,e){var i;if(r==="x"){var n=e[0];i=n?n.title:t}else i=t;return{position:r==="y"?"start":"end",content:i,style:{fill:"#dfdfdf"}}},textBackground:{padding:[2,4],style:{fill:"#666"}}}},dmt=W({},Bt.getDefaultOptions(),{tooltip:fmt,interactions:[{type:"tooltip"}],legend:{position:"top-left"},risingFill:"#ef5350",fallingFill:"#26a69a"});function b7(r,t){return Ne(r,function(e){var i=e&&S({},e);if(q(t)&&i){var n=t[0],a=t[1],o=t[2],s=t[3];i[by]=i[n]<=i[a]?A7:T7,i[Ud]=[i[n],i[a],i[o],i[s]]}return i})}function vmt(r){var t=r.chart,e=r.options,i=e.yField,n=e.data,a=e.risingFill,o=e.fallingFill,s=e.tooltip,l=e.stockStyle;t.data(b7(n,i));var u=s;return u!==!1&&(u=W({},{fields:i},u)),WA(W({},r,{options:{schema:{shape:"candle",color:[a,o],style:l},yField:Ud,seriesField:by,rawFields:i,tooltip:u}})),r}function pmt(r){var t,e,i=r.chart,n=r.options,a=n.meta,o=n.xAxis,s=n.yAxis,l=n.xField,u=(t={},t[l]={type:"timeCat",tickCount:6},t[by]={values:[A7,T7]},t),c=W(u,a,(e={},e[l]=ye(o,Xi),e[Ud]=ye(s,Xi),e));return i.scale(c),r}function gmt(r){var t=r.chart,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField;return i===!1?t.axis(a,!1):t.axis(a,i),n===!1?t.axis(Ud,!1):t.axis(Ud,n),r}function mmt(r){var t=r.chart,e=r.options,i=e.tooltip;return i!==!1?t.tooltip(i):t.tooltip(!1),r}function ymt(r){var t=r.chart,e=r.options,i=e.legend;return i?t.legend(by,i):i===!1&&t.legend(!1),r}function w7(r){Rt(se,vmt,pmt,gmt,mmt,ymt,ze,Ce,We(),qv)(r)}var _mt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="stock",e}return t.getDefaultOptions=function(){return dmt},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return w7},t.prototype.changeData=function(e){this.updateOption({data:e});var i=this.options.yField;this.chart.changeData(b7(e,i))},t}(Bt);function $u(r){return Ne(r||[],function(t,e){return{x:"".concat(e),y:t}})}var zd="x",Nc="y",R7={showTitle:!1,shared:!0,showMarkers:!1,customContent:function(r,t){return"".concat(P(t,[0,"data","y"],0))},containerTpl:'<div class="g2-tooltip"><div class="g2-tooltip-list"></div></div>',itemTpl:"<span>{value}</span>",domStyles:{"g2-tooltip":{padding:"2px 4px",fontSize:"10px"}},showCrosshairs:!0,crosshairs:{type:"x"}},xmt={appendPadding:2,tooltip:S({},R7),animation:{}};function Cmt(r){var t=r.chart,e=r.options,i=e.data,n=e.color,a=e.areaStyle,o=e.point,s=e.line,l=o==null?void 0:o.state,u=$u(i);t.data(u);var c=W({},r,{options:{xField:zd,yField:Nc,area:{color:n,style:a},line:s,point:o}}),h=W({},c,{options:{tooltip:!1}}),f=W({},c,{options:{tooltip:!1,state:l}});return Ey(c),Dh(h),Fn(f),t.axis(!1),t.legend(!1),r}function Nh(r){var t,e,i=r.options,n=i.xAxis,a=i.yAxis,o=i.data,s=$u(o);return Rt(Je((t={},t[zd]=n,t[Nc]=a,t),(e={},e[zd]={type:"cat"},e[Nc]=NA(s,Nc),e)))(r)}function M7(r){return Rt(Pn("areaStyle"),Cmt,Nh,Cr,se,Ce,We())(r)}var Emt={appendPadding:2,tooltip:S({},R7),color:"l(90) 0:#E5EDFE 1:#ffffff",areaStyle:{fillOpacity:.6},line:{size:1,color:"#5B8FF9"},animation:{}},Smt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="tiny-area",e}return t.getDefaultOptions=function(){return Emt},t.prototype.changeData=function(e){this.updateOption({data:e});var i=this,n=i.chart,a=i.options;Nh({chart:n,options:a}),n.changeData($u(e))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return M7},t}(Bt);function Amt(r){var t=r.chart,e=r.options,i=e.data,n=e.color,a=e.columnStyle,o=e.columnWidthRatio,s=$u(i);t.data(s);var l=W({},r,{options:{xField:zd,yField:Nc,widthRatio:o,interval:{style:a,color:n}}});return ei(l),t.axis(!1),t.legend(!1),t.interaction("element-active"),r}function I7(r){return Rt(se,Pn("columnStyle"),Amt,Nh,Cr,Ce,We())(r)}var Tmt={showTitle:!1,shared:!0,showMarkers:!1,customContent:function(r,t){return"".concat(P(t,[0,"data","y"],0))},containerTpl:'<div class="g2-tooltip"><div class="g2-tooltip-list"></div></div>',itemTpl:"<span>{value}</span>",domStyles:{"g2-tooltip":{padding:"2px 4px",fontSize:"10px"}}},bmt={appendPadding:2,tooltip:S({},Tmt),animation:{}},wmt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="tiny-column",e}return t.getDefaultOptions=function(){return bmt},t.prototype.changeData=function(e){this.updateOption({data:e});var i=this,n=i.chart,a=i.options;Nh({chart:n,options:a}),n.changeData($u(e))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return I7},t}(Bt);function Rmt(r){var t=r.chart,e=r.options,i=e.data,n=e.color,a=e.lineStyle,o=e.point,s=o==null?void 0:o.state,l=$u(i);t.data(l);var u=W({},r,{options:{xField:zd,yField:Nc,line:{color:n,style:a},point:o}}),c=W({},u,{options:{tooltip:!1,state:s}});return Dh(u),Fn(c),t.axis(!1),t.legend(!1),r}function L7(r){return Rt(Rmt,Nh,se,Cr,Ce,We())(r)}var Mmt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="tiny-line",e}return t.getDefaultOptions=function(){return xmt},t.prototype.changeData=function(e){this.updateOption({data:e});var i=this,n=i.chart,a=i.options;Nh({chart:n,options:a}),n.changeData($u(e))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return L7},t}(Bt),Imt={line:N6,pie:v7,column:Ty,bar:$6,area:k6,gauge:a7,"tiny-line":L7,"tiny-column":I7,"tiny-area":M7,"ring-progress":x7,progress:y7,scatter:E7,histogram:l7,funnel:K6,stock:w7},Lmt={line:u7,pie:p7,column:V6,bar:W6,area:U6,gauge:o7,"tiny-line":Mmt,"tiny-column":wmt,"tiny-area":Smt,"ring-progress":K0t,progress:j0t,scatter:S7,histogram:L0t,funnel:Q6,stock:_mt},Omt={pie:{label:!1},column:{tooltip:{showMarkers:!1}},bar:{tooltip:{showMarkers:!1}}};function hC(r,t,e){var i=Lmt[r];if(!i){console.error("could not find ".concat(r," plot"));return}var n=Imt[r];n({chart:t,options:W({},i.getDefaultOptions(),P(Omt,r,{}),e)})}function Pmt(r){var t=r.chart,e=r.options,i=e.views,n=e.legend;return I(i,function(a){var o=a.region,s=a.data,l=a.meta,u=a.axes,c=a.coordinate,h=a.interactions,f=a.annotations,d=a.tooltip,v=a.geometries,p=t.createView({region:o});p.data(s);var g={};u&&I(u,function(m,y){g[y]=ye(m,Xi)}),g=W({},l,g),p.scale(g),u?I(u,function(m,y){p.axis(y,m)}):p.axis(!1),p.coordinate(c),I(v,function(m){var y=cn({chart:p,options:m}).ext,_=m.adjust;_&&y.geometry.adjust(_)}),I(h,function(m){m.enable===!1?p.removeInteraction(m.type):p.interaction(m.type,m.cfg)}),I(f,function(m){p.annotation()[m.type](S({},m))}),typeof a.animation=="boolean"?p.animate(!1):(p.animate(!0),I(p.geometries,function(m){m.animate(a.animation)})),d&&(p.interaction("tooltip"),p.tooltip(d))}),n?I(n,function(a,o){t.legend(o,a)}):t.legend(!1),t.tooltip(e.tooltip),r}function Fmt(r){var t=r.chart,e=r.options,i=e.plots,n=e.data,a=n===void 0?[]:n;return I(i,function(o){var s=o.type,l=o.region,u=o.options,c=u===void 0?{}:u,h=o.top,f=c.tooltip;if(h){hC(s,t,S(S({},c),{data:a}));return}var d=t.createView(S({region:l},ye(c,P6)));f&&d.interaction("tooltip"),hC(s,d,S({data:a},c))}),r}function Bmt(r){var t=r.chart,e=r.options;return t.option("slider",e.slider),r}function Dmt(r){return Rt(Ce,Pmt,Fmt,ze,Ce,se,Cr,Bmt,We())(r)}function Nmt(r,t){var e=r.getModel(),i=e.data,n;return q(i)?n=i[0][t]:n=i[t],n}function kmt(r){var t=J0(r);I(t,function(e){e.hasState("active")&&e.setState("active",!1),e.hasState("selected")&&e.setState("selected",!1),e.hasState("inactive")&&e.setState("inactive",!1)})}var Umt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getAssociationItems=function(e,i){var n,a=this.context.event,o=i||{},s=o.linkField,l=o.dim,u=[];if(!((n=a.data)===null||n===void 0)&&n.data){var c=a.data.data;I(e,function(h){var f,d,v=s;if(l==="x"?v=h.getXScale().field:l==="y"?v=(f=h.getYScales().find(function(g){return g.field===v}))===null||f===void 0?void 0:f.field:v||(v=(d=h.getGroupScales()[0])===null||d===void 0?void 0:d.field),!!v){var p=Ne(J0(h),function(g){var m=!1,y=!1,_=q(c)?P(c[0],v):P(c,v);return Nmt(g,v)===_?m=!0:y=!0,{element:g,view:h,active:m,inactive:y}});u.push.apply(u,p)}})}return u},t.prototype.showTooltip=function(e){var i=LI(this.context.view),n=this.getAssociationItems(i,e);I(n,function(a){if(a.active){var o=a.element.shape.getCanvasBBox();a.view.showTooltip({x:o.minX+o.width/2,y:o.minY+o.height/2})}})},t.prototype.hideTooltip=function(){var e=LI(this.context.view);I(e,function(i){i.hideTooltip()})},t.prototype.active=function(e){var i=Uf(this.context.view),n=this.getAssociationItems(i,e);I(n,function(a){var o=a.active,s=a.element;o&&s.setState("active",!0)})},t.prototype.selected=function(e){var i=Uf(this.context.view),n=this.getAssociationItems(i,e);I(n,function(a){var o=a.active,s=a.element;o&&s.setState("selected",!0)})},t.prototype.highlight=function(e){var i=Uf(this.context.view),n=this.getAssociationItems(i,e);I(n,function(a){var o=a.inactive,s=a.element;o&&s.setState("inactive",!0)})},t.prototype.reset=function(){var e=Uf(this.context.view);I(e,function(i){kmt(i)})},t}(De);Ct("association",Umt);Pt("association-active",{start:[{trigger:"element:mouseenter",action:"association:active"}],end:[{trigger:"element:mouseleave",action:"association:reset"}]});Pt("association-selected",{start:[{trigger:"element:mouseenter",action:"association:selected"}],end:[{trigger:"element:mouseleave",action:"association:reset"}]});Pt("association-highlight",{start:[{trigger:"element:mouseenter",action:"association:highlight"}],end:[{trigger:"element:mouseleave",action:"association:reset"}]});Pt("association-tooltip",{start:[{trigger:"element:mousemove",action:"association:showTooltip"}],end:[{trigger:"element:mouseleave",action:"association:hideTooltip"}]});var zmt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="mix",e}return t.prototype.getSchemaAdaptor=function(){return Dmt},t}(Bt);const zWt=Object.freeze(Object.defineProperty({__proto__:null,Mix:zmt},Symbol.toStringTag,{value:"Module"}));var BI;(function(r){r.DEV="DEV",r.BETA="BETA",r.STABLE="STABLE"})(BI||(BI={}));var xo="first-axes-view",Co="second-axes-view",Vl="series-field-key";function O7(r,t,e,i,n){var a=[];t.forEach(function(h){i.forEach(function(f){var d,v=(d={},d[r]=f[r],d[e]=h,d[h]=f[h],d);a.push(v)})});var o=Object.values(Qi(a,e)),s=o[0],l=s===void 0?[]:s,u=o[1],c=u===void 0?[]:u;return n?[l.reverse(),c.reverse()]:[l,c]}function jo(r){return r!=="vertical"}function Hmt(r,t,e){var i=t[0],n=t[1],a=i.autoPadding,o=n.autoPadding,s=r.__axisPosition,l=s.layout,u=s.position;if(jo(l)&&u==="top"&&(i.autoPadding=e.instance(a.top,0,a.bottom,a.left),n.autoPadding=e.instance(o.top,a.left,o.bottom,0)),jo(l)&&u==="bottom"&&(i.autoPadding=e.instance(a.top,a.right/2+5,a.bottom,a.left),n.autoPadding=e.instance(o.top,o.right,o.bottom,a.right/2+5)),!jo(l)&&u==="bottom"){var c=a.left>=o.left?a.left:o.left;i.autoPadding=e.instance(a.top,a.right,a.bottom/2+5,c),n.autoPadding=e.instance(a.bottom/2+5,o.right,o.bottom,c)}if(!jo(l)&&u==="top"){var c=a.left>=o.left?a.left:o.left;i.autoPadding=e.instance(a.top,a.right,0,c),n.autoPadding=e.instance(0,o.right,a.top,c)}}function $mt(r){var t=r.chart,e=r.options,i=e.data,n=e.xField,a=e.yField,o=e.color,s=e.barStyle,l=e.widthRatio,u=e.legend,c=e.layout,h=O7(n,a,Vl,i,jo(c));u?t.legend(Vl,u):u===!1&&t.legend(!1);var f,d,v=h[0],p=h[1];jo(c)?(f=t.createView({region:{start:{x:0,y:0},end:{x:.5,y:1}},id:xo}),f.coordinate().transpose().reflect("x"),d=t.createView({region:{start:{x:.5,y:0},end:{x:1,y:1}},id:Co}),d.coordinate().transpose(),f.data(v),d.data(p)):(f=t.createView({region:{start:{x:0,y:0},end:{x:1,y:.5}},id:xo}),d=t.createView({region:{start:{x:0,y:.5},end:{x:1,y:1}},id:Co}),d.coordinate().reflect("y"),f.data(v),d.data(p));var g=W({},r,{chart:f,options:{widthRatio:l,xField:n,yField:a[0],seriesField:Vl,interval:{color:o,style:s}}});ei(g);var m=W({},r,{chart:d,options:{xField:n,yField:a[1],seriesField:Vl,widthRatio:l,interval:{color:o,style:s}}});return ei(m),r}function Wmt(r){var t,e,i,n=r.options,a=r.chart,o=n.xAxis,s=n.yAxis,l=n.xField,u=n.yField,c=Ht(a,xo),h=Ht(a,Co),f={};return Du((n==null?void 0:n.meta)||{}).map(function(d){P(n==null?void 0:n.meta,[d,"alias"])&&(f[d]=n.meta[d].alias)}),a.scale((t={},t[Vl]={sync:!0,formatter:function(d){return P(f,d,d)}},t)),Je((e={},e[l]=o,e[u[0]]=s[u[0]],e))(W({},r,{chart:c})),Je((i={},i[l]=o,i[u[1]]=s[u[1]],i))(W({},r,{chart:h})),r}function Vmt(r){var t=r.chart,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField,o=e.yField,s=e.layout,l=Ht(t,xo),u=Ht(t,Co);return(i==null?void 0:i.position)==="bottom"?u.axis(a,S(S({},i),{label:{formatter:function(){return""}}})):u.axis(a,!1),i===!1?l.axis(a,!1):l.axis(a,S({position:jo(s)?"top":"bottom"},i)),n===!1?(l.axis(o[0],!1),u.axis(o[1],!1)):(l.axis(o[0],n[o[0]]),u.axis(o[1],n[o[1]])),t.__axisPosition={position:l.getOptions().axes[a].position,layout:s},r}function Gmt(r){var t=r.chart;return ze(W({},r,{chart:Ht(t,xo)})),ze(W({},r,{chart:Ht(t,Co)})),r}function Xmt(r){var t=r.chart,e=r.options,i=e.yField,n=e.yAxis;return _u(W({},r,{chart:Ht(t,xo),options:{yAxis:n[i[0]]}})),_u(W({},r,{chart:Ht(t,Co),options:{yAxis:n[i[1]]}})),r}function Ymt(r){var t=r.chart;return se(W({},r,{chart:Ht(t,xo)})),se(W({},r,{chart:Ht(t,Co)})),se(r),r}function jmt(r){var t=r.chart;return Ce(W({},r,{chart:Ht(t,xo)})),Ce(W({},r,{chart:Ht(t,Co)})),r}function Zmt(r){var t=this,e,i,n=r.chart,a=r.options,o=a.label,s=a.yField,l=a.layout,u=Ht(n,xo),c=Ht(n,Co),h=ti(u,"interval"),f=ti(c,"interval");if(!o)h.label(!1),f.label(!1);else{var d=o.callback,v=zt(o,["callback"]);v.position||(v.position="middle"),v.offset===void 0&&(v.offset=2);var p=S({},v);if(jo(l)){var g=((e=p.style)===null||e===void 0?void 0:e.textAlign)||(v.position==="middle"?"center":"left");v.style=W({},v.style,{textAlign:g});var m={left:"right",right:"left",center:"center"};p.style=W({},p.style,{textAlign:m[g]})}else{var y={top:"bottom",bottom:"top",middle:"middle"};typeof v.position=="string"?v.position=y[v.position]:typeof v.position=="function"&&(v.position=function(){for(var C=[],A=0;A<arguments.length;A++)C[A]=arguments[A];return y[v.position.apply(t,C)]});var _=((i=p.style)===null||i===void 0?void 0:i.textBaseline)||"bottom";p.style=W({},p.style,{textBaseline:_});var x={top:"bottom",bottom:"top",middle:"middle"};v.style=W({},v.style,{textBaseline:x[_]})}h.label({fields:[s[0]],callback:d,cfg:Lr(p)}),f.label({fields:[s[1]],callback:d,cfg:Lr(v)})}return r}function qmt(r){return Rt($mt,Wmt,Vmt,Xmt,Ymt,Zmt,Cr,Gmt,jmt)(r)}var Kmt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="bidirectional-bar",e}return t.getDefaultOptions=function(){return W({},r.getDefaultOptions.call(this),{syncViewPadding:Hmt})},t.prototype.changeData=function(e){e===void 0&&(e=[]),this.chart.emit(Ut.BEFORE_CHANGE_DATA,$e.fromData(this.chart,Ut.BEFORE_CHANGE_DATA,null)),this.updateOption({data:e});var i=this.options,n=i.xField,a=i.yField,o=i.layout,s=O7(n,a,Vl,e,jo(o)),l=s[0],u=s[1],c=Ht(this.chart,xo),h=Ht(this.chart,Co);c.data(l),h.data(u),this.chart.render(!0),this.chart.emit(Ut.AFTER_CHANGE_DATA,$e.fromData(this.chart,Ut.AFTER_CHANGE_DATA,null))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return qmt},t.SERIES_FIELD_KEY=Vl,t}(Bt);const HWt=Object.freeze(Object.defineProperty({__proto__:null,BidirectionalBar:Kmt},Symbol.toStringTag,{value:"Module"}));var p1,ch="$$range$$",Qmt="low-q1-median-q3-high",Jmt="$$y_outliers$$",P7="outliers_view",tyt=W({},Bt.getDefaultOptions(),{meta:(p1={},p1[ch]={min:0,alias:Qmt},p1),interactions:[{type:"active-region"}],tooltip:{showMarkers:!1,shared:!0},boxStyle:{lineWidth:1}}),F7=function(r,t){var e=r;if(Array.isArray(t)){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4];e=Ne(r,function(l){return l[ch]=[l[i],l[n],l[a],l[o],l[s]],l})}return e};function eyt(r){var t=r.chart,e=r.options,i=e.xField,n=e.yField,a=e.groupField,o=e.color,s=e.tooltip,l=e.boxStyle;t.data(F7(e.data,n));var u=q(n)?ch:n,c=n?q(n)?n:[n]:[],h=s;h!==!1&&(h=W({},{fields:q(n)?n:[]},h));var f=WA(W({},r,{options:{xField:i,yField:u,seriesField:a,tooltip:h,rawFields:c,label:!1,schema:{shape:"box",color:o,style:l}}})).ext;return a&&f.geometry.adjust("dodge"),r}function ryt(r){var t=r.chart,e=r.options,i=e.xField,n=e.data,a=e.outliersField,o=e.outliersStyle,s=e.padding,l=e.label;if(!a)return r;var u=t.createView({padding:s,id:P7}),c=n.reduce(function(h,f){var d=f[a];return d.forEach(function(v){var p;return h.push(S(S({},f),(p={},p[a]=v,p)))}),h},[]);return u.data(c),Fn({chart:u,options:{xField:i,yField:a,point:{shape:"circle",style:o},label:l}}),u.axis(!1),r}function iyt(r){var t,e,i=r.chart,n=r.options,a=n.meta,o=n.xAxis,s=n.yAxis,l=n.xField,u=n.yField,c=n.outliersField,h=Array.isArray(u)?ch:u,f={};if(c){var d=Jmt;f=(t={},t[c]={sync:d,nice:!0},t[h]={sync:d,nice:!0},t)}var v=W(f,a,(e={},e[l]=ye(o,Xi),e[h]=ye(s,Xi),e));return i.scale(v),r}function nyt(r){var t=r.chart,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField,o=e.yField,s=Array.isArray(o)?ch:o;return i===!1?t.axis(a,!1):t.axis(a,i),n===!1?t.axis(ch,!1):t.axis(s,n),r}function ayt(r){var t=r.chart,e=r.options,i=e.legend,n=e.groupField;return n?i?t.legend(n,i):t.legend(n,{position:"bottom"}):t.legend(!1),r}function oyt(r){return Rt(eyt,ryt,iyt,nyt,ayt,Cr,We(),ze,Ce,se)(r)}(function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="box",e}return t.getDefaultOptions=function(){return tyt},t.prototype.changeData=function(e){this.updateOption({data:e});var i=this.options.yField,n=this.chart.views.find(function(a){return a.id===P7});n&&n.data(e),this.chart.changeData(F7(e,i))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return oyt},t})(Bt);function DI(r,t,e){return r.length>1?"".concat(t,"_").concat(e):"".concat(t)}function B7(r){var t=r.data,e=r.xField,i=r.measureField,n=r.rangeField,a=r.targetField,o=r.layout,s=[],l=[];t.forEach(function(h,f){var d=[h[n]].flat();d.sort(function(g,m){return g-m}),d.forEach(function(g,m){var y,_=m===0?g:d[m]-d[m-1];s.push((y={rKey:"".concat(n,"_").concat(m)},y[e]=e?h[e]:String(f),y[n]=_,y))});var v=[h[i]].flat();v.forEach(function(g,m){var y;s.push((y={mKey:DI(v,i,m)},y[e]=e?h[e]:String(f),y[i]=g,y))});var p=[h[a]].flat();p.forEach(function(g,m){var y;s.push((y={tKey:DI(p,a,m)},y[e]=e?h[e]:String(f),y[a]=g,y))}),l.push(h[n],h[i],h[a])});var u=Math.min.apply(Math,l.flat(1/0)),c=Math.max.apply(Math,l.flat(1/0));return u=u>0?0:u,o==="vertical"&&s.reverse(),{min:u,max:c,ds:s}}function syt(r){var t=r.chart,e=r.options,i=e.bulletStyle,n=e.targetField,a=e.rangeField,o=e.measureField,s=e.xField,l=e.color,u=e.layout,c=e.size,h=e.label,f=B7(e),d=f.min,v=f.max,p=f.ds;t.data(p);var g=W({},r,{options:{xField:s,yField:a,seriesField:"rKey",isStack:!0,label:P(h,"range"),interval:{color:P(l,"range"),style:P(i,"range"),size:P(c,"range")}}});ei(g),t.geometries[0].tooltip(!1);var m=W({},r,{options:{xField:s,yField:o,seriesField:"mKey",isStack:!0,label:P(h,"measure"),interval:{color:P(l,"measure"),style:P(i,"measure"),size:P(c,"measure")}}});ei(m);var y=W({},r,{options:{xField:s,yField:n,seriesField:"tKey",label:P(h,"target"),point:{color:P(l,"target"),style:P(i,"target"),size:ot(P(c,"target"))?function(_){return P(c,"target")(_)/2}:P(c,"target")/2,shape:u==="horizontal"?"line":"hyphen"}}});return Fn(y),u==="horizontal"&&t.coordinate().transpose(),S(S({},r),{ext:{data:{min:d,max:v}}})}function D7(r){var t,e,i=r.options,n=r.ext,a=i.xAxis,o=i.yAxis,s=i.targetField,l=i.rangeField,u=i.measureField,c=i.xField,h=n.data;return Rt(Je((t={},t[c]=a,t[u]=o,t),(e={},e[u]={min:h==null?void 0:h.min,max:h==null?void 0:h.max,sync:!0},e[s]={sync:"".concat(u)},e[l]={sync:"".concat(u)},e)))(r)}function lyt(r){var t=r.chart,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField,o=e.measureField,s=e.rangeField,l=e.targetField;return t.axis("".concat(s),!1),t.axis("".concat(l),!1),i===!1?t.axis("".concat(a),!1):t.axis("".concat(a),i),n===!1?t.axis("".concat(o),!1):t.axis("".concat(o),n),r}function uyt(r){var t=r.chart,e=r.options,i=e.legend;return t.removeInteraction("legend-filter"),t.legend(i),t.legend("rKey",!1),t.legend("mKey",!1),t.legend("tKey",!1),r}function cyt(r){var t=r.chart,e=r.options,i=e.label,n=e.measureField,a=e.targetField,o=e.rangeField,s=t.geometries,l=s[0],u=s[1],c=s[2];return P(i,"range")?l.label("".concat(o),S({layout:[{type:"limit-in-plot"}]},Lr(i.range))):l.label(!1),P(i,"measure")?u.label("".concat(n),S({layout:[{type:"limit-in-plot"}]},Lr(i.measure))):u.label(!1),P(i,"target")?c.label("".concat(a),S({layout:[{type:"limit-in-plot"}]},Lr(i.target))):c.label(!1),r}function hyt(r){Rt(syt,D7,lyt,uyt,se,cyt,Cr,ze,Ce)(r)}var fyt=W({},Bt.getDefaultOptions(),{layout:"horizontal",size:{range:30,measure:20,target:20},xAxis:{tickLine:!1,line:null},bulletStyle:{range:{fillOpacity:.5}},label:{measure:{position:"right"}},tooltip:{showMarkers:!1}}),dyt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="bullet",e}return t.getDefaultOptions=function(){return fyt},t.prototype.changeData=function(e){this.updateOption({data:e});var i=B7(this.options),n=i.min,a=i.max,o=i.ds;D7({options:this.options,ext:{data:{min:n,max:a}},chart:this.chart}),this.chart.changeData(o)},t.prototype.getSchemaAdaptor=function(){return hyt},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t}(Bt);const $Wt=Object.freeze(Object.defineProperty({__proto__:null,Bullet:dyt},Symbol.toStringTag,{value:"Module"}));var vyt={y:0,nodeWidthRatio:.05,weight:!1,nodePaddingRatio:.1,id:function(r){return r.id},source:function(r){return r.source},target:function(r){return r.target},sourceWeight:function(r){return r.value||1},targetWeight:function(r){return r.value||1},sortBy:null};function pyt(r,t,e){I(r,function(i,n){i.inEdges=t.filter(function(a){return"".concat(e.target(a))==="".concat(n)}),i.outEdges=t.filter(function(a){return"".concat(e.source(a))==="".concat(n)}),i.edges=i.outEdges.concat(i.inEdges),i.frequency=i.edges.length,i.value=0,i.inEdges.forEach(function(a){i.value+=e.targetWeight(a)}),i.outEdges.forEach(function(a){i.value+=e.sourceWeight(a)})})}function gyt(r,t){var e={weight:function(n,a){return a.value-n.value},frequency:function(n,a){return a.frequency-n.frequency},id:function(n,a){return"".concat(t.id(n)).localeCompare("".concat(t.id(a)))}},i=e[t.sortBy];!i&&ot(t.sortBy)&&(i=t.sortBy),i&&r.sort(i)}function myt(r,t){var e=r.length;if(!e)throw new TypeError("Invalid nodes: it's empty!");if(t.weight){var i=t.nodePaddingRatio;if(i<0||i>=1)throw new TypeError("Invalid nodePaddingRatio: it must be in range [0, 1)!");var n=i/(2*e),a=t.nodeWidthRatio;if(a<=0||a>=1)throw new TypeError("Invalid nodeWidthRatio: it must be in range (0, 1)!");var o=0;r.forEach(function(l){o+=l.value}),r.forEach(function(l){l.weight=l.value/o,l.width=l.weight*(1-i),l.height=a}),r.forEach(function(l,u){for(var c=0,h=u-1;h>=0;h--)c+=r[h].width+2*n;var f=l.minX=n+c,d=l.maxX=l.minX+l.width,v=l.minY=t.y-a/2,p=l.maxY=v+a;l.x=[f,d,d,f],l.y=[v,v,p,p]})}else{var s=1/e;r.forEach(function(l,u){l.x=(u+.5)*s,l.y=t.y})}return r}function yyt(r,t,e){if(e.weight){var i={};I(r,function(n,a){i[a]=n.value}),t.forEach(function(n){var a=e.source(n),o=e.target(n),s=r[a],l=r[o];if(s&&l){var u=i[a],c=e.sourceWeight(n),h=s.minX+(s.value-u)/s.value*s.width,f=h+c/s.value*s.width;i[a]-=c;var d=i[o],v=e.targetWeight(n),p=l.minX+(l.value-d)/l.value*l.width,g=p+v/l.value*l.width;i[o]-=v;var m=e.y;n.x=[h,f,p,g],n.y=[m,m,m,m],n.source=s,n.target=l}})}else t.forEach(function(n){var a=r[e.source(n)],o=r[e.target(n)];a&&o&&(n.x=[a.x,o.x],n.y=[a.y,o.y],n.source=a,n.target=o)});return t}function _yt(r){return ne({},vyt,r)}function xyt(r,t){var e=_yt(r),i={},n=t.nodes,a=t.links;n.forEach(function(l){var u=e.id(l);i[u]=l}),pyt(i,a,e),gyt(n,e);var o=myt(n,e),s=yyt(i,a,e);return{nodes:o,links:s}}var N7="x",k7="y",U7="name",z7="source",Cyt={nodeStyle:{opacity:1,fillOpacity:1,lineWidth:1},edgeStyle:{opacity:.5,lineWidth:2},label:{fields:["x","name"],callback:function(r,t){var e=(r[0]+r[1])/2,i=e>.5?-4:4;return{offsetX:i,content:t}},labelEmit:!0,style:{fill:"#8c8c8c"}},tooltip:{showTitle:!1,showMarkers:!1,fields:["source","target","value","isNode"],showContent:function(r){return!P(r,[0,"data","isNode"])},formatter:function(r){var t=r.source,e=r.target,i=r.value;return{name:"".concat(t," -> ").concat(e),value:i}}},interactions:[{type:"element-active"}],weight:!0,nodePaddingRatio:.1,nodeWidthRatio:.05};function Eyt(r){var t=r.options,e=t.data,i=t.sourceField,n=t.targetField,a=t.weightField,o=t.nodePaddingRatio,s=t.nodeWidthRatio,l=t.rawFields,u=l===void 0?[]:l,c=E6(e,i,n,a),h=xyt({weight:!0,nodePaddingRatio:o,nodeWidthRatio:s},c),f=h.nodes,d=h.links,v=f.map(function(g){return S(S({},ye(g,xt(["id","x","y","name"],u,!0))),{isNode:!0})}),p=d.map(function(g){return S(S({source:g.source.name,target:g.target.name,name:g.source.name||g.target.name},ye(g,xt(["x","y","value"],u,!0))),{isNode:!1})});return S(S({},r),{ext:S(S({},r.ext),{chordData:{nodesData:v,edgesData:p}})})}function Syt(r){var t,e=r.chart;return e.scale((t={x:{sync:!0,nice:!0},y:{sync:!0,nice:!0,max:1}},t[U7]={sync:"color"},t[z7]={sync:"color"},t)),r}function Ayt(r){var t=r.chart;return t.axis(!1),r}function Tyt(r){var t=r.chart;return t.legend(!1),r}function byt(r){var t=r.chart,e=r.options,i=e.tooltip;return t.tooltip(i),r}function wyt(r){var t=r.chart;return t.coordinate("polar").reflect("y"),r}function Ryt(r){var t=r.chart,e=r.options,i=r.ext.chordData.nodesData,n=e.nodeStyle,a=e.label,o=e.tooltip,s=t.createView();return s.data(i),Sy({chart:s,options:{xField:N7,yField:k7,seriesField:U7,polygon:{style:n},label:a,tooltip:o}}),r}function Myt(r){var t=r.chart,e=r.options,i=r.ext.chordData.edgesData,n=e.edgeStyle,a=e.tooltip,o=t.createView();o.data(i);var s={xField:N7,yField:k7,seriesField:z7,edge:{style:n,shape:"arc"},tooltip:a};return O6({chart:o,options:s}),r}function Iyt(r){var t=r.chart,e=r.options,i=e.animation;return Zv(t,i,jpt(t)),r}function Lyt(r){return Rt(se,Eyt,wyt,Syt,Ayt,Tyt,byt,Myt,Ryt,ze,pl,Iyt)(r)}(function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="chord",e}return t.getDefaultOptions=function(){return Cyt},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return Lyt},t})(Bt);var Oyt=["x","y","r","name","value","path","depth"],Pyt={colorField:"name",autoFit:!0,pointStyle:{lineWidth:0,stroke:"#fff"},legend:!1,hierarchyConfig:{size:[1,1],padding:0},label:{fields:["name"],layout:{type:"limit-in-shape"}},tooltip:{showMarkers:!1,showTitle:!1},drilldown:{enabled:!1}},NI=4,Fyt=0,kI=5,UI="drilldown-bread-crumb",Byt={position:"top-left",dividerText:"/",textStyle:{fontSize:12,fill:"rgba(0, 0, 0, 0.65)",cursor:"pointer"},activeTextStyle:{fill:"#87B5FF"}},Hd="hierarchy-data-transform-params",Dyt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.name="drill-down",e.historyCache=[],e.breadCrumbGroup=null,e.breadCrumbCfg=Byt,e}return t.prototype.click=function(){var e=P(this.context,["event","data","data"]);if(!e)return!1;this.drill(e),this.drawBreadCrumb()},t.prototype.resetPosition=function(){if(this.breadCrumbGroup){var e=this.context.view.getCoordinate(),i=this.breadCrumbGroup,n=i.getBBox(),a=this.getButtonCfg().position,o={x:e.start.x,y:e.end.y-(n.height+kI*2)};e.isPolar&&(o={x:0,y:0}),a==="bottom-left"&&(o={x:e.start.x,y:e.start.y});var s=nn.transform(null,[["t",o.x+Fyt,o.y+n.height+kI]]);i.setMatrix(s)}},t.prototype.back=function(){xr(this.historyCache)&&this.backTo(this.historyCache.slice(0,-1))},t.prototype.reset=function(){this.historyCache[0]&&this.backTo(this.historyCache.slice(0,1)),this.historyCache=[],this.hideCrumbGroup()},t.prototype.drill=function(e){var i=this.context.view,n=P(i,["interactions","drill-down","cfg","transformData"],function(u){return u}),a=n(S({data:e.data},e[Hd]));i.changeData(a);for(var o=[],s=e;s;){var l=s.data;o.unshift({id:"".concat(l.name,"_").concat(s.height,"_").concat(s.depth),name:l.name,children:n(S({data:l},e[Hd]))}),s=s.parent}this.historyCache=(this.historyCache||[]).slice(0,-1).concat(o)},t.prototype.backTo=function(e){if(!(!e||e.length<=0)){var i=this.context.view,n=cr(e).children;i.changeData(n),e.length>1?(this.historyCache=e,this.drawBreadCrumb()):(this.historyCache=[],this.hideCrumbGroup())}},t.prototype.getButtonCfg=function(){var e=this.context.view,i=P(e,["interactions","drill-down","cfg","drillDownConfig"]);return W(this.breadCrumbCfg,i==null?void 0:i.breadCrumb,this.cfg)},t.prototype.drawBreadCrumb=function(){this.drawBreadCrumbGroup(),this.resetPosition(),this.breadCrumbGroup.show()},t.prototype.drawBreadCrumbGroup=function(){var e=this,i=this.getButtonCfg(),n=this.historyCache;this.breadCrumbGroup?this.breadCrumbGroup.clear():this.breadCrumbGroup=this.context.view.foregroundGroup.addGroup({name:UI});var a=0;n.forEach(function(o,s){var l=e.breadCrumbGroup.addShape({type:"text",id:o.id,name:"".concat(UI,"_").concat(o.name,"_text"),attrs:S(S({text:s===0&&!K(i.rootText)?i.rootText:o.name},i.textStyle),{x:a,y:0})}),u=l.getBBox();if(a+=u.width+NI,l.on("click",function(f){var d,v=f.target.get("id");if(v!==((d=cr(n))===null||d===void 0?void 0:d.id)){var p=n.slice(0,n.findIndex(function(g){return g.id===v})+1);e.backTo(p)}}),l.on("mouseenter",function(f){var d,v=f.target.get("id");v!==((d=cr(n))===null||d===void 0?void 0:d.id)?l.attr(i.activeTextStyle):l.attr({cursor:"default"})}),l.on("mouseleave",function(){l.attr(i.textStyle)}),s<n.length-1){var c=e.breadCrumbGroup.addShape({type:"text",name:"".concat(i.name,"_").concat(o.name,"_divider"),attrs:S(S({text:i.dividerText},i.textStyle),{x:a,y:0})}),h=c.getBBox();a+=h.width+NI}})},t.prototype.hideCrumbGroup=function(){this.breadCrumbGroup&&this.breadCrumbGroup.hide()},t.prototype.destroy=function(){this.breadCrumbGroup&&this.breadCrumbGroup.remove(),r.prototype.destroy.call(this)},t}(De),H7="nodeIndex",$7="childNodeCount",qA="nodeAncestor",g1="Invalid field: it must be a string!";function KA(r,t){var e=r.field,i=r.fields;if(mt(e))return e;if(q(e))return console.warn(g1),e[0];if(console.warn("".concat(g1," will try to get fields instead.")),mt(i))return i;if(q(i)&&i.length)return i[0];if(t)return t;throw new TypeError(g1)}function QA(r){var t=[];if(r&&r.each){var e,i;r.each(function(n){var a,o;n.parent!==e?(e=n.parent,i=0):i+=1;var s=Fr((((a=n.ancestors)===null||a===void 0?void 0:a.call(n))||[]).map(function(l){return t.find(function(u){return u.name===l.name})||l}),function(l){var u=l.depth;return u>0&&u<n.depth});n[qA]=s,n[$7]=((o=n.children)===null||o===void 0?void 0:o.length)||0,n[H7]=i,t.push(n)})}else r&&r.eachNode&&r.eachNode(function(n){t.push(n)});return t}var Nyt={field:"value",as:["x","y","r"],sort:function(r,t){return t.value-r.value}};function kyt(r,t){t=ne({},Nyt,t);var e=t.as;if(!q(e)||e.length!==3)throw new TypeError('Invalid as: it must be an array with 3 strings (e.g. [ "x", "y", "r" ])!');var i;try{i=KA(t)}catch(u){console.warn(u)}var n=function(u){return aW().size(t.size).padding(t.padding)(kE(u).sum(function(c){return c[i]}).sort(t.sort))},a=n(r),o=e[0],s=e[1],l=e[2];return a.each(function(u){u[o]=u.x,u[s]=u.y,u[l]=u.r}),QA(a)}function W7(r){var t=r.data,e=r.hierarchyConfig,i=r.rawFields,n=i===void 0?[]:i,a=r.enableDrillDown,o=kyt(t,S(S({},e),{field:"value",as:["x","y","r"]})),s=[];return o.forEach(function(l){for(var u,c=l.data.name,h=S({},l);h.depth>1;)c="".concat((u=h.parent.data)===null||u===void 0?void 0:u.name," / ").concat(c),h=h.parent;if(a&&l.depth>2)return null;var f=W({},l.data,S(S(S({},ye(l.data,n)),{path:c}),l));f.ext=e,f[Hd]={hierarchyConfig:e,rawFields:n,enableDrillDown:a},s.push(f)}),s}function V7(r,t,e){var i=kA([r,t]),n=i[0],a=i[1],o=i[2],s=i[3],l=e.width,u=e.height,c=l-(s+a),h=u-(n+o),f=Math.min(c,h),d=(c-f)/2,v=(h-f)/2,p=n+v,g=a+d,m=o+v,y=s+d,_=[p,g,m,y],x=f<0?0:f;return{finalPadding:_,finalSize:x}}function Uyt(r){var t=r.chart,e=Math.min(t.viewBBox.width,t.viewBBox.height);return W({options:{size:function(i){var n=i.r;return n*e}}},r)}function zyt(r){var t=r.options,e=r.chart,i=e.viewBBox,n=t.padding,a=t.appendPadding,o=t.drilldown,s=a;if(o!=null&&o.enabled){var l=yy(e.appendPadding,P(o,["breadCrumb","position"]));s=kA([l,a])}var u=V7(n,s,i).finalPadding;return e.padding=u,e.appendPadding=0,r}function Hyt(r){var t=r.chart,e=r.options,i=t.padding,n=t.appendPadding,a=e.color,o=e.colorField,s=e.pointStyle,l=e.hierarchyConfig,u=e.sizeField,c=e.rawFields,h=c===void 0?[]:c,f=e.drilldown,d=W7({data:e.data,hierarchyConfig:l,enableDrillDown:f==null?void 0:f.enabled,rawFields:h});t.data(d);var v=t.viewBBox,p=V7(i,n,v).finalSize,g=function(m){var y=m.r;return y*p};return u&&(g=function(m){return m[u]*p}),Fn(W({},r,{options:{xField:"x",yField:"y",seriesField:o,sizeField:u,rawFields:xt(xt([],Oyt,!0),h,!0),point:{color:a,style:s,shape:"circle",size:g}}})),r}function $yt(r){return Rt(Je({},{x:{min:0,max:1,minLimit:0,maxLimit:1,nice:!0},y:{min:0,max:1,minLimit:0,maxLimit:1,nice:!0}}))(r)}function Wyt(r){var t=r.chart,e=r.options,i=e.tooltip;if(i===!1)t.tooltip(!1);else{var n=i;P(i,"fields")||(n=W({},{customItems:function(a){return a.map(function(o){var s=P(t.getOptions(),"scales"),l=P(s,["name","formatter"],function(c){return c}),u=P(s,["value","formatter"],function(c){return c});return S(S({},o),{name:l(o.data.name),value:u(o.data.value)})})}},n)),t.tooltip(n)}return r}function Vyt(r){var t=r.chart;return t.axis(!1),r}function Gyt(r){var t=r.drilldown,e=r.interactions,i=e===void 0?[]:e;return t!=null&&t.enabled?W({},r,{interactions:xt(xt([],i,!0),[{type:"drill-down",cfg:{drillDownConfig:t,transformData:W7,enableDrillDown:!0}}],!1)}):r}function Xyt(r){var t=r.chart,e=r.options;return ze({chart:t,options:Gyt(e)}),r}function Yyt(r){return Rt(Pn("pointStyle"),Uyt,zyt,se,$yt,Hyt,Vyt,Bh,Wyt,Xyt,Ce,We())(r)}function zI(r){var t=P(r,["event","data","data"],{});return q(t.children)&&t.children.length>0}function HI(r){var t=r.view.getCoordinate(),e=t.innerRadius;if(e){var i=r.event,n=i.x,a=i.y,o=t.center,s=o.x,l=o.y,u=t.getRadius()*e,c=Math.sqrt(Math.pow(s-n,2)+Math.pow(l-a,2));return c<u}return!1}Ct("drill-down-action",Dyt);Pt("drill-down",{showEnable:[{trigger:"element:mouseenter",action:"cursor:pointer",isEnable:zI},{trigger:"element:mouseleave",action:"cursor:default"},{trigger:"element:mouseleave",action:"cursor:pointer",isEnable:HI}],start:[{trigger:"element:click",isEnable:zI,action:["drill-down-action:click"]},{trigger:"afterchangesize",action:["drill-down-action:resetPosition"]},{trigger:"click",isEnable:HI,action:["drill-down-action:back"]}]});var jyt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="circle-packing",e}return t.getDefaultOptions=function(){return Pyt},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return Yyt},t.prototype.triggerResize=function(){this.chart.destroyed||(this.chart.forceFit(),this.chart.clear(),this.execAdaptor(),this.chart.render(!0))},t}(Bt);const WWt=Object.freeze(Object.defineProperty({__proto__:null,CirclePacking:jyt},Symbol.toStringTag,{value:"Module"}));var Bn="left-axes-view",Dn="right-axes-view",G7={nice:!0,label:{autoHide:!0,autoRotate:!1}},Zyt=S(S({},G7),{position:"left"}),qyt=S(S({},G7),{position:"right",grid:null}),hh;(function(r){r.Left="Left",r.Right="Right"})(hh||(hh={}));var xu;(function(r){r.Line="line",r.Column="column"})(xu||(xu={}));function fC(r){return P(r,"geometry")===xu.Line}function JA(r){return P(r,"geometry")===xu.Column}function $I(r,t,e){return JA(e)?W({},{geometry:xu.Column,label:e.label&&e.isRange?{content:function(i){var n;return(n=i[t])===null||n===void 0?void 0:n.join("-")}}:void 0},e):S({geometry:xu.Line},e)}function WI(r,t){var e=r[0],i=r[1];if(q(t)){var n=t[0],a=t[1];return[n,a]}var o=P(t,e),s=P(t,i);return[o,s]}function VI(r,t){return t===hh.Left?r===!1?!1:W({},Zyt,r):t===hh.Right?r===!1?!1:W({},qyt,r):r}function Kyt(r){var t=r.options,e=r.chart,i=t.geometryOption,n=i.isStack,a=i.color,o=i.seriesField,s=i.groupField,l=i.isGroup,u=["xField","yField"];if(fC(i)){Dh(W({},r,{options:S(S(S({},ye(t,u)),i),{line:{color:i.color,style:i.lineStyle}})})),Fn(W({},r,{options:S(S(S({},ye(t,u)),i),{point:i.point&&S({color:a,shape:"circle"},i.point)})}));var c=[];l&&c.push({type:"dodge",dodgeBy:s||o,customOffset:0}),n&&c.push({type:"stack"}),c.length&&I(e.geometries,function(h){h.adjust(c)})}return JA(i)&&Ty(W({},r,{options:S(S(S({},ye(t,u)),i),{widthRatio:i.columnWidthRatio,interval:S(S({},ye(i,["color"])),{style:i.columnStyle})})})),r}function GI(r){var t=r.view,e=r.geometryOption,i=r.yField,n=r.legend,a=P(n,"marker"),o=ti(t,fC(e)?"line":"interval");if(!e.seriesField){var s=P(t,"options.scales.".concat(i,".alias"))||i,l=o.getAttribute("color"),u=t.getTheme().defaultColor;l&&(u=nn.getMappingValue(l,s,P(l,["values",0],u)));var c=(ot(a)?a:!Mi(a)&&W({},{style:{stroke:u,fill:u}},a))||(fC(e)?{symbol:function(f,d,v){return[["M",f-v,d],["L",f+v,d]]},style:{lineWidth:2,r:6,stroke:u}}:{symbol:"square",style:{fill:u}});return[{value:i,name:s,marker:c,isGeometry:!0,viewId:t.id}]}var h=o.getGroupAttributes();return Qr(h,function(f,d){var v=nn.getLegendItems(t,o,d,t.getTheme(),a);return f.concat(v)},[])}var XI=function(r,t){var e=t[0],i=t[1],n=r.getOptions().data,a=r.getXScale(),o=xr(n);if(!(!a||!o)){var s=ea(n,a.field),l=s,u=xr(l),c=Math.round(e*(u-1)),h=Math.round(i*(u-1));r.filter(a.field,function(f){var d=l.indexOf(f);return d>-1?qpt(d,c,h):!0}),r.getRootView().render(!0)}};function Qyt(r){var t,e=r.options,i=e.geometryOptions,n=i===void 0?[]:i,a=e.xField,o=e.yField,s=jm(n,function(l){var u=l.geometry;return u===xu.Line||u===void 0});return W({},{options:{geometryOptions:[],meta:(t={},t[a]={type:"cat",sync:!0,range:s?[0,1]:void 0},t),tooltip:{showMarkers:s,showCrosshairs:s,shared:!0,crosshairs:{type:"x"}},interactions:s?[{type:"legend-visible-filter"}]:[{type:"legend-visible-filter"},{type:"active-region"}],legend:{position:"top-left"}}},r,{options:{yAxis:WI(o,e.yAxis),geometryOptions:[$I(a,o[0],n[0]),$I(a,o[1],n[1])],annotations:WI(o,e.annotations)}})}function Jyt(r){var t,e,i=r.chart,n=r.options,a=n.geometryOptions,o={line:0,column:1},s=[{type:(t=a[0])===null||t===void 0?void 0:t.geometry,id:Bn},{type:(e=a[1])===null||e===void 0?void 0:e.geometry,id:Dn}];return s.sort(function(l,u){return-o[l.type]+o[u.type]}).forEach(function(l){return i.createView({id:l.id})}),r}function t_t(r){var t=r.chart,e=r.options,i=e.xField,n=e.yField,a=e.geometryOptions,o=e.data,s=e.tooltip,l=[S(S({},a[0]),{id:Bn,data:o[0],yField:n[0]}),S(S({},a[1]),{id:Dn,data:o[1],yField:n[1]})];return l.forEach(function(u){var c=u.id,h=u.data,f=u.yField,d=JA(u)&&u.isPercent,v=d?F6(h,f,i,f):h,p=Ht(t,c).data(v),g=d?S({formatter:function(m){return{name:m[u.seriesField]||f,value:(Number(m[f])*100).toFixed(2)+"%"}}},s):s;Kyt({chart:p,options:{xField:i,yField:f,tooltip:g,geometryOption:u}})}),r}function e_t(r){var t,e=r.chart,i=r.options,n=i.geometryOptions,a=((t=e.getTheme())===null||t===void 0?void 0:t.colors10)||[],o=0;return e.once("beforepaint",function(){I(n,function(s,l){var u=Ht(e,l===0?Bn:Dn);if(!s.color){var c=u.getGroupScales(),h=P(c,[0,"values","length"],1),f=a.slice(o,o+h).concat(l===0?[]:a);u.geometries.forEach(function(d){s.seriesField?d.color(s.seriesField,f):d.color(f[0])}),o+=h}}),e.render(!0)}),r}function r_t(r){var t,e,i=r.chart,n=r.options,a=n.xAxis,o=n.yAxis,s=n.xField,l=n.yField;return Je((t={},t[s]=a,t[l[0]]=o[0],t))(W({},r,{chart:Ht(i,Bn)})),Je((e={},e[s]=a,e[l[1]]=o[1],e))(W({},r,{chart:Ht(i,Dn)})),r}function i_t(r){var t=r.chart,e=r.options,i=Ht(t,Bn),n=Ht(t,Dn),a=e.xField,o=e.yField,s=e.xAxis,l=e.yAxis;return t.axis(a,!1),t.axis(o[0],!1),t.axis(o[1],!1),i.axis(a,s),i.axis(o[0],VI(l[0],hh.Left)),n.axis(a,!1),n.axis(o[1],VI(l[1],hh.Right)),r}function n_t(r){var t=r.chart,e=r.options,i=e.tooltip,n=Ht(t,Bn),a=Ht(t,Dn);return t.tooltip(i),n.tooltip({shared:!0}),a.tooltip({shared:!0}),r}function a_t(r){var t=r.chart;return ze(W({},r,{chart:Ht(t,Bn)})),ze(W({},r,{chart:Ht(t,Dn)})),r}function o_t(r){var t=r.chart,e=r.options,i=e.annotations,n=P(i,[0]),a=P(i,[1]);return We(n)(W({},r,{chart:Ht(t,Bn),options:{annotations:n}})),We(a)(W({},r,{chart:Ht(t,Dn),options:{annotations:a}})),r}function s_t(r){var t=r.chart;return se(W({},r,{chart:Ht(t,Bn)})),se(W({},r,{chart:Ht(t,Dn)})),se(r),r}function l_t(r){var t=r.chart;return Ce(W({},r,{chart:Ht(t,Bn)})),Ce(W({},r,{chart:Ht(t,Dn)})),r}function u_t(r){var t=r.chart,e=r.options,i=e.yAxis;return _u(W({},r,{chart:Ht(t,Bn),options:{yAxis:i[0]}})),_u(W({},r,{chart:Ht(t,Dn),options:{yAxis:i[1]}})),r}function c_t(r){var t=r.chart,e=r.options,i=e.legend,n=e.geometryOptions,a=e.yField,o=e.data,s=Ht(t,Bn),l=Ht(t,Dn);if(i===!1)t.legend(!1);else if(ie(i)&&i.custom===!0)t.legend(i);else{var u=P(n,[0,"legend"],i),c=P(n,[1,"legend"],i);t.once("beforepaint",function(){var h=o[0].length?GI({view:s,geometryOption:n[0],yField:a[0],legend:u}):[],f=o[1].length?GI({view:l,geometryOption:n[1],yField:a[1],legend:c}):[];t.legend(W({},i,{custom:!0,items:h.concat(f)}))}),n[0].seriesField&&s.legend(n[0].seriesField,u),n[1].seriesField&&l.legend(n[1].seriesField,c),t.on("legend-item:click",function(h){var f=P(h,"gEvent.delegateObject",{});if(f&&f.item){var d=f.item,v=d.value,p=d.isGeometry,g=d.viewId;if(p){var m=AS(a,function(x){return x===v});if(m>-1){var y=P(Ht(t,g),"geometries");I(y,function(x){x.changeVisible(!f.item.unchecked)})}}else{var _=P(t.getController("legend"),"option.items",[]);I(t.views,function(x){var C=x.getGroupScales();I(C,function(A){A.values&&A.values.indexOf(v)>-1&&x.filter(A.field,function(b){var R=Qn(_,function(M){return M.value===b});return!R.unchecked})}),t.render(!0)})}}})}return r}function h_t(r){var t=r.chart,e=r.options,i=e.slider,n=Ht(t,Bn),a=Ht(t,Dn);return i&&(n.option("slider",i),n.on("slider:valuechanged",function(o){var s=o.event,l=s.value,u=s.originValue;qt(l,u)||XI(a,l)}),t.once("afterpaint",function(){if(!os(i)){var o=i.start,s=i.end;(o||s)&&XI(a,[o,s])}})),r}function f_t(r){return Rt(Qyt,Jyt,s_t,t_t,r_t,i_t,u_t,n_t,a_t,o_t,l_t,e_t,c_t,h_t)(r)}var d_t=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="dual-axes",e}return t.prototype.getDefaultOptions=function(){return W({},r.prototype.getDefaultOptions.call(this),{yAxis:[],syncViewPadding:!0})},t.prototype.getSchemaAdaptor=function(){return f_t},t}(Bt);const VWt=Object.freeze(Object.defineProperty({__proto__:null,DualAxes:d_t},Symbol.toStringTag,{value:"Module"}));function v_t(r,t){var e=t.data,i=t.coordinate,n=t.interactions,a=t.annotations,o=t.animation,s=t.tooltip,l=t.axes,u=t.meta,c=t.geometries;e&&r.data(e);var h={};l&&I(l,function(f,d){h[d]=ye(f,Xi)}),h=W({},u,h),r.scale(h),i&&r.coordinate(i),l===!1?r.axis(!1):I(l,function(f,d){r.axis(d,f)}),I(c,function(f){var d=cn({chart:r,options:f}).ext,v=f.adjust;v&&d.geometry.adjust(v)}),I(n,function(f){f.enable===!1?r.removeInteraction(f.type):r.interaction(f.type,f.cfg)}),I(a,function(f){r.annotation()[f.type](S({},f))}),Zv(r,o),s?(r.interaction("tooltip"),r.tooltip(s)):s===!1&&r.removeInteraction("tooltip")}function p_t(r){var t=r.chart,e=r.options,i=e.type,n=e.data,a=e.fields,o=e.eachView,s=Rv(e,["type","data","fields","eachView","axes","meta","tooltip","coordinate","theme","legend","interactions","annotations"]);return t.data(n),t.facet(i,S(S({},s),{fields:a,eachView:function(l,u){var c=o(l,u);if(c.geometries)v_t(l,c);else{var h=c,f=h.options;f.tooltip&&l.interaction("tooltip"),hC(h.type,l,f)}}})),r}function g_t(r){var t=r.chart,e=r.options,i=e.axes,n=e.meta,a=e.tooltip,o=e.coordinate,s=e.theme,l=e.legend,u=e.interactions,c=e.annotations,h={};return i&&I(i,function(f,d){h[d]=ye(f,Xi)}),h=W({},n,h),t.scale(h),t.coordinate(o),i?I(i,function(f,d){t.axis(d,f)}):t.axis(!1),a?(t.interaction("tooltip"),t.tooltip(a)):a===!1&&t.removeInteraction("tooltip"),t.legend(l),s&&t.theme(s),I(u,function(f){f.enable===!1?t.removeInteraction(f.type):t.interaction(f.type,f.cfg)}),I(c,function(f){t.annotation()[f.type](S({},f))}),r}function m_t(r){return Rt(se,p_t,g_t)(r)}var y_t={title:{style:{fontSize:12,fill:"rgba(0,0,0,0.65)"}},rowTitle:{style:{fontSize:12,fill:"rgba(0,0,0,0.65)"}},columnTitle:{style:{fontSize:12,fill:"rgba(0,0,0,0.65)"}}};(function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="area",e}return t.getDefaultOptions=function(){return y_t},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return m_t},t})(Bt);function __t(r){var t=r.chart,e=r.options,i=e.data,n=e.type,a=e.xField,o=e.yField,s=e.colorField,l=e.sizeField,u=e.sizeRatio,c=e.shape,h=e.color,f=e.tooltip,d=e.heatmapStyle,v=e.meta;t.data(i);var p="polygon";n==="density"&&(p="heatmap");var g=ha(f,[a,o,s]),m=g.fields,y=g.formatter,_=1;return(u||u===0)&&(!c&&!l?console.warn("sizeRatio is not in effect: Must define shape or sizeField first"):u<0||u>1?console.warn("sizeRatio is not in effect: It must be a number in [0,1]"):_=u),cn(W({},r,{options:{type:p,colorField:s,tooltipFields:m,shapeField:l||"",label:void 0,mapping:{tooltip:y,shape:c&&(l?function(x){var C=i.map(function(M){return M[l]}),A=(v==null?void 0:v[l])||{},b=A.min,R=A.max;return b=Tt(b)?b:Math.min.apply(Math,C),R=Tt(R)?R:Math.max.apply(Math,C),[c,(P(x,l)-b)/(R-b),_]}:function(){return[c,1,_]}),color:h||s&&t.getTheme().sequenceColors.join("-"),style:d}}})),r}function x_t(r){var t,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField,o=e.yField;return Rt(Je((t={},t[a]=i,t[o]=n,t)))(r)}function C_t(r){var t=r.chart,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField,o=e.yField;return i===!1?t.axis(a,!1):t.axis(a,i),n===!1?t.axis(o,!1):t.axis(o,n),r}function E_t(r){var t=r.chart,e=r.options,i=e.legend,n=e.colorField,a=e.sizeField,o=e.sizeLegend,s=i!==!1;return n&&t.legend(n,s?i:!1),a&&t.legend(a,o===void 0?i:o),!s&&!o&&t.legend(!1),r}function S_t(r){var t=r.chart,e=r.options,i=e.label,n=e.colorField,a=e.type,o=ti(t,a==="density"?"heatmap":"polygon");if(!i)o.label(!1);else if(n){var s=i.callback,l=zt(i,["callback"]);o.label({fields:[n],callback:s,cfg:Lr(l)})}return r}function A_t(r){var t,e,i=r.chart,n=r.options,a=n.coordinate,o=n.reflect,s=W({actions:[]},a??{type:"rect"});return o&&((e=(t=s.actions)===null||t===void 0?void 0:t.push)===null||e===void 0||e.call(t,["reflect",o])),i.coordinate(s),r}function T_t(r){return Rt(se,Pn("heatmapStyle"),x_t,A_t,__t,C_t,E_t,Cr,S_t,We(),ze,Ce,pl)(r)}var b_t=W({},Bt.getDefaultOptions(),{type:"polygon",legend:!1,coordinate:{type:"rect"},xAxis:{tickLine:null,line:null,grid:{alignTick:!1,line:{style:{lineWidth:1,lineDash:null,stroke:"#f0f0f0"}}}},yAxis:{grid:{alignTick:!1,line:{style:{lineWidth:1,lineDash:null,stroke:"#f0f0f0"}}}}});de("polygon","circle",{draw:function(r,t){var e,i,n=r.x,a=r.y,o=this.parsePoints(r.points),s=Math.abs(o[2].x-o[1].x),l=Math.abs(o[1].y-o[0].y),u=Math.min(s,l)/2,c=Number(r.shape[1]),h=Number(r.shape[2]),f=Math.sqrt(h),d=u*f*Math.sqrt(c),v=((e=r.style)===null||e===void 0?void 0:e.fill)||r.color||((i=r.defaultStyle)===null||i===void 0?void 0:i.fill),p=t.addShape("circle",{attrs:S(S(S({x:n,y:a,r:d},r.defaultStyle),r.style),{fill:v})});return p}});de("polygon","square",{draw:function(r,t){var e,i,n=r.x,a=r.y,o=this.parsePoints(r.points),s=Math.abs(o[2].x-o[1].x),l=Math.abs(o[1].y-o[0].y),u=Math.min(s,l),c=Number(r.shape[1]),h=Number(r.shape[2]),f=Math.sqrt(h),d=u*f*Math.sqrt(c),v=((e=r.style)===null||e===void 0?void 0:e.fill)||r.color||((i=r.defaultStyle)===null||i===void 0?void 0:i.fill),p=t.addShape("rect",{attrs:S(S(S({x:n-d/2,y:a-d/2,width:d,height:d},r.defaultStyle),r.style),{fill:v})});return p}});var w_t=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="heatmap",e}return t.getDefaultOptions=function(){return b_t},t.prototype.getSchemaAdaptor=function(){return T_t},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t}(Bt);const GWt=Object.freeze(Object.defineProperty({__proto__:null,Heatmap:w_t},Symbol.toStringTag,{value:"Module"}));var R_t="liquid";function X7(r){return[{percent:r,type:R_t}]}function M_t(r){var t=r.chart,e=r.options,i=e.percent,n=e.liquidStyle,a=e.radius,o=e.outline,s=e.wave,l=e.shape,u=e.shapeStyle,c=e.animation;t.scale({percent:{min:0,max:1}}),t.data(X7(i));var h=e.color||t.getTheme().defaultColor,f=W({},r,{options:{xField:"type",yField:"percent",widthRatio:a,interval:{color:h,style:n,shape:"liquid-fill-gauge"}}}),d=ei(f).ext,v=d.geometry,p=t.getTheme().background,g={percent:i,radius:a,outline:o,wave:s,shape:l,shapeStyle:u,background:p,animation:c};return v.customInfo(g),t.legend(!1),t.axis(!1),t.tooltip(!1),r}function Y7(r,t){var e=r.chart,i=r.options,n=i.statistic,a=i.percent,o=i.meta;e.getController("annotation").clear(!0);var s=P(o,["percent","formatter"])||function(u){return"".concat((u*100).toFixed(2),"%")},l=n.content;return l&&(l=W({},l,{content:K(l.content)?s(a):l.content})),_y(e,{statistic:S(S({},n),{content:l}),plotType:"liquid"},{percent:a}),t&&e.render(!0),r}function I_t(r){return Rt(se,Pn("liquidStyle"),M_t,Y7,Je({}),Ce,ze)(r)}var L_t={radius:.9,statistic:{title:!1,content:{style:{opacity:.75,fontSize:"30px",lineHeight:"30px",textAlign:"center"}}},outline:{border:2,distance:0},wave:{count:3,length:192},shape:"circle"},YI=5e3;function jI(r,t,e){return r+(t-r)*e}function O_t(r){var t=S({opacity:1},r.style);return r.color&&!t.fill&&(t.fill=r.color),t}function P_t(r){var t={fill:"#fff",fillOpacity:0,lineWidth:4},e=ne({},t,r.style);return r.color&&!e.stroke&&(e.stroke=r.color),Tt(r.opacity)&&(e.opacity=e.strokeOpacity=r.opacity),e}function F_t(r,t,e,i){return t===0?[[r+1/2*e/Math.PI/2,i/2],[r+1/2*e/Math.PI,i],[r+e/4,i]]:t===1?[[r+1/2*e/Math.PI/2*(Math.PI-2),i],[r+1/2*e/Math.PI/2*(Math.PI-1),i/2],[r+e/4,0]]:t===2?[[r+1/2*e/Math.PI/2,-i/2],[r+1/2*e/Math.PI,-i],[r+e/4,-i]]:[[r+1/2*e/Math.PI/2*(Math.PI-2),-i],[r+1/2*e/Math.PI/2*(Math.PI-1),-i/2],[r+e/4,0]]}function B_t(r,t,e,i,n,a,o){for(var s=Math.ceil(2*r/e*4)*4,l=[],u=i;u<-Math.PI*2;)u+=Math.PI*2;for(;u>0;)u-=Math.PI*2;u=u/Math.PI/2*e;var c=a-r+u-r*2;l.push(["M",c,t]);for(var h=0,f=0;f<s;++f){var d=f%4,v=F_t(f*e/4,d,e,n);l.push(["C",v[0][0]+c,-v[0][1]+t,v[1][0]+c,-v[1][1]+t,v[2][0]+c,-v[2][1]+t]),f===s-1&&(h=v[2][0])}return l.push(["L",h+c,o+r]),l.push(["L",c,o+r]),l.push(["Z"]),l}function j7(r,t,e,i,n,a,o,s,l,u){for(var c=n.fill,h=n.opacity,f=o.getBBox(),d=f.maxX-f.minX,v=f.maxY-f.minY,p=0;p<i;p++){var g=i<=1?1:p/(i-1),m=a.addShape("path",{name:"waterwave-path",attrs:{path:B_t(s,f.minY+v*e,l,0,d/32,r,t),fill:c,opacity:jI(.2,.9,g)*h}});try{if(u===!1)return;var y=cC([["t",l,0]]);m.stopAnimate(),m.animate({matrix:y},{duration:jI(.5*YI,YI,g),repeat:!0})}catch{console.warn("off-screen group animate error!")}}}function D_t(r,t,e,i){var n=e*2/3,a=Math.max(n,i),o=n/2,s=r,l=o+t-a/2,u=Math.asin(o/((a-o)*.85)),c=Math.sin(u)*o,h=Math.cos(u)*o,f=s-h,d=l+c,v=r,p=l+o/Math.sin(u);return`
      M `.concat(f," ").concat(d,`
      A `).concat(o," ").concat(o," 0 1 1 ").concat(f+h*2," ").concat(d,`
      Q `).concat(v," ").concat(p," ").concat(r," ").concat(t+a/2,`
      Q `).concat(v," ").concat(p," ").concat(f," ").concat(d,`
      Z 
    `)}function N_t(r,t,e,i){var n=e/2,a=i/2;return`
      M `.concat(r," ").concat(t-a,` 
      a `).concat(n," ").concat(a," 0 1 0 0 ").concat(a*2,`
      a `).concat(n," ").concat(a," 0 1 0 0 ").concat(-a*2,`
      Z
    `)}function k_t(r,t,e,i){var n=i/2,a=e/2;return`
      M `.concat(r," ").concat(t-n,`
      L `).concat(r+a," ").concat(t,`
      L `).concat(r," ").concat(t+n,`
      L `).concat(r-a," ").concat(t,`
      Z
    `)}function U_t(r,t,e,i){var n=i/2,a=e/2;return`
      M `.concat(r," ").concat(t-n,`
      L `).concat(r+a," ").concat(t+n,`
      L `).concat(r-a," ").concat(t+n,`
      Z
    `)}function z_t(r,t,e,i){var n=.618,a=i/2,o=e/2*n;return`
      M `.concat(r-o," ").concat(t-a,`
      L `).concat(r+o," ").concat(t-a,`
      L `).concat(r+o," ").concat(t+a,`
      L `).concat(r-o," ").concat(t+a,`
      Z
    `)}var ZI={pin:D_t,circle:N_t,diamond:k_t,triangle:U_t,rect:z_t};de("interval","liquid-fill-gauge",{draw:function(r,t){var e=.5,i=.5,n=r.customInfo,a=n,o=a.percent,s=a.radius,l=a.shape,u=a.shapeStyle,c=a.background,h=a.animation,f=n.outline,d=n.wave,v=f.border,p=f.distance,g=d.count,m=d.length,y=Qr(r.points,function(j,$){return Math.min(j,$.x)},1/0),_=this.parsePoint({x:e,y:i}),x=this.parsePoint({x:y,y:i}),C=_.x-x.x,A=Math.min(C,x.y*s),b=O_t(r),R=P_t(ne({},r,f)),M=A-v/2,O=typeof l=="function"?l:ZI[l]||ZI.circle,F=O(_.x,_.y,M*2,M*2);if(u&&t.addShape("path",{name:"shape",attrs:S({path:F},u)}),o>0){var D=t.addGroup({name:"waves"}),H=D.setClip({type:"path",attrs:{path:F}});j7(_.x,_.y,1-r.points[1].y,g,b,D,H,A*2,m,h)}return t.addShape("path",{name:"distance",attrs:{path:F,fill:"transparent",lineWidth:v+p*2,stroke:c==="transparent"?"#fff":c}}),t.addShape("path",{name:"wrap",attrs:ne(R,{path:F,fill:"transparent",lineWidth:v})}),t}});var H_t=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="liquid",e}return t.getDefaultOptions=function(){return L_t},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.changeData=function(e){this.chart.emit(Ut.BEFORE_CHANGE_DATA,$e.fromData(this.chart,Ut.BEFORE_CHANGE_DATA,null)),this.updateOption({percent:e}),this.chart.data(X7(e)),Y7({chart:this.chart,options:this.options},!0),this.chart.emit(Ut.AFTER_CHANGE_DATA,$e.fromData(this.chart,Ut.AFTER_CHANGE_DATA,null))},t.prototype.getSchemaAdaptor=function(){return I_t},t}(Bt);const XWt=Object.freeze(Object.defineProperty({__proto__:null,Liquid:H_t,addWaterWave:j7},Symbol.toStringTag,{value:"Module"}));function $_t(r){var t=r.chart,e=r.options,i=e.data,n=e.lineStyle,a=e.color,o=e.point,s=e.area;t.data(i);var l=W({},r,{options:{line:{style:n,color:a},point:o&&S({color:a},o),area:s&&S({color:a},s),label:void 0}}),u=W({},l,{options:{tooltip:!1}}),c=(o==null?void 0:o.state)||e.state,h=W({},l,{options:{tooltip:!1,state:c}});return Dh(l),Fn(h),Ey(u),r}function W_t(r){var t,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField,o=e.yField;return Rt(Je((t={},t[a]=i,t[o]=n,t)))(r)}function V_t(r){var t=r.chart,e=r.options,i=e.radius,n=e.startAngle,a=e.endAngle;return t.coordinate("polar",{radius:i,startAngle:n,endAngle:a}),r}function G_t(r){var t=r.chart,e=r.options,i=e.xField,n=e.xAxis,a=e.yField,o=e.yAxis;return t.axis(i,n),t.axis(a,o),r}function X_t(r){var t=r.chart,e=r.options,i=e.label,n=e.yField,a=ti(t,"line");if(!i)a.label(!1);else{var o=i.fields,s=i.callback,l=zt(i,["fields","callback"]);a.label({fields:o||[n],callback:s,cfg:Lr(l)})}return r}function Y_t(r){return Rt($_t,W_t,se,V_t,G_t,Bh,Cr,X_t,ze,Ce,We())(r)}var j_t=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"name",{get:function(){return"radar-tooltip"},enumerable:!1,configurable:!0}),t.prototype.getTooltipItems=function(e){var i=this.getTooltipCfg(),n=i.shared,a=i.title,o=r.prototype.getTooltipItems.call(this,e);if(o.length>0){var s=this.view.geometries[0],l=s.dataArray,u=o[0].name,c=[];return l.forEach(function(h){h.forEach(function(f){var d=nn.getTooltipItems(f,s),v=d[0];if(!n&&v&&v.name===u){var p=K(a)?u:a;c.push(S(S({},v),{name:v.title,title:p}))}else if(n&&v){var p=K(a)?v.name||u:a;c.push(S(S({},v),{name:v.title,title:p}))}})}),c}return[]},t}(fN);Uu("radar-tooltip",j_t);var Z_t=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.init=function(){var e=this.context.view;e.removeInteraction("tooltip")},t.prototype.show=function(){var e=this.context.event,i=this.getTooltipController();i.showTooltip({x:e.x,y:e.y})},t.prototype.hide=function(){var e=this.getTooltipController();e.hideTooltip()},t.prototype.getTooltipController=function(){var e=this.context.view;return e.getController("radar-tooltip")},t}(De);Ct("radar-tooltip",Z_t);Pt("radar-tooltip",{start:[{trigger:"plot:mousemove",action:"radar-tooltip:show"}],end:[{trigger:"plot:mouseleave",action:"radar-tooltip:hide"}]});var q_t=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="radar",e}return t.prototype.changeData=function(e){this.updateOption({data:e}),this.chart.changeData(e)},t.prototype.getDefaultOptions=function(){return W({},r.prototype.getDefaultOptions.call(this),{xAxis:{label:{offset:15},grid:{line:{type:"line"}}},yAxis:{grid:{line:{type:"circle"}}},legend:{position:"top"},tooltip:{shared:!0,showCrosshairs:!0,showMarkers:!0,crosshairs:{type:"xy",line:{style:{stroke:"#565656",lineDash:[4]}},follow:!0}}})},t.prototype.getSchemaAdaptor=function(){return Y_t},t}(Bt);const YWt=Object.freeze(Object.defineProperty({__proto__:null,Radar:q_t},Symbol.toStringTag,{value:"Module"}));function K_t(r,t,e){var i=e.map(function(o){return o[t]}).filter(function(o){return o!==void 0}),n=i.length>0?Math.max.apply(Math,i):0,a=Math.abs(r)%360;return a?n*360/a:n}function Q_t(r,t,e){var i=[];return r.forEach(function(n){var a=i.find(function(o){return o[t]===n[t]});a?a[e]+=n[e]||null:i.push(S({},n))}),i}function J_t(r){var t=r.chart,e=r.options,i=e.barStyle,n=e.color,a=e.tooltip,o=e.colorField,s=e.type,l=e.xField,u=e.yField,c=e.data,h=e.shape,f=uh(c,u);t.data(f);var d=W({},r,{options:{tooltip:a,seriesField:o,interval:{style:i,color:n,shape:h||(s==="line"?"line":"intervel")},minColumnWidth:e.minBarWidth,maxColumnWidth:e.maxBarWidth,columnBackground:e.barBackground}});return ei(d),s==="line"&&Fn({chart:t,options:{xField:l,yField:u,seriesField:o,point:{shape:"circle",color:n}}}),r}function Z7(r){var t,e=r.options,i=e.yField,n=e.xField,a=e.data,o=e.isStack,s=e.isGroup,l=e.colorField,u=e.maxAngle,c=o&&!s&&l?Q_t(a,n,i):a,h=uh(c,i);return Rt(Je((t={},t[i]={min:0,max:K_t(u,i,h)},t)))(r)}function t1t(r){var t=r.chart,e=r.options,i=e.radius,n=e.innerRadius,a=e.startAngle,o=e.endAngle;return t.coordinate({type:"polar",cfg:{radius:i,innerRadius:n,startAngle:a,endAngle:o}}).transpose(),r}function e1t(r){var t=r.chart,e=r.options,i=e.xField,n=e.xAxis;return t.axis(i,n),r}function r1t(r){var t=r.chart,e=r.options,i=e.label,n=e.yField,a=ti(t,"interval");if(!i)a.label(!1);else{var o=i.callback,s=zt(i,["callback"]);a.label({fields:[n],callback:o,cfg:S(S({},Lr(s)),{type:"polar"})})}return r}function i1t(r){return Rt(Pn("barStyle"),J_t,Z7,e1t,t1t,ze,Ce,se,Cr,Bh,We(),r1t)(r)}var n1t=W({},Bt.getDefaultOptions(),{interactions:[{type:"element-active"}],legend:!1,tooltip:{showMarkers:!1},xAxis:{grid:null,tickLine:null,line:null},maxAngle:240});(function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="radial-bar",e}return t.getDefaultOptions=function(){return n1t},t.prototype.changeData=function(e){this.updateOption({data:e}),Z7({chart:this.chart,options:this.options}),this.chart.changeData(e)},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return i1t},t})(Bt);function a1t(r){var t=r.chart,e=r.options,i=e.data,n=e.sectorStyle,a=e.shape,o=e.color;return t.data(i),Rt(ei)(W({},r,{options:{marginRatio:1,interval:{style:n,color:o,shape:a}}})),r}function o1t(r){var t=r.chart,e=r.options,i=e.label,n=e.xField,a=ti(t,"interval");if(i===!1)a.label(!1);else if(ie(i)){var o=i.callback,s=i.fields,l=zt(i,["callback","fields"]),u=l.offset,c=l.layout;(u===void 0||u>=0)&&(c=c?q(c)?c:[c]:[],l.layout=Fr(c,function(h){return h.type!=="limit-in-shape"}),l.layout.length||delete l.layout),a.label({fields:s||[n],callback:o,cfg:Lr(l)})}else cs(Ba.WARN,i===null,"the label option must be an Object."),a.label({fields:[n]});return r}function s1t(r){var t=r.chart,e=r.options,i=e.legend,n=e.seriesField;return i===!1?t.legend(!1):n&&t.legend(n,i),r}function l1t(r){var t=r.chart,e=r.options,i=e.radius,n=e.innerRadius,a=e.startAngle,o=e.endAngle;return t.coordinate({type:"polar",cfg:{radius:i,innerRadius:n,startAngle:a,endAngle:o}}),r}function u1t(r){var t,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField,o=e.yField;return Rt(Je((t={},t[a]=i,t[o]=n,t)))(r)}function c1t(r){var t=r.chart,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField,o=e.yField;return i?t.axis(a,i):t.axis(a,!1),n?t.axis(o,n):t.axis(o,!1),r}function h1t(r){Rt(Pn("sectorStyle"),a1t,u1t,o1t,l1t,c1t,s1t,Cr,ze,Ce,se,We(),pl)(r)}var f1t=W({},Bt.getDefaultOptions(),{xAxis:!1,yAxis:!1,legend:{position:"right",radio:{}},sectorStyle:{stroke:"#fff",lineWidth:1},label:{layout:{type:"limit-in-shape"}},tooltip:{shared:!0,showMarkers:!1},interactions:[{type:"active-region"}]}),d1t=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="rose",e}return t.getDefaultOptions=function(){return f1t},t.prototype.changeData=function(e){this.updateOption({data:e}),this.chart.changeData(e)},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return h1t},t}(Bt);const jWt=Object.freeze(Object.defineProperty({__proto__:null,Rose:d1t},Symbol.toStringTag,{value:"Module"}));var qI="x",KI="y",QI="name",wy="nodes",Ry="edges";function v1t(r,t,e){var i=[];return r.forEach(function(n){var a=n[t],o=n[e];i.includes(a)||i.push(a),i.includes(o)||i.push(o)}),i}function p1t(r,t,e,i){var n={};return t.forEach(function(a){n[a]={},t.forEach(function(o){n[a][o]=0})}),r.forEach(function(a){n[a[e]][a[i]]=1}),n}function g1t(r,t,e){if(!q(r))return[];var i=[],n=v1t(r,t,e),a=p1t(r,n,t,e),o={};n.forEach(function(l){o[l]=0});function s(l){o[l]=1,n.forEach(function(u){if(a[l][u]!=0)if(o[u]==1)i.push("".concat(l,"_").concat(u));else{if(o[u]==-1)return;s(u)}}),o[l]=-1}return n.forEach(function(l){o[l]!=-1&&s(l)}),i.length!==0&&console.warn("sankey data contains circle, ".concat(i.length," records removed."),i),r.filter(function(l){return i.findIndex(function(u){return u==="".concat(l[t],"_").concat(l[e])})<0})}function m1t(r){return r.target.depth}function y1t(r){return r.depth}function _1t(r,t){return t-1-r.height}function tT(r,t){return r.sourceLinks.length?r.depth:t-1}function x1t(r){return r.targetLinks.length?r.depth:r.sourceLinks.length?o5(r.sourceLinks,m1t)-1:0}function pg(r){return function(){return r}}function m1(r,t){for(var e=0,i=0;i<r.length;i++)e+=t(r[i]);return e}function y1(r,t){for(var e=-1/0,i=0;i<r.length;i++)e=Math.max(t(r[i]),e);return e}function C1t(r,t){for(var e=1/0,i=0;i<r.length;i++)e=Math.min(t(r[i]),e);return e}function JI(r,t){return im(r.source,t.source)||r.index-t.index}function tL(r,t){return im(r.target,t.target)||r.index-t.index}function im(r,t){return r.y0-t.y0}function _1(r){return r.value}function E1t(r){return r.index}function S1t(r){return r.nodes}function A1t(r){return r.links}function eL(r,t){var e=r.get(t);if(!e)throw new Error("missing: "+t);return e}function rL(r){for(var t=r.nodes,e=0,i=t;e<i.length;e++){for(var n=i[e],a=n.y0,o=a,s=0,l=n.sourceLinks;s<l.length;s++){var u=l[s];u.y0=a+u.width/2,a+=u.width}for(var c=0,h=n.targetLinks;c<h.length;c++){var u=h[c];u.y1=o+u.width/2,o+=u.width}}}function T1t(){var r=0,t=0,e=1,i=1,n=24,a=8,o,s=E1t,l=tT,u,c,h,f=S1t,d=A1t,v=6;function p(k){var V={nodes:f(k),links:d(k)};return g(V),m(V),y(V),_(V),A(V),rL(V),V}p.update=function(k){return rL(k),k},p.nodeId=function(k){return arguments.length?(s=typeof k=="function"?k:pg(k),p):s},p.nodeAlign=function(k){return arguments.length?(l=typeof k=="function"?k:pg(k),p):l},p.nodeDepth=function(k){return arguments.length?(u=k,p):u},p.nodeSort=function(k){return arguments.length?(c=k,p):c},p.nodeWidth=function(k){return arguments.length?(n=+k,p):n},p.nodePadding=function(k){return arguments.length?(a=o=+k,p):a},p.nodes=function(k){return arguments.length?(f=typeof k=="function"?k:pg(k),p):f},p.links=function(k){return arguments.length?(d=typeof k=="function"?k:pg(k),p):d},p.linkSort=function(k){return arguments.length?(h=k,p):h},p.size=function(k){return arguments.length?(r=t=0,e=+k[0],i=+k[1],p):[e-r,i-t]},p.extent=function(k){return arguments.length?(r=+k[0][0],e=+k[1][0],t=+k[0][1],i=+k[1][1],p):[[r,t],[e,i]]},p.iterations=function(k){return arguments.length?(v=+k,p):v};function g(k){var V=k.nodes,Q=k.links;V.forEach(function(vt,It){vt.index=It,vt.sourceLinks=[],vt.targetLinks=[]});var Y=new Map(V.map(function(vt){return[s(vt),vt]}));if(Q.forEach(function(vt,It){vt.index=It;var ce=vt.source,_e=vt.target;typeof ce!="object"&&(ce=vt.source=eL(Y,ce)),typeof _e!="object"&&(_e=vt.target=eL(Y,_e)),ce.sourceLinks.push(vt),_e.targetLinks.push(vt)}),h!=null)for(var tt=0,et=V;tt<et.length;tt++){var dt=et[tt],Et=dt.sourceLinks,ht=dt.targetLinks;Et.sort(h),ht.sort(h)}}function m(k){for(var V=k.nodes,Q=0,Y=V;Q<Y.length;Q++){var tt=Y[Q];tt.value=tt.fixedValue===void 0?Math.max(m1(tt.sourceLinks,_1),m1(tt.targetLinks,_1)):tt.fixedValue}}function y(k){for(var V=k.nodes,Q=V.length,Y=new Set(V),tt=new Set,et=0;Y.size;){if(Y.forEach(function(vt){vt.depth=et;for(var It=0,ce=vt.sourceLinks;It<ce.length;It++){var _e=ce[It].target;tt.add(_e)}}),++et>Q)throw new Error("circular link");Y=tt,tt=new Set}if(u)for(var dt=Math.max(y1(V,function(vt){return vt.depth})+1,0),Et=void 0,ht=0;ht<V.length;ht++)Et=V[ht],Et.depth=u.call(null,Et,dt)}function _(k){for(var V=k.nodes,Q=V.length,Y=new Set(V),tt=new Set,et=0;Y.size;){if(Y.forEach(function(dt){dt.height=et;for(var Et=0,ht=dt.targetLinks;Et<ht.length;Et++){var vt=ht[Et].source;tt.add(vt)}}),++et>Q)throw new Error("circular link");Y=tt,tt=new Set}}function x(k){for(var V=k.nodes,Q=Math.max(y1(V,function(_e){return _e.depth})+1,0),Y=(e-r-n)/(Q-1),tt=new Array(Q).fill(0).map(function(){return[]}),et=0,dt=V;et<dt.length;et++){var Et=dt[et],ht=Math.max(0,Math.min(Q-1,Math.floor(l.call(null,Et,Q))));Et.layer=ht,Et.x0=r+ht*Y,Et.x1=Et.x0+n,tt[ht]?tt[ht].push(Et):tt[ht]=[Et]}if(c)for(var vt=0,It=tt;vt<It.length;vt++){var ce=It[vt];ce.sort(c)}return tt}function C(k){for(var V=C1t(k,function(Ve){return(i-t-(Ve.length-1)*o)/m1(Ve,_1)}),Q=0,Y=k;Q<Y.length;Q++){for(var tt=Y[Q],et=t,dt=0,Et=tt;dt<Et.length;dt++){var ht=Et[dt];ht.y0=et,ht.y1=et+ht.value*V,et=ht.y1+o;for(var vt=0,It=ht.sourceLinks;vt<It.length;vt++){var ce=It[vt];ce.width=ce.value*V}}et=(i-et+o)/(tt.length+1);for(var _e=0;_e<tt.length;++_e){var ht=tt[_e];ht.y0+=et*(_e+1),ht.y1+=et*(_e+1)}H(tt)}}function A(k){var V=x(k);o=Math.min(a,(i-t)/(y1(V,function(et){return et.length})-1)),C(V);for(var Q=0;Q<v;++Q){var Y=Math.pow(.99,Q),tt=Math.max(1-Y,(Q+1)/v);R(V,Y,tt),b(V,Y,tt)}}function b(k,V,Q){for(var Y=1,tt=k.length;Y<tt;++Y){for(var et=k[Y],dt=0,Et=et;dt<Et.length;dt++){for(var ht=Et[dt],vt=0,It=0,ce=0,_e=ht.targetLinks;ce<_e.length;ce++){var Ve=_e[ce],Fi=Ve.source,dn=Ve.value,da=dn*(ht.layer-Fi.layer);vt+=j(Fi,ht)*da,It+=da}if(It>0){var Sl=(vt/It-ht.y0)*V;ht.y0+=Sl,ht.y1+=Sl,D(ht)}}c===void 0&&et.sort(im),et.length&&M(et,Q)}}function R(k,V,Q){for(var Y=k.length,tt=Y-2;tt>=0;--tt){for(var et=k[tt],dt=0,Et=et;dt<Et.length;dt++){for(var ht=Et[dt],vt=0,It=0,ce=0,_e=ht.sourceLinks;ce<_e.length;ce++){var Ve=_e[ce],Fi=Ve.target,dn=Ve.value,da=dn*(Fi.layer-ht.layer);vt+=$(ht,Fi)*da,It+=da}if(It>0){var Sl=(vt/It-ht.y0)*V;ht.y0+=Sl,ht.y1+=Sl,D(ht)}}c===void 0&&et.sort(im),et.length&&M(et,Q)}}function M(k,V){var Q=k.length>>1,Y=k[Q];F(k,Y.y0-o,Q-1,V),O(k,Y.y1+o,Q+1,V),F(k,i,k.length-1,V),O(k,t,0,V)}function O(k,V,Q,Y){for(;Q<k.length;++Q){var tt=k[Q],et=(V-tt.y0)*Y;et>1e-6&&(tt.y0+=et,tt.y1+=et),V=tt.y1+o}}function F(k,V,Q,Y){for(;Q>=0;--Q){var tt=k[Q],et=(tt.y1-V)*Y;et>1e-6&&(tt.y0-=et,tt.y1-=et),V=tt.y0-o}}function D(k){var V=k.sourceLinks,Q=k.targetLinks;if(h===void 0){for(var Y=0,tt=Q;Y<tt.length;Y++){var et=tt[Y].source.sourceLinks;et.sort(tL)}for(var dt=0,Et=V;dt<Et.length;dt++){var ht=Et[dt].target.targetLinks;ht.sort(JI)}}}function H(k){if(h===void 0)for(var V=0,Q=k;V<Q.length;V++){var Y=Q[V],tt=Y.sourceLinks,et=Y.targetLinks;tt.sort(tL),et.sort(JI)}}function j(k,V){for(var Q=k.y0-(k.sourceLinks.length-1)*o/2,Y=0,tt=k.sourceLinks;Y<tt.length;Y++){var et=tt[Y],dt=et.target,Et=et.width;if(dt===V)break;Q+=Et+o}for(var ht=0,vt=V.targetLinks;ht<vt.length;ht++){var It=vt[ht],dt=It.source,Et=It.width;if(dt===k)break;Q-=Et}return Q}function $(k,V){for(var Q=V.y0-(V.targetLinks.length-1)*o/2,Y=0,tt=V.targetLinks;Y<tt.length;Y++){var et=tt[Y],dt=et.source,Et=et.width;if(dt===k)break;Q+=Et+o}for(var ht=0,vt=k.sourceLinks;ht<vt.length;ht++){var It=vt[ht],dt=It.target,Et=It.width;if(dt===V)break;Q-=Et}return Q}return p}var b1t={left:y1t,right:_1t,center:x1t,justify:tT},w1t={nodeId:function(r){return r.index},nodeAlign:"justify",nodeWidth:.008,nodePadding:.03,nodeSort:void 0};function R1t(r){var t=mt(r)?b1t[r]:ot(r)?r:null;return t||tT}function M1t(r){return ne({},w1t,r)}function I1t(r,t){var e=M1t(r),i=e.nodeId,n=e.nodeSort,a=e.nodeAlign,o=e.nodeWidth,s=e.nodePadding,l=e.nodeDepth,u=T1t().nodeSort(n).nodeWidth(o).nodePadding(s).nodeDepth(l).nodeAlign(R1t(a)).extent([[0,0],[1,1]]).nodeId(i),c=u(t),h=c.nodes.map(function(d){var v=d.x0,p=d.x1,g=d.y0,m=d.y1;return d.x=[v,p,p,v],d.y=[g,g,m,m],d}).filter(function(d){return d.name!==null}),f=c.links.map(function(d){var v=d.source,p=d.target,g=v.x1,m=p.x0;d.x=[g,g,m,m];var y=d.width/2;return d.y=[d.y0+y,d.y0-y,d.y1+y,d.y1-y],d}).filter(function(d){var v=d.source,p=d.target;return v.name!==null&&p.name!==null});return{nodes:h,links:f}}function L1t(r){return r==="node-link"}function O1t(r,t,e){return yu(r)?r/e:t}function P1t(r,t,e){return yu(r)?r/e:t}function q7(r,t,e){var i=r.dataType,n=r.data,a=r.sourceField,o=r.targetField,s=r.weightField,l=r.nodeAlign,u=r.nodeSort,c=r.nodePadding,h=r.nodePaddingRatio,f=r.nodeWidth,d=r.nodeWidthRatio,v=r.nodeDepth,p=r.rawFields,g=p===void 0?[]:p,m;L1t(i)?m=n:m=E6(g1t(n,a,o),a,o,s,g);var y=I1t({nodeAlign:l,nodePadding:P1t(c,h,e),nodeWidth:O1t(f,d,t),nodeSort:u,nodeDepth:v},m),_=y.nodes,x=y.links;return{nodes:_.map(function(C){return S(S({},ye(C,xt(["x","y","name"],g,!0))),{isNode:!0})}),edges:x.map(function(C){return S(S({source:C.source.name,target:C.target.name,name:C.source.name||C.target.name},ye(C,xt(["x","y","value"],g,!0))),{isNode:!1})})}}function F1t(r){var t=r.options,e=t.rawFields,i=e===void 0?[]:e;return W({},{options:{tooltip:{fields:as(xt(["name","source","target","value","isNode"],i,!0))},label:{fields:as(xt(["x","name"],i,!0))}}},r)}function B1t(r){var t=r.chart,e=r.options,i=e.color,n=e.nodeStyle,a=e.edgeStyle,o=e.label,s=e.tooltip,l=e.nodeState,u=e.edgeState,c=e.rawFields,h=c===void 0?[]:c;t.legend(!1),t.tooltip(s),t.axis(!1),t.coordinate().reflect("y");var f=q7(e,t.width,t.height),d=f.nodes,v=f.edges,p=t.createView({id:Ry});p.data(v),O6({chart:p,options:{xField:qI,yField:KI,seriesField:QI,rawFields:xt(["source","target"],h,!0),edge:{color:i,style:a,shape:"arc"},tooltip:s,state:u}});var g=t.createView({id:wy});return g.data(d),Sy({chart:g,options:{xField:qI,yField:KI,seriesField:QI,polygon:{color:i,style:n},label:o,tooltip:s,state:l}}),t.interaction("element-active"),t.scale({x:{sync:!0,nice:!0,min:0,max:1,minLimit:0,maxLimit:1},y:{sync:!0,nice:!0,min:0,max:1,minLimit:0,maxLimit:1},name:{sync:"color",type:"cat"}}),r}function D1t(r){var t=r.chart,e=r.options,i=e.animation,n=xt(xt([],t.views[0].geometries,!0),t.views[1].geometries,!0);return Zv(t,i,n),r}function N1t(r){var t=r.chart,e=r.options,i=e.nodeDraggable,n="sankey-node-draggable";return i?t.interaction(n):t.removeInteraction(n),r}function k1t(r){var t=r.chart,e=r.options,i=e.interactions,n=i===void 0?[]:i,a=[].concat(n,e.nodeInteractions||[]),o=[].concat(n,e.edgeInteractions||[]),s=Ht(t,wy),l=Ht(t,Ry);return a.forEach(function(u){(u==null?void 0:u.enable)===!1?s.removeInteraction(u.type):s.interaction(u.type,u.cfg||{})}),o.forEach(function(u){(u==null?void 0:u.enable)===!1?l.removeInteraction(u.type):l.interaction(u.type,u.cfg||{})}),r}function U1t(r){return Rt(F1t,B1t,k1t,N1t,D1t,se)(r)}var z1t=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.isDragging=!1,e}return t.prototype.isNodeElement=function(){var e=P(this.context,"event.target");if(e){var i=e.get("element");return i&&i.getModel().data.isNode}return!1},t.prototype.getNodeView=function(){return Ht(this.context.view,wy)},t.prototype.getEdgeView=function(){return Ht(this.context.view,Ry)},t.prototype.getCurrentDatumIdx=function(e){return this.getNodeView().geometries[0].elements.indexOf(e)},t.prototype.start=function(){if(this.isNodeElement()){this.prevPoint={x:P(this.context,"event.x"),y:P(this.context,"event.y")};var e=this.context.event.target.get("element"),i=this.getCurrentDatumIdx(e);if(i===-1)return;this.currentElementIdx=i,this.context.isDragging=!0,this.isDragging=!0,this.prevNodeAnimateCfg=this.getNodeView().getOptions().animate,this.prevEdgeAnimateCfg=this.getEdgeView().getOptions().animate,this.getNodeView().animate(!1),this.getEdgeView().animate(!1)}},t.prototype.translate=function(){if(this.isDragging){var e=this.context.view,i={x:P(this.context,"event.x"),y:P(this.context,"event.y")},n=i.x-this.prevPoint.x,a=i.y-this.prevPoint.y,o=this.getNodeView(),s=o.geometries[0].elements[this.currentElementIdx];if(s&&s.getModel()){var l=s.getModel().data,u=o.getOptions().data,c=o.getCoordinate(),h={x:n/c.getWidth(),y:a/c.getHeight()},f=S(S({},l),{x:l.x.map(function(m){return m+=h.x}),y:l.y.map(function(m){return m+=h.y})}),d=xt([],u,!0);d[this.currentElementIdx]=f,o.data(d);var v=l.name,p=this.getEdgeView(),g=p.getOptions().data;g.forEach(function(m){m.source===v&&(m.x[0]+=h.x,m.x[1]+=h.x,m.y[0]+=h.y,m.y[1]+=h.y),m.target===v&&(m.x[2]+=h.x,m.x[3]+=h.x,m.y[2]+=h.y,m.y[3]+=h.y)}),p.data(g),this.prevPoint=i,e.render(!0)}}},t.prototype.end=function(){this.isDragging=!1,this.context.isDragging=!1,this.prevPoint=null,this.currentElementIdx=null,this.getNodeView().animate(this.prevNodeAnimateCfg),this.getEdgeView().animate(this.prevEdgeAnimateCfg)},t}(De);Ct("sankey-node-drag",z1t);Pt("sankey-node-draggable",{showEnable:[{trigger:"polygon:mouseenter",action:"cursor:pointer"},{trigger:"polygon:mouseleave",action:"cursor:default"}],start:[{trigger:"polygon:mousedown",action:"sankey-node-drag:start"}],processing:[{trigger:"plot:mousemove",action:"sankey-node-drag:translate"},{isEnable:function(r){return r.isDragging},trigger:"plot:mousemove",action:"cursor:move"}],end:[{trigger:"plot:mouseup",action:"sankey-node-drag:end"}]});var H1t=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="sankey",e}return t.getDefaultOptions=function(){return{appendPadding:8,syncViewPadding:!0,nodeStyle:{opacity:1,fillOpacity:1,lineWidth:1},edgeStyle:{opacity:.3,lineWidth:0},edgeState:{active:{style:{opacity:.8,lineWidth:0}}},label:{formatter:function(e){var i=e.name;return i},callback:function(e){var i=e[1]===1;return{style:{fill:"#545454",textAlign:i?"end":"start"},offsetX:i?-8:8}},layout:[{type:"hide-overlap"}]},tooltip:{showTitle:!1,showMarkers:!1,shared:!1,showContent:function(e){return!P(e,[0,"data","isNode"])},formatter:function(e){var i=e.source,n=e.target,a=e.value;return{name:i+" -> "+n,value:a}}},nodeWidthRatio:.008,nodePaddingRatio:.01,animation:{appear:{animation:"wave-in"},enter:{animation:"wave-in"}}}},t.prototype.changeData=function(e){this.updateOption({data:e});var i=q7(this.options,this.chart.width,this.chart.height),n=i.nodes,a=i.edges,o=Ht(this.chart,wy),s=Ht(this.chart,Ry);o.changeData(n),s.changeData(a)},t.prototype.getSchemaAdaptor=function(){return U1t},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t}(Bt);const ZWt=Object.freeze(Object.defineProperty({__proto__:null,Sankey:H1t},Symbol.toStringTag,{value:"Module"}));var eT="ancestor-node",K7="value",$d="path",$1t=[$d,H7,qA,$7,"name","depth","height"],W1t=W({},Bt.getDefaultOptions(),{innerRadius:0,radius:.85,hierarchyConfig:{field:"value"},tooltip:{shared:!0,showMarkers:!1,offset:20,showTitle:!1},legend:!1,sunburstStyle:{lineWidth:.5,stroke:"#FFF"},drilldown:{enabled:!0}}),V1t={field:"value",size:[1,1],round:!1,padding:0,sort:function(r,t){return t.value-r.value},as:["x","y"],ignoreParentValue:!0};function G1t(r,t){t=ne({},V1t,t);var e=t.as;if(!q(e)||e.length!==2)throw new TypeError('Invalid as: it must be an array with 2 strings (e.g. [ "x", "y" ])!');var i;try{i=KA(t)}catch(l){console.warn(l)}var n=function(l){return oW().size(t.size).round(t.round).padding(t.padding)(kE(l).sum(function(u){return xr(u.children)?t.ignoreParentValue?0:u[i]-Qr(u.children,function(c,h){return c+h[i]},0):u[i]}).sort(t.sort))},a=n(r),o=e[0],s=e[1];return a.each(function(l){var u,c;l[o]=[l.x0,l.x1,l.x1,l.x0],l[s]=[l.y1,l.y1,l.y0,l.y0],l.name=l.name||((u=l.data)===null||u===void 0?void 0:u.name)||((c=l.data)===null||c===void 0?void 0:c.label),l.data.name=l.name,["x0","x1","y0","y1"].forEach(function(h){e.indexOf(h)===-1&&delete l[h]})}),QA(a)}var X1t={field:"value",tile:"treemapSquarify",size:[1,1],round:!1,ignoreParentValue:!0,padding:0,paddingInner:0,paddingOuter:0,paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0,as:["x","y"],sort:function(r,t){return t.value-r.value},ratio:.5*(1+Math.sqrt(5))};function Y1t(r,t){return r==="treemapSquarify"?y2[r].ratio(t):y2[r]}function Q7(r,t){t=ne({},X1t,t);var e=t.as;if(!q(e)||e.length!==2)throw new TypeError('Invalid as: it must be an array with 2 strings (e.g. [ "x", "y" ])!');var i;try{i=KA(t)}catch(u){console.warn(u)}var n=Y1t(t.tile,t.ratio),a=function(u){return sW().tile(n).size(t.size).round(t.round).padding(t.padding).paddingInner(t.paddingInner).paddingOuter(t.paddingOuter).paddingTop(t.paddingTop).paddingRight(t.paddingRight).paddingBottom(t.paddingBottom).paddingLeft(t.paddingLeft)(kE(u).sum(function(c){return t.ignoreParentValue&&c.children?0:c[i]}).sort(t.sort))},o=a(r),s=e[0],l=e[1];return o.each(function(u){u[s]=[u.x0,u.x1,u.x1,u.x0],u[l]=[u.y1,u.y1,u.y0,u.y0],["x0","x1","y0","y1"].forEach(function(c){e.indexOf(c)===-1&&delete u[c]})}),QA(o)}function J7(r){var t=r.data,e=r.colorField,i=r.rawFields,n=r.hierarchyConfig,a=n===void 0?{}:n,o=a.activeDepth,s={partition:G1t,treemap:Q7},l=r.seriesField,u=r.type||"partition",c=s[u](t,S(S({field:l||"value"},Rv(a,["activeDepth"])),{type:"hierarchy.".concat(u),as:["x","y"]})),h=[];return c.forEach(function(f){var d,v,p,g,m,y;if(f.depth===0||o>0&&f.depth>o)return null;for(var _=f.data.name,x=S({},f);x.depth>1;)_="".concat((v=x.parent.data)===null||v===void 0?void 0:v.name," / ").concat(_),x=x.parent;var C=S(S(S({},ye(f.data,xt(xt([],i||[],!0),[a.field],!1))),(d={},d[$d]=_,d[eT]=x.data.name,d)),f);l&&(C[l]=f.data[l]||((g=(p=f.parent)===null||p===void 0?void 0:p.data)===null||g===void 0?void 0:g[l])),e&&(C[e]=f.data[e]||((y=(m=f.parent)===null||m===void 0?void 0:m.data)===null||y===void 0?void 0:y[e])),C.ext=a,C[Hd]={hierarchyConfig:a,colorField:e,rawFields:i},h.push(C)}),h}function j1t(r){var t=r.chart,e=r.options,i=e.color,n=e.colorField,a=n===void 0?eT:n,o=e.sunburstStyle,s=e.rawFields,l=s===void 0?[]:s,u=e.shape,c=J7(e);t.data(c);var h;return o&&(h=function(f){return W({},{fillOpacity:Math.pow(.85,f.depth)},ot(o)?o(f):o)}),Sy(W({},r,{options:{xField:"x",yField:"y",seriesField:a,rawFields:as(xt(xt([],$1t,!0),l,!0)),polygon:{color:i,style:h,shape:u}}})),r}function Z1t(r){var t=r.chart;return t.axis(!1),r}function q1t(r){var t=r.chart,e=r.options,i=e.label,n=ti(t,"polygon");if(!i)n.label(!1);else{var a=i.fields,o=a===void 0?["name"]:a,s=i.callback,l=zt(i,["fields","callback"]);n.label({fields:o,callback:s,cfg:Lr(l)})}return r}function K1t(r){var t=r.chart,e=r.options,i=e.innerRadius,n=e.radius,a=e.reflect,o=t.coordinate({type:"polar",cfg:{innerRadius:i,radius:n}});return a&&o.reflect(a),r}function Q1t(r){var t,e=r.options,i=e.hierarchyConfig,n=e.meta;return Rt(Je({},(t={},t[K7]=P(n,P(i,["field"],"value")),t)))(r)}function J1t(r){var t=r.chart,e=r.options,i=e.tooltip;if(i===!1)t.tooltip(!1);else{var n=i;P(i,"fields")||(n=W({},{customItems:function(a){return a.map(function(o){var s=P(t.getOptions(),"scales"),l=P(s,[$d,"formatter"],function(c){return c}),u=P(s,[K7,"formatter"],function(c){return c});return S(S({},o),{name:l(o.data[$d]),value:u(o.data.value)})})}},n)),t.tooltip(n)}return r}function txt(r){var t=r.drilldown,e=r.interactions,i=e===void 0?[]:e;return t!=null&&t.enabled?W({},r,{interactions:xt(xt([],i,!0),[{type:"drill-down",cfg:{drillDownConfig:t,transformData:J7}}],!1)}):r}function ext(r){var t=r.chart,e=r.options,i=e.drilldown;return ze({chart:t,options:txt(e)}),i!=null&&i.enabled&&(t.appendPadding=yy(t.appendPadding,P(i,["breadCrumb","position"]))),r}function rxt(r){return Rt(se,Pn("sunburstStyle"),j1t,Z1t,Q1t,Bh,K1t,J1t,q1t,ext,Ce,We())(r)}(function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="sunburst",e}return t.getDefaultOptions=function(){return W1t},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return rxt},t.SUNBURST_ANCESTOR_FIELD=eT,t.SUNBURST_PATH_FIELD=$d,t.NODE_ANCESTORS_FIELD=qA,t})(Bt);function t8(r,t){if(q(r))return r.find(function(e){return e.type===t})}function e8(r,t){var e=t8(r,t);return e&&e.enable!==!1}function rT(r){var t=r.interactions,e=r.drilldown;return P(e,"enabled")||e8(t,"treemap-drill-down")}function ixt(r){var t=r.interactions["drill-down"];if(t){var e=t.context.actions.find(function(i){return i.name==="drill-down-action"});e.reset()}}function iT(r){var t=r.data,e=r.colorField,i=r.enableDrillDown,n=r.hierarchyConfig,a=Q7(t,S(S({},n),{type:"hierarchy.treemap",field:"value",as:["x","y"]})),o=[];return a.forEach(function(s){if(s.depth===0||i&&s.depth!==1||!i&&s.children)return null;var l=s.ancestors().map(function(f){return{data:f.data,height:f.height,value:f.value}}),u=i&&q(t.path)?l.concat(t.path.slice(1)):l,c=Object.assign({},s.data,S({x:s.x,y:s.y,depth:s.depth,value:s.value,path:u},s));if(!s.data[e]&&s.parent){var h=s.ancestors().find(function(f){return f.data[e]});c[e]=h==null?void 0:h.data[e]}else c[e]=s.data[e];c[Hd]={hierarchyConfig:n,colorField:e,enableDrillDown:i},o.push(c)}),o}function nxt(r){var t=r.options,e=t.colorField;return W({options:{rawFields:["value"],tooltip:{fields:["name","value",e,"path"],formatter:function(i){return{name:i.name,value:i.value}}}}},r)}function axt(r){var t=r.chart,e=r.options,i=e.color,n=e.colorField,a=e.rectStyle,o=e.hierarchyConfig,s=e.rawFields,l=iT({data:e.data,colorField:e.colorField,enableDrillDown:rT(e),hierarchyConfig:o});return t.data(l),Sy(W({},r,{options:{xField:"x",yField:"y",seriesField:n,rawFields:s,polygon:{color:i,style:a}}})),t.coordinate().reflect("y"),r}function oxt(r){var t=r.chart;return t.axis(!1),r}function sxt(r){var t=r.drilldown,e=r.interactions,i=e===void 0?[]:e,n=rT(r);return n?W({},r,{interactions:xt(xt([],i,!0),[{type:"drill-down",cfg:{drillDownConfig:t,transformData:iT}}],!1)}):r}function lxt(r){var t=r.chart,e=r.options,i=e.interactions,n=e.drilldown;ze({chart:t,options:sxt(e)});var a=t8(i,"view-zoom");a&&(a.enable!==!1?t.getCanvas().on("mousewheel",function(s){s.preventDefault()}):t.getCanvas().off("mousewheel"));var o=rT(e);return o&&(t.appendPadding=yy(t.appendPadding,P(n,["breadCrumb","position"]))),r}function uxt(r){return Rt(nxt,se,Pn("rectStyle"),axt,oxt,Bh,Cr,lxt,Ce,We())(r)}var cxt={colorField:"name",rectStyle:{lineWidth:1,stroke:"#fff"},hierarchyConfig:{tile:"treemapSquarify"},label:{fields:["name"],layout:{type:"limit-in-shape"}},tooltip:{showMarkers:!1,showTitle:!1},drilldown:{enabled:!1,breadCrumb:{position:"bottom-left",rootText:"初始",dividerText:"/",textStyle:{fontSize:12,fill:"rgba(0, 0, 0, 0.65)",cursor:"pointer"},activeTextStyle:{fill:"#87B5FF"}}}},hxt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="treemap",e}return t.getDefaultOptions=function(){return cxt},t.prototype.changeData=function(e){var i=this.options,n=i.colorField,a=i.interactions,o=i.hierarchyConfig;this.updateOption({data:e});var s=iT({data:e,colorField:n,enableDrillDown:e8(a,"treemap-drill-down"),hierarchyConfig:o});this.chart.changeData(s),ixt(this.chart)},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return uxt},t}(Bt);const qWt=Object.freeze(Object.defineProperty({__proto__:null,Treemap:hxt},Symbol.toStringTag,{value:"Module"}));var es="id",dC="path",fxt={appendPadding:[10,0,20,0],blendMode:"multiply",tooltip:{showTitle:!1,showMarkers:!1,fields:["id","size"],formatter:function(r){return{name:r.id,value:r.size}}},legend:{position:"top-left"},label:{style:{textAlign:"center",fill:"#fff"}},interactions:[{type:"legend-filter",enable:!1}],state:{active:{style:{stroke:"#000"}},selected:{style:{stroke:"#000",lineWidth:2}},inactive:{style:{fillOpacity:.3,strokeOpacity:.3}}},defaultInteractions:["tooltip","venn-legend-active"]};function My(r){if(r){var t=r.geometries[0].elements;t.forEach(function(e){e.shape.toFront()})}}var dxt=uy("element-active"),vxt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.syncElementsPos=function(){My(this.context.view)},t.prototype.active=function(){r.prototype.active.call(this),this.syncElementsPos()},t.prototype.toggle=function(){r.prototype.toggle.call(this),this.syncElementsPos()},t.prototype.reset=function(){r.prototype.reset.call(this),this.syncElementsPos()},t}(dxt),pxt=uy("element-highlight"),gxt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.syncElementsPos=function(){My(this.context.view)},t.prototype.highlight=function(){r.prototype.highlight.call(this),this.syncElementsPos()},t.prototype.toggle=function(){r.prototype.toggle.call(this),this.syncElementsPos()},t.prototype.clear=function(){r.prototype.clear.call(this),this.syncElementsPos()},t.prototype.reset=function(){r.prototype.reset.call(this),this.syncElementsPos()},t}(pxt),mxt=uy("element-selected"),yxt=uy("element-single-selected"),_xt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.syncElementsPos=function(){My(this.context.view)},t.prototype.selected=function(){r.prototype.selected.call(this),this.syncElementsPos()},t.prototype.toggle=function(){r.prototype.toggle.call(this),this.syncElementsPos()},t.prototype.reset=function(){r.prototype.reset.call(this),this.syncElementsPos()},t}(mxt),xxt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.syncElementsPos=function(){My(this.context.view)},t.prototype.selected=function(){r.prototype.selected.call(this),this.syncElementsPos()},t.prototype.toggle=function(){r.prototype.toggle.call(this),this.syncElementsPos()},t.prototype.reset=function(){r.prototype.reset.call(this),this.syncElementsPos()},t}(yxt);Ct("venn-element-active",vxt);Ct("venn-element-highlight",gxt);Ct("venn-element-selected",_xt);Ct("venn-element-single-selected",xxt);Pt("venn-element-active",{start:[{trigger:"element:mouseenter",action:"venn-element-active:active"}],end:[{trigger:"element:mouseleave",action:"venn-element-active:reset"}]});Pt("venn-element-highlight",{start:[{trigger:"element:mouseenter",action:"venn-element-highlight:highlight"}],end:[{trigger:"element:mouseleave",action:"venn-element-highlight:reset"}]});Pt("venn-element-selected",{start:[{trigger:"element:click",action:"venn-element-selected:toggle"}],rollback:[{trigger:"dblclick",action:["venn-element-selected:reset"]}]});Pt("venn-element-single-selected",{start:[{trigger:"element:click",action:"venn-element-single-selected:toggle"}],rollback:[{trigger:"dblclick",action:["venn-element-single-selected:reset"]}]});Pt("venn-legend-active",{start:[{trigger:"legend-item:mouseenter",action:["list-active:active","venn-element-active:active"]}],end:[{trigger:"legend-item:mouseleave",action:["list-active:reset","venn-element-active:reset"]}]});Pt("venn-legend-highlight",{start:[{trigger:"legend-item:mouseenter",action:["legend-item-highlight:highlight","venn-element-highlight:highlight"]}],end:[{trigger:"legend-item:mouseleave",action:["legend-item-highlight:reset","venn-element-highlight:reset"]}]});var Cxt=function(r){N(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getLabelPoint=function(e,i,n){var a=e.data,o=a.x,s=a.y,l=e.customLabelInfo,u=l.offsetX,c=l.offsetY;return{content:e.content[n],x:o+u,y:s+c}},t}(dy);Xv("venn",Cxt);var od=`	
\v\f\r   ᠎             　\u2028\u2029`,Ext=new RegExp("([a-z])["+od+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+od+"]*,?["+od+"]*)+)","ig"),Sxt=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+od+"]*,?["+od+"]*","ig");function Axt(r){if(!r)return null;if(lW(r))return r;var t={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},e=[];return String(r).replace(Ext,function(i,n,a){var o=[],s=n.toLowerCase();if(a.replace(Sxt,function(l,u){u&&o.push(+u)}),s==="m"&&o.length>2&&(e.push([n].concat(o.splice(0,2))),s="l",n=n==="m"?"l":"L"),s==="o"&&o.length===1&&e.push([n,o[0]]),s==="r")e.push([n].concat(o));else for(;o.length>=t[s]&&(e.push([n].concat(o.splice(0,t[s]))),!!t[s]););return""}),e}function Txt(r){return W({},r.defaultStyle,{fill:r.color},r.style)}de("schema","venn",{draw:function(r,t){var e=r.data,i=Axt(e[dC]),n=Txt(r),a=t.addGroup({name:"venn-shape"});a.addShape("path",{attrs:S(S({},n),{path:i}),name:"venn-path"});var o=r.customInfo,s=o.offsetX,l=o.offsetY,u=nn.transform(null,[["t",s,l]]);return a.setMatrix(u),a},getMarker:function(r){var t=r.color;return{symbol:"circle",style:{lineWidth:0,stroke:t,fill:t,r:4}}}});var bxt=function(r){return function(t,e){var i=[];return i[0]=r(t[0],e[0]),i[1]=r(t[1],e[1]),i[2]=r(t[2],e[2]),i}},iL={normal:function(r){return r},multiply:function(r,t){return r*t/255},screen:function(r,t){return 255*(1-(1-r/255)*(1-t/255))},overlay:function(r,t){return t<128?2*r*t/255:255*(1-2*(1-r/255)*(1-t/255))},darken:function(r,t){return r>t?t:r},lighten:function(r,t){return r>t?r:t},dodge:function(r,t){return r===255?255:(r=255*(t/255)/(1-r/255),r>255?255:r)},burn:function(r,t){return t===255?255:r===0?0:255*(1-Math.min(1,(1-t/255)/(r/255)))}},wxt=function(r){if(!iL[r])throw new Error("unknown blend mode "+r);return iL[r]};function Rxt(r,t,e){e===void 0&&(e="normal");var i=bxt(wxt(e))(gg(r),gg(t)),n=gg(r),a=n[0],o=n[1],s=n[2],l=n[3],u=gg(t),c=u[0],h=u[1],f=u[2],d=u[3],v=Number((l+d*(1-l)).toFixed(2)),p=Math.round((l*(1-d)*(a/255)+l*d*(i[0]/255)+(1-l)*d*(c/255))/v*255),g=Math.round((l*(1-d)*(o/255)+l*d*(i[1]/255)+(1-l)*d*(h/255))/v*255),m=Math.round((l*(1-d)*(s/255)+l*d*(i[2]/255)+(1-l)*d*(f/255))/v*255);return"rgba(".concat(p,", ").concat(g,", ").concat(m,", ").concat(v,")")}function gg(r){var t=r.replace("/s+/g",""),e;return typeof t=="string"&&!t.startsWith("rgba")&&!t.startsWith("#")?e=Gs.rgb2arr(Gs.toRGB(t)).concat([1]):(t.startsWith("rgba")&&(e=t.replace("rgba(","").replace(")","").split(",")),t.startsWith("#")&&(e=Gs.rgb2arr(t).concat([1])),e.map(function(i,n){return n===3?Number(i):i|0}))}var r8=1e-10;function nT(r,t){var e=Ixt(r),i=e.filter(function(b){return Mxt(b,r)}),n=0,a=0,o,s=[];if(i.length>1){var l=a8(i);for(o=0;o<i.length;++o){var u=i[o];u.angle=Math.atan2(u.x-l.x,u.y-l.y)}i.sort(function(b,R){return R.angle-b.angle});var c=i[i.length-1];for(o=0;o<i.length;++o){var h=i[o];a+=(c.x+h.x)*(h.y-c.y);for(var f={x:(h.x+c.x)/2,y:(h.y+c.y)/2},d=null,v=0;v<h.parentIndex.length;++v)if(c.parentIndex.indexOf(h.parentIndex[v])>-1){var p=r[h.parentIndex[v]],g=Math.atan2(h.x-p.x,h.y-p.y),m=Math.atan2(c.x-p.x,c.y-p.y),y=m-g;y<0&&(y+=2*Math.PI);var _=m-y/2,x=Ia(f,{x:p.x+p.radius*Math.sin(_),y:p.y+p.radius*Math.cos(_)});x>p.radius*2&&(x=p.radius*2),(d===null||d.width>x)&&(d={circle:p,width:x,p1:h,p2:c})}d!==null&&(s.push(d),n+=vC(d.circle.radius,d.width),c=h)}}else{var C=r[0];for(o=1;o<r.length;++o)r[o].radius<C.radius&&(C=r[o]);var A=!1;for(o=0;o<r.length;++o)if(Ia(r[o],C)>Math.abs(C.radius-r[o].radius)){A=!0;break}A?n=a=0:(n=C.radius*C.radius*Math.PI,s.push({circle:C,p1:{x:C.x,y:C.y+C.radius},p2:{x:C.x-r8,y:C.y+C.radius},width:C.radius*2}))}return a/=2,t&&(t.area=n+a,t.arcArea=n,t.polygonArea=a,t.arcs=s,t.innerPoints=i,t.intersectionPoints=e),n+a}function Mxt(r,t){for(var e=0;e<t.length;++e)if(Ia(r,t[e])>t[e].radius+r8)return!1;return!0}function Ixt(r){for(var t=[],e=0;e<r.length;++e)for(var i=e+1;i<r.length;++i)for(var n=n8(r[e],r[i]),a=0;a<n.length;++a){var o=n[a];o.parentIndex=[e,i],t.push(o)}return t}function vC(r,t){return r*r*Math.acos(1-t/r)-(r-t)*Math.sqrt(t*(2*r-t))}function Ia(r,t){return Math.sqrt((r.x-t.x)*(r.x-t.x)+(r.y-t.y)*(r.y-t.y))}function i8(r,t,e){if(e>=r+t)return 0;if(e<=Math.abs(r-t))return Math.PI*Math.min(r,t)*Math.min(r,t);var i=r-(e*e-t*t+r*r)/(2*e),n=t-(e*e-r*r+t*t)/(2*e);return vC(r,i)+vC(t,n)}function n8(r,t){var e=Ia(r,t),i=r.radius,n=t.radius;if(e>=i+n||e<=Math.abs(i-n))return[];var a=(i*i-n*n+e*e)/(2*e),o=Math.sqrt(i*i-a*a),s=r.x+a*(t.x-r.x)/e,l=r.y+a*(t.y-r.y)/e,u=-(t.y-r.y)*(o/e),c=-(t.x-r.x)*(o/e);return[{x:s+u,y:l-c},{x:s-u,y:l+c}]}function a8(r){for(var t={x:0,y:0},e=0;e<r.length;++e)t.x+=r[e].x,t.y+=r[e].y;return t.x/=r.length,t.y/=r.length,t}function x1(r,t,e){var i=t[0].radius-Ia(t[0],r),n,a;for(n=1;n<t.length;++n)a=t[n].radius-Ia(t[n],r),a<=i&&(i=a);for(n=0;n<e.length;++n)a=Ia(e[n],r)-e[n].radius,a<=i&&(i=a);return i}function o8(r,t){var e=[],i;for(i=0;i<r.length;++i){var n=r[i];e.push({x:n.x,y:n.y}),e.push({x:n.x+n.radius/2,y:n.y}),e.push({x:n.x-n.radius/2,y:n.y}),e.push({x:n.x,y:n.y+n.radius/2}),e.push({x:n.x,y:n.y-n.radius/2})}var a=e[0],o=x1(e[0],r,t);for(i=1;i<e.length;++i){var s=x1(e[i],r,t);s>=o&&(a=e[i],o=s)}var l=GF(function(f){return-1*x1({x:f[0],y:f[1]},r,t)},[a.x,a.y],{maxIterations:500,minErrorDelta:1e-10}).x,u={x:l[0],y:l[1]},c=!0;for(i=0;i<r.length;++i)if(Ia(u,r[i])>r[i].radius){c=!1;break}for(i=0;i<t.length;++i)if(Ia(u,t[i])<t[i].radius){c=!1;break}if(!c)if(r.length==1)u={x:r[0].x,y:r[0].y};else{var h={};nT(r,h),h.arcs.length===0?u={x:0,y:-1e3,disjoint:!0}:h.arcs.length==1?u={x:h.arcs[0].circle.x,y:h.arcs[0].circle.y}:t.length?u=o8(r,[]):u=a8(h.arcs.map(function(f){return f.p1}))}return u}function Lxt(r){var t={},e=[];for(var i in r)e.push(i),t[i]=[];for(var n=0;n<e.length;n++)for(var a=r[e[n]],o=n+1;o<e.length;++o){var s=r[e[o]],l=Ia(a,s);l+s.radius<=a.radius+1e-10?t[e[o]].push(e[n]):l+a.radius<=s.radius+1e-10&&t[e[n]].push(e[o])}return t}function Oxt(r,t){for(var e={},i=Lxt(r),n=0;n<t.length;++n){for(var a=t[n].sets,o={},s={},l=0;l<a.length;++l){o[a[l]]=!0;for(var u=i[a[l]],c=0;c<u.length;++c)s[u[c]]=!0}var h=[],f=[];for(var d in r)d in o?h.push(r[d]):d in s||f.push(r[d]);var v=o8(h,f);e[a]=v,v.disjoint&&t[n].size>0&&console.log("WARNING: area "+a+" not represented on screen")}return e}function Pxt(r,t,e){var i=[],n=r-e,a=t;return i.push("M",n,a),i.push("A",e,e,0,1,0,n+2*e,a),i.push("A",e,e,0,1,0,n,a),i.join(" ")}function Fxt(r){var t={};nT(r,t);var e=t.arcs;if(e.length===0)return"M 0 0";if(e.length==1){var i=e[0].circle;return Pxt(i.x,i.y,i.radius)}else{for(var n=[`
M`,e[0].p2.x,e[0].p2.y],a=0;a<e.length;++a){var o=e[a],s=o.circle.radius,l=o.width>s;n.push(`
A`,s,s,0,l?1:0,1,o.p1.x,o.p1.y)}return n.join(" ")}}function Bxt(r,t){t=t||{},t.maxIterations=t.maxIterations||500;var e=t.initialLayout||Uxt,i=t.lossFunction||aT;r=Dxt(r);var n=e(r,t),a=[],o=[],s;for(s in n)n.hasOwnProperty(s)&&(a.push(n[s].x),a.push(n[s].y),o.push(s));for(var l=GF(function(h){for(var f={},d=0;d<o.length;++d){var v=o[d];f[v]={x:h[2*d],y:h[2*d+1],radius:n[v].radius}}return i(f,r)},a,t),u=l.x,c=0;c<o.length;++c)s=o[c],n[s].x=u[2*c],n[s].y=u[2*c+1];return n}var s8=1e-10;function pC(r,t,e){return Math.min(r,t)*Math.min(r,t)*Math.PI<=e+s8?Math.abs(r-t):fW(function(i){return i8(r,t,i)-e},0,r+t)}function Dxt(r){r=r.slice();var t=[],e={},i,n,a,o;for(i=0;i<r.length;++i){var s=r[i];s.sets.length==1?t.push(s.sets[0]):s.sets.length==2&&(a=s.sets[0],o=s.sets[1],e[[a,o]]=!0,e[[o,a]]=!0)}for(t.sort(function(l,u){return l>u?1:-1}),i=0;i<t.length;++i)for(a=t[i],n=i+1;n<t.length;++n)o=t[n],[a,o]in e||r.push({sets:[a,o],size:0});return r}function Nxt(r,t,e){var i=E2(t.length,t.length),n=E2(t.length,t.length);return r.filter(function(a){return a.sets.length==2}).map(function(a){var o=e[a.sets[0]],s=e[a.sets[1]],l=Math.sqrt(t[o].size/Math.PI),u=Math.sqrt(t[s].size/Math.PI),c=pC(l,u,a.size);i[o][s]=i[s][o]=c;var h=0;a.size+1e-10>=Math.min(t[o].size,t[s].size)?h=1:a.size<=1e-10&&(h=-1),n[o][s]=n[s][o]=h}),{distances:i,constraints:n}}function kxt(r,t,e,i){var n=0,a;for(a=0;a<t.length;++a)t[a]=0;for(a=0;a<e.length;++a)for(var o=r[2*a],s=r[2*a+1],l=a+1;l<e.length;++l){var u=r[2*l],c=r[2*l+1],h=e[a][l],f=i[a][l],d=(u-o)*(u-o)+(c-s)*(c-s),v=Math.sqrt(d),p=d-h*h;f>0&&v<=h||f<0&&v>=h||(n+=2*p*p,t[2*a]+=4*p*(o-u),t[2*a+1]+=4*p*(s-c),t[2*l]+=4*p*(u-o),t[2*l+1]+=4*p*(c-s))}return n}function Uxt(r,t){var e=Hxt(r,t),i=t.lossFunction||aT;if(r.length>=8){var n=zxt(r,t),a=i(n,r),o=i(e,r);a+1e-8<o&&(e=n)}return e}function zxt(r,t){t=t||{};var e=t.restarts||10,i=[],n={},a;for(a=0;a<r.length;++a){var o=r[a];o.sets.length==1&&(n[o.sets[0]]=i.length,i.push(o))}var s=Nxt(r,i,n),l=s.distances,u=s.constraints,c=C2(l.map(C2))/l.length;l=l.map(function(y){return y.map(function(_){return _/c})});var h=function(y,_){return kxt(y,_,l,u)},f,d;for(a=0;a<e;++a){var v=uW(l.length*2).map(Math.random);d=cW(h,v,t),(!f||d.fx<f.fx)&&(f=d)}var p=f.x,g={};for(a=0;a<i.length;++a){var m=i[a];g[m.sets[0]]={x:p[2*a]*c,y:p[2*a+1]*c,radius:Math.sqrt(m.size/Math.PI)}}if(t.history)for(a=0;a<t.history.length;++a)hW(t.history[a].x,c);return g}function Hxt(r,t){for(var e=t&&t.lossFunction?t.lossFunction:aT,i={},n={},a,o=0;o<r.length;++o){var s=r[o];s.sets.length==1&&(a=s.sets[0],i[a]={x:1e10,y:1e10,rowid:Object.keys(i).length,size:s.size,radius:Math.sqrt(s.size/Math.PI)},n[a]=[])}r=r.filter(function(k){return k.sets.length==2});for(var o=0;o<r.length;++o){var l=r[o],u=l.hasOwnProperty("weight")?l.weight:1,c=l.sets[0],h=l.sets[1];l.size+s8>=Math.min(i[c].size,i[h].size)&&(u=0),n[c].push({set:h,size:l.size,weight:u}),n[h].push({set:c,size:l.size,weight:u})}var f=[];for(a in n)if(n.hasOwnProperty(a)){for(var d=0,o=0;o<n[a].length;++o)d+=n[a][o].size*n[a][o].weight;f.push({set:a,size:d})}function v(k,V){return V.size-k.size}f.sort(v);var p={};function g(k){return k.set in p}function m(k,V){i[V].x=k.x,i[V].y=k.y,p[V]=!0}m({x:0,y:0},f[0].set);for(var o=1;o<f.length;++o){var y=f[o].set,_=n[y].filter(g);if(a=i[y],_.sort(v),_.length===0)throw"ERROR: missing pairwise overlap information";for(var x=[],C=0;C<_.length;++C){var A=i[_[C].set],b=pC(a.radius,A.radius,_[C].size);x.push({x:A.x+b,y:A.y}),x.push({x:A.x-b,y:A.y}),x.push({y:A.y+b,x:A.x}),x.push({y:A.y-b,x:A.x});for(var R=C+1;R<_.length;++R)for(var M=i[_[R].set],O=pC(a.radius,M.radius,_[R].size),F=n8({x:A.x,y:A.y,radius:b},{x:M.x,y:M.y,radius:O}),D=0;D<F.length;++D)x.push(F[D])}for(var H=1e50,j=x[0],C=0;C<x.length;++C){i[y].x=x[C].x,i[y].y=x[C].y;var $=e(i,r);$<H&&(H=$,j=x[C])}m(j,y)}return i}function aT(r,t){var e=0;function i(c){return c.map(function(h){return r[h]})}for(var n=0;n<t.length;++n){var a=t[n],o=void 0;if(a.sets.length!=1){if(a.sets.length==2){var s=r[a.sets[0]],l=r[a.sets[1]];o=i8(s.radius,l.radius,Ia(s,l))}else o=nT(i(a.sets));var u=a.hasOwnProperty("weight")?a.weight:1;e+=u*(o-a.size)*(o-a.size)}}return e}function $xt(r){var t=function(e){var i=Math.max.apply(null,r.map(function(a){return a[e]+a.radius})),n=Math.min.apply(null,r.map(function(a){return a[e]-a.radius}));return{max:i,min:n}};return{xRange:t("x"),yRange:t("y")}}function Wxt(r,t,e,i){var n=[],a=[];for(var o in r)r.hasOwnProperty(o)&&(a.push(o),n.push(r[o]));t-=2*i,e-=2*i;var s=$xt(n),l=s.xRange,u=s.yRange;if(l.max==l.min||u.max==u.min)return console.log("not scaling solution: zero size detected"),r;for(var c=t/(l.max-l.min),h=e/(u.max-u.min),f=Math.min(h,c),d=(t-(l.max-l.min)*f)/2,v=(e-(u.max-u.min)*f)/2,p={},g=0;g<n.length;++g){var m=n[g];p[a[g]]={radius:f*m.radius,x:i+d+(m.x-l.min)*f,y:i+v+(m.y-u.min)*f}}return p}var Vxt=Nu(function(r,t,e,i){var n=new Map,a=r.length;return t.forEach(function(o,s){if(o[i].length===1)n.set(o[es],r[(s+a)%a]);else{var l=o[i].map(function(u){return n.get(u)});n.set(o[es],l.slice(1).reduce(function(u,c){return Rxt(u,c,e)},l[0]))}}),n},function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];return JSON.stringify(r)});function Gxt(r,t,e,i){i===void 0&&(i=0);var n=r.data,a=r.setsField,o=r.sizeField;if(n.length===0)return cs(Ba.WARN,!1,"warn: %s","数据不能为空"),[];var s=n.map(function(h){var f;return S(S({},h),(f={sets:h[a]||[],size:h[o]},f[dC]="",f[es]="",f))});s.sort(function(h,f){return h.sets.length-f.sets.length});var l=Bxt(s),u=Wxt(l,t,e,i),c=Oxt(u,s);return s.forEach(function(h){var f=h.sets,d=f.join(",");h[es]=d;var v=f.map(function(m){return u[m]}),p=Fxt(v);/[zZ]$/.test(p)||(p+=" Z"),h[dC]=p;var g=c[d]||{x:0,y:0};ne(h,g)}),s}function Xxt(r,t){for(var e=0;e<t.length;e++)if(!r.includes(t[e]))return!1;return!0}var Yxt=40;function l8(r,t,e){var i=r.chart,n=r.options,a=n.blendMode,o=n.setsField,s=i.getTheme(),l=s.colors10,u=s.colors20,c=e;q(c)||(c=t.filter(function(f){return f[o].length===1}).length<=10?l:u);var h=Vxt(c,t,a,o);return function(f){return h.get(f)||c[0]}}function jxt(r,t){var e=r.options,i=e.color;if(typeof i!="function"){var n=typeof i=="string"?[i]:i,a=l8(r,t,n);return function(o){return a(o[es])}}return i}function Zxt(r){var t=r.chart,e=r.options,i=e.legend,n=e.appendPadding,a=e.padding,o=Qs(n);return i!==!1&&(o=yy(n,P(i,"position"),Yxt)),t.appendPadding=kA([o,a]),r}function qxt(r){var t=r.options,e=t.data;e||(cs(Ba.WARN,!1,"warn: %s","数据不能为空"),e=[]);var i=e.filter(function(a){return a.sets.length===1}).map(function(a){return a.sets[0]}),n=e.filter(function(a){var o=a.sets;return Xxt(i,o)});return qt(n,e)||cs(Ba.WARN,!1,"warn: %s","交集中不能出现不存在的集合, 请输入合法数据"),at({},r,{options:{data:n}})}function Kxt(r){var t=r.chart,e=r.options,i=e.pointStyle,n=e.setsField,a=e.sizeField,o=Qs(t.appendPadding),s=o[0],l=o[1],u=o[2],c=o[3],h={offsetX:c,offsetY:s},f=t.viewBBox,d=f.width,v=f.height,p=Gxt(e,Math.max(d-(l+c),0),Math.max(v-(s+u),0),0);t.data(p);var g=WA(W({},r,{options:{xField:"x",yField:"y",sizeField:a,seriesField:es,rawFields:[n,a],schema:{shape:"venn",style:i}}})).ext,m=g.geometry;m.customInfo(h);var y=jxt(r,p);return typeof y=="function"&&m.color(es,function(_){var x=p.find(function(A){return A[es]===_}),C=l8(r,p)(_);return y(x,C)}),r}function Qxt(r){var t=r.chart,e=r.options,i=e.label,n=Qs(t.appendPadding),a=n[0],o=n[3],s={offsetX:o,offsetY:a},l=ti(t,"schema");if(!i)l.label(!1);else{var u=i.callback,c=zt(i,["callback"]);l.label({fields:["id"],callback:u,cfg:at({},Lr(c),{type:"venn",customLabelInfo:s})})}return r}function Jxt(r){var t=r.chart,e=r.options,i=e.legend,n=e.sizeField;return t.legend(es,i),t.legend(n,!1),r}function tCt(r){var t=r.chart;return t.axis(!1),r}function eCt(r){var t=r.options,e=r.chart,i=t.interactions;if(i){var n={"legend-active":"venn-legend-active","legend-highlight":"venn-legend-highlight"};ze(W({},r,{options:{interactions:i.map(function(a){return S(S({},a),{type:n[a.type]||a.type})})}}))}return e.removeInteraction("legend-active"),e.removeInteraction("legend-highlight"),r}function rCt(r){return Rt(Zxt,se,qxt,Kxt,Qxt,Je({}),Jxt,tCt,Cr,eCt,Ce)(r)}(function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="venn",e}return t.getDefaultOptions=function(){return fxt},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return rCt},t.prototype.triggerResize=function(){this.chart.destroyed||(this.chart.forceFit(),this.chart.clear(),this.execAdaptor(),this.chart.render(!0))},t})(Bt);var Gn="x",Gl="violinY",iCt="violinSize",u8="minMax",c8="quantile",h8="median",oT="violin_view",nCt="min_max_view",aCt="quantile_view",oCt="median_view",sCt=W({},Bt.getDefaultOptions(),{syncViewPadding:!0,kde:{type:"triangular",sampleSize:32,width:3},violinStyle:{lineWidth:1,fillOpacity:.3,strokeOpacity:.75},xAxis:{grid:{line:null},tickLine:{alignTick:!1}},yAxis:{grid:{line:{style:{lineWidth:.5,lineDash:[4,4]}}}},legend:{position:"top-left"},tooltip:{showMarkers:!1}});function nL(r,t){var e=r.length*t;if(r.length===0)throw new Error("quantile requires at least one data point.");if(t<0||t>1)throw new Error("quantiles must be between 0 and 1");return t===1?r[r.length-1]:t===0?r[0]:e%1!==0?r[Math.ceil(e)-1]:r.length%2===0?(r[e-1]+r[e])/2:r[e]}function Sf(r,t,e){var i=r[t];r[t]=r[e],r[e]=i}function e0(r,t,e,i){for(e=e||0,i=i||r.length-1;i>e;){if(i-e>600){var n=i-e+1,a=t-e+1,o=Math.log(n),s=.5*Math.exp(2*o/3),l=.5*Math.sqrt(o*s*(n-s)/n);a-n/2<0&&(l*=-1);var u=Math.max(e,Math.floor(t-a*s/n+l)),c=Math.min(i,Math.floor(t+(n-a)*s/n+l));e0(r,t,u,c)}var h=r[t],f=e,d=i;for(Sf(r,e,t),r[i]>h&&Sf(r,e,i);f<d;){for(Sf(r,f,d),f++,d--;r[f]<h;)f++;for(;r[d]>h;)d--}r[e]===h?Sf(r,e,d):(d++,Sf(r,d,i)),d<=t&&(e=d+1),t<=d&&(i=d-1)}}function Af(r,t){var e=r.slice();if(Array.isArray(t)){lCt(e,t);for(var i=[],n=0;n<t.length;n++)i[n]=nL(e,t[n]);return i}else{var a=d8(e.length,t);return f8(e,a,0,e.length-1),nL(e,t)}}function f8(r,t,e,i){t%1===0?e0(r,t,e,i):(t=Math.floor(t),e0(r,t,e,i),e0(r,t+1,t+1,i))}function lCt(r,t){for(var e=[0],i=0;i<t.length;i++)e.push(d8(r.length,t[i]));e.push(r.length-1),e.sort(uCt);for(var n=[0,e.length-1];n.length;){var a=Math.ceil(n.pop()),o=Math.floor(n.pop());if(!(a-o<=1)){var s=Math.floor((o+a)/2);f8(r,e[s],Math.floor(e[o]),Math.ceil(e[a])),n.push(o,s,s,a)}}}function uCt(r,t){return r-t}function d8(r,t){var e=r*t;return t===1?r-1:t===0?0:e%1!==0?Math.ceil(e)-1:r%2===0?e-.5:e}var aL=function(r){return{low:Tn(r),high:rn(r),q1:Af(r,.25),q3:Af(r,.75),median:Af(r,[.5]),minMax:[Tn(r),rn(r)],quantile:[Af(r,.25),Af(r,.75)]}},oL=function(r,t){var e=dW.create(r,t);return{violinSize:e.map(function(i){return i.y}),violinY:e.map(function(i){return i.x})}},v8=function(r){var t=r.xField,e=r.yField,i=r.seriesField,n=r.data,a=r.kde,o={min:a.min,max:a.max,size:a.sampleSize,width:a.width};if(!i){var s=Qi(n,t);return Object.keys(s).map(function(c){var h=s[c],f=h.map(function(d){return d[e]});return S(S({x:c},oL(f,o)),aL(f))})}var l=[],u=Qi(n,i);return Object.keys(u).forEach(function(c){var h=Qi(u[c],t);return Object.keys(h).forEach(function(f){var d,v=h[f],p=v.map(function(g){return g[e]});l.push(S(S((d={x:f},d[i]=c,d),oL(p,o)),aL(p)))})}),l},r0=["low","high","q1","q3","median"],i0=[{type:"dodge",marginRatio:1/32}];function cCt(r){var t=r.chart,e=r.options;return t.data(v8(e)),r}function hCt(r){var t=r.chart,e=r.options,i=e.seriesField,n=e.color,a=e.shape,o=a===void 0?"violin":a,s=e.violinStyle,l=e.tooltip,u=e.state,c=t.createView({id:oT});return ggt({chart:c,options:{xField:Gn,yField:Gl,seriesField:i||Gn,sizeField:iCt,tooltip:S({fields:r0},l),violin:{style:s,color:n,shape:o},state:u}}),c.geometries[0].adjust(i0),r}function fCt(r){var t=r.chart,e=r.options,i=e.seriesField,n=e.color,a=e.tooltip,o=e.box;if(o===!1)return r;var s=t.createView({id:nCt});ei({chart:s,options:{xField:Gn,yField:u8,seriesField:i||Gn,tooltip:S({fields:r0},a),state:typeof o=="object"?o.state:{},interval:{color:n,size:1,style:{lineWidth:0}}}}),s.geometries[0].adjust(i0);var l=t.createView({id:aCt});ei({chart:l,options:{xField:Gn,yField:c8,seriesField:i||Gn,tooltip:S({fields:r0},a),state:typeof o=="object"?o.state:{},interval:{color:n,size:8,style:{fillOpacity:1}}}}),l.geometries[0].adjust(i0);var u=t.createView({id:oCt});return Fn({chart:u,options:{xField:Gn,yField:h8,seriesField:i||Gn,tooltip:S({fields:r0},a),state:typeof o=="object"?o.state:{},point:{color:n,size:1,style:{fill:"white",lineWidth:0}}}}),u.geometries[0].adjust(i0),l.axis(!1),s.axis(!1),u.axis(!1),u.legend(!1),s.legend(!1),l.legend(!1),r}function dCt(r){var t,e=r.chart,i=r.options,n=i.meta,a=i.xAxis,o=i.yAxis,s={},l=W(s,n,(t={},t[Gn]=S(S({sync:!0},ye(a,Xi)),{type:"cat"}),t[Gl]=S({sync:!0},ye(o,Xi)),t[u8]=S({sync:Gl},ye(o,Xi)),t[c8]=S({sync:Gl},ye(o,Xi)),t[h8]=S({sync:Gl},ye(o,Xi)),t));return e.scale(l),r}function vCt(r){var t=r.chart,e=r.options,i=e.xAxis,n=e.yAxis,a=Ht(t,oT);return i===!1?a.axis(Gn,!1):a.axis(Gn,i),n===!1?a.axis(Gl,!1):a.axis(Gl,n),t.axis(!1),r}function pCt(r){var t=r.chart,e=r.options,i=e.legend,n=e.seriesField,a=e.shape;if(i===!1)t.legend(!1);else{var o=n||Gn,s=Rv(i,["selected"]);(!a||!a.startsWith("hollow"))&&(P(s,["marker","style","lineWidth"])||or(s,["marker","style","lineWidth"],0)),t.legend(o,s),P(i,"selected")&&I(t.views,function(l){return l.legend(o,i)})}return r}function gCt(r){var t=r.chart,e=Ht(t,oT);return We()(S(S({},r),{chart:e})),r}function mCt(r){var t=r.chart,e=r.options,i=e.animation;return I(t.views,function(n){Zv(n,i)}),r}function yCt(r){return Rt(se,cCt,hCt,fCt,dCt,Cr,vCt,pCt,ze,gCt,mCt)(r)}(function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="violin",e}return t.getDefaultOptions=function(){return sCt},t.prototype.changeData=function(e){this.updateOption({data:e}),this.chart.changeData(v8(this.options))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return yCt},t})(Bt);var Kn="$$yField$$",Iy="$$diffField$$",sT="$$absoluteField$$",gC="$$isTotal$$",_Ct={label:{},leaderLine:{style:{lineWidth:1,stroke:"#8c8c8c",lineDash:[4,2]}},total:{style:{fill:"rgba(0, 0, 0, 0.25)"}},interactions:[{type:"element-active"}],risingFill:"#f4664a",fallingFill:"#30bf78",waterfallStyle:{fill:"rgba(0, 0, 0, 0.25)"},yAxis:{grid:{line:{style:{lineDash:[4,2]}}}}};function xCt(r){for(var t=[],e=0;e<r.length;e++){var i=r[e];if(i){var n=e===0?"M":"L";t.push([n,i.x,i.y])}}var a=r[0];return t.push(["L",a.x,a.y]),t.push(["z"]),t}function CCt(r){return W({},r.defaultStyle,r.style,{fill:r.color})}de("interval","waterfall",{draw:function(r,t){var e=r.customInfo,i=r.points,n=r.nextPoints,a=t.addGroup(),o=this.parsePath(xCt(i)),s=CCt(r);a.addShape("path",{attrs:S(S({},s),{path:o})});var l=P(e,"leaderLine");if(l&&n){var u=[["M",i[2].x,i[2].y],["L",n[0].x,n[0].y]];i[2].y===n[1].y&&(u[1]=["L",n[1].x,n[1].y]),u=this.parsePath(u),a.addShape("path",{attrs:S({path:u},l.style||{})})}return a}});function ECt(r,t,e,i,n){var a,o=[];if(Qr(r,function(l,u){var c;cs(Ba.WARN,Tt(u[e]),"".concat(u[e]," is not a valid number"));var h=zr(u[e])?null:u[e];return o.push(S(S({},u),(c={},c[i]=[l,l+h],c))),l+h},0),o.length&&n){var s=P(o,[[r.length-1],i,[1]]);o.push((a={},a[t]=n.label,a[e]=s,a[i]=[0,s],a))}return o}function p8(r,t,e,i){var n=ECt(r,t,e,Kn,i);return n.map(function(a,o){var s;return ie(a)?S(S({},a),(s={},s[sT]=a[Kn][1],s[Iy]=a[Kn][1]-a[Kn][0],s[gC]=o===r.length,s)):a})}function SCt(r){var t=r.options,e=t.locale,i=t.total,n=Cy(e).get(["waterfall","total"]);return i&&typeof i.label!="string"&&n&&(r.options.total.label=n),r}function ACt(r){var t=r.chart,e=r.options,i=e.data,n=e.xField,a=e.yField,o=e.total,s=e.leaderLine,l=e.columnWidthRatio,u=e.waterfallStyle,c=e.risingFill,h=e.fallingFill,f=e.color,d=e.shape,v=e.customInfo;t.data(p8(i,n,a,o));var p=f||function(_){return P(_,[gC])?P(o,["style","fill"],""):P(_,[Kn,1])-P(_,[Kn,0])>0?c:h},g=W({},r,{options:{xField:n,yField:Kn,seriesField:n,rawFields:[a,Iy,gC,Kn],widthRatio:l,interval:{style:u,shape:d||"waterfall",color:p}}}),m=ei(g).ext,y=m.geometry;return y.customInfo(S(S({},v),{leaderLine:s})),r}function TCt(r){var t,e,i=r.options,n=i.xAxis,a=i.yAxis,o=i.xField,s=i.yField,l=i.meta,u=W({},{alias:s},P(l,s));return Rt(Je((t={},t[o]=n,t[s]=a,t[Kn]=a,t),W({},l,(e={},e[Kn]=u,e[Iy]=u,e[sT]=u,e))))(r)}function bCt(r){var t=r.chart,e=r.options,i=e.xAxis,n=e.yAxis,a=e.xField,o=e.yField;return i===!1?t.axis(a,!1):t.axis(a,i),n===!1?(t.axis(o,!1),t.axis(Kn,!1)):(t.axis(o,n),t.axis(Kn,n)),r}function wCt(r){var t=r.chart,e=r.options,i=e.legend,n=e.total,a=e.risingFill,o=e.fallingFill,s=e.locale,l=Cy(s);if(i===!1)t.legend(!1);else{var u=[{name:l.get(["general","increase"]),value:"increase",marker:{symbol:"square",style:{r:5,fill:a}}},{name:l.get(["general","decrease"]),value:"decrease",marker:{symbol:"square",style:{r:5,fill:o}}}];n&&u.push({name:n.label||"",value:"total",marker:{symbol:"square",style:W({},{r:5},P(n,"style"))}}),t.legend(W({},{custom:!0,position:"top",items:u},i)),t.removeInteraction("legend-filter")}return r}function RCt(r){var t=r.chart,e=r.options,i=e.label,n=e.labelMode,a=e.xField,o=ti(t,"interval");if(!i)o.label(!1);else{var s=i.callback,l=zt(i,["callback"]);o.label({fields:n==="absolute"?[sT,a]:[Iy,a],callback:s,cfg:Lr(l)})}return r}function MCt(r){var t=r.chart,e=r.options,i=e.tooltip,n=e.xField,a=e.yField;if(i!==!1){t.tooltip(S({showCrosshairs:!1,showMarkers:!1,shared:!0,fields:[a]},i));var o=t.geometries[0];i!=null&&i.formatter?o.tooltip("".concat(n,"*").concat(a),i.formatter):o.tooltip(a)}else t.tooltip(!1);return r}function ICt(r){return Rt(SCt,se,ACt,TCt,bCt,wCt,MCt,RCt,pl,ze,Ce,We())(r)}var LCt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="waterfall",e}return t.getDefaultOptions=function(){return _Ct},t.prototype.changeData=function(e){var i=this.options,n=i.xField,a=i.yField,o=i.total;this.updateOption({data:e}),this.chart.changeData(p8(e,n,a,o))},t.prototype.getSchemaAdaptor=function(){return ICt},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t}(Bt);const KWt=Object.freeze(Object.defineProperty({__proto__:null,Waterfall:LCt},Symbol.toStringTag,{value:"Module"}));var lT="color",OCt=W({},Bt.getDefaultOptions(),{timeInterval:2e3,legend:!1,tooltip:{showTitle:!1,showMarkers:!1,showCrosshairs:!1,fields:["text","value",lT],formatter:function(r){return{name:r.text,value:r.value}}},wordStyle:{fontFamily:"Verdana",fontWeight:"normal",padding:1,fontSize:[12,60],rotation:[0,90],rotationSteps:2,rotateRatio:.5}}),PCt={font:function(){return"serif"},padding:1,size:[500,500],spiral:"archimedean",timeInterval:3e3};function FCt(r,t){return t=ne({},PCt,t),BCt(r,t)}function BCt(r,t){var e=jCt();["font","fontSize","fontWeight","padding","rotate","size","spiral","timeInterval","random"].forEach(function(l){K(t[l])||e[l](t[l])}),e.words(r),t.imageMask&&e.createMask(t.imageMask);var i=e.start(),n=i._tags;n.forEach(function(l){l.x+=t.size[0]/2,l.y+=t.size[1]/2});var a=t.size,o=a[0],s=a[1];return n.push({text:"",value:0,x:0,y:0,opacity:0}),n.push({text:"",value:0,x:o,y:s,opacity:0}),n}var C1=Math.PI/180,zf=64,n0=2048;function DCt(r){return r.text}function NCt(){return"serif"}function sL(){return"normal"}function kCt(r){return r.value}function UCt(){return~~(Math.random()*2)*90}function zCt(){return 1}function HCt(r,t,e,i){if(!t.sprite){var n=r.context,a=r.ratio;n.clearRect(0,0,(zf<<5)/a,n0/a);var o=0,s=0,l=0,u=e.length;for(--i;++i<u;){t=e[i],n.save(),n.font=t.style+" "+t.weight+" "+~~((t.size+1)/a)+"px "+t.font;var c=n.measureText(t.text+"m").width*a,h=t.size<<1;if(t.rotate){var f=Math.sin(t.rotate*C1),d=Math.cos(t.rotate*C1),v=c*d,p=c*f,g=h*d,m=h*f;c=Math.max(Math.abs(v+m),Math.abs(v-m))+31>>5<<5,h=~~Math.max(Math.abs(p+g),Math.abs(p-g))}else c=c+31>>5<<5;if(h>l&&(l=h),o+c>=zf<<5&&(o=0,s+=l,l=0),s+h>=n0)break;n.translate((o+(c>>1))/a,(s+(h>>1))/a),t.rotate&&n.rotate(t.rotate*C1),n.fillText(t.text,0,0),t.padding&&(n.lineWidth=2*t.padding,n.strokeText(t.text,0,0)),n.restore(),t.width=c,t.height=h,t.xoff=o,t.yoff=s,t.x1=c>>1,t.y1=h>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,o+=c}for(var y=n.getImageData(0,0,(zf<<5)/a,n0/a).data,_=[];--i>=0;)if(t=e[i],!!t.hasText){for(var c=t.width,x=c>>5,h=t.y1-t.y0,C=0;C<h*x;C++)_[C]=0;if(o=t.xoff,o==null)return;s=t.yoff;for(var A=0,b=-1,R=0;R<h;R++){for(var C=0;C<c;C++){var M=x*R+(C>>5),O=y[(s+R)*(zf<<5)+(o+C)<<2]?1<<31-C%32:0;_[M]|=O,A|=O}A?b=R:(t.y0++,h--,R--,s++)}t.y1=t.y0+b,t.sprite=_.slice(0,(t.y1-t.y0)*x)}}}function $Ct(r,t,e){e>>=5;for(var i=r.sprite,n=r.width>>5,a=r.x-(n<<4),o=a&127,s=32-o,l=r.y1-r.y0,u=(r.y+r.y0)*e+(a>>5),c,h=0;h<l;h++){c=0;for(var f=0;f<=n;f++)if((c<<s|(f<n?(c=i[h*n+f])>>>o:0))&t[u+f])return!0;u+=e}return!1}function WCt(r,t){var e=r[0],i=r[1];t.x+t.x0<e.x&&(e.x=t.x+t.x0),t.y+t.y0<e.y&&(e.y=t.y+t.y0),t.x+t.x1>i.x&&(i.x=t.x+t.x1),t.y+t.y1>i.y&&(i.y=t.y+t.y1)}function VCt(r,t){return r.x+r.x1>t[0].x&&r.x+r.x0<t[1].x&&r.y+r.y1>t[0].y&&r.y+r.y0<t[1].y}function g8(r){var t=r[0]/r[1];return function(e){return[t*(e*=.1)*Math.cos(e),e*Math.sin(e)]}}function GCt(r){var t=4,e=t*r[0]/r[1],i=0,n=0;return function(a){var o=a<0?-1:1;switch(Math.sqrt(1+4*o*a)-o&3){case 0:i+=e;break;case 1:n+=t;break;case 2:i-=e;break;default:n-=t;break}return[i,n]}}function lL(r){for(var t=[],e=-1;++e<r;)t[e]=0;return t}function XCt(){return document.createElement("canvas")}function Qa(r){return ot(r)?r:function(){return r}}var YCt={archimedean:g8,rectangular:GCt};function jCt(){var r=[256,256],t=NCt,e=kCt,i=sL,n=UCt,a=zCt,o=g8,s=Math.random,l=[],u=1/0,c=DCt,h=sL,f=XCt,d={};d.start=function(){var g=r[0],m=r[1],y=v(f()),_=d.board?d.board:lL((r[0]>>5)*r[1]),x=l.length,C=[],A=l.map(function(O,F,D){return O.text=c.call(this,O,F,D),O.font=t.call(this,O,F,D),O.style=h.call(this,O,F,D),O.weight=i.call(this,O,F,D),O.rotate=n.call(this,O,F,D),O.size=~~e.call(this,O,F,D),O.padding=a.call(this,O,F,D),O}).sort(function(O,F){return F.size-O.size}),b=-1,R=d.board?[{x:0,y:0},{x:g,y:m}]:null;M();function M(){for(var O=Date.now();Date.now()-O<u&&++b<x;){var F=A[b];F.x=g*(s()+.5)>>1,F.y=m*(s()+.5)>>1,HCt(y,F,A,b),F.hasText&&p(_,F,R)&&(C.push(F),R?d.hasImage||WCt(R,F):R=[{x:F.x+F.x0,y:F.y+F.y0},{x:F.x+F.x1,y:F.y+F.y1}],F.x-=r[0]>>1,F.y-=r[1]>>1)}d._tags=C,d._bounds=R}return d};function v(g){g.width=g.height=1;var m=Math.sqrt(g.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,1,1).data.length>>2);g.width=(zf<<5)/m,g.height=n0/m;var y=g.getContext("2d",{willReadFrequently:!0});return y.fillStyle=y.strokeStyle="red",y.textAlign="center",{context:y,ratio:m}}function p(g,m,y){for(var _=m.x,x=m.y,C=Math.sqrt(r[0]*r[0]+r[1]*r[1]),A=o(r),b=s()<.5?1:-1,R,M=-b,O,F;(R=A(M+=b))&&(O=~~R[0],F=~~R[1],!(Math.min(Math.abs(O),Math.abs(F))>=C));)if(m.x=_+O,m.y=x+F,!(m.x+m.x0<0||m.y+m.y0<0||m.x+m.x1>r[0]||m.y+m.y1>r[1])&&(!y||!$Ct(m,g,r[0]))&&(!y||VCt(m,y))){for(var D=m.sprite,H=m.width>>5,j=r[0]>>5,$=m.x-(H<<4),k=$&127,V=32-k,Q=m.y1-m.y0,Y=void 0,tt=(m.y+m.y0)*j+($>>5),et=0;et<Q;et++){Y=0;for(var dt=0;dt<=H;dt++)g[tt+dt]|=Y<<V|(dt<H?(Y=D[et*H+dt])>>>k:0);tt+=j}return delete m.sprite,!0}return!1}return d.createMask=function(g){var m=document.createElement("canvas"),y=r[0],_=r[1];if(!(!y||!_)){var x=y>>5,C=lL((y>>5)*_);m.width=y,m.height=_;var A=m.getContext("2d");A.drawImage(g,0,0,g.width,g.height,0,0,y,_);for(var b=A.getImageData(0,0,y,_).data,R=0;R<_;R++)for(var M=0;M<y;M++){var O=x*R+(M>>5),F=R*y+M<<2,D=b[F]>=250&&b[F+1]>=250&&b[F+2]>=250,H=D?1<<31-M%32:0;C[O]|=H}d.board=C,d.hasImage=!0}},d.timeInterval=function(g){u=g??1/0},d.words=function(g){l=g},d.size=function(g){r=[+g[0],+g[1]]},d.font=function(g){t=Qa(g)},d.fontWeight=function(g){i=Qa(g)},d.rotate=function(g){n=Qa(g)},d.spiral=function(g){o=YCt[g]||g},d.fontSize=function(g){e=Qa(g)},d.padding=function(g){a=Qa(g)},d.random=function(g){s=Qa(g)},d}function m8(r){var t=r.options,e=r.chart,i=e,n=i.width,a=i.height,o=i.padding,s=i.appendPadding,l=i.ele,u=t.data,c=t.imageMask,h=t.wordField,f=t.weightField,d=t.colorField,v=t.wordStyle,p=t.timeInterval,g=t.random,m=t.spiral,y=t.autoFit,_=y===void 0?!0:y,x=t.placementStrategy;if(!u||!u.length)return[];var C=v.fontFamily,A=v.fontWeight,b=v.padding,R=v.fontSize,M=JCt(u,f),O=[rEt(M),iEt(M)],F=u.map(function(j){return{text:j[h],value:j[f],color:j[d],datum:j}}),D={imageMask:c,font:C,fontSize:QCt(R,O),fontWeight:A,size:ZCt({width:n,height:a,padding:o,appendPadding:s,autoFit:_,container:l}),padding:b,timeInterval:p,random:g,spiral:m,rotate:tEt(t)};if(ot(x)){var H=F.map(function(j,$,k){return S(S(S({},j),{hasText:!!j.text,font:Qa(D.font)(j,$,k),weight:Qa(D.fontWeight)(j,$,k),rotate:Qa(D.rotate)(j,$,k),size:Qa(D.fontSize)(j,$,k),style:"normal"}),x.call(e,j,$,k))});return H.push({text:"",value:0,x:0,y:0,opacity:0}),H.push({text:"",value:0,x:D.size[0],y:D.size[1],opacity:0}),H}return FCt(F,D)}function ZCt(r){var t=r.width,e=r.height,i=r.container,n=r.autoFit,a=r.padding,o=r.appendPadding;if(n){var s=sC(i);t=s.width,e=s.height}t=t||400,e=e||400;var l=qCt({padding:a,appendPadding:o}),u=l[0],c=l[1],h=l[2],f=l[3],d=[t-(f+c),e-(u+h)];return d}function qCt(r){var t=Qs(r.padding),e=Qs(r.appendPadding),i=t[0]+e[0],n=t[1]+e[1],a=t[2]+e[2],o=t[3]+e[3];return[i,n,a,o]}function KCt(r){return new Promise(function(t,e){if(r instanceof HTMLImageElement){t(r);return}if(mt(r)){var i=new Image;i.crossOrigin="anonymous",i.src=r,i.onload=function(){t(i)},i.onerror=function(){cs(Ba.ERROR,!1,"image %s load failed !!!",r),e()};return}cs(Ba.WARN,r===void 0,"The type of imageMask option must be String or HTMLImageElement."),e()})}function QCt(r,t){if(ot(r))return r;if(q(r)){var e=r[0],i=r[1];if(!t)return function(){return(i+e)/2};var n=t[0],a=t[1];return a===n?function(){return(i+e)/2}:function(s){var l=s.value;return(i-e)/(a-n)*(l-n)+e}}return function(){return r}}function JCt(r,t){return r.map(function(e){return e[t]}).filter(function(e){return typeof e=="number"&&!isNaN(e)})}function tEt(r){var t=eEt(r),e=t.rotation,i=t.rotationSteps;if(!q(e))return e;var n=e[0],a=e[1],o=i===1?0:(a-n)/(i-1);return function(){return a===n?a:Math.floor(Math.random()*i)*o}}function eEt(r){var t=r.wordStyle.rotationSteps;return t<1&&(cs(Ba.WARN,!1,"The rotationSteps option must be greater than or equal to 1."),t=1),{rotation:r.wordStyle.rotation,rotationSteps:t}}function rEt(r){return Math.min.apply(Math,r)}function iEt(r){return Math.max.apply(Math,r)}function nEt(r){var t=r.chart,e=r.options,i=e.colorField,n=e.color,a=m8(r);t.data(a);var o=W({},r,{options:{xField:"x",yField:"y",seriesField:i&&lT,rawFields:ot(n)&&xt(xt([],P(e,"rawFields",[]),!0),["datum"],!1),point:{color:n,shape:"word-cloud"}}}),s=Fn(o).ext;return s.geometry.label(!1),t.coordinate().reflect("y"),t.axis(!1),r}function aEt(r){return Rt(Je({x:{nice:!1},y:{nice:!1}}))(r)}function oEt(r){var t=r.chart,e=r.options,i=e.legend,n=e.colorField;return i===!1?t.legend(!1):n&&t.legend(lT,i),r}function sEt(r){Rt(nEt,aEt,Cr,oEt,ze,Ce,se,pl)(r)}de("point","word-cloud",{draw:function(r,t){var e=r.x,i=r.y,n=t.addShape("text",{attrs:S(S({},lEt(r)),{x:e,y:i})}),a=r.data.rotate;return typeof a=="number"&&nn.rotate(n,a*Math.PI/180),n}});function lEt(r){return{fontSize:r.data.size,text:r.data.text,textAlign:"center",fontFamily:r.data.font,fontWeight:r.data.weight,fill:r.color||r.defaultStyle.stroke,textBaseline:"alphabetic"}}var uEt=function(r){N(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.type="word-cloud",e}return t.getDefaultOptions=function(){return OCt},t.prototype.changeData=function(e){this.updateOption({data:e}),this.options.imageMask?this.render():this.chart.changeData(m8({chart:this.chart,options:this.options}))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.render=function(){var e=this;return new Promise(function(i){var n=e.options.imageMask;if(!n){r.prototype.render.call(e),i();return}var a=function(o){e.options=S(S({},e.options),{imageMask:o||null}),r.prototype.render.call(e),i()};KCt(n).then(a).catch(a)})},t.prototype.getSchemaAdaptor=function(){return sEt},t.prototype.triggerResize=function(){var e=this;this.chart.destroyed||(this.execAdaptor(),window.setTimeout(function(){r.prototype.triggerResize.call(e)}))},t}(Bt);const QWt=Object.freeze(Object.defineProperty({__proto__:null,WordCloud:uEt},Symbol.toStringTag,{value:"Module"}));(function(r){N(t,r);function t(e,i,n,a){var o=r.call(this,e,W({},a,i))||this;return o.type="g2-plot",o.defaultOptions=a,o.adaptor=n,o}return t.prototype.getDefaultOptions=function(){return this.defaultOptions},t.prototype.getSchemaAdaptor=function(){return this.adaptor},t})(Bt);L6("en-US",dgt);L6("zh-CN",vgt);var Ly={};const Wu=Pu(Jat);var so={},Oy={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.COMPONENT_MAX_VIEW_PERCENTAGE=r.MIN_CHART_HEIGHT=r.MIN_CHART_WIDTH=r.FIELD_ORIGIN=r.GROUP_ATTRS=r.ELEMENT_STATE=r.PLOT_EVENTS=r.GEOMETRY_LIFE_CIRCLE=r.VIEW_LIFE_CIRCLE=r.GROUP_Z_INDEX=r.COMPONENT_TYPE=r.DIRECTION=r.LAYER=void 0,function(t){t.FORE="fore",t.MID="mid",t.BG="bg"}(r.LAYER||(r.LAYER={})),function(t){t.TOP="top",t.TOP_LEFT="top-left",t.TOP_RIGHT="top-right",t.RIGHT="right",t.RIGHT_TOP="right-top",t.RIGHT_BOTTOM="right-bottom",t.LEFT="left",t.LEFT_TOP="left-top",t.LEFT_BOTTOM="left-bottom",t.BOTTOM="bottom",t.BOTTOM_LEFT="bottom-left",t.BOTTOM_RIGHT="bottom-right",t.RADIUS="radius",t.CIRCLE="circle",t.NONE="none"}(r.DIRECTION||(r.DIRECTION={})),function(t){t.AXIS="axis",t.GRID="grid",t.LEGEND="legend",t.TOOLTIP="tooltip",t.ANNOTATION="annotation",t.SLIDER="slider",t.SCROLLBAR="scrollbar",t.OTHER="other"}(r.COMPONENT_TYPE||(r.COMPONENT_TYPE={})),r.GROUP_Z_INDEX={FORE:3,MID:2,BG:1},function(t){t.BEFORE_RENDER="beforerender",t.AFTER_RENDER="afterrender",t.BEFORE_PAINT="beforepaint",t.AFTER_PAINT="afterpaint",t.BEFORE_CHANGE_DATA="beforechangedata",t.AFTER_CHANGE_DATA="afterchangedata",t.BEFORE_CLEAR="beforeclear",t.AFTER_CLEAR="afterclear",t.BEFORE_DESTROY="beforedestroy",t.BEFORE_CHANGE_SIZE="beforechangesize",t.AFTER_CHANGE_SIZE="afterchangesize"}(r.VIEW_LIFE_CIRCLE||(r.VIEW_LIFE_CIRCLE={})),function(t){t.BEFORE_DRAW_ANIMATE="beforeanimate",t.AFTER_DRAW_ANIMATE="afteranimate",t.BEFORE_RENDER_LABEL="beforerenderlabel",t.AFTER_RENDER_LABEL="afterrenderlabel"}(r.GEOMETRY_LIFE_CIRCLE||(r.GEOMETRY_LIFE_CIRCLE={})),function(t){t.MOUSE_ENTER="plot:mouseenter",t.MOUSE_DOWN="plot:mousedown",t.MOUSE_MOVE="plot:mousemove",t.MOUSE_UP="plot:mouseup",t.MOUSE_LEAVE="plot:mouseleave",t.TOUCH_START="plot:touchstart",t.TOUCH_MOVE="plot:touchmove",t.TOUCH_END="plot:touchend",t.TOUCH_CANCEL="plot:touchcancel",t.CLICK="plot:click",t.DBLCLICK="plot:dblclick",t.CONTEXTMENU="plot:contextmenu",t.LEAVE="plot:leave",t.ENTER="plot:enter"}(r.PLOT_EVENTS||(r.PLOT_EVENTS={})),function(t){t.ACTIVE="active",t.INACTIVE="inactive",t.SELECTED="selected",t.DEFAULT="default"}(r.ELEMENT_STATE||(r.ELEMENT_STATE={})),r.GROUP_ATTRS=["color","shape","size"],r.FIELD_ORIGIN="_origin",r.MIN_CHART_WIDTH=1,r.MIN_CHART_HEIGHT=1,r.COMPONENT_MAX_VIEW_PERCENTAGE=.25})(Oy);var Vi={},y8={};const cEt=Pu(xst),hEt=Pu(Mst),uL=Pu(ylt),fEt=Pu(Clt),dEt=Pu(mlt),vEt=Pu(Hut);(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.Scrollbar=r.Slider=r.HtmlTooltip=r.ContinuousLegend=r.CategoryLegend=r.CircleGrid=r.LineGrid=r.CircleAxis=r.LineAxis=r.Annotation=r.Crosshair=r.Component=r.GroupComponent=r.HtmlComponent=r.Scale=r.registerScale=r.getScale=r.Coordinate=r.registerCoordinate=r.getCoordinate=r.Color=r.Attribute=r.getAttribute=r.Adjust=r.getAdjust=r.registerAdjust=r.AbstractShape=r.AbstractGroup=r.Event=void 0;var t=cEt;Object.defineProperty(r,"Event",{enumerable:!0,get:function(){return t.Event}}),Object.defineProperty(r,"AbstractGroup",{enumerable:!0,get:function(){return t.AbstractGroup}}),Object.defineProperty(r,"AbstractShape",{enumerable:!0,get:function(){return t.AbstractShape}});var e=hEt;Object.defineProperty(r,"registerAdjust",{enumerable:!0,get:function(){return e.registerAdjust}}),Object.defineProperty(r,"getAdjust",{enumerable:!0,get:function(){return e.getAdjust}}),Object.defineProperty(r,"Adjust",{enumerable:!0,get:function(){return e.Adjust}});var i=uL;Object.defineProperty(r,"getAttribute",{enumerable:!0,get:function(){return i.getAttribute}}),Object.defineProperty(r,"Attribute",{enumerable:!0,get:function(){return i.Attribute}});var n=uL;Object.defineProperty(r,"Color",{enumerable:!0,get:function(){return n.Color}});var a=fEt;Object.defineProperty(r,"getCoordinate",{enumerable:!0,get:function(){return a.getCoordinate}}),Object.defineProperty(r,"registerCoordinate",{enumerable:!0,get:function(){return a.registerCoordinate}}),Object.defineProperty(r,"Coordinate",{enumerable:!0,get:function(){return a.Coordinate}});var o=dEt;Object.defineProperty(r,"getScale",{enumerable:!0,get:function(){return o.getScale}}),Object.defineProperty(r,"registerScale",{enumerable:!0,get:function(){return o.registerScale}}),Object.defineProperty(r,"Scale",{enumerable:!0,get:function(){return o.Scale}});var s=vEt;Object.defineProperty(r,"Annotation",{enumerable:!0,get:function(){return s.Annotation}}),Object.defineProperty(r,"Component",{enumerable:!0,get:function(){return s.Component}}),Object.defineProperty(r,"Crosshair",{enumerable:!0,get:function(){return s.Crosshair}}),Object.defineProperty(r,"GroupComponent",{enumerable:!0,get:function(){return s.GroupComponent}}),Object.defineProperty(r,"HtmlComponent",{enumerable:!0,get:function(){return s.HtmlComponent}}),Object.defineProperty(r,"Slider",{enumerable:!0,get:function(){return s.Slider}}),Object.defineProperty(r,"Scrollbar",{enumerable:!0,get:function(){return s.Scrollbar}});var l=s.Axis.Line,u=s.Axis.Circle;r.LineAxis=l,r.CircleAxis=u;var c=s.Grid.Line,h=s.Grid.Circle;r.LineGrid=c,r.CircleGrid=h;var f=s.Legend.Category,d=s.Legend.Continuous;r.CategoryLegend=f,r.ContinuousLegend=d;var v=s.Tooltip.Html;r.HtmlTooltip=v})(y8);var oi={},Ci={};Object.defineProperty(Ci,"__esModule",{value:!0});Ci.getReplaceAttrs=Ci.getPolygonCentroid=Ci.getAngle=Ci.getArcPath=Ci.getSectorPath=Ci.polarToCartesian=void 0;var el=Wu;function pEt(r){if((0,el.isEmpty)(r))return null;var t=r[0].x,e=r[0].x,i=r[0].y,n=r[0].y;return(0,el.each)(r,function(a){t=t>a.x?a.x:t,e=e<a.x?a.x:e,i=i>a.y?a.y:i,n=n<a.y?a.y:n}),{minX:t,maxX:e,minY:i,maxY:n,centerX:(t+e)/2,centerY:(i+n)/2}}function cL(r){return Array.from(new Set(r)).length===1}function hL(r){return((0,el.min)(r)+(0,el.max)(r))/2}function Ja(r,t,e,i){return{x:r+e*Math.cos(i),y:t+e*Math.sin(i)}}Ci.polarToCartesian=Ja;function gEt(r,t,e,i,n,a){a===void 0&&(a=0);var o=Ja(r,t,e,i),s=Ja(r,t,e,n),l=Ja(r,t,a,i),u=Ja(r,t,a,n);if(n-i===Math.PI*2){var c=Ja(r,t,e,i+Math.PI),h=Ja(r,t,a,i+Math.PI),f=[["M",o.x,o.y],["A",e,e,0,1,1,c.x,c.y],["A",e,e,0,1,1,s.x,s.y],["M",l.x,l.y]];return a&&(f.push(["A",a,a,0,1,0,h.x,h.y]),f.push(["A",a,a,0,1,0,u.x,u.y])),f.push(["M",o.x,o.y]),f.push(["Z"]),f}var d=n-i<=Math.PI?0:1,v=[["M",o.x,o.y],["A",e,e,0,d,1,s.x,s.y],["L",u.x,u.y]];return a&&v.push(["A",a,a,0,d,0,l.x,l.y]),v.push(["L",o.x,o.y]),v.push(["Z"]),v}Ci.getSectorPath=gEt;function mEt(r,t,e,i,n){var a=Ja(r,t,e,i),o=Ja(r,t,e,n);if((0,el.isNumberEqual)(n-i,Math.PI*2)){var s=Ja(r,t,e,i+Math.PI);return[["M",a.x,a.y],["A",e,e,0,1,1,s.x,s.y],["A",e,e,0,1,1,a.x,a.y],["A",e,e,0,1,0,s.x,s.y],["A",e,e,0,1,0,a.x,a.y],["Z"]]}var l=n-i<=Math.PI?0:1;return[["M",a.x,a.y],["A",e,e,0,l,1,o.x,o.y]]}Ci.getArcPath=mEt;function yEt(r,t){var e=r.points,i=pEt(e),n,a,o=t.startAngle,s=t.endAngle,l=s-o;return t.isTransposed?(n=i.maxY*l,a=i.minY*l):(n=i.maxX*l,a=i.minX*l),n+=o,a+=o,{startAngle:a,endAngle:n}}Ci.getAngle=yEt;function _Et(r,t){if((0,el.isNumber)(r)&&(0,el.isNumber)(t))return[r,t];if(r=r,t=t,cL(r)||cL(t))return[hL(r),hL(t)];for(var e=-1,i=0,n=0,a,o=r.length-1,s,l=0;++e<r.length;)a=o,o=e,l+=s=r[a]*t[o]-r[o]*t[a],i+=(r[a]+r[o])*s,n+=(t[a]+t[o])*s;return l*=3,[i/l,n/l]}Ci.getPolygonCentroid=_Et;function xEt(r,t){var e=r.attr(),i=t.attr();return(0,el.each)(e,function(n,a){i[a]===void 0&&(i[a]=void 0)}),i}Ci.getReplaceAttrs=xEt;var lo={};Object.defineProperty(lo,"__esModule",{value:!0});lo.uniq=lo.omit=lo.padEnd=lo.isBetween=void 0;var CEt=gv,fL=Wu;function EEt(r,t,e){var i=Math.min(t,e),n=Math.max(t,e);return r>=i&&r<=n}lo.isBetween=EEt;function SEt(r,t,e){if((0,fL.isString)(r))return r.padEnd(t,e);if((0,fL.isArray)(r)){var i=r.length;if(i<t)for(var n=t-i,a=0;a<n;a++)r.push(e)}return r}lo.padEnd=SEt;function AEt(r,t){return typeof r=="object"&&t.forEach(function(e){delete r[e]}),r}lo.omit=AEt;function TEt(r,t,e){var i,n;t===void 0&&(t=[]),e===void 0&&(e=new Map);try{for(var a=CEt.__values(r),o=a.next();!o.done;o=a.next()){var s=o.value;e.has(s)||(t.push(s),e.set(s,!0))}}catch(l){i={error:l}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return t}lo.uniq=TEt;var Ys={};Object.defineProperty(Ys,"__esModule",{value:!0});Ys.toPoints=Ys.getRegionBBox=Ys.BBox=void 0;var dL=gv,vL=Wu,kn=Oy,_8=function(){function r(t,e,i,n){t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=0),n===void 0&&(n=0),this.x=t,this.y=e,this.height=n,this.width=i}return r.fromRange=function(t,e,i,n){return new r(t,e,i-t,n-e)},r.fromObject=function(t){return new r(t.minX,t.minY,t.width,t.height)},Object.defineProperty(r.prototype,"minX",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"maxX",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"minY",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"maxY",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"tl",{get:function(){return{x:this.x,y:this.y}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"tr",{get:function(){return{x:this.maxX,y:this.y}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"bl",{get:function(){return{x:this.x,y:this.maxY}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"br",{get:function(){return{x:this.maxX,y:this.maxY}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"top",{get:function(){return{x:this.x+this.width/2,y:this.minY}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"right",{get:function(){return{x:this.maxX,y:this.y+this.height/2}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"bottom",{get:function(){return{x:this.x+this.width/2,y:this.maxY}},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"left",{get:function(){return{x:this.minX,y:this.y+this.height/2}},enumerable:!1,configurable:!0}),r.prototype.isEqual=function(t){return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},r.prototype.contains=function(t){return t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY},r.prototype.clone=function(){return new r(this.x,this.y,this.width,this.height)},r.prototype.add=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this.clone();return(0,vL.each)(t,function(n){i.x=Math.min(n.x,i.x),i.y=Math.min(n.y,i.y),i.width=Math.max(n.maxX,i.maxX)-i.x,i.height=Math.max(n.maxY,i.maxY)-i.y}),i},r.prototype.merge=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this.clone();return(0,vL.each)(t,function(n){i.x=Math.max(n.x,i.x),i.y=Math.max(n.y,i.y),i.width=Math.min(n.maxX,i.maxX)-i.x,i.height=Math.min(n.maxY,i.maxY)-i.y}),i},r.prototype.cut=function(t,e){var i=t.width,n=t.height;switch(e){case kn.DIRECTION.TOP:case kn.DIRECTION.TOP_LEFT:case kn.DIRECTION.TOP_RIGHT:return r.fromRange(this.minX,this.minY+n,this.maxX,this.maxY);case kn.DIRECTION.RIGHT:case kn.DIRECTION.RIGHT_TOP:case kn.DIRECTION.RIGHT_BOTTOM:return r.fromRange(this.minX,this.minY,this.maxX-i,this.maxY);case kn.DIRECTION.BOTTOM:case kn.DIRECTION.BOTTOM_LEFT:case kn.DIRECTION.BOTTOM_RIGHT:return r.fromRange(this.minX,this.minY,this.maxX,this.maxY-n);case kn.DIRECTION.LEFT:case kn.DIRECTION.LEFT_TOP:case kn.DIRECTION.LEFT_BOTTOM:return r.fromRange(this.minX+i,this.minY,this.maxX,this.maxY);default:return this}},r.prototype.shrink=function(t){var e=dL.__read(t,4),i=e[0],n=e[1],a=e[2],o=e[3];return new r(this.x+o,this.y+i,this.width-o-n,this.height-i-a)},r.prototype.expand=function(t){var e=dL.__read(t,4),i=e[0],n=e[1],a=e[2],o=e[3];return new r(this.x-o,this.y-i,this.width+o+n,this.height+i+a)},r.prototype.exceed=function(t){return[Math.max(-this.minY+t.minY,0),Math.max(this.maxX-t.maxX,0),Math.max(this.maxY-t.maxY,0),Math.max(-this.minX+t.minX,0)]},r.prototype.collide=function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},r.prototype.size=function(){return this.width*this.height},r.prototype.isPointIn=function(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY},r}();Ys.BBox=_8;var bEt=function(r,t){var e=t.start,i=t.end;return new _8(r.x+r.width*e.x,r.y+r.height*e.y,r.width*Math.abs(i.x-e.x),r.height*Math.abs(i.y-e.y))};Ys.getRegionBBox=bEt;function wEt(r){return[[r.minX,r.minY],[r.maxX,r.minY],[r.maxX,r.maxY],[r.minX,r.maxY]]}Ys.toPoints=wEt;Object.defineProperty(oi,"__esModule",{value:!0});oi.getCoordinateBBox=oi.getCoordinateClipCfg=oi.getAngleByPoint=oi.isPointInCoordinate=oi.getDistanceToCenter=oi.isFullCircle=oi.getXDimensionLength=void 0;var E1=Ci,mg=lo,REt=Ys;function MEt(r){if(r.isPolar&&!r.isTransposed)return(r.endAngle-r.startAngle)*r.getRadius();var t=r.convert({x:0,y:0}),e=r.convert({x:1,y:0});return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}oi.getXDimensionLength=MEt;function IEt(r){if(r.isPolar){var t=r.startAngle,e=r.endAngle;return e-t===Math.PI*2}return!1}oi.isFullCircle=IEt;function LEt(r,t){var e=r.getCenter();return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}oi.getDistanceToCenter=LEt;function OEt(r,t){var e=!1;if(r)if(r.type==="theta"){var i=r.start,n=r.end;e=(0,mg.isBetween)(t.x,i.x,n.x)&&(0,mg.isBetween)(t.y,i.y,n.y)}else{var a=r.invert(t);e=(0,mg.isBetween)(a.x,0,1)&&(0,mg.isBetween)(a.y,0,1)}return e}oi.isPointInCoordinate=OEt;function PEt(r,t){var e=r.getCenter();return Math.atan2(t.y-e.y,t.x-e.x)}oi.getAngleByPoint=PEt;function FEt(r,t){t===void 0&&(t=0);var e=r.start,i=r.end,n=r.getWidth(),a=r.getHeight();if(r.isPolar){var o=r.startAngle,s=r.endAngle,l=r.getCenter(),u=r.getRadius();return{type:"path",startState:{path:(0,E1.getSectorPath)(l.x,l.y,u+t,o,o)},endState:function(h){var f=(s-o)*h+o,d=(0,E1.getSectorPath)(l.x,l.y,u+t,o,f);return{path:d}},attrs:{path:(0,E1.getSectorPath)(l.x,l.y,u+t,o,s)}}}var c;return r.isTransposed?c={height:a+t*2}:c={width:n+t*2},{type:"rect",startState:{x:e.x-t,y:i.y-t,width:r.isTransposed?n+t*2:0,height:r.isTransposed?0:a+t*2},endState:c,attrs:{x:e.x-t,y:i.y-t,width:n+t*2,height:a+t*2}}}oi.getCoordinateClipCfg=FEt;function BEt(r,t){t===void 0&&(t=0);var e=r.start,i=r.end,n=r.getWidth(),a=r.getHeight(),o=Math.min(e.x,i.x),s=Math.min(e.y,i.y);return REt.BBox.fromRange(o-t,s-t,o+n+t,s+a+t)}oi.getCoordinateBBox=BEt;Object.defineProperty(Vi,"__esModule",{value:!0});Vi.getMaxScale=Vi.getDefaultCategoryScaleRange=Vi.getName=Vi.syncScale=Vi.createScaleByField=Vi.inferScaleType=void 0;var a0=gv,to=Wu,DEt=Oy,pL=y8,NEt=oi,kEt=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]+)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/;function UEt(r){var t="linear";return kEt.test(r)?t="timeCat":(0,to.isString)(r)&&(t="cat"),t}function zEt(r,t,e,i){return t===void 0&&(t={}),t.type?t.type:r.type!=="identity"&&DEt.GROUP_ATTRS.includes(e)&&["interval"].includes(i)||r.isCategory?"cat":r.type}Vi.inferScaleType=zEt;function HEt(r,t,e){var i=t||[];if((0,to.isNumber)(r)||(0,to.isNil)((0,to.firstValue)(i,r))&&(0,to.isEmpty)(e)){var n=(0,pL.getScale)("identity");return new n({field:r.toString(),values:[r]})}var a=(0,to.valuesOfKey)(i,r),o=(0,to.get)(e,"type",UEt(a[0])),s=(0,pL.getScale)(o);return new s(a0.__assign({field:r,values:a},e))}Vi.createScaleByField=HEt;function $Et(r,t){if(r.type!=="identity"&&t.type!=="identity"){var e={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);r.change(e)}}Vi.syncScale=$Et;function WEt(r){return r.alias||r.field}Vi.getName=WEt;function VEt(r,t,e){var i=r.values,n=i.length,a;if(n===1)a=[.5,1];else{var o=1,s=0;(0,NEt.isFullCircle)(t)?t.isTransposed?(o=(0,to.get)(e,"widthRatio.multiplePie",1/1.3),s=1/n*o,a=[s/2,1-s/2]):a=[0,1-1/n]:(s=1/n/2,a=[s,1-s])}return a}Vi.getDefaultCategoryScaleRange=VEt;function GEt(r){var t=r.values.filter(function(e){return!(0,to.isNil)(e)&&!isNaN(e)});return Math.max.apply(Math,a0.__spreadArray(a0.__spreadArray([],a0.__read(t),!1),[(0,to.isNil)(r.max)?-1/0:r.max],!1))}Vi.getMaxScale=GEt;Object.defineProperty(so,"__esModule",{value:!0});so.findItemsFromViewRecurisive=so.findItemsFromView=so.getTooltipItems=so.findDataByPoint=void 0;var Hs=gv,yr=Wu,xi=Oy,uT=Vi;function gL(r,t,e){var i=e.translate(r),n=e.translate(t);return(0,yr.isNumberEqual)(i,n)}function XEt(r,t){var e=t.coordinate,i=t.getXScale(),n=i.range,a=n[n.length-1],o=n[0],s=e.invert(r),l=s.x;return e.isPolar&&l>(1+a)/2&&(l=o),i.translate(i.invert(l))}function mL(r,t,e){var i=e.coordinate,n=e.getYScale(),a=n.field,o=i.invert(t),s=n.invert(o.y),l=(0,yr.find)(r,function(u){var c=u[xi.FIELD_ORIGIN];return c[a][0]<=s&&c[a][1]>=s});return l||r[r.length-1]}var YEt=(0,yr.memoize)(function(r){if(r.isCategory)return 1;for(var t=r.values,e=t.length,i=r.translate(t[0]),n=i,a=0;a<e;a++){var o=t[a],s=r.translate(o);s<i&&(i=s),s>n&&(n=s)}return(n-i)/(e-1)});function jEt(r,t,e){var i=t.getAttribute("position"),n=i.getFields(),a=t.scales,o=(0,yr.isFunction)(e)||!e?n[0]:e,s=a[o],l=s?s.getText(r[o]):r[o]||o;return(0,yr.isFunction)(e)?e(l,r):l}function ZEt(r){var t=(0,yr.values)(r.attributes);return(0,yr.filter)(t,function(e){return(0,yr.contains)(xi.GROUP_ATTRS,e.type)})}function x8(r){var t,e,i=ZEt(r),n;try{for(var a=Hs.__values(i),o=a.next();!o.done;o=a.next()){var s=o.value,l=s.getScale(s.type);if(l&&l.isLinear){var u=(0,yr.get)(r.scaleDefs,l.field),c=(0,uT.inferScaleType)(l,u,s.type,r.type);if(c!=="cat"){n=l;break}}}}catch(d){t={error:d}}finally{try{o&&!o.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}var h=r.getXScale(),f=r.getYScale();return n||f||h}function qEt(r,t){var e=t.field,i=r[e];if((0,yr.isArray)(i)){var n=i.map(function(a){return t.getText(a)});return n.join("-")}return t.getText(i)}function KEt(r,t){var e,i=t.getGroupScales();if(i.length&&(e=i[0]),e){var n=e.field;return e.getText(r[n])}var a=x8(t);return(0,uT.getName)(a)}function C8(r,t,e){if(t.length===0)return null;var i=e.type,n=e.getXScale(),a=e.getYScale(),o=n.field,s=a.field,l=null;if(i==="heatmap"||i==="point"){for(var u=e.coordinate,c=u.invert(r),h=n.invert(c.x),f=a.invert(c.y),d=1/0,v=0;v<t.length;v++){var p=t[v],g=p[xi.FIELD_ORIGIN],m=Math.pow(g[o]-h,2)+Math.pow(g[s]-f,2);m<d&&(d=m,l=p)}return l}var y=t[0],_=t[t.length-1],x=XEt(r,e),C=y[xi.FIELD_ORIGIN][o],A=y[xi.FIELD_ORIGIN][s],b=_[xi.FIELD_ORIGIN][o],R=a.isLinear&&(0,yr.isArray)(A);if((0,yr.isArray)(C)){for(var v=0;v<t.length;v++){var M=t[v],g=M[xi.FIELD_ORIGIN];if(n.translate(g[o][0])<=x&&n.translate(g[o][1])>=x)if(R)(0,yr.isArray)(l)||(l=[]),l.push(M);else{l=M;break}}(0,yr.isArray)(l)&&(l=mL(l,r,e))}else{var O=void 0;if(!n.isLinear&&n.type!=="timeCat"){for(var v=0;v<t.length;v++){var M=t[v],g=M[xi.FIELD_ORIGIN];if(gL(g[o],x,n))if(R)(0,yr.isArray)(l)||(l=[]),l.push(M);else{l=M;break}else n.translate(g[o])<=x&&(_=M,O=t[v+1])}(0,yr.isArray)(l)&&(l=mL(l,r,e))}else{if((x>n.translate(b)||x<n.translate(C))&&(x>n.max||x<n.min))return null;for(var F=0,D=t.length-1,H=void 0;F<=D;){H=Math.floor((F+D)/2);var j=t[H][xi.FIELD_ORIGIN][o];if(gL(j,x,n))return t[H];n.translate(j)<=n.translate(x)?(F=H+1,_=t[H],O=t[H+1]):(D===0&&(_=t[0]),D=H-1)}}_&&O&&Math.abs(n.translate(_[xi.FIELD_ORIGIN][o])-x)>Math.abs(n.translate(O[xi.FIELD_ORIGIN][o])-x)&&(_=O)}var $=YEt(e.getXScale());return!l&&Math.abs(n.translate(_[xi.FIELD_ORIGIN][o])-x)<=$/2&&(l=_),l}so.findDataByPoint=C8;function cT(r,t,e,i){var n,a;e===void 0&&(e=""),i===void 0&&(i=!1);var o=r[xi.FIELD_ORIGIN],s=jEt(o,t,e),l=t.tooltipOption,u=t.theme.defaultColor,c=[],h,f;function d(M,O){if(i||!(0,yr.isNil)(O)&&O!==""){var F={title:s,data:o,mappingData:r,name:M,value:O,color:r.color||u,marker:!0};c.push(F)}}if((0,yr.isObject)(l)){var v=l.fields,p=l.callback;if(p){var g=v.map(function(M){return r[xi.FIELD_ORIGIN][M]}),m=p.apply(void 0,Hs.__spreadArray([],Hs.__read(g),!1)),y=Hs.__assign({data:r[xi.FIELD_ORIGIN],mappingData:r,title:s,color:r.color||u,marker:!0},m);c.push(y)}else{var _=t.scales;try{for(var x=Hs.__values(v),C=x.next();!C.done;C=x.next()){var A=C.value;if(!(0,yr.isNil)(o[A])){var b=_[A];h=(0,uT.getName)(b),f=b.getText(o[A]),d(h,f)}}}catch(M){n={error:M}}finally{try{C&&!C.done&&(a=x.return)&&a.call(x)}finally{if(n)throw n.error}}}}else{var R=x8(t);f=qEt(o,R),h=KEt(o,t),d(h,f)}return c}so.getTooltipItems=cT;function yL(r,t,e,i){var n,a,o=i.showNil,s=[],l=r.dataArray;if(!(0,yr.isEmpty)(l)){r.sort(l);try{for(var u=Hs.__values(l),c=u.next();!c.done;c=u.next()){var h=c.value,f=C8(t,h,r);if(f){var d=r.getElementId(f),v=r.elementsMap[d];if(r.type==="heatmap"||v.visible){var p=cT(f,r,e,o);p.length&&s.push(p)}}}}catch(g){n={error:g}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}}return s}function _L(r,t,e,i){var n=i.showNil,a=[],o=r.container,s=o.getShape(t.x,t.y);if(s&&s.get("visible")&&s.get("origin")){var l=s.get("origin").mappingData,u=cT(l,r,e,n);u.length&&a.push(u)}return a}function mC(r,t,e){var i,n,a=[],o=r.geometries,s=e.shared,l=e.title,u=e.reversed;try{for(var c=Hs.__values(o),h=c.next();!h.done;h=c.next()){var f=h.value;if(f.visible&&f.tooltipOption!==!1){var d=f.type,v=void 0;["point","edge","polygon"].includes(d)?v=_L(f,t,l,e):["area","line","path","heatmap"].includes(d)||s!==!1?v=yL(f,t,l,e):v=_L(f,t,l,e),v.length&&(u&&v.reverse(),a.push(v))}}}catch(p){i={error:p}}finally{try{h&&!h.done&&(n=c.return)&&n.call(c)}finally{if(i)throw i.error}}return a}so.findItemsFromView=mC;function QEt(r,t,e){var i,n,a=mC(r,t,e);try{for(var o=Hs.__values(r.views),s=o.next();!s.done;s=o.next()){var l=s.value;a=a.concat(mC(l,t,e))}}catch(u){i={error:u}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}so.findItemsFromViewRecurisive=QEt;var yg={},xL;function JEt(){if(xL)return yg;xL=1,Object.defineProperty(yg,"__esModule",{value:!0});var r=Wu,t=function(){function e(i,n){this.context=i,this.cfg=n,i.addAction(this)}return e.prototype.applyCfg=function(i){(0,r.assign)(this,i)},e.prototype.init=function(){this.applyCfg(this.cfg)},e.prototype.destroy=function(){this.context.removeAction(this),this.context=null},e}();return yg.default=t,yg}Object.defineProperty(Ly,"__esModule",{value:!0});var tSt=Ly.getItemsOfView=void 0,nu=gv,_n=Wu,eSt=so,S1=Ci,rSt=nu.__importDefault(JEt()),iSt={fill:"#CCD6EC",opacity:.3};function E8(r,t,e){var i,n,a,o,s,l,u=(0,eSt.findItemsFromViewRecurisive)(r,t,e);if(u.length){u=(0,_n.flatten)(u);try{for(var c=nu.__values(u),h=c.next();!h.done;h=c.next()){var f=h.value;try{for(var d=(a=void 0,nu.__values(f)),v=d.next();!v.done;v=d.next()){var p=v.value,g=p.mappingData,m=g.x,y=g.y;p.x=(0,_n.isArray)(m)?m[m.length-1]:m,p.y=(0,_n.isArray)(y)?y[y.length-1]:y}}catch(O){a={error:O}}finally{try{v&&!v.done&&(o=d.return)&&o.call(d)}finally{if(a)throw a.error}}}}catch(O){i={error:O}}finally{try{h&&!h.done&&(n=c.return)&&n.call(c)}finally{if(i)throw i.error}}var _=e.shared;if(_===!1&&u.length>1){var x=u[0],C=Math.abs(t.y-x[0].y);try{for(var A=nu.__values(u),b=A.next();!b.done;b=A.next()){var R=b.value,M=Math.abs(t.y-R[0].y);M<=C&&(x=R,C=M)}}catch(O){s={error:O}}finally{try{b&&!b.done&&(l=A.return)&&l.call(A)}finally{if(s)throw s.error}}u=[x]}return(0,_n.uniq)((0,_n.flatten)(u))}return[]}tSt=Ly.getItemsOfView=E8;var nSt=function(r){nu.__extends(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.show=function(e){var i=this.context.view,n=this.context.event,a=i.getController("tooltip").getTooltipCfg(),o=E8(i,{x:n.x,y:n.y},a);if(!(0,_n.isEqual)(o,this.items)&&(this.items=o,o.length)){var s=i.getXScale().field,l=o[0].data[s],u=[],c=i.geometries;if((0,_n.each)(c,function(Q){if(Q.type==="interval"||Q.type==="schema"){var Y=Q.getElementsBy(function(tt){var et=tt.getData();return et[s]===l});u=u.concat(Y)}}),u.length){var h=i.getCoordinate(),f=u[0].shape.getCanvasBBox(),d=u[0].shape.getCanvasBBox(),v=f;(0,_n.each)(u,function(Q){var Y=Q.shape.getCanvasBBox();h.isTransposed?(Y.minY<f.minY&&(f=Y),Y.maxY>d.maxY&&(d=Y)):(Y.minX<f.minX&&(f=Y),Y.maxX>d.maxX&&(d=Y)),v.x=Math.min(Y.minX,v.minX),v.y=Math.min(Y.minY,v.minY),v.width=Math.max(Y.maxX,v.maxX)-v.x,v.height=Math.max(Y.maxY,v.maxY)-v.y});var p=i.backgroundGroup,g=i.coordinateBBox,m=void 0;if(h.isRect){var y=i.getXScale(),_=e||{},x=_.appendRatio,C=_.appendWidth;(0,_n.isNil)(C)&&(x=(0,_n.isNil)(x)?y.isLinear?0:.25:x,C=h.isTransposed?x*d.height:x*f.width);var A=void 0,b=void 0,R=void 0,M=void 0;h.isTransposed?(A=g.minX,b=Math.min(d.minY,f.minY)-C,R=g.width,M=v.height+C*2):(A=Math.min(f.minX,d.minX)-C,b=g.minY,R=v.width+C*2,M=g.height),m=[["M",A,b],["L",A+R,b],["L",A+R,b+M],["L",A,b+M],["Z"]]}else{var O=(0,_n.head)(u),F=(0,_n.last)(u),D=(0,S1.getAngle)(O.getModel(),h).startAngle,H=(0,S1.getAngle)(F.getModel(),h).endAngle,j=h.getCenter(),$=h.getRadius(),k=h.innerRadius*$;m=(0,S1.getSectorPath)(j.x,j.y,$,D,H,k)}if(this.regionPath)this.regionPath.attr("path",m),this.regionPath.show();else{var V=(0,_n.get)(e,"style",iSt);this.regionPath=p.addShape({type:"path",name:"active-region",capture:!1,attrs:nu.__assign(nu.__assign({},V),{path:m})})}}}},t.prototype.hide=function(){this.regionPath&&this.regionPath.hide(),this.items=null},t.prototype.destroy=function(){this.hide(),this.regionPath&&this.regionPath.remove(!0),r.prototype.destroy.call(this)},t}(rSt.default);Ly.default=nSt;class hT extends ku{constructor(t=[],e={}){super(),this.name=e.name?e.name:ln("layerGroup"),this.layers=t}addTo(t){this.scene=t;let e=0;const i=this.layers.length;this.layers.forEach(n=>{n.once("inited",a=>{e++,this.emit("inited",a),e===i&&this.emit("inited-all")}),n.addTo(t)})}hasLayer(t){return this.layers.some(e=>e===t)}addLayer(t){this.layers.push(t),this.scene&&(t.once("inited",e=>this.emit("inited",e)),t.addTo(this.scene))}removeLayer(t){const e=this.layers.findIndex(i=>i===t);return e===-1?!1:(this.layers.splice(e,1),this.scene&&t.remove(this.scene),!0)}getLayers(){return this.layers}getInteractionLayers(){return this.layers.filter(({interaction:t})=>t)}getLayer(t){return this.layers.find(({layer:e})=>e.id===t)}getLayerByName(t){return this.layers.find(e=>e.name===t)}removeAllLayer(){this.layers.forEach(t=>{this.scene&&t.remove(this.scene)}),this.layers=[]}isEmpty(){return this.layers.length===0}}const fT={fontFamily:`
  "-apple-system", BlinkMacSystemFont, "Segoe UI", Roboto,"Helvetica Neue",
  Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei",
  SimSun, "sans-serif"`},dT="l7plot-tooltip",vT="l7plot-tooltip__title",pT="l7plot-tooltip__list",S8="l7plot-tooltip__list-item",A8="l7plot-tooltip__name",T8="l7plot-tooltip__value",aSt=`<div class="${dT}">
  <div class="${vT}"></div>
  <ul class="${pT}"></ul>
</div>`,CL=`<li class="${S8}" data-index={index}>
  <span class="${A8}">{name}</span>
  <span class="${T8}">{value}</span>
</li>`,oSt={[dT]:{visibility:"visible",zIndex:999,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)",backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontSize:"12px",fontFamily:fT.fontFamily,lineHeight:"20px",padding:"10px 10px 6px 10px"},[vT]:{marginBottom:"4px"},[pT]:{margin:"0px",listStyleType:"none",padding:"0px"},[S8]:{listStyleType:"none",marginBottom:"4px",whiteSpace:"nowrap",display:"flex",justifyContent:"space-between"},[A8]:{},[T8]:{marginLeft:"30px"}};function sSt(r,t){return!!r.className.match(new RegExp(`(\\s|^)${t}(\\s|$)`))}function gT(r){const t=r.childNodes,e=t.length;for(let i=e-1;i>=0;i--)r.removeChild(t[i])}class mT{constructor(t){this.destroyed=!1,this.options=at({},this.getDefaultOptions(),t),this.container=this.initContainer(),this.initDom(),this.applyStyles(),this.initEvent(),this.initCapture(),this.initVisible(),this.render()}getDefaultOptions(){return{name:"",containerTpl:"<div></div>",visible:!0,capture:!0,domStyles:{}}}getContainer(){return this.container}getParentContainer(){const t=this.options.parent;let e;if(!t)return e;if(mt(t)){const i=document.getElementById(t);if(i)e=i;else throw new Error(`No parent id ${t}`)}else e=t;return e}initContainer(){const t=this.createDom(this.options.containerTpl),e=this.getParentContainer();return e&&e.appendChild(t),t}initVisible(){this.options.visible?this.show():this.hide()}initCapture(){this.setCapture(this.options.capture)}update(t){this.options=at({},this.options,t),this.updateInner(t),this.afterUpdate(t)}updateInner(t){t.domStyles&&this.applyStyles()}afterUpdate(t){t.capture&&this.setCapture(t.capture)}setCapture(t){const e=this.container,i=t?"auto":"none";e.style.pointerEvents=i}applyStyles(){const t=this.options.domStyles;if(!t)return;const e=this.container;this.applyChildrenStyles(e,t);const i=this.options.className;if(i&&sSt(e,i)){const n=t[i];be(e,n)}}applyChildrenStyles(t,e){I(e,(i,n)=>{const a=t.getElementsByClassName(n);I(a,o=>{be(o,i)})})}applyStyle(t,e){const i=this.options.domStyles;i&&be(e,i[t])}createDom(t="<div></div>"){return Qo(t)}removeDom(){const t=this.container;t&&t.parentNode&&t.parentNode.removeChild(t)}destroy(){this.removeEvent(),this.removeDom(),this.destroyed=!0}}let lSt=class extends mT{getDefaultOptions(){return at({},super.getDefaultOptions(),{id:"l7plot-tooltip",name:"l7plot-tooltip",title:"",showTitle:!0,items:[],containerTpl:aSt,itemTpl:CL,domStyles:oSt,className:dT})}initContainer(){const{customContent:t}=this.options;if(t){const e=this.getHtmlContentNode(t),i=this.getParentContainer();return i&&i.appendChild(e),e}else return super.initContainer()}initDom(){this.cacheDoms()}initEvent(){}removeEvent(){}cacheDoms(){const t=this.container,e=t.getElementsByClassName(vT)[0],i=t.getElementsByClassName(pT)[0];this.titleDom=e,this.listDom=i}render(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderItems())}show(){const t=this.container;!t||this.destroyed||be(t,{visibility:"visible"})}hide(){const t=this.container;!t||this.destroyed||be(t,{visibility:"hidden"})}updateInner(t){this.options.customContent?this.renderCustomContent(this.options.customContent):(t.title&&this.resetTitle(),t.items&&this.renderItems()),super.updateInner(t)}renderCustomContent(t){const e=this.container.parentNode,i=this.getHtmlContentNode(t),n=this.container;e&&e.replaceChild(i,n),this.container=i,this.applyStyles()}getHtmlContentNode(t){let e;const i=t(this.options.title||"",this.options.items);return mt(i)?e=this.createDom(i):e=i,e}resetTitle(){const t=this.options.title;this.options.showTitle&&t?(this.showTitle(),this.setTitle(t)):this.hideTitle()}showTitle(){const t=this.titleDom;t&&be(t,{display:"block"})}hideTitle(){const t=this.titleDom;t&&be(t,{display:"none"})}setTitle(t){const e=this.titleDom;e&&(e.innerHTML=t)}renderItems(){this.clearItemDoms();const t=this.options.items,e=this.options.itemTpl||CL,i=this.listDom;i&&(t.forEach(n=>{const a=Object.assign({},n),o=Ah(e,a),s=this.createDom(o);i.appendChild(s)}),this.applyChildrenStyles(i,this.options.domStyles))}clearItemDoms(){this.listDom&&gT(this.listDom)}clear(){this.setTitle(""),this.clearItemDoms()}};const uSt={[UE]:{visibility:"visible",zIndex:1,backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontFamily:fT.fontFamily,padding:"10px 10px 6px 10px",lineHeight:1,fontSize:"12px"},[zE]:{fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},[HE]:{margin:"0px",listStyleType:"none",padding:"0px"},[ZF]:{listStyleType:"none",display:"flex",alignItems:"center",marginBottom:"2px"},[qF]:{width:"10px",height:"10px"},[KF]:{paddingLeft:"8px"}};class cSt extends mT{getDefaultOptions(){return at({},super.getDefaultOptions(),{id:"l7plot-category-legend",name:"l7plot-category-legend",title:"",items:[],containerTpl:GW,itemTpl:b2,domStyles:uSt,className:UE})}initContainer(){const{customContent:t}=this.options;if(t){const e=this.getHtmlContentNode(t),i=this.getParentContainer();return i&&i.appendChild(e),e}else return super.initContainer()}initDom(){this.cacheDoms()}initEvent(){}removeEvent(){}cacheDoms(){const t=this.container,e=t.getElementsByClassName(zE)[0],i=t.getElementsByClassName(HE)[0];this.titleDom=e,this.listDom=i}render(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderItems())}show(){const t=this.container;!t||this.destroyed||be(t,{visibility:"visible"})}hide(){const t=this.container;!t||this.destroyed||be(t,{visibility:"hidden"})}updateInner(t){this.options.customContent?this.renderCustomContent(this.options.customContent):(t.title&&this.resetTitle(),t.items&&this.renderItems()),super.updateInner(t)}renderCustomContent(t){const e=this.container.parentNode,i=this.getHtmlContentNode(t),n=this.container;e&&e.replaceChild(i,n),this.container=i,this.applyStyles()}getHtmlContentNode(t){let e;const i=t(this.options.title||"",this.options.items);return mt(i)?e=this.createDom(i):e=i,e}resetTitle(){const t=this.options.title;t?(this.showTitle(),this.setTitle(t)):this.hideTitle()}showTitle(){const t=this.titleDom;t&&be(t,{display:"block"})}hideTitle(){const t=this.titleDom;t&&be(t,{display:"none"})}setTitle(t){const e=this.titleDom;e&&(e.innerHTML=t)}renderItems(){this.clearItemDoms();const t=this.options.items.length>30?this.options.items.slice(0,30):this.options.items,e=this.options.itemTpl||b2,i=this.listDom;i&&(t.forEach(n=>{const o=n.value===""?"—":Array.isArray(n.value)?n.value.join(" - "):n.value,s=Object.assign(Object.assign({},n),{value:o}),l=Ah(e,s),u=this.createDom(l);i.appendChild(u)}),this.applyChildrenStyles(i,this.options.domStyles))}clearItemDoms(){this.listDom&&gT(this.listDom)}clear(){this.setTitle(""),this.clearItemDoms()}}const yT="l7plot-legend l7plot-legend__continue",_T="l7plot-legend__title",b8="l7plot-legend__ribbon-container",w8="l7plot-legend__ribbon",R8="l7plot-legend__gradient-bar",yC="l7plot-legend__value-range",hSt=`<div class="${yT}">
  <div class="${_T}"></div>
  <div class="${b8}"></div>
</div>`,EL=`<div class="${w8}">
  <span class="${yC}">{min}</span>
  <div class="${R8}" style="background-image: {backgroundImage}"></div>
  <span class="${yC}">{max}</span>
</div>`,fSt={[yT]:{visibility:"visible",zIndex:1,backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontFamily:fT.fontFamily,padding:"10px",lineHeight:1,fontSize:"12px"},[_T]:{fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},[w8]:{display:"flex",alignItems:"center"},[R8]:{width:"140px",height:"14px",margin:"0px 5px"},[yC]:{padding:"0px"}};class dSt extends mT{getDefaultOptions(){return at({},super.getDefaultOptions(),{id:"l7plot-continue-legend",name:"l7plot-continue-legend",title:"",containerTpl:hSt,ribbonTpl:EL,domStyles:fSt,className:yT})}initContainer(){const{customContent:t}=this.options;if(t){const e=this.getHtmlContentNode(t),i=this.getParentContainer();return i&&i.appendChild(e),e}else return super.initContainer()}initDom(){this.cacheDoms()}initEvent(){}removeEvent(){}cacheDoms(){const t=this.container,e=t.getElementsByClassName(_T)[0],i=t.getElementsByClassName(b8)[0];this.titleDom=e,this.ribbonContainerDom=i}render(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderRibbon())}show(){const t=this.container;!t||this.destroyed||be(t,{visibility:"visible"})}hide(){const t=this.container;!t||this.destroyed||be(t,{visibility:"hidden"})}updateInner(t){this.options.customContent?this.renderCustomContent(this.options.customContent):(t.title&&this.resetTitle(),t.colors&&this.renderRibbon()),super.updateInner(t)}renderCustomContent(t){const e=this.container.parentNode,i=this.getHtmlContentNode(t),n=this.container;e&&e.replaceChild(i,n),this.container=i,this.applyStyles()}getHtmlContentNode(t){let e;const i=t(this.options.title||"",this.options.min,this.options.max,this.options.colors);return mt(i)?e=this.createDom(i):e=i,e}resetTitle(){const t=this.options.title;t?(this.showTitle(),this.setTitle(t)):this.hideTitle()}showTitle(){const t=this.titleDom;t&&be(t,{display:"block"})}hideTitle(){const t=this.titleDom;t&&be(t,{display:"none"})}setTitle(t){const e=this.titleDom;e&&(e.innerHTML=t)}renderRibbon(){this.clearRibbonContainerDoms();const{min:t,max:e,colors:i,ribbonTpl:n=EL}=this.options,a=this.ribbonContainerDom;if(a){const o=`linear-gradient(to right, ${i.join(", ")})`,l=Ah(n,{min:t,max:e,backgroundImage:o}),u=this.createDom(l);a.appendChild(u),this.applyChildrenStyles(a,this.options.domStyles)}}clearRibbonContainerDoms(){this.ribbonContainerDom&&gT(this.ribbonContainerDom)}clear(){this.setTitle(""),this.clearRibbonContainerDoms()}}class vSt extends ns{constructor(t){super(t),this.legendComponents=[],this.options=t,this.legendComponents=this.initLegendComponents(t.items)}initLegendComponents(t){const e=[];for(let i=0;i<t.length;i++){const n=t[i];if(n.type==="category"){const a=new cSt({title:n.options.title,items:n.options.items,className:n.options.className,customContent:n.options.customContent,domStyles:n.options.domStyles});e.push(a)}else if(n.type==="continue"){const a=new dSt({title:n.options.title,min:n.options.min,max:n.options.max,colors:n.options.colors,className:n.options.className,customContent:n.options.customContent,domStyles:n.options.domStyles});e.push(a)}}return e}getDefaultOptions(){return{position:"bottomleft"}}onAdd(){const t=window.document.createElement("div");return t.className="l7plot-legend-container",this.legendComponents.forEach(e=>{const i=e.getContainer();t.appendChild(i)}),t}onRemove(){this.legendComponents.forEach(t=>{t.destroy()})}}var SL;(function(r){r[r.solid=0]="solid",r[r.dash=1]="dash"})(SL||(SL={}));var _C;(function(r){r.TextLayer="textLayer",r.DotLayer="dotLayer",r.IconLayer="iconLayer",r.DotDensity="dotDensityLayer",r.ColumnLayer="columnLayer",r.HeatmapLayer="heatmapLayer",r.GridLayer="gridLayer",r.HexbinLayer="hexbinLayer",r.LinesLayer="linesLayer",r.PathLayer="pathLayer",r.ArcLayer="arcLayer",r.AreaLayer="areaLayer",r.PrismLayer="prismLayer"})(_C||(_C={}));var ma;(function(r){r.Map="map",r.Amap="amap",r.AmapV1="amapv1",r.AmapV2="amapv2",r.Mapbox="mapbox"})(ma||(ma={}));var xC;(function(r){r.Dot="dot",r.DotDensity="dotDensity",r.Heatmap="heatmap",r.Grid="grid",r.Hexbin="hexbin",r.Path="path",r.Flow="flow",r.Area="area",r.Choropleth="choropleth"})(xC||(xC={}));const pSt=5,gSt=new Object().toString,M8=(r,t)=>gSt.call(r)==="[object "+t+"]",mSt=r=>M8(r,"Array"),ySt=r=>typeof r=="object"&&r!==null,AL=r=>{if(!ySt(r)||!M8(r,"Object"))return!1;let t=r;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(r)===t},I8=(r,t,e,i)=>{e=e||0,i=i||pSt;for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const a=t[n];a?AL(a)?(AL(r[n])||(r[n]={}),e<i?I8(r[n],a,e+1,i):r[n]=t[n]):mSt(a)?(r[n]=[],r[n]=r[n].concat(a)):r[n]=a:r[n]=a}},lr=(r,...t)=>{for(let e=0;e<t.length;e+=1)I8(r,t[e]);return r},_St=["mousemove","click"];class xSt extends ku{constructor(t,e,i){super(),this.currentVisible=!1,this.interactionTriggerHander=h=>{const{feature:f,featureId:d}=h,{title:v,customTitle:p,items:g,customItems:m}=this.options,_=f.type==="Feature"&&f.geometry&&f.properties?f.properties:f;let x=[];if(m){const A=m(f);if(Array.isArray(A))x=A;else throw new Error("customItems return array")}else g&&g.forEach(A=>{if(mt(A)){const b=A.split(".").pop()||A,R=_2(_,A);R!==void 0&&x.push({name:b,value:R})}else{const{field:b,alias:R,customValue:M}=A,O=R||b.split(".").pop()||b,F=_2(_,b);F!==void 0&&x.push({name:O,value:M?M(F,_,d):F})}});const C={title:p?p(_):v,items:x};this.updateTooltip(h,C)},this.interactionUntriggerHander=()=>{this.hideTooltip()},this.scene=t,this.interactionLayers=e,this.options=lr({},this.getDefaultOptions(),i);const{offsets:n,title:a,showTitle:o,customContent:s,domStyles:l,anchor:u,className:c}=this.options;this.marker=new tR({offsets:n,anchor:u,draggable:!1}),this.tooltipComponent=new lSt({title:a,showTitle:o,items:[],customContent:s,domStyles:l,className:c}),this.setComponent(),this.initInteractionEvent()}getDefaultOptions(){return{showTitle:!0,showComponent:!0,items:[],offsets:[15,0],trigger:"mousemove",anchor:Um["TOP-LEFT"]}}update(t){this.marker.remove(),this.currentVisible=!1,this.options=lr({},this.options,t);const{offsets:e,showTitle:i,customContent:n,domStyles:a,anchor:o,className:s}=this.options;this.marker=new tR({offsets:e,anchor:o,draggable:!1}),this.tooltipComponent.update({showTitle:i,customContent:n,domStyles:a,className:s}),this.setComponent()}initInteractionEvent(){const t=this.options.trigger||"mousemove";if(!_St.includes(t))throw new Error("trigger is mousemove or click");this.interactionLayers.forEach(({layer:e})=>{e.on(t,this.interactionTriggerHander),e.on(`un${t}`,this.interactionUntriggerHander)})}unBindInteractionEvent(){const t=this.options.trigger||"mousemove";this.interactionLayers.forEach(({layer:e})=>{e.off(t,this.interactionTriggerHander),e.off(`un${t}`,this.interactionUntriggerHander)})}updateTooltip(t,e){const{lngLat:i,x:n,y:a}=t;if(this.options.showComponent&&(this.updateComponent(e),this.setPostion(i)),this.currentVisible){const o={type:"tooltip:change",data:e,lngLat:i,x:n,y:a};this.emit("tooltip:change",o)}else{this.showTooltip();const o={type:"tooltip:show",data:e,lngLat:i,x:n,y:a};this.emit("tooltip:show",o)}}showTooltip(){this.currentVisible||(this.options.showComponent&&this.scene.addMarker(this.marker),this.currentVisible=!0)}hideTooltip(){if(!this.currentVisible)return;this.options.showComponent&&this.marker.remove(),this.currentVisible=!1;const t={type:"tooltip:hide"};this.emit("tooltip:hide",t)}updateComponent(t){qt(this.lastComponentOptions,t)||(this.tooltipComponent.update(t),this.lastComponentOptions=t)}setComponent(){const t=this.tooltipComponent.getContainer(),e=window.document.createElement("div");e.style.cursor="auto",e.style.userSelect="text",e.className="l7plot-tooltip-container",["mousemove","mousedown","mouseup","click","dblclick"].forEach(i=>{e.addEventListener(i,n=>n.stopPropagation())}),e.appendChild(t),this.marker.setElement(e)}setPostion(t){this.marker.setLnglat(t)}destroy(){this.unBindInteractionEvent(),this.off(),this.marker.remove(),this.tooltipComponent.destroy()}}var Fl={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ITEM_TPL=r.CONTAINER_TPL=r.VALUE_CLASS=r.NAME_CLASS=r.LIST_ITEM_CLASS=r.LIST_CLASS=r.TITLE_CLASS=r.CONTAINER_CLASS=void 0,r.CONTAINER_CLASS="l7plot-tooltip",r.TITLE_CLASS="l7plot-tooltip__title",r.LIST_CLASS="l7plot-tooltip__list",r.LIST_ITEM_CLASS="l7plot-tooltip__list-item",r.NAME_CLASS="l7plot-tooltip__name",r.VALUE_CLASS="l7plot-tooltip__value",r.CONTAINER_TPL=`<div class="${r.CONTAINER_CLASS}">
  <div class="${r.TITLE_CLASS}"></div>
  <ul class="${r.LIST_CLASS}"></ul>
</div>`,r.ITEM_TPL=`<li class="${r.LIST_ITEM_CLASS}" data-index={index}>
  <span class="${r.NAME_CLASS}">{name}</span>
  <span class="${r.VALUE_CLASS}">{value}</span>
</li>`})(Fl);var Bl={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ITEM_TPL=r.CONTAINER_TPL=r.VALUE_CLASS=r.MARKER_CLASS=r.LIST_ITEM_CLASS=r.LIST_CLASS=r.TITLE_CLASS=r.CONTAINER_CLASS=void 0,r.CONTAINER_CLASS="l7plot-legend l7plot-legend__category",r.TITLE_CLASS="l7plot-legend__title",r.LIST_CLASS="l7plot-legend__category-list",r.LIST_ITEM_CLASS="l7plot-legend__list-item",r.MARKER_CLASS="l7plot-legend__category-marker",r.VALUE_CLASS="l7plot-legend__category-value",r.CONTAINER_TPL=`<div class="${r.CONTAINER_CLASS}">
  <div class="${r.TITLE_CLASS}"></div>
  <ul class="${r.LIST_CLASS}"></ul>
</div>`,r.ITEM_TPL=`<li class="${r.LIST_ITEM_CLASS}" data-index={index}>
  <span class="${r.MARKER_CLASS}" style="background:{color}"></span>
  <span class="${r.VALUE_CLASS}">{value}</span>
</li>`})(Bl);var vc={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.RIBBON_TPL=r.CONTAINER_TPL=r.VALUE_RANGE_CLASS=r.GRADIENT_BAR_CLASS=r.RIBBON_CLASS=r.RIBBON_CONTAINER_CLASS=r.TITLE_CLASS=r.CONTAINER_CLASS=void 0,r.CONTAINER_CLASS="l7plot-legend l7plot-legend__continue",r.TITLE_CLASS="l7plot-legend__title",r.RIBBON_CONTAINER_CLASS="l7plot-legend__ribbon-container",r.RIBBON_CLASS="l7plot-legend__ribbon",r.GRADIENT_BAR_CLASS="l7plot-legend__gradient-bar",r.VALUE_RANGE_CLASS="l7plot-legend__value-range",r.CONTAINER_TPL=`<div class="${r.CONTAINER_CLASS}">
  <div class="${r.TITLE_CLASS}"></div>
  <div class="${r.RIBBON_CONTAINER_CLASS}"></div>
</div>`,r.RIBBON_TPL=`<div class="${r.RIBBON_CLASS}">
  <span class="${r.VALUE_RANGE_CLASS}">{min}</span>
  <div class="${r.GRADIENT_BAR_CLASS}" style="background-image: {backgroundImage}"></div>
  <span class="${r.VALUE_RANGE_CLASS}">{max}</span>
</div>`})(vc);function L8(r){const t={point:{default:{fill:r.pointFillColor,size:r.pointSize,stroke:r.pointBorderColor,lineWidth:r.pointBorder,fillOpacity:r.pointFillOpacity},active:{fill:r.pointActiveFillColor},selected:{fill:r.pointSelectedFillColor}}};return{mapStyle:r.mapStyle,defaultColor:r.brandColor,subColor:r.subColor,semanticRed:r.paletteSemanticRed,semanticGreen:r.paletteSemanticGreen,fontFamily:r.fontFamily,colors10:r.paletteQualitative10,colors20:r.paletteQualitative20,sequenceColors:r.paletteSequence,shapes:{point:["circle","square"],line:["line"]},sizes:[1,10],geometries:{point:{circle:{default:{style:t.point.default},active:{style:t.point.active},selected:{style:t.point.selected}}},line:{},polygon:{}},components:{legend:{category:{domStyles:{[Bl.CONTAINER_CLASS]:{visibility:"visible",zIndex:1,backgroundColor:r.legendContainerFillColor,boxShadow:r.legendContainerShadow,borderRadius:`${r.legendContainerBorderRadius}px`,color:r.legendTextFillColor,fontFamily:r.fontFamily,padding:"10px",lineHeight:"1",fontSize:`${r.legendTextFontSize}px`},[Bl.TITLE_CLASS]:{fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},[Bl.LIST_CLASS]:{margin:"0px",padding:"0px"},[Bl.LIST_ITEM_CLASS]:{marginBottom:"2px"},[Bl.MARKER_CLASS]:{width:"10px",height:"10px"},[Bl.VALUE_CLASS]:{paddingLeft:"8px"}}},continue:{domStyles:{[vc.CONTAINER_CLASS]:{visibility:"visible",zIndex:1,backgroundColor:r.legendContainerFillColor,boxShadow:r.legendContainerShadow,borderRadius:`${r.legendContainerBorderRadius}px`,color:r.legendTextFillColor,fontFamily:r.fontFamily,padding:"10px",lineHeight:1,fontSize:`${r.legendTextFontSize}px`},[vc.TITLE_CLASS]:{fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},[vc.RIBBON_CLASS]:{display:"flex",alignItems:"center"},[vc.GRADIENT_BAR_CLASS]:{width:"140px",height:"14px",margin:"0px 5px"},[vc.VALUE_RANGE_CLASS]:{padding:"0px"}}}},tooltip:{domStyles:{[Fl.CONTAINER_CLASS]:{visibility:"visible",zIndex:999,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)",backgroundColor:r.tooltipContainerFillColor,boxShadow:r.tooltipContainerShadow,borderRadius:`${r.tooltipContainerBorderRadius}px`,color:r.tooltipTextFillColor,fontSize:`${r.tooltipTextFontSize}px`,fontFamily:r.fontFamily,lineHeight:r.tooltipTextLineHeight},[Fl.TITLE_CLASS]:{marginBottom:"4px"},[Fl.LIST_CLASS]:{margin:"0px",padding:"0px"},[Fl.LIST_ITEM_CLASS]:{marginBottom:"4px"},[Fl.NAME_CLASS]:{color:r.tooltipItemNameFillColor},[Fl.VALUE_CLASS]:{color:r.tooltipItemValueFillColor,marginLeft:"30px"}}},label:{style:{textAnchor:"center",textOffset:[0,0],fill:r.labelFillColor,fontSize:r.labelFontSize,fontFamily:r.fontFamily,fillColorDark:r.labelFillColorDark,fillColorLight:r.labelFillColorLight}}}}}const Ml={100:"#000",95:"#0D0D0D",85:"#262626",65:"#595959",45:"#8C8C8C",25:"#BFBFBF",15:"#D9D9D9",6:"#F0F0F0"},CSt={100:"#FFFFFF",95:"#F2F2F2",85:"#D9D9D9",65:"#A6A6A6",45:"#737373",25:"#404040",15:"#262626",6:"#0F0F0F"},ESt=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#6F5EF9","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],SSt=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#6F5EF9","#D3CEFD","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],ASt=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"],O8=(r={})=>{const{mapStyle:t="light",subColor:e="rgba(0,0,0,0.05)",paletteQualitative10:i=ESt,paletteQualitative20:n=SSt,paletteSemanticRed:a="#F4664A",paletteSemanticGreen:o="#30BF78",paletteSemanticYellow:s="#FAAD14",paletteSequence:l=ASt,fontFamily:u=`"-apple-system", "Segoe UI", Roboto, "Helvetica Neue", Arial,
    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
    "Noto Color Emoji"`}=r,{brandColor:c=i[0]}=r;return{mapStyle:t,brandColor:c,subColor:e,paletteQualitative10:i,paletteQualitative20:n,paletteSemanticRed:a,paletteSemanticGreen:o,paletteSemanticYellow:s,paletteSequence:l,fontFamily:u,legendContainerFillColor:"rgba(255, 255, 255, 0.85)",legendContainerShadow:"0 2px 8px 0 rgba(166, 166, 166, 0.20)",legendContainerBorderRadius:2,legendTextFillColor:Ml[65],legendTextFontSize:12,tooltipContainerFillColor:"rgba(255, 255, 255, 0.9)",tooltipContainerShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",tooltipContainerBorderRadius:2,tooltipTextFillColor:Ml[65],tooltipItemNameFillColor:Ml[65],tooltipItemValueFillColor:Ml[65],tooltipTextFontSize:12,tooltipTextLineHeight:"20px",labelFillColor:Ml[65],labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,pointFillColor:c,pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:CSt[100],pointActiveBorderColor:Ml[100],pointSelectedBorderColor:Ml[100]}};O8();const TSt={100:"#000",95:"#0D0D0D",85:"#262626",65:"#595959",45:"#8C8C8C",25:"#BFBFBF",15:"#D9D9D9",6:"#F0F0F0"},Il={100:"#FFFFFF",95:"#F2F2F2",85:"#D9D9D9",65:"#A6A6A6",45:"#737373",25:"#404040",15:"#262626",6:"#0F0F0F"},TL=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#E86452","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],bSt=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#E86452","#F8D0CB","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],wSt=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"],P8=(r={})=>{const{mapStyle:t="dark",subColor:e="rgba(255,255,255,0.05)",paletteQualitative10:i=TL,paletteQualitative20:n=bSt,paletteSemanticRed:a="#F4664A",paletteSemanticGreen:o="#30BF78",paletteSemanticYellow:s="#FAAD14",paletteSequence:l=wSt,fontFamily:u=`"-apple-system", "Segoe UI", Roboto, "Helvetica Neue", Arial,
    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
    "Noto Color Emoji"`}=r,{brandColor:c=i[0]}=r;return{mapStyle:t,brandColor:c,subColor:e,paletteQualitative10:i,paletteQualitative20:n,paletteSemanticRed:a,paletteSemanticGreen:o,paletteSemanticYellow:s,paletteSequence:l,fontFamily:u,legendContainerFillColor:"rgba(31, 31, 31, 0.85)",legendContainerShadow:"0 2px 8px 0 rgba(166, 166, 166, 0.20)",legendContainerBorderRadius:2,legendTextFillColor:Il[65],legendTextFontSize:12,tooltipContainerFillColor:"rgba(31, 31, 31, 0.9)",tooltipContainerShadow:"0px 2px 4px rgba(0, 0, 0, 0.5)",tooltipContainerBorderRadius:2,tooltipTextFillColor:Il[65],tooltipItemNameFillColor:Il[65],tooltipItemValueFillColor:Il[65],tooltipTextFontSize:12,tooltipTextLineHeight:"20px",labelFillColor:Il[65],labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,pointFillColor:TL[0],pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:TSt[100],pointActiveBorderColor:Il[100],pointSelectedBorderColor:Il[100]}};P8();function F8(r){const{styleSheet:t={}}=r,e=zt(r,["styleSheet"]),i=O8(t);return at({},L8(i),e)}function RSt(r){const{styleSheet:t={}}=r,e=zt(r,["styleSheet"]),i=P8(t);return at({},L8(i),e)}const bL=F8({}),MSt=RSt({}),wL={default:bL,light:bL,dark:MSt};function CC(r="default"){return P(wL,hl(r),wL.default)}const ISt=[{original:"loaded",adaptation:"scene-loaded"},{original:"resize",adaptation:"resize"},{original:"destroy",adaptation:"destroy"},{original:"resize",adaptation:"resize"}],LSt=["mapmove","movestart","moveend","zoomchange","zoomstart","zoomend","click","dblclick","contextmenu","mousemove","mousewheel","mouseover","mouseout","mouseup","mousedown","dragstart","dragging","dragend"],o0=["inited","add","remove","dataUpdate","click","unclick","dblclick","undblclick","contextmenu","uncontextmenu","mouseenter","mousemove","unmousemove","mouseout","mouseup","unmouseup","mousedown","uncontextmenu","unpick","legend","legend:color","legend:size"],RL=new Map,ML=new Map,IL=new Map,B8={map:{type:ma.Amap},logo:!0};let D8=class N8 extends ku{constructor(t){super(),this.inited=!1,this.sceneLoaded=!1,this.layersLoaded=!1,this.loaded=!1,this.layerGroup=new hT,this.options=lr({},this.getDefaultOptions(),t),this.lastOptions=this.options}getDefaultOptions(){return N8.DefaultOptions}createContainer(t){const{width:e,height:i}=this.options,n=typeof t=="string"?document.getElementById(t):t;return n.style.position||(n.style.position="relative"),e&&(n.style.width||(n.style.width=`${e}px`)),i&&(n.style.height||(n.style.height=`${i}px`)),n}createTheme(){return ie(this.options.theme)?lr({},CC("default"),F8(this.options.theme)):CC(this.options.theme)}createMap(){const t=this.options.map?this.options.map:B8.map,{type:e}=t,i=zt(t,["type"]),n=Object.assign({style:this.theme.mapStyle},i);return e===ma.Amap?new art(n):e===ma.AmapV1?new ort(n):e===ma.AmapV2?new srt(n):e===ma.Mapbox?new Yet(n):new Het(n)}createScene(){const{logo:t,antialias:e,preserveDrawingBuffer:i}=this.options,n=os(t)?{logoVisible:t}:{logoVisible:t==null?void 0:t.visible,logoPosition:t==null?void 0:t.position},a=Object.assign({antialias:e,preserveDrawingBuffer:i},n),o=this.createMap();return new hat(Object.assign({id:this.container,map:o},a))}registerResources(){RL.size&&RL.forEach((t,e)=>{!this.scene.hasImage(e)&&this.scene.addImage(e,t)}),ML.size&&ML.forEach((t,e)=>{this.scene.addFontFace(e,t)}),IL.size&&IL.forEach((t,e)=>{this.scene.addIconFont(e,t)})}update(t){this.updateOption(t),t.map&&!qt(this.lastOptions.map,this.options.map)&&this.updateMap(t.map),this.render(),this.emit("update")}updateOption(t){this.lastOptions=this.options,this.options=lr({},this.options,t)}updateMap(t){var e;if(!this.scene)return;const{style:i,center:n,zoom:a,rotation:o,pitch:s}=t;zr(s)||this.scene.setPitch(s),zr(o)||this.scene.setRotation(o),i&&i!==((e=this.lastOptions.map)===null||e===void 0?void 0:e.style)&&this.scene.setMapStyle(i),a&&n&&this.scene.setZoomAndCenter(a,n)}changeSize(t,e){this.options.width===t&&this.options.height===e||(this.container.style.width=`${t}px`,this.container.style.height=`${e}px`,this.options=Object.assign(this.options,{width:t,height:e}))}on(t,e,i){return this.proxyEventHander("on",t,e,i),this}once(t,e){return this.proxyEventHander("once",t,e),this}off(t,e){return this.proxyEventHander("off",t,e),this}proxyEventHander(t,e,i,n){const a=ISt.find(o=>o.adaptation===e);if(a)this.scene[t](a.original,i);else if(LSt.indexOf(e)!==-1)this.scene[t](e,i);else if(e.includes("Layer:")){const[o,s]=e.split(":");if(this[o]&&this[o][t]&&o0.indexOf(s)!==-1)this[o][t](s,i);else throw new Error(`No event name "${e}"`)}else super[t](e,i,n)}getScene(){return this.scene}getMap(){var t,e,i,n;return((t=this.options.map)===null||t===void 0?void 0:t.type)===ma.Amap?this.scene.map:((e=this.options.map)===null||e===void 0?void 0:e.type)===ma.AmapV2?this.scene.map:((i=this.options.map)===null||i===void 0?void 0:i.type)===ma.Mapbox?this.scene.map:((n=this.options.map)===null||n===void 0?void 0:n.type)===ma.Map?this.scene.map:this.scene.map}addLayer(t){this.layerGroup.addLayer(t)}getLayes(){return console.warn("Replace to use getLayers()"),this.getLayers()}getLayers(){return this.layerGroup.getLayers()}getLayerByName(t){return this.layerGroup.getLayerByName(t)}removeLayer(t){return this.layerGroup.removeLayer(t)}removeAllLayer(){this.layerGroup.removeAllLayer()}zoomIn(){this.scene.zoomIn()}zoomOut(){this.scene.zoomOut()}setPitch(t){this.scene.setPitch(t)}fitBounds(t){this.scene.fitBounds(t)}setMapStatus(t){this.scene.setMapStatus(t)}setBgColor(t){this.scene.setBgColor(t)}initComponents(){this.initControls(),this.initTooltip()}updateComponents(){this.updateControls(),this.initTooltip()}initControls(){const{zoom:t,scale:e,layerMenu:i,legend:n}=this.options;e&&this.addScaleControl(e),t&&this.addZoomControl(t),i&&this.addLayerMenuControl(i),n&&(this.addLegendControl(n),this.emit("add-legend"))}updateControls(){const{zoom:t,scale:e,layerMenu:i,legend:n}=this.options;qt(this.lastOptions.zoom,t)||(t?this.updateZoomControl(t):this.removeZoomControl()),qt(this.lastOptions.scale,e)||(e?this.updateScaleControl(e):this.removeScaleControl()),qt(this.lastOptions.layerMenu,i)||(i?this.updateLayerMenuControl(i):this.removeLayerMenuControl()),qt(this.lastOptions.legend,n)||(n?this.updateLegendControl(n):this.removeLegendControl())}addZoomControl(t){this.zoomControl||(this.zoomControl=new gtt(t),this.scene.addControl(this.zoomControl))}updateZoomControl(t){if(!this.zoomControl){this.addZoomControl(t);return}this.removeZoomControl(),this.addZoomControl(t)}removeZoomControl(){this.zoomControl&&(this.zoomControl.remove(),this.zoomControl=void 0)}addScaleControl(t){this.scaleControl||(this.scaleControl=new Aq(t),this.scene.addControl(this.scaleControl))}updateScaleControl(t){if(!this.scaleControl){this.addScaleControl(t);return}this.removeScaleControl(),this.addScaleControl(t)}removeScaleControl(){this.scaleControl&&(this.scaleControl.remove(),this.scaleControl=void 0)}addLayerMenuControl(t){this.layerGroup.getLayers().forEach(({name:e,layer:i})=>{})}updateLayerMenuControl(t){this.removeLayerMenuControl(),this.addLayerMenuControl(t)}removeLayerMenuControl(){}getLegendOptions(){return{}}addLegendControl(t){if(this.legendControl)return;const e=this.theme.components.legend,i=lr({},this.getLegendOptions(),t),{type:n,position:a}=i,o=zt(i,["type","position"]),s=[];if(n==="category"){const l=lr({},{domStyles:e.category.domStyles},o);s.push({type:n,options:l})}else if(n==="continue"){const l=lr({},{domStyles:e.continue.domStyles},o);s.push({type:n,options:l})}s.length&&(this.legendControl=new vSt({position:a,items:s}),this.scene.addControl(this.legendControl))}updateLegendControl(t){if(!this.legendControl){this.addLegendControl(t);return}this.removeLegendControl(),this.addLegendControl(t)}removeLegendControl(){this.legendControl&&(this.legendControl.remove(),this.legendControl=void 0)}initTooltip(){this.tooltip&&this.tooltip.destroy();const{tooltip:t}=this.options;if(t){const e=lr({},{domStyles:this.theme.components.tooltip.domStyles},t),i=this.layerGroup.getInteractionLayers();this.tooltip=new xSt(this.scene,i,e),this.tooltip.on("*",n=>this.emit(n.type,n))}}exportPng(t){return this.scene.exportPng(t)}destroy(){var t;super.off("*"),this.removeScaleControl(),this.removeZoomControl(),this.removeLayerMenuControl(),this.removeLegendControl(),(t=this.tooltip)===null||t===void 0||t.destroy(),this.scene.destroy()}};D8.DefaultOptions=B8;class EC{static aggregation(t,e){const{type:i="grid",radius:n,method:a,field:o}=e,s={type:i,size:n,method:a,field:o};t.transforms?(t.transforms=t.transforms.filter(l=>l.type!==s.type),t.transforms.push(s)):t.transforms=[s]}}const k8=["name","zIndex","visible","minZoom","maxZoom","pickingBuffer","autoFit","blend"];class an extends ku{constructor(t){super(),this.options=lr({},this.getDefaultOptions(),t),this.lastOptions=this.options}getDefaultOptions(){return{}}pickLayerConfig(t){return Ma(t,k8)}addTo(t){t.addLayer(this.layer)}remove(t){t.removeLayer(this.layer)}update(t){this.updateOption(t),this.updateConfig(t)}updateOption(t){this.lastOptions=this.options,this.options=lr({},this.options,t)}updateConfig(t){!zr(t.zIndex)&&!qt(this.lastOptions.zIndex,this.options.zIndex)&&this.setIndex(t.zIndex),!zr(t.blend)&&!qt(this.lastOptions.blend,this.options.blend)&&this.setBlend(t.blend),!zr(t.minZoom)&&!qt(this.lastOptions.minZoom,this.options.minZoom)&&this.setMinZoom(t.minZoom),!zr(t.maxZoom)&&!qt(this.lastOptions.maxZoom,this.options.maxZoom)&&this.setMinZoom(t.maxZoom),!zr(t.visible)&&!qt(this.lastOptions.visible,this.options.visible)&&(t.visible?this.show():this.hide())}render(){this.layer.renderLayers()}setSource(t){if(t instanceof Wm)this.layer.setSource(t);else{const{data:e,aggregation:i}=t,n=zt(t,["data","aggregation"]);i&&EC.aggregation(n,i),this.layer.getSource()?this.layer.setData(e,n):this.layer.source(e,n)}}changeData(t){this.setSource(t)}setIndex(t){this.layer.setIndex(t)}setBlend(t){this.layer.setBlend(t)}setMinZoom(t){this.layer.setMinZoom(t)}setMaxZoom(t){this.layer.setMaxZoom(t)}show(){this.layer.inited&&this.layer.show()}hide(){this.layer.inited&&this.layer.hide()}toggleVisible(){this.isVisible()?this.hide():this.show()}isVisible(){return this.layer.inited?this.layer.isVisible():this.options.visible}fitBounds(t){this.layer.fitBounds(t)}on(t,e){return o0.indexOf(t)!==-1?this.layer.on(t,e):super.on(t,e),this}once(t,e){return o0.indexOf(t)!==-1?this.layer.once(t,e):super.once(t,e),this}off(t,e){return o0.indexOf(t)!==-1?this.layer.off(t,e):super.off(t,e),this}}an.LayerType=_C;an.LayerConfigkeys=k8;function Ll(r,t){return(...e)=>{const i={};return r.forEach((n,a)=>{i[n]=e[a]}),delete i.undefined,t(i)}}class te{static shape(t,e){if(mt(e))t.shape(e);else if(ot(e)){const i=[];t.shape(i.join("*"),Ll(i,e))}else if(ie(e)){const i=e.field?e.field:"";if(ot(e.value)){const n=q(i)?i:i.split("*");t.shape(i,Ll(n,e.value))}else t.shape(i,e.value);mt(i)&&e.scale&&te.scale(t,i,e.scale)}}static size(t,e){if(Tt(e))t.size(e);else if(q(e))t.size(e);else if(ot(e)){const i=[];t.size(i.join("*"),Ll(i,e))}else if(ie(e)){const i=e.field?e.field:"";if(ot(e.value)){const n=q(i)?i:i.split("*");t.size(i,Ll(n,e.value))}else t.size(i,e.value);mt(i)&&e.scale&&te.scale(t,i,e.scale)}}static color(t,e){if(mt(e))t.color(e);else if(ot(e)){const i=[];t.color(i.join("*"),Ll(i,e))}else if(ie(e)){const i=e.field?e.field:"";if(ot(e.value)){const n=q(i)?i:i.split("*");t.color(i,Ll(n,e.value))}else t.color(i,e.value);mt(i)&&e.scale&&te.scale(t,i,e.scale)}}static style(t,e){e&&t.style(e)}static state(t,e){const{active:i,select:n}=e;i&&t.active(i),n&&t.select(n)}static rotate(t,e){mt(e)||ot(e)}static texture(t,e){mt(e)&&t.texture(e)}static animate(t,e){(os(e)||ie(e))&&t.animate(e)}static scale(t,e,i){t.scale(e,i)}static filter(t,e){const i=e.field?e.field:"",n=q(i)?i:i.split("*");t.filter(n.join("*"),Ll(n,e.value))}}function OSt(r,t){const{field:e,content:i,style:n={},state:a}=t,{fontSize:o,fill:s}=n,u={field:e||i||"",value:"text"};te.shape(r,u),o&&te.size(r,o),s&&te.color(r,s),n&&te.style(r,n),a&&te.state(r,a)}const U8={style:{fontSize:12}},PSt=[];class Py extends an{constructor(t){super(t),this.type=an.LayerType.TextLayer,this.interaction=!1;const{name:e,source:i}=this.options,n=this.pickLayerConfig(this.options);this.name=e||ln(this.type),this.layer=new Ed(Object.assign(Object.assign({},n),{name:this.name})),this.mappingLayer(this.layer,this.options),this.setSource(i)}getDefaultOptions(){return U8}mappingLayer(t,e){OSt(t,e)}update(t){super.update(t),this.mappingLayer(this.layer,this.options)}}Py.DefaultOptions=U8;Py.LayerOptionsKeys=an.LayerConfigkeys.concat(PSt);const FSt={autoFit:!1};class Eo extends D8{constructor(t,e){if(typeof t=="string"||t instanceof Element){if(e===void 0)throw new Error("options is undefined");super(e),this.container=this.createContainer(t),this.theme=this.createTheme(),this.scene=this.createScene(),this.registerResources(),this.initSource()}else super(t)}initSource(){this.source=this.createSource(),this.render(),this.inited=!0}initLayersEvent(){}getDefaultOptions(){return Eo.DefaultOptions}createSource(){const t=this.options.source,{data:e,aggregation:i}=t,n=zt(t,["data","aggregation"]);return i&&EC.aggregation(n,i),new Wm(e,n)}createLabelLayer(t,e,i){const{visible:n,minZoom:a,maxZoom:o,zIndex:s=0}=i||{};return new Py(Object.assign({name:"labelLayer",visible:n,minZoom:a,maxZoom:o,zIndex:s+.1,source:t},e))}updateLabelLayer(t,e,i,n){e?n?n.update(Object.assign({},e)):(n=this.createLabelLayer(t,e,i),this.layerGroup.addLayer(n)):e===!1&&n&&this.layerGroup.removeLayer(n)}render(){const t=this.createLayers(this.source);this.inited?(this.layerGroup.removeAllLayer(),t.addTo(this.scene),this.layerGroup=t):(this.layerGroup=t,this.scene.sceneService.loaded?this.onSceneLoaded():this.scene.once("loaded",()=>{this.onSceneLoaded()})),this.initLayersEvent()}onSceneLoaded(){this.sceneLoaded=!0,this.layerGroup.isEmpty()?this.onLayersLoaded():this.layerGroup.once("inited-all",()=>{this.onLayersLoaded()}),this.layerGroup.addTo(this.scene)}onLayersLoaded(){this.layersLoaded=!0,this.initComponents(),this.loaded=!0,this.emit("loaded")}attachToScene(t,e){this.scene=t,this.theme=e||CC("default"),this.registerResources(),this.initSource()}unattachFromScene(){var t;this.removeAllLayer(),(t=this.tooltip)===null||t===void 0||t.destroy()}addToScene(t){this.attachToScene(t)}removeFromScene(){var t;this.removeAllLayer(),this.removeScaleControl(),this.removeZoomControl(),this.removeLayerMenuControl(),this.removeLegendControl(),(t=this.tooltip)===null||t===void 0||t.destroy()}update(t){if(this.updateOption(t),t.map&&!qt(this.lastOptions.map,this.options.map)&&this.updateMap(t.map),this.scene.setEnableRender(!1),t.source&&!qt(this.lastOptions.source,this.options.source)){const e=t.source,{data:i}=e,n=zt(e,["data"]);this.changeData(i,n)}this.scene.setEnableRender(!0),this.render(),this.updateComponents(),this.emit("update")}changeData(t,e){this.options.source=lr({},this.options.source,Object.assign({data:t},e));const i=this.options.source,{aggregation:n}=i,a=zt(i,["aggregation"]);n&&EC.aggregation(a,n),this.source.setData(this.options.source.data,a);const o=this.options.legend;o&&setTimeout(()=>{this.updateLegendControl(o)},500),this.emit("change-data")}}Eo.DefaultOptions=FSt;Eo.PlotType=xC;const LL="#2f54eb",Br={active:{fill:!1,stroke:LL,lineWidth:1.5,lineOpacity:.8},select:{fill:!1,stroke:LL,lineWidth:1.5,lineOpacity:.8}},Hf=r=>(zr(r)||(r.active===!1?Br.active=Object.assign(Br.active,{fill:!1,stroke:!1}):typeof r.active=="object"&&(r.active.fill===!1?Br.active.fill=!1:typeof r.active.fill=="string"&&(Br.active.fill=r.active.fill),r.active.stroke===!1?Br.active.stroke=!1:typeof r.active.stroke=="string"&&(Br.active.stroke=r.active.stroke),typeof r.active.lineWidth=="number"&&(Br.active.lineWidth=r.active.lineWidth),typeof r.active.lineOpacity=="number"&&(Br.active.lineOpacity=r.active.lineOpacity)),r.select===!1?Br.select=Object.assign(Br.select,{fill:!1,stroke:!1}):typeof r.select=="object"&&(r.select.fill===!1?Br.select.fill=!1:typeof r.select.fill=="string"&&(Br.select.fill=r.select.fill),r.select.stroke===!1?Br.select.stroke=!1:typeof r.select.stroke=="string"&&(Br.select.stroke=r.select.stroke),typeof r.select.lineWidth=="number"&&(Br.select.lineWidth=r.select.lineWidth),typeof r.select.lineOpacity=="number"&&(Br.select.lineOpacity=r.select.lineOpacity))),Br);function BSt(r,t,e,i,n,a){const{color:o,style:s,state:l}=a,u=Hf(l),c={active:u.active.fill===!1?!1:{color:u.active.fill},select:!1},h={opacity:s==null?void 0:s.opacity},f=s==null?void 0:s.lineWidth,d=s==null?void 0:s.stroke,v={opacity:s==null?void 0:s.lineOpacity,dashArray:s==null?void 0:s.lineDash,lineType:s==null?void 0:s.lineType};if(te.shape(r,"fill"),o&&te.color(r,o),h&&te.style(r,h),c&&te.state(r,c),te.shape(t,"line"),f&&te.size(t,f),d&&te.color(t,d),v&&te.style(t,v),u.active.stroke){const p=u.active.stroke,g=u.active.lineWidth||f,m={opacity:u.active.lineOpacity};te.shape(e,"line"),g&&te.size(e,g),p&&te.color(e,p),m&&te.style(e,m)}if(u.select.fill){const p=u.select.fill;te.shape(i,"fill"),p&&te.color(i,p),h&&te.style(i,h),te.state(i,{select:!1,active:!1})}if(u.select.stroke){const p=u.select.stroke,g=u.select.lineWidth||f,m={opacity:u.select.lineOpacity};te.shape(n,"line"),g&&te.size(n,g),p&&te.color(n,p),m&&te.style(n,m)}}const DSt=r=>!Array.isArray(r[0].value),xT=r=>DSt(r)?r:r.map(e=>Object.assign(Object.assign({},e),{value:[x2(e.value[0],4),x2(e.value[1],4)]})),z8={visible:!0,state:{active:!1,select:!1},enabledMultiSelect:!1},NSt=["color","style","state","enabledMultiSelect"];class sd extends an{constructor(t){super(t),this.selectData=[],this.type=an.LayerType.AreaLayer,this.interaction=!0,this.onHighlighHandle=c=>{const{feature:h,featureId:f}=c;this.setHighlightLayerSource(h,f)},this.onUnhighlighHandle=()=>{this.setHighlightLayerSource()},this.onSelectHandle=c=>{const h=this.options.enabledMultiSelect,{feature:f,featureId:d}=c;let v=Rr(this.selectData);const p=v.findIndex(g=>g.featureId===d);if(p===-1)h?v.push({feature:f,featureId:d}):v=[{feature:f,featureId:d}],this.emit("select",f,Rr(v));else{const g=v[p];h?v.splice(p,1):v=[],this.emit("unselect",g,Rr(v))}this.setSelectLayerSource(v)};const{name:e,source:i,visible:n,minZoom:a,maxZoom:o,zIndex:s=0}=this.options,l=this.pickLayerConfig(this.options),u=Hf(this.options.state);this.name=e||ln(this.type),this.layer=new M0(Object.assign(Object.assign({},l),{name:this.name})),this.strokeLayer=new Oc({name:"strokeLayer",visible:n,zIndex:s,minZoom:a,maxZoom:o}),this.highlightLayer=new Oc({name:"highlightLayer",visible:n&&!!u.active.stroke,zIndex:s+.1,minZoom:a,maxZoom:o}),this.selectFillLayer=new M0({name:"selectFillLayer",visible:n&&!!u.select.fill,zIndex:s+.1,minZoom:a,maxZoom:o}),this.selectStrokeLayer=new Oc({name:"selectStrokeLayer",visible:n&&!!u.select.stroke,zIndex:s+.1,minZoom:a,maxZoom:o}),this.mappingLayer(this.options),this.setSource(i),this.initEvent()}getDefaultOptions(){return z8}mappingLayer(t){BSt(this.layer,this.strokeLayer,this.highlightLayer,this.selectFillLayer,this.selectStrokeLayer,t)}setSource(t){super.setSource(t),this.setStrokeLayerSource(),this.setHighlightLayerSource(),this.selectFillLayer.source({type:"FeatureCollection",features:[]},{parser:{type:"geojson"}}),this.selectStrokeLayer.source({type:"FeatureCollection",features:[]},{parser:{type:"geojson"}})}setStrokeLayerSource(){const t=this.layer.getSource();if(t)this.strokeLayer.setSource(t);else{const{data:e,options:i}=this.layer.sourceOption;this.strokeLayer.source(e,i)}}setHighlightLayerSource(t,e=-999){if(this.highlightLayerData===e)return;const i=t?[t]:[];this.highlightLayer.getSource()?this.highlightLayer.setData({type:"FeatureCollection",features:i},{parser:{type:"geojson"}}):this.highlightLayer.source({type:"FeatureCollection",features:[]},{parser:{type:"geojson"}}),this.highlightLayerData=e}setSelectLayerSource(t=[]){if(this.selectData.length===t.length&&qt(this.selectData.map(({featureId:i})=>i),t.map(({featureId:i})=>i)))return;const e=t.map(({feature:i})=>i);this.selectFillLayer.setData({type:"FeatureCollection",features:e},{parser:{type:"geojson"}}),this.selectStrokeLayer.setData({type:"FeatureCollection",features:e},{parser:{type:"geojson"}}),this.selectData=t}initEvent(){this.layer.off("mousemove",this.onHighlighHandle),this.layer.off("unmousemove",this.onHighlighHandle),this.layer.off("click",this.onSelectHandle),this.selectData=[],this.highlightLayerData=null,this.options.state&&(this.options.state.active&&(this.layer.on("mousemove",this.onHighlighHandle),this.layer.on("unmousemove",this.onUnhighlighHandle)),this.options.state.select&&this.layer.on("click",this.onSelectHandle))}addTo(t){t.addLayer(this.layer),t.addLayer(this.strokeLayer),t.addLayer(this.highlightLayer),t.addLayer(this.selectFillLayer),t.addLayer(this.selectStrokeLayer)}remove(t){t.removeLayer(this.layer),t.removeLayer(this.strokeLayer),t.removeLayer(this.highlightLayer),t.removeLayer(this.selectFillLayer),t.removeLayer(this.selectStrokeLayer)}update(t){if(super.update(t),this.mappingLayer(this.options),this.options.visible){!zr(t.state)&&!qt(this.lastOptions.state,this.options.state)&&this.updateHighlightLayer();const e=Hf(this.options.state);e.active.stroke&&this.setHighlightLayerSource(),(e.select.fill||e.select.stroke)&&this.setSelectLayerSource()}this.initEvent()}updateHighlightLayer(){const t=Hf(this.options.state),e=Hf(this.lastOptions.state);e.active.stroke!==t.active.stroke&&(t.active.stroke?this.highlightLayer.show():this.highlightLayer.hide()),e.select.fill!==t.select.fill&&(t.select.fill?this.selectFillLayer.show():this.selectFillLayer.hide()),e.select.stroke!==t.select.stroke&&(t.select.stroke?this.selectStrokeLayer.show():this.selectStrokeLayer.hide())}setIndex(t){this.layer.setIndex(t),this.strokeLayer.setIndex(t),this.highlightLayer.setIndex(t+.1),this.selectFillLayer.setIndex(t+.1),this.selectStrokeLayer.setIndex(t+.1)}setMinZoom(t){this.layer.setMinZoom(t),this.strokeLayer.setMinZoom(t),this.highlightLayer.setMinZoom(t),this.selectFillLayer.setMinZoom(t),this.selectStrokeLayer.setMinZoom(t)}setMaxZoom(t){this.layer.setMaxZoom(t),this.strokeLayer.setMaxZoom(t),this.highlightLayer.setMaxZoom(t),this.selectFillLayer.setMaxZoom(t),this.selectStrokeLayer.setMaxZoom(t)}show(){this.layer.inited&&(this.layer.show(),this.strokeLayer.show(),this.selectFillLayer.show(),this.selectStrokeLayer.show())}hide(){this.layer.inited&&(this.layer.hide(),this.strokeLayer.hide(),this.selectFillLayer.hide(),this.selectStrokeLayer.hide())}getColorLegendItems(){const t=this.layer.getLegendItems("color");return Array.isArray(t)&&t.length!==0?xT(t):[]}setActive(t){}setSelect(t){}}sd.DefaultOptions=z8;sd.LayerOptionsKeys=an.LayerConfigkeys.concat(NSt);const H8=new Map;function kSt(r,t){H8.set(r,t)}function USt(r){return H8.get(r)}const zSt=lr({},Eo.DefaultOptions,{source:{data:[],joinBy:{geoField:"adcode"}},viewLevel:{level:"country",adcode:"100000"},chinaBorder:!0}),uc={world:"country",country:"province",province:"city",city:"district",district:"district"},$8="https://gw.alipayobjects.com/os/alisis/geo-data-v0.1.2",SC=`${$8}/choropleth-data`,OL={national:{color:"red",width:1,opacity:1},dispute:{color:"red",width:1,opacity:.8,dashArray:[2,4]},coast:{color:"blue",width:.7,opacity:.8},hkm:{color:"gray",width:.7,opacity:.8,dashArray:[2,4]}},HSt=r=>{const t={url:SC,type:"topojson",extension:"topo.json"};return zr(r)||(typeof r=="string"?t.url=r:(t.url=(r==null?void 0:r.url)||SC,t.type=r.type,t.extension=r.type==="topojson"?"topo.json":"json")),t},$St=r=>{try{return CW(r,"json")}catch{throw new Error('Failed convert to geojson from topojson, topojson default layer name "json"')}},WSt=(r,t)=>{if(r.length!==t.length)return!1;for(let e=0;e<r.length;e++){const{level:i,granularity:n}=r[e];if(t[e].level!==i||t[e].granularity!==n)return!1}return!0},PL=r=>Ma(r,["source","color","style","state","label","tooltip"]);function VSt(r,t){const{shape:e,color:i,size:n,style:a,state:o,animate:s,texture:l}=t;e&&te.shape(r,e),n&&te.size(r,n),i&&te.color(r,i),a&&te.style(r,a),o&&te.state(r,o),s&&te.animate(r,s),l&&te.texture(r,l)}const W8={},GSt=["shape","color","size","style","state","animate"];class kc extends an{constructor(t){super(t),this.type=an.LayerType.LinesLayer,this.interaction=!0;const{name:e,source:i}=this.options,n=this.pickLayerConfig(this.options);this.name=e||ln(this.type),this.layer=new Oc(Object.assign(Object.assign({},n),{name:this.name})),this.mappingLayer(this.layer,this.options),this.setSource(i)}getDefaultOptions(){return W8}mappingLayer(t,e){VSt(t,e)}update(t){super.update(t),this.mappingLayer(this.layer,this.options)}getColorLegendItems(){const t=this.layer.getLegendItems("color");return Array.isArray(t)&&t.length!==0?xT(t):[]}}kc.DefaultOptions=W8;kc.LayerOptionsKeys=an.LayerConfigkeys.concat(GSt);const XSt=["color","size","style","state","animate"];class s0 extends kc{constructor(){super(...arguments),this.type=kc.LayerType.PathLayer}getDefaultOptions(){return lr({},kc.DefaultOptions,{shape:"line"})}}s0.LayerOptionsKeys=kc.LayerConfigkeys.concat(XSt);const YSt=(r,t)=>{const{visible:e,minZoom:i,maxZoom:n,zIndex:a=0,chinaBorder:o}=t||{},s=typeof o=="object"?lr({},OL,o):OL,l=r.features.filter(({properties:v})=>["coast","national"].includes(v==null?void 0:v.type)),u=r.features.filter(({properties:v})=>(v==null?void 0:v.type)==="dispute"),c=r.features.filter(({properties:v})=>(v==null?void 0:v.type)==="hkm"),h=new s0({name:"chinaBoundaryLayer",visible:e,minZoom:i,maxZoom:n,zIndex:a+.1,source:{data:{type:"FeatureCollection",features:l},parser:{type:"geojson"}},color:{field:"type",value:({type:v})=>s[v].color},size:{field:"type",value:({type:v})=>s[v].width},style:{opacity:s.national.opacity}}),f=new s0({name:"chinaHkmBoundaryLayer",visible:e,minZoom:i,maxZoom:n,zIndex:a+.1,source:{data:{type:"FeatureCollection",features:c},parser:{type:"geojson"}},color:s.hkm.color,size:s.hkm.width,style:{opacity:s.hkm.opacity,lineType:"dash",dashArray:s.hkm.dashArray}}),d=new s0({name:"chinaDisputeBoundaryLayer",visible:e,minZoom:i,maxZoom:n,zIndex:a+.1,source:{data:{type:"FeatureCollection",features:u},parser:{type:"geojson"}},color:s.dispute.color,size:s.dispute.width,style:{opacity:s.dispute.opacity,lineType:"dash",dashArray:s.dispute.dashArray}});return{chinaBoundaryLayer:h,chinaHkmBoundaryLayer:f,chinaDisputeBoundaryLayer:d}};class kh extends Eo{constructor(){super(...arguments),this.type=Eo.PlotType.Choropleth,this.chinaBoundaryData={type:"FeatureCollection",features:[]},this.currentDistrictData={type:"FeatureCollection",features:[]},this.drillSteps=[],this.drillStacks=[],this.onDrillDownHander=t=>{var e;const{steps:i,onDown:n}=this.options.drill,a=(e=t.feature)===null||e===void 0?void 0:e.properties,{adcode:o}=a;if(this.drillStacks.length===i.length+1)return;const s=this.drillStacks.slice(-1)[0],l=this.drillStacks.length-1,u=this.drillSteps[l],{level:c,granularity:h=uc[c]}=u,f=zt(u,["level","granularity"]),d={nativeEvent:!0,from:{level:s.level,adcode:s.adcode,granularity:s.granularity},to:{level:c,adcode:o,granularity:h,properties:a}},v=(p={})=>{const g={level:c,adcode:o,granularity:h},m=lr({},f,p);this.changeView(g,m).then(y=>{y&&(this.drillStacks.push(y),this.emit("drilldown",d))})};n?n(d.from,d.to,v):v()},this.onDrillUpHander=()=>{const{onUp:t}=this.options.drill;if(this.drillStacks.length===0||this.drillStacks.length===1)return;const i=this.drillStacks.length-1,n=this.drillStacks[i],a=this.drillStacks[i-1],o={nativeEvent:!0,from:{level:n.level,adcode:n.adcode,granularity:n.granularity},to:{level:a.level,adcode:a.adcode,granularity:a.granularity}},s=(l={})=>{const u=o.to,c=lr({},a.config,l);this.changeView(u,c).then(h=>{h&&(this.drillStacks.pop(),this.emit("drillup",o))})};t?t(o.from,o.to,s):s()}}initSource(){this.getInitDistrictData().then(()=>{this.source=this.createSource(),this.render(),this.inited=!0})}render(){if(this.inited)this.scene.setEnableRender(!0),this.scene.render();else{const t=this.createLayers(this.source);this.layerGroup=t,this.scene.sceneService.loaded?this.onSceneLoaded():this.scene.once("loaded",()=>{this.onSceneLoaded()}),this.initLayersEvent()}}update(t){var e,i,n;if(this.updateOption(t),t.map&&!qt(this.lastOptions.map,this.options.map)&&this.updateMap(t.map),t.drill&&t.drill.enabled!==!1&&!qt((e=this.lastOptions.drill)===null||e===void 0?void 0:e.steps,(i=this.options.drill)===null||i===void 0?void 0:i.steps)&&(this.drillReset(),this.initDrillEvent()),this.scene.setEnableRender(!1),t.viewLevel&&!qt(this.lastOptions.viewLevel,this.options.viewLevel)){const a=(n=t.source)===null||n===void 0?void 0:n.joinBy.geoData;this.getDistrictData(a).then(()=>{const o=this.options.source,{data:s}=o,l=zt(o,["data"]);this.changeData(s,l),this.updateLayers(t),this.render(),this.updateComponents(),this.emit("update")})}else{if(t.source&&!qt(this.lastOptions.source,this.options.source)){const a=this.options.source,{data:o}=a,s=zt(a,["data"]);this.changeData(o,s)}this.updateLayers(t),this.render(),this.updateComponents(),this.emit("update")}}getDefaultOptions(){return kh.DefaultOptions}parserSourceConfig(t){const{data:e,joinBy:i}=t,n=zt(t,["data","joinBy"]),{sourceField:a,geoField:o,geoData:s}=i,l=s,u={type:"join",sourceField:a,targetField:o,data:e};return n.transforms?n.transforms.push(u):n.transforms=[u],n.parser&&delete n.parser,{data:l,sourceCFG:n}}createSource(){const{data:t,sourceCFG:e}=this.parserSourceConfig(this.options.source);return new Wm(t,e)}changeData(t,e){this.options.source=lr({},this.options.source,Object.assign({data:t},e));const{data:i,sourceCFG:n}=this.parserSourceConfig(this.options.source);this.source.setData(i,n),this.emit("change-data")}createLayers(t){this.fillAreaLayer=new sd(Object.assign({name:"fillAreaLayer",source:t},Ma(this.options,sd.LayerOptionsKeys)));const e=new hT([this.fillAreaLayer]);return this.options.chinaBorder&&this.createCountryBoundaryLayer(this.chinaBoundaryData,this.options).forEach(n=>e.addLayer(n)),this.options.label&&(this.labelLayer=this.createLabelLayer(t,this.options.label),e.addLayer(this.labelLayer)),e}createCountryBoundaryLayer(t,e){const{chinaBoundaryLayer:i,chinaHkmBoundaryLayer:n,chinaDisputeBoundaryLayer:a}=YSt(t,e);return this.chinaBoundaryLayer=i,this.chinaHkmBoundaryLayer=n,this.chinaDisputeBoundaryLayer=a,[i,n,a]}createLabelLayer(t,e){const i=t.originData.features.map(({properties:c})=>Object.assign({},c,{centroid:c.centroid||c.center})).filter(({centroid:c})=>c),{visible:n,minZoom:a,maxZoom:o,zIndex:s=0}=this.options,l=new Py(Object.assign({name:"labelLayer",source:{data:i,parser:{type:"json",coordinates:"centroid"},transforms:t.transforms},visible:n,minZoom:a,maxZoom:o,zIndex:s+.1},e)),u=()=>{const c=this.source.originData.features.map(({properties:h})=>h).filter(({centroid:h})=>h);l.layer.setData(c,{transforms:t.transforms})};return t.on("update",u),l.on("remove",()=>{t.off("update",u)}),l}updateLayers(t){const e=Ma(t,sd.LayerOptionsKeys);this.fillAreaLayer.update(e);const i=()=>{this.createCountryBoundaryLayer(this.chinaBoundaryData,this.options).forEach(o=>this.layerGroup.addLayer(o))},n=()=>{this.chinaBoundaryLayer&&this.layerGroup.removeLayer(this.chinaBoundaryLayer),this.chinaHkmBoundaryLayer&&this.layerGroup.removeLayer(this.chinaHkmBoundaryLayer),this.chinaDisputeBoundaryLayer&&this.layerGroup.removeLayer(this.chinaDisputeBoundaryLayer)};t.chinaBorder?(this.chinaBoundaryLayer&&n(),i()):t.chinaBorder===!1&&n(),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)}initLayersEvent(){this.initDrillEvent(),this.initLegendEvent()}initDrillEvent(){if(this.lastOptions.drill){const{triggerUp:a="unclick",triggerDown:o="click"}=this.lastOptions.drill;this.fillAreaLayer.off(a,this.onDrillUpHander),this.fillAreaLayer.off(o,this.onDrillDownHander)}if(!this.options.drill||this.options.drill.enabled===!1)return;const{steps:t,triggerUp:e="unclick",triggerDown:i="click"}=this.options.drill,n=t.map(a=>typeof a=="string"?{level:a,granularity:uc[a]}:(a.granularity||(a.granularity=uc[a.level]),a));if(WSt(n,this.drillSteps)||(this.drillSteps=n,this.drillStacks=[]),!this.drillStacks.length){const{level:a,adcode:o,granularity:s=uc[a]}=this.options.viewLevel,l=PL(this.options);this.drillStacks=[{level:a,adcode:o,granularity:s,config:l}]}this.fillAreaLayer.on(e,this.onDrillUpHander),this.fillAreaLayer.on(i,this.onDrillDownHander)}initLegendEvent(){const t=this.options.legend;if(!t)return;const e=()=>{this.updateLegendControl(t)};this.fillAreaLayer.on("legend:color",e)}drillReset(){this.drillStacks=[]}getCurrentDrillSteps(){return this.drillStacks.map(e=>Ma(e,["level","adcode","granularity"]))}getLegendOptions(){const t=this.fillAreaLayer.getColorLegendItems();return t.length!==0?{type:"category",items:t}:{}}fetchData(t,e,i){return Ti(this,void 0,void 0,function*(){const n=`${e}_${t}_${i}`,a=USt(n);if(a)return a;const{url:o,type:s,extension:l}=HSt(this.options.geoArea);let u;const c=this.options.customFetchGeoData;return c?u=yield c({url:o,level:t,adcode:e,granularity:i,extension:l}):u=yield(yield fetch(`${o}/${t}/${n}.${l}`)).json(),s==="topojson"&&(u=$St(u)),kSt(n,u),u})}getInitDistrictData(){return Ti(this,void 0,void 0,function*(){var t;const e=this.fetchData("country","100000","boundary"),i=(t=this.options.source)===null||t===void 0?void 0:t.joinBy.geoData;try{[this.chinaBoundaryData]=yield Promise.all([e,this.getDistrictData(i)])}catch(n){throw new Error(`Failed to get china boundary data，${n}`)}})}getDistrictData(t){return Ti(this,void 0,void 0,function*(){const{level:e,adcode:i,granularity:n=uc[e]}=this.options.viewLevel,a=t?Promise.resolve(t):this.fetchData(e,i,n);try{this.currentDistrictData=yield a,this.options.source=lr({},this.options.source,{joinBy:{geoData:this.currentDistrictData}})}catch(o){throw new Error(`Failed to get district data，${o}`)}})}drillDown(t,e={}){const i=this.drillStacks.slice(-1)[0],{level:n,adcode:a,granularity:o}=t,s={nativeEvent:!1,from:{level:i.level,adcode:i.adcode,granularity:i.granularity},to:{level:n,adcode:a,granularity:o}};this.changeView(t,e).then(l=>{l&&(this.drillStacks.push(l),this.emit("drilldown",s))})}drillUp(t={},e){const i=this.drillStacks.length;if([0,1].includes(i))return;const a=e?this.drillStacks.findIndex(v=>v.level===e):-1,o=a!==-1,s=o?a:i-2,l=this.drillStacks[s],{config:u}=l,c=zt(l,["config"]),h=lr({},u,t),f=this.drillStacks[this.drillStacks.length-1],d={nativeEvent:!1,from:{level:f.level,adcode:f.adcode,granularity:f.granularity},to:{level:c.level,adcode:c.adcode,granularity:c.granularity}};this.changeView(c,h).then(v=>{v&&(o?this.drillStacks.splice(a+1):this.drillStacks.pop(),this.emit("drillup",d))})}changeView(t){return Ti(this,arguments,void 0,function*(e,i={}){const{level:n,adcode:a,granularity:o=uc[n]}=e,s=yield this.fetchData(n,a,o);if(!s.features.length)return;const l=lr({},PL(this.options),i,{viewLevel:{level:n,adcode:a,granularity:o},source:{joinBy:{geoData:s}}});return this.update(l),{level:n,adcode:a,granularity:o,config:l}})}}kh.DefaultOptions=zSt;kh.GeoDataUrl=$8;kh.GeoAreaUrl=SC;const tVt=Object.freeze(Object.defineProperty({__proto__:null,Choropleth:kh},Symbol.toStringTag,{value:"Module"})),jSt=lr({},Eo.DefaultOptions,{source:{data:[],parser:{type:"json",x:"x",y:"y"}}});function ZSt(r,t){const{shape:e,color:i,size:n,style:a,state:o,animate:s}=t;e&&te.shape(r,e),n&&te.size(r,n),i&&te.color(r,i),a&&te.style(r,a),o&&te.state(r,o),s&&te.animate(r,s)}const V8={source:{data:[],parser:{type:"json",x:"x",y:"y"}},shape:"circle",size:12,color:"#5FD3A6"},qSt=["shape","color","size","style","state","animate"];class ld extends an{constructor(t){super(t),this.type=an.LayerType.DotLayer,this.interaction=!0;const{name:e,source:i}=this.options,n=this.pickLayerConfig(this.options);this.name=e||ln(this.type),this.layer=new Ed(Object.assign(Object.assign({},n),{name:this.name})),this.mappingLayer(this.layer,this.options),this.setSource(i)}getDefaultOptions(){return V8}mappingLayer(t,e){ZSt(t,e)}update(t){super.update(t),this.mappingLayer(this.layer,this.options)}getColorLegendItems(){const t=this.layer.getLegendItems("color");return Array.isArray(t)&&t.length!==0?xT(t):[]}}ld.DefaultOptions=V8;ld.LayerOptionsKeys=an.LayerConfigkeys.concat(qSt);class CT extends Eo{constructor(){super(...arguments),this.type=Eo.PlotType.Dot}getDefaultOptions(){return CT.DefaultOptions}createLayers(t){this.dotLayer=new ld(Object.assign({source:t},Ma(this.options,ld.LayerOptionsKeys)));const e=new hT([this.dotLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(t,this.options.label,this.options),e.addLayer(this.labelLayer)),e}updateLayers(t){const e=Ma(t,ld.LayerOptionsKeys);this.dotLayer.update(e),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)}getLegendOptions(){const t=this.dotLayer.getColorLegendItems();return t.length!==0?{type:"category",items:t}:{}}}CT.DefaultOptions=jSt;var ET=Object.freeze({__proto__:null,get Base(){return Wa},get Circle(){return m2t},get Ellipse(){return _2t},get Image(){return BT},get Line(){return E2t},get Marker(){return T2t},get Path(){return DT},get Polygon(){return F2t},get Polyline(){return D2t},get Rect(){return z2t},get Text(){return $2t}}),AC=function(r,t){return AC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])},AC(r,t)};function yt(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");AC(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var U=function(){return U=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++){e=arguments[i];for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])}return t},U.apply(this,arguments)};function Fy(r,t){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&t.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(r);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(r,i[n])&&(e[i[n]]=r[i[n]]);return e}function ia(r){var t=typeof Symbol=="function"&&Symbol.iterator,e=t&&r[t],i=0;if(e)return e.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function rt(r,t){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var i=e.call(r),n,a=[],o;try{for(;(t===void 0||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(s){o={error:s}}finally{try{n&&!n.done&&(e=i.return)&&e.call(i)}finally{if(o)throw o.error}}return a}function KSt(){for(var r=0,t=0,e=arguments.length;t<e;t++)r+=arguments[t].length;for(var i=Array(r),n=0,t=0;t<e;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,n++)i[n]=a[o];return i}function ft(r,t,e){if(e||arguments.length===2)for(var i=0,n=t.length,a;i<n;i++)(a||!(i in t))&&(a||(a=Array.prototype.slice.call(t,0,i)),a[i]=t[i]);return r.concat(a||Array.prototype.slice.call(t))}var FL=function(r){return r!==null&&typeof r!="function"&&isFinite(r.length)},QSt={}.toString,By=function(r,t){return QSt.call(r)==="[object "+t+"]"},Cu=function(r){return By(r,"Function")},Ir=function(r){return r==null},na=function(r){return Array.isArray?Array.isArray(r):By(r,"Array")},ud=function(r){var t=typeof r;return r!==null&&t==="object"||t==="function"};function xe(r,t){if(r){var e;if(na(r))for(var i=0,n=r.length;i<n&&(e=t(r[i],i),e!==!1);i++);else if(ud(r)){for(var a in r)if(r.hasOwnProperty(a)&&(e=t(r[a],a),e===!1))break}}}var BL=function(r){return typeof r=="object"&&r!==null},rl=function(r){if(na(r))return r.reduce(function(t,e){return Math.max(t,e)},r[0])},il=function(r){if(na(r))return r.reduce(function(t,e){return Math.min(t,e)},r[0])},Da=function(r){return By(r,"String")},TC=function(r){return By(r,"Number")},JSt=1e-5;function tAt(r,t,e){return e===void 0&&(e=JSt),Math.abs(r-t)<e}var G8=function(r,t){return(r%t+t)%t},eAt=Math.PI/180,X8=function(r){return eAt*r},rAt=Object.values?function(r){return Object.values(r)}:function(r){var t=[];return xe(r,function(e,i){Cu(r)&&i==="prototype"||t.push(e)}),t},iAt=function(r){return Ir(r)?"":r.toString()},Y8=function(r){var t=iAt(r);return t.charAt(0).toUpperCase()+t.substring(1)};function nAt(r){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,16)};return t(r)}function aAt(r){var t=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||clearTimeout;t(r)}function A1(r,t){for(var e in t)t.hasOwnProperty(e)&&e!=="constructor"&&t[e]!==void 0&&(r[e]=t[e])}function j8(r,t,e,i){return t&&A1(r,t),e&&A1(r,e),i&&A1(r,i),r}var oAt=function(r,t){if(!Cu(r))throw new TypeError("Expected a function");var e=function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];var a=t?t.apply(this,i):i[0],o=e.cache;if(o.has(a))return o.get(a);var s=r.apply(this,i);return o.set(a,s),s};return e.cache=new Map,e},nm=function(r,t){if(r===t)return!0;if(!r||!t||Da(r)||Da(t))return!1;if(FL(r)||FL(t)){if(r.length!==t.length)return!1;for(var e=!0,i=0;i<r.length&&(e=nm(r[i],t[i]),!!e);i++);return e}if(BL(r)||BL(t)){var n=Object.keys(r),a=Object.keys(t);if(n.length!==a.length)return!1;for(var e=!0,i=0;i<n.length&&(e=nm(r[n[i]],t[n[i]]),!!e);i++);return e}return!1},_g={},sAt=function(r){return r=r||"g",_g[r]?_g[r]+=1:_g[r]=1,r+_g[r]},xg=function(){},Cg;oAt(function(r,t){t===void 0&&(t={});var e=t.fontSize,i=t.fontFamily,n=t.fontWeight,a=t.fontStyle,o=t.fontVariant;return Cg||(Cg=document.createElement("canvas").getContext("2d")),Cg.font=[a,o,n,e+"px",i].join(" "),Cg.measureText(Da(r)?r:"").width},function(r,t){return t===void 0&&(t={}),KSt([r],rAt(t)).join("")});var cd=`	
\v\f\r   ᠎             　\u2028\u2029`,lAt=new RegExp("([a-z])["+cd+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+cd+"]*,?["+cd+"]*)+)","ig"),uAt=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+cd+"]*,?["+cd+"]*","ig"),Ac=function(r){if(!r)return null;if(na(r))return r;var t={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},e=[];return String(r).replace(lAt,function(i,n,a){var o=[],s=n.toLowerCase();if(a.replace(uAt,function(l,u){u&&o.push(+u)}),s==="m"&&o.length>2&&(e.push([n].concat(o.splice(0,2))),s="l",n=n==="m"?"l":"L"),s==="o"&&o.length===1&&e.push([n,o[0]]),s==="r")e.push([n].concat(o));else for(;o.length>=t[s]&&(e.push([n].concat(o.splice(0,t[s]))),!!t[s]););return r}),e},bC=function(r,t){for(var e=[],i=0,n=r.length;n-2*!t>i;i+=2){var a=[{x:+r[i-2],y:+r[i-1]},{x:+r[i],y:+r[i+1]},{x:+r[i+2],y:+r[i+3]},{x:+r[i+4],y:+r[i+5]}];t?i?n-4===i?a[3]={x:+r[0],y:+r[1]}:n-2===i&&(a[2]={x:+r[0],y:+r[1]},a[3]={x:+r[2],y:+r[3]}):a[0]={x:+r[n-2],y:+r[n-1]}:n-4===i?a[3]=a[2]:i||(a[0]={x:+r[i],y:+r[i+1]}),e.push(["C",(-a[0].x+6*a[1].x+a[2].x)/6,(-a[0].y+6*a[1].y+a[2].y)/6,(a[1].x+6*a[2].x-a[3].x)/6,(a[1].y+6*a[2].y-a[3].y)/6,a[2].x,a[2].y])}return e},Eg=function(r,t,e,i,n){var a=[];if(n===null&&i===null&&(i=e),r=+r,t=+t,e=+e,i=+i,n!==null){var o=Math.PI/180,s=r+e*Math.cos(-i*o),l=r+e*Math.cos(-n*o),u=t+e*Math.sin(-i*o),c=t+e*Math.sin(-n*o);a=[["M",s,u],["A",e,e,0,+(n-i>180),0,l,c]]}else a=[["M",r,t],["m",0,-i],["a",e,i,0,1,1,0,2*i],["a",e,i,0,1,1,0,-2*i],["z"]];return a},wC=function(r){if(r=Ac(r),!r||!r.length)return[["M",0,0]];var t=[],e=0,i=0,n=0,a=0,o=0,s,l;r[0][0]==="M"&&(e=+r[0][1],i=+r[0][2],n=e,a=i,o++,t[0]=["M",e,i]);for(var u=r.length===3&&r[0][0]==="M"&&r[1][0].toUpperCase()==="R"&&r[2][0].toUpperCase()==="Z",c=void 0,h=void 0,f=o,d=r.length;f<d;f++){if(t.push(c=[]),h=r[f],s=h[0],s!==s.toUpperCase())switch(c[0]=s.toUpperCase(),c[0]){case"A":c[1]=h[1],c[2]=h[2],c[3]=h[3],c[4]=h[4],c[5]=h[5],c[6]=+h[6]+e,c[7]=+h[7]+i;break;case"V":c[1]=+h[1]+i;break;case"H":c[1]=+h[1]+e;break;case"R":l=[e,i].concat(h.slice(1));for(var v=2,p=l.length;v<p;v++)l[v]=+l[v]+e,l[++v]=+l[v]+i;t.pop(),t=t.concat(bC(l,u));break;case"O":t.pop(),l=Eg(e,i,h[1],h[2]),l.push(l[0]),t=t.concat(l);break;case"U":t.pop(),t=t.concat(Eg(e,i,h[1],h[2],h[3])),c=["U"].concat(t[t.length-1].slice(-2));break;case"M":n=+h[1]+e,a=+h[2]+i;break;default:for(var v=1,p=h.length;v<p;v++)c[v]=+h[v]+(v%2?e:i)}else if(s==="R")l=[e,i].concat(h.slice(1)),t.pop(),t=t.concat(bC(l,u)),c=["R"].concat(h.slice(-2));else if(s==="O")t.pop(),l=Eg(e,i,h[1],h[2]),l.push(l[0]),t=t.concat(l);else if(s==="U")t.pop(),t=t.concat(Eg(e,i,h[1],h[2],h[3])),c=["U"].concat(t[t.length-1].slice(-2));else for(var g=0,m=h.length;g<m;g++)c[g]=h[g];if(s=s.toUpperCase(),s!=="O")switch(c[0]){case"Z":e=+n,i=+a;break;case"H":e=c[1];break;case"V":i=c[1];break;case"M":n=c[c.length-2],a=c[c.length-1];break;default:e=c[c.length-2],i=c[c.length-1]}}return t},Sg=function(r,t,e,i){return[r,t,e,i,e,i]},DL=function(r,t,e,i,n,a){var o=.3333333333333333,s=2/3;return[o*r+s*e,o*t+s*i,o*n+s*e,o*a+s*i,n,a]},Z8=function(r,t,e,i,n,a,o,s,l,u){e===i&&(e+=1);var c=Math.PI*120/180,h=Math.PI/180*(+n||0),f=[],d,v,p,g,m,y=function(ce,_e,Ve){var Fi=ce*Math.cos(Ve)-_e*Math.sin(Ve),dn=ce*Math.sin(Ve)+_e*Math.cos(Ve);return{x:Fi,y:dn}};if(u)v=u[0],p=u[1],g=u[2],m=u[3];else{d=y(r,t,-h),r=d.x,t=d.y,d=y(s,l,-h),s=d.x,l=d.y,r===s&&t===l&&(s+=1,l+=1);var _=(r-s)/2,x=(t-l)/2,C=_*_/(e*e)+x*x/(i*i);C>1&&(C=Math.sqrt(C),e=C*e,i=C*i);var A=e*e,b=i*i,R=(a===o?-1:1)*Math.sqrt(Math.abs((A*b-A*x*x-b*_*_)/(A*x*x+b*_*_)));g=R*e*x/i+(r+s)/2,m=R*-i*_/e+(t+l)/2,v=Math.asin(((t-m)/i).toFixed(9)),p=Math.asin(((l-m)/i).toFixed(9)),v=r<g?Math.PI-v:v,p=s<g?Math.PI-p:p,v<0&&(v=Math.PI*2+v),p<0&&(p=Math.PI*2+p),o&&v>p&&(v=v-Math.PI*2),!o&&p>v&&(p=p-Math.PI*2)}var M=p-v;if(Math.abs(M)>c){var O=p,F=s,D=l;p=v+c*(o&&p>v?1:-1),s=g+e*Math.cos(p),l=m+i*Math.sin(p),f=Z8(s,l,e,i,n,0,o,F,D,[p,O,g,m])}M=p-v;var H=Math.cos(v),j=Math.sin(v),$=Math.cos(p),k=Math.sin(p),V=Math.tan(M/4),Q=4/3*e*V,Y=4/3*i*V,tt=[r,t],et=[r+Q*j,t-Y*H],dt=[s+Q*k,l-Y*$],Et=[s,l];if(et[0]=2*tt[0]-et[0],et[1]=2*tt[1]-et[1],u)return[et,dt,Et].concat(f);f=[et,dt,Et].concat(f).join().split(",");for(var ht=[],vt=0,It=f.length;vt<It;vt++)ht[vt]=vt%2?y(f[vt-1],f[vt],h).y:y(f[vt],f[vt+1],h).x;return ht},RC=function(r,t){var e=wC(r),i=t&&wC(t),n={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},a={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},o=[],s=[],l="",u="",c,h=function(_,x,C){var A,b;if(!_)return["C",x.x,x.y,x.x,x.y,x.x,x.y];switch(!(_[0]in{T:1,Q:1})&&(x.qx=x.qy=null),_[0]){case"M":x.X=_[1],x.Y=_[2];break;case"A":_=["C"].concat(Z8.apply(0,[x.x,x.y].concat(_.slice(1))));break;case"S":C==="C"||C==="S"?(A=x.x*2-x.bx,b=x.y*2-x.by):(A=x.x,b=x.y),_=["C",A,b].concat(_.slice(1));break;case"T":C==="Q"||C==="T"?(x.qx=x.x*2-x.qx,x.qy=x.y*2-x.qy):(x.qx=x.x,x.qy=x.y),_=["C"].concat(DL(x.x,x.y,x.qx,x.qy,_[1],_[2]));break;case"Q":x.qx=_[1],x.qy=_[2],_=["C"].concat(DL(x.x,x.y,_[1],_[2],_[3],_[4]));break;case"L":_=["C"].concat(Sg(x.x,x.y,_[1],_[2]));break;case"H":_=["C"].concat(Sg(x.x,x.y,_[1],x.y));break;case"V":_=["C"].concat(Sg(x.x,x.y,x.x,_[1]));break;case"Z":_=["C"].concat(Sg(x.x,x.y,x.X,x.Y));break}return _},f=function(_,x){if(_[x].length>7){_[x].shift();for(var C=_[x];C.length;)o[x]="A",i&&(s[x]="A"),_.splice(x++,0,["C"].concat(C.splice(0,6)));_.splice(x,1),c=Math.max(e.length,i&&i.length||0)}},d=function(_,x,C,A,b){_&&x&&_[b][0]==="M"&&x[b][0]!=="M"&&(x.splice(b,0,["M",A.x,A.y]),C.bx=0,C.by=0,C.x=_[b][1],C.y=_[b][2],c=Math.max(e.length,i&&i.length||0))};c=Math.max(e.length,i&&i.length||0);for(var v=0;v<c;v++){e[v]&&(l=e[v][0]),l!=="C"&&(o[v]=l,v&&(u=o[v-1])),e[v]=h(e[v],n,u),o[v]!=="A"&&l==="C"&&(o[v]="C"),f(e,v),i&&(i[v]&&(l=i[v][0]),l!=="C"&&(s[v]=l,v&&(u=s[v-1])),i[v]=h(i[v],a,u),s[v]!=="A"&&l==="C"&&(s[v]="C"),f(i,v)),d(e,i,n,a,v),d(i,e,a,n,v);var p=e[v],g=i&&i[v],m=p.length,y=i&&g.length;n.x=p[m-2],n.y=p[m-1],n.bx=parseFloat(p[m-4])||n.x,n.by=parseFloat(p[m-3])||n.y,a.bx=i&&(parseFloat(g[y-4])||a.x),a.by=i&&(parseFloat(g[y-3])||a.y),a.x=i&&g[y-2],a.y=i&&g[y-1]}return i?[e,i]:e},cAt=/,?([a-z]),?/gi,q8=function(r){return r.join(",").replace(cAt,"$1")},NL=function(r,t,e,i,n){var a=-3*t+9*e-9*i+3*n,o=r*a+6*t-12*e+6*i;return r*o-3*t+3*e},kL=function(r,t,e,i,n,a,o,s,l){l===null&&(l=1),l=l>1?1:l<0?0:l;for(var u=l/2,c=12,h=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],f=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],d=0,v=0;v<c;v++){var p=u*h[v]+u,g=NL(p,r,e,n,o),m=NL(p,t,i,a,s),y=g*g+m*m;d+=f[v]*Math.sqrt(y)}return u*d},hAt=function(r,t,e,i,n,a,o,s){for(var l=[],u=[[],[]],c,h,f,d,v=0;v<2;++v){if(v===0?(h=6*r-12*e+6*n,c=-3*r+9*e-9*n+3*o,f=3*e-3*r):(h=6*t-12*i+6*a,c=-3*t+9*i-9*a+3*s,f=3*i-3*t),Math.abs(c)<1e-12){if(Math.abs(h)<1e-12)continue;d=-f/h,d>0&&d<1&&l.push(d);continue}var p=h*h-4*f*c,g=Math.sqrt(p);if(!(p<0)){var m=(-h+g)/(2*c);m>0&&m<1&&l.push(m);var y=(-h-g)/(2*c);y>0&&y<1&&l.push(y)}}for(var _=l.length,x=_,C;_--;)d=l[_],C=1-d,u[0][_]=C*C*C*r+3*C*C*d*e+3*C*d*d*n+d*d*d*o,u[1][_]=C*C*C*t+3*C*C*d*i+3*C*d*d*a+d*d*d*s;return u[0][x]=r,u[1][x]=t,u[0][x+1]=o,u[1][x+1]=s,u[0].length=u[1].length=x+2,{min:{x:Math.min.apply(0,u[0]),y:Math.min.apply(0,u[1])},max:{x:Math.max.apply(0,u[0]),y:Math.max.apply(0,u[1])}}},fAt=function(r,t,e,i,n,a,o,s){if(!(Math.max(r,e)<Math.min(n,o)||Math.min(r,e)>Math.max(n,o)||Math.max(t,i)<Math.min(a,s)||Math.min(t,i)>Math.max(a,s))){var l=(r*i-t*e)*(n-o)-(r-e)*(n*s-a*o),u=(r*i-t*e)*(a-s)-(t-i)*(n*s-a*o),c=(r-e)*(a-s)-(t-i)*(n-o);if(c){var h=l/c,f=u/c,d=+h.toFixed(2),v=+f.toFixed(2);if(!(d<+Math.min(r,e).toFixed(2)||d>+Math.max(r,e).toFixed(2)||d<+Math.min(n,o).toFixed(2)||d>+Math.max(n,o).toFixed(2)||v<+Math.min(t,i).toFixed(2)||v>+Math.max(t,i).toFixed(2)||v<+Math.min(a,s).toFixed(2)||v>+Math.max(a,s).toFixed(2)))return{x:h,y:f}}}},ws=function(r,t,e){return t>=r.x&&t<=r.x+r.width&&e>=r.y&&e<=r.y+r.height},K8=function(r,t,e,i,n){if(n)return[["M",+r+ +n,t],["l",e-n*2,0],["a",n,n,0,0,1,n,n],["l",0,i-n*2],["a",n,n,0,0,1,-n,n],["l",n*2-e,0],["a",n,n,0,0,1,-n,-n],["l",0,n*2-i],["a",n,n,0,0,1,n,-n],["z"]];var a=[["M",r,t],["l",e,0],["l",0,i],["l",-e,0],["z"]];return a.parsePathArray=q8,a},MC=function(r,t,e,i){return r===null&&(r=t=e=i=0),t===null&&(t=r.y,e=r.width,i=r.height,r=r.x),{x:r,y:t,width:e,w:e,height:i,h:i,x2:r+e,y2:t+i,cx:r+e/2,cy:t+i/2,r1:Math.min(e,i)/2,r2:Math.max(e,i)/2,r0:Math.sqrt(e*e+i*i)/2,path:K8(r,t,e,i),vb:[r,t,e,i].join(" ")}},dAt=function(r,t){return r=MC(r),t=MC(t),ws(t,r.x,r.y)||ws(t,r.x2,r.y)||ws(t,r.x,r.y2)||ws(t,r.x2,r.y2)||ws(r,t.x,t.y)||ws(r,t.x2,t.y)||ws(r,t.x,t.y2)||ws(r,t.x2,t.y2)||(r.x<t.x2&&r.x>t.x||t.x<r.x2&&t.x>r.x)&&(r.y<t.y2&&r.y>t.y||t.y<r.y2&&t.y>r.y)},UL=function(r,t,e,i,n,a,o,s){na(r)||(r=[r,t,e,i,n,a,o,s]);var l=hAt.apply(null,r);return MC(l.min.x,l.min.y,l.max.x-l.min.x,l.max.y-l.min.y)},zL=function(r,t,e,i,n,a,o,s,l){var u=1-l,c=Math.pow(u,3),h=Math.pow(u,2),f=l*l,d=f*l,v=c*r+h*3*l*e+u*3*l*l*n+d*o,p=c*t+h*3*l*i+u*3*l*l*a+d*s,g=r+2*l*(e-r)+f*(n-2*e+r),m=t+2*l*(i-t)+f*(a-2*i+t),y=e+2*l*(n-e)+f*(o-2*n+e),_=i+2*l*(a-i)+f*(s-2*a+i),x=u*r+l*e,C=u*t+l*i,A=u*n+l*o,b=u*a+l*s,R=90-Math.atan2(g-y,m-_)*180/Math.PI;return{x:v,y:p,m:{x:g,y:m},n:{x:y,y:_},start:{x,y:C},end:{x:A,y:b},alpha:R}},vAt=function(r,t,e){var i=UL(r),n=UL(t);if(!dAt(i,n))return e?0:[];for(var a=kL.apply(0,r),o=kL.apply(0,t),s=~~(a/8),l=~~(o/8),u=[],c=[],h={},f=e?0:[],d=0;d<s+1;d++){var v=zL.apply(0,r.concat(d/s));u.push({x:v.x,y:v.y,t:d/s})}for(var d=0;d<l+1;d++){var v=zL.apply(0,t.concat(d/l));c.push({x:v.x,y:v.y,t:d/l})}for(var d=0;d<s;d++)for(var p=0;p<l;p++){var g=u[d],m=u[d+1],y=c[p],_=c[p+1],x=Math.abs(m.x-g.x)<.001?"y":"x",C=Math.abs(_.x-y.x)<.001?"y":"x",A=fAt(g.x,g.y,m.x,m.y,y.x,y.y,_.x,_.y);if(A){if(h[A.x.toFixed(4)]===A.y.toFixed(4))continue;h[A.x.toFixed(4)]=A.y.toFixed(4);var b=g.t+Math.abs((A[x]-g[x])/(m[x]-g[x]))*(m.t-g.t),R=y.t+Math.abs((A[C]-y[C])/(_[C]-y[C]))*(_.t-y.t);b>=0&&b<=1&&R>=0&&R<=1&&(e?f+=1:f.push({x:A.x,y:A.y,t1:b,t2:R}))}}return f},pAt=function(r,t,e){r=RC(r),t=RC(t);for(var i,n,a,o,s,l,u,c,h,f,d=e?0:[],v=0,p=r.length;v<p;v++){var g=r[v];if(g[0]==="M")i=s=g[1],n=l=g[2];else{g[0]==="C"?(h=[i,n].concat(g.slice(1)),i=h[6],n=h[7]):(h=[i,n,i,n,s,l,s,l],i=s,n=l);for(var m=0,y=t.length;m<y;m++){var _=t[m];if(_[0]==="M")a=u=_[1],o=c=_[2];else{_[0]==="C"?(f=[a,o].concat(_.slice(1)),a=f[6],o=f[7]):(f=[a,o,a,o,u,c,u,c],a=u,o=c);var x=vAt(h,f,e);if(e)d+=x;else{for(var C=0,A=x.length;C<A;C++)x[C].segment1=v,x[C].segment2=m,x[C].bez1=h,x[C].bez2=f;d=d.concat(x)}}}}}return d},gAt=function(r,t){return pAt(r,t)};function mAt(r,t){var e=[],i=[];function n(a,o){if(a.length===1)e.push(a[0]),i.push(a[0]);else{for(var s=[],l=0;l<a.length-1;l++)l===0&&e.push(a[0]),l===a.length-2&&i.push(a[l+1]),s[l]=[(1-o)*a[l][0]+o*a[l+1][0],(1-o)*a[l][1]+o*a[l+1][1]];n(s,o)}}return r.length&&n(r,t),{left:e,right:i.reverse()}}function yAt(r,t,e){var i=[[r[1],r[2]]];e=e||2;var n=[];t[0]==="A"?(i.push(t[6]),i.push(t[7])):t[0]==="C"?(i.push([t[1],t[2]]),i.push([t[3],t[4]]),i.push([t[5],t[6]])):t[0]==="S"||t[0]==="Q"?(i.push([t[1],t[2]]),i.push([t[3],t[4]])):i.push([t[1],t[2]]);for(var a=i,o=1/e,s=0;s<e-1;s++){var l=o/(1-o*s),u=mAt(a,l);n.push(u.left),a=u.right}n.push(a);var c=n.map(function(h){var f=[];return h.length===4&&(f.push("C"),f=f.concat(h[2])),h.length>=3&&(h.length===3&&f.push("Q"),f=f.concat(h[1])),h.length===2&&f.push("L"),f=f.concat(h[h.length-1]),f});return c}var _At=function(r,t,e){if(e===1)return[[].concat(r)];var i=[];if(t[0]==="L"||t[0]==="C"||t[0]==="Q")i=i.concat(yAt(r,t,e));else{var n=[].concat(r);n[0]==="M"&&(n[0]="L");for(var a=0;a<=e-1;a++)i.push(n)}return i},xAt=function(r,t){if(r.length===1)return r;var e=r.length-1,i=t.length-1,n=e/i,a=[];if(r.length===1&&r[0][0]==="M"){for(var o=0;o<i-e;o++)r.push(r[0]);return r}for(var o=0;o<i;o++){var s=Math.floor(n*o);a[s]=(a[s]||0)+1}var l=a.reduce(function(u,c,h){return h===e?u.concat(r[e]):u.concat(_At(r[h],r[h+1],c))},[]);return l.unshift(r[0]),(t[i]==="Z"||t[i]==="z")&&l.push("Z"),l},CAt=function(r,t){if(r.length!==t.length)return!1;var e=!0;return xe(r,function(i,n){if(i!==t[n])return e=!1,!1}),e};function EAt(r,t,e){var i=null,n=e;return t<n&&(n=t,i="add"),r<n&&(n=r,i="del"),{type:i,min:n}}var SAt=function(r,t){var e=r.length,i=t.length,n,a,o=0;if(e===0||i===0)return null;for(var s=[],l=0;l<=e;l++)s[l]=[],s[l][0]={min:l};for(var u=0;u<=i;u++)s[0][u]={min:u};for(var l=1;l<=e;l++){n=r[l-1];for(var u=1;u<=i;u++){a=t[u-1],CAt(n,a)?o=0:o=1;var c=s[l-1][u].min+1,h=s[l][u-1].min+1,f=s[l-1][u-1].min+o;s[l][u]=EAt(c,h,f)}}return s},Q8=function(r,t){var e=SAt(r,t),i=r.length,n=t.length,a=[],o=1,s=1;if(e[i][n].min!==i){for(var l=1;l<=i;l++){var u=e[l][l].min;s=l;for(var c=o;c<=n;c++)e[l][c].min<u&&(u=e[l][c].min,s=c);o=s,e[l][o].type&&a.push({index:l-1,type:e[l][o].type})}for(var l=a.length-1;l>=0;l--)o=a[l].index,a[l].type==="add"?r.splice(o,0,[].concat(r[o])):r.splice(o,1)}i=r.length;var h=n-i;if(i<n)for(var l=0;l<h;l++)r[i-1][0]==="z"||r[i-1][0]==="Z"?r.splice(i-2,0,r[i-2]):r.push(r[i-1]),i+=1;return r};function T1(r,t,e){for(var i=[].concat(r),n,a=1/(e+1),o=J8(t)[0],s=1;s<=e;s++)a*=s,n=Math.floor(r.length*a),n===0?i.unshift([o[0]*a+r[n][0]*(1-a),o[1]*a+r[n][1]*(1-a)]):i.splice(n,0,[o[0]*a+r[n][0]*(1-a),o[1]*a+r[n][1]*(1-a)]);return i}function J8(r){var t=[];switch(r[0]){case"M":t.push([r[1],r[2]]);break;case"L":t.push([r[1],r[2]]);break;case"A":t.push([r[6],r[7]]);break;case"Q":t.push([r[3],r[4]]),t.push([r[1],r[2]]);break;case"T":t.push([r[1],r[2]]);break;case"C":t.push([r[5],r[6]]),t.push([r[1],r[2]]),t.push([r[3],r[4]]);break;case"S":t.push([r[3],r[4]]),t.push([r[1],r[2]]);break;case"H":t.push([r[1],r[1]]);break;case"V":t.push([r[1],r[1]]);break}return t}var IC=function(r,t){if(r.length<=1)return r;for(var e,i=0;i<t.length;i++)if(r[i][0]!==t[i][0])switch(e=J8(r[i]),t[i][0]){case"M":r[i]=["M"].concat(e[0]);break;case"L":r[i]=["L"].concat(e[0]);break;case"A":r[i]=[].concat(t[i]),r[i][6]=e[0][0],r[i][7]=e[0][1];break;case"Q":if(e.length<2)if(i>0)e=T1(e,r[i-1],1);else{r[i]=t[i];break}r[i]=["Q"].concat(e.reduce(function(n,a){return n.concat(a)},[]));break;case"T":r[i]=["T"].concat(e[0]);break;case"C":if(e.length<3)if(i>0)e=T1(e,r[i-1],2);else{r[i]=t[i];break}r[i]=["C"].concat(e.reduce(function(n,a){return n.concat(a)},[]));break;case"S":if(e.length<2)if(i>0)e=T1(e,r[i-1],1);else{r[i]=t[i];break}r[i]=["S"].concat(e.reduce(function(n,a){return n.concat(a)},[]));break;default:r[i]=t[i]}return r},AAt=Object.freeze({__proto__:null,catmullRomToBezier:bC,fillPath:xAt,fillPathByDiff:Q8,formatPath:IC,intersection:gAt,parsePathArray:q8,parsePathString:Ac,pathToAbsolute:wC,pathToCurve:RC,rectPath:K8}),TAt=function(){function r(t,e){this.bubbles=!0,this.target=null,this.currentTarget=null,this.delegateTarget=null,this.delegateObject=null,this.defaultPrevented=!1,this.propagationStopped=!1,this.shape=null,this.fromShape=null,this.toShape=null,this.propagationPath=[],this.type=t,this.name=t,this.originalEvent=e,this.timeStamp=e.timeStamp}return r.prototype.preventDefault=function(){this.defaultPrevented=!0,this.originalEvent.preventDefault&&this.originalEvent.preventDefault()},r.prototype.stopPropagation=function(){this.propagationStopped=!0},r.prototype.toString=function(){var t=this.type;return"[Event (type="+t+")]"},r.prototype.save=function(){},r.prototype.restore=function(){},r}(),bAt="*",Dy=function(){function r(){this._events={}}return r.prototype.on=function(t,e,i){return this._events[t]||(this._events[t]=[]),this._events[t].push({callback:e,once:!!i}),this},r.prototype.once=function(t,e){return this.on(t,e,!0)},r.prototype.emit=function(t){for(var e=this,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var a=this._events[t]||[],o=this._events[bAt]||[],s=function(l){for(var u=l.length,c=0;c<u;c++)if(l[c]){var h=l[c],f=h.callback,d=h.once;d&&(l.splice(c,1),l.length===0&&delete e._events[t],u--,c--),f.apply(e,i)}};s(a),s(o)},r.prototype.off=function(t,e){if(!t)this._events={};else if(!e)delete this._events[t];else{for(var i=this._events[t]||[],n=i.length,a=0;a<n;a++)i[a].callback===e&&(i.splice(a,1),n--,a--);i.length===0&&delete this._events[t]}return this},r.prototype.getEvents=function(){return this._events},r}();function tk(r,t){var e=r.indexOf(t);e!==-1&&r.splice(e,1)}var HL=typeof window<"u"&&typeof window.document<"u";function ek(r,t){if(r.isCanvas())return!0;for(var e=t.getParent(),i=!1;e;){if(e===r){i=!0;break}e=e.getParent()}return i}function LC(r){return r.cfg.visible&&r.cfg.capture}var wAt=function(r){yt(t,r);function t(e){var i=r.call(this)||this;i.destroyed=!1;var n=i.getDefaultCfg();return i.cfg=j8(n,e),i}return t.prototype.getDefaultCfg=function(){return{}},t.prototype.get=function(e){return this.cfg[e]},t.prototype.set=function(e,i){this.cfg[e]=i},t.prototype.destroy=function(){this.cfg={destroyed:!0},this.off(),this.destroyed=!0},t}(Dy),$L=function(r,t,e){if(e||arguments.length===2)for(var i=0,n=t.length,a;i<n;i++)(a||!(i in t))&&(a||(a=Array.prototype.slice.call(t,0,i)),a[i]=t[i]);return r.concat(a||Array.prototype.slice.call(t))},RAt=function(){function r(t,e,i){this.name=t,this.version=e,this.os=i,this.type="browser"}return r}(),MAt=function(){function r(t){this.version=t,this.type="node",this.name="node",this.os=process.platform}return r}(),IAt=function(){function r(t,e,i,n){this.name=t,this.version=e,this.os=i,this.bot=n,this.type="bot-device"}return r}(),LAt=function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r}(),OAt=function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r}(),PAt=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,FAt=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,WL=3,BAt=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",PAt]],VL=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function DAt(r){return r?GL(r):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new OAt:typeof navigator<"u"?GL(navigator.userAgent):UAt()}function NAt(r){return r!==""&&BAt.reduce(function(t,e){var i=e[0],n=e[1];if(t)return t;var a=n.exec(r);return!!a&&[i,a]},!1)}function GL(r){var t=NAt(r);if(!t)return null;var e=t[0],i=t[1];if(e==="searchbot")return new LAt;var n=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);n?n.length<WL&&(n=$L($L([],n,!0),zAt(WL-n.length),!0)):n=[];var a=n.join("."),o=kAt(r),s=FAt.exec(r);return s&&s[1]?new IAt(e,a,o,s[1]):new RAt(e,a,o)}function kAt(r){for(var t=0,e=VL.length;t<e;t++){var i=VL[t],n=i[0],a=i[1],o=a.exec(r);if(o)return n}return null}function UAt(){var r=typeof process<"u"&&process.version;return r?new MAt(process.version.slice(1)):null}function zAt(r){for(var t=[],e=0;e<r;e++)t.push("0");return t}var am=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});function Ny(r,t,e){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],f=e[0],d=e[1],v=e[2],p=e[3],g=e[4],m=e[5],y=e[6],_=e[7],x=e[8];return r[0]=f*i+d*o+v*u,r[1]=f*n+d*s+v*c,r[2]=f*a+d*l+v*h,r[3]=p*i+g*o+m*u,r[4]=p*n+g*s+m*c,r[5]=p*a+g*l+m*h,r[6]=y*i+_*o+x*u,r[7]=y*n+_*s+x*c,r[8]=y*a+_*l+x*h,r}function HAt(r,t){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=t[0],r[7]=t[1],r[8]=1,r}function $At(r,t){var e=Math.sin(t),i=Math.cos(t);return r[0]=i,r[1]=e,r[2]=0,r[3]=-e,r[4]=i,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r}function WAt(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=t[1],r[5]=0,r[6]=0,r[7]=0,r[8]=1,r}function VAt(){var r=new am(3);return am!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function GAt(r,t,e){var i=t[0],n=t[1],a=t[2];return r[0]=i*e[0]+n*e[3]+a*e[6],r[1]=i*e[1]+n*e[4]+a*e[7],r[2]=i*e[2]+n*e[5]+a*e[8],r}(function(){var r=VAt();return function(t,e,i,n,a,o){var s,l;for(e||(e=3),i||(i=0),n?l=Math.min(n*e+i,t.length):l=t.length,s=i;s<l;s+=e)r[0]=t[s],r[1]=t[s+1],r[2]=t[s+2],a(r,r,o),t[s]=r[0],t[s+1]=r[1],t[s+2]=r[2];return t}})();function XAt(){var r=new am(2);return am!=Float32Array&&(r[0]=0,r[1]=0),r}function YAt(r,t){var e=t[0],i=t[1],n=e*e+i*i;return n>0&&(n=1/Math.sqrt(n)),r[0]=t[0]*n,r[1]=t[1]*n,r}function jAt(r,t){return r[0]*t[0]+r[1]*t[1]}function ZAt(r,t){return r[0]===t[0]&&r[1]===t[1]}(function(){var r=XAt();return function(t,e,i,n,a,o){var s,l;for(e||(e=2),i||(i=0),n?l=Math.min(n*e+i,t.length):l=t.length,s=i;s<l;s+=e)r[0]=t[s],r[1]=t[s+1],a(r,r,o),t[s]=r[0],t[s+1]=r[1];return t}})();function qAt(r,t,e){var i=[0,0,0,0,0,0,0,0,0];return HAt(i,e),Ny(r,i,t)}function KAt(r,t,e){var i=[0,0,0,0,0,0,0,0,0];return $At(i,e),Ny(r,i,t)}function QAt(r,t,e){var i=[0,0,0,0,0,0,0,0,0];return WAt(i,e),Ny(r,i,t)}function JAt(r,t,e){return Ny(r,e,t)}function rk(r,t){for(var e=r?[].concat(r):[1,0,0,0,1,0,0,0,1],i=0,n=t.length;i<n;i++){var a=t[i];switch(a[0]){case"t":qAt(e,e,[a[1],a[2]]);break;case"s":QAt(e,e,[a[1],a[2]]);break;case"r":KAt(e,e,a[1]);break;case"m":JAt(e,e,a[1]);break}}return e}function XL(r,t){var e=[],i=r[0],n=r[1],a=r[2],o=r[3],s=r[4],l=r[5],u=r[6],c=r[7],h=r[8],f=t[0],d=t[1],v=t[2],p=t[3],g=t[4],m=t[5],y=t[6],_=t[7],x=t[8];return e[0]=f*i+d*o+v*u,e[1]=f*n+d*s+v*c,e[2]=f*a+d*l+v*h,e[3]=p*i+g*o+m*u,e[4]=p*n+g*s+m*c,e[5]=p*a+g*l+m*h,e[6]=y*i+_*o+x*u,e[7]=y*n+_*s+x*c,e[8]=y*a+_*l+x*h,e}function Xl(r,t){var e=[],i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e}function ik(r){var t=[],e=r[0],i=r[1],n=r[2],a=r[3],o=r[4],s=r[5],l=r[6],u=r[7],c=r[8],h=c*o-s*u,f=-c*a+s*l,d=u*a-o*l,v=e*h+i*f+n*d;return v?(v=1/v,t[0]=h*v,t[1]=(-c*i+n*u)*v,t[2]=(s*i-n*o)*v,t[3]=f*v,t[4]=(c*e-n*l)*v,t[5]=(-s*e+n*a)*v,t[6]=d*v,t[7]=(-u*e+i*l)*v,t[8]=(o*e-i*a)*v,t):null}var Tf=rk,b1="matrix",tTt=["zIndex","capture","visible","type"],eTt=["repeat"],rTt=":",iTt="*";function nTt(r){for(var t=[],e=0;e<r.length;e++)na(r[e])?t.push([].concat(r[e])):t.push(r[e]);return t}function aTt(r,t){var e={},i=t.attrs;for(var n in r)e[n]=i[n];return e}function oTt(r,t){var e={},i=t.attr();return xe(r,function(n,a){eTt.indexOf(a)===-1&&!nm(i[a],n)&&(e[a]=n)}),e}function sTt(r,t){if(t.onFrame)return r;var e=t.startTime,i=t.delay,n=t.duration,a=Object.prototype.hasOwnProperty;return xe(r,function(o){e+i<o.startTime+o.delay+o.duration&&n>o.delay&&xe(t.toAttrs,function(s,l){a.call(o.toAttrs,l)&&(delete o.toAttrs[l],delete o.fromAttrs[l])})}),r}var nk=function(r){yt(t,r);function t(e){var i=r.call(this,e)||this;i.attrs={};var n=i.getDefaultAttrs();return j8(n,e.attrs),i.attrs=n,i.initAttrs(n),i.initAnimate(),i}return t.prototype.getDefaultCfg=function(){return{visible:!0,capture:!0,zIndex:0}},t.prototype.getDefaultAttrs=function(){return{matrix:this.getDefaultMatrix(),opacity:1}},t.prototype.onCanvasChange=function(e){},t.prototype.initAttrs=function(e){},t.prototype.initAnimate=function(){this.set("animable",!0),this.set("animating",!1)},t.prototype.isGroup=function(){return!1},t.prototype.getParent=function(){return this.get("parent")},t.prototype.getCanvas=function(){return this.get("canvas")},t.prototype.attr=function(){for(var e,i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];var a=i[0],o=i[1];if(!a)return this.attrs;if(ud(a)){for(var s in a)this.setAttr(s,a[s]);return this.afterAttrsChange(a),this}return i.length===2?(this.setAttr(a,o),this.afterAttrsChange((e={},e[a]=o,e)),this):this.attrs[a]},t.prototype.isClipped=function(e,i){var n=this.getClip();return n&&!n.isHit(e,i)},t.prototype.setAttr=function(e,i){var n=this.attrs[e];n!==i&&(this.attrs[e]=i,this.onAttrChange(e,i,n))},t.prototype.onAttrChange=function(e,i,n){e==="matrix"&&this.set("totalMatrix",null)},t.prototype.afterAttrsChange=function(e){if(this.cfg.isClipShape){var i=this.cfg.applyTo;i&&i.onCanvasChange("clip")}else this.onCanvasChange("attr")},t.prototype.show=function(){return this.set("visible",!0),this.onCanvasChange("show"),this},t.prototype.hide=function(){return this.set("visible",!1),this.onCanvasChange("hide"),this},t.prototype.setZIndex=function(e){this.set("zIndex",e);var i=this.getParent();return i&&i.sort(),this},t.prototype.toFront=function(){var e=this.getParent();if(e){var i=e.getChildren();this.get("el");var n=i.indexOf(this);i.splice(n,1),i.push(this),this.onCanvasChange("zIndex")}},t.prototype.toBack=function(){var e=this.getParent();if(e){var i=e.getChildren();this.get("el");var n=i.indexOf(this);i.splice(n,1),i.unshift(this),this.onCanvasChange("zIndex")}},t.prototype.remove=function(e){e===void 0&&(e=!0);var i=this.getParent();i?(tk(i.getChildren(),this),i.get("clearing")||this.onCanvasChange("remove")):this.onCanvasChange("remove"),e&&this.destroy()},t.prototype.resetMatrix=function(){this.attr(b1,this.getDefaultMatrix()),this.onCanvasChange("matrix")},t.prototype.getMatrix=function(){return this.attr(b1)},t.prototype.setMatrix=function(e){this.attr(b1,e),this.onCanvasChange("matrix")},t.prototype.getTotalMatrix=function(){var e=this.cfg.totalMatrix;if(!e){var i=this.attr("matrix"),n=this.cfg.parentMatrix;n&&i?e=XL(n,i):e=i||n,this.set("totalMatrix",e)}return e},t.prototype.applyMatrix=function(e){var i=this.attr("matrix"),n=null;e&&i?n=XL(e,i):n=i||e,this.set("totalMatrix",n),this.set("parentMatrix",e)},t.prototype.getDefaultMatrix=function(){return null},t.prototype.applyToMatrix=function(e){var i=this.attr("matrix");return i?Xl(i,e):e},t.prototype.invertFromMatrix=function(e){var i=this.attr("matrix");if(i){var n=ik(i);if(n)return Xl(n,e)}return e},t.prototype.setClip=function(e){var i=this.getCanvas(),n=null;if(e){var a=this.getShapeBase(),o=Y8(e.type),s=a[o];s&&(n=new s({type:e.type,isClipShape:!0,applyTo:this,attrs:e.attrs,canvas:i}))}return this.set("clipShape",n),this.onCanvasChange("clip"),n},t.prototype.getClip=function(){var e=this.cfg.clipShape;return e||null},t.prototype.clone=function(){var e=this,i=this.attrs,n={};xe(i,function(s,l){na(i[l])?n[l]=nTt(i[l]):n[l]=i[l]});var a=this.constructor,o=new a({attrs:n});return xe(tTt,function(s){o.set(s,e.get(s))}),o},t.prototype.destroy=function(){var e=this.destroyed;e||(this.attrs={},r.prototype.destroy.call(this))},t.prototype.isAnimatePaused=function(){return this.get("_pause").isPaused},t.prototype.animate=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];if(!(!this.get("timeline")&&!this.get("canvas"))){this.set("animating",!0);var n=this.get("timeline");n||(n=this.get("canvas").get("timeline"),this.set("timeline",n));var a=this.get("animations")||[];n.timer||n.initTimer();var o=e[0],s=e[1],l=e[2],u=l===void 0?"easeLinear":l,c=e[3],h=c===void 0?xg:c,f=e[4],d=f===void 0?0:f,v,p,g,m,y;Cu(o)?(v=o,o={}):ud(o)&&o.onFrame&&(v=o.onFrame,p=o.repeat),ud(s)?(y=s,s=y.duration,u=y.easing||"easeLinear",d=y.delay||0,p=y.repeat||p||!1,h=y.callback||xg,g=y.pauseCallback||xg,m=y.resumeCallback||xg):(TC(h)&&(d=h,h=null),Cu(u)?(h=u,u="easeLinear"):u=u||"easeLinear");var _=oTt(o,this),x={fromAttrs:aTt(_,this),toAttrs:_,duration:s,easing:u,repeat:p,callback:h,pauseCallback:g,resumeCallback:m,delay:d,startTime:n.getTime(),id:sAt(),onFrame:v,pathFormatted:!1};a.length>0?a=sTt(a,x):n.addAnimator(this),a.push(x),this.set("animations",a),this.set("_pause",{isPaused:!1})}},t.prototype.stopAnimate=function(e){var i=this;e===void 0&&(e=!0);var n=this.get("animations");xe(n,function(a){e&&(a.onFrame?i.attr(a.onFrame(1)):i.attr(a.toAttrs)),a.callback&&a.callback()}),this.set("animating",!1),this.set("animations",[])},t.prototype.pauseAnimate=function(){var e=this.get("timeline"),i=this.get("animations"),n=e.getTime();return xe(i,function(a){a._paused=!0,a._pauseTime=n,a.pauseCallback&&a.pauseCallback()}),this.set("_pause",{isPaused:!0,pauseTime:n}),this},t.prototype.resumeAnimate=function(){var e=this.get("timeline"),i=e.getTime(),n=this.get("animations"),a=this.get("_pause").pauseTime;return xe(n,function(o){o.startTime=o.startTime+(i-a),o._paused=!1,o._pauseTime=null,o.resumeCallback&&o.resumeCallback()}),this.set("_pause",{isPaused:!1}),this.set("animations",n),this},t.prototype.emitDelegation=function(e,i){var n=this,a=i.propagationPath;this.getEvents();var o;e==="mouseenter"?o=i.fromShape:e==="mouseleave"&&(o=i.toShape);for(var s=function(h){var f=a[h],d=f.get("name");if(d){if((f.isGroup()||f.isCanvas&&f.isCanvas())&&o&&ek(f,o))return"break";na(d)?xe(d,function(v){n.emitDelegateEvent(f,v,i)}):l.emitDelegateEvent(f,d,i)}},l=this,u=0;u<a.length;u++){var c=s(u);if(c==="break")break}},t.prototype.emitDelegateEvent=function(e,i,n){var a=this.getEvents(),o=i+rTt+n.type;(a[o]||a[iTt])&&(n.name=o,n.currentTarget=e,n.delegateTarget=this,n.delegateObject=e.get("delegateObject"),this.emit(o,n))},t.prototype.translate=function(e,i){e===void 0&&(e=0),i===void 0&&(i=0);var n=this.getMatrix(),a=Tf(n,[["t",e,i]]);return this.setMatrix(a),this},t.prototype.move=function(e,i){var n=this.attr("x")||0,a=this.attr("y")||0;return this.translate(e-n,i-a),this},t.prototype.moveTo=function(e,i){return this.move(e,i)},t.prototype.scale=function(e,i){var n=this.getMatrix(),a=Tf(n,[["s",e,i||e]]);return this.setMatrix(a),this},t.prototype.rotate=function(e){var i=this.getMatrix(),n=Tf(i,[["r",e]]);return this.setMatrix(n),this},t.prototype.rotateAtStart=function(e){var i=this.attr(),n=i.x,a=i.y,o=this.getMatrix(),s=Tf(o,[["t",-n,-a],["r",e],["t",n,a]]);return this.setMatrix(s),this},t.prototype.rotateAtPoint=function(e,i,n){var a=this.getMatrix(),o=Tf(a,[["t",-e,-i],["r",n],["t",e,i]]);return this.setMatrix(o),this},t}(wAt),YL={},OC="_INDEX";function ak(r,t){if(r.set("canvas",t),r.isGroup()){var e=r.get("children");e.length&&e.forEach(function(i){ak(i,t)})}}function ok(r,t){if(r.set("timeline",t),r.isGroup()){var e=r.get("children");e.length&&e.forEach(function(i){ok(i,t)})}}function lTt(r,t,e){e===void 0&&(e=!0),e?t.destroy():(t.set("parent",null),t.set("canvas",null)),tk(r.getChildren(),t)}function uTt(r){return function(t,e){var i=r(t,e);return i===0?t[OC]-e[OC]:i}}var sk=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.isCanvas=function(){return!1},t.prototype.getBBox=function(){var e=1/0,i=-1/0,n=1/0,a=-1/0,o=this.getChildren().filter(function(l){return l.get("visible")&&(!l.isGroup()||l.isGroup()&&l.getChildren().length>0)});o.length>0?xe(o,function(l){var u=l.getBBox(),c=u.minX,h=u.maxX,f=u.minY,d=u.maxY;c<e&&(e=c),h>i&&(i=h),f<n&&(n=f),d>a&&(a=d)}):(e=0,i=0,n=0,a=0);var s={x:e,y:n,minX:e,minY:n,maxX:i,maxY:a,width:i-e,height:a-n};return s},t.prototype.getCanvasBBox=function(){var e=1/0,i=-1/0,n=1/0,a=-1/0,o=this.getChildren().filter(function(l){return l.get("visible")&&(!l.isGroup()||l.isGroup()&&l.getChildren().length>0)});o.length>0?xe(o,function(l){var u=l.getCanvasBBox(),c=u.minX,h=u.maxX,f=u.minY,d=u.maxY;c<e&&(e=c),h>i&&(i=h),f<n&&(n=f),d>a&&(a=d)}):(e=0,i=0,n=0,a=0);var s={x:e,y:n,minX:e,minY:n,maxX:i,maxY:a,width:i-e,height:a-n};return s},t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return e.children=[],e},t.prototype.onAttrChange=function(e,i,n){if(r.prototype.onAttrChange.call(this,e,i,n),e==="matrix"){var a=this.getTotalMatrix();this._applyChildrenMarix(a)}},t.prototype.applyMatrix=function(e){var i=this.getTotalMatrix();r.prototype.applyMatrix.call(this,e);var n=this.getTotalMatrix();n!==i&&this._applyChildrenMarix(n)},t.prototype._applyChildrenMarix=function(e){var i=this.getChildren();xe(i,function(n){n.applyMatrix(e)})},t.prototype.addShape=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=e[0],a=e[1];ud(n)?a=n:a.type=n;var o=YL[a.type];o||(o=Y8(a.type),YL[a.type]=o);var s=this.getShapeBase(),l=new s[o](a);return this.add(l),l},t.prototype.addGroup=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=e[0],a=e[1],o;if(Cu(n))a?o=new n(a):o=new n({parent:this});else{var s=n||{},l=this.getGroupBase();o=new l(s)}return this.add(o),o},t.prototype.getCanvas=function(){var e;return this.isCanvas()?e=this:e=this.get("canvas"),e},t.prototype.getShape=function(e,i,n){if(!LC(this))return null;var a=this.getChildren(),o;if(this.isCanvas())o=this._findShape(a,e,i,n);else{var s=[e,i,1];s=this.invertFromMatrix(s),this.isClipped(s[0],s[1])||(o=this._findShape(a,s[0],s[1],n))}return o},t.prototype._findShape=function(e,i,n,a){for(var o=null,s=e.length-1;s>=0;s--){var l=e[s];if(LC(l)&&(l.isGroup()?o=l.getShape(i,n,a):l.isHit(i,n)&&(o=l)),o)break}return o},t.prototype.add=function(e){var i=this.getCanvas(),n=this.getChildren(),a=this.get("timeline"),o=e.getParent();o&&lTt(o,e,!1),e.set("parent",this),i&&ak(e,i),a&&ok(e,a),n.push(e),e.onCanvasChange("add"),this._applyElementMatrix(e)},t.prototype._applyElementMatrix=function(e){var i=this.getTotalMatrix();i&&e.applyMatrix(i)},t.prototype.getChildren=function(){return this.get("children")},t.prototype.sort=function(){var e=this.getChildren();xe(e,function(i,n){return i[OC]=n,i}),e.sort(uTt(function(i,n){return i.get("zIndex")-n.get("zIndex")})),this.onCanvasChange("sort")},t.prototype.clear=function(){if(this.set("clearing",!0),!this.destroyed){for(var e=this.getChildren(),i=e.length-1;i>=0;i--)e[i].destroy();this.set("children",[]),this.onCanvasChange("clear"),this.set("clearing",!1)}},t.prototype.destroy=function(){this.get("destroyed")||(this.clear(),r.prototype.destroy.call(this))},t.prototype.getFirst=function(){return this.getChildByIndex(0)},t.prototype.getLast=function(){var e=this.getChildren();return this.getChildByIndex(e.length-1)},t.prototype.getChildByIndex=function(e){var i=this.getChildren();return i[e]},t.prototype.getCount=function(){var e=this.getChildren();return e.length},t.prototype.contain=function(e){var i=this.getChildren();return i.indexOf(e)>-1},t.prototype.removeChild=function(e,i){i===void 0&&(i=!0),this.contain(e)&&e.remove(i)},t.prototype.findAll=function(e){var i=[],n=this.getChildren();return xe(n,function(a){e(a)&&i.push(a),a.isGroup()&&(i=i.concat(a.findAll(e)))}),i},t.prototype.find=function(e){var i=null,n=this.getChildren();return xe(n,function(a){if(e(a)?i=a:a.isGroup()&&(i=a.find(e)),i)return!1}),i},t.prototype.findById=function(e){return this.find(function(i){return i.get("id")===e})},t.prototype.findByClassName=function(e){return this.find(function(i){return i.get("className")===e})},t.prototype.findAllByName=function(e){return this.findAll(function(i){return i.get("name")===e})},t}(nk),fh=0,$f=0,bf=0,lk=1e3,om,Wf,sm=0,Eu=0,ky=0,Wd=typeof performance=="object"&&performance.now?performance:Date,uk=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(r){setTimeout(r,17)};function ck(){return Eu||(uk(cTt),Eu=Wd.now()+ky)}function cTt(){Eu=0}function PC(){this._call=this._time=this._next=null}PC.prototype=ST.prototype={constructor:PC,restart:function(r,t,e){if(typeof r!="function")throw new TypeError("callback is not a function");e=(e==null?ck():+e)+(t==null?0:+t),!this._next&&Wf!==this&&(Wf?Wf._next=this:om=this,Wf=this),this._call=r,this._time=e,FC()},stop:function(){this._call&&(this._call=null,this._time=1/0,FC())}};function ST(r,t,e){var i=new PC;return i.restart(r,t,e),i}function hTt(){ck(),++fh;for(var r=om,t;r;)(t=Eu-r._time)>=0&&r._call.call(null,t),r=r._next;--fh}function jL(){Eu=(sm=Wd.now())+ky,fh=$f=0;try{hTt()}finally{fh=0,dTt(),Eu=0}}function fTt(){var r=Wd.now(),t=r-sm;t>lk&&(ky-=t,sm=r)}function dTt(){for(var r,t=om,e,i=1/0;t;)t._call?(i>t._time&&(i=t._time),r=t,t=t._next):(e=t._next,t._next=null,t=r?r._next=e:om=e);Wf=r,FC(i)}function FC(r){if(!fh){$f&&($f=clearTimeout($f));var t=r-Eu;t>24?(r<1/0&&($f=setTimeout(jL,r-Wd.now()-ky)),bf&&(bf=clearInterval(bf))):(bf||(sm=Wd.now(),bf=setInterval(fTt,lk)),fh=1,uk(jL))}}function AT(r,t,e){r.prototype=t.prototype=e,e.constructor=r}function hk(r,t){var e=Object.create(r.prototype);for(var i in t)e[i]=t[i];return e}function Qv(){}var Vd=.7,lm=1/Vd,Uc="\\s*([+-]?\\d+)\\s*",Gd="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",go="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",vTt=/^#([0-9a-f]{3,8})$/,pTt=new RegExp(`^rgb\\(${Uc},${Uc},${Uc}\\)$`),gTt=new RegExp(`^rgb\\(${go},${go},${go}\\)$`),mTt=new RegExp(`^rgba\\(${Uc},${Uc},${Uc},${Gd}\\)$`),yTt=new RegExp(`^rgba\\(${go},${go},${go},${Gd}\\)$`),_Tt=new RegExp(`^hsl\\(${Gd},${go},${go}\\)$`),xTt=new RegExp(`^hsla\\(${Gd},${go},${go},${Gd}\\)$`),ZL={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};AT(Qv,Xd,{copy(r){return Object.assign(new this.constructor,this,r)},displayable(){return this.rgb().displayable()},hex:qL,formatHex:qL,formatHex8:CTt,formatHsl:ETt,formatRgb:KL,toString:KL});function qL(){return this.rgb().formatHex()}function CTt(){return this.rgb().formatHex8()}function ETt(){return fk(this).formatHsl()}function KL(){return this.rgb().formatRgb()}function Xd(r){var t,e;return r=(r+"").trim().toLowerCase(),(t=vTt.exec(r))?(e=t[1].length,t=parseInt(t[1],16),e===6?QL(t):e===3?new ji(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):e===8?Ag(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):e===4?Ag(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=pTt.exec(r))?new ji(t[1],t[2],t[3],1):(t=gTt.exec(r))?new ji(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=mTt.exec(r))?Ag(t[1],t[2],t[3],t[4]):(t=yTt.exec(r))?Ag(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=_Tt.exec(r))?eO(t[1],t[2]/100,t[3]/100,1):(t=xTt.exec(r))?eO(t[1],t[2]/100,t[3]/100,t[4]):ZL.hasOwnProperty(r)?QL(ZL[r]):r==="transparent"?new ji(NaN,NaN,NaN,0):null}function QL(r){return new ji(r>>16&255,r>>8&255,r&255,1)}function Ag(r,t,e,i){return i<=0&&(r=t=e=NaN),new ji(r,t,e,i)}function STt(r){return r instanceof Qv||(r=Xd(r)),r?(r=r.rgb(),new ji(r.r,r.g,r.b,r.opacity)):new ji}function BC(r,t,e,i){return arguments.length===1?STt(r):new ji(r,t,e,i??1)}function ji(r,t,e,i){this.r=+r,this.g=+t,this.b=+e,this.opacity=+i}AT(ji,BC,hk(Qv,{brighter(r){return r=r==null?lm:Math.pow(lm,r),new ji(this.r*r,this.g*r,this.b*r,this.opacity)},darker(r){return r=r==null?Vd:Math.pow(Vd,r),new ji(this.r*r,this.g*r,this.b*r,this.opacity)},rgb(){return this},clamp(){return new ji(au(this.r),au(this.g),au(this.b),um(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:JL,formatHex:JL,formatHex8:ATt,formatRgb:tO,toString:tO}));function JL(){return`#${Yl(this.r)}${Yl(this.g)}${Yl(this.b)}`}function ATt(){return`#${Yl(this.r)}${Yl(this.g)}${Yl(this.b)}${Yl((isNaN(this.opacity)?1:this.opacity)*255)}`}function tO(){const r=um(this.opacity);return`${r===1?"rgb(":"rgba("}${au(this.r)}, ${au(this.g)}, ${au(this.b)}${r===1?")":`, ${r})`}`}function um(r){return isNaN(r)?1:Math.max(0,Math.min(1,r))}function au(r){return Math.max(0,Math.min(255,Math.round(r)||0))}function Yl(r){return r=au(r),(r<16?"0":"")+r.toString(16)}function eO(r,t,e,i){return i<=0?r=t=e=NaN:e<=0||e>=1?r=t=NaN:t<=0&&(r=NaN),new Ca(r,t,e,i)}function fk(r){if(r instanceof Ca)return new Ca(r.h,r.s,r.l,r.opacity);if(r instanceof Qv||(r=Xd(r)),!r)return new Ca;if(r instanceof Ca)return r;r=r.rgb();var t=r.r/255,e=r.g/255,i=r.b/255,n=Math.min(t,e,i),a=Math.max(t,e,i),o=NaN,s=a-n,l=(a+n)/2;return s?(t===a?o=(e-i)/s+(e<i)*6:e===a?o=(i-t)/s+2:o=(t-e)/s+4,s/=l<.5?a+n:2-a-n,o*=60):s=l>0&&l<1?0:o,new Ca(o,s,l,r.opacity)}function TTt(r,t,e,i){return arguments.length===1?fk(r):new Ca(r,t,e,i??1)}function Ca(r,t,e,i){this.h=+r,this.s=+t,this.l=+e,this.opacity=+i}AT(Ca,TTt,hk(Qv,{brighter(r){return r=r==null?lm:Math.pow(lm,r),new Ca(this.h,this.s,this.l*r,this.opacity)},darker(r){return r=r==null?Vd:Math.pow(Vd,r),new Ca(this.h,this.s,this.l*r,this.opacity)},rgb(){var r=this.h%360+(this.h<0)*360,t=isNaN(r)||isNaN(this.s)?0:this.s,e=this.l,i=e+(e<.5?e:1-e)*t,n=2*e-i;return new ji(w1(r>=240?r-240:r+120,n,i),w1(r,n,i),w1(r<120?r+240:r-120,n,i),this.opacity)},clamp(){return new Ca(rO(this.h),Tg(this.s),Tg(this.l),um(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const r=um(this.opacity);return`${r===1?"hsl(":"hsla("}${rO(this.h)}, ${Tg(this.s)*100}%, ${Tg(this.l)*100}%${r===1?")":`, ${r})`}`}}));function rO(r){return r=(r||0)%360,r<0?r+360:r}function Tg(r){return Math.max(0,Math.min(1,r||0))}function w1(r,t,e){return(r<60?t+(e-t)*r/60:r<180?e:r<240?t+(e-t)*(240-r)/60:t)*255}var TT=r=>()=>r;function bTt(r,t){return function(e){return r+e*t}}function wTt(r,t,e){return r=Math.pow(r,e),t=Math.pow(t,e)-r,e=1/e,function(i){return Math.pow(r+i*t,e)}}function RTt(r){return(r=+r)==1?dk:function(t,e){return e-t?wTt(t,e,r):TT(isNaN(t)?e:t)}}function dk(r,t){var e=t-r;return e?bTt(r,e):TT(isNaN(r)?t:r)}var iO=function r(t){var e=RTt(t);function i(n,a){var o=e((n=BC(n)).r,(a=BC(a)).r),s=e(n.g,a.g),l=e(n.b,a.b),u=dk(n.opacity,a.opacity);return function(c){return n.r=o(c),n.g=s(c),n.b=l(c),n.opacity=u(c),n+""}}return i.gamma=r,i}(1);function vk(r,t){t||(t=[]);var e=r?Math.min(t.length,r.length):0,i=t.slice(),n;return function(a){for(n=0;n<e;++n)i[n]=r[n]*(1-a)+t[n]*a;return i}}function pk(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function MTt(r,t){return(pk(t)?vk:gk)(r,t)}function gk(r,t){var e=t?t.length:0,i=r?Math.min(e,r.length):0,n=new Array(i),a=new Array(e),o;for(o=0;o<i;++o)n[o]=cm(r[o],t[o]);for(;o<e;++o)a[o]=t[o];return function(s){for(o=0;o<i;++o)a[o]=n[o](s);return a}}function ITt(r,t){var e=new Date;return r=+r,t=+t,function(i){return e.setTime(r*(1-i)+t*i),e}}function DC(r,t){return r=+r,t=+t,function(e){return r*(1-e)+t*e}}function LTt(r,t){var e={},i={},n;(r===null||typeof r!="object")&&(r={}),(t===null||typeof t!="object")&&(t={});for(n in t)n in r?e[n]=cm(r[n],t[n]):i[n]=t[n];return function(a){for(n in e)i[n]=e[n](a);return i}}var NC=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,R1=new RegExp(NC.source,"g");function OTt(r){return function(){return r}}function PTt(r){return function(t){return r(t)+""}}function FTt(r,t){var e=NC.lastIndex=R1.lastIndex=0,i,n,a,o=-1,s=[],l=[];for(r=r+"",t=t+"";(i=NC.exec(r))&&(n=R1.exec(t));)(a=n.index)>e&&(a=t.slice(e,a),s[o]?s[o]+=a:s[++o]=a),(i=i[0])===(n=n[0])?s[o]?s[o]+=n:s[++o]=n:(s[++o]=null,l.push({i:o,x:DC(i,n)})),e=R1.lastIndex;return e<t.length&&(a=t.slice(e),s[o]?s[o]+=a:s[++o]=a),s.length<2?l[0]?PTt(l[0].x):OTt(t):(t=l.length,function(u){for(var c=0,h;c<t;++c)s[(h=l[c]).i]=h.x(u);return s.join("")})}function cm(r,t){var e=typeof t,i;return t==null||e==="boolean"?TT(t):(e==="number"?DC:e==="string"?(i=Xd(t))?(t=i,iO):FTt:t instanceof Xd?iO:t instanceof Date?ITt:pk(t)?vk:Array.isArray(t)?gk:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?LTt:DC)(r,t)}function BTt(r){return+r}function DTt(r){return r*r}function NTt(r){return r*(2-r)}function nO(r){return((r*=2)<=1?r*r:--r*(2-r)+1)/2}function mk(r){return r*r*r}function kTt(r){return--r*r*r+1}function aO(r){return((r*=2)<=1?r*r*r:(r-=2)*r*r+2)/2}var bT=3,UTt=function r(t){t=+t;function e(i){return Math.pow(i,t)}return e.exponent=r,e}(bT),zTt=function r(t){t=+t;function e(i){return 1-Math.pow(1-i,t)}return e.exponent=r,e}(bT),oO=function r(t){t=+t;function e(i){return((i*=2)<=1?Math.pow(i,t):2-Math.pow(2-i,t))/2}return e.exponent=r,e}(bT),yk=Math.PI,_k=yk/2;function HTt(r){return+r==1?1:1-Math.cos(r*_k)}function $Tt(r){return Math.sin(r*_k)}function sO(r){return(1-Math.cos(yk*r))/2}function nl(r){return(Math.pow(2,-10*r)-.0009765625)*1.0009775171065494}function WTt(r){return nl(1-+r)}function VTt(r){return 1-nl(r)}function lO(r){return((r*=2)<=1?nl(1-r):2-nl(r-1))/2}function GTt(r){return 1-Math.sqrt(1-r*r)}function XTt(r){return Math.sqrt(1- --r*r)}function uO(r){return((r*=2)<=1?1-Math.sqrt(1-r*r):Math.sqrt(1-(r-=2)*r)+1)/2}var kC=4/11,YTt=6/11,jTt=8/11,ZTt=3/4,qTt=9/11,KTt=10/11,QTt=15/16,JTt=21/22,tbt=63/64,bg=1/kC/kC;function ebt(r){return 1-Yd(1-r)}function Yd(r){return(r=+r)<kC?bg*r*r:r<jTt?bg*(r-=YTt)*r+ZTt:r<KTt?bg*(r-=qTt)*r+QTt:bg*(r-=JTt)*r+tbt}function rbt(r){return((r*=2)<=1?1-Yd(1-r):Yd(r-1)+1)/2}var wT=1.70158,ibt=function r(t){t=+t;function e(i){return(i=+i)*i*(t*(i-1)+i)}return e.overshoot=r,e}(wT),nbt=function r(t){t=+t;function e(i){return--i*i*((i+1)*t+i)+1}return e.overshoot=r,e}(wT),cO=function r(t){t=+t;function e(i){return((i*=2)<1?i*i*((t+1)*i-t):(i-=2)*i*((t+1)*i+t)+2)/2}return e.overshoot=r,e}(wT),dh=2*Math.PI,RT=1,MT=.3,abt=function r(t,e){var i=Math.asin(1/(t=Math.max(1,t)))*(e/=dh);function n(a){return t*nl(- --a)*Math.sin((i-a)/e)}return n.amplitude=function(a){return r(a,e*dh)},n.period=function(a){return r(t,a)},n}(RT,MT),hO=function r(t,e){var i=Math.asin(1/(t=Math.max(1,t)))*(e/=dh);function n(a){return 1-t*nl(a=+a)*Math.sin((a+i)/e)}return n.amplitude=function(a){return r(a,e*dh)},n.period=function(a){return r(t,a)},n}(RT,MT),obt=function r(t,e){var i=Math.asin(1/(t=Math.max(1,t)))*(e/=dh);function n(a){return((a=a*2-1)<0?t*nl(-a)*Math.sin((i-a)/e):2-t*nl(a)*Math.sin((i+a)/e))/2}return n.amplitude=function(a){return r(a,e*dh)},n.period=function(a){return r(t,a)},n}(RT,MT),sbt=Object.freeze({__proto__:null,easeLinear:BTt,easeQuad:nO,easeQuadIn:DTt,easeQuadOut:NTt,easeQuadInOut:nO,easeCubic:aO,easeCubicIn:mk,easeCubicOut:kTt,easeCubicInOut:aO,easePoly:oO,easePolyIn:UTt,easePolyOut:zTt,easePolyInOut:oO,easeSin:sO,easeSinIn:HTt,easeSinOut:$Tt,easeSinInOut:sO,easeExp:lO,easeExpIn:WTt,easeExpOut:VTt,easeExpInOut:lO,easeCircle:uO,easeCircleIn:GTt,easeCircleOut:XTt,easeCircleInOut:uO,easeBounce:Yd,easeBounceIn:ebt,easeBounceOut:Yd,easeBounceInOut:rbt,easeBack:cO,easeBackIn:ibt,easeBackOut:nbt,easeBackInOut:cO,easeElastic:hO,easeElasticIn:abt,easeElasticOut:hO,easeElasticInOut:obt}),lbt={};function ubt(r){return lbt[r.toLowerCase()]||sbt[r]}var cbt=function(r){return["fill","stroke","fillStyle","strokeStyle"].includes(r)},hbt=function(r){return/^[r,R,L,l]{1}[\s]*\(/.test(r)},fO=[1,0,0,0,1,0,0,0,1];function fbt(r,t,e){var i={},n=t.fromAttrs,a=t.toAttrs;if(!r.destroyed){var o;for(var s in a)if(!nm(n[s],a[s]))if(s==="path"){var l=a[s],u=n[s];l.length>u.length?(l=Ac(a[s]),u=Ac(n[s]),u=Q8(u,l),u=IC(u,l),t.fromAttrs.path=u,t.toAttrs.path=l):t.pathFormatted||(l=Ac(a[s]),u=Ac(n[s]),u=IC(u,l),t.fromAttrs.path=u,t.toAttrs.path=l,t.pathFormatted=!0),i[s]=[];for(var c=0;c<l.length;c++){for(var h=l[c],f=u[c],d=[],v=0;v<h.length;v++)TC(h[v])&&f&&TC(f[v])?(o=cm(f[v],h[v]),d.push(o(e))):d.push(h[v]);i[s].push(d)}}else if(s==="matrix"){var p=MTt(n[s]||fO,a[s]||fO),g=p(e);i[s]=g}else cbt(s)&&hbt(a[s])?i[s]=a[s]:Cu(a[s])||(o=cm(n[s],a[s]),i[s]=o(e));r.attr(i)}}function dbt(r,t,e){var i=t.startTime,n=t.delay;if(e<i+n||t._paused)return!1;var a,o=t.duration,s=t.easing,l=ubt(s);if(e=e-i-t.delay,t.repeat)a=e%o/o,a=l(a);else if(a=e/o,a<1)a=l(a);else return t.onFrame?r.attr(t.onFrame(1)):r.attr(t.toAttrs),!0;if(t.onFrame){var u=t.onFrame(a);r.attr(u)}else fbt(r,t,a);return!1}var vbt=function(){function r(t){this.animators=[],this.current=0,this.timer=null,this.canvas=t}return r.prototype.initTimer=function(){var t=this,e=!1,i,n,a;this.timer=ST(function(o){if(t.current=o,t.animators.length>0){for(var s=t.animators.length-1;s>=0;s--){if(i=t.animators[s],i.destroyed){t.removeAnimator(s);continue}if(!i.isAnimatePaused()){n=i.get("animations");for(var l=n.length-1;l>=0;l--)a=n[l],e=dbt(i,a,o),e&&(n.splice(l,1),e=!1,a.callback&&a.callback())}n.length===0&&t.removeAnimator(s)}var u=t.canvas.get("autoDraw");u||t.canvas.draw()}})},r.prototype.addAnimator=function(t){this.animators.push(t)},r.prototype.removeAnimator=function(t){this.animators.splice(t,1)},r.prototype.isAnimating=function(){return!!this.animators.length},r.prototype.stop=function(){this.timer&&this.timer.stop()},r.prototype.stopAllAnimations=function(t){t===void 0&&(t=!0),this.animators.forEach(function(e){e.stopAnimate(t)}),this.animators=[],this.canvas.draw()},r.prototype.getTime=function(){return this.current},r}(),pbt=40,dO=0,vO=["mousedown","mouseup","dblclick","mouseout","mouseover","mousemove","mouseleave","mouseenter","touchstart","touchmove","touchend","dragenter","dragover","dragleave","drop","contextmenu","mousewheel"];function pO(r,t,e){e.name=t,e.target=r,e.currentTarget=r,e.delegateTarget=r,r.emit(t,e)}function gbt(r,t,e){if(e.bubbles){var i=void 0,n=!1;if(t==="mouseenter"?(i=e.fromShape,n=!0):t==="mouseleave"&&(n=!0,i=e.toShape),r.isCanvas()&&n)return;if(i&&ek(r,i)){e.bubbles=!1;return}e.name=t,e.currentTarget=r,e.delegateTarget=r,r.emit(t,e)}}var mbt=function(){function r(t){var e=this;this.draggingShape=null,this.dragging=!1,this.currentShape=null,this.mousedownShape=null,this.mousedownPoint=null,this._eventCallback=function(i){var n=i.type;e._triggerEvent(n,i)},this._onDocumentMove=function(i){var n=e.canvas,a=n.get("el");if(a!==i.target&&(e.dragging||e.currentShape)){var o=e._getPointInfo(i);e.dragging&&e._emitEvent("drag",i,o,e.draggingShape)}},this._onDocumentMouseUp=function(i){var n=e.canvas,a=n.get("el");if(a!==i.target&&e.dragging){var o=e._getPointInfo(i);e.draggingShape&&e._emitEvent("drop",i,o,null),e._emitEvent("dragend",i,o,e.draggingShape),e._afterDrag(e.draggingShape,o,i)}},this.canvas=t.canvas}return r.prototype.init=function(){this._bindEvents()},r.prototype._bindEvents=function(){var t=this,e=this.canvas.get("el");xe(vO,function(i){e.addEventListener(i,t._eventCallback)}),document&&(document.addEventListener("mousemove",this._onDocumentMove),document.addEventListener("mouseup",this._onDocumentMouseUp))},r.prototype._clearEvents=function(){var t=this,e=this.canvas.get("el");xe(vO,function(i){e.removeEventListener(i,t._eventCallback)}),document&&(document.removeEventListener("mousemove",this._onDocumentMove),document.removeEventListener("mouseup",this._onDocumentMouseUp))},r.prototype._getEventObj=function(t,e,i,n,a,o){var s=new TAt(t,e);return s.fromShape=a,s.toShape=o,s.x=i.x,s.y=i.y,s.clientX=i.clientX,s.clientY=i.clientY,s.propagationPath.push(n),s},r.prototype._getShape=function(t,e){return this.canvas.getShape(t.x,t.y,e)},r.prototype._getPointInfo=function(t){var e=this.canvas,i=e.getClientByEvent(t),n=e.getPointByEvent(t);return{x:n.x,y:n.y,clientX:i.x,clientY:i.y}},r.prototype._triggerEvent=function(t,e){var i=this._getPointInfo(e),n=this._getShape(i,e),a=this["_on"+t],o=!1;if(a)a.call(this,i,n,e);else{var s=this.currentShape;t==="mouseenter"||t==="dragenter"||t==="mouseover"?(this._emitEvent(t,e,i,null,null,n),n&&this._emitEvent(t,e,i,n,null,n),t==="mouseenter"&&this.draggingShape&&this._emitEvent("dragenter",e,i,null)):t==="mouseleave"||t==="dragleave"||t==="mouseout"?(o=!0,s&&this._emitEvent(t,e,i,s,s,null),this._emitEvent(t,e,i,null,s,null),t==="mouseleave"&&this.draggingShape&&this._emitEvent("dragleave",e,i,null)):this._emitEvent(t,e,i,n,null,null)}if(o||(this.currentShape=n),n&&!n.get("destroyed")){var l=this.canvas,u=l.get("el");u.style.cursor=n.attr("cursor")||l.get("cursor")}},r.prototype._onmousedown=function(t,e,i){i.button===dO&&(this.mousedownShape=e,this.mousedownPoint=t,this.mousedownTimeStamp=i.timeStamp),this._emitEvent("mousedown",i,t,e,null,null)},r.prototype._emitMouseoverEvents=function(t,e,i,n){var a=this.canvas.get("el");i!==n&&(i&&(this._emitEvent("mouseout",t,e,i,i,n),this._emitEvent("mouseleave",t,e,i,i,n),(!n||n.get("destroyed"))&&(a.style.cursor=this.canvas.get("cursor"))),n&&(this._emitEvent("mouseover",t,e,n,i,n),this._emitEvent("mouseenter",t,e,n,i,n)))},r.prototype._emitDragoverEvents=function(t,e,i,n,a){n?(n!==i&&(i&&this._emitEvent("dragleave",t,e,i,i,n),this._emitEvent("dragenter",t,e,n,i,n)),a||this._emitEvent("dragover",t,e,n)):i&&this._emitEvent("dragleave",t,e,i,i,n),a&&this._emitEvent("dragover",t,e,n)},r.prototype._afterDrag=function(t,e,i){t&&(t.set("capture",!0),this.draggingShape=null),this.dragging=!1;var n=this._getShape(e,i);n!==t&&this._emitMouseoverEvents(i,e,t,n),this.currentShape=n},r.prototype._onmouseup=function(t,e,i){if(i.button===dO){var n=this.draggingShape;this.dragging?(n&&this._emitEvent("drop",i,t,e),this._emitEvent("dragend",i,t,n),this._afterDrag(n,t,i)):(this._emitEvent("mouseup",i,t,e),e===this.mousedownShape&&this._emitEvent("click",i,t,e),this.mousedownShape=null,this.mousedownPoint=null)}},r.prototype._ondragover=function(t,e,i){i.preventDefault();var n=this.currentShape;this._emitDragoverEvents(i,t,n,e,!0)},r.prototype._onmousemove=function(t,e,i){var n=this.canvas,a=this.currentShape,o=this.draggingShape;if(this.dragging)o&&this._emitDragoverEvents(i,t,a,e,!1),this._emitEvent("drag",i,t,o);else{var s=this.mousedownPoint;if(s){var l=this.mousedownShape,u=i.timeStamp,c=u-this.mousedownTimeStamp,h=s.clientX-t.clientX,f=s.clientY-t.clientY,d=h*h+f*f;c>120||d>pbt?l&&l.get("draggable")?(o=this.mousedownShape,o.set("capture",!1),this.draggingShape=o,this.dragging=!0,this._emitEvent("dragstart",i,t,o),this.mousedownShape=null,this.mousedownPoint=null):!l&&n.get("draggable")?(this.dragging=!0,this._emitEvent("dragstart",i,t,null),this.mousedownShape=null,this.mousedownPoint=null):(this._emitMouseoverEvents(i,t,a,e),this._emitEvent("mousemove",i,t,e)):(this._emitMouseoverEvents(i,t,a,e),this._emitEvent("mousemove",i,t,e))}else this._emitMouseoverEvents(i,t,a,e),this._emitEvent("mousemove",i,t,e)}},r.prototype._emitEvent=function(t,e,i,n,a,o){var s=this._getEventObj(t,e,i,n,a,o);if(n){s.shape=n,pO(n,t,s);for(var l=n.getParent();l;)l.emitDelegation(t,s),s.propagationStopped||gbt(l,t,s),s.propagationPath.push(l),l=l.getParent()}else{var u=this.canvas;pO(u,t,s)}},r.prototype.destroy=function(){this._clearEvents(),this.canvas=null,this.currentShape=null,this.draggingShape=null,this.mousedownPoint=null,this.mousedownShape=null,this.mousedownTimeStamp=null},r}(),gO="px",mO=DAt(),ybt=mO&&mO.name==="firefox",_bt=function(r){yt(t,r);function t(e){var i=r.call(this,e)||this;return i.initContainer(),i.initDom(),i.initEvents(),i.initTimeline(),i}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return e.cursor="default",e.supportCSSTransform=!1,e},t.prototype.initContainer=function(){var e=this.get("container");Da(e)&&(e=document.getElementById(e),this.set("container",e))},t.prototype.initDom=function(){var e=this.createDom();this.set("el",e);var i=this.get("container");i.appendChild(e),this.setDOMSize(this.get("width"),this.get("height"))},t.prototype.initEvents=function(){var e=new mbt({canvas:this});e.init(),this.set("eventController",e)},t.prototype.initTimeline=function(){var e=new vbt(this);this.set("timeline",e)},t.prototype.setDOMSize=function(e,i){var n=this.get("el");HL&&(n.style.width=e+gO,n.style.height=i+gO)},t.prototype.changeSize=function(e,i){this.setDOMSize(e,i),this.set("width",e),this.set("height",i),this.onCanvasChange("changeSize")},t.prototype.getRenderer=function(){return this.get("renderer")},t.prototype.getCursor=function(){return this.get("cursor")},t.prototype.setCursor=function(e){this.set("cursor",e);var i=this.get("el");HL&&i&&(i.style.cursor=e)},t.prototype.getPointByEvent=function(e){var i=this.get("supportCSSTransform");if(i){if(ybt&&!Ir(e.layerX)&&e.layerX!==e.offsetX)return{x:e.layerX,y:e.layerY};if(!Ir(e.offsetX))return{x:e.offsetX,y:e.offsetY}}var n=this.getClientByEvent(e),a=n.x,o=n.y;return this.getPointByClient(a,o)},t.prototype.getClientByEvent=function(e){var i=e;return e.touches&&(e.type==="touchend"?i=e.changedTouches[0]:i=e.touches[0]),{x:i.clientX,y:i.clientY}},t.prototype.getPointByClient=function(e,i){var n=this.get("el"),a=n.getBoundingClientRect();return{x:e-a.left,y:i-a.top}},t.prototype.getClientByPoint=function(e,i){var n=this.get("el"),a=n.getBoundingClientRect();return{x:e+a.left,y:i+a.top}},t.prototype.draw=function(){},t.prototype.removeDom=function(){var e=this.get("el");e.parentNode.removeChild(e)},t.prototype.clearEvents=function(){var e=this.get("eventController");e.destroy()},t.prototype.isCanvas=function(){return!0},t.prototype.getParent=function(){return null},t.prototype.destroy=function(){var e=this.get("timeline");this.get("destroyed")||(this.clear(),e&&e.stop(),this.clearEvents(),this.removeDom(),r.prototype.destroy.call(this))},t}(sk),xbt=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.isGroup=function(){return!0},t.prototype.isEntityGroup=function(){return!1},t.prototype.clone=function(){for(var e=r.prototype.clone.call(this),i=this.getChildren(),n=0;n<i.length;n++){var a=i[n];e.add(a.clone())}return e},t}(sk),Cbt=function(r){yt(t,r);function t(e){return r.call(this,e)||this}return t.prototype._isInBBox=function(e,i){var n=this.getBBox();return n.minX<=e&&n.maxX>=e&&n.minY<=i&&n.maxY>=i},t.prototype.afterAttrsChange=function(e){r.prototype.afterAttrsChange.call(this,e),this.clearCacheBBox()},t.prototype.getBBox=function(){var e=this.cfg.bbox;return e||(e=this.calculateBBox(),this.set("bbox",e)),e},t.prototype.getCanvasBBox=function(){var e=this.cfg.canvasBBox;return e||(e=this.calculateCanvasBBox(),this.set("canvasBBox",e)),e},t.prototype.applyMatrix=function(e){r.prototype.applyMatrix.call(this,e),this.set("canvasBBox",null)},t.prototype.calculateCanvasBBox=function(){var e=this.getBBox(),i=this.getTotalMatrix(),n=e.minX,a=e.minY,o=e.maxX,s=e.maxY;if(i){var l=Xl(i,[e.minX,e.minY]),u=Xl(i,[e.maxX,e.minY]),c=Xl(i,[e.minX,e.maxY]),h=Xl(i,[e.maxX,e.maxY]);n=Math.min(l[0],u[0],c[0],h[0]),o=Math.max(l[0],u[0],c[0],h[0]),a=Math.min(l[1],u[1],c[1],h[1]),s=Math.max(l[1],u[1],c[1],h[1])}var f=this.attrs;if(f.shadowColor){var d=f.shadowBlur,v=d===void 0?0:d,p=f.shadowOffsetX,g=p===void 0?0:p,m=f.shadowOffsetY,y=m===void 0?0:m,_=n-v+g,x=o+v+g,C=a-v+y,A=s+v+y;n=Math.min(n,_),o=Math.max(o,x),a=Math.min(a,C),s=Math.max(s,A)}return{x:n,y:a,minX:n,minY:a,maxX:o,maxY:s,width:o-n,height:s-a}},t.prototype.clearCacheBBox=function(){this.set("bbox",null),this.set("canvasBBox",null)},t.prototype.isClipShape=function(){return this.get("isClipShape")},t.prototype.isInShape=function(e,i){return!1},t.prototype.isOnlyHitBox=function(){return!1},t.prototype.isHit=function(e,i){var n=this.get("startArrowShape"),a=this.get("endArrowShape"),o=[e,i,1];o=this.invertFromMatrix(o);var s=o[0],l=o[1],u=this._isInBBox(s,l);return this.isOnlyHitBox()?u:!!(u&&!this.isClipped(s,l)&&(this.isInShape(s,l)||n&&n.isHit(s,l)||a&&a.isHit(s,l)))},t}(nk),xk=new Map;function Ro(r,t){xk.set(r,t)}function Ebt(r){return xk.get(r)}function Ck(r){var t=r.attr(),e=t.x,i=t.y,n=t.width,a=t.height;return{x:e,y:i,width:n,height:a}}function Ek(r){var t=r.attr(),e=t.x,i=t.y,n=t.r;return{x:e-n,y:i-n,width:n*2,height:n*2}}function fi(r,t,e,i){var n=r-e,a=t-i;return Math.sqrt(n*n+a*a)}function l0(r,t){return Math.abs(r-t)<.001}function Uh(r,t){var e=il(r),i=il(t),n=rl(r),a=rl(t);return{x:e,y:i,width:n-e,height:a-i}}function Uy(r){return(r+Math.PI*2)%(Math.PI*2)}var Yi={box:function(r,t,e,i){return Uh([r,e],[t,i])},length:function(r,t,e,i){return fi(r,t,e,i)},pointAt:function(r,t,e,i,n){return{x:(1-n)*r+n*e,y:(1-n)*t+n*i}},pointDistance:function(r,t,e,i,n,a){var o=(e-r)*(n-r)+(i-t)*(a-t);if(o<0)return fi(r,t,n,a);var s=(e-r)*(e-r)+(i-t)*(i-t);return o>s?fi(e,i,n,a):this.pointToLine(r,t,e,i,n,a)},pointToLine:function(r,t,e,i,n,a){var o=[e-r,i-t];if(ZAt(o,[0,0]))return Math.sqrt((n-r)*(n-r)+(a-t)*(a-t));var s=[-o[1],o[0]];YAt(s,s);var l=[n-r,a-t];return Math.abs(jAt(l,s))},tangentAngle:function(r,t,e,i){return Math.atan2(i-t,e-r)}},Sbt=1e-4;function Sk(r,t,e,i,n,a){var o,s=1/0,l=[e,i],u=20;a&&a>200&&(u=a/10);for(var c=1/u,h=c/10,f=0;f<=u;f++){var d=f*c,v=[n.apply(null,r.concat([d])),n.apply(null,t.concat([d]))],p=fi(l[0],l[1],v[0],v[1]);p<s&&(o=d,s=p)}if(o===0)return{x:r[0],y:t[0]};if(o===1){var g=r.length;return{x:r[g-1],y:t[g-1]}}s=1/0;for(var f=0;f<32&&!(h<Sbt);f++){var m=o-h,y=o+h,v=[n.apply(null,r.concat([m])),n.apply(null,t.concat([m]))],p=fi(l[0],l[1],v[0],v[1]);if(m>=0&&p<s)o=m,s=p;else{var _=[n.apply(null,r.concat([y])),n.apply(null,t.concat([y]))],x=fi(l[0],l[1],_[0],_[1]);y<=1&&x<s?(o=y,s=x):h*=.5}}return{x:n.apply(null,r.concat([o])),y:n.apply(null,t.concat([o]))}}function Abt(r,t){for(var e=0,i=r.length,n=0;n<i;n++){var a=r[n],o=t[n],s=r[(n+1)%i],l=t[(n+1)%i];e+=fi(a,o,s,l)}return e/2}function Ps(r,t,e,i){var n=1-i;return n*n*r+2*i*n*t+i*i*e}function yO(r,t,e){var i=r+e-2*t;if(l0(i,0))return[.5];var n=(r-t)/i;return n<=1&&n>=0?[n]:[]}function _O(r,t,e,i){return 2*(1-i)*(t-r)+2*i*(e-t)}function Ak(r,t,e,i,n,a,o){var s=Ps(r,e,n,o),l=Ps(t,i,a,o),u=Yi.pointAt(r,t,e,i,o),c=Yi.pointAt(e,i,n,a,o);return[[r,t,u.x,u.y,s,l],[s,l,c.x,c.y,n,a]]}function UC(r,t,e,i,n,a,o){if(o===0)return(fi(r,t,e,i)+fi(e,i,n,a)+fi(r,t,n,a))/2;var s=Ak(r,t,e,i,n,a,.5),l=s[0],u=s[1];return l.push(o-1),u.push(o-1),UC.apply(null,l)+UC.apply(null,u)}var Tk={box:function(r,t,e,i,n,a){var o=yO(r,e,n)[0],s=yO(t,i,a)[0],l=[r,n],u=[t,a];return o!==void 0&&l.push(Ps(r,e,n,o)),s!==void 0&&u.push(Ps(t,i,a,s)),Uh(l,u)},length:function(r,t,e,i,n,a){return UC(r,t,e,i,n,a,3)},nearestPoint:function(r,t,e,i,n,a,o,s){return Sk([r,e,n],[t,i,a],o,s,Ps)},pointDistance:function(r,t,e,i,n,a,o,s){var l=this.nearestPoint(r,t,e,i,n,a,o,s);return fi(l.x,l.y,o,s)},interpolationAt:Ps,pointAt:function(r,t,e,i,n,a,o){return{x:Ps(r,e,n,o),y:Ps(t,i,a,o)}},divide:function(r,t,e,i,n,a,o){return Ak(r,t,e,i,n,a,o)},tangentAngle:function(r,t,e,i,n,a,o){var s=_O(r,e,n,o),l=_O(t,i,a,o),u=Math.atan2(l,s);return Uy(u)}};function Fs(r,t,e,i,n){var a=1-n;return a*a*a*r+3*t*n*a*a+3*e*n*n*a+i*n*n*n}function xO(r,t,e,i,n){var a=1-n;return 3*(a*a*(t-r)+2*a*n*(e-t)+n*n*(i-e))}function M1(r,t,e,i){var n=-3*r+9*t-9*e+3*i,a=6*r-12*t+6*e,o=3*t-3*r,s=[],l,u,c;if(l0(n,0))l0(a,0)||(l=-o/a,l>=0&&l<=1&&s.push(l));else{var h=a*a-4*n*o;l0(h,0)?s.push(-a/(2*n)):h>0&&(c=Math.sqrt(h),l=(-a+c)/(2*n),u=(-a-c)/(2*n),l>=0&&l<=1&&s.push(l),u>=0&&u<=1&&s.push(u))}return s}function bk(r,t,e,i,n,a,o,s,l){var u=Fs(r,e,n,o,l),c=Fs(t,i,a,s,l),h=Yi.pointAt(r,t,e,i,l),f=Yi.pointAt(e,i,n,a,l),d=Yi.pointAt(n,a,o,s,l),v=Yi.pointAt(h.x,h.y,f.x,f.y,l),p=Yi.pointAt(f.x,f.y,d.x,d.y,l);return[[r,t,h.x,h.y,v.x,v.y,u,c],[u,c,p.x,p.y,d.x,d.y,o,s]]}function zC(r,t,e,i,n,a,o,s,l){if(l===0)return Abt([r,e,n,o],[t,i,a,s]);var u=bk(r,t,e,i,n,a,o,s,.5),c=u[0],h=u[1];return c.push(l-1),h.push(l-1),zC.apply(null,c)+zC.apply(null,h)}var hd={extrema:M1,box:function(r,t,e,i,n,a,o,s){for(var l=[r,o],u=[t,s],c=M1(r,e,n,o),h=M1(t,i,a,s),f=0;f<c.length;f++)l.push(Fs(r,e,n,o,c[f]));for(var f=0;f<h.length;f++)u.push(Fs(t,i,a,s,h[f]));return Uh(l,u)},length:function(r,t,e,i,n,a,o,s){return zC(r,t,e,i,n,a,o,s,3)},nearestPoint:function(r,t,e,i,n,a,o,s,l,u,c){return Sk([r,e,n,o],[t,i,a,s],l,u,Fs,c)},pointDistance:function(r,t,e,i,n,a,o,s,l,u,c){var h=this.nearestPoint(r,t,e,i,n,a,o,s,l,u,c);return fi(h.x,h.y,l,u)},interpolationAt:Fs,pointAt:function(r,t,e,i,n,a,o,s,l){return{x:Fs(r,e,n,o,l),y:Fs(t,i,a,s,l)}},divide:function(r,t,e,i,n,a,o,s,l){return bk(r,t,e,i,n,a,o,s,l)},tangentAngle:function(r,t,e,i,n,a,o,s,l){var u=xO(r,e,n,o,l),c=xO(t,i,a,s,l);return Uy(Math.atan2(c,u))}};function CO(r,t){var e=Math.abs(r);return t>0?e:e*-1}var Tbt={box:function(r,t,e,i){return{x:r-e,y:t-i,width:e*2,height:i*2}},length:function(r,t,e,i){return Math.PI*(3*(e+i)-Math.sqrt((3*e+i)*(e+3*i)))},nearestPoint:function(r,t,e,i,n,a){var o=e,s=i;if(o===0||s===0)return{x:r,y:t};for(var l=n-r,u=a-t,c=Math.abs(l),h=Math.abs(u),f=o*o,d=s*s,v=Math.PI/4,p,g,m=0;m<4;m++){p=o*Math.cos(v),g=s*Math.sin(v);var y=(f-d)*Math.pow(Math.cos(v),3)/o,_=(d-f)*Math.pow(Math.sin(v),3)/s,x=p-y,C=g-_,A=c-y,b=h-_,R=Math.hypot(C,x),M=Math.hypot(b,A),O=R*Math.asin((x*b-C*A)/(R*M)),F=O/Math.sqrt(f+d-p*p-g*g);v+=F,v=Math.min(Math.PI/2,Math.max(0,v))}return{x:r+CO(p,l),y:t+CO(g,u)}},pointDistance:function(r,t,e,i,n,a){var o=this.nearestPoint(r,t,e,i,n,a);return fi(o.x,o.y,n,a)},pointAt:function(r,t,e,i,n){var a=2*Math.PI*n;return{x:r+e*Math.cos(a),y:t+i*Math.sin(a)}},tangentAngle:function(r,t,e,i,n){var a=2*Math.PI*n,o=Math.atan2(i*Math.cos(a),-e*Math.sin(a));return Uy(o)}};function bbt(r,t,e,i,n,a,o,s){return-1*e*Math.cos(n)*Math.sin(s)-i*Math.sin(n)*Math.cos(s)}function wbt(r,t,e,i,n,a,o,s){return-1*e*Math.sin(n)*Math.sin(s)+i*Math.cos(n)*Math.cos(s)}function Rbt(r,t,e){return Math.atan(-t/r*Math.tan(e))}function Mbt(r,t,e){return Math.atan(t/(r*Math.tan(e)))}function EO(r,t,e,i,n,a){return e*Math.cos(n)*Math.cos(a)-i*Math.sin(n)*Math.sin(a)+r}function SO(r,t,e,i,n,a){return e*Math.sin(n)*Math.cos(a)+i*Math.cos(n)*Math.sin(a)+t}function Ibt(r,t,e,i){var n=Math.atan2(i*r,e*t);return(n+Math.PI*2)%(Math.PI*2)}function AO(r,t,e){return{x:r*Math.cos(e),y:t*Math.sin(e)}}function TO(r,t,e){var i=Math.cos(e),n=Math.sin(e);return[r*i-t*n,r*n+t*i]}var Lbt={box:function(r,t,e,i,n,a,o){for(var s=Rbt(e,i,n),l=1/0,u=-1/0,c=[a,o],h=-Math.PI*2;h<=Math.PI*2;h+=Math.PI){var f=s+h;a<o?a<f&&f<o&&c.push(f):o<f&&f<a&&c.push(f)}for(var h=0;h<c.length;h++){var d=EO(r,t,e,i,n,c[h]);d<l&&(l=d),d>u&&(u=d)}for(var v=Mbt(e,i,n),p=1/0,g=-1/0,m=[a,o],h=-Math.PI*2;h<=Math.PI*2;h+=Math.PI){var y=v+h;a<o?a<y&&y<o&&m.push(y):o<y&&y<a&&m.push(y)}for(var h=0;h<m.length;h++){var _=SO(r,t,e,i,n,m[h]);_<p&&(p=_),_>g&&(g=_)}return{x:l,y:p,width:u-l,height:g-p}},length:function(r,t,e,i,n,a,o){},nearestPoint:function(r,t,e,i,n,a,o,s,l){var u=TO(s-r,l-t,-n),c=u[0],h=u[1],f=Tbt.nearestPoint(0,0,e,i,c,h),d=Ibt(e,i,f.x,f.y);d<a?f=AO(e,i,a):d>o&&(f=AO(e,i,o));var v=TO(f.x,f.y,n);return{x:v[0]+r,y:v[1]+t}},pointDistance:function(r,t,e,i,n,a,o,s,l){var u=this.nearestPoint(r,t,e,i,s,l);return fi(u.x,u.y,s,l)},pointAt:function(r,t,e,i,n,a,o,s){var l=(o-a)*s+a;return{x:EO(r,t,e,i,n,l),y:SO(r,t,e,i,n,l)}},tangentAngle:function(r,t,e,i,n,a,o,s){var l=(o-a)*s+a,u=bbt(r,t,e,i,n,a,o,l),c=wbt(r,t,e,i,n,a,o,l);return Uy(Math.atan2(c,u))}};function wk(r){for(var t=0,e=[],i=0;i<r.length-1;i++){var n=r[i],a=r[i+1],o=fi(n[0],n[1],a[0],a[1]),s={from:n,to:a,length:o};e.push(s),t+=o}return{segments:e,totalLength:t}}function Obt(r){if(r.length<2)return 0;for(var t=0,e=0;e<r.length-1;e++){var i=r[e],n=r[e+1];t+=fi(i[0],i[1],n[0],n[1])}return t}function Pbt(r,t){if(t>1||t<0||r.length<2)return null;var e=wk(r),i=e.segments,n=e.totalLength;if(n===0)return{x:r[0][0],y:r[0][1]};for(var a=0,o=null,s=0;s<i.length;s++){var l=i[s],u=l.from,c=l.to,h=l.length/n;if(t>=a&&t<=a+h){var f=(t-a)/h;o=Yi.pointAt(u[0],u[1],c[0],c[1],f);break}a+=h}return o}function Fbt(r,t){if(t>1||t<0||r.length<2)return 0;for(var e=wk(r),i=e.segments,n=e.totalLength,a=0,o=0,s=0;s<i.length;s++){var l=i[s],u=l.from,c=l.to,h=l.length/n;if(t>=a&&t<=a+h){o=Math.atan2(c[1]-u[1],c[0]-u[0]);break}a+=h}return o}function Bbt(r,t,e){for(var i=1/0,n=0;n<r.length-1;n++){var a=r[n],o=r[n+1],s=Yi.pointDistance(a[0],a[1],o[0],o[1],t,e);s<i&&(i=s)}return i}var Dbt={box:function(r){for(var t=[],e=[],i=0;i<r.length;i++){var n=r[i];t.push(n[0]),e.push(n[1])}return Uh(t,e)},length:function(r){return Obt(r)},pointAt:function(r,t){return Pbt(r,t)},pointDistance:function(r,t,e){return Bbt(r,t,e)},tangentAngle:function(r,t){return Fbt(r,t)}};function bO(r,t){return!r||!t?r||t:{minX:Math.min(r.minX,t.minX),minY:Math.min(r.minY,t.minY),maxX:Math.max(r.maxX,t.maxX),maxY:Math.max(r.maxY,t.maxY)}}function IT(r,t){var e=r.get("startArrowShape"),i=r.get("endArrowShape"),n=null,a=null;return e&&(n=e.getCanvasBBox(),t=bO(t,n)),i&&(a=i.getCanvasBBox(),t=bO(t,a)),t}function Nbt(r){for(var t=r.attr(),e=t.points,i=[],n=[],a=0;a<e.length;a++){var o=e[a];i.push(o[0]),n.push(o[1])}var s=Uh(i,n),l=s.x,u=s.y,c=s.width,h=s.height,f={minX:l,minY:u,maxX:l+c,maxY:u+h};return f=IT(r,f),{x:f.minX,y:f.minY,width:f.maxX-f.minX,height:f.maxY-f.minY}}function kbt(r){for(var t=r.attr(),e=t.points,i=[],n=[],a=0;a<e.length;a++){var o=e[a];i.push(o[0]),n.push(o[1])}return Uh(i,n)}var I1=null;function Rk(){if(!I1){var r=document.createElement("canvas");r.width=1,r.height=1,I1=r.getContext("2d")}return I1}function Mk(r,t,e){var i=1;if(Da(r)&&(i=r.split(`
`).length),i>1){var n=Ubt(t,e);return t*i+n*(i-1)}return t}function Ubt(r,t){return t?t-r:r*.14}function zbt(r,t){var e=Rk(),i=0;if(Ir(r)||r==="")return i;if(e.save(),e.font=t,Da(r)&&r.includes(`
`)){var n=r.split(`
`);xe(n,function(a){var o=e.measureText(a).width;i<o&&(i=o)})}else i=e.measureText(r).width;return e.restore(),i}function Ik(r){var t=r.fontSize,e=r.fontFamily,i=r.fontWeight,n=r.fontStyle,a=r.fontVariant;return[n,a,i,t+"px",e].join(" ").trim()}function Hbt(r){var t=r.attr(),e=t.x,i=t.y,n=t.text,a=t.fontSize,o=t.lineHeight,s=t.font;s||(s=Ik(t));var l=zbt(n,s),u;if(!l)u={x:e,y:i,width:0,height:0};else{var c=t.textAlign,h=t.textBaseline,f=Mk(n,a,o),d={x:e,y:i-f};c&&(c==="end"||c==="right"?d.x-=l:c==="center"&&(d.x-=l/2)),h&&(h==="top"?d.y+=f:h==="middle"&&(d.y+=f/2)),u={x:d.x,y:d.y,width:l,height:f}}return u}var $bt=/[MLHVQTCSAZ]([^MLHVQTCSAZ]*)/ig,Wbt=/[^\s\,]+/ig;function Vbt(r){var t=r||[];if(na(t))return t;if(Da(t))return t=t.match($bt),xe(t,function(e,i){if(e=e.match(Wbt),e[0].length>1){var n=e[0].charAt(0);e.splice(1,0,e[0].substr(1)),e[0]=n}xe(e,function(a,o){isNaN(a)||(e[o]=+a)}),t[i]=e}),t}var fd=`	
\v\f\r   ᠎             　\u2028\u2029`,Gbt=new RegExp("([a-z])["+fd+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+fd+"]*,?["+fd+"]*)+)","ig"),Xbt=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+fd+"]*,?["+fd+"]*","ig");function Ybt(r){if(!r)return null;if(na(r))return r;var t={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},e=[];return String(r).replace(Gbt,function(i,n,a){var o=[],s=n.toLowerCase();if(a.replace(Xbt,function(l,u){u&&o.push(+u)}),s==="m"&&o.length>2&&(e.push([n].concat(o.splice(0,2))),s="l",n=n==="m"?"l":"L"),s==="o"&&o.length===1&&e.push([n,o[0]]),s==="r")e.push([n].concat(o));else for(;o.length>=t[s]&&(e.push([n].concat(o.splice(0,t[s]))),!!t[s]););return""}),e}var jbt=/[a-z]/;function wO(r,t){return[t[0]+(t[0]-r[0]),t[1]+(t[1]-r[1])]}function Lk(r){var t=Ybt(r);if(!t||!t.length)return[["M",0,0]];for(var e=!1,i=0;i<t.length;i++){var n=t[i][0];if(jbt.test(n)||["V","H","T","S"].indexOf(n)>=0){e=!0;break}}if(!e)return t;var a=[],o=0,s=0,l=0,u=0,c=0,h=t[0];(h[0]==="M"||h[0]==="m")&&(o=+h[1],s=+h[2],l=o,u=s,c++,a[0]=["M",o,s]);for(var i=c,f=t.length;i<f;i++){var d=t[i],v=a[i-1],p=[],n=d[0],g=n.toUpperCase();if(n!==g)switch(p[0]=g,g){case"A":p[1]=d[1],p[2]=d[2],p[3]=d[3],p[4]=d[4],p[5]=d[5],p[6]=+d[6]+o,p[7]=+d[7]+s;break;case"V":p[1]=+d[1]+s;break;case"H":p[1]=+d[1]+o;break;case"M":l=+d[1]+o,u=+d[2]+s,p[1]=l,p[2]=u;break;default:for(var m=1,y=d.length;m<y;m++)p[m]=+d[m]+(m%2?o:s)}else p=t[i];switch(g){case"Z":o=+l,s=+u;break;case"H":o=p[1],p=["L",o,s];break;case"V":s=p[1],p=["L",o,s];break;case"T":o=p[1],s=p[2];var _=wO([v[1],v[2]],[v[3],v[4]]);p=["Q",_[0],_[1],o,s];break;case"S":o=p[p.length-2],s=p[p.length-1];var x=v.length,C=wO([v[x-4],v[x-3]],[v[x-2],v[x-1]]);p=["C",C[0],C[1],p[1],p[2],o,s];break;case"M":l=p[p.length-2],u=p[p.length-1];break;default:o=p[p.length-2],s=p[p.length-1]}a.push(p)}return a}function wg(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function HC(r,t){return wg(r)*wg(t)?(r[0]*t[0]+r[1]*t[1])/(wg(r)*wg(t)):1}function RO(r,t){return(r[0]*t[1]<r[1]*t[0]?-1:1)*Math.acos(HC(r,t))}function $C(r,t){return r[0]===t[0]&&r[1]===t[1]}function Zbt(r,t){var e=t[1],i=t[2],n=G8(X8(t[3]),Math.PI*2),a=t[4],o=t[5],s=r[0],l=r[1],u=t[6],c=t[7],h=Math.cos(n)*(s-u)/2+Math.sin(n)*(l-c)/2,f=-1*Math.sin(n)*(s-u)/2+Math.cos(n)*(l-c)/2,d=h*h/(e*e)+f*f/(i*i);d>1&&(e*=Math.sqrt(d),i*=Math.sqrt(d));var v=e*e*(f*f)+i*i*(h*h),p=v?Math.sqrt((e*e*(i*i)-v)/v):1;a===o&&(p*=-1),isNaN(p)&&(p=0);var g=i?p*e*f/i:0,m=e?p*-i*h/e:0,y=(s+u)/2+Math.cos(n)*g-Math.sin(n)*m,_=(l+c)/2+Math.sin(n)*g+Math.cos(n)*m,x=[(h-g)/e,(f-m)/i],C=[(-1*h-g)/e,(-1*f-m)/i],A=RO([1,0],x),b=RO(x,C);return HC(x,C)<=-1&&(b=Math.PI),HC(x,C)>=1&&(b=0),o===0&&b>0&&(b=b-2*Math.PI),o===1&&b<0&&(b=b+2*Math.PI),{cx:y,cy:_,rx:$C(r,[u,c])?0:e,ry:$C(r,[u,c])?0:i,startAngle:A,endAngle:A+b,xRotation:n,arcFlag:a,sweepFlag:o}}function MO(r,t){return[t[0]+(t[0]-r[0]),t[1]+(t[1]-r[1])]}function Ok(r){r=Vbt(r);for(var t=[],e=null,i=null,n=null,a=0,o=r.length,s=0;s<o;s++){var l=r[s];i=r[s+1];var u=l[0],c={command:u,prePoint:e,params:l,startTangent:null,endTangent:null};switch(u){case"M":n=[l[1],l[2]],a=s;break;case"A":var h=Zbt(e,l);c.arcParams=h;break}if(u==="Z")e=n,i=r[a+1];else{var f=l.length;e=[l[f-2],l[f-1]]}i&&i[0]==="Z"&&(i=r[a],t[a]&&(t[a].prePoint=e)),c.currentPoint=e,t[a]&&$C(e,t[a].currentPoint)&&(t[a].prePoint=c.prePoint);var d=i?[i[i.length-2],i[i.length-1]]:null;c.nextPoint=d;var v=c.prePoint;if(["L","H","V"].includes(u))c.startTangent=[v[0]-e[0],v[1]-e[1]],c.endTangent=[e[0]-v[0],e[1]-v[1]];else if(u==="Q"){var p=[l[1],l[2]];c.startTangent=[v[0]-p[0],v[1]-p[1]],c.endTangent=[e[0]-p[0],e[1]-p[1]]}else if(u==="T"){var g=t[s-1],p=MO(g.currentPoint,v);g.command==="Q"?(c.command="Q",c.startTangent=[v[0]-p[0],v[1]-p[1]],c.endTangent=[e[0]-p[0],e[1]-p[1]]):(c.command="TL",c.startTangent=[v[0]-e[0],v[1]-e[1]],c.endTangent=[e[0]-v[0],e[1]-v[1]])}else if(u==="C"){var m=[l[1],l[2]],y=[l[3],l[4]];c.startTangent=[v[0]-m[0],v[1]-m[1]],c.endTangent=[e[0]-y[0],e[1]-y[1]],c.startTangent[0]===0&&c.startTangent[1]===0&&(c.startTangent=[m[0]-y[0],m[1]-y[1]]),c.endTangent[0]===0&&c.endTangent[1]===0&&(c.endTangent=[y[0]-m[0],y[1]-m[1]])}else if(u==="S"){var g=t[s-1],m=MO(g.currentPoint,v),y=[l[1],l[2]];g.command==="C"?(c.command="C",c.startTangent=[v[0]-m[0],v[1]-m[1]],c.endTangent=[e[0]-y[0],e[1]-y[1]]):(c.command="SQ",c.startTangent=[v[0]-y[0],v[1]-y[1]],c.endTangent=[e[0]-y[0],e[1]-y[1]])}else if(u==="A"){var _=.001,x=c.arcParams||{},C=x.cx,A=C===void 0?0:C,b=x.cy,R=b===void 0?0:b,M=x.rx,O=M===void 0?0:M,F=x.ry,D=F===void 0?0:F,H=x.sweepFlag,j=H===void 0?0:H,$=x.startAngle,k=$===void 0?0:$,V=x.endAngle,Q=V===void 0?0:V;j===0&&(_*=-1);var Y=O*Math.cos(k-_)+A,tt=D*Math.sin(k-_)+R;c.startTangent=[Y-n[0],tt-n[1]];var et=O*Math.cos(k+Q+_)+A,dt=D*Math.sin(k+Q-_)+R;c.endTangent=[v[0]-et,v[1]-dt]}t.push(c)}return t}function qbt(r,t){for(var e=[],i=[],n=[],a=0;a<r.length;a++){var o=r[a],s=o.currentPoint,l=o.params,u=o.prePoint,c=void 0;switch(o.command){case"Q":c=Tk.box(u[0],u[1],l[1],l[2],l[3],l[4]);break;case"C":c=hd.box(u[0],u[1],l[1],l[2],l[3],l[4],l[5],l[6]);break;case"A":var h=o.arcParams;c=Lbt.box(h.cx,h.cy,h.rx,h.ry,h.xRotation,h.startAngle,h.endAngle);break;default:e.push(s[0]),i.push(s[1]);break}c&&(o.box=c,e.push(c.x,c.x+c.width),i.push(c.y,c.y+c.height)),t&&(o.command==="L"||o.command==="M")&&o.prePoint&&o.nextPoint&&n.push(o)}e=e.filter(function(m){return!Number.isNaN(m)&&m!==1/0&&m!==-1/0}),i=i.filter(function(m){return!Number.isNaN(m)&&m!==1/0&&m!==-1/0});var f=il(e),d=il(i),v=rl(e),p=rl(i);if(n.length===0)return{x:f,y:d,width:v-f,height:p-d};for(var a=0;a<n.length;a++){var o=n[a],s=o.currentPoint,g=void 0;s[0]===f?(g=Rg(o,t),f=f-g.xExtra):s[0]===v&&(g=Rg(o,t),v=v+g.xExtra),s[1]===d?(g=Rg(o,t),d=d-g.yExtra):s[1]===p&&(g=Rg(o,t),p=p+g.yExtra)}return{x:f,y:d,width:v-f,height:p-d}}function Rg(r,t){var e=r.prePoint,i=r.currentPoint,n=r.nextPoint,a=Math.pow(i[0]-e[0],2)+Math.pow(i[1]-e[1],2),o=Math.pow(i[0]-n[0],2)+Math.pow(i[1]-n[1],2),s=Math.pow(e[0]-n[0],2)+Math.pow(e[1]-n[1],2),l=Math.acos((a+o-s)/(2*Math.sqrt(a)*Math.sqrt(o)));if(!l||Math.sin(l)===0||tAt(l,0))return{xExtra:0,yExtra:0};var u=Math.abs(Math.atan2(n[1]-i[1],n[0]-i[0])),c=Math.abs(Math.atan2(n[0]-i[0],n[1]-i[1]));u=u>Math.PI/2?Math.PI-u:u,c=c>Math.PI/2?Math.PI-c:c;var h={xExtra:Math.cos(l/2-u)*(t/2*(1/Math.sin(l/2)))-t/2||0,yExtra:Math.cos(c-l/2)*(t/2*(1/Math.sin(l/2)))-t/2||0};return h}function Kbt(r){var t=r.attr(),e=t.path,i=t.stroke,n=i?t.lineWidth:0,a=r.get("segments")||Ok(e),o=qbt(a,n),s=o.x,l=o.y,u=o.width,c=o.height,h={minX:s,minY:l,maxX:s+u,maxY:l+c};return h=IT(r,h),{x:h.minX,y:h.minY,width:h.maxX-h.minX,height:h.maxY-h.minY}}function Qbt(r){var t=r.attr(),e=t.x1,i=t.y1,n=t.x2,a=t.y2,o=Math.min(e,n),s=Math.max(e,n),l=Math.min(i,a),u=Math.max(i,a),c={minX:o,maxX:s,minY:l,maxY:u};return c=IT(r,c),{x:c.minX,y:c.minY,width:c.maxX-c.minX,height:c.maxY-c.minY}}function Jbt(r){var t=r.attr(),e=t.x,i=t.y,n=t.rx,a=t.ry;return{x:e-n,y:i-a,width:n*2,height:a*2}}Ro("rect",Ck);Ro("image",Ck);Ro("circle",Ek);Ro("marker",Ek);Ro("polyline",Nbt);Ro("polygon",kbt);Ro("text",Hbt);Ro("path",Kbt);Ro("line",Qbt);Ro("ellipse",Jbt);function t2t(){return window?window.devicePixelRatio:1}function Pk(r,t,e,i){var n=r-e,a=t-i;return Math.sqrt(n*n+a*a)}function jl(r,t,e,i,n,a){return n>=r&&n<=r+e&&a>=t&&a<=t+i}function jd(r,t){return!(t.minX>r.maxX||t.maxX<r.minX||t.minY>r.maxY||t.maxY<r.minY)}function e2t(r,t){return!r||!t?r||t:{minX:Math.min(r.minX,t.minX),minY:Math.min(r.minY,t.minY),maxX:Math.max(r.maxX,t.maxX),maxY:Math.max(r.maxY,t.maxY)}}function IO(r,t){return r[0]===t[0]&&r[1]===t[1]}var r2t=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,i2t=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,n2t=/^p\s*\(\s*([axyn])\s*\)\s*(.*)/i,Fk=/[\d.]+:(#[^\s]+|[^\)]+\))/gi;function Bk(r,t){var e=r.match(Fk);xe(e,function(i){var n=i.split(":");t.addColorStop(n[0],n[1])})}function a2t(r,t,e){var i=r2t.exec(e),n=parseFloat(i[1])%360*(Math.PI/180),a=i[2],o=t.getBBox(),s,l;n>=0&&n<1/2*Math.PI?(s={x:o.minX,y:o.minY},l={x:o.maxX,y:o.maxY}):1/2*Math.PI<=n&&n<Math.PI?(s={x:o.maxX,y:o.minY},l={x:o.minX,y:o.maxY}):Math.PI<=n&&n<3/2*Math.PI?(s={x:o.maxX,y:o.maxY},l={x:o.minX,y:o.minY}):(s={x:o.minX,y:o.maxY},l={x:o.maxX,y:o.minY});var u=Math.tan(n),c=u*u,h=(l.x-s.x+u*(l.y-s.y))/(c+1)+s.x,f=u*(l.x-s.x+u*(l.y-s.y))/(c+1)+s.y,d=r.createLinearGradient(s.x,s.y,h,f);return Bk(a,d),d}function o2t(r,t,e){var i=i2t.exec(e),n=parseFloat(i[1]),a=parseFloat(i[2]),o=parseFloat(i[3]),s=i[4];if(o===0){var l=s.match(Fk);return l[l.length-1].split(":")[1]}var u=t.getBBox(),c=u.maxX-u.minX,h=u.maxY-u.minY,f=Math.sqrt(c*c+h*h)/2,d=r.createRadialGradient(u.minX+c*n,u.minY+h*a,0,u.minX+c/2,u.minY+h/2,o*f);return Bk(s,d),d}function s2t(r,t,e){if(t.get("patternSource")&&t.get("patternSource")===e)return t.get("pattern");var i,n,a=n2t.exec(e),o=a[1],s=a[2];function l(){i=r.createPattern(n,o),t.set("pattern",i),t.set("patternSource",e)}switch(o){case"a":o="repeat";break;case"x":o="repeat-x";break;case"y":o="repeat-y";break;case"n":o="no-repeat";break;default:o="no-repeat"}return n=new Image,s.match(/^data:/i)||(n.crossOrigin="Anonymous"),n.src=s,n.complete?l():(n.onload=l,n.src=n.src),i}function l2t(r,t,e){var i=t.getBBox();if(isNaN(i.x)||isNaN(i.y)||isNaN(i.width)||isNaN(i.height))return e;if(Da(e)){if(e[1]==="("||e[2]==="("){if(e[0]==="l")return a2t(r,t,e);if(e[0]==="r")return o2t(r,t,e);if(e[0]==="p")return s2t(r,t,e)}return e}if(e instanceof CanvasPattern)return e}function u2t(r){var t=0,e=0,i=0,n=0;return na(r)?r.length===1?t=e=i=n=r[0]:r.length===2?(t=i=r[0],e=n=r[1]):r.length===3?(t=r[0],e=n=r[1],i=r[2]):(t=r[0],e=r[1],i=r[2],n=r[3]):t=e=i=n=r,[t,e,i,n]}function Mg(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function WC(r,t){return Mg(r)*Mg(t)?(r[0]*t[0]+r[1]*t[1])/(Mg(r)*Mg(t)):1}function LO(r,t){return(r[0]*t[1]<r[1]*t[0]?-1:1)*Math.acos(WC(r,t))}function OO(r,t){var e=t[1],i=t[2],n=G8(X8(t[3]),Math.PI*2),a=t[4],o=t[5],s=r[0],l=r[1],u=t[6],c=t[7],h=Math.cos(n)*(s-u)/2+Math.sin(n)*(l-c)/2,f=-1*Math.sin(n)*(s-u)/2+Math.cos(n)*(l-c)/2,d=h*h/(e*e)+f*f/(i*i);d>1&&(e*=Math.sqrt(d),i*=Math.sqrt(d));var v=e*e*(f*f)+i*i*(h*h),p=v?Math.sqrt((e*e*(i*i)-v)/v):1;a===o&&(p*=-1),isNaN(p)&&(p=0);var g=i?p*e*f/i:0,m=e?p*-i*h/e:0,y=(s+u)/2+Math.cos(n)*g-Math.sin(n)*m,_=(l+c)/2+Math.sin(n)*g+Math.cos(n)*m,x=[(h-g)/e,(f-m)/i],C=[(-1*h-g)/e,(-1*f-m)/i],A=LO([1,0],x),b=LO(x,C);return WC(x,C)<=-1&&(b=Math.PI),WC(x,C)>=1&&(b=0),o===0&&b>0&&(b=b-2*Math.PI),o===1&&b<0&&(b=b+2*Math.PI),{cx:y,cy:_,rx:IO(r,[u,c])?0:e,ry:IO(r,[u,c])?0:i,startAngle:A,endAngle:A+b,xRotation:n,arcFlag:a,sweepFlag:o}}var hm=Math.sin,fm=Math.cos,LT=Math.atan2,Ig=Math.PI;function Dk(r,t,e,i,n,a,o){var s=t.stroke,l=t.lineWidth,u=e-n,c=i-a,h=LT(c,u),f=new DT({type:"path",canvas:r.get("canvas"),isArrowShape:!0,attrs:{path:"M"+10*fm(Ig/6)+","+10*hm(Ig/6)+" L0,0 L"+10*fm(Ig/6)+",-"+10*hm(Ig/6),stroke:s,lineWidth:l}});f.translate(n,a),f.rotateAtPoint(n,a,h),r.set(o?"startArrowShape":"endArrowShape",f)}function Nk(r,t,e,i,n,a,o){var s=t.startArrow,l=t.endArrow,u=t.stroke,c=t.lineWidth,h=o?s:l,f=h.d,d=h.fill,v=h.stroke,p=h.lineWidth,g=Fy(h,["d","fill","stroke","lineWidth"]),m=e-n,y=i-a,_=LT(y,m);f&&(n=n-fm(_)*f,a=a-hm(_)*f);var x=new DT({type:"path",canvas:r.get("canvas"),isArrowShape:!0,attrs:U(U({},g),{stroke:v||u,lineWidth:p||c,fill:d})});x.translate(n,a),x.rotateAtPoint(n,a,_),r.set(o?"startArrowShape":"endArrowShape",x)}function ou(r,t,e,i,n){var a=LT(i-t,e-r);return{dx:fm(a)*n,dy:hm(a)*n}}function OT(r,t,e,i,n,a){typeof t.startArrow=="object"?Nk(r,t,e,i,n,a,!0):t.startArrow?Dk(r,t,e,i,n,a,!0):r.set("startArrowShape",null)}function PT(r,t,e,i,n,a){typeof t.endArrow=="object"?Nk(r,t,e,i,n,a,!1):t.endArrow?Dk(r,t,e,i,n,a,!1):r.set("startArrowShape",null)}var PO={fill:"fillStyle",stroke:"strokeStyle",opacity:"globalAlpha"};function vh(r,t){var e=t.attr();for(var i in e){var n=e[i],a=PO[i]?PO[i]:i;a==="matrix"&&n?r.transform(n[0],n[1],n[3],n[4],n[6],n[7]):a==="lineDash"&&r.setLineDash?na(n)&&r.setLineDash(n):(a==="strokeStyle"||a==="fillStyle"?n=l2t(r,t,n):a==="globalAlpha"&&(n=n*r.globalAlpha),r[a]=n)}}function VC(r,t,e){for(var i=0;i<t.length;i++){var n=t[i];n.cfg.visible?n.draw(r,e):n.skipDraw()}}function c2t(r,t,e){var i=r.get("refreshElements");xe(i,function(n){if(n!==r)for(var a=n.cfg.parent;a&&a!==r&&!a.cfg.refresh;)a.cfg.refresh=!0,a=a.cfg.parent}),i[0]===r?FT(t):GC(t,e)}function GC(r,t){for(var e=0;e<r.length;e++){var i=r[e];if(i.cfg.visible)if(i.cfg.hasChanged)i.cfg.refresh=!0,i.isGroup()&&FT(i.cfg.children);else if(i.cfg.refresh)i.isGroup()&&GC(i.cfg.children,t);else{var n=h2t(i,t);i.cfg.refresh=n,n&&i.isGroup()&&GC(i.cfg.children,t)}}}function kk(r){for(var t=0;t<r.length;t++){var e=r[t];e.cfg.hasChanged=!1,e.isGroup()&&!e.destroyed&&kk(e.cfg.children)}}function FT(r,t){for(var e=0;e<r.length;e++){var i=r[e];i.cfg.visible&&(i.cfg.refresh=!0,i.isGroup()&&FT(i.get("children")))}}function h2t(r,t){var e=r.cfg.cacheCanvasBBox,i=r.cfg.isInView&&e&&jd(e,t);return i}function Uk(r,t,e,i){var n=e.path,a=e.startArrow,o=e.endArrow;if(n){var s=[0,0],l=[0,0],u={dx:0,dy:0};t.beginPath();for(var c=0;c<n.length;c++){var h=n[c],f=h[0];if(c===0&&a&&a.d){var d=r.getStartTangent();u=ou(d[0][0],d[0][1],d[1][0],d[1][1],a.d)}else if(c===n.length-2&&n[c+1][0]==="Z"&&o&&o.d){var v=n[c+1];if(v[0]==="Z"){var d=r.getEndTangent();u=ou(d[0][0],d[0][1],d[1][0],d[1][1],o.d)}}else if(c===n.length-1&&o&&o.d&&n[0]!=="Z"){var d=r.getEndTangent();u=ou(d[0][0],d[0][1],d[1][0],d[1][1],o.d)}var p=u.dx,g=u.dy;switch(f){case"M":t.moveTo(h[1]-p,h[2]-g),l=[h[1],h[2]];break;case"L":t.lineTo(h[1]-p,h[2]-g);break;case"Q":t.quadraticCurveTo(h[1],h[2],h[3]-p,h[4]-g);break;case"C":t.bezierCurveTo(h[1],h[2],h[3],h[4],h[5]-p,h[6]-g);break;case"A":{var m=void 0;i?(m=i[c],m||(m=OO(s,h),i[c]=m)):m=OO(s,h);var y=m.cx,_=m.cy,x=m.rx,C=m.ry,A=m.startAngle,b=m.endAngle,R=m.xRotation,M=m.sweepFlag;if(t.ellipse)t.ellipse(y,_,x,C,R,A,b,1-M);else{var O=x>C?x:C,F=x>C?1:x/C,D=x>C?C/x:1;t.translate(y,_),t.rotate(R),t.scale(F,D),t.arc(0,0,O,A,b,1-M),t.scale(1/F,1/D),t.rotate(-R),t.translate(-y,-_)}break}case"Z":t.closePath();break}if(f==="Z")s=l;else{var H=h.length;s=[h[H-2],h[H-1]]}}}}function zk(r,t){var e=r.get("canvas");e&&(t==="remove"&&(r._cacheCanvasBBox=r.get("cacheCanvasBBox")),r.get("hasChanged")||(r.set("hasChanged",!0),r.cfg.parent&&r.cfg.parent.get("hasChanged")||(e.refreshElement(r,t,e),e.get("autoDraw")&&e.draw())))}function f2t(r){var t;if(r.destroyed)t=r._cacheCanvasBBox;else{var e=r.get("cacheCanvasBBox"),i=e&&!!(e.width&&e.height),n=r.getCanvasBBox(),a=n&&!!(n.width&&n.height);i&&a?t=e2t(e,n):i?t=e:a&&(t=n)}return t}function d2t(r){if(!r.length)return null;var t=[],e=[],i=[],n=[];return xe(r,function(a){var o=f2t(a);o&&(t.push(o.minX),e.push(o.minY),i.push(o.maxX),n.push(o.maxY))}),{minX:il(t),minY:il(e),maxX:rl(i),maxY:rl(n)}}function v2t(r,t){return!r||!t||!jd(r,t)?null:{minX:Math.max(r.minX,t.minX),minY:Math.max(r.minY,t.minY),maxX:Math.min(r.maxX,t.maxX),maxY:Math.min(r.maxY,t.maxY)}}var Mo=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.onCanvasChange=function(e){zk(this,e)},t.prototype.getShapeBase=function(){return ET},t.prototype.getGroupBase=function(){return t},t.prototype._applyClip=function(e,i){i&&(e.save(),vh(e,i),i.createPath(e),e.restore(),e.clip(),i._afterDraw())},t.prototype.cacheCanvasBBox=function(){var e=this.cfg.children,i=[],n=[];xe(e,function(f){var d=f.cfg.cacheCanvasBBox;d&&f.cfg.isInView&&(i.push(d.minX,d.maxX),n.push(d.minY,d.maxY))});var a=null;if(i.length){var o=il(i),s=rl(i),l=il(n),u=rl(n);a={minX:o,minY:l,x:o,y:l,maxX:s,maxY:u,width:s-o,height:u-l};var c=this.cfg.canvas;if(c){var h=c.getViewRange();this.set("isInView",jd(a,h))}}else this.set("isInView",!1);this.set("cacheCanvasBBox",a)},t.prototype.draw=function(e,i){var n=this.cfg.children,a=i?this.cfg.refresh:!0;n.length&&a&&(e.save(),vh(e,this),this._applyClip(e,this.getClip()),VC(e,n,i),e.restore(),this.cacheCanvasBBox()),this.cfg.refresh=null,this.set("hasChanged",!1)},t.prototype.skipDraw=function(){this.set("cacheCanvasBBox",null),this.set("hasChanged",!1)},t}(xbt),p2t=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return U(U({},e),{lineWidth:1,lineAppendWidth:0,strokeOpacity:1,fillOpacity:1})},t.prototype.getShapeBase=function(){return ET},t.prototype.getGroupBase=function(){return Mo},t.prototype.onCanvasChange=function(e){zk(this,e)},t.prototype.calculateBBox=function(){var e=this.get("type"),i=this.getHitLineWidth(),n=Ebt(e),a=n(this),o=i/2,s=a.x-o,l=a.y-o,u=a.x+a.width+o,c=a.y+a.height+o;return{x:s,minX:s,y:l,minY:l,width:a.width+i,height:a.height+i,maxX:u,maxY:c}},t.prototype.isFill=function(){return!!this.attrs.fill||this.isClipShape()},t.prototype.isStroke=function(){return!!this.attrs.stroke},t.prototype._applyClip=function(e,i){i&&(e.save(),vh(e,i),i.createPath(e),e.restore(),e.clip(),i._afterDraw())},t.prototype.draw=function(e,i){var n=this.cfg.clipShape;if(i){if(this.cfg.refresh===!1){this.set("hasChanged",!1);return}var a=this.getCanvasBBox();if(!jd(i,a)){this.set("hasChanged",!1),this.cfg.isInView&&this._afterDraw();return}}e.save(),vh(e,this),this._applyClip(e,n),this.drawPath(e),e.restore(),this._afterDraw()},t.prototype.getCanvasViewBox=function(){var e=this.cfg.canvas;return e?e.getViewRange():null},t.prototype.cacheCanvasBBox=function(){var e=this.getCanvasViewBox();if(e){var i=this.getCanvasBBox(),n=jd(i,e);this.set("isInView",n),n?this.set("cacheCanvasBBox",i):this.set("cacheCanvasBBox",null)}},t.prototype._afterDraw=function(){this.cacheCanvasBBox(),this.set("hasChanged",!1),this.set("refresh",null)},t.prototype.skipDraw=function(){this.set("cacheCanvasBBox",null),this.set("isInView",null),this.set("hasChanged",!1)},t.prototype.drawPath=function(e){this.createPath(e),this.strokeAndFill(e),this.afterDrawPath(e)},t.prototype.fill=function(e){e.fill()},t.prototype.stroke=function(e){e.stroke()},t.prototype.strokeAndFill=function(e){var i=this.attrs,n=i.lineWidth,a=i.opacity,o=i.strokeOpacity,s=i.fillOpacity;this.isFill()&&(!Ir(s)&&s!==1?(e.globalAlpha=s,this.fill(e),e.globalAlpha=a):this.fill(e)),this.isStroke()&&n>0&&(!Ir(o)&&o!==1&&(e.globalAlpha=o),this.stroke(e)),this.afterDrawPath(e)},t.prototype.createPath=function(e){},t.prototype.afterDrawPath=function(e){},t.prototype.isInShape=function(e,i){var n=this.isStroke(),a=this.isFill(),o=this.getHitLineWidth();return this.isInStrokeOrPath(e,i,n,a,o)},t.prototype.isInStrokeOrPath=function(e,i,n,a,o){return!1},t.prototype.getHitLineWidth=function(){if(!this.isStroke())return 0;var e=this.attrs;return e.lineWidth+e.lineAppendWidth},t}(Cbt),Wa=p2t,g2t=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return U(U({},e),{x:0,y:0,r:0})},t.prototype.isInStrokeOrPath=function(e,i,n,a,o){var s=this.attr(),l=s.x,u=s.y,c=s.r,h=o/2,f=Pk(l,u,e,i);return a&&n?f<=c+h:a?f<=c:n?f>=c-h&&f<=c+h:!1},t.prototype.createPath=function(e){var i=this.attr(),n=i.x,a=i.y,o=i.r;e.beginPath(),e.arc(n,a,o,0,Math.PI*2,!1),e.closePath()},t}(Wa),m2t=g2t;function Lg(r,t,e,i){return r/(e*e)+t/(i*i)}var y2t=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return U(U({},e),{x:0,y:0,rx:0,ry:0})},t.prototype.isInStrokeOrPath=function(e,i,n,a,o){var s=this.attr(),l=o/2,u=s.x,c=s.y,h=s.rx,f=s.ry,d=(e-u)*(e-u),v=(i-c)*(i-c);return a&&n?Lg(d,v,h+l,f+l)<=1:a?Lg(d,v,h,f)<=1:n?Lg(d,v,h-l,f-l)>=1&&Lg(d,v,h+l,f+l)<=1:!1},t.prototype.createPath=function(e){var i=this.attr(),n=i.x,a=i.y,o=i.rx,s=i.ry;if(e.beginPath(),e.ellipse)e.ellipse(n,a,o,s,0,0,Math.PI*2,!1);else{var l=o>s?o:s,u=o>s?1:o/s,c=o>s?s/o:1;e.save(),e.translate(n,a),e.scale(u,c),e.arc(0,0,l,0,Math.PI*2),e.restore(),e.closePath()}},t}(Wa),_2t=y2t;function FO(r){return r instanceof HTMLElement&&Da(r.nodeName)&&r.nodeName.toUpperCase()==="CANVAS"}var x2t=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return U(U({},e),{x:0,y:0,width:0,height:0})},t.prototype.initAttrs=function(e){this._setImage(e.img)},t.prototype.isStroke=function(){return!1},t.prototype.isOnlyHitBox=function(){return!0},t.prototype._afterLoading=function(){if(this.get("toDraw")===!0){var e=this.get("canvas");e?e.draw():this.createPath(this.get("context"))}},t.prototype._setImage=function(e){var i=this,n=this.attrs;if(Da(e)){var a=new Image;a.onload=function(){if(i.destroyed)return!1;i.attr("img",a),i.set("loading",!1),i._afterLoading();var o=i.get("callback");o&&o.call(i)},a.crossOrigin="Anonymous",a.src=e,this.set("loading",!0)}else e instanceof Image?(n.width||(n.width=e.width),n.height||(n.height=e.height)):FO(e)&&(n.width||(n.width=Number(e.getAttribute("width"))),n.height||(n.height,Number(e.getAttribute("height"))))},t.prototype.onAttrChange=function(e,i,n){r.prototype.onAttrChange.call(this,e,i,n),e==="img"&&this._setImage(i)},t.prototype.createPath=function(e){if(this.get("loading")){this.set("toDraw",!0),this.set("context",e);return}var i=this.attr(),n=i.x,a=i.y,o=i.width,s=i.height,l=i.sx,u=i.sy,c=i.swidth,h=i.sheight,f=i.img;(f instanceof Image||FO(f))&&(!Ir(l)&&!Ir(u)&&!Ir(c)&&!Ir(h)?e.drawImage(f,l,u,c,h,n,a,o,s):e.drawImage(f,n,a,o,s))},t}(Wa),BT=x2t;function $s(r,t,e,i,n,a,o){var s=Math.min(r,e),l=Math.max(r,e),u=Math.min(t,i),c=Math.max(t,i),h=n/2;return a>=s-h&&a<=l+h&&o>=u-h&&o<=c+h?Yi.pointToLine(r,t,e,i,a,o)<=n/2:!1}var C2t=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return U(U({},e),{x1:0,y1:0,x2:0,y2:0,startArrow:!1,endArrow:!1})},t.prototype.initAttrs=function(e){this.setArrow()},t.prototype.onAttrChange=function(e,i,n){r.prototype.onAttrChange.call(this,e,i,n),this.setArrow()},t.prototype.setArrow=function(){var e=this.attr(),i=e.x1,n=e.y1,a=e.x2,o=e.y2,s=e.startArrow,l=e.endArrow;s&&OT(this,e,a,o,i,n),l&&PT(this,e,i,n,a,o)},t.prototype.isInStrokeOrPath=function(e,i,n,a,o){if(!n||!o)return!1;var s=this.attr(),l=s.x1,u=s.y1,c=s.x2,h=s.y2;return $s(l,u,c,h,o,e,i)},t.prototype.createPath=function(e){var i=this.attr(),n=i.x1,a=i.y1,o=i.x2,s=i.y2,l=i.startArrow,u=i.endArrow,c={dx:0,dy:0},h={dx:0,dy:0};l&&l.d&&(c=ou(n,a,o,s,i.startArrow.d)),u&&u.d&&(h=ou(n,a,o,s,i.endArrow.d)),e.beginPath(),e.moveTo(n+c.dx,a+c.dy),e.lineTo(o-h.dx,s-h.dy)},t.prototype.afterDrawPath=function(e){var i=this.get("startArrowShape"),n=this.get("endArrowShape");i&&i.draw(e),n&&n.draw(e)},t.prototype.getTotalLength=function(){var e=this.attr(),i=e.x1,n=e.y1,a=e.x2,o=e.y2;return Yi.length(i,n,a,o)},t.prototype.getPoint=function(e){var i=this.attr(),n=i.x1,a=i.y1,o=i.x2,s=i.y2;return Yi.pointAt(n,a,o,s,e)},t}(Wa),E2t=C2t,S2t={circle:function(r,t,e){return[["M",r-e,t],["A",e,e,0,1,0,r+e,t],["A",e,e,0,1,0,r-e,t]]},square:function(r,t,e){return[["M",r-e,t-e],["L",r+e,t-e],["L",r+e,t+e],["L",r-e,t+e],["Z"]]},diamond:function(r,t,e){return[["M",r-e,t],["L",r,t-e],["L",r+e,t],["L",r,t+e],["Z"]]},triangle:function(r,t,e){var i=e*Math.sin(.3333333333333333*Math.PI);return[["M",r-e,t+i],["L",r,t-i],["L",r+e,t+i],["Z"]]},"triangle-down":function(r,t,e){var i=e*Math.sin(.3333333333333333*Math.PI);return[["M",r-e,t-i],["L",r+e,t-i],["L",r,t+i],["Z"]]}},A2t=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.initAttrs=function(e){this._resetParamsCache()},t.prototype._resetParamsCache=function(){this.set("paramsCache",{})},t.prototype.onAttrChange=function(e,i,n){r.prototype.onAttrChange.call(this,e,i,n),["symbol","x","y","r","radius"].indexOf(e)!==-1&&this._resetParamsCache()},t.prototype.isOnlyHitBox=function(){return!0},t.prototype._getR=function(e){return Ir(e.r)?e.radius:e.r},t.prototype._getPath=function(){var e=this.attr(),i=e.x,n=e.y,a=e.symbol||"circle",o=this._getR(e),s,l;if(Cu(a))s=a,l=s(i,n,o),l=Lk(l);else{if(s=t.Symbols[a],!s)return console.warn(a+" marker is not supported."),null;l=s(i,n,o)}return l},t.prototype.createPath=function(e){var i=this._getPath(),n=this.get("paramsCache");Uk(this,e,{path:i},n)},t.Symbols=S2t,t}(Wa),T2t=A2t;function Hk(r,t,e){var i=Rk();return r.createPath(i),i.isPointInPath(t,e)}var b2t=1e-6;function L1(r){return Math.abs(r)<b2t?0:r<0?-1:1}function w2t(r,t,e){return(e[0]-r[0])*(t[1]-r[1])===(t[0]-r[0])*(e[1]-r[1])&&Math.min(r[0],t[0])<=e[0]&&e[0]<=Math.max(r[0],t[0])&&Math.min(r[1],t[1])<=e[1]&&e[1]<=Math.max(r[1],t[1])}function $k(r,t,e){var i=!1,n=r.length;if(n<=2)return!1;for(var a=0;a<n;a++){var o=r[a],s=r[(a+1)%n];if(w2t(o,s,[t,e]))return!0;L1(o[1]-e)>0!=L1(s[1]-e)>0&&L1(t-(e-o[1])*(o[0]-s[0])/(o[1]-s[1])-o[0])<0&&(i=!i)}return i}function Vf(r,t,e,i,n,a,o,s){var l=(Math.atan2(s-t,o-r)+Math.PI*2)%(Math.PI*2);if(l<i||l>n)return!1;var u={x:r+e*Math.cos(l),y:t+e*Math.sin(l)};return Pk(u.x,u.y,o,s)<=a/2}var R2t=rk;function M2t(r){for(var t=!1,e=r.length,i=0;i<e;i++){var n=r[i],a=n[0];if(a==="C"||a==="A"||a==="Q"){t=!0;break}}return t}function I2t(r,t,e,i,n){for(var a=!1,o=t/2,s=0;s<r.length;s++){var l=r[s],u=l.currentPoint,c=l.params,h=l.prePoint,f=l.box;if(!(f&&!jl(f.x-o,f.y-o,f.width+t,f.height+t,e,i))){switch(l.command){case"L":case"Z":a=$s(h[0],h[1],u[0],u[1],t,e,i);break;case"Q":var d=Tk.pointDistance(h[0],h[1],c[1],c[2],c[3],c[4],e,i);a=d<=t/2;break;case"C":var v=hd.pointDistance(h[0],h[1],c[1],c[2],c[3],c[4],c[5],c[6],e,i,n);a=v<=t/2;break;case"A":var p=l.arcParams,g=p.cx,m=p.cy,y=p.rx,_=p.ry,x=p.startAngle,C=p.endAngle,A=p.xRotation,b=[e,i,1],R=y>_?y:_,M=y>_?1:y/_,O=y>_?_/y:1,F=R2t(null,[["t",-g,-m],["r",-A],["s",1/M,1/O]]);GAt(b,b,F),a=Vf(0,0,R,x,C,t,b[0],b[1]);break}if(a)break}}return a}function L2t(r){for(var t=r.length,e=[],i=[],n=[],a=0;a<t;a++){var o=r[a],s=o[0];s==="M"?(n.length&&(i.push(n),n=[]),n.push([o[1],o[2]])):s==="Z"?n.length&&(e.push(n),n=[]):n.push([o[1],o[2]])}return n.length>0&&i.push(n),{polygons:e,polylines:i}}var Og=U({hasArc:M2t,extractPolygons:L2t,isPointInStroke:I2t},AAt);function BO(r,t,e){for(var i=!1,n=0;n<r.length;n++){var a=r[n];if(i=$k(a,t,e),i)break}return i}var O2t=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return U(U({},e),{startArrow:!1,endArrow:!1})},t.prototype.initAttrs=function(e){this._setPathArr(e.path),this.setArrow()},t.prototype.onAttrChange=function(e,i,n){r.prototype.onAttrChange.call(this,e,i,n),e==="path"&&this._setPathArr(i),this.setArrow()},t.prototype._setPathArr=function(e){this.attrs.path=Lk(e);var i=Og.hasArc(e);this.set("hasArc",i),this.set("paramsCache",{}),this.set("segments",null),this.set("curve",null),this.set("tCache",null),this.set("totalLength",null)},t.prototype.getSegments=function(){var e=this.get("segements");return e||(e=Ok(this.attr("path")),this.set("segments",e)),e},t.prototype.setArrow=function(){var e=this.attr(),i=e.startArrow,n=e.endArrow;if(i){var a=this.getStartTangent();OT(this,e,a[0][0],a[0][1],a[1][0],a[1][1])}if(n){var a=this.getEndTangent();PT(this,e,a[0][0],a[0][1],a[1][0],a[1][1])}},t.prototype.isInStrokeOrPath=function(e,i,n,a,o){var s=this.getSegments(),l=this.get("hasArc"),u=!1;if(n){var c=this.getTotalLength();u=Og.isPointInStroke(s,o,e,i,c)}if(!u&&a)if(l)u=Hk(this,e,i);else{var h=this.attr("path"),f=Og.extractPolygons(h);u=BO(f.polygons,e,i)||BO(f.polylines,e,i)}return u},t.prototype.createPath=function(e){var i=this.attr(),n=this.get("paramsCache");Uk(this,e,i,n)},t.prototype.afterDrawPath=function(e){var i=this.get("startArrowShape"),n=this.get("endArrowShape");i&&i.draw(e),n&&n.draw(e)},t.prototype.getTotalLength=function(){var e=this.get("totalLength");return Ir(e)?(this._calculateCurve(),this._setTcache(),this.get("totalLength")):e},t.prototype.getPoint=function(e){var i=this.get("tCache");i||(this._calculateCurve(),this._setTcache(),i=this.get("tCache"));var n,a,o=this.get("curve");if(!i||i.length===0)return o?{x:o[0][1],y:o[0][2]}:null;xe(i,function(c,h){e>=c[0]&&e<=c[1]&&(n=(e-c[0])/(c[1]-c[0]),a=h)});var s=o[a];if(Ir(s)||Ir(a))return null;var l=s.length,u=o[a+1];return hd.pointAt(s[l-2],s[l-1],u[1],u[2],u[3],u[4],u[5],u[6],n)},t.prototype._calculateCurve=function(){var e=this.attr().path;this.set("curve",Og.pathToCurve(e))},t.prototype._setTcache=function(){var e=0,i=0,n=[],a,o,s,l,u=this.get("curve");if(u){if(xe(u,function(c,h){s=u[h+1],l=c.length,s&&(e+=hd.length(c[l-2],c[l-1],s[1],s[2],s[3],s[4],s[5],s[6])||0)}),this.set("totalLength",e),e===0){this.set("tCache",[]);return}xe(u,function(c,h){s=u[h+1],l=c.length,s&&(a=[],a[0]=i/e,o=hd.length(c[l-2],c[l-1],s[1],s[2],s[3],s[4],s[5],s[6]),i+=o||0,a[1]=i/e,n.push(a))}),this.set("tCache",n)}},t.prototype.getStartTangent=function(){var e=this.getSegments(),i;if(e.length>1){var n=e[0].currentPoint,a=e[1].currentPoint,o=e[1].startTangent;i=[],o?(i.push([n[0]-o[0],n[1]-o[1]]),i.push([n[0],n[1]])):(i.push([a[0],a[1]]),i.push([n[0],n[1]]))}return i},t.prototype.getEndTangent=function(){var e=this.getSegments(),i=e.length,n;if(i>1){var a=e[i-2].currentPoint,o=e[i-1].currentPoint,s=e[i-1].endTangent;n=[],s?(n.push([o[0]-s[0],o[1]-s[1]]),n.push([o[0],o[1]])):(n.push([a[0],a[1]]),n.push([o[0],o[1]]))}return n},t}(Wa),DT=O2t;function Wk(r,t,e,i,n){var a=r.length;if(a<2)return!1;for(var o=0;o<a-1;o++){var s=r[o][0],l=r[o][1],u=r[o+1][0],c=r[o+1][1];if($s(s,l,u,c,t,e,i))return!0}if(n){var h=r[0],f=r[a-1];if($s(h[0],h[1],f[0],f[1],t,e,i))return!0}return!1}var P2t=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.isInStrokeOrPath=function(e,i,n,a,o){var s=this.attr().points,l=!1;return n&&(l=Wk(s,o,e,i,!0)),!l&&a&&(l=$k(s,e,i)),l},t.prototype.createPath=function(e){var i=this.attr(),n=i.points;if(!(n.length<2)){e.beginPath();for(var a=0;a<n.length;a++){var o=n[a];a===0?e.moveTo(o[0],o[1]):e.lineTo(o[0],o[1])}e.closePath()}},t}(Wa),F2t=P2t,B2t=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return U(U({},e),{startArrow:!1,endArrow:!1})},t.prototype.initAttrs=function(e){this.setArrow()},t.prototype.onAttrChange=function(e,i,n){r.prototype.onAttrChange.call(this,e,i,n),this.setArrow(),["points"].indexOf(e)!==-1&&this._resetCache()},t.prototype._resetCache=function(){this.set("totalLength",null),this.set("tCache",null)},t.prototype.setArrow=function(){var e=this.attr(),i=this.attrs,n=i.points,a=i.startArrow,o=i.endArrow,s=n.length,l=n[0][0],u=n[0][1],c=n[s-1][0],h=n[s-1][1];a&&OT(this,e,n[1][0],n[1][1],l,u),o&&PT(this,e,n[s-2][0],n[s-2][1],c,h)},t.prototype.isFill=function(){return!1},t.prototype.isInStrokeOrPath=function(e,i,n,a,o){if(!n||!o)return!1;var s=this.attr().points;return Wk(s,o,e,i,!1)},t.prototype.isStroke=function(){return!0},t.prototype.createPath=function(e){var i=this.attr(),n=i.points,a=i.startArrow,o=i.endArrow,s=n.length;if(!(n.length<2)){var l=n[0][0],u=n[0][1],c=n[s-1][0],h=n[s-1][1];if(a&&a.d){var f=ou(l,u,n[1][0],n[1][1],a.d);l+=f.dx,u+=f.dy}if(o&&o.d){var f=ou(n[s-2][0],n[s-2][1],c,h,o.d);c-=f.dx,h-=f.dy}e.beginPath(),e.moveTo(l,u);for(var d=0;d<s-1;d++){var v=n[d];e.lineTo(v[0],v[1])}e.lineTo(c,h)}},t.prototype.afterDrawPath=function(e){var i=this.get("startArrowShape"),n=this.get("endArrowShape");i&&i.draw(e),n&&n.draw(e)},t.prototype.getTotalLength=function(){var e=this.attr().points,i=this.get("totalLength");return Ir(i)?(this.set("totalLength",Dbt.length(e)),this.get("totalLength")):i},t.prototype.getPoint=function(e){var i=this.attr().points,n=this.get("tCache");n||(this._setTcache(),n=this.get("tCache"));var a,o;return xe(n,function(s,l){e>=s[0]&&e<=s[1]&&(a=(e-s[0])/(s[1]-s[0]),o=l)}),Yi.pointAt(i[o][0],i[o][1],i[o+1][0],i[o+1][1],a)},t.prototype._setTcache=function(){var e=this.attr().points;if(!(!e||e.length===0)){var i=this.getTotalLength();if(!(i<=0)){var n=0,a=[],o,s;xe(e,function(l,u){e[u+1]&&(o=[],o[0]=n/i,s=Yi.length(l[0],l[1],e[u+1][0],e[u+1][1]),n+=s,o[1]=n/i,a.push(o))}),this.set("tCache",a)}}},t.prototype.getStartTangent=function(){var e=this.attr().points,i=[];return i.push([e[1][0],e[1][1]]),i.push([e[0][0],e[0][1]]),i},t.prototype.getEndTangent=function(){var e=this.attr().points,i=e.length-1,n=[];return n.push([e[i-1][0],e[i-1][1]]),n.push([e[i][0],e[i][1]]),n},t}(Wa),D2t=B2t;function N2t(r,t,e,i,n,a,o){var s=n/2;return jl(r-s,t-s,e,n,a,o)||jl(r+e-s,t-s,n,i,a,o)||jl(r+s,t+i-s,e,n,a,o)||jl(r-s,t+s,n,i,a,o)}function k2t(r,t,e,i,n,a,o,s){return $s(r+n,t,r+e-n,t,a,o,s)||$s(r+e,t+n,r+e,t+i-n,a,o,s)||$s(r+e-n,t+i,r+n,t+i,a,o,s)||$s(r,t+i-n,r,t+n,a,o,s)||Vf(r+e-n,t+n,n,1.5*Math.PI,2*Math.PI,a,o,s)||Vf(r+e-n,t+i-n,n,0,.5*Math.PI,a,o,s)||Vf(r+n,t+i-n,n,.5*Math.PI,Math.PI,a,o,s)||Vf(r+n,t+n,n,Math.PI,1.5*Math.PI,a,o,s)}var U2t=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return U(U({},e),{x:0,y:0,width:0,height:0,radius:0})},t.prototype.isInStrokeOrPath=function(e,i,n,a,o){var s=this.attr(),l=s.x,u=s.y,c=s.width,h=s.height,f=s.radius;if(f){var v=!1;return n&&(v=k2t(l,u,c,h,f,o,e,i)),!v&&a&&(v=Hk(this,e,i)),v}else{var d=o/2;if(a&&n)return jl(l-d,u-d,c+d,h+d,e,i);if(a)return jl(l,u,c,h,e,i);if(n)return N2t(l,u,c,h,o,e,i)}},t.prototype.createPath=function(e){var i=this.attr(),n=i.x,a=i.y,o=i.width,s=i.height,l=i.radius;if(e.beginPath(),l===0)e.rect(n,a,o,s);else{var u=u2t(l),c=u[0],h=u[1],f=u[2],d=u[3];e.moveTo(n+c,a),e.lineTo(n+o-h,a),h!==0&&e.arc(n+o-h,a+h,h,-Math.PI/2,0),e.lineTo(n+o,a+s-f),f!==0&&e.arc(n+o-f,a+s-f,f,0,Math.PI/2),e.lineTo(n+d,a+s),d!==0&&e.arc(n+d,a+s-d,d,Math.PI/2,Math.PI),e.lineTo(n,a+c),c!==0&&e.arc(n+c,a+c,c,Math.PI,Math.PI*1.5),e.closePath()}},t}(Wa),z2t=U2t,H2t=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var e=r.prototype.getDefaultAttrs.call(this);return U(U({},e),{x:0,y:0,text:null,fontSize:12,fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"normal",fontVariant:"normal",textAlign:"start",textBaseline:"bottom"})},t.prototype.isOnlyHitBox=function(){return!0},t.prototype.initAttrs=function(e){this._assembleFont(),e.text&&this._setText(e.text)},t.prototype._assembleFont=function(){var e=this.attrs;e.font=Ik(e)},t.prototype._setText=function(e){var i=null;Da(e)&&e.indexOf(`
`)!==-1&&(i=e.split(`
`)),this.set("textArr",i)},t.prototype.onAttrChange=function(e,i,n){r.prototype.onAttrChange.call(this,e,i,n),e.startsWith("font")&&this._assembleFont(),e==="text"&&this._setText(i)},t.prototype._getSpaceingY=function(){var e=this.attrs,i=e.lineHeight,n=e.fontSize*1;return i?i-n:n*.14},t.prototype._drawTextArr=function(e,i,n){var a=this.attrs,o=a.textBaseline,s=a.x,l=a.y,u=a.fontSize*1,c=this._getSpaceingY(),h=Mk(a.text,a.fontSize,a.lineHeight),f;xe(i,function(d,v){f=l+v*(c+u)-h+u,o==="middle"&&(f+=h-u-(h-u)/2),o==="top"&&(f+=h-u),Ir(d)||(n?e.fillText(d,s,f):e.strokeText(d,s,f))})},t.prototype._drawText=function(e,i){var n=this.attr(),a=n.x,o=n.y,s=this.get("textArr");if(s)this._drawTextArr(e,s,i);else{var l=n.text;Ir(l)||(i?e.fillText(l,a,o):e.strokeText(l,a,o))}},t.prototype.strokeAndFill=function(e){var i=this.attrs,n=i.lineWidth,a=i.opacity,o=i.strokeOpacity,s=i.fillOpacity;this.isStroke()&&n>0&&(!Ir(o)&&o!==1&&(e.globalAlpha=a),this.stroke(e)),this.isFill()&&(!Ir(s)&&s!==1?(e.globalAlpha=s,this.fill(e),e.globalAlpha=a):this.fill(e)),this.afterDrawPath(e)},t.prototype.fill=function(e){this._drawText(e,!0)},t.prototype.stroke=function(e){this._drawText(e,!1)},t}(Wa),$2t=H2t;function W2t(r,t){if(t){var e=ik(t);return Xl(e,r)}return r}function Vk(r,t,e){var i=r.getTotalMatrix();if(i){var n=W2t([t,e,1],i),a=n[0],o=n[1];return[a,o]}return[t,e]}function DO(r,t,e){if(r.isCanvas&&r.isCanvas())return!0;if(!LC(r)||r.cfg.isInView===!1)return!1;if(r.cfg.clipShape){var i=Vk(r,t,e),n=i[0],a=i[1];if(r.isClipped(n,a))return!1}var o=r.cfg.cacheCanvasBBox||r.getCanvasBBox();return t>=o.minX&&t<=o.maxX&&e>=o.minY&&e<=o.maxY}function Gk(r,t,e){if(!DO(r,t,e))return null;for(var i=null,n=r.getChildren(),a=n.length,o=a-1;o>=0;o--){var s=n[o];if(s.isGroup())i=Gk(s,t,e);else if(DO(s,t,e)){var l=s,u=Vk(s,t,e),c=u[0],h=u[1];l.isInShape(c,h)&&(i=s)}if(i)break}return i}var NO=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var e=r.prototype.getDefaultCfg.call(this);return e.renderer="canvas",e.autoDraw=!0,e.localRefresh=!0,e.refreshElements=[],e.clipView=!0,e.quickHit=!1,e},t.prototype.onCanvasChange=function(e){(e==="attr"||e==="sort"||e==="changeSize")&&(this.set("refreshElements",[this]),this.draw())},t.prototype.getShapeBase=function(){return ET},t.prototype.getGroupBase=function(){return Mo},t.prototype.getPixelRatio=function(){var e=this.get("pixelRatio")||t2t();return e>=1?Math.ceil(e):1},t.prototype.getViewRange=function(){return{minX:0,minY:0,maxX:this.cfg.width,maxY:this.cfg.height}},t.prototype.createDom=function(){var e=document.createElement("canvas"),i=e.getContext("2d");return this.set("context",i),e},t.prototype.setDOMSize=function(e,i){r.prototype.setDOMSize.call(this,e,i);var n=this.get("context"),a=this.get("el"),o=this.getPixelRatio();a.width=o*e,a.height=o*i,o>1&&n.scale(o,o)},t.prototype.clear=function(){r.prototype.clear.call(this),this._clearFrame();var e=this.get("context"),i=this.get("el");e.clearRect(0,0,i.width,i.height)},t.prototype.getShape=function(e,i){var n;return this.get("quickHit")?n=Gk(this,e,i):n=r.prototype.getShape.call(this,e,i,null),n},t.prototype._getRefreshRegion=function(){var e=this.get("refreshElements"),i=this.getViewRange(),n;if(e.length&&e[0]===this)n=i;else if(n=d2t(e),n){n.minX=Math.floor(n.minX),n.minY=Math.floor(n.minY),n.maxX=Math.ceil(n.maxX),n.maxY=Math.ceil(n.maxY),n.maxY+=1;var a=this.get("clipView");a&&(n=v2t(n,i))}return n},t.prototype.refreshElement=function(e){var i=this.get("refreshElements");i.push(e)},t.prototype._clearFrame=function(){var e=this.get("drawFrame");e&&(aAt(e),this.set("drawFrame",null),this.set("refreshElements",[]))},t.prototype.draw=function(){var e=this.get("drawFrame");this.get("autoDraw")&&e||this._startDraw()},t.prototype._drawAll=function(){var e=this.get("context"),i=this.get("el"),n=this.getChildren();e.clearRect(0,0,i.width,i.height),vh(e,this),VC(e,n),this.set("refreshElements",[])},t.prototype._drawRegion=function(){var e=this.get("context"),i=this.get("refreshElements"),n=this.getChildren(),a=this._getRefreshRegion();a?(e.clearRect(a.minX,a.minY,a.maxX-a.minX,a.maxY-a.minY),e.save(),e.beginPath(),e.rect(a.minX,a.minY,a.maxX-a.minX,a.maxY-a.minY),e.clip(),vh(e,this),c2t(this,n,a),VC(e,n,a),e.restore()):i.length&&kk(i),xe(i,function(o){o.get("hasChanged")&&o.set("hasChanged",!1)}),this.set("refreshElements",[])},t.prototype._startDraw=function(){var e=this,i=this.get("drawFrame");i||(i=nAt(function(){e.get("localRefresh")?e._drawRegion():e._drawAll(),e.set("drawFrame",null)}),this.set("drawFrame",i))},t.prototype.skipDraw=function(){},t.prototype.removeDom=function(){var e=this.get("el");e.width=0,e.height=0,e.parentNode.removeChild(e)},t}(_bt),Zi="$$value$$",Kt="$$extra$$",NT="$$origin$$",V2t="$$extra_column$$",So="$$total$$",u0="$$multi$$",Su="$$series_number$$",Vu="$$empty_field_value$$",kT="$$empty_extra_placeholder$$",kO;(function(r){r.DATA_CELL_CLICK_EVENT="interaction:data-cell-click",r.MERGED_CELLS_CLICK_EVENT="interaction:merged-cells-click",r.CORNER_TEXT_CLICK_EVENT="interaction:corner-cell-text-click",r.ROW_COLUMN_CLICK_EVENT="interaction:row-column-click",r.ROW_TEXT_CLICK_EVENT="interaction:row-text-click",r.HOVER_EVENT="interaction:hover",r.TREND_ICON_CLICK="interaction:trend-icon-click"})(kO||(kO={}));var _i;(function(r){r.MOUSE_DOWN="mousedown",r.MOUSE_MOVE="mousemove",r.MOUSE_OUT="mouseout",r.MOUSE_LEAVE="mouseleave",r.MOUSE_UP="mouseup",r.KEY_DOWN="keydown",r.KEY_UP="keyup",r.CLICK="click",r.HOVER="hover",r.DOUBLE_CLICK="dblclick",r.CONTEXT_MENU="contextmenu"})(_i||(_i={}));var X;(function(r){r.ROW_CELL_HOVER="row-cell:hover",r.ROW_CELL_CLICK="row-cell:click",r.ROW_CELL_DOUBLE_CLICK="row-cell:double-click",r.ROW_CELL_CONTEXT_MENU="row-cell:context-menu",r.ROW_CELL_MOUSE_DOWN="row-cell:mouse-down",r.ROW_CELL_MOUSE_UP="row-cell:mouse-up",r.ROW_CELL_MOUSE_MOVE="row-cell:mouse-move",r.ROW_CELL_COLLAPSE_TREE_ROWS="row-cell:collapsed-tree-rows",r.ROW_CELL_SCROLL="row-cell:scroll",r.ROW_CELL_BRUSH_SELECTION="row-cell:brush-selection",r.COL_CELL_HOVER="col-cell:hover",r.COL_CELL_CLICK="col-cell:click",r.COL_CELL_DOUBLE_CLICK="col-cell:double-click",r.COL_CELL_CONTEXT_MENU="col-cell:context-menu",r.COL_CELL_MOUSE_DOWN="col-cell:mouse-down",r.COL_CELL_MOUSE_UP="col-cell:mouse-up",r.COL_CELL_MOUSE_MOVE="col-cell:mouse-move",r.COL_CELL_BRUSH_SELECTION="col-cell:brush-selection",r.DATA_CELL_HOVER="data-cell:hover",r.DATA_CELL_CLICK="data-cell:click",r.DATA_CELL_DOUBLE_CLICK="data-cell:double-click",r.DATA_CELL_CONTEXT_MENU="data-cell:context-menu",r.DATA_CELL_MOUSE_UP="data-cell:mouse-up",r.DATA_CELL_MOUSE_DOWN="data-cell:mouse-down",r.DATA_CELL_MOUSE_MOVE="data-cell:mouse-move",r.DATA_CELL_TREND_ICON_CLICK="data-cell:trend-icon-click",r.DATA_CELL_BRUSH_SELECTION="data-cell:brush-selection",r.DATA_CELL_SELECT_MOVE="data-cell:select-move",r.CORNER_CELL_HOVER="corner-cell:hover",r.CORNER_CELL_CLICK="corner-cell:click",r.CORNER_CELL_DOUBLE_CLICK="corner-cell:double-click",r.CORNER_CELL_CONTEXT_MENU="corner-cell:context-menu",r.CORNER_CELL_MOUSE_DOWN="corner-cell:mouse-down",r.CORNER_CELL_MOUSE_UP="corner-cell:mouse-up",r.CORNER_CELL_MOUSE_MOVE="corner-cell:mouse-move",r.MERGED_CELLS_HOVER="merged-cells:hover",r.MERGED_CELLS_CLICK="merged-cells:click",r.MERGED_CELLS_DOUBLE_CLICK="merged-cells:double-click",r.MERGED_CELLS_CONTEXT_MENU="merged-cell:context-menu",r.MERGED_CELLS_MOUSE_DOWN="merged-cells:mouse-down",r.MERGED_CELLS_MOUSE_UP="merged-cells:mouse-up",r.MERGED_CELLS_MOUSE_MOVE="merged-cells:mouse-move",r.RANGE_SORT="sort:range-sort",r.RANGE_SORTED="sort:range-sorted",r.RANGE_FILTER="filter:range-filter",r.RANGE_FILTERED="filter:range-filtered",r.LAYOUT_AFTER_HEADER_LAYOUT="layout:after-header-layout",r.LAYOUT_CELL_SCROLL="layout:cell-scroll",r.LAYOUT_PAGINATION="layout:pagination",r.LAYOUT_COLLAPSE_ROWS="layout:collapsed-rows",r.LAYOUT_AFTER_COLLAPSE_ROWS="layout:after-collapsed-rows",r.LAYOUT_AFTER_REAL_DATA_CELL_RENDER="layout:after-real-data-cell-render",r.LAYOUT_TREE_ROWS_COLLAPSE_ALL="layout:toggle-collapse-all",r.LAYOUT_COLS_EXPANDED="layout:table-col-expanded",r.LAYOUT_COLS_HIDDEN="layout:table-col-hidden",r.LAYOUT_AFTER_RENDER="layout:after-render",r.LAYOUT_BEFORE_RENDER="layout:before-render",r.LAYOUT_DESTROY="layout:destroy",r.LAYOUT_RESIZE="layout:resize",r.LAYOUT_RESIZE_SERIES_WIDTH="layout:resize-series-width",r.LAYOUT_RESIZE_ROW_WIDTH="layout:resize-row-width",r.LAYOUT_RESIZE_ROW_HEIGHT="layout:resize-row-height",r.LAYOUT_RESIZE_COL_WIDTH="layout:resize-column-width",r.LAYOUT_RESIZE_COL_HEIGHT="layout:resize-column-height",r.LAYOUT_RESIZE_TREE_WIDTH="layout:resize-tree-width",r.LAYOUT_RESIZE_MOUSE_DOWN="layout:resize:mouse-down",r.LAYOUT_RESIZE_MOUSE_MOVE="layout:resize:mouse-move",r.LAYOUT_RESIZE_MOUSE_UP="layout:resize-mouse-up",r.GLOBAL_KEYBOARD_DOWN="global:keyboard-down",r.GLOBAL_KEYBOARD_UP="global:keyboard-up",r.GLOBAL_COPIED="global:copied",r.GLOBAL_MOUSE_UP="global:mouse-up",r.GLOBAL_MOUSE_MOVE="global:mouse-move",r.GLOBAL_ACTION_ICON_CLICK="global:action-icon-click",r.GLOBAL_ACTION_ICON_HOVER="global:action-icon-hover",r.GLOBAL_ACTION_ICON_HOVER_OFF="global:action-icon-hover-off",r.GLOBAL_CONTEXT_MENU="global:context-menu",r.GLOBAL_CLICK="global:click",r.GLOBAL_DOUBLE_CLICK="global:double-click",r.GLOBAL_SELECTED="global:selected",r.GLOBAL_HOVER="global:hover",r.GLOBAL_RESET="global:reset",r.GLOBAL_LINK_FIELD_JUMP="global:link-field-jump",r.GLOBAL_SCROLL="global:scroll"})(X||(X={}));var G2t=0,X2t=3,Xk=3,Zd=4,Y2t=5,j2t=5,Z2t=1,q2t=1,Yk=2,K2t="backGroundGroup",Q2t="foreGroundGroup",J2t="panelGroup",twt="panelScrollGroup",UO="mergedCellsGroup",jk="frozenRowGroup",Zk="frozenColGroup",ewt="frozenTrailingRowGroup",rwt="frozenTrailingColGroup",iwt="frozenTopGroup",nwt="frozenBottomGroup",ph="rowResizeAreaGroup",qk="rowFrozenResizeAreaGroup",dm="frozenSplitLine",zO="rowIndexResizeAreaGroup",XC="cornerResizeAreaGroup",Kk="colResizeAreaGroup",Qk="colFrozenResizeAreaGroup",awt="colScrollGroup",owt="colFrozenGroup",swt="colFrozenTrailingGroup",HO="gridGroup",lwt="rowScrollGroup",uwt="rowHeaderFrozenGroup",cwt="series-number-node",Jk="horizontal-resize-area-",tU="root",li="[&]",YC="-",zy="-",$O=28,WO=16,eU=16,hwt=.5,O1=50,gh;(function(r){r.Line="line",r.Bar="bar",r.Bullet="bullet"})(gh||(gh={}));var VO="square",zc="...",fwt="antv-s2",vm="valueRanges",UT={},rU="#000000",jC="#FFFFFF",dwt={data:[],totalData:[],fields:{rows:[],columns:[],values:[],customTreeItems:[],valueInCols:!0},meta:[],sortParams:[],filterParams:[]},ko,gr;(function(r){r.ROW="row",r.COL="col",r.TRAILING_ROW="trailingRow",r.TRAILING_COL="trailingCol",r.SCROLL="scroll",r.TOP="top",r.BOTTOM="bottom"})(gr||(gr={}));var Wn;(function(r){r.FROZEN_COL="frozenCol",r.FROZEN_ROW="frozenRow",r.FROZEN_TRAILING_COL="frozenTrailingCol",r.FROZEN_TRAILING_ROW="frozenTrailingRow"})(Wn||(Wn={}));var iU=(ko={},ko[gr.ROW]="frozenRowGroup",ko[gr.COL]="frozenColGroup",ko[gr.TRAILING_COL]="frozenTrailingColGroup",ko[gr.TRAILING_ROW]="frozenTrailingRowGroup",ko[gr.SCROLL]="panelScrollGroup",ko[gr.TOP]="frozenTopGroup",ko[gr.BOTTOM]="frozenBottomGroup",ko),yi;(function(r){r.CORNER_CELL_CLICK="cornerCellClick",r.DATA_CELL_CLICK="dataCellClick",r.MERGED_CELLS_CLICK="mergedCellsClick",r.ROW_COLUMN_CLICK="rowColumnClick",r.ROW_TEXT_CLICK="rowTextClick",r.HOVER="hover",r.BRUSH_SELECTION="brushSelection",r.ROW_BRUSH_SELECTION="rowBrushSelection",r.COL_BRUSH_SELECTION="colBrushSelection",r.COL_ROW_RESIZE="rowColResize",r.DATA_CELL_MULTI_SELECTION="dataCellMultiSelection",r.RANGE_SELECTION="rangeSelection",r.SELECTED_CELL_MOVE="selectedCellMove"})(yi||(yi={}));var bt;(function(r){r.ALL_SELECTED="allSelected",r.SELECTED="selected",r.BRUSH_SELECTED="brushSelected",r.UNSELECTED="unselected",r.HOVER="hover",r.HOVER_FOCUS="hoverFocus",r.HIGHLIGHT="highlight",r.SEARCH_RESULT="searchResult",r.PREPARE_SELECT="prepareSelect"})(bt||(bt={}));var ut;(function(r){r.DATA_CELL="dataCell",r.HEADER_CELL="headerCell",r.ROW_CELL="rowCell",r.COL_CELL="colCell",r.CORNER_CELL="cornerCell",r.MERGED_CELL="mergedCell"})(ut||(ut={}));var ZC=800,mn={textOpacity:"fillOpacity",backgroundOpacity:"fillOpacity",backgroundColor:"fill",borderOpacity:"strokeOpacity",borderColor:"stroke",borderWidth:"lineWidth",opacity:"opacity"},vwt={textShape:["textOpacity"],textShapes:["textOpacity"],linkFieldShape:["opacity"],interactiveBgShape:["backgroundColor","backgroundOpacity"],interactiveBorderShape:["borderColor","borderOpacity","borderWidth"]},qC="interactionStateInfo",ai;(function(r){r.CLICK="click",r.UN_DRAGGED="unDragged",r.DRAGGED="dragged"})(ai||(ai={}));var ui;(function(r){r.SHIFT="Shift",r.COPY="c",r.ESC="Escape",r.META="Meta",r.CONTROL="Control",r.ARROW_UP="ArrowUp",r.ARROW_DOWN="ArrowDown",r.ARROW_LEFT="ArrowLeft",r.ARROW_RIGHT="ArrowRight"})(ui||(ui={}));var GO;(function(r){r.ASC="ASC",r.DESC="DESC"})(GO||(GO={}));var Gt;(function(r){r.HOVER="hover",r.CLICK="click",r.BRUSH_SELECTION="brushSelection",r.ROW_BRUSH_SELECTION="rowBrushSelection",r.COL_BRUSH_SELECTION="colBrushSelection",r.MULTI_SELECTION="multiSelection",r.RESIZE="resize"})(Gt||(Gt={}));var XO={x:{value:0,scroll:!1},y:{value:0,scroll:!1}},pm;(function(r){r.CONTENT="content",r.CANVAS="canvas"})(pm||(pm={}));var Dr;(function(r){r.SCROLL_UP="scrollUp",r.SCROLL_DOWN="scrollDown"})(Dr||(Dr={}));var gm;(function(r){r[r.SCROLL_UP=-1]="SCROLL_UP",r[r.SCROLL_DOWN=1]="SCROLL_DOWN"})(gm||(gm={}));var pwt="RESIZE_START_GUIDE_LINE",gwt="RESIZE_END_GUIDE_LINE",mwt="RESIZE_MASK",Jn;(function(r){r.Horizontal="col",r.Vertical="row"})(Jn||(Jn={}));var Ei;(function(r){r.Field="field",r.Cell="cell",r.Tree="tree",r.Series="series"})(Ei||(Ei={}));var mm;(function(r){r.ALL="all",r.CURRENT="current"})(mm||(mm={}));var nU=1,Au;(function(r){r.Adaptive="adaptive",r.ColAdaptive="colAdaptive",r.Compact="compact"})(Au||(Au={}));var YO=120,ywt={layoutWidthType:Au.Adaptive,showTreeLeafNodeAlignDot:!1,collapsedRows:{},collapsedCols:{},cellCfg:{width:96,height:30},rowCfg:{width:null,widthByField:{},heightByField:{}},colCfg:{height:30,widthByFieldValue:{},heightByField:{}},device:"pc"},_wt={width:600,height:480,debug:!1,hierarchyType:"grid",conditions:{},totals:{},tooltip:{showTooltip:!1,autoAdjustBoundary:"body",operation:{hiddenColumns:!1,trend:!1,sort:!1,menus:[]}},interaction:{linkFields:[],hiddenColumnFields:[],selectedCellsSpotlight:!1,hoverHighlight:!0,hoverFocus:{duration:ZC},scrollSpeedRatio:{horizontal:1,vertical:1},autoResetSheetStyle:!0,brushSelection:{data:!0,row:!1,col:!1},multiSelection:!0,rangeSelection:!0,scrollbarPosition:pm.CONTENT,resize:{rowCellVertical:!0,cornerCellHorizontal:!0,colCellHorizontal:!0,colCellVertical:!0,rowResizeType:mm.ALL},eventListenerOptions:!1,selectedCellHighlight:!1,overscrollBehavior:"auto"},showSeriesNumber:!1,customSVGIcons:[],showDefaultHeaderActionIcon:!1,headerActionIcons:[],style:ywt,frozenRowHeader:!0,frozenRowCount:0,frozenColCount:0,frozenTrailingRowCount:0,frozenTrailingColCount:0,hdAdapter:!0,cornerText:"",cornerExtraFieldText:"",placeholder:zy,supportCSSTransform:!1,devicePixelRatio:window.devicePixelRatio},xwt=typeof global=="object"&&global&&global.Object===Object&&global,aU=xwt,Cwt=typeof self=="object"&&self&&self.Object===Object&&self,Ewt=aU||Cwt||Function("return this")(),Vr=Ewt,Swt=Vr.Symbol,di=Swt,oU=Object.prototype,Awt=oU.hasOwnProperty,Twt=oU.toString,wf=di?di.toStringTag:void 0;function bwt(r){var t=Awt.call(r,wf),e=r[wf];try{r[wf]=void 0;var i=!0}catch{}var n=Twt.call(r);return i&&(t?r[wf]=e:delete r[wf]),n}var wwt=Object.prototype,Rwt=wwt.toString;function Mwt(r){return Rwt.call(r)}var Iwt="[object Null]",Lwt="[object Undefined]",jO=di?di.toStringTag:void 0;function Oi(r){return r==null?r===void 0?Lwt:Iwt:jO&&jO in Object(r)?bwt(r):Mwt(r)}function hr(r){return r!=null&&typeof r=="object"}var Owt="[object Symbol]";function bn(r){return typeof r=="symbol"||hr(r)&&Oi(r)==Owt}var Pwt=0/0;function ZO(r){return typeof r=="number"?r:bn(r)?Pwt:+r}function Qe(r,t){for(var e=-1,i=r==null?0:r.length,n=Array(i);++e<i;)n[e]=t(r[e],e,r);return n}var Fwt=Array.isArray,Lt=Fwt,Bwt=1/0,qO=di?di.prototype:void 0,KO=qO?qO.toString:void 0;function wn(r){if(typeof r=="string")return r;if(Lt(r))return Qe(r,wn)+"";if(bn(r))return KO?KO.call(r):"";var t=r+"";return t=="0"&&1/r==-Bwt?"-0":t}function Hy(r,t){return function(e,i){var n;if(e===void 0&&i===void 0)return t;if(e!==void 0&&(n=e),i!==void 0){if(n===void 0)return i;typeof e=="string"||typeof i=="string"?(e=wn(e),i=wn(i)):(e=ZO(e),i=ZO(i)),n=r(e,i)}return n}}var Dwt=Hy(function(r,t){return r+t},0),Nwt=Dwt,kwt=/\s/;function sU(r){for(var t=r.length;t--&&kwt.test(r.charAt(t)););return t}var Uwt=/^\s+/;function lU(r){return r&&r.slice(0,sU(r)+1).replace(Uwt,"")}function Fe(r){var t=typeof r;return r!=null&&(t=="object"||t=="function")}var QO=0/0,zwt=/^[-+]0x[0-9a-f]+$/i,Hwt=/^0b[01]+$/i,$wt=/^0o[0-7]+$/i,Wwt=parseInt;function En(r){if(typeof r=="number")return r;if(bn(r))return QO;if(Fe(r)){var t=typeof r.valueOf=="function"?r.valueOf():r;r=Fe(t)?t+"":t}if(typeof r!="string")return r===0?r:+r;r=lU(r);var e=Hwt.test(r);return e||$wt.test(r)?Wwt(r.slice(2),e?2:8):zwt.test(r)?QO:+r}var JO=1/0,Vwt=17976931348623157e292;function rs(r){if(!r)return r===0?r:0;if(r=En(r),r===JO||r===-JO){var t=r<0?-1:1;return t*Vwt}return r===r?r:0}function ee(r){var t=rs(r),e=t%1;return t===t?e?t-e:t:0}var Gwt="Expected a function";function Xwt(r,t){if(typeof t!="function")throw new TypeError(Gwt);return r=ee(r),function(){if(--r<1)return t.apply(this,arguments)}}function gi(r){return r}var Ywt="[object AsyncFunction]",jwt="[object Function]",Zwt="[object GeneratorFunction]",qwt="[object Proxy]";function ri(r){if(!Fe(r))return!1;var t=Oi(r);return t==jwt||t==Zwt||t==Ywt||t==qwt}var Kwt=Vr["__core-js_shared__"],c0=Kwt,tP=function(){var r=/[^.]+$/.exec(c0&&c0.keys&&c0.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function Qwt(r){return!!tP&&tP in r}var Jwt=Function.prototype,tRt=Jwt.toString;function Gu(r){if(r!=null){try{return tRt.call(r)}catch{}try{return r+""}catch{}}return""}var eRt=/[\\^$.*+?()[\]{}|]/g,rRt=/^\[object .+?Constructor\]$/,iRt=Function.prototype,nRt=Object.prototype,aRt=iRt.toString,oRt=nRt.hasOwnProperty,sRt=RegExp("^"+aRt.call(oRt).replace(eRt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function uU(r){if(!Fe(r)||Qwt(r))return!1;var t=ri(r)?sRt:rRt;return t.test(Gu(r))}function lRt(r,t){return r==null?void 0:r[t]}function Xu(r,t){var e=lRt(r,t);return uU(e)?e:void 0}var uRt=Xu(Vr,"WeakMap"),qd=uRt,cRt=qd&&new qd,ym=cRt,hRt=ym?function(r,t){return ym.set(r,t),r}:gi,cU=hRt,eP=Object.create,fRt=function(){function r(){}return function(t){if(!Fe(t))return{};if(eP)return eP(t);r.prototype=t;var e=new r;return r.prototype=void 0,e}}(),zh=fRt;function Kd(r){return function(){var t=arguments;switch(t.length){case 0:return new r;case 1:return new r(t[0]);case 2:return new r(t[0],t[1]);case 3:return new r(t[0],t[1],t[2]);case 4:return new r(t[0],t[1],t[2],t[3]);case 5:return new r(t[0],t[1],t[2],t[3],t[4]);case 6:return new r(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new r(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var e=zh(r.prototype),i=r.apply(e,t);return Fe(i)?i:e}}var dRt=1;function vRt(r,t,e){var i=t&dRt,n=Kd(r);function a(){var o=this&&this!==Vr&&this instanceof a?n:r;return o.apply(i?e:this,arguments)}return a}function Rn(r,t,e){switch(e.length){case 0:return r.call(t);case 1:return r.call(t,e[0]);case 2:return r.call(t,e[0],e[1]);case 3:return r.call(t,e[0],e[1],e[2])}return r.apply(t,e)}var pRt=Math.max;function hU(r,t,e,i){for(var n=-1,a=r.length,o=e.length,s=-1,l=t.length,u=pRt(a-o,0),c=Array(l+u),h=!i;++s<l;)c[s]=t[s];for(;++n<o;)(h||n<a)&&(c[e[n]]=r[n]);for(;u--;)c[s++]=r[n++];return c}var gRt=Math.max;function fU(r,t,e,i){for(var n=-1,a=r.length,o=-1,s=e.length,l=-1,u=t.length,c=gRt(a-s,0),h=Array(c+u),f=!i;++n<c;)h[n]=r[n];for(var d=n;++l<u;)h[d+l]=t[l];for(;++o<s;)(f||n<a)&&(h[d+e[o]]=r[n++]);return h}function mRt(r,t){for(var e=r.length,i=0;e--;)r[e]===t&&++i;return i}function $y(){}var yRt=4294967295;function fe(r){this.__wrapped__=r,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=yRt,this.__views__=[]}fe.prototype=zh($y.prototype);fe.prototype.constructor=fe;function Wy(){}var _Rt=ym?function(r){return ym.get(r)}:Wy,zT=_Rt,xRt={},Hc=xRt,CRt=Object.prototype,ERt=CRt.hasOwnProperty;function h0(r){for(var t=r.name+"",e=Hc[t],i=ERt.call(Hc,t)?e.length:0;i--;){var n=e[i],a=n.func;if(a==null||a==r)return n.name}return t}function aa(r,t){this.__wrapped__=r,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=void 0}aa.prototype=zh($y.prototype);aa.prototype.constructor=aa;function Ji(r,t){var e=-1,i=r.length;for(t||(t=Array(i));++e<i;)t[e]=r[e];return t}function dU(r){if(r instanceof fe)return r.clone();var t=new aa(r.__wrapped__,r.__chain__);return t.__actions__=Ji(r.__actions__),t.__index__=r.__index__,t.__values__=r.__values__,t}var SRt=Object.prototype,ARt=SRt.hasOwnProperty;function L(r){if(hr(r)&&!Lt(r)&&!(r instanceof fe)){if(r instanceof aa)return r;if(ARt.call(r,"__wrapped__"))return dU(r)}return new aa(r)}L.prototype=$y.prototype;L.prototype.constructor=L;function KC(r){var t=h0(r),e=L[t];if(typeof e!="function"||!(t in fe.prototype))return!1;if(r===e)return!0;var i=zT(e);return!!i&&r===i[0]}var TRt=800,bRt=16,wRt=Date.now;function vU(r){var t=0,e=0;return function(){var i=wRt(),n=bRt-(i-e);if(e=i,n>0){if(++t>=TRt)return arguments[0]}else t=0;return r.apply(void 0,arguments)}}var RRt=vU(cU),pU=RRt,MRt=/\{\n\/\* \[wrapped with (.+)\] \*/,IRt=/,? & /;function LRt(r){var t=r.match(MRt);return t?t[1].split(IRt):[]}var ORt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/;function PRt(r,t){var e=t.length;if(!e)return r;var i=e-1;return t[i]=(e>1?"& ":"")+t[i],t=t.join(e>2?", ":" "),r.replace(ORt,`{
/* [wrapped with `+t+`] */
`)}function $c(r){return function(){return r}}var FRt=function(){try{var r=Xu(Object,"defineProperty");return r({},"",{}),r}catch{}}(),_m=FRt,BRt=_m?function(r,t){return _m(r,"toString",{configurable:!0,enumerable:!1,value:$c(t),writable:!0})}:gi,DRt=BRt,NRt=vU(DRt),HT=NRt;function fa(r,t){for(var e=-1,i=r==null?0:r.length;++e<i&&t(r[e],e,r)!==!1;);return r}function Vy(r,t,e,i){for(var n=r.length,a=e+(i?1:-1);i?a--:++a<n;)if(t(r[a],a,r))return a;return-1}function gU(r){return r!==r}function kRt(r,t,e){for(var i=e-1,n=r.length;++i<n;)if(r[i]===t)return i;return-1}function Hh(r,t,e){return t===t?kRt(r,t,e):Vy(r,gU,e)}function Gy(r,t){var e=r==null?0:r.length;return!!e&&Hh(r,t,0)>-1}var URt=1,zRt=2,HRt=8,$Rt=16,WRt=32,VRt=64,GRt=128,XRt=256,YRt=512,jRt=[["ary",GRt],["bind",URt],["bindKey",zRt],["curry",HRt],["curryRight",$Rt],["flip",YRt],["partial",WRt],["partialRight",VRt],["rearg",XRt]];function ZRt(r,t){return fa(jRt,function(e){var i="_."+e[0];t&e[1]&&!Gy(r,i)&&r.push(i)}),r.sort()}function mU(r,t,e){var i=t+"";return HT(r,PRt(i,ZRt(LRt(i),e)))}var qRt=1,KRt=2,QRt=4,JRt=8,rP=32,iP=64;function yU(r,t,e,i,n,a,o,s,l,u){var c=t&JRt,h=c?o:void 0,f=c?void 0:o,d=c?a:void 0,v=c?void 0:a;t|=c?rP:iP,t&=~(c?iP:rP),t&QRt||(t&=~(qRt|KRt));var p=[r,t,n,d,h,v,f,s,l,u],g=e.apply(void 0,p);return KC(r)&&pU(g,p),g.placeholder=i,mU(g,r,t)}function $h(r){var t=r;return t.placeholder}var tMt=9007199254740991,eMt=/^(?:0|[1-9]\d*)$/;function fs(r,t){var e=typeof r;return t=t??tMt,!!t&&(e=="number"||e!="symbol"&&eMt.test(r))&&r>-1&&r%1==0&&r<t}var rMt=Math.min;function iMt(r,t){for(var e=r.length,i=rMt(t.length,e),n=Ji(r);i--;){var a=t[i];r[i]=fs(a,e)?n[a]:void 0}return r}var nP="__lodash_placeholder__";function al(r,t){for(var e=-1,i=r.length,n=0,a=[];++e<i;){var o=r[e];(o===t||o===nP)&&(r[e]=nP,a[n++]=e)}return a}var nMt=1,aMt=2,oMt=8,sMt=16,lMt=128,uMt=512;function Xy(r,t,e,i,n,a,o,s,l,u){var c=t&lMt,h=t&nMt,f=t&aMt,d=t&(oMt|sMt),v=t&uMt,p=f?void 0:Kd(r);function g(){for(var m=arguments.length,y=Array(m),_=m;_--;)y[_]=arguments[_];if(d)var x=$h(g),C=mRt(y,x);if(i&&(y=hU(y,i,n,d)),a&&(y=fU(y,a,o,d)),m-=C,d&&m<u){var A=al(y,x);return yU(r,t,Xy,g.placeholder,e,y,A,s,l,u-m)}var b=h?e:this,R=f?b[r]:r;return m=y.length,s?y=iMt(y,s):v&&m>1&&y.reverse(),c&&l<m&&(y.length=l),this&&this!==Vr&&this instanceof g&&(R=p||Kd(R)),R.apply(b,y)}return g}function cMt(r,t,e){var i=Kd(r);function n(){for(var a=arguments.length,o=Array(a),s=a,l=$h(n);s--;)o[s]=arguments[s];var u=a<3&&o[0]!==l&&o[a-1]!==l?[]:al(o,l);if(a-=u.length,a<e)return yU(r,t,Xy,n.placeholder,void 0,o,u,void 0,void 0,e-a);var c=this&&this!==Vr&&this instanceof n?i:r;return Rn(c,this,o)}return n}var hMt=1;function fMt(r,t,e,i){var n=t&hMt,a=Kd(r);function o(){for(var s=-1,l=arguments.length,u=-1,c=i.length,h=Array(c+l),f=this&&this!==Vr&&this instanceof o?a:r;++u<c;)h[u]=i[u];for(;l--;)h[u++]=arguments[++s];return Rn(f,n?e:this,h)}return o}var aP="__lodash_placeholder__",P1=1,dMt=2,vMt=4,oP=8,Rf=128,sP=256,pMt=Math.min;function gMt(r,t){var e=r[1],i=t[1],n=e|i,a=n<(P1|dMt|Rf),o=i==Rf&&e==oP||i==Rf&&e==sP&&r[7].length<=t[8]||i==(Rf|sP)&&t[7].length<=t[8]&&e==oP;if(!(a||o))return r;i&P1&&(r[2]=t[2],n|=e&P1?0:vMt);var s=t[3];if(s){var l=r[3];r[3]=l?hU(l,s,t[4]):s,r[4]=l?al(r[3],aP):t[4]}return s=t[5],s&&(l=r[5],r[5]=l?fU(l,s,t[6]):s,r[6]=l?al(r[5],aP):t[6]),s=t[7],s&&(r[7]=s),i&Rf&&(r[8]=r[8]==null?t[8]:pMt(r[8],t[8])),r[9]==null&&(r[9]=t[9]),r[0]=t[0],r[1]=n,r}var mMt="Expected a function",lP=1,yMt=2,F1=8,B1=16,D1=32,uP=64,cP=Math.max;function ds(r,t,e,i,n,a,o,s){var l=t&yMt;if(!l&&typeof r!="function")throw new TypeError(mMt);var u=i?i.length:0;if(u||(t&=~(D1|uP),i=n=void 0),o=o===void 0?o:cP(ee(o),0),s=s===void 0?s:ee(s),u-=n?n.length:0,t&uP){var c=i,h=n;i=n=void 0}var f=l?void 0:zT(r),d=[r,t,e,i,n,c,h,a,o,s];if(f&&gMt(d,f),r=d[0],t=d[1],e=d[2],i=d[3],n=d[4],s=d[9]=d[9]===void 0?l?0:r.length:cP(d[9]-u,0),!s&&t&(F1|B1)&&(t&=~(F1|B1)),!t||t==lP)var v=vRt(r,t,e);else t==F1||t==B1?v=cMt(r,t,s):(t==D1||t==(lP|D1))&&!n.length?v=fMt(r,t,e,i):v=Xy.apply(void 0,d);var p=f?cU:pU;return mU(p(v,d),r,t)}var _Mt=128;function _U(r,t,e){return t=e?void 0:t,t=r&&t==null?r.length:t,ds(r,_Mt,void 0,void 0,void 0,void 0,t)}function vs(r,t,e){t=="__proto__"&&_m?_m(r,t,{configurable:!0,enumerable:!0,value:e,writable:!0}):r[t]=e}function Va(r,t){return r===t||r!==r&&t!==t}var xMt=Object.prototype,CMt=xMt.hasOwnProperty;function Jv(r,t,e){var i=r[t];(!(CMt.call(r,t)&&Va(i,e))||e===void 0&&!(t in r))&&vs(r,t,e)}function Io(r,t,e,i){var n=!e;e||(e={});for(var a=-1,o=t.length;++a<o;){var s=t[a],l=i?i(e[s],r[s],s,e,r):void 0;l===void 0&&(l=r[s]),n?vs(e,s,l):Jv(e,s,l)}return e}var hP=Math.max;function xU(r,t,e){return t=hP(t===void 0?r.length-1:t,0),function(){for(var i=arguments,n=-1,a=hP(i.length-t,0),o=Array(a);++n<a;)o[n]=i[t+n];n=-1;for(var s=Array(t+1);++n<t;)s[n]=i[n];return s[t]=e(o),Rn(r,this,s)}}function ae(r,t){return HT(xU(r,t,gi),r+"")}var EMt=9007199254740991;function Yy(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=EMt}function hn(r){return r!=null&&Yy(r.length)&&!ri(r)}function Ii(r,t,e){if(!Fe(e))return!1;var i=typeof t;return(i=="number"?hn(e)&&fs(t,e.length):i=="string"&&t in e)?Va(e[t],r):!1}function Wh(r){return ae(function(t,e){var i=-1,n=e.length,a=n>1?e[n-1]:void 0,o=n>2?e[2]:void 0;for(a=r.length>3&&typeof a=="function"?(n--,a):void 0,o&&Ii(e[0],e[1],o)&&(a=n<3?void 0:a,n=1),t=Object(t);++i<n;){var s=e[i];s&&r(t,s,i,a)}return t})}var SMt=Object.prototype;function tp(r){var t=r&&r.constructor,e=typeof t=="function"&&t.prototype||SMt;return r===e}function $T(r,t){for(var e=-1,i=Array(r);++e<r;)i[e]=t(e);return i}var AMt="[object Arguments]";function fP(r){return hr(r)&&Oi(r)==AMt}var CU=Object.prototype,TMt=CU.hasOwnProperty,bMt=CU.propertyIsEnumerable,wMt=fP(function(){return arguments}())?fP:function(r){return hr(r)&&TMt.call(r,"callee")&&!bMt.call(r,"callee")},Tu=wMt;function WT(){return!1}var EU=typeof exports=="object"&&exports&&!exports.nodeType&&exports,dP=EU&&typeof module=="object"&&module&&!module.nodeType&&module,RMt=dP&&dP.exports===EU,vP=RMt?Vr.Buffer:void 0,MMt=vP?vP.isBuffer:void 0,IMt=MMt||WT,ol=IMt,LMt="[object Arguments]",OMt="[object Array]",PMt="[object Boolean]",FMt="[object Date]",BMt="[object Error]",DMt="[object Function]",NMt="[object Map]",kMt="[object Number]",UMt="[object Object]",zMt="[object RegExp]",HMt="[object Set]",$Mt="[object String]",WMt="[object WeakMap]",VMt="[object ArrayBuffer]",GMt="[object DataView]",XMt="[object Float32Array]",YMt="[object Float64Array]",jMt="[object Int8Array]",ZMt="[object Int16Array]",qMt="[object Int32Array]",KMt="[object Uint8Array]",QMt="[object Uint8ClampedArray]",JMt="[object Uint16Array]",t3t="[object Uint32Array]",Xe={};Xe[XMt]=Xe[YMt]=Xe[jMt]=Xe[ZMt]=Xe[qMt]=Xe[KMt]=Xe[QMt]=Xe[JMt]=Xe[t3t]=!0;Xe[LMt]=Xe[OMt]=Xe[VMt]=Xe[PMt]=Xe[GMt]=Xe[FMt]=Xe[BMt]=Xe[DMt]=Xe[NMt]=Xe[kMt]=Xe[UMt]=Xe[zMt]=Xe[HMt]=Xe[$Mt]=Xe[WMt]=!1;function e3t(r){return hr(r)&&Yy(r.length)&&!!Xe[Oi(r)]}function Mn(r){return function(t){return r(t)}}var SU=typeof exports=="object"&&exports&&!exports.nodeType&&exports,dd=SU&&typeof module=="object"&&module&&!module.nodeType&&module,r3t=dd&&dd.exports===SU,N1=r3t&&aU.process,i3t=function(){try{var r=dd&&dd.require&&dd.require("util").types;return r||N1&&N1.binding&&N1.binding("util")}catch{}}(),oa=i3t,pP=oa&&oa.isTypedArray,n3t=pP?Mn(pP):e3t,Vh=n3t,a3t=Object.prototype,o3t=a3t.hasOwnProperty;function AU(r,t){var e=Lt(r),i=!e&&Tu(r),n=!e&&!i&&ol(r),a=!e&&!i&&!n&&Vh(r),o=e||i||n||a,s=o?$T(r.length,String):[],l=s.length;for(var u in r)(t||o3t.call(r,u))&&!(o&&(u=="length"||n&&(u=="offset"||u=="parent")||a&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||fs(u,l)))&&s.push(u);return s}function TU(r,t){return function(e){return r(t(e))}}var s3t=TU(Object.keys,Object),l3t=s3t,u3t=Object.prototype,c3t=u3t.hasOwnProperty;function VT(r){if(!tp(r))return l3t(r);var t=[];for(var e in Object(r))c3t.call(r,e)&&e!="constructor"&&t.push(e);return t}function ar(r){return hn(r)?AU(r):VT(r)}var h3t=Object.prototype,f3t=h3t.hasOwnProperty,d3t=Wh(function(r,t){if(tp(t)||hn(t)){Io(t,ar(t),r);return}for(var e in t)f3t.call(t,e)&&Jv(r,e,t[e])}),bU=d3t;function v3t(r){var t=[];if(r!=null)for(var e in Object(r))t.push(e);return t}var p3t=Object.prototype,g3t=p3t.hasOwnProperty;function m3t(r){if(!Fe(r))return v3t(r);var t=tp(r),e=[];for(var i in r)i=="constructor"&&(t||!g3t.call(r,i))||e.push(i);return e}function fn(r){return hn(r)?AU(r,!0):m3t(r)}var y3t=Wh(function(r,t){Io(t,fn(t),r)}),gP=y3t,_3t=Wh(function(r,t,e,i){Io(t,fn(t),r,i)}),xm=_3t,x3t=Wh(function(r,t,e,i){Io(t,ar(t),r,i)}),C3t=x3t,E3t=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,S3t=/^\w*$/;function GT(r,t){if(Lt(r))return!1;var e=typeof r;return e=="number"||e=="symbol"||e=="boolean"||r==null||bn(r)?!0:S3t.test(r)||!E3t.test(r)||t!=null&&r in Object(t)}var A3t=Xu(Object,"create"),Qd=A3t;function T3t(){this.__data__=Qd?Qd(null):{},this.size=0}function b3t(r){var t=this.has(r)&&delete this.__data__[r];return this.size-=t?1:0,t}var w3t="__lodash_hash_undefined__",R3t=Object.prototype,M3t=R3t.hasOwnProperty;function I3t(r){var t=this.__data__;if(Qd){var e=t[r];return e===w3t?void 0:e}return M3t.call(t,r)?t[r]:void 0}var L3t=Object.prototype,O3t=L3t.hasOwnProperty;function P3t(r){var t=this.__data__;return Qd?t[r]!==void 0:O3t.call(t,r)}var F3t="__lodash_hash_undefined__";function B3t(r,t){var e=this.__data__;return this.size+=this.has(r)?0:1,e[r]=Qd&&t===void 0?F3t:t,this}function bu(r){var t=-1,e=r==null?0:r.length;for(this.clear();++t<e;){var i=r[t];this.set(i[0],i[1])}}bu.prototype.clear=T3t;bu.prototype.delete=b3t;bu.prototype.get=I3t;bu.prototype.has=P3t;bu.prototype.set=B3t;function D3t(){this.__data__=[],this.size=0}function jy(r,t){for(var e=r.length;e--;)if(Va(r[e][0],t))return e;return-1}var N3t=Array.prototype,k3t=N3t.splice;function U3t(r){var t=this.__data__,e=jy(t,r);if(e<0)return!1;var i=t.length-1;return e==i?t.pop():k3t.call(t,e,1),--this.size,!0}function z3t(r){var t=this.__data__,e=jy(t,r);return e<0?void 0:t[e][1]}function H3t(r){return jy(this.__data__,r)>-1}function $3t(r,t){var e=this.__data__,i=jy(e,r);return i<0?(++this.size,e.push([r,t])):e[i][1]=t,this}function ps(r){var t=-1,e=r==null?0:r.length;for(this.clear();++t<e;){var i=r[t];this.set(i[0],i[1])}}ps.prototype.clear=D3t;ps.prototype.delete=U3t;ps.prototype.get=z3t;ps.prototype.has=H3t;ps.prototype.set=$3t;var W3t=Xu(Vr,"Map"),Jd=W3t;function V3t(){this.size=0,this.__data__={hash:new bu,map:new(Jd||ps),string:new bu}}function G3t(r){var t=typeof r;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?r!=="__proto__":r===null}function Zy(r,t){var e=r.__data__;return G3t(t)?e[typeof t=="string"?"string":"hash"]:e.map}function X3t(r){var t=Zy(this,r).delete(r);return this.size-=t?1:0,t}function Y3t(r){return Zy(this,r).get(r)}function j3t(r){return Zy(this,r).has(r)}function Z3t(r,t){var e=Zy(this,r),i=e.size;return e.set(r,t),this.size+=e.size==i?0:1,this}function gs(r){var t=-1,e=r==null?0:r.length;for(this.clear();++t<e;){var i=r[t];this.set(i[0],i[1])}}gs.prototype.clear=V3t;gs.prototype.delete=X3t;gs.prototype.get=Y3t;gs.prototype.has=j3t;gs.prototype.set=Z3t;var q3t="Expected a function";function Yu(r,t){if(typeof r!="function"||t!=null&&typeof t!="function")throw new TypeError(q3t);var e=function(){var i=arguments,n=t?t.apply(this,i):i[0],a=e.cache;if(a.has(n))return a.get(n);var o=r.apply(this,i);return e.cache=a.set(n,o)||a,o};return e.cache=new(Yu.Cache||gs),e}Yu.Cache=gs;var K3t=500;function Q3t(r){var t=Yu(r,function(i){return e.size===K3t&&e.clear(),i}),e=t.cache;return t}var J3t=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,tIt=/\\(\\)?/g,eIt=Q3t(function(r){var t=[];return r.charCodeAt(0)===46&&t.push(""),r.replace(J3t,function(e,i,n,a){t.push(n?a.replace(tIt,"$1"):i||e)}),t}),wU=eIt;function Re(r){return r==null?"":wn(r)}function gl(r,t){return Lt(r)?r:GT(r,t)?[r]:wU(Re(r))}var rIt=1/0;function Lo(r){if(typeof r=="string"||bn(r))return r;var t=r+"";return t=="0"&&1/r==-rIt?"-0":t}function ju(r,t){t=gl(t,r);for(var e=0,i=t.length;r!=null&&e<i;)r=r[Lo(t[e++])];return e&&e==i?r:void 0}function kt(r,t,e){var i=r==null?void 0:ju(r,t);return i===void 0?e:i}function XT(r,t){for(var e=-1,i=t.length,n=Array(i),a=r==null;++e<i;)n[e]=a?void 0:kt(r,t[e]);return n}function ml(r,t){for(var e=-1,i=t.length,n=r.length;++e<i;)r[n+e]=t[e];return r}var mP=di?di.isConcatSpreadable:void 0;function iIt(r){return Lt(r)||Tu(r)||!!(mP&&r&&r[mP])}function ii(r,t,e,i,n){var a=-1,o=r.length;for(e||(e=iIt),n||(n=[]);++a<o;){var s=r[a];t>0&&e(s)?t>1?ii(s,t-1,e,i,n):ml(n,s):i||(n[n.length]=s)}return n}function RU(r){var t=r==null?0:r.length;return t?ii(r,1):[]}function ms(r){return HT(xU(r,void 0,RU),r+"")}var nIt=ms(XT),aIt=nIt,oIt=TU(Object.getPrototypeOf,Object),qy=oIt,sIt="[object Object]",lIt=Function.prototype,uIt=Object.prototype,MU=lIt.toString,cIt=uIt.hasOwnProperty,hIt=MU.call(Object);function ep(r){if(!hr(r)||Oi(r)!=sIt)return!1;var t=qy(r);if(t===null)return!0;var e=cIt.call(t,"constructor")&&t.constructor;return typeof e=="function"&&e instanceof e&&MU.call(e)==hIt}var fIt="[object DOMException]",dIt="[object Error]";function YT(r){if(!hr(r))return!1;var t=Oi(r);return t==dIt||t==fIt||typeof r.message=="string"&&typeof r.name=="string"&&!ep(r)}var vIt=ae(function(r,t){try{return Rn(r,void 0,t)}catch(e){return YT(e)?e:new Error(e)}}),IU=vIt,pIt="Expected a function";function LU(r,t){var e;if(typeof t!="function")throw new TypeError(pIt);return r=ee(r),function(){return--r>0&&(e=t.apply(this,arguments)),r<=1&&(t=void 0),e}}var gIt=1,mIt=32,jT=ae(function(r,t,e){var i=gIt;if(e.length){var n=al(e,$h(jT));i|=mIt}return ds(r,i,t,e,n)});jT.placeholder={};var OU=jT,yIt=ms(function(r,t){return fa(t,function(e){e=Lo(e),vs(r,e,OU(r[e],r))}),r}),_It=yIt,xIt=1,CIt=2,EIt=32,ZT=ae(function(r,t,e){var i=xIt|CIt;if(e.length){var n=al(e,$h(ZT));i|=EIt}return ds(t,i,r,e,n)});ZT.placeholder={};var SIt=ZT;function sa(r,t,e){var i=-1,n=r.length;t<0&&(t=-t>n?0:n+t),e=e>n?n:e,e<0&&(e+=n),n=t>e?0:e-t>>>0,t>>>=0;for(var a=Array(n);++i<n;)a[i]=r[i+t];return a}function yl(r,t,e){var i=r.length;return e=e===void 0?i:e,!t&&e>=i?r:sa(r,t,e)}var AIt="\\ud800-\\udfff",TIt="\\u0300-\\u036f",bIt="\\ufe20-\\ufe2f",wIt="\\u20d0-\\u20ff",RIt=TIt+bIt+wIt,MIt="\\ufe0e\\ufe0f",IIt="\\u200d",LIt=RegExp("["+IIt+AIt+RIt+MIt+"]");function Gh(r){return LIt.test(r)}function OIt(r){return r.split("")}var PU="\\ud800-\\udfff",PIt="\\u0300-\\u036f",FIt="\\ufe20-\\ufe2f",BIt="\\u20d0-\\u20ff",DIt=PIt+FIt+BIt,NIt="\\ufe0e\\ufe0f",kIt="["+PU+"]",QC="["+DIt+"]",JC="\\ud83c[\\udffb-\\udfff]",UIt="(?:"+QC+"|"+JC+")",FU="[^"+PU+"]",BU="(?:\\ud83c[\\udde6-\\uddff]){2}",DU="[\\ud800-\\udbff][\\udc00-\\udfff]",zIt="\\u200d",NU=UIt+"?",kU="["+NIt+"]?",HIt="(?:"+zIt+"(?:"+[FU,BU,DU].join("|")+")"+kU+NU+")*",$It=kU+NU+HIt,WIt="(?:"+[FU+QC+"?",QC,BU,DU,kIt].join("|")+")",VIt=RegExp(JC+"(?="+JC+")|"+WIt+$It,"g");function GIt(r){return r.match(VIt)||[]}function Na(r){return Gh(r)?GIt(r):OIt(r)}function UU(r){return function(t){t=Re(t);var e=Gh(t)?Na(t):void 0,i=e?e[0]:t.charAt(0),n=e?yl(e,1).join(""):t.slice(1);return i[r]()+n}}var XIt=UU("toUpperCase"),qT=XIt;function zU(r){return qT(Re(r).toLowerCase())}function KT(r,t,e,i){var n=-1,a=r==null?0:r.length;for(i&&a&&(e=r[++n]);++n<a;)e=t(e,r[n],n,r);return e}function QT(r){return function(t){return r==null?void 0:r[t]}}var YIt={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},jIt=QT(YIt),ZIt=jIt,qIt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,KIt="\\u0300-\\u036f",QIt="\\ufe20-\\ufe2f",JIt="\\u20d0-\\u20ff",tLt=KIt+QIt+JIt,eLt="["+tLt+"]",rLt=RegExp(eLt,"g");function HU(r){return r=Re(r),r&&r.replace(qIt,ZIt).replace(rLt,"")}var iLt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function nLt(r){return r.match(iLt)||[]}var aLt=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function oLt(r){return aLt.test(r)}var $U="\\ud800-\\udfff",sLt="\\u0300-\\u036f",lLt="\\ufe20-\\ufe2f",uLt="\\u20d0-\\u20ff",cLt=sLt+lLt+uLt,WU="\\u2700-\\u27bf",VU="a-z\\xdf-\\xf6\\xf8-\\xff",hLt="\\xac\\xb1\\xd7\\xf7",fLt="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",dLt="\\u2000-\\u206f",vLt=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",GU="A-Z\\xc0-\\xd6\\xd8-\\xde",pLt="\\ufe0e\\ufe0f",XU=hLt+fLt+dLt+vLt,YU="['’]",yP="["+XU+"]",gLt="["+cLt+"]",jU="\\d+",mLt="["+WU+"]",ZU="["+VU+"]",qU="[^"+$U+XU+jU+WU+VU+GU+"]",yLt="\\ud83c[\\udffb-\\udfff]",_Lt="(?:"+gLt+"|"+yLt+")",xLt="[^"+$U+"]",KU="(?:\\ud83c[\\udde6-\\uddff]){2}",QU="[\\ud800-\\udbff][\\udc00-\\udfff]",pc="["+GU+"]",CLt="\\u200d",_P="(?:"+ZU+"|"+qU+")",ELt="(?:"+pc+"|"+qU+")",xP="(?:"+YU+"(?:d|ll|m|re|s|t|ve))?",CP="(?:"+YU+"(?:D|LL|M|RE|S|T|VE))?",JU=_Lt+"?",t9="["+pLt+"]?",SLt="(?:"+CLt+"(?:"+[xLt,KU,QU].join("|")+")"+t9+JU+")*",ALt="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",TLt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",bLt=t9+JU+SLt,wLt="(?:"+[mLt,KU,QU].join("|")+")"+bLt,RLt=RegExp([pc+"?"+ZU+"+"+xP+"(?="+[yP,pc,"$"].join("|")+")",ELt+"+"+CP+"(?="+[yP,pc+_P,"$"].join("|")+")",pc+"?"+_P+"+"+xP,pc+"+"+CP,TLt,ALt,jU,wLt].join("|"),"g");function MLt(r){return r.match(RLt)||[]}function e9(r,t,e){return r=Re(r),t=e?void 0:t,t===void 0?oLt(r)?MLt(r):nLt(r):r.match(t)||[]}var ILt="['’]",LLt=RegExp(ILt,"g");function Xh(r){return function(t){return KT(e9(HU(t).replace(LLt,"")),r,"")}}var OLt=Xh(function(r,t,e){return t=t.toLowerCase(),r+(e?zU(t):t)}),PLt=OLt;function FLt(){if(!arguments.length)return[];var r=arguments[0];return Lt(r)?r:[r]}var BLt=Vr.isFinite,DLt=Math.min;function JT(r){var t=Math[r];return function(e,i){if(e=En(e),i=i==null?0:DLt(ee(i),292),i&&BLt(e)){var n=(Re(e)+"e").split("e"),a=t(n[0]+"e"+(+n[1]+i));return n=(Re(a)+"e").split("e"),+(n[0]+"e"+(+n[1]-i))}return t(e)}}var NLt=JT("ceil"),kLt=NLt;function r9(r){var t=L(r);return t.__chain__=!0,t}var ULt=Math.ceil,zLt=Math.max;function HLt(r,t,e){(e?Ii(r,t,e):t===void 0)?t=1:t=zLt(ee(t),0);var i=r==null?0:r.length;if(!i||t<1)return[];for(var n=0,a=0,o=Array(ULt(i/t));n<i;)o[a++]=sa(r,n,n+=t);return o}function Zu(r,t,e){return r===r&&(e!==void 0&&(r=r<=e?r:e),t!==void 0&&(r=r>=t?r:t)),r}function Cm(r,t,e){return e===void 0&&(e=t,t=void 0),e!==void 0&&(e=En(e),e=e===e?e:0),t!==void 0&&(t=En(t),t=t===t?t:0),Zu(En(r),t,e)}function $Lt(){this.__data__=new ps,this.size=0}function WLt(r){var t=this.__data__,e=t.delete(r);return this.size=t.size,e}function VLt(r){return this.__data__.get(r)}function GLt(r){return this.__data__.has(r)}var XLt=200;function YLt(r,t){var e=this.__data__;if(e instanceof ps){var i=e.__data__;if(!Jd||i.length<XLt-1)return i.push([r,t]),this.size=++e.size,this;e=this.__data__=new gs(i)}return e.set(r,t),this.size=e.size,this}function La(r){var t=this.__data__=new ps(r);this.size=t.size}La.prototype.clear=$Lt;La.prototype.delete=WLt;La.prototype.get=VLt;La.prototype.has=GLt;La.prototype.set=YLt;function i9(r,t){return r&&Io(t,ar(t),r)}function jLt(r,t){return r&&Io(t,fn(t),r)}var n9=typeof exports=="object"&&exports&&!exports.nodeType&&exports,EP=n9&&typeof module=="object"&&module&&!module.nodeType&&module,ZLt=EP&&EP.exports===n9,SP=ZLt?Vr.Buffer:void 0,AP=SP?SP.allocUnsafe:void 0;function a9(r,t){if(t)return r.slice();var e=r.length,i=AP?AP(e):new r.constructor(e);return r.copy(i),i}function _l(r,t){for(var e=-1,i=r==null?0:r.length,n=0,a=[];++e<i;){var o=r[e];t(o,e,r)&&(a[n++]=o)}return a}function tb(){return[]}var qLt=Object.prototype,KLt=qLt.propertyIsEnumerable,TP=Object.getOwnPropertySymbols,QLt=TP?function(r){return r==null?[]:(r=Object(r),_l(TP(r),function(t){return KLt.call(r,t)}))}:tb,eb=QLt;function JLt(r,t){return Io(r,eb(r),t)}var tOt=Object.getOwnPropertySymbols,eOt=tOt?function(r){for(var t=[];r;)ml(t,eb(r)),r=qy(r);return t}:tb,o9=eOt;function rOt(r,t){return Io(r,o9(r),t)}function s9(r,t,e){var i=t(r);return Lt(r)?i:ml(i,e(r))}function tE(r){return s9(r,ar,eb)}function rb(r){return s9(r,fn,o9)}var iOt=Xu(Vr,"DataView"),eE=iOt,nOt=Xu(Vr,"Promise"),rE=nOt,aOt=Xu(Vr,"Set"),Wc=aOt,bP="[object Map]",oOt="[object Object]",wP="[object Promise]",RP="[object Set]",MP="[object WeakMap]",IP="[object DataView]",sOt=Gu(eE),lOt=Gu(Jd),uOt=Gu(rE),cOt=Gu(Wc),hOt=Gu(qd),Dl=Oi;(eE&&Dl(new eE(new ArrayBuffer(1)))!=IP||Jd&&Dl(new Jd)!=bP||rE&&Dl(rE.resolve())!=wP||Wc&&Dl(new Wc)!=RP||qd&&Dl(new qd)!=MP)&&(Dl=function(r){var t=Oi(r),e=t==oOt?r.constructor:void 0,i=e?Gu(e):"";if(i)switch(i){case sOt:return IP;case lOt:return bP;case uOt:return wP;case cOt:return RP;case hOt:return MP}return t});var Ao=Dl,fOt=Object.prototype,dOt=fOt.hasOwnProperty;function vOt(r){var t=r.length,e=new r.constructor(t);return t&&typeof r[0]=="string"&&dOt.call(r,"index")&&(e.index=r.index,e.input=r.input),e}var pOt=Vr.Uint8Array,Em=pOt;function ib(r){var t=new r.constructor(r.byteLength);return new Em(t).set(new Em(r)),t}function gOt(r,t){var e=t?ib(r.buffer):r.buffer;return new r.constructor(e,r.byteOffset,r.byteLength)}var mOt=/\w*$/;function yOt(r){var t=new r.constructor(r.source,mOt.exec(r));return t.lastIndex=r.lastIndex,t}var LP=di?di.prototype:void 0,OP=LP?LP.valueOf:void 0;function _Ot(r){return OP?Object(OP.call(r)):{}}function l9(r,t){var e=t?ib(r.buffer):r.buffer;return new r.constructor(e,r.byteOffset,r.length)}var xOt="[object Boolean]",COt="[object Date]",EOt="[object Map]",SOt="[object Number]",AOt="[object RegExp]",TOt="[object Set]",bOt="[object String]",wOt="[object Symbol]",ROt="[object ArrayBuffer]",MOt="[object DataView]",IOt="[object Float32Array]",LOt="[object Float64Array]",OOt="[object Int8Array]",POt="[object Int16Array]",FOt="[object Int32Array]",BOt="[object Uint8Array]",DOt="[object Uint8ClampedArray]",NOt="[object Uint16Array]",kOt="[object Uint32Array]";function UOt(r,t,e){var i=r.constructor;switch(t){case ROt:return ib(r);case xOt:case COt:return new i(+r);case MOt:return gOt(r,e);case IOt:case LOt:case OOt:case POt:case FOt:case BOt:case DOt:case NOt:case kOt:return l9(r,e);case EOt:return new i;case SOt:case bOt:return new i(r);case AOt:return yOt(r);case TOt:return new i;case wOt:return _Ot(r)}}function u9(r){return typeof r.constructor=="function"&&!tp(r)?zh(qy(r)):{}}var zOt="[object Map]";function HOt(r){return hr(r)&&Ao(r)==zOt}var PP=oa&&oa.isMap,$Ot=PP?Mn(PP):HOt,c9=$Ot,WOt="[object Set]";function VOt(r){return hr(r)&&Ao(r)==WOt}var FP=oa&&oa.isSet,GOt=FP?Mn(FP):VOt,h9=GOt,XOt=1,YOt=2,jOt=4,f9="[object Arguments]",ZOt="[object Array]",qOt="[object Boolean]",KOt="[object Date]",QOt="[object Error]",d9="[object Function]",JOt="[object GeneratorFunction]",tPt="[object Map]",ePt="[object Number]",v9="[object Object]",rPt="[object RegExp]",iPt="[object Set]",nPt="[object String]",aPt="[object Symbol]",oPt="[object WeakMap]",sPt="[object ArrayBuffer]",lPt="[object DataView]",uPt="[object Float32Array]",cPt="[object Float64Array]",hPt="[object Int8Array]",fPt="[object Int16Array]",dPt="[object Int32Array]",vPt="[object Uint8Array]",pPt="[object Uint8ClampedArray]",gPt="[object Uint16Array]",mPt="[object Uint32Array]",He={};He[f9]=He[ZOt]=He[sPt]=He[lPt]=He[qOt]=He[KOt]=He[uPt]=He[cPt]=He[hPt]=He[fPt]=He[dPt]=He[tPt]=He[ePt]=He[v9]=He[rPt]=He[iPt]=He[nPt]=He[aPt]=He[vPt]=He[pPt]=He[gPt]=He[mPt]=!0;He[QOt]=He[d9]=He[oPt]=!1;function ta(r,t,e,i,n,a){var o,s=t&XOt,l=t&YOt,u=t&jOt;if(e&&(o=n?e(r,i,n,a):e(r)),o!==void 0)return o;if(!Fe(r))return r;var c=Lt(r);if(c){if(o=vOt(r),!s)return Ji(r,o)}else{var h=Ao(r),f=h==d9||h==JOt;if(ol(r))return a9(r,s);if(h==v9||h==f9||f&&!n){if(o=l||f?{}:u9(r),!s)return l?rOt(r,jLt(o,r)):JLt(r,i9(o,r))}else{if(!He[h])return n?r:{};o=UOt(r,h,s)}}a||(a=new La);var d=a.get(r);if(d)return d;a.set(r,o),h9(r)?r.forEach(function(g){o.add(ta(g,t,e,g,r,a))}):c9(r)&&r.forEach(function(g,m){o.set(m,ta(g,t,e,m,r,a))});var v=u?l?rb:tE:l?fn:ar,p=c?void 0:v(r);return fa(p||r,function(g,m){p&&(m=g,g=r[m]),Jv(o,m,ta(g,t,e,m,r,a))}),o}var yPt=4;function rp(r){return ta(r,yPt)}var _Pt=1,xPt=4;function iE(r){return ta(r,_Pt|xPt)}var CPt=1,EPt=4;function SPt(r,t){return t=typeof t=="function"?t:void 0,ta(r,CPt|EPt,t)}var APt=4;function TPt(r,t){return t=typeof t=="function"?t:void 0,ta(r,APt,t)}function bPt(){return new aa(this.value(),this.__chain__)}function Oa(r){for(var t=-1,e=r==null?0:r.length,i=0,n=[];++t<e;){var a=r[t];a&&(n[i++]=a)}return n}function Tc(){var r=arguments.length;if(!r)return[];for(var t=Array(r-1),e=arguments[0],i=r;i--;)t[i-1]=arguments[i];return ml(Lt(e)?Ji(e):[e],ii(t,1))}var wPt="__lodash_hash_undefined__";function RPt(r){return this.__data__.set(r,wPt),this}function MPt(r){return this.__data__.has(r)}function wu(r){var t=-1,e=r==null?0:r.length;for(this.__data__=new gs;++t<e;)this.add(r[t])}wu.prototype.add=wu.prototype.push=RPt;wu.prototype.has=MPt;function nb(r,t){for(var e=-1,i=r==null?0:r.length;++e<i;)if(t(r[e],e,r))return!0;return!1}function tv(r,t){return r.has(t)}var IPt=1,LPt=2;function p9(r,t,e,i,n,a){var o=e&IPt,s=r.length,l=t.length;if(s!=l&&!(o&&l>s))return!1;var u=a.get(r),c=a.get(t);if(u&&c)return u==t&&c==r;var h=-1,f=!0,d=e&LPt?new wu:void 0;for(a.set(r,t),a.set(t,r);++h<s;){var v=r[h],p=t[h];if(i)var g=o?i(p,v,h,t,r,a):i(v,p,h,r,t,a);if(g!==void 0){if(g)continue;f=!1;break}if(d){if(!nb(t,function(m,y){if(!tv(d,y)&&(v===m||n(v,m,e,i,a)))return d.push(y)})){f=!1;break}}else if(!(v===p||n(v,p,e,i,a))){f=!1;break}}return a.delete(r),a.delete(t),f}function ab(r){var t=-1,e=Array(r.size);return r.forEach(function(i,n){e[++t]=[n,i]}),e}function Ky(r){var t=-1,e=Array(r.size);return r.forEach(function(i){e[++t]=i}),e}var OPt=1,PPt=2,FPt="[object Boolean]",BPt="[object Date]",DPt="[object Error]",NPt="[object Map]",kPt="[object Number]",UPt="[object RegExp]",zPt="[object Set]",HPt="[object String]",$Pt="[object Symbol]",WPt="[object ArrayBuffer]",VPt="[object DataView]",BP=di?di.prototype:void 0,k1=BP?BP.valueOf:void 0;function GPt(r,t,e,i,n,a,o){switch(e){case VPt:if(r.byteLength!=t.byteLength||r.byteOffset!=t.byteOffset)return!1;r=r.buffer,t=t.buffer;case WPt:return!(r.byteLength!=t.byteLength||!a(new Em(r),new Em(t)));case FPt:case BPt:case kPt:return Va(+r,+t);case DPt:return r.name==t.name&&r.message==t.message;case UPt:case HPt:return r==t+"";case NPt:var s=ab;case zPt:var l=i&OPt;if(s||(s=Ky),r.size!=t.size&&!l)return!1;var u=o.get(r);if(u)return u==t;i|=PPt,o.set(r,t);var c=p9(s(r),s(t),i,n,a,o);return o.delete(r),c;case $Pt:if(k1)return k1.call(r)==k1.call(t)}return!1}var XPt=1,YPt=Object.prototype,jPt=YPt.hasOwnProperty;function ZPt(r,t,e,i,n,a){var o=e&XPt,s=tE(r),l=s.length,u=tE(t),c=u.length;if(l!=c&&!o)return!1;for(var h=l;h--;){var f=s[h];if(!(o?f in t:jPt.call(t,f)))return!1}var d=a.get(r),v=a.get(t);if(d&&v)return d==t&&v==r;var p=!0;a.set(r,t),a.set(t,r);for(var g=o;++h<l;){f=s[h];var m=r[f],y=t[f];if(i)var _=o?i(y,m,f,t,r,a):i(m,y,f,r,t,a);if(!(_===void 0?m===y||n(m,y,e,i,a):_)){p=!1;break}g||(g=f=="constructor")}if(p&&!g){var x=r.constructor,C=t.constructor;x!=C&&"constructor"in r&&"constructor"in t&&!(typeof x=="function"&&x instanceof x&&typeof C=="function"&&C instanceof C)&&(p=!1)}return a.delete(r),a.delete(t),p}var qPt=1,DP="[object Arguments]",NP="[object Array]",Pg="[object Object]",KPt=Object.prototype,kP=KPt.hasOwnProperty;function QPt(r,t,e,i,n,a){var o=Lt(r),s=Lt(t),l=o?NP:Ao(r),u=s?NP:Ao(t);l=l==DP?Pg:l,u=u==DP?Pg:u;var c=l==Pg,h=u==Pg,f=l==u;if(f&&ol(r)){if(!ol(t))return!1;o=!0,c=!1}if(f&&!c)return a||(a=new La),o||Vh(r)?p9(r,t,e,i,n,a):GPt(r,t,l,e,i,n,a);if(!(e&qPt)){var d=c&&kP.call(r,"__wrapped__"),v=h&&kP.call(t,"__wrapped__");if(d||v){var p=d?r.value():r,g=v?t.value():t;return a||(a=new La),n(p,g,e,i,a)}}return f?(a||(a=new La),ZPt(r,t,e,i,n,a)):!1}function ip(r,t,e,i,n){return r===t?!0:r==null||t==null||!hr(r)&&!hr(t)?r!==r&&t!==t:QPt(r,t,e,i,ip,n)}var JPt=1,tFt=2;function ob(r,t,e,i){var n=e.length,a=n,o=!i;if(r==null)return!a;for(r=Object(r);n--;){var s=e[n];if(o&&s[2]?s[1]!==r[s[0]]:!(s[0]in r))return!1}for(;++n<a;){s=e[n];var l=s[0],u=r[l],c=s[1];if(o&&s[2]){if(u===void 0&&!(l in r))return!1}else{var h=new La;if(i)var f=i(u,c,l,r,t,h);if(!(f===void 0?ip(c,u,JPt|tFt,i,h):f))return!1}}return!0}function g9(r){return r===r&&!Fe(r)}function sb(r){for(var t=ar(r),e=t.length;e--;){var i=t[e],n=r[i];t[e]=[i,n,g9(n)]}return t}function m9(r,t){return function(e){return e==null?!1:e[r]===t&&(t!==void 0||r in Object(e))}}function y9(r){var t=sb(r);return t.length==1&&t[0][2]?m9(t[0][0],t[0][1]):function(e){return e===r||ob(e,r,t)}}function eFt(r,t){return r!=null&&t in Object(r)}function _9(r,t,e){t=gl(t,r);for(var i=-1,n=t.length,a=!1;++i<n;){var o=Lo(t[i]);if(!(a=r!=null&&e(r,o)))break;r=r[o]}return a||++i!=n?a:(n=r==null?0:r.length,!!n&&Yy(n)&&fs(o,n)&&(Lt(r)||Tu(r)))}function Ru(r,t){return r!=null&&_9(r,t,eFt)}var rFt=1,iFt=2;function x9(r,t){return GT(r)&&g9(t)?m9(Lo(r),t):function(e){var i=kt(e,r);return i===void 0&&i===t?Ru(e,r):ip(t,i,rFt|iFt)}}function lb(r){return function(t){return t==null?void 0:t[r]}}function nFt(r){return function(t){return ju(t,r)}}function C9(r){return GT(r)?lb(Lo(r)):nFt(r)}function Yt(r){return typeof r=="function"?r:r==null?gi:typeof r=="object"?Lt(r)?x9(r[0],r[1]):y9(r):C9(r)}var aFt="Expected a function";function E9(r){var t=r==null?0:r.length,e=Yt;return r=t?Qe(r,function(i){if(typeof i[1]!="function")throw new TypeError(aFt);return[e(i[0]),i[1]]}):[],ae(function(i){for(var n=-1;++n<t;){var a=r[n];if(Rn(a[0],this,i))return Rn(a[1],this,i)}})}function S9(r,t,e){var i=e.length;if(r==null)return!i;for(r=Object(r);i--;){var n=e[i],a=t[n],o=r[n];if(o===void 0&&!(n in r)||!a(o))return!1}return!0}function oFt(r){var t=ar(r);return function(e){return S9(e,r,t)}}var sFt=1;function lFt(r){return oFt(ta(r,sFt))}function uFt(r,t){return t==null||S9(r,t,ar(t))}function cFt(r,t,e,i){for(var n=-1,a=r==null?0:r.length;++n<a;){var o=r[n];t(i,o,e(o),r)}return i}function A9(r){return function(t,e,i){for(var n=-1,a=Object(t),o=i(t),s=o.length;s--;){var l=o[r?s:++n];if(e(a[l],l,a)===!1)break}return t}}var hFt=A9(),ub=hFt;function Oo(r,t){return r&&ub(r,t,ar)}function T9(r,t){return function(e,i){if(e==null)return e;if(!hn(e))return r(e,i);for(var n=e.length,a=t?n:-1,o=Object(e);(t?a--:++a<n)&&i(o[a],a,o)!==!1;);return e}}var fFt=T9(Oo),xl=fFt;function dFt(r,t,e,i){return xl(r,function(n,a,o){t(i,n,e(n),o)}),i}function Qy(r,t){return function(e,i){var n=Lt(e)?cFt:dFt,a=t?t():{};return n(e,r,Yt(i),a)}}var vFt=Object.prototype,pFt=vFt.hasOwnProperty,gFt=Qy(function(r,t,e){pFt.call(r,e)?++r[e]:vs(r,e,1)}),mFt=gFt;function yFt(r,t){var e=zh(r);return t==null?e:i9(e,t)}var _Ft=8;function cb(r,t,e){t=e?void 0:t;var i=ds(r,_Ft,void 0,void 0,void 0,void 0,void 0,t);return i.placeholder=cb.placeholder,i}cb.placeholder={};var xFt=16;function hb(r,t,e){t=e?void 0:t;var i=ds(r,xFt,void 0,void 0,void 0,void 0,void 0,t);return i.placeholder=hb.placeholder,i}hb.placeholder={};var CFt=function(){return Vr.Date.now()},f0=CFt,EFt="Expected a function",SFt=Math.max,AFt=Math.min;function ev(r,t,e){var i,n,a,o,s,l,u=0,c=!1,h=!1,f=!0;if(typeof r!="function")throw new TypeError(EFt);t=En(t)||0,Fe(e)&&(c=!!e.leading,h="maxWait"in e,a=h?SFt(En(e.maxWait)||0,t):a,f="trailing"in e?!!e.trailing:f);function d(A){var b=i,R=n;return i=n=void 0,u=A,o=r.apply(R,b),o}function v(A){return u=A,s=setTimeout(m,t),c?d(A):o}function p(A){var b=A-l,R=A-u,M=t-b;return h?AFt(M,a-R):M}function g(A){var b=A-l,R=A-u;return l===void 0||b>=t||b<0||h&&R>=a}function m(){var A=f0();if(g(A))return y(A);s=setTimeout(m,p(A))}function y(A){return s=void 0,f&&i?d(A):(i=n=void 0,o)}function _(){s!==void 0&&clearTimeout(s),u=0,i=l=n=s=void 0}function x(){return s===void 0?o:y(f0())}function C(){var A=f0(),b=g(A);if(i=arguments,n=this,l=A,b){if(s===void 0)return v(l);if(h)return clearTimeout(s),s=setTimeout(m,t),d(l)}return s===void 0&&(s=setTimeout(m,t)),o}return C.cancel=_,C.flush=x,C}function TFt(r,t){return r==null||r!==r?t:r}var b9=Object.prototype,bFt=b9.hasOwnProperty,wFt=ae(function(r,t){r=Object(r);var e=-1,i=t.length,n=i>2?t[2]:void 0;for(n&&Ii(t[0],t[1],n)&&(i=1);++e<i;)for(var a=t[e],o=fn(a),s=-1,l=o.length;++s<l;){var u=o[s],c=r[u];(c===void 0||Va(c,b9[u])&&!bFt.call(r,u))&&(r[u]=a[u])}return r}),RFt=wFt;function nE(r,t,e){(e!==void 0&&!Va(r[t],e)||e===void 0&&!(t in r))&&vs(r,t,e)}function vr(r){return hr(r)&&hn(r)}function aE(r,t){if(!(t==="constructor"&&typeof r[t]=="function")&&t!="__proto__")return r[t]}function w9(r){return Io(r,fn(r))}function MFt(r,t,e,i,n,a,o){var s=aE(r,e),l=aE(t,e),u=o.get(l);if(u){nE(r,e,u);return}var c=a?a(s,l,e+"",r,t,o):void 0,h=c===void 0;if(h){var f=Lt(l),d=!f&&ol(l),v=!f&&!d&&Vh(l);c=l,f||d||v?Lt(s)?c=s:vr(s)?c=Ji(s):d?(h=!1,c=a9(l,!0)):v?(h=!1,c=l9(l,!0)):c=[]:ep(l)||Tu(l)?(c=s,Tu(s)?c=w9(s):(!Fe(s)||ri(s))&&(c=u9(l))):h=!1}h&&(o.set(l,c),n(c,l,i,a,o),o.delete(l)),nE(r,e,c)}function Jy(r,t,e,i,n){r!==t&&ub(t,function(a,o){if(n||(n=new La),Fe(a))MFt(r,t,o,e,Jy,i,n);else{var s=i?i(aE(r,o),a,o+"",r,t,n):void 0;s===void 0&&(s=a),nE(r,o,s)}},fn)}function R9(r,t,e,i,n,a){return Fe(r)&&Fe(t)&&(a.set(t,r),Jy(r,t,void 0,R9,a),a.delete(t)),r}var IFt=Wh(function(r,t,e,i){Jy(r,t,e,i)}),fb=IFt,LFt=ae(function(r){return r.push(void 0,R9),Rn(fb,void 0,r)}),OFt=LFt,PFt="Expected a function";function M9(r,t,e){if(typeof r!="function")throw new TypeError(PFt);return setTimeout(function(){r.apply(void 0,e)},t)}var FFt=ae(function(r,t){return M9(r,1,t)}),BFt=FFt,DFt=ae(function(r,t,e){return M9(r,En(t)||0,e)}),NFt=DFt;function db(r,t,e){for(var i=-1,n=r==null?0:r.length;++i<n;)if(e(t,r[i]))return!0;return!1}var kFt=200;function np(r,t,e,i){var n=-1,a=Gy,o=!0,s=r.length,l=[],u=t.length;if(!s)return l;e&&(t=Qe(t,Mn(e))),i?(a=db,o=!1):t.length>=kFt&&(a=tv,o=!1,t=new wu(t));t:for(;++n<s;){var c=r[n],h=e==null?c:e(c);if(c=i||c!==0?c:0,o&&h===h){for(var f=u;f--;)if(t[f]===h)continue t;l.push(c)}else a(t,h,i)||l.push(c)}return l}var UFt=ae(function(r,t){return vr(r)?np(r,ii(t,1,vr,!0)):[]}),I9=UFt;function Be(r){var t=r==null?0:r.length;return t?r[t-1]:void 0}var zFt=ae(function(r,t){var e=Be(t);return vr(e)&&(e=void 0),vr(r)?np(r,ii(t,1,vr,!0),Yt(e)):[]}),HFt=zFt,$Ft=ae(function(r,t){var e=Be(t);return vr(e)&&(e=void 0),vr(r)?np(r,ii(t,1,vr,!0),void 0,e):[]}),L9=$Ft,WFt=Hy(function(r,t){return r/t},1),VFt=WFt;function GFt(r,t,e){var i=r==null?0:r.length;return i?(t=e||t===void 0?1:ee(t),sa(r,t<0?0:t,i)):[]}function XFt(r,t,e){var i=r==null?0:r.length;return i?(t=e||t===void 0?1:ee(t),t=i-t,sa(r,0,t<0?0:t)):[]}function t_(r,t,e,i){for(var n=r.length,a=i?n:-1;(i?a--:++a<n)&&t(r[a],a,r););return e?sa(r,i?0:a,i?a+1:n):sa(r,i?a+1:0,i?n:a)}function YFt(r,t){return r&&r.length?t_(r,Yt(t),!0,!0):[]}function jFt(r,t){return r&&r.length?t_(r,Yt(t),!0):[]}function Po(r){return typeof r=="function"?r:gi}function $t(r,t){var e=Lt(r)?fa:xl;return e(r,Po(t))}function ZFt(r,t){for(var e=r==null?0:r.length;e--&&t(r[e],e,r)!==!1;);return r}var qFt=A9(!0),O9=qFt;function vb(r,t){return r&&O9(r,t,ar)}var KFt=T9(vb,!0),P9=KFt;function UP(r,t){var e=Lt(r)?ZFt:P9;return e(r,Po(t))}function QFt(r,t,e){r=Re(r),t=wn(t);var i=r.length;e=e===void 0?i:Zu(ee(e),0,i);var n=e;return e-=t.length,e>=0&&r.slice(e,n)==t}function JFt(r,t){return Qe(t,function(e){return[e,r[e]]})}function tBt(r){var t=-1,e=Array(r.size);return r.forEach(function(i){e[++t]=[i,i]}),e}var eBt="[object Map]",rBt="[object Set]";function F9(r){return function(t){var e=Ao(t);return e==eBt?ab(t):e==rBt?tBt(t):JFt(t,r(t))}}var iBt=F9(ar),zP=iBt,nBt=F9(fn),HP=nBt,aBt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},oBt=QT(aBt),sBt=oBt,B9=/[&<>"']/g,lBt=RegExp(B9.source);function pb(r){return r=Re(r),r&&lBt.test(r)?r.replace(B9,sBt):r}var D9=/[\\^$.*+?()[\]{}|]/g,uBt=RegExp(D9.source);function cBt(r){return r=Re(r),r&&uBt.test(r)?r.replace(D9,"\\$&"):r}function N9(r,t){for(var e=-1,i=r==null?0:r.length;++e<i;)if(!t(r[e],e,r))return!1;return!0}function hBt(r,t){var e=!0;return xl(r,function(i,n,a){return e=!!t(i,n,a),e}),e}function e_(r,t,e){var i=Lt(r)?N9:hBt;return e&&Ii(r,t,e)&&(t=void 0),i(r,Yt(t))}var fBt=4294967295;function k9(r){return r?Zu(ee(r),0,fBt):0}function dBt(r,t,e,i){var n=r.length;for(e=ee(e),e<0&&(e=-e>n?0:n+e),i=i===void 0||i>n?n:ee(i),i<0&&(i+=n),i=e>i?0:k9(i);e<i;)r[e++]=t;return r}function vBt(r,t,e,i){var n=r==null?0:r.length;return n?(e&&typeof e!="number"&&Ii(r,t,e)&&(e=0,i=n),dBt(r,t,e,i)):[]}function U9(r,t){var e=[];return xl(r,function(i,n,a){t(i,n,a)&&e.push(i)}),e}function ys(r,t){var e=Lt(r)?_l:U9;return e(r,Yt(t))}function z9(r){return function(t,e,i){var n=Object(t);if(!hn(t)){var a=Yt(e);t=ar(t),e=function(s){return a(n[s],s,n)}}var o=r(t,e,i);return o>-1?n[a?t[o]:o]:void 0}}var pBt=Math.max;function mh(r,t,e){var i=r==null?0:r.length;if(!i)return-1;var n=e==null?0:ee(e);return n<0&&(n=pBt(i+n,0)),Vy(r,Yt(t),n)}var gBt=z9(mh),vi=gBt;function H9(r,t,e){var i;return e(r,function(n,a,o){if(t(n,a,o))return i=a,!1}),i}function mBt(r,t){return H9(r,Yt(t),Oo)}var yBt=Math.max,_Bt=Math.min;function $9(r,t,e){var i=r==null?0:r.length;if(!i)return-1;var n=i-1;return e!==void 0&&(n=ee(e),n=e<0?yBt(i+n,0):_Bt(n,i-1)),Vy(r,Yt(t),n,!0)}var xBt=z9($9),r_=xBt;function CBt(r,t){return H9(r,Yt(t),vb)}function Mu(r){return r&&r.length?r[0]:void 0}function W9(r,t){var e=-1,i=hn(r)?Array(r.length):[];return xl(r,function(n,a,o){i[++e]=t(n,a,o)}),i}function ue(r,t){var e=Lt(r)?Qe:W9;return e(r,Yt(t))}function ap(r,t){return ii(ue(r,t),1)}var EBt=1/0;function SBt(r,t){return ii(ue(r,t),EBt)}function ABt(r,t,e){return e=e===void 0?1:ee(e),ii(ue(r,t),e)}var TBt=1/0;function V9(r){var t=r==null?0:r.length;return t?ii(r,TBt):[]}function bBt(r,t){var e=r==null?0:r.length;return e?(t=t===void 0?1:ee(t),ii(r,t)):[]}var wBt=512;function RBt(r){return ds(r,wBt)}var MBt=JT("floor"),IBt=MBt,LBt="Expected a function",OBt=8,PBt=32,FBt=128,BBt=256;function G9(r){return ms(function(t){var e=t.length,i=e,n=aa.prototype.thru;for(r&&t.reverse();i--;){var a=t[i];if(typeof a!="function")throw new TypeError(LBt);if(n&&!o&&h0(a)=="wrapper")var o=new aa([],!0)}for(i=o?i:e;++i<e;){a=t[i];var s=h0(a),l=s=="wrapper"?zT(a):void 0;l&&KC(l[0])&&l[1]==(FBt|OBt|PBt|BBt)&&!l[4].length&&l[9]==1?o=o[h0(l[0])].apply(o,l[3]):o=a.length==1&&KC(a)?o[s]():o.thru(a)}return function(){var u=arguments,c=u[0];if(o&&u.length==1&&Lt(c))return o.plant(c).value();for(var h=0,f=e?t[h].apply(this,u):c;++h<e;)f=t[h].call(this,f);return f}})}var DBt=G9(),NBt=DBt,kBt=G9(!0),UBt=kBt;function X9(r,t){return r==null?r:ub(r,Po(t),fn)}function zBt(r,t){return r==null?r:O9(r,Po(t),fn)}function HBt(r,t){return r&&Oo(r,Po(t))}function $Bt(r,t){return r&&vb(r,Po(t))}function WBt(r){for(var t=-1,e=r==null?0:r.length,i={};++t<e;){var n=r[t];i[n[0]]=n[1]}return i}function i_(r,t){return _l(t,function(e){return ri(r[e])})}function VBt(r){return r==null?[]:i_(r,ar(r))}function GBt(r){return r==null?[]:i_(r,fn(r))}var XBt=Object.prototype,YBt=XBt.hasOwnProperty,jBt=Qy(function(r,t,e){YBt.call(r,e)?r[e].push(t):vs(r,e,[t])}),ZBt=jBt;function gb(r,t){return r>t}function n_(r){return function(t,e){return typeof t=="string"&&typeof e=="string"||(t=En(t),e=En(e)),r(t,e)}}var qBt=n_(gb),KBt=qBt,QBt=n_(function(r,t){return r>=t}),JBt=QBt,tDt=Object.prototype,eDt=tDt.hasOwnProperty;function rDt(r,t){return r!=null&&eDt.call(r,t)}function oE(r,t){return r!=null&&_9(r,t,rDt)}var iDt=Math.max,nDt=Math.min;function aDt(r,t,e){return r>=nDt(t,e)&&r<iDt(t,e)}function sE(r,t,e){return t=rs(t),e===void 0?(e=t,t=0):e=rs(e),r=En(r),aDt(r,t,e)}var oDt="[object String]";function Yh(r){return typeof r=="string"||!Lt(r)&&hr(r)&&Oi(r)==oDt}function mb(r,t){return Qe(t,function(e){return r[e]})}function _s(r){return r==null?[]:mb(r,ar(r))}var sDt=Math.max;function wi(r,t,e,i){r=hn(r)?r:_s(r),e=e&&!i?ee(e):0;var n=r.length;return e<0&&(e=sDt(n+e,0)),Yh(r)?e<=n&&r.indexOf(t,e)>-1:!!n&&Hh(r,t,e)>-1}var lDt=Math.max;function a_(r,t,e){var i=r==null?0:r.length;if(!i)return-1;var n=e==null?0:ee(e);return n<0&&(n=lDt(i+n,0)),Hh(r,t,n)}function uDt(r){var t=r==null?0:r.length;return t?sa(r,0,-1):[]}var cDt=Math.min;function yb(r,t,e){for(var i=e?db:Gy,n=r[0].length,a=r.length,o=a,s=Array(a),l=1/0,u=[];o--;){var c=r[o];o&&t&&(c=Qe(c,Mn(t))),l=cDt(c.length,l),s[o]=!e&&(t||n>=120&&c.length>=120)?new wu(o&&c):void 0}c=r[0];var h=-1,f=s[0];t:for(;++h<n&&u.length<l;){var d=c[h],v=t?t(d):d;if(d=e||d!==0?d:0,!(f?tv(f,v):i(u,v,e))){for(o=a;--o;){var p=s[o];if(!(p?tv(p,v):i(r[o],v,e)))continue t}f&&f.push(v),u.push(d)}}return u}function _b(r){return vr(r)?r:[]}var hDt=ae(function(r){var t=Qe(r,_b);return t.length&&t[0]===r[0]?yb(t):[]}),Y9=hDt,fDt=ae(function(r){var t=Be(r),e=Qe(r,_b);return t===Be(e)?t=void 0:e.pop(),e.length&&e[0]===r[0]?yb(e,Yt(t)):[]}),dDt=fDt,vDt=ae(function(r){var t=Be(r),e=Qe(r,_b);return t=typeof t=="function"?t:void 0,t&&e.pop(),e.length&&e[0]===r[0]?yb(e,void 0,t):[]}),pDt=vDt;function gDt(r,t,e,i){return Oo(r,function(n,a,o){t(i,e(n),a,o)}),i}function j9(r,t){return function(e,i){return gDt(e,r,t(i),{})}}var mDt=Object.prototype,yDt=mDt.toString,_Dt=j9(function(r,t,e){t!=null&&typeof t.toString!="function"&&(t=yDt.call(t)),r[t]=e},$c(gi)),xDt=_Dt,Z9=Object.prototype,CDt=Z9.hasOwnProperty,EDt=Z9.toString,SDt=j9(function(r,t,e){t!=null&&typeof t.toString!="function"&&(t=EDt.call(t)),CDt.call(r,t)?r[t].push(e):r[t]=[e]},Yt),ADt=SDt;function q9(r,t){return t.length<2?r:ju(r,sa(t,0,-1))}function op(r,t,e){t=gl(t,r),r=q9(r,t);var i=r==null?r:r[Lo(Be(t))];return i==null?void 0:Rn(i,r,e)}var TDt=ae(op),bDt=TDt,wDt=ae(function(r,t,e){var i=-1,n=typeof t=="function",a=hn(r)?Array(r.length):[];return xl(r,function(o){a[++i]=n?Rn(t,o,e):op(o,t,e)}),a}),RDt=wDt,MDt="[object ArrayBuffer]";function IDt(r){return hr(r)&&Oi(r)==MDt}var $P=oa&&oa.isArrayBuffer,LDt=$P?Mn($P):IDt,ODt=LDt,PDt="[object Boolean]";function uo(r){return r===!0||r===!1||hr(r)&&Oi(r)==PDt}var FDt="[object Date]";function BDt(r){return hr(r)&&Oi(r)==FDt}var WP=oa&&oa.isDate,DDt=WP?Mn(WP):BDt,NDt=DDt;function kDt(r){return hr(r)&&r.nodeType===1&&!ep(r)}var UDt="[object Map]",zDt="[object Set]",HDt=Object.prototype,$Dt=HDt.hasOwnProperty;function st(r){if(r==null)return!0;if(hn(r)&&(Lt(r)||typeof r=="string"||typeof r.splice=="function"||ol(r)||Vh(r)||Tu(r)))return!r.length;var t=Ao(r);if(t==UDt||t==zDt)return!r.size;if(tp(r))return!VT(r).length;for(var e in r)if($Dt.call(r,e))return!1;return!0}function Jr(r,t){return ip(r,t)}function WDt(r,t,e){e=typeof e=="function"?e:void 0;var i=e?e(r,t):void 0;return i===void 0?ip(r,t,void 0,e):!!i}var VDt=Vr.isFinite;function GDt(r){return typeof r=="number"&&VDt(r)}function K9(r){return typeof r=="number"&&r==ee(r)}function XDt(r,t){return r===t||ob(r,t,sb(t))}function YDt(r,t,e){return e=typeof e=="function"?e:void 0,ob(r,t,sb(t),e)}var jDt="[object Number]";function Si(r){return typeof r=="number"||hr(r)&&Oi(r)==jDt}function Q9(r){return Si(r)&&r!=+r}var ZDt=c0?ri:WT,qDt=ZDt,KDt="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.";function QDt(r){if(qDt(r))throw new Error(KDt);return uU(r)}function Or(r){return r==null}function J9(r){return r===null}var JDt="[object RegExp]";function t5t(r){return hr(r)&&Oi(r)==JDt}var VP=oa&&oa.isRegExp,e5t=VP?Mn(VP):t5t,xb=e5t,GP=9007199254740991;function r5t(r){return K9(r)&&r>=-GP&&r<=GP}function o_(r){return r===void 0}var i5t="[object WeakMap]";function n5t(r){return hr(r)&&Ao(r)==i5t}var a5t="[object WeakSet]";function o5t(r){return hr(r)&&Oi(r)==a5t}var s5t=1;function l5t(r){return Yt(typeof r=="function"?r:ta(r,s5t))}var u5t=Array.prototype,c5t=u5t.join;function h5t(r,t){return r==null?"":c5t.call(r,t)}var f5t=Xh(function(r,t,e){return r+(e?"-":"")+t.toLowerCase()}),d5t=f5t,v5t=Qy(function(r,t,e){vs(r,e,t)}),p5t=v5t;function g5t(r,t,e){for(var i=e+1;i--;)if(r[i]===t)return i;return i}var m5t=Math.max,y5t=Math.min;function _5t(r,t,e){var i=r==null?0:r.length;if(!i)return-1;var n=i;return e!==void 0&&(n=ee(e),n=n<0?m5t(i+n,0):y5t(n,i-1)),t===t?g5t(r,t,n):Vy(r,gU,n,!0)}var x5t=Xh(function(r,t,e){return r+(e?" ":"")+t.toLowerCase()}),Cb=x5t,C5t=UU("toLowerCase"),E5t=C5t;function Eb(r,t){return r<t}var S5t=n_(Eb),A5t=S5t,T5t=n_(function(r,t){return r<=t}),b5t=T5t;function tz(r,t){var e={};return t=Yt(t),Oo(r,function(i,n,a){vs(e,t(i,n,a),i)}),e}function w5t(r,t){var e={};return t=Yt(t),Oo(r,function(i,n,a){vs(e,n,t(i,n,a))}),e}var R5t=1;function lE(r){return y9(ta(r,R5t))}var M5t=1;function I5t(r,t){return x9(r,ta(t,M5t))}function s_(r,t,e){for(var i=-1,n=r.length;++i<n;){var a=r[i],o=t(a);if(o!=null&&(s===void 0?o===o&&!bn(o):e(o,s)))var s=o,l=a}return l}function yh(r){return r&&r.length?s_(r,gi,gb):void 0}function Sb(r,t){return r&&r.length?s_(r,Yt(t),gb):void 0}function Ab(r,t){for(var e,i=-1,n=r.length;++i<n;){var a=t(r[i]);a!==void 0&&(e=e===void 0?a:e+a)}return e}var L5t=0/0;function ez(r,t){var e=r==null?0:r.length;return e?Ab(r,t)/e:L5t}function O5t(r){return ez(r,gi)}function P5t(r,t){return ez(r,Yt(t))}var F5t=Wh(function(r,t,e){Jy(r,t,e)}),Sm=F5t,B5t=ae(function(r,t){return function(e){return op(e,r,t)}}),D5t=B5t,N5t=ae(function(r,t){return function(e){return op(r,e,t)}}),k5t=N5t;function Tb(r){return r&&r.length?s_(r,gi,Eb):void 0}function U5t(r,t){return r&&r.length?s_(r,Yt(t),Eb):void 0}function rz(r,t,e){var i=ar(t),n=i_(t,i),a=!(Fe(e)&&"chain"in e)||!!e.chain,o=ri(r);return fa(n,function(s){var l=t[s];r[s]=l,o&&(r.prototype[s]=function(){var u=this.__chain__;if(a||u){var c=r(this.__wrapped__),h=c.__actions__=Ji(this.__actions__);return h.push({func:l,args:arguments,thisArg:r}),c.__chain__=u,c}return l.apply(r,ml([this.value()],arguments))})}),r}var z5t=Hy(function(r,t){return r*t},1),H5t=z5t,$5t="Expected a function";function sp(r){if(typeof r!="function")throw new TypeError($5t);return function(){var t=arguments;switch(t.length){case 0:return!r.call(this);case 1:return!r.call(this,t[0]);case 2:return!r.call(this,t[0],t[1]);case 3:return!r.call(this,t[0],t[1],t[2])}return!r.apply(this,t)}}function W5t(r){for(var t,e=[];!(t=r.next()).done;)e.push(t.value);return e}var V5t="[object Map]",G5t="[object Set]",U1=di?di.iterator:void 0;function iz(r){if(!r)return[];if(hn(r))return Yh(r)?Na(r):Ji(r);if(U1&&r[U1])return W5t(r[U1]());var t=Ao(r),e=t==V5t?ab:t==G5t?Ky:_s;return e(r)}function X5t(){this.__values__===void 0&&(this.__values__=iz(this.value()));var r=this.__index__>=this.__values__.length,t=r?void 0:this.__values__[this.__index__++];return{done:r,value:t}}function nz(r,t){var e=r.length;if(e)return t+=t<0?e:0,fs(t,e)?r[t]:void 0}function Y5t(r,t){return r&&r.length?nz(r,ee(t)):void 0}function j5t(r){return r=ee(r),ae(function(t){return nz(t,r)})}function bb(r,t){return t=gl(t,r),r=q9(r,t),r==null||delete r[Lo(Be(t))]}function Z5t(r){return ep(r)?void 0:r}var q5t=1,K5t=2,Q5t=4,J5t=ms(function(r,t){var e={};if(r==null)return e;var i=!1;t=Qe(t,function(a){return a=gl(a,r),i||(i=a.length>1),a}),Io(r,rb(r),e),i&&(e=ta(e,q5t|K5t|Q5t,Z5t));for(var n=t.length;n--;)bb(e,t[n]);return e}),wb=J5t;function lp(r,t,e,i){if(!Fe(r))return r;t=gl(t,r);for(var n=-1,a=t.length,o=a-1,s=r;s!=null&&++n<a;){var l=Lo(t[n]),u=e;if(l==="__proto__"||l==="constructor"||l==="prototype")return r;if(n!=o){var c=s[l];u=i?i(c,l,s):void 0,u===void 0&&(u=Fe(c)?c:fs(t[n+1])?[]:{})}Jv(s,l,u),s=s[l]}return r}function az(r,t,e){for(var i=-1,n=t.length,a={};++i<n;){var o=t[i],s=ju(r,o);e(s,o)&&lp(a,gl(o,r),s)}return a}function Rb(r,t){if(r==null)return{};var e=Qe(rb(r),function(i){return[i]});return t=Yt(t),az(r,e,function(i,n){return t(i,n[0])})}function t4t(r,t){return Rb(r,sp(Yt(t)))}function e4t(r){return LU(2,r)}function r4t(r,t){var e=r.length;for(r.sort(t);e--;)r[e]=r[e].value;return r}function oz(r,t){if(r!==t){var e=r!==void 0,i=r===null,n=r===r,a=bn(r),o=t!==void 0,s=t===null,l=t===t,u=bn(t);if(!s&&!u&&!a&&r>t||a&&o&&l&&!s&&!u||i&&o&&l||!e&&l||!n)return 1;if(!i&&!a&&!u&&r<t||u&&e&&n&&!i&&!a||s&&e&&n||!o&&n||!l)return-1}return 0}function i4t(r,t,e){for(var i=-1,n=r.criteria,a=t.criteria,o=n.length,s=e.length;++i<o;){var l=oz(n[i],a[i]);if(l){if(i>=s)return l;var u=e[i];return l*(u=="desc"?-1:1)}}return r.index-t.index}function sz(r,t,e){t.length?t=Qe(t,function(a){return Lt(a)?function(o){return ju(o,a.length===1?a[0]:a)}:a}):t=[gi];var i=-1;t=Qe(t,Mn(Yt));var n=W9(r,function(a,o,s){var l=Qe(t,function(u){return u(a)});return{criteria:l,index:++i,value:a}});return r4t(n,function(a,o){return i4t(a,o,e)})}function Mb(r,t,e,i){return r==null?[]:(Lt(t)||(t=t==null?[]:[t]),e=i?void 0:e,Lt(e)||(e=e==null?[]:[e]),sz(r,t,e))}function Ib(r){return ms(function(t){return t=Qe(t,Mn(Yt)),ae(function(e){var i=this;return r(t,function(n){return Rn(n,i,e)})})})}var n4t=Ib(Qe),a4t=n4t,o4t=ae,s4t=o4t,l4t=Math.min,u4t=s4t(function(r,t){t=t.length==1&&Lt(t[0])?Qe(t[0],Mn(Yt)):Qe(ii(t,1),Mn(Yt));var e=t.length;return ae(function(i){for(var n=-1,a=l4t(i.length,e);++n<a;)i[n]=t[n].call(this,i[n]);return Rn(r,this,i)})}),c4t=u4t,h4t=Ib(N9),f4t=h4t,d4t=Ib(nb),v4t=d4t,p4t=9007199254740991,g4t=Math.floor;function uE(r,t){var e="";if(!r||t<1||t>p4t)return e;do t%2&&(e+=r),t=g4t(t/2),t&&(r+=r);while(t);return e}var m4t=lb("length"),y4t=m4t,lz="\\ud800-\\udfff",_4t="\\u0300-\\u036f",x4t="\\ufe20-\\ufe2f",C4t="\\u20d0-\\u20ff",E4t=_4t+x4t+C4t,S4t="\\ufe0e\\ufe0f",A4t="["+lz+"]",cE="["+E4t+"]",hE="\\ud83c[\\udffb-\\udfff]",T4t="(?:"+cE+"|"+hE+")",uz="[^"+lz+"]",cz="(?:\\ud83c[\\udde6-\\uddff]){2}",hz="[\\ud800-\\udbff][\\udc00-\\udfff]",b4t="\\u200d",fz=T4t+"?",dz="["+S4t+"]?",w4t="(?:"+b4t+"(?:"+[uz,cz,hz].join("|")+")"+dz+fz+")*",R4t=dz+fz+w4t,M4t="(?:"+[uz+cE+"?",cE,cz,hz,A4t].join("|")+")",XP=RegExp(hE+"(?="+hE+")|"+M4t+R4t,"g");function I4t(r){for(var t=XP.lastIndex=0;XP.test(r);)++t;return t}function jh(r){return Gh(r)?I4t(r):y4t(r)}var L4t=Math.ceil;function Am(r,t){t=t===void 0?" ":wn(t);var e=t.length;if(e<2)return e?uE(t,r):t;var i=uE(t,L4t(r/jh(t)));return Gh(t)?yl(Na(i),0,r).join(""):i.slice(0,r)}var O4t=Math.ceil,P4t=Math.floor;function F4t(r,t,e){r=Re(r),t=ee(t);var i=t?jh(r):0;if(!t||i>=t)return r;var n=(t-i)/2;return Am(P4t(n),e)+r+Am(O4t(n),e)}function B4t(r,t,e){r=Re(r),t=ee(t);var i=t?jh(r):0;return t&&i<t?r+Am(t-i,e):r}function D4t(r,t,e){r=Re(r),t=ee(t);var i=t?jh(r):0;return t&&i<t?Am(t-i,e)+r:r}var N4t=/^\s+/,k4t=Vr.parseInt;function U4t(r,t,e){return e||t==null?t=0:t&&(t=+t),k4t(Re(r).replace(N4t,""),t||0)}var z4t=32,Lb=ae(function(r,t){var e=al(t,$h(Lb));return ds(r,z4t,void 0,t,e)});Lb.placeholder={};var vz=Lb,H4t=64,Ob=ae(function(r,t){var e=al(t,$h(Ob));return ds(r,H4t,void 0,t,e)});Ob.placeholder={};var $4t=Ob,W4t=Qy(function(r,t,e){r[e?0:1].push(t)},function(){return[[],[]]}),V4t=W4t;function G4t(r,t){return az(r,t,function(e,i){return Ru(r,i)})}var X4t=ms(function(r,t){return r==null?{}:G4t(r,t)}),pz=X4t;function Y4t(r){for(var t,e=this;e instanceof $y;){var i=dU(e);i.__index__=0,i.__values__=void 0,t?n.__wrapped__=i:t=i;var n=i;e=e.__wrapped__}return n.__wrapped__=r,t}function j4t(r){return function(t){return r==null?void 0:ju(r,t)}}function Z4t(r,t,e,i){for(var n=e-1,a=r.length;++n<a;)if(i(r[n],t))return n;return-1}var q4t=Array.prototype,YP=q4t.splice;function Pb(r,t,e,i){var n=i?Z4t:Hh,a=-1,o=t.length,s=r;for(r===t&&(t=Ji(t)),e&&(s=Qe(r,Mn(e)));++a<o;)for(var l=0,u=t[a],c=e?e(u):u;(l=n(s,c,l,i))>-1;)s!==r&&YP.call(s,l,1),YP.call(r,l,1);return r}function gz(r,t){return r&&r.length&&t&&t.length?Pb(r,t):r}var K4t=ae(gz),Q4t=K4t;function J4t(r,t,e){return r&&r.length&&t&&t.length?Pb(r,t,Yt(e)):r}function tNt(r,t,e){return r&&r.length&&t&&t.length?Pb(r,t,void 0,e):r}var eNt=Array.prototype,rNt=eNt.splice;function mz(r,t){for(var e=r?t.length:0,i=e-1;e--;){var n=t[e];if(e==i||n!==a){var a=n;fs(n)?rNt.call(r,n,1):bb(r,n)}}return r}var iNt=ms(function(r,t){var e=r==null?0:r.length,i=XT(r,t);return mz(r,Qe(t,function(n){return fs(n,e)?+n:n}).sort(oz)),i}),nNt=iNt,aNt=Math.floor,oNt=Math.random;function Fb(r,t){return r+aNt(oNt()*(t-r+1))}var sNt=parseFloat,lNt=Math.min,uNt=Math.random;function cNt(r,t,e){if(e&&typeof e!="boolean"&&Ii(r,t,e)&&(t=e=void 0),e===void 0&&(typeof t=="boolean"?(e=t,t=void 0):typeof r=="boolean"&&(e=r,r=void 0)),r===void 0&&t===void 0?(r=0,t=1):(r=rs(r),t===void 0?(t=r,r=0):t=rs(t)),r>t){var i=r;r=t,t=i}if(e||r%1||t%1){var n=uNt();return lNt(r+n*(t-r+sNt("1e-"+((n+"").length-1))),t)}return Fb(r,t)}var hNt=Math.ceil,fNt=Math.max;function dNt(r,t,e,i){for(var n=-1,a=fNt(hNt((t-r)/(e||1)),0),o=Array(a);a--;)o[i?a:++n]=r,r+=e;return o}function yz(r){return function(t,e,i){return i&&typeof i!="number"&&Ii(t,e,i)&&(e=i=void 0),t=rs(t),e===void 0?(e=t,t=0):e=rs(e),i=i===void 0?t<e?1:-1:rs(i),dNt(t,e,i,r)}}var vNt=yz(),Vc=vNt,pNt=yz(!0),gNt=pNt,mNt=256,yNt=ms(function(r,t){return ds(r,mNt,void 0,void 0,void 0,t)}),_Nt=yNt;function _z(r,t,e,i,n){return n(r,function(a,o,s){e=i?(i=!1,a):t(e,a,o,s)}),e}function l_(r,t,e){var i=Lt(r)?KT:_z,n=arguments.length<3;return i(r,Yt(t),e,n,xl)}function xNt(r,t,e,i){var n=r==null?0:r.length;for(i&&n&&(e=r[--n]);n--;)e=t(e,r[n],n,r);return e}function CNt(r,t,e){var i=Lt(r)?xNt:_z,n=arguments.length<3;return i(r,Yt(t),e,n,P9)}function ENt(r,t){var e=Lt(r)?_l:U9;return e(r,sp(Yt(t)))}function SNt(r,t){var e=[];if(!(r&&r.length))return e;var i=-1,n=[],a=r.length;for(t=Yt(t);++i<a;){var o=r[i];t(o,i,r)&&(e.push(o),n.push(i))}return mz(r,n),e}function ANt(r,t,e){return(e?Ii(r,t,e):t===void 0)?t=1:t=ee(t),uE(Re(r),t)}function TNt(){var r=arguments,t=Re(r[0]);return r.length<3?t:t.replace(r[1],r[2])}var bNt="Expected a function";function wNt(r,t){if(typeof r!="function")throw new TypeError(bNt);return t=t===void 0?t:ee(t),ae(r,t)}function RNt(r,t,e){t=gl(t,r);var i=-1,n=t.length;for(n||(n=1,r=void 0);++i<n;){var a=r==null?void 0:r[Lo(t[i])];a===void 0&&(i=n,a=e),r=ri(a)?a.call(r):a}return r}var MNt=Array.prototype,INt=MNt.reverse;function fE(r){return r==null?r:INt.call(r)}var LNt=JT("round"),ONt=LNt;function xz(r){var t=r.length;return t?r[Fb(0,t-1)]:void 0}function PNt(r){return xz(_s(r))}function FNt(r){var t=Lt(r)?xz:PNt;return t(r)}function u_(r,t){var e=-1,i=r.length,n=i-1;for(t=t===void 0?i:t;++e<t;){var a=Fb(e,n),o=r[a];r[a]=r[e],r[e]=o}return r.length=t,r}function BNt(r,t){return u_(Ji(r),Zu(t,0,r.length))}function DNt(r,t){var e=_s(r);return u_(e,Zu(t,0,e.length))}function NNt(r,t,e){(e?Ii(r,t,e):t===void 0)?t=1:t=ee(t);var i=Lt(r)?BNt:DNt;return i(r,t)}function rv(r,t,e){return r==null?r:lp(r,t,e)}function kNt(r,t,e,i){return i=typeof i=="function"?i:void 0,r==null?r:lp(r,t,e,i)}function UNt(r){return u_(Ji(r))}function zNt(r){return u_(_s(r))}function HNt(r){var t=Lt(r)?UNt:zNt;return t(r)}var $Nt="[object Map]",WNt="[object Set]";function bc(r){if(r==null)return 0;if(hn(r))return Yh(r)?jh(r):r.length;var t=Ao(r);return t==$Nt||t==WNt?r.size:VT(r).length}function VNt(r,t,e){var i=r==null?0:r.length;return i?(e&&typeof e!="number"&&Ii(r,t,e)?(t=0,e=i):(t=t==null?0:ee(t),e=e===void 0?i:ee(e)),sa(r,t,e)):[]}var GNt=Xh(function(r,t,e){return r+(e?"_":"")+t.toLowerCase()}),XNt=GNt;function YNt(r,t){var e;return xl(r,function(i,n,a){return e=t(i,n,a),!e}),!!e}function Cz(r,t,e){var i=Lt(r)?nb:YNt;return e&&Ii(r,t,e)&&(t=void 0),i(r,Yt(t))}var jNt=ae(function(r,t){if(r==null)return[];var e=t.length;return e>1&&Ii(r,t[0],t[1])?t=[]:e>2&&Ii(t[0],t[1],t[2])&&(t=[t[0]]),sz(r,ii(t,1),[])}),Ez=jNt,ZNt=4294967295,qNt=ZNt-1,KNt=Math.floor,QNt=Math.min;function Bb(r,t,e,i){var n=0,a=r==null?0:r.length;if(a===0)return 0;t=e(t);for(var o=t!==t,s=t===null,l=bn(t),u=t===void 0;n<a;){var c=KNt((n+a)/2),h=e(r[c]),f=h!==void 0,d=h===null,v=h===h,p=bn(h);if(o)var g=i||v;else u?g=v&&(i||f):s?g=v&&f&&(i||!d):l?g=v&&f&&!d&&(i||!p):d||p?g=!1:g=i?h<=t:h<t;g?n=c+1:a=c}return QNt(a,qNt)}var JNt=4294967295,t6t=JNt>>>1;function c_(r,t,e){var i=0,n=r==null?i:r.length;if(typeof t=="number"&&t===t&&n<=t6t){for(;i<n;){var a=i+n>>>1,o=r[a];o!==null&&!bn(o)&&(e?o<=t:o<t)?i=a+1:n=a}return n}return Bb(r,t,gi,e)}function e6t(r,t){return c_(r,t)}function r6t(r,t,e){return Bb(r,t,Yt(e))}function i6t(r,t){var e=r==null?0:r.length;if(e){var i=c_(r,t);if(i<e&&Va(r[i],t))return i}return-1}function n6t(r,t){return c_(r,t,!0)}function a6t(r,t,e){return Bb(r,t,Yt(e),!0)}function o6t(r,t){var e=r==null?0:r.length;if(e){var i=c_(r,t,!0)-1;if(Va(r[i],t))return i}return-1}function Sz(r,t){for(var e=-1,i=r.length,n=0,a=[];++e<i;){var o=r[e],s=t?t(o):o;if(!e||!Va(s,l)){var l=s;a[n++]=o===0?0:o}}return a}function s6t(r){return r&&r.length?Sz(r):[]}function l6t(r,t){return r&&r.length?Sz(r,Yt(t)):[]}var u6t=4294967295;function Db(r,t,e){return e&&typeof e!="number"&&Ii(r,t,e)&&(t=e=void 0),e=e===void 0?u6t:e>>>0,e?(r=Re(r),r&&(typeof t=="string"||t!=null&&!xb(t))&&(t=wn(t),!t&&Gh(r))?yl(Na(r),0,e):r.split(t,e)):[]}var c6t="Expected a function",h6t=Math.max;function f6t(r,t){if(typeof r!="function")throw new TypeError(c6t);return t=t==null?0:h6t(ee(t),0),ae(function(e){var i=e[t],n=yl(e,0,t);return i&&ml(n,i),Rn(r,this,n)})}var d6t=Xh(function(r,t,e){return r+(e?" ":"")+qT(t)}),v6t=d6t;function p6t(r,t,e){return r=Re(r),e=e==null?0:Zu(ee(e),0,r.length),t=wn(t),r.slice(e,e+t.length)==t}function g6t(){return{}}function m6t(){return""}function Az(){return!0}var y6t=Hy(function(r,t){return r-t},0),_6t=y6t;function x6t(r){return r&&r.length?Ab(r,gi):0}function Tz(r,t){return r&&r.length?Ab(r,Yt(t)):0}function C6t(r){var t=r==null?0:r.length;return t?sa(r,1,t):[]}function E6t(r,t,e){return r&&r.length?(t=e||t===void 0?1:ee(t),sa(r,0,t<0?0:t)):[]}function S6t(r,t,e){var i=r==null?0:r.length;return i?(t=e||t===void 0?1:ee(t),t=i-t,sa(r,t<0?0:t,i)):[]}function A6t(r,t){return r&&r.length?t_(r,Yt(t),!1,!0):[]}function T6t(r,t){return r&&r.length?t_(r,Yt(t)):[]}function b6t(r,t){return t(r),r}var bz=Object.prototype,w6t=bz.hasOwnProperty;function jP(r,t,e,i){return r===void 0||Va(r,bz[e])&&!w6t.call(i,e)?t:r}var R6t={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};function M6t(r){return"\\"+R6t[r]}var I6t=/<%=([\s\S]+?)%>/g,wz=I6t,L6t=/<%-([\s\S]+?)%>/g,O6t=L6t,P6t=/<%([\s\S]+?)%>/g,F6t=P6t,B6t={escape:O6t,evaluate:F6t,interpolate:wz,variable:"",imports:{_:{escape:pb}}},dE=B6t,D6t="Invalid `variable` option passed into `_.template`",N6t=/\b__p \+= '';/g,k6t=/\b(__p \+=) '' \+/g,U6t=/(__e\(.*?\)|\b__t\)) \+\n'';/g,z6t=/[()=,{}\[\]\/\s]/,H6t=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Fg=/($^)/,$6t=/['\n\r\u2028\u2029\\]/g,W6t=Object.prototype,ZP=W6t.hasOwnProperty;function V6t(r,t,e){var i=dE.imports._.templateSettings||dE;e&&Ii(r,t,e)&&(t=void 0),r=Re(r),t=xm({},t,i,jP);var n=xm({},t.imports,i.imports,jP),a=ar(n),o=mb(n,a),s,l,u=0,c=t.interpolate||Fg,h="__p += '",f=RegExp((t.escape||Fg).source+"|"+c.source+"|"+(c===wz?H6t:Fg).source+"|"+(t.evaluate||Fg).source+"|$","g"),d=ZP.call(t,"sourceURL")?"//# sourceURL="+(t.sourceURL+"").replace(/\s/g," ")+`
`:"";r.replace(f,function(g,m,y,_,x,C){return y||(y=_),h+=r.slice(u,C).replace($6t,M6t),m&&(s=!0,h+=`' +
__e(`+m+`) +
'`),x&&(l=!0,h+=`';
`+x+`;
__p += '`),y&&(h+=`' +
((__t = (`+y+`)) == null ? '' : __t) +
'`),u=C+g.length,g}),h+=`';
`;var v=ZP.call(t,"variable")&&t.variable;if(!v)h=`with (obj) {
`+h+`
}
`;else if(z6t.test(v))throw new Error(D6t);h=(l?h.replace(N6t,""):h).replace(k6t,"$1").replace(U6t,"$1;"),h="function("+(v||"obj")+`) {
`+(v?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(s?", __e = _.escape":"")+(l?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+h+`return __p
}`;var p=IU(function(){return Function(a,d+"return "+h).apply(void 0,o)});if(p.source=h,YT(p))throw p;return p}var G6t="Expected a function";function Nb(r,t,e){var i=!0,n=!0;if(typeof r!="function")throw new TypeError(G6t);return Fe(e)&&(i="leading"in e?!!e.leading:i,n="trailing"in e?!!e.trailing:n),ev(r,t,{leading:i,maxWait:t,trailing:n})}function up(r,t){return t(r)}var X6t=9007199254740991,z1=4294967295,Y6t=Math.min;function j6t(r,t){if(r=ee(r),r<1||r>X6t)return[];var e=z1,i=Y6t(r,z1);t=Po(t),r-=z1;for(var n=$T(i,t);++e<r;)t(e);return n}function Z6t(){return this}function Rz(r,t){var e=r;return e instanceof fe&&(e=e.value()),KT(t,function(i,n){return n.func.apply(n.thisArg,ml([i],n.args))},e)}function H1(){return Rz(this.__wrapped__,this.__actions__)}function q6t(r){return Re(r).toLowerCase()}function K6t(r){return Lt(r)?Qe(r,Lo):bn(r)?[r]:Ji(wU(Re(r)))}var qP=9007199254740991;function Q6t(r){return r?Zu(ee(r),-qP,qP):r===0?r:0}function iv(r){return Re(r).toUpperCase()}function J6t(r,t,e){var i=Lt(r),n=i||ol(r)||Vh(r);if(t=Yt(t),e==null){var a=r&&r.constructor;n?e=i?new a:[]:Fe(r)?e=ri(a)?zh(qy(r)):{}:e={}}return(n?fa:Oo)(r,function(o,s,l){return t(e,o,s,l)}),e}function Mz(r,t){for(var e=r.length;e--&&Hh(t,r[e],0)>-1;);return e}function Iz(r,t){for(var e=-1,i=r.length;++e<i&&Hh(t,r[e],0)>-1;);return e}function t7t(r,t,e){if(r=Re(r),r&&(e||t===void 0))return lU(r);if(!r||!(t=wn(t)))return r;var i=Na(r),n=Na(t),a=Iz(i,n),o=Mz(i,n)+1;return yl(i,a,o).join("")}function e7t(r,t,e){if(r=Re(r),r&&(e||t===void 0))return r.slice(0,sU(r)+1);if(!r||!(t=wn(t)))return r;var i=Na(r),n=Mz(i,Na(t))+1;return yl(i,0,n).join("")}var r7t=/^\s+/;function i7t(r,t,e){if(r=Re(r),r&&(e||t===void 0))return r.replace(r7t,"");if(!r||!(t=wn(t)))return r;var i=Na(r),n=Iz(i,Na(t));return yl(i,n).join("")}var n7t=30,a7t="...",o7t=/\w*$/;function s7t(r,t){var e=n7t,i=a7t;if(Fe(t)){var n="separator"in t?t.separator:n;e="length"in t?ee(t.length):e,i="omission"in t?wn(t.omission):i}r=Re(r);var a=r.length;if(Gh(r)){var o=Na(r);a=o.length}if(e>=a)return r;var s=e-jh(i);if(s<1)return i;var l=o?yl(o,0,s).join(""):r.slice(0,s);if(n===void 0)return l+i;if(o&&(s+=l.length-s),xb(n)){if(r.slice(s).search(n)){var u,c=l;for(n.global||(n=RegExp(n.source,Re(o7t.exec(n))+"g")),n.lastIndex=0;u=n.exec(c);)var h=u.index;l=l.slice(0,h===void 0?s:h)}}else if(r.indexOf(wn(n),s)!=s){var f=l.lastIndexOf(n);f>-1&&(l=l.slice(0,f))}return l+i}function l7t(r){return _U(r,1)}var u7t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},c7t=QT(u7t),h7t=c7t,Lz=/&(?:amp|lt|gt|quot|#39);/g,f7t=RegExp(Lz.source);function d7t(r){return r=Re(r),r&&f7t.test(r)?r.replace(Lz,h7t):r}var v7t=1/0,p7t=Wc&&1/Ky(new Wc([,-0]))[1]==v7t?function(r){return new Wc(r)}:Wy,g7t=p7t,m7t=200;function sl(r,t,e){var i=-1,n=Gy,a=r.length,o=!0,s=[],l=s;if(e)o=!1,n=db;else if(a>=m7t){var u=t?null:g7t(r);if(u)return Ky(u);o=!1,n=tv,l=new wu}else l=t?[]:s;t:for(;++i<a;){var c=r[i],h=t?t(c):c;if(c=e||c!==0?c:0,o&&h===h){for(var f=l.length;f--;)if(l[f]===h)continue t;t&&l.push(h),s.push(c)}else n(l,h,e)||(l!==s&&l.push(h),s.push(c))}return s}var y7t=ae(function(r){return sl(ii(r,1,vr,!0))}),_7t=y7t,x7t=ae(function(r){var t=Be(r);return vr(t)&&(t=void 0),sl(ii(r,1,vr,!0),Yt(t))}),C7t=x7t,E7t=ae(function(r){var t=Be(r);return t=typeof t=="function"?t:void 0,sl(ii(r,1,vr,!0),void 0,t)}),S7t=E7t;function Vo(r){return r&&r.length?sl(r):[]}function A7t(r,t){return r&&r.length?sl(r,Yt(t)):[]}function T7t(r,t){return t=typeof t=="function"?t:void 0,r&&r.length?sl(r,void 0,t):[]}var b7t=0;function w7t(r){var t=++b7t;return Re(r)+t}function vE(r,t){return r==null?!0:bb(r,t)}var R7t=Math.max;function kb(r){if(!(r&&r.length))return[];var t=0;return r=_l(r,function(e){if(vr(e))return t=R7t(e.length,t),!0}),$T(t,function(e){return Qe(r,lb(e))})}function Oz(r,t){if(!(r&&r.length))return[];var e=kb(r);return t==null?e:Qe(e,function(i){return Rn(t,void 0,i)})}function Pz(r,t,e,i){return lp(r,t,e(ju(r,t)),i)}function M7t(r,t,e){return r==null?r:Pz(r,t,Po(e))}function I7t(r,t,e,i){return i=typeof i=="function"?i:void 0,r==null?r:Pz(r,t,Po(e),i)}var L7t=Xh(function(r,t,e){return r+(e?" ":"")+t.toUpperCase()}),O7t=L7t;function P7t(r){return r==null?[]:mb(r,fn(r))}var F7t=ae(function(r,t){return vr(r)?np(r,t):[]}),B7t=F7t;function D7t(r,t){return vz(Po(t),r)}var N7t=ms(function(r){var t=r.length,e=t?r[0]:0,i=this.__wrapped__,n=function(a){return XT(a,r)};return t>1||this.__actions__.length||!(i instanceof fe)||!fs(e)?this.thru(n):(i=i.slice(e,+e+(t?1:0)),i.__actions__.push({func:up,args:[n],thisArg:void 0}),new aa(i,this.__chain__).thru(function(a){return t&&!a.length&&a.push(void 0),a}))}),k7t=N7t;function U7t(){return r9(this)}function z7t(){var r=this.__wrapped__;if(r instanceof fe){var t=r;return this.__actions__.length&&(t=new fe(this)),t=t.reverse(),t.__actions__.push({func:up,args:[fE],thisArg:void 0}),new aa(t,this.__chain__)}return this.thru(fE)}function Ub(r,t,e){var i=r.length;if(i<2)return i?sl(r[0]):[];for(var n=-1,a=Array(i);++n<i;)for(var o=r[n],s=-1;++s<i;)s!=n&&(a[n]=np(a[n]||o,r[s],t,e));return sl(ii(a,1),t,e)}var H7t=ae(function(r){return Ub(_l(r,vr))}),$7t=H7t,W7t=ae(function(r){var t=Be(r);return vr(t)&&(t=void 0),Ub(_l(r,vr),Yt(t))}),V7t=W7t,G7t=ae(function(r){var t=Be(r);return t=typeof t=="function"?t:void 0,Ub(_l(r,vr),void 0,t)}),X7t=G7t,Y7t=ae(kb),h_=Y7t;function Fz(r,t,e){for(var i=-1,n=r.length,a=t.length,o={};++i<n;){var s=i<a?t[i]:void 0;e(o,r[i],s)}return o}function j7t(r,t){return Fz(r||[],t||[],Jv)}function Z7t(r,t){return Fz(r||[],t||[],lp)}var q7t=ae(function(r){var t=r.length,e=t>1?r[t-1]:void 0;return e=typeof e=="function"?(r.pop(),e):void 0,Oz(r,e)}),K7t=q7t,At={chunk:HLt,compact:Oa,concat:Tc,difference:I9,differenceBy:HFt,differenceWith:L9,drop:GFt,dropRight:XFt,dropRightWhile:YFt,dropWhile:jFt,fill:vBt,findIndex:mh,findLastIndex:$9,first:Mu,flatten:RU,flattenDeep:V9,flattenDepth:bBt,fromPairs:WBt,head:Mu,indexOf:a_,initial:uDt,intersection:Y9,intersectionBy:dDt,intersectionWith:pDt,join:h5t,last:Be,lastIndexOf:_5t,nth:Y5t,pull:Q4t,pullAll:gz,pullAllBy:J4t,pullAllWith:tNt,pullAt:nNt,remove:SNt,reverse:fE,slice:VNt,sortedIndex:e6t,sortedIndexBy:r6t,sortedIndexOf:i6t,sortedLastIndex:n6t,sortedLastIndexBy:a6t,sortedLastIndexOf:o6t,sortedUniq:s6t,sortedUniqBy:l6t,tail:C6t,take:E6t,takeRight:S6t,takeRightWhile:A6t,takeWhile:T6t,union:_7t,unionBy:C7t,unionWith:S7t,uniq:Vo,uniqBy:A7t,uniqWith:T7t,unzip:kb,unzipWith:Oz,without:B7t,xor:$7t,xorBy:V7t,xorWith:X7t,zip:h_,zipObject:j7t,zipObjectDeep:Z7t,zipWith:K7t},ke={countBy:mFt,each:$t,eachRight:UP,every:e_,filter:ys,find:vi,findLast:r_,flatMap:ap,flatMapDeep:SBt,flatMapDepth:ABt,forEach:$t,forEachRight:UP,groupBy:ZBt,includes:wi,invokeMap:RDt,keyBy:p5t,map:ue,orderBy:Mb,partition:V4t,reduce:l_,reduceRight:CNt,reject:ENt,sample:FNt,sampleSize:NNt,shuffle:HNt,size:bc,some:Cz,sortBy:Ez},Q7t={now:f0},fr={after:Xwt,ary:_U,before:LU,bind:OU,bindKey:SIt,curry:cb,curryRight:hb,debounce:ev,defer:BFt,delay:NFt,flip:RBt,memoize:Yu,negate:sp,once:e4t,overArgs:c4t,partial:vz,partialRight:$4t,rearg:_Nt,rest:wNt,spread:f6t,throttle:Nb,unary:l7t,wrap:D7t},Ft={castArray:FLt,clone:rp,cloneDeep:iE,cloneDeepWith:SPt,cloneWith:TPt,conformsTo:uFt,eq:Va,gt:KBt,gte:JBt,isArguments:Tu,isArray:Lt,isArrayBuffer:ODt,isArrayLike:hn,isArrayLikeObject:vr,isBoolean:uo,isBuffer:ol,isDate:NDt,isElement:kDt,isEmpty:st,isEqual:Jr,isEqualWith:WDt,isError:YT,isFinite:GDt,isFunction:ri,isInteger:K9,isLength:Yy,isMap:c9,isMatch:XDt,isMatchWith:YDt,isNaN:Q9,isNative:QDt,isNil:Or,isNull:J9,isNumber:Si,isObject:Fe,isObjectLike:hr,isPlainObject:ep,isRegExp:xb,isSafeInteger:r5t,isSet:h9,isString:Yh,isSymbol:bn,isTypedArray:Vh,isUndefined:o_,isWeakMap:n5t,isWeakSet:o5t,lt:A5t,lte:b5t,toArray:iz,toFinite:rs,toInteger:ee,toLength:k9,toNumber:En,toPlainObject:w9,toSafeInteger:Q6t,toString:Re},Pi={add:Nwt,ceil:kLt,divide:VFt,floor:IBt,max:yh,maxBy:Sb,mean:O5t,meanBy:P5t,min:Tb,minBy:U5t,multiply:H5t,round:ONt,subtract:_6t,sum:x6t,sumBy:Tz},zb={clamp:Cm,inRange:sE,random:cNt},Vt={assign:bU,assignIn:gP,assignInWith:xm,assignWith:C3t,at:aIt,create:yFt,defaults:RFt,defaultsDeep:OFt,entries:zP,entriesIn:HP,extend:gP,extendWith:xm,findKey:mBt,findLastKey:CBt,forIn:X9,forInRight:zBt,forOwn:HBt,forOwnRight:$Bt,functions:VBt,functionsIn:GBt,get:kt,has:oE,hasIn:Ru,invert:xDt,invertBy:ADt,invoke:bDt,keys:ar,keysIn:fn,mapKeys:tz,mapValues:w5t,merge:Sm,mergeWith:fb,omit:wb,omitBy:t4t,pick:pz,pickBy:Rb,result:RNt,set:rv,setWith:kNt,toPairs:zP,toPairsIn:HP,transform:J6t,unset:vE,update:M7t,updateWith:I7t,values:_s,valuesIn:P7t},Fo={at:k7t,chain:r9,commit:bPt,lodash:L,next:X5t,plant:Y4t,reverse:z7t,tap:b6t,thru:up,toIterator:Z6t,toJSON:H1,value:H1,valueOf:H1,wrapperChain:U7t},Ie={camelCase:PLt,capitalize:zU,deburr:HU,endsWith:QFt,escape:pb,escapeRegExp:cBt,kebabCase:d5t,lowerCase:Cb,lowerFirst:E5t,pad:F4t,padEnd:B4t,padStart:D4t,parseInt:U4t,repeat:ANt,replace:TNt,snakeCase:XNt,split:Db,startCase:v6t,startsWith:p6t,template:V6t,templateSettings:dE,toLower:q6t,toUpper:iv,trim:t7t,trimEnd:e7t,trimStart:i7t,truncate:s7t,unescape:d7t,upperCase:O7t,upperFirst:qT,words:e9},Le={attempt:IU,bindAll:_It,cond:E9,conforms:lFt,constant:$c,defaultTo:TFt,flow:NBt,flowRight:UBt,identity:gi,iteratee:l5t,matches:lE,matchesProperty:I5t,method:D5t,methodOf:k5t,mixin:rz,noop:Wy,nthArg:j5t,over:a4t,overEvery:f4t,overSome:v4t,property:C9,propertyOf:j4t,range:Vc,rangeRight:gNt,stubArray:tb,stubFalse:WT,stubObject:g6t,stubString:m6t,stubTrue:Az,times:j6t,toPath:K6t,uniqueId:w7t};function J7t(){var r=new fe(this.__wrapped__);return r.__actions__=Ji(this.__actions__),r.__dir__=this.__dir__,r.__filtered__=this.__filtered__,r.__iteratees__=Ji(this.__iteratees__),r.__takeCount__=this.__takeCount__,r.__views__=Ji(this.__views__),r}function t8t(){if(this.__filtered__){var r=new fe(this);r.__dir__=-1,r.__filtered__=!0}else r=this.clone(),r.__dir__*=-1;return r}var e8t=Math.max,r8t=Math.min;function i8t(r,t,e){for(var i=-1,n=e.length;++i<n;){var a=e[i],o=a.size;switch(a.type){case"drop":r+=o;break;case"dropRight":t-=o;break;case"take":t=r8t(t,r+o);break;case"takeRight":r=e8t(r,t-o);break}}return{start:r,end:t}}var n8t=1,a8t=2,o8t=Math.min;function s8t(){var r=this.__wrapped__.value(),t=this.__dir__,e=Lt(r),i=t<0,n=e?r.length:0,a=i8t(0,n,this.__views__),o=a.start,s=a.end,l=s-o,u=i?s:o-1,c=this.__iteratees__,h=c.length,f=0,d=o8t(l,this.__takeCount__);if(!e||!i&&n==l&&d==l)return Rz(r,this.__actions__);var v=[];t:for(;l--&&f<d;){u+=t;for(var p=-1,g=r[u];++p<h;){var m=c[p],y=m.iteratee,_=m.type,x=y(g);if(_==a8t)g=x;else if(!x){if(_==n8t)continue t;break t}}v[f++]=g}return v}/**
 * @license
 * Lodash (Custom Build) <https://lodash.com/>
 * Build: `lodash modularize exports="es" -o ./`
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */var l8t="4.17.21",u8t=2,c8t=1,h8t=3,Bz=4294967295,f8t=Array.prototype,d8t=Object.prototype,Dz=d8t.hasOwnProperty,KP=di?di.iterator:void 0,v8t=Math.max,QP=Math.min,Hb=function(r){return function(t,e,i){if(i==null){var n=Fe(e),a=n&&ar(e),o=a&&a.length&&i_(e,a);(o?o.length:n)||(i=e,e=t,t=this)}return r(t,e,i)}}(rz);L.after=fr.after;L.ary=fr.ary;L.assign=Vt.assign;L.assignIn=Vt.assignIn;L.assignInWith=Vt.assignInWith;L.assignWith=Vt.assignWith;L.at=Vt.at;L.before=fr.before;L.bind=fr.bind;L.bindAll=Le.bindAll;L.bindKey=fr.bindKey;L.castArray=Ft.castArray;L.chain=Fo.chain;L.chunk=At.chunk;L.compact=At.compact;L.concat=At.concat;L.cond=Le.cond;L.conforms=Le.conforms;L.constant=Le.constant;L.countBy=ke.countBy;L.create=Vt.create;L.curry=fr.curry;L.curryRight=fr.curryRight;L.debounce=fr.debounce;L.defaults=Vt.defaults;L.defaultsDeep=Vt.defaultsDeep;L.defer=fr.defer;L.delay=fr.delay;L.difference=At.difference;L.differenceBy=At.differenceBy;L.differenceWith=At.differenceWith;L.drop=At.drop;L.dropRight=At.dropRight;L.dropRightWhile=At.dropRightWhile;L.dropWhile=At.dropWhile;L.fill=At.fill;L.filter=ke.filter;L.flatMap=ke.flatMap;L.flatMapDeep=ke.flatMapDeep;L.flatMapDepth=ke.flatMapDepth;L.flatten=At.flatten;L.flattenDeep=At.flattenDeep;L.flattenDepth=At.flattenDepth;L.flip=fr.flip;L.flow=Le.flow;L.flowRight=Le.flowRight;L.fromPairs=At.fromPairs;L.functions=Vt.functions;L.functionsIn=Vt.functionsIn;L.groupBy=ke.groupBy;L.initial=At.initial;L.intersection=At.intersection;L.intersectionBy=At.intersectionBy;L.intersectionWith=At.intersectionWith;L.invert=Vt.invert;L.invertBy=Vt.invertBy;L.invokeMap=ke.invokeMap;L.iteratee=Le.iteratee;L.keyBy=ke.keyBy;L.keys=ar;L.keysIn=Vt.keysIn;L.map=ke.map;L.mapKeys=Vt.mapKeys;L.mapValues=Vt.mapValues;L.matches=Le.matches;L.matchesProperty=Le.matchesProperty;L.memoize=fr.memoize;L.merge=Vt.merge;L.mergeWith=Vt.mergeWith;L.method=Le.method;L.methodOf=Le.methodOf;L.mixin=Hb;L.negate=sp;L.nthArg=Le.nthArg;L.omit=Vt.omit;L.omitBy=Vt.omitBy;L.once=fr.once;L.orderBy=ke.orderBy;L.over=Le.over;L.overArgs=fr.overArgs;L.overEvery=Le.overEvery;L.overSome=Le.overSome;L.partial=fr.partial;L.partialRight=fr.partialRight;L.partition=ke.partition;L.pick=Vt.pick;L.pickBy=Vt.pickBy;L.property=Le.property;L.propertyOf=Le.propertyOf;L.pull=At.pull;L.pullAll=At.pullAll;L.pullAllBy=At.pullAllBy;L.pullAllWith=At.pullAllWith;L.pullAt=At.pullAt;L.range=Le.range;L.rangeRight=Le.rangeRight;L.rearg=fr.rearg;L.reject=ke.reject;L.remove=At.remove;L.rest=fr.rest;L.reverse=At.reverse;L.sampleSize=ke.sampleSize;L.set=Vt.set;L.setWith=Vt.setWith;L.shuffle=ke.shuffle;L.slice=At.slice;L.sortBy=ke.sortBy;L.sortedUniq=At.sortedUniq;L.sortedUniqBy=At.sortedUniqBy;L.split=Ie.split;L.spread=fr.spread;L.tail=At.tail;L.take=At.take;L.takeRight=At.takeRight;L.takeRightWhile=At.takeRightWhile;L.takeWhile=At.takeWhile;L.tap=Fo.tap;L.throttle=fr.throttle;L.thru=up;L.toArray=Ft.toArray;L.toPairs=Vt.toPairs;L.toPairsIn=Vt.toPairsIn;L.toPath=Le.toPath;L.toPlainObject=Ft.toPlainObject;L.transform=Vt.transform;L.unary=fr.unary;L.union=At.union;L.unionBy=At.unionBy;L.unionWith=At.unionWith;L.uniq=At.uniq;L.uniqBy=At.uniqBy;L.uniqWith=At.uniqWith;L.unset=Vt.unset;L.unzip=At.unzip;L.unzipWith=At.unzipWith;L.update=Vt.update;L.updateWith=Vt.updateWith;L.values=Vt.values;L.valuesIn=Vt.valuesIn;L.without=At.without;L.words=Ie.words;L.wrap=fr.wrap;L.xor=At.xor;L.xorBy=At.xorBy;L.xorWith=At.xorWith;L.zip=At.zip;L.zipObject=At.zipObject;L.zipObjectDeep=At.zipObjectDeep;L.zipWith=At.zipWith;L.entries=Vt.toPairs;L.entriesIn=Vt.toPairsIn;L.extend=Vt.assignIn;L.extendWith=Vt.assignInWith;Hb(L,L);L.add=Pi.add;L.attempt=Le.attempt;L.camelCase=Ie.camelCase;L.capitalize=Ie.capitalize;L.ceil=Pi.ceil;L.clamp=zb.clamp;L.clone=Ft.clone;L.cloneDeep=Ft.cloneDeep;L.cloneDeepWith=Ft.cloneDeepWith;L.cloneWith=Ft.cloneWith;L.conformsTo=Ft.conformsTo;L.deburr=Ie.deburr;L.defaultTo=Le.defaultTo;L.divide=Pi.divide;L.endsWith=Ie.endsWith;L.eq=Ft.eq;L.escape=Ie.escape;L.escapeRegExp=Ie.escapeRegExp;L.every=ke.every;L.find=ke.find;L.findIndex=At.findIndex;L.findKey=Vt.findKey;L.findLast=ke.findLast;L.findLastIndex=At.findLastIndex;L.findLastKey=Vt.findLastKey;L.floor=Pi.floor;L.forEach=ke.forEach;L.forEachRight=ke.forEachRight;L.forIn=Vt.forIn;L.forInRight=Vt.forInRight;L.forOwn=Vt.forOwn;L.forOwnRight=Vt.forOwnRight;L.get=Vt.get;L.gt=Ft.gt;L.gte=Ft.gte;L.has=Vt.has;L.hasIn=Vt.hasIn;L.head=At.head;L.identity=gi;L.includes=ke.includes;L.indexOf=At.indexOf;L.inRange=zb.inRange;L.invoke=Vt.invoke;L.isArguments=Ft.isArguments;L.isArray=Lt;L.isArrayBuffer=Ft.isArrayBuffer;L.isArrayLike=Ft.isArrayLike;L.isArrayLikeObject=Ft.isArrayLikeObject;L.isBoolean=Ft.isBoolean;L.isBuffer=Ft.isBuffer;L.isDate=Ft.isDate;L.isElement=Ft.isElement;L.isEmpty=Ft.isEmpty;L.isEqual=Ft.isEqual;L.isEqualWith=Ft.isEqualWith;L.isError=Ft.isError;L.isFinite=Ft.isFinite;L.isFunction=Ft.isFunction;L.isInteger=Ft.isInteger;L.isLength=Ft.isLength;L.isMap=Ft.isMap;L.isMatch=Ft.isMatch;L.isMatchWith=Ft.isMatchWith;L.isNaN=Ft.isNaN;L.isNative=Ft.isNative;L.isNil=Ft.isNil;L.isNull=Ft.isNull;L.isNumber=Ft.isNumber;L.isObject=Fe;L.isObjectLike=Ft.isObjectLike;L.isPlainObject=Ft.isPlainObject;L.isRegExp=Ft.isRegExp;L.isSafeInteger=Ft.isSafeInteger;L.isSet=Ft.isSet;L.isString=Ft.isString;L.isSymbol=Ft.isSymbol;L.isTypedArray=Ft.isTypedArray;L.isUndefined=Ft.isUndefined;L.isWeakMap=Ft.isWeakMap;L.isWeakSet=Ft.isWeakSet;L.join=At.join;L.kebabCase=Ie.kebabCase;L.last=Be;L.lastIndexOf=At.lastIndexOf;L.lowerCase=Ie.lowerCase;L.lowerFirst=Ie.lowerFirst;L.lt=Ft.lt;L.lte=Ft.lte;L.max=Pi.max;L.maxBy=Pi.maxBy;L.mean=Pi.mean;L.meanBy=Pi.meanBy;L.min=Pi.min;L.minBy=Pi.minBy;L.stubArray=Le.stubArray;L.stubFalse=Le.stubFalse;L.stubObject=Le.stubObject;L.stubString=Le.stubString;L.stubTrue=Le.stubTrue;L.multiply=Pi.multiply;L.nth=At.nth;L.noop=Le.noop;L.now=Q7t.now;L.pad=Ie.pad;L.padEnd=Ie.padEnd;L.padStart=Ie.padStart;L.parseInt=Ie.parseInt;L.random=zb.random;L.reduce=ke.reduce;L.reduceRight=ke.reduceRight;L.repeat=Ie.repeat;L.replace=Ie.replace;L.result=Vt.result;L.round=Pi.round;L.sample=ke.sample;L.size=ke.size;L.snakeCase=Ie.snakeCase;L.some=ke.some;L.sortedIndex=At.sortedIndex;L.sortedIndexBy=At.sortedIndexBy;L.sortedIndexOf=At.sortedIndexOf;L.sortedLastIndex=At.sortedLastIndex;L.sortedLastIndexBy=At.sortedLastIndexBy;L.sortedLastIndexOf=At.sortedLastIndexOf;L.startCase=Ie.startCase;L.startsWith=Ie.startsWith;L.subtract=Pi.subtract;L.sum=Pi.sum;L.sumBy=Pi.sumBy;L.template=Ie.template;L.times=Le.times;L.toFinite=Ft.toFinite;L.toInteger=ee;L.toLength=Ft.toLength;L.toLower=Ie.toLower;L.toNumber=Ft.toNumber;L.toSafeInteger=Ft.toSafeInteger;L.toString=Ft.toString;L.toUpper=Ie.toUpper;L.trim=Ie.trim;L.trimEnd=Ie.trimEnd;L.trimStart=Ie.trimStart;L.truncate=Ie.truncate;L.unescape=Ie.unescape;L.uniqueId=Le.uniqueId;L.upperCase=Ie.upperCase;L.upperFirst=Ie.upperFirst;L.each=ke.forEach;L.eachRight=ke.forEachRight;L.first=At.head;Hb(L,function(){var r={};return Oo(L,function(t,e){Dz.call(L.prototype,e)||(r[e]=t)}),r}(),{chain:!1});L.VERSION=l8t;(L.templateSettings=Ie.templateSettings).imports._=L;fa(["bind","bindKey","curry","curryRight","partial","partialRight"],function(r){L[r].placeholder=L});fa(["drop","take"],function(r,t){fe.prototype[r]=function(e){e=e===void 0?1:v8t(ee(e),0);var i=this.__filtered__&&!t?new fe(this):this.clone();return i.__filtered__?i.__takeCount__=QP(e,i.__takeCount__):i.__views__.push({size:QP(e,Bz),type:r+(i.__dir__<0?"Right":"")}),i},fe.prototype[r+"Right"]=function(e){return this.reverse()[r](e).reverse()}});fa(["filter","map","takeWhile"],function(r,t){var e=t+1,i=e==c8t||e==h8t;fe.prototype[r]=function(n){var a=this.clone();return a.__iteratees__.push({iteratee:Yt(n),type:e}),a.__filtered__=a.__filtered__||i,a}});fa(["head","last"],function(r,t){var e="take"+(t?"Right":"");fe.prototype[r]=function(){return this[e](1).value()[0]}});fa(["initial","tail"],function(r,t){var e="drop"+(t?"":"Right");fe.prototype[r]=function(){return this.__filtered__?new fe(this):this[e](1)}});fe.prototype.compact=function(){return this.filter(gi)};fe.prototype.find=function(r){return this.filter(r).head()};fe.prototype.findLast=function(r){return this.reverse().find(r)};fe.prototype.invokeMap=ae(function(r,t){return typeof r=="function"?new fe(this):this.map(function(e){return op(e,r,t)})});fe.prototype.reject=function(r){return this.filter(sp(Yt(r)))};fe.prototype.slice=function(r,t){r=ee(r);var e=this;return e.__filtered__&&(r>0||t<0)?new fe(e):(r<0?e=e.takeRight(-r):r&&(e=e.drop(r)),t!==void 0&&(t=ee(t),e=t<0?e.dropRight(-t):e.take(t-r)),e)};fe.prototype.takeRightWhile=function(r){return this.reverse().takeWhile(r).reverse()};fe.prototype.toArray=function(){return this.take(Bz)};Oo(fe.prototype,function(r,t){var e=/^(?:filter|find|map|reject)|While$/.test(t),i=/^(?:head|last)$/.test(t),n=L[i?"take"+(t=="last"?"Right":""):t],a=i||/^find/.test(t);n&&(L.prototype[t]=function(){var o=this.__wrapped__,s=i?[1]:arguments,l=o instanceof fe,u=s[0],c=l||Lt(o),h=function(m){var y=n.apply(L,ml([m],s));return i&&f?y[0]:y};c&&e&&typeof u=="function"&&u.length!=1&&(l=c=!1);var f=this.__chain__,d=!!this.__actions__.length,v=a&&!f,p=l&&!d;if(!a&&c){o=p?o:new fe(this);var g=r.apply(o,s);return g.__actions__.push({func:up,args:[h],thisArg:void 0}),new aa(g,f)}return v&&p?r.apply(this,s):(g=this.thru(h),v?i?g.value()[0]:g.value():g)})});fa(["pop","push","shift","sort","splice","unshift"],function(r){var t=f8t[r],e=/^(?:push|sort|unshift)$/.test(r)?"tap":"thru",i=/^(?:pop|shift)$/.test(r);L.prototype[r]=function(){var n=arguments;if(i&&!this.__chain__){var a=this.value();return t.apply(Lt(a)?a:[],n)}return this[e](function(o){return t.apply(Lt(o)?o:[],n)})}});Oo(fe.prototype,function(r,t){var e=L[t];if(e){var i=e.name+"";Dz.call(Hc,i)||(Hc[i]=[]),Hc[i].push({name:t,func:e})}});Hc[Xy(void 0,u8t).name]=[{name:"wrapper",func:void 0}];fe.prototype.clone=J7t;fe.prototype.reverse=t8t;fe.prototype.value=s8t;L.prototype.at=Fo.at;L.prototype.chain=Fo.wrapperChain;L.prototype.commit=Fo.commit;L.prototype.next=Fo.next;L.prototype.plant=Fo.plant;L.prototype.reverse=Fo.reverse;L.prototype.toJSON=L.prototype.valueOf=L.prototype.value=Fo.value;L.prototype.first=L.prototype.head;KP&&(L.prototype[KP]=Fo.toIterator);function Tm(r){"@babel/helpers - typeof";return Tm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tm(r)}var p8t=/^\s+/,g8t=/\s+$/;function wt(r,t){if(r=r||"",t=t||{},r instanceof wt)return r;if(!(this instanceof wt))return new wt(r,t);var e=m8t(r);this._originalInput=r,this._r=e.r,this._g=e.g,this._b=e.b,this._a=e.a,this._roundA=Math.round(100*this._a)/100,this._format=t.format||e.format,this._gradientType=t.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=e.ok}wt.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var t=this.toRgb();return(t.r*299+t.g*587+t.b*114)/1e3},getLuminance:function(){var t=this.toRgb(),e,i,n,a,o,s;return e=t.r/255,i=t.g/255,n=t.b/255,e<=.03928?a=e/12.92:a=Math.pow((e+.055)/1.055,2.4),i<=.03928?o=i/12.92:o=Math.pow((i+.055)/1.055,2.4),n<=.03928?s=n/12.92:s=Math.pow((n+.055)/1.055,2.4),.2126*a+.7152*o+.0722*s},setAlpha:function(t){return this._a=Nz(t),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var t=tF(this._r,this._g,this._b);return{h:t.h*360,s:t.s,v:t.v,a:this._a}},toHsvString:function(){var t=tF(this._r,this._g,this._b),e=Math.round(t.h*360),i=Math.round(t.s*100),n=Math.round(t.v*100);return this._a==1?"hsv("+e+", "+i+"%, "+n+"%)":"hsva("+e+", "+i+"%, "+n+"%, "+this._roundA+")"},toHsl:function(){var t=JP(this._r,this._g,this._b);return{h:t.h*360,s:t.s,l:t.l,a:this._a}},toHslString:function(){var t=JP(this._r,this._g,this._b),e=Math.round(t.h*360),i=Math.round(t.s*100),n=Math.round(t.l*100);return this._a==1?"hsl("+e+", "+i+"%, "+n+"%)":"hsla("+e+", "+i+"%, "+n+"%, "+this._roundA+")"},toHex:function(t){return eF(this._r,this._g,this._b,t)},toHexString:function(t){return"#"+this.toHex(t)},toHex8:function(t){return C8t(this._r,this._g,this._b,this._a,t)},toHex8String:function(t){return"#"+this.toHex8(t)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(qe(this._r,255)*100)+"%",g:Math.round(qe(this._g,255)*100)+"%",b:Math.round(qe(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(qe(this._r,255)*100)+"%, "+Math.round(qe(this._g,255)*100)+"%, "+Math.round(qe(this._b,255)*100)+"%)":"rgba("+Math.round(qe(this._r,255)*100)+"%, "+Math.round(qe(this._g,255)*100)+"%, "+Math.round(qe(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:P8t[eF(this._r,this._g,this._b,!0)]||!1},toFilter:function(t){var e="#"+rF(this._r,this._g,this._b,this._a),i=e,n=this._gradientType?"GradientType = 1, ":"";if(t){var a=wt(t);i="#"+rF(a._r,a._g,a._b,a._a)}return"progid:DXImageTransform.Microsoft.gradient("+n+"startColorstr="+e+",endColorstr="+i+")"},toString:function(t){var e=!!t;t=t||this._format;var i=!1,n=this._a<1&&this._a>=0,a=!e&&n&&(t==="hex"||t==="hex6"||t==="hex3"||t==="hex4"||t==="hex8"||t==="name");return a?t==="name"&&this._a===0?this.toName():this.toRgbString():(t==="rgb"&&(i=this.toRgbString()),t==="prgb"&&(i=this.toPercentageRgbString()),(t==="hex"||t==="hex6")&&(i=this.toHexString()),t==="hex3"&&(i=this.toHexString(!0)),t==="hex4"&&(i=this.toHex8String(!0)),t==="hex8"&&(i=this.toHex8String()),t==="name"&&(i=this.toName()),t==="hsl"&&(i=this.toHslString()),t==="hsv"&&(i=this.toHsvString()),i||this.toHexString())},clone:function(){return wt(this.toString())},_applyModification:function(t,e){var i=t.apply(null,[this].concat([].slice.call(e)));return this._r=i._r,this._g=i._g,this._b=i._b,this.setAlpha(i._a),this},lighten:function(){return this._applyModification(T8t,arguments)},brighten:function(){return this._applyModification(b8t,arguments)},darken:function(){return this._applyModification(w8t,arguments)},desaturate:function(){return this._applyModification(E8t,arguments)},saturate:function(){return this._applyModification(S8t,arguments)},greyscale:function(){return this._applyModification(A8t,arguments)},spin:function(){return this._applyModification(R8t,arguments)},_applyCombination:function(t,e){return t.apply(null,[this].concat([].slice.call(e)))},analogous:function(){return this._applyCombination(L8t,arguments)},complement:function(){return this._applyCombination(M8t,arguments)},monochromatic:function(){return this._applyCombination(O8t,arguments)},splitcomplement:function(){return this._applyCombination(I8t,arguments)},triad:function(){return this._applyCombination(iF,[3])},tetrad:function(){return this._applyCombination(iF,[4])}};wt.fromRatio=function(r,t){if(Tm(r)=="object"){var e={};for(var i in r)r.hasOwnProperty(i)&&(i==="a"?e[i]=r[i]:e[i]=Gf(r[i]));r=e}return wt(r,t)};function m8t(r){var t={r:0,g:0,b:0},e=1,i=null,n=null,a=null,o=!1,s=!1;return typeof r=="string"&&(r=N8t(r)),Tm(r)=="object"&&(Uo(r.r)&&Uo(r.g)&&Uo(r.b)?(t=y8t(r.r,r.g,r.b),o=!0,s=String(r.r).substr(-1)==="%"?"prgb":"rgb"):Uo(r.h)&&Uo(r.s)&&Uo(r.v)?(i=Gf(r.s),n=Gf(r.v),t=x8t(r.h,i,n),o=!0,s="hsv"):Uo(r.h)&&Uo(r.s)&&Uo(r.l)&&(i=Gf(r.s),a=Gf(r.l),t=_8t(r.h,i,a),o=!0,s="hsl"),r.hasOwnProperty("a")&&(e=r.a)),e=Nz(e),{ok:o,format:r.format||s,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:e}}function y8t(r,t,e){return{r:qe(r,255)*255,g:qe(t,255)*255,b:qe(e,255)*255}}function JP(r,t,e){r=qe(r,255),t=qe(t,255),e=qe(e,255);var i=Math.max(r,t,e),n=Math.min(r,t,e),a,o,s=(i+n)/2;if(i==n)a=o=0;else{var l=i-n;switch(o=s>.5?l/(2-i-n):l/(i+n),i){case r:a=(t-e)/l+(t<e?6:0);break;case t:a=(e-r)/l+2;break;case e:a=(r-t)/l+4;break}a/=6}return{h:a,s:o,l:s}}function _8t(r,t,e){var i,n,a;r=qe(r,360),t=qe(t,100),e=qe(e,100);function o(u,c,h){return h<0&&(h+=1),h>1&&(h-=1),h<1/6?u+(c-u)*6*h:h<1/2?c:h<2/3?u+(c-u)*(2/3-h)*6:u}if(t===0)i=n=a=e;else{var s=e<.5?e*(1+t):e+t-e*t,l=2*e-s;i=o(l,s,r+1/3),n=o(l,s,r),a=o(l,s,r-1/3)}return{r:i*255,g:n*255,b:a*255}}function tF(r,t,e){r=qe(r,255),t=qe(t,255),e=qe(e,255);var i=Math.max(r,t,e),n=Math.min(r,t,e),a,o,s=i,l=i-n;if(o=i===0?0:l/i,i==n)a=0;else{switch(i){case r:a=(t-e)/l+(t<e?6:0);break;case t:a=(e-r)/l+2;break;case e:a=(r-t)/l+4;break}a/=6}return{h:a,s:o,v:s}}function x8t(r,t,e){r=qe(r,360)*6,t=qe(t,100),e=qe(e,100);var i=Math.floor(r),n=r-i,a=e*(1-t),o=e*(1-n*t),s=e*(1-(1-n)*t),l=i%6,u=[e,o,a,a,s,e][l],c=[s,e,e,o,a,a][l],h=[a,a,s,e,e,o][l];return{r:u*255,g:c*255,b:h*255}}function eF(r,t,e,i){var n=[Aa(Math.round(r).toString(16)),Aa(Math.round(t).toString(16)),Aa(Math.round(e).toString(16))];return i&&n[0].charAt(0)==n[0].charAt(1)&&n[1].charAt(0)==n[1].charAt(1)&&n[2].charAt(0)==n[2].charAt(1)?n[0].charAt(0)+n[1].charAt(0)+n[2].charAt(0):n.join("")}function C8t(r,t,e,i,n){var a=[Aa(Math.round(r).toString(16)),Aa(Math.round(t).toString(16)),Aa(Math.round(e).toString(16)),Aa(kz(i))];return n&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)&&a[3].charAt(0)==a[3].charAt(1)?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0)+a[3].charAt(0):a.join("")}function rF(r,t,e,i){var n=[Aa(kz(i)),Aa(Math.round(r).toString(16)),Aa(Math.round(t).toString(16)),Aa(Math.round(e).toString(16))];return n.join("")}wt.equals=function(r,t){return!r||!t?!1:wt(r).toRgbString()==wt(t).toRgbString()};wt.random=function(){return wt.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function E8t(r,t){t=t===0?0:t||10;var e=wt(r).toHsl();return e.s-=t/100,e.s=f_(e.s),wt(e)}function S8t(r,t){t=t===0?0:t||10;var e=wt(r).toHsl();return e.s+=t/100,e.s=f_(e.s),wt(e)}function A8t(r){return wt(r).desaturate(100)}function T8t(r,t){t=t===0?0:t||10;var e=wt(r).toHsl();return e.l+=t/100,e.l=f_(e.l),wt(e)}function b8t(r,t){t=t===0?0:t||10;var e=wt(r).toRgb();return e.r=Math.max(0,Math.min(255,e.r-Math.round(255*-(t/100)))),e.g=Math.max(0,Math.min(255,e.g-Math.round(255*-(t/100)))),e.b=Math.max(0,Math.min(255,e.b-Math.round(255*-(t/100)))),wt(e)}function w8t(r,t){t=t===0?0:t||10;var e=wt(r).toHsl();return e.l-=t/100,e.l=f_(e.l),wt(e)}function R8t(r,t){var e=wt(r).toHsl(),i=(e.h+t)%360;return e.h=i<0?360+i:i,wt(e)}function M8t(r){var t=wt(r).toHsl();return t.h=(t.h+180)%360,wt(t)}function iF(r,t){if(isNaN(t)||t<=0)throw new Error("Argument to polyad must be a positive number");for(var e=wt(r).toHsl(),i=[wt(r)],n=360/t,a=1;a<t;a++)i.push(wt({h:(e.h+a*n)%360,s:e.s,l:e.l}));return i}function I8t(r){var t=wt(r).toHsl(),e=t.h;return[wt(r),wt({h:(e+72)%360,s:t.s,l:t.l}),wt({h:(e+216)%360,s:t.s,l:t.l})]}function L8t(r,t,e){t=t||6,e=e||30;var i=wt(r).toHsl(),n=360/e,a=[wt(r)];for(i.h=(i.h-(n*t>>1)+720)%360;--t;)i.h=(i.h+n)%360,a.push(wt(i));return a}function O8t(r,t){t=t||6;for(var e=wt(r).toHsv(),i=e.h,n=e.s,a=e.v,o=[],s=1/t;t--;)o.push(wt({h:i,s:n,v:a})),a=(a+s)%1;return o}wt.mix=function(r,t,e){e=e===0?0:e||50;var i=wt(r).toRgb(),n=wt(t).toRgb(),a=e/100,o={r:(n.r-i.r)*a+i.r,g:(n.g-i.g)*a+i.g,b:(n.b-i.b)*a+i.b,a:(n.a-i.a)*a+i.a};return wt(o)};wt.readability=function(r,t){var e=wt(r),i=wt(t);return(Math.max(e.getLuminance(),i.getLuminance())+.05)/(Math.min(e.getLuminance(),i.getLuminance())+.05)};wt.isReadable=function(r,t,e){var i=wt.readability(r,t),n,a;switch(a=!1,n=k8t(e),n.level+n.size){case"AAsmall":case"AAAlarge":a=i>=4.5;break;case"AAlarge":a=i>=3;break;case"AAAsmall":a=i>=7;break}return a};wt.mostReadable=function(r,t,e){var i=null,n=0,a,o,s,l;e=e||{},o=e.includeFallbackColors,s=e.level,l=e.size;for(var u=0;u<t.length;u++)a=wt.readability(r,t[u]),a>n&&(n=a,i=wt(t[u]));return wt.isReadable(r,i,{level:s,size:l})||!o?i:(e.includeFallbackColors=!1,wt.mostReadable(r,["#fff","#000"],e))};var pE=wt.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},P8t=wt.hexNames=F8t(pE);function F8t(r){var t={};for(var e in r)r.hasOwnProperty(e)&&(t[r[e]]=e);return t}function Nz(r){return r=parseFloat(r),(isNaN(r)||r<0||r>1)&&(r=1),r}function qe(r,t){B8t(r)&&(r="100%");var e=D8t(r);return r=Math.min(t,Math.max(0,parseFloat(r))),e&&(r=parseInt(r*t,10)/100),Math.abs(r-t)<1e-6?1:r%t/parseFloat(t)}function f_(r){return Math.min(1,Math.max(0,r))}function gn(r){return parseInt(r,16)}function B8t(r){return typeof r=="string"&&r.indexOf(".")!=-1&&parseFloat(r)===1}function D8t(r){return typeof r=="string"&&r.indexOf("%")!=-1}function Aa(r){return r.length==1?"0"+r:""+r}function Gf(r){return r<=1&&(r=r*100+"%"),r}function kz(r){return Math.round(parseFloat(r)*255).toString(16)}function nF(r){return gn(r)/255}var ga=function(){var r="[-\\+]?\\d+%?",t="[-\\+]?\\d*\\.\\d+%?",e="(?:"+t+")|(?:"+r+")",i="[\\s|\\(]+("+e+")[,|\\s]+("+e+")[,|\\s]+("+e+")\\s*\\)?",n="[\\s|\\(]+("+e+")[,|\\s]+("+e+")[,|\\s]+("+e+")[,|\\s]+("+e+")\\s*\\)?";return{CSS_UNIT:new RegExp(e),rgb:new RegExp("rgb"+i),rgba:new RegExp("rgba"+n),hsl:new RegExp("hsl"+i),hsla:new RegExp("hsla"+n),hsv:new RegExp("hsv"+i),hsva:new RegExp("hsva"+n),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function Uo(r){return!!ga.CSS_UNIT.exec(r)}function N8t(r){r=r.replace(p8t,"").replace(g8t,"").toLowerCase();var t=!1;if(pE[r])r=pE[r],t=!0;else if(r=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var e;return(e=ga.rgb.exec(r))?{r:e[1],g:e[2],b:e[3]}:(e=ga.rgba.exec(r))?{r:e[1],g:e[2],b:e[3],a:e[4]}:(e=ga.hsl.exec(r))?{h:e[1],s:e[2],l:e[3]}:(e=ga.hsla.exec(r))?{h:e[1],s:e[2],l:e[3],a:e[4]}:(e=ga.hsv.exec(r))?{h:e[1],s:e[2],v:e[3]}:(e=ga.hsva.exec(r))?{h:e[1],s:e[2],v:e[3],a:e[4]}:(e=ga.hex8.exec(r))?{r:gn(e[1]),g:gn(e[2]),b:gn(e[3]),a:nF(e[4]),format:t?"name":"hex8"}:(e=ga.hex6.exec(r))?{r:gn(e[1]),g:gn(e[2]),b:gn(e[3]),format:t?"name":"hex"}:(e=ga.hex4.exec(r))?{r:gn(e[1]+""+e[1]),g:gn(e[2]+""+e[2]),b:gn(e[3]+""+e[3]),a:nF(e[4]+""+e[4]),format:t?"name":"hex8"}:(e=ga.hex3.exec(r))?{r:gn(e[1]+""+e[1]),g:gn(e[2]+""+e[2]),b:gn(e[3]+""+e[3]),format:t?"name":"hex"}:!1}function k8t(r){var t,e;return r=r||{level:"AA",size:"small"},t=(r.level||"AA").toUpperCase(),e=(r.size||"small").toLowerCase(),t!=="AA"&&t!=="AAA"&&(t="AA"),e!=="small"&&e!=="large"&&(e="small"),{level:t,size:e}}var U8t="#FFFFFF",z8t="#000000",H8t=[95,85,75,30,15,0,15,30,45,60,80],$8t=15,Uz=function(r){return wt(r).getLuminance()<=.5},W8t=function(r,t){return wt.isReadable(r,t,{level:"AA",size:"small"})},V8t=[{fontColorIndex:0,bgColorIndex:3},{fontColorIndex:13,bgColorIndex:8},{fontColorIndex:14,bgColorIndex:1}],G8t=function(r){for(var t=[],e=0;e<11;e++){var i=H8t[e];t.push(iv(i===0?r:wt.mix(r,e<5?U8t:z8t,i).toHexString()))}return t},$b=function(r){r===void 0&&(r={});var t=Array.from(Array($8t)).fill(jC),e=r.basicColorRelations,i=e===void 0?[]:e,n=r.brandColor,a=G8t(n);return i.forEach(function(o){t[o.basicColorIndex]=a[o.standardColorIndex]}),V8t.forEach(function(o){var s=o.fontColorIndex,l=o.bgColorIndex;t[s]=Uz(t[l])?jC:rU}),U(U({},r),{basicColors:t})},X8t={brandColor:"#3471F9",semanticColors:{red:"#FF4D4F",green:"#29A294",yellow:"#FAAD14"},others:{highlight:"#87B5FF",results:"#F0F7FF"},basicColorRelations:[{basicColorIndex:1,standardColorIndex:0},{basicColorIndex:2,standardColorIndex:1},{basicColorIndex:3,standardColorIndex:5},{basicColorIndex:4,standardColorIndex:6},{basicColorIndex:5,standardColorIndex:6},{basicColorIndex:6,standardColorIndex:6},{basicColorIndex:7,standardColorIndex:5},{basicColorIndex:9,standardColorIndex:1},{basicColorIndex:10,standardColorIndex:4},{basicColorIndex:11,standardColorIndex:4},{basicColorIndex:12,standardColorIndex:5}]},Y8t=$b(X8t),j8t={brandColor:"#326EF4",semanticColors:{red:"#FF4D4F",green:"#29A294",yellow:"#FAAD14"},others:{highlight:"#87B5FF",results:"#F0F7FF"},basicColorRelations:[{basicColorIndex:1,standardColorIndex:0},{basicColorIndex:2,standardColorIndex:1},{basicColorIndex:3,standardColorIndex:1},{basicColorIndex:4,standardColorIndex:2},{basicColorIndex:5,standardColorIndex:7},{basicColorIndex:6,standardColorIndex:5},{basicColorIndex:7,standardColorIndex:5},{basicColorIndex:9,standardColorIndex:1},{basicColorIndex:10,standardColorIndex:2},{basicColorIndex:11,standardColorIndex:5},{basicColorIndex:12,standardColorIndex:5}]},Z8t=$b(j8t),q8t={brandColor:"#9DA7B6",semanticColors:{red:"#FF4D4F",green:"#29A294",yellow:"#FAAD14"},others:{highlight:"#87B5FF",results:"#F0F7FF"},basicColorRelations:[{basicColorIndex:1,standardColorIndex:0},{basicColorIndex:2,standardColorIndex:1},{basicColorIndex:3,standardColorIndex:1},{basicColorIndex:4,standardColorIndex:2},{basicColorIndex:5,standardColorIndex:7},{basicColorIndex:6,standardColorIndex:8},{basicColorIndex:7,standardColorIndex:5},{basicColorIndex:9,standardColorIndex:1},{basicColorIndex:10,standardColorIndex:2},{basicColorIndex:11,standardColorIndex:3},{basicColorIndex:12,standardColorIndex:3}]},K8t=$b(q8t),Q8t={default:Z8t,colorful:Y8t,gray:K8t},pa="Roboto, PingFangSC, BlinkMacSystemFont, Microsoft YaHei, Arial, sans-serif",J8t=12,tkt={小计:"Total",总计:"Total",总和:"(SUM)",项:"items",已选择:"selected",序号:"Index",度量:"Measure",数值:"Measure",共计:"Total",条:"",隐藏:"Hide",趋势:"Trend",组内升序:"Group ASC",组内降序:"Group DESC",升序:"ASC",降序:"DESC",不排序:"No order","，":", "},ekt={小计:"Промежуточный итог",总计:"Общий итог",总和:"(СУММА)",项:"элемент(-а/-ов)",已选择:"выбрано",序号:"Индекс",度量:"Мера",数值:"Численная величина",共计:"Общее количество",条:"",隐藏:"Скрыть",趋势:"Курс",组内升序:"Группировать по возрастанию",组内降序:"Группировать по убыванию",升序:"По возрастанию",降序:"По убыванию",不排序:"Не отсортировано","，":", "},rkt={小计:"小计",总计:"总计",总和:"（总和）",项:"项",已选择:"已选择",序号:"序号",度量:"度量",数值:"数值",共计:"共计",条:"条",趋势:"趋势",隐藏:"隐藏",组内升序:"组内升序",升序:"升序",降序:"降序",组内降序:"组内降序",不排序:"不排序","，":"，"},ikt="zh_CN",nkt=ikt,akt={zh_CN:rkt,en_US:tkt,ru_RU:ekt},Pr=function(r,t){return t===void 0&&(t=r),kt(akt,[nkt,r],t)},okt="".concat(fwt,"-tooltip"),Wb="".concat(okt,"-container"),skt="".concat(Wb,"-show"),lkt="".concat(Wb,"-hide"),aF={x:15,y:10},ukt=function(){return{key:"hiddenColumns",text:Pr("隐藏"),icon:"EyeOutlined"}},ckt=function(){return{key:"trend",text:Pr("趋势"),icon:"Trend"}},hkt=function(){return[{key:"asc",icon:"groupAsc",text:Pr("组内升序")},{key:"desc",icon:"groupDesc",text:Pr("组内降序")},{key:"none",text:Pr("不排序")}]},fkt=function(){return[{key:"asc",icon:"groupAsc",text:Pr("升序")},{key:"desc",icon:"groupDesc",text:Pr("降序")},{key:"none",text:Pr("不排序")}]},oF;(function(r){r[r.ALL=0]="ALL",r[r.COL=1]="COL",r[r.ROW=2]="ROW"})(oF||(oF={}));var gE=1,Yn;(function(r){r.All="all",r.DetailOnly="detailOnly"})(Yn||(Yn={}));function Nr(r){return r==="mobile"?!0:/(iPhone|iPad|SymbianOS|Windows Phone|iPod|iOS|Android)/i.test(navigator.userAgent)}function dkt(){return/iPhone/gi.test(navigator.userAgent)&&window.screen.height===812&&window.screen.width===375}function zz(){return/windows/i.test(navigator.userAgent)}var vkt=function(r){var t=r||"default";return Q8t[t.toLowerCase()]},pkt=function(r){var t,e,i,n,a,o=(r==null?void 0:r.palette)||vkt(r==null?void 0:r.name),s=o.basicColors,l=o.semanticColors,u=o.others,c=(t=r==null?void 0:r.spreadsheet)===null||t===void 0?void 0:t.isTableMode(),h=zz()?"bold":700,f=function(){var d,v;return{bolderText:{fontFamily:pa,fontSize:12,fontWeight:h,fill:s[13],opacity:1,textAlign:"right",textBaseline:"middle",linkTextFill:s[6]},text:{fontFamily:pa,fontSize:12,fontWeight:"normal",fill:s[13],opacity:1,textAlign:"right",textBaseline:"middle",linkTextFill:s[6]},cell:{crossBackgroundColor:s[1],backgroundColor:s[8],backgroundColorOpacity:1,horizontalBorderColor:s[9],horizontalBorderColorOpacity:1,verticalBorderColor:s[9],verticalBorderColorOpacity:1,horizontalBorderWidth:1,verticalBorderWidth:1,borderDash:[],padding:{top:8,right:8,bottom:8,left:8},interactionState:{hover:{backgroundColor:s[2],backgroundOpacity:.6},hoverFocus:{backgroundColor:s[2],backgroundOpacity:.6,borderColor:s[14],borderWidth:1,borderOpacity:1},selected:{backgroundColor:s[2],backgroundOpacity:.6},unselected:{backgroundOpacity:.3,textOpacity:.3,opacity:.3},searchResult:{backgroundColor:(d=u==null?void 0:u.results)!==null&&d!==void 0?d:s[2],backgroundOpacity:1},highlight:{backgroundColor:(v=u==null?void 0:u.highlight)!==null&&v!==void 0?v:s[6],backgroundOpacity:1},prepareSelect:{borderColor:s[14],borderOpacity:1,borderWidth:1}}},miniChart:{line:{point:{size:2.2,fill:s[6],opacity:1},linkLine:{size:1.5,fill:s[6],opacity:.6}},bar:{intervalPadding:4,fill:s[6],opacity:1},bullet:{progressBar:{widthPercent:.6,height:10,innerHeight:6},comparativeMeasure:{width:1,height:12,fill:s[13],opacity:.25},rangeColors:{good:l==null?void 0:l.green,satisfactory:l.yellow,bad:l.red},backgroundColor:"#E9E9E9"},interval:{height:J8t,fill:s[7]}},icon:{fill:s[13],downIconColor:l.red,upIconColor:l.green,size:10,margin:{right:4,left:4}}}};return{cornerCell:{bolderText:{fontFamily:pa,fontSize:12,fontWeight:h,fill:s[0],opacity:1,textAlign:c?"center":"left",textBaseline:"middle"},text:{fontFamily:pa,fontSize:12,fontWeight:h,fill:s[0],opacity:1,textAlign:"right",textBaseline:"middle"},cell:{backgroundColor:s[3],backgroundColorOpacity:1,horizontalBorderColor:s[10],horizontalBorderColorOpacity:1,verticalBorderColor:s[10],verticalBorderColorOpacity:1,horizontalBorderWidth:1,verticalBorderWidth:1,borderDash:[],padding:{top:0,right:8,bottom:0,left:8}},icon:{fill:s[0],size:10,margin:{right:4,left:4}}},rowCell:{seriesText:{fontFamily:pa,fontSize:12,fontWeight:"normal",fill:s[14],linkTextFill:s[6],opacity:1,textBaseline:c?"middle":"top",textAlign:"center"},measureText:{fontFamily:pa,fontSize:12,fontWeight:"normal",fill:s[14],linkTextFill:s[6],opacity:1,textAlign:c?"center":"left",textBaseline:"top"},bolderText:{fontFamily:pa,fontSize:12,fontWeight:h,fill:s[14],linkTextFill:s[6],opacity:1,textAlign:c?"center":"left",textBaseline:"top"},text:{fontFamily:pa,fontSize:12,fontWeight:"normal",fill:s[14],linkTextFill:s[6],opacity:1,textBaseline:"top",textAlign:c?"center":"left"},cell:{backgroundColor:s[1],backgroundColorOpacity:1,horizontalBorderColor:s[9],horizontalBorderColorOpacity:1,verticalBorderColor:s[9],verticalBorderColorOpacity:1,horizontalBorderWidth:1,verticalBorderWidth:1,borderDash:[],padding:{top:0,right:8,bottom:0,left:8},interactionState:{hover:{backgroundColor:s[2],backgroundOpacity:.6},selected:{backgroundColor:s[2],backgroundOpacity:.6},unselected:{backgroundOpacity:.3,textOpacity:.3,opacity:.3},prepareSelect:{borderColor:s[14],borderOpacity:1,borderWidth:1},searchResult:{backgroundColor:(e=u==null?void 0:u.results)!==null&&e!==void 0?e:s[2],backgroundOpacity:1},highlight:{backgroundColor:(i=u==null?void 0:u.highlight)!==null&&i!==void 0?i:s[6],backgroundOpacity:1}}},icon:{fill:s[14],size:10,margin:{right:4,left:4}},seriesNumberWidth:80},colCell:{measureText:{fontFamily:pa,fontSize:12,fontWeight:"normal",fill:s[0],opacity:1,textAlign:"right",textBaseline:"middle"},bolderText:{fontFamily:pa,fontSize:12,fontWeight:h,fill:s[0],opacity:1,textAlign:"center",textBaseline:"middle"},text:{fontFamily:pa,fontSize:12,fontWeight:"normal",fill:s[0],opacity:1,textAlign:"center",textBaseline:"middle"},cell:{backgroundColor:s[3],backgroundColorOpacity:1,horizontalBorderColor:s[10],horizontalBorderColorOpacity:1,verticalBorderColor:s[10],verticalBorderColorOpacity:1,horizontalBorderWidth:1,verticalBorderWidth:1,borderDash:[],padding:{top:0,right:8,bottom:0,left:8},interactionState:{hover:{backgroundColor:s[4],backgroundOpacity:.6},selected:{backgroundColor:s[4],backgroundOpacity:.6},unselected:{backgroundOpacity:.3,textOpacity:.3,opacity:.3},prepareSelect:{borderColor:s[14],borderOpacity:1,borderWidth:1},searchResult:{backgroundColor:(n=u==null?void 0:u.results)!==null&&n!==void 0?n:s[2],backgroundOpacity:1},highlight:{backgroundColor:(a=u==null?void 0:u.highlight)!==null&&a!==void 0?a:s[6],backgroundOpacity:1}}},icon:{fill:s[0],size:10,margin:{top:6,right:4,bottom:6,left:4}}},dataCell:f(),mergedCell:f(),resizeArea:{size:3,background:s[7],backgroundOpacity:0,guideLineColor:s[7],guideLineDisableColor:"rgba(0,0,0,0.25)",guideLineDash:[3,3],interactionState:{hover:{backgroundColor:s[7],backgroundOpacity:1}}},scrollBar:{trackColor:"rgba(0,0,0,0.01)",thumbHoverColor:"rgba(0,0,0,0.25)",thumbColor:"rgba(0,0,0,0.15)",thumbHorizontalMinSize:32,thumbVerticalMinSize:32,size:Nr()?3:6,hoverSize:Nr()?4:8,lineCap:"round"},splitLine:{horizontalBorderColor:s[12],horizontalBorderColorOpacity:.2,horizontalBorderWidth:2,verticalBorderColor:s[11],verticalBorderColorOpacity:.25,verticalBorderWidth:2,showShadow:!0,shadowWidth:8,shadowColors:{left:"rgba(0,0,0,0.1)",right:"rgba(0,0,0,0)"},borderDash:[]},prepareSelectMask:{backgroundColor:s[5],backgroundOpacity:.3},background:{color:s[8],opacity:1}}},Zr=function(){function r(t){this.x=0,this.y=0,this.width=0,this.height=0,this.colIndex=-1,this.level=0,this.isLeaf=!1,this.children=[],this.padding=0;var e=t.id,i=t.key,n=t.value,a=t.label,o=t.parent,s=t.level,l=t.rowIndex,u=t.isTotals,c=t.isGrandTotals,h=t.isSubTotals,f=t.isCollapsed,d=t.isTotalRoot,v=t.hierarchy,p=t.isPivotMode,g=t.seriesNumberWidth,m=t.field,y=t.spreadsheet,_=t.query,x=t.belongsCell,C=t.inCollapseNode,A=t.isTotalMeasure,b=t.isLeaf,R=t.extra;this.id=e,this.key=i,this.value=n,this.label=a||n,this.parent=o,this.level=s,this.rowIndex=l,this.isTotals=u,this.isCollapsed=f,this.hierarchy=v,this.isPivotMode=p,this.seriesNumberWidth=g,this.field=m,this.spreadsheet=y,this.query=_,this.belongsCell=x,this.inCollapseNode=C,this.isTotalMeasure=A,this.isLeaf=b,this.isGrandTotals=c,this.isSubTotals=h,this.isTotalRoot=d,this.extra=R}return r.getFieldPath=function(t,e){if(t&&!t.isTotals||t&&e){for(var i=t.parent,n=[t.field];i&&i.id!==tU;)n.push(i.field),i=i.parent;return n.reverse()}},r.getAllLeaveNodes=function(t){var e=[];if(t.isLeaf)return[t];for(var i=ft([],rt(t.children),!1),n=i.shift();n;)n.isLeaf?e.push(n):i.unshift.apply(i,ft([],rt(n.children),!1)),n=i.shift();return e},r.getAllChildrenNodes=function(t){var e=[];if(t.isLeaf)return[t];for(var i=ft([],rt(t.children||[]),!1),n=i.shift();n;)e.push(n),i.unshift.apply(i,ft([],rt(n.children),!1)),n=i.shift();return e},r.getAllBranch=function(t){for(var e=[],i=this.getAllLeaveNodes(t),n=i.shift(),a=[];n;){a.unshift(n);for(var o=n.parent;o&&!Jr(o,t);){a.unshift(o);o=o.parent}e.push(a),n=i.shift(),a=[]}return e},r.blankNode=function(){return new r({id:"",key:"",value:""})},r.rootNode=function(){return new r({id:"root",key:"",value:""})},r.prototype.toJSON=function(){return wb(this,["config","hierarchy","parent","spreadsheet"])},r.prototype.getHeadLeafChild=function(){for(var t=this;!st(t.children);)t=Mu(t.children);return t},r.prototype.getTotalHeightForTreeHierarchy=function(){return this.height===0||st(this.children)?this.height:this.children.reduce(function(t,e){return t+e.getTotalHeightForTreeHierarchy()},this.height)},r}(),Hz=function(){function r(){this.width=0,this.height=0,this.maxLevel=-1,this.sampleNodesForAllLevels=[],this.sampleNodeForLastLevel=null,this.allNodesWithoutRoot=[],this.indexNode=[]}return r.prototype.getLeaves=function(){return this.allNodesWithoutRoot.filter(function(t){return t.isLeaf})},r.prototype.getNodes=function(t){return t!==void 0?this.allNodesWithoutRoot.filter(function(e){return e.level===t}):this.allNodesWithoutRoot},r.prototype.getNodesLessThanLevel=function(t){return this.allNodesWithoutRoot.filter(function(e){return e.level<=t})},r.prototype.pushNode=function(t,e){e===void 0&&(e=-1),e===-1?this.allNodesWithoutRoot.push(t):this.allNodesWithoutRoot.splice(e,0,t)},r.prototype.pushIndexNode=function(t){this.indexNode.push(t)},r.prototype.getIndexNodes=function(){return this.indexNode},r}(),_h=function(){function r(t){var e=t.label,i=t.isSubTotals,n=t.isGrandTotals,a=t.isTotalRoot;this.label=e,this.isSubTotals=i,this.isGrandTotals=n,this.isTotalRoot=a}return r}(),gkt=function(r){var t,e=r.isFirstField,i=r.currentField,n=r.fieldValues,a=r.spreadsheet,o=r.lastField,s=a.getTotalsConfig(e?i:o),l,u;e?s!=null&&s.showGrandTotals&&(l=s.reverseLayout?"unshift":"push",u=new _h({label:s.label,isSubTotals:!1,isGrandTotals:!0,isTotalRoot:!0})):s!=null&&s.showSubTotals&&(L.size(n)>1||L.get(s,"showSubTotals.always")!==!1)&&i!==Kt&&(l=s.reverseSubLayout?"unshift":"push",u=new _h({label:s.subLabel,isSubTotals:!0,isGrandTotals:!1,isTotalRoot:!0})),(t=n[l])===null||t===void 0||t.call(n,u)};function mE(r,t){for(var e={},i=r;i&&i.key;)(!i.isTotalRoot||t)&&i.value!==Vu&&(e[i.key]=i.value),i=i.parent;return e}var mkt="Transform Data",ykt="Header Layout",_kt="Data Cell Render",co=function(){function r(){var t=this;this.debug=!1,this.debugCallback=function(e,i){if(t.debug){var n=performance.now();i();var a=performance.now();console.log(e,"".concat(a-n," ms"))}else i()},this.logger=function(e){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];t.debug&&console.log.apply(console,ft([e],rt(i),!1))}}return r.getInstance=function(){return r.instance||(r.instance=new r),r.instance},r.prototype.setDebug=function(t){this.debug=t},r}(),xkt=`
<svg width="10px" height="10px" viewBox="0 0 10 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" font-family="Roboto, PingFangSC, BlinkMacSystemFont, Microsoft YaHei, Arial, sans-serif" font-size="12" font-weight="bold">
    <text id="↓" fill="#29A294">
        <tspan x="-0.225097656" y="8.5">↓</tspan>
    </text>
</g>
</svg>`,Ckt=`<svg width="10px" height="10px" viewBox="0 0 10 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" font-family="Roboto, PingFangSC, BlinkMacSystemFont, Microsoft YaHei, Arial, sans-serif" font-size="12" font-weight="bold">
    <text id="↑" fill="#FF4D4F">
        <tspan x="-0.225097656" y="8.5">↑</tspan>
    </text>
</g>
</svg>
`,Ekt=`<?xml version="1.0" encoding="UTF-8"?>
<svg width="7px" height="9px" viewBox="0 0 7 9" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 58 (84663) - https://sketch.com -->
    <title>down</title>
    <desc>Created with Sketch.</desc>
    <g id="一期开发" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <polygon id="down" fill="#58AE57" transform="translate(3.500000, 4.500000) scale(1, -1) translate(-3.500000, -4.500000) " points="3.5 0 7 9 0 9"></polygon>
    </g>
</svg>`,Skt=`<?xml version="1.0" encoding="UTF-8"?>
<svg width="7px" height="9px" viewBox="0 0 7 9" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 58 (84663) - https://sketch.com -->
    <title>up</title>
    <desc>Created with Sketch.</desc>
    <g id="一期开发" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <polygon id="up" fill="#F46649" points="3.5 0 7 9 0 9"></polygon>
    </g>
</svg> `,Akt=`<svg t="1557124621626" class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
xmlns="http://www.w3.org/2000/svg" p-id="17452"
xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14">
<defs>
  <style type="text/css"></style>
</defs>
<path d="M182.272 167.04a8 8 0 0 0-12.544 0L57.728 309.056A8 8 0 0 0 64 321.984h76.032v530.048c0 4.352 3.584 7.936 7.936 7.936h56.064a8 8 0 0 0 7.936-7.936V321.92H288a8 8 0 0 0 6.272-12.992l-112-141.888z m209.728 626.944h176c4.416 0 8 3.584 8 8v56a8 8 0 0 1-8 8h-176A8 8 0 0 1 384 857.984v-56c0-4.416 3.584-8 8-8z m0-424h368c4.416 0 8 3.648 8 8v56a8 8 0 0 1-8 8h-368A8 8 0 0 1 384 433.984v-56c0-4.352 3.584-8 8-8z m528-139.968h-528A8 8 0 0 1 384 222.016v-56c0-4.416 3.584-8 8-8h528c4.416 0 8 3.584 8 8v56a8 8 0 0 1-8 8z m-256 424h-272A8 8 0 0 1 384 646.016v-56c0-4.416 3.584-8 8-8h272c4.416 0 8 3.584 8 8v56a8 8 0 0 1-8 8z" p-id="17453"></path>
</svg>`,Tkt=`<svg t="1557124685600" class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" p-id="17561"
  xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14">
  <defs>
    <style type="text/css"></style>
  </defs>
  <path d="M182.272 856.96a8 8 0 0 1-12.544 0l-112-141.952A8 8 0 0 1 64 702.08h76.032V172.032c0-4.416 3.584-8 7.936-8h56.064c4.352 0 7.936 3.584 7.936 8v529.984H288c6.72 0 10.496 7.808 6.272 12.992l-112 141.888z m209.728-626.944h176A8 8 0 0 0 576 222.016v-56a8 8 0 0 0-8-8h-176A8 8 0 0 0 384 166.016v56c0 4.416 3.584 8 8 8z m0 424h368a8 8 0 0 0 8-8v-56a8 8 0 0 0-8-8h-368A8 8 0 0 0 384 590.016v56c0 4.416 3.584 8 8 8z m528 139.968h-528a8 8 0 0 0-8 8v56c0 4.416 3.584 8 8 8h528a8 8 0 0 0 8-8v-56a8 8 0 0 0-8-8z m-256-424h-272A8 8 0 0 0 384 377.984v56c0 4.416 3.584 8 8 8h272a8 8 0 0 0 8-8v-56a8 8 0 0 0-8-8z" p-id="17562"></path>
</svg>`,bkt=`<svg t="1557124695786" class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" p-id="17670"
  xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14">
  <defs>
    <style type="text/css"></style>
  </defs>
  <path d="M182.272 167.04a8 8 0 0 0-12.544 0L57.728 309.056A8 8 0 0 0 64 321.984h76.032v530.048c0 4.352 3.584 7.936 7.936 7.936h56.064a8 8 0 0 0 7.936-7.936V321.92H288a8 8 0 0 0 6.272-12.992l-112-141.888z m209.728 62.976h304A8 8 0 0 0 704 222.016v-56a8 8 0 0 0-8-8h-304A8 8 0 0 0 384 166.016v56c0 4.416 3.584 8 8 8z m0 424h304a8 8 0 0 0 8-8v-56a8 8 0 0 0-8-8h-304A8 8 0 0 0 384 590.016v56c0 4.416 3.584 8 8 8z m528 139.968h-528a8 8 0 0 0-8 8v56c0 4.416 3.584 8 8 8h528a8 8 0 0 0 8-8v-56a8 8 0 0 0-8-8z m0-424h-528A8 8 0 0 0 384 377.984v56c0 4.416 3.584 8 8 8h528a8 8 0 0 0 8-8v-56a8 8 0 0 0-8-8z" p-id="17671"></path>
</svg>`,wkt=`<svg t="1557124710652" class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" p-id="17779"
  xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14">
  <defs>
    <style type="text/css"></style>
  </defs>
  <path d="M182.272 856.96a8 8 0 0 1-12.544 0l-112-141.952A8 8 0 0 1 64 702.08h76.032V172.032c0-4.416 3.584-8 7.936-8h56.064c4.352 0 7.936 3.584 7.936 8v529.984H288c6.72 0 10.496 7.808 6.272 12.992l-112 141.888z m209.728-626.944h304A8 8 0 0 0 704 222.016v-56a8 8 0 0 0-8-8h-304A8 8 0 0 0 384 166.016v56c0 4.416 3.584 8 8 8z m0 424h304a8 8 0 0 0 8-8v-56a8 8 0 0 0-8-8h-304A8 8 0 0 0 384 590.016v56c0 4.416 3.584 8 8 8z m528 139.968h-528a8 8 0 0 0-8 8v56c0 4.416 3.584 8 8 8h528a8 8 0 0 0 8-8v-56a8 8 0 0 0-8-8z m0-424h-528A8 8 0 0 0 384 377.984v56c0 4.416 3.584 8 8 8h528a8 8 0 0 0 8-8v-56a8 8 0 0 0-8-8z" p-id="17780"></path>
</svg>`,Rkt=`<svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="设计输出" stroke="none" stroke-width="1" fill-opacity="0.25" fill-rule="evenodd">
    <g id="设计输出-移动端指标详情页-阅读端" transform="translate(-3275.000000, -724.000000)" fill-rule="nonzero">
        <g id="编组-39" transform="translate(3064.500000, 667.000000)">
            <g id="编组-36" transform="translate(80.500000, 44.000000)">
                <g id="不排序" transform="translate(130.000000, 13.000000)">
                    <path d="M12.0009375,12.40625 C12.0696875,12.40625 12.1259375,12.4625 12.1259375,12.53125 L12.1259375,12.53125 L12.1259375,13.40625 C12.1259375,13.475 12.0696875,13.53125 12.0009375,13.53125 L12.0009375,13.53125 L6.25093747,13.53125 C6.18218747,13.53125 6.12593747,13.475 6.12593747,13.40625 L6.12593747,13.40625 L6.12593747,12.53125 C6.12593747,12.4625 6.18218747,12.40625 6.25093747,12.40625 L6.25093747,12.40625 Z M2.93949997,2.5801875 L2.97437497,2.6109375 L4.72437497,4.828125 C4.78062497,4.89776786 4.74503823,4.99725765 4.66779698,5.02426203 L4.62593747,5.03125 L3.438,5.03089062 L3.43843747,10.9691406 L4.62593747,10.9691406 C4.73062497,10.9691406 4.78999997,11.0910156 4.72437497,11.1722656 L2.97437497,13.3894531 C2.92437497,13.4535156 2.82749997,13.4535156 2.77749997,13.3894531 L1.02749997,11.1722656 C0.961874969,11.0894531 1.02124997,10.9691406 1.12593747,10.9691406 L2.31343747,10.9691406 L2.313,5.03089062 L1.12593747,5.03125 C1.03620533,5.03125 0.979764,4.94285714 1.00679571,4.8654519 L1.02749997,4.828125 L2.77749997,2.6109375 C2.81749997,2.5596875 2.88749997,2.5494375 2.93949997,2.5801875 Z M10.5009375,9.09375 C10.5696875,9.09375 10.6259375,9.15 10.6259375,9.21875 L10.6259375,9.21875 L10.6259375,10.09375 C10.6259375,10.1625 10.5696875,10.21875 10.5009375,10.21875 L10.5009375,10.21875 L6.25093747,10.21875 C6.18218747,10.21875 6.12593747,10.1625 6.12593747,10.09375 L6.12593747,10.09375 L6.12593747,9.21875 C6.12593747,9.15 6.18218747,9.09375 6.25093747,9.09375 L6.25093747,9.09375 Z M14.5009375,5.78125 C14.5696875,5.78125 14.6259375,5.8375 14.6259375,5.90625 L14.6259375,5.90625 L14.6259375,6.78125 C14.6259375,6.85 14.5696875,6.90625 14.5009375,6.90625 L14.5009375,6.90625 L6.25093747,6.90625 C6.18218747,6.90625 6.12593747,6.85 6.12593747,6.78125 L6.12593747,6.78125 L6.12593747,5.90625 C6.12593747,5.8375 6.18218747,5.78125 6.25093747,5.78125 L6.25093747,5.78125 Z M9.00093747,2.46875 C9.06968747,2.46875 9.12593747,2.525 9.12593747,2.59375 L9.12593747,2.59375 L9.12593747,3.46875 C9.12593747,3.5375 9.06968747,3.59375 9.00093747,3.59375 L9.00093747,3.59375 L6.25093747,3.59375 C6.18218747,3.59375 6.12593747,3.5375 6.12593747,3.46875 L6.12593747,3.46875 L6.12593747,2.59375 C6.12593747,2.525 6.18218747,2.46875 6.25093747,2.46875 L6.25093747,2.46875 Z" id="形状结合"></path>
                </g>
            </g>
        </g>
    </g>q
</g>
</svg>`,Mkt='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1590389330617" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="19656" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><defs><style type="text/css"></style></defs><path d="M512 64c-247.4 0-448 200.6-448 448s200.6 448 448 448 448-200.6 448-448-200.6-448-448-448z m0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z" fill="" p-id="19657"></path><path d="M464 336c0 26.5 21.5 48 48 48s48-21.5 48-48-21.5-48-48-48-48 21.5-48 48zM536 448h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8v-272c0-4.4-3.6-8-8-8z" fill="" p-id="19658"></path></svg>',Ikt=`<?xml version="1.0" encoding="UTF-8"?>
<svg width="23px" height="12px" viewBox="0 0 23 12" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <title>编组 8备份 3</title>
    <g id="----隐藏列标注！" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="隐藏列标注" transform="translate(-275.000000, -824.000000)">
            <rect fill="#FFFFFF" x="0" y="0" width="1333" height="1167"></rect>
            <g id="编组-8备份-3" transform="translate(275.000000, 824.000000)">
                <rect id="矩形" stroke-opacity="0.25" stroke="#000000" fill="#F7F7F7" x="0.5" y="0.5" width="11" height="11"></rect>
                <rect id="矩形备份-9" stroke-opacity="0.25" stroke="#000000" fill="#F7F7F7" x="11.5" y="0.5" width="11" height="11"></rect>
                <g id="7.Icon/arrow/15.down/fill" transform="translate(6.000000, 6.000000) rotate(90.000000) translate(-6.000000, -6.000000) " fill="#000000" fill-rule="nonzero" opacity="0.65">
                    <path d="M7.25020811,6.37218077 L4.91348936,8.20968077 C4.82677061,8.27764952 4.69903624,8.21671202 4.69903624,8.10655577 L4.69903624,4.43272764 C4.69903624,4.32257139 4.82677061,4.26046202 4.91348936,4.32960264 L7.25020811,6.16593077 C7.31700499,6.21866514 7.31700499,6.31944639 7.25020811,6.37218077 Z" id="fill" transform="translate(5.999671, 6.269385) rotate(90.000000) translate(-5.999671, -6.269385) "></path>
                </g>
                <g id="7.Icon/arrow/15.down/fill" transform="translate(17.000000, 6.000000) rotate(270.000000) translate(-17.000000, -6.000000) translate(11.000000, 0.000000)" fill="#000000" fill-rule="nonzero" opacity="0.65">
                    <path d="M7.25020811,6.37218077 L4.91348936,8.20968077 C4.82677061,8.27764952 4.69903624,8.21671202 4.69903624,8.10655577 L4.69903624,4.43272764 C4.69903624,4.32257139 4.82677061,4.26046202 4.91348936,4.32960264 L7.25020811,6.16593077 C7.31700499,6.21866514 7.31700499,6.31944639 7.25020811,6.37218077 Z" id="fill" transform="translate(5.999671, 6.269385) rotate(90.000000) translate(-5.999671, -6.269385) "></path>
                </g>
            </g>
            <line x1="286.5" y1="813" x2="286.5" y2="864.5" id="路径-2备份-3" stroke="#000000" opacity="0.25"></line>
        </g>
    </g>
</svg>`,Lkt=`<svg t="1557140120188" class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
xmlns="http://www.w3.org/2000/svg" p-id="16909" xmlns:xlink="http://www.w3.org/1999/xlink"
width="200" height="200">
	<defs>
		<style type="text/css">
		</style>
	</defs>
	<path d="M328 544h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"
	p-id="16910">
	</path>
	<path d="M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32z m-40 728H184V184h656v656z"
	p-id="16911">
	</path>
</svg>`,Okt=`<svg t="1557140186692" class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
xmlns="http://www.w3.org/2000/svg" p-id="17025" xmlns:xlink="http://www.w3.org/1999/xlink"
width="200" height="200">
	<defs>
		<style type="text/css">
		</style>
	</defs>
	<path d="M328 544h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"
	p-id="17026">
	</path>
	<path d="M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32z m-40 728H184V184h656v656z"
	p-id="17027">
	</path>
</svg>`,Pkt=`<svg t="1565940955886" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
     p-id="17472" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200">
  <defs>
    <style type="text/css"></style>
  </defs>
  <path
    d="M948 392.992l-403.008 488.99200001Q532 896 512.992 896t-32-14.016L76 392.992q-18.016-20.992-7.008-46.016T108 321.98400001L916 321.98400001q28 0 39.008 24.99199999T948 392.992z"
    p-id="17473" data-spm-anchor-id="a313x.7781069.0.i2" class="selected"></path>
</svg>
`,Fkt=`<svg t="1565940955886" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
     p-id="17472" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200">
  <defs>
    <style type="text/css"></style>
  </defs>
  <path
    fill-opacity="0.45"
    d="M948 392.992l-403.008 488.99200001Q532 896 512.992 896t-32-14.016L76 392.992q-18.016-20.992-7.008-46.016T108 321.98400001L916 321.98400001q28 0 39.008 24.99199999T948 392.992z"
    p-id="17473" data-spm-anchor-id="a313x.7781069.0.i2" class="selected"></path>
</svg>
`,Bkt=`<svg t="1565940979768" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
p-id="17620" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200">
<defs>
<style type="text/css"></style>
</defs>
<path
d="M76 631.008l403.008-488.99200001Q492 128 511.008 128t32 14.016L948 631.008q18.016 20.992 7.008 46.016T916 702.01599999L108 702.01599999q-28 0-39.008-24.99199999T76 631.008z"
p-id="17621"></path>
</svg>
`,Dkt=`<svg t="1565940979768" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
     p-id="17620" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200">
  <defs>
    <style type="text/css"></style>
  </defs>
  <path
    fill-opacity="0.45"
    d="M76 631.008l403.008-488.99200001Q492 128 511.008 128t32 14.016L948 631.008q18.016 20.992 7.008 46.016T916 702.01599999L108 702.01599999q-28 0-39.008-24.99199999T76 631.008z"
    p-id="17621"></path>
</svg>
`,Nkt='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1596433821690" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="20229" width="16" height="16" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><style type="text/css"></style></defs><path d="M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6c-3.1-3.1-8.2-3.1-11.3 0l-230 229.9L461.4 404c-3.1-3.1-8.2-3.1-11.3 0L266.3 586.7c-3.1 3.1-3.1 8.2 0 11.3l39.5 39.7z" p-id="20230"></path></svg>',kkt=`<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1608030723688" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="21482" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16"><defs><style type="text/css"></style></defs><path d="M547.648 696a32 32 0 0 1 31.488 26.24l0.512 5.76v151.68l145.216-144.512a32 32 0 0 1 40.832-3.648l4.416 3.712a32 32 0 0 1 3.584 40.832l-3.712 4.48-203.072 202.24a32 32 0 0 1-40.768 3.648l-4.416-3.712-202.24-202.24a32 32 0 0 1 40.832-48.96l4.416 3.712 150.912 150.912v-158.144a32 32 0 0 1 32-32z m194.56-529.28l4.928 3.072 233.792 180.224a32 32 0 0 1 1.728 49.28l-4.864 3.52-409.792 245.568a32 32 0 0 1-27.328 2.624l-5.184-2.432-422.4-245.568a32 32 0 0 1-7.552-49.28l4.544-4.032 242.816-180.288a32 32 0 0 1 42.432 47.552l-4.288 3.84-203.84 151.296 364.16 211.648 353.28-211.712-196.608-151.552a32 32 0 0 1-8.896-40l3.136-4.864a32 32 0 0 1 40-8.96zM547.712 28.672a32 32 0 0 1 31.488 26.24l0.512 5.76v396.992a32 32 0 0 1-63.488 5.76l-0.512-5.76V60.736a32 32 0 0 1 32-32z" p-id="21483" fill="currentColor"></path></svg>
`,Ukt='<svg viewBox="64 64 896 896" focusable="false" data-icon="eye" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258c161.3 0 279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766zm-4-430c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z"></path></svg>',sF=Object.freeze({__proto__:null,ArrowDown:xkt,ArrowUp:Ckt,CellDown:Ekt,CellUp:Skt,GlobalAsc:Akt,GlobalDesc:Tkt,GroupAsc:bkt,GroupDesc:wkt,GroupNone:Rkt,Minus:Lkt,Plus:Okt,SortDown:Fkt,SortUp:Dkt,SortDownSelected:Pkt,SortUpSelected:Bkt,InfoCircle:Mkt,ExpandColIcon:Ikt,Trend:Nkt,DrillDownIcon:kkt,EyeOutlined:Ukt}),$z={},Wz=function(r,t){$z[Cb(r)]=t},zkt=function(r){return $z[Cb(r)]};ar(sF).forEach(function(r){Wz(r,sF[r])});var lF="<svg",uF="data:image/svg+xml",cF={},nv=function(r){yt(t,r);function t(e){var i=r.call(this,e)||this;return i.isOnlineLink=function(n){return/^(https?:)?(\/\/)/.test(n)},i.render(),i}return t.prototype.getImage=function(e,i,n){var a=this;return new Promise(function(o,s){var l=zkt(e);if(l){var u=new Image;u.onload=function(){cF[i]=u,o(u)},u.onerror=s,l.includes(uF)||a.isOnlineLink(l)?(u.src=l,u.crossOrigin="anonymous"):(n&&(l=l.replace(/fill=[\'\"]#?\w+[\'\"]/g,""),l=l.replace(/fill>/g,">")),l=l.replace(lF,"".concat(lF,' fill="').concat(n,'"')),u.src="".concat(uF,";utf-8,").concat(encodeURIComponent(l)))}})},t.prototype.render=function(){var e=this.cfg,i=e.name,n=e.fill,a=rp(this.cfg),o=U(U({},wb(a,"fill")),{type:t.type}),s=new BT({attrs:o});this.iconImageShape=s,this.setImageAttrs({name:i,fill:n})},t.prototype.setImageAttrs=function(e){var i=this,n=e.name,a=e.fill,o=this.iconImageShape;n=n||o.attrs.name,a=a||o.attrs.fill;var s="".concat(n,"-").concat(a),l=cF[s];l?(o.attr("img",l),this.addShape("image",o)):this.getImage(n,s,a).then(function(u){var c,h,f,d=(f=(h=(c=i.getParent())===null||c===void 0?void 0:c.getMeta)===null||h===void 0?void 0:h.call(c).spreadsheet)===null||f===void 0?void 0:f.container;if(i.destroyed||d&&!d.get("refreshElements")){co.getInstance().logger("GuiIcon ".concat(n," destroyed."));return}o.attr("img",u),i.addShape("image",o)}).catch(function(u){if(u instanceof TypeError){console.warn("GuiIcon ".concat(n," destroyed:"),u);return}console.error("GuiIcon ".concat(n," load failed:"),u)})},t.type="__GUI_ICON__",t}(Mo),Tr;(function(r){r.TOP="TOP",r.BOTTOM="BOTTOM",r.LEFT="LEFT",r.RIGHT="RIGHT"})(Tr||(Tr={}));var Zl;(function(r){r.SUM="SUM",r.MIN="MIN",r.MAX="MAX",r.AVG="AVG"})(Zl||(Zl={}));var Ea;(function(r){r.Row="row",r.Col="col",r.Series="series"})(Ea||(Ea={}));var Hkt=function(){function r(){this.store=new Map}return r.prototype.set=function(t,e){return this.store.set(t,e)},r.prototype.get=function(t,e){var i,n=this.store.get(t);return(i=n)!==null&&i!==void 0?i:e},r.prototype.clear=function(){this.store.clear()},r.prototype.size=function(){return this.store.size},r}(),d0=function(r){var t,e,i=r.facetCfg,n=r.level,a=r.fields,o=i.colCfg,s=i.spreadsheet,l=i.dataSet,u=l.moreThanOneValue(),c=(e=(t=s.dataCfg.fields)===null||t===void 0?void 0:t.valueInCols)!==null&&e!==void 0?e:!0,h=(o==null?void 0:o.hideMeasureColumn)&&c&&!u&&wi(a,Kt),f=h?2:1;return n===a.length-f},Vz=function(r,t,e,i){return t.layoutArrange?t.layoutArrange(t.spreadsheet,e,i,r):r},Vb=function(r,t,e,i){var n,a,o=(a=(n=r.spreadsheet)===null||n===void 0?void 0:n.facet)===null||a===void 0?void 0:a.getHiddenColumnsInfo(e);if(o&&r.columns.find(function(p){return p===e.field}))return!1;var s=!0,l=function(p,g,m){g===void 0&&(g=-1),m===void 0&&(m=-1),g===-1?(t.children.push(p),i.pushNode(p)):(t.children.splice(g,0,p),i.pushNode(p,m))};if(r.layoutHierarchy){var u=r.layoutHierarchy(r.spreadsheet,e);if(u){var c=uo(u==null?void 0:u.delete)?u==null?void 0:u.delete:!1;s=!c;var h=u.push,f=u.unshift,d=t.children.length,v=i.getNodes().length;st(f)||($t(f,function(p){l(p)}),d=t.children.length,v=i.getNodes().length),st(h)||$t(h,function(p){l(p)}),c||l(e,d,v)}else l(e)}else l(e);return s},yE=function(r,t,e){r!=null&&r.layoutCoordinate&&(t!=null&&t.isLeaf||e!=null&&e.isLeaf)&&(r==null||r.layoutCoordinate(r.spreadsheet,t,e))},$kt=function(r,t){var e=r==null?void 0:r.layoutDataPosition;if(e){var i=t.getCellMeta,n=e(r.spreadsheet,i);return U(U({},t),{getCellMeta:n})}return t},Gz=function(){function r(t){this.label=t}return r}(),Xz=function(r){var t=r.addTotalMeasureInTotal,e=r.parentNode,i=r.currentField,n=r.fields,a=r.facetCfg,o=r.hierarchy,s=n.indexOf(i),l=a.dataSet,u=a.values,c=a.spreadsheet,h=[],f={},d=c.getTotalsConfig(i),v=e.isGrandTotals?d.totalsGroupDimensions||[]:d.subTotalsGroupDimensions||[],p=l.isEmpty()?[]:v;if(p!=null&&p.includes(i)){f=mE(e);var g=l.getDimensionValues(i,f);h.push.apply(h,ft([],rt((g||[]).map(function(y){return new _h({label:y,isSubTotals:e.isSubTotals,isGrandTotals:e.isGrandTotals,isTotalRoot:!1})})),!1)),st(h)&&i&&h.push(Vu)}else if(t&&i===Kt)f=mE(e),h.push.apply(h,ft([],rt(u.map(function(y){return new Gz(y)})),!1));else if(d0({facetCfg:a,level:s,fields:n})){e.isLeaf=!0,o.pushIndexNode(e),e.rowIndex=o.getIndexNodes().length-1;return}else{Xz(U(U({},r),{currentField:n[s+1]}));return}var m=h.filter(function(y){return!o_(y)});Gb(U(U({},r),{fieldValues:m,level:s,parentNode:e,query:f}))},Wkt=function(r){var t,e=r.parentNode,i=r.currentField,n=r.fields,a=r.facetCfg,o=n.indexOf(i),s=a.dataSet,l=a.spreadsheet,u=[],c={};c=mE(e,!0);var h=s.getDimensionValues(i,c),f=Vz(h,a,e,i);u.push.apply(u,ft([],rt(f||[]),!1)),st(u)&&i&&(i===Kt?u.push.apply(u,ft([],rt((t=s.fields)===null||t===void 0?void 0:t.values),!1)):u.push(Vu)),gkt({currentField:i,lastField:n[o-1],isFirstField:o===0,fieldValues:u,spreadsheet:l});var d=u.filter(function(v){return!o_(v)});Gb(U(U({},r),{fieldValues:d,level:o,parentNode:e,query:c}))},Yz=function(r){r.parentNode.isTotals?Xz(r):Wkt(r)},av=function(r,t){return"".concat(r).concat(li).concat(t)},Gb=function(r){var t,e,i,n,a,o,s,l,u,c,h=r.currentField,f=r.fields,d=r.fieldValues,v=r.facetCfg,p=r.hierarchy,g=r.parentNode,m=r.level,y=r.query,_=r.addMeasureInTotalQuery,x=r.addTotalMeasureInTotal,C=v.spreadsheet,A=v.collapsedCols;try{for(var b=ia(d.entries()),R=b.next();!R.done;R=b.next()){var M=rt(R.value,2),O=M[0],F=M[1],D=F instanceof _h,H=F instanceof Gz,j=void 0,$=void 0,k=!1,V=!1,Q=!1,Y=!1,tt=h;if(D){var et=F;V=et.isGrandTotals,Q=et.isSubTotals,Y=et.isTotalRoot,j=Pr(F.label),Y?$=y:$=U(U({},y),(i={},i[h]=j,i)),_&&($[Kt]=(s=C==null?void 0:C.dataSet)===null||s===void 0?void 0:s.fields.values[0]),k=d0({facetCfg:v,level:m,fields:f})}else H?(j=Pr(F.label),$=U(U({},y),(n={},n[Kt]=j,n)),tt=Kt,V=g.isGrandTotals,Q=g.isSubTotals,k=d0({facetCfg:v,level:m,fields:f})):C.isTableMode()?(j=F,tt=f[O],$=U(U({},y),(a={},a[tt]=j,a)),k=!0):(j=F,$=j===Vu?U({},y):U(U({},y),(o={},o[h]=j,o)),k=d0({facetCfg:v,level:m,fields:f}));var dt=av(g.id,j);if(!dt)return;var Et=uo(A==null?void 0:A[dt])?A==null?void 0:A[dt]:!1,ht=new Zr({id:dt,key:tt,value:j,level:m,field:tt,parent:g,isTotals:D||H,isGrandTotals:V,isSubTotals:Q,isTotalMeasure:H,isCollapsed:Et,isTotalRoot:Y,hierarchy:p,query:$,spreadsheet:C,isLeaf:k||Et}),vt=Vb(v,g,ht,p),It=(l=C==null?void 0:C.facet)===null||l===void 0?void 0:l.getHiddenColumnsInfo(ht);It&&g&&(g.hiddenChildNodeInfo=It),m>p.maxLevel&&!V&&!g.isGrandTotals&&!g.isSubTotals&&!ht.isSubTotals&&(p.sampleNodesForAllLevels.push(ht),p.maxLevel=m,p.sampleNodeForLastLevel=It?((u=It==null?void 0:It.displaySiblingNode)===null||u===void 0?void 0:u.next)||((c=It==null?void 0:It.displaySiblingNode)===null||c===void 0?void 0:c.prev):ht);var ce=k||Et||!vt;ce?(ht.isLeaf=!0,p.pushIndexNode(ht),ht.rowIndex=p.getIndexNodes().length-1):Yz({addTotalMeasureInTotal:x,addMeasureInTotalQuery:_,parentNode:ht,currentField:f[m+1],fields:f,facetCfg:v,hierarchy:p})}}catch(_e){t={error:_e}}finally{try{R&&!R.done&&(e=b.return)&&e.call(b)}finally{if(t)throw t.error}}},jz=function(r,t,e,i){var n=t.facetCfg,a=t.hierarchy,o=t.parentNode,s=n.dataSet;r.forEach(function(l,u){typeof l=="string"&&(l={key:l});var c=l.key,h=c===Su?Pr("序号"):s.getFieldName(c),f=i||o;if(Gb({currentField:c,fields:[c],fieldValues:[h],facetCfg:n,hierarchy:a,parentNode:f,level:e,query:{},addMeasureInTotalQuery:!1,addTotalMeasureInTotal:!1}),l.children&&l.children.length){var d=f.children[u];d.isLeaf=!1,jz(l.children,t,e+1,d)}})},su=function(r,t){return t>0&&r<t},lu=function(r,t,e){return t>0&&r>=e-t},d_=function(r,t,e){return e>0&&r<t+e},cp=function(r,t,e){return e>0&&r>=t+1-e},Xb=function(r,t,e,i,n,a){var o=mh(e,function(h,f){var d=r-(Or(a)?0:a)+n.x;return d>=h&&d<e[f+1]},0);o=Math.max(o,0);var s=mh(e,function(h,f){var d=n.width+r+n.x;return d>=h&&d<e[f+1]},o);s=Math.min(s===-1?1/0:s,e.length-2);var l=i.getIndexRange(t+n.y,n.height+t+n.y),u=l.start,c=l.end;return[o,s,u,c]},Vkt=function(r,t,e){var i=2,n=Math.abs(r/t),a=n<=1/i?0:r,o=n>i?0:t;return[a*e.horizontal,o*e.vertical]},Zo=function(r,t,e){var i,n,a=r==null?void 0:r.getMatrix(),o=(i=a==null?void 0:a[6])!==null&&i!==void 0?i:0,s=(n=a==null?void 0:a[7])!==null&&n!==void 0?n:0;r==null||r.translate(t-o,e-s)},v_=function(r,t){var e,i=r==null?void 0:r.getMatrix(),n=(e=i==null?void 0:i[6])!==null&&e!==void 0?e:0;r==null||r.translate(t-n,0)},Gkt=function(r,t){var e,i=r==null?void 0:r.getMatrix(),n=(e=i==null?void 0:i[7])!==null&&e!==void 0?e:0;r==null||r.translate(0,t-n)},Xkt=function(r,t,e,i){var n=t.frozenColCount,a=t.frozenRowCount,o=t.frozenTrailingColCount,s=t.frozenTrailingRowCount,l=r.colIndex,u=r.rowIndex;return d_(u,i.start,a)?gr.ROW:cp(u,i.end,s)?gr.TRAILING_ROW:su(l,n)?gr.COL:lu(l,o,e)?gr.TRAILING_COL:gr.SCROLL},Ykt=function(r,t,e){for(var i,n=r.frozenColCount,a=r.frozenRowCount,o=r.frozenTrailingColCount,s=r.frozenTrailingRowCount,l=(i={},i[gr.TOP]=[],i[gr.BOTTOM]=[],i),u=0;u<n;u++){for(var c=e.start;c<e.start+a;c++)l[gr.TOP].push({x:u,y:c});if(s>0)for(var c=0;c<s;c++){var h=e.end-c;l[gr.BOTTOM].push({x:u,y:h})}}for(var u=0;u<o;u++){for(var f=t-1-u,c=e.start;c<e.start+a;c++)l[gr.TOP].push({x:f,y:c});if(s>0)for(var c=0;c<s;c++){var h=e.end-c;l[gr.BOTTOM].push({x:f,y:h})}}return l},jkt=function(r,t,e,i){var n=t.frozenColCount,a=t.frozenRowCount,o=t.frozenTrailingColCount,s=t.frozenTrailingRowCount,l=ft([],rt(r),!1);su(l[0],n)&&(l[0]=n),lu(l[1],o,e)&&(l[1]=e-o-1),d_(l[2],i.start,a)&&(l[2]=i.start+a),cp(l[3],i.end,s)&&(l[3]=i.end-s);var u=ft([],rt(l),!1);u[2]=i.start,u[3]=i.start+a-1;var c=ft([],rt(l),!1);c[0]=0,c[1]=n-1;var h=ft([],rt(l),!1);h[2]=i.end+1-s,h[3]=i.end;var f=ft([],rt(l),!1);return f[0]=e-o,f[1]=e-1,{center:l,frozenRow:u,frozenCol:c,frozenTrailingCol:f,frozenTrailingRow:h}},Zkt=function(r,t){var e=r,i=0,n=e.getTotalLength()-1;if(t){var a=t.current,o=a===void 0?gE:a,s=t.pageSize;i=Math.max((o-1)*s,0),n=Math.min(o*s-1,e.getTotalLength()-1)}return{start:i,end:n}},bm=function(r,t,e){var i=t,n=e,a=function(o){return o.isLeaf?1:o.children?o.children.reduce(function(s,l){return s+=a(l),s},0):0};return t&&(i=r.slice(0,t).reduce(function(o,s){return o+=a(s),o},0)),e&&(n=r.slice(r.length-e).reduce(function(o,s){return o+=a(s),o},0)),{colCount:i,trailingColCount:n}},Zz=function(r,t){return r.reduce(function(e,i){typeof i=="string"&&(i={key:i});var n=U({},i);return n.children?(n.children=Zz(n.children,t),e.push(n),e):(t[n.key]&&e.push(n),e)},[])},ho=function(r){return r.parent.id==="root"},qkt=function(r){for(;!ho(r);)r=r.parent;return r},Kkt=function(r){var t=[],e=function(i){i.forEach(function(n){typeof n=="string"||!n.children?t.push(n):e(n.children)})};return e(r),t},Zh=function(r){var t=Kkt(r);return t.map(function(e){return typeof e=="string"?e:e.key})},_E=function(r){var t=r.children[0];return t?t.isLeaf?t:_E(t):r},Qkt=function(r){return st(r.rows)&&st(r.columns)&&st(r.values)&&st(r.customTreeItems)},xh=function(r,t){var e,i=r.pagination,n=r.frozenFirstRow,a=r.hierarchyType,o=r.showSeriesNumber,s=i&&i.pageSize,l=!1,u=t==null?void 0:t[0];if(!s&&n){l=((e=u==null?void 0:u.children)===null||e===void 0?void 0:e.length)===0;var c=a==="tree"||a==="customTree";c&&!l&&(l=!o)}var h=l&&!!u;return{frozenRowCount:h?1:0,frozenColCount:0,frozenTrailingColCount:0,frozenTrailingRowCount:0,enableFrozenFirstRow:l,frozenRowHeight:h?u.height:0}},Jkt=function(r){return r===Vu?zy:r},tUt=function(r){var t=r.facetCfg,e=t.columns,i=t.spreadsheet,n=i.store.get("hiddenColumnsDetail"),a=t==null?void 0:t.showSeriesNumber,o=Zh(e),s=o.filter(function(h){return n?n.every(function(f){return f.hideColumnNodes.every(function(d){return d.field!==h})}):!0}),l=ft([],rt(s),!1),u=ft([],rt(e),!1),c={};a&&(u.unshift({key:Su}),c[Su]=!0),l.reduce(function(h,f){return h[f]=!0,h},c),jz(Zz(u,c),r,0,null)},wc=function(r){return Number.parseFloat((En(r)||0).toPrecision(eU))},js=function(r,t,e){if(e===void 0&&(e=0),!Object.values(r).find(function(o){return o>0}))return r;var i=U({},r);i.frozenColCount>=t&&(i.frozenColCount=t);var n=t-i.frozenColCount;i.frozenTrailingColCount>n&&(i.frozenTrailingColCount=n),i.frozenRowCount>=e&&(i.frozenRowCount=e);var a=e-i.frozenRowCount;return i.frozenTrailingRowCount>a&&(i.frozenTrailingRowCount=a),i},eUt=function(r){var t;return(t=r==null?void 0:r.position)!==null&&t!==void 0?t:"right"},rUt=function(r,t){r===void 0&&(r=0),t===void 0&&(t=0),r=wc(r),t=wc(t);var e=r>=0,i=t>=0&&r<=0,n=e?r:t,a=i?0:n,o=t-r;return function(s){var l=e?0:1,u=i?Cm(Math.abs(0-r)/o,0,1):l,c=Cm((s-a)/o,-1,1);return{zeroScale:u,scale:c}}},qz=function(r,t){return r_(r,function(e){return e.field instanceof RegExp?e.field.test(t):e.field===t})},Yb=function(r){return Sm({size:0,position:"right",margin:{left:0,right:0}},r)},Kz=function(r,t,e){var i=t.size,n=t.margin,a=qz(r==null?void 0:r.icon,e),o=a&&a.mapping&&{size:i,margin:n,position:eUt(a)};return Yb(o)};function Sn(r,t,e){var i;return(i=r==null?void 0:r.addShape)===null||i===void 0?void 0:i.call(r,"rect",U({zIndex:1,attrs:t},e||{}))}function iUt(r,t){var e;return(e=r==null?void 0:r.addShape)===null||e===void 0?void 0:e.call(r,"polygon",{attrs:t})}function nUt(r,t){var e;return(e=r==null?void 0:r.addShape)===null||e===void 0?void 0:e.call(r,"polyline",{attrs:t})}function Qz(r,t){var e;return(e=r==null?void 0:r.addShape)===null||e===void 0?void 0:e.call(r,"circle",{attrs:t})}function Iu(r,t,e,i,n,a,o,s){var l;return!st(t)&&r&&$t(t,function(u){r.contain(u)&&r.removeChild(u,!0)}),(l=r==null?void 0:r.addShape)===null||l===void 0?void 0:l.call(r,"text",{attrs:U(U({x:e,y:i,text:n,originalText:s},a),o)})}function qr(r,t,e){var i;return(i=r==null?void 0:r.addShape)===null||i===void 0?void 0:i.call(r,"line",{zIndex:100,attrs:U(U({},t),e)})}function Hn(r,t,e){if(!st(r)){var i=Lt(r)?r:[r];i.forEach(function(n){rv(n,"attrs.".concat(t),e)})}}function jb(r,t){var e=new nv(t);return r==null||r.add(e),e}function Jz(r,t,e,i,n){var a=new nv(U(U({name:i?"Plus":"Minus"},t),{fill:e}));return ri(n)&&a.on("click",n),r==null||r.add(a),a}var xE="s2-offscreen-canvas",aUt=function(){var r=document.getElementById(xE);return r||(r=document.createElement("canvas"),r.id=xE,r.style.display="none",document.body.appendChild(r),r)},oUt=function(){var r;(r=document.getElementById(xE))===null||r===void 0||r.remove()},tH=function(r,t){var e,i,n,a=r.data,o=r.encode,s=r.type,l=t.getMeta(),u=l.x,c=l.y,h=l.height,f=l.width,d=t.getStyle(ut.DATA_CELL),v=d.cell,p=d.miniChart,g=[],m=ue(a,function(H){return g.push(H==null?void 0:H[o.y]),{x:H[o.x],y:H[o.y]}}),y=yh(g),_=Tb(g),x=y-_,C=u+v.padding.left,A=u+f-v.padding.right,b=c+v.padding.top,R=c+h-v.padding.bottom,M=R-b,O=s===gh.Bar?(A-C-(g.length-1)*((e=p==null?void 0:p.bar)===null||e===void 0?void 0:e.intervalPadding))/g.length+((i=p==null?void 0:p.bar)===null||i===void 0?void 0:i.intervalPadding):(n=(A-C)/(g.length-1))!==null&&n!==void 0?n:0,F=[],D=ue(m,function(H,j){var $,k=C+j*O,V;if(x!==0?V=R-((H==null?void 0:H.y)-_)/x*M:V=_>0?b:R,s===gh.Bar){var Q=void 0,Y=void 0;_<0&&y>0&&x!==0?(Q=R-(0-_)/x*M,Y=Math.abs(V-Q),(H==null?void 0:H.y)<0&&(V=Q)):(Q=_<0?b:R,x=yh([Math.abs(y),Math.abs(_)]),Y=x===0?M:Math.abs((H==null?void 0:H.y)-0)/x*M,V=Q);var tt=O-(($=p==null?void 0:p.bar)===null||$===void 0?void 0:$.intervalPadding);F.push([tt,Y])}return[k,V]});return{points:D,box:F}},sUt=function(r,t){if(!(st(r==null?void 0:r.data)||st(t))){var e=t.getStyle(ut.DATA_CELL),i=e.miniChart,n=i.line,a=n.point,o=n.linkLine,s=tH(r,t).points;nUt(t,{points:s,stroke:o.fill,lineWidth:o.size,opacity:o.opacity});for(var l=0;l<s.length;l++)Qz(t,{x:s[l][0],y:s[l][1],r:a.size,fill:a.fill,fillOpacity:a.opacity})}},lUt=function(r,t){if(!(st(r==null?void 0:r.data)||st(t)))for(var e=t.getStyle(ut.DATA_CELL),i=e.miniChart,n=i.bar,a=tH(r,t),o=a.points,s=a.box,l=0;l<o.length;l++)Sn(t,{x:o[l][0],y:o[l][1],width:s[l][0],height:s[l][1],fill:n.fill,fillOpacity:n.opacity})},uUt=function(r,t,e){var i=Number(t)-Number(r);return Number.isNaN(i)||Number(r)<0?e.bad:i<=.1?e.good:i>.1&&i<=.2?e.satisfactory:e.bad},cUt=function(r,t){var e,i;t===void 0&&(t={min:0,max:0});var n=Number(r);if(Number.isNaN(n))return r;var a=(e=t==null?void 0:t.min)!==null&&e!==void 0?e:t,o=(i=t==null?void 0:t.max)!==null&&i!==void 0?i:t,s=new Intl.NumberFormat("en-US",{minimumFractionDigits:a,maximumFractionDigits:o,useGrouping:!1,style:"percent"});return s.format(n)},hUt=function(r){var t,e,i,n,a,o;if(!st(r)){var s=r.getCellArea(),l=s.x,u=s.y,c=s.height,h=s.width,f=r.findFieldCondition((t=r.cellConditions)===null||t===void 0?void 0:t.interval);if(f&&f.mapping){var d=r.mappingValue(f);if(!d)return;var v=d.isCompare?d:r.valueRangeByField,p=wc(v.minValue),g=wc(v.maxValue),m=Or(d==null?void 0:d.fieldValue)?wc(r.getMeta().fieldValue):wc(d==null?void 0:d.fieldValue);if(m<p||m>g)return;var y=(i=(e=r.getStyle().miniChart.interval)===null||e===void 0?void 0:e.height)!==null&&i!==void 0?i:r.getStyle().cell.miniBarChartHeight,_=(a=(n=r.getStyle().miniChart.interval)===null||n===void 0?void 0:n.fill)!==null&&a!==void 0?a:r.getStyle().cell.miniBarChartFillColor,x=rUt(p,g),C=x(m),A=C.zeroScale,b=C.scale,R=(o=d.fill)!==null&&o!==void 0?o:_;return Sn(r,{x:l+h*A,y:u+c/2-y/2,width:h*b,height:y,fill:R})}}},fUt=function(r,t){var e,i=t.getStyle(ut.DATA_CELL),n=t.getMeta(),a=n.x,o=n.y,s=n.height,l=n.width,u=n.spreadsheet;if(st(r)){Iu(t,[],a+l-i.cell.padding.right,o+s/2,qu(t,u.options.placeholder),i.text);return}var c=i.miniChart.bullet,h=c.progressBar,f=c.comparativeMeasure,d=c.rangeColors,v=c.backgroundColor,p=r.measure,g=r.target,m=Math.max(Number(p),0),y=Math.max(Number(g),0),_=cUt(p,2),x=(h==null?void 0:h.widthPercent)>1?(h==null?void 0:h.widthPercent)/100:h==null?void 0:h.widthPercent,C=i.cell.padding,A=l-C.left-C.right,b=x*A,R=A-b,M=a+l-C.right-b,O=o+s/2-h.height/2;Sn(t,{x:M,y:O,width:b,height:h.height,fill:v,textBaseline:i.text.textBaseline});var F=kt(t.getMeta(),"spreadsheet.options.bullet.getRangeColor"),D=Math.max(Math.min(b*m,b),0);Sn(t,{x:M,y:O+(h.height-h.innerHeight)/2,width:D,height:h.innerHeight,fill:(e=F==null?void 0:F(m,y))!==null&&e!==void 0?e:uUt(m,y,d)});var H=M+b*y;qr(t,{x1:H,y1:o+(s-f.height)/2,x2:H,y2:o+(s-f.height)/2+f.height},{stroke:(f==null?void 0:f.fill)||(f==null?void 0:f.color),lineWidth:f.width,opacity:f==null?void 0:f.opacity}),Iu(t,[],M-C.right,o+s/2,Ch({measureTextWidth:u.measureTextWidth,text:_,maxWidth:R-C.right,fontParam:i.text}),i.text)},dUt=function(r,t){switch(t==null?void 0:t.type){case gh.Line:sUt(t,r);break;case gh.Bar:lUt(t,r);break;default:fUt(t,r);break}},eH=function(r,t){var e=r.x,i=r.y,n=r.width,a=r.height,o=n-(t==null?void 0:t.left)-(t==null?void 0:t.right),s=a-(t==null?void 0:t.top)-(t==null?void 0:t.bottom);return{x:e+(t==null?void 0:t.left),y:i+(t==null?void 0:t.top),width:o,height:s}},rH=function(r,t){return t=Yb(t),r-t.size-t.margin.right-t.margin.left},wm=function(r,t,e){var i=r.y,n=r.height;e===void 0&&(e=0);var a=0;switch(t){case"top":a=i;break;case"middle":a=i+n/2-e/2;break;default:a=i+n-e;break}return a},hp=function(r,t,e,i,n){e===void 0&&(e=0),n===void 0&&(n=1);var a=r.x,o=r.width,s=t||{},l=s.textAlign,u=s.textBaseline,c=Yb(i),h=c.size,f=c.margin,d=c.position,v=n*(h+f.left)+(n?f.right:0),p,g;switch(l){case"left":p=a+(d==="left"?v:0),g=a+(d==="left"?f.left:e+f.left);break;case"center":{var m=v-(d==="left"?f.left:f.right)+e,y=a+o/2-m/2;p=y+e/2+(d==="left"?v-f.left:0),g=y+(d==="left"?0:e+f.left);break}default:{p=a+o-(d==="right"?v:0),g=a+o-(d==="right"?v-f.left:e+v-f.left);break}}var _=wm(r,u,0),x=wm(r,u,h);return{text:{x:p,y:_},icon:{x:g,y:x}}},vUt=function(r,t){return hp(r,t).text},pUt=function(r,t,e){var i=t.start+t.width,n=r.start+r.width,a,o;if(t.start<=r.start&&i>=n)a=r.start+r.width/2,o=r.width;else if(t.start<=r.start){var s=t.width-(r.start-t.start);a=s<e?i-e/2:i-s/2,o=s}else if(i>=n){var s=t.width-(i-n);a=s<e?t.start+e/2:t.start+s/2,o=s}else a=t.start+t.width/2,o=t.width;return{start:a,width:o}},Lu=function(r,t,e){var i=t.x,n=t.y,a=t.width,o=t.height,s=e.horizontalBorderWidth,l=e.horizontalBorderColorOpacity,u=e.horizontalBorderColor,c=e.verticalBorderWidth,h=e.verticalBorderColor,f=e.verticalBorderColorOpacity,d=e.borderDash,v,p,g,m,y;if(r===Tr.TOP||r===Tr.BOTTOM){var _=n;r===Tr.TOP?_=n+c/2:_=n+o-c/2,p=_,m=_,v=i,g=i+a,y={lineWidth:s,stroke:u,strokeOpacity:l,lineDash:d}}if(r===Tr.LEFT||r===Tr.RIGHT){var x=i;r===Tr.LEFT?x=i+s/2:x=i+a-s/2,v=x,g=x,p=n,m=n+o,y={lineWidth:c,stroke:h,strokeOpacity:f,lineDash:d}}return{position:{x1:v,x2:g,y1:p,y2:m},style:y}},gUt=function(r,t,e){e===void 0&&(e={left:0,right:0});var i=U({},r);return t==="left"?(i.start+=e.left,i.width-=e.left):t==="right"&&(i.width-=e.right),i},mUt=function(r,t,e,i){var n=t+e,a=r.start;if(i==="center")return a-e/2;var o=r.width-n>0,s=o?r.width/2:n/2;return i==="left"?a-s:a+s-e};Yu(function(r,t){if(r===void 0&&(r=""),!t)return 0;var e=aUt().getContext("2d"),i=t,n=i.fontSize,a=i.fontFamily,o=i.fontWeight,s=i.fontStyle,l=i.fontVariant;return e.font=[s,l,o,"".concat(n,"px"),a].join(" ").trim(),e.measureText("".concat(r)).width},function(r,t){return ft([r],rt(_s(t)),!1).join("")});var hF=function(r,t,e,i){var n=16,a=r(zc,i),o;Yh(t)?o=t:o=Re(t);var s=e,l=[],u,c;if(r(t,i)<=e)return t;for(var h=!0;h;){if(u=o.substr(0,n),c=r(u,i),c+a>s&&c>s){h=!1;break}if(l.push(u),s-=c,o=o.substr(n),!o)return l.join("")}for(var f=!0;f;){if(u=o.substr(0,1),c=r(u,i),c+a>s){f=!1;break}if(l.push(u),s-=c,o=o.substr(1),!o)return l.join("")}return"".concat(l.join(""),"...")},Ch=function(r){var t=r.measureTextWidth,e=r.text,i=r.maxWidth,n=r.fontParam,a=r.priorityParam,o=r.placeholder,s={},l=o??zy,u=Or(e)||e===""||e===Vu,c=u?l:"".concat(e),h=a;if(n&&Lt(n)?h=n:s=n||{},!h||!h.length)return hF(t,c,i,s);var f=[],d=[c];h.forEach(function(m){d.forEach(function(y,_){var x=-1,C=y.match(new RegExp(m));if(C){var A=C[0];x=C.index,f.push(A);var b=x+A.length,R=y.slice(0,x),M=y.slice(b),O=[R,M].filter(function(F){return!!F});d.splice.apply(d,ft([_,1],rt(O),!1))}})}),d=f.concat(d);var v=c,p=t(zc,s),g=i;return d.forEach(function(m){if(g<=0){var y=v.indexOf(m),_=v.slice(y-3,y);if(_&&_!==zc){var x=t(m,s);v=v.replace(m,x>p?zc:m)}else v=v.replace(m,"");g-=p}else{var x=t(m,s);if(g<x&&x>p){var C=hF(t,m,g,s);v=v.replace(m,C),g=0}else g-=x}}),v},yUt=function(r,t,e,i){i===void 0&&(i="left");var n=t.right,a=t.left,o=e||0;return i==="left"?r+n/2+o:i==="right"?r-n/2-o:r+a/2+o},_Ut=function(r){var t,e,i=r.getMeta().isTotals,n=(e=(t=r).isMeasureField)===null||e===void 0?void 0:e.call(t),a=r.getStyle(r.cellType||ut.DATA_CELL),o;return n?o=a.measureText:i?o=a.bolderText:o=a.text,{cellStyle:a,textStyle:o}},xUt=function(r){var t=r.rowIndex,e=r.colIndex,i=r.meta,n=r.data,a=r.textStyle,o=r.textCondition,s=a==null?void 0:a.fill;return o!=null&&o.mapping&&(s=o==null?void 0:o.mapping(n,{rowIndex:t,colIndex:e,meta:i}).fill),U(U({},a),{fill:s})},qu=function(r,t){return ri(t)?t(r):t},CUt=function(r,t,e){for(var i=r.x,n=r.y,a=r.width,o=r.height,s=o/bc(t),l=[],u,c,h,f=0,d=ue(e,function(m){return m>1?m/100:m}),v=0;v<bc(t);v++){c=n+s*v;var p=[];u=i,f=0;for(var g=0;g<bc(t[v]);g++)h=st(d)?a/bc(t[0]):a*d[g],u=yUt(i,{left:0,right:0},f,"left"),f+=h,p.push({x:u,y:c,width:h,height:s});l.push(p)}return l},EUt=function(r,t,e){var i,n,a,o;e===void 0&&(e=!0);var s=r.getContentArea(),l=s.x,u=s.y,c=s.height,h=s.width,f=t||r.getMeta().fieldValue,d=f.values,v=r.getMeta().spreadsheet,p=v.options,g=v.measureTextWidth,m=p.style.cellCfg.valuesCfg,y=(n=(i=p==null?void 0:p.conditions)===null||i===void 0?void 0:i.text)===null||n===void 0?void 0:n[0],_=(o=(a=p==null?void 0:p.conditions)===null||a===void 0?void 0:a.icon)===null||o===void 0?void 0:o[0];if(!Lt(d)){dUt(r,d);return}var x=m==null?void 0:m.widthPercent,C=0;if(f!=null&&f.label){var A=r.getStyle(ut.DATA_CELL),b=A.bolderText;C=c/(d.length+1);var R=Iu(r,[],l,u+C/2,Ch({measureTextWidth:g,text:f.label,maxWidth:h,fontParam:b}),b);r.addTextShape(R)}for(var M=_Ut(r),O=M.cellStyle,F=M.textStyle,D=O==null?void 0:O.icon,H=_&&_.mapping&&{size:D==null?void 0:D.size,margin:D==null?void 0:D.margin,position:_==null?void 0:_.position},j,$=CUt({x:l,y:u+C,height:c-C,width:h},d,x),k=0;k<d.length;k++)for(var V=rp(d[k]),Q=0;Q<V.length;Q++){j=V[Q];var Y=e?xUt({rowIndex:k,colIndex:Q,meta:r==null?void 0:r.getMeta(),data:j,textStyle:F,textCondition:y}):F,tt=(r==null?void 0:r.getMeta().spreadsheet.options).placeholder,et=qu(r==null?void 0:r.getMeta(),tt),dt=rH($[k][Q].width,D),Et=Ch({measureTextWidth:g,text:j,maxWidth:dt,fontParam:Y,placeholder:et}),ht=g(Et,F),vt=hp($[k][Q],F,ht,H,_?1:0),R=Iu(r,[],vt.text.x,vt.text.y,Et,Y,{},j==null?void 0:j.toString());if(r.addTextShape(R),_&&e){var It=_==null?void 0:_.mapping(j,{rowIndex:k,colIndex:Q,meta:r==null?void 0:r.getMeta()});if(It){var ce=jb(r,U(U({},vt.icon),{name:It.icon,width:D==null?void 0:D.size,height:D==null?void 0:D.size,fill:It.fill}));r.addConditionIconShape(ce)}}}},$1=function(r,t){return t===void 0&&(t=1),(r==null?void 0:r.width)*t},SUt=function(r){try{return JSON.parse(r)}catch{return null}},AUt=function(r,t,e){return r.sort(function(i,n){e&&(i=e(i),n=e(n));var a=t.indexOf(i),o=t.indexOf(n);return a===-1&&o===-1?0:a===-1?1:o===-1?-1:a-o})},TUt=function(r){return r===void 0&&(r=[]),r.filter(function(t){return t!==So&&t!==kT})},bUt=function(r){return Lt(r)?V9(r):[r]},wUt=function(r,t){var e;return(e=r==null?void 0:r.filter(function(i){return!(t!=null&&t.includes(i))}))===null||e===void 0?void 0:e.concat(t)};function RUt(r,t){var e=r.isRowTotal,i=r.isRowSubTotal,n=r.isColTotal,a=r.isColSubTotal,o=t||{},s=o.row,l=o.col,u=s||{},c=u.calcTotals,h=c===void 0?{}:c,f=u.calcSubTotals,d=f===void 0?{}:f,v=l||{},p=v.calcTotals,g=p===void 0?{}:p,m=v.calcSubTotals,y=m===void 0?{}:m,_=function(x,C){if((x.aggregation||x.calcFunc)&&C)return{aggregation:x.aggregation,calcFunc:x.calcFunc}};return _(g,n)||_(y,a)||_(h,e)||_(d,i)}function ov(r){return r===u0}function Ul(r,t,e){return r===void 0&&(r={}),t===void 0&&(t=[]),e===void 0&&(e=So),t.reduce(function(i,n){var a=r[n];return n in r?i.push(String(a)):i.push(e),i},[])}function iH(r,t){var e=t.filter(function(i){return i in r});return st(e)&&e.push(kT),e}function fF(r,t,e){r===void 0&&(r={}),t===void 0&&(t=[]);var i=[];function n(a,o,s){return o.reduce(function(l,u){var c=a[u];return u in a?l.push(String(c)):u===Kt&&s?l.push(s):l.push(So),l},[])}return e?e.forEach(function(a){i.push(n(r,t,a))}):i.push(n(r,t)),i}function MUt(r,t,e){var i,n=t.slice(0,t.indexOf(r)+1);return(i=e.map(function(a){return n.map(function(o){return a[o]}).join("".concat(li))}))===null||i===void 0?void 0:i.filter(function(a){return a})}function Rm(r,t){return r.concat(t).filter(function(e){return e!==Kt}).join(li)}function Mm(r){var t=r.rowDimensionValues,e=r.colDimensionValues,i=r.isFirstCreate,n=r.onFirstCreate,a=r.rowFields,o=r.colFields,s=r.rowPivotMeta,l=r.colPivotMeta,u=r.prefix,c=u===void 0?"":u,h=function(v,p,g,m){for(var y=g,_=[],x=0;x<p.length;x++){var C=p[x];if(i&&y&&!(y!=null&&y.has(C))){var A=p.slice(0,x+1).map(function(D){return String(D)}),b=A.join(li),R=C===So,M=void 0;R?M=0:y.has(So)?M=y.size:M=y.size+1,y.set(C,{id:b,dimensions:A,value:C,level:M,children:new Map}),n==null||n({dimension:v==null?void 0:v[x],dimensionPath:b,careRepeated:m})}var O=y==null?void 0:y.get(C);if(_.push(ov(C)?C:O==null?void 0:O.level),O){var F=v==null?void 0:v[x+1];i&&O.childField!==F&&(O.childField=F),y=O==null?void 0:O.children}}return _},f=h(a,t,s,!1),d=h(o,e,l,!0);return ft(ft([c],rt(f),!1),rt(d),!1)}function IUt(r){var t=r.rows,e=r.columns,i=r.values,n=r.valueInCols,a=r.data,o=a===void 0?[]:a,s=r.indexesData,l=s===void 0?{}:s,u=r.sortedDimensionValues,c=r.rowPivotMeta,h=r.colPivotMeta,f=r.getExistValuesByDataItem,d=[],v=new Set(Y9(t,e)),p=function(m){var y=m.dimension,_=m.dimensionPath,x=m.careRepeated,C=x===void 0?!0:x;C&&v.has(y)||(u[y]||(u[y]=[])).push(_)},g=Rm(t,e);return o.forEach(function(m){var y,_,x,C;if(!(!m||st(m))){var A=f?f(m,i):iH(m,i),b=fF(m,t,n?null:A),R=fF(m,e,n?A:null);try{for(var M=ia(b),O=M.next();!O.done;O=M.next()){var F=O.value;try{for(var D=(x=void 0,ia(R)),H=D.next();!H.done;H=D.next()){var j=H.value,$=Mm({rowDimensionValues:F,colDimensionValues:j,rowPivotMeta:c,colPivotMeta:h,rowFields:t,colFields:e,isFirstCreate:!0,onFirstCreate:p,prefix:g});d.push($),rv(l,$,m)}}catch(k){x={error:k}}finally{try{H&&!H.done&&(C=D.return)&&C.call(D)}finally{if(x)throw x.error}}}}catch(k){y={error:k}}finally{try{O&&!O.done&&(_=M.return)&&_.call(M)}finally{if(y)throw y.error}}}}),{paths:d,indexesData:l,rowPivotMeta:c,colPivotMeta:h,sortedDimensionValues:u}}function dF(r,t){if(!(!r||!t)){var e=t.split(li),i=Be(e),n=r;$t(e,function(a,o){var s=n.get(a);return s?(a===i?(s.children=new Map,s.childField=void 0):n=s.children,!0):o===0&&a===tU})}}function LUt(r,t,e){var i=function(o){var s=vi(r,function(l){var u=l.field;return u===o});return kt(s,"name",o)},n=t||e,a={field:Kt,name:n,formatter:function(o){return i(o)}};return a}function vd(r,t){return{isRowTotal:r.isGrandTotals,isRowSubTotal:r.isSubTotals,isColTotal:t.isGrandTotals,isColSubTotal:t.isSubTotals}}function OUt(r){for(var t=null,e=0;e<r.length;e++){var i=r[e];if(ov(i))t=e;else if(!J9(t)&&t<e)return!0}return!1}function nH(r){var t=r.pivotMeta,e=r.dimensionValues,i=r.fieldIdx,n=r.queryType,a=r.fields,o=r.sortedDimensionValues,s={children:t},l=[s];function u(f,d){var v,p=ap(f,function(y){var _,x,C=[];try{for(var A=ia(y.children.values()),b=A.next();!b.done;b=A.next()){var R=b.value;R.value!==kT&&(n===Yn.All||R.value!==So)&&C.push(R)}}catch(M){_={error:M}}finally{try{b&&!b.done&&(x=A.return)&&x.call(A)}finally{if(_)throw _.error}}return C});if(f.length>1){var g=(v=o[d])!==null&&v!==void 0?v:[],m=new Map(g.map(function(y,_){return[y,_]}));return p.sort(function(y,_){return m.get(y.id)-m.get(_.id)}),p}return p}for(var c=function(f){var d=e[f],v=a[f];ov(d)?l=u(l,v):l=l.map(function(p){return p.children.get(d)}).filter(Boolean)},h=0;h<=i;h++)c(h);return l}function vF(r){var t=r.dimensionValues,e=r.pivotMeta,i=r.fields,n=r.sortedDimensionValues,a=r.queryType,o=a===void 0?Yn.All:a;if(!OUt(t))return[t];var s=nH({pivotMeta:e,dimensionValues:t,fieldIdx:t.length-1,queryType:o,fields:i,sortedDimensionValues:n});return s.map(function(l){return l.dimensions})}function PUt(r){var t=r.rowFields,e=r.rowDimensionValues,i=r.rowPivotMeta,n=r.colFields,a=r.colDimensionValues,o=r.colPivotMeta,s=r.queryType,l=r.sortedDimensionValues,u=vF({dimensionValues:e,pivotMeta:i,fields:t,sortedDimensionValues:l,queryType:s}),c=vF({dimensionValues:a,pivotMeta:o,fields:n,sortedDimensionValues:l,queryType:s});return{rowQueries:u,colQueries:c}}function FUt(r,t){return r?Lt(r)?ap(r,function(e){if(!Lt(e))return Oa([e]);var i=t===Yn.DetailOnly?1:0;return Oa(e.slice(i))}):Oa([r]):[]}var Bg;function pF(r,t){return!r||!t?!1:String(r).toLowerCase()===String(t).toLowerCase()}var BUt=`\r
`,DUt="	",Im=function(r,t){var e=r.getColumnNodes().find(function(i){return i.id===t});return r.isPivotMode()?e==null?void 0:e.value:e==null?void 0:e.field},NUt=function(r,t){var e=t.getColumnNodes().find(function(i){return i.colIndex===r});return Im(t,e.id)},kUt=function(r,t){var e=r.rowIndex,i=r.colIndex;return[t.getRowNodes().find(function(n){return n.rowIndex===e}),t.getColumnNodes().find(function(n){return n.colIndex===i})]},sv=function(r,t){var e=t.getColumnNodes().find(function(n){return n.colIndex===r}),i=Im(t,e.id);return t.options.interaction.copyWithFormat?t.dataSet.getFieldFormatter(i):function(n){return n}},UUt=function(r){var t,e,i,n,a=((n=(i=(e=r.options)===null||e===void 0?void 0:e.style)===null||i===void 0?void 0:i.colCfg)===null||n===void 0?void 0:n.hideMeasureColumn)&&r.isValueInCols();return a?(t={},t[Kt]=r.dataCfg.fields.values[0],t):{}},zUt=function(r,t,e){var i,n;if(e.isPivotMode()){var a=rt(kUt(r,e),2),o=a[0],s=a[1],l=UUt(e),u=e.dataSet.getCellData({query:U(U(U({},o.query),s.query),l),rowNode:o,isTotals:o.isTotals||o.isTotalMeasure||s.isTotals||s.isTotalMeasure,totalStatus:vd(o,s)});return(i=u==null?void 0:u[Zi])!==null&&i!==void 0?i:""}var c=NUt(r.colIndex,e);return(n=t[r.rowIndex])===null||n===void 0?void 0:n[c]},aH=function(r,t,e){var i=sv(r.colIndex,e);return i(zUt(r,t,e))},Zb=function(r){return/\n/.test(r)?'"'+r.replace(/\r\n?/g,`
`)+'"':r},lv=function(r,t){var e=r.split(li);return t?e.slice(e.length-t):(e.shift(),e)},CE=function(r,t){return ue(r,function(e){return t.dataSet.getFieldName(e)})},tr;(function(r){r.PLAIN="text/plain",r.HTML="text/html"})(tr||(tr={}));var HUt=function(r){return{type:tr.PLAIN,content:ue(r,function(t){return t.join(DUt)}).join(BUt)}},$Ut=function(r){function t(i,n){return i.map(function(a){return"<".concat(n,">").concat(pb(a),"</").concat(n,">")}).join("")}function e(i,n){return i.map(function(a){return"<".concat(n,">").concat(t(a,"td"),"</").concat(n,">")}).join("")}return{type:tr.HTML,content:'<meta charset="utf-8"><table><tbody>'.concat(e(r,"tr"),"</tbody></table>")}},WUt=(Bg={},Bg[tr.PLAIN]=HUt,Bg[tr.HTML]=$Ut,Bg);function on(r){return WUt[r]}function VUt(r,t){return t===void 0&&(t=tr.PLAIN),Array.isArray(t)?[].concat(r).filter(function(e){return t.includes(e.type)}).map(function(e){return e.content}):[].concat(r).filter(function(e){return(e==null?void 0:e.type)===t}).map(function(e){return e.content})[0]||""}var oH=function(r,t,e){var i,n,a,o,s,l,u=(n=(i=r[0])===null||i===void 0?void 0:i.length)!==null&&n!==void 0?n:0,c=(a=t==null?void 0:t.length)!==null&&a!==void 0?a:0,h=(s=(o=e[0])===null||o===void 0?void 0:o.length)!==null&&s!==void 0?s:0,f=(l=e.length)!==null&&l!==void 0?l:0,d=u+h,v=c+f,p=Array.from(Array(v),function(){return new Array(d)});return p=ue(p,function(g,m){return ue(g,function(y,_){if(_>=0&&_<u&&m>=0&&m<c)return"";if(_>=u&&_<=d&&m>=0&&m<c)return t[m][_-u];if(_>=0&&_<u&&m>=c&&m<v)return r[m-c][_];if(_>=u&&_<=d&&m>=c&&m<v)return e[m-c][_-u]})}),[on(tr.PLAIN)(p),on(tr.HTML)(p)]},GUt=function(r,t,e){var i=t.map(function(n){return n.map(function(a){return a?Zb(aH(a,r,e)):""})});return[on(tr.PLAIN)(i),on(tr.HTML)(i)]},XUt=function(r){if(!(r!=null&&r.length))return[];var t=rt([{row:1/0,col:1/0},{row:0,col:0}],2),e=t[0],i=t[1];r.forEach(function(l){var u=l.rowIndex,c=l.colIndex;e.col=Math.min(c,e.col),e.row=Math.min(u,e.row),i.col=Math.max(c,i.col),i.row=Math.max(u,i.row)});var n=rt([i.row-e.row+1,i.col-e.col+1],2),a=n[0],o=n[1],s=new Array(a).fill("").map(function(){return new Array(o).fill("")});return r.forEach(function(l){var u=l.rowIndex,c=l.colIndex,h=rt([u-e.row,c-e.col],2),f=h[0],d=h[1];s[f][d]=l}),s},YUt=function(r,t){var e=r.dataSet.getDisplayDataSet(),i=t.length?t.map(function(a){return{field:Im(r,a.id),formatter:sv(a.colIndex,r)}}):r.dataCfg.fields.columns.map(function(a){return r.getColumnNodes().find(function(o){return o.field===a})}).map(function(a){return{field:Im(r,a.id),formatter:sv(a.colIndex,r)}}),n=e.map(function(a){return i.map(function(o){var s=o.field,l=o.formatter;return Zb(l(a[s]))})});return[on(tr.PLAIN)(n),on(tr.HTML)(n)]},sH=function(r,t,e){return ue(r,function(i){return t.map(function(n){var a,o=e.dataSet.getCellData({query:U(U({},i.query),n.query),rowNode:i,isTotals:i.isTotals||i.isTotalMeasure||n.isTotals||n.isTotalMeasure,totalStatus:vd(i,n)});return sv(n.colIndex,e)((a=o==null?void 0:o[Zi])!==null&&a!==void 0?a:"")})})},jUt=function(r,t,e){var i=sH(t,e,r);return[on(tr.PLAIN)(i),on(tr.HTML)(i)]},ZUt=function(r,t,e){var i=ue(t,function(o){return lv(o.id)}),n=h_.apply(void 0,ft([],rt(ue(e,function(o){return lv(o.id)})),!1)),a=sH(t,e,r);return oH(i,n,a)};function lH(r,t,e){var i=r.options.interaction.copyWithHeader;return i?ZUt(r,t,e):jUt(r,t,e)}var qUt=function(r,t){var e=r.getRowNodes().filter(function(a){return a.isLeaf||r.isHierarchyTreeType()}),i=r.getColumnNodes().filter(function(a){return a.isLeaf}),n=t.length?t.reduce(function(a,o){return a.push.apply(a,ft([],rt(i.filter(function(s){return s.id.startsWith(o.id)})),!1)),a},[]):i;return lH(r,e,n)},gF=function(r,t,e){return t.isPivotMode()?qUt(t,e):YUt(t,e)},KUt=function(r,t){var e=r.dataSet.getDisplayDataSet(),i=e.filter(function(n,a){return t.map(function(o){return o.rowIndex}).includes(a)}).map(function(n){var a=r.getColumnNodes().reduce(function(o,s,l){return o[s.field]=l,o},{});return Object.keys(n).sort(function(o,s){return a[o]-a[s]}).map(function(o){return r.getColumnNodes().find(function(s){return s.field===o})}).filter(Boolean).map(function(o){return Zb(sv(o.colIndex,r)(n[o.field]))})});return[on(tr.PLAIN)(i),on(tr.HTML)(i)]},QUt=function(r,t){var e=r.getRowNodes().filter(function(a){return a.isLeaf||r.isHierarchyTreeType()}),i=r.getColumnNodes().filter(function(a){return a.isLeaf}),n=t.reduce(function(a,o){return a.push.apply(a,ft([],rt(e.filter(function(s){return s.id.startsWith(o.id)})),!1)),a},[]);return lH(r,n,i)},JUt=function(r,t,e){return t.isPivotMode()?QUt(t,e):KUt(t,e)},t9t=function(r,t,e){var i=h_.apply(void 0,ft([],rt(ue(r[0],function(o){var s,l=(o==null?void 0:o.colId)||Be((s=o==null?void 0:o.id)===null||s===void 0?void 0:s.split(YC))||"";return CE(lv(l),e)})),!1)),n=ue(r,function(o){var s,l,u,c=((s=o==null?void 0:o[0])===null||s===void 0?void 0:s.rowId)||Mu((u=(l=o==null?void 0:o[0])===null||l===void 0?void 0:l.id)===null||u===void 0?void 0:u.split(YC))||"";return CE(lv(c),e)}),a=ue(r,function(o){return ue(o,function(s){return aH(s,t,e)})});return oH(n,i,a)};function e9t(r){var t=new Set;return $t(r,function(e){var i=e.getMeta().level;t.has(i)||t.add(i)}),t}function r9t(r,t){return ys(r,function(e){var i=e.getMeta(),n=i.level===t,a=i.isTotals&&st(i.children);return n||a})}function i9t(r,t){for(var e=r,i={level:t},n=e.label;e.level>=0;){for(var a=i.level-e.level;a>0;)n="".concat(e.label).concat(li).concat(n),a--;i=e,e=e.parent}return n}function n9t(r,t,e){return ue(r,function(i){var n=i.getMeta(),a=n.id,o=n.isTotals,s=n.spreadsheet,l=o?i9t(n,t):a,u=lv(l,e.size);return CE(u,s)})}function a9t(r){var t,e=e9t(r),i=(t=yh(Array.from(e)))!==null&&t!==void 0?t:0,n=r9t(r,i),a=r[0].cellType===ut.COL_CELL,o=n9t(n,i,e);return a&&(o=h_.apply(void 0,ft([],rt(o),!1))),[on(tr.PLAIN)(o),on(tr.HTML)(o)]}var o9t=function(r,t,e){return ue(t,function(i){var n;return(n=r[i])!==null&&n!==void 0?n:e})},s9t=function(r,t){var e=r.options.placeholder,i=r.dataCfg.fields,n=i.rows,a=i.columns,o=i.values,s=qu(r,e),l=r.getColumnLeafNodes(),u=[];if(r.isTableMode()){var c=ys(l,function(v){return v.field!==Su});u=ue(t,function(v){return ue(c,function(p){var g;return(g=v==null?void 0:v[p.field])!==null&&g!==void 0?g:s})})}else if(r.isPivotMode()){var h=ft(ft(ft([],rt(n),!1),rt(a),!1),rt(o),!1),f=bUt(t),d=f.filter(function(v){return ft(ft([],rt(n),!1),rt(a),!1).every(function(p){return!Or(v[p])})});u=l_(d,function(v,p){return ft(ft([],rt(v),!1),[o9t(p,h,s)],!1)},[])}return[on(tr.PLAIN)(u),on(tr.HTML)(u)]};function l9t(r,t){var e,i,n=t.filter(function(c){var h=c.type;return h===ut.COL_CELL}),a=t.filter(function(c){var h=c.type;return h===ut.ROW_CELL}),o=r.dataSet.getDisplayDataSet();if(r.interaction.getCurrentStateName()===bt.ALL_SELECTED)i=gF(o,r,[]);else if(n.length)i=gF(o,r,n);else if(a.length)i=JUt(o,r,a);else{if(!t.length)return;var s=XUt(t),l=r.interaction.getSelectedCellHighlight().currentRow;if(l){var u=Mb(t,"rowIndex","asc").map(function(c){return r.dataSet.getRowData(c)});i=s9t(r,u)}else!((e=r.options.interaction)===null||e===void 0)&&e.copyWithHeader?i=t9t(s,o,r):i=GUt(o,s,r)}return i}var u9t=function(r){var t,e=r.interaction,i=e.getState().cells||[],n,a=(t=e.getInteractedCells())!==null&&t!==void 0?t:[],o=st(a)?!1:e_(a,function(s){return s.cellType===ut.ROW_CELL||s.cellType===ut.COL_CELL});return o?n=a9t(a):n=l9t(r,i),n&&h9t(n),VUt(n,tr.PLAIN)},uH=function(r){return new Promise(function(t,e){var i;Array.isArray(r)?i=kt(r.filter(function(o){return o.type===tr.PLAIN}),"[0].content",""):i=r.content||"";var n=document.createElement("textarea");n.value=i,document.body.appendChild(n),n.focus({preventScroll:!0}),n.select();var a=document.execCommand("copy");document.body.removeChild(n),a?t():e()})},c9t=function(r){return navigator.clipboard.write([new ClipboardItem([].concat(r).reduce(function(t,e){var i,n=e.type,a=e.content,o=a.replace(/\x00/g,"");return U(U({},t),(i={},i[n]=new Blob([o],{type:n}),i))},{}))]).catch(function(){return uH(r)})},h9t=function(r,t){t===void 0&&(t=!1);var e;return typeof r=="string"?e={content:r,type:tr.PLAIN}:e=r,!navigator.clipboard||!window.ClipboardItem||t?uH(e):c9t(e)},qb=function(r,t,e){var i,n=r.split(li);if(e)i=[r];else{i=[av(n[0],n[1])];for(var a=2;a<n.length;a+=1)i.push(av(i[a-2],n[a]))}var o=ys(t,function(s){var l;return i.includes((l=s.getMeta())===null||l===void 0?void 0:l.id)});return o},cH=function(r,t,e){if(r){var i=qb(r,t);$t(i,function(n){n.updateByState(e)})}},f9t=function(r,t){return typeof r=="function"?r(t):r.some(function(e){return e===t.key||e===t.id||e===t.valueField})},eo=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=function(n,a){if(Lt(n)&&Lt(a))return a},i=ft(ft([],rt(r),!1),[e],!1);return fb.apply(void 0,ft([{}],rt(i),!1))},d9t=function(r){var t=["rows","columns","values"],e=t.reduce(function(i,n){var a=r[n],o=Vo(a);return Jr(o,a)||console.warn("fields.".concat(n,":[").concat(a,"] should be unique")),i[n]=o,i},{});return U(U({},r),e)},W1=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=eo.apply(void 0,ft([dwt],rt(r),!1));return e.fields=d9t(e.fields),(!st(e.fields.customTreeItems)||st(e.fields.values))&&(e.fields.valueInCols=!1),e},mF=function(r){return eo(_wt,r)},p_=function(r){yt(t,r);function t(e,i){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];var o=r.call(this,{})||this;return o.textShapes=[],o.actualTextWidth=0,o.conditionIconShapes=[],o.stateShapes=new Map,o.meta=e,o.spreadsheet=i,o.theme=i.theme,o.conditions=o.spreadsheet.options.conditions,o.handleRestOptions.apply(o,ft([],rt(n),!1)),o.shouldInit()&&o.initCell(),o}return t.prototype.getMeta=function(){return this.meta},t.prototype.setMeta=function(e){this.meta=eo(this.meta,e)},t.prototype.getIconStyle=function(){return this.theme[this.cellType].icon},t.prototype.getTextAndIconPosition=function(e){e===void 0&&(e=1);var i=this.getTextStyle(),n=this.getIconStyle();return hp(this.getContentArea(),i,this.actualTextWidth,n,e)},t.prototype.getActualText=function(){return this.actualText},t.prototype.isTextOverflowing=function(){var e=this.getActualText();return e?wi(e,zc):e!==this.getFieldValue()},t.prototype.getFieldValue=function(){var e=this.getFormattedFieldValue().formattedValue;return e===Vu?this.getActualText():e},t.prototype.handleRestOptions=function(){},t.prototype.shouldInit=function(){var e=this.meta,i=e.width,n=e.height;return i>0&&n>0},t.prototype.getStyle=function(e){return kt(this.theme,e||this.cellType)},t.prototype.getResizeAreaStyle=function(){return this.getStyle("resizeArea")},t.prototype.shouldDrawResizeAreaByType=function(e,i){var n=this.spreadsheet.options.interaction.resize;return uo(n)?n:ri(n.visible)?n.visible(i):n[e]},t.prototype.getCellArea=function(){var e=this.meta,i=e.x,n=e.y,a=e.height,o=e.width;return{x:i,y:n,height:a,width:o}},t.prototype.getContentArea=function(){var e=this.getStyle()||this.theme.dataCell,i=(e==null?void 0:e.cell).padding;return eH(this.getCellArea(),i)},t.prototype.getIconPosition=function(e){return e===void 0&&(e=1),this.getTextAndIconPosition(e).icon},t.prototype.drawTextShape=function(){var e=this.getFormattedFieldValue().formattedValue,i=this.getMaxTextWidth(),n=this.getTextStyle(),a=this.spreadsheet,o=a.options.placeholder,s=a.measureTextWidth,l=qu(this,o),u=Ch({measureTextWidth:s,text:e,maxWidth:i,fontParam:n,placeholder:l});this.actualText=u,this.actualTextWidth=s(u,n);var c=this.getTextPosition();this.textShape=Iu(this,[this.textShape],c.x,c.y,u,n),this.textShapes.push(this.textShape)},t.prototype.drawLinkFieldShape=function(e,i){if(e){var n=this.spreadsheet.options.style.device;if(!Nr(n)){var a=this.getTextStyle(),o=this.getTextPosition(),s=o.x;a.textAlign==="center"?s-=this.actualTextWidth/2:a.textAlign==="right"&&(s-=this.actualTextWidth);var l=this.textShape.getBBox().maxY;this.linkFieldShape=qr(this,{x1:s,y1:l+1,x2:s+this.actualTextWidth,y2:l+1},{stroke:i,lineWidth:1})}this.textShape.attr({fill:i,cursor:"pointer",appendInfo:{isLinkFieldText:!0,cellData:this.meta}})}},t.prototype.getLinkFieldStyle=function(){return this.getTextStyle().linkTextFill},t.prototype.drawLinkField=function(e){var i=this.spreadsheet.options.interaction.linkFields,n=i===void 0?[]:i,a=this.getLinkFieldStyle(),o=f9t(n,e);this.drawLinkFieldShape(o,a)},t.prototype.updateByState=function(e,i){var n=this;this.spreadsheet.interaction.setInteractedCells(i);var a=kt(this.theme,"".concat(this.cellType,".cell.interactionState.").concat(e));$t(a,function(o,s){var l=ar(Rb(vwt,function(u){return wi(u,s)}));l.forEach(function(u){var c=n.stateShapes.has(u),h=c?n.stateShapes.get(u):n[u],f=Lt(h)?h:[h];if(c&&f.forEach(function(v){v.set("visible",!0)}),u==="interactiveBorderShape"&&s==="borderWidth"&&Si(o)){var d=n.getInteractiveBorderShapeStyle(o);$t(d,function(v,p){Hn(f,p,v)})}Hn(f,mn[s],o)})})},t.prototype.getInteractiveBorderShapeStyle=function(e){var i=this.getCellArea(),n=i.x,a=i.y,o=i.height,s=i.width,l=this.theme.dataCell.cell,u=l.horizontalBorderWidth,c=l.verticalBorderWidth;return{x:n+c/2+e/2,y:a+u/2+e/2,width:s-c-e,height:o-u-e}},t.prototype.hideInteractionShape=function(){this.stateShapes.forEach(function(e){Hn(e,mn.backgroundOpacity,0),Hn(e,mn.backgroundColor,"transparent"),Hn(e,mn.borderOpacity,0),Hn(e,mn.borderWidth,1),Hn(e,mn.borderColor,"transparent")})},t.prototype.clearUnselectedState=function(){Hn(this.backgroundShape,mn.backgroundOpacity,1),Hn(this.textShapes,mn.textOpacity,1),Hn(this.linkFieldShape,mn.opacity,1)},t.prototype.getTextShape=function(){return this.textShape},t.prototype.getTextShapes=function(){return this.textShapes||[this.textShape]},t.prototype.addTextShape=function(e){e&&this.textShapes.push(e)},t.prototype.getConditionIconShape=function(){return this.conditionIconShape},t.prototype.getConditionIconShapes=function(){return this.conditionIconShapes||[this.conditionIconShape]},t.prototype.addConditionIconShape=function(e){e&&this.conditionIconShapes.push(e)},t.prototype.resetTextAndConditionIconShapes=function(){this.textShapes=[],this.conditionIconShapes=[]},Object.defineProperty(t.prototype,"cellConditions",{get:function(){return this.conditions},enumerable:!1,configurable:!0}),t.prototype.drawConditionIconShapes=function(){var e,i=this.findFieldCondition((e=this.conditions)===null||e===void 0?void 0:e.icon);if(i&&i.mapping){var n=this.mappingValue(i),a=this.getIconPosition(),o=this.theme.dataCell.icon.size;st(n==null?void 0:n.icon)||(this.conditionIconShape=jb(this,U(U({},a),{name:n.icon,width:o,height:o,fill:n.fill})),this.addConditionIconShape(this.conditionIconShape))}},t.prototype.getTextConditionFill=function(e){var i,n,a=e.fill,o=this.findFieldCondition((i=this.conditions)===null||i===void 0?void 0:i.text);return o!=null&&o.mapping&&(a=((n=this.mappingValue(o))===null||n===void 0?void 0:n.fill)||e.fill),a},t.prototype.getCrossBackgroundColor=function(e){var i=this.getStyle().cell,n=i.crossBackgroundColor,a=i.backgroundColorOpacity;return n&&e%2===0?{backgroundColorOpacity:a,backgroundColor:n}:{backgroundColorOpacity:a,backgroundColor:this.getStyle().cell.backgroundColor}},t}(Mo),hH=function(r,t){return t?t(r[Kt],r[Zi]):r[Zi]},ql=function(r,t){var e=t.getMeta().id;return r.some(function(i){return Jr(i.id,e)})},fp=function(r,t){return"".concat(r).concat(YC).concat(t)},v9t=function(r){var t=r.interaction.getSelectedCellHighlight(),e=t.currentRow,i=t.currentCol,n=t.rowHeader,a=t.colHeader;return e||i||n||a},Kb=function(r){return r.type===ut.DATA_CELL},p9t=function(r,t){$t(r,function(e){Kb(e)&&e.rowIndex===t.getMeta().rowIndex&&t.updateByState(bt.SELECTED)})},g9t=function(r,t){$t(r,function(e){Kb(e)&&e.colIndex===t.getMeta().colIndex&&t.updateByState(bt.SELECTED)})},m9t=function(r,t){$t(r,function(e){Kb(e)&&e.rowIndex===t.getMeta().rowIndex&&e.colIndex===t.getMeta().colIndex&&t.updateByState(bt.SELECTED)})},y9t=function(r,t,e){var i=e.interaction.getSelectedCellHighlight(),n=i.rowHeader,a=i.colHeader,o=i.currentRow,s=i.currentCol,l=t.cellType===ut.ROW_CELL,u=e.isTableMode()&&e.options.showSeriesNumber&&n&&l;(o||u)&&p9t(r,t),s&&g9t(r,t),(n||a)&&m9t(r,t)},Cl=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"cellType",{get:function(){return ut.DATA_CELL},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"valueRangeByField",{get:function(){return this.spreadsheet.dataSet.getValueRangeByField(this.meta.valueField)},enumerable:!1,configurable:!0}),t.prototype.handleByStateName=function(e,i){ql(e,this)&&this.updateByState(i)},t.prototype.handleSearchResult=function(e){if(ql(e,this)){var i=vi(e,function(n){return n==null?void 0:n.isTarget});i.id===this.getMeta().id?this.updateByState(bt.HIGHLIGHT):this.updateByState(bt.SEARCH_RESULT)}},t.prototype.handleSelect=function(e){var i,n=(i=e==null?void 0:e[0])===null||i===void 0?void 0:i.type;switch(n){case ut.COL_CELL:this.changeRowColSelectState("colIndex");break;case ut.ROW_CELL:this.changeRowColSelectState("rowIndex");break;case ut.DATA_CELL:v9t(this.spreadsheet)?y9t(e,this,this.spreadsheet):ql(e,this)?this.updateByState(bt.SELECTED):this.spreadsheet.options.interaction.selectedCellsSpotlight&&this.updateByState(bt.UNSELECTED);break}},t.prototype.handleHover=function(e){var i=Mu(e);if(i.type!==ut.DATA_CELL){this.hideInteractionShape();return}var n=this.spreadsheet.interaction.getHoverHighlight(),a=n.currentRow,o=n.currentCol;if(a||o){var s=this.meta.colIndex,l=this.meta.rowIndex;o&&s===(i==null?void 0:i.colIndex)||a&&l===(i==null?void 0:i.rowIndex)?this.updateByState(bt.HOVER):this.hideInteractionShape()}var u=this.getMeta(),c=u.id,h=u.rowIndex,f=u.colIndex;Jr(i.id,c)&&Jr(i.rowIndex,h)&&Jr(i.colIndex,f)&&this.updateByState(bt.HOVER_FOCUS)},t.prototype.update=function(){var e=this.spreadsheet.interaction.getCurrentStateName(),i=this.spreadsheet.interaction.getCells();if(e===bt.ALL_SELECTED){this.updateByState(bt.SELECTED);return}if(!(st(i)||!e))switch(e){case bt.SELECTED:this.handleSelect(i);break;case bt.HOVER_FOCUS:case bt.HOVER:this.handleHover(i);break;case bt.SEARCH_RESULT:this.handleSearchResult(i);break;default:this.handleByStateName(i,e);break}},t.prototype.setMeta=function(e){r.prototype.setMeta.call(this,e),this.initCell()},t.prototype.drawTextShape=function(){r.prototype.drawTextShape.call(this),this.drawLinkField(this.meta)},t.prototype.initCell=function(){this.resetTextAndConditionIconShapes(),this.drawBackgroundShape(),this.drawInteractiveBgShape(),this.shouldHideRowSubtotalData()||(this.drawConditionIntervalShape(),this.drawTextShape(),this.drawConditionIconShapes()),this.drawInteractiveBorderShape(),this.meta.isFrozenCorner&&this.drawBorderShape(),this.update()},t.prototype.getDefaultTextFill=function(e){var i=e.fill,n=this.getBackgroundColor(),a=n.backgroundColor,o=n.intelligentReverseTextColor;return Uz(a)&&(i===rU||!W8t(a,i))&&o&&(i=jC),i},t.prototype.getTextStyle=function(){var e=this.meta.isTotals,i=e?this.theme.dataCell.bolderText:this.theme.dataCell.text,n=this.getTextConditionFill(U(U({},i),{fill:this.getDefaultTextFill(i)}));return U(U({},i),{fill:n})},t.prototype.getIconStyle=function(){return Kz(this.conditions,this.theme.dataCell.icon,this.meta.valueField)},t.prototype.drawConditionIntervalShape=function(){this.conditionIntervalShape=hUt(this)},t.prototype.shouldHideRowSubtotalData=function(){var e,i=this.meta,n=i.rowId,a=i.rowIndex,o=this.spreadsheet.store.get("drillDownIdPathMap");if(o!=null&&o.has(n))return!1;var s=((e=this.spreadsheet.options.totals)!==null&&e!==void 0?e:{}).row,l=s===void 0?{}:s,u=this.spreadsheet.facet.layoutResult.rowLeafNodes[a],c=!(u!=null&&u.isGrandTotals)&&(u==null?void 0:u.isTotals);return this.spreadsheet.options.hierarchyType==="tree"&&!l.showSubTotals&&c},t.prototype.getFormattedFieldValue=function(){var e;if(this.shouldHideRowSubtotalData())return{value:null,formattedValue:zy};var i=this.meta,n=i.rowId,a=i.valueField,o=i.fieldValue,s=i.data,l=i.id,u=(e=this.spreadsheet.dataSet.displayFormattedValueMap)===null||e===void 0?void 0:e.get(l),c=this.spreadsheet.dataSet.getFieldMeta(n),h=c?n:a,f=this.spreadsheet.dataSet.getFieldFormatter(h),d=u??f(o,s,this.meta);return{value:o,formattedValue:d}},t.prototype.getMaxTextWidth=function(){var e=this.getContentArea().width,i=this.getIconStyle();return rH(e,i)},t.prototype.getTextPosition=function(){return this.getTextAndIconPosition().text},t.prototype.getBackgroundColor=function(){var e,i=this.getCrossBackgroundColor(this.meta.rowIndex),n=i.backgroundColor,a=i.backgroundColorOpacity;if(this.shouldHideRowSubtotalData())return{backgroundColor:n,backgroundColorOpacity:a};var o=this.findFieldCondition((e=this.conditions)===null||e===void 0?void 0:e.background),s=!1;if(o&&o.mapping){var l=this.mappingValue(o);l&&(n=l.fill,s=l.intelligentReverseTextColor,a=1)}return{backgroundColor:n,backgroundColorOpacity:a,intelligentReverseTextColor:s}},t.prototype.drawBackgroundShape=function(){var e=this.getBackgroundColor(),i=e.backgroundColor,n=e.backgroundColorOpacity;this.backgroundShape=Sn(this,U(U({},this.getCellArea()),{fill:i,fillOpacity:n}))},t.prototype.drawInteractiveBorderShape=function(){var e=1,i=this.getCellArea(),n=i.x,a=i.y,o=i.height,s=i.width;this.stateShapes.set("interactiveBorderShape",Sn(this,{x:n+e,y:a+e,width:s-e*2,height:o-e*2},{capture:!1,visible:!1}))},t.prototype.drawInteractiveBgShape=function(){this.stateShapes.set("interactiveBgShape",Sn(this,U({},this.getCellArea()),{visible:!1}))},t.prototype.changeRowColSelectState=function(e){var i=this.spreadsheet.interaction,n=kt(this.meta,e),a=i.getState(),o=a.nodes,s=o===void 0?[]:o,l=a.cells,u=l===void 0?[]:l,c=!1;if(this.spreadsheet.isTableMode()&&s.length){var h=s[0].hierarchy.getLeaves();c=h.some(function(f,d){return s.some(function(v){return v===f})?d===n:!1})}else c=ft(ft([],rt(s),!1),rt(u),!1).some(function(f){return kt(f,e)===n});c?this.updateByState(bt.SELECTED):this.spreadsheet.options.interaction.selectedCellsSpotlight?this.updateByState(bt.UNSELECTED):this.hideInteractionShape()},t.prototype.drawBorderShape=function(){var e=this;[Tr.BOTTOM,Tr.RIGHT].forEach(function(i){var n=Lu(i,e.getCellArea(),e.getStyle().cell),a=n.position,o=n.style;qr(e,a,o)})},t.prototype.findFieldCondition=function(e){return qz(e,this.meta.valueField)},t.prototype.mappingValue=function(e){var i=this.meta.fieldValue,n=this.spreadsheet.isTableMode()?this.spreadsheet.dataSet.getCellData({query:{rowIndex:this.meta.rowIndex}}):this.meta.data;return e==null?void 0:e.mapping(i,n)},t.prototype.updateByState=function(e){if(r.prototype.updateByState.call(this,e,this),e===bt.UNSELECTED){var i=kt(this.theme,"".concat(this.cellType,".cell.interactionState.").concat(e));i&&this.toggleConditionIntervalShapeOpacity(i.opacity)}},t.prototype.clearUnselectedState=function(){r.prototype.clearUnselectedState.call(this),this.toggleConditionIntervalShapeOpacity(1)},t.prototype.toggleConditionIntervalShapeOpacity=function(e){Hn(this.conditionIntervalShape,mn.backgroundOpacity,e),Hn(this.conditionIconShapes,mn.opacity,e)},t.prototype.drawLeftBorder=function(){var e=Lu(Tr.LEFT,this.getCellArea(),this.getStyle().cell),i=e.position,n=e.style;qr(this,i,n)},t}(p_),_9t=function(r){yt(t,r);function t(e,i,n){return r.call(this,n,e,i)||this}return t.prototype.handleRestOptions=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=rt(e,1),a=n[0];this.cells=a},Object.defineProperty(t.prototype,"cellType",{get:function(){return ut.MERGED_CELL},enumerable:!1,configurable:!0}),t.prototype.update=function(){},t.prototype.initCell=function(){this.resetTextAndConditionIconShapes(),this.conditions=this.spreadsheet.options.conditions,this.drawBackgroundShape(),this.drawTextShape()},t.prototype.drawBackgroundShape=function(){var e=S9t(this.cells),i=this.theme.dataCell.cell;this.backgroundShape=iUt(this,{points:e,stroke:i.horizontalBorderColor,fill:i.backgroundColor,lineHeight:i.horizontalBorderWidth})},t.prototype.drawTextShape=function(){st(this.meta)||(Fe(this.meta.fieldValue)?EUt(this):r.prototype.drawTextShape.call(this))},t}(Cl),x9t=function(r,t,e,i){var n=[r,t],a=[r+e,t],o=[r+e,t+i],s=[r,t+i];return[[n,a],[a,o],[o,s],[s,n]]},C9t=function(r){var t=[];return $t(r,function(e){var i=[e[1],e[0]];JSON.stringify(r).includes(JSON.stringify(i))||t.push(e)}),t},E9t=function(r,t){return vi(t,function(e){return Jr(e[0],r[1])})},S9t=function(r){var t=[];r.forEach(function(o){var s=o.getMeta(),l=s.x,u=s.y,c=s.width,h=s.height;t=t.concat(x9t(l,u,c,h))}),t=C9t(t);for(var e=[],i=t[0],n=i,a=[];!Jr(i,a);)e=e.concat(n),a=E9t(n,t),n=a;return e},A9t=function(r,t){var e=[],i;return $t(r,function(n){var a,o,s,l=(o=(a=t==null?void 0:t.facet)===null||a===void 0?void 0:a.layoutResult)===null||o===void 0?void 0:o.getCellMeta(n.rowIndex,n.colIndex);if(l){var u=(s=t==null?void 0:t.facet)===null||s===void 0?void 0:s.cfg.dataCell(l);i=n!=null&&n.showText?l:i,e.push(u)}}),{cells:e,cellsMeta:i}},T9t=function(r,t){var e=[],i=[],n;return $t(r,function(a){var o=vi(t,function(s){var l,u=(l=s==null?void 0:s.getMeta)===null||l===void 0?void 0:l.call(s);if((u==null?void 0:u.colIndex)===(a==null?void 0:a.colIndex)&&(u==null?void 0:u.rowIndex)===(a==null?void 0:a.rowIndex))return s});o?(e.push(o),n=a!=null&&a.showText?o==null?void 0:o.getMeta():n):i.push(a)}),{cells:e,invisibleCellInfo:i,cellsMeta:n}},fH=function(r,t,e){var i;e===void 0&&(e=[]);var n=T9t(e,r),a=n.cellsMeta,o=n.cells,s=n.invisibleCellInfo,l=a,u=o,c=(s==null?void 0:s.length)>0&&s.length<e.length;if(c){var h=A9t(s,t),f=h.cells,d=h.cellsMeta;l=l||d,u=o.concat(f)}return!st(o)&&!l&&(l=(i=u[0])===null||i===void 0?void 0:i.getMeta()),{cells:u,viewMeta:l}},b9t=function(r){var t=r.interaction,e=t.getActiveCells(),i=[];return $t(e,function(n,a){var o=n.getMeta(),s=a===0?{showText:!0}:{};i.push(U(U({},s),{colIndex:o==null?void 0:o.colIndex,rowIndex:o==null?void 0:o.rowIndex}))}),i},dH=function(r,t,e){var i;return!((i=r.options)===null||i===void 0)&&i.mergedCell?r.options.mergedCell(r,t,e):new _9t(r,t,e)},w9t=function(r,t,e){var i,n=t||b9t(r);if((n==null?void 0:n.length)<=1){console.error("[mergeCell]: The merged cells must be more than one!");return}var a=r.interaction.getPanelGroupAllDataCells(),o=fH(a,r,n),s=o.cells,l=o.viewMeta;if(!st(s)){var u=((i=r.options)===null||i===void 0?void 0:i.mergedCellsInfo)||[];u.push(n),r.setOptions({mergedCellsInfo:u});var c=e?void 0:l;r.panelScrollGroup.addMergeCell(dH(r,s,c))}},R9t=function(r,t){var e=ue(r.cells,function(i){return{colIndex:i.getMeta().colIndex,rowIndex:i.getMeta().rowIndex}});return ys(t,function(i){var n=i.map(function(a){return a.showText?{colIndex:a.colIndex,rowIndex:a.rowIndex}:a});return!Jr(n,e)})},M9t=function(r,t){var e,i,n;if(!t||t.cellType!==ut.MERGED_CELL){console.error("[unmergeCell]: The ".concat(t," is not a MergedCell"));return}var a=R9t(t,(e=r.options)===null||e===void 0?void 0:e.mergedCellsInfo);(a==null?void 0:a.length)!==((n=(i=r.options)===null||i===void 0?void 0:i.mergedCellsInfo)===null||n===void 0?void 0:n.length)&&(r.setOptions({mergedCellsInfo:a}),t.remove(!0))},I9t=function(r){return ue(r,function(t){return{cells:t.cells,viewMeta:t.getMeta()}})},yF=function(r,t){return L9(r,t,function(e,i){return Jr(e.viewMeta.id,i.viewMeta.id)})},L9t=function(r,t){var e,i=(e=r.options)===null||e===void 0?void 0:e.mergedCellsInfo;if(!st(i)){var n=r.interaction.getPanelGroupAllDataCells();if(!st(n)){var a=[];i.forEach(function(c){var h=fH(n,r,c);h.cells.length>0&&a.push(h)});var o=t.getChildren(),s=I9t(o),l=yF(s,a),u=yF(a,s);$t(l,function(c){var h=vi(o,function(f){return Jr(f.getMeta().id,c.viewMeta.id)});h==null||h.remove(!0)}),$t(u,function(c){var h=c.cells,f=c.viewMeta;t.add(dH(r,h,f))})}}},vH=function(r){var t=r.includes(li)?"id":"field";return t},EE=function(r,t){t===void 0&&(t=[]);var e=r.getInitColumnLeafNodes();return Oa(t.map(function(i){var n=vH(i);return e.find(function(a){return a[n]===i})}))},O9t=function(r,t){if(t===void 0&&(t=[]),st(t))return{prev:null,next:null};var e=r.getInitColumnLeafNodes(),i=EE(r,t).map(function(l){return l==null?void 0:l.colIndex}),n=Math.max.apply(Math,ft([],rt(i),!1)),a=Math.min.apply(Math,ft([],rt(i),!1)),o=e.find(function(l){return l.colIndex===n+1}),s=e.find(function(l){return l.colIndex===a-1});return{prev:s||null,next:o||null}},P9t=function(r,t){if(st(t))return[];var e=Number.NEGATIVE_INFINITY;return r.reduce(function(i,n,a){if(!t.includes(n))return i;if(a===e+1){var o=Be(i);o.push(n)}else{var s=[n];i.push(s)}return e=a,i},[])},_F=function(r,t,e){t===void 0&&(t=[]),e===void 0&&(e=!1);var i=function(h,f){h===void 0&&(h=[]),f===void 0&&(f=[]),r.setOptions({interaction:{hiddenColumnFields:h}}),r.interaction.reset(),r.store.set("hiddenColumnsDetail",f),r.render(!1,{reBuildHiddenColumnsDetail:!1})};if(st(t)&&e){i();return}var n=r.store.get("hiddenColumnsDetail",[]),a=r.options.interaction.hiddenColumnFields;if(!(Jr(t,a)&&!e)){var o=Vo(ft(ft([],rt(t),!1),rt(a),!1)),s=EE(r,o).every(function(h,f,d){var v=d[f+1];return!v||Math.abs(h.colIndex-v.colIndex)===1}),l=O9t(r,s?o:t),u={hideColumnNodes:EE(r,t),displaySiblingNode:l},c=ft(ft([],rt(n),!1),[u],!1);r.emit(X.LAYOUT_COLS_HIDDEN,u,c),i(o,c)}},F9t=function(r){var t=r.dataCfg.fields.columns,e=t===void 0?[]:t;return r.isTableMode()?e:r.getInitColumnLeafNodes().map(function(i){var n=i.id;return n})},Qb=function(r,t,e){t===void 0&&(t=[]),e===void 0&&(e=!1),st(t)&&e&&_F(r,t,!0);var i=F9t(r),n=Zh(i),a=P9t(n,t);a.forEach(function(o){_F(r,o,e)})},B9t=function(r,t){var e=r.getColumnLeafNodes(),i=r.getInitColumnLeafNodes(),n=vH(t);return kt(Be(e),n)===t&&kt(Be(i),n)!==t},D9t=function(r){return(r==null?void 0:r.next)||(r==null?void 0:r.prev)},N9t=function(r){var t=D9t(r);return t==null?void 0:t.id},SE=function(r,t){return N9t(r)===t},uv=function(r){var t=r.type,e=r.id,i=r.theme,n=r.width,a=r.height,o=Fy(r,["type","id","theme","width","height"]),s=t===Jn.Horizontal?i.size:null,l=t===Jn.Vertical?i.size:null;return{fill:i.background,fillOpacity:i.backgroundOpacity,cursor:"".concat(t,"-resize"),width:s,height:l,appendInfo:U(U({},o),{isResizeArea:!0,type:t,id:e,width:n,height:a,size:i.size})}},dp=function(r,t){if(r.foregroundGroup){var e=r.foregroundGroup.findById(t);return e||r.foregroundGroup.addGroup({id:t,zIndex:Y2t})}},Jb=function(r,t,e){var i=e??{},n=i.scrollX,a=n===void 0?0:n,o=i.scrollY,s=o===void 0?0:o,l=!(r.x-a>t.x+t.width||r.x+r.width-a<t.x),u=!(r.y-s>t.y+t.height||r.y+r.height-s<t.y);return l&&u},k9t=function(r,t,e){if(!r)return!1;var i=r.iconNames,n=r.displayCondition,a=r.belongsCell;return st(i)||a!==e?!1:n?i.some(function(o){return n(t,o)}):!0},t2=function(r,t,e){var i=vi(r,function(a){return k9t(a,t,e)});if(i){var n=i.iconNames;return i.displayCondition&&(n=n.filter(function(a){return i.displayCondition(t,a)})),U(U({},i),{iconNames:n})}},pH=function(r,t){var e=r.label,i=r.field;return Jr(i,Kt)?{formattedValue:t||e,value:e}:{formattedValue:e,value:e}},qh=function(r){return iv(r)==="ASC"},e2=function(r){return iv(r)==="DESC"},xF=function(r){return!Q9(Number(r))},CF=function(r,t,e){var i=qh(t)?1:-1,n=["-",void 0];return r==null?void 0:r.sort(function(a,o){var s=a,l=o;if(e){if(s=a[e],l=o[e],xF(s)&&xF(l))return(Number(s)-Number(l))*i;if(s&&(n!=null&&n.includes(s==null?void 0:s.toString())))return-i;if(Number(s)&&(n!=null&&n.includes(l==null?void 0:l.toString())))return i}return!Or(s)&&!Or(l)?s.toString().localeCompare(l.toString(),"zh")*i:s?i:-i})},gH=function(r,t,e){return e?wUt(t,Vo(r)):ft([],rt(new Set(ft(ft([],rt(r),!1),rt(t),!1))),!1)},mH=function(r){var t=r.sortByValues,e=r.originValues,i=e.filter(function(s){return t.find(function(l){return Be(Db(s,li))===l})}),n=i.map(function(s){var l=s.split(li);if(l.length>1){var u=l.slice(0,l.length-1).join(li);return[u,l[l.length-1]]}return l}),a=Array.from(new Set(n.map(function(s){return s[0]})));n.sort(function(s,l){var u=s.slice(0,s.length-1),c=l.slice(0,l.length-1);if(u.join()!==c.join()){var h=a.indexOf(u[0]),f=a.indexOf(c[0]);return h-f}var d=t.indexOf(s[s.length-1]),v=t.indexOf(l[l.length-1]);return d-v});var o=n.map(function(s){return s.join(li)});return AUt(e,o)},U9t=function(r){var t=r.originValues,e=r.measureValues,i=r.sortParam,n=r.dataSet,a=i.sortFunc,o=i.sortFieldId,s=i.sortMethod,l=a(U({data:e},i));return l!=null&&l.length?(n.fields.rows.indexOf(o)>0||n.fields.columns.indexOf(o)>0)&&!wi(l[0],li)?mH({sortByValues:l,originValues:t}):gH(l,t,qh(s)):t},z9t=function(r){var t=r.sortParam,e=r.measureValues,i=r.originValues,n=r.dataSet,a=t.sortByMeasure,o=t.query,s=t.sortFieldId,l=t.sortMethod,u=n.fields,c=u.rows,h=u.columns,f=c.includes(s),d;if(a){var v=CF(e,l,a===So?o[Kt]:a);d=MUt(s,f?c:Zh(h),v)}else d=ue(CF(e,l));return gH(d,i,qh(l))},H9t=function(r){var t=r.sortParam,e=r.originValues,i=r.measureValues,n=r.dataSet,a=t.sortFunc,o=t.sortMethod,s=t.sortBy,l=e,u={originValues:e,measureValues:i,sortParam:t,dataSet:n};return a?l=U9t(u):s?l=mH({sortByValues:s,originValues:e}):(qh(o)||e2(o))&&(l=z9t(u)),l},$9t=function(r,t,e){var i,n={},a=wi(r,li);if(a)for(var o=Db(r,li),s=!((i=t==null?void 0:t.rows)===null||i===void 0)&&i.includes(e)?t.rows:Zh(t.columns),l=0;l<=a_(s,e);l++)n[s[l]]=o[l];else n[e]=r;return n},EF=function(r){return r.filter(function(t){return t!==Kt})},W9t=function(r){var t=r.dataSet,e=r.sortParam,i=r.originValues,n=t.fields,a=e.sortByMeasure,o=e.query,s=e.sortFieldId;if(a!==So){var l=t.getMultiData(o,{queryType:Yn.DetailOnly});return l}var u=t.getMultiData(o,{queryType:Yn.All}),c=Zh(n.columns),h=wi(n.rows,s),f=EF(h?n.rows:c),d=EF(h?c:n.rows),v=f[f.indexOf(s)+1],p=ar(o),g=d.filter(function(y){return!p.includes(y)}),m=u.filter(function(y){var _=new Set(Object.keys(y[NT]));if(!_.has(s)||_.has(v))return!1;var x=g.every(function(C){return!_.has(C)});return x});return st(m)?Oa(ue(i,function(y){var _=$9t(y,n,s);return t.getTotalValue(U(U({},o),_))})):m},V9t=function(r){var t=r.dataSet,e=r.sortParam,i=r.originValues,n=r.isSortByMeasure,a;return n?a=W9t(r):a=i,H9t({sortParam:e,originValues:i,measureValues:a,dataSet:t})},yH=function(r,t){if(r!=null&&r.sortMethod){if(qh(r==null?void 0:r.sortMethod))return"groupAsc";if(e2(r==null?void 0:r.sortMethod))return"groupDesc"}if(t)return"SortDown"},SF=function(r){var t,e,i=r.pivotMeta,n=r.dimensions,a=r.sortedDimensionValues,o=r.sortFieldId,s={children:i},l=[s];try{for(var u=ia(n),c=u.next();!c.done;c=u.next()){var h=c.value;if(h!==o)l=ap(l,function(f){return ft([],rt(f.children.values()),!1)});else{l.forEach(function(f){var d=ft([],rt(f.children.values()),!1),v=Ez(d,function(p){return a_(a,p.id)}).map(function(p){return[p.value,p]});f.children=new Map(v)});break}}}catch(f){t={error:f}}finally{try{c&&!c.done&&(e=u.return)&&e.call(u)}finally{if(t)throw t.error}}return s.children},r2=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.handleRestOptions=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=rt(e,1),a=n[0];this.headerConfig=U({},a);var o=this.meta,s=o.value,l=o.query,u=this.spreadsheet.dataCfg.sortParams,c=this.isSortCell(),h=vi(ft([],rt(u),!1).reverse(),function(d){return c&&(d==null?void 0:d.sortByMeasure)===s&&Jr(kt(d,"query"),l)}),f=yH(h,c);this.headerConfig.sortParam=U(U(U({},this.headerConfig.sortParam),h||{query:l}),{type:f})},t.prototype.initCell=function(){this.resetTextAndConditionIconShapes(),this.actionIcons=[],this.hasDefaultHiddenIcon=!1},t.prototype.getTreeIcon=function(){return this.treeIcon},t.prototype.getInteractiveBorderShapeStyle=function(e){var i=this.getCellArea(),n=i.x,a=i.y,o=i.height,s=i.width;return{x:n+e,y:a+e,width:s-e*2,height:o-e*2}},t.prototype.getFormattedFieldValue=function(){var e=this.meta,i=e.label,n=e.isTotalRoot,a=e.isGrandTotals,o=this.spreadsheet.dataSet.getFieldFormatter(this.meta.field),s=!0;this.spreadsheet.isTableMode()?s=!1:this.spreadsheet.isHierarchyTreeType()?s=!(a&&n):s=!n;var l=s&&o?o(i,void 0,this.meta):i;return{formattedValue:l,value:i}},t.prototype.getActionIconCfg=function(){return t2(this.spreadsheet.options.headerActionIcons,this.meta,this.cellType)},t.prototype.showSortIcon=function(){var e=this.spreadsheet,i=e.options,n=e.dataCfg,a=st(n.fields.values);if(i.showDefaultHeaderActionIcon&&!a){var o=this.headerConfig.sortParam,s=this.meta.query;return s&&Jr(o==null?void 0:o.query,s)&&(o==null?void 0:o.type)&&(o==null?void 0:o.type)!=="none"}return!1},t.prototype.getActionIconsCount=function(){if(this.showSortIcon())return 1;var e=this.getActionIconCfg();if(e){var i=e.iconNames;return i.length}return 0},t.prototype.getActionIconsWidth=function(){var e=this.getStyle().icon,i=e.size,n=e.margin;return(i+n.left)*this.getActionIconsCount()},t.prototype.drawSortIcons=function(){var e=this;if(this.showSortIcon()){var i=this.getStyle(),n=i.icon,a=i.text,o=this.getTextConditionFill(a),s=this.headerConfig.sortParam,l=this.getIconPosition(),u=new nv(U(U({name:kt(s,"type","none")},l),{width:n.size,height:n.size,fill:o}));u.on("click",function(c){e.spreadsheet.emit(X.GLOBAL_ACTION_ICON_CLICK,c),e.spreadsheet.handleGroupSort(c,e.meta)}),this.add(u),this.actionIcons.push(u)}},t.prototype.hasDefaultHideActionIcon=function(){return this.hasDefaultHiddenIcon},t.prototype.addActionIcon=function(e){var i=this,n=e.x,a=e.y,o=e.iconName,s=e.defaultHide,l=e.action,u=e.onClick,c=e.onHover,h=this.getStyle(),f=h.icon,d=h.text,v=this.getTextConditionFill(d),p=(f==null?void 0:f.fill)||v,g=new nv({name:o,x:n,y:a,width:f==null?void 0:f.size,height:f==null?void 0:f.size,fill:p});g.set("visible",!s),g.on("mouseover",function(m){i.spreadsheet.emit(X.GLOBAL_ACTION_ICON_HOVER,m),c==null||c({hovering:!0,iconName:o,meta:i.meta,event:m})}),g.on("mouseleave",function(m){i.spreadsheet.emit(X.GLOBAL_ACTION_ICON_HOVER_OFF,m),c==null||c({hovering:!1,iconName:o,meta:i.meta,event:m})}),g.on("click",function(m){var y;i.spreadsheet.emit(X.GLOBAL_ACTION_ICON_CLICK,m),(y=u||l)===null||y===void 0||y({iconName:o,meta:i.meta,event:m})}),this.actionIcons.push(g),this.add(g)},t.prototype.drawActionIcons=function(){var e=this;if(this.showSortIcon()){this.drawSortIcons();return}var i=this.getActionIconCfg();if(i){var n=i.iconNames,a=i.action,o=i.onClick,s=i.onHover,l=i.defaultHide,u=this.getIconPosition(n.length),c=this.getStyle().icon,h=c.size,f=c.margin;$t(n,function(d,v){var p=u.x+v*h+v*f.left,g=u.y,m=typeof l=="function"?l(e.meta,d):l;m&&(e.hasDefaultHiddenIcon=!0),e.addActionIcon({iconName:d,x:p,y:g,defaultHide:m,action:a,onClick:o,onHover:s})})}},t.prototype.drawBackgroundShape=function(){var e=this.getBackgroundColor(),i=e.backgroundColor,n=e.backgroundColorOpacity;this.backgroundShape=Sn(this,U(U({},this.getCellArea()),{fill:i,fillOpacity:n}))},t.prototype.isSortCell=function(){var e,i,n,a=(i=(e=this.spreadsheet)===null||e===void 0?void 0:e.isValueInCols)===null||i===void 0?void 0:i.call(e),o=this.meta.level===((n=this.meta.hierarchy)===null||n===void 0?void 0:n.maxLevel);return a?o&&this.cellType===ut.COL_CELL:o&&this.cellType===ut.ROW_CELL},t.prototype.handleByStateName=function(e,i){ql(e,this)&&this.updateByState(i)},t.prototype.handleSearchResult=function(e){if(ql(e,this)){var i=vi(e,function(n){return n==null?void 0:n.isTarget});i.id===this.getMeta().id?this.updateByState(bt.HIGHLIGHT):this.updateByState(bt.SEARCH_RESULT)}},t.prototype.handleHover=function(e){var i;ql(e,this)&&(this.updateByState(bt.HOVER),this.hasDefaultHideActionIcon()&&this.toggleActionIcon((i=e==null?void 0:e[0])===null||i===void 0?void 0:i.id))},t.prototype.handleSelect=function(e,i){ql(e,this)&&this.updateByState(bt.SELECTED);var n=ue(i,"id");wi(n,this.meta.id)&&this.updateByState(bt.SELECTED)},t.prototype.getTextStyle=function(){var e=this.getStyle(),i=e.text,n=e.bolderText,a=e.measureText,o;this.isMeasureField()?o=a||i:this.isBolderText()?o=n:o=i;var s=this.getTextConditionFill(o);return U(U({},o),{fill:s})},t.prototype.getBackgroundColor=function(){var e,i=((e=this.getStyle())===null||e===void 0?void 0:e.cell)||{},n=i.backgroundColor,a=i.backgroundColorOpacity;return this.getBackgroundColorByCondition(n,a)},t.prototype.getBackgroundColorByCondition=function(e,i){var n,a=e,o=this.findFieldCondition((n=this.conditions)===null||n===void 0?void 0:n.background);if(o&&o.mapping){var s=this.mappingValue(o);s&&(a=s.fill)}return{backgroundColor:a,backgroundColorOpacity:i}},t.prototype.toggleActionIcon=function(e){if(this.getMeta().id===e){var i=[];$t(this.actionIcons,function(n){n.get("visible")||(n.set("visible",!0),i.push(n))}),this.spreadsheet.store.set("visibleActionIcons",i)}},t.prototype.update=function(){var e=this.spreadsheet.interaction,i=e==null?void 0:e.getState(),n=e==null?void 0:e.getCells([ut.CORNER_CELL,ut.COL_CELL,ut.ROW_CELL]);if(Mu(n))switch(i==null?void 0:i.stateName){case bt.SELECTED:case bt.BRUSH_SELECTED:this.handleSelect(n,i==null?void 0:i.nodes);break;case bt.HOVER_FOCUS:case bt.HOVER:this.handleHover(n);break;case bt.SEARCH_RESULT:this.handleSearchResult(n);break;default:this.handleByStateName(n,i==null?void 0:i.stateName);break}},t.prototype.updateByState=function(e){r.prototype.updateByState.call(this,e,this)},t.prototype.hideInteractionShape=function(){r.prototype.hideInteractionShape.call(this)},t.prototype.isMeasureField=function(){return[Kt,V2t].includes(this.meta.field)},t.prototype.mappingValue=function(e){var i=this.getMeta().label;return e==null?void 0:e.mapping(i,this.meta)},t.prototype.findFieldCondition=function(e){var i=this;return r_(e,function(n){return n.field instanceof RegExp?n.field.test(i.meta.field):n.field===i.meta.field})},t}(p_),g_=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"cellType",{get:function(){return ut.COL_CELL},enumerable:!1,configurable:!0}),t.prototype.initCell=function(){r.prototype.initCell.call(this),this.drawBackgroundShape(),this.drawInteractiveBgShape(),this.drawInteractiveBorderShape(),this.drawTextShape(),this.drawConditionIconShapes(),this.drawActionIcons(),this.drawBorders(),this.drawResizeArea(),this.addExpandColumnIconShapes(),this.update()},t.prototype.drawInteractiveBgShape=function(){this.stateShapes.set("interactiveBgShape",Sn(this,U({},this.getCellArea()),{visible:!1}))},t.prototype.drawInteractiveBorderShape=function(){var e=2;this.stateShapes.set("interactiveBorderShape",Sn(this,this.getInteractiveBorderShapeStyle(e),{visible:!1}))},t.prototype.getMaxTextWidth=function(){var e=this.getContentArea().width;return e-this.getActionIconsWidth()},t.prototype.getIconPosition=function(){if(this.meta.isLeaf)return r.prototype.getIconPosition.call(this,this.getActionIconsCount());var e=this.getIconStyle(),i=e.margin.left,n=this.getTextStyle(),a=this.textPosition,o=a==null?void 0:a.x,s=(a==null?void 0:a.y)-e.size/2;return n.textAlign==="left"?{x:o+this.actualTextWidth+i,y:s}:n.textAlign==="right"?{x:o+i,y:s}:{x:o+this.actualTextWidth/2+i,y:s}},t.prototype.isBolderText=function(){var e=this.meta,i=e.isLeaf,n=e.isTotals;return!!(n||!i)},t.prototype.getTextPosition=function(){var e,i=this.meta.isLeaf,n=this.headerConfig,a=n.width,o=n.scrollContainsRowHeader,s=n.cornerWidth,l=n.scrollX,u=this.getTextStyle(),c=this.getContentArea(),h=this.getIconStyle();if(i)return hp(c,u,this.actualTextWidth,h,this.getActionIconsCount()).text;var f={start:l-(o?s:0),width:a+(o?s:0)},d=this.getTextStyle().textAlign,v=gUt(f,d,(e=this.getStyle().cell)===null||e===void 0?void 0:e.padding),p=this.getActionIconsWidth(),g=this.actualTextWidth+p,m=pUt(v,{start:c.x,width:c.width},g),y=mUt(m,this.actualTextWidth,p,d),_=c.y+c.height/2;return this.textPosition={x:y,y:_},this.textPosition},t.prototype.getActionIconsWidth=function(){var e=this.getStyle().icon,i=e.size,n=e.margin,a=this.getActionIconsCount();return(i+n.left)*a+(a>0?n.right:0)},t.prototype.getColResizeAreaKey=function(){return this.meta.key},t.prototype.getColResizeArea=function(){return dp(this.spreadsheet,Kk)},t.prototype.getHorizontalResizeAreaName=function(){return"".concat(Jk).concat(this.meta.key)},t.prototype.drawHorizontalResizeArea=function(){var e,i,n=((i=(e=this.spreadsheet.options.style)===null||e===void 0?void 0:e.colCfg)===null||i===void 0?void 0:i.height)===0;if(!(n||!this.shouldDrawResizeAreaByType("colCellVertical",this))){var a=this.headerConfig,o=a.cornerWidth,s=a.viewportWidth,l=this.meta,u=l.y,c=l.height,h=this.getResizeAreaStyle(),f=this.getColResizeArea(),d=this.getHorizontalResizeAreaName(),v=f.find(function(g){return g.attrs.name===d});if(!v){var p=o+s;f.addShape("rect",{attrs:U(U({},uv({theme:h,type:Jn.Vertical,id:this.getColResizeAreaKey(),effect:Ei.Field,offsetX:0,offsetY:u,width:p,height:c,meta:this.meta})),{name:d,x:0,y:u+c-h.size/2,width:p})})}}},t.prototype.shouldAddVerticalResizeArea=function(){var e=this.meta,i=e.x,n=e.y,a=e.width,o=e.height,s=this.headerConfig,l=s.scrollX,u=s.scrollY,c=s.scrollContainsRowHeader,h=s.cornerWidth,f=s.height,d=s.width,v=this.getResizeAreaStyle(),p={x:i+a-v.size/2,y:n,width:v.size,height:o},g={x:c?-h:0,y:0,width:c?h+d:d,height:f};return Jb(p,g,{scrollX:l,scrollY:u})},t.prototype.getVerticalResizeAreaOffset=function(){var e=this.meta,i=e.x,n=e.y,a=this.headerConfig,o=a.scrollX,s=a.position;return{x:s.x+i-o,y:s.y+n}},t.prototype.drawVerticalResizeArea=function(){if(!(!this.meta.isLeaf||!this.shouldDrawResizeAreaByType("colCellHorizontal",this))){var e=this.meta,i=e.label,n=e.width,a=e.height,o=this.getResizeAreaStyle(),s=this.getColResizeArea();if(this.shouldAddVerticalResizeArea()){var l=this.getVerticalResizeAreaOffset(),u=l.x,c=l.y;s.addShape("rect",{attrs:U(U({},uv({theme:o,type:Jn.Horizontal,effect:Ei.Cell,id:i,offsetX:u,offsetY:c,width:n,height:a,meta:this.meta})),{x:u+n-o.size/2,y:c,height:a})})}}},t.prototype.drawResizeArea=function(){this.drawHorizontalResizeArea(),this.drawVerticalResizeArea()},t.prototype.drawHorizontalBorder=function(){var e=Lu(Tr.TOP,this.meta,this.theme.colCell.cell),i=e.position,n=e.style;qr(this,i,n)},t.prototype.drawVerticalBorder=function(e){var i=Lu(e,this.meta,this.theme.colCell.cell),n=i.position,a=i.style;qr(this,n,a)},t.prototype.drawBorders=function(){var e=this.spreadsheet,i=e.options,n=e.isTableMode;this.meta.colIndex===0&&n()&&!i.showSeriesNumber&&this.drawVerticalBorder(Tr.LEFT),this.drawHorizontalBorder(),this.drawVerticalBorder(Tr.RIGHT)},t.prototype.hasHiddenColumnCell=function(){var e=this,i=this.spreadsheet.options,n=i.interaction.hiddenColumnFields,a=n===void 0?[]:n,o=i.tooltip.operation,s=this.spreadsheet.store.get("hiddenColumnsDetail",[]);return st(s)||st(a)||!o.hiddenColumns?!1:!!s.find(function(l){return SE(l==null?void 0:l.displaySiblingNode,e.meta.id)})},t.prototype.getExpandIconTheme=function(){var e=this.getStyle();return e.icon},t.prototype.addExpandColumnSplitLine=function(){var e=this.meta,i=e.x,n=e.y,a=e.width,o=e.height,s=this.theme.splitLine,l=s.horizontalBorderColor,u=s.horizontalBorderWidth,c=s.horizontalBorderColorOpacity,h=s.borderDash,f=this.isLastColumn()?i+a-u:i;qr(this,{x1:f,y1:n,x2:f,y2:n+o},{stroke:l,lineWidth:u,strokeOpacity:c,lineDash:h})},t.prototype.addExpandColumnIconShapes=function(){this.hasHiddenColumnCell()&&(this.addExpandColumnSplitLine(),this.addExpandColumnIcons())},t.prototype.addExpandColumnIcons=function(){var e=this.isLastColumn();this.addExpandColumnIcon(e),this.isAllDisplaySiblingNodeHidden()&&e&&this.addExpandColumnIcon(!1)},t.prototype.addExpandColumnIcon=function(e){var i=this,n=this.getExpandColumnIconConfig(e),a=jb(this,U(U({},n),{name:"ExpandColIcon",cursor:"pointer"}));a.on("click",function(){i.spreadsheet.emit(X.LAYOUT_COLS_EXPANDED,i.meta)})},t.prototype.getExpandColumnIconConfig=function(e){var i=this.getExpandIconTheme().size,n=this.getCellArea(),a=n.x,o=n.y,s=n.width,l=n.height,u=a-i,c=e?u+s:u,h=o+l/2-i/2;return{x:c,y:h,width:i*2,height:i}},t.prototype.isLastColumn=function(){return B9t(this.spreadsheet,this.meta.id)},t.prototype.isAllDisplaySiblingNodeHidden=function(){var e=this.meta.id,i=this.spreadsheet.store.get("hiddenColumnsDetail",[]),n=i.find(function(o){var s,l=o.displaySiblingNode;return((s=l==null?void 0:l.next)===null||s===void 0?void 0:s.id)===e}),a=i.find(function(o){var s,l=o.displaySiblingNode;return((s=l==null?void 0:l.prev)===null||s===void 0?void 0:s.id)===e});return a&&n},t}(r2),G9t=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.isBolderText=function(){var e=this.meta.cornerType;return e===Ea.Col},Object.defineProperty(t.prototype,"cellType",{get:function(){return ut.CORNER_CELL},enumerable:!1,configurable:!0}),t.prototype.initCell=function(){r.prototype.initCell.call(this),this.resetTextAndConditionIconShapes(),this.drawBackgroundShape(),this.drawTreeIcon(),this.drawCellText(),this.drawConditionIconShapes(),this.drawActionIcons(),this.drawBorderShape(),this.drawResizeArea(),this.update()},t.prototype.drawCellText=function(){this.drawTextShape()},t.prototype.drawTextShape=function(){var e=this.getContentArea().x,i=this.getCellArea(),n=i.y,a=i.height,o=this.getTextStyle(),s=this.getCornerText(),l=this.getMaxTextWidth(),u=qu(this.meta,this.spreadsheet.options.placeholder),c=this.spreadsheet.measureTextWidth,h=Ch({measureTextWidth:c,text:s,maxWidth:l,fontParam:o,placeholder:u});this.actualText=h;var f=h.indexOf(zc),d=h,v="";if(f!==-1&&this.spreadsheet.isHierarchyTreeType()){var p=f+(dkt()?1:0);d=s.substr(0,p),v=s.slice(p),v=Ch({measureTextWidth:c,text:v,maxWidth:l,fontParam:o})}var g=vUt({x:e+this.getTreeIconWidth(),y:n,width:l,height:a},o).x,m=n+(st(v)?a/2:a/4);this.addTextShape(Iu(this,[this.textShapes[0]],g,m,d,o)),st(v)||this.addTextShape(Iu(this,[this.textShapes[1]],g,n+a*.75,v,o)),this.actualTextWidth=yh([c(d,o),c(v,o)])},t.prototype.drawTreeIcon=function(){var e=this;if(!(!this.showTreeIcon()||this.meta.cornerType===Ea.Col)){var i=this.headerConfig.hierarchyCollapse,n=this.getStyle().icon.size,a=this.getTextStyle(),o=a.textBaseline,s=a.fill,l=this.getContentArea();this.treeIcon=Jz(this,{x:l.x,y:wm(l,o,n),width:n,height:n},s,i,function(){e.headerConfig.spreadsheet.store.set("scrollY",0),e.headerConfig.spreadsheet.emit(X.LAYOUT_TREE_ROWS_COLLAPSE_ALL,i)})}},t.prototype.drawBorderShape=function(){var e=this;[Tr.TOP,Tr.LEFT].forEach(function(i){var n=Lu(i,e.getCellArea(),e.getStyle().cell),a=n.position,o=n.style;qr(e,a,o)})},t.prototype.isLastRowCornerCell=function(){var e=this.meta,i=e.cornerType,n=e.field,a=this.headerConfig.rows;return i===Ea.Row&&(this.spreadsheet.isHierarchyTreeType()||Be(a)===n)},t.prototype.getResizeAreaEffect=function(){var e=this.meta.cornerType;return e===Ea.Series?Ei.Series:this.isLastRowCornerCell()&&this.spreadsheet.isHierarchyTreeType()?Ei.Tree:Ei.Field},t.prototype.drawResizeArea=function(){if(this.shouldDrawResizeAreaByType("cornerCellHorizontal",this)){var e=this.getResizeAreaStyle(),i=dp(this.spreadsheet,XC),n=this.headerConfig,a=n.position,o=n.scrollX,s=n.scrollY,l=n.width,u=n.height,c=this.meta,h=c.x,f=c.y,d=c.width,v=c.height,p=c.field,g=c.cornerType,m={x:h+d-e.size/2,y:f,width:e.size,height:v},y={x:0,y:0,width:l,height:u};if(!(g===Ea.Col||!Jb(m,y,{scrollX:o,scrollY:s}))){var _=a.x+h-o,x=a.y+(this.isLastRowCornerCell()?0:f);i.addShape("rect",{attrs:U(U({},uv({theme:e,id:p,type:Jn.Horizontal,effect:this.getResizeAreaEffect(),offsetX:_,offsetY:x,width:d,height:v,meta:this.meta})),{x:_+d-e.size/2,y:x,height:this.isLastRowCornerCell()?u:v})})}}},t.prototype.showTreeIcon=function(){var e;return this.spreadsheet.isHierarchyTreeType()&&((e=this.meta)===null||e===void 0?void 0:e.x)===0},t.prototype.getIconPosition=function(){var e,i,n=(i=(e=this.textShapes)===null||e===void 0?void 0:e[0])===null||i===void 0?void 0:i.cfg.attrs,a=this.getTextStyle(),o=a.textBaseline,s=a.textAlign,l=this.getStyle().icon,u=l.size,c=l.margin,h=(n==null?void 0:n.x)+E9([[lE("center"),$c(this.actualTextWidth/2)],[lE("right"),$c(0)],[Az,$c(this.actualTextWidth)]])(s)+c.left,f=wm(this.getContentArea(),o,u);return{x:h,y:f}},t.prototype.getTreeIconWidth=function(){var e=this.getStyle().icon,i=e.size,n=e.margin;return this.showTreeIcon()?i+n.right:0},t.prototype.getTextStyle=function(){var e=this.getStyle(),i=e.text,n=e.bolderText,a=this.isBolderText()?i:n,o=this.getTextConditionFill(a);return U(U({},a),{fill:o})},t.prototype.getMaxTextWidth=function(){var e=this.getContentArea().width;return e-this.getTreeIconWidth()-this.getActionIconsWidth()},t.prototype.getTextPosition=function(){return{x:0,y:0}},t.prototype.getFormattedFieldValue=function(){return pH(this.meta,this.spreadsheet.dataSet.getFieldName(this.meta.label))},t.prototype.getCornerText=function(){var e=this.getFormattedFieldValue().formattedValue;return e},t}(r2),X9t=function(r,t,e,i){var n,a,o=kt(i,"size"),s=kt(i,"margin"),l=0;return r.options.showDefaultHeaderActionIcon?l=1:l=(a=(n=t2(r.options.headerActionIcons,t,e))===null||n===void 0?void 0:n.iconNames.length)!==null&&a!==void 0?a:0,l*(o+s.left)+(l>0?s.right:0)},_H=function(r,t,e){var i,n,a=((i=e.icon.margin)===null||i===void 0?void 0:i.left)||0,o=((n=e.icon.margin)===null||n===void 0?void 0:n.right)||0,s=r.store.get("hiddenColumnsDetail",[]),l=!1,u=!1;s.forEach(function(h){var f,d,v,p;((d=(f=h==null?void 0:h.displaySiblingNode)===null||f===void 0?void 0:f.prev)===null||d===void 0?void 0:d.field)===t&&(l=!0),((p=(v=h==null?void 0:h.displaySiblingNode)===null||v===void 0?void 0:v.next)===null||p===void 0?void 0:p.field)===t&&(u=!0)});var c=kt(e,"icon.size");return{left:u?c+o:0,right:l?c+a:0}},Y9t=function(r,t,e){var i=kt(e,"cell.padding"),n=_H(r,t.field,e);return i.left+i.right+X9t(r,t,ut.COL_CELL,kt(e,"icon"))+n.left+n.right},xH=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.handleRestOptions=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=rt(e,1),a=n[0];this.headerConfig=U({},a);var o=this.meta.field,s=this.spreadsheet.dataCfg.sortParams,l=vi(s,function(c){return(c==null?void 0:c.sortFieldId)===o}),u=yH(l,!0);this.headerConfig.sortParam=U(U(U({},this.headerConfig.sortParam),l||{}),{type:u})},t.prototype.isFrozenCell=function(){var e=this.spreadsheet.options,i=e.frozenColCount,n=e.frozenTrailingColCount,a=this.spreadsheet.facet.layoutResult.colNodes.filter(function(s){return ho(s)}),o=qkt(this.meta).colIndex;return su(o,i)||lu(o,n,a.length)},t.prototype.getFormattedFieldValue=function(){return pH(this.meta,this.spreadsheet.dataSet.getFieldName(this.meta.label))},t.prototype.shouldAddVerticalResizeArea=function(){return this.isFrozenCell()?!0:r.prototype.shouldAddVerticalResizeArea.call(this)},t.prototype.getVerticalResizeAreaOffset=function(){var e=this.meta,i=e.x,n=e.y,a=this.headerConfig,o=a.scrollX,s=a.position;return this.isFrozenCell()?{x:i,y:n}:{x:s.x+i-o,y:s.y+n}},t.prototype.getColResizeArea=function(){var e=this.isFrozenCell();return e?dp(this.spreadsheet,Qk):r.prototype.getColResizeArea.call(this)},t.prototype.isSortCell=function(){return!0},t.prototype.showSortIcon=function(){return this.spreadsheet.options.showDefaultHeaderActionIcon},t.prototype.getTextStyle=function(){var e=this.getStyle();return e==null?void 0:e.bolderText},t.prototype.getContentArea=function(){var e,i=(((e=this.getStyle())===null||e===void 0?void 0:e.cell)||this.theme.dataCell.cell).padding,n=U({},i),a=_H(this.spreadsheet,this.meta.field,this.getStyle());return a.left&&(n.left=(n.left||0)+a.left),a.right&&(n.right=(n.right||0)+a.right),eH(this.getCellArea(),n)},t.prototype.getHorizontalResizeAreaName=function(){return"".concat(Jk).concat("table-col-cell")},t.prototype.drawBackgroundShape=function(){var e=this.getStyle().cell.backgroundColor;this.backgroundShape=Sn(this,U(U({},this.getCellArea()),{fill:e}))},t}(g_),j9t=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getStyle=function(e){return e?this.theme[e]:kt(this,"theme.cornerCell")},t.prototype.showSortIcon=function(){return!1},t.prototype.drawLeftBorder=function(){var e=Lu(Tr.LEFT,this.getCellArea(),this.getStyle().cell),i=e.position,n=e.style;qr(this,i,n)},t.prototype.drawBorders=function(){r.prototype.drawBorders.call(this),this.meta.colIndex===0&&this.drawLeftBorder()},t}(xH),m_=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getLinkFieldStyle=function(){return this.theme.rowCell.text.linkTextFill},t.prototype.drawBorderShape=function(){r.prototype.drawBorderShape.call(this),this.meta.colIndex===0&&this.drawLeftBorder()},t.prototype.shouldDrawResizeArea=function(){return this.meta.colIndex===0},t.prototype.drawResizeArea=function(){if(this.shouldDrawResizeArea()){var e=this.getCellArea(),i=e.x,n=e.y,a=e.width,o=e.height,s=this.meta.rowIndex,l=this.getResizeAreaStyle(),u=this.spreadsheet.options,c=u.frozenRowCount,h=u.frozenTrailingRowCount,f=this.spreadsheet.facet.getCellRange(),d=d_(s,f.start,c),v=cp(s,f.end,h),p=d||v,g=p?qk:ph,m=dp(this.spreadsheet,g),y=this.spreadsheet.facet.layoutResult.colsHierarchy.height,_=this.spreadsheet.facet.getScrollOffset().scrollY,x=this.spreadsheet.facet.getPaginationScrollY(),C=_+x,A=n+(v?0:y);v||(A-=d?x:C),m.addShape("rect",{attrs:U(U({},uv({id:String(this.meta.rowIndex),theme:l,type:Jn.Vertical,effect:Ei.Cell,offsetX:i,offsetY:A,width:a,height:o,meta:this.meta})),{x:i,y:A+o-l.size/2,width:a})})}},t}(Cl),CH=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"cellType",{get:function(){return ut.ROW_CELL},enumerable:!1,configurable:!0}),t.prototype.getTextStyle=function(){return this.theme.rowCell.seriesText},t}(m_),y_=function(){function r(t){this.EVENT="gesture",this.gm=t}return r.prototype.do=function(t){var e=t.type;switch(e){case"touchstart":this.onTouchStart(t);break;case"touchmove":this.onTouchMove(t);break;case"touchend":this.onTouchEnd(t);break;case"touchcancel":this.onTouchCancel(t);break;default:return}},r.prototype.emit=function(t){this.gm.emit(this.EVENT,t)},r}(),Z9t=function(r){yt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.EVENT="pan",e}return t.prototype.onTouchCancel=function(e){},t.prototype.onTouchEnd=function(e){},t.prototype.onTouchMove=function(e){var i=e.x,n=e.y,a=i-this.preX,o=n-this.preY;this.preX=i,this.preY=n,this.emit({x:i,y:n,deltaX:a,deltaY:o,event:e})},t.prototype.onTouchStart=function(e){var i=e.x,n=e.y;this.preX=i,this.preY=n},t}(y_),Zs=typeof performance=="object"&&performance.now?performance:Date,q9t=300,AF=10,K9t=function(r){yt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.EVENT="press",e}return t.prototype.onTouchCancel=function(e){this.clearTimeout()},t.prototype.onTouchEnd=function(e){this.clearTimeout()},t.prototype.onTouchMove=function(e){var i=e.x,n=e.y;(i-this.touchStartX>AF||n-this.touchStartY>AF)&&this.clearTimeout()},t.prototype.onTouchStart=function(e){var i=this;this.clearTimeout();var n=e.x,a=e.y;this.touchStartTime=Zs.now(),this.touchStartX=n,this.touchStartY=a,this.pressTimeout=window.setTimeout(function(){i.emit({x:n,y:a,event:e})},q9t)},t.prototype.clearTimeout=function(){window.clearTimeout(this.pressTimeout)},t}(y_),Q9t=100,J9t=function(r){yt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.EVENT="swipe",e.latestMoveTime=0,e.ms=0,e.speedX=0,e.speedY=0,e.preX=0,e.preY=0,e}return t.prototype.onTouchCancel=function(e){},t.prototype.onTouchEnd=function(e){var i=this.speedX,n=this.speedY;if(Zs.now()-this.latestMoveTime<Q9t){var a=e.x,o=e.y;this.emit({x:a,y:o,speedX:i,speedY:n,event:e})}},t.prototype.onTouchMove=function(e){var i=e.x,n=e.y,a=Zs.now(),o=i-this.preX,s=n-this.preY,l=a-this.ms;this.speedX=o/l,this.speedY=s/l,this.latestMoveTime=a},t.prototype.onTouchStart=function(e){var i=e.x,n=e.y;this.speedX=this.speedY=0,this.preX=i,this.preY=n,this.ms=Zs.now()},t}(y_),tzt=300,TF=2,ezt=function(r){yt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.EVENT="tap",e}return t.prototype.onTouchCancel=function(e){},t.prototype.onTouchEnd=function(e){var i=e.x,n=e.y;i-this.touchStartX<TF&&n-this.touchStartY<TF&&Zs.now()-this.touchStartTime<tzt&&this.emit({x:i,y:n,event:e})},t.prototype.onTouchMove=function(e){},t.prototype.onTouchStart=function(e){var i=e.x,n=e.y;this.touchStartTime=Zs.now(),this.touchStartX=i,this.touchStartY=n},t}(y_),rzt={Pan:Z9t,Press:K9t,Swipe:J9t,Tap:ezt},izt=function(r){return rzt[r]},EH=function(r){yt(t,r);function t(e,i){i===void 0&&(i={});var n=r.call(this)||this;return n.onTouchStart=function(a){n.preventEvent(a),n.element.on("touchmove",n.onTouchMove),n.element.on("touchend",n.onTouchEnd),n.element.on("touchcancel",n.onTouchCancel),n.emit("touchdown",a),n.doGestures(a)},n.onTouchMove=function(a){n.preventEvent(a),n.emit("touchmove",a),n.doGestures(a)},n.onTouchEnd=function(a){n.preventEvent(a),n.emit("touchend",a),n.element.off("touchmove",n.onTouchMove),n.element.off("touchend",n.onTouchEnd),n.element.off("touchcancel",n.onTouchCancel),n.doGestures(a)},n.onTouchCancel=function(a){n.preventEvent(a),n.emit("touchcancel",a),n.element.off("touchmove",n.onTouchMove),n.element.off("touchend",n.onTouchEnd),n.element.off("touchcancel",n.onTouchCancel),n.doGestures(a)},n.element=e,n.options=i,n.initialGestures(),n.bindTouchStart(),n}return t.prototype.destroy=function(){this.element.off("touchstart",this.onTouchStart),this.off()},t.prototype.initialGestures=function(){var e=this,i=this.options.gestures||["Pan","Press","Swipe","Tap"];this.gestures=i.map(function(n){var a=izt(n);return new a(e)})},t.prototype.bindTouchStart=function(){this.element.on("touchstart",this.onTouchStart)},t.prototype.preventEvent=function(e){var i=e.type,n=this.options.prevents||[];n.includes(i)&&e.preventDefault()},t.prototype.doGestures=function(e){this.gestures.forEach(function(i){i.do(e)})},t}(Dy),nzt=mk,azt=800,ozt="swipe",szt="pan",bF="wheel",lzt=function(r){yt(t,r);function t(e){var i=r.call(this)||this;return i.rafMs=0,i.onPan=function(n){i.raf&&cancelAnimationFrame(i.raf);var a=n.deltaX,o=n.deltaY,s=i.getWrapperEvent(n,a,o);i.emit(bF,s)},i.onSwipe=function(n){var a=n.speedX,o=n.speedY;i.rafMs=Zs.now(),i.ms=i.rafMs,(a!==0||o!==0)&&i.rafInertia(n)},i.element=e,i.gm=new EH(e,{gestures:["Pan","Swipe"]}),i.gm.on(ozt,i.onSwipe),i.gm.on(szt,i.onPan),i}return t.prototype.destroy=function(){window.cancelAnimationFrame(this.raf),this.gm.destroy(),this.off()},t.prototype.rafInertia=function(e){var i=this,n=e.speedX,a=e.speedY;this.raf=window.requestAnimationFrame(function(){var o=Zs.now(),s=(o-i.ms)/azt;if(s<1){s=nzt(1-s);var l=o-i.rafMs,u=n*s*l,c=a*s*l,h=i.getWrapperEvent(e,u,c);i.emit(bF,h),i.rafMs=o,i.rafInertia(e)}})},t.prototype.getWrapperEvent=function(e,i,n){return U(U({},e),{deltaX:-i,deltaY:-n})},t}(Dy),uzt=function(r){var t=0,e=r.children;return e==null||e.forEach(function(i){t+=i.height||0}),t},SH=function(r,t,e,i,n){var a=0,o=r+(t-n)/2,s=r+(t+n)/2,l=e+i;return r+n>=l?a=r:l<s?a=e+i-n:e>o?r+t-e>n?a=e:a=r+t-n:a=r+(t-n)/2,a},czt=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"cellType",{get:function(){return ut.ROW_CELL},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){var e;r.prototype.destroy.call(this),(e=this.gm)===null||e===void 0||e.destroy()},t.prototype.initCell=function(){r.prototype.initCell.call(this),this.drawBackgroundShape(),this.drawInteractiveBgShape(),this.drawInteractiveBorderShape(),this.drawTextShape(),this.drawConditionIconShapes(),this.drawTreeIcon(),this.drawTreeLeafNodeAlignDot(),this.drawRectBorder(),this.drawResizeAreaInLeaf(),this.drawActionIcons(),this.update()},t.prototype.getBackgroundColor=function(){var e=this.getCrossBackgroundColor(this.meta.rowIndex),i=e.backgroundColor,n=e.backgroundColorOpacity;return this.getBackgroundColorByCondition(i,n)},t.prototype.drawInteractiveBorderShape=function(){var e=2;this.stateShapes.set("interactiveBorderShape",Sn(this,this.getInteractiveBorderShapeStyle(e),{visible:!1}))},t.prototype.drawInteractiveBgShape=function(){this.stateShapes.set("interactiveBgShape",Sn(this,U({},this.getCellArea()),{visible:!1}))},t.prototype.showTreeIcon=function(){return this.spreadsheet.isHierarchyTreeType()&&!this.meta.isLeaf},t.prototype.showTreeLeafNodeAlignDot=function(){var e;return((e=this.spreadsheet.options.style)===null||e===void 0?void 0:e.showTreeLeafNodeAlignDot)&&this.spreadsheet.isHierarchyTreeType()},t.prototype.getParentTreeIconCfg=function(){if(!(!this.showTreeLeafNodeAlignDot()||!this.spreadsheet.isHierarchyTreeType()||!this.meta.isLeaf))return kt(this.meta,"parent.belongsCell.treeIcon.cfg")},t.prototype.drawTreeIcon=function(){var e=this;if(this.showTreeIcon()){var i=this.meta,n=i.isCollapsed,a=i.id,o=i.hierarchy,s=this.getContentArea().x,l=this.getTextStyle().fill,u=this.getStyle().icon.size,c=this.getContentIndent(),h=s+c,f=this.getIconYPosition();this.treeIcon=Jz(this,{x:h,y:f,width:u,height:u},l,n,function(){if(!Nr()){if(!n){var d=e.spreadsheet.store.get("scrollY"),v=e.headerConfig.viewportHeight||0,p=uzt(e.meta),g=o.height-p;if(d>0&&d+v>g){var m=g-v;e.spreadsheet.store.set("scrollY",m>0?m:0)}}e.spreadsheet.emit(X.ROW_CELL_COLLAPSE_TREE_ROWS,{id:a,isCollapsed:!n,node:e.meta})}}),Nr()&&(this.gm=new EH(this,{gestures:["Tap"]}),this.gm.on("tap",function(){e.spreadsheet.emit(X.ROW_CELL_COLLAPSE_TREE_ROWS,{id:a,isCollapsed:!n,node:e.meta})}))}},t.prototype.drawTreeLeafNodeAlignDot=function(){var e=this.getParentTreeIconCfg();if(e){var i=this.getStyle().icon,n=i.size,a=i.margin,o=e.x+n+a.right,s=this.getTextPosition().y,l=this.getTextStyle(),u=l.fill,c=l.fontSize,h=n/5;this.treeLeafNodeAlignDot=Qz(this,{x:o+n/2,y:s+(c-h)/2,r:h,fill:u,fillOpacity:.3})}},t.prototype.isBolderText=function(){var e=this.meta,i=e.isLeaf,n=e.isTotals,a=e.level;return!i&&a===0||n},t.prototype.drawTextShape=function(){r.prototype.drawTextShape.call(this),this.drawLinkField(this.meta)},t.prototype.drawRectBorder=function(){var e=this,i=this.getCellArea().x,n=this.getContentIndent(),a=this.spreadsheet.isHierarchyTreeType()?i:i+n;[Tr.BOTTOM,Tr.LEFT].forEach(function(o){var s=Lu(o,U(U({},e.getCellArea()),{x:a}),e.getStyle().cell),l=s.position,u=s.style;qr(e,l,u)})},t.prototype.getResizeClipAreaBBox=function(){var e=this.headerConfig,i=e.width,n=e.viewportHeight;return{x:0,y:0,width:i,height:n}},t.prototype.drawResizeAreaInLeaf=function(){if(!(!this.meta.isLeaf||!this.shouldDrawResizeAreaByType("rowCellVertical",this))){var e=this.getCellArea(),i=e.x,n=e.y,a=e.width,o=e.height,s=this.getResizeAreaStyle(),l=dp(this.spreadsheet,ph),u=this.headerConfig,c=u.position,h=u.seriesNumberWidth,f=u.width,d=u.scrollX,v=u.scrollY,p={x:i+h,y:n+o-s.size/2,width:a,height:s.size},g=this.getResizeClipAreaBBox();if(Jb(p,g,{scrollX:d,scrollY:v})){var m=(c==null?void 0:c.x)+i-d+h,y=(c==null?void 0:c.y)+n-v,_=this.spreadsheet.isFrozenRowHeader()?f-h-(i-d):a;l.addShape("rect",{attrs:U(U({},uv({id:this.meta.id,theme:s,type:Jn.Vertical,effect:Ei.Cell,offsetX:m,offsetY:y,width:a,height:o,meta:this.meta})),{x:m,y:y+o-s.size/2,width:_})})}}},t.prototype.getContentIndent=function(){if(!this.spreadsheet.isHierarchyTreeType())return 0;for(var e=this.getStyle(),i=e.icon,n=e.cell,a=i.size+i.margin.right,o=this.meta.parent,s=0;o;)o.height!==0&&(s+=a),o=o.parent;return this.showTreeLeafNodeAlignDot()&&(s+=this.isTreeLevel()?0:n.padding.right+i.margin.right),s},t.prototype.getTextIndent=function(){var e=this.getStyle().icon,i=e.size,n=e.margin,a=this.getContentIndent(),o=this.showTreeIcon()||this.isTreeLevel()&&this.showTreeLeafNodeAlignDot()?i+n.right:0;return a+o},t.prototype.isTreeLevel=function(){return vi(kt(this.meta,"parent.children"),function(e){return!e.isLeaf})},t.prototype.getIconPosition=function(){if(!this.textShape)return{x:0,y:0};var e=this.textShape.cfg.attrs,i=e.x,n=e.y,a=e.textAlign,o=this.getStyle().icon.margin.left;return a==="left"?{x:i+this.actualTextWidth+o,y:n}:a==="right"?{x:i+o,y:n}:{x:i+this.actualTextWidth/2+o,y:n}},t.prototype.getMaxTextWidth=function(){var e=this.getContentArea().width;return e-this.getTextIndent()-this.getActionIconsWidth()},t.prototype.getTextArea=function(){var e=this.getContentArea(),i=this.getTextIndent();return U(U({},e),{x:e.x+i,width:e.width-i})},t.prototype.getAdjustTextAreaHeight=function(e,i,n){var a=e.height;return!this.spreadsheet.facet.vScrollBar&&e.y+e.height>i+n&&(a=i+n-e.y),a},t.prototype.calculateTextY=function(e){var i=e.textArea,n=e.adjustTextAreaHeight,a=this.headerConfig,o=a.scrollY,s=a.viewportHeight,l=this.getTextStyle().fontSize;return SH(i.y,n,o,s,l)},t.prototype.getTextPosition=function(){var e=this.getTextArea(),i=this.headerConfig,n=i.scrollY,a=i.viewportHeight,o=this.getAdjustTextAreaHeight(e,n,a),s=this.calculateTextY({textArea:e,adjustTextAreaHeight:o}),l=hp(e,this.getTextStyle(),0,this.getIconStyle(),this.getActionIconsCount()).text.x;return{x:l,y:s}},t.prototype.getIconYPosition=function(){var e=this.getTextPosition().y,i=this.getStyle().icon.size,n=this.getTextStyle().fontSize;return e+(n-i)/2},t}(r2),vp=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.handleRestOptions=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var n=rt(e),a=n[0],o=n.slice(1);r.prototype.handleRestOptions.call(this,a,o),this.frozenRowCell=o[0]},t.prototype.getAdjustTextAreaHeight=function(e,i,n){var a=e.y-this.getFrozenFirstRowHeight(),o=e.height;return!this.spreadsheet.facet.vScrollBar&&a+e.height>i+n&&(o=i+n-a),o},t.prototype.calculateTextY=function(e){var i=e.textArea,n=e.adjustTextAreaHeight,a=this.headerConfig,o=a.scrollY,s=a.viewportHeight,l=this.getTextStyle().fontSize;return SH(i.y,n,o+this.getFrozenFirstRowHeight(),s,l)},t.prototype.getResizeClipAreaBBox=function(){return U(U({},r.prototype.getResizeClipAreaBBox.call(this)),{y:this.getFrozenFirstRowHeight()})},t.prototype.getFrozenFirstRowHeight=function(){var e;if(this.frozenRowCell)return 0;var i=this.spreadsheet,n=i.facet,a=i.options,o=xh(a,(e=n==null?void 0:n.layoutResult)===null||e===void 0?void 0:e.rowNodes).frozenRowHeight;return o},t}(czt),AH=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.initCell=function(){this.drawBackgroundShape(),this.drawRectBorder(),this.drawTextShape()},t.prototype.getTextStyle=function(){var e;return(e=this.getStyle())===null||e===void 0?void 0:e.seriesText},t.prototype.getTextPosition=function(){return r.prototype.getTextPosition.call(this)},t.prototype.getActionIconsCount=function(){return 0},t.prototype.getIconStyle=function(){},t.prototype.drawResizeAreaInLeaf=function(){},t.prototype.update=function(){},t.prototype.findFieldCondition=function(){},t.prototype.mappingValue=function(){},t}(vp),Lm=function(r){return[ui.META,ui.CONTROL].includes(r.key)},TH=function(r){return r.ctrlKey||r.metaKey},mo=function(r){var t=r.getMeta(),e=t||{},i=e.id,n=e.colIndex,a=e.rowIndex,o=e.rowQuery;return{id:i,colIndex:n,rowIndex:a,type:r.cellType,rowQuery:o}},hzt=function(r,t){var e=r.interaction;e.changeState({stateName:bt.SELECTED,cells:t}),r.emit(X.GLOBAL_SELECTED,e.getActiveCells())};function AE(r,t){var e=Math.min(r.rowIndex,t.rowIndex),i=Math.max(r.rowIndex,t.rowIndex),n=Math.min(r.colIndex,t.colIndex),a=Math.max(r.colIndex,t.colIndex);return{start:{rowIndex:e,colIndex:n},end:{rowIndex:i,colIndex:a}}}function fzt(r,t){var e=t.interaction,i=t.facet,n=t.options;if(t.isTableMode()){if(!n.showSeriesNumber)return[];var a=i.layoutResult.colLeafNodes[0].id,o=fp(String(r.rowIndex),a),s=[],l=e.getAllCells().find(function(u){return u.getMeta().id===o});return l&&l instanceof CH&&s.push(l),s}return qb(r.rowId,e.getAllRowHeaderCells(),t.isHierarchyTreeType())}var i2=function(r,t){var e=r.getSelectedCellHighlight(),i=e.colHeader,n=e.rowHeader;i&&r.updateCells(r.getAllColHeaderCells()),n&&r.updateCells(r.getAllRowHeaderCells()),t()},bH=function(r){var t=r.store.get("visibleActionIcons"),e=r.interaction.getInteractedCells(),i=r.interaction.getState().cells;if(st(e)&&st(i)&&st(t))return!1;if($t(t,function(a){a.set("visible",!1)}),r.store.set("visibleActionIcons",[]),$t(e,function(a){a.hideInteractionShape()}),r.interaction.resetState(),r.options.interaction.selectedCellsSpotlight){var n=r.interaction.getPanelGroupAllUnSelectedDataCells()||[];$t(n,function(a){a.clearUnselectedState()})}return!0},dzt=function(r,t){var e=t==null?void 0:t.stateName;r.interaction.isEqualStateName(e)||(bH(r),r.hideTooltip(),r.store.set(qC,t))},vzt=function(r,t,e){var i,n,a=e.facet,o=a.panelBBox.width,s=a==null?void 0:a.frozenGroupInfo,l=(i=s==null?void 0:s.frozenCol.width)!==null&&i!==void 0?i:0,u=(n=s==null?void 0:s.frozenTrailingCol.width)!==null&&n!==void 0?n:0,c=a.layoutResult.colLeafNodes[r];return t===Dr.SCROLL_UP?c.x-l:c.x+c.width-(o-u)},pzt=function(r,t,e){var i,n,a=e.facet,o=a.viewCellHeights.getCellOffsetY,s=a.panelBBox.height,l=o(r+1);if(Or(l))return 0;var u=a==null?void 0:a.frozenGroupInfo,c=(i=u==null?void 0:u.frozenRow.height)!==null&&i!==void 0?i:0,h=(n=u==null?void 0:u.frozenTrailingRow.height)!==null&&n!==void 0?n:0;return t===Dr.SCROLL_UP?o(r)-c:l-(s-h)};/*!
 *  decimal.js v10.4.3
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2022 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */var Rc=9e15,El=1e9,TE="0123456789abcdef",Om="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Pm="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",bE={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Rc,maxE:Rc,crypto:!1},wH,qo,Wt=!0,__="[DecimalError] ",ll=__+"Invalid argument: ",RH=__+"Precision limit exceeded",MH=__+"crypto unavailable",IH="[object Decimal]",pi=Math.floor,Sr=Math.pow,gzt=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,mzt=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,yzt=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,LH=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Pa=1e7,Nt=7,_zt=9007199254740991,xzt=Om.length-1,wE=Pm.length-1,it={toStringTag:IH};it.absoluteValue=it.abs=function(){var r=new this.constructor(this);return r.s<0&&(r.s=1),Mt(r)};it.ceil=function(){return Mt(new this.constructor(this),this.e+1,2)};it.clampedTo=it.clamp=function(r,t){var e,i=this,n=i.constructor;if(r=new n(r),t=new n(t),!r.s||!t.s)return new n(NaN);if(r.gt(t))throw Error(ll+t);return e=i.cmp(r),e<0?r:i.cmp(t)>0?t:new n(i)};it.comparedTo=it.cmp=function(r){var t,e,i,n,a=this,o=a.d,s=(r=new a.constructor(r)).d,l=a.s,u=r.s;if(!o||!s)return!l||!u?NaN:l!==u?l:o===s?0:!o^l<0?1:-1;if(!o[0]||!s[0])return o[0]?l:s[0]?-u:0;if(l!==u)return l;if(a.e!==r.e)return a.e>r.e^l<0?1:-1;for(i=o.length,n=s.length,t=0,e=i<n?i:n;t<e;++t)if(o[t]!==s[t])return o[t]>s[t]^l<0?1:-1;return i===n?0:i>n^l<0?1:-1};it.cosine=it.cos=function(){var r,t,e=this,i=e.constructor;return e.d?e.d[0]?(r=i.precision,t=i.rounding,i.precision=r+Math.max(e.e,e.sd())+Nt,i.rounding=1,e=Czt(i,DH(i,e)),i.precision=r,i.rounding=t,Mt(qo==2||qo==3?e.neg():e,r,t,!0)):new i(1):new i(NaN)};it.cubeRoot=it.cbrt=function(){var r,t,e,i,n,a,o,s,l,u,c=this,h=c.constructor;if(!c.isFinite()||c.isZero())return new h(c);for(Wt=!1,a=c.s*Sr(c.s*c,1/3),!a||Math.abs(a)==1/0?(e=Kr(c.d),r=c.e,(a=(r-e.length+1)%3)&&(e+=a==1||a==-2?"0":"00"),a=Sr(e,1/3),r=pi((r+1)/3)-(r%3==(r<0?-1:2)),a==1/0?e="5e"+r:(e=a.toExponential(),e=e.slice(0,e.indexOf("e")+1)+r),i=new h(e),i.s=c.s):i=new h(a.toString()),o=(r=h.precision)+3;;)if(s=i,l=s.times(s).times(s),u=l.plus(c),i=Ue(u.plus(c).times(s),u.plus(l),o+2,1),Kr(s.d).slice(0,o)===(e=Kr(i.d)).slice(0,o))if(e=e.slice(o-3,o+1),e=="9999"||!n&&e=="4999"){if(!n&&(Mt(s,r+1,0),s.times(s).times(s).eq(c))){i=s;break}o+=4,n=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(Mt(i,r+1,1),t=!i.times(i).times(i).eq(c));break}return Wt=!0,Mt(i,r,h.rounding,t)};it.decimalPlaces=it.dp=function(){var r,t=this.d,e=NaN;if(t){if(r=t.length-1,e=(r-pi(this.e/Nt))*Nt,r=t[r],r)for(;r%10==0;r/=10)e--;e<0&&(e=0)}return e};it.dividedBy=it.div=function(r){return Ue(this,new this.constructor(r))};it.dividedToIntegerBy=it.divToInt=function(r){var t=this,e=t.constructor;return Mt(Ue(t,new e(r),0,1,1),e.precision,e.rounding)};it.equals=it.eq=function(r){return this.cmp(r)===0};it.floor=function(){return Mt(new this.constructor(this),this.e+1,3)};it.greaterThan=it.gt=function(r){return this.cmp(r)>0};it.greaterThanOrEqualTo=it.gte=function(r){var t=this.cmp(r);return t==1||t===0};it.hyperbolicCosine=it.cosh=function(){var r,t,e,i,n,a=this,o=a.constructor,s=new o(1);if(!a.isFinite())return new o(a.s?1/0:NaN);if(a.isZero())return s;e=o.precision,i=o.rounding,o.precision=e+Math.max(a.e,a.sd())+4,o.rounding=1,n=a.d.length,n<32?(r=Math.ceil(n/3),t=(1/C_(4,r)).toString()):(r=16,t="2.3283064365386962890625e-10"),a=Eh(o,1,a.times(t),new o(1),!0);for(var l,u=r,c=new o(8);u--;)l=a.times(a),a=s.minus(l.times(c.minus(l.times(c))));return Mt(a,o.precision=e,o.rounding=i,!0)};it.hyperbolicSine=it.sinh=function(){var r,t,e,i,n=this,a=n.constructor;if(!n.isFinite()||n.isZero())return new a(n);if(t=a.precision,e=a.rounding,a.precision=t+Math.max(n.e,n.sd())+4,a.rounding=1,i=n.d.length,i<3)n=Eh(a,2,n,n,!0);else{r=1.4*Math.sqrt(i),r=r>16?16:r|0,n=n.times(1/C_(5,r)),n=Eh(a,2,n,n,!0);for(var o,s=new a(5),l=new a(16),u=new a(20);r--;)o=n.times(n),n=n.times(s.plus(o.times(l.times(o).plus(u))))}return a.precision=t,a.rounding=e,Mt(n,t,e,!0)};it.hyperbolicTangent=it.tanh=function(){var r,t,e=this,i=e.constructor;return e.isFinite()?e.isZero()?new i(e):(r=i.precision,t=i.rounding,i.precision=r+7,i.rounding=1,Ue(e.sinh(),e.cosh(),i.precision=r,i.rounding=t)):new i(e.s)};it.inverseCosine=it.acos=function(){var r,t=this,e=t.constructor,i=t.abs().cmp(1),n=e.precision,a=e.rounding;return i!==-1?i===0?t.isNeg()?Ta(e,n,a):new e(0):new e(NaN):t.isZero()?Ta(e,n+4,a).times(.5):(e.precision=n+6,e.rounding=1,t=t.asin(),r=Ta(e,n+4,a).times(.5),e.precision=n,e.rounding=a,r.minus(t))};it.inverseHyperbolicCosine=it.acosh=function(){var r,t,e=this,i=e.constructor;return e.lte(1)?new i(e.eq(1)?0:NaN):e.isFinite()?(r=i.precision,t=i.rounding,i.precision=r+Math.max(Math.abs(e.e),e.sd())+4,i.rounding=1,Wt=!1,e=e.times(e).minus(1).sqrt().plus(e),Wt=!0,i.precision=r,i.rounding=t,e.ln()):new i(e)};it.inverseHyperbolicSine=it.asinh=function(){var r,t,e=this,i=e.constructor;return!e.isFinite()||e.isZero()?new i(e):(r=i.precision,t=i.rounding,i.precision=r+2*Math.max(Math.abs(e.e),e.sd())+6,i.rounding=1,Wt=!1,e=e.times(e).plus(1).sqrt().plus(e),Wt=!0,i.precision=r,i.rounding=t,e.ln())};it.inverseHyperbolicTangent=it.atanh=function(){var r,t,e,i,n=this,a=n.constructor;return n.isFinite()?n.e>=0?new a(n.abs().eq(1)?n.s/0:n.isZero()?n:NaN):(r=a.precision,t=a.rounding,i=n.sd(),Math.max(i,r)<2*-n.e-1?Mt(new a(n),r,t,!0):(a.precision=e=i-n.e,n=Ue(n.plus(1),new a(1).minus(n),e+r,1),a.precision=r+4,a.rounding=1,n=n.ln(),a.precision=r,a.rounding=t,n.times(.5))):new a(NaN)};it.inverseSine=it.asin=function(){var r,t,e,i,n=this,a=n.constructor;return n.isZero()?new a(n):(t=n.abs().cmp(1),e=a.precision,i=a.rounding,t!==-1?t===0?(r=Ta(a,e+4,i).times(.5),r.s=n.s,r):new a(NaN):(a.precision=e+6,a.rounding=1,n=n.div(new a(1).minus(n.times(n)).sqrt().plus(1)).atan(),a.precision=e,a.rounding=i,n.times(2)))};it.inverseTangent=it.atan=function(){var r,t,e,i,n,a,o,s,l,u=this,c=u.constructor,h=c.precision,f=c.rounding;if(u.isFinite()){if(u.isZero())return new c(u);if(u.abs().eq(1)&&h+4<=wE)return o=Ta(c,h+4,f).times(.25),o.s=u.s,o}else{if(!u.s)return new c(NaN);if(h+4<=wE)return o=Ta(c,h+4,f).times(.5),o.s=u.s,o}for(c.precision=s=h+10,c.rounding=1,e=Math.min(28,s/Nt+2|0),r=e;r;--r)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(Wt=!1,t=Math.ceil(s/Nt),i=1,l=u.times(u),o=new c(u),n=u;r!==-1;)if(n=n.times(l),a=o.minus(n.div(i+=2)),n=n.times(l),o=a.plus(n.div(i+=2)),o.d[t]!==void 0)for(r=t;o.d[r]===a.d[r]&&r--;);return e&&(o=o.times(2<<e-1)),Wt=!0,Mt(o,c.precision=h,c.rounding=f,!0)};it.isFinite=function(){return!!this.d};it.isInteger=it.isInt=function(){return!!this.d&&pi(this.e/Nt)>this.d.length-2};it.isNaN=function(){return!this.s};it.isNegative=it.isNeg=function(){return this.s<0};it.isPositive=it.isPos=function(){return this.s>0};it.isZero=function(){return!!this.d&&this.d[0]===0};it.lessThan=it.lt=function(r){return this.cmp(r)<0};it.lessThanOrEqualTo=it.lte=function(r){return this.cmp(r)<1};it.logarithm=it.log=function(r){var t,e,i,n,a,o,s,l,u=this,c=u.constructor,h=c.precision,f=c.rounding,d=5;if(r==null)r=new c(10),t=!0;else{if(r=new c(r),e=r.d,r.s<0||!e||!e[0]||r.eq(1))return new c(NaN);t=r.eq(10)}if(e=u.d,u.s<0||!e||!e[0]||u.eq(1))return new c(e&&!e[0]?-1/0:u.s!=1?NaN:e?0:1/0);if(t)if(e.length>1)a=!0;else{for(n=e[0];n%10===0;)n/=10;a=n!==1}if(Wt=!1,s=h+d,o=Ws(u,s),i=t?Fm(c,s+10):Ws(r,s),l=Ue(o,i,s,1),cv(l.d,n=h,f))do if(s+=10,o=Ws(u,s),i=t?Fm(c,s+10):Ws(r,s),l=Ue(o,i,s,1),!a){+Kr(l.d).slice(n+1,n+15)+1==1e14&&(l=Mt(l,h+1,0));break}while(cv(l.d,n+=10,f));return Wt=!0,Mt(l,h,f)};it.minus=it.sub=function(r){var t,e,i,n,a,o,s,l,u,c,h,f,d=this,v=d.constructor;if(r=new v(r),!d.d||!r.d)return!d.s||!r.s?r=new v(NaN):d.d?r.s=-r.s:r=new v(r.d||d.s!==r.s?d:NaN),r;if(d.s!=r.s)return r.s=-r.s,d.plus(r);if(u=d.d,f=r.d,s=v.precision,l=v.rounding,!u[0]||!f[0]){if(f[0])r.s=-r.s;else if(u[0])r=new v(d);else return new v(l===3?-0:0);return Wt?Mt(r,s,l):r}if(e=pi(r.e/Nt),c=pi(d.e/Nt),u=u.slice(),a=c-e,a){for(h=a<0,h?(t=u,a=-a,o=f.length):(t=f,e=c,o=u.length),i=Math.max(Math.ceil(s/Nt),o)+2,a>i&&(a=i,t.length=1),t.reverse(),i=a;i--;)t.push(0);t.reverse()}else{for(i=u.length,o=f.length,h=i<o,h&&(o=i),i=0;i<o;i++)if(u[i]!=f[i]){h=u[i]<f[i];break}a=0}for(h&&(t=u,u=f,f=t,r.s=-r.s),o=u.length,i=f.length-o;i>0;--i)u[o++]=0;for(i=f.length;i>a;){if(u[--i]<f[i]){for(n=i;n&&u[--n]===0;)u[n]=Pa-1;--u[n],u[i]+=Pa}u[i]-=f[i]}for(;u[--o]===0;)u.pop();for(;u[0]===0;u.shift())--e;return u[0]?(r.d=u,r.e=x_(u,e),Wt?Mt(r,s,l):r):new v(l===3?-0:0)};it.modulo=it.mod=function(r){var t,e=this,i=e.constructor;return r=new i(r),!e.d||!r.s||r.d&&!r.d[0]?new i(NaN):!r.d||e.d&&!e.d[0]?Mt(new i(e),i.precision,i.rounding):(Wt=!1,i.modulo==9?(t=Ue(e,r.abs(),0,3,1),t.s*=r.s):t=Ue(e,r,0,i.modulo,1),t=t.times(r),Wt=!0,e.minus(t))};it.naturalExponential=it.exp=function(){return RE(this)};it.naturalLogarithm=it.ln=function(){return Ws(this)};it.negated=it.neg=function(){var r=new this.constructor(this);return r.s=-r.s,Mt(r)};it.plus=it.add=function(r){var t,e,i,n,a,o,s,l,u,c,h=this,f=h.constructor;if(r=new f(r),!h.d||!r.d)return!h.s||!r.s?r=new f(NaN):h.d||(r=new f(r.d||h.s===r.s?h:NaN)),r;if(h.s!=r.s)return r.s=-r.s,h.minus(r);if(u=h.d,c=r.d,s=f.precision,l=f.rounding,!u[0]||!c[0])return c[0]||(r=new f(h)),Wt?Mt(r,s,l):r;if(a=pi(h.e/Nt),i=pi(r.e/Nt),u=u.slice(),n=a-i,n){for(n<0?(e=u,n=-n,o=c.length):(e=c,i=a,o=u.length),a=Math.ceil(s/Nt),o=a>o?a+1:o+1,n>o&&(n=o,e.length=1),e.reverse();n--;)e.push(0);e.reverse()}for(o=u.length,n=c.length,o-n<0&&(n=o,e=c,c=u,u=e),t=0;n;)t=(u[--n]=u[n]+c[n]+t)/Pa|0,u[n]%=Pa;for(t&&(u.unshift(t),++i),o=u.length;u[--o]==0;)u.pop();return r.d=u,r.e=x_(u,i),Wt?Mt(r,s,l):r};it.precision=it.sd=function(r){var t,e=this;if(r!==void 0&&r!==!!r&&r!==1&&r!==0)throw Error(ll+r);return e.d?(t=OH(e.d),r&&e.e+1>t&&(t=e.e+1)):t=NaN,t};it.round=function(){var r=this,t=r.constructor;return Mt(new t(r),r.e+1,t.rounding)};it.sine=it.sin=function(){var r,t,e=this,i=e.constructor;return e.isFinite()?e.isZero()?new i(e):(r=i.precision,t=i.rounding,i.precision=r+Math.max(e.e,e.sd())+Nt,i.rounding=1,e=Szt(i,DH(i,e)),i.precision=r,i.rounding=t,Mt(qo>2?e.neg():e,r,t,!0)):new i(NaN)};it.squareRoot=it.sqrt=function(){var r,t,e,i,n,a,o=this,s=o.d,l=o.e,u=o.s,c=o.constructor;if(u!==1||!s||!s[0])return new c(!u||u<0&&(!s||s[0])?NaN:s?o:1/0);for(Wt=!1,u=Math.sqrt(+o),u==0||u==1/0?(t=Kr(s),(t.length+l)%2==0&&(t+="0"),u=Math.sqrt(t),l=pi((l+1)/2)-(l<0||l%2),u==1/0?t="5e"+l:(t=u.toExponential(),t=t.slice(0,t.indexOf("e")+1)+l),i=new c(t)):i=new c(u.toString()),e=(l=c.precision)+3;;)if(a=i,i=a.plus(Ue(o,a,e+2,1)).times(.5),Kr(a.d).slice(0,e)===(t=Kr(i.d)).slice(0,e))if(t=t.slice(e-3,e+1),t=="9999"||!n&&t=="4999"){if(!n&&(Mt(a,l+1,0),a.times(a).eq(o))){i=a;break}e+=4,n=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(Mt(i,l+1,1),r=!i.times(i).eq(o));break}return Wt=!0,Mt(i,l,c.rounding,r)};it.tangent=it.tan=function(){var r,t,e=this,i=e.constructor;return e.isFinite()?e.isZero()?new i(e):(r=i.precision,t=i.rounding,i.precision=r+10,i.rounding=1,e=e.sin(),e.s=1,e=Ue(e,new i(1).minus(e.times(e)).sqrt(),r+10,0),i.precision=r,i.rounding=t,Mt(qo==2||qo==4?e.neg():e,r,t,!0)):new i(NaN)};it.times=it.mul=function(r){var t,e,i,n,a,o,s,l,u,c=this,h=c.constructor,f=c.d,d=(r=new h(r)).d;if(r.s*=c.s,!f||!f[0]||!d||!d[0])return new h(!r.s||f&&!f[0]&&!d||d&&!d[0]&&!f?NaN:!f||!d?r.s/0:r.s*0);for(e=pi(c.e/Nt)+pi(r.e/Nt),l=f.length,u=d.length,l<u&&(a=f,f=d,d=a,o=l,l=u,u=o),a=[],o=l+u,i=o;i--;)a.push(0);for(i=u;--i>=0;){for(t=0,n=l+i;n>i;)s=a[n]+d[i]*f[n-i-1]+t,a[n--]=s%Pa|0,t=s/Pa|0;a[n]=(a[n]+t)%Pa|0}for(;!a[--o];)a.pop();return t?++e:a.shift(),r.d=a,r.e=x_(a,e),Wt?Mt(r,h.precision,h.rounding):r};it.toBinary=function(r,t){return n2(this,2,r,t)};it.toDecimalPlaces=it.toDP=function(r,t){var e=this,i=e.constructor;return e=new i(e),r===void 0?e:(sn(r,0,El),t===void 0?t=i.rounding:sn(t,0,8),Mt(e,r+e.e+1,t))};it.toExponential=function(r,t){var e,i=this,n=i.constructor;return r===void 0?e=To(i,!0):(sn(r,0,El),t===void 0?t=n.rounding:sn(t,0,8),i=Mt(new n(i),r+1,t),e=To(i,!0,r+1)),i.isNeg()&&!i.isZero()?"-"+e:e};it.toFixed=function(r,t){var e,i,n=this,a=n.constructor;return r===void 0?e=To(n):(sn(r,0,El),t===void 0?t=a.rounding:sn(t,0,8),i=Mt(new a(n),r+n.e+1,t),e=To(i,!1,r+i.e+1)),n.isNeg()&&!n.isZero()?"-"+e:e};it.toFraction=function(r){var t,e,i,n,a,o,s,l,u,c,h,f,d=this,v=d.d,p=d.constructor;if(!v)return new p(d);if(u=e=new p(1),i=l=new p(0),t=new p(i),a=t.e=OH(v)-d.e-1,o=a%Nt,t.d[0]=Sr(10,o<0?Nt+o:o),r==null)r=a>0?t:u;else{if(s=new p(r),!s.isInt()||s.lt(u))throw Error(ll+s);r=s.gt(t)?a>0?t:u:s}for(Wt=!1,s=new p(Kr(v)),c=p.precision,p.precision=a=v.length*Nt*2;h=Ue(s,t,0,1,1),n=e.plus(h.times(i)),n.cmp(r)!=1;)e=i,i=n,n=u,u=l.plus(h.times(n)),l=n,n=t,t=s.minus(h.times(n)),s=n;return n=Ue(r.minus(e),i,0,1,1),l=l.plus(n.times(u)),e=e.plus(n.times(i)),l.s=u.s=d.s,f=Ue(u,i,a,1).minus(d).abs().cmp(Ue(l,e,a,1).minus(d).abs())<1?[u,i]:[l,e],p.precision=c,Wt=!0,f};it.toHexadecimal=it.toHex=function(r,t){return n2(this,16,r,t)};it.toNearest=function(r,t){var e=this,i=e.constructor;if(e=new i(e),r==null){if(!e.d)return e;r=new i(1),t=i.rounding}else{if(r=new i(r),t===void 0?t=i.rounding:sn(t,0,8),!e.d)return r.s?e:r;if(!r.d)return r.s&&(r.s=e.s),r}return r.d[0]?(Wt=!1,e=Ue(e,r,0,t,1).times(r),Wt=!0,Mt(e)):(r.s=e.s,e=r),e};it.toNumber=function(){return+this};it.toOctal=function(r,t){return n2(this,8,r,t)};it.toPower=it.pow=function(r){var t,e,i,n,a,o,s=this,l=s.constructor,u=+(r=new l(r));if(!s.d||!r.d||!s.d[0]||!r.d[0])return new l(Sr(+s,u));if(s=new l(s),s.eq(1))return s;if(i=l.precision,a=l.rounding,r.eq(1))return Mt(s,i,a);if(t=pi(r.e/Nt),t>=r.d.length-1&&(e=u<0?-u:u)<=_zt)return n=PH(l,s,e,i),r.s<0?new l(1).div(n):Mt(n,i,a);if(o=s.s,o<0){if(t<r.d.length-1)return new l(NaN);if(r.d[t]&1||(o=1),s.e==0&&s.d[0]==1&&s.d.length==1)return s.s=o,s}return e=Sr(+s,u),t=e==0||!isFinite(e)?pi(u*(Math.log("0."+Kr(s.d))/Math.LN10+s.e+1)):new l(e+"").e,t>l.maxE+1||t<l.minE-1?new l(t>0?o/0:0):(Wt=!1,l.rounding=s.s=1,e=Math.min(12,(t+"").length),n=RE(r.times(Ws(s,i+e)),i),n.d&&(n=Mt(n,i+5,1),cv(n.d,i,a)&&(t=i+10,n=Mt(RE(r.times(Ws(s,t+e)),t),t+5,1),+Kr(n.d).slice(i+1,i+15)+1==1e14&&(n=Mt(n,i+1,0)))),n.s=o,Wt=!0,l.rounding=a,Mt(n,i,a))};it.toPrecision=function(r,t){var e,i=this,n=i.constructor;return r===void 0?e=To(i,i.e<=n.toExpNeg||i.e>=n.toExpPos):(sn(r,1,El),t===void 0?t=n.rounding:sn(t,0,8),i=Mt(new n(i),r,t),e=To(i,r<=i.e||i.e<=n.toExpNeg,r)),i.isNeg()&&!i.isZero()?"-"+e:e};it.toSignificantDigits=it.toSD=function(r,t){var e=this,i=e.constructor;return r===void 0?(r=i.precision,t=i.rounding):(sn(r,1,El),t===void 0?t=i.rounding:sn(t,0,8)),Mt(new i(e),r,t)};it.toString=function(){var r=this,t=r.constructor,e=To(r,r.e<=t.toExpNeg||r.e>=t.toExpPos);return r.isNeg()&&!r.isZero()?"-"+e:e};it.truncated=it.trunc=function(){return Mt(new this.constructor(this),this.e+1,1)};it.valueOf=it.toJSON=function(){var r=this,t=r.constructor,e=To(r,r.e<=t.toExpNeg||r.e>=t.toExpPos);return r.isNeg()?"-"+e:e};function Kr(r){var t,e,i,n=r.length-1,a="",o=r[0];if(n>0){for(a+=o,t=1;t<n;t++)i=r[t]+"",e=Nt-i.length,e&&(a+=Bs(e)),a+=i;o=r[t],i=o+"",e=Nt-i.length,e&&(a+=Bs(e))}else if(o===0)return"0";for(;o%10===0;)o/=10;return a+o}function sn(r,t,e){if(r!==~~r||r<t||r>e)throw Error(ll+r)}function cv(r,t,e,i){var n,a,o,s;for(a=r[0];a>=10;a/=10)--t;return--t<0?(t+=Nt,n=0):(n=Math.ceil((t+1)/Nt),t%=Nt),a=Sr(10,Nt-t),s=r[n]%a|0,i==null?t<3?(t==0?s=s/100|0:t==1&&(s=s/10|0),o=e<4&&s==99999||e>3&&s==49999||s==5e4||s==0):o=(e<4&&s+1==a||e>3&&s+1==a/2)&&(r[n+1]/a/100|0)==Sr(10,t-2)-1||(s==a/2||s==0)&&(r[n+1]/a/100|0)==0:t<4?(t==0?s=s/1e3|0:t==1?s=s/100|0:t==2&&(s=s/10|0),o=(i||e<4)&&s==9999||!i&&e>3&&s==4999):o=((i||e<4)&&s+1==a||!i&&e>3&&s+1==a/2)&&(r[n+1]/a/1e3|0)==Sr(10,t-3)-1,o}function v0(r,t,e){for(var i,n=[0],a,o=0,s=r.length;o<s;){for(a=n.length;a--;)n[a]*=t;for(n[0]+=TE.indexOf(r.charAt(o++)),i=0;i<n.length;i++)n[i]>e-1&&(n[i+1]===void 0&&(n[i+1]=0),n[i+1]+=n[i]/e|0,n[i]%=e)}return n.reverse()}function Czt(r,t){var e,i,n;if(t.isZero())return t;i=t.d.length,i<32?(e=Math.ceil(i/3),n=(1/C_(4,e)).toString()):(e=16,n="2.3283064365386962890625e-10"),r.precision+=e,t=Eh(r,1,t.times(n),new r(1));for(var a=e;a--;){var o=t.times(t);t=o.times(o).minus(o).times(8).plus(1)}return r.precision-=e,t}var Ue=function(){function r(i,n,a){var o,s=0,l=i.length;for(i=i.slice();l--;)o=i[l]*n+s,i[l]=o%a|0,s=o/a|0;return s&&i.unshift(s),i}function t(i,n,a,o){var s,l;if(a!=o)l=a>o?1:-1;else for(s=l=0;s<a;s++)if(i[s]!=n[s]){l=i[s]>n[s]?1:-1;break}return l}function e(i,n,a,o){for(var s=0;a--;)i[a]-=s,s=i[a]<n[a]?1:0,i[a]=s*o+i[a]-n[a];for(;!i[0]&&i.length>1;)i.shift()}return function(i,n,a,o,s,l){var u,c,h,f,d,v,p,g,m,y,_,x,C,A,b,R,M,O,F,D,H=i.constructor,j=i.s==n.s?1:-1,$=i.d,k=n.d;if(!$||!$[0]||!k||!k[0])return new H(!i.s||!n.s||($?k&&$[0]==k[0]:!k)?NaN:$&&$[0]==0||!k?j*0:j/0);for(l?(d=1,c=i.e-n.e):(l=Pa,d=Nt,c=pi(i.e/d)-pi(n.e/d)),F=k.length,M=$.length,m=new H(j),y=m.d=[],h=0;k[h]==($[h]||0);h++);if(k[h]>($[h]||0)&&c--,a==null?(A=a=H.precision,o=H.rounding):s?A=a+(i.e-n.e)+1:A=a,A<0)y.push(1),v=!0;else{if(A=A/d+2|0,h=0,F==1){for(f=0,k=k[0],A++;(h<M||f)&&A--;h++)b=f*l+($[h]||0),y[h]=b/k|0,f=b%k|0;v=f||h<M}else{for(f=l/(k[0]+1)|0,f>1&&(k=r(k,f,l),$=r($,f,l),F=k.length,M=$.length),R=F,_=$.slice(0,F),x=_.length;x<F;)_[x++]=0;D=k.slice(),D.unshift(0),O=k[0],k[1]>=l/2&&++O;do f=0,u=t(k,_,F,x),u<0?(C=_[0],F!=x&&(C=C*l+(_[1]||0)),f=C/O|0,f>1?(f>=l&&(f=l-1),p=r(k,f,l),g=p.length,x=_.length,u=t(p,_,g,x),u==1&&(f--,e(p,F<g?D:k,g,l))):(f==0&&(u=f=1),p=k.slice()),g=p.length,g<x&&p.unshift(0),e(_,p,x,l),u==-1&&(x=_.length,u=t(k,_,F,x),u<1&&(f++,e(_,F<x?D:k,x,l))),x=_.length):u===0&&(f++,_=[0]),y[h++]=f,u&&_[0]?_[x++]=$[R]||0:(_=[$[R]],x=1);while((R++<M||_[0]!==void 0)&&A--);v=_[0]!==void 0}y[0]||y.shift()}if(d==1)m.e=c,wH=v;else{for(h=1,f=y[0];f>=10;f/=10)h++;m.e=h+c*d-1,Mt(m,s?a+m.e+1:a,o,v)}return m}}();function Mt(r,t,e,i){var n,a,o,s,l,u,c,h,f,d=r.constructor;t:if(t!=null){if(h=r.d,!h)return r;for(n=1,s=h[0];s>=10;s/=10)n++;if(a=t-n,a<0)a+=Nt,o=t,c=h[f=0],l=c/Sr(10,n-o-1)%10|0;else if(f=Math.ceil((a+1)/Nt),s=h.length,f>=s)if(i){for(;s++<=f;)h.push(0);c=l=0,n=1,a%=Nt,o=a-Nt+1}else break t;else{for(c=s=h[f],n=1;s>=10;s/=10)n++;a%=Nt,o=a-Nt+n,l=o<0?0:c/Sr(10,n-o-1)%10|0}if(i=i||t<0||h[f+1]!==void 0||(o<0?c:c%Sr(10,n-o-1)),u=e<4?(l||i)&&(e==0||e==(r.s<0?3:2)):l>5||l==5&&(e==4||i||e==6&&(a>0?o>0?c/Sr(10,n-o):0:h[f-1])%10&1||e==(r.s<0?8:7)),t<1||!h[0])return h.length=0,u?(t-=r.e+1,h[0]=Sr(10,(Nt-t%Nt)%Nt),r.e=-t||0):h[0]=r.e=0,r;if(a==0?(h.length=f,s=1,f--):(h.length=f+1,s=Sr(10,Nt-a),h[f]=o>0?(c/Sr(10,n-o)%Sr(10,o)|0)*s:0),u)for(;;)if(f==0){for(a=1,o=h[0];o>=10;o/=10)a++;for(o=h[0]+=s,s=1;o>=10;o/=10)s++;a!=s&&(r.e++,h[0]==Pa&&(h[0]=1));break}else{if(h[f]+=s,h[f]!=Pa)break;h[f--]=0,s=1}for(a=h.length;h[--a]===0;)h.pop()}return Wt&&(r.e>d.maxE?(r.d=null,r.e=NaN):r.e<d.minE&&(r.e=0,r.d=[0])),r}function To(r,t,e){if(!r.isFinite())return BH(r);var i,n=r.e,a=Kr(r.d),o=a.length;return t?(e&&(i=e-o)>0?a=a.charAt(0)+"."+a.slice(1)+Bs(i):o>1&&(a=a.charAt(0)+"."+a.slice(1)),a=a+(r.e<0?"e":"e+")+r.e):n<0?(a="0."+Bs(-n-1)+a,e&&(i=e-o)>0&&(a+=Bs(i))):n>=o?(a+=Bs(n+1-o),e&&(i=e-n-1)>0&&(a=a+"."+Bs(i))):((i=n+1)<o&&(a=a.slice(0,i)+"."+a.slice(i)),e&&(i=e-o)>0&&(n+1===o&&(a+="."),a+=Bs(i))),a}function x_(r,t){var e=r[0];for(t*=Nt;e>=10;e/=10)t++;return t}function Fm(r,t,e){if(t>xzt)throw Wt=!0,e&&(r.precision=e),Error(RH);return Mt(new r(Om),t,1,!0)}function Ta(r,t,e){if(t>wE)throw Error(RH);return Mt(new r(Pm),t,e,!0)}function OH(r){var t=r.length-1,e=t*Nt+1;if(t=r[t],t){for(;t%10==0;t/=10)e--;for(t=r[0];t>=10;t/=10)e++}return e}function Bs(r){for(var t="";r--;)t+="0";return t}function PH(r,t,e,i){var n,a=new r(1),o=Math.ceil(i/Nt+4);for(Wt=!1;;){if(e%2&&(a=a.times(t),RF(a.d,o)&&(n=!0)),e=pi(e/2),e===0){e=a.d.length-1,n&&a.d[e]===0&&++a.d[e];break}t=t.times(t),RF(t.d,o)}return Wt=!0,a}function wF(r){return r.d[r.d.length-1]&1}function FH(r,t,e){for(var i,n=new r(t[0]),a=0;++a<t.length;)if(i=new r(t[a]),i.s)n[e](i)&&(n=i);else{n=i;break}return n}function RE(r,t){var e,i,n,a,o,s,l,u=0,c=0,h=0,f=r.constructor,d=f.rounding,v=f.precision;if(!r.d||!r.d[0]||r.e>17)return new f(r.d?r.d[0]?r.s<0?0:1/0:1:r.s?r.s<0?0:r:0/0);for(t==null?(Wt=!1,l=v):l=t,s=new f(.03125);r.e>-2;)r=r.times(s),h+=5;for(i=Math.log(Sr(2,h))/Math.LN10*2+5|0,l+=i,e=a=o=new f(1),f.precision=l;;){if(a=Mt(a.times(r),l,1),e=e.times(++c),s=o.plus(Ue(a,e,l,1)),Kr(s.d).slice(0,l)===Kr(o.d).slice(0,l)){for(n=h;n--;)o=Mt(o.times(o),l,1);if(t==null)if(u<3&&cv(o.d,l-i,d,u))f.precision=l+=10,e=a=s=new f(1),c=0,u++;else return Mt(o,f.precision=v,d,Wt=!0);else return f.precision=v,o}o=s}}function Ws(r,t){var e,i,n,a,o,s,l,u,c,h,f,d=1,v=10,p=r,g=p.d,m=p.constructor,y=m.rounding,_=m.precision;if(p.s<0||!g||!g[0]||!p.e&&g[0]==1&&g.length==1)return new m(g&&!g[0]?-1/0:p.s!=1?NaN:g?0:p);if(t==null?(Wt=!1,c=_):c=t,m.precision=c+=v,e=Kr(g),i=e.charAt(0),Math.abs(a=p.e)<15e14){for(;i<7&&i!=1||i==1&&e.charAt(1)>3;)p=p.times(r),e=Kr(p.d),i=e.charAt(0),d++;a=p.e,i>1?(p=new m("0."+e),a++):p=new m(i+"."+e.slice(1))}else return u=Fm(m,c+2,_).times(a+""),p=Ws(new m(i+"."+e.slice(1)),c-v).plus(u),m.precision=_,t==null?Mt(p,_,y,Wt=!0):p;for(h=p,l=o=p=Ue(p.minus(1),p.plus(1),c,1),f=Mt(p.times(p),c,1),n=3;;){if(o=Mt(o.times(f),c,1),u=l.plus(Ue(o,new m(n),c,1)),Kr(u.d).slice(0,c)===Kr(l.d).slice(0,c))if(l=l.times(2),a!==0&&(l=l.plus(Fm(m,c+2,_).times(a+""))),l=Ue(l,new m(d),c,1),t==null)if(cv(l.d,c-v,y,s))m.precision=c+=v,u=o=p=Ue(h.minus(1),h.plus(1),c,1),f=Mt(p.times(p),c,1),n=s=1;else return Mt(l,m.precision=_,y,Wt=!0);else return m.precision=_,l;l=u,n+=2}}function BH(r){return String(r.s*r.s/0)}function ME(r,t){var e,i,n;for((e=t.indexOf("."))>-1&&(t=t.replace(".","")),(i=t.search(/e/i))>0?(e<0&&(e=i),e+=+t.slice(i+1),t=t.substring(0,i)):e<0&&(e=t.length),i=0;t.charCodeAt(i)===48;i++);for(n=t.length;t.charCodeAt(n-1)===48;--n);if(t=t.slice(i,n),t){if(n-=i,r.e=e=e-i-1,r.d=[],i=(e+1)%Nt,e<0&&(i+=Nt),i<n){for(i&&r.d.push(+t.slice(0,i)),n-=Nt;i<n;)r.d.push(+t.slice(i,i+=Nt));t=t.slice(i),i=Nt-t.length}else i-=n;for(;i--;)t+="0";r.d.push(+t),Wt&&(r.e>r.constructor.maxE?(r.d=null,r.e=NaN):r.e<r.constructor.minE&&(r.e=0,r.d=[0]))}else r.e=0,r.d=[0];return r}function Ezt(r,t){var e,i,n,a,o,s,l,u,c;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),LH.test(t))return ME(r,t)}else if(t==="Infinity"||t==="NaN")return+t||(r.s=NaN),r.e=NaN,r.d=null,r;if(mzt.test(t))e=16,t=t.toLowerCase();else if(gzt.test(t))e=2;else if(yzt.test(t))e=8;else throw Error(ll+t);for(a=t.search(/p/i),a>0?(l=+t.slice(a+1),t=t.substring(2,a)):t=t.slice(2),a=t.indexOf("."),o=a>=0,i=r.constructor,o&&(t=t.replace(".",""),s=t.length,a=s-a,n=PH(i,new i(e),a,a*2)),u=v0(t,e,Pa),c=u.length-1,a=c;u[a]===0;--a)u.pop();return a<0?new i(r.s*0):(r.e=x_(u,c),r.d=u,Wt=!1,o&&(r=Ue(r,n,s*4)),l&&(r=r.times(Math.abs(l)<54?Sr(2,l):ka.pow(2,l))),Wt=!0,r)}function Szt(r,t){var e,i=t.d.length;if(i<3)return t.isZero()?t:Eh(r,2,t,t);e=1.4*Math.sqrt(i),e=e>16?16:e|0,t=t.times(1/C_(5,e)),t=Eh(r,2,t,t);for(var n,a=new r(5),o=new r(16),s=new r(20);e--;)n=t.times(t),t=t.times(a.plus(n.times(o.times(n).minus(s))));return t}function Eh(r,t,e,i,n){var a,o,s,l,u=r.precision,c=Math.ceil(u/Nt);for(Wt=!1,l=e.times(e),s=new r(i);;){if(o=Ue(s.times(l),new r(t++*t++),u,1),s=n?i.plus(o):i.minus(o),i=Ue(o.times(l),new r(t++*t++),u,1),o=s.plus(i),o.d[c]!==void 0){for(a=c;o.d[a]===s.d[a]&&a--;);if(a==-1)break}a=s,s=i,i=o,o=a}return Wt=!0,o.d.length=c+1,o}function C_(r,t){for(var e=r;--t;)e*=r;return e}function DH(r,t){var e,i=t.s<0,n=Ta(r,r.precision,1),a=n.times(.5);if(t=t.abs(),t.lte(a))return qo=i?4:1,t;if(e=t.divToInt(n),e.isZero())qo=i?3:2;else{if(t=t.minus(e.times(n)),t.lte(a))return qo=wF(e)?i?2:3:i?4:1,t;qo=wF(e)?i?1:4:i?3:2}return t.minus(n).abs()}function n2(r,t,e,i){var n,a,o,s,l,u,c,h,f,d=r.constructor,v=e!==void 0;if(v?(sn(e,1,El),i===void 0?i=d.rounding:sn(i,0,8)):(e=d.precision,i=d.rounding),!r.isFinite())c=BH(r);else{for(c=To(r),o=c.indexOf("."),v?(n=2,t==16?e=e*4-3:t==8&&(e=e*3-2)):n=t,o>=0&&(c=c.replace(".",""),f=new d(1),f.e=c.length-o,f.d=v0(To(f),10,n),f.e=f.d.length),h=v0(c,10,n),a=l=h.length;h[--l]==0;)h.pop();if(!h[0])c=v?"0p+0":"0";else{if(o<0?a--:(r=new d(r),r.d=h,r.e=a,r=Ue(r,f,e,i,0,n),h=r.d,a=r.e,u=wH),o=h[e],s=n/2,u=u||h[e+1]!==void 0,u=i<4?(o!==void 0||u)&&(i===0||i===(r.s<0?3:2)):o>s||o===s&&(i===4||u||i===6&&h[e-1]&1||i===(r.s<0?8:7)),h.length=e,u)for(;++h[--e]>n-1;)h[e]=0,e||(++a,h.unshift(1));for(l=h.length;!h[l-1];--l);for(o=0,c="";o<l;o++)c+=TE.charAt(h[o]);if(v){if(l>1)if(t==16||t==8){for(o=t==16?4:3,--l;l%o;l++)c+="0";for(h=v0(c,n,t),l=h.length;!h[l-1];--l);for(o=1,c="1.";o<l;o++)c+=TE.charAt(h[o])}else c=c.charAt(0)+"."+c.slice(1);c=c+(a<0?"p":"p+")+a}else if(a<0){for(;++a;)c="0"+c;c="0."+c}else if(++a>l)for(a-=l;a--;)c+="0";else a<l&&(c=c.slice(0,a)+"."+c.slice(a))}c=(t==16?"0x":t==2?"0b":t==8?"0o":"")+c}return r.s<0?"-"+c:c}function RF(r,t){if(r.length>t)return r.length=t,!0}function Azt(r){return new this(r).abs()}function Tzt(r){return new this(r).acos()}function bzt(r){return new this(r).acosh()}function wzt(r,t){return new this(r).plus(t)}function Rzt(r){return new this(r).asin()}function Mzt(r){return new this(r).asinh()}function Izt(r){return new this(r).atan()}function Lzt(r){return new this(r).atanh()}function Ozt(r,t){r=new this(r),t=new this(t);var e,i=this.precision,n=this.rounding,a=i+4;return!r.s||!t.s?e=new this(NaN):!r.d&&!t.d?(e=Ta(this,a,1).times(t.s>0?.25:.75),e.s=r.s):!t.d||r.isZero()?(e=t.s<0?Ta(this,i,n):new this(0),e.s=r.s):!r.d||t.isZero()?(e=Ta(this,a,1).times(.5),e.s=r.s):t.s<0?(this.precision=a,this.rounding=1,e=this.atan(Ue(r,t,a,1)),t=Ta(this,a,1),this.precision=i,this.rounding=n,e=r.s<0?e.minus(t):e.plus(t)):e=this.atan(Ue(r,t,a,1)),e}function Pzt(r){return new this(r).cbrt()}function Fzt(r){return Mt(r=new this(r),r.e+1,2)}function Bzt(r,t,e){return new this(r).clamp(t,e)}function Dzt(r){if(!r||typeof r!="object")throw Error(__+"Object expected");var t,e,i,n=r.defaults===!0,a=["precision",1,El,"rounding",0,8,"toExpNeg",-Rc,0,"toExpPos",0,Rc,"maxE",0,Rc,"minE",-Rc,0,"modulo",0,9];for(t=0;t<a.length;t+=3)if(e=a[t],n&&(this[e]=bE[e]),(i=r[e])!==void 0)if(pi(i)===i&&i>=a[t+1]&&i<=a[t+2])this[e]=i;else throw Error(ll+e+": "+i);if(e="crypto",n&&(this[e]=bE[e]),(i=r[e])!==void 0)if(i===!0||i===!1||i===0||i===1)if(i)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[e]=!0;else throw Error(MH);else this[e]=!1;else throw Error(ll+e+": "+i);return this}function Nzt(r){return new this(r).cos()}function kzt(r){return new this(r).cosh()}function NH(r){var t,e,i;function n(a){var o,s,l,u=this;if(!(u instanceof n))return new n(a);if(u.constructor=n,MF(a)){u.s=a.s,Wt?!a.d||a.e>n.maxE?(u.e=NaN,u.d=null):a.e<n.minE?(u.e=0,u.d=[0]):(u.e=a.e,u.d=a.d.slice()):(u.e=a.e,u.d=a.d?a.d.slice():a.d);return}if(l=typeof a,l==="number"){if(a===0){u.s=1/a<0?-1:1,u.e=0,u.d=[0];return}if(a<0?(a=-a,u.s=-1):u.s=1,a===~~a&&a<1e7){for(o=0,s=a;s>=10;s/=10)o++;Wt?o>n.maxE?(u.e=NaN,u.d=null):o<n.minE?(u.e=0,u.d=[0]):(u.e=o,u.d=[a]):(u.e=o,u.d=[a]);return}else if(a*0!==0){a||(u.s=NaN),u.e=NaN,u.d=null;return}return ME(u,a.toString())}else if(l!=="string")throw Error(ll+a);return(s=a.charCodeAt(0))===45?(a=a.slice(1),u.s=-1):(s===43&&(a=a.slice(1)),u.s=1),LH.test(a)?ME(u,a):Ezt(u,a)}if(n.prototype=it,n.ROUND_UP=0,n.ROUND_DOWN=1,n.ROUND_CEIL=2,n.ROUND_FLOOR=3,n.ROUND_HALF_UP=4,n.ROUND_HALF_DOWN=5,n.ROUND_HALF_EVEN=6,n.ROUND_HALF_CEIL=7,n.ROUND_HALF_FLOOR=8,n.EUCLID=9,n.config=n.set=Dzt,n.clone=NH,n.isDecimal=MF,n.abs=Azt,n.acos=Tzt,n.acosh=bzt,n.add=wzt,n.asin=Rzt,n.asinh=Mzt,n.atan=Izt,n.atanh=Lzt,n.atan2=Ozt,n.cbrt=Pzt,n.ceil=Fzt,n.clamp=Bzt,n.cos=Nzt,n.cosh=kzt,n.div=Uzt,n.exp=zzt,n.floor=Hzt,n.hypot=$zt,n.ln=Wzt,n.log=Vzt,n.log10=Xzt,n.log2=Gzt,n.max=Yzt,n.min=jzt,n.mod=Zzt,n.mul=qzt,n.pow=Kzt,n.random=Qzt,n.round=Jzt,n.sign=tHt,n.sin=eHt,n.sinh=rHt,n.sqrt=iHt,n.sub=nHt,n.sum=aHt,n.tan=oHt,n.tanh=sHt,n.trunc=lHt,r===void 0&&(r={}),r&&r.defaults!==!0)for(i=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],t=0;t<i.length;)r.hasOwnProperty(e=i[t++])||(r[e]=this[e]);return n.config(r),n}function Uzt(r,t){return new this(r).div(t)}function zzt(r){return new this(r).exp()}function Hzt(r){return Mt(r=new this(r),r.e+1,3)}function $zt(){var r,t,e=new this(0);for(Wt=!1,r=0;r<arguments.length;)if(t=new this(arguments[r++]),t.d)e.d&&(e=e.plus(t.times(t)));else{if(t.s)return Wt=!0,new this(1/0);e=t}return Wt=!0,e.sqrt()}function MF(r){return r instanceof ka||r&&r.toStringTag===IH||!1}function Wzt(r){return new this(r).ln()}function Vzt(r,t){return new this(r).log(t)}function Gzt(r){return new this(r).log(2)}function Xzt(r){return new this(r).log(10)}function Yzt(){return FH(this,arguments,"lt")}function jzt(){return FH(this,arguments,"gt")}function Zzt(r,t){return new this(r).mod(t)}function qzt(r,t){return new this(r).mul(t)}function Kzt(r,t){return new this(r).pow(t)}function Qzt(r){var t,e,i,n,a=0,o=new this(1),s=[];if(r===void 0?r=this.precision:sn(r,1,El),i=Math.ceil(r/Nt),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(i));a<i;)n=t[a],n>=429e7?t[a]=crypto.getRandomValues(new Uint32Array(1))[0]:s[a++]=n%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(i*=4);a<i;)n=t[a]+(t[a+1]<<8)+(t[a+2]<<16)+((t[a+3]&127)<<24),n>=214e7?crypto.randomBytes(4).copy(t,a):(s.push(n%1e7),a+=4);a=i/4}else throw Error(MH);else for(;a<i;)s[a++]=Math.random()*1e7|0;for(i=s[--a],r%=Nt,i&&r&&(n=Sr(10,Nt-r),s[a]=(i/n|0)*n);s[a]===0;a--)s.pop();if(a<0)e=0,s=[0];else{for(e=-1;s[0]===0;e-=Nt)s.shift();for(i=1,n=s[0];n>=10;n/=10)i++;i<Nt&&(e-=Nt-i)}return o.e=e,o.d=s,o}function Jzt(r){return Mt(r=new this(r),r.e+1,this.rounding)}function tHt(r){return r=new this(r),r.d?r.d[0]?r.s:0*r.s:r.s||NaN}function eHt(r){return new this(r).sin()}function rHt(r){return new this(r).sinh()}function iHt(r){return new this(r).sqrt()}function nHt(r,t){return new this(r).sub(t)}function aHt(){var r=0,t=arguments,e=new this(t[r]);for(Wt=!1;e.s&&++r<t.length;)e=e.plus(t[r]);return Wt=!0,Mt(e,this.precision,this.rounding)}function oHt(r){return new this(r).tan()}function sHt(r){return new this(r).tanh()}function lHt(r){return Mt(r=new this(r),r.e+1,1)}it[Symbol.for("nodejs.util.inspect.custom")]=it.toString;it[Symbol.toStringTag]="Decimal";var ka=it.constructor=NH(bE);Om=new ka(Om);Pm=new ka(Pm);var cc,kH=function(r){return typeof r=="number"?Number.isNaN(r):r&&typeof r=="string"?Number.isNaN(Number(r)):!0},a2=function(r,t,e){return e===void 0&&(e=!1),r!=null&&r.length?r.reduce(function(i,n){var a=kt(n,t),o=kH(a);if(e&&o)return i;var s=o?0:a;return i.push(new ka(s)),i},[]):[]},UH=function(r,t){var e=a2(r,t);return e.length?ka.sum.apply(ka,ft([],rt(e),!1)).toNumber():0},IF=function(r,t,e){var i=a2(t,e,!0);if(i!=null&&i.length)return ka[r].apply(ka,ft([],rt(i),!1)).toNumber()},uHt=function(r,t){var e=a2(r,t);return e!=null&&e.length?ka.sum.apply(ka,ft([],rt(e),!1)).dividedBy(e.length).toNumber():0},cHt=(cc={},cc[Zl.SUM]=UH,cc[Zl.MIN]=function(r,t){return IF("min",r,t)},cc[Zl.MAX]=function(r,t){return IF("max",r,t)},cc[Zl.AVG]=uHt,cc),hHt=function(r){return Fe(r)&&"values"in r},fHt=function(r){var t=r.spreadsheet,e=r.position,i=r.tooltipContainer,n=r.autoAdjustBoundary,a=t.getCanvasElement(),o=e.x+aF.x,s=e.y+aF.y;if(!n||!a)return{x:o,y:s};var l=n==="body",u=t.facet.panelBBox,c=u.maxX,h=u.maxY,f=t.options,d=f.width,v=f.height,p=a.getBoundingClientRect(),g=p.top,m=p.left,y=i.getBoundingClientRect(),_=y.width,x=y.height,C=document.body.getBoundingClientRect(),A=C.width,b=C.height,R=l?A:Math.min(d,c)+m,M=l?b:Math.min(v,h)+g;return o+_>=R&&(o=R-_),s+x>=M&&(s=M-x),{x:o,y:s}},dHt=function(r){return U({operator:{onClick:Wy,menus:[]},enterable:!0,enableFormat:!0},r)},IE=function(r){return U(U({},r==null?void 0:r.colQuery),r==null?void 0:r.rowQuery)},Dg=function(r,t){var e;if(r){var i=t.style,n=t.className,a=n===void 0?[]:n,o=t.visible;if(i&&Object.assign(r.style,i),a.length){var s=a.filter(Boolean);(e=r.classList).add.apply(e,ft([],rt(s),!1))}r.classList.toggle(skt,o),r.classList.toggle(lkt,!o)}},vHt=function(r){var t=Si(r)&&Number.isNaN(r),e=r==="";return Or(r)||t||e?"-":r},o2=function(r,t){var e,i=(e=r==null?void 0:r.dataSet)===null||e===void 0?void 0:e.getFieldFormatter(t);return function(n,a){return vHt(i(n,a))}},p0=function(r,t){var e,i=t.data,n=t.field,a=t.valueField,o=t.useCompleteDataForFormatter,s=o===void 0?!0:o,l=(e=r==null?void 0:r.dataSet)===null||e===void 0?void 0:e.getFieldName(n),u=o2(r,n),c=Fe(i[n])?JSON.stringify(i[n]):i[n],h=u(a||c,s?i:void 0);return{name:l,value:h}},LF=function(r,t,e){var i=ys(Tc([],t),function(a){return a!==Kt&&e[a]}),n=ue(i,function(a){return p0(r,{data:e,field:a,useCompleteDataForFormatter:!1})});return n},pHt=function(r,t,e){var i,n,a,o,s=(e||{}).isTotals,l=[],u=[];if(t){var c=(n=(i=r==null?void 0:r.dataSet)===null||i===void 0?void 0:i.fields)===null||n===void 0?void 0:n.columns,h=(o=(a=r==null?void 0:r.dataSet)===null||a===void 0?void 0:a.fields)===null||o===void 0?void 0:o.rows;l=LF(r,Zh(c||[]),t),u=LF(r,h,t)}return st(l)&&st(u)&&s&&(l=[{value:Pr("总计")}]),{cols:l,rows:u}},gHt=function(r,t,e){if(t){var i=e.isTotals,n=t[Kt],a=t[n],o=[];if(i)o.push(p0(r,{data:t,field:n,valueField:kt(t,Zi)}));else if(hHt(a)&&r.getTooltipDataItemMappingCallback()){var s=hH(t,r.getTooltipDataItemMappingCallback());$t(s,function(l,u){o.push(p0(r,{data:s,field:u}))})}else o.push(p0(r,{data:t,field:n}));return o}},mHt=function(r,t,e){var i;if(e)return Pr("总计");var n=(i=r==null?void 0:r.dataSet)===null||i===void 0?void 0:i.getFieldName(t);return n&&n!=="undefined"?n:""},OF=function(r,t,e){e===void 0&&(e=!0);var i=[];return $t(t,function(n,a){$t(r,function(o){!e&&o.colIndex!==-1?i.push([a,o.colIndex]):e&&o.rowIndex!==-1&&i.push([o.rowIndex,a])})}),i},yHt=function(r,t){var e,i=t.rowLeafNodes,n=t.colLeafNodes,a=r.interaction.getState(),o=a.nodes,s=o===void 0?[]:o,l=a.cells,u=l===void 0?[]:l,c=(e=u==null?void 0:u[0])===null||e===void 0?void 0:e.type,h=s.filter(function(f){return f==null?void 0:f.isLeaf});return c===ut.COL_CELL?OF(h,i,!1):c===ut.ROW_CELL?OF(h,n):[]},_Ht=function(r,t,e){var i,n=(i=r.facet)===null||i===void 0?void 0:i.layoutResult,a=function(l){var u=t==null?void 0:t.getMeta(),c=u==null?void 0:u.isTotals,h=(t==null?void 0:t.cellType)===ut.COL_CELL,f=(t==null?void 0:t.cellType)===ut.ROW_CELL;if(!h&&!f)return!1;var d=n.colNodes.find(function(g){return g.colIndex===l.colIndex}),v=n.rowNodes.find(function(g){return g.rowIndex===l.rowIndex}),p=h?v==null?void 0:v.isTotals:d==null?void 0:d.isTotals;return!c&&(l==null?void 0:l.isTotals)||c&&p};if(e){var o=yHt(r,n);return Oa(ue(o,function(l){var u=rt(l,2),c=u[0],h=u[1],f=n.getCellMeta(c,h);if(!a(f))return(f==null?void 0:f.data)||IE(f)}))}var s=r.interaction.getCells();return s.filter(function(l){var u=n.getCellMeta(l.rowIndex,l.colIndex);return!a(u)}).map(function(l){var u=n.getCellMeta(l.rowIndex,l.colIndex);return(u==null?void 0:u.data)||IE(u)})},xHt=function(r){var t=r.spreadsheet,e=r.targetCell,i=r.options,n=i===void 0?{}:i,a=[],o={},s=t.isTableMode();if(s&&(n!=null&&n.showSingleTips)){var l=e.getMeta(),u=l!=null&&l.field?t.dataSet.getMultiData({field:l.field}):[t.dataSet.getRowData(l)];return[{selectedData:u,name:"",value:""}]}var c=_Ht(t,e,n.showSingleTips);return $t(c,function(h){var f;o[h==null?void 0:h[Kt]]?(f=o[h==null?void 0:h[Kt]])===null||f===void 0||f.push(h):o[h==null?void 0:h[Kt]]=[h]}),tz(o,function(h,f){var d,v=mHt(t,f,n==null?void 0:n.isTotals),p="",g="";if(e_(h,function(C){return kH(kt(C,Zi))})){var m=t.options.placeholder,y=qu(o,m);p=y,g=y}else{var _=o2(t,f),x=UH(h,Zi);g=x,p=(d=_==null?void 0:_(x,h))!==null&&d!==void 0?d:parseFloat(x.toPrecision(eU))}a.push({selectedData:h,name:v,value:p,originValue:g})}),a},CHt=function(r){if(r){var t=r.getMeta();if(!t.isTotals){var e=vi(t.spreadsheet.dataCfg.meta,{field:t.field||t.value||t.valueField}),i=e==null?void 0:e.field;return t.spreadsheet.dataSet.getFieldDescription(i)}}},EHt=function(r){var t=r.spreadsheet,e=r.cellInfos,i=e===void 0?[]:e,n=r.options,a=n===void 0?{}:n,o=r.targetCell,s=null,l=null,u=null,c=CHt(o),h=i[0]||{};if(!(a!=null&&a.hideSummary))s=xHt({spreadsheet:t,options:a,targetCell:o});else if(a.showSingleTips){var f=o2(t,h.valueField),d=f(h.value),v=a.enableFormat?t.dataSet.getFieldName(h.value)||d:t.dataSet.getFieldName(h.valueField);h.name=v||""}else l=pHt(t,h,a),u=gHt(t,h,a);var p=h||{},g=p.interpretation,m=p.infos,y=p.tips,_=p.name;return{summaries:s,interpretation:g,infos:m,tips:y,name:_,headInfo:l,details:u,description:c}},SHt=function(r){return ue(r,function(t){var e=t.getMeta();return bU({},e.query||{},pz(e,["colIndex","rowIndex"]))})},s2=function(r){if(!r.interaction.isSelectedState())return[];var t=r.dataCfg.fields.valueInCols;return r.interaction.getCells().reduce(function(e,i){var n=r.facet.layoutResult.getCellMeta(i==null?void 0:i.rowIndex,i==null?void 0:i.colIndex),a=IE(n);if(st(n)||st(a))return[];var o=U(U({},a),{colIndex:t?n.colIndex:null,rowIndex:t?null:n.rowIndex}),s=e.find(function(l){return Jr(o,l)});return s||e.push(o),e},[])},AHt=function(r,t){r===void 0&&(r={});var e=function(s){return eo(r,s)},i=r.col,n=r.row,a=r.data,o=r.corner;return t===ut.COL_CELL?e(i):t===ut.ROW_CELL?e(n):t===ut.DATA_CELL?e(a):t===ut.CORNER_CELL?e(o):U({},r)},l2=function(r,t){var e;if(!(!t||!r)){var i=(e=r.getCellType)===null||e===void 0?void 0:e.call(r,t==null?void 0:t.target);return AHt(r.options.tooltip,i)}},zH=function(r,t){var e=t.defaultMenus,i=e===void 0?[]:e,n=t.cell,a=function(s){return s===void 0&&(s=[]),s.filter(function(l){var u;return ri(l.visible)?l.visible(n):(u=l.visible)!==null&&u!==void 0?u:!0}).map(function(l){return l.children&&(l.children=a(l.children)),l})},o=a(r.menus);return{onClick:r.onClick,menus:Oa(ft(ft([],rt(i),!1),rt(o),!1))}},THt=function(r,t){for(var e=!1,i=t;i&&i!==document.body;){if(r===i){e=!0;break}i=i.parentElement}return e},bHt=function(r){r.store.set(vm,UT)},wHt=function(r,t){var e=r.store.get(vm,UT);r.store.set(vm,U(U({},e),t))},RHt=function(r,t){var e=r.store.get(vm,UT);return e[t]},HH=function(){function r(t){var e=this;this.displayFormattedValueMap=new Map,this.getFieldMeta=Yu(function(i,n){return vi(e.meta||n,function(a){return a.field===i})}),this.spreadsheet=t}return r.prototype.getFieldName=function(t){var e=kt(this.getFieldMeta(t,this.meta),"name",t);return Jkt(e)},r.prototype.getFieldFormatter=function(t){return kt(this.getFieldMeta(t,this.meta),"formatter",gi)},r.prototype.getFieldDescription=function(t){return kt(this.getFieldMeta(t,this.meta),"description")},r.prototype.setDataCfg=function(t){this.getFieldMeta.cache.clear();var e=this.processDataCfg(t),i=e.fields,n=e.meta,a=e.data,o=e.totalData,s=e.sortParams,l=e.filterParams;this.fields=i,this.meta=n,this.originData=a,this.totalData=o,this.sortParams=s,this.filterParams=l,this.displayData=this.originData,this.indexesData={}},r.prototype.processMeta=function(t,e){var i,n;return t===void 0&&(t=[]),ft(ft([],rt(t),!1),[LUt(t,(n=(i=this.spreadsheet)===null||i===void 0?void 0:i.options)===null||n===void 0?void 0:n.cornerExtraFieldText,e)],!1)},r.prototype.getDisplayDataSet=function(){return this.displayData||[]},r.prototype.isEmpty=function(){return st(this.getDisplayDataSet())},r.prototype.getEmptyViewIndexes=function(){return[]},r.prototype.getValueRangeByField=function(t){var e,i=RHt(this.spreadsheet,t);if(i)return i;var n=Oa(ue(this.originData,function(o){var s=o[t];return Or(s)?null:Number.parseFloat(s)})),a={maxValue:yh(n),minValue:Tb(n)};return wHt(this.spreadsheet,(e={},e[t]=a,e)),a},r.prototype.moreThanOneValue=function(){var t,e;return((e=(t=this.fields)===null||t===void 0?void 0:t.values)===null||e===void 0?void 0:e.length)>1},r}(),LE=function(){function r(t){this.extraField=t}return r.createProxyData=function(t,e){return new Proxy(t,new r(e))},r.createProxyDataList=function(t,e){return e.map(function(i){return r.createProxyData(t,i)})},r.prototype.get=function(t,e){return e===NT?t:e===Kt?this.extraField:e===Zi?t[this.extraField]:t[e]},r.prototype.has=function(t,e){return e===Kt||e===Zi?!0:e in t},r.prototype.ownKeys=function(t){return Object.keys(t).concat(Kt,Zi)},r.prototype.getOwnPropertyDescriptor=function(t,e){return e===Kt||e===Zi?{configurable:!0,enumerable:!0}:Object.getOwnPropertyDescriptor(t,e)},r}(),OE=function(r){yt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.handleDimensionValuesSort=function(){$t(e.sortParams,function(i){var n=i.sortFieldId,a=i.sortByMeasure;if(n){var o=ft([],rt(e.sortedDimensionValues[n]||[]),!1),s=V9t({dataSet:e,sortParam:i,originValues:o,isSortByMeasure:!st(a)});e.sortedDimensionValues[n]=s,e.handlePivotMetaSort(n,s)}})},e.getTotalStatus=function(i){var n=e.fields,a=n.columns,o=n.rows,s=function(u,c){if(c){var h=vi(u,function(f){return!oE(i,f)});return h&&h!==Mu(u)}return e_(u,function(f){return!oE(i,f)})},l=function(u,c){return c?u.filter(function(h){return h!==Kt}):u};return{isRowTotal:s(l(o,!e.spreadsheet.isValueInCols())),isRowSubTotal:s(o,!0),isColTotal:s(l(a,e.spreadsheet.isValueInCols())),isColSubTotal:s(a,!0)}},e}return t.prototype.getExistValuesByDataItem=function(e,i){return iH(e,i)},t.prototype.setDataCfg=function(e){r.prototype.setDataCfg.call(this,e);var i=this.fields.rows;this.sortedDimensionValues={},this.rowPivotMeta=new Map,this.colPivotMeta=new Map,this.dimensionValuesCache=new Map,this.transformIndexesData(this.originData.concat(this.totalData),i),this.handleDimensionValuesSort()},t.prototype.transformIndexesData=function(e,i){var n=this,a=this.fields,o=a.columns,s=a.values,l=a.valueInCols,u;return co.getInstance().debugCallback(mkt,function(){u=IUt({rows:i,columns:o,values:s,valueInCols:l,data:e,indexesData:n.indexesData,sortedDimensionValues:n.sortedDimensionValues,rowPivotMeta:n.rowPivotMeta,colPivotMeta:n.colPivotMeta,getExistValuesByDataItem:n.getExistValuesByDataItem}),n.indexesData=u.indexesData,n.rowPivotMeta=u.rowPivotMeta,n.colPivotMeta=u.colPivotMeta,n.sortedDimensionValues=u.sortedDimensionValues}),u},t.prototype.transformDrillDownData=function(e,i,n){var a=this,o,s=Zr.getFieldPath(n,!0),l=ft(ft([],rt(s),!1),[e],!1),u=this.spreadsheet.store,c=n==null?void 0:n.id,h=(o=u.get("drillDownIdPathMap"))!==null&&o!==void 0?o:new Map;h.has(c)&&($t(h.get(c),function(d){vE(a.indexesData,d)}),dF(this.rowPivotMeta,c));var f=this.transformIndexesData(i,l).paths;h.set(c,f),u.set("drillDownIdPathMap",h)},t.prototype.clearDrillDownData=function(e){var i=this,n=this.spreadsheet.store,a=n.get("drillDownIdPathMap");if(!a)return!1;var o=n.get("drillDownDataCache",[]);if(e){var s=a.get(e);s&&$t(s,function(d){vE(i.indexesData,d)}),dF(this.rowPivotMeta,e),a.delete(e);var l=ys(o,function(d){return a.has(d==null?void 0:d.rowId)});n.set("drillDownDataCache",l);var u=l.map(function(d){return d==null?void 0:d.drillLevel}),c=n.get("drillDownFieldInLevel",[]),h=c.filter(function(d){return wi(u,d==null?void 0:d.drillLevel)});n.set("drillDownFieldInLevel",h)}else{a.clear();var f=this.spreadsheet.store.get("originalDataCfg");st(f)||this.spreadsheet.setDataCfg(f),this.spreadsheet.store.set("drillItemsNum",-1),this.spreadsheet.store.set("drillDownDataCache",[]),this.spreadsheet.store.set("drillDownFieldInLevel",[])}return n.set("drillDownIdPathMap",a),!0},t.prototype.handlePivotMetaSort=function(e,i){var n=this.fields,a=n.rows,o=n.columns;wi(a,e)?this.rowPivotMeta=SF({pivotMeta:this.rowPivotMeta,dimensions:a,sortFieldId:e,sortedDimensionValues:i}):wi(o,e)&&(this.colPivotMeta=SF({pivotMeta:this.colPivotMeta,dimensions:o,sortFieldId:e,sortedDimensionValues:i}))},t.prototype.processDataCfg=function(e){var i=e.data,n=e.meta,a=n===void 0?[]:n,o=e.fields,s=e.sortParams,l=s===void 0?[]:s,u=e.totalData,c=o.columns,h=o.rows,f=o.values,d=o.valueInCols,v=o.customValueOrder,p=c,g=h;d?p=this.isCustomMeasuresPosition(v)?this.handleCustomMeasuresOrder(v,p):Vo(ft(ft([],rt(c),!1),[Kt],!1)):g=this.isCustomMeasuresPosition(v)?this.handleCustomMeasuresOrder(v,g):Vo(ft(ft([],rt(h),!1),[Kt],!1));var m=this.processMeta(a,Pr("数值"));return{data:i,totalData:u,meta:m,fields:U(U({},o),{rows:g,columns:p,values:f}),sortParams:l}},t.prototype.getFieldsAndPivotMetaByField=function(e){var i=this.fields||{},n=i.rows,a=n===void 0?[]:n,o=i.columns,s=o===void 0?[]:o;return a.includes(e)?{dimensions:a,pivotMeta:this.rowPivotMeta}:s.includes(e)?{dimensions:s,pivotMeta:this.colPivotMeta}:{}},t.prototype.getDimensionValues=function(e,i){i===void 0&&(i={});var n=this.getFieldsAndPivotMetaByField(e),a=n.pivotMeta,o=n.dimensions;if(!a||!o)return[];var s=st(i);if(this.dimensionValuesCache.has(e)&&s)return this.dimensionValuesCache.get(e);var l=Ul(i,o,u0),u=nH({pivotMeta:a,dimensionValues:l,fields:o,fieldIdx:a_(o,e),queryType:Yn.DetailOnly,sortedDimensionValues:this.sortedDimensionValues}),c=Vo(u.map(function(h){return h.value}));return s&&this.dimensionValuesCache.set(e,c),c},t.prototype.getTotalValue=function(e,i){var n,a=this.spreadsheet.options,o=Cz(i),s=o?i:this.getTotalStatus(e),l=RUt(s,a==null?void 0:a.totals)||{},u=l.aggregation,c=l.calcFunc,h=st(a==null?void 0:a.totals)&&!this.spreadsheet.isHierarchyTreeType()?Zl.SUM:"",f=cHt[u||h];if(f||c){var d=this.getMultiData(e,{queryType:Yn.DetailOnly}),v=void 0;return c?v=c(e,d,this.spreadsheet):f&&(v=f(d,Zi)),U(U({},e),(n={},n[Zi]=v,n[e[Kt]]=v,n))}},t.prototype.getCellData=function(e){var i,n,a,o=e||{},s=o.query,l=s===void 0?{}:s,u=o.rowNode,c=o.isTotals,h=c===void 0?!1:c,f=o.totalStatus,d=this.fields,v=d.rows,p=d.columns,g=v,m=(i=this.spreadsheet)===null||i===void 0?void 0:i.store.get("drillDownIdPathMap"),y=Array.from((n=m==null?void 0:m.keys())!==null&&n!==void 0?n:[]).some(function(b){return u==null?void 0:u.id.startsWith(b)});u&&y&&(g=(a=Zr.getFieldPath(u,y))!==null&&a!==void 0?a:v);var _=Ul(l,g),x=Ul(l,p),C=Mm({rowDimensionValues:_,colDimensionValues:x,rowPivotMeta:this.rowPivotMeta,colPivotMeta:this.colPivotMeta,rowFields:g,colFields:p,prefix:Rm(g,p)}),A=kt(this.indexesData,C);if(A)return LE.createProxyData(A,l[Kt]);if(h)return this.getTotalValue(l,f)},t.prototype.getQueryExtraFields=function(e){var i=this.fields.values,n=e[Kt];return n?wi(i,n)?[n]:[]:i},t.prototype.getMultiData=function(e,i,n,a,o){var s,l,u,c;e===void 0&&(e={}),a===void 0&&(a=[]),o===void 0&&(o=!0),st(e)&&console.warn("query: ".concat(e,` shouldn't be empty, you can get all data from dataCfg if you're intended.
 you should use { EXTRA_FIELD: xxx} as least if you want query all specific value data`));var h=Fe(i)?i:{queryType:o?Yn.All:Yn.DetailOnly,drillDownFields:a},f=h.drillDownFields,d=f===void 0?[]:f,v=h.queryType,p=v===void 0?Yn.All:v,g=this.fields,m=g.rows,y=g.columns,_=st(d)?m:m.concat(d),x=Ul(e,_,u0),C=Ul(e,y,u0),A=PUt({rowDimensionValues:x,colDimensionValues:C,rowPivotMeta:this.rowPivotMeta,colPivotMeta:this.colPivotMeta,rowFields:_,colFields:y,sortedDimensionValues:this.sortedDimensionValues,queryType:p}),b=A.rowQueries,R=A.colQueries,M=Rm(_,y),O=[];try{for(var F=ia(b),D=F.next();!D.done;D=F.next()){var H=D.value;try{for(var j=(u=void 0,ia(R)),$=j.next();!$.done;$=j.next()){for(var k=$.value,V=Mm({rowDimensionValues:H,colDimensionValues:k,rowPivotMeta:this.rowPivotMeta,colPivotMeta:this.colPivotMeta,rowFields:_,colFields:y,prefix:M}),Q=!1,Y=this.indexesData,tt=function(ht){var vt=V[ht];Q?ov(vt)?Y=FUt(Y,p):Y=Oa(ue(Y,function(It){return It==null?void 0:It[vt]})):ov(vt)?(Q=!0,Y=Oa([Y]),ht--):Y=Y==null?void 0:Y[vt],et=ht},et,dt=0;dt<V.length;dt++)tt(dt),dt=et;Lt(Y)?O.push.apply(O,ft([],rt(Y),!1)):Y&&O.push(Y)}}catch(ht){u={error:ht}}finally{try{$&&!$.done&&(c=j.return)&&c.call(j)}finally{if(u)throw u.error}}}}catch(ht){s={error:ht}}finally{try{D&&!D.done&&(l=F.return)&&l.call(F)}finally{if(s)throw s.error}}var Et=this.getQueryExtraFields(e);return ap(Vo(O),function(ht){return ht?LE.createProxyDataList(ht,Et):[]})},t.prototype.getFieldFormatter=function(e,i){return e===So?this.getFieldFormatterForTotalValue(i):r.prototype.getFieldFormatter.call(this,e)},t.prototype.getFieldFormatterForTotalValue=function(e){var i;return!this.spreadsheet.isValueInCols()&&e&&(i=kt(e.rowQuery,Kt)),i=i??kt(this.fields.values,0),r.prototype.getFieldFormatter.call(this,i)},t.prototype.handleCustomMeasuresOrder=function(e,i){var n=Vo(ft([],rt(i),!1));return i.length>=e?(n.splice(e,0,Kt),n):ft(ft([],rt(n),!1),[Kt],!1)},t.prototype.isCustomMeasuresPosition=function(e){return Si(e)},t.prototype.getRowData=function(e){return this.getMultiData(e.rowQuery)},t}(HH),MHt=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getCellData=function(e){var i=e.query,n=this.fields,a=n.rows,o=n.columns,s=Ul(i,a),l=Ul(i,o),u=Mm({rowDimensionValues:s,colDimensionValues:l,rowPivotMeta:this.rowPivotMeta,colPivotMeta:this.colPivotMeta,rowFields:a,colFields:o,prefix:Rm(a,o)}),c=kt(this.indexesData,u);return c&&LE.createProxyData(c,i[Kt])},t.prototype.processDataCfg=function(e){var i=e.meta,n=this.processMeta(i,Pr("指标"));return U(U({},e),{meta:n,fields:U(U({},e.fields),{rows:[Kt],valueInCols:!1})})},t}(OE),IHt=function(r){yt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.handleDimensionValueFilter=function(){$t(e.filterParams,function(i){var n=i.filterKey,a=i.filteredValues,o=i.customFilter,s=new Set(a),l=function(c){return!s.has(c[n])},u=ys(e.displayData,function(c){return o?o(c)&&l(c):l(c)});e.displayData=e.getDisplayData(u)})},e.handleDimensionValuesSort=function(){$t(e.sortParams,function(i){var n,a=i.sortFieldId,o=i.sortBy,s=i.sortFunc,l=i.sortMethod,u=i.query;if(a){var c=e.displayData,h=[];if(u){var f=[];c.forEach(function(y){for(var _=Object.keys(u),x=!0,C=0;C<_.length;C++){var A=_[C];if(y[A]!==u[A]){x=!1,h.push(y);break}}x&&f.push(y)}),c=f}var d=c;if(s)d=s(U(U({},i),{data:c}));else if(o&&!ri(o)){var v=ft([],rt(o),!1).reverse();d=c.sort(function(y,_){var x=v.indexOf(y[a]),C=v.indexOf(_[a]);return C-x})}else if(qh(l)||e2(l)){var p=qu(e.spreadsheet,(n=e.spreadsheet.options)===null||n===void 0?void 0:n.placeholder),g=ri(o)?o:null,m=function(y){return y[a]===p?Number.MIN_VALUE:y[a]};d=Mb(c,[g||m],[l.toLocaleLowerCase()])}h.length&&(d=ft(ft([],rt(d),!1),rt(h),!1)),e.displayData=e.getDisplayData(d)}})},e}return t.prototype.processDataCfg=function(e){return e},t.prototype.setDataCfg=function(e){r.prototype.setDataCfg.call(this,e),this.handleDimensionValueFilter(),this.handleDimensionValuesSort()},t.prototype.getStartFrozenRows=function(e){var i=(this.spreadsheet.options||{}).frozenRowCount;return i?e.slice(0,i):[]},t.prototype.getEndFrozenRows=function(e){var i=(this.spreadsheet.options||{}).frozenTrailingRowCount;return i?e.slice(-i):[]},t.prototype.getDisplayData=function(e){var i=this.getStartFrozenRows(e),n=this.getEndFrozenRows(e),a=e.slice(i.length||0,-n.length||void 0);return ft(ft(ft([],rt(i),!1),rt(a),!1),rt(n),!1)},t.prototype.getDimensionValues=function(){return[]},t.prototype.getCellData=function(e){var i=e.query;if(!(this.displayData.length===0&&i.rowIndex===0)){var n=this.displayData[i.rowIndex];return!Ru(i,"field")||!Fe(n)?n:n[i.field]}},t.prototype.getMultiData=function(e){if(!e)return this.displayData;var i=this.displayData[e.rowIndex]?[this.displayData[e.rowIndex]]:this.displayData;return Ru(e,"field")?i.map(function(n){return n[e.field]}):i},t.prototype.getRowData=function(e){return this.getCellData({query:{rowIndex:e.rowIndex}})},t}(HH);function u2(r,t,e){r.prototype=t.prototype=e,e.constructor=r}function $H(r,t){var e=Object.create(r.prototype);for(var i in t)e[i]=t[i];return e}function pp(){}var hv=.7,Bm=1/hv,Gc="\\s*([+-]?\\d+)\\s*",fv="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",yo="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",LHt=/^#([0-9a-f]{3,8})$/,OHt=new RegExp("^rgb\\("+[Gc,Gc,Gc]+"\\)$"),PHt=new RegExp("^rgb\\("+[yo,yo,yo]+"\\)$"),FHt=new RegExp("^rgba\\("+[Gc,Gc,Gc,fv]+"\\)$"),BHt=new RegExp("^rgba\\("+[yo,yo,yo,fv]+"\\)$"),DHt=new RegExp("^hsl\\("+[fv,yo,yo]+"\\)$"),NHt=new RegExp("^hsla\\("+[fv,yo,yo,fv]+"\\)$"),PF={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};u2(pp,dv,{copy:function(r){return Object.assign(new this.constructor,this,r)},displayable:function(){return this.rgb().displayable()},hex:FF,formatHex:FF,formatHsl:kHt,formatRgb:BF,toString:BF});function FF(){return this.rgb().formatHex()}function kHt(){return WH(this).formatHsl()}function BF(){return this.rgb().formatRgb()}function dv(r){var t,e;return r=(r+"").trim().toLowerCase(),(t=LHt.exec(r))?(e=t[1].length,t=parseInt(t[1],16),e===6?DF(t):e===3?new Cn(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):e===8?Ng(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):e===4?Ng(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=OHt.exec(r))?new Cn(t[1],t[2],t[3],1):(t=PHt.exec(r))?new Cn(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=FHt.exec(r))?Ng(t[1],t[2],t[3],t[4]):(t=BHt.exec(r))?Ng(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=DHt.exec(r))?UF(t[1],t[2]/100,t[3]/100,1):(t=NHt.exec(r))?UF(t[1],t[2]/100,t[3]/100,t[4]):PF.hasOwnProperty(r)?DF(PF[r]):r==="transparent"?new Cn(NaN,NaN,NaN,0):null}function DF(r){return new Cn(r>>16&255,r>>8&255,r&255,1)}function Ng(r,t,e,i){return i<=0&&(r=t=e=NaN),new Cn(r,t,e,i)}function UHt(r){return r instanceof pp||(r=dv(r)),r?(r=r.rgb(),new Cn(r.r,r.g,r.b,r.opacity)):new Cn}function PE(r,t,e,i){return arguments.length===1?UHt(r):new Cn(r,t,e,i??1)}function Cn(r,t,e,i){this.r=+r,this.g=+t,this.b=+e,this.opacity=+i}u2(Cn,PE,$H(pp,{brighter:function(r){return r=r==null?Bm:Math.pow(Bm,r),new Cn(this.r*r,this.g*r,this.b*r,this.opacity)},darker:function(r){return r=r==null?hv:Math.pow(hv,r),new Cn(this.r*r,this.g*r,this.b*r,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:NF,formatHex:NF,formatRgb:kF,toString:kF}));function NF(){return"#"+V1(this.r)+V1(this.g)+V1(this.b)}function kF(){var r=this.opacity;return r=isNaN(r)?1:Math.max(0,Math.min(1,r)),(r===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(r===1?")":", "+r+")")}function V1(r){return r=Math.max(0,Math.min(255,Math.round(r)||0)),(r<16?"0":"")+r.toString(16)}function UF(r,t,e,i){return i<=0?r=t=e=NaN:e<=0||e>=1?r=t=NaN:t<=0&&(r=NaN),new no(r,t,e,i)}function WH(r){if(r instanceof no)return new no(r.h,r.s,r.l,r.opacity);if(r instanceof pp||(r=dv(r)),!r)return new no;if(r instanceof no)return r;r=r.rgb();var t=r.r/255,e=r.g/255,i=r.b/255,n=Math.min(t,e,i),a=Math.max(t,e,i),o=NaN,s=a-n,l=(a+n)/2;return s?(t===a?o=(e-i)/s+(e<i)*6:e===a?o=(i-t)/s+2:o=(t-e)/s+4,s/=l<.5?a+n:2-a-n,o*=60):s=l>0&&l<1?0:o,new no(o,s,l,r.opacity)}function zHt(r,t,e,i){return arguments.length===1?WH(r):new no(r,t,e,i??1)}function no(r,t,e,i){this.h=+r,this.s=+t,this.l=+e,this.opacity=+i}u2(no,zHt,$H(pp,{brighter:function(r){return r=r==null?Bm:Math.pow(Bm,r),new no(this.h,this.s,this.l*r,this.opacity)},darker:function(r){return r=r==null?hv:Math.pow(hv,r),new no(this.h,this.s,this.l*r,this.opacity)},rgb:function(){var r=this.h%360+(this.h<0)*360,t=isNaN(r)||isNaN(this.s)?0:this.s,e=this.l,i=e+(e<.5?e:1-e)*t,n=2*e-i;return new Cn(G1(r>=240?r-240:r+120,n,i),G1(r,n,i),G1(r<120?r+240:r-120,n,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var r=this.opacity;return r=isNaN(r)?1:Math.max(0,Math.min(1,r)),(r===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(r===1?")":", "+r+")")}}));function G1(r,t,e){return(r<60?t+(e-t)*r/60:r<180?e:r<240?t+(e-t)*(240-r)/60:t)*255}function c2(r){return function(){return r}}function HHt(r,t){return function(e){return r+e*t}}function $Ht(r,t,e){return r=Math.pow(r,e),t=Math.pow(t,e)-r,e=1/e,function(i){return Math.pow(r+i*t,e)}}function WHt(r){return(r=+r)==1?VH:function(t,e){return e-t?$Ht(t,e,r):c2(isNaN(t)?e:t)}}function VH(r,t){var e=t-r;return e?HHt(r,e):c2(isNaN(r)?t:r)}var zF=function r(t){var e=WHt(t);function i(n,a){var o=e((n=PE(n)).r,(a=PE(a)).r),s=e(n.g,a.g),l=e(n.b,a.b),u=VH(n.opacity,a.opacity);return function(c){return n.r=o(c),n.g=s(c),n.b=l(c),n.opacity=u(c),n+""}}return i.gamma=r,i}(1);function GH(r,t){t||(t=[]);var e=r?Math.min(t.length,r.length):0,i=t.slice(),n;return function(a){for(n=0;n<e;++n)i[n]=r[n]*(1-a)+t[n]*a;return i}}function XH(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function VHt(r,t){return(XH(t)?GH:YH)(r,t)}function YH(r,t){var e=t?t.length:0,i=r?Math.min(e,r.length):0,n=new Array(i),a=new Array(e),o;for(o=0;o<i;++o)n[o]=jH(r[o],t[o]);for(;o<e;++o)a[o]=t[o];return function(s){for(o=0;o<i;++o)a[o]=n[o](s);return a}}function GHt(r,t){var e=new Date;return r=+r,t=+t,function(i){return e.setTime(r*(1-i)+t*i),e}}function FE(r,t){return r=+r,t=+t,function(e){return r*(1-e)+t*e}}function XHt(r,t){var e={},i={},n;(r===null||typeof r!="object")&&(r={}),(t===null||typeof t!="object")&&(t={});for(n in t)n in r?e[n]=jH(r[n],t[n]):i[n]=t[n];return function(a){for(n in e)i[n]=e[n](a);return i}}var BE=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,X1=new RegExp(BE.source,"g");function YHt(r){return function(){return r}}function jHt(r){return function(t){return r(t)+""}}function ZHt(r,t){var e=BE.lastIndex=X1.lastIndex=0,i,n,a,o=-1,s=[],l=[];for(r=r+"",t=t+"";(i=BE.exec(r))&&(n=X1.exec(t));)(a=n.index)>e&&(a=t.slice(e,a),s[o]?s[o]+=a:s[++o]=a),(i=i[0])===(n=n[0])?s[o]?s[o]+=n:s[++o]=n:(s[++o]=null,l.push({i:o,x:FE(i,n)})),e=X1.lastIndex;return e<t.length&&(a=t.slice(e),s[o]?s[o]+=a:s[++o]=a),s.length<2?l[0]?jHt(l[0].x):YHt(t):(t=l.length,function(u){for(var c=0,h;c<t;++c)s[(h=l[c]).i]=h.x(u);return s.join("")})}function jH(r,t){var e=typeof t,i;return t==null||e==="boolean"?c2(t):(e==="number"?FE:e==="string"?(i=dv(t))?(t=i,zF):ZHt:t instanceof dv?zF:t instanceof Date?GHt:XH(t)?GH:Array.isArray(t)?YH:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?XHt:FE)(r,t)}var uu;(function(r){r.ScrollChange="scroll-change",r.ScrollEnd="scroll-end"})(uu||(uu={}));var Y1=function(r){yt(t,r);function t(e){var i=r.call(this,e)||this;i.isMobile=!1,i.eventHandlers=[],i.scrollFrameId=null,i.getCoordinatesName=function(){var d=i.isHorizontal?"x1":"y1",v=i.isHorizontal?"x2":"y2";return{from:d,to:v}},i.getCoordinatesWithBBoxExtraPadding=function(){var d=i.theme.size,v=i.isHorizontal?0:d/2,p=i.isHorizontal?d:d/2;return{start:i.thumbOffset+v,end:i.thumbOffset+i.thumbLen-p}},i.current=function(){var d=i.thumbLen/i.trackLen,v=i.thumbOffset/i.trackLen;return v/(1-d)},i.updateThumbLen=function(d){if(i.thumbLen!==d){i.thumbLen=d;var v=i.getCoordinatesName();i.thumbShape.attr(v.to,i.thumbOffset+d),i.emitScrollChange(i.thumbOffset/(i.trackLen-i.thumbLen)*i.scrollTargetMaxOffset,!1)}},i.updateThumbOffset=function(d,v){var p;v===void 0&&(v=!0);var g=i.validateRange(d),m=i.thumbOffset===g&&g!==0;if(!m){i.thumbOffset=g;var y=i.getCoordinatesName(),_=y.from,x=y.to,C=i.getCoordinatesWithBBoxExtraPadding(),A=C.start,b=C.end;i.thumbShape.attr((p={},p[_]=A,p[x]=b,p)),v&&i.emitScrollChange(g/(i.trackLen-i.thumbLen)*i.scrollTargetMaxOffset,!1)}},i.onlyUpdateThumbOffset=function(d){var v;i.updateThumbOffset(d,!1),(v=i.get("canvas"))===null||v===void 0||v.draw()},i.emitScrollChange=function(d,v){v===void 0&&(v=!0),cancelAnimationFrame(i.scrollFrameId),i.scrollFrameId=requestAnimationFrame(function(){i.emit(uu.ScrollChange,{offset:d,updateThumbOffset:v})})},i.addEventListener=function(d,v,p){return d==null||d.addEventListener(v,p,!1),{remove:function(){d==null||d.removeEventListener(v,p,!1)}}},i.addEvent=function(d,v,p){d.on(v,p),i.eventHandlers.push({target:d,type:v,handler:p})},i.initScrollBar=function(){i.scrollBarGroup=i.createScrollBarGroup(),i.scrollBarGroup.move(i.position.x,i.position.y),i.bindEvents()},i.createScrollBarGroup=function(){var d=i.addGroup({className:i.isHorizontal?"horizontalBar":"verticalBar"});return i.trackShape=i.createTrackShape(d),i.thumbShape=i.createThumbShape(d),d},i.createTrackShape=function(d){var v=i.theme,p=v.lineCap,g=p===void 0?"round":p,m=v.trackColor,y=v.size,_={lineWidth:y,stroke:m,lineCap:g};return i.isHorizontal?d.addShape("line",{attrs:U(U({},_),{x1:0,y1:y/2,x2:i.trackLen,y2:y/2})}):d.addShape("line",{attrs:U(U({},_),{x1:y/2,y1:0,x2:y/2,y2:i.trackLen})})},i.createThumbShape=function(d){var v=i.theme,p=v.size,g=v.lineCap,m=g===void 0?"round":g,y=v.thumbColor,_={lineWidth:p,stroke:y,lineCap:m,cursor:"default"},x=i.getCoordinatesWithBBoxExtraPadding(),C=x.start,A=x.end;return i.isHorizontal?d.addShape("line",{attrs:U(U({},_),{x1:C,y1:p/2,x2:A,y2:p/2})}):d.addShape("line",{attrs:U(U({},_),{x1:p/2,y1:C,x2:p/2,y2:A})})},i.bindEvents=function(){i.on("mousedown",i.onStartEvent(!1)),i.on("mouseup",i.onMouseUp),i.on("touchstart",i.onStartEvent(!0)),i.on("touchend",i.onMouseUp),i.trackShape.on("click",i.onTrackClick),i.thumbShape.on("mouseover",i.onTrackMouseOver),i.thumbShape.on("mouseout",i.onTrackMouseOut)},i.onStartEvent=function(d){return function(v){v.preventDefault(),i.isMobile=d;var p=i.isMobile?kt(v,"touches.0",v):v,g=p.clientX,m=p.clientY;i.startPos=i.isHorizontal?g:m,i.bindLaterEvent()}},i.bindLaterEvent=function(){var d=i.get("canvas"),v=document.body,p=[];i.isMobile?(p=[i.addEventListener(v,"touchmove",i.onMouseMove),i.addEventListener(v,"touchend",i.onMouseUp),i.addEventListener(v,"touchcancel",i.onMouseUp)],i.addEvent(d,"touchend",i.onMouseUp),i.addEvent(d,"touchcancel",i.onMouseUp)):(p=[i.addEventListener(v,"mousemove",i.onMouseMove),i.addEventListener(v,"mouseup",i.onMouseUp),i.addEventListener(v,"mouseleave",i.onMouseUp)],i.addEvent(d,"mouseup",i.onMouseUp)),i.clearEvents=function(){p.forEach(function(g){g==null||g.remove()}),$t(i.eventHandlers,function(g){var m;(m=g.target)===null||m===void 0||m.off(g.type,g.handler)}),i.eventHandlers.length=0}},i.onTrackClick=function(d){var v=i.isHorizontal?d.x-i.position.x-i.thumbLen/2:d.y-i.position.y-i.thumbLen/2,p=i.validateRange(v);i.updateThumbOffset(p)},i.onMouseMove=function(d){d.preventDefault();var v=i.isMobile?kt(d,"touches.0",d):d,p=v.clientX,g=v.clientY,m=i.isHorizontal?p:g,y=m-i.startPos;i.startPos=m,i.updateThumbOffset(i.thumbOffset+y)},i.onMouseUp=function(d){var v;i.emit(uu.ScrollEnd,{}),d.preventDefault(),(v=i.clearEvents)===null||v===void 0||v.call(i)},i.onTrackMouseOver=function(){var d=i.theme,v=d.thumbHoverColor,p=d.hoverSize;i.thumbShape.attr("stroke",v),i.thumbShape.attr("lineWidth",p)},i.onTrackMouseOut=function(){var d=i.theme,v=d.thumbColor,p=d.size;i.thumbShape.attr("stroke",v),i.thumbShape.attr("lineWidth",p)},i.validateRange=function(d){var v=d;return d+i.thumbLen>i.trackLen?v=i.trackLen-i.thumbLen:d+i.thumbLen<i.thumbLen&&(v=0),v};var n=e.isHorizontal,a=n===void 0?!1:n,o=e.trackLen,s=e.thumbLen,l=e.position,u=e.thumbOffset,c=u===void 0?0:u,h=e.theme,f=e.scrollTargetMaxOffset;return i.isHorizontal=a,i.thumbOffset=c,i.trackLen=o,i.thumbLen=s,i.position=l,i.theme=h,i.scrollTargetMaxOffset=f,i.initScrollBar(),i}return t}(Mo),ZH=function(r,t,e){if(e<=0)return{start:0,end:0};var i=mh(r,function(a,o){var s=t;return s>=a&&s<r[o+1]},0);i=Math.max(i,0);var n=e===t?i:mh(r,function(a,o){var s=e;return s>a&&s<=r[o+1]},i);return n=Math.min(n===-1?1/0:n,r.length-2),{start:i,end:n}},qHt=function(r,t){var e=t.width,i=t.originalWidth,n=Math.min(i-e,r);return n<0?0:n},j1=function(r,t,e){var i=Math.min(t-e,r);return i<0?0:i},pd=function(r,t){if(r===void 0&&(r=[]),st(r))return[];var e=[];return r.forEach(function(i){if(i instanceof t&&e.push(i),i instanceof Mo){var n=i.getChildren();n.forEach(function(a){a instanceof t&&e.push(a)})}}),e},qH=function(r,t,e){return e.slice(r,t+1).map(function(i){return i.x+i.width})},E_=function(r,t,e){for(var i=[],n=r;n<t+1;n++)i.push(e.getCellOffsetY(n+1));return i},KHt=function(r,t,e,i){var n=E_(r,t,i),a=i.getCellOffsetY(r);return n.map(function(o){return o-a+e})},HF=function(r,t,e){var i=rt(e,4),n=i[0],a=i[1],o=i[2],s=i[3];return r>=n&&r<=a&&t>=o&&t<=s},$F=function(r){for(var t=rt(r,4),e=t[0],i=t[1],n=t[2],a=t[3],o=[],s=e;s<=i;s+=1)for(var l=n;l<=a;l+=1)o.push([s,l]);return o},QHt=function(r,t){var e=[],i=[];if(st(r))return st(t)?{add:e,remove:i}:{add:$F(t),remove:i};if(st(t))return{add:e,remove:$F(r)};for(var n=rt(r,4),a=n[0],o=n[1],s=n[2],l=n[3],u=rt(t,4),c=u[0],h=u[1],f=u[2],d=u[3],v=a;v<=o;v++)for(var p=s;p<=l;p++)HF(v,p,t)||i.push([v,p]);for(var v=c;v<=h;v+=1)for(var p=f;p<=d;p+=1)HF(v,p,r)||e.push([v,p]);return{add:e,remove:i}},JHt=function(r,t){var e=[],i=[];return Object.keys(t).forEach(function(n){var a=QHt((r==null?void 0:r[n])||[],t[n]),o=a.add,s=a.remove;e.push.apply(e,ft([],rt(o),!1)),i.push.apply(i,ft([],rt(s),!1))}),{add:e,remove:i}},KH=function(){function r(t,e){e===void 0&&(e=!1),this.x=0,this.y=0,this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.width=0,this.height=0,this.originalWidth=0,this.originalHeight=0,this.viewportHeight=0,this.viewportWidth=0,this.facet=t,this.spreadsheet=t.spreadsheet,this.layoutResult=t.layoutResult,e&&this.calculateBBox()}return r}(),QH=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.calculateBBox=function(){var e=this.getCornerBBoxWidth(),i=this.getCornerBBoxHeight();this.width=e,this.height=i,this.maxX=e,this.maxY=i},t.prototype.getCornerBBoxOriginalHeight=function(){var e=this.layoutResult.colsHierarchy,i=this.spreadsheet.options.style.colCfg;return e.sampleNodeForLastLevel?Math.floor(e.height):i==null?void 0:i.height},t.prototype.getCornerBBoxHeight=function(){return this.originalHeight=this.getCornerBBoxOriginalHeight(),this.originalHeight},t.prototype.getCornerBBoxWidth=function(){var e=this.layoutResult.rowsHierarchy;return this.originalWidth=Math.floor(e.width+this.facet.getSeriesNumberWidth()),this.spreadsheet.isScrollContainsRowHeader()?this.originalWidth:this.adjustCornerBBoxWidth()},t.prototype.adjustCornerBBoxWidth=function(){var e=this.layoutResult.colsHierarchy,i=this.spreadsheet.options.width,n=i*hwt,a=e==null?void 0:e.width,o=i-this.originalWidth;if(this.originalWidth<=n||a<=o)return this.originalWidth;var s=0,l=i-n;return a<=l?s=this.originalWidth-(a-o):s=n,Math.floor(s)},t}(KH),t$t=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.calculateBBox=function(){this.originalWidth=this.facet.getRealWidth(),this.originalHeight=this.facet.getRealHeight();var e=this.facet.cornerBBox,i={x:Math.floor(e.maxX),y:Math.floor(e.maxY)},n=this.spreadsheet.theme.scrollBar.size,a=this.spreadsheet.options,o=a.width,s=a.height,l=Math.max(0,o-i.x),u=Math.max(0,s-i.y-n);this.x=i.x,this.y=i.y,this.width=l,this.height=u,this.viewportHeight=Math.abs(Math.floor(Math.min(u,this.originalHeight))),this.viewportWidth=Math.abs(Math.floor(Math.min(l,this.originalWidth))),this.maxX=i.x+this.viewportWidth,this.maxY=i.y+this.viewportHeight,this.minX=i.x,this.minY=i.y;var c=this.spreadsheet.options,h=c.frozenTrailingColCount,f=c.frozenTrailingRowCount;h>0&&(this.viewportWidth=this.width,this.maxX=i.x+this.width),f>0&&(this.viewportHeight=this.height,this.maxY=i.y+this.height)},t}(KH),h2=function(r){yt(t,r);function t(e){var i=r.call(this,e)||this;return i.isHeaderCellInViewport=function(n,a,o,s){return n+a>=o&&o+s>=n},i.headerConfig=e,i}return t.prototype.getConfig=function(){return this.headerConfig},t.prototype.clearResizeAreaGroup=function(e){var i=this.get("parent"),n=i==null?void 0:i.findById(e);n==null||n.clear()},t.prototype.render=function(e){this.clearResizeAreaGroup(e),this.clear(),this.layout(),this.offset(),this.clip()},t.prototype.onScrollXY=function(e,i,n){this.headerConfig.scrollX=e,this.headerConfig.scrollY=i,this.render(n)},t.prototype.onRowScrollX=function(e,i){this.headerConfig.scrollX=e,this.render(i)},t.prototype.clear=function(){r.prototype.clear.call(this)},t}(Mo),f2=function(r){yt(t,r);function t(e){var i=r.call(this,e)||this;return i.scrollGroup=i.addGroup({name:awt,zIndex:Xk}),i}return t.prototype.onColScroll=function(e,i){this.headerConfig.scrollX!==e&&(this.headerConfig.scrollX=e,this.render(i))},t.prototype.clip=function(){var e=this.headerConfig,i=e.width,n=e.height,a=e.scrollX,o=e.spreadsheet,s=o.isFrozenRowHeader();this.scrollGroup.setClip({type:"rect",attrs:{x:s?a:0,y:0,width:s?i:i+a,height:n}})},t.prototype.clear=function(){var e,i;(e=this.scrollGroup)===null||e===void 0||e.clear(),(i=this.background)===null||i===void 0||i.remove(!0)},t.prototype.getCellInstance=function(e,i,n){return new g_(e,i,n)},t.prototype.getCellGroup=function(e){return this.scrollGroup},t.prototype.isColCellInRect=function(e){var i=this.headerConfig,n=i.spreadsheet,a=i.cornerWidth,o=i.width,s=i.scrollX;return o+s>e.x&&s-(n.isFrozenRowHeader()?0:a)<e.x+e.width},t.prototype.layout=function(){var e=this,i=this.headerConfig,n=i.data,a=i.spreadsheet,o=a.options.colCell;$t(n,function(s){var l=s;if(e.isColCellInRect(l)){var u=(o==null?void 0:o(l,a,e.headerConfig))||e.getCellInstance(l,a,e.headerConfig);l.belongsCell=u;var c=e.getCellGroup(l);c.add(u)}})},t.prototype.offset=function(){var e=this.headerConfig,i=e.position,n=e.scrollX;v_(this.scrollGroup,i.x-n)},t}(h2),e$t=function(r){yt(t,r);function t(e){return r.call(this,e)||this}return t.getCornerHeader=function(e,i,n,a,o,s){var l=e.width,u=e.height,c=i.originalWidth,h=i.originalHeight,f=i.width,d=i.height,v=this.getCornerNodes({x:i.x,y:i.y},c,h,a.rows,a.columns,o.rowsHierarchy,o.colsHierarchy,a.dataSet,n,s);return new t({data:v,position:{x:i.x,y:i.y},width:f,height:d,originalHeight:h,originalWidth:c,viewportWidth:l,viewportHeight:u,hierarchyType:a.hierarchyType,hierarchyCollapse:a.hierarchyCollapse,rows:a.rows,columns:a.columns,seriesNumberWidth:n,spreadsheet:s})},t.getCornerNodes=function(e,i,n,a,o,s,l,u,c,h){var f,d,v,p=[],g=h.options.style.colCfg,m=l==null?void 0:l.sampleNodeForLastLevel,y=(f=m==null?void 0:m.y)!==null&&f!==void 0?f:0,_=(v=(d=m==null?void 0:m.height)!==null&&d!==void 0?d:g==null?void 0:g.height)!==null&&v!==void 0?v:0;if(c){var x=new Zr({id:"",key:cwt,value:Pr("序号")});x.x=e==null?void 0:e.x,x.y=y,x.width=c,x.height=_,x.isPivotMode=!0,x.spreadsheet=h,x.cornerType=Ea.Series,p.push(x)}if(h.isHierarchyTreeType()){var C=this.getTreeCornerText(h),A=new Zr({key:"",id:C,value:C});A.x=e.x+c,A.y=y,A.width=i-c,A.height=_,A.seriesNumberWidth=c,A.isPivotMode=!0,A.spreadsheet=h,A.cornerType=Ea.Row,p.push(A)}else s.sampleNodesForAllLevels.forEach(function(b){var R=a[b.level],M=new Zr({key:R,id:R,value:u.getFieldName(R)});M.x=b.x+c,M.y=y,M.width=b.width,M.height=_,M.field=R,M.isPivotMode=!0,M.cornerType=Ea.Row,M.spreadsheet=h,p.push(M)});return l.sampleNodesForAllLevels.forEach(function(b){if(b.level<l.maxLevel){var R=o[b.level],M=new Zr({key:R,id:R,value:u.getFieldName(R)});M.x=e.x,M.y=b.y,M.width=i,M.height=b.height,M.field=R,M.isPivotMode=!0,M.cornerType=Ea.Col,M.spreadsheet=h,p.push(M)}}),p},t.getTreeCornerText=function(e){var i=e.dataSet.fields.rows,n=i===void 0?[]:i,a=e.options.cornerText;if(a)return a;var o=e.store.get("drillDownFieldInLevel",[]),s=o.map(function(u){return u.drillField}),l=n.filter(function(u){return!wi(s,u)}).map(function(u){return e.dataSet.getFieldName(u)}).join("/");return l},t.prototype.onCorScroll=function(e,i){this.headerConfig.scrollX=e,this.render(i)},t.prototype.destroy=function(){r.prototype.destroy.call(this)},t.prototype.layout=function(){this.renderCells()},t.prototype.renderCells=function(){var e=this,i,n,a,o,s=this.headerConfig,l=s.data,u=s.spreadsheet,c=(n=(i=u==null?void 0:u.facet)===null||i===void 0?void 0:i.cfg)===null||n===void 0?void 0:n.cornerHeader,h=(o=(a=u==null?void 0:u.facet)===null||a===void 0?void 0:a.cfg)===null||o===void 0?void 0:o.cornerCell;if(c){c(this,u,this.headerConfig);return}l.forEach(function(f){var d;h&&(d=h(f,e.headerConfig.spreadsheet,e.headerConfig)),st(d)&&(d=new G9t(f,e.headerConfig.spreadsheet,e.headerConfig)),e.add(d)})},t.prototype.offset=function(){var e=this.headerConfig.scrollX;v_(this,-e)},t.prototype.clip=function(){var e=this.headerConfig,i=e.width,n=e.height,a=e.scrollX;this.setClip({type:"rect",attrs:{x:a,y:0,width:i,height:n}})},t.prototype.getNodes=function(){return this.headerConfig.data||[]},t}(h2),r$t=function(r){yt(t,r);function t(e){var i=r.call(this,e)||this;return i.render(),i}return t.prototype.layout=function(){this.addCornerBottomBorder(),this.addCornerRightBorder(),this.addSplitLineShadow()},t.prototype.render=function(){this.clear(),this.layout()},t.prototype.onBorderScroll=function(e){this.cfg.scrollX=e;var i=this.cfg.position;Zo(this,i.x-e,0),this.render()},t.prototype.onChangeShadowVisibility=function(e,i){this.cfg.showViewportLeftShadow=e>0,this.cfg.showViewportRightShadow=Math.floor(e)<Math.floor(i),this.render()},t.prototype.addCornerRightBorder=function(){var e,i=this.cfg,n=i.isPivotMode;if(n){var a=i.width,o=i.height,s=i.viewportHeight,l=i.position,u=i.spreadsheet,c=(e=u.theme)===null||e===void 0?void 0:e.splitLine,h=l.x+a,f=l.y,d=l.y+o+s;this.addShape("line",{attrs:{x1:h,y1:f,x2:h,y2:d,stroke:c.verticalBorderColor,lineWidth:c.verticalBorderWidth,opacity:c.verticalBorderColorOpacity,lineDash:c.borderDash}})}},t.prototype.addCornerBottomBorder=function(){var e,i=this.cfg,n=i.width,a=i.height,o=i.viewportWidth,s=i.position,l=i.scrollX,u=i.scrollContainsRowHeader,c=i.spreadsheet,h=(e=c.theme)===null||e===void 0?void 0:e.splitLine,f=s.x,d=f+n+o+(u?l:0),v=s.y+a-1;this.addShape("line",{attrs:{x1:f,y1:v,x2:d,y2:v,stroke:h.horizontalBorderColor,lineWidth:h.horizontalBorderWidth,opacity:h.horizontalBorderColorOpacity,lineDash:h.borderDash}})},t.prototype.addSplitLineShadow=function(){var e,i=this.cfg,n=i.isPivotMode,a=i.spreadsheet,o=(e=a.theme)===null||e===void 0?void 0:e.splitLine;!n||!o.showShadow||!a.isFrozenRowHeader()||(this.addSplitLineLeftShadow(),this.addSplitLineRightShadow())},t.prototype.addSplitLineLeftShadow=function(){var e,i,n;if(this.cfg.showViewportLeftShadow){var a=this.cfg,o=a.width,s=a.height,l=a.viewportHeight,u=a.position,c=a.spreadsheet,h=(e=c.theme)===null||e===void 0?void 0:e.splitLine,f=u.x+o,d=u.y;this.addShape("rect",{attrs:{x:f,y:d,width:h.shadowWidth,height:l+s,fill:"l (0) 0:".concat((i=h.shadowColors)===null||i===void 0?void 0:i.left," 1:").concat((n=h.shadowColors)===null||n===void 0?void 0:n.right)}})}},t.prototype.addSplitLineRightShadow=function(){var e,i,n;if(this.cfg.showViewportRightShadow){var a=this.cfg,o=a.width,s=a.height,l=a.viewportHeight,u=a.viewportWidth,c=a.position,h=a.spreadsheet,f=(e=h.theme)===null||e===void 0?void 0:e.splitLine,d=c.x+o+u-f.shadowWidth,v=c.y;this.addShape("rect",{attrs:{x:d,y:v,width:f.shadowWidth,height:l+s,fill:"l (0) 0:".concat((i=f.shadowColors)===null||i===void 0?void 0:i.right," 1:").concat((n=f.shadowColors)===null||n===void 0?void 0:n.left)}})}},t}(Mo),d2=function(r){yt(t,r);function t(e){return r.call(this,e)||this}return t.prototype.destroy=function(){r.prototype.destroy.call(this),this.gm&&this.gm.destroy()},t.prototype.rowCellInRect=function(e){var i=this.headerConfig,n=i.width,a=i.viewportHeight,o=i.seriesNumberWidth,s=i.scrollY,l=i.scrollX;return a+s>e.y&&s<e.y+e.height&&n-o+l>e.x&&l-o<e.x+e.width},t.prototype.createCellInstance=function(e){return new vp(e,this.headerConfig.spreadsheet,this.headerConfig)},t.prototype.getCellGroup=function(e){return this},t.prototype.getCustomRowCell=function(){var e,i,n=this.headerConfig.spreadsheet;return(i=(e=n==null?void 0:n.facet)===null||e===void 0?void 0:e.cfg)===null||i===void 0?void 0:i.rowCell},t.prototype.layout=function(){var e=this,i=this.headerConfig,n=i.data,a=i.spreadsheet,o=this.getCustomRowCell();$t(n,function(s){if(e.rowCellInRect(s)&&s.height!==0){var l=void 0;o&&(l=o(s,a,e.headerConfig)),st(l)&&a.isPivotMode()&&(l=e.createCellInstance(s)),s.belongsCell=l;var u=e.getCellGroup(s);u.add(l)}})},t.prototype.offset=function(){var e=this.headerConfig,i=e.scrollX,n=e.scrollY,a=e.position,o=e.seriesNumberWidth;Zo(this,a.x-i+o,a.y-n)},t.prototype.clip=function(){var e=this.headerConfig,i=e.width,n=e.viewportHeight,a=e.scrollX,o=e.scrollY,s=e.seriesNumberWidth;this.setClip({type:"rect",attrs:{x:a-s,y:o,width:i,height:n}})},t}(h2),JH=function(r){yt(t,r);function t(e){var i=r.call(this,e)||this;i.scrollGroup=i.addGroup({name:lwt,zIndex:Xk}),i.frozenHeadGroup=i.addGroup({name:uwt,zIndex:Zd});var n=i.headerConfig,a=n.position,o=n.seriesNumberWidth;return Zo(i.frozenHeadGroup,a.x+o,a.y),i}return t.prototype.rowCellInRectXDir=function(e){var i=this.headerConfig,n=i.width,a=i.scrollX,o=i.seriesNumberWidth,s=e.x+o;return n+a>s&&a<s+e.width},t.prototype.rowCellInRectYDir=function(e){var i=this.headerConfig,n=i.viewportHeight,a=i.scrollY,o=e.y-this.getFrozenFirstRowHeight();return n+a>o&&a<o+e.height},t.prototype.rowCellInRect=function(e){var i=this.rowCellInRectXDir(e);return this.isFrozenRow(e)?i:i&&this.rowCellInRectYDir(e)},t.prototype.getCellGroup=function(e){return this.isFrozenRow(e)?this.frozenHeadGroup:this.scrollGroup},t.prototype.offset=function(){var e=this.headerConfig,i=e.scrollX,n=e.scrollY,a=e.position,o=e.seriesNumberWidth,s=a.x-i+o;Zo(this.scrollGroup,s,a.y-n),v_(this.frozenHeadGroup,s)},t.prototype.clip=function(){var e=this.headerConfig,i=e.width,n=e.viewportHeight,a=e.scrollX,o=e.scrollY,s=e.seriesNumberWidth,l=a-s;this.scrollGroup.setClip({type:"rect",attrs:{x:l,y:o+this.getFrozenFirstRowHeight(),width:i,height:n}}),this.frozenHeadGroup.setClip({type:"rect",attrs:{x:l,y:0,width:this.headerConfig.width,height:this.getFrozenFirstRowHeight()}})},t.prototype.isFrozenRow=function(e){var i,n=this.headerConfig.spreadsheet,a=n.facet,o=xh(n.options,(i=a.layoutResult)===null||i===void 0?void 0:i.rowNodes).frozenRowCount;return o>0&&e.rowIndex>=0&&e.rowIndex<o},t.prototype.getFrozenFirstRowHeight=function(){var e,i=this.headerConfig.spreadsheet,n=i.facet,a=xh(i.options,(e=n.layoutResult)===null||e===void 0?void 0:e.rowNodes).frozenRowHeight;return a},t.prototype.clear=function(){this.frozenHeadGroup.clear(),this.scrollGroup.clear()},t}(d2),t$=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.getSeriesNumberHeader=function(e){var i,n=e.viewportBBox,a=e.seriesNumberWidth,o=e.leafNodes,s=e.spreadsheet,l=e.cornerWidth,u=n.height,c=n.viewportHeight,h=[],f=s.isHierarchyTreeType();o.forEach(function(y){var _=new Zr({id:"",key:"",value:"".concat(h.length+1)});_.x=y.x,_.y=y.y,_.height=f?y.getTotalHeightForTreeHierarchy():y.height,_.width=a,_.rowIndex=y.rowIndex,_.spreadsheet=s,_.isLeaf=!0,h.push(_)});var d=s.facet,v=xh(s.options,(i=d.layoutResult)===null||i===void 0?void 0:i.rowNodes),p=v.frozenRowCount,g=v.frozenRowHeight,m=!!p;return new t({width:l,height:u,viewportWidth:l,viewportHeight:m?c-g:c,position:{x:0,y:n.y},data:h,spreadsheet:s,seriesNumberWidth:0,hierarchyType:s.options.hierarchyType,linkFields:[]})},t.prototype.createCellInstance=function(e){var i=this.isFrozenRow(e);return new AH(e,this.headerConfig.spreadsheet,U(U({},this.headerConfig),{scrollY:i?0:this.headerConfig.scrollY}),i)},t.prototype.getCustomRowCell=function(){return null},t}(JH),i$t=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.createCellInstance=function(e){var i=this.headerConfig,n=i.spreadsheet,a=i.scrollY,o=this.isFrozenRow(e);return new vp(e,n,U(U({},this.headerConfig),{scrollY:o?0:a}),o)},t}(JH),n$t=function(){function r(t){var e=this;this.scrollFrameId=null,this.hideScrollBar=function(){var i,n,a;(i=e.hRowScrollBar)===null||i===void 0||i.hide(),(n=e.hScrollBar)===null||n===void 0||n.hide(),(a=e.vScrollBar)===null||a===void 0||a.hide()},this.delayHideScrollBar=ev(this.hideScrollBar,1e3),this.delayHideScrollbarOnMobile=function(){Nr()&&e.delayHideScrollBar()},this.showVerticalScrollBar=function(){var i;(i=e.vScrollBar)===null||i===void 0||i.show()},this.showHorizontalScrollBar=function(){var i,n;(i=e.hRowScrollBar)===null||i===void 0||i.show(),(n=e.hScrollBar)===null||n===void 0||n.show()},this.onContainerWheelForMobileCompatibility=function(){var i=e.spreadsheet.getCanvasElement(),n,a;i.addEventListener("touchstart",function(o){n=o.touches[0].clientY}),i.addEventListener("touchend",function(o){a=o.changedTouches[0].clientY,a<n?e.scrollDirection=Dr.SCROLL_UP:a>n&&(e.scrollDirection=Dr.SCROLL_DOWN)})},this.onContainerWheel=function(){e.onContainerWheelForPc(),e.onContainerWheelForMobile()},this.getMobileWheelDeltaY=function(i){return e.scrollDirection===Dr.SCROLL_UP?Math.max(0,i):e.scrollDirection===Dr.SCROLL_DOWN?Math.min(0,i):i},this.onContainerWheelForPc=function(){var i=e.spreadsheet.getCanvasElement();i==null||i.addEventListener("wheel",e.onWheel)},this.onContainerWheelForMobile=function(){e.mobileWheel=new lzt(e.spreadsheet.container),e.mobileWheel.on("wheel",function(i){e.spreadsheet.hideTooltip();var n=i.event,a=i.deltaX,o=i.deltaY,s=i.x,l=i.y,u=e.getMobileWheelDeltaY(o);e.onWheel(U(U({},n),{deltaX:a,deltaY:u,offsetX:s,offsetY:l}))}),e.onContainerWheelForMobileCompatibility()},this.bindEvents=function(){e.onContainerWheel(),e.emitPaginationEvent()},this.setScrollOffset=function(i){Object.keys(i).forEach(function(n){var a=i[n];o_(a)||e.spreadsheet.store.set(n,Math.floor(a))})},this.getScrollOffset=function(){var i=e.spreadsheet.store;return{scrollX:i.get("scrollX",0),scrollY:i.get("scrollY",0),rowHeaderScrollX:i.get("rowHeaderScrollX",0)}},this.emitPaginationEvent=function(){var i=e.cfg.pagination;if(i){var n=i.current,a=n===void 0?gE:n,o=i.pageSize,s=e.viewCellHeights.getTotalLength(),l=Math.floor((s-1)/o)+1;e.cfg.spreadsheet.emit(X.LAYOUT_PAGINATION,{pageSize:o,pageCount:l,total:s,current:a})}},this.unbindEvents=function(){var i=e.spreadsheet.getCanvasElement();i==null||i.removeEventListener("wheel",e.onWheel),e.mobileWheel.destroy()},this.clipPanelGroup=function(){var i;e.foregroundGroup=e.spreadsheet.foregroundGroup,e.backgroundGroup=e.spreadsheet.backgroundGroup,e.panelGroup=e.spreadsheet.panelGroup;var n=e.panelBBox,a=n.width,o=n.height;(i=e.spreadsheet.panelScrollGroup)===null||i===void 0||i.setClip({type:"rect",attrs:{x:0,y:e.cornerBBox.height,width:a,height:o}})},this.calculateCellWidthHeight=function(){var i=e.layoutResult.colLeafNodes,n=l_(i,function(a,o){return a.push(Be(a)+o.width),a},[0]);e.viewCellWidths=n,e.viewCellHeights=e.getViewCellHeights(e.layoutResult)},this.getRealScrollX=function(i,n){return n===void 0&&(n=0),e.cfg.spreadsheet.isScrollContainsRowHeader()?i:n},this.calculatePanelBBox=function(){e.panelBBox=new t$t(e,!0)},this.getRealWidth=function(){return Be(e.viewCellWidths)},this.getRealHeight=function(){var i=e.cfg.pagination,n=e.viewCellHeights;if(i){var a=e.getCellRange(),o=a.start,s=a.end;return n.getCellOffsetY(s+1)-n.getCellOffsetY(o)}return n.getTotalHeight()},this.clearAllGroup=function(){for(var i=e.panelGroup.getChildren()||[],n=i.length-1;n>=0;n--){var a=i[n];a instanceof Mo?a.set("children",[]):i[n].remove()}e.foregroundGroup.set("children",[]),e.backgroundGroup.set("children",[])},this.scrollWithAnimation=function(i,n,a){var o,s,l,u;i===void 0&&(i={}),n===void 0&&(n=200);var c=e.getAdjustedScrollOffset({scrollX:((o=i.offsetX)===null||o===void 0?void 0:o.value)||0,scrollY:((s=i.offsetY)===null||s===void 0?void 0:s.value)||0,rowHeaderScrollX:((l=i.rowHeaderOffsetX)===null||l===void 0?void 0:l.value)||0}),h=c.scrollX,f=c.scrollY,d=c.rowHeaderScrollX;(u=e.timer)===null||u===void 0||u.stop();var v=e.getScrollOffset(),p=[h??v.scrollX,f??v.scrollY,d??v.rowHeaderScrollX],g=VHt(Object.values(v),p);e.timer=ST(function(m){try{var y=Math.min(m/n,1),_=rt(g(y),3),x=_[0],C=_[1],A=_[2];e.setScrollOffset({rowHeaderScrollX:A,scrollX:x,scrollY:C}),e.startScroll(),m>n&&(e.timer.stop(),a==null||a())}catch(b){console.error(b),e.timer.stop()}})},this.scrollImmediately=function(i){var n,a,o;i===void 0&&(i={});var s=e.getAdjustedScrollOffset({scrollX:((n=i.offsetX)===null||n===void 0?void 0:n.value)||0,scrollY:((a=i.offsetY)===null||a===void 0?void 0:a.value)||0,rowHeaderScrollX:((o=i.rowHeaderOffsetX)===null||o===void 0?void 0:o.value)||0}),l=s.scrollX,u=s.scrollY,c=s.rowHeaderScrollX;e.setScrollOffset({scrollX:l,scrollY:u,rowHeaderScrollX:c}),e.startScroll()},this.startScroll=function(i){var n,a,o;i===void 0&&(i=!1);var s=e.getScrollOffset(),l=s.rowHeaderScrollX,u=s.scrollX,c=s.scrollY;(n=e.hRowScrollBar)===null||n===void 0||n.onlyUpdateThumbOffset(e.getScrollBarOffset(l,e.hRowScrollBar)),(a=e.hScrollBar)===null||a===void 0||a.onlyUpdateThumbOffset(e.getScrollBarOffset(u,e.hScrollBar)),(o=e.vScrollBar)===null||o===void 0||o.onlyUpdateThumbOffset(e.getScrollBarOffset(c,e.vScrollBar)),e.dynamicRenderCell(i)},this.getRendererHeight=function(){var i=e.getCellRange(),n=i.start,a=i.end;return e.viewCellHeights.getCellOffsetY(a+1)-e.viewCellHeights.getCellOffsetY(n)},this.getAdjustedScrollOffset=function(i){var n=i.scrollX,a=i.scrollY,o=i.rowHeaderScrollX;return{scrollX:j1(n,e.layoutResult.colsHierarchy.width,e.panelBBox.width),scrollY:j1(a,e.getRendererHeight(),e.panelBBox.height),rowHeaderScrollX:qHt(o,e.cornerBBox)}},this.renderRowScrollBar=function(i){if(!e.cfg.spreadsheet.isScrollContainsRowHeader()&&e.cornerBBox.width<e.cornerBBox.originalWidth){var n=e.cornerBBox.originalWidth-e.cornerBBox.width,a=e.getScrollbarPosition().maxY,o=e.spreadsheet.theme,s=o.splitLine,l=o.scrollBar,u=Math.max(e.cornerBBox.width*e.cornerBBox.width/e.cornerBBox.originalWidth,l==null?void 0:l.thumbHorizontalMinSize),c=u-(s==null?void 0:s.verticalBorderWidth);e.hRowScrollBar=new Y1({isHorizontal:!0,trackLen:e.cornerBBox.width,thumbLen:c,position:{x:e.cornerBBox.minX+e.scrollBarSize/2,y:a},thumbOffset:i*(e.cornerBBox.width-u)/n,theme:e.scrollBarTheme,scrollTargetMaxOffset:n}),e.hRowScrollBar.on(uu.ScrollChange,function(h){var f,d,v=h.offset,p=e.getValidScrollBarOffset(v,n),g=Math.floor(p);e.setScrollOffset({rowHeaderScrollX:g}),(f=e.rowHeader)===null||f===void 0||f.onRowScrollX(g,ph),(d=e.rowIndexHeader)===null||d===void 0||d.onRowScrollX(g,zO),e.cornerHeader.onRowScrollX(g,XC);var m=e.getScrollBarOffset(g,e.hRowScrollBar),y=e.getScrollOffset(),_=y.scrollX,x=y.scrollY,C={scrollX:_,scrollY:x,rowHeaderScrollX:m};e.hRowScrollBar.updateThumbOffset(m,!1),e.spreadsheet.emit(X.ROW_CELL_SCROLL,C),e.spreadsheet.emit(X.GLOBAL_SCROLL,C)}),e.foregroundGroup.add(e.hRowScrollBar)}},this.getValidScrollBarOffset=function(i,n){return Cm(i,0,n)},this.renderHScrollBar=function(i,n,a){if(Math.floor(i)<Math.floor(n)){var o=e.scrollBarSize/2,s=e.getScrollbarPosition().maxY,l=i+(e.cfg.spreadsheet.isScrollContainsRowHeader()?Math.min(e.cornerBBox.width,e.getCanvasHW().width):0),u={x:e.panelBBox.minX+(e.cfg.spreadsheet.isScrollContainsRowHeader()?-e.cornerBBox.width+o:o),y:s},c=n+(e.cfg.spreadsheet.isScrollContainsRowHeader()?e.cornerBBox.width:0),h=e.spreadsheet.theme.scrollBar,f=c-l,d=Math.max(l/c*l,h==null?void 0:h.thumbHorizontalMinSize);e.hScrollBar=new Y1({isHorizontal:!0,trackLen:l,thumbLen:d,position:u,thumbOffset:a*(l-d)/f,theme:e.scrollBarTheme,scrollTargetMaxOffset:f}),e.hScrollBar.on(uu.ScrollChange,function(v){var p=v.offset,g=v.updateThumbOffset,m=e.getValidScrollBarOffset(p,f);g&&e.hScrollBar.updateThumbOffset(e.getScrollBarOffset(m,e.hScrollBar),!1),e.setScrollOffset({scrollX:m}),e.dynamicRenderCell()}),e.foregroundGroup.add(e.hScrollBar)}},this.getScrollbarPosition=function(){var i=e.panelBBox,n=i.maxX,a=i.maxY,o=e.getCanvasHW(),s=o.width,l=o.height,u=e.spreadsheet.options.interaction.scrollbarPosition===pm.CONTENT;return{maxX:(u?n:s)-e.scrollBarSize,maxY:u?a:l-e.scrollBarSize}},this.renderVScrollBar=function(i,n,a){if(i<n){var o=e.spreadsheet.theme.scrollBar,s=Math.max(i/n*i,o==null?void 0:o.thumbVerticalMinSize),l=n-i,u=e.getScrollbarPosition().maxX;e.vScrollBar=new Y1({isHorizontal:!1,trackLen:i,thumbLen:s,thumbOffset:a*(i-s)/l,position:{x:u,y:e.panelBBox.minY},theme:e.scrollBarTheme,scrollTargetMaxOffset:l}),e.vScrollBar.on(uu.ScrollChange,function(c){var h=c.offset,f=c.updateThumbOffset,d=e.getValidScrollBarOffset(h,l);f&&e.vScrollBar.updateThumbOffset(e.getScrollBarOffset(d,e.vScrollBar),!1),e.setScrollOffset({scrollY:d}),e.dynamicRenderCell()}),e.foregroundGroup.add(e.vScrollBar)}},this.getScrollBarOffset=function(i,n){var a=n.trackLen,o=n.thumbLen,s=n.scrollTargetMaxOffset;return i*(a-o)/s},this.isScrollOverThePanelArea=function(i){var n=i.offsetX,a=i.offsetY;return n>e.panelBBox.minX&&n<e.panelBBox.maxX&&a>e.panelBBox.minY&&a<e.panelBBox.maxY},this.isScrollOverTheCornerArea=function(i){var n=i.offsetX,a=i.offsetY;return n>e.cornerBBox.minX&&n<e.cornerBBox.maxX&&a>e.cornerBBox.minY&&a<e.cornerBBox.maxY+e.panelBBox.height},this.updateHorizontalRowScrollOffset=function(i){var n,a=i.offset,o=i.offsetX,s=i.offsetY;e.isScrollOverTheCornerArea({offsetX:o,offsetY:s})&&((n=e.hRowScrollBar)===null||n===void 0||n.emitScrollChange(a))},this.updateHorizontalScrollOffset=function(i){var n,a=i.offset,o=i.offsetX,s=i.offsetY;(!e.hRowScrollBar||e.isScrollOverThePanelArea({offsetX:o,offsetY:s}))&&((n=e.hScrollBar)===null||n===void 0||n.emitScrollChange(a))},this.isScrollToLeft=function(i){var n=i.deltaX,a=i.offsetX,o=i.offsetY;if(!e.hScrollBar&&!e.hRowScrollBar)return!0;var s=!e.hRowScrollBar||e.isScrollOverThePanelArea({offsetY:o,offsetX:a})||e.hRowScrollBar.thumbOffset<=0,l=!e.hScrollBar||e.hScrollBar.thumbOffset<=0;return n<=0&&l&&s},this.isScrollToRight=function(i){var n,a,o,s,l,u,c=i.deltaX,h=i.offsetX,f=i.offsetY;if(!e.hScrollBar&&!e.hRowScrollBar)return!0;var d=e.spreadsheet.isFrozenRowHeader()?(n=e.panelBBox)===null||n===void 0?void 0:n.width:(a=e.panelBBox)===null||a===void 0?void 0:a.maxX,v=!e.hRowScrollBar||e.isScrollOverThePanelArea({offsetY:f,offsetX:h})||((o=e.hRowScrollBar)===null||o===void 0?void 0:o.thumbOffset)+((s=e.hRowScrollBar)===null||s===void 0?void 0:s.thumbLen)>=e.cornerBBox.width,p=e.hRowScrollBar&&e.isScrollOverTheCornerArea({offsetX:h,offsetY:f})||((l=e.hScrollBar)===null||l===void 0?void 0:l.thumbOffset)+((u=e.hScrollBar)===null||u===void 0?void 0:u.thumbLen)>=d;return c>=0&&p&&v},this.isScrollToTop=function(i){var n;return e.vScrollBar?i<=0&&((n=e.vScrollBar)===null||n===void 0?void 0:n.thumbOffset)<=0:!0},this.isScrollToBottom=function(i){var n,a,o;return e.vScrollBar?i>=0&&((n=e.vScrollBar)===null||n===void 0?void 0:n.thumbOffset)+((a=e.vScrollBar)===null||a===void 0?void 0:a.thumbLen)>=((o=e.panelBBox)===null||o===void 0?void 0:o.height):!0},this.isVerticalScrollOverTheViewport=function(i){return!e.isScrollToTop(i)&&!e.isScrollToBottom(i)},this.isHorizontalScrollOverTheViewport=function(i){return!e.isScrollToLeft(i)&&!e.isScrollToRight(i)},this.isScrollOverTheViewport=function(i){var n=i.deltaY,a=i.deltaX,o=i.offsetY,s=o<=e.cornerBBox.maxY;return s?!1:n!==0?e.isVerticalScrollOverTheViewport(n):a!==0?e.isHorizontalScrollOverTheViewport(i):!1},this.cancelScrollFrame=function(){return Nr()&&e.scrollFrameId?!1:(cancelAnimationFrame(e.scrollFrameId),!0)},this.clearScrollFrameIdOnMobile=function(){Nr()&&(e.scrollFrameId=null)},this.stopScrollChainingIfNeeded=function(i){var n=e.spreadsheet.options.interaction;n.overscrollBehavior!=="auto"&&(e.cancelScrollFrame(),e.stopScrollChaining(i))},this.stopScrollChaining=function(i){var n,a;i!=null&&i.cancelable&&((n=i==null?void 0:i.preventDefault)===null||n===void 0||n.call(i));var o=i==null?void 0:i.originalEvent;o!=null&&o.cancelable&&((a=o==null?void 0:o.preventDefault)===null||a===void 0||a.call(o))},this.onWheel=function(i){var n=e.spreadsheet.options.interaction,a=i.deltaX,o=i.deltaY,s=i.offsetX,l=i.offsetY,u=i.shiftKey;u&&zz()&&(s=s-a+o,a=o,l-=o,o=0);var c=rt(Vkt(a,o,n.scrollSpeedRatio),2),h=c[0],f=c[1];if(e.spreadsheet.hideTooltip(),e.spreadsheet.interaction.clearHoverTimer(),!e.isScrollOverTheViewport({deltaX:h,deltaY:f,offsetX:s,offsetY:l})){e.stopScrollChainingIfNeeded(i);return}e.stopScrollChaining(i),e.spreadsheet.interaction.addIntercepts([Gt.HOVER]),e.cancelScrollFrame()&&(e.scrollFrameId=requestAnimationFrame(function(){var d,v=e.getScrollOffset(),p=v.scrollX,g=v.scrollY,m=v.rowHeaderScrollX;h!==0&&(e.showHorizontalScrollBar(),e.updateHorizontalRowScrollOffset({offsetX:s,offsetY:l,offset:h+m}),e.updateHorizontalScrollOffset({offsetX:s,offsetY:l,offset:h+p})),f!==0&&(e.showVerticalScrollBar(),(d=e.vScrollBar)===null||d===void 0||d.emitScrollChange(f+g)),e.delayHideScrollbarOnMobile(),e.clearScrollFrameIdOnMobile()}))},this.addCell=function(i){var n=e.spreadsheet.panelScrollGroup;n==null||n.add(i)},this.realCellRender=function(i,n){var a=e.calculateXYIndexes(i,n);co.getInstance().logger("renderIndex:",e.preCellIndexes,a);var o=JHt(e.preCellIndexes,a),s=o.add,l=o.remove;co.getInstance().debugCallback(_kt,function(){$t(s,function(c){var h=rt(c,2),f=h[0],d=h[1],v=e.layoutResult.getCellMeta(d,f);if(v){var p=e.cfg.dataCell(v);p.set("name","".concat(f,"-").concat(d)),e.addCell(p)}});var u=pd(e.panelGroup.getChildren(),Cl);$t(l,function(c){var h=rt(c,2),f=h[0],d=h[1],v=vi(u,function(p){return p.get("name")==="".concat(f,"-").concat(d)});v==null||v.remove(!0)}),co.getInstance().logger("Render Cell Panel: ".concat(u==null?void 0:u.length,", Add: ").concat(s==null?void 0:s.length,", Remove: ").concat(l==null?void 0:l.length))}),e.preCellIndexes=a,e.spreadsheet.emit(X.LAYOUT_AFTER_REAL_DATA_CELL_RENDER,{add:s,remove:l,spreadsheet:e.spreadsheet})},this.getGridInfo=function(){var i=rt(e.preCellIndexes.center,4),n=i[0],a=i[1],o=i[2],s=i[3],l=qH(n,a,e.layoutResult.colLeafNodes),u=E_(o,s,e.viewCellHeights);return{cols:l,rows:u}},this.onAfterScroll=ev(function(){var i=e.spreadsheet,n=i.interaction,a=i.container;if(!n.isSelectedState()&&(n.removeIntercepts([Gt.HOVER]),n.getHoverAfterScroll())){var o=n.eventController.canvasMousemoveEvent;if(o){var s=o.x,l=o.y,u=a.getShape(s,l);u&&a.emit(_i.MOUSE_MOVE,U(U({},o),{shape:u,target:u,timestamp:performance.now()}))}}},300),this.cfg=t,this.spreadsheet=t.spreadsheet,this.init()}return Object.defineProperty(r.prototype,"scrollBarTheme",{get:function(){return this.spreadsheet.theme.scrollBar},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"scrollBarSize",{get:function(){return this.scrollBarTheme.size},enumerable:!1,configurable:!0}),r.prototype.getCellCustomWidth=function(t,e){return ri(e)?e==null?void 0:e(t):e},r.prototype.getCellDraggedWidth=function(t){var e=this.cfg.colCfg;return kt(e==null?void 0:e.widthByFieldValue,"".concat(t.value))},r.prototype.render=function(){Qkt(this.spreadsheet.dataCfg.fields)||(this.adjustScrollOffset(),this.renderHeaders(),this.renderScrollBars(),this.renderBackground(),this.dynamicRenderCell(!0))},r.prototype.adjustScrollOffset=function(){var t=this.getAdjustedScrollOffset(this.getScrollOffset());this.setScrollOffset(t)},r.prototype.getSeriesNumberWidth=function(){var t=this.cfg.showSeriesNumber;return t?this.spreadsheet.theme.rowCell.seriesNumberWidth:0},r.prototype.getCanvasHW=function(){return{width:this.cfg.width,height:this.cfg.height}},r.prototype.updateScrollOffset=function(t){var e,i,n,a,o,s;if(((e=t.rowHeaderOffsetX)===null||e===void 0?void 0:e.value)!==void 0){!((i=t.rowHeaderOffsetX)===null||i===void 0)&&i.animate?this.scrollWithAnimation(t):this.scrollImmediately(t);return}if(((n=t.offsetX)===null||n===void 0?void 0:n.value)!==void 0){!((a=t.offsetX)===null||a===void 0)&&a.animate?this.scrollWithAnimation(t):this.scrollImmediately(t);return}((o=t.offsetY)===null||o===void 0?void 0:o.value)!==void 0&&(!((s=t.offsetY)===null||s===void 0)&&s.animate?this.scrollWithAnimation(t):this.scrollImmediately(t))},r.prototype.getPaginationScrollY=function(){var t=this.cfg.pagination;if(t){var e=t.current,i=e===void 0?gE:e,n=t.pageSize,a=this.viewCellHeights,o=Math.max((i-1)*n,0);return a.getCellOffsetY(o)}return 0},r.prototype.destroy=function(){this.unbindEvents(),this.clearAllGroup(),this.preCellIndexes=null,cancelAnimationFrame(this.scrollFrameId)},r.prototype.calculateXYIndexes=function(t,e){var i=this.panelBBox,n=i.viewportHeight,a=i.viewportWidth,o=Xb(t,e,this.viewCellWidths,this.viewCellHeights,{width:a,height:n,x:0,y:0},this.getRealScrollX(this.cornerBBox.width));return{center:o}},r.prototype.calculateCornerBBox=function(){this.cornerBBox=new QH(this,!0)},r.prototype.getCellRange=function(){var t=this.cfg.pagination;return Zkt(this.viewCellHeights,t)},r.prototype.panelScrollGroupClip=function(t,e){var i,n=this.spreadsheet.isFrozenRowHeader();(i=this.spreadsheet.panelScrollGroup)===null||i===void 0||i.setClip({type:"rect",attrs:{x:n?t:0,y:e,width:this.panelBBox.width+(n?0:t),height:this.panelBBox.height}})},r.prototype.clip=function(t,e){this.panelScrollGroupClip(t,e)},r.prototype.translateRelatedGroups=function(t,e,i){var n,a,o,s,l,u;Zo(this.spreadsheet.panelScrollGroup,this.cornerBBox.width-t,this.cornerBBox.height-e),(n=this.rowHeader)===null||n===void 0||n.onScrollXY(this.getRealScrollX(t,i),e,ph),(a=this.rowIndexHeader)===null||a===void 0||a.onScrollXY(this.getRealScrollX(t,i),e,zO),(o=this.cornerHeader)===null||o===void 0||o.onCorScroll(this.getRealScrollX(t,i),XC),(s=this.centerFrame)===null||s===void 0||s.onChangeShadowVisibility(t,this.getRealWidth()-this.panelBBox.width),(l=this.centerFrame)===null||l===void 0||l.onBorderScroll(this.getRealScrollX(t)),(u=this.columnHeader)===null||u===void 0||u.onColScroll(t,Kk)},r.prototype.init=function(){var t=this;co.getInstance().debugCallback(ykt,function(){t.layoutResult=t.doLayout(),t.saveInitColumnLeafNodes(t.layoutResult.colLeafNodes),t.spreadsheet.emit(X.LAYOUT_AFTER_HEADER_LAYOUT,t.layoutResult)}),this.calculateCellWidthHeight(),this.calculateCornerBBox(),this.calculatePanelBBox(),this.clipPanelGroup(),this.bindEvents()},r.prototype.renderBackground=function(){var t=this.getCanvasHW(),e=t.width,i=t.height,n=this.spreadsheet.theme.background,a=n.color,o=n.opacity;this.backgroundGroup.addShape("rect",{attrs:{fill:a,opacity:o,x:0,y:0,width:e,height:i}})},r.prototype.renderScrollBars=function(){var t=this.getScrollOffset(),e=t.scrollX,i=t.scrollY,n=t.rowHeaderScrollX,a=this.panelBBox,o=a.width,s=a.height,l=this.layoutResult.colsHierarchy.width,u=this.getRealHeight();this.renderRowScrollBar(n),this.renderHScrollBar(o,l,e),this.renderVScrollBar(s,u,i)},r.prototype.renderHeaders=function(){var t=this.getSeriesNumberWidth();this.rowHeader=this.getRowHeader(),this.columnHeader=this.getColHeader(),t>0&&!this.rowIndexHeader&&(this.rowIndexHeader=this.getSeriesNumberHeader()),this.cornerHeader=this.getCornerHeader(),this.centerFrame=this.getCenterFrame(),this.rowIndexHeader&&this.foregroundGroup.add(this.rowIndexHeader),this.rowHeader&&this.foregroundGroup.add(this.rowHeader),this.foregroundGroup.add(this.columnHeader),this.foregroundGroup.add(this.cornerHeader),this.foregroundGroup.add(this.centerFrame)},r.prototype.getRowHeaderCfg=function(){var t,e,i,n=this.panelBBox,a=n.y,o=n.viewportHeight,s=n.viewportWidth,l=n.height,u=this.getSeriesNumberWidth();return{width:this.cornerBBox.width,height:l,viewportWidth:s,viewportHeight:o,position:{x:0,y:a},data:this.layoutResult.rowNodes,hierarchyType:this.cfg.hierarchyType,linkFields:(i=(e=(t=this.cfg.spreadsheet.options)===null||t===void 0?void 0:t.interaction)===null||e===void 0?void 0:e.linkFields)!==null&&i!==void 0?i:[],seriesNumberWidth:u,spreadsheet:this.spreadsheet}},r.prototype.getRowHeader=function(){return this.rowHeader?this.rowHeader:new d2(this.getRowHeaderCfg())},r.prototype.getColHeader=function(){if(!this.columnHeader){var t=this.panelBBox,e=t.x,i=t.width,n=t.viewportHeight,a=t.viewportWidth;return new f2({width:i,cornerWidth:this.cornerBBox.width,height:this.cornerBBox.height,viewportWidth:a,viewportHeight:n,position:{x:e,y:0},data:this.layoutResult.colNodes,scrollContainsRowHeader:this.cfg.spreadsheet.isScrollContainsRowHeader(),sortParam:this.cfg.spreadsheet.store.get("sortParam"),spreadsheet:this.spreadsheet})}return this.columnHeader},r.prototype.getCornerHeader=function(){return this.cornerHeader?this.cornerHeader:e$t.getCornerHeader(this.panelBBox,this.cornerBBox,this.getSeriesNumberWidth(),this.cfg,this.layoutResult,this.spreadsheet)},r.prototype.getSeriesNumberHeader=function(){return t$.getSeriesNumberHeader({viewportBBox:this.panelBBox,seriesNumberWidth:this.getSeriesNumberWidth(),leafNodes:this.layoutResult.rowsHierarchy.getNodes(0),spreadsheet:this.spreadsheet,cornerWidth:this.cornerBBox.width})},r.prototype.getCenterFrame=function(){var t;if(!this.centerFrame){var e=this.panelBBox,i=e.viewportWidth,n=e.viewportHeight,a=this.cornerBBox.width,o=this.cornerBBox.height,s=(t=this.cfg)===null||t===void 0?void 0:t.frame,l={position:{x:this.cornerBBox.x,y:this.cornerBBox.y},width:a,height:o,viewportWidth:i,viewportHeight:n,showViewportLeftShadow:!1,showViewportRightShadow:!1,scrollContainsRowHeader:this.cfg.spreadsheet.isScrollContainsRowHeader(),isPivotMode:this.cfg.spreadsheet.isPivotMode(),spreadsheet:this.cfg.spreadsheet};return s?s(l):new r$t(l)}return this.centerFrame},r.prototype.updatePanelScrollGroup=function(){this.gridInfo=this.getGridInfo(),this.spreadsheet.panelScrollGroup.update(this.gridInfo)},r.prototype.dynamicRenderCell=function(t){var e=this.getScrollOffset(),i=e.scrollX,n=e.scrollY,a=e.rowHeaderScrollX,o=n+this.getPaginationScrollY(),s=j1(o,this.viewCellHeights.getTotalHeight(),this.panelBBox.viewportHeight);this.spreadsheet.hideTooltip(),this.spreadsheet.interaction.clearHoverTimer(),this.realCellRender(i,s),this.updatePanelScrollGroup(),this.translateRelatedGroups(i,s,a),this.clip(i,s),t||this.emitScrollEvent({scrollX:i,scrollY:s,rowHeaderScrollX:a}),this.onAfterScroll()},r.prototype.emitScrollEvent=function(t){this.spreadsheet.emit(X.LAYOUT_CELL_SCROLL,t),this.spreadsheet.emit(X.GLOBAL_SCROLL,t)},r.prototype.saveInitColumnLeafNodes=function(t){t===void 0&&(t=[]);var e=this.spreadsheet,i=e.store,n=e.options,a=n.interaction.hiddenColumnFields,o=t.length+a.length,s=i.get("initColumnLeafNodes",[]);o!==s.length&&i.set("initColumnLeafNodes",t)},r.prototype.getHiddenColumnsInfo=function(t){var e=this.spreadsheet.store.get("hiddenColumnsDetail",[]);return st(e)?null:e.find(function(i){var n;return(n=i==null?void 0:i.hideColumnNodes)===null||n===void 0?void 0:n.some(function(a){return a.id===t.id})})},r.prototype.getCornerNodes=function(){var t;return((t=this.cornerHeader)===null||t===void 0?void 0:t.getNodes())||[]},r}(),e$=function(r){yt(t,r);function t(e){var i,n=r.call(this,e)||this;return n.frozenGroupInfo=(i={},i[Wn.FROZEN_COL]={width:0},i[Wn.FROZEN_ROW]={height:0},i[Wn.FROZEN_TRAILING_ROW]={height:0},i[Wn.FROZEN_TRAILING_COL]={width:0},i),n.panelScrollGroupIndexes=[],n.initFrozenGroupPosition=function(){var a=n.getScrollOffset(),o=a.scrollY,s=a.scrollX,l=n.getPaginationScrollY();Zo(n.spreadsheet.frozenRowGroup,n.cornerBBox.width-s,n.cornerBBox.height-l),Zo(n.spreadsheet.frozenColGroup,n.cornerBBox.width,n.cornerBBox.height-o-l),Zo(n.spreadsheet.frozenTrailingColGroup,n.cornerBBox.width,n.cornerBBox.height-o-l),Zo(n.spreadsheet.frozenTopGroup,n.cornerBBox.width,n.cornerBBox.height-l)},n.addCell=function(a){var o=n.getBizRevisedFrozenOptions(),s=o.frozenRowCount,l=o.frozenColCount,u=o.frozenTrailingRowCount,c=o.frozenTrailingColCount,h=n.layoutResult.colsHierarchy.getLeaves().length,f=n.getCellRange(),d=n.getRealFrozenColumns(l,c),v=d.colCount,p=d.trailingColCount,g=Xkt(a.getMeta(),{frozenRowCount:s,frozenColCount:v,frozenTrailingRowCount:u,frozenTrailingColCount:p},h,f),m=iU[g];m&&n.spreadsheet[m]&&n.spreadsheet[m].add(a)},n.renderFrozenGroupSplitLine=function(a,o){var s,l,u,c=n.panelBBox,h=c.width,f=c.height,d=c.viewportWidth,v=c.viewportHeight,p=n.cornerBBox.height,g=n.layoutResult.colNodes.filter(function(Et){return ho(Et)}),m=n.getCellRange(),y=m.end-m.start,_=js(n.getBizRevisedFrozenOptions(),g.length,y),x=_.frozenRowCount,C=x===void 0?0:x,A=_.frozenColCount,b=A===void 0?0:A,R=_.frozenTrailingColCount,M=R===void 0?0:R,O=_.frozenTrailingRowCount,F=O===void 0?0:O,D=Math.floor(o-n.getPaginationScrollY()),H=Math.max(0,((s=Be(n.viewCellWidths))!==null&&s!==void 0?s:0)-d),j=Math.max(0,n.viewCellHeights.getCellOffsetY(m.end+1)-n.viewCellHeights.getCellOffsetY(m.start)-v);(l=n.foregroundGroup.findById(dm))===null||l===void 0||l.remove();var $=kt(n.cfg,"spreadsheet.theme.splitLine"),k=n.foregroundGroup.addGroup({id:dm,zIndex:Zd}),V={lineWidth:$==null?void 0:$.verticalBorderWidth,stroke:$==null?void 0:$.verticalBorderColor,opacity:$==null?void 0:$.verticalBorderColorOpacity,lineDash:$==null?void 0:$.borderDash},Q={lineWidth:$==null?void 0:$.horizontalBorderWidth,stroke:$==null?void 0:$.horizontalBorderColor,opacity:$==null?void 0:$.horizontalBorderColorOpacity,lineDash:$==null?void 0:$.borderDash};if(b>0){var Y=g.reduce(function(Et,ht,vt){return vt<b?Et+ht.width:Et},0),tt=F>0?f:v;qr(k,{x1:Y,x2:Y,y1:p,y2:p+tt},U({},V)),$.showShadow&&a>0&&k.addShape("rect",{attrs:{x:Y,y:p,width:$.shadowWidth,height:tt,fill:n.getShadowFill(0)}})}if(C>0){var et=p+n.getTotalHeightForRange(m.start,m.start+C-1),dt=M>0?h:d;qr(k,{x1:0,x2:dt,y1:et,y2:et},U({},Q)),$.showShadow&&D>0&&k.addShape("rect",{attrs:{x:0,y:et,width:dt,height:$.shadowWidth,fill:n.getShadowFill(90)}})}if(M>0){var Y=g[g.length-M].x,tt=F?f:v;qr(k,{x1:Y,x2:Y,y1:p,y2:p+tt},U({},V)),$.showShadow&&Math.floor(a)<Math.floor(H)&&k.addShape("rect",{attrs:{x:Y-((u=$.shadowWidth)!==null&&u!==void 0?u:0),y:p,width:$.shadowWidth,height:tt,fill:n.getShadowFill(180)}})}if(F>0){var et=n.panelBBox.maxY-n.getTotalHeightForRange(m.end-F+1,m.end),dt=M>0?h:d;qr(k,{x1:0,x2:dt,y1:et,y2:et},U({},Q)),$.showShadow&&D<Math.floor(j)&&k.addShape("rect",{attrs:{x:0,y:et-$.shadowWidth,width:dt,height:$.shadowWidth,fill:n.getShadowFill(270)}})}n.foregroundGroup.sort()},n.getRealFrozenColumns=function(a,o){var s,l=a,u=o;if(a||o){var c=n.layoutResult.colsHierarchy.getNodes();c=c.filter(function(h){return ho(h)}),s=bm(c,a,o),l=s.colCount,u=s.trailingColCount}return{colCount:l,trailingColCount:u}},n.getTotalHeightForRange=function(a,o){if(a<0||o<0)return 0;if(n.rowOffsets)return n.rowOffsets[o+1]-n.rowOffsets[a];for(var s=0,l=a;l<o+1;l++){var u=n.getDefaultCellHeight();s+=u}return s},n.getShadowFill=function(a){var o,s,l=kt(n.cfg,"spreadsheet.theme.splitLine");return"l (".concat(a,") 0:").concat((o=l.shadowColors)===null||o===void 0?void 0:o.left," 1:").concat((s=l.shadowColors)===null||s===void 0?void 0:s.right)},n}return t.prototype.calculateFrozenGroupInfo=function(){var e=this.getFrozenOptionsDirectly(),i=e.frozenColCount,n=e.frozenRowCount,a=e.frozenTrailingColCount,o=e.frozenTrailingRowCount,s=this.layoutResult.colNodes.filter(function(p){return ho(p)}),l=this.viewCellHeights,u=this.getCellRange(),c=this.frozenGroupInfo,h=c.frozenCol,f=c.frozenTrailingCol,d=c.frozenRow,v=c.frozenTrailingRow;i>0&&(h.width=s[i-1].x+s[i-1].width-0,h.range=[0,i-1]),n>0&&(d.height=l.getCellOffsetY(u.start+n)-l.getCellOffsetY(u.start),d.range=[u.start,u.start+n-1]),a>0&&(f.width=s[s.length-1].x-s[s.length-a].x+s[s.length-1].width,f.range=[s.length-a,s.length-1]),o>0&&(v.height=l.getCellOffsetY(u.end+1)-l.getCellOffsetY(u.end+1-o),v.range=[u.end-o+1,u.end])},t.prototype.calculateXYIndexes=function(e,i){var n,a,o,s=this.layoutResult.colLeafNodes.length,l=this.getCellRange(),u=this.panelBBox,c=u.viewportHeight,h=u.viewportWidth,f=this.getFrozenOptionsDirectly(),d=f.frozenColCount,v=d===void 0?0:d,p=f.frozenRowCount,g=p===void 0?0:p,m=f.frozenTrailingColCount,y=m===void 0?0:m,_=f.frozenTrailingRowCount,x=_===void 0?0:_,C={width:h,height:c,x:0,y:0};if(y>0||v>0){var A=this.frozenGroupInfo,b=A.frozenTrailingCol,R=A.frozenCol;C.width-=b.width+R.width,C.x+=(n=R.width)!==null&&n!==void 0?n:0}if(x>0||g>0){var M=this.frozenGroupInfo,O=M.frozenRow,F=M.frozenTrailingRow;C.height<O.height+F.height?(C.height=0,C.y=0):(C.height-=O.height+F.height,C.y+=O.height)}var D=this.spreadsheet.isTableMode()&&(!((o=(a=this.spreadsheet.dataSet)===null||a===void 0?void 0:a.isEmpty)===null||o===void 0)&&o.call(a))?this.spreadsheet.dataSet.getEmptyViewIndexes():Xb(e,i,this.viewCellWidths,this.viewCellHeights,C,this.getRealScrollX(this.cornerBBox.width));this.panelScrollGroupIndexes=D;var H=this.getRealFrozenColumns(v,y),j=H.colCount,$=H.trailingColCount;return jkt(D,{frozenColCount:j,frozenRowCount:g,frozenTrailingColCount:$,frozenTrailingRowCount:x},s,l)},t.prototype.updateFrozenGroupGrid=function(){var e=this;[Wn.FROZEN_COL,Wn.FROZEN_ROW,Wn.FROZEN_TRAILING_COL,Wn.FROZEN_TRAILING_ROW].forEach(function(i){if(e.frozenGroupInfo[i].range){var n=[],a=[];if(i.toLowerCase().includes("row")){var o=rt(e.frozenGroupInfo[i].range,2),s=o[0],l=o[1];if(n=e.gridInfo.cols,a=E_(s,l,e.viewCellHeights),i===Wn.FROZEN_TRAILING_ROW){var u=e.spreadsheet.frozenTrailingRowGroup.getBBox().minY;a=KHt(s,l,Math.ceil(u),e.viewCellHeights)}}else{var c=rt(e.frozenGroupInfo[i].range,2),h=c[0],f=c[1],d=e.layoutResult.colNodes.filter(function(v){return ho(v)});n=qH(h,f,d),a=e.gridInfo.rows}e.spreadsheet["".concat(i,"Group")].updateGrid({cols:n,rows:a},"".concat(i,"Group"))}})},t.prototype.updatePanelScrollGroup=function(){r.prototype.updatePanelScrollGroup.call(this),this.updateFrozenGroupGrid()},t.prototype.translateRelatedGroups=function(e,i,n){var a=this,o=this.spreadsheet,s=o.frozenColGroup,l=o.frozenTrailingColGroup,u=o.frozenRowGroup,c=o.frozenTrailingRowGroup;[u,c].forEach(function(h){v_(h,a.cornerBBox.width-e)}),[s,l].forEach(function(h){Gkt(h,a.cornerBBox.height-i)}),r.prototype.translateRelatedGroups.call(this,e,i,n),this.updateRowResizeArea(),this.renderFrozenGroupSplitLine(e,i)},t.prototype.updateRowResizeArea=function(){},t.prototype.clip=function(e,i){var n,a,o,s=this.getPaginationScrollY(),l=this.spreadsheet,u=l.frozenRowGroup,c=l.frozenColGroup,h=l.frozenTrailingColGroup,f=l.frozenTrailingRowGroup,d=l.panelScrollGroup,v=0,p=0,g=0;c&&(v=c.getBBox().width),u&&(p=u.getBBox().height);var m;h&&(m=h.getBBox()),f&&(g=f.getBBox().height);var y=this.panelBBox.width-v-((n=m==null?void 0:m.width)!==null&&n!==void 0?n:0),_=this.panelBBox.height-p-g;d.setClip({type:"rect",attrs:{x:e+v,y:i+p,width:y,height:_}}),u.setClip({type:"rect",attrs:{x:e+v,y:s,width:y,height:p}}),f==null||f.setClip({type:"rect",attrs:{x:e+v,y:f.getBBox().minY,width:y,height:g}});var x={y:i+p,height:_};c==null||c.setClip({type:"rect",attrs:U(U({},x),{x:0,width:v})}),h==null||h.setClip({type:"rect",attrs:U(U({},x),{x:(a=m==null?void 0:m.minX)!==null&&a!==void 0?a:0,width:(o=m==null?void 0:m.width)!==null&&o!==void 0?o:0})})},t.prototype.init=function(){r.prototype.init.call(this)},t.prototype.render=function(){this.calculateFrozenGroupInfo(),r.prototype.render.call(this),this.initFrozenGroupPosition()},t.prototype.getFrozenOptionsDirectly=function(){var e=this.layoutResult.colLeafNodes.length,i=this.getCellRange();return js(this.getBizRevisedFrozenOptions(),e,i.end-i.start+1)},t.prototype.getBizRevisedFrozenOptions=function(){var e=this.cfg,i=e.frozenColCount,n=e.frozenRowCount,a=e.frozenTrailingColCount,o=e.frozenTrailingRowCount;return{frozenColCount:i,frozenRowCount:n,frozenTrailingColCount:a,frozenTrailingRowCount:o}},t.prototype.getDefaultCellHeight=function(){var e,i=this.cfg.cellCfg;return(e=i==null?void 0:i.height)!==null&&e!==void 0?e:0},t}(n$t),r$=function(r){var t,e,i,n=r.facetCfg,a=r.customTreeItems,o=a===void 0?[]:a,s=r.level,l=r.parentNode,u=r.hierarchy,c=n.spreadsheet,h=n.collapsedRows,f=n.hierarchyCollapse;try{for(var d=ia(o),v=d.next();!v.done;v=d.next()){var p=v.value,g=p.key,m=p.title,y=p.collapsed,_=p.children,x=Fy(p,["key","title","collapsed","children"]),C=(i={},i[Kt]=g,i),A=av(l.id,m),b=y??!1,R=kt(h,A),M=R??(f||b),O=new Zr({id:A,key:g,label:m,value:m,level:s,parent:l,field:g,isTotals:!1,isCollapsed:M,hierarchy:u,query:C,spreadsheet:c,extra:x});s>u.maxLevel&&(u.maxLevel=s),st(_)&&(O.isLeaf=!0);var F=Vb(n,l,O,u);!st(_)&&!M&&F&&r$({facetCfg:n,parentNode:O,level:s+1,hierarchy:u,customTreeItems:_})}}catch(D){t={error:D}}finally{try{v&&!v.done&&(e=d.return)&&e.call(d)}finally{if(t)throw t.error}}},a$t=function(r,t,e){var i=r.getTotalsConfig(t);if(i.showGrandTotals){var n=i.reverseLayout?"unshift":"push";e[n](new _h({label:i.label,isSubTotals:!1,isGrandTotals:!0}))}},i$=function(r){var t,e,i,n,a,o,s=r.parentNode,l=r.currentField,u=r.level,c=r.facetCfg,h=r.hierarchy,f=r.pivotMeta,d=c.spreadsheet,v=c.collapsedRows,p=c.hierarchyCollapse,g=c.rowExpandDepth,m=s.query,y=s.id,_=((n=d.dataCfg.fields.rows)===null||n===void 0?void 0:n.length)<=u,x=TUt(Array.from(f.keys())),C=Vz(x,c,s,l),A=d.store.get("drillItemsNum");_&&A>0&&(C=C.slice(0,A)),u===0&&a$t(d,l,C);try{for(var b=ia(C),R=b.next();!R.done;R=b.next()){var M=R.value,O=M instanceof _h,F=O?null:f.get(M),D=void 0,H=m,j=!1,$=!1;if(O){var k=M;j=k.isGrandTotals,$=k.isSubTotals,D=Pr(M.label),H=m}else D=M,H=U(U({},m),(i={},i[l]=D,i));var V=av(y,D),Q=v==null?void 0:v[V],Y=Si(g)?u>g:null,tt=(a=Q??Y)!==null&&a!==void 0?a:p,et=new Zr({id:V,key:l,label:D,value:D,level:u,parent:s,field:l,isTotals:O,isGrandTotals:j,isSubTotals:$,isCollapsed:tt,hierarchy:h,query:H,spreadsheet:d});u>h.maxLevel&&(h.maxLevel=u);var dt=ft([],rt(((o=F==null?void 0:F.children)===null||o===void 0?void 0:o.keys())||[]),!1).filter(function(vt){return vt!==So}),Et=st(dt);(Et||O)&&(et.isLeaf=!0),Et||(et.isTotals=!0);var ht=Vb(c,s,et,h);!Et&&!tt&&!O&&ht&&i$({level:u+1,currentField:F.childField,pivotMeta:F.children,facetCfg:c,parentNode:et,hierarchy:h})}}catch(vt){t={error:vt}}finally{try{R&&!R.done&&(e=b.return)&&e.call(b)}finally{if(t)throw t.error}}},n$=function(r){var t=r.isValueInCols,e=r.moreThanOneValue,i=r.rootNode,n=r.facetCfg,a=r.hierarchy,o=r.fields,s=r.isRowHeader,l,u;s?(l=!t&&e,u=!t&&!e):(l=t&&e,u=t&&!e),Yz({addTotalMeasureInTotal:l,addMeasureInTotalQuery:u,parentNode:i,currentField:o[0],fields:o,facetCfg:n,hierarchy:a})},o$t=function(r){var t=r.facetCfg,e=r.rootNode,i=r.hierarchy,n=t.dataSet.fields.customTreeItems;r$({customTreeItems:n,facetCfg:t,level:0,parentNode:e,hierarchy:i})},s$t=function(r){var t=r.facetCfg,e=r.rootNode,i=r.hierarchy,n=t.hierarchyType,a=t.rows,o=t.dataSet;n==="tree"?i$({level:0,currentField:a[0],pivotMeta:o.rowPivotMeta,facetCfg:t,parentNode:e,hierarchy:i}):o$t(r)},l$t=function(r){var t=r.spreadsheet;t.isHierarchyTreeType()?s$t(r):n$(r)},u$t=function(r){var t=r.isPivotMode,e=r.hierarchy,i=r.rootNode,n=r.facetCfg;t?n$(r):tUt({parentNode:i,hierarchy:e,facetCfg:n})},DE=function(r){var t=r.isRowHeader,e=r.facetCfg,i=e.spreadsheet,n=e.rows,a=n===void 0?[]:n,o=e.columns,s=o===void 0?[]:o,l=i.dataCfg.fields.valueInCols,u=i.isPivotMode(),c=e.dataSet.moreThanOneValue(),h=Zr.rootNode(),f=new Hz,d={isValueInCols:l,isPivotMode:u,moreThanOneValue:c,rootNode:h,hierarchy:f,spreadsheet:i,facetCfg:e,fields:t?a:s,isRowHeader:t};t?l$t(d):u$t(d);var v=function(){return t&&i.isHierarchyTreeType()?f.getNodes():f.getLeaves()};return{hierarchy:f,leafNodes:v()}},c$t=function(r){yt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.renderFrozenGroupSplitLine=function(i,n){var a;if((a=e.foregroundGroup.findById(dm))===null||a===void 0||a.remove(),e.enableFrozenFirstRow()){var o=Math.floor(n-e.getPaginationScrollY()),s=e.foregroundGroup.addGroup({id:dm,zIndex:Zd}),l=kt(e.cfg,"spreadsheet.theme.splitLine"),u={lineWidth:l==null?void 0:l.horizontalBorderWidth,stroke:l==null?void 0:l.horizontalBorderColor,opacity:l==null?void 0:l.horizontalBorderColorOpacity},c=e.cornerBBox.height,h=e.getCellRange(),f=c+e.getTotalHeightForRange(h.start,h.start),d=e.panelBBox.viewportWidth+e.layoutResult.rowsHierarchy.width+e.getSeriesNumberWidth();qr(s,{x1:0,x2:d,y1:f,y2:f},U({},u)),l.showShadow&&o>0&&s.addShape("rect",{attrs:{x:0,y:f,width:d,height:l.shadowWidth,fill:e.getShadowFill(90)}})}},e}return t.prototype.updateFrozenGroupGrid=function(){var e=this;[Wn.FROZEN_ROW].forEach(function(i){if(e.frozenGroupInfo[i].range){var n=[],a=[];if(i.toLowerCase().includes("row")){var o=rt(e.frozenGroupInfo[i].range,2),s=o[0],l=o[1];n=e.gridInfo.cols,a=E_(s,l,e.viewCellHeights)}e.spreadsheet["".concat(i,"Group")].updateGrid({cols:n,rows:a},"".concat(i,"Group"))}})},t.prototype.getBizRevisedFrozenOptions=function(){return xh(this.cfg,this.layoutResult.rowNodes)},t.prototype.clip=function(e,i){var n=this.spreadsheet,a=n.isFrozenRowHeader,o=n.frozenRowGroup;if(!a.call(this.spreadsheet)){if(this.panelScrollGroupClip(e,i),this.enableFrozenFirstRow()){var s=this.getPaginationScrollY();o.setClip({type:"rect",attrs:{x:0,y:s,width:this.panelBBox.width+e,height:o.getBBox().height}})}return}r.prototype.clip.call(this,e,i)},Object.defineProperty(t.prototype,"rowCellTheme",{get:function(){return this.spreadsheet.theme.rowCell.cell},enumerable:!1,configurable:!0}),t.prototype.getContentHeight=function(){var e=this.layoutResult,i=e.rowsHierarchy,n=e.colsHierarchy;return i.height+n.height},t.prototype.doLayout=function(){var e=this,i=DE({isRowHeader:!0,facetCfg:this.cfg}),n=i.leafNodes,a=i.hierarchy,o=DE({isRowHeader:!1,facetCfg:this.cfg}),s=o.leafNodes,l=o.hierarchy;this.calculateNodesCoordinate(n,a,s,l);var u=this.cfg,c=u.dataSet,h=u.spreadsheet,f=function(v,p){var g=v||0,m=p||0,y=n[g],_=s[m];if(!y||!_)return null;var x=y.query,C=_.query,A=y.isTotals||y.isTotalMeasure||_.isTotals||_.isTotalMeasure,b=e.getMeasureInfo(),R=Sm({},x,C,b),M=vd(y,_),O=c.getCellData({query:R,rowNode:y,isTotals:A,totalStatus:M}),F=R[Kt],D=kt(O,Zi,null);return{spreadsheet:h,x:_.x,y:y.y,width:_.width,height:y.height,data:O,rowIndex:g,colIndex:m,isTotals:A,valueField:F,fieldValue:D,rowQuery:x,colQuery:C,rowId:y.id,colId:_.id,id:fp(y.id,_.id)}},d={colNodes:l.getNodes(),colsHierarchy:l,rowNodes:a.getNodes(),rowsHierarchy:a,rowLeafNodes:n,colLeafNodes:s,getCellMeta:f,spreadsheet:h};return $kt(this.cfg,d)},t.prototype.getMeasureInfo=function(){var e,i,n,a=this.cfg,o=a.dataSet,s=a.spreadsheet,l=s.options.hierarchyType,u=(i=kt(s,"facet.cfg.colCfg.hideMeasureColumn"))!==null&&i!==void 0?i:!1;return u&&l!=="customTree"?(e={},e[Kt]=(n=o.fields.values)===null||n===void 0?void 0:n[0],e):{}},t.prototype.calculateNodesCoordinate=function(e,i,n,a){this.calculateRowNodesCoordinate(e,i,n),this.calculateColNodesCoordinate(n,a,e,i.width)},t.prototype.calculateColNodesCoordinate=function(e,i,n,a){for(var o,s,l,u=Zr.blankNode(),c=i.getNodes(),h=i.sampleNodesForAllLevels,f=0;f<h.length;f++){var d=h[f];if(d.height=this.getColNodeHeight(d),i.height+=d.height,d.level===0)d.y=0;else{var v=h[f-1];d.y=(o=(v==null?void 0:v.y)+(v==null?void 0:v.height))!==null&&o!==void 0?o:0}}for(var p=0,g=function(_){var x=c[_];if(x.isLeaf&&(x.colIndex=p,p+=1,x.x=u.x+u.width,x.width=m.calculateColLeafNodesWidth(x,e,n,a),i.width+=x.width,u=x),x.level===0)x.y=0;else{var C=i.sampleNodesForAllLevels.find(function(A){return A.level===x.level-1});x.y=(s=(C==null?void 0:C.y)+(C==null?void 0:C.height))!==null&&s!==void 0?s:0}x.height=m.getColNodeHeight(x),yE(m.cfg,null,x)},m=this,y=0;y<c.length;y++)g(y);this.autoCalculateColNodeWidthAndX(e),st((l=this.spreadsheet.options.totals)===null||l===void 0?void 0:l.col)||(this.adjustTotalNodesCoordinate({hierarchy:i,isRowHeader:!1,isSubTotal:!0}),this.adjustTotalNodesCoordinate({hierarchy:i,isRowHeader:!1,isSubTotal:!1}))},t.prototype.autoCalculateColNodeWidthAndX=function(e){for(var i,n=null,a=0,o=e.slice(0);a<o.length;){var s=o[a++],l=s.parent;if(n!==l&&l){o.push(l);var u=(i=l.children)===null||i===void 0?void 0:i.find(function(f){return f.width}),c=u==null?void 0:u.x,h=Tz(l.children,"width");l.x=c,l.width=h,n=l}}},t.prototype.calculateColLeafNodesWidth=function(e,i,n,a){var o,s,l,u,c,h=this.cfg,f=h.colCfg,d=h.dataSet,v=h.filterDisplayDataItem,p=this.getCellDraggedWidth(e);if(Si(p))return p;var g=this.getCellCustomWidth(e,f==null?void 0:f.width);if(Si(g))return g;if(this.spreadsheet.getLayoutWidthType()===Au.Compact){for(var m=this.spreadsheet.theme.colCell,y=m.bolderText,_=m.cell,x=m.icon,C=this.spreadsheet.theme.dataCell.text,A=this.spreadsheet.dataSet.getFieldFormatter(e.field),b=(o=A==null?void 0:A(e.value))!==null&&o!==void 0?o:e.label,R=this.getExpectedCellIconWidth(ut.COL_CELL,this.spreadsheet.isValueInCols()&&this.spreadsheet.options.showDefaultHeaderActionIcon,x),M=this.spreadsheet.measureTextWidth(b,y)+R,O=this.getMeasureInfo(),F=void 0,D=0,H=0,j=0;j<O1;j++){var $=n[j];if($){var k=d.getCellData({query:U(U({},e.query),$.query),rowNode:$,isTotals:e.isTotals||e.isTotalMeasure||$.isTotals||$.isTotalMeasure,totalStatus:vd($,e)});if(k){var V=hH(k,v),Q=(l=(s=this.spreadsheet.dataSet.getFieldFormatter(k[Kt]))===null||s===void 0?void 0:s(V))!==null&&l!==void 0?l:V,Y="".concat(Q),tt=Sm({},$.query,e.query,O),et=tt[Kt],dt=Kz(this.spreadsheet.options.conditions,this.spreadsheet.theme.dataCell.icon,et),Et=dt.size,ht=dt.margin,vt=ht.left,It=ht.right,ce=Et+vt+It,_e=this.spreadsheet.measureTextWidth(Y,C)+ce;_e>D&&(F=Y,D=_e,H=ce)}}}var Ve=M>D,Fi=Ve?b:F,dn=Ve?R:H;co.getInstance().logger("Max Label In Col:",e.field,Fi,D);var da=this.spreadsheet.measureTextWidth(Fi,U(U({},y),{fontSize:Math.max(C.fontSize,y.fontSize)}));return da+((u=_.padding)===null||u===void 0?void 0:u.left)+((c=_.padding)===null||c===void 0?void 0:c.right)+dn}return this.spreadsheet.isHierarchyTreeType()?this.getAdaptTreeColWidth(e,i,n):this.getAdaptGridColWidth(i,a)},t.prototype.getColNodeHeight=function(e){var i=this.cfg.colCfg,n=kt(i,["heightByField",e.key]);return n??(i==null?void 0:i.height)},t.prototype.getExpectedCellIconWidth=function(e,i,n){var a,o=0;if(i)o=1;else{var s=t2(ue(this.spreadsheet.options.headerActionIcons,function(l){return U(U({},l),{displayCondition:function(){return!0}})}),null,e);o=(a=s==null?void 0:s.iconNames.length)!==null&&a!==void 0?a:0}return o?o*(n.size+n.margin.left)+n.margin.right:0},t.prototype.calculateRowNodesCoordinate=function(e,i,n){var a,o,s,l,u,c,h,f,d,v,p=this.cfg,g=p.cellCfg,m=p.spreadsheet,y=m.isHierarchyTreeType(),_=kt(m,"options.style.rowCfg.heightByField",{}),x=(s=i.sampleNodesForAllLevels)!==null&&s!==void 0?s:[];if(y)i.width=this.getTreeRowHeaderWidth();else try{for(var C=ia(i.sampleNodesForAllLevels),A=C.next();!A.done;A=C.next()){var b=A.value;b.width=this.calculateGridRowNodesWidth(b,n),i.width+=b.width;var R=(l=x[b.level-1])!==null&&l!==void 0?l:{x:0,width:0};b.x=(R==null?void 0:R.x)+(R==null?void 0:R.width)}}catch($){a={error:$}}finally{try{A&&!A.done&&(o=C.return)&&o.call(C)}finally{if(a)throw a.error}}for(var M=Zr.blankNode(),O=i.getNodes(),F=0;F<O.length;F++){var D=O[F],H=y||!y&&D.isLeaf;if(H&&((u=D.rowIndex)!==null&&u!==void 0||(D.rowIndex=F),(c=D.colIndex)!==null&&c!==void 0||(D.colIndex=F),D.y=M.y+M.height,D.height=((h=_==null?void 0:_[D.id])!==null&&h!==void 0?h:g==null?void 0:g.height)+((f=this.rowCellTheme.padding)===null||f===void 0?void 0:f.top)+((d=this.rowCellTheme.padding)===null||d===void 0?void 0:d.bottom),M=D,i.height+=D.height),y||D.level===0)D.x=0;else{var R=x[D.level-1];D.x=(R==null?void 0:R.x)+(R==null?void 0:R.width)}if(y)D.width=this.getTreeRowHeaderWidth();else{var j=x[D.level];D.width=j==null?void 0:j.width}yE(this.cfg,D,null)}y||(this.autoCalculateRowNodeHeightAndY(e),st((v=m.options.totals)===null||v===void 0?void 0:v.row)||(this.adjustTotalNodesCoordinate({hierarchy:i,isRowHeader:!0,isSubTotal:!1}),this.adjustTotalNodesCoordinate({hierarchy:i,isRowHeader:!0,isSubTotal:!0})))},t.prototype.autoCalculateRowNodeHeightAndY=function(e){for(var i=null,n=0,a=e.slice(0);n<a.length;){var o=a[n++],s=o.parent;i!==s&&s&&(a.push(s),s.y=s.children[0].y,s.height=s.children.reduce(function(l,u){return l+u.height},0),i=s)}},t.prototype.getMultipleMap=function(e,i,n){for(var a=e.maxLevel,o=this.cfg,s=o.totals,l=o.dataSet,u=l.moreThanOneValue(),c=l.fields,h=c.rows,f=c.columns,d=i?h:f,v=i?s.row:s.col,p=n?v.subTotalsGroupDimensions||[]:v.totalsGroupDimensions||[],g=l.isEmpty()?[]:p,m=Array.from({length:a+1},function(){return 1}),y=a;y>0;y--){var _=d[y],x=_===Kt&&u;g.includes(_)||x||(m[y-1]+=m[y],m[y]=0)}return m},t.prototype.adjustTotalNodesCoordinate=function(e){var i=e.hierarchy,n=e.isRowHeader,a=e.isSubTotal,o=this.getMultipleMap(i,n,a),s=ys(i.getNodes(),function(u){return a?u.isSubTotals:u.isGrandTotals}),l=n?"width":"height";$t(s,function(u){var c,h=o[u.level];if(!h&&a)for(var f=1;h<1;)h=o[u.level-f]-f,f++;for(var d=0,v=function(g){d+=((c=i.sampleNodesForAllLevels.find(function(m){return m.level===u.level+g}))===null||c===void 0?void 0:c[l])||0},p=0;p<h;p++)v(p);u[l]=d})},t.prototype.calculateGridRowNodesWidth=function(e,i){var n=this.cfg,a=n.rowCfg,o=n.spreadsheet,s=kt(a,["widthByField",e.key]);if(Si(s))return s;var l=this.getCellCustomWidth(e,a==null?void 0:a.width);return Si(l)?l:o.getLayoutWidthType()!==Au.Adaptive?this.getCompactGridRowWidth(e):this.getAdaptGridColWidth(i)},t.prototype.getAdaptTreeColWidth=function(e,i,n){var a=this.getCanvasHW().width,o=a-this.getSeriesNumberWidth(),s=Math.min(o/2,this.getTreeRowHeaderWidth()),l=Math.max(1,i.length),u=this.cfg.cellCfg;return Math.max($1(u,this.getColLabelLength(e,n)),(o-s)/l)},t.prototype.getColLabelLength=function(e,i){var n,a=SUt(e==null?void 0:e.value);if(Lt(a))return a.length;for(var o=1,s=0;s<O1;s++){var l=i[s];if(!l)return o;for(var u=this.cfg.dataSet.getCellData({query:U(U({},e.query),l.query),rowNode:l,isTotals:e.isTotals||e.isTotalMeasure||l.isTotals||l.isTotalMeasure,totalStatus:vd(l,e)}),c=ar(u==null?void 0:u[NT]),h=0;h<c.length;h++){var f=u[c[h]],d=bc((n=f==null?void 0:f.values)===null||n===void 0?void 0:n[0]);d>o&&(o=d)}}return o},t.prototype.getAdaptGridColWidth=function(e,i){var n=this.cfg,a=n.rows,o=n.cellCfg,s=a.length,l=e.length,u=this.getCanvasHW().width,c=u-this.getSeriesNumberWidth(),h=Math.max(1,s+l);return i?Math.max($1(o),(c-i)/l):Math.max($1(o),c/h)},t.prototype.getTreeRowHeaderWidth=function(){var e,i,n,a,o=this.cfg,s=o.rows,l=o.dataSet,u=o.rowCfg,c=o.treeRowsWidth,h=c??(u==null?void 0:u.treeRowsWidth);if(Si(h))return h;var f=this.getCellCustomWidth(null,u==null?void 0:u.width);if(Si(f))return f;var d=s.map(function(_){return l.getFieldName(_)}).join("/"),v=this.spreadsheet.theme.cornerCell,p=v.bolderText,g=v.icon,m=1+this.spreadsheet.measureTextWidth(d,p)+g.size*2+((e=g.margin)===null||e===void 0?void 0:e.left)+((i=g.margin)===null||i===void 0?void 0:i.right)+((n=this.rowCellTheme.padding)===null||n===void 0?void 0:n.left)+((a=this.rowCellTheme.padding)===null||a===void 0?void 0:a.right),y=Math.max(h??YO,m);return Number.isNaN(y)?YO:y},t.prototype.getCompactGridRowWidth=function(e){var i=this,n,a=this.cfg,o=a.dataSet,s=a.spreadsheet,l=s.theme.rowCell,u=l.bolderText,c=l.icon,h=l.cell,f=s.theme.cornerCell,d=f.bolderText,v=f.icon,p=f.cell,g=e.field,m=e.isLeaf,y=this.getExpectedCellIconWidth(ut.ROW_CELL,!s.isValueInCols()&&m&&s.options.showDefaultHeaderActionIcon,c),_=(n=o.getDimensionValues(g))===null||n===void 0?void 0:n.slice(0,O1).map(function(M){var O,F;return(F=(O=i.spreadsheet.dataSet.getFieldFormatter(g))===null||O===void 0?void 0:O(M))!==null&&F!==void 0?F:M}),x=Sb(_,function(M){return"".concat(M).length}),C=s.measureTextWidth(x,u)+y+h.padding.left+h.padding.right,A=o.getFieldName(g),b=this.getExpectedCellIconWidth(ut.CORNER_CELL,!1,v),R=s.measureTextWidth(A,d)+b+p.padding.left+p.padding.right;return co.getInstance().logger("Max Label In Row:",g,C>R?x:A),Math.max(C,R)},t.prototype.getViewCellHeights=function(e){var i=e.rowLeafNodes,n=l_(i,function(a,o){return a.push(Be(a)+o.height),a},[0]);return{getTotalHeight:function(){return Be(n)||0},getCellOffsetY:function(a){return n[a]||0},getTotalLength:function(){return n.length-1},getIndexRange:function(a,o){return ZH(n,a,o)}}},t.prototype.getRowHeader=function(){if(!this.rowHeader){var e=this.getRowHeaderCfg(),i=e.viewportHeight,n=Fy(e,["viewportHeight"]),a=xh(this.cfg,this.layoutResult.rowNodes).frozenRowHeight;return new i$t(U(U({},n),{viewportHeight:i-a}))}},t.prototype.enableFrozenFirstRow=function(){return!!this.getBizRevisedFrozenOptions().frozenRowCount},t}(e$),h$t=function(r){yt(t,r);function t(e){var i=this,n,a,o;i=r.call(this,e)||this,i.getScrollGroupClipBBox=function(){var v,p=i.headerConfig,g=p.width,m=p.height,y=p.scrollX,_=p.spreadsheet,x=_.options;if(!x.frozenColCount&&!x.frozenTrailingColCount)return{x:y,y:0,width:g,height:m};for(var C=(v=_.facet)===null||v===void 0?void 0:v.layoutResult.colLeafNodes,A=js(_.options,C.length),b=A.frozenColCount,R=A.frozenTrailingColCount,M=0,O=0,F=0;F<b;F++)M+=C[F].width;for(var F=0;F<R;F++)O+=C[C.length-1-F].width;var D=g-M-O;return{x:y+M,y:0,width:D,height:m}};var s=(n=i.headerConfig.spreadsheet)===null||n===void 0?void 0:n.options,l=s.frozenColCount,u=s.frozenTrailingColCount,c=(o=(a=i.headerConfig.spreadsheet)===null||a===void 0?void 0:a.facet)===null||o===void 0?void 0:o.layoutResult.colNodes.filter(function(v){return ho(v)}),h=bm(c,l,u),f=h.colCount,d=h.trailingColCount;return i.finalColCount=f,i.finalTrailingColCount=d,f&&(i.frozenColGroup=i.addGroup({name:owt,zIndex:Zd})),d&&(i.frozenTrailingColGroup=i.addGroup({name:swt,zIndex:Zd})),i}return t.prototype.isFrozenCell=function(e){var i=this.headerConfig.spreadsheet,n=i==null?void 0:i.options,a=n.frozenColCount,o=n.frozenTrailingColCount,s=e.colIndex,l=i==null?void 0:i.facet.layoutResult.colLeafNodes;return su(s,a)||lu(s,o,l.length)},t.prototype.clear=function(){var e,i,n=this.headerConfig.spreadsheet;r.prototype.clear.call(this),(e=this.frozenTrailingColGroup)===null||e===void 0||e.clear(),(i=this.frozenColGroup)===null||i===void 0||i.clear();var a=n==null?void 0:n.foregroundGroup.findById(Qk);a==null||a.clear()},t.prototype.getCellInstance=function(e,i,n){return e.field===Su?new j9t(e,i,n):new xH(e,i,n)},t.prototype.getCellGroup=function(e){var i,n=this.headerConfig.spreadsheet,a=_E(e).colIndex;return su(a,this.finalColCount)?this.frozenColGroup:lu(a,this.finalTrailingColCount,(i=n==null?void 0:n.facet)===null||i===void 0?void 0:i.layoutResult.colLeafNodes.length)?this.frozenTrailingColGroup:this.scrollGroup},t.prototype.isColCellInRect=function(e){var i,n=this.headerConfig.spreadsheet,a=(i=n==null?void 0:n.facet)===null||i===void 0?void 0:i.layoutResult.colLeafNodes.length,o=_E(e).colIndex;return su(o,this.finalColCount)||lu(o,this.finalTrailingColCount,a)?!0:r.prototype.isColCellInRect.call(this,e)},t.prototype.clip=function(){this.scrollGroup.setClip({type:"rect",attrs:this.getScrollGroupClipBBox()})},t}(f2),f$t=function(r){yt(t,r);function t(e){var i=r.call(this,e)||this;i.onSortHandler=function(a){var o=i.spreadsheet,s=a;Array.isArray(a)||(s=[a]);var l=o.dataCfg.sortParams||[];s=s.map(function(c){var h,f,d=U(U({},c),{sortFieldId:(h=c.sortKey)!==null&&h!==void 0?h:c.sortFieldId}),v=(f=l.find(function(p){return p.sortFieldId===d.sortFieldId}))!==null&&f!==void 0?f:{};return U(U({},v),d)});var u=l.filter(function(c){var h=s.find(function(f){return f.sortFieldId===c.sortFieldId});return!h});rv(o.dataCfg,"sortParams",ft(ft([],rt(u),!1),rt(s),!1)),o.setDataCfg(o.dataCfg),o.render(!0),o.emit(X.RANGE_SORTED,o.dataSet.getDisplayDataSet())},i.onFilterHandler=function(a){var o=i.spreadsheet,s=!a.filteredValues||a.filteredValues.length===0,l=o.dataCfg.filterParams||[],u=l.findIndex(function(c){return c.filterKey===a.filterKey});u!==-1?s?l.splice(u,1):l[u]=a:l.push(a),rv(o.dataCfg,"filterParams",l),o.render(!0),o.emit(X.RANGE_FILTERED,o.dataSet.getDisplayDataSet())},i.renderFrozenPanelCornerGroup=function(){var a=i.layoutResult.colNodes.filter(function(g){return ho(g)}),o=i.getCellRange(),s=js(i.spreadsheet.options,a.length,o.end-o.start+1),l=s.frozenRowCount,u=s.frozenColCount,c=s.frozenTrailingRowCount,h=s.frozenTrailingColCount,f=bm(a,u,h),d=f.colCount,v=f.trailingColCount,p=Ykt({frozenRowCount:l,frozenColCount:d,frozenTrailingRowCount:c,frozenTrailingColCount:v},i.layoutResult.colLeafNodes.length,o);Object.keys(p).forEach(function(g){var m=p[g],y=i.spreadsheet[iU[g]];y&&m.forEach(function(_){i.addFrozenCell(_.x,_.y,y)})})},i.addFrozenCell=function(a,o,s){var l=i.layoutResult.getCellMeta(o,a);if(l.isFrozenCorner=!0,l){var u=i.cfg.dataCell(l);s.add(u)}};var n=i.spreadsheet;return n.on(X.RANGE_SORT,i.onSortHandler),n.on(X.RANGE_FILTER,i.onFilterHandler),i}return t.prototype.updateRowResizeArea=function(){var e=this.spreadsheet,i=e.foregroundGroup,n=e.options,a=kt(n,"interaction.resize"),o=uo(a)?a:a==null?void 0:a.rowCellVertical;if(o){var s=i.findById(ph),l=i.findById(qk);s&&s.set("children",[]),l&&l.set("children",[]);var u=pd(this.panelGroup.getChildren(),m_).filter(function(c){return c.shouldDrawResizeArea()});u==null||u.forEach(function(c){c.drawResizeArea()})}},t.prototype.clip=function(e,i){r.prototype.clip.call(this,e,i),this.clipResizeAreaGroup()},t.prototype.clipResizeAreaGroup=function(){var e,i,n=this.spreadsheet.foregroundGroup.findById(ph);if(n){var a=this.layoutResult.colLeafNodes,o=this.spreadsheet,s=o.frozenRowGroup,l=o.frozenTrailingRowGroup,u=0,c=0;s&&(u=s.getBBox().height),l&&(c=l.getBBox().height);var h=this.panelBBox.height-u-c;n.setClip({type:"rect",attrs:{x:0,y:u+this.cornerBBox.height,width:(i=(e=a==null?void 0:a[0])===null||e===void 0?void 0:e.width)!==null&&i!==void 0?i:0,height:h}})}},t.prototype.getContentHeight=function(){var e=this.getViewCellHeights().getTotalHeight,i=this.layoutResult.colsHierarchy;return e()+i.height},Object.defineProperty(t.prototype,"dataCellTheme",{get:function(){return this.spreadsheet.theme.dataCell.cell},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){var e=this.spreadsheet;e.off(X.RANGE_SORT,this.onSortHandler),e.off(X.RANGE_FILTER,this.onFilterHandler),r.prototype.destroy.call(this)},t.prototype.calculateCornerBBox=function(){var e=this.layoutResult.colsHierarchy,i=Math.floor(e.height);this.cornerBBox=new QH(this),this.cornerBBox.height=i,this.cornerBBox.maxY=i},t.prototype.doLayout=function(){var e=this,i=this.cfg,n=i.dataSet,a=i.spreadsheet,o=new Hz,s=DE({isRowHeader:!1,facetCfg:this.cfg}),l=s.leafNodes,u=s.hierarchy;this.calculateColNodesCoordinate(l,u);var c=function(f,d){var v,p=e.cfg.showSeriesNumber,g=l[d],m=e.getCellHeight(f),y=e.getCellRange(),_=js(e.cfg,l.length,y.end-y.start+1).frozenTrailingRowCount,x,C=g.x,A=e.viewCellHeights.getCellOffsetY(f);return cp(f,y.end,_)&&(A=e.panelBBox.maxY-e.getTotalHeightForRange(f,y.end)),p&&g.field===Su?x="".concat(f+1):x=n.getCellData({query:{field:g.field,rowIndex:f}}),{spreadsheet:a,x:C,y:A,width:g.width,height:m,data:(v={},v[g.field]=x,v),rowIndex:f,colIndex:d,isTotals:!1,colId:g.id,rowId:String(f),valueField:g.field,fieldValue:x,id:fp(String(f),g.id)}},h={colNodes:u.getNodes(),colsHierarchy:u,rowNodes:o.getNodes(),rowsHierarchy:o,rowLeafNodes:o.getLeaves(),colLeafNodes:l,getCellMeta:c,spreadsheet:a};return h},t.prototype.getAdaptiveColWidth=function(e){var i=this.cfg.cellCfg,n=this.cfg.showSeriesNumber;if(this.spreadsheet.getLayoutWidthType()!==Au.Compact){var a=this.getSeriesNumberWidth(),o=e.length-(n?1:0),s=this.getCanvasHW().width-a;return Math.max(i==null?void 0:i.width,s/Math.max(1,o))}return i==null?void 0:i.width},t.prototype.getColNodeHeight=function(e,i){var n=this.cfg.colCfg,a=_s(n==null?void 0:n.heightByField)[0],o=a||(n==null?void 0:n.height);if(!i||e.children&&e.children.length)return o;for(;e.parent;)i-=ho(e)?0:o,e=e.parent;return i},t.prototype.calculateColNodesCoordinate=function(e,i){var n,a,o,s,l,u,c=Zr.blankNode(),h=i.getNodes();try{for(var f=ia(i.sampleNodesForAllLevels),d=f.next();!d.done;d=f.next()){var v=d.value;v.height=this.getColNodeHeight(v),i.height+=v.height}}catch(R){n={error:R}}finally{try{d&&!d.done&&(a=f.return)&&a.call(f)}finally{if(n)throw n.error}}for(var p=this.getAdaptiveColWidth(e),g=0,m=0;m<h.length;m++){var y=h[m];y.isLeaf&&(y.colIndex=g,g+=1,y.x=c.x+c.width,y.width=this.calculateColLeafNodesWidth(y,p),yE(this.cfg,null,y),i.width+=y.width,c=y),y.level===0?y.y=0:y.y=(l=((o=y.parent)===null||o===void 0?void 0:o.y)+((s=y.parent)===null||s===void 0?void 0:s.height))!==null&&l!==void 0?l:0,y.height=this.getColNodeHeight(y,i.height)}var _=h.filter(function(R){return ho(R)}),x=js((u=this.spreadsheet)===null||u===void 0?void 0:u.options,_.length).frozenTrailingColCount;c=Zr.blankNode();var C=this.getCanvasHW().width;if(x>0)for(var A=bm(_,0,x).trailingColCount,b=h.filter(function(R){return R.isLeaf}),m=1;m<=A;m++){var y=b[b.length-m];m===1?y.x=C-y.width:y.x=c.x-y.width,c=y}this.autoCalculateColNodeWidthAndX(e)},t.prototype.autoCalculateColNodeWidthAndX=function(e){for(var i=null,n=e.slice(0);n.length;){var a=n.shift(),o=a.parent;i!==o&&o&&(n.push(o),o.x=o.children[0].x,o.width=o.children.map(function(s){return s.width}).reduce(function(s,l){return s+l},0),i=o)}},t.prototype.calculateColLeafNodesWidth=function(e,i){var n=this.cfg,a=n.colCfg,o=n.dataSet,s=n.spreadsheet,l=this.spreadsheet.getLayoutWidthType(),u=this.getCellDraggedWidth(e);if(Si(u))return u;var c=this.getCellCustomWidth(e,a==null?void 0:a.width);if(Si(c))return c;var h;if(l===Au.Compact){var f=o.getDisplayDataSet(),d=o.getFieldFormatter(e.field),v=Sb(f==null?void 0:f.slice(0,50).map(function(A){var b;return"".concat((b=d==null?void 0:d(A[e.field]))!==null&&b!==void 0?b:A[e.field])}),function(A){return s.measureTextWidthRoughly(A)});co.getInstance().logger("Max Label In Col:",e.field,v);var p=s.theme.colCell.bolderText,g=s.theme.dataCell,m=g.text,y=g.cell,_=1,x=s.measureTextWidth(v,m)+y.padding.left+y.padding.right+_,C=s.measureTextWidth(e.label,p)+Y9t(this.spreadsheet,e,s.theme.colCell);h=Math.max(C,x)}else h=i;return e.field===Su&&(h=this.getSeriesNumberWidth()),h},t.prototype.initRowOffsets=function(){var e=this,i,n=this.cfg.dataSet,a=(((i=this.spreadsheet.options.style)===null||i===void 0?void 0:i.rowCfg)||{}).heightByField,o=a===void 0?{}:a;if(Object.keys(o).length){var s=n.getDisplayDataSet();this.rowOffsets=[0];var l=0;s.forEach(function(u,c){var h,f=(h=o==null?void 0:o[String(c)])!==null&&h!==void 0?h:e.getDefaultCellHeight(),d=l+f;e.rowOffsets.push(d),l=d})}},t.prototype.getCellHeight=function(e){var i;if(this.rowOffsets){var n=(((i=this.spreadsheet.options.style)===null||i===void 0?void 0:i.rowCfg)||{}).heightByField,a=n===void 0?{}:n,o=a==null?void 0:a[String(e)];if(Si(o))return o}return this.getDefaultCellHeight()},t.prototype.getViewCellHeights=function(){var e=this,i=this.cfg.dataSet,n=this.getDefaultCellHeight();return{getTotalHeight:function(){return e.rowOffsets?Be(e.rowOffsets):n*i.getDisplayDataSet().length},getCellOffsetY:function(a){if(a<=0)return 0;if(e.rowOffsets)return e.rowOffsets[a];for(var o=0,s=0;s<a;s++)o+=n;return o},getTotalLength:function(){return i.getDisplayDataSet().length},getIndexRange:function(a,o){if(e.rowOffsets)return ZH(e.rowOffsets,a,o);var s=Math.floor(a/n),l=o%n===0?o/n-1:Math.floor(o/n);return{start:Math.max(0,s),end:Math.max(0,l)}}}},t.prototype.init=function(){this.initRowOffsets(),r.prototype.init.call(this);var e=this.panelBBox,i=e.width,n=e.height;this.spreadsheet.panelGroup.setClip({type:"rect",attrs:{x:0,y:this.cornerBBox.height,width:i,height:n}})},t.prototype.getColHeader=function(){if(!this.columnHeader){var e=this.panelBBox,i=e.x,n=e.width,a=e.viewportHeight,o=e.viewportWidth;return new h$t({width:n,height:this.cornerBBox.height,viewportWidth:o,viewportHeight:a,cornerWidth:this.cornerBBox.width,position:{x:i,y:0},data:this.layoutResult.colNodes,scrollContainsRowHeader:this.cfg.spreadsheet.isScrollContainsRowHeader(),sortParam:this.cfg.spreadsheet.store.get("sortParam"),spreadsheet:this.spreadsheet})}return this.columnHeader},t.prototype.render=function(){this.renderFrozenPanelCornerGroup(),r.prototype.render.call(this)},t.prototype.getRowHeader=function(){return null},t.prototype.getSeriesNumberHeader=function(){return null},t}(e$),a$=function(r){yt(t,r);function t(e){var i=r.call(this,e)||this;return i.gridInfo={cols:[],rows:[]},i.updateGrid=function(n,a){a===void 0&&(a=HO);var o=i.getBBox(),s=i.s2,l=s.theme,u=s.isTableMode,c=l.dataCell.cell,h=u()&&(a===HO||a===Zk);(!i.gridGroup||!i.findById(a))&&(i.gridGroup=i.addGroup({id:a})),i.gridGroup.clear(),i.gridInfo=n,h&&i.gridInfo.cols.unshift(0);var f=c.verticalBorderWidth,d=c.verticalBorderWidth/2;i.gridInfo.cols.forEach(function(g){qr(i.gridGroup,{x1:g,x2:g,y1:Math.ceil(o.minY+d),y2:Math.floor(o.maxY-d)},{stroke:c.verticalBorderColor,strokeOpacity:c.verticalBorderColorOpacity,lineWidth:f,lineCap:VO,lineDash:c.borderDash})});var v=c.horizontalBorderWidth,p=c.horizontalBorderWidth/2;i.gridInfo.rows.forEach(function(g){qr(i.gridGroup,{x1:Math.ceil(o.minX+p),x2:Math.floor(o.maxX-p),y1:g,y2:g},{stroke:c.horizontalBorderColor,strokeOpacity:c.horizontalBorderColorOpacity,lineWidth:v,lineCap:VO,lineDash:c.borderDash})}),i.gridGroup.toFront()},i.s2=e.s2,i}return t}(Mo),o$=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t}(a$),d$t=function(r){yt(t,r);function t(e){var i=r.call(this,e)||this;return i.initMergedCellsGroup(),i}return t.prototype.initMergedCellsGroup=function(){this.mergedCellsGroup&&this.findById(UO)||(this.mergedCellsGroup=this.addGroup({id:UO}))},t.prototype.updateMergedCells=function(){this.initMergedCellsGroup(),L9t(this.s2,this.mergedCellsGroup),this.mergedCellsGroup.toFront()},t.prototype.addMergeCell=function(e){var i;(i=this.mergedCellsGroup)===null||i===void 0||i.add(e)},t.prototype.update=function(e){this.updateGrid(e),this.updateMergedCells()},t}(a$),Ga=function(){function r(t){var e=this;this.isLinkFieldText=function(i){var n=e.getCellAppendInfo(i);return n==null?void 0:n.isLinkFieldText},this.spreadsheet=t,this.bindEvents()}return r.prototype.getCellAppendInfo=function(t){var e,i;return((e=t==null?void 0:t.attr)===null||e===void 0?void 0:e.call(t,"appendInfo"))||((i=t==null?void 0:t.attrs)===null||i===void 0?void 0:i.appendInfo)||{}},r.prototype.reset=function(){},r}(),v$t=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.bindEvents=function(){this.bindDataCellClick()},t.prototype.bindDataCellClick=function(){var e=this;this.spreadsheet.on(X.DATA_CELL_CLICK,function(i){var n;i.stopPropagation();var a=e.spreadsheet.interaction;if(a.clearHoverTimer(),!a.hasIntercepts([Gt.CLICK])){if(e.isLinkFieldText(i.target)){e.emitLinkFieldClickEvent(i);return}var o=e.spreadsheet.getCell(i.target),s=o.getMeta();if(s){if(a.addIntercepts([Gt.HOVER]),a.isSelectedCell(o)){((n=i.originalEvent)===null||n===void 0?void 0:n.detail)===1&&(a.reset(),e.spreadsheet.emit(X.GLOBAL_SELECTED,a.getActiveCells()));return}a.changeState({cells:[mo(o)],stateName:bt.SELECTED,onUpdateCells:i2}),e.spreadsheet.emit(X.GLOBAL_SELECTED,[o]),e.showTooltip(i,s);var l=s.rowId,u=s.colId,c=s.spreadsheet,h=a.getSelectedCellHighlight(),f=h.colHeader,d=h.rowHeader;if(f&&cH(u,a.getAllColHeaderCells(),bt.SELECTED),d&&l){var v=fzt(s,c);$t(v,function(p){p.updateByState(bt.SELECTED)})}}}})},t.prototype.getTooltipOperator=function(e,i){var n=this,a=ckt(),o=this.spreadsheet.getCell(e.target),s=l2(this.spreadsheet,e).operation,l=s.trend&&U(U({},a),{onClick:function(){n.spreadsheet.emit(X.DATA_CELL_TREND_ICON_CLICK,U(U({},i),{record:n.spreadsheet.isTableMode()?n.spreadsheet.dataSet.getCellData({query:{rowIndex:i.rowIndex}}):void 0})),n.spreadsheet.hideTooltip()}});return zH(s,{defaultMenus:[l],cell:o})},t.prototype.showTooltip=function(e,i){var n=i.data,a=i.isTotals,o=a===void 0?!1:a,s=i.value,l=i.fieldValue,u=i.field,c=i.valueField,h=n,f=this.spreadsheet.isTableMode(),d=f?U(U({},h),{value:s||l,valueField:u||c}):h,v=[d||U(U({},i.rowQuery),i.colQuery)],p=this.getTooltipOperator(e,i);this.spreadsheet.showTooltipWithInfo(e,v,{isTotals:o,operator:p,enterable:!0,hideSummary:!0,showSingleTips:f})},t.prototype.emitLinkFieldClickEvent=function(e){var i=this.getCellAppendInfo(e.target).cellData,n=i.valueField,a=i.data;this.spreadsheet.emit(X.GLOBAL_LINK_FIELD_JUMP,{key:n,cellData:i,record:Object.assign({rowIndex:i.rowIndex},a)})},t}(Ga),p$t=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.bindEvents=function(){this.bindDataCellClick()},t.prototype.bindDataCellClick=function(){var e=this;this.spreadsheet.on(X.MERGED_CELLS_CLICK,function(i){i.stopPropagation();var n=e.spreadsheet.interaction;n.hasIntercepts([Gt.CLICK])||n.addIntercepts([Gt.HOVER])})},t}(Ga),g$t=function(r){yt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.isMultiSelection=!1,e.handleRowColClick=function(i){if(i.stopPropagation(),!e.isLinkFieldText(i.target)){var n=e.spreadsheet,a=n.interaction,o=n.options,s=e.spreadsheet.getCell(i.target),l=o.interaction.multiSelection,u=!!(l&&e.isMultiSelection),c=a.selectHeaderCell({cell:s,isMultiSelection:u});c&&e.showTooltip(i)}},e.getHideColumnField=function(i){return e.spreadsheet.isTableMode()?i.field:i.id},e}return t.prototype.bindEvents=function(){this.bindKeyboardDown(),this.bindKeyboardUp(),this.bindColCellClick(),this.bindRowCellClick(),this.bindTableColExpand(),this.bindMouseMove()},t.prototype.reset=function(){this.isMultiSelection=!1,this.spreadsheet.interaction.removeIntercepts([Gt.CLICK])},t.prototype.bindKeyboardDown=function(){var e=this;this.spreadsheet.on(X.GLOBAL_KEYBOARD_DOWN,function(i){Lm(i)&&(e.isMultiSelection=!0)})},t.prototype.bindKeyboardUp=function(){var e=this;this.spreadsheet.on(X.GLOBAL_KEYBOARD_UP,function(i){Lm(i)&&e.reset()})},t.prototype.bindMouseMove=function(){var e=this;this.spreadsheet.on(X.GLOBAL_MOUSE_MOVE,function(i){e.isMultiSelection&&!TH(i)&&e.reset()})},t.prototype.bindRowCellClick=function(){var e=this;this.spreadsheet.on(X.ROW_CELL_CLICK,function(i){e.handleRowColClick(i)})},t.prototype.bindColCellClick=function(){var e=this;this.spreadsheet.on(X.COL_CELL_CLICK,function(i){e.handleRowColClick(i)})},t.prototype.showTooltip=function(e){var i=l2(this.spreadsheet,e),n=i.operation,a=i.showTooltip;if(a){var o=this.spreadsheet.interaction,s=o.isSelectedState()?SHt(o.getActiveCells()):[],l=this.getTooltipOperator(e,n);this.spreadsheet.showTooltipWithInfo(e,s,{showSingleTips:!0,operator:l})}},t.prototype.getTooltipOperator=function(e,i){var n=this,a=this.spreadsheet.getCell(e.target),o=a.getMeta(),s=a.cellType===ut.COL_CELL,l=this.spreadsheet.getColumnLeafNodes().length===1,u=ukt(),c=s&&!l&&o.isLeaf&&i.hiddenColumns,h=c&&U(U({},u),{onClick:function(){n.hideSelectedColumns()}});return zH(i,{defaultMenus:[h],cell:a})},t.prototype.bindTableColExpand=function(){var e=this;this.spreadsheet.on(X.LAYOUT_COLS_EXPANDED,function(i){e.handleExpandIconClick(i)})},t.prototype.hideSelectedColumns=function(){var e=this.spreadsheet.interaction,i=e.getActiveCells().map(function(a){return a.getMeta()}),n=i.map(this.getHideColumnField);Qb(this.spreadsheet,n,!0)},t.prototype.handleExpandIconClick=function(e){var i=this.spreadsheet.store.get("hiddenColumnsDetail",[]),n=(r_(i,function(c){var h=c.displaySiblingNode;return SE(h,e.id)})||{}).hideColumnNodes,a=n===void 0?[]:n,o=this.spreadsheet.options.interaction.hiddenColumnFields,s=a.map(this.getHideColumnField),l=I9(o,s),u=i.filter(function(c){var h=c.displaySiblingNode;return!SE(h,e.id)});this.spreadsheet.setOptions({interaction:{hiddenColumnFields:l}}),this.spreadsheet.store.set("hiddenColumnsDetail",u),this.spreadsheet.interaction.reset(),this.spreadsheet.render(!1)},t}(Ga),m$t=function(r){yt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.getRowData=function(i){var n,a=i.getHeadLeafChild(),o=e.spreadsheet.dataSet.getMultiData(a==null?void 0:a.query)[0];return U(U({},o),{rowIndex:(n=i.rowIndex)!==null&&n!==void 0?n:a.rowIndex})},e}return t.prototype.bindEvents=function(){this.bindRowCellClick()},t.prototype.bindRowCellClick=function(){var e=this;this.spreadsheet.on(X.ROW_CELL_CLICK,function(i){if(!e.spreadsheet.interaction.hasIntercepts([Gt.CLICK])&&e.isLinkFieldText(i.target)){var n=e.getCellAppendInfo(i.target).cellData,a=n.key,o=e.getRowData(n);e.spreadsheet.emit(X.GLOBAL_LINK_FIELD_JUMP,{key:a,cellData:n,record:o})}})},t}(Ga),y$t=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.bindEvents=function(){this.bindCornerCellClick()},t.prototype.bindCornerCellClick=function(){var e=this;this.spreadsheet.on(X.CORNER_CELL_CLICK,function(i){var n,a=e.spreadsheet.interaction,o=e.spreadsheet.getCell(i.target);if(o){var s=o.getMeta(),l=e.getRowNodesByField(s==null?void 0:s.field),u=(n=l[0])===null||n===void 0?void 0:n.belongsCell,c=e.getRowCells(l);if(u&&a.isSelectedCell(u)){a.reset(),e.spreadsheet.emit(X.GLOBAL_SELECTED,a.getActiveCells());return}st(l)||st(c)||(a.addIntercepts([Gt.HOVER]),a.changeState({cells:c,stateName:bt.SELECTED}),a.highlightNodes(l),e.showTooltip(i),e.spreadsheet.emit(X.GLOBAL_SELECTED,a.getActiveCells()))}})},t.prototype.getRowNodesByField=function(e){return this.spreadsheet.getRowNodes().filter(function(i){return i.field===e})},t.prototype.getRowCells=function(e){return e.map(function(i){return{id:i.id,colIndex:-1,rowIndex:-1,type:ut.ROW_CELL}})},t.prototype.showTooltip=function(e){var i=this.spreadsheet.interaction.getActiveCells();this.spreadsheet.showTooltipWithInfo(e,[],{data:{summaries:[{selectedData:i,name:"",value:null}]}})},t}(Ga),_$t=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.bindEvents=function(){this.bindCornerCellHover(),this.bindDataCellHover(),this.bindRowCellHover(),this.bindColCellHover()},t.prototype.updateRowColCells=function(e){var i=e.rowId,n=e.colId,a=this.spreadsheet.interaction,o=a.getHoverHighlight(),s=o.rowHeader,l=o.colHeader;if(l&&cH(n,a.getAllColHeaderCells(),bt.HOVER),s&&i){var u=qb(i,a.getAllRowHeaderCells(),this.spreadsheet.isHierarchyTreeType());$t(u,function(c){c.updateByState(bt.HOVER)})}},t.prototype.changeStateToHoverFocus=function(e,i,n){var a=this,o,s=this.spreadsheet.interaction,l=this.spreadsheet.options.interaction,u=l.hoverFocus;s.clearHoverTimer();var c=function(){if(!s.hasIntercepts([Gt.HOVER])){s.changeState({cells:[mo(e)],stateName:bt.HOVER_FOCUS});var d=a.spreadsheet.isTableMode(),v={isTotals:n.isTotals,enterable:!0,hideSummary:!0,showSingleTips:d},p=s.getHoverHighlight(),g=p.rowHeader,m=p.colHeader;(g||m)&&a.updateRowColCells(n);var y=a.getCellData(n,d);a.spreadsheet.showTooltipWithInfo(i,y,v)}},h=ZC;if(uo(u)||(h=(o=u==null?void 0:u.duration)!==null&&o!==void 0?o:ZC),h===0)c();else{var f=window.setTimeout(function(){return c()},h);s.setHoverTimer(f)}},t.prototype.handleHeaderHover=function(e){var i=this.spreadsheet.getCell(e.target);if(!st(i)){var n=this.spreadsheet.interaction;n.clearHoverTimer(),!n.isActiveCell(i)&&(n.changeState({cells:[mo(i)],stateName:bt.HOVER}),i.update(),this.showEllipsisTooltip(e,i))}},t.prototype.showEllipsisTooltip=function(e,i){if(!i||!i.isTextOverflowing()){this.spreadsheet.hideTooltip();return}var n=i.getMeta(),a=!0,o={isTotals:n.isTotals,enterable:!0,hideSummary:!0,showSingleTips:a,enableFormat:!0},s=this.getCellData(n,a);this.spreadsheet.showTooltipWithInfo(e,s,o)},t.prototype.getCellData=function(e,i){e===void 0&&(e={});var n=e.data,a=e.query,o=e.value,s=e.field,l=e.fieldValue,u=e.valueField,c=e.rowQuery,h=e.colQuery,f=n,d=i?[U(U({},a),{value:o||l,valueField:s||u})]:[f||U(U({},c),h)];return d},t.prototype.bindDataCellHover=function(){var e=this;this.spreadsheet.on(X.DATA_CELL_HOVER,function(i){var n=e.spreadsheet.getCell(i.target);if(!st(n)){var a=e.spreadsheet,o=a.interaction,s=a.options,l=s.interaction,u=n==null?void 0:n.getMeta();if(!o.isActiveCell(n)){o.changeState({cells:[mo(n)],stateName:bt.HOVER});var c=o.getHoverHighlight(),h=c.rowHeader,f=c.colHeader;(h||f)&&e.updateRowColCells(u),l.hoverFocus&&e.changeStateToHoverFocus(n,i,u)}}})},t.prototype.bindRowCellHover=function(){var e=this;this.spreadsheet.on(X.ROW_CELL_HOVER,function(i){e.handleHeaderHover(i)})},t.prototype.bindColCellHover=function(){var e=this;this.spreadsheet.on(X.COL_CELL_HOVER,function(i){e.handleHeaderHover(i)})},t.prototype.bindCornerCellHover=function(){var e=this;this.spreadsheet.on(X.CORNER_CELL_HOVER,function(i){e.handleHeaderHover(i)})},t}(Ga),v2=function(r){yt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.displayedCells=[],e.brushRangeCells=[],e.brushSelectionStage=ai.UN_DRAGGED,e.brushSelectionMinimumMoveDistance=5,e.scrollAnimationComplete=!0,e.mouseMoveDistanceFromCanvas=0,e.setMoveDistanceFromCanvas=function(i,n,a){var o=0;if(n&&(o=i.x),a){var s=i.y;n?o=Math.max(s,o):o=s}e.mouseMoveDistanceFromCanvas=Math.abs(o)},e.formatBrushPointForScroll=function(i,n){var a,o,s,l;n===void 0&&(n=!1);var u=i.x,c=i.y,h=e.spreadsheet.facet,f=n?h.cornerBBox:h.panelBBox,d=f.minX,v=f.maxX,p=h.panelBBox,g=p.minY,m=p.maxY,y=((a=e.endBrushPoint)===null||a===void 0?void 0:a.x)+u,_=((o=e.endBrushPoint)===null||o===void 0?void 0:o.y)+c,x=!0,C=!0,A=(l=(s=h.vScrollBar)===null||s===void 0?void 0:s.getBBox())===null||l===void 0?void 0:l.width,b=2;return y>v?y=v-A-b:y<d?y=d+b:x=!1,_>m?_=m-b:_<=g?_=g+b:C=!1,{x:{value:y,needScroll:x},y:{value:_,needScroll:C}}},e.rectanglesIntersect=function(i,n){return i.maxX>n.minX&&i.minX<n.maxX&&i.minY<n.maxY&&i.maxY>n.minY},e.autoScrollIntervalId=null,e.autoScrollConfig=iE(XO),e.validateYIndex=function(i){var n,a,o=e.spreadsheet.facet,s=o.frozenGroupInfo,l=0,u=(n=s==null?void 0:s.frozenRow)===null||n===void 0?void 0:n.range;if(u&&(l=u[1]+1),i<l)return null;var c=o.getCellRange().end,h=(a=s==null?void 0:s.frozenTrailingRow)===null||a===void 0?void 0:a.range;return h&&(c=h[0]-1),i>c?null:i},e.validateXIndex=function(i){var n,a,o=e.spreadsheet.facet,s=o.frozenGroupInfo,l=0,u=(n=s==null?void 0:s.frozenCol)===null||n===void 0?void 0:n.range;if(u&&(l=u[1]+1),i<l)return null;var c=o.layoutResult.colLeafNodes.length-1,h=(a=s==null?void 0:s.frozenTrailingCol)===null||a===void 0?void 0:a.range;return h&&(c=h[0]-1),i>c?null:i},e.adjustNextColIndexWithFrozen=function(i,n){var a=e.spreadsheet,o=a.facet,s=a.dataSet,l=a.options,u=s.getDisplayDataSet().length,c=o.layoutResult.colLeafNodes.length,h=js(l,c,u),f=h.frozenTrailingColCount,d=h.frozenColCount,v=o.panelScrollGroupIndexes;return f>0&&n===Dr.SCROLL_DOWN&&lu(i,f,c)?v[1]:d>0&&n===Dr.SCROLL_UP&&su(i,d)?v[0]:i},e.adjustNextRowIndexWithFrozen=function(i,n){var a=e.spreadsheet,o=a.facet,s=a.dataSet,l=a.options,u=s.getDisplayDataSet().length,c=o.layoutResult.colLeafNodes.length,h=o.getCellRange(),f=js(l,c,u),d=f.frozenTrailingRowCount,v=f.frozenRowCount,p=o.panelScrollGroupIndexes;return d>0&&n===Dr.SCROLL_DOWN&&cp(i,h.end,d)?p[3]:v>0&&n===Dr.SCROLL_UP&&d_(i,h.start,v)?p[2]:i},e.getWillScrollRowIndexDiff=function(i){return i===Dr.SCROLL_DOWN?gm.SCROLL_DOWN:gm.SCROLL_UP},e.getDefaultWillScrollToRowIndex=function(i){var n=e.adjustNextRowIndexWithFrozen(e.endBrushPoint.rowIndex,i),a=n+e.getWillScrollRowIndexDiff(i);return e.validateYIndex(a)},e.getWillScrollToRowIndex=function(i){return e.getDefaultWillScrollToRowIndex(i)},e.getNextScrollDelta=function(i){var n=e.spreadsheet.facet.getScrollOffset(),a=n.scrollX,o=n.scrollY,s=0,l=0;if(i.y.scroll){var u=i.y.value>0?Dr.SCROLL_DOWN:Dr.SCROLL_UP,c=e.getWillScrollToRowIndex(u),h=pzt(c,u,e.spreadsheet)-o,f=Or(c)||Or(h)||Number.isNaN(h);l=f?0:h}if(i.x.scroll){var u=i.x.value>0?Dr.SCROLL_DOWN:Dr.SCROLL_UP,d=e.adjustNextColIndexWithFrozen(e.endBrushPoint.colIndex,u),v=e.validateXIndex(d+(i.x.value>0?1:-1));s=Or(v)?0:vzt(v,u,e.spreadsheet)-a}return{x:s,y:l}},e.onScrollAnimationComplete=function(){e.scrollAnimationComplete=!0,e.brushSelectionStage!==ai.UN_DRAGGED&&e.renderPrepareSelected(e.endBrushPoint)},e.autoScroll=function(i){if(i===void 0&&(i=!1),!(e.brushSelectionStage===ai.UN_DRAGGED||!e.scrollAnimationComplete)){var n=e.autoScrollConfig,a=e.spreadsheet.facet.getScrollOffset(),o=i?"rowHeaderOffsetX":"offsetX",s={rowHeaderOffsetX:{value:a.rowHeaderScrollX,animate:!0},offsetX:{value:a.scrollX,animate:!0},offsetY:{value:a.scrollY,animate:!0}},l=e.getNextScrollDelta(n),u=l.x,c=l.y;if(c===0&&u===0){e.clearAutoScroll();return}if(n.y.scroll&&(s.offsetY.value+=c),n.x.scroll){var h=s[o];h.value+=u,h.value<0&&(h.value=0)}e.scrollAnimationComplete=!1;var f=n.x.scroll?1:3,d=Math.max(16,300-e.mouseMoveDistanceFromCanvas*f);e.spreadsheet.facet.scrollWithAnimation(s,d,e.onScrollAnimationComplete)}},e.handleScroll=Nb(function(i,n,a){if(a===void 0&&(a=!1),e.brushSelectionStage!==ai.UN_DRAGGED){var o=e.formatBrushPointForScroll({x:i,y:n},a),s=o.x,l=s.value,u=s.needScroll,c=o.y,h=c.value,f=c.needScroll,d=e.autoScrollConfig;f&&(d.y.value=n,d.y.scroll=!0),u&&(d.x.value=i,d.x.scroll=!0),e.setMoveDistanceFromCanvas({x:i,y:n},u,f),e.renderPrepareSelected({x:l,y:h}),(f||u)&&(e.clearAutoScroll(),e.autoScroll(a),e.autoScrollIntervalId=setInterval(function(){e.autoScroll(a)},16))}},30),e.clearAutoScroll=function(){e.autoScrollIntervalId&&(clearInterval(e.autoScrollIntervalId),e.autoScrollIntervalId=null,e.resetScrollDelta())},e.onUpdateCells=function(i,n){return n()},e.showPrepareSelectedCells=function(){e.brushRangeCells=e.getBrushRangeCells(),e.spreadsheet.interaction.changeState({cells:ue(e.brushRangeCells,function(i){return mo(i)}),stateName:bt.PREPARE_SELECT,force:!0,onUpdateCells:e.onUpdateCells})},e.renderPrepareSelected=function(i){var n=i.x,a=i.y,o=e.spreadsheet.container.getShape(n,a),s=e.spreadsheet.getCell(o),l=s instanceof Cl||s instanceof vp||s instanceof g_;if(!(!s||!l)){var u=s.getMeta(),c=u.rowIndex,h=u.colIndex;e.endBrushPoint={x:n,y:a,rowIndex:c,colIndex:h};var f=e.spreadsheet.interaction;f.addIntercepts([Gt.HOVER]),f.clearStyleIndependent(),e.isValidBrushSelection()&&(e.showPrepareSelectedCells(),e.updatePrepareSelectMask())}},e}return t.prototype.bindEvents=function(){this.bindMouseDown(),this.bindMouseMove(),this.bindMouseUp()},t.prototype.getPrepareSelectMaskTheme=function(){var e;return(e=this.spreadsheet.theme)===null||e===void 0?void 0:e.prepareSelectMask},t.prototype.initPrepareSelectMaskShape=function(){var e=this.spreadsheet.foregroundGroup;if(e){e.removeChild(this.prepareSelectMaskShape);var i=this.getPrepareSelectMaskTheme();this.prepareSelectMaskShape=e.addShape("rect",{visible:!1,attrs:{width:0,height:0,x:0,y:0,fill:i==null?void 0:i.backgroundColor,fillOpacity:i==null?void 0:i.backgroundOpacity,zIndex:j2t},capture:!1})}},t.prototype.setBrushSelectionStage=function(e){this.brushSelectionStage=e},t.prototype.isPointInCanvas=function(e){var i=this.spreadsheet.facet.getCanvasHW(),n=i.height,a=i.width,o=this.spreadsheet.facet.panelBBox,s=o.minX,l=o.minY;return e.x>s&&e.x<a&&e.y>l&&e.y<n},t.prototype.resetDrag=function(){this.hidePrepareSelectMaskShape(),this.setBrushSelectionStage(ai.UN_DRAGGED)},t.prototype.isValidBrushSelection=function(){var e=this.getBrushRange(),i=e.start,n=e.end,a=n.x-i.x>this.brushSelectionMinimumMoveDistance||n.y-i.y>this.brushSelectionMinimumMoveDistance;return a},t.prototype.setDisplayedCells=function(){this.displayedCells=this.spreadsheet.interaction.getPanelGroupAllDataCells()},t.prototype.updatePrepareSelectMask=function(){var e=this.getBrushRange(),i=this.getPrepareSelectMaskPosition(e),n=i.x,a=i.y;this.prepareSelectMaskShape.attr({x:n,y:a,width:e.width,height:e.height}),this.prepareSelectMaskShape.show()},t.prototype.hidePrepareSelectMaskShape=function(){var e;(e=this.prepareSelectMaskShape)===null||e===void 0||e.hide()},t.prototype.resetScrollDelta=function(){this.autoScrollConfig=iE(XO)},t.prototype.getBrushPoint=function(e){var i=this.spreadsheet.facet.getScrollOffset(),n=i.scrollY,a=i.scrollX,o={x:e==null?void 0:e.x,y:e==null?void 0:e.y},s=this.spreadsheet.getCell(e.target),l=s.getMeta(),u=l.colIndex,c=l.rowIndex;return U(U({},o),{rowIndex:c,colIndex:u,scrollY:n,scrollX:a})},t.prototype.getBrushRange=function(){var e,i,n,a,o,s,l,u,c=this.spreadsheet.facet.getScrollOffset(),h=c.scrollX,f=c.scrollY,d=Math.min(this.startBrushPoint.rowIndex,(e=this.endBrushPoint)===null||e===void 0?void 0:e.rowIndex),v=Math.max(this.startBrushPoint.rowIndex,(i=this.endBrushPoint)===null||i===void 0?void 0:i.rowIndex),p=Math.min(this.startBrushPoint.colIndex,(n=this.endBrushPoint)===null||n===void 0?void 0:n.colIndex),g=Math.max(this.startBrushPoint.colIndex,(a=this.endBrushPoint)===null||a===void 0?void 0:a.colIndex),m=this.startBrushPoint.x+this.startBrushPoint.scrollX-h,y=this.startBrushPoint.y+this.startBrushPoint.scrollY-f,_=Math.min(m,(o=this.endBrushPoint)===null||o===void 0?void 0:o.x),x=Math.max(m,(s=this.endBrushPoint)===null||s===void 0?void 0:s.x),C=Math.min(y,(l=this.endBrushPoint)===null||l===void 0?void 0:l.y),A=Math.max(y,(u=this.endBrushPoint)===null||u===void 0?void 0:u.y);return{start:{rowIndex:d,colIndex:p,x:_,y:C},end:{rowIndex:v,colIndex:g,x,y:A},width:x-_,height:A-C}},t.prototype.getBrushRangeCells=function(){var e=this;return this.setDisplayedCells(),this.displayedCells.filter(function(i){var n=i.getMeta();return e.isInBrushRange(n)})},t.prototype.mouseDown=function(e){var i;(i=e==null?void 0:e.preventDefault)===null||i===void 0||i.call(e),!this.spreadsheet.interaction.hasIntercepts([Gt.CLICK])&&(this.setBrushSelectionStage(ai.CLICK),this.initPrepareSelectMaskShape(),this.setDisplayedCells(),this.startBrushPoint=this.getBrushPoint(e))},t.prototype.addBrushIntercepts=function(){this.spreadsheet.interaction.addIntercepts([Gt.BRUSH_SELECTION])},t.prototype.bindMouseUp=function(e){var i=this;e===void 0&&(e=!1),this.spreadsheet.on(X.GLOBAL_MOUSE_UP,function(n){if(i.brushSelectionStage!==ai.DRAGGED){i.resetDrag();return}if(e&&i.clearAutoScroll(),i.isValidBrushSelection()){i.addBrushIntercepts(),i.updateSelectedCells();var a=s2(i.spreadsheet);i.spreadsheet.showTooltipWithInfo(n,a)}i.spreadsheet.interaction.getCurrentStateName()===bt.PREPARE_SELECT&&i.spreadsheet.interaction.reset(),i.resetDrag()}),this.spreadsheet.on(X.GLOBAL_CONTEXT_MENU,function(){i.brushSelectionStage!==ai.UN_DRAGGED&&(i.spreadsheet.interaction.removeIntercepts([Gt.HOVER]),i.resetDrag())})},t.prototype.autoBrushScroll=function(e,i){var n,a;if(i===void 0&&(i=!1),this.clearAutoScroll(),!this.isPointInCanvas(e)){var o=(e==null?void 0:e.x)-((n=this.endBrushPoint)===null||n===void 0?void 0:n.x),s=(e==null?void 0:e.y)-((a=this.endBrushPoint)===null||a===void 0?void 0:a.y);return this.handleScroll(o,s,i),!0}return!1},t.prototype.emitBrushSelectionEvent=function(e,i){this.spreadsheet.emit(e,i),this.spreadsheet.emit(X.GLOBAL_SELECTED,i),st(i)&&this.spreadsheet.interaction.removeIntercepts([Gt.HOVER])},t.prototype.getVisibleBrushRangeCells=function(e){return this.brushRangeCells.find(function(i){var n=i.getMeta();return(n==null?void 0:n.id)===e})},t.prototype.isInBrushRange=function(e){return!1},t.prototype.bindMouseDown=function(){},t.prototype.bindMouseMove=function(){},t.prototype.updateSelectedCells=function(){},t.prototype.getPrepareSelectMaskPosition=function(e){return{x:e.start.x,y:e.start.y}},t}(Ga),x$t=function(r){yt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.displayedCells=[],e.brushRangeCells=[],e.onUpdateCells=function(i){return i.updateCells(i.getAllColHeaderCells())},e}return t.prototype.bindEvents=function(){this.bindMouseDown(),this.bindMouseMove(),this.bindMouseUp()},t.prototype.bindMouseDown=function(){var e=this;this.spreadsheet.on(X.COL_CELL_MOUSE_DOWN,function(i){e.spreadsheet.interaction.getBrushSelection().col&&r.prototype.mouseDown.call(e,i)})},t.prototype.isPointInCanvas=function(e){var i=this.spreadsheet.facet.getCanvasHW().width,n=this.spreadsheet.facet.cornerBBox,a=n.width,o=n.minY,s=n.maxY;return e.x>=a&&e.x<=i&&e.y>=o&&e.y<=s},t.prototype.bindMouseMove=function(){var e=this;this.spreadsheet.on(X.COL_CELL_MOUSE_MOVE,function(i){if(e.brushSelectionStage!==ai.UN_DRAGGED){e.setBrushSelectionStage(ai.DRAGGED);var n=e.spreadsheet.container.getPointByEvent(i.originalEvent);e.isPointInCanvas(n)&&e.renderPrepareSelected(n)}})},t.prototype.setDisplayedCells=function(){this.displayedCells=this.spreadsheet.interaction.getAllColHeaderCells()},t.prototype.isInBrushRange=function(e){var i=this.getBrushRange(),n=i.start,a=i.end,o=this.spreadsheet.facet.getScrollOffset().scrollX,s=this.spreadsheet.facet.cornerBBox,l=e.x,u=l===void 0?0:l,c=e.y,h=c===void 0?0:c,f=e.width,d=f===void 0?0:f,v=e.height,p=v===void 0?0:v;return this.rectanglesIntersect({minX:n.x-s.width+o,minY:n.y,maxX:a.x-s.width+o,maxY:a.y},{minX:u,maxX:u+d,minY:h,maxY:h+p})},t.prototype.updateSelectedCells=function(){var e=this.spreadsheet.interaction;e.changeState({cells:ue(this.brushRangeCells,mo),stateName:bt.BRUSH_SELECTED,onUpdateCells:this.onUpdateCells}),this.spreadsheet.emit(X.COL_CELL_BRUSH_SELECTION,this.brushRangeCells),this.spreadsheet.emit(X.GLOBAL_SELECTED,this.brushRangeCells),st(this.brushRangeCells)&&e.removeIntercepts([Gt.HOVER])},t.prototype.addBrushIntercepts=function(){this.spreadsheet.interaction.addIntercepts([Gt.COL_BRUSH_SELECTION])},t}(v2),C$t=function(r){yt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.displayedCells=[],e.brushRangeCells=[],e.getSelectedCellMetas=function(i){var n=[],a=e.spreadsheet.facet.layoutResult,o=a.rowLeafNodes,s=o===void 0?[]:o,l=a.colLeafNodes,u=l===void 0?[]:l,c=Vc(i.start.rowIndex,i.end.rowIndex+1),h=Vc(i.start.colIndex,i.end.colIndex+1);return c.forEach(function(f){h.forEach(function(d){var v=String(u[d].id),p=st(s)?String(f):String(s[f].id);n.push({colIndex:d,rowIndex:f,id:fp(p,v),type:ut.DATA_CELL,rowId:p,colId:v,spreadsheet:e.spreadsheet})})}),n},e}return t.prototype.bindMouseDown=function(){var e=this;this.spreadsheet.on(X.DATA_CELL_MOUSE_DOWN,function(i){e.spreadsheet.interaction.getBrushSelection().data&&(r.prototype.mouseDown.call(e,i),e.resetScrollDelta())})},t.prototype.bindMouseMove=function(){var e=this;this.spreadsheet.on(X.GLOBAL_MOUSE_MOVE,function(i){if(e.brushSelectionStage!==ai.UN_DRAGGED){e.setBrushSelectionStage(ai.DRAGGED);var n=e.spreadsheet.container.getPointByEvent(i);e.autoBrushScroll(n)||e.renderPrepareSelected(n)}})},t.prototype.isInBrushRange=function(e){var i=this.getBrushRange(),n=i.start,a=i.end,o=e.rowIndex,s=e.colIndex;return o>=n.rowIndex&&o<=a.rowIndex&&s>=n.colIndex&&s<=a.colIndex},t.prototype.updateSelectedCells=function(){var e=this.getBrushRange(),i=this.getSelectedCellMetas(e);this.spreadsheet.interaction.changeState({cells:i,stateName:bt.SELECTED,onUpdateCells:i2});var n=this.getScrollBrushRangeCells(i);this.emitBrushSelectionEvent(X.DATA_CELL_BRUSH_SELECTION,n)},t.prototype.getScrollBrushRangeCells=function(e){var i=this;return e.map(function(n){var a=i.getVisibleBrushRangeCells(n.id);if(a)return a;var o=i.spreadsheet.facet.layoutResult.getCellMeta(n.rowIndex,n.colIndex),s=i.spreadsheet.isTableMode()?m_:Cl;return new s(o,i.spreadsheet)})},t.prototype.bindMouseUp=function(){r.prototype.bindMouseUp.call(this,!0)},t.prototype.getPrepareSelectMaskPosition=function(e){var i=this.spreadsheet.facet.panelBBox,n=i.minX,a=i.minY,o=Math.max(e.start.x,n),s=Math.max(e.start.y,a);return{x:o,y:s}},t}(v2),E$t=function(r){yt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.isInBrushRange=function(i){var n=e.getBrushRange(),a=n.start,o=n.end,s=e.spreadsheet.facet.getScrollOffset(),l=s.scrollY,u=s.rowHeaderScrollX,c=e.spreadsheet.facet.cornerBBox,h=i.x,f=h===void 0?0:h,d=i.y,v=d===void 0?0:d,p=i.width,g=p===void 0?0:p,m=i.height,y=m===void 0?0:m;return e.rectanglesIntersect({minX:a.x+u,minY:a.y-c.height+l,maxX:o.x+u,maxY:o.y-c.height+l},{minX:f,maxX:f+g,minY:v,maxY:v+y})},e.onUpdateCells=function(i){return i.updateCells(i.getAllRowHeaderCells())},e.getSelectedRowNodes=function(){return e.spreadsheet.getRowNodes().filter(e.isInBrushRange)},e.getVisibleRowLeafCellByScrollDirection=function(i){var n=e.spreadsheet.interaction.getAllRowHeaderCells();return i===Dr.SCROLL_DOWN?Be(n):n.find(function(a){var o=a.getMeta();return o.isLeaf})},e.getWillScrollToRowIndex=function(i){var n,a;if(!Or(e.endBrushPoint.rowIndex))return e.getDefaultWillScrollToRowIndex(i);var o=e.getVisibleRowLeafCellByScrollDirection(i),s=(a=(n=o==null?void 0:o.getMeta())===null||n===void 0?void 0:n.rowIndex)!==null&&a!==void 0?a:0,l=s+e.getWillScrollRowIndexDiff(i);return e.validateYIndex(l)},e}return t.prototype.bindMouseDown=function(){var e=this;this.spreadsheet.on(X.ROW_CELL_MOUSE_DOWN,function(i){e.spreadsheet.interaction.getBrushSelection().row&&r.prototype.mouseDown.call(e,i)})},t.prototype.isPointInCanvas=function(e){var i=this.spreadsheet.facet.getCanvasHW().height,n=this.spreadsheet.facet.cornerBBox,a=n.minX,o=n.height,s=n.maxX;return e.x>=a&&e.x<=s&&e.y>=o&&e.y<=i},t.prototype.bindMouseMove=function(){var e=this;this.spreadsheet.on(X.GLOBAL_MOUSE_MOVE,function(i){if(e.brushSelectionStage!==ai.UN_DRAGGED){e.setBrushSelectionStage(ai.DRAGGED);var n=e.spreadsheet.container.getPointByEvent(i);e.autoBrushScroll(n,!0)||e.renderPrepareSelected(n)}})},t.prototype.setDisplayedCells=function(){this.displayedCells=this.spreadsheet.interaction.getAllRowHeaderCells()},t.prototype.updateSelectedCells=function(){var e=this.getSelectedRowNodes(),i=this.getScrollBrushRangeCells(e),n=ue(i,mo);this.spreadsheet.interaction.changeState({cells:n,stateName:bt.BRUSH_SELECTED,onUpdateCells:this.onUpdateCells}),this.emitBrushSelectionEvent(X.ROW_CELL_BRUSH_SELECTION,i)},t.prototype.addBrushIntercepts=function(){this.spreadsheet.interaction.addIntercepts([Gt.ROW_BRUSH_SELECTION])},t.prototype.getScrollBrushRangeCells=function(e){var i=this;return e.map(function(n){var a=i.getVisibleBrushRangeCells(n.id);return a||i.spreadsheet.facet.rowHeader.createCellInstance(n)})},t.prototype.getPrepareSelectMaskPosition=function(e){var i=this.spreadsheet.facet.panelBBox.minY,n=e.start.x,a=Math.max(e.start.y,i);return{x:n,y:a}},t}(v2),S$t=function(r){yt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.isMultiSelection=!1,e}return t.prototype.bindEvents=function(){this.bindKeyboardDown(),this.bindDataCellClick(),this.bindKeyboardUp(),this.bindMouseMove()},t.prototype.reset=function(){this.isMultiSelection=!1,this.spreadsheet.interaction.removeIntercepts([Gt.CLICK])},t.prototype.bindKeyboardDown=function(){var e=this;this.spreadsheet.on(X.GLOBAL_KEYBOARD_DOWN,function(i){Lm(i)&&(e.isMultiSelection=!0,e.spreadsheet.interaction.addIntercepts([Gt.CLICK]))})},t.prototype.bindKeyboardUp=function(){var e=this;this.spreadsheet.on(X.GLOBAL_KEYBOARD_UP,function(i){Lm(i)&&e.reset()})},t.prototype.bindMouseMove=function(){var e=this;this.spreadsheet.on(X.GLOBAL_MOUSE_MOVE,function(i){e.isMultiSelection&&!TH(i)&&e.reset()})},t.prototype.getSelectedCells=function(e){var i=e.getMeta().id,n=this.spreadsheet.interaction,a=n.getCells([ut.DATA_CELL]),o=[];return n.getCurrentStateName()!==bt.SELECTED&&(a=[]),a.find(function(s){return s.id===i})?o=a.filter(function(s){return s.id!==i}):o=ft(ft([],rt(a),!1),[mo(e)],!1),o},t.prototype.bindDataCellClick=function(){var e=this;this.spreadsheet.on(X.DATA_CELL_CLICK,function(i){i.stopPropagation();var n=e.spreadsheet.getCell(i.target),a=n.getMeta(),o=e.spreadsheet.interaction;if(e.isMultiSelection&&a){var s=e.getSelectedCells(n);if(st(s)){o.clearState(),e.spreadsheet.hideTooltip(),e.spreadsheet.emit(X.GLOBAL_SELECTED,o.getActiveCells());return}o.addIntercepts([Gt.CLICK,Gt.HOVER]),e.spreadsheet.hideTooltip(),o.changeState({cells:s,stateName:bt.SELECTED,onUpdateCells:i2}),e.spreadsheet.emit(X.GLOBAL_SELECTED,o.getActiveCells()),e.spreadsheet.showTooltipWithInfo(i,s2(e.spreadsheet))}})},t}(Ga),A$t=function(){function r(t){var e=this;this.canvasEventHandlers=[],this.s2EventHandlers=[],this.domEventListeners=[],this.isCanvasEffect=!1,this.isGuiIconShape=function(i){return i instanceof BT&&i.attrs.type===nv.type},this.onCanvasMousedown=function(i){if(e.target=i.target,e.spreadsheet.interaction.clearHoverTimer(),e.isResizeArea(i)){e.spreadsheet.emit(X.LAYOUT_RESIZE_MOUSE_DOWN,i);var n=function(o){if(!e.spreadsheet.getCanvasElement())return!1;e.spreadsheet.getCanvasElement()!==o.target&&(i.clientX=o.clientX,i.clientY=o.clientY,i.originalEvent=o,e.spreadsheet.emit(X.LAYOUT_RESIZE_MOUSE_MOVE,i))};window.addEventListener("mousemove",n),window.addEventListener("mouseup",function(){window.removeEventListener("mousemove",n)},{once:!0});return}var a=e.spreadsheet.getCellType(i.target);switch(a){case ut.DATA_CELL:e.spreadsheet.emit(X.DATA_CELL_MOUSE_DOWN,i);break;case ut.ROW_CELL:e.spreadsheet.emit(X.ROW_CELL_MOUSE_DOWN,i);break;case ut.COL_CELL:e.spreadsheet.emit(X.COL_CELL_MOUSE_DOWN,i);break;case ut.CORNER_CELL:e.spreadsheet.emit(X.CORNER_CELL_MOUSE_DOWN,i);break;case ut.MERGED_CELL:e.spreadsheet.emit(X.MERGED_CELLS_MOUSE_DOWN,i);break}},this.onCanvasMousemove=function(i){if(e.canvasMousemoveEvent=i,e.isResizeArea(i)){e.activeResizeArea(i),e.spreadsheet.emit(X.LAYOUT_RESIZE_MOUSE_MOVE,i);return}e.resetResizeArea();var n=e.spreadsheet.getCell(i.target);if(n){var a=n.cellType;switch(a){case ut.DATA_CELL:e.spreadsheet.emit(X.DATA_CELL_MOUSE_MOVE,i);break;case ut.ROW_CELL:e.spreadsheet.emit(X.ROW_CELL_MOUSE_MOVE,i);break;case ut.COL_CELL:e.spreadsheet.emit(X.COL_CELL_MOUSE_MOVE,i);break;case ut.CORNER_CELL:e.spreadsheet.emit(X.CORNER_CELL_MOUSE_MOVE,i);break;case ut.MERGED_CELL:e.spreadsheet.emit(X.MERGED_CELLS_MOUSE_MOVE,i);break}if(!e.hasBrushSelectionIntercepts())switch(e.spreadsheet.emit(X.GLOBAL_HOVER,i),a){case ut.DATA_CELL:e.spreadsheet.emit(X.DATA_CELL_HOVER,i);break;case ut.ROW_CELL:e.spreadsheet.emit(X.ROW_CELL_HOVER,i);break;case ut.COL_CELL:e.spreadsheet.emit(X.COL_CELL_HOVER,i);break;case ut.CORNER_CELL:e.spreadsheet.emit(X.CORNER_CELL_HOVER,i);break;case ut.MERGED_CELL:e.spreadsheet.emit(X.MERGED_CELLS_HOVER,i);break}}},this.onCanvasMouseup=function(i){if(e.isResizeArea(i)){e.spreadsheet.emit(X.LAYOUT_RESIZE_MOUSE_UP,i);return}var n=e.spreadsheet.getCell(i.target);if(n){var a=n.cellType;if(e.target===i.target){var o=e.isGuiIconShape(i.target);switch(a){case ut.DATA_CELL:e.spreadsheet.emit(X.DATA_CELL_CLICK,i);break;case ut.ROW_CELL:if(o)break;e.spreadsheet.emit(X.ROW_CELL_CLICK,i);break;case ut.COL_CELL:if(o)break;e.spreadsheet.emit(X.COL_CELL_CLICK,i);break;case ut.CORNER_CELL:if(o)break;e.spreadsheet.emit(X.CORNER_CELL_CLICK,i);break;case ut.MERGED_CELL:e.spreadsheet.emit(X.MERGED_CELLS_CLICK,i);break}}switch(a){case ut.DATA_CELL:e.spreadsheet.emit(X.DATA_CELL_MOUSE_UP,i);break;case ut.ROW_CELL:e.spreadsheet.emit(X.ROW_CELL_MOUSE_UP,i);break;case ut.COL_CELL:e.spreadsheet.emit(X.COL_CELL_MOUSE_UP,i);break;case ut.CORNER_CELL:e.spreadsheet.emit(X.CORNER_CELL_MOUSE_UP,i);break;case ut.MERGED_CELL:e.spreadsheet.emit(X.MERGED_CELLS_MOUSE_UP,i);break}}},this.onCanvasClick=function(i){e.spreadsheet.emit(X.GLOBAL_CLICK,i)},this.onCanvasDoubleClick=function(i){var n=e.spreadsheet;if(e.isResizeArea(i)){n.emit(X.LAYOUT_RESIZE_MOUSE_UP,i);return}n.emit(X.GLOBAL_DOUBLE_CLICK,i);var a=n.getCell(i.target);if(a){var o=a.cellType;if(e.target===i.target)switch(o){case ut.DATA_CELL:n.emit(X.DATA_CELL_DOUBLE_CLICK,i);break;case ut.ROW_CELL:n.emit(X.ROW_CELL_DOUBLE_CLICK,i);break;case ut.COL_CELL:n.emit(X.COL_CELL_DOUBLE_CLICK,i);break;case ut.CORNER_CELL:n.emit(X.CORNER_CELL_DOUBLE_CLICK,i);break;case ut.MERGED_CELL:n.emit(X.MERGED_CELLS_DOUBLE_CLICK,i);break}}},this.onCanvasMouseout=function(i){if(!(!e.isAutoResetSheetStyle||i!=null&&i.shape)){var n=e.spreadsheet.interaction;!n.isSelectedState()&&!(n.intercepts.size>0)&&n.reset()}},this.onCanvasContextMenu=function(i){var n=e.spreadsheet;if(e.isResizeArea(i)){n.emit(X.LAYOUT_RESIZE_MOUSE_UP,i);return}n.emit(X.GLOBAL_CONTEXT_MENU,i);var a=e.spreadsheet.getCellType(i.target);switch(a){case ut.DATA_CELL:e.spreadsheet.emit(X.DATA_CELL_CONTEXT_MENU,i);break;case ut.ROW_CELL:e.spreadsheet.emit(X.ROW_CELL_CONTEXT_MENU,i);break;case ut.COL_CELL:e.spreadsheet.emit(X.COL_CELL_CONTEXT_MENU,i);break;case ut.CORNER_CELL:e.spreadsheet.emit(X.CORNER_CELL_CONTEXT_MENU,i);break;case ut.MERGED_CELL:e.spreadsheet.emit(X.MERGED_CELLS_CONTEXT_MENU,i);break}},this.spreadsheet=t,this.bindEvents()}return Object.defineProperty(r.prototype,"canvasContainer",{get:function(){return this.spreadsheet.container},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isAutoResetSheetStyle",{get:function(){return this.spreadsheet.options.interaction.autoResetSheetStyle},enumerable:!1,configurable:!0}),r.prototype.bindEvents=function(){var t=this;this.clearAllEvents(),this.addCanvasEvent(_i.CLICK,this.onCanvasClick),this.addCanvasEvent(_i.MOUSE_DOWN,this.onCanvasMousedown),this.addCanvasEvent(_i.MOUSE_MOVE,this.onCanvasMousemove),this.addCanvasEvent(_i.MOUSE_OUT,this.onCanvasMouseout),this.addCanvasEvent(_i.MOUSE_UP,this.onCanvasMouseup),this.addCanvasEvent(_i.DOUBLE_CLICK,this.onCanvasDoubleClick),this.addCanvasEvent(_i.CONTEXT_MENU,this.onCanvasContextMenu),this.addS2Event(X.GLOBAL_ACTION_ICON_CLICK,function(){t.spreadsheet.interaction.addIntercepts([Gt.HOVER]),t.spreadsheet.interaction.clearState()}),this.addDomEventListener(window,_i.CLICK,function(e){t.resetSheetStyle(e),t.isCanvasEffect=t.isMouseOnTheCanvasContainer(e)}),this.addDomEventListener(window,_i.KEY_DOWN,function(e){t.onKeyboardCopy(e),t.onKeyboardEsc(e),t.spreadsheet.emit(X.GLOBAL_KEYBOARD_DOWN,e)}),this.addDomEventListener(window,_i.KEY_UP,function(e){t.spreadsheet.emit(X.GLOBAL_KEYBOARD_UP,e)}),this.addDomEventListener(window,_i.MOUSE_UP,function(e){t.spreadsheet.emit(X.GLOBAL_MOUSE_UP,e)}),this.addDomEventListener(window,_i.MOUSE_MOVE,function(e){t.spreadsheet.emit(X.GLOBAL_MOUSE_MOVE,e)})},r.prototype.onKeyboardCopy=function(t){if(this.isCanvasEffect&&this.spreadsheet.options.interaction.enableCopy&&pF(t.key,ui.COPY)&&(t.metaKey||t.ctrlKey)){var e=u9t(this.spreadsheet);Or(e)||this.spreadsheet.emit(X.GLOBAL_COPIED,e)}},r.prototype.onKeyboardEsc=function(t){this.isCanvasEffect&&pF(t.key,ui.ESC)&&this.resetSheetStyle(t)},r.prototype.resetSheetStyle=function(t){if(!(!this.isAutoResetSheetStyle||!this.spreadsheet)){var e=this.spreadsheet.interaction;if(e.hasIntercepts([Gt.BRUSH_SELECTION,Gt.COL_BRUSH_SELECTION,Gt.ROW_BRUSH_SELECTION])){e.removeIntercepts([Gt.BRUSH_SELECTION,Gt.ROW_BRUSH_SELECTION,Gt.COL_BRUSH_SELECTION]);return}this.isMouseOnTheTooltip(t)||this.isMouseOnTheCanvasContainer(t)||(e.reset(),this.spreadsheet.emit(X.GLOBAL_RESET,t),this.spreadsheet.emit(X.GLOBAL_SELECTED,e.getActiveCells()))}},r.prototype.isMouseEvent=function(t){return Ru(t,"clientX")&&Ru(t,"clientY")},r.prototype.isMouseOnTheCanvasContainer=function(t){if(this.isMouseEvent(t)){var e=this.spreadsheet.getCanvasElement();if(!e)return!1;if(this.spreadsheet.options.supportCSSTransform)return e.contains(t.target);var i=e.getBoundingClientRect()||{},n=i.x,a=i.y,o=this.getContainerRect(),s=o.width,l=o.height;return e.contains(t.target)&&t.clientX<=n+s&&t.clientY<=a+l}return!1},r.prototype.getContainerRect=function(){var t,e=this.spreadsheet,i=e.facet,n=e.options,a=(i==null?void 0:i.hRowScrollBar)||(i==null?void 0:i.hScrollBar),o=(i==null?void 0:i.panelBBox)||{},s=o.maxX,l=o.maxY,u=n.width,c=n.height,h=((t=a==null?void 0:a.theme)===null||t===void 0?void 0:t.size)||0;return{width:Math.min(u,s),height:Math.min(c,l+h)}},r.prototype.isMouseOnTheTooltip=function(t){var e,i,n,a,o=this.spreadsheet.tooltip;if(!(o!=null&&o.visible))return!1;var s=((n=(i=(e=this.spreadsheet.tooltip)===null||e===void 0?void 0:e.container)===null||i===void 0?void 0:i.getBoundingClientRect)===null||n===void 0?void 0:n.call(i))||{},l=s.x,u=s.y,c=s.width,h=s.height;return t.target instanceof Node?THt((a=this.spreadsheet.tooltip)===null||a===void 0?void 0:a.container,t.target):this.isMouseEvent(t)?t.clientX>=l&&t.clientX<=l+c&&t.clientY>=u&&t.clientY<=u+h:!1},r.prototype.isResizeArea=function(t){var e=kt(t.target,"attrs.appendInfo");return e==null?void 0:e.isResizeArea},r.prototype.activeResizeArea=function(t){this.resetResizeArea();var e=t.target;this.spreadsheet.store.set("activeResizeArea",e),e.attr(mn.backgroundOpacity,this.spreadsheet.theme.resizeArea.interactionState.hover.backgroundOpacity)},r.prototype.resetResizeArea=function(){var t=this.spreadsheet.store.get("activeResizeArea");st(t)||t.attr(mn.backgroundOpacity,this.spreadsheet.theme.resizeArea.backgroundOpacity),this.spreadsheet.store.set("activeResizeArea",t)},r.prototype.hasBrushSelectionIntercepts=function(){return this.spreadsheet.interaction.hasIntercepts([Gt.HOVER,Gt.BRUSH_SELECTION,Gt.ROW_BRUSH_SELECTION,Gt.COL_BRUSH_SELECTION])},r.prototype.clear=function(){this.unbindEvents()},r.prototype.unbindEvents=function(){this.clearAllEvents()},r.prototype.addCanvasEvent=function(t,e){var i;(i=this.canvasContainer)===null||i===void 0||i.on(t,e),this.canvasEventHandlers.push({type:t,handler:e})},r.prototype.addS2Event=function(t,e){this.spreadsheet.on(t,e),this.s2EventHandlers.push({type:t,handler:e})},r.prototype.addDomEventListener=function(t,e,i){if(t.addEventListener){var n=this.spreadsheet.options.interaction.eventListenerOptions;t.addEventListener(e,i,n),this.domEventListeners.push({target:t,type:e,handler:i,options:n})}else console.error("Please make sure ".concat(t," has addEventListener function"))},r.prototype.clearAllEvents=function(){var t=this;$t(this.canvasEventHandlers,function(e){var i,n=e.type,a=e.handler;(i=t.canvasContainer)===null||i===void 0||i.off(n,a)}),$t(this.s2EventHandlers,function(e){var i=e.type,n=e.handler;t.spreadsheet.off(i,n)}),$t(this.domEventListeners,function(e){e.target.removeEventListener(e.type,e.handler,e.options)}),this.canvasEventHandlers=[],this.s2EventHandlers=[],this.domEventListeners=[]},r}(),T$t=function(r){yt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.isRangeSelection=!1,e.handleColClick=function(i){i.stopPropagation();var n=e.spreadsheet.interaction,a=e.spreadsheet.getCell(i.target),o=a==null?void 0:a.getMeta();if(!Or(o==null?void 0:o.x)){n.addIntercepts([Gt.HOVER]);var s=[mo(a)],l=e.spreadsheet.store.get("lastClickedCell");if(e.isRangeSelection&&l&&l.cellType===a.cellType&&l.getMeta().level===a.getMeta().level){var u=rt([e.spreadsheet.facet.layoutResult.rowsHierarchy.maxLevel,e.spreadsheet.facet.layoutResult.colsHierarchy.maxLevel],2),c=u[0],h=u[1],f=AE(l.getMeta(),a.getMeta()),d=f.start,v=f.end;a instanceof Cl?s=e.handleSeriesNumberRowSelected(d.rowIndex,v.rowIndex,a):a.cellType===ut.ROW_CELL&&a.getMeta().level===c?s=e.handleRowSelected(d.rowIndex,v.rowIndex,a):a.cellType===ut.COL_CELL&&a.getMeta().level===h&&(s=e.handleColSelected(d.colIndex,v.colIndex,a)),n.changeState({cells:s,stateName:bt.SELECTED})}else st(n.getCells())&&n.removeIntercepts([Gt.HOVER]),e.spreadsheet.store.set("lastClickedCell",a);var p=s.map(function(g){var m=g.id;return m});n.updateCells(n.getRowColActiveCells(p)),e.spreadsheet.emit(X.GLOBAL_SELECTED,n.getActiveCells())}},e}return t.prototype.bindEvents=function(){this.bindKeyboardDown(),this.bindDataCellClick(),this.bindColCellClick(),this.bindKeyboardUp(),this.bindMouseMove()},t.prototype.reset=function(){this.isRangeSelection=!1,this.spreadsheet.interaction.removeIntercepts([Gt.CLICK])},t.prototype.bindKeyboardDown=function(){var e=this;this.spreadsheet.on(X.GLOBAL_KEYBOARD_DOWN,function(i){i.key===ui.SHIFT&&(e.isRangeSelection=!0,e.spreadsheet.interaction.addIntercepts([Gt.CLICK]))})},t.prototype.bindKeyboardUp=function(){var e=this;this.spreadsheet.on(X.GLOBAL_KEYBOARD_UP,function(i){i.key===ui.SHIFT&&e.reset()})},t.prototype.bindMouseMove=function(){var e=this;this.spreadsheet.on(X.GLOBAL_MOUSE_MOVE,function(i){e.isRangeSelection&&!i.shiftKey&&e.reset()})},t.prototype.bindColCellClick=function(){var e=this;this.spreadsheet.isTableMode()&&this.spreadsheet.on(X.ROW_CELL_CLICK,function(i){e.handleColClick(i)}),this.spreadsheet.on(X.COL_CELL_CLICK,function(i){e.handleColClick(i)})},t.prototype.bindDataCellClick=function(){var e=this;this.spreadsheet.on(X.DATA_CELL_CLICK,function(i){i.stopPropagation();var n=e.spreadsheet.getCell(i.target),a=n.getMeta(),o=e.spreadsheet.interaction;if(a){var s=e.spreadsheet.store.get("lastClickedCell"),l=e.isRangeSelection&&(s==null?void 0:s.cellType)===n.cellType;if(!l){e.spreadsheet.store.set("lastClickedCell",n);return}var u=AE(s.getMeta(),n.getMeta()),c=u.start,h=u.end,f=Vc(c.colIndex,h.colIndex+1).flatMap(function(d){var v=e.spreadsheet.facet.layoutResult.colLeafNodes[d].id;return Vc(c.rowIndex,h.rowIndex+1).map(function(p){var g=e.spreadsheet.facet.getSeriesNumberWidth()||e.spreadsheet.isTableMode()?String(p):e.spreadsheet.facet.layoutResult.rowLeafNodes[p].id;return{id:g+"-"+v,colIndex:d,rowIndex:p,type:n.cellType}})});o.addIntercepts([Gt.CLICK,Gt.HOVER]),o.changeState({cells:f,stateName:bt.SELECTED}),e.spreadsheet.showTooltipWithInfo(i,s2(e.spreadsheet)),e.spreadsheet.emit(X.GLOBAL_SELECTED,o.getActiveCells())}})},t.prototype.handleSeriesNumberRowSelected=function(e,i,n){var a=this.spreadsheet.facet.layoutResult.colLeafNodes[0].id;return Vc(e,i+1).map(function(o){var s=String(o);return{id:s+"-"+a,colIndex:0,rowIndex:o,type:n.cellType}})},t.prototype.handleRowSelected=function(e,i,n){return this.spreadsheet.facet.layoutResult.rowNodes.filter(function(a){var o=a.rowIndex;return sE(o,e,i+1)}).map(function(a){return{id:a.id,colIndex:a.colIndex,rowIndex:a.rowIndex,type:n.cellType}})},t.prototype.handleColSelected=function(e,i,n){return this.spreadsheet.facet.layoutResult.colLeafNodes.filter(function(a){var o=a.colIndex;return sE(o,e,i+1)}).map(function(a){return{id:a.id,colIndex:a.colIndex,rowIndex:a.rowIndex,type:n.cellType}})},t}(Ga),b$t=function(r){yt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.resizeStartPosition={},e.resizeMouseMove=function(i){var n,a;if(!((n=e.resizeReferenceGroup)===null||n===void 0)&&n.get("visible")){(a=i==null?void 0:i.preventDefault)===null||a===void 0||a.call(i);var o=i.originalEvent,s=e.getResizeInfo(),l=e.resizeReferenceGroup.getChildren()||[];if(!st(l)){var u=rt(l,2),c=u[1],h=rt(rp(c.attr("path")),2),f=h[0],d=h[1];s.type===Jn.Horizontal?e.updateHorizontalResizingEndGuideLinePosition(o,s,f,d):e.updateVerticalResizingEndGuideLinePosition(o,s,f,d),e.updateResizeGuideLineTheme(c),c.attr("path",[f,d])}}},e}return t.prototype.bindEvents=function(){this.bindMouseDown(),this.bindMouseMove(),this.bindMouseUp()},t.prototype.initResizeGroup=function(){if(!this.resizeReferenceGroup){this.resizeReferenceGroup=this.spreadsheet.foregroundGroup.addGroup();var e=this.spreadsheet.options,i=e.width,n=e.height,a=this.getResizeAreaTheme(),o=a.guideLineColor,s=a.guideLineDash,l=a.size,u={path:"",lineDash:s,stroke:o,lineWidth:l};this.resizeReferenceGroup.addShape("path",{id:pwt,attrs:u}),this.resizeReferenceGroup.addShape("path",{id:gwt,attrs:u}),this.resizeReferenceGroup.addShape("rect",{id:mwt,attrs:{appendInfo:{isResizeArea:!0},x:0,y:0,width:i,height:n,fill:"transparent"}})}},t.prototype.getResizeAreaTheme=function(){return this.spreadsheet.theme.resizeArea},t.prototype.setResizeTarget=function(e){this.resizeTarget=e},t.prototype.getGuideLineWidthAndHeight=function(){var e=this.spreadsheet.options,i=e.width,n=e.height,a=this.spreadsheet.facet.panelBBox,o=a.maxY,s=a.maxX,l=Math.min(s,i),u=Math.min(o,n);return{width:l,height:u}},t.prototype.getResizeShapes=function(){var e;return((e=this.resizeReferenceGroup)===null||e===void 0?void 0:e.get("children"))||[]},t.prototype.setResizeMaskCursor=function(e){var i=rt(this.getResizeShapes(),3),n=i[2];n==null||n.attr("cursor",e)},t.prototype.updateResizeGuideLinePosition=function(e,i){var n=this.getResizeShapes();if(!st(n)){var a=rt(n,2),o=a[0],s=a[1],l=i.type,u=i.offsetX,c=i.offsetY,h=i.width,f=i.height,d=this.getGuideLineWidthAndHeight(),v=d.width,p=d.height;if(this.setResizeMaskCursor("".concat(l,"-resize")),l===Jn.Horizontal){o.attr("path",[["M",u,c],["L",u,p]]),s.attr("path",[["M",u+h,c],["L",u+h,p]]),this.resizeStartPosition.offsetX=e.offsetX,this.resizeStartPosition.clientX=e.clientX;return}o.attr("path",[["M",u,c],["L",v,c]]),s.attr("path",[["M",u,c+f],["L",v,c+f]]),this.resizeStartPosition.offsetY=e.offsetY,this.resizeStartPosition.clientY=e.clientY}},t.prototype.bindMouseDown=function(){var e=this;this.spreadsheet.on(X.LAYOUT_RESIZE_MOUSE_DOWN,function(i){var n;(n=i==null?void 0:i.preventDefault)===null||n===void 0||n.call(i);var a=i.target,o=i.originalEvent,s=e.getCellAppendInfo(i.target);e.spreadsheet.store.set("resized",!1),s!=null&&s.isResizeArea&&(e.spreadsheet.interaction.reset(),e.spreadsheet.interaction.addIntercepts([Gt.RESIZE]),e.setResizeTarget(a),e.showResizeGroup(),e.updateResizeGuideLinePosition(o,s))})},t.prototype.bindMouseMove=function(){var e=this;this.spreadsheet.on(X.LAYOUT_RESIZE_MOUSE_MOVE,function(i){Nb(e.resizeMouseMove,33)(i)})},t.prototype.getResizeGuideLinePosition=function(){var e=rt(this.resizeReferenceGroup.getChildren()||[],2),i=e[0],n=e[1],a=(i==null?void 0:i.attr("path"))||[],o=(n==null?void 0:n.attr("path"))||[],s=rt(a[0]||[],3),l=s[1],u=l===void 0?0:l,c=s[2],h=c===void 0?0:c,f=rt(o[0]||[],3),d=f[1],v=d===void 0?0:d,p=f[2],g=p===void 0?0:p;return{start:{x:u,y:h},end:{x:v,y:g}}},t.prototype.getDisAllowResizeInfo=function(){var e,i=this.getResizeInfo(),n=this.spreadsheet.options.interaction.resize,a=i.width,o=i.height,s=i.resizedWidth,l=i.resizedHeight,u=(e=n==null?void 0:n.disable)===null||e===void 0?void 0:e.call(n,i),c=u?a:s,h=u?o:l;return{displayWidth:c,displayHeight:h,isDisabled:u}},t.prototype.getResizeWidthDetail=function(){var e,i,n=this.getResizeInfo(),a=this.getDisAllowResizeInfo().displayWidth;switch(n.effect){case Ei.Field:return{eventType:X.LAYOUT_RESIZE_ROW_WIDTH,style:{rowCfg:{widthByField:(e={},e[n.id]=a,e)}}};case Ei.Tree:return{eventType:X.LAYOUT_RESIZE_TREE_WIDTH,style:{treeRowsWidth:a,rowCfg:{treeRowsWidth:a}}};case Ei.Cell:return{eventType:X.LAYOUT_RESIZE_COL_WIDTH,style:{colCfg:{widthByFieldValue:(i={},i[n.id]=a,i)}}};case Ei.Series:return{eventType:X.LAYOUT_RESIZE_SERIES_WIDTH,seriesNumberWidth:a};default:return null}},t.prototype.getResizeHeightDetail=function(){var e,i,n=this.spreadsheet.options,a=n.interaction.resize,o=n.style.rowCfg.heightByField,s=this.spreadsheet.theme.rowCell.cell.padding,l=this.getResizeInfo(),u=this.getDisAllowResizeInfo().displayHeight,c=this.spreadsheet.isPivotMode()?u-s.top-s.bottom:u,h;switch(l.effect){case Ei.Field:return{eventType:X.LAYOUT_RESIZE_COL_HEIGHT,style:{colCfg:{heightByField:(e={},e[l.id]=u,e)}}};case Ei.Cell:return o!=null&&o[String(l.id)]||(a==null?void 0:a.rowResizeType)===mm.CURRENT?h={rowCfg:{heightByField:(i={},i[l.id]=c,i)}}:h={cellCfg:{height:c}},{eventType:X.LAYOUT_RESIZE_ROW_HEIGHT,style:h};default:return null}},t.prototype.getResizeDetail=function(){var e=this.getResizeInfo();return e.type===Jn.Horizontal?this.getResizeWidthDetail():this.getResizeHeightDetail()},t.prototype.showResizeGroup=function(){this.initResizeGroup(),this.resizeReferenceGroup.set("visible",!0)},t.prototype.hideResizeGroup=function(){this.resizeReferenceGroup.set("visible",!1)},t.prototype.bindMouseUp=function(){var e=this;this.spreadsheet.on(X.GLOBAL_MOUSE_UP,function(){var i;e.setResizeMaskCursor("default"),!(!e.resizeReferenceGroup||st((i=e.resizeReferenceGroup)===null||i===void 0?void 0:i.getChildren()))&&(e.hideResizeGroup(),e.renderResizedResult())})},t.prototype.updateResizeGuideLineTheme=function(e){var i=this.getResizeAreaTheme(),n=i.guideLineColor,a=i.guideLineDisableColor,o=this.getDisAllowResizeInfo().isDisabled;e.attr("stroke",o?a:n),this.setResizeMaskCursor(o?"no-drop":"default")},t.prototype.updateHorizontalResizingEndGuideLinePosition=function(e,i,n,a){var o=e.clientX-this.resizeStartPosition.clientX;i.width+o<$O&&(o=-(i.width-$O));var s=i.offsetX+i.width+o;n[1]=s,a[1]=s,this.resizeTarget.attr({x:s-i.size/2})},t.prototype.updateVerticalResizingEndGuideLinePosition=function(e,i,n,a){var o=e.clientY-this.resizeStartPosition.clientY;i.height+o<WO&&(o=-(i.height-WO));var s=i.offsetY+i.height+o;n[2]=s,a[2]=s,this.resizeTarget.attr({y:s-i.size/2})},t.prototype.renderResizedResult=function(){var e=this.getResizeInfo(),i=this.getResizeDetail()||{},n=i.style,a=i.seriesNumberWidth,o=i.eventType,s={info:e,style:n};this.spreadsheet.emit(X.LAYOUT_RESIZE,s),this.spreadsheet.emit(o,s),n&&this.spreadsheet.setOptions({style:n}),a&&this.spreadsheet.setTheme({rowCell:{seriesNumberWidth:a}}),this.spreadsheet.store.set("resized",!0),this.render()},t.prototype.getResizeInfo=function(){var e=this.getCellAppendInfo(this.resizeTarget),i=this.getResizeGuideLinePosition(),n=i.start,a=i.end,o=Math.floor(a.x-n.x),s=Math.floor(a.y-n.y);return U(U({},e),{resizedWidth:o,resizedHeight:s})},t.prototype.render=function(){this.resizeStartPosition={},this.resizeTarget=null,this.resizeReferenceGroup=null,this.spreadsheet.render(!1)},t}(Ga),w$t=[ui.ARROW_LEFT,ui.ARROW_RIGHT,ui.ARROW_UP,ui.ARROW_DOWN],R$t=function(r){yt(t,r);function t(e){return r.call(this,e)||this}return t.prototype.isCanvasEffect=function(){return this.spreadsheet.interaction.eventController.isCanvasEffect},t.prototype.bindEvents=function(){var e=this;this.spreadsheet.on(X.GLOBAL_KEYBOARD_DOWN,function(i){if(e.isCanvasEffect()){var n=i.shiftKey,a=i.metaKey,o=w$t.includes(i.key),s=!1,l=!1,u=!1;o&&(a&&n?(s=!1,l=!0,u=!1):a?(s=!0,l=!0,u=!0):n?(s=!1,l=!1,u=!1):(s=!0,l=!1,u=!0),e.handleMove({event:i,changeStartCell:s,isJumpMode:l,isSingleSelection:u}))}}),this.spreadsheet.on(X.DATA_CELL_CLICK,function(i){var n=e.spreadsheet.getCell(i.target).getMeta();n&&(e.startCell=e.getCellMetaFromViewMeta(n),e.endCell=e.startCell)})},t.prototype.getCellMetaFromViewMeta=function(e){return{rowIndex:e.rowIndex,colIndex:e.colIndex,id:e.id,type:ut.DATA_CELL}},t.prototype.handleMove=function(e){var i=e.event,n=e.changeStartCell,a=e.isJumpMode,o=e.isSingleSelection,s=this,l=s.spreadsheet,u=s.startCell,c=s.endCell,h=n?u:c,f=this.getMoveInfo(i.key,h,a);if(f){var d=rt([f.row,f.col],2),v=d[0],p=d[1];this.scrollToActiveCell(l,v,p);var g=this.generateCellMeta(l,v,p),m=o?[g]:this.getRangeCells(l,u,g);hzt(l,m),n&&(this.startCell=g),this.endCell=g,this.spreadsheet.emit(X.DATA_CELL_SELECT_MOVE,m)}},t.prototype.generateCellMeta=function(e,i,n){var a=e.isTableMode,o=e.facet.layoutResult,s=o.colLeafNodes,l=o.rowLeafNodes,u=a()?String(i):l[i].id,c=s[n].id;return{rowIndex:i,colIndex:n,id:fp(u,c),type:ut.DATA_CELL}},t.prototype.getRangeCells=function(e,i,n){for(var a=AE(i,n),o=a.start,s=o.rowIndex,l=o.colIndex,u=a.end,c=u.rowIndex,h=u.colIndex,f=[],d=s;d<=c;d++)for(var v=l;v<=h;v++)f.push(this.generateCellMeta(e,d,v));return f},t.prototype.getMoveInfo=function(e,i,n){var a=this.spreadsheet,o=a.options,s=o.frozenColCount,l=s===void 0?0:s,u=o.frozenRowCount,c=u===void 0?0:u,h=o.frozenTrailingColCount,f=h===void 0?0:h,d=o.frozenTrailingRowCount,v=d===void 0?0:d,p=a.facet.layoutResult,g=p.rowLeafNodes,m=p.colLeafNodes,y=rt([0+l,m.length-f-1],2),_=y[0],x=y[1],C=rt([0+c,(a.isTableMode()?a.dataSet.getDisplayDataSet().length:g.length)-v-1],2),A=C[0],b=C[1];if(i)switch(e){case ui.ARROW_RIGHT:return i.colIndex+1>x?void 0:{row:i.rowIndex,col:n?x:i.colIndex+1};case ui.ARROW_LEFT:return i.colIndex-1<_?void 0:{row:i.rowIndex,col:n?_:i.colIndex-1};case ui.ARROW_UP:return i.rowIndex-1<A?void 0:{row:n?A:i.rowIndex-1,col:i.colIndex};case ui.ARROW_DOWN:return i.rowIndex+1>b?void 0:{row:n?b:i.rowIndex+1,col:i.colIndex}}},t.prototype.calculateOffset=function(e,i,n){var a=e.options,o=a.frozenRowCount,s=o===void 0?0:o,l=a.frozenTrailingRowCount,u=l===void 0?0:l,c=e.facet,h=e.frozenColGroup,f=e.frozenTrailingColGroup,d=e.frozenRowGroup,v=e.frozenTrailingRowGroup,p=c.layoutResult.colLeafNodes,g=c.getScrollOffset(),m=g.scrollX,y=g.scrollY,_=c.panelBBox,x=_.viewportHeight,C=_.viewportWidth,A=kt(e,"theme.splitLine"),b=h?Math.floor(h.getBBox().width-A.verticalBorderWidth/2):0,R=f?Math.floor(f.getBBox().width):0,M=d?Math.floor(d.getBBox().height-A.horizontalBorderWidth/2):0,O=v?Math.floor(v.getBBox().height):0,F=Xb(m,y,c.viewCellWidths,c.viewCellHeights,{width:C-b-R,height:x-M-O,x:b,y:M},c.getRealScrollX(c.cornerBBox.width)),D=-1,H=-1,j=p.find(function(k){return k.colIndex===n});if(n<=F[0]?D=j.x-b:n>=F[1]&&n<p.length-u&&(D=j.x+j.width-C+R),i<=F[2])H=c.viewCellHeights.getCellOffsetY(i-s);else if(i>=F[3]){var $=c.viewCellHeights.getCellOffsetY(i+1);H=$+O-x}return{offsetX:D,offsetY:H}},t.prototype.scrollToActiveCell=function(e,i,n){var a=this.calculateOffset(e,i,n),o=a.offsetX,s=a.offsetY,l=e.facet,u=e.facet.getScrollOffset(),c=u.scrollX,h=u.scrollY;l.scrollWithAnimation({offsetX:{value:o>-1?o:c},offsetY:{value:s>-1?s:h}})},t}(Ga),M$t=function(){function r(t){var e=this;this.interactions=new Map,this.intercepts=new Set,this.hoverTimer=null,this.defaultState={cells:[],force:!1},this.onTriggerInteractionsResetEffect=function(){e.interactions.forEach(function(i){i.reset()})},this.selectAll=function(){e.changeState({stateName:bt.ALL_SELECTED})},this.getCellChildrenNodes=function(i){var n,a=(n=i==null?void 0:i.getMeta)===null||n===void 0?void 0:n.call(i),o=(i==null?void 0:i.cellType)===ut.ROW_CELL,s=e.spreadsheet.isHierarchyTreeType();return s&&o?Zr.getAllLeaveNodes(a).filter(function(l){return l.rowIndex===a.rowIndex}):Zr.getAllChildrenNodes(a)},this.selectHeaderCell=function(i){var n;i===void 0&&(i={});var a=i.cell;if(!st(a)){var o=(n=a==null?void 0:a.getMeta)===null||n===void 0?void 0:n.call(a);if(!(!o||Or(o==null?void 0:o.x))){e.addIntercepts([Gt.HOVER]);var s=e.spreadsheet.isHierarchyTreeType(),l=(a==null?void 0:a.cellType)===ut.COL_CELL,u=e.getState(),c=e.isSelectedCell(a),h=(i==null?void 0:i.isMultiSelection)&&e.isSelectedState(),f=c?[]:e.getCellChildrenNodes(a),d=c?[]:[mo(a)];if(h&&(d=Tc(u==null?void 0:u.cells,d),f=Tc(u==null?void 0:u.nodes,f),c&&(d=d.filter(function(p){var g=p.id;return g!==o.id}),f=f.filter(function(p){return!(p!=null&&p.id.includes(o.id))}))),st(d)){e.reset(),e.spreadsheet.emit(X.GLOBAL_SELECTED,e.getActiveCells());return}e.changeState({cells:d,nodes:f,stateName:bt.SELECTED});var v=d.map(function(p){var g=p.id;return g});return e.updateCells(e.getRowColActiveCells(v)),(!s||l)&&e.highlightNodes(f),e.spreadsheet.emit(X.GLOBAL_SELECTED,e.getActiveCells()),!0}}},this.highlightNodes=function(i){i===void 0&&(i=[]),i.forEach(function(n){var a;(a=n==null?void 0:n.belongsCell)===null||a===void 0||a.updateByState(bt.SELECTED,n.belongsCell)})},this.mergeCells=function(i,n){w9t(e.spreadsheet,i,n)},this.unmergeCell=function(i){M9t(e.spreadsheet,i)},this.spreadsheet=t,this.registerEventController(),this.registerInteractions(),window.addEventListener("visibilitychange",this.onTriggerInteractionsResetEffect)}return r.prototype.destroy=function(){this.interactions.clear(),this.intercepts.clear(),this.eventController.clear(),this.clearHoverTimer(),this.resetState(),window.removeEventListener("visibilitychange",this.onTriggerInteractionsResetEffect)},r.prototype.reset=function(){this.clearState(),this.clearHoverTimer(),this.intercepts.clear(),this.spreadsheet.hideTooltip()},r.prototype.setState=function(t){dzt(this.spreadsheet,t)},r.prototype.getState=function(){return this.spreadsheet.store.get(qC)||this.defaultState},r.prototype.setInteractedCells=function(t){var e=this.getInteractedCells().concat([t]),i=this.getState();i.interactedCells=e,this.setState(i)},r.prototype.getInteractedCells=function(){var t=this.getState();return(t==null?void 0:t.interactedCells)||[]},r.prototype.resetState=function(){this.spreadsheet.store.set(qC,this.defaultState)},r.prototype.getCurrentStateName=function(){return this.getState().stateName},r.prototype.isEqualStateName=function(t){return this.getCurrentStateName()===t},r.prototype.isStateOf=function(t){var e=this.getState();return(e==null?void 0:e.stateName)===t},r.prototype.isSelectedState=function(){return this.isStateOf(bt.SELECTED)||this.isStateOf(bt.BRUSH_SELECTED)},r.prototype.isAllSelectedState=function(){return this.isStateOf(bt.ALL_SELECTED)},r.prototype.isHoverFocusState=function(){return this.isStateOf(bt.HOVER_FOCUS)},r.prototype.isHoverState=function(){return this.isStateOf(bt.HOVER)},r.prototype.isActiveCell=function(t){return!!this.getCells().find(function(e){return t.getMeta().id===e.id})},r.prototype.isSelectedCell=function(t){return this.isSelectedState()&&this.isActiveCell(t)},r.prototype.getCells=function(t){var e=this.getState(),i=(e==null?void 0:e.cells)||[];return Or(t)?i:i.filter(function(n){return t.includes(n.type)})},r.prototype.getActiveCells=function(){var t=this.getCells().map(function(i){return i.id}),e=this.getAllCells();return ue(t,function(i){return vi(e,function(n){var a;return((a=n==null?void 0:n.getMeta())===null||a===void 0?void 0:a.id)===i})}).filter(function(i){return i})},r.prototype.clearStyleIndependent=function(){!this.isSelectedState()&&!this.isHoverState()&&!this.isAllSelectedState()||this.getPanelGroupAllDataCells().forEach(function(t){t.hideInteractionShape()})},r.prototype.getPanelGroupAllUnSelectedDataCells=function(){var t=this;return this.getPanelGroupAllDataCells().filter(function(e){return!t.isActiveCell(e)})},r.prototype.getPanelGroupAllDataCells=function(){var t;return pd((t=this.spreadsheet.panelGroup)===null||t===void 0?void 0:t.getChildren(),Cl)},r.prototype.getAllRowHeaderCells=function(){var t,e,i=((t=this.spreadsheet.foregroundGroup)===null||t===void 0?void 0:t.getChildren())||[],n=i.find(function(o){return o instanceof d2&&!(o instanceof t$)}),a=((e=n==null?void 0:n.cfg)===null||e===void 0?void 0:e.children)||[];return pd(a,vp).filter(function(o){return o.cellType===ut.ROW_CELL})},r.prototype.getAllColHeaderCells=function(){var t,e,i=((t=this.spreadsheet.foregroundGroup)===null||t===void 0?void 0:t.getChildren())||[],n=i.find(function(o){return o instanceof f2}),a=((e=n==null?void 0:n.cfg)===null||e===void 0?void 0:e.children)||[];return pd(a,g_).filter(function(o){return o.cellType===ut.COL_CELL})},r.prototype.getRowColActiveCells=function(t){return Tc(this.getAllRowHeaderCells(),this.getAllColHeaderCells()).filter(function(e){return t.includes(e.getMeta().id)})},r.prototype.getAllCells=function(){return Tc(this.getPanelGroupAllDataCells(),this.getAllRowHeaderCells(),this.getAllColHeaderCells())},r.prototype.hideColumns=function(t,e){t===void 0&&(t=[]),e===void 0&&(e=!0),Qb(this.spreadsheet,t,e)},r.prototype.getBrushSelectionInfo=function(t){var e,i,n;return uo(t)?{dataBrushSelection:t,rowBrushSelection:t,colBrushSelection:t}:{dataBrushSelection:(e=t==null?void 0:t.data)!==null&&e!==void 0?e:!1,rowBrushSelection:(i=t==null?void 0:t.row)!==null&&i!==void 0?i:!1,colBrushSelection:(n=t==null?void 0:t.col)!==null&&n!==void 0?n:!1}},r.prototype.getDefaultInteractions=function(){var t=this.spreadsheet.options.interaction,e=t.resize,i=t.brushSelection,n=t.multiSelection,a=t.rangeSelection,o=t.selectedCellMove,s=this.getBrushSelectionInfo(i),l=s.dataBrushSelection,u=s.rowBrushSelection,c=s.colBrushSelection;return[{key:yi.CORNER_CELL_CLICK,interaction:y$t},{key:yi.DATA_CELL_CLICK,interaction:v$t},{key:yi.ROW_COLUMN_CLICK,interaction:g$t},{key:yi.ROW_TEXT_CLICK,interaction:m$t},{key:yi.MERGED_CELLS_CLICK,interaction:p$t},{key:yi.HOVER,interaction:_$t,enable:!Nr()},{key:yi.BRUSH_SELECTION,interaction:C$t,enable:!Nr()&&l},{key:yi.ROW_BRUSH_SELECTION,interaction:E$t,enable:!Nr()&&u},{key:yi.COL_BRUSH_SELECTION,interaction:x$t,enable:!Nr()&&c},{key:yi.COL_ROW_RESIZE,interaction:b$t,enable:!Nr()&&e},{key:yi.DATA_CELL_MULTI_SELECTION,interaction:S$t,enable:!Nr()&&n},{key:yi.RANGE_SELECTION,interaction:T$t,enable:!Nr()&&a},{key:yi.SELECTED_CELL_MOVE,interaction:R$t,enable:!Nr()&&o}]},r.prototype.registerInteractions=function(){var t=this,e=this.spreadsheet.options.interaction.customInteractions;this.interactions.clear();var i=this.getDefaultInteractions();i.forEach(function(n){var a=n.key,o=n.interaction,s=n.enable;s!==!1&&t.interactions.set(a,new o(t.spreadsheet))}),st(e)||$t(e,function(n){var a=n.interaction;t.interactions.set(n.key,new a(t.spreadsheet))})},r.prototype.registerEventController=function(){this.eventController=new A$t(this.spreadsheet)},r.prototype.draw=function(){this.spreadsheet.container.draw()},r.prototype.clearState=function(){bH(this.spreadsheet)&&this.draw()},r.prototype.changeState=function(t){var e=this,i=this.spreadsheet.interaction,n=t.cells,a=n===void 0?[]:n,o=t.force,s=t.stateName,l=t.onUpdateCells;if(st(a)&&s===bt.SELECTED){o&&i.changeState({cells:[],stateName:bt.UNSELECTED});return}this.getCurrentStateName()===bt.ALL_SELECTED&&this.clearStyleIndependent(),this.clearState(),this.setState(t);var u=function(){e.updatePanelGroupAllDataCells()};l?l(this,u):u(),this.draw()},r.prototype.updatePanelGroupAllDataCells=function(){this.updateCells(this.getPanelGroupAllDataCells())},r.prototype.updateCells=function(t){t===void 0&&(t=[]),t.forEach(function(e){e.update()})},r.prototype.addIntercepts=function(t){var e=this;t===void 0&&(t=[]),t.forEach(function(i){e.intercepts.add(i)})},r.prototype.hasIntercepts=function(t){var e=this;return t===void 0&&(t=[]),t.some(function(i){return e.intercepts.has(i)})},r.prototype.removeIntercepts=function(t){var e=this;t===void 0&&(t=[]),t.forEach(function(i){e.intercepts.delete(i)})},r.prototype.clearHoverTimer=function(){clearTimeout(this.hoverTimer)},r.prototype.setHoverTimer=function(t){this.hoverTimer=t},r.prototype.getHoverTimer=function(){return this.hoverTimer},r.prototype.getSelectedCellHighlight=function(){var t=this.spreadsheet.options.interaction.selectedCellHighlight;if(uo(t))return{rowHeader:t,colHeader:t,currentRow:!1,currentCol:!1};var e=t??{},i=e.rowHeader,n=i===void 0?!1:i,a=e.colHeader,o=a===void 0?!1:a,s=e.currentRow,l=s===void 0?!1:s,u=e.currentCol,c=u===void 0?!1:u;return{rowHeader:n,colHeader:o,currentRow:l,currentCol:c}},r.prototype.getHoverAfterScroll=function(){return this.spreadsheet.options.interaction.hoverAfterScroll},r.prototype.getHoverHighlight=function(){var t=this.spreadsheet.options.interaction.hoverHighlight;if(uo(t))return{rowHeader:t,colHeader:t,currentRow:t,currentCol:t};var e=t??{},i=e.rowHeader,n=i===void 0?!1:i,a=e.colHeader,o=a===void 0?!1:a,s=e.currentRow,l=s===void 0?!1:s,u=e.currentCol,c=u===void 0?!1:u;return{rowHeader:n,colHeader:o,currentRow:l,currentCol:c}},r.prototype.getBrushSelection=function(){var t=this.spreadsheet.options.interaction.brushSelection;if(uo(t))return{data:t,row:t,col:t};var e=t??{},i=e.data,n=i===void 0?!1:i,a=e.row,o=a===void 0?!1:a,s=e.col,l=s===void 0?!1:s;return{data:n,row:o,col:l}},r}(),I$t=function(){function r(t){var e=this;this.viewport=window,this.isDevicePixelRatioChange=!1,this.init=function(){e.initDevicePixelRatioListener(),e.initDeviceZoomListener()},this.destroy=function(){e.removeDevicePixelRatioListener(),e.removeDeviceZoomListener()},this.removeDevicePixelRatioListener=function(){var i;!((i=e.devicePixelRatioMedia)===null||i===void 0)&&i.removeEventListener?e.devicePixelRatioMedia.removeEventListener("change",e.renderByDevicePixelRatioChanged):e.devicePixelRatioMedia.removeListener(e.renderByDevicePixelRatioChanged)},this.initDeviceZoomListener=function(){var i,n;Nr()||(n=(i=e.viewport)===null||i===void 0?void 0:i.visualViewport)===null||n===void 0||n.addEventListener("resize",e.renderByZoomScaleWithoutResizeEffect)},this.removeDeviceZoomListener=function(){var i,n;Nr()||(n=(i=e.viewport)===null||i===void 0?void 0:i.visualViewport)===null||n===void 0||n.removeEventListener("resize",e.renderByZoomScaleWithoutResizeEffect)},this.renderByZoomScaleWithoutResizeEffect=function(i){e.isDevicePixelRatioChange=!1,e.renderByZoomScale(i)},this.renderByDevicePixelRatioChanged=function(){e.isDevicePixelRatioChange=!0,e.renderByDevicePixelRatio()},this.renderByDevicePixelRatio=function(i){i===void 0&&(i=window.devicePixelRatio);var n=e.spreadsheet,a=n.container,o=n.options,s=o.width,l=o.height,u=o.devicePixelRatio,c=e.spreadsheet.getCanvasElement(),h=a.get("pixelRatio");if(!(h===i||!c)){var f=Math.max(i,u,nU);a.set("pixelRatio",f),a.changeSize(s,l),e.spreadsheet.render(!1)}},this.renderByZoomScale=ev(function(i){var n=Math.ceil(i.target.scale);n>=1&&!e.isDevicePixelRatioChange&&e.renderByDevicePixelRatio(n)},350),this.spreadsheet=t}return r.prototype.initDevicePixelRatioListener=function(){var t;this.devicePixelRatioMedia=window.matchMedia("(resolution: ".concat(window.devicePixelRatio,"dppx)")),!((t=this.devicePixelRatioMedia)===null||t===void 0)&&t.addEventListener?this.devicePixelRatioMedia.addEventListener("change",this.renderByDevicePixelRatioChanged):this.devicePixelRatioMedia.addListener(this.renderByDevicePixelRatioChanged)},r}(),WF=function(){function r(t){this.visible=!1,this.position={x:0,y:0},this.spreadsheet=t}return r.prototype.show=function(t){var e,i,n,a=t.position,o=t.options,s=t.content,l=t.event,u=dHt(o).enterable,c=this.spreadsheet.options.tooltip||{},h=c.autoAdjustBoundary,f=c.adjustPosition;this.visible=!0,this.options=t;var d=this.getContainer();this.renderContent(s);var v=fHt({spreadsheet:this.spreadsheet,position:a,tooltipContainer:d,autoAdjustBoundary:h}),p=v.x,g=v.y;this.position=(e=f==null?void 0:f({position:{x:p,y:g},event:l}))!==null&&e!==void 0?e:{x:p,y:g},Dg(d,{style:{left:"".concat((i=this.position)===null||i===void 0?void 0:i.x,"px"),top:"".concat((n=this.position)===null||n===void 0?void 0:n.y,"px"),pointerEvents:u?"all":"none"},visible:!0})},r.prototype.hide=function(){this.visible=!1,this.container&&(Dg(this.container,{style:{pointerEvents:"none"},visible:!1}),this.resetPosition())},r.prototype.destroy=function(){var t,e;this.visible=!1,this.container&&(this.resetPosition(),(e=(t=this.container).remove)===null||e===void 0||e.call(t),this.container=null)},r.prototype.renderContent=function(t){if(this.container){this.clearContent();var e=(this.spreadsheet.options.tooltip||{}).content,i=t??e;if(!Or(i)){if(typeof i=="string"){this.container.innerHTML=i;return}i instanceof Element&&this.container.appendChild(i)}}},r.prototype.clearContent=function(){this.container&&(this.container.innerHTML="")},r.prototype.disablePointerEvent=function(){this.container&&this.container.style.pointerEvents!=="none"&&Dg(this.container,{style:{pointerEvents:"none"}})},r.prototype.resetPosition=function(){this.position={x:0,y:0}},r.prototype.getContainer=function(){var t;if(!this.container){var e=this.spreadsheet.options.tooltip,i=((t=e.getContainer)===null||t===void 0?void 0:t.call(e))||document.body,n=document.createElement("div");return Dg(n,{style:e.style,className:[Wb].concat(e.className)}),i.appendChild(n),this.container=n,this.container}return this.container},r}(),s$=function(r){yt(t,r);function t(e,i,n){var a=r.call(this)||this;return a.store=new Hkt,a.untypedOn=a.on,a.untypedEmit=a.emit,a.on=function(o,s){return a.untypedOn(o,s)},a.emit=function(o){for(var s=[],l=1;l<arguments.length;l++)s[l-1]=arguments[l];return a.untypedEmit.apply(a,ft([o],rt(s),!1))},a.initHiddenColumnsDetail=function(){var o=a.options.interaction.hiddenColumnFields,s=a.store.get("hiddenColumnsDetail");st(o)&&st(s)||Qb(a,o,!0)},a.measureText=Yu(function(o,s){var l;if(o===void 0&&(o=""),!s)return null;var u=(l=a.getCanvasElement())===null||l===void 0?void 0:l.getContext("2d"),c=s,h=c.fontSize,f=c.fontFamily,d=c.fontWeight,v=c.fontStyle,p=c.fontVariant;return u.font=[v,p,d,"".concat(h,"px"),f].join(" ").trim(),u.measureText(String(o))},function(o,s){return ft([o],rt(_s(s)),!1).join("")}),a.measureTextWidth=function(o,s){o===void 0&&(o="");var l=a.measureText(o,s);return(l==null?void 0:l.width)||0},a.measureTextHeight=function(o,s){o===void 0&&(o="");var l=a.measureText(o,s);return l?l.actualBoundingBoxAscent+l.actualBoundingBoxDescent:0},a.measureTextWidthRoughly=function(o,s){var l,u;s===void 0&&(s={});var c=a.measureTextWidth("a",s),h=a.measureTextWidth("蚂",s),f=0;if(!o)return f;try{for(var d=ia(o),v=d.next();!v.done;v=d.next()){var p=v.value,g=p.charCodeAt(0);f+=g>=0&&g<=255?c:h}}catch(m){l={error:m}}finally{try{v&&!v.done&&(u=d.return)&&u.call(d)}finally{if(l)throw l.error}}return f},a.dataCfg=W1(i),a.options=mF(n),a.dataSet=a.getDataSet(a.options),a.setDebug(),a.initTooltip(),a.initGroups(e),a.bindEvents(),a.initInteraction(),a.initTheme(),a.initHdAdapter(),a.registerIcons(),a.setOverscrollBehavior(),a.mountSheetInstance(),a}return t.prototype.setOverscrollBehavior=function(){var e=this.options.interaction.overscrollBehavior,i=window.getComputedStyle(document.body).getPropertyValue("overscroll-behavior"),n=i&&i!=="auto";n?this.store.set("initOverscrollBehavior",i):e&&(document.body.style.overscrollBehavior=e)},t.prototype.restoreOverscrollBehavior=function(){document.body.style.overscrollBehavior=this.store.get("initOverscrollBehavior")||""},t.prototype.setDebug=function(){co.getInstance().setDebug(this.options.debug)},t.prototype.initTheme=function(){this.setThemeCfg({name:"default"})},t.prototype.getMountContainer=function(e){var i=Yh(e)?document.querySelector(e):e;if(!i)throw new Error("Target mount container is not a DOM element");return i},t.prototype.initHdAdapter=function(){this.options.hdAdapter&&(this.hdAdapter=new I$t(this),this.hdAdapter.init())},t.prototype.initInteraction=function(){var e,i;(i=(e=this.interaction)===null||e===void 0?void 0:e.destroy)===null||i===void 0||i.call(e),this.interaction=new M$t(this)},t.prototype.initTooltip=function(){var e,i,n,a;(i=(e=this.tooltip)===null||e===void 0?void 0:e.destroy)===null||i===void 0||i.call(e),this.tooltip=this.renderTooltip(),this.tooltip instanceof WF||console.warn("[Custom Tooltip]: ".concat((a=(n=this.tooltip)===null||n===void 0?void 0:n.constructor)===null||a===void 0?void 0:a.toString()," should be extends from BaseTooltip"))},t.prototype.renderTooltip=function(){var e,i;return((i=(e=this.options.tooltip)===null||e===void 0?void 0:e.renderTooltip)===null||i===void 0?void 0:i.call(e,this))||new WF(this)},t.prototype.showTooltip=function(e){var i,n,a=e.content,o=e.event,s=this.getCell(o==null?void 0:o.target),l=ri(a)?a(s,e):a;(n=(i=this.tooltip).show)===null||n===void 0||n.call(i,U(U({},e),{content:l}))},t.prototype.showTooltipWithInfo=function(e,i,n){var a,o=l2(this,e),s=o.showTooltip,l=o.content;if(s){var u=this.getCell(e==null?void 0:e.target),c=(a=n==null?void 0:n.data)!==null&&a!==void 0?a:EHt({spreadsheet:this,cellInfos:i,targetCell:u,options:U({enableFormat:!0},n)});this.showTooltip({data:c,position:{x:e.clientX,y:e.clientY},options:U({enterable:!0},n),event:e,content:l})}},t.prototype.hideTooltip=function(){var e,i;(i=(e=this.tooltip).hide)===null||i===void 0||i.call(e)},t.prototype.destroyTooltip=function(){var e,i;(i=(e=this.tooltip).destroy)===null||i===void 0||i.call(e)},t.prototype.registerIcons=function(){var e=this.options.customSVGIcons;st(e)||$t(e,function(i){Wz(i.name,i.svg)})},t.prototype.setDataCfg=function(e,i){this.store.set("originalDataCfg",e),i?this.dataCfg=W1(e):this.dataCfg=W1(this.dataCfg,e),bHt(this)},t.prototype.setOptions=function(e,i){var n;this.hideTooltip(),i?this.options=mF(e):this.options=eo(this.options,e),(i||!((n=e.tooltip)===null||n===void 0)&&n.renderTooltip)&&this.initTooltip(),this.resetHiddenColumnsDetailInfoIfNeeded(),this.registerIcons()},t.prototype.resetHiddenColumnsDetailInfoIfNeeded=function(){var e;st((e=this.options.interaction)===null||e===void 0?void 0:e.hiddenColumnFields)||this.store.set("hiddenColumnsDetail",[])},t.prototype.render=function(e,i){if(e===void 0&&(e=!0),i===void 0&&(i={}),!!this.getCanvasElement()){var n=i.reBuildDataSet,a=n===void 0?!1:n,o=i.reBuildHiddenColumnsDetail,s=o===void 0?!0:o;this.emit(X.LAYOUT_BEFORE_RENDER),a&&(this.dataSet=this.getDataSet(this.options)),e&&(this.clearDrillDownData("",!0),this.dataSet.setDataCfg(this.dataCfg)),this.buildFacet(),s&&this.initHiddenColumnsDetail(),this.emit(X.LAYOUT_AFTER_RENDER)}},t.prototype.mountSheetInstance=function(){var e=this.getCanvasElement();e&&(e.__s2_instance__=this)},t.prototype.unmountSheetInstance=function(){var e=this.getCanvasElement();e&&delete e.__s2_instance__},t.prototype.destroy=function(){var e,i,n,a,o;this.restoreOverscrollBehavior(),this.emit(X.LAYOUT_DESTROY),(e=this.facet)===null||e===void 0||e.destroy(),(i=this.hdAdapter)===null||i===void 0||i.destroy(),(n=this.interaction)===null||n===void 0||n.destroy(),(a=this.store)===null||a===void 0||a.clear(),this.destroyTooltip(),this.clearCanvasEvent(),this.unmountSheetInstance(),(o=this.container)===null||o===void 0||o.destroy(),oUt()},t.prototype.setThemeCfg=function(e){e===void 0&&(e={});var i=(e==null?void 0:e.theme)||{},n=pkt(U(U({},e),{spreadsheet:this}));this.theme=eo(n,i)},t.prototype.setTheme=function(e){this.theme=eo(this.theme,e)},t.prototype.updatePagination=function(e){this.options=eo(this.options,{pagination:e}),this.store.set("scrollX",0),this.store.set("scrollY",0)},t.prototype.getContentHeight=function(){return this.facet.getContentHeight()},t.prototype.changeSize=function(e,i){e===void 0&&(e=this.options.width),i===void 0&&(i=this.options.height),this.changeSheetSize(e,i)},t.prototype.changeSheetSize=function(e,i){e===void 0&&(e=this.options.width),i===void 0&&(i=this.options.height);var n=this.getCanvasElement(),a=this.container.get("width"),o=this.container.get("height"),s=e!==a||i!==o;!s||!n||(this.options=eo(this.options,{width:e,height:i}),this.container.changeSize(e,i))},t.prototype.getCanvasElement=function(){return this.container.get("el")},t.prototype.getLayoutWidthType=function(){return this.options.style.layoutWidthType},t.prototype.getRowNodes=function(e){return e===void 0&&(e=-1),e===-1?this.facet.layoutResult.rowNodes:this.facet.layoutResult.rowNodes.filter(function(i){return i.level===e})},t.prototype.getRowLeafNodes=function(){var e;return((e=this.facet)===null||e===void 0?void 0:e.layoutResult.rowLeafNodes)||[]},t.prototype.getColumnNodes=function(e){var i;e===void 0&&(e=-1);var n=((i=this.facet)===null||i===void 0?void 0:i.layoutResult.colNodes)||[];return e===-1?n:n.filter(function(a){return a.level===e})},t.prototype.getColumnLeafNodes=function(){var e;return((e=this.facet)===null||e===void 0?void 0:e.layoutResult.colLeafNodes)||[]},t.prototype.updateScrollOffset=function(e){var i={offsetX:{value:void 0,animate:!1},offsetY:{value:void 0,animate:!1},rowHeaderOffsetX:{value:void 0,animate:!1}};this.facet.updateScrollOffset(eo(i,e))},t.prototype.getTooltipDataItemMappingCallback=function(){var e;return(e=this.options)===null||e===void 0?void 0:e.mappingDisplayDataItem},t.prototype.isCellType=function(e){return e instanceof p_},t.prototype.getCell=function(e){for(var i,n=e;n&&!(n instanceof NO);){if(this.isCellType(n))return n;n=(i=n.get)===null||i===void 0?void 0:i.call(n,"parent")}return null},t.prototype.getCellType=function(e){var i=this.getCell(e);return i==null?void 0:i.cellType},t.prototype.getTotalsConfig=function(e){var i=this.options.totals,n=this.dataSet.fields.rows,a=kt(i,wi(n,e)?"row":"col",{}),o=a.showSubTotals&&wi(a.subTotalsDimensions,e)?a.showSubTotals:!1;return U(U({label:Pr("总计"),subLabel:Pr("小计"),totalsGroupDimensions:[],subTotalsGroupDimensions:[]},a),{showSubTotals:o})},t.prototype.initGroups=function(e){var i=this.options,n=i.width,a=i.height,o=i.supportCSSTransform,s=i.devicePixelRatio;this.container=new NO({container:this.getMountContainer(e),width:n,height:a,localRefresh:!1,supportCSSTransform:o,pixelRatio:Math.max(s,nU)}),this.backgroundGroup=this.container.addGroup({name:K2t,zIndex:G2t}),this.panelGroup=this.container.addGroup({name:J2t,zIndex:Z2t}),this.foregroundGroup=this.container.addGroup({name:Q2t,zIndex:X2t}),this.initPanelGroupChildren(),this.updateContainerStyle()},t.prototype.updateContainerStyle=function(){var e=this.getCanvasElement();e&&(e.style.display="block")},t.prototype.initPanelGroupChildren=function(){this.panelScrollGroup=new d$t({name:twt,zIndex:q2t,s2:this}),this.panelGroup.add(this.panelScrollGroup)},t.prototype.getInitColumnLeafNodes=function(){return this.store.get("initColumnLeafNodes",[])},t.prototype.clearColumnLeafNodes=function(){this.clearInitColumnLeafNodes()},t.prototype.clearInitColumnLeafNodes=function(){this.store.set("initColumnLeafNodes",void 0)},t.prototype.clearCanvasEvent=function(){var e=this,i=this.getEvents();X9(i,function(n,a){e.off(a)})},t.prototype.updateSortMethodMap=function(e,i,n){var a;n===void 0&&(n=!1);var o=n?null:this.store.get("sortMethodMap");this.store.set("sortMethodMap",U(U({},o),(a={},a[e]=i,a)))},t.prototype.getMenuDefaultSelectedKeys=function(e){var i=this.store.get("sortMethodMap"),n=kt(i,e);return n?[n]:[]},t}(Dy),eVt=function(r){yt(t,r);function t(){return r!==null&&r.apply(this,arguments)||this}return t.prototype.getDataSet=function(e){var i=e.dataSet,n=e.hierarchyType;if(i)return i(this);var a=n==="customTree"?new MHt(this):new OE(this);return a},t.prototype.getContentHeight=function(){return this.facet.getContentHeight()},t.prototype.isPivotMode=function(){return!0},t.prototype.isTableMode=function(){return!1},t.prototype.isHierarchyTreeType=function(){var e=this.options.hierarchyType;return e==="tree"||e==="customTree"},t.prototype.isScrollContainsRowHeader=function(){return!this.isFrozenRowHeader()},t.prototype.isFrozenRowHeader=function(){var e;return(e=this.options)===null||e===void 0?void 0:e.frozenRowHeader},t.prototype.isValueInCols=function(){var e,i;return(i=(e=this.dataSet)===null||e===void 0?void 0:e.fields)===null||i===void 0?void 0:i.valueInCols},t.prototype.clearDrillDownData=function(e,i){if(this.dataSet instanceof OE){var n=this.dataSet.clearDrillDownData(e);n&&!i&&(this.interaction.reset(),this.render(!1))}},t.prototype.getFacetCfgFromDataSetAndOptions=function(){var e=this,i=this.dataSet,n=i.fields,a=i.meta,o=this.options,s=o.style,l=o.dataCell,u=function(c){return new Cl(c,e)};return U(U(U(U({},this.options),n),s),{meta:a,spreadsheet:this,dataSet:this.dataSet,dataCell:l??u})},t.prototype.buildFacet=function(){var e,i=this.getFacetCfgFromDataSetAndOptions();(e=this.facet)===null||e===void 0||e.destroy(),this.facet=new c$t(i),this.facet.render()},t.prototype.bindEvents=function(){this.off(X.ROW_CELL_COLLAPSE_TREE_ROWS),this.off(X.LAYOUT_TREE_ROWS_COLLAPSE_ALL),this.on(X.ROW_CELL_COLLAPSE_TREE_ROWS,this.handleRowCellCollapseTreeRows),this.on(X.LAYOUT_TREE_ROWS_COLLAPSE_ALL,this.handleTreeRowsCollapseAll)},t.prototype.handleRowCellCollapseTreeRows=function(e){var i,n=e.id,a=e.isCollapsed,o={style:{collapsedRows:(i={},i[n]=a,i)}};this.emit(X.LAYOUT_COLLAPSE_ROWS,{collapsedRows:o.style.collapsedRows,meta:e==null?void 0:e.node}),this.setOptions(o),this.render(!1),this.emit(X.LAYOUT_AFTER_COLLAPSE_ROWS,{collapsedRows:o.style.collapsedRows,meta:e==null?void 0:e.node})},t.prototype.handleTreeRowsCollapseAll=function(e){var i={style:{hierarchyCollapse:!e,collapsedRows:null,rowExpandDepth:null}};this.setOptions(i),this.render(!1)},t.prototype.groupSortByMethod=function(e,i){var n=this.dataCfg.fields,a=n.rows,o=n.columns,s=this.options.style.colCfg.hideMeasureColumn,l=this.isValueInCols()?Be(a):Be(o),u=i.query,c=i.value,h=rp(u),f=c;s&&this.isValueInCols()&&(f=this.dataSet.fields.values[0],h[Kt]=f);var d={sortFieldId:l,sortMethod:e,sortByMeasure:f,query:h},v=this.dataCfg.sortParams.filter(function(g){return(g==null?void 0:g.sortFieldId)!==l});this.updateSortMethodMap(i.id,e,!0);var p=ft(ft([],rt(v),!1),[d],!1);this.emit(X.RANGE_SORT,p),this.setDataCfg(U(U({},this.dataCfg),{sortParams:p})),this.render()},t.prototype.handleGroupSort=function(e,i){var n=this;e.stopPropagation(),this.interaction.addIntercepts([Gt.HOVER]);var a=this.getMenuDefaultSelectedKeys(i==null?void 0:i.id),o={onClick:function(s){var l=s.key,u=l;n.groupSortByMethod(u,i),n.emit(X.RANGE_SORTED,e)},menus:hkt(),defaultSelectedKeys:a};this.showTooltipWithInfo(e,[],{operator:o,onlyMenu:!0,forceRender:!0})},t.prototype.initPanelGroupChildren=function(){r.prototype.initPanelGroupChildren.call(this);var e={zIndex:Yk,s2:this};this.frozenRowGroup=new o$(U({KEY_GROUP_PANEL_FROZEN_ROW:jk},e)),this.panelGroup.add(this.frozenRowGroup)},t.prototype.isCellType=function(e){return e instanceof p_&&!(e instanceof AH)},t}(s$),rVt=function(r){yt(t,r);function t(){var e=r!==null&&r.apply(this,arguments)||this;return e.onSortTooltipClick=function(i,n){var a=i.key,o=n.field,s={sortFieldId:o,sortMethod:a};e.updateSortMethodMap(n.id,a),e.emit(X.RANGE_SORT,[s])},e}return t.prototype.getDataSet=function(e){var i=e.dataSet;return i?i(this):new IHt(this)},t.prototype.isPivotMode=function(){return!1},t.prototype.isTableMode=function(){return!0},t.prototype.isHierarchyTreeType=function(){return!1},t.prototype.isScrollContainsRowHeader=function(){return!1},t.prototype.isFrozenRowHeader=function(){return!1},t.prototype.clearDrillDownData=function(){},t.prototype.isValueInCols=function(){return!1},t.prototype.bindEvents=function(){},t.prototype.initPanelGroupChildren=function(){var e,i=this;r.prototype.initPanelGroupChildren.call(this);var n={zIndex:Yk,s2:this};e=rt([jk,Zk,ewt,rwt,iwt,nwt].map(function(a){var o=new o$(U({name:a},n));return i.panelGroup.add(o),o}),6),this.frozenRowGroup=e[0],this.frozenColGroup=e[1],this.frozenTrailingRowGroup=e[2],this.frozenTrailingColGroup=e[3],this.frozenTopGroup=e[4],this.frozenBottomGroup=e[5]},t.prototype.getFacetCfgFromDataSetAndOptions=function(){var e=this,i=this.dataSet,n=i.fields,a=i.meta,o=this.options,s=o.style,l=o.dataCell,u=function(c){return e.options.showSeriesNumber&&c.colIndex===0?new CH(c,e):new m_(c,e)};return U(U(U(U({},this.options),n),s),{meta:a,spreadsheet:this,dataSet:this.dataSet,dataCell:l??u})},t.prototype.buildFacet=function(){var e,i=this.getFacetCfgFromDataSetAndOptions();(e=this.facet)===null||e===void 0||e.destroy(),this.facet=new f$t(i),this.facet.render()},t.prototype.clearFrozenGroups=function(){this.frozenRowGroup.set("children",[]),this.frozenColGroup.set("children",[]),this.frozenTrailingRowGroup.set("children",[]),this.frozenTrailingColGroup.set("children",[]),this.frozenTopGroup.set("children",[]),this.frozenBottomGroup.set("children",[])},t.prototype.destroy=function(){r.prototype.destroy.call(this),this.clearFrozenGroups(),this.off(X.RANGE_SORT),this.off(X.RANGE_FILTER)},t.prototype.handleGroupSort=function(e,i){var n=this;e.stopPropagation(),this.interaction.addIntercepts([Gt.HOVER]);var a=this.getMenuDefaultSelectedKeys(i==null?void 0:i.id),o={onClick:function(s){var l=s.key,u=l;n.onSortTooltipClick({key:u},i)},menus:fkt(),defaultSelectedKeys:a};this.showTooltipWithInfo(e,[],{operator:o,onlyMenu:!0,forceRender:!0})},t}(s$);export{vWt as $,iUt as A,WF as B,GW as C,d_t as D,mn as E,pa as F,art as G,mWt as H,b2 as I,pm as J,rVt as K,HE as L,_9t as M,Zl as N,So as O,qc as P,Kt as Q,eVt as R,hat as S,LWt as T,OE as U,Yn as V,Zi as W,V6 as X,u7 as Y,gtt as Z,p7 as _,IWt as a,OWt as a0,PWt as a1,FWt as a2,BWt as a3,DWt as a4,NWt as a5,kWt as a6,UWt as a7,zWt as a8,HWt as a9,$Wt as aa,WWt as ab,VWt as ac,GWt as ad,XWt as ae,YWt as af,jWt as ag,ZWt as ah,qWt as ai,KWt as aj,QWt as ak,tVt as al,mv as b,Qo as c,pA as d,mtt as e,kh as f,tSt as g,CT as h,Py as i,Oc as j,Ed as k,TWt as l,dHt as m,fHt as n,Dg as o,bt as p,yi as q,m_ as r,Ah as s,xH as t,Hn as u,qu as v,Iu as w,X as x,Su as y,S9t as z};

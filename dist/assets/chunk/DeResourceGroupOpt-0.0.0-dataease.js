import{E,r as we,w as ye,e as be,s as ke,t as Ve,x as Te,i as ze,M as De,v as Le}from"./element-plus-secondary-0.0.0-dataease.js";import{f as Ce,e as Fe}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as Ee,t as xe,l as Q,r as u,k as B,w as Ie,o as w,T as x,U as i,W as m,_ as Z,Y as z,u as c,$ as Ne,X as D,R as I,a as v,c as ee,n as Re}from"./@vue-0.0.0-dataease.js";import{d as te}from"./dv-folder-0.0.0-dataease.js";import{i as Se}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{a as qe,D as Pe,E as Ue,x as Be,g as Ae}from"./index-0.0.0-dataease.js";import{n as Me}from"./nothing-tree-0.0.0-dataease.js";import{e as Ke,m as Oe,t as $e,o as Ge,w as We,l as Xe}from"./dataVisualization-0.0.0-dataease.js";import{_ as Ye}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./lodash-es-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./pinia-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./fast-png-0.0.0-dataease.js";import"./iobuffer-0.0.0-dataease.js";import"./pako-0.0.0-dataease.js";import"./vue-router_2-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";import"./dataset-0.0.0-dataease.js";import"./js-base64-0.0.0-dataease.js";const je={class:"custom-tree-node"},He=["title"],Je={key:2},Qe={class:"tree-content"},Ze={class:"custom-tree-node"},et=["title"],tt={key:0,class:"empty-search"},at=["src"],ot=Ee({__name:"DeResourceGroupOpt",props:{curCanvasType:{type:String,required:!0}},emits:["finish"],setup(ae,{expose:oe,emit:re}){const N=ae,{curCanvasType:f}=xe(N),{wsCache:le}=qe("localStorage"),{t:a}=Ce(),s=Q({tData:[],nameList:[],targetInfo:null,attachParams:null}),A=u(!1),L=u(!1),M=u(),y=u(),b=u(),d=u(""),R=u(),_=u(""),S=u(""),o=Q({pid:"",pName:null,name:"新建"}),K=B(()=>f.value==="dataV"?a("work_branch.big_data_screen"):a("work_branch.dashboard")),O={move:Ge,copy:We,newFolder:Xe},$=u(!1),ne=(t,e)=>(Re(()=>{$.value=R.value.isEmpty}),t?e.name.includes(t):!0);Ie(_,t=>{R.value.filter(t)});const ie=t=>!q||q.length===0?!1:q.some(e=>e===t),se=(t,e,r)=>{ie(e)?r(new Error(a("visualization.name_repeat"))):r()},ue=B(()=>["newLeaf","copy","newLeafAfter"].includes(d.value)&&A.value),me=B(()=>!["newLeafAfter","move"].includes(d.value));let q=[];const G=u(),P=u(),g=u(!1),U=u("");let W=[];const de=t=>{s.tData=[...W].filter(e=>e.name.includes(t))},X=()=>{U.value=null,S.value="",o.name=a("visualization.new"),o.pid="",g.value=!1},Y=t=>{t.forEach(e=>{var r;e.value=e.id,(r=e.children)!=null&&r.length&&Y(e.children)})},pe=t=>({newFolder:a("visualization.new_folder"),newLeaf:N.curCanvasType==="dataV"?a("visualization.new_screen"):a("visualization.new_dashboard"),move:a("visualization.move_to"),copy:a("visualization.copy")+K.value,rename:a("visualization.rename"),newLeafAfter:a("visualization.belong_folder")})[t],C=u(""),ce=(t,e,r,l=!1,h)=>{A.value=l,s.targetInfo=e,s.attachParams=h,M.value=t;const p=e.leaf||t==="leaf"?K.value:a("visualization.folder"),k=e.leaf||t==="leaf"?N.curCanvasType==="dataV"?a("work_branch.big_data_screen"):a("work_branch.dashboard"):a("visualization.folder");C.value=a("visualization.input_name_tips",[k]),_.value="",U.value=pe(r)+(r==="rename"?p:""),S.value=(r==="move"?"":p)+a("visualization.name");const V={busiFlag:f.value,leaf:!1,resourceTable:"core",weight:7};["newFolder"].includes(r)?o.name="":r==="copy"?o.name=e.name+"_copy":o.name=e.name,Ke(V).then(F=>{Pe(F,f.value);const T=F||[];Y(T),s.tData=T||[],s.tData.length&&s.tData[0].name==="root"&&s.tData[0].id==="0"&&(s.tData[0].name=f.value==="dataV"?a("work_branch.big_data_screen"):a("work_branch.dashboard")),W=[...s.tData],r==="move"&&Ue(s.tData,e.id),["newLeaf","newFolder"].includes(r)?(o.pid=e.id,y.value=e.id):b.value=e.id}),d.value=r,g.value=!0,G.value={name:[{required:!0,message:C.value,trigger:"change"},{required:!0,message:C.value,trigger:"blur"},{min:1,max:64,message:a("commons.char_1_64"),trigger:"change"},{required:!0,trigger:"blur",validator:se}],pid:[{required:!0,message:a("common.please_select"),trigger:"blur"}]},setTimeout(()=>{P.value.clearValidate()},50)},ve=t=>{y.value=t.pid,b.value=t.id},j={label:"name",children:"children",isLeaf:t=>{var e;return!((e=t.children)!=null&&e.length)}},H=t=>{o.pid=t.id,o.pName=t.name},fe=t=>{if(t.pid!==0&&!t.pid)return E.error(a("visualization.select_target_folder")),!1;if(_.value&&!o.pName.includes(_.value))return E.error(a("visualization.select_target_folder")),!1;if(t.pid===t.id){E.warning(a("visualization.select_target_tips"));return}return!0},_e=()=>{P.value.validate(async t=>{var e,r;if(t){const l={nodeType:M.value,name:o.name,type:f.value,mobileLayout:(e=s.targetInfo)==null?void 0:e.extraFlag,status:(r=s.targetInfo)==null?void 0:r.extraFlag1};switch(d.value){case"move":l.pid=o.pid,l.id=b.value;break;case"copy":l.id=b.value,l.pid=o.pid||y.value||"0";break;case"rename":l.pid=y.value,l.id=b.value;break;default:l.pid=o.pid||y.value||"0";break}if(Be(l,a("components.length_1_64_characters")),d.value==="move"&&!fe(l))return;["newLeaf","newLeafAfter","newFolder","rename","move","copy"].includes(d.value)&&await Oe({opt:d.value,...l}),d.value==="newLeaf"?(g.value=!1,J("finish",{opt:"newLeaf",...l,...s.attachParams})):(L.value=!0,(O[d.value]?O[d.value]:$e)(l).then(p=>{if(L.value=!1,g.value=!1,J("finish"),E.success(a("visualization.save_success")),d.value==="copy"){const k=le.get(Ae("open-backend"))==="1"?"_self":"_blank",V=f.value==="dataV"?"#/dvCanvas?opt=copy&dvId=":"#/dashboard?opt=copy&resourceId=";window.open(V+p.data,k)}}).finally(()=>{L.value=!1}))}})};oe({optInit:ce,editeInit:ve});const J=re;return(t,e)=>{const r=we,l=ye,h=Fe,p=be,k=ke,V=Ve,F=Te,T=ze,ge=De,he=Le;return w(),x(ge,{class:"create-dialog",title:U.value,modelValue:g.value,"onUpdate:modelValue":e[10]||(e[10]=n=>g.value=n),width:d.value==="move"?"600px":"420px","before-close":X,onSubmit:e[11]||(e[11]=D(()=>{},["prevent"]))},{footer:i(()=>[m(T,{secondary:"",onClick:e[8]||(e[8]=n=>X())},{default:i(()=>[Z(z(c(a)("visualization.cancel")),1)]),_:1}),m(T,{type:"primary",onClick:e[9]||(e[9]=n=>_e())},{default:i(()=>[Z(z(c(a)("visualization.confirm")),1)]),_:1})]),default:i(()=>[Ne((w(),x(F,{"label-position":"top","require-asterisk-position":"right",ref_key:"resource",ref:P,model:o,rules:G.value},{default:i(()=>[me.value?(w(),x(l,{key:0,label:S.value,prop:"name"},{default:i(()=>[m(r,{onKeydown:e[0]||(e[0]=D(()=>{},["stop"])),onKeyup:e[1]||(e[1]=D(()=>{},["stop"])),placeholder:C.value,modelValue:o.name,"onUpdate:modelValue":e[2]||(e[2]=n=>o.name=n)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])):I("",!0),ue.value?(w(),x(l,{key:1,label:c(a)("visualization.belong_folder"),prop:"pid"},{default:i(()=>[m(k,{style:{width:"100%"},onKeydown:e[3]||(e[3]=D(()=>{},["stop"])),onKeyup:e[4]||(e[4]=D(()=>{},["stop"])),modelValue:o.pid,"onUpdate:modelValue":e[5]||(e[5]=n=>o.pid=n),data:s.tData,props:j,onNodeClick:H,"filter-method":de,"render-after-expand":!1,filterable:""},{default:i(({data:{name:n}})=>[v("span",je,[m(p,null,{default:i(()=>[m(h,{name:"dv-folder"},{default:i(()=>[m(c(te),{class:"svg-icon"})]),_:1})]),_:1}),v("span",{title:n},z(n),9,He)])]),_:1},8,["modelValue","data"])]),_:1},8,["label"])):I("",!0),d.value==="move"?(w(),ee("div",Je,[m(r,{style:{"margin-bottom":"12px"},modelValue:_.value,"onUpdate:modelValue":e[6]||(e[6]=n=>_.value=n),clearable:""},{prefix:i(()=>[m(p,null,{default:i(()=>[m(h,{name:"icon_search-outline_outlined"},{default:i(()=>[m(c(Se),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue"]),v("div",Qe,[m(V,{ref_key:"treeRef",ref:R,"filter-node-method":ne,filterable:"",modelValue:o.pid,"onUpdate:modelValue":e[7]||(e[7]=n=>o.pid=n),"empty-text":"",menu:"",data:s.tData,props:j,onNodeClick:H},{default:i(({data:n})=>[v("span",Ze,[m(p,{style:{"font-size":"18px"}},{default:i(()=>[m(h,{name:"dv-folder"},{default:i(()=>[m(c(te),{class:"svg-icon"})]),_:1})]),_:1}),v("span",{title:n.name},z(n.name),9,et)])]),_:1},8,["modelValue","data"]),$.value?(w(),ee("div",tt,[v("img",{src:c(Me)},null,8,at),v("span",null,z(c(a)("visualization.no_content")),1)])):I("",!0)])])):I("",!0)]),_:1},8,["model","rules"])),[[he,L.value]])]),_:1},8,["title","modelValue","width"])}}});const pa=Ye(ot,[["__scopeId","data-v-d753f99e"]]);export{pa as default};

import{b as we,z as ye}from"./index-0.0.0-dataease.js";import{E as be}from"./el-dialog-0.0.0-dataease.js";import{o as ke,aA as Ve,aB as ze,a7 as Te,D as F,G as De,n as Ee,j as Le,y as Ce}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import{E as Fe}from"./el-tree-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as Ie}from"./el-tree-select-0.0.0-dataease.js";import{E as Ne,a as xe}from"./el-form-item-0.0.0-dataease.js";import{d as Re,t as qe,X as Y,r as u,y as A,w as Se,f as w,g as I,i as r,j as d,a3 as Z,a4 as T,u as p,R as Be,a8 as D,_ as N,P as v,O as ee,n as Pe}from"./vue-0.0.0-dataease.js";import{d as ae}from"./dv-folder-0.0.0-dataease.js";import{i as Ae}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{n as Ue}from"./nothing-tree-0.0.0-dataease.js";import{e as Oe,m as Ge,t as Ke,o as Me,w as $e,l as je}from"./dataVisualization-0.0.0-dataease.js";import{_ as Xe}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./index-0.0.0-dataease3.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./token-0.0.0-dataease.js";import"./index-0.0.0-dataease15.js";import"./index-0.0.0-dataease4.js";import"./index-0.0.0-dataease6.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease5.js";import"./dataset-0.0.0-dataease.js";const He={class:"custom-tree-node"},Je=["title"],Qe={key:2},We={class:"tree-content"},Ye={class:"custom-tree-node"},Ze=["title"],ea={key:0,class:"empty-search"},aa=["src"],ta=Re({__name:"DeResourceGroupOpt",props:{curCanvasType:{type:String,required:!0}},emits:["finish"],setup(te,{expose:oe,emit:le}){const x=te,{curCanvasType:f}=qe(x),{wsCache:ne}=we("localStorage"),{t}=ke(),i=Y({tData:[],nameList:[],targetInfo:null,attachParams:null}),U=u(!1),E=u(!1),O=u(),y=u(),b=u(),m=u(""),R=u(),_=u(""),q=u(""),o=Y({pid:"",pName:null,name:"新建"}),G=A(()=>f.value==="dataV"?t("work_branch.big_data_screen"):t("work_branch.dashboard")),K={move:Me,copy:$e,newFolder:je},M=u(!1),se=(a,e)=>(Pe(()=>{M.value=R.value.isEmpty}),a?e.name.includes(a):!0);Se(_,a=>{R.value.filter(a)});const re=a=>!S||S.length===0?!1:S.some(e=>e===a),ie=(a,e,l)=>{re(e)?l(new Error(t("visualization.name_repeat"))):l()},ue=A(()=>["newLeaf","copy","newLeafAfter"].includes(m.value)&&U.value),de=A(()=>!["newLeafAfter","move"].includes(m.value));let S=[];const $=u(),B=u(),g=u(!1),P=u("");let j=[];const me=a=>{i.tData=[...j].filter(e=>e.name.includes(a))},X=()=>{P.value=null,q.value="",o.name=t("visualization.new"),o.pid="",g.value=!1},H=a=>{a.forEach(e=>{var l;e.value=e.id,(l=e.children)!=null&&l.length&&H(e.children)})},ce=a=>({newFolder:t("visualization.new_folder"),newLeaf:x.curCanvasType==="dataV"?t("visualization.new_screen"):t("visualization.new_dashboard"),move:t("visualization.move_to"),copy:t("visualization.copy")+G.value,rename:t("visualization.rename"),newLeafAfter:t("visualization.belong_folder")})[a],L=u(""),pe=(a,e,l,n=!1,h)=>{U.value=n,i.targetInfo=e,i.attachParams=h,O.value=a;const c=e.leaf||a==="leaf"?G.value:t("visualization.folder"),k=e.leaf||a==="leaf"?x.curCanvasType==="dataV"?t("work_branch.big_data_screen"):t("work_branch.dashboard"):t("visualization.folder");L.value=t("visualization.input_name_tips",[k]),_.value="",P.value=ce(l)+(l==="rename"?c:""),q.value=(l==="move"?"":c)+t("visualization.name");const V={busiFlag:f.value,leaf:!1,resourceTable:"core",weight:7};["newFolder"].includes(l)?o.name="":l==="copy"?o.name=e.name+"_copy":o.name=e.name,Oe(V).then(C=>{Ve(C,f.value);const z=C||[];H(z),i.tData=z||[],i.tData.length&&i.tData[0].name==="root"&&i.tData[0].id==="0"&&(i.tData[0].name=f.value==="dataV"?t("work_branch.big_data_screen"):t("work_branch.dashboard")),j=[...i.tData],l==="move"&&ze(i.tData,e.id),["newLeaf","newFolder"].includes(l)?(o.pid=e.id,y.value=e.id):b.value=e.id}),m.value=l,g.value=!0,$.value={name:[{required:!0,message:L.value,trigger:"change"},{required:!0,message:L.value,trigger:"blur"},{min:1,max:64,message:t("commons.char_1_64"),trigger:"change"},{required:!0,trigger:"blur",validator:ie}],pid:[{required:!0,message:t("common.please_select"),trigger:"blur"}]},setTimeout(()=>{B.value.clearValidate()},50)},ve=a=>{y.value=a.pid,b.value=a.id},J={label:"name",children:"children",isLeaf:a=>{var e;return!((e=a.children)!=null&&e.length)}},Q=a=>{o.pid=a.id,o.pName=a.name},fe=a=>{if(a.pid!==0&&!a.pid)return F.error(t("visualization.select_target_folder")),!1;if(_.value&&!o.pName.includes(_.value))return F.error(t("visualization.select_target_folder")),!1;if(a.pid===a.id){F.warning(t("visualization.select_target_tips"));return}return!0},_e=()=>{B.value.validate(async a=>{var e,l;if(a){const n={nodeType:O.value,name:o.name,type:f.value,mobileLayout:(e=i.targetInfo)==null?void 0:e.extraFlag,status:(l=i.targetInfo)==null?void 0:l.extraFlag1};switch(m.value){case"move":n.pid=o.pid,n.id=b.value;break;case"copy":n.id=b.value,n.pid=o.pid||y.value||"0";break;case"rename":n.pid=y.value,n.id=b.value;break;default:n.pid=o.pid||y.value||"0";break}if(Te(n,t("components.length_1_64_characters")),m.value==="move"&&!fe(n))return;["newLeaf","newLeafAfter","newFolder","rename","move","copy"].includes(m.value)&&await Ge({opt:m.value,...n}),m.value==="newLeaf"?(g.value=!1,W("finish",{opt:"newLeaf",...n,...i.attachParams})):(E.value=!0,(K[m.value]?K[m.value]:Ke)(n).then(c=>{if(E.value=!1,g.value=!1,W("finish"),F.success(t("visualization.save_success")),m.value==="copy"){const k=ne.get("open-backend")==="1"?"_self":"_blank",V=f.value==="dataV"?"#/dvCanvas?opt=copy&dvId=":"#/dashboard?opt=copy&resourceId=";window.open(V+c.data,k)}}).finally(()=>{E.value=!1}))}})};oe({optInit:pe,editeInit:ve});const W=le;return(a,e)=>{const l=De,n=Ne,h=Ee,c=Le,k=Ie,V=Fe,C=xe,z=Ce,ge=be,he=ye;return w(),I(ge,{class:"create-dialog",title:P.value,modelValue:g.value,"onUpdate:modelValue":e[10]||(e[10]=s=>g.value=s),width:m.value==="move"?"600px":"420px","before-close":X,onSubmit:e[11]||(e[11]=D(()=>{},["prevent"]))},{footer:r(()=>[d(z,{secondary:"",onClick:e[8]||(e[8]=s=>X())},{default:r(()=>[Z(T(p(t)("visualization.cancel")),1)]),_:1}),d(z,{type:"primary",onClick:e[9]||(e[9]=s=>_e())},{default:r(()=>[Z(T(p(t)("visualization.confirm")),1)]),_:1})]),default:r(()=>[Be((w(),I(C,{"label-position":"top","require-asterisk-position":"right",ref_key:"resource",ref:B,model:o,rules:$.value},{default:r(()=>[de.value?(w(),I(n,{key:0,label:q.value,prop:"name"},{default:r(()=>[d(l,{onKeydown:e[0]||(e[0]=D(()=>{},["stop"])),onKeyup:e[1]||(e[1]=D(()=>{},["stop"])),placeholder:L.value,modelValue:o.name,"onUpdate:modelValue":e[2]||(e[2]=s=>o.name=s)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])):N("",!0),ue.value?(w(),I(n,{key:1,label:p(t)("visualization.belong_folder"),prop:"pid"},{default:r(()=>[d(k,{style:{width:"100%"},onKeydown:e[3]||(e[3]=D(()=>{},["stop"])),onKeyup:e[4]||(e[4]=D(()=>{},["stop"])),modelValue:o.pid,"onUpdate:modelValue":e[5]||(e[5]=s=>o.pid=s),data:i.tData,props:J,onNodeClick:Q,"filter-method":me,"render-after-expand":!1,filterable:""},{default:r(({data:{name:s}})=>[v("span",He,[d(c,null,{default:r(()=>[d(h,{name:"dv-folder"},{default:r(()=>[d(p(ae),{class:"svg-icon"})]),_:1})]),_:1}),v("span",{title:s},T(s),9,Je)])]),_:1},8,["modelValue","data"])]),_:1},8,["label"])):N("",!0),m.value==="move"?(w(),ee("div",Qe,[d(l,{style:{"margin-bottom":"12px"},modelValue:_.value,"onUpdate:modelValue":e[6]||(e[6]=s=>_.value=s),clearable:""},{prefix:r(()=>[d(c,null,{default:r(()=>[d(h,{name:"icon_search-outline_outlined"},{default:r(()=>[d(p(Ae),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue"]),v("div",We,[d(V,{ref_key:"treeRef",ref:R,"filter-node-method":se,filterable:"",modelValue:o.pid,"onUpdate:modelValue":e[7]||(e[7]=s=>o.pid=s),"empty-text":"",menu:"",data:i.tData,props:J,onNodeClick:Q},{default:r(({data:s})=>[v("span",Ye,[d(c,{style:{"font-size":"18px"}},{default:r(()=>[d(h,{name:"dv-folder"},{default:r(()=>[d(p(ae),{class:"svg-icon"})]),_:1})]),_:1}),v("span",{title:s.name},T(s.name),9,Ze)])]),_:1},8,["modelValue","data"]),M.value?(w(),ee("div",ea,[v("img",{src:p(Ue)},null,8,aa),v("span",null,T(p(t)("visualization.no_content")),1)])):N("",!0)])])):N("",!0)]),_:1},8,["model","rules"])),[[he,E.value]])]),_:1},8,["title","modelValue","width"])}}});const qa=Xe(ta,[["__scopeId","data-v-9743b0da"]]);export{qa as default};

import{p as S,c as Y}from"./index-0.0.0-dataease.js";import{a as Z}from"./el-table-0.0.0-dataease.js";import{E as tt}from"./el-checkbox-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{o as q,x as h,n as z,y as et,j as ot,D,F as nt}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as at,r as R,t as st,X as it,o as ct,f as lt,O as rt,P as s,a4 as m,u as c,j as e,z as dt,a8 as _,i as o,a3 as pt,S as ut,W as mt}from"./vue-0.0.0-dataease.js";import{i as _t}from"./icon_close_outlined-0.0.0-dataease.js";import{d as ft}from"./de-copy-0.0.0-dataease.js";import{i as gt}from"./icon_refresh_outlined-0.0.0-dataease.js";import{d as kt}from"./dv-info-0.0.0-dataease.js";import{i as ht}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import{i as bt}from"./icon_edit_outlined-0.0.0-dataease.js";import{i as vt}from"./icon_add_outlined-0.0.0-dataease.js";import{u as Ct}from"./index-0.0.0-dataease19.js";import{G as wt}from"./GridTable-0.0.0-dataease.js";import Tt from"./TicketEdit-0.0.0-dataease.js";import{E as yt}from"./index-0.0.0-dataease4.js";import{_ as xt}from"./_plugin-vue_export-helper-0.0.0-dataease.js";const St="/de-link/",{t:$}=q(),le=[{text:$("commons.date.one_hour"),value:()=>{const l=new Date;return l.setTime(l.getTime()+3600*1e3),l}},{text:$("commons.date.one_day"),value:()=>{const l=new Date;return l.setTime(l.getTime()+3600*1e3*24),l}},{text:$("commons.date.one_week"),value:()=>{const l=new Date;return l.setTime(l.getTime()+7*3600*1e3*24),l}}],$t={class:"ticket"},Et={class:"ticket-model"},Bt={class:"ticket-model-start"},It={class:"ticket-title"},zt={class:"ticket-model-end"},Dt={class:"ticket-add"},Rt={class:"ticket-table"},qt={class:"ticket-row"},Nt=["title"],Ot={class:"ticket-exp-head"},jt={class:"exp-tips-span"},Pt={style:{color:"#3370ff"}},Vt={class:"ticket-row"},Lt=at({__name:"ShareTicket",props:{uuid:S.string.def(""),resourceId:S.string.def(null),ticketRequire:S.bool},emits:["close","requireChange"],setup(l,{emit:N}){const E=Y(),{toClipboard:O}=Ct(),{t:r}=q(),f=l,C=R(),{ticketRequire:w}=st(f),T=R(0),d=it({tableData:[],paginationConfig:{currentPage:1,pageSize:10,total:0}}),B=N,j=()=>{B("close")},P=t=>{const n="/ticket/enableTicket",a={resourceId:f.resourceId,require:t};h.post({url:n,data:a}).then(()=>{B("requireChange",t)})},V=()=>{const t=d.paginationConfig.total;return T.value&&t>=T.value?(nt.confirm(r("chart.tips"),{confirmButtonType:"primary",type:"warning",confirmButtonText:r("common.roger_that"),cancelButtonText:r("dataset.cancel"),autofocus:!1,showClose:!1,showCancelButton:!1,tip:r("work_branch.max_ticket_count")}),!0):!1},L=t=>{const n=t.args;if(!n)return 0;try{const a=JSON.parse(n);return Object.keys(a).length}catch(a){return console.error(a),0}},M=()=>{V()||C.value.edit(null,y())},y=()=>A()+f.uuid,A=()=>{let t="/";return E.baseUrl?t=E.baseUrl+"#":t=window.location.origin+window.location.pathname+"#",(t.includes("oidcbi/")||t.includes("casbi/"))&&(t=t.replace("oidcbi/",""),t=t.replace("casbi/","")),t+St},J=async t=>{const n=`${y()}?ticket=${t}`;try{await O(n),D.success(r("common.copy_success"))}catch(a){D.warning(r("common.copy_unsupported"),a)}},U=t=>{const n="/ticket/saveTicket",a=JSON.parse(JSON.stringify(t));a.generateNew=!0,h.post({url:n,data:a}).then(p=>{t.ticket=p.data})},F=t=>{const n={ticket:t.ticket},a="/ticket/delTicket";h.post({url:a,data:n}).then(()=>{g()})},G=t=>{C.value.edit(t,y())},H=()=>{j()},g=()=>{const n=`/ticket/pager/${f.resourceId}/${d.paginationConfig.currentPage}/${d.paginationConfig.pageSize}`;h.post({url:n}).then(a=>{var p;d.tableData=((p=a.data)==null?void 0:p.records)||[],d.paginationConfig.total=a.data.total})},W=t=>{typeof t=="number"&&(d.paginationConfig.currentPage=t,g())},X=t=>{d.paginationConfig.pageSize=t,d.paginationConfig.currentPage=1,g()},K=()=>{const t="/ticket/limit";h.get({url:t}).then(n=>{const a=n.data;T.value=a})};return ct(()=>{K(),g()}),(t,n)=>{var I;const a=tt,p=z,b=et,k=z,u=yt,v=Z,Q=ot;return lt(),rt(mt,null,[s("div",$t,[s("div",Et,[s("div",Bt,[s("span",It,m("Ticket "+c(r)("commons.setting")),1)]),s("div",zt,[e(a,{modelValue:c(w),"onUpdate:modelValue":n[0]||(n[0]=i=>dt(w)?w.value=i:null),onChange:P,label:c(r)("link_ticket.require")},null,8,["modelValue","label"]),n[1]||(n[1]=s("span",{class:"top-split"},null,-1)),s("span",{class:"top-close",onClick:_(H,["stop"])},[e(p,{name:"icon_close_outlined"},{default:o(()=>[e(c(_t),{class:"svg-icon"})]),_:1})])])]),s("div",Dt,[e(b,{onClick:_(M,["stop"]),text:""},{icon:o(()=>[e(p,{name:"icon_add_outlined"},{default:o(()=>[e(c(vt),{class:"svg-icon"})]),_:1})]),default:o(()=>[pt(" "+m(c(r)("commons.add")),1)]),_:1})]),s("div",Rt,[e(wt,{ref:"multipleTableRef","show-empty-img":!1,"table-data":d.tableData,pagination:d.paginationConfig,class:ut(["popper-max-width",{"popper-max-height":((I=d.tableData)==null?void 0:I.length)>=10}]),onCurrentChange:W,onSizeChange:X},{default:o(()=>[e(v,{prop:"ticket",label:"Ticket"},{default:o(i=>[s("div",qt,[s("span",{title:i.row.ticket},m(i.row.ticket),9,Nt),e(u,{class:"item",effect:"dark",content:t.$t("commons.copy"),placement:"top"},{default:o(()=>[e(b,{text:"",onClick:_(x=>J(i.row.ticket),["stop"])},{icon:o(()=>[e(k,{name:"de-copy"},{default:o(()=>[e(c(ft),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["content"]),e(u,{class:"item",effect:"dark",content:`${t.$t("link_ticket.refresh")} ticket`,placement:"top"},{default:o(()=>[e(b,{text:"",onClick:_(x=>U(i.row),["stop"])},{icon:o(()=>[e(k,{name:"icon_refresh_outlined"},{default:o(()=>[e(c(gt),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["content"])])]),_:1}),e(v,{prop:"exp",label:t.$t("visualization.over_time")},{header:o(()=>[s("div",Ot,[s("span",null,m(c(r)("visualization.over_time")),1),e(u,{class:"item",effect:"dark",content:c(r)("link_ticket.time_tips"),placement:"top"},{default:o(()=>[s("span",jt,[e(k,{name:"dv-info"},{default:o(()=>[e(c(kt),{class:"svg-icon"})]),_:1})])]),_:1},8,["content"])])]),default:o(i=>[s("span",null,m(i.row.exp),1)]),_:1},8,["label"]),e(v,{prop:"args",label:t.$t("dataset.param"),width:"117"},{default:o(i=>[e(u,{class:"box-item",effect:"light",content:i.row.args,placement:"top"},{default:o(()=>[s("span",Pt,m(L(i.row)),1)]),_:2},1032,["content"])]),_:1},8,["label"]),e(v,{label:t.$t("commons.operating"),width:"80"},{default:o(i=>[s("div",Vt,[e(u,{class:"item",effect:"dark",content:t.$t("commons.edit"),placement:"top"},{default:o(()=>[e(b,{text:"",onClick:_(x=>G(i.row),["stop"])},{icon:o(()=>[e(k,{name:"icon_edit_outlined"},{default:o(()=>[e(c(bt),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["content"]),e(u,{class:"item",effect:"dark",content:c(r)("commons.delete"),placement:"top"},{default:o(()=>[e(Q,{style:{"margin-left":"8px",color:"#646a73",cursor:"pointer"},onClick:_(x=>F(i.row),["stop"])},{default:o(()=>[e(k,{name:"icon_delete-trash_outlined"},{default:o(()=>[e(c(ht),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["content"])])]),_:1},8,["label"])]),_:1},8,["table-data","pagination","class"])])]),e(Tt,{ref_key:"ticketEditor",ref:C,uuid:f.uuid,onSaved:g},null,8,["uuid"])],64)}}});const Mt=xt(Lt,[["__scopeId","data-v-9341d488"]]),re=Object.freeze(Object.defineProperty({__proto__:null,default:Mt},Symbol.toStringTag,{value:"Module"}));export{Mt as S,St as a,re as b,le as s};

import{z as Q,i as Z,f as tt,W as et,e as ot,E as I,q as nt}from"./element-plus-secondary-0.0.0-dataease.js";import{f as R,j as h,e as q}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as at,r as D,t as st,l as it,b as ct,o as lt,c as rt,a as s,Y as m,u as c,W as e,m as dt,X as _,U as o,_ as ut,z as pt,S as mt}from"./@vue-0.0.0-dataease.js";import{i as _t}from"./icon_close_outlined-0.0.0-dataease.js";import{d as ft}from"./de-copy-0.0.0-dataease.js";import{i as gt}from"./icon_refresh_outlined-0.0.0-dataease.js";import{d as kt}from"./dv-info-0.0.0-dataease.js";import{i as ht}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import{i as bt}from"./icon_edit_outlined-0.0.0-dataease.js";import{i as vt}from"./icon_add_outlined-0.0.0-dataease.js";import{p as S,f as Ct}from"./index-0.0.0-dataease.js";import{u as wt}from"./vue-clipboard3-0.0.0-dataease.js";import{G as Tt}from"./GridTable-0.0.0-dataease.js";import yt from"./TicketEdit-0.0.0-dataease.js";import{_ as xt}from"./_plugin-vue_export-helper-0.0.0-dataease.js";const St="/de-link/",{t:$}=R(),ne=[{text:$("commons.date.one_hour"),value:()=>{const l=new Date;return l.setTime(l.getTime()+3600*1e3),l}},{text:$("commons.date.one_day"),value:()=>{const l=new Date;return l.setTime(l.getTime()+3600*1e3*24),l}},{text:$("commons.date.one_week"),value:()=>{const l=new Date;return l.setTime(l.getTime()+7*3600*1e3*24),l}}],$t={class:"ticket"},Et={class:"ticket-model"},zt={class:"ticket-model-start"},Bt={class:"ticket-title"},It={class:"ticket-model-end"},qt={class:"ticket-add"},Dt={class:"ticket-table"},Rt={class:"ticket-row"},Nt=["title"],Ot={class:"ticket-exp-head"},Vt={class:"exp-tips-span"},jt={style:{color:"#3370ff"}},Lt={class:"ticket-row"},Mt=at({__name:"ShareTicket",props:{uuid:S.string.def(""),resourceId:S.string.def(null),ticketRequire:S.bool},emits:["close","requireChange"],setup(l,{emit:N}){const E=Ct(),{toClipboard:O}=wt(),{t:r}=R(),f=l,C=D(),{ticketRequire:w}=st(f),T=D(0),d=it({tableData:[],paginationConfig:{currentPage:1,pageSize:10,total:0}}),z=N,V=()=>{z("close")},j=t=>{const n="/ticket/enableTicket",a={resourceId:f.resourceId,require:t};h.post({url:n,data:a}).then(()=>{z("requireChange",t)})},L=()=>{const t=d.paginationConfig.total;return T.value&&t>=T.value?(nt.confirm(r("chart.tips"),{confirmButtonType:"primary",type:"warning",confirmButtonText:r("common.roger_that"),cancelButtonText:r("dataset.cancel"),autofocus:!1,showClose:!1,showCancelButton:!1,tip:r("work_branch.max_ticket_count")}),!0):!1},M=t=>{const n=t.args;if(!n)return 0;try{const a=JSON.parse(n);return Object.keys(a).length}catch(a){return console.error(a),0}},P=()=>{L()||C.value.edit(null,y())},y=()=>A()+f.uuid,A=()=>{let t="/";return E.baseUrl?t=E.baseUrl+"#":t=window.location.origin+window.location.pathname+"#",(t.includes("oidcbi/")||t.includes("casbi/"))&&(t=t.replace("oidcbi/",""),t=t.replace("casbi/","")),t+St},U=async t=>{const n=`${y()}?ticket=${t}`;try{await O(n),I.success(r("common.copy_success"))}catch(a){I.warning(r("common.copy_unsupported"),a)}},J=t=>{const n="/ticket/saveTicket",a=JSON.parse(JSON.stringify(t));a.generateNew=!0,h.post({url:n,data:a}).then(u=>{t.ticket=u.data})},G=t=>{const n={ticket:t.ticket},a="/ticket/delTicket";h.post({url:a,data:n}).then(()=>{g()})},W=t=>{C.value.edit(t,y())},F=()=>{V()},g=()=>{const n=`/ticket/pager/${f.resourceId}/${d.paginationConfig.currentPage}/${d.paginationConfig.pageSize}`;h.post({url:n}).then(a=>{var u;d.tableData=((u=a.data)==null?void 0:u.records)||[],d.paginationConfig.total=a.data.total})},H=t=>{typeof t=="number"&&(d.paginationConfig.currentPage=t,g())},X=t=>{d.paginationConfig.pageSize=t,d.paginationConfig.currentPage=1,g()},Y=()=>{const t="/ticket/limit";h.get({url:t}).then(n=>{const a=n.data;T.value=a})};return ct(()=>{Y(),g()}),(t,n)=>{var B;const a=Q,u=q,b=Z,k=q,p=tt,v=et,K=ot;return lt(),rt(mt,null,[s("div",$t,[s("div",Et,[s("div",zt,[s("span",Bt,m("Ticket "+c(r)("commons.setting")),1)]),s("div",It,[e(a,{modelValue:c(w),"onUpdate:modelValue":n[0]||(n[0]=i=>dt(w)?w.value=i:null),onChange:j,label:c(r)("link_ticket.require")},null,8,["modelValue","label"]),n[1]||(n[1]=s("span",{class:"top-split"},null,-1)),s("span",{class:"top-close",onClick:_(F,["stop"])},[e(u,{name:"icon_close_outlined"},{default:o(()=>[e(c(_t),{class:"svg-icon"})]),_:1})])])]),s("div",qt,[e(b,{onClick:_(P,["stop"]),text:""},{icon:o(()=>[e(u,{name:"icon_add_outlined"},{default:o(()=>[e(c(vt),{class:"svg-icon"})]),_:1})]),default:o(()=>[ut(" "+m(c(r)("commons.add")),1)]),_:1})]),s("div",Dt,[e(Tt,{ref:"multipleTableRef","show-empty-img":!1,"table-data":d.tableData,pagination:d.paginationConfig,class:pt(["popper-max-width",{"popper-max-height":((B=d.tableData)==null?void 0:B.length)>=10}]),onCurrentChange:H,onSizeChange:X},{default:o(()=>[e(v,{prop:"ticket",label:"Ticket"},{default:o(i=>[s("div",Rt,[s("span",{title:i.row.ticket},m(i.row.ticket),9,Nt),e(p,{class:"item",effect:"dark",content:t.$t("commons.copy"),placement:"top"},{default:o(()=>[e(b,{text:"",onClick:_(x=>U(i.row.ticket),["stop"])},{icon:o(()=>[e(k,{name:"de-copy"},{default:o(()=>[e(c(ft),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["content"]),e(p,{class:"item",effect:"dark",content:`${t.$t("link_ticket.refresh")} ticket`,placement:"top"},{default:o(()=>[e(b,{text:"",onClick:_(x=>J(i.row),["stop"])},{icon:o(()=>[e(k,{name:"icon_refresh_outlined"},{default:o(()=>[e(c(gt),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["content"])])]),_:1}),e(v,{prop:"exp",label:t.$t("visualization.over_time")},{header:o(()=>[s("div",Ot,[s("span",null,m(c(r)("visualization.over_time")),1),e(p,{class:"item",effect:"dark",content:c(r)("link_ticket.time_tips"),placement:"top"},{default:o(()=>[s("span",Vt,[e(k,{name:"dv-info"},{default:o(()=>[e(c(kt),{class:"svg-icon"})]),_:1})])]),_:1},8,["content"])])]),default:o(i=>[s("span",null,m(i.row.exp),1)]),_:1},8,["label"]),e(v,{prop:"args",label:t.$t("dataset.param"),width:"117"},{default:o(i=>[e(p,{class:"box-item",effect:"light",content:i.row.args,placement:"top"},{default:o(()=>[s("span",jt,m(M(i.row)),1)]),_:2},1032,["content"])]),_:1},8,["label"]),e(v,{label:t.$t("commons.operating"),width:"80"},{default:o(i=>[s("div",Lt,[e(p,{class:"item",effect:"dark",content:t.$t("commons.edit"),placement:"top"},{default:o(()=>[e(b,{text:"",onClick:_(x=>W(i.row),["stop"])},{icon:o(()=>[e(k,{name:"icon_edit_outlined"},{default:o(()=>[e(c(bt),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["content"]),e(p,{class:"item",effect:"dark",content:c(r)("commons.delete"),placement:"top"},{default:o(()=>[e(K,{style:{"margin-left":"8px",color:"#646a73",cursor:"pointer"},onClick:_(x=>G(i.row),["stop"])},{default:o(()=>[e(k,{name:"icon_delete-trash_outlined"},{default:o(()=>[e(c(ht),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["content"])])]),_:1},8,["label"])]),_:1},8,["table-data","pagination","class"])])]),e(yt,{ref_key:"ticketEditor",ref:C,uuid:f.uuid,onSaved:g},null,8,["uuid"])],64)}}});const Pt=xt(Mt,[["__scopeId","data-v-9341d488"]]),ae=Object.freeze(Object.defineProperty({__proto__:null,default:Pt},Symbol.toStringTag,{value:"Module"}));export{Pt as S,St as a,ae as b,ne as s};

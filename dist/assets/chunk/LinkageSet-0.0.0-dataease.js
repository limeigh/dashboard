import{b as Oe,E as we,p as je,K as Qe,z as Ye,e as Be,t as et,C as tt,P as lt,Q as at,w as kt,l as wt,A as nt,y as it,s as It,R as xt,S as Vt,i as st,x as bt,f as Ct,r as St,n as At,o as Jt,M as ot,v as rt,g as Ft}from"./element-plus-secondary-0.0.0-dataease.js";import{i as zt,f as We,e as dt}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{o as u,c as V,a as o,d as Le,r as L,t as ut,l as Ke,e as Lt,T as m,k as _e,w as Pe,$ as Z,U as t,W as e,Y as r,u as a,V as M,_,X as oe,z as le,R as P,S as E,a8 as X,n as Ie,ae as Me,a0 as te}from"./@vue-0.0.0-dataease.js";import{i as fe}from"./field-list-0.0.0-dataease.js";import{a as re}from"./chart-list-0.0.0-dataease.js";import{d as ze}from"./dv-link-target-0.0.0-dataease.js";import{d as Tt}from"./dv-dashboard-spine-0.0.0-dataease.js";import{d as Dt}from"./dv-folder-0.0.0-dataease.js";import{i as Ue}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import{i as Xe}from"./icon_info_outlined-0.0.0-dataease.js";import{d as Et}from"./dv-screen-spine-0.0.0-dataease.js";import{E as $t,L as Nt,M as Ot,q as ct,N as Pt,l as Mt,m as Ut,f as jt,O as Bt}from"./canvasUtils-0.0.0-dataease.js";import{d as pt}from"./dvMain-0.0.0-dataease.js";import{f as K}from"./attr-0.0.0-dataease23.js";import{s as ft}from"./pinia-0.0.0-dataease.js";import{e as Wt,x as Kt}from"./dataVisualization-0.0.0-dataease.js";import{o as _t,M as qt}from"./dataset-0.0.0-dataease.js";import Rt from"./CodeMirror-0.0.0-dataease2.js";import{F as Zt}from"./@element-plus-0.0.0-dataease.js";import{s as mt}from"./snapshot-0.0.0-dataease.js";import{E as Ge}from"./EmptyBackground-0.0.0-dataease.js";import{f as Xt,a as Gt,g as Ht,u as Qt,p as Yt,l as el}from"./index-0.0.0-dataease.js";import{useAppStoreWithOut as tl}from"./app-0.0.0-dataease.js";import{g as ll}from"./util-0.0.0-dataease.js";import{t as al}from"./treeSortUtils-0.0.0-dataease.js";import{_ as qe}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import{d as He}from"./dv-empty-0.0.0-dataease.js";import{A as nl}from"./dataVisualization-0.0.0-dataease2.js";const il={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function sl(ae,N){return u(),V("svg",il,[...N[0]||(N[0]=[o("path",{d:"M0.666016 5.09541C0.666016 4.83398 0.818817 4.59668 1.05681 4.4885L7.72348 1.45819C7.89876 1.37852 8.09993 1.37852 8.27522 1.45819L14.9419 4.4885C15.1799 4.59668 15.3327 4.83398 15.3327 5.09541V11.5874C15.3327 11.84 15.19 12.0708 14.9642 12.1837L8.29749 15.5171C8.10981 15.6109 7.88889 15.6109 7.70121 15.5171L1.03454 12.1837C0.808684 12.0708 0.666016 11.84 0.666016 11.5874V5.09541ZM12.8112 4.98463L7.99935 2.79741L3.16148 4.99644L7.97266 7.06896L12.8112 4.98463ZM8.66602 8.22206V13.8421L13.9993 11.1754V5.92461L8.66602 8.22206ZM1.99935 5.94761V11.1754L7.33268 13.8421V8.24505L1.99935 5.94761Z",fill:"#3370FF"},null,-1)])])}const vt={render:sl},ol=Le({__name:"JumpSetOuterContentEditor",props:{linkJumpInfoArray:Array,linkJumpInfo:Object},setup(ae,{expose:N}){const U=L(null),w=L(null),q=ae,{linkJumpInfo:de}=ut(q),J=Ke({name2Auto:[],content:""}),d=L(null),D=F=>{w.value.dispatch({changes:{from:w.value.viewState.state.selection.ranges[0].from,insert:F},selection:{anchor:w.value.viewState.state.selection.ranges[0].from}})},x=(F,A,C,j)=>{if(!C)return C;let l=C;const c=q.linkJumpInfoArray.reduce((G,$)=>(G[$[F]]=$[A],G),{}),B=C.match(/\[(.+?)\]/g)||[];return B&&B.forEach(G=>{const $=G.slice(1,-1);j&&j.push(c[$]),l=l.replace(`[${$}]`,`[${c[$]}]`)}),l};return N({editorInit:F=>{J.name2Auto=[],w.value||(w.value=U.value.codeComInit()),J.content=x("sourceFieldId","sourceFieldName",F,J.name2Auto),w.value.dispatch({changes:{from:0,to:w.value.viewState.state.doc.length,insert:J.content}}),clearTimeout(d.value),d.value=setInterval(()=>{const A=w.value?w.value.state.doc.toString():"",C=x("sourceFieldName","sourceFieldId",A,J.name2Auto);de.value.content=C},1500)},insertFieldToCodeMirror:D}),Lt(()=>{var F,A;clearTimeout(d.value),w.value&&((A=(F=w.value).destroy)==null||A.call(F))}),(F,A)=>(u(),m(Rt,{quotaMap:q.linkJumpInfoArray.map(C=>C.sourceFieldName),ref_key:"myCm",ref:U,"dom-id":"jumpSetField",style:{height:"100%"}},null,8,["quotaMap"]))}}),rl={class:"top-area"},dl={class:"top-area-text"},ul={class:"top-area-value"},cl={class:"top-area-text margin-left"},pl={class:"top-area-value"},fl={class:"head-text"},_l={class:"head-filter"},ml={class:"custom-tree-node"},vl={class:"auth-span"},gl=["title"],hl={class:"tree-select-field"},yl={class:"title"},kl={class:"title"},wl={class:"title"},Il={class:"m-row"},xl={style:{flex:"1"}},Vl={class:"icon-center"},bl={style:{flex:"1"}},Cl={class:"label-content-details"},Sl=["title"],Al={class:"jump-com-list"},Jl={style:{flex:"1"}},Fl={class:"custom-option"},zl={style:{float:"left","margin-left":"4px","font-size":"14px"}},Ll={class:"icon-center"},Tl={style:{flex:"1"}},Dl={class:"custom-option"},El={style:{float:"left","margin-left":"4px","font-size":"14px"}},$l={style:{flex:"1",margin:"0 8px"}},Nl={class:"custom-option"},Ol={style:{float:"left","margin-left":"4px","font-size":"14px"}},Pl={key:0},Ml={key:1},Ul={style:{flex:"1"}},jl={class:"custom-option"},Bl={style:{float:"left","margin-left":"4px","font-size":"14px"}},Wl={class:"icon-center"},Kl={style:{flex:"1"}},ql={class:"custom-option"},Rl={style:{float:"left","margin-left":"4px","font-size":"14px"}},Zl={class:"url-text"},Xl={class:"outer-content-mirror"},Gl={class:"url-text"},Hl=["innerHTML"],Ql={class:"outer-content-right"},Yl=["title","onClick"],ea={key:1,class:"empty"},ta="_blank",la=Le({__name:"LinkJumpSet",setup(ae,{expose:N}){const U=pt(),{dvInfo:w,canvasViewInfo:q,componentData:de}=ft(U),J=L(null),{t:d}=We(),D=L(!1),x=mt(),R=tl(),F=Xt(),A=_e(()=>w.value.type==="dashboard"?d("work_branch.dashboard"):d("work_branch.big_data_screen")),C=d("visualization.select_target_resource"),j=d("visualization.target_dashboard_dataV"),l=Ke({curDataVWeight:0,activeCollapse:"view",loading:!1,showSelected:!1,curJumpViewInfo:{},curDatasetInfo:{},tempId:null,initState:!1,viewId:null,name2Auto:[],searchField:"",searchFunction:"",inputType:"self",fieldName:"name",tableRadio:null,keyWordSearch:"",columnLabel:d("visualization.belong_to_category"),templateList:[],importTemplateInfo:{snapshot:""},sourceViewFields:[],dvSelectProps:{label:"name",children:"children",value:"id",isLeaf:"leaf",disabled:"disabled"},treeProp:{id:"sourceFieldId",label:"sourceFieldName",children:"children"},linkJump:null,linkJumpInfoArray:[],linkJumpInfoXArray:[],linkJumpCurViewFieldArray:[],linkJumpCurFilterFieldArray:[],mapJumpInfoArray:{},panelList:[],linkJumpInfo:null,currentFiledTreeNode:null,defaultLinkJumpInfo:{linkType:"outer",jumpType:"_self",targetViewInfoList:[]},defaultTargetViewInfo:{targetViewId:null,targetFieldId:null},currentLinkPanelViewArray:[],viewIdFieldArrayMap:{},dimensionData:[],dimensionList:[],quotaList:[],quotaData:[],dimension:[],quota:[],currentOutParams:[]}),{wsCache:c}=Gt(),B=L(null),G=p=>{l.showSelected=!1,D.value=!0,l.initState=!1,ne(p)},$=p=>{p.forEach(s=>{s.component==="VQuery"&&s.propValue instanceof Array?s.propValue.forEach(i=>{i.checkedFields.includes(l.viewId)&&l.linkJumpCurFilterFieldArray.push({id:i.id,name:i.name,deType:"filter"})}):s.component==="Group"?$(s.propValue):s.component==="DeTabs"&&s.propValue.forEach(i=>{$(i.componentData)})})},ne=p=>{l.initState=!1,l.viewId=p.id,l.activeCollapse="view";const s=q.value[l.viewId];l.curJumpViewInfo=s;let i=JSON.stringify(s.xAxis)+JSON.stringify(s.xAxisExt)+JSON.stringify(s.drillFields),n;if(s.type.indexOf("stack")>-1&&s.extStack.length>2){const v=s.yAxis,y=v.length>0?JSON.stringify(v[0]):"[]";i=JSON.stringify(s.xAxis)+JSON.stringify(s.xAxisExt)+JSON.stringify(y)+JSON.stringify(s.yAxisExt)+JSON.stringify(s.drillFields),n=i}else s.type==="table-pivot"?n=i+JSON.stringify(s.yAxis)+JSON.stringify(s.yAxisExt):(s.type,n=i);Wt({busiFlag:"dashboard-dataV"}).then(v=>{var b;v&&((b=v[0])==null?void 0:b.id)==="0"?l.panelList=v[0].children:l.panelList=v,l.panelList=$t(l.panelList);const y=c.get(Ht(`TreeSort-${w.value.type}`))||"time_asc";l.panelList=al(l.panelList,y)}),l.linkJumpCurFilterFieldArray=[],$(de.value),s.tableId&&(_t(s.tableId).then(v=>{l.curDatasetInfo=v||{}}),qt(s.tableId).then(v=>{l.linkJumpCurViewFieldArray=[],v.data.forEach(b=>{i.indexOf(b.id)>-1&&l.linkJumpCurViewFieldArray.push(b)})}),Nt(w.value.id,l.viewId).then(v=>{l.linkJump=v.data,l.linkJumpInfoArray=[],l.linkJumpInfoXArray=[],l.linkJump.linkJumpInfoArray.forEach(b=>{n.indexOf(b.sourceFieldId)>-1?(l.mapJumpInfoArray[b.sourceFieldId]=b,l.linkJumpInfoArray.push(b),l.linkJumpInfoXArray.push(b)):i.indexOf(b.sourceFieldId)>-1&&l.linkJumpInfoArray.push(b)});const y=l.linkJumpInfoArray[0];l.initState=!0,Ie(()=>{J.value.setCurrentKey(y==null?void 0:y.sourceFieldId),ue(y)})}))},ie=()=>{let p=0;l.linkJump.linkJumpInfoArray.forEach(s=>{if(s.checked){let i=0;s.linkType==="inner"&&(s.targetDvId||(i++,p++),s.targetViewInfoList&&s.targetViewInfoList.forEach(function(n){n.sourceFieldActiveId&&n.targetFieldId&&n.targetViewId||(i++,p++)})),s.linkType==="outer"&&(s.content||(i++,p++)),i>0&&we.error(d("visualization.jump_null_tips",[s.sourceFieldName]))}}),!p&&(l.loading=!0,Ot(l.linkJump).then(()=>{x.recordSnapshotCache("updateJumpSet"),we.success(d("common.save_success")),ct(w.value.id).then(s=>{U.setNowPanelJumpInfo(s.data),ge()}),l.loading=!1}).catch(()=>{l.loading=!1}))},ue=p=>{l.linkJumpInfo=l.mapJumpInfoArray[p.sourceFieldId],l.linkJumpInfo.windowSize||(l.linkJumpInfo.windowSize="middle"),l.linkJumpInfo.linkType||(l.linkJumpInfo.linkType="outer"),l.linkJumpInfo.jumpType||(l.linkJumpInfo.jumpType="_blank"),l.linkJumpInfo.content||(l.linkJumpInfo.content="http://"),l.linkJumpInfo.attachParams||(l.linkJumpInfo.attachParams=!1),l.linkJumpInfo.targetDvId&&me(l.linkJumpInfo.targetDvId),xe(l.linkJumpInfo.content)},xe=p=>{Ie(()=>{var s;(s=B.value)==null||s.editorInit(p)})},me=p=>{Pt(p).then(s=>{l.viewIdFieldArrayMap={},l.currentLinkPanelViewArray=s.data.visualizationViewTables,l.currentLinkPanelViewArray&&l.currentLinkPanelViewArray.forEach(i=>{l.viewIdFieldArrayMap[i.id]=i.tableFields}),l.currentOutParams=s.data.outParamsJumpInfo||[],l.currentOutParams&&l.currentOutParams.length>0&&l.currentOutParams.forEach(i=>{l.currentLinkPanelViewArray.push(i),l.viewIdFieldArrayMap[i.id]=[{id:"1000001",name:d("visualization.out_params_no_select")}]}),JSON.parse(s.data.bashComponentData).forEach(i=>{i.component==="VQuery"&&i.propValue instanceof Array&&i.propValue.forEach(n=>{l.currentLinkPanelViewArray.push({id:n.id,type:"filter",name:n.name,title:n.name}),l.viewIdFieldArrayMap[n.id]=[{id:"1000001",name:d("visualization.filter_no_select")}]})})})},Ve=p=>{p.leaf&&(l.curDataVWeight=p.weight,l.linkJumpInfo.targetViewInfoList=[],ve(),me(p.id))},ve=(p="view")=>{l.linkJumpInfo.targetViewInfoList.push({targetId:ll(),targetViewId:"",targetType:p,targetFieldId:""})},be=p=>{if(p){let s;l.linkJumpInfo.targetViewInfoList.forEach((i,n)=>{p===i.targetId&&(s=n)}),s!==void 0&&l.linkJumpInfo.targetViewInfoList.splice(s,1)}},Te=p=>l.viewIdFieldArrayMap[p.targetViewId]&&l.viewIdFieldArrayMap[p.targetViewId].length===1&&l.viewIdFieldArrayMap[p.targetViewId][0].id==="1000001"||!p.sourceFieldActiveId,Ce=p=>{l.viewIdFieldArrayMap[p.targetViewId]&&l.viewIdFieldArrayMap[p.targetViewId].length===1&&l.viewIdFieldArrayMap[p.targetViewId][0].id==="1000001"?p.targetFieldId="1000001":p.targetFieldId=null},De=p=>{Ie(()=>{J.value.setCurrentKey(p.sourceFieldId),ue(p)})},ge=()=>{D.value=!1,l.initState=!1},he=p=>{B.value.insertFieldToCodeMirror(p)},ye=_e(()=>l.linkJumpInfo&&l.linkJumpInfo.linkType==="outer"&&D.value),Ee=(p,s)=>!p||s.checked,$e=_e(()=>R.getIsDataEaseBi||R.getIsIframe),Se=async p=>{if(l.curDataVWeight&&l.curDataVWeight<7){we.error(d("visualization.no_edit_auth"));return}let s;await Kt(p).then(g=>{s=g.data});const i=s==="dataV"?"#/dvCanvas?dvId=":"#/dashboard?resourceId=";if($e.value){F.clearState(),w.value.type==="dataV"?F.setDvId(p):F.setResourceId(p),Qt().emitter.emit("changeCurrentComponent",w.value.type==="dataV"?"VisualizationEditor":"DashboardEditor");return}const n=window.open(i+p,ta);Ae(n)},se=L(null),Ae=p=>{if(se!=null&&se.value){const s={methodName:"initOpenHandler",args:p};se.value.invokeMethod(s)}};return Pe(()=>l.showSelected,p=>{var s;(s=J.value)==null||s.filter(p)}),Pe(()=>ye.value,p=>{p&&xe(l.linkJumpInfo.content)}),N({dialogInit:G}),(p,s)=>{const i=dt,n=je,g=Qe,v=Ye,y=Be,b=et,S=tt,T=lt,H=at,ee=kt,Je=wt,Q=nt,Y=it,ce=It,Fe=xt,Ne=Vt,k=st,O=bt,ke=Ct,z=St,gt=At,ht=Jt,yt=ot,Re=rt;return Z((u(),m(yt,{ref:"enlargeDialog","append-to-body":!0,title:a(d)("visualization.jump_set"),modelValue:D.value,"onUpdate:modelValue":s[16]||(s[16]=I=>D.value=I),width:"70vw",top:"10vh",trigger:"click"},{default:t(()=>[l.initState?(u(),V("div",{key:0,onKeydown:s[14]||(s[14]=oe(()=>{},["stop"])),onKeyup:s[15]||(s[15]=oe(()=>{},["stop"])),style:{height:"550px"}},[e(n,{style:{"flex-direction":"row"}},{default:t(()=>[o("div",rl,[o("span",dl,r(a(d)("visualization.selected_view"))+"：",1),o("span",ul,[e(i,{"class-name":"view-type-icon"},{default:t(()=>[(u(),m(M(a(re)[l.curJumpViewInfo.type]),{class:"svg-icon view-type-icon"}))]),_:1}),_(" "+r(l.curJumpViewInfo.title),1)]),o("span",cl,r(a(d)("visualization.used_dataset"))+"：",1),o("span",pl,[e(i,{name:"dataset-outline"},{default:t(()=>[e(a(vt),{style:{"vertical-align":"-0.2em"},class:"svg-icon view-type-icon"})]),_:1}),_(" "+r(l.curDatasetInfo.name),1)])])]),_:1}),Z((u(),m(n,null,{default:t(()=>[e(n,{class:"preview"},{default:t(()=>[e(S,{span:8,style:{height:"100%","overflow-y":"auto"}},{default:t(()=>[e(n,{class:"tree-head"},{default:t(()=>[o("span",fl,r(a(d)("visualization.to_select_view")),1),o("span",_l,[_(r(a(d)("visualization.show_selected_only"))+" ",1),e(g,{size:"small",modelValue:l.showSelected,"onUpdate:modelValue":s[0]||(s[0]=I=>l.showSelected=I)},null,8,["modelValue"])])]),_:1}),e(b,{menu:"",ref_key:"linkJumpInfoTree",ref:J,"filter-node-method":Ee,data:l.linkJumpInfoXArray,"node-key":"sourceFieldId","highlight-current":"",props:l.treeProp,onNodeClick:ue},{default:t(({data:I})=>[o("span",ml,[o("span",null,[o("div",{onClick:s[1]||(s[1]=oe(()=>{},["stop"]))},[o("span",vl,[e(v,{modelValue:I.checked,"onUpdate:modelValue":W=>I.checked=W,onChange:W=>De(I)},null,8,["modelValue","onUpdate:modelValue","onChange"])])])]),o("span",{title:I.sourceFieldName},[o("span",hl,[e(y,{style:{"margin-right":"4px"}},{default:t(()=>[e(i,null,{default:t(()=>[(u(),m(M(a(fe)[a(K)[I.sourceDeType]]),{class:le(["svg-icon",`field-icon-${a(K)[I.sourceDeType]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),_(" "+r(I.sourceFieldName),1)])],8,gl)])]),_:1},8,["data","props"])]),_:1}),e(S,{span:16,class:"preview-show"},{default:t(()=>[e(ht,{class:"settings-container"},{default:t(()=>[e(Je,{class:"settings-header"},{default:t(()=>{var I;return[e(ee,{class:"radio-group-box"},{label:t(()=>[o("span",yl,r(a(d)("visualization.link_type")),1)]),default:t(()=>[l.linkJumpInfo?(u(),m(H,{key:0,class:"larger-radio",modelValue:l.linkJumpInfo.linkType,"onUpdate:modelValue":s[2]||(s[2]=W=>l.linkJumpInfo.linkType=W)},{default:t(()=>[e(T,{label:"outer"},{default:t(()=>[_(r(a(d)("visualization.link_outer")),1)]),_:1}),e(T,{label:"inner"},{default:t(()=>[_(r(a(d)("visualization.dashboard_dataV")),1)]),_:1})]),_:1},8,["modelValue"])):P("",!0),l.linkJumpInfo?P("",!0):(u(),m(H,{key:1,class:"larger-radio",disabled:""},{default:t(()=>[e(T,{label:"outer"},{default:t(()=>[_(r(a(d)("visualization.link_outer")),1)]),_:1}),e(T,{label:"inner"},{default:t(()=>[_(r(A.value),1)]),_:1})]),_:1}))]),_:1}),e(ee,{class:"radio-group-box"},{label:t(()=>[o("span",kl,r(a(d)("visualization.open_model")),1)]),default:t(()=>[l.linkJumpInfo?(u(),m(H,{key:0,class:"larger-radio",modelValue:l.linkJumpInfo.jumpType,"onUpdate:modelValue":s[3]||(s[3]=W=>l.linkJumpInfo.jumpType=W)},{default:t(()=>[e(T,{label:"_self"},{default:t(()=>[_(r(a(d)("visualization.now_window")),1)]),_:1}),e(T,{label:"_blank"},{default:t(()=>[_(r(a(d)("visualization.new_window")),1)]),_:1}),e(T,{label:"newPop"},{default:t(()=>[_(r(a(d)("visualization.pop_window")),1)]),_:1})]),_:1},8,["modelValue"])):P("",!0),l.linkJumpInfo?P("",!0):(u(),m(H,{key:1,class:"larger-radio",disabled:""},{default:t(()=>[e(T,{label:"_self"},{default:t(()=>[_(r(a(d)("visualization.now_window")),1)]),_:1}),e(T,{label:"_blank"},{default:t(()=>[_(r(a(d)("visualization.new_window")),1)]),_:1}),e(T,{label:"newPop"},{default:t(()=>[_(r(a(d)("visualization.pop_window")),1)]),_:1})]),_:1}))]),_:1}),((I=l.linkJumpInfo)==null?void 0:I.jumpType)==="newPop"?(u(),m(ee,{key:0,class:"radio-group-box"},{label:t(()=>[o("span",wl,r(a(d)("visualization.window_size")),1)]),default:t(()=>[e(H,{class:"larger-radio",modelValue:l.linkJumpInfo.windowSize,"onUpdate:modelValue":s[4]||(s[4]=W=>l.linkJumpInfo.windowSize=W)},{default:t(()=>[e(T,{label:"large"},{default:t(()=>[_(r(a(d)("visualization.window_size_large")),1)]),_:1}),e(T,{label:"middle"},{default:t(()=>[_(r(a(d)("visualization.window_size_middle")),1)]),_:1}),e(T,{label:"small"},{default:t(()=>[_(r(a(d)("visualization.window_size_small")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})):P("",!0)]}),_:1}),e(gt,{class:"settings-main"},{default:t(()=>[l.linkJumpInfo?(u(),V(E,{key:0},[l.linkJumpInfo.linkType==="inner"?(u(),m(O,{key:0,"label-position":"top",class:"main-form"},{default:t(()=>{var I,W,Ze;return[o("div",Il,[o("div",xl,[e(ee,null,{label:t(()=>[_(r(a(w).type==="dashboard"?a(d)("visualization.cur_dashboard"):a(d)("visualization.cur_screen")),1)]),default:t(()=>[e(Y,{style:{width:"100%"},modelValue:a(w).name,"onUpdate:modelValue":s[5]||(s[5]=h=>a(w).name=h),disabled:""},{default:t(()=>[(u(),m(Q,{key:a(w).name,label:a(w).name,value:a(w).name},null,8,["label","value"]))]),_:1},8,["modelValue"])]),_:1})]),o("div",Vl,[e(i,{name:"dv-link-target"},{default:t(()=>[e(a(ze),{style:{width:"20px",height:"20px"},class:"svg-icon"})]),_:1})]),o("div",bl,[e(ee,null,{label:t(()=>[_(r(a(j)),1)]),default:t(()=>[e(ce,{modelValue:l.linkJumpInfo.targetDvId,"onUpdate:modelValue":s[6]||(s[6]=h=>l.linkJumpInfo.targetDvId=h),data:l.panelList,props:l.dvSelectProps,"render-after-expand":!1,filterable:"",onNodeClick:Ve,class:"dv-selector"},{default:t(({node:h,data:pe})=>[o("div",Cl,[pe.leaf?(u(),m(y,{key:0,size:"18px",style:{display:"inline-block"}},{default:t(()=>[e(i,{name:"dv-dashboard-spine"},{default:t(()=>[pe.type==="dashboard"?(u(),m(a(Tt),{key:0,class:"svg-icon"})):(u(),m(a(Et),{key:1,class:"svg-icon"}))]),_:2},1024)]),_:2},1024)):(u(),m(y,{key:1,size:"18px",style:{display:"inline-block"}},{default:t(()=>[e(i,{name:"dv-folder"},{default:t(()=>[e(a(Dt),{class:"svg-icon"})]),_:1})]),_:1})),o("span",{style:{"margin-left":"8px","font-size":"14px"},title:h.label},r(h.label),9,Sl)])]),_:1},8,["modelValue","data","props"])]),_:1})])]),l.linkJumpInfo.targetDvId?(u(),V(E,{key:0},[o("div",Al,[e(Ne,{size:"small",modelValue:l.activeCollapse,"onUpdate:modelValue":s[7]||(s[7]=h=>l.activeCollapse=h)},{default:t(()=>[e(Fe,{label:a(d)("visualization.linkage_view"),name:"view"},null,8,["label"]),e(Fe,{label:a(d)("visualization.with_filter_params"),name:"filter"},null,8,["label"])]),_:1},8,["modelValue"])]),l.activeCollapse==="view"?(u(),V(E,{key:0},[e(n,{style:{"margin-bottom":"8px"},gutter:8},{default:t(()=>[e(S,{span:7},{default:t(()=>[_(r(a(d)("visualization.source_field")),1)]),_:1}),e(S,{span:2}),e(S,{span:7,style:{"margin-left":"-2.9%"}},{default:t(()=>[_(r(a(d)("visualization.link_view_field")),1)]),_:1}),e(S,{span:8})]),_:1}),o("div",{class:le(["main-scrollbar-container",{"main-scrollbar-container-min":((I=l.linkJumpInfo)==null?void 0:I.jumpType)==="newPop"}])},[e(a(Oe),{height:"fit-content","max-height":((W=l.linkJumpInfo)==null?void 0:W.jumpType)==="newPop"?"138px":"178px"},{default:t(()=>[(u(!0),V(E,null,X(l.linkJumpInfo.targetViewInfoList.filter(h=>h.targetType==="view"),(h,pe)=>(u(),V("div",{style:{display:"flex","margin-bottom":"6px"},key:pe},[o("div",Jl,[e(Y,{modelValue:h.sourceFieldActiveId,"onUpdate:modelValue":f=>h.sourceFieldActiveId=f,placeholder:a(d)("chart.pls_select_field"),style:{width:"100%"}},{default:t(()=>[(u(!0),V(E,null,X(l.linkJumpCurViewFieldArray,f=>(u(),m(Q,{key:f.id,label:f.name,value:f.id},{default:t(()=>[o("span",Fl,[e(i,null,{default:t(()=>[(u(),m(M(a(fe)[a(K)[f.deType]]),{class:le(["svg-icon",`field-icon-${a(K)[f.deType]}`]),style:{width:"14px",height:"14px"}},null,8,["class"]))]),_:2},1024),o("span",zl,r(f.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","placeholder"])]),o("div",Ll,[e(i,{name:"dv-link-target"},{default:t(()=>[e(a(ze),{style:{width:"20px",height:"20px"},class:"svg-icon"})]),_:1})]),o("div",Tl,[e(Y,{modelValue:h.targetViewId,"onUpdate:modelValue":f=>h.targetViewId=f,disabled:!h.sourceFieldActiveId,placeholder:a(d)("visualization.select_view"),style:{width:"100%"},onChange:f=>Ce(h)},{default:t(()=>[(u(!0),V(E,null,X(l.currentLinkPanelViewArray.filter(f=>f.type!=="outerParams"),f=>(u(),m(Q,{key:f.id,label:f.title,value:f.id},{default:t(()=>[o("span",Dl,[e(i,null,{default:t(()=>[(u(),m(M(a(re)[f.type]),{class:"svg-icon view-type-icon",style:{width:"14px",height:"14px"}}))]),_:2},1024),o("span",El,r(f.title),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","disabled","placeholder","onChange"])]),o("div",$l,[e(Y,{modelValue:h.targetFieldId,"onUpdate:modelValue":f=>h.targetFieldId=f,placeholder:a(d)("chart.pls_select_field"),disabled:Te(h),style:{width:"100%"}},{default:t(()=>[(u(!0),V(E,null,X(l.viewIdFieldArrayMap[h.targetViewId],f=>(u(),m(Q,{key:f.id,label:f.name,value:f.id},{default:t(()=>[o("span",Nl,[e(i,null,{default:t(()=>[(u(),m(M(a(fe)[a(K)[f.deType]]),{class:le(["svg-icon",`field-icon-${a(K)[f.deType]}`]),style:{width:"14px",height:"14px"}},null,8,["class"]))]),_:2},1024),o("span",Ol,r(f.name),1)])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","disabled"])]),e(k,{class:"m-del-icon-btn",text:"",onClick:f=>be(h.targetId)},{default:t(()=>[e(y,{size:"20px"},{default:t(()=>[e(i,{name:"icon_delete-trash_outlined"},{default:t(()=>[e(a(Ue),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["onClick"])]))),128))]),_:1},8,["max-height"]),e(k,{style:{"margin-top":"8px"},disabled:!l.linkJumpInfo.targetDvId,type:"primary",icon:"Plus",text:"",onClick:s[8]||(s[8]=h=>ve("view"))},{default:t(()=>[_(r(a(d)("visualization.add_jump_field")),1)]),_:1},8,["disabled"])],2)],64)):P("",!0),l.activeCollapse==="filter"?(u(),V(E,{key:1},[l.currentOutParams.length===0?(u(),V("span",Pl,[_(r(a(d)("visualization.link_target_tips1")),1),o("a",{class:"target_jump",onClick:s[9]||(s[9]=h=>Se(l.linkJumpInfo.targetDvId))},r(a(d)("visualization.link_target_tips2")),1)])):l.linkJumpCurFilterFieldArray.length===0?(u(),V("span",Ml,r(a(d)("visualization.jump_no_banding_tips")),1)):l.currentOutParams.length>0?(u(),V(E,{key:2},[e(n,{style:{"margin-bottom":"8px"},gutter:8},{default:t(()=>[e(S,{span:12},{default:t(()=>[_(r(a(d)("visualization.source_filter")),1)]),_:1}),e(S,{span:1}),e(S,{span:10,style:{"margin-left":"-2.9%"}},{default:t(()=>[_(r(a(d)("visualization.link_outer_params")),1)]),_:1})]),_:1}),o("div",{class:le(["main-scrollbar-container",{"main-scrollbar-container-min":((Ze=l.linkJumpInfo)==null?void 0:Ze.jumpType)==="newPop"}])},[e(a(Oe),{height:"fit-content","max-height":"178px"},{default:t(()=>[(u(!0),V(E,null,X(l.linkJumpInfo.targetViewInfoList.filter(h=>h.targetType==="outerParams"),(h,pe)=>(u(),V("div",{style:{display:"flex","margin-bottom":"6px"},key:pe},[o("div",Ul,[e(Y,{modelValue:h.sourceFieldActiveId,"onUpdate:modelValue":f=>h.sourceFieldActiveId=f,placeholder:a(d)("chart.pls_select_field"),style:{width:"100%"}},{default:t(()=>[(u(!0),V(E,null,X(l.linkJumpCurFilterFieldArray,f=>(u(),m(Q,{key:f.id,label:f.name,value:f.id},{default:t(()=>[o("span",jl,[e(i,null,{default:t(()=>[(u(),m(M(a(re).filter),{class:"svg-icon",style:{width:"14px",height:"14px"}}))]),_:1}),o("span",Bl,r(f.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","placeholder"])]),o("div",Wl,[e(i,{name:"dv-link-target"},{default:t(()=>[e(a(ze),{style:{width:"20px",height:"20px"},class:"svg-icon"})]),_:1})]),o("div",Kl,[e(Y,{modelValue:h.targetViewId,"onUpdate:modelValue":f=>h.targetViewId=f,disabled:!h.sourceFieldActiveId,placeholder:a(d)("visualization.select_param"),style:{width:"100%"},onChange:f=>Ce(h)},{default:t(()=>[(u(!0),V(E,null,X(l.currentOutParams,f=>(u(),m(Q,{key:f.id,label:f.title,value:f.id},{default:t(()=>[o("span",ql,[e(i,null,{default:t(()=>[(u(),m(M(a(re)[f.type]),{class:"svg-icon view-type-icon",style:{width:"14px",height:"14px"}}))]),_:2},1024),o("span",Rl,r(f.title),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","disabled","placeholder","onChange"])]),e(k,{class:"m-del-icon-btn",text:"",onClick:f=>be(h.targetId)},{default:t(()=>[e(y,{size:"20px"},{default:t(()=>[e(i,{name:"icon_delete-trash_outlined"},{default:t(()=>[e(a(Ue),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["onClick"])]))),128))]),_:1}),e(k,{style:{"margin-top":"8px"},disabled:!l.linkJumpInfo.targetDvId,type:"primary",icon:"Plus",text:"",onClick:s[10]||(s[10]=h=>ve("outerParams"))},{default:t(()=>[_(r(a(d)("visualization.add_jump_field")),1)]),_:1},8,["disabled"])],2)],64)):P("",!0)],64)):P("",!0)],64)):(u(),m(Ge,{key:1,style:{height:"auto"},description:a(C),"img-type":"noneWhite"},null,8,["description"]))]}),_:1})):P("",!0),ye.value?(u(),m(n,{key:1,gutter:8,class:"main-form"},{default:t(()=>[e(S,{span:16,style:{height:"100%"}},{default:t(()=>[o("div",Zl,[_(r(a(d)("visualization.target_url"))+" ",1),e(ke,{class:"item",effect:"dark",placement:"bottom"},{content:t(()=>[_(r(p.$t("visualization.target_url_tips")),1)]),default:t(()=>[e(y,{size:"16px",class:"hint-icon"},{default:t(()=>[e(i,{name:"icon_info_outlined"},{default:t(()=>[e(a(Xe),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),o("div",Xl,[e(ol,{ref_key:"outerContentEditor",ref:B,"link-jump-info":l.linkJumpInfo,"link-jump-info-array":l.linkJumpInfoArray},null,8,["link-jump-info","link-jump-info-array"])])]),_:1}),e(S,{span:8,style:{height:"100%"}},{default:t(()=>[o("div",Gl,[_(r(a(d)("visualization.select_world"))+" ",1),e(ke,{class:"item",effect:"dark",placement:"bottom"},{content:t(()=>[o("span",{innerHTML:p.$t("chart.reference_field_tip")},null,8,Hl)]),default:t(()=>[e(y,{size:"16px",class:"hint-icon"},{default:t(()=>[e(i,{name:"icon_info_outlined"},{default:t(()=>[e(a(Xe),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),o("div",Ql,[e(z,{modelValue:l.searchField,"onUpdate:modelValue":s[11]||(s[11]=I=>l.searchField=I),placeholder:a(d)("dataset.search"),"prefix-icon":a(Zt),clearable:""},null,8,["modelValue","placeholder","prefix-icon"]),e(a(Oe),{style:{"margin-top":"12px"},height:"250px"},{default:t(()=>[(u(!0),V(E,null,X(l.linkJumpInfoArray.filter(I=>!l.searchField||I.sourceFieldName.indexOf(l.searchField)>-1),I=>(u(),V("span",{key:I.sourceFieldId,class:"item-dimension",title:I.sourceFieldName,onClick:W=>he("["+I.sourceFieldName+"]")},[e(y,null,{default:t(()=>[e(i,null,{default:t(()=>[(u(),m(M(a(fe)[a(K)[I.sourceDeType]]),{class:le(["svg-icon",`field-icon-${a(K)[I.sourceDeType]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),_(" "+r(I.sourceFieldName),1)],8,Yl))),128))]),_:1})])]),_:1})]),_:1})):P("",!0)],64)):(u(),V("div",ea,[e(Ge,{description:a(d)("visualization.select_dimension_hint"),"img-type":"noneWhite"},null,8,["description"])]))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})),[[Re,l.loading]]),e(n,{class:"root-class"},{default:t(()=>[e(k,{size:"mini",onClick:s[12]||(s[12]=I=>ge())},{default:t(()=>[_(r(a(d)("common.cancel")),1)]),_:1}),e(k,{type:"primary",size:"mini",onClick:s[13]||(s[13]=I=>ie())},{default:t(()=>[_(r(a(d)("dataset.confirm")),1)]),_:1})]),_:1})],32)):P("",!0),e(a(zt),{ref_key:"openHandler",ref:se,jsname:"L2NvbXBvbmVudC9lbWJlZGRlZC1pZnJhbWUvT3BlbkhhbmRsZXI="},null,512)]),_:1},8,["title","modelValue"])),[[Re,l.loading]])}}});const cn=qe(la,[["__scopeId","data-v-0534612a"]]),aa={class:"option-set ed-dialog__title"},na={style:{"font-weight":"normal"}},ia={style:{"font-weight":"normal"}},sa=Le({__name:"LinkageSetOption",props:{title:Yt.string,baseWidth:{required:!1,type:String,default:"100%"},actionSelection:{required:!0,type:Object},themes:{type:String,default:"dark"}},setup(ae){const{t:N}=We(),U=ae,w=()=>{},{actionSelection:q}=ut(U);return(de,J)=>{const d=Me("Setting"),D=Be,x=je,R=lt,F=at,A=Ft;return u(),m(A,{placement:"right-start",width:"auto","popper-style":"max-width:"+ae.baseWidth,trigger:"click","show-arrow":!1},{reference:t(()=>[o("span",aa,[_(r(a(N)("visualization.linkage_setting"))+" ",1),e(D,{style:{margin:"5px 0 0 5px"}},{default:t(()=>[e(d)]),_:1})])]),default:t(()=>[e(x,null,{default:t(()=>[_(r(a(N)("visualization.select_linkage_tips")),1)]),_:1}),e(x,null,{default:t(()=>[e(F,{style:{"margin-top":"12px"},modelValue:a(q).linkageActive,"onUpdate:modelValue":J[0]||(J[0]=C=>a(q).linkageActive=C),onChange:w,class:"radio_group"},{default:t(()=>[e(R,{label:"custom"},{default:t(()=>[o("span",na,r(a(N)("visualization.linkage_option1")),1)]),_:1}),e(R,{label:"auto"},{default:t(()=>[o("span",ia,r(a(N)("visualization.linkage_option2")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["popper-style"])}}});const oa=qe(sa,[["__scopeId","data-v-b991b6e9"]]),ra={class:"top-area"},da={class:"top-area-text",style:{"margin-left":"0"}},ua={class:"top-area-value"},ca={class:"top-area-text"},pa={class:"top-area-value"},fa={class:"head-text"},_a={class:"head-filter"},ma={class:"custom-tree-node"},va={class:"auth-span"},ga={class:"tree-select-field"},ha={class:"custom-tree-node"},ya={class:"auth-span"},ka={class:"tree-select-field"},wa={style:{"margin-top":"8px","font-size":"14px"}},Ia={style:{display:"flex"},class:"inner-content"},xa={style:{flex:"1"}},Va={style:{flex:"1"}},ba={style:{width:"100%","max-height":"350px","overflow-y":"auto"}},Ca={style:{flex:"1"}},Sa={class:"select-filed"},Aa={class:"custom-option"},Ja={style:{float:"left","margin-left":"4px","font-size":"14px"}},Fa={style:{flex:"1"}},za={class:"select-filed"},La={class:"custom-option"},Ta={style:{float:"left","margin-left":"4px","font-size":"14px"}},Da={style:{"margin-top":"8px","font-size":"14px"}},Ea=Le({__name:"LinkageSet",setup(ae,{expose:N}){const U=pt(),{dvInfo:w,canvasViewInfo:q,componentData:de,curComponent:J}=ft(U),d=L(null),D=L(null),{t:x}=We(),R=L(!1),F=L(!1),A=L([]),C=L([]),j=L([]),l=mt(),c=Ke({sourceLinkageInfo:{},showSelected:!1,curLinkageViewInfo:{},curDatasetInfo:{},initState:!1,viewId:null,tableId:null,treeProp:{id:"targetViewId",label:"targetViewName",children:"children"},linkageInfo:null}),B=L(!1),G=L(!1),$=L(el(nl)),ne=L(!0),ie=L(!0),ue=()=>{const i=C.value.filter(n=>n.linkageActive).length;B.value=i===C.value.length,G.value=i>0&&i<C.value.length},xe=i=>{C.value.forEach(n=>{i?(n.linkageActive=!0,B.value=!0,Se(n)):(n.linkageActive=!1,B.value=!1)}),G.value=!1},me=_e(()=>C.value&&C.value.length>0),Ve=_e(()=>j.value&&j.value.length>0&&J.value.innerType!=="indicator"),ve=i=>{c.showSelected=!1,R.value=!0,c.initState=!1,Te(i)},be=i=>{const n=[];jt(de.value,n);const g={dvId:w.value.id,sourceViewId:i,targetViewIds:n,linkageInfo:null,resourceTable:"snapshot"};Bt(g).then(v=>{A.value=v.data||[],A.value.forEach(S=>{S.targetViewId===i&&(c.sourceLinkageInfo=S)}),A.value=A.value.filter(S=>S.targetViewId!==c.viewId),C.value=A.value.filter(S=>S.tableId===c.tableId),j.value=A.value.filter(S=>S.tableId!==c.tableId);let y,b;C.value&&C.value.length>0?(y=C.value[0],b="sameDs"):j.value&&j.value.length>0&&(y=j.value[0],b="diffDs"),c.initState=!0,Ie(()=>{y&&(b==="sameDs"?d.value:D.value).setCurrentKey(y.targetViewId),he(y),ue()})})},Te=i=>{c.initState=!1,c.viewId=i.id,A.value=[];const n=q.value[c.viewId];c.curLinkageViewInfo=n,n.tableId&&(c.tableId=n.tableId,_t(n.tableId).then(g=>{c.curDatasetInfo=g||{}})),$.value=J.value.actionSelection,be(c.viewId)},Ce=()=>{let i=0;if(A.value.forEach(g=>{let v=0;const y=g.linkageFields;if(y&&g.linkageActive&&y.forEach(function(b){b.sourceField&&b.targetField||(v++,i++)}),v>0){we.error("【"+g.targetViewName+"】-"+x("visualization.exit_un_march_linkage_field"));return}}),i)return;const n={dvId:w.value.id,sourceViewId:c.viewId,linkageInfo:A.value};F.value=!0,Mt(n).then(()=>{J.value.actionSelection.linkageActive=$.value.linkageActive,l.recordSnapshotCache("saveLinkageSetting"),we.success("保存成功"),Ut(w.value.id).then(g=>{U.setNowPanelTrackInfo(g.data)}),De(),ct(w.value.id).then(g=>{U.setNowPanelJumpInfo(g.data),p()}),F.value=!1}).catch(()=>{F.value=!1})},De=()=>{U.clearLinkageSettingInfo()},ge=(i,n)=>{n==="sameDs"?(d.value.setCurrentKey(i.targetViewId),D.value.setCurrentKey(null)):(d.value.setCurrentKey(null),D.value.setCurrentKey(i.targetViewId)),he(i)},he=i=>{c.linkageInfo=i},ye=(i,n,g)=>{const v={sourceField:n,targetField:g};i.linkageFields.push(v)},Ee=(i,n)=>{const g={sourceField:i,targetField:n};c.linkageInfo.linkageFields.push(g)},$e=i=>{c.linkageInfo.linkageFields.splice(i,1)},Se=async i=>{if(i.linkageActive){const n=q.value[i.targetViewId];if(n&&n.tableId&&i.linkageFields.length===0)if(c.curLinkageViewInfo.tableId===n.tableId){if(i.linkageFields&&i.linkageFields.length===0){const g=JSON.stringify(c.curLinkageViewInfo.xAxis)+JSON.stringify(c.curLinkageViewInfo.xAxisExt)+JSON.stringify(c.curLinkageViewInfo.extStack)+(c.curLinkageViewInfo.type.includes("chart-mix")?JSON.stringify(c.curLinkageViewInfo.extBubble):"")+(["indicator"].includes(c.curLinkageViewInfo.type)?JSON.stringify(c.curLinkageViewInfo.yAxis):""),v=JSON.stringify(n.xAxis)+JSON.stringify(n.xAxisExt)+JSON.stringify(c.curLinkageViewInfo.extStack)+(n.type.includes("chart-mix")?JSON.stringify(n.extBubble):"")+(["indicator"].includes(c.curLinkageViewInfo.type)?JSON.stringify(c.curLinkageViewInfo.yAxis):"");c.sourceLinkageInfo.targetViewFields.forEach(y=>{g.includes(y.id)&&v.includes(y.id)&&i.linkageFields&&ye(i,y.id,y.id)})}}else ye(i,"","")}},se=_e(()=>{if(c.sourceLinkageInfo.targetViewFields){const i=JSON.stringify(c.curLinkageViewInfo.xAxis)+JSON.stringify(c.curLinkageViewInfo.drillFields)+JSON.stringify(c.curLinkageViewInfo.xAxisExt)+JSON.stringify(c.curLinkageViewInfo.extStack)+(c.curLinkageViewInfo.type.includes("chart-mix")?JSON.stringify(c.curLinkageViewInfo.extBubble):"")+(["table-normal","indicator"].includes(c.curLinkageViewInfo.type)?JSON.stringify(c.curLinkageViewInfo.yAxis):"");return c.sourceLinkageInfo.targetViewFields.filter(n=>i.includes(n.id))}else return[]}),Ae=(i,n)=>{Ie(()=>{i==="sameDs"?(d.value.setCurrentKey(n.targetViewId),D.value.setCurrentKey(null)):(d.value.setCurrentKey(null),D.value.setCurrentKey(n.targetViewId)),he(n),Se(n),ue()})},p=()=>{R.value=!1,c.initState=!1},s=(i,n)=>!i||n.linkageActive;return Pe(()=>c.showSelected,i=>{var n,g;(n=d.value)==null||n.filter(i),(g=D.value)==null||g.filter(i)}),N({dialogInit:ve}),(i,n)=>{const g=dt,v=je,y=Qe,b=Me("CaretBottom"),S=Me("CaretRight"),T=Be,H=Ye,ee=et,Je=tt,Q=nt,Y=it,ce=st,Fe=ot,Ne=rt;return u(),m(Fe,{ref:"enlargeDialog","append-to-body":!0,modelValue:R.value,"onUpdate:modelValue":n[13]||(n[13]=k=>R.value=k),width:"70vw",top:"10vh",trigger:"click"},{default:t(()=>[a(J)&&a(J).actionSelection?(u(),m(oa,{key:0,"action-selection":$.value},null,8,["action-selection"])):P("",!0),c.initState?Z((u(),V("div",{key:1,onKeydown:n[11]||(n[11]=oe(()=>{},["stop"])),onKeyup:n[12]||(n[12]=oe(()=>{},["stop"])),style:{height:"550px","margin-top":"22px"}},[e(v,{style:{"flex-direction":"row"}},{default:t(()=>[o("div",ra,[o("span",da,r(a(x)("visualization.selected_view"))+"：",1),o("span",ua,[e(g,{"class-name":"view-type-icon"},{default:t(()=>[(u(),m(M(a(re)[c.curLinkageViewInfo.type]),{class:"svg-icon view-type-icon"}))]),_:1}),_(" "+r(c.curLinkageViewInfo.title),1)]),o("span",ca,r(a(x)("visualization.used_dataset"))+"：",1),o("span",pa,[e(g,{"class-name":"view-type-icon",name:"dataset-outline"},{default:t(()=>[e(a(vt),{style:{"vertical-align":"-0.2em"},class:"svg-icon view-type-icon"})]),_:1}),_(" "+r(c.curDatasetInfo.name),1)])])]),_:1}),e(v,null,{default:t(()=>[e(v,{class:"preview"},{default:t(()=>[e(Je,{span:8,style:{height:"100%","overflow-y":"auto"}},{default:t(()=>[e(v,{class:"tree-head"},{default:t(()=>[o("span",fa,r(a(x)("visualization.to_select_view")),1),o("span",_a,[_(r(a(x)("visualization.show_selected_only"))+" ",1),e(y,{size:"small",modelValue:c.showSelected,"onUpdate:modelValue":n[0]||(n[0]=k=>c.showSelected=k)},null,8,["modelValue"])])]),_:1}),Z(e(v,{class:"tree-dataset-head"},{default:t(()=>[o("span",null,[e(T,{class:"toggle-icon",onClick:n[1]||(n[1]=()=>ne.value=!ne.value)},{default:t(()=>[Z(e(b,null,null,512),[[te,ne.value]]),Z(e(S,null,null,512),[[te,!ne.value]])]),_:1}),o("span",null,r(a(x)("visualization.same_dataset")),1)]),e(H,{modelValue:B.value,"onUpdate:modelValue":n[2]||(n[2]=k=>B.value=k),indeterminate:G.value,onChange:xe},{default:t(()=>[_(r(a(x)("visualization.select_all")),1)]),_:1},8,["modelValue","indeterminate"])]),_:1},512),[[te,me.value]]),Z(e(ee,{class:"custom-tree",menu:"",ref_key:"linkageInfoTree",ref:d,"empty-text":a(x)("visualization.no_available_view"),"filter-node-method":s,data:C.value,"node-key":"targetViewId","highlight-current":"",props:c.treeProp,onNodeClick:n[4]||(n[4]=k=>ge(k,"sameDs"))},{default:t(({data:k})=>[o("span",ma,[o("span",null,[o("div",{onClick:n[3]||(n[3]=oe(()=>{},["stop"]))},[o("span",va,[e(H,{modelValue:k.linkageActive,"onUpdate:modelValue":O=>k.linkageActive=O,onChange:O=>Ae("sameDs",k)},null,8,["modelValue","onUpdate:modelValue","onChange"])])])]),o("span",null,[o("span",ga,[e(g,{"class-name":"view-type-icon"},{default:t(()=>[(u(),m(M(a(re)[k.targetViewType]),{style:{"margin-right":"4px"},class:"svg-icon view-type-icon"}))]),_:2},1024),_(" "+r(k.targetViewName),1)])])])]),_:1},8,["empty-text","data","props"]),[[te,ne.value&&me.value]]),Z(e(v,{class:"tree-dataset-head tree-dataset-head-top"},{default:t(()=>[o("span",null,[e(T,{class:"toggle-icon",onClick:n[5]||(n[5]=()=>ie.value=!ie.value)},{default:t(()=>[Z(e(b,null,null,512),[[te,ie.value]]),Z(e(S,null,null,512),[[te,!ie.value]])]),_:1}),o("span",null,r(a(x)("visualization.diff_dataset")),1)])]),_:1},512),[[te,Ve.value]]),Z(e(ee,{class:"custom-tree",menu:"",ref_key:"linkageInfoTreeDiffDs",ref:D,"empty-text":a(x)("visualization.no_available_view"),"filter-node-method":s,data:j.value,"node-key":"targetViewId","highlight-current":"",props:c.treeProp,onNodeClick:n[7]||(n[7]=k=>ge(k,"diffDs"))},{default:t(({data:k})=>[o("span",ha,[o("span",null,[o("div",{onClick:n[6]||(n[6]=oe(()=>{},["stop"]))},[o("span",ya,[e(H,{modelValue:k.linkageActive,"onUpdate:modelValue":O=>k.linkageActive=O,onChange:O=>Ae("diffDs",k)},null,8,["modelValue","onUpdate:modelValue","onChange"])])])]),o("span",null,[o("span",ka,[e(g,{name:k.targetViewType},{default:t(()=>[(u(),m(M(a(re)[k.targetViewType]),{class:"svg-icon view-type-icon",style:{"margin-right":"4px"}}))]),_:2},1032,["name"]),_(" "+r(k.targetViewName),1)])])])]),_:1},8,["empty-text","data","props"]),[[te,ie.value&&Ve.value]])]),_:1}),e(Je,{span:16,class:"preview-show"},{default:t(()=>{var k;return[e(v,{class:"content-head"},{default:t(()=>[_(r(a(x)("visualization.linkage_setting_tips1")),1)]),_:1}),c.linkageInfo&&c.linkageInfo.linkageActive&&((k=a(J))==null?void 0:k.innerType)==="indicator"?(u(),m(v,{key:0,style:{height:"100%"},class:"custom-position"},{default:t(()=>[e(g,{name:"dv-empty"},{default:t(()=>[e(a(He),{style:{width:"125px",height:"125px"},class:"svg-icon"})]),_:1}),o("span",wa,r(a(x)("visualization.indicator_linkage")),1)]),_:1})):c.linkageInfo&&c.linkageInfo.linkageActive?(u(),m(v,{key:1},{default:t(()=>[e(v,{style:{"margin-top":"5px"}},{default:t(()=>[o("div",Ia,[o("div",xa,r(a(x)("visualization.current_chart_source_field")),1),n[14]||(n[14]=o("div",{style:{width:"36px"}},null,-1)),o("div",Va,r(a(x)("visualization.link_view_field")),1),n[15]||(n[15]=o("div",{style:{width:"32px"}},null,-1))]),o("div",ba,[(u(!0),V(E,null,X(c.linkageInfo.linkageFields,(O,ke)=>(u(),V("div",{style:{display:"flex",padding:"0 16px 8px"},key:ke},[o("div",Ca,[o("div",Sa,[e(Y,{modelValue:O.sourceField,"onUpdate:modelValue":z=>O.sourceField=z,placeholder:a(x)("chart.pls_select_field"),style:{width:"100%"}},{default:t(()=>[(u(!0),V(E,null,X(se.value,z=>(u(),m(Q,{key:z.id,label:z.name,value:z.id},{default:t(()=>[o("span",Aa,[e(g,null,{default:t(()=>[(u(),m(M(a(fe)[a(K)[z.deType]]),{style:{width:"14px",height:"14px"},class:le([`field-icon-${a(K)[z.deType]}`,"svg-icon"])},null,8,["class"]))]),_:2},1024),o("span",Ja,r(z.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","placeholder"])])]),e(T,{class:"link-icon-join"},{default:t(()=>[e(g,{style:{width:"20px",height:"20px"},name:"dv-link-target"},{default:t(()=>[e(a(ze),{style:{width:"20px",height:"20px"},class:"svg-icon"})]),_:1})]),_:1}),o("div",Fa,[o("div",za,[e(Y,{modelValue:O.targetField,"onUpdate:modelValue":z=>O.targetField=z,placeholder:a(x)("common.selectText"),style:{width:"100%"}},{default:t(()=>[(u(!0),V(E,null,X(c.linkageInfo.targetViewFields,z=>(u(),m(Q,{key:z.id,label:z.name,value:z.id},{default:t(()=>[o("span",La,[e(g,null,{default:t(()=>[(u(),m(M(a(fe)[a(K)[z.deType]]),{style:{width:"14px",height:"14px"},class:le(["svg-icon",`field-icon-${a(K)[z.deType]}`])},null,8,["class"]))]),_:2},1024),o("span",Ta,r(z.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","placeholder"])])]),e(ce,{class:"m-del-icon-btn",text:"",onClick:z=>$e(ke)},{default:t(()=>[e(T,{size:"16px"},{default:t(()=>[e(g,{name:"icon_delete-trash_outlined"},{default:t(()=>[e(a(Ue),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["onClick"])]))),128))]),e(v,{style:{width:"100%","padding-left":"16px"}},{default:t(()=>[e(ce,{type:"primary",icon:"Plus",text:"",onClick:n[8]||(n[8]=O=>Ee("",""))},{default:t(()=>[_(r(a(x)("visualization.add_linkage_dependency_fields")),1)]),_:1})]),_:1})]),_:1})]),_:1})):(u(),m(v,{key:2,style:{height:"100%"},class:"custom-position"},{default:t(()=>[e(g,{name:"dv-empty"},{default:t(()=>[e(a(He),{style:{width:"125px",height:"125px"},class:"svg-icon"})]),_:1}),o("span",Da,r(a(x)("visualization.select_linkage_tips")),1)]),_:1}))]}),_:1})]),_:1})]),_:1}),e(v,{class:"root-class"},{default:t(()=>[e(ce,{size:"mini",onClick:n[9]||(n[9]=k=>p())},{default:t(()=>[_(r(a(x)("common.cancel")),1)]),_:1}),e(ce,{type:"primary",size:"mini",onClick:n[10]||(n[10]=k=>Ce())},{default:t(()=>[_(r(a(x)("dataset.confirm")),1)]),_:1})]),_:1})],32)),[[Ne,F.value]]):P("",!0)]),_:1},8,["modelValue"])}}});const pn=qe(Ea,[["__scopeId","data-v-18bb3c36"]]);export{cn as L,pn as a};

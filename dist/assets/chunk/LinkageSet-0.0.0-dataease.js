import{c as kt,b as wt,R as Oe,aQ as It,a as xt,z as Qe,p as bt}from"./index-0.0.0-dataease.js";import{E as Ye}from"./el-dialog-0.0.0-dataease.js";import{v as Vt,o as je,D as we,n as et,j as Be,y as tt,G as Ct,N as St}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./el-footer-0.0.0-dataease.js";import"./el-aside-0.0.0-dataease.js";import"./el-main-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import{E as At,a as Jt}from"./el-tabs-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import{a as lt,E as at}from"./el-select-0.0.0-dataease.js";import{E as it}from"./el-tree-0.0.0-dataease.js";import{E as nt}from"./el-checkbox-0.0.0-dataease.js";import{E as Ft}from"./el-tree-select-0.0.0-dataease.js";import{E as Lt,a as zt}from"./el-form-item-0.0.0-dataease.js";import"./el-radio-group-0.0.0-dataease.js";import"./el-radio-0.0.0-dataease.js";import{E as ot}from"./el-col-0.0.0-dataease.js";import{E as st}from"./el-switch-0.0.0-dataease.js";import{E as We}from"./el-row-0.0.0-dataease.js";import{f as u,O as b,P as s,d as ze,r as z,t as rt,X as qe,a as Tt,g as _,af as dt,y as me,w as Pe,R as Z,i as t,j as e,a4 as r,u as a,l as M,a3 as m,a8 as se,S as le,_ as P,W as D,a6 as X,n as Ie,e as Me,U as te}from"./vue-0.0.0-dataease.js";import{i as fe}from"./field-list-0.0.0-dataease.js";import{a as re}from"./chart-list-0.0.0-dataease.js";import{d as Le}from"./dv-link-target-0.0.0-dataease.js";import{d as Et}from"./dv-dashboard-spine-0.0.0-dataease.js";import{d as Dt}from"./dv-folder-0.0.0-dataease.js";import{i as Ue}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import{i as Xe}from"./icon_info_outlined-0.0.0-dataease.js";import{d as Nt}from"./dv-screen-spine-0.0.0-dataease.js";import{E as $t,L as Ot,M as Pt,q as ut,N as Mt,l as Ut,m as jt,f as Bt,O as Wt}from"./canvasUtils-0.0.0-dataease.js";import{d as ct}from"./dvMain-0.0.0-dataease.js";import{f as q}from"./attr-0.0.0-dataease23.js";import{e as qt,x as Kt}from"./dataVisualization-0.0.0-dataease.js";import{q as pt,N as Rt}from"./dataset-0.0.0-dataease.js";import Zt from"./CodeMirror-0.0.0-dataease.js";import{s as ft}from"./snapshot-0.0.0-dataease.js";import{E as Ge}from"./EmptyBackground-0.0.0-dataease.js";import{useAppStoreWithOut as Xt}from"./app-0.0.0-dataease.js";import{g as Gt}from"./util-0.0.0-dataease.js";import{t as Ht}from"./treeSortUtils-0.0.0-dataease.js";import{E as mt,a as _t}from"./index-0.0.0-dataease27.js";import{E as Qt,b as Yt,c as el}from"./index-0.0.0-dataease16.js";import{E as tl}from"./index-0.0.0-dataease4.js";import{_ as Ke}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import{d as He}from"./dv-empty-0.0.0-dataease.js";import{E as ll}from"./el-popover-0.0.0-dataease.js";import{A as al}from"./dataVisualization-0.0.0-dataease2.js";const il={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function nl(ae,$){return u(),b("svg",il,[...$[0]||($[0]=[s("path",{d:"M0.666016 5.09541C0.666016 4.83398 0.818817 4.59668 1.05681 4.4885L7.72348 1.45819C7.89876 1.37852 8.09993 1.37852 8.27522 1.45819L14.9419 4.4885C15.1799 4.59668 15.3327 4.83398 15.3327 5.09541V11.5874C15.3327 11.84 15.19 12.0708 14.9642 12.1837L8.29749 15.5171C8.10981 15.6109 7.88889 15.6109 7.70121 15.5171L1.03454 12.1837C0.808684 12.0708 0.666016 11.84 0.666016 11.5874V5.09541ZM12.8112 4.98463L7.99935 2.79741L3.16148 4.99644L7.97266 7.06896L12.8112 4.98463ZM8.66602 8.22206V13.8421L13.9993 11.1754V5.92461L8.66602 8.22206ZM1.99935 5.94761V11.1754L7.33268 13.8421V8.24505L1.99935 5.94761Z",fill:"#3370FF"},null,-1)])])}const vt={render:nl},ol=ze({__name:"JumpSetOuterContentEditor",props:{linkJumpInfoArray:Array,linkJumpInfo:Object},setup(ae,{expose:$}){const U=z(null),w=z(null),K=ae,{linkJumpInfo:de}=rt(K),J=qe({name2Auto:[],content:""}),d=z(null),E=F=>{w.value.dispatch({changes:{from:w.value.viewState.state.selection.ranges[0].from,insert:F},selection:{anchor:w.value.viewState.state.selection.ranges[0].from}})},x=(F,A,C,j)=>{if(!C)return C;let l=C;const c=K.linkJumpInfoArray.reduce((G,N)=>(G[N[F]]=N[A],G),{}),B=C.match(/\[(.+?)\]/g)||[];return B&&B.forEach(G=>{const N=G.slice(1,-1);j&&j.push(c[N]),l=l.replace(`[${N}]`,`[${c[N]}]`)}),l};return $({editorInit:F=>{J.name2Auto=[],w.value||(w.value=U.value.codeComInit()),J.content=x("sourceFieldId","sourceFieldName",F,J.name2Auto),w.value.dispatch({changes:{from:0,to:w.value.viewState.state.doc.length,insert:J.content}}),clearTimeout(d.value),d.value=setInterval(()=>{const A=w.value?w.value.state.doc.toString():"",C=x("sourceFieldName","sourceFieldId",A,J.name2Auto);de.value.content=C},1500)},insertFieldToCodeMirror:E}),Tt(()=>{var F,A;clearTimeout(d.value),w.value&&((A=(F=w.value).destroy)==null||A.call(F))}),(F,A)=>(u(),_(Zt,{quotaMap:K.linkJumpInfoArray.map(C=>C.sourceFieldName),ref_key:"myCm",ref:U,"dom-id":"jumpSetField",style:{height:"100%"}},null,8,["quotaMap"]))}}),sl={class:"top-area"},rl={class:"top-area-text"},dl={class:"top-area-value"},ul={class:"top-area-text margin-left"},cl={class:"top-area-value"},pl={class:"head-text"},fl={class:"head-filter"},ml={class:"custom-tree-node"},_l={class:"auth-span"},vl=["title"],gl={class:"tree-select-field"},hl={class:"title"},yl={class:"title"},kl={class:"title"},wl={class:"m-row"},Il={style:{flex:"1"}},xl={class:"icon-center"},bl={style:{flex:"1"}},Vl={class:"label-content-details"},Cl=["title"],Sl={class:"jump-com-list"},Al={style:{flex:"1"}},Jl={class:"custom-option"},Fl={style:{float:"left","margin-left":"4px","font-size":"14px"}},Ll={class:"icon-center"},zl={style:{flex:"1"}},Tl={class:"custom-option"},El={style:{float:"left","margin-left":"4px","font-size":"14px"}},Dl={style:{flex:"1",margin:"0 8px"}},Nl={class:"custom-option"},$l={style:{float:"left","margin-left":"4px","font-size":"14px"}},Ol={key:0},Pl={key:1},Ml={style:{flex:"1"}},Ul={class:"custom-option"},jl={style:{float:"left","margin-left":"4px","font-size":"14px"}},Bl={class:"icon-center"},Wl={style:{flex:"1"}},ql={class:"custom-option"},Kl={style:{float:"left","margin-left":"4px","font-size":"14px"}},Rl={class:"url-text"},Zl={class:"outer-content-mirror"},Xl={class:"url-text"},Gl=["innerHTML"],Hl={class:"outer-content-right"},Ql=["title","onClick"],Yl={key:1,class:"empty"},ea="_blank",ta=ze({__name:"LinkJumpSet",setup(ae,{expose:$}){const U=ct(),{dvInfo:w,canvasViewInfo:K,componentData:de}=dt(U),J=z(null),{t:d}=je(),E=z(!1),x=ft(),R=Xt(),F=kt(),A=me(()=>w.value.type==="dashboard"?d("work_branch.dashboard"):d("work_branch.big_data_screen")),C=d("visualization.select_target_resource"),j=d("visualization.target_dashboard_dataV"),l=qe({curDataVWeight:0,activeCollapse:"view",loading:!1,showSelected:!1,curJumpViewInfo:{},curDatasetInfo:{},tempId:null,initState:!1,viewId:null,name2Auto:[],searchField:"",searchFunction:"",inputType:"self",fieldName:"name",tableRadio:null,keyWordSearch:"",columnLabel:d("visualization.belong_to_category"),templateList:[],importTemplateInfo:{snapshot:""},sourceViewFields:[],dvSelectProps:{label:"name",children:"children",value:"id",isLeaf:"leaf",disabled:"disabled"},treeProp:{id:"sourceFieldId",label:"sourceFieldName",children:"children"},linkJump:null,linkJumpInfoArray:[],linkJumpInfoXArray:[],linkJumpCurViewFieldArray:[],linkJumpCurFilterFieldArray:[],mapJumpInfoArray:{},panelList:[],linkJumpInfo:null,currentFiledTreeNode:null,defaultLinkJumpInfo:{linkType:"outer",jumpType:"_self",targetViewInfoList:[]},defaultTargetViewInfo:{targetViewId:null,targetFieldId:null},currentLinkPanelViewArray:[],viewIdFieldArrayMap:{},dimensionData:[],dimensionList:[],quotaList:[],quotaData:[],dimension:[],quota:[],currentOutParams:[]}),{wsCache:c}=wt(),B=z(null),G=p=>{l.showSelected=!1,E.value=!0,l.initState=!1,ie(p)},N=p=>{p.forEach(o=>{o.component==="VQuery"&&o.propValue instanceof Array?o.propValue.forEach(n=>{n.checkedFields.includes(l.viewId)&&l.linkJumpCurFilterFieldArray.push({id:n.id,name:n.name,deType:"filter"})}):o.component==="Group"?N(o.propValue):o.component==="DeTabs"&&o.propValue.forEach(n=>{N(n.componentData)})})},ie=p=>{l.initState=!1,l.viewId=p.id,l.activeCollapse="view";const o=K.value[l.viewId];l.curJumpViewInfo=o;let n=JSON.stringify(o.xAxis)+JSON.stringify(o.xAxisExt)+JSON.stringify(o.drillFields),i;if(o.type.indexOf("stack")>-1&&o.extStack.length>2){const v=o.yAxis,y=v.length>0?JSON.stringify(v[0]):"[]";n=JSON.stringify(o.xAxis)+JSON.stringify(o.xAxisExt)+JSON.stringify(y)+JSON.stringify(o.yAxisExt)+JSON.stringify(o.drillFields),i=n}else o.type==="table-pivot"?i=n+JSON.stringify(o.yAxis)+JSON.stringify(o.yAxisExt):(o.type,i=n);qt({busiFlag:"dashboard-dataV"}).then(v=>{var V;v&&((V=v[0])==null?void 0:V.id)==="0"?l.panelList=v[0].children:l.panelList=v,l.panelList=$t(l.panelList);const y=c.get(`TreeSort-${w.value.type}`)||"time_asc";l.panelList=Ht(l.panelList,y)}),l.linkJumpCurFilterFieldArray=[],N(de.value),o.tableId&&(pt(o.tableId).then(v=>{l.curDatasetInfo=v||{}}),Rt(o.tableId).then(v=>{l.linkJumpCurViewFieldArray=[],v.data.forEach(V=>{n.indexOf(V.id)>-1&&l.linkJumpCurViewFieldArray.push(V)})}),Ot(w.value.id,l.viewId).then(v=>{l.linkJump=v.data,l.linkJumpInfoArray=[],l.linkJumpInfoXArray=[],l.linkJump.linkJumpInfoArray.forEach(V=>{i.indexOf(V.sourceFieldId)>-1?(l.mapJumpInfoArray[V.sourceFieldId]=V,l.linkJumpInfoArray.push(V),l.linkJumpInfoXArray.push(V)):n.indexOf(V.sourceFieldId)>-1&&l.linkJumpInfoArray.push(V)});const y=l.linkJumpInfoArray[0];l.initState=!0,Ie(()=>{J.value.setCurrentKey(y==null?void 0:y.sourceFieldId),ue(y)})}))},ne=()=>{let p=0;l.linkJump.linkJumpInfoArray.forEach(o=>{if(o.checked){let n=0;o.linkType==="inner"&&(o.targetDvId||(n++,p++),o.targetViewInfoList&&o.targetViewInfoList.forEach(function(i){i.sourceFieldActiveId&&i.targetFieldId&&i.targetViewId||(n++,p++)})),o.linkType==="outer"&&(o.content||(n++,p++)),n>0&&we.error(d("visualization.jump_null_tips",[o.sourceFieldName]))}}),!p&&(l.loading=!0,Pt(l.linkJump).then(()=>{x.recordSnapshotCache("updateJumpSet"),we.success(d("common.save_success")),ut(w.value.id).then(o=>{U.setNowPanelJumpInfo(o.data),ge()}),l.loading=!1}).catch(()=>{l.loading=!1}))},ue=p=>{l.linkJumpInfo=l.mapJumpInfoArray[p.sourceFieldId],l.linkJumpInfo.windowSize||(l.linkJumpInfo.windowSize="middle"),l.linkJumpInfo.linkType||(l.linkJumpInfo.linkType="outer"),l.linkJumpInfo.jumpType||(l.linkJumpInfo.jumpType="_blank"),l.linkJumpInfo.content||(l.linkJumpInfo.content="http://"),l.linkJumpInfo.attachParams||(l.linkJumpInfo.attachParams=!1),l.linkJumpInfo.targetDvId&&_e(l.linkJumpInfo.targetDvId),xe(l.linkJumpInfo.content)},xe=p=>{Ie(()=>{var o;(o=B.value)==null||o.editorInit(p)})},_e=p=>{Mt(p).then(o=>{l.viewIdFieldArrayMap={},l.currentLinkPanelViewArray=o.data.visualizationViewTables,l.currentLinkPanelViewArray&&l.currentLinkPanelViewArray.forEach(n=>{l.viewIdFieldArrayMap[n.id]=n.tableFields}),l.currentOutParams=o.data.outParamsJumpInfo||[],l.currentOutParams&&l.currentOutParams.length>0&&l.currentOutParams.forEach(n=>{l.currentLinkPanelViewArray.push(n),l.viewIdFieldArrayMap[n.id]=[{id:"1000001",name:d("visualization.out_params_no_select")}]}),JSON.parse(o.data.bashComponentData).forEach(n=>{n.component==="VQuery"&&n.propValue instanceof Array&&n.propValue.forEach(i=>{l.currentLinkPanelViewArray.push({id:i.id,type:"filter",name:i.name,title:i.name}),l.viewIdFieldArrayMap[i.id]=[{id:"1000001",name:d("visualization.filter_no_select")}]})})})},be=p=>{p.leaf&&(l.curDataVWeight=p.weight,l.linkJumpInfo.targetViewInfoList=[],ve(),_e(p.id))},ve=(p="view")=>{l.linkJumpInfo.targetViewInfoList.push({targetId:Gt(),targetViewId:"",targetType:p,targetFieldId:""})},Ve=p=>{if(p){let o;l.linkJumpInfo.targetViewInfoList.forEach((n,i)=>{p===n.targetId&&(o=i)}),o!==void 0&&l.linkJumpInfo.targetViewInfoList.splice(o,1)}},Te=p=>l.viewIdFieldArrayMap[p.targetViewId]&&l.viewIdFieldArrayMap[p.targetViewId].length===1&&l.viewIdFieldArrayMap[p.targetViewId][0].id==="1000001"||!p.sourceFieldActiveId,Ce=p=>{l.viewIdFieldArrayMap[p.targetViewId]&&l.viewIdFieldArrayMap[p.targetViewId].length===1&&l.viewIdFieldArrayMap[p.targetViewId][0].id==="1000001"?p.targetFieldId="1000001":p.targetFieldId=null},Ee=p=>{Ie(()=>{J.value.setCurrentKey(p.sourceFieldId),ue(p)})},ge=()=>{E.value=!1,l.initState=!1},he=p=>{B.value.insertFieldToCodeMirror(p)},ye=me(()=>l.linkJumpInfo&&l.linkJumpInfo.linkType==="outer"&&E.value),De=(p,o)=>!p||o.checked,Ne=me(()=>R.getIsDataEaseBi||R.getIsIframe),Se=async p=>{if(l.curDataVWeight&&l.curDataVWeight<7){we.error(d("visualization.no_edit_auth"));return}let o;await Kt(p).then(g=>{o=g.data});const n=o==="dataV"?"#/dvCanvas?dvId=":"#/dashboard?resourceId=";if(Ne.value){F.clearState(),w.value.type==="dataV"?F.setDvId(p):F.setResourceId(p),xt().emitter.emit("changeCurrentComponent",w.value.type==="dataV"?"VisualizationEditor":"DashboardEditor");return}const i=window.open(n+p,ea);Ae(i)},oe=z(null),Ae=p=>{if(oe!=null&&oe.value){const o={methodName:"initOpenHandler",args:p};oe.value.invokeMethod(o)}};return Pe(()=>l.showSelected,p=>{var o;(o=J.value)==null||o.filter(p)}),Pe(()=>ye.value,p=>{p&&xe(l.linkJumpInfo.content)}),$({dialogInit:G}),(p,o)=>{const n=et,i=We,g=st,v=nt,y=Be,V=it,S=ot,T=mt,H=_t,ee=Lt,Je=Qt,Q=lt,Y=at,ce=Ft,Fe=At,$e=Jt,k=tt,O=zt,ke=tl,L=Ct,gt=Yt,ht=el,yt=Ye,Re=Qe;return Z((u(),_(yt,{ref:"enlargeDialog","append-to-body":!0,title:a(d)("visualization.jump_set"),modelValue:E.value,"onUpdate:modelValue":o[16]||(o[16]=I=>E.value=I),width:"70vw",top:"10vh",trigger:"click"},{default:t(()=>[l.initState?(u(),b("div",{key:0,onKeydown:o[14]||(o[14]=se(()=>{},["stop"])),onKeyup:o[15]||(o[15]=se(()=>{},["stop"])),style:{height:"550px"}},[e(i,{style:{"flex-direction":"row"}},{default:t(()=>[s("div",sl,[s("span",rl,r(a(d)("visualization.selected_view"))+"：",1),s("span",dl,[e(n,{"class-name":"view-type-icon"},{default:t(()=>[(u(),_(M(a(re)[l.curJumpViewInfo.type]),{class:"svg-icon view-type-icon"}))]),_:1}),m(" "+r(l.curJumpViewInfo.title),1)]),s("span",ul,r(a(d)("visualization.used_dataset"))+"：",1),s("span",cl,[e(n,{name:"dataset-outline"},{default:t(()=>[e(a(vt),{style:{"vertical-align":"-0.2em"},class:"svg-icon view-type-icon"})]),_:1}),m(" "+r(l.curDatasetInfo.name),1)])])]),_:1}),Z((u(),_(i,null,{default:t(()=>[e(i,{class:"preview"},{default:t(()=>[e(S,{span:8,style:{height:"100%","overflow-y":"auto"}},{default:t(()=>[e(i,{class:"tree-head"},{default:t(()=>[s("span",pl,r(a(d)("visualization.to_select_view")),1),s("span",fl,[m(r(a(d)("visualization.show_selected_only"))+" ",1),e(g,{size:"small",modelValue:l.showSelected,"onUpdate:modelValue":o[0]||(o[0]=I=>l.showSelected=I)},null,8,["modelValue"])])]),_:1}),e(V,{menu:"",ref_key:"linkJumpInfoTree",ref:J,"filter-node-method":De,data:l.linkJumpInfoXArray,"node-key":"sourceFieldId","highlight-current":"",props:l.treeProp,onNodeClick:ue},{default:t(({data:I})=>[s("span",ml,[s("span",null,[s("div",{onClick:o[1]||(o[1]=se(()=>{},["stop"]))},[s("span",_l,[e(v,{modelValue:I.checked,"onUpdate:modelValue":W=>I.checked=W,onChange:W=>Ee(I)},null,8,["modelValue","onUpdate:modelValue","onChange"])])])]),s("span",{title:I.sourceFieldName},[s("span",gl,[e(y,{style:{"margin-right":"4px"}},{default:t(()=>[e(n,null,{default:t(()=>[(u(),_(M(a(fe)[a(q)[I.sourceDeType]]),{class:le(["svg-icon",`field-icon-${a(q)[I.sourceDeType]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),m(" "+r(I.sourceFieldName),1)])],8,vl)])]),_:1},8,["data","props"])]),_:1}),e(S,{span:16,class:"preview-show"},{default:t(()=>[e(ht,{class:"settings-container"},{default:t(()=>[e(Je,{class:"settings-header"},{default:t(()=>{var I;return[e(ee,{class:"radio-group-box"},{label:t(()=>[s("span",hl,r(a(d)("visualization.link_type")),1)]),default:t(()=>[l.linkJumpInfo?(u(),_(H,{key:0,class:"larger-radio",modelValue:l.linkJumpInfo.linkType,"onUpdate:modelValue":o[2]||(o[2]=W=>l.linkJumpInfo.linkType=W)},{default:t(()=>[e(T,{label:"outer"},{default:t(()=>[m(r(a(d)("visualization.link_outer")),1)]),_:1}),e(T,{label:"inner"},{default:t(()=>[m(r(a(d)("visualization.dashboard_dataV")),1)]),_:1})]),_:1},8,["modelValue"])):P("",!0),l.linkJumpInfo?P("",!0):(u(),_(H,{key:1,class:"larger-radio",disabled:""},{default:t(()=>[e(T,{label:"outer"},{default:t(()=>[m(r(a(d)("visualization.link_outer")),1)]),_:1}),e(T,{label:"inner"},{default:t(()=>[m(r(A.value),1)]),_:1})]),_:1}))]),_:1}),e(ee,{class:"radio-group-box"},{label:t(()=>[s("span",yl,r(a(d)("visualization.open_model")),1)]),default:t(()=>[l.linkJumpInfo?(u(),_(H,{key:0,class:"larger-radio",modelValue:l.linkJumpInfo.jumpType,"onUpdate:modelValue":o[3]||(o[3]=W=>l.linkJumpInfo.jumpType=W)},{default:t(()=>[e(T,{label:"_self"},{default:t(()=>[m(r(a(d)("visualization.now_window")),1)]),_:1}),e(T,{label:"_blank"},{default:t(()=>[m(r(a(d)("visualization.new_window")),1)]),_:1}),e(T,{label:"newPop"},{default:t(()=>[m(r(a(d)("visualization.pop_window")),1)]),_:1})]),_:1},8,["modelValue"])):P("",!0),l.linkJumpInfo?P("",!0):(u(),_(H,{key:1,class:"larger-radio",disabled:""},{default:t(()=>[e(T,{label:"_self"},{default:t(()=>[m(r(a(d)("visualization.now_window")),1)]),_:1}),e(T,{label:"_blank"},{default:t(()=>[m(r(a(d)("visualization.new_window")),1)]),_:1}),e(T,{label:"newPop"},{default:t(()=>[m(r(a(d)("visualization.pop_window")),1)]),_:1})]),_:1}))]),_:1}),((I=l.linkJumpInfo)==null?void 0:I.jumpType)==="newPop"?(u(),_(ee,{key:0,class:"radio-group-box"},{label:t(()=>[s("span",kl,r(a(d)("visualization.window_size")),1)]),default:t(()=>[e(H,{class:"larger-radio",modelValue:l.linkJumpInfo.windowSize,"onUpdate:modelValue":o[4]||(o[4]=W=>l.linkJumpInfo.windowSize=W)},{default:t(()=>[e(T,{label:"large"},{default:t(()=>[m(r(a(d)("visualization.window_size_large")),1)]),_:1}),e(T,{label:"middle"},{default:t(()=>[m(r(a(d)("visualization.window_size_middle")),1)]),_:1}),e(T,{label:"small"},{default:t(()=>[m(r(a(d)("visualization.window_size_small")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})):P("",!0)]}),_:1}),e(gt,{class:"settings-main"},{default:t(()=>[l.linkJumpInfo?(u(),b(D,{key:0},[l.linkJumpInfo.linkType==="inner"?(u(),_(O,{key:0,"label-position":"top",class:"main-form"},{default:t(()=>{var I,W,Ze;return[s("div",wl,[s("div",Il,[e(ee,null,{label:t(()=>[m(r(a(w).type==="dashboard"?a(d)("visualization.cur_dashboard"):a(d)("visualization.cur_screen")),1)]),default:t(()=>[e(Y,{style:{width:"100%"},modelValue:a(w).name,"onUpdate:modelValue":o[5]||(o[5]=h=>a(w).name=h),disabled:""},{default:t(()=>[(u(),_(Q,{key:a(w).name,label:a(w).name,value:a(w).name},null,8,["label","value"]))]),_:1},8,["modelValue"])]),_:1})]),s("div",xl,[e(n,{name:"dv-link-target"},{default:t(()=>[e(a(Le),{style:{width:"20px",height:"20px"},class:"svg-icon"})]),_:1})]),s("div",bl,[e(ee,null,{label:t(()=>[m(r(a(j)),1)]),default:t(()=>[e(ce,{modelValue:l.linkJumpInfo.targetDvId,"onUpdate:modelValue":o[6]||(o[6]=h=>l.linkJumpInfo.targetDvId=h),data:l.panelList,props:l.dvSelectProps,"render-after-expand":!1,filterable:"",onNodeClick:be,class:"dv-selector"},{default:t(({node:h,data:pe})=>[s("div",Vl,[pe.leaf?(u(),_(y,{key:0,size:"18px",style:{display:"inline-block"}},{default:t(()=>[e(n,{name:"dv-dashboard-spine"},{default:t(()=>[pe.type==="dashboard"?(u(),_(a(Et),{key:0,class:"svg-icon"})):(u(),_(a(Nt),{key:1,class:"svg-icon"}))]),_:2},1024)]),_:2},1024)):(u(),_(y,{key:1,size:"18px",style:{display:"inline-block"}},{default:t(()=>[e(n,{name:"dv-folder"},{default:t(()=>[e(a(Dt),{class:"svg-icon"})]),_:1})]),_:1})),s("span",{style:{"margin-left":"8px","font-size":"14px"},title:h.label},r(h.label),9,Cl)])]),_:1},8,["modelValue","data","props"])]),_:1})])]),l.linkJumpInfo.targetDvId?(u(),b(D,{key:0},[s("div",Sl,[e($e,{size:"small",modelValue:l.activeCollapse,"onUpdate:modelValue":o[7]||(o[7]=h=>l.activeCollapse=h)},{default:t(()=>[e(Fe,{label:a(d)("visualization.linkage_view"),name:"view"},null,8,["label"]),e(Fe,{label:a(d)("visualization.with_filter_params"),name:"filter"},null,8,["label"])]),_:1},8,["modelValue"])]),l.activeCollapse==="view"?(u(),b(D,{key:0},[e(i,{style:{"margin-bottom":"8px"},gutter:8},{default:t(()=>[e(S,{span:7},{default:t(()=>[m(r(a(d)("visualization.source_field")),1)]),_:1}),e(S,{span:2}),e(S,{span:7,style:{"margin-left":"-2.9%"}},{default:t(()=>[m(r(a(d)("visualization.link_view_field")),1)]),_:1}),e(S,{span:8})]),_:1}),s("div",{class:le(["main-scrollbar-container",{"main-scrollbar-container-min":((I=l.linkJumpInfo)==null?void 0:I.jumpType)==="newPop"}])},[e(a(Oe),{height:"fit-content","max-height":((W=l.linkJumpInfo)==null?void 0:W.jumpType)==="newPop"?"138px":"178px"},{default:t(()=>[(u(!0),b(D,null,X(l.linkJumpInfo.targetViewInfoList.filter(h=>h.targetType==="view"),(h,pe)=>(u(),b("div",{style:{display:"flex","margin-bottom":"6px"},key:pe},[s("div",Al,[e(Y,{modelValue:h.sourceFieldActiveId,"onUpdate:modelValue":f=>h.sourceFieldActiveId=f,placeholder:a(d)("chart.pls_select_field"),style:{width:"100%"}},{default:t(()=>[(u(!0),b(D,null,X(l.linkJumpCurViewFieldArray,f=>(u(),_(Q,{key:f.id,label:f.name,value:f.id},{default:t(()=>[s("span",Jl,[e(n,null,{default:t(()=>[(u(),_(M(a(fe)[a(q)[f.deType]]),{class:le(["svg-icon",`field-icon-${a(q)[f.deType]}`]),style:{width:"14px",height:"14px"}},null,8,["class"]))]),_:2},1024),s("span",Fl,r(f.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","placeholder"])]),s("div",Ll,[e(n,{name:"dv-link-target"},{default:t(()=>[e(a(Le),{style:{width:"20px",height:"20px"},class:"svg-icon"})]),_:1})]),s("div",zl,[e(Y,{modelValue:h.targetViewId,"onUpdate:modelValue":f=>h.targetViewId=f,disabled:!h.sourceFieldActiveId,placeholder:a(d)("visualization.select_view"),style:{width:"100%"},onChange:f=>Ce(h)},{default:t(()=>[(u(!0),b(D,null,X(l.currentLinkPanelViewArray.filter(f=>f.type!=="outerParams"),f=>(u(),_(Q,{key:f.id,label:f.title,value:f.id},{default:t(()=>[s("span",Tl,[e(n,null,{default:t(()=>[(u(),_(M(a(re)[f.type]),{class:"svg-icon view-type-icon",style:{width:"14px",height:"14px"}}))]),_:2},1024),s("span",El,r(f.title),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","disabled","placeholder","onChange"])]),s("div",Dl,[e(Y,{modelValue:h.targetFieldId,"onUpdate:modelValue":f=>h.targetFieldId=f,placeholder:a(d)("chart.pls_select_field"),disabled:Te(h),style:{width:"100%"}},{default:t(()=>[(u(!0),b(D,null,X(l.viewIdFieldArrayMap[h.targetViewId],f=>(u(),_(Q,{key:f.id,label:f.name,value:f.id},{default:t(()=>[s("span",Nl,[e(n,null,{default:t(()=>[(u(),_(M(a(fe)[a(q)[f.deType]]),{class:le(["svg-icon",`field-icon-${a(q)[f.deType]}`]),style:{width:"14px",height:"14px"}},null,8,["class"]))]),_:2},1024),s("span",$l,r(f.name),1)])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","disabled"])]),e(k,{class:"m-del-icon-btn",text:"",onClick:f=>Ve(h.targetId)},{default:t(()=>[e(y,{size:"20px"},{default:t(()=>[e(n,{name:"icon_delete-trash_outlined"},{default:t(()=>[e(a(Ue),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["onClick"])]))),128))]),_:1},8,["max-height"]),e(k,{style:{"margin-top":"8px"},disabled:!l.linkJumpInfo.targetDvId,type:"primary",icon:"Plus",text:"",onClick:o[8]||(o[8]=h=>ve("view"))},{default:t(()=>[m(r(a(d)("visualization.add_jump_field")),1)]),_:1},8,["disabled"])],2)],64)):P("",!0),l.activeCollapse==="filter"?(u(),b(D,{key:1},[l.currentOutParams.length===0?(u(),b("span",Ol,[m(r(a(d)("visualization.link_target_tips1")),1),s("a",{class:"target_jump",onClick:o[9]||(o[9]=h=>Se(l.linkJumpInfo.targetDvId))},r(a(d)("visualization.link_target_tips2")),1)])):l.linkJumpCurFilterFieldArray.length===0?(u(),b("span",Pl,r(a(d)("visualization.jump_no_banding_tips")),1)):l.currentOutParams.length>0?(u(),b(D,{key:2},[e(i,{style:{"margin-bottom":"8px"},gutter:8},{default:t(()=>[e(S,{span:12},{default:t(()=>[m(r(a(d)("visualization.source_filter")),1)]),_:1}),e(S,{span:1}),e(S,{span:10,style:{"margin-left":"-2.9%"}},{default:t(()=>[m(r(a(d)("visualization.link_outer_params")),1)]),_:1})]),_:1}),s("div",{class:le(["main-scrollbar-container",{"main-scrollbar-container-min":((Ze=l.linkJumpInfo)==null?void 0:Ze.jumpType)==="newPop"}])},[e(a(Oe),{height:"fit-content","max-height":"178px"},{default:t(()=>[(u(!0),b(D,null,X(l.linkJumpInfo.targetViewInfoList.filter(h=>h.targetType==="outerParams"),(h,pe)=>(u(),b("div",{style:{display:"flex","margin-bottom":"6px"},key:pe},[s("div",Ml,[e(Y,{modelValue:h.sourceFieldActiveId,"onUpdate:modelValue":f=>h.sourceFieldActiveId=f,placeholder:a(d)("chart.pls_select_field"),style:{width:"100%"}},{default:t(()=>[(u(!0),b(D,null,X(l.linkJumpCurFilterFieldArray,f=>(u(),_(Q,{key:f.id,label:f.name,value:f.id},{default:t(()=>[s("span",Ul,[e(n,null,{default:t(()=>[(u(),_(M(a(re).filter),{class:"svg-icon",style:{width:"14px",height:"14px"}}))]),_:1}),s("span",jl,r(f.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","placeholder"])]),s("div",Bl,[e(n,{name:"dv-link-target"},{default:t(()=>[e(a(Le),{style:{width:"20px",height:"20px"},class:"svg-icon"})]),_:1})]),s("div",Wl,[e(Y,{modelValue:h.targetViewId,"onUpdate:modelValue":f=>h.targetViewId=f,disabled:!h.sourceFieldActiveId,placeholder:a(d)("visualization.select_param"),style:{width:"100%"},onChange:f=>Ce(h)},{default:t(()=>[(u(!0),b(D,null,X(l.currentOutParams,f=>(u(),_(Q,{key:f.id,label:f.title,value:f.id},{default:t(()=>[s("span",ql,[e(n,null,{default:t(()=>[(u(),_(M(a(re)[f.type]),{class:"svg-icon view-type-icon",style:{width:"14px",height:"14px"}}))]),_:2},1024),s("span",Kl,r(f.title),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","disabled","placeholder","onChange"])]),e(k,{class:"m-del-icon-btn",text:"",onClick:f=>Ve(h.targetId)},{default:t(()=>[e(y,{size:"20px"},{default:t(()=>[e(n,{name:"icon_delete-trash_outlined"},{default:t(()=>[e(a(Ue),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["onClick"])]))),128))]),_:1}),e(k,{style:{"margin-top":"8px"},disabled:!l.linkJumpInfo.targetDvId,type:"primary",icon:"Plus",text:"",onClick:o[10]||(o[10]=h=>ve("outerParams"))},{default:t(()=>[m(r(a(d)("visualization.add_jump_field")),1)]),_:1},8,["disabled"])],2)],64)):P("",!0)],64)):P("",!0)],64)):(u(),_(Ge,{key:1,style:{height:"auto"},description:a(C),"img-type":"noneWhite"},null,8,["description"]))]}),_:1})):P("",!0),ye.value?(u(),_(i,{key:1,gutter:8,class:"main-form"},{default:t(()=>[e(S,{span:16,style:{height:"100%"}},{default:t(()=>[s("div",Rl,[m(r(a(d)("visualization.target_url"))+" ",1),e(ke,{class:"item",effect:"dark",placement:"bottom"},{content:t(()=>[m(r(p.$t("visualization.target_url_tips")),1)]),default:t(()=>[e(y,{size:"16px",class:"hint-icon"},{default:t(()=>[e(n,{name:"icon_info_outlined"},{default:t(()=>[e(a(Xe),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),s("div",Zl,[e(ol,{ref_key:"outerContentEditor",ref:B,"link-jump-info":l.linkJumpInfo,"link-jump-info-array":l.linkJumpInfoArray},null,8,["link-jump-info","link-jump-info-array"])])]),_:1}),e(S,{span:8,style:{height:"100%"}},{default:t(()=>[s("div",Xl,[m(r(a(d)("visualization.select_world"))+" ",1),e(ke,{class:"item",effect:"dark",placement:"bottom"},{content:t(()=>[s("span",{innerHTML:p.$t("chart.reference_field_tip")},null,8,Gl)]),default:t(()=>[e(y,{size:"16px",class:"hint-icon"},{default:t(()=>[e(n,{name:"icon_info_outlined"},{default:t(()=>[e(a(Xe),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),s("div",Hl,[e(L,{modelValue:l.searchField,"onUpdate:modelValue":o[11]||(o[11]=I=>l.searchField=I),placeholder:a(d)("dataset.search"),"prefix-icon":a(It),clearable:""},null,8,["modelValue","placeholder","prefix-icon"]),e(a(Oe),{style:{"margin-top":"12px"},height:"250px"},{default:t(()=>[(u(!0),b(D,null,X(l.linkJumpInfoArray.filter(I=>!l.searchField||I.sourceFieldName.indexOf(l.searchField)>-1),I=>(u(),b("span",{key:I.sourceFieldId,class:"item-dimension",title:I.sourceFieldName,onClick:W=>he("["+I.sourceFieldName+"]")},[e(y,null,{default:t(()=>[e(n,null,{default:t(()=>[(u(),_(M(a(fe)[a(q)[I.sourceDeType]]),{class:le(["svg-icon",`field-icon-${a(q)[I.sourceDeType]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),m(" "+r(I.sourceFieldName),1)],8,Ql))),128))]),_:1})])]),_:1})]),_:1})):P("",!0)],64)):(u(),b("div",Yl,[e(Ge,{description:a(d)("visualization.select_dimension_hint"),"img-type":"noneWhite"},null,8,["description"])]))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})),[[Re,l.loading]]),e(i,{class:"root-class"},{default:t(()=>[e(k,{size:"mini",onClick:o[12]||(o[12]=I=>ge())},{default:t(()=>[m(r(a(d)("common.cancel")),1)]),_:1}),e(k,{type:"primary",size:"mini",onClick:o[13]||(o[13]=I=>ne())},{default:t(()=>[m(r(a(d)("dataset.confirm")),1)]),_:1})]),_:1})],32)):P("",!0),e(a(Vt),{ref_key:"openHandler",ref:oe,jsname:"L2NvbXBvbmVudC9lbWJlZGRlZC1pZnJhbWUvT3BlbkhhbmRsZXI="},null,512)]),_:1},8,["title","modelValue"])),[[Re,l.loading]])}}});const Ji=Ke(ta,[["__scopeId","data-v-05654b65"]]),la={class:"option-set ed-dialog__title"},aa={style:{"font-weight":"normal"}},ia={style:{"font-weight":"normal"}},na=ze({__name:"LinkageSetOption",props:{title:bt.string,baseWidth:{required:!1,type:String,default:"100%"},actionSelection:{required:!0,type:Object},themes:{type:String,default:"dark"}},setup(ae){const{t:$}=je(),U=ae,w=()=>{},{actionSelection:K}=rt(U);return(de,J)=>{const d=Me("Setting"),E=Be,x=We,R=mt,F=_t,A=ll;return u(),_(A,{placement:"right-start",width:"auto","popper-style":"max-width:"+ae.baseWidth,trigger:"click","show-arrow":!1},{reference:t(()=>[s("span",la,[m(r(a($)("visualization.linkage_setting"))+" ",1),e(E,{style:{margin:"5px 0 0 5px"}},{default:t(()=>[e(d)]),_:1})])]),default:t(()=>[e(x,null,{default:t(()=>[m(r(a($)("visualization.select_linkage_tips")),1)]),_:1}),e(x,null,{default:t(()=>[e(F,{style:{"margin-top":"12px"},modelValue:a(K).linkageActive,"onUpdate:modelValue":J[0]||(J[0]=C=>a(K).linkageActive=C),onChange:w,class:"radio_group"},{default:t(()=>[e(R,{label:"custom"},{default:t(()=>[s("span",aa,r(a($)("visualization.linkage_option1")),1)]),_:1}),e(R,{label:"auto"},{default:t(()=>[s("span",ia,r(a($)("visualization.linkage_option2")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["popper-style"])}}});const oa=Ke(na,[["__scopeId","data-v-b991b6e9"]]),sa={class:"top-area"},ra={class:"top-area-text",style:{"margin-left":"0"}},da={class:"top-area-value"},ua={class:"top-area-text"},ca={class:"top-area-value"},pa={class:"head-text"},fa={class:"head-filter"},ma={class:"custom-tree-node"},_a={class:"auth-span"},va={class:"tree-select-field"},ga={class:"custom-tree-node"},ha={class:"auth-span"},ya={class:"tree-select-field"},ka={style:{"margin-top":"8px","font-size":"14px"}},wa={style:{display:"flex"},class:"inner-content"},Ia={style:{flex:"1"}},xa={style:{flex:"1"}},ba={style:{width:"100%","max-height":"350px","overflow-y":"auto"}},Va={style:{flex:"1"}},Ca={class:"select-filed"},Sa={class:"custom-option"},Aa={style:{float:"left","margin-left":"4px","font-size":"14px"}},Ja={style:{flex:"1"}},Fa={class:"select-filed"},La={class:"custom-option"},za={style:{float:"left","margin-left":"4px","font-size":"14px"}},Ta={style:{"margin-top":"8px","font-size":"14px"}},Ea=ze({__name:"LinkageSet",setup(ae,{expose:$}){const U=ct(),{dvInfo:w,canvasViewInfo:K,componentData:de,curComponent:J}=dt(U),d=z(null),E=z(null),{t:x}=je(),R=z(!1),F=z(!1),A=z([]),C=z([]),j=z([]),l=ft(),c=qe({sourceLinkageInfo:{},showSelected:!1,curLinkageViewInfo:{},curDatasetInfo:{},initState:!1,viewId:null,tableId:null,treeProp:{id:"targetViewId",label:"targetViewName",children:"children"},linkageInfo:null}),B=z(!1),G=z(!1),N=z(St(al)),ie=z(!0),ne=z(!0),ue=()=>{const n=C.value.filter(i=>i.linkageActive).length;B.value=n===C.value.length,G.value=n>0&&n<C.value.length},xe=n=>{C.value.forEach(i=>{n?(i.linkageActive=!0,B.value=!0,Se(i)):(i.linkageActive=!1,B.value=!1)}),G.value=!1},_e=me(()=>C.value&&C.value.length>0),be=me(()=>j.value&&j.value.length>0&&J.value.innerType!=="indicator"),ve=n=>{c.showSelected=!1,R.value=!0,c.initState=!1,Te(n)},Ve=n=>{const i=[];Bt(de.value,i);const g={dvId:w.value.id,sourceViewId:n,targetViewIds:i,linkageInfo:null,resourceTable:"snapshot"};Wt(g).then(v=>{A.value=v.data||[],A.value.forEach(S=>{S.targetViewId===n&&(c.sourceLinkageInfo=S)}),A.value=A.value.filter(S=>S.targetViewId!==c.viewId),C.value=A.value.filter(S=>S.tableId===c.tableId),j.value=A.value.filter(S=>S.tableId!==c.tableId);let y,V;C.value&&C.value.length>0?(y=C.value[0],V="sameDs"):j.value&&j.value.length>0&&(y=j.value[0],V="diffDs"),c.initState=!0,Ie(()=>{y&&(V==="sameDs"?d.value:E.value).setCurrentKey(y.targetViewId),he(y),ue()})})},Te=n=>{c.initState=!1,c.viewId=n.id,A.value=[];const i=K.value[c.viewId];c.curLinkageViewInfo=i,i.tableId&&(c.tableId=i.tableId,pt(i.tableId).then(g=>{c.curDatasetInfo=g||{}})),N.value=J.value.actionSelection,Ve(c.viewId)},Ce=()=>{let n=0;if(A.value.forEach(g=>{let v=0;const y=g.linkageFields;if(y&&g.linkageActive&&y.forEach(function(V){V.sourceField&&V.targetField||(v++,n++)}),v>0){we.error("【"+g.targetViewName+"】-"+x("visualization.exit_un_march_linkage_field"));return}}),n)return;const i={dvId:w.value.id,sourceViewId:c.viewId,linkageInfo:A.value};F.value=!0,Ut(i).then(()=>{J.value.actionSelection.linkageActive=N.value.linkageActive,l.recordSnapshotCache("saveLinkageSetting"),we.success("保存成功"),jt(w.value.id).then(g=>{U.setNowPanelTrackInfo(g.data)}),Ee(),ut(w.value.id).then(g=>{U.setNowPanelJumpInfo(g.data),p()}),F.value=!1}).catch(()=>{F.value=!1})},Ee=()=>{U.clearLinkageSettingInfo()},ge=(n,i)=>{i==="sameDs"?(d.value.setCurrentKey(n.targetViewId),E.value.setCurrentKey(null)):(d.value.setCurrentKey(null),E.value.setCurrentKey(n.targetViewId)),he(n)},he=n=>{c.linkageInfo=n},ye=(n,i,g)=>{const v={sourceField:i,targetField:g};n.linkageFields.push(v)},De=(n,i)=>{const g={sourceField:n,targetField:i};c.linkageInfo.linkageFields.push(g)},Ne=n=>{c.linkageInfo.linkageFields.splice(n,1)},Se=async n=>{if(n.linkageActive){const i=K.value[n.targetViewId];if(i&&i.tableId&&n.linkageFields.length===0)if(c.curLinkageViewInfo.tableId===i.tableId){if(n.linkageFields&&n.linkageFields.length===0){const g=JSON.stringify(c.curLinkageViewInfo.xAxis)+JSON.stringify(c.curLinkageViewInfo.xAxisExt)+JSON.stringify(c.curLinkageViewInfo.extStack)+(c.curLinkageViewInfo.type.includes("chart-mix")?JSON.stringify(c.curLinkageViewInfo.extBubble):"")+(["indicator"].includes(c.curLinkageViewInfo.type)?JSON.stringify(c.curLinkageViewInfo.yAxis):""),v=JSON.stringify(i.xAxis)+JSON.stringify(i.xAxisExt)+JSON.stringify(c.curLinkageViewInfo.extStack)+(i.type.includes("chart-mix")?JSON.stringify(i.extBubble):"")+(["indicator"].includes(c.curLinkageViewInfo.type)?JSON.stringify(c.curLinkageViewInfo.yAxis):"");c.sourceLinkageInfo.targetViewFields.forEach(y=>{g.includes(y.id)&&v.includes(y.id)&&n.linkageFields&&ye(n,y.id,y.id)})}}else ye(n,"","")}},oe=me(()=>{if(c.sourceLinkageInfo.targetViewFields){const n=JSON.stringify(c.curLinkageViewInfo.xAxis)+JSON.stringify(c.curLinkageViewInfo.drillFields)+JSON.stringify(c.curLinkageViewInfo.xAxisExt)+JSON.stringify(c.curLinkageViewInfo.extStack)+(c.curLinkageViewInfo.type.includes("chart-mix")?JSON.stringify(c.curLinkageViewInfo.extBubble):"")+(["table-normal","indicator"].includes(c.curLinkageViewInfo.type)?JSON.stringify(c.curLinkageViewInfo.yAxis):"");return c.sourceLinkageInfo.targetViewFields.filter(i=>n.includes(i.id))}else return[]}),Ae=(n,i)=>{Ie(()=>{n==="sameDs"?(d.value.setCurrentKey(i.targetViewId),E.value.setCurrentKey(null)):(d.value.setCurrentKey(null),E.value.setCurrentKey(i.targetViewId)),he(i),Se(i),ue()})},p=()=>{R.value=!1,c.initState=!1},o=(n,i)=>!n||i.linkageActive;return Pe(()=>c.showSelected,n=>{var i,g;(i=d.value)==null||i.filter(n),(g=E.value)==null||g.filter(n)}),$({dialogInit:ve}),(n,i)=>{const g=et,v=We,y=st,V=Me("CaretBottom"),S=Me("CaretRight"),T=Be,H=nt,ee=it,Je=ot,Q=lt,Y=at,ce=tt,Fe=Ye,$e=Qe;return u(),_(Fe,{ref:"enlargeDialog","append-to-body":!0,modelValue:R.value,"onUpdate:modelValue":i[13]||(i[13]=k=>R.value=k),width:"70vw",top:"10vh",trigger:"click"},{default:t(()=>[a(J)&&a(J).actionSelection?(u(),_(oa,{key:0,"action-selection":N.value},null,8,["action-selection"])):P("",!0),c.initState?Z((u(),b("div",{key:1,onKeydown:i[11]||(i[11]=se(()=>{},["stop"])),onKeyup:i[12]||(i[12]=se(()=>{},["stop"])),style:{height:"550px","margin-top":"22px"}},[e(v,{style:{"flex-direction":"row"}},{default:t(()=>[s("div",sa,[s("span",ra,r(a(x)("visualization.selected_view"))+"：",1),s("span",da,[e(g,{"class-name":"view-type-icon"},{default:t(()=>[(u(),_(M(a(re)[c.curLinkageViewInfo.type]),{class:"svg-icon view-type-icon"}))]),_:1}),m(" "+r(c.curLinkageViewInfo.title),1)]),s("span",ua,r(a(x)("visualization.used_dataset"))+"：",1),s("span",ca,[e(g,{"class-name":"view-type-icon",name:"dataset-outline"},{default:t(()=>[e(a(vt),{style:{"vertical-align":"-0.2em"},class:"svg-icon view-type-icon"})]),_:1}),m(" "+r(c.curDatasetInfo.name),1)])])]),_:1}),e(v,null,{default:t(()=>[e(v,{class:"preview"},{default:t(()=>[e(Je,{span:8,style:{height:"100%","overflow-y":"auto"}},{default:t(()=>[e(v,{class:"tree-head"},{default:t(()=>[s("span",pa,r(a(x)("visualization.to_select_view")),1),s("span",fa,[m(r(a(x)("visualization.show_selected_only"))+" ",1),e(y,{size:"small",modelValue:c.showSelected,"onUpdate:modelValue":i[0]||(i[0]=k=>c.showSelected=k)},null,8,["modelValue"])])]),_:1}),Z(e(v,{class:"tree-dataset-head"},{default:t(()=>[s("span",null,[e(T,{class:"toggle-icon",onClick:i[1]||(i[1]=()=>ie.value=!ie.value)},{default:t(()=>[Z(e(V,null,null,512),[[te,ie.value]]),Z(e(S,null,null,512),[[te,!ie.value]])]),_:1}),s("span",null,r(a(x)("visualization.same_dataset")),1)]),e(H,{modelValue:B.value,"onUpdate:modelValue":i[2]||(i[2]=k=>B.value=k),indeterminate:G.value,onChange:xe},{default:t(()=>[m(r(a(x)("visualization.select_all")),1)]),_:1},8,["modelValue","indeterminate"])]),_:1},512),[[te,_e.value]]),Z(e(ee,{class:"custom-tree",menu:"",ref_key:"linkageInfoTree",ref:d,"empty-text":a(x)("visualization.no_available_view"),"filter-node-method":o,data:C.value,"node-key":"targetViewId","highlight-current":"",props:c.treeProp,onNodeClick:i[4]||(i[4]=k=>ge(k,"sameDs"))},{default:t(({data:k})=>[s("span",ma,[s("span",null,[s("div",{onClick:i[3]||(i[3]=se(()=>{},["stop"]))},[s("span",_a,[e(H,{modelValue:k.linkageActive,"onUpdate:modelValue":O=>k.linkageActive=O,onChange:O=>Ae("sameDs",k)},null,8,["modelValue","onUpdate:modelValue","onChange"])])])]),s("span",null,[s("span",va,[e(g,{"class-name":"view-type-icon"},{default:t(()=>[(u(),_(M(a(re)[k.targetViewType]),{style:{"margin-right":"4px"},class:"svg-icon view-type-icon"}))]),_:2},1024),m(" "+r(k.targetViewName),1)])])])]),_:1},8,["empty-text","data","props"]),[[te,ie.value&&_e.value]]),Z(e(v,{class:"tree-dataset-head tree-dataset-head-top"},{default:t(()=>[s("span",null,[e(T,{class:"toggle-icon",onClick:i[5]||(i[5]=()=>ne.value=!ne.value)},{default:t(()=>[Z(e(V,null,null,512),[[te,ne.value]]),Z(e(S,null,null,512),[[te,!ne.value]])]),_:1}),s("span",null,r(a(x)("visualization.diff_dataset")),1)])]),_:1},512),[[te,be.value]]),Z(e(ee,{class:"custom-tree",menu:"",ref_key:"linkageInfoTreeDiffDs",ref:E,"empty-text":a(x)("visualization.no_available_view"),"filter-node-method":o,data:j.value,"node-key":"targetViewId","highlight-current":"",props:c.treeProp,onNodeClick:i[7]||(i[7]=k=>ge(k,"diffDs"))},{default:t(({data:k})=>[s("span",ga,[s("span",null,[s("div",{onClick:i[6]||(i[6]=se(()=>{},["stop"]))},[s("span",ha,[e(H,{modelValue:k.linkageActive,"onUpdate:modelValue":O=>k.linkageActive=O,onChange:O=>Ae("diffDs",k)},null,8,["modelValue","onUpdate:modelValue","onChange"])])])]),s("span",null,[s("span",ya,[e(g,{name:k.targetViewType},{default:t(()=>[(u(),_(M(a(re)[k.targetViewType]),{class:"svg-icon view-type-icon",style:{"margin-right":"4px"}}))]),_:2},1032,["name"]),m(" "+r(k.targetViewName),1)])])])]),_:1},8,["empty-text","data","props"]),[[te,ne.value&&be.value]])]),_:1}),e(Je,{span:16,class:"preview-show"},{default:t(()=>{var k;return[e(v,{class:"content-head"},{default:t(()=>[m(r(a(x)("visualization.linkage_setting_tips1")),1)]),_:1}),c.linkageInfo&&c.linkageInfo.linkageActive&&((k=a(J))==null?void 0:k.innerType)==="indicator"?(u(),_(v,{key:0,style:{height:"100%"},class:"custom-position"},{default:t(()=>[e(g,{name:"dv-empty"},{default:t(()=>[e(a(He),{style:{width:"125px",height:"125px"},class:"svg-icon"})]),_:1}),s("span",ka,r(a(x)("visualization.indicator_linkage")),1)]),_:1})):c.linkageInfo&&c.linkageInfo.linkageActive?(u(),_(v,{key:1},{default:t(()=>[e(v,{style:{"margin-top":"5px"}},{default:t(()=>[s("div",wa,[s("div",Ia,r(a(x)("visualization.current_chart_source_field")),1),i[14]||(i[14]=s("div",{style:{width:"36px"}},null,-1)),s("div",xa,r(a(x)("visualization.link_view_field")),1),i[15]||(i[15]=s("div",{style:{width:"32px"}},null,-1))]),s("div",ba,[(u(!0),b(D,null,X(c.linkageInfo.linkageFields,(O,ke)=>(u(),b("div",{style:{display:"flex",padding:"0 16px 8px"},key:ke},[s("div",Va,[s("div",Ca,[e(Y,{modelValue:O.sourceField,"onUpdate:modelValue":L=>O.sourceField=L,placeholder:a(x)("chart.pls_select_field"),style:{width:"100%"}},{default:t(()=>[(u(!0),b(D,null,X(oe.value,L=>(u(),_(Q,{key:L.id,label:L.name,value:L.id},{default:t(()=>[s("span",Sa,[e(g,null,{default:t(()=>[(u(),_(M(a(fe)[a(q)[L.deType]]),{style:{width:"14px",height:"14px"},class:le([`field-icon-${a(q)[L.deType]}`,"svg-icon"])},null,8,["class"]))]),_:2},1024),s("span",Aa,r(L.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","placeholder"])])]),e(T,{class:"link-icon-join"},{default:t(()=>[e(g,{style:{width:"20px",height:"20px"},name:"dv-link-target"},{default:t(()=>[e(a(Le),{style:{width:"20px",height:"20px"},class:"svg-icon"})]),_:1})]),_:1}),s("div",Ja,[s("div",Fa,[e(Y,{modelValue:O.targetField,"onUpdate:modelValue":L=>O.targetField=L,placeholder:a(x)("common.selectText"),style:{width:"100%"}},{default:t(()=>[(u(!0),b(D,null,X(c.linkageInfo.targetViewFields,L=>(u(),_(Q,{key:L.id,label:L.name,value:L.id},{default:t(()=>[s("span",La,[e(g,null,{default:t(()=>[(u(),_(M(a(fe)[a(q)[L.deType]]),{style:{width:"14px",height:"14px"},class:le(["svg-icon",`field-icon-${a(q)[L.deType]}`])},null,8,["class"]))]),_:2},1024),s("span",za,r(L.name),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue","placeholder"])])]),e(ce,{class:"m-del-icon-btn",text:"",onClick:L=>Ne(ke)},{default:t(()=>[e(T,{size:"16px"},{default:t(()=>[e(g,{name:"icon_delete-trash_outlined"},{default:t(()=>[e(a(Ue),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["onClick"])]))),128))]),e(v,{style:{width:"100%","padding-left":"16px"}},{default:t(()=>[e(ce,{type:"primary",icon:"Plus",text:"",onClick:i[8]||(i[8]=O=>De("",""))},{default:t(()=>[m(r(a(x)("visualization.add_linkage_dependency_fields")),1)]),_:1})]),_:1})]),_:1})]),_:1})):(u(),_(v,{key:2,style:{height:"100%"},class:"custom-position"},{default:t(()=>[e(g,{name:"dv-empty"},{default:t(()=>[e(a(He),{style:{width:"125px",height:"125px"},class:"svg-icon"})]),_:1}),s("span",Ta,r(a(x)("visualization.select_linkage_tips")),1)]),_:1}))]}),_:1})]),_:1})]),_:1}),e(v,{class:"root-class"},{default:t(()=>[e(ce,{size:"mini",onClick:i[9]||(i[9]=k=>p())},{default:t(()=>[m(r(a(x)("common.cancel")),1)]),_:1}),e(ce,{type:"primary",size:"mini",onClick:i[10]||(i[10]=k=>Ce())},{default:t(()=>[m(r(a(x)("dataset.confirm")),1)]),_:1})]),_:1})],32)),[[$e,F.value]]):P("",!0)]),_:1},8,["modelValue"])}}});const Fi=Ke(Ea,[["__scopeId","data-v-18bb3c36"]]);export{Ji as L,Fi as a};

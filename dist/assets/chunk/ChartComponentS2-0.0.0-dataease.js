import{a5 as ie,p as Fe,M as He}from"./element-plus-secondary-0.0.0-dataease.js";import{d as Me,t as De,r as R,i as Le,l as Ve,x as qe,k,b as Re,e as je,o as y,c as ae,a as C,W as le,Z as j,u as O,R as N,T as B,U as ne,z as Oe,X as re,Y as Ne,S as We,n as se,v as Ue}from"./@vue-0.0.0-dataease.js";import{b as Je}from"./chart-0.0.0-dataease2.js";import{c as Ye}from"./index-0.0.0-dataease12.js";import{d as Ge}from"./dvMain-0.0.0-dataease.js";import{V as Ke}from"./ViewTrackBar-0.0.0-dataease.js";import{s as Ze}from"./pinia-0.0.0-dataease.js";import Xe from"./ChartError-0.0.0-dataease.js";import{p as Qe,B as $e}from"./chart-0.0.0-dataease.js";import{r as pe,e as et,f as tt}from"./canvasStyle-0.0.0-dataease.js";import{u as ot,i as it,B as at,l as lt}from"./index-0.0.0-dataease.js";import{x as nt,P as rt}from"./canvasUtils-0.0.0-dataease.js";import{d as st,E as pt,h as ut}from"./lodash-es-0.0.0-dataease.js";import{_ as mt}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./fast-png-0.0.0-dataease.js";import"./iobuffer-0.0.0-dataease.js";import"./pako-0.0.0-dataease.js";import"./vue-router_2-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./dataset-0.0.0-dataease.js";import"./js-base64-0.0.0-dataease.js";import"./@antv-0.0.0-dataease.js";import"./eventemitter3-0.0.0-dataease.js";import"./@mapbox-0.0.0-dataease.js";import"./pbf-0.0.0-dataease.js";import"./ieee754-0.0.0-dataease.js";import"./supercluster-0.0.0-dataease.js";import"./gl-matrix-0.0.0-dataease.js";import"./tslib-0.0.0-dataease.js";import"./detect-browser-0.0.0-dataease.js";import"./size-sensor-0.0.0-dataease.js";import"./d3-regression-0.0.0-dataease.js";import"./d3-hierarchy-0.0.0-dataease.js";import"./fmin-0.0.0-dataease.js";import"./pdfast-0.0.0-dataease.js";import"./d3-ease-0.0.0-dataease.js";import"./d3-interpolate-0.0.0-dataease.js";import"./d3-color-0.0.0-dataease.js";import"./d3-timer-0.0.0-dataease.js";import"./fecha-0.0.0-dataease.js";import"./topojson-client-0.0.0-dataease.js";import"./viewport-mercator-project-0.0.0-dataease.js";import"./@turf-0.0.0-dataease.js";import"./polygon-clipping-0.0.0-dataease.js";import"./splaytree-0.0.0-dataease.js";import"./robust-predicates-0.0.0-dataease.js";import"./d3-scale-0.0.0-dataease.js";import"./d3-collection-0.0.0-dataease.js";import"./d3-format-0.0.0-dataease.js";import"./d3-time-format-0.0.0-dataease.js";import"./d3-time-0.0.0-dataease.js";import"./d3-array-0.0.0-dataease.js";import"./earcut-0.0.0-dataease.js";import"./regl-0.0.0-dataease.js";import"./mapbox-gl-0.0.0-dataease.js";import"./d3-dsv-0.0.0-dataease.js";import"./geojson-vt-0.0.0-dataease.js";import"./hammerjs-0.0.0-dataease.js";import"./element-resize-detector-0.0.0-dataease.js";import"./batch-processor-0.0.0-dataease.js";import"./d3-hexbin-0.0.0-dataease.js";import"./mathjs-0.0.0-dataease.js";import"./decimal.js-0.0.0-dataease.js";import"./typed-function-0.0.0-dataease.js";import"./complex.js-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";import"./exceljs-0.0.0-dataease.js";import"./file-saver-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./snowflake-id-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./login-0.0.0-dataease.js";import"./less-0.0.0-dataease.js";import"./copy-anything-0.0.0-dataease.js";import"./is-what-0.0.0-dataease.js";import"./app-0.0.0-dataease.js";import"./translate-0.0.0-dataease.js";import"./eventBus-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease.js";import"./snapshot-0.0.0-dataease.js";import"./ModelUtil-0.0.0-dataease.js";const ct={class:"canvas-area"},dt={key:0,class:"canvas-content"},ft={class:"enlarge-image"},gt=["src"],ue=1,vt=Me({__name:"ChartComponentS2",props:{element:{type:Object,default(){return{propValue:null}}},view:{type:Object,default(){return{propValue:null}}},showPosition:{type:String,required:!1,default:"canvas"},scale:{type:Number,required:!1,default:1},terminal:{type:String,default:"pc"},drillLength:{type:Number,required:!1,default:0},suffixId:{type:String,required:!1,default:"common"},fontFamily:{type:String,required:!1,default:"inherit"}},emits:["onPointClick","onChartClick","onDrillFilters","onJumpClick"],setup(W,{expose:me,emit:ce}){const b=Ge(),{nowPanelTrackInfo:U,nowPanelJumpInfo:J,mobileInPc:E,canvasStyleData:Y,embeddedCallBack:de,inMobile:_}=Ze(b),{emitter:G}=ot(),f=W,w=ce,K=!nt()&&it(),{view:s,showPosition:T,scale:v,terminal:Z,drillLength:fe,suffixId:ge}=De(f),P=R(!1),X=R(""),x=Le("chartExtRequest"),o=Ve({curActionId:null,curTrackMenu:[],trackBarStyle:{position:"absolute",left:"50px",top:"50px"},linkageActiveParam:null,pointParam:null,loading:!1,data:{fields:[]},pageInfo:{total:0,pageSize:20,currentPage:1},totalItems:0,showPage:!1,pageStyle:"simple",currentPageSize:0,imgEnlarge:!1,imgSrc:""}),F=["table-info","table-normal"];let S=qe({fields:[]});const I="container-"+T.value+"-"+s.value.id+"-"+ge.value,Q=R(null),H=(t,e,l=!0)=>{var n;if(t.customAttr.basicStyle.tablePageStyle==="general"?o.currentPageSize!==0?(t.chartExtRequest.pageSize=o.currentPageSize,o.pageInfo.pageSize=o.currentPageSize):t.chartExtRequest.pageSize=o.pageInfo.pageSize:(n=t.chartExtRequest)==null||delete n.pageSize,t.tableId||t.dataFrom==="template"){P.value=!1;const i=JSON.parse(JSON.stringify(t));Je(i).then(r=>{r.code&&r.code!==0?(P.value=!0,X.value=r.msg):(S.value=r==null?void 0:r.data,o.totalItems=r==null?void 0:r.totalItems,b.setViewDataDetails(t.id,r),w("onDrillFilters",r==null?void 0:r.drillFilters),M(r,l)),e==null||e()}).catch(()=>{e==null||e()})}else e==null||e()};let a=null,d;const ve=(t,e)=>{S.value=e,M(t,!1)},Se=t=>{var l,n;const e=Qe(t.customAttr);if(e.tableCell.mergeCells===void 0&&(e.tableCell.mergeCells=!1),t.type==="table-pivot"){(n=(l=e.tableTotal)==null?void 0:l.row)!=null&&n.subTotalsDimensionsNew||(e.tableTotal.row.subTotalsDimensionsNew=!!e.tableTotal.row.subTotalsDimensionsNew);const{tableHeader:i}=e;i.tableHeaderColBgColor||(i.tableHeaderColBgColor=i.tableHeaderBgColor,i.tableHeaderColFontColor=i.tableHeaderFontColor,i.tableTitleColFontSize=i.tableTitleFontSize,i.tableHeaderColAlign=i.tableHeaderAlign,i.isColBolder=i.isBolder,i.isColItalic=i.isItalic,i.tableHeaderCornerBgColor=i.tableHeaderBgColor,i.tableHeaderCornerFontColor=i.tableHeaderFontColor,i.tableTitleCornerFontSize=i.tableTitleFontSize,i.tableHeaderCornerAlign=i.tableHeaderAlign,i.isCornerBolder=i.isBolder,i.isCornerItalic=i.isItalic)}},M=(t,e)=>{t&&(Se(t),d=lt({...pt(t,ut($e)),data:S.value,fontFamily:f.fontFamily}),pe(et,d.customAttr,v.value,Z.value),pe(tt,d.customStyle,v.value,Z.value),be(d,e),se(()=>$(e)))},$=st(()=>{var e,l,n,i;(l=(e=a==null?void 0:a.facet)==null?void 0:e.timer)==null||l.stop(),(n=a==null?void 0:a.facet)==null||n.cancelScrollFrame(),a==null||a.destroy(),(i=a==null?void 0:a.getCanvasElement())==null||i.remove(),a=Ye.getChartView(d.render,d.type).drawChart({container:I,chart:Ue(d),chartObj:a,pageInfo:o.pageInfo,action:Pe,resizeAction:ze,touchAction:we}),a==null||a.render(),b.setViewInstanceInfo(d.id,a),z()},500),be=(t,e)=>{const l=t.customAttr;if(!F.includes(t.type)||l.basicStyle.tablePageMode!=="page"){o.showPage=!1;return}const n=o.pageInfo;o.pageStyle=l.basicStyle.tablePageStyle,o.pageStyle!=="general"&&(n.pageSize=l.basicStyle.tablePageSize??20),o.totalItems>o.pageInfo.pageSize||o.pageStyle==="general"?(n.total=o.totalItems,o.showPage=!0):o.showPage=!1,e&&(o.pageInfo.currentPage=1),b.setViewPageInfo(t.id,o.pageInfo)},ee=()=>{var t,e;(e=(t=a==null?void 0:a.facet)==null?void 0:t.timer)==null||e.stop()},he=()=>{z()};let D;const z=()=>{D&&clearTimeout(D),D=setTimeout(()=>{var l,n,i;const t=d==null?void 0:d.customAttr,e=d==null?void 0:d.senior;if(a&&((l=e==null?void 0:e.scrollCfg)!=null&&l.open)&&((n=S.value.tableRow)!=null&&n.length)&&F.includes(f.view.type)&&!o.showPage){(i=a.facet.timer)==null||i.stop();let r=a.store.get("scrollY")||0;const m=document.getElementById(I).offsetHeight;if(!m)return;const u=t.tableCell.tableItemHeight,c=t.tableHeader.showTableHeader===!1?1:t.tableHeader.tableTitleHeight,p=a.theme.scrollBar.size,q=u*S.value.tableRow.length+c-m+p;if(q<p)return;r>=q-1&&(a.store.set("scrollY",0),a.render(),r=0);const Ee=m-c-p+r,_e=(S.value.tableRow.length-Ee/u)/e.scrollCfg.row*e.scrollCfg.interval;a.facet.scrollWithAnimation({offsetY:{value:q,animate:!1}},_e,z)}},1500)},ke=k(()=>F.includes(s.value.type)?o.showPage:!1),te=t=>{let e={goPage:t};x.value&&(e={...e,...x.value});const l={...s.value,chartExtRequest:e};H(l,null,!1)},ye=t=>{o.pageStyle==="general"&&(o.currentPageSize=t,G.emit("set-page-size",t));let e={pageSize:t};x.value&&(e={...e,...x.value});const l={...s.value,chartExtRequest:e};H(l,null,!1)},Ce=()=>{de.value==="yes"&&L("pointClick")},we=(t,e)=>{e&&(o.curActionId=e),h.value.length||t==null||t()},Pe=t=>{if(o.pointParam=t,o.curActionId=t.data.name,o.curTrackMenu=oe(o.curActionId),Ce(),h.value.length<2)L(h.value[0]);else{const e={left:t.x-50,top:t.y+10};rt(f.element,e,f.scale,h.value.length),K?(o.trackBarStyle.left=e.left+40+"px",o.trackBarStyle.top=e.top+70+"px"):(o.trackBarStyle.left=e.left+"px",o.trackBarStyle.top=e.top+"px"),Q.value.trackButtonClick(s.value.id)}},L=t=>{var r,m;const e=o.pointParam;if(!((r=e==null?void 0:e.data)!=null&&r.dimensionList))return;const l={option:"linkage",name:o.pointParam.data.name,viewId:s.value.id,dimensionList:o.pointParam.data.dimensionList,quotaList:o.pointParam.data.quotaList};if(["table-info","table-normal"].includes(s.value.type)){l.quotaList=[];const u=[],c=[];s.value.xAxis.forEach(p=>{p.groupType==="d"?u.push(p.id):c.push(p.id)}),s.value.yAxis.forEach(p=>{p.groupType==="d"?u.push(p.id):c.push(p.id)}),u.includes(e.data.name)?l.dimensionList=l.dimensionList.filter(p=>p.id===e.data.name):c.includes(e.data.name)&&(l.dimensionList=l.dimensionList.filter(p=>u.includes(p.id))),s.value}const n={option:"jump",name:o.pointParam.data.name,viewId:s.value.id,dimensionList:o.pointParam.data.dimensionList,quotaList:o.pointParam.data.quotaList,sourceType:o.pointParam.data.sourceType},i={option:"pointClick",name:o.pointParam.data.name,viewId:s.value.id,dimensionList:o.pointParam.data.dimensionList,quotaList:o.pointParam.data.quotaList};switch(t){case"pointClick":w("onPointClick",i);break;case"linkageAndDrill":b.addViewTrackFilter(l),w("onChartClick",e);break;case"drill":w("onChartClick",e);break;case"linkage":b.addViewTrackFilter(l);break;case"jump":if(E.value&&!_.value)return;w("onJumpClick",n);break;case"enlarge":s.value.type==="table-info"&&((m=e.data.dimensionList)==null||m.forEach(u=>{u.id===o.curActionId&&(o.imgSrc=u.value,o.imgEnlarge=!0)}));break}},h=k(()=>["table-info","table-normal"].includes(s.value.type)&&o.curActionId?oe(o.curActionId):Ie.value),Ie=k(()=>{var n,i,r,m;let t=[];if(T.value==="viewDialog")return t;let e=0,l=0;return(i=(n=S.value)==null?void 0:n.fields)==null||i.forEach(u=>{const c=s.value.id+"#"+u.id;U.value[c]&&e++,J.value[c]&&l++}),l&&((r=s.value)!=null&&r.jumpActive)&&(!E.value||_.value)&&t.push("jump"),e&&((m=s.value)!=null&&m.linkageActive)&&t.push("linkage"),s.value.drillFields.length&&t.push("drill"),t.length===3&&f.element.actionSelection.linkageActive==="auto"?t=["jump","linkageAndDrill"]:t.length===2&&f.element.actionSelection.linkageActive==="auto"&&!t.includes("jump")&&(t=["linkageAndDrill"]),t}),oe=t=>{var m,u,c;let e=[];if(T.value==="viewDialog")return e;let l=0,n=0,i=0;const r=s.value.id+"#"+t;return U.value[r]&&l++,J.value[r]&&n++,n&&((m=s.value)!=null&&m.jumpActive)&&(!E.value||_.value)&&e.push("jump"),l&&((u=s.value)!=null&&u.linkageActive)&&e.push("linkage"),s.value.drillFields.length&&s.value.drillFields[fe.value].id===t&&i++,i&&e.push("drill"),e.length===3&&f.element.actionSelection.linkageActive==="auto"?e=["jump","linkageAndDrill"]:e.length===2&&f.element.actionSelection.linkageActive==="auto"&&!e.includes("jump")&&(e=["linkageAndDrill"]),s.value.type==="table-info"&&((c=s.value.xAxis)==null||c.forEach(p=>{p.id===t&&p.deType===7&&e.push("enlarge")})),e},ze=t=>{var u,c;if(a!=null&&a.facet.timer&&(a==null||a.facet.timer.stop(),se(z)),T.value!=="canvas")return;const e=t.info.meta.field,{basicStyle:l}=s.value.customAttr,n=document.getElementById(I).offsetWidth,i=(u=l.tableFieldWidth)==null?void 0:u.find(p=>p.fieldId===e);let r;const m=parseFloat((t.info.resizedWidth/n*100).toFixed(2));if(i)i.width=m,r=[...l.tableFieldWidth];else{const p={fieldId:e,width:m};r=(c=l.tableFieldWidth)!=null&&c.length?[...l.tableFieldWidth,p]:[p]}G.emit("set-table-column-width",r)};me({calcData:H,renderChart:M,renderChartFromDialog:ve,trackMenu:h});let V;const Ae=(t,e)=>{V&&clearTimeout(V),V=setTimeout(()=>{var l,n;a!=null&&a.facet?((n=(l=a==null?void 0:a.facet)==null?void 0:l.timer)==null||n.stop(),a==null||a.changeSheetSize(t,e),a==null||a.render()):$(!1),z()},500)},g=[0,0];let A;Re(()=>{A=new ResizeObserver(([t]=[])=>{const[e]=t.borderBoxSize||[];g[0]||g[1]||(g[0]=e.inlineSize,g[1]=e.blockSize);const l=Math.abs(e.inlineSize-g[0]),n=Math.abs(e.blockSize-g[1]);l<ue&&n<ue||(g[0]=e.inlineSize,g[1]=e.blockSize,Ae(e.inlineSize,Math.round(e.blockSize)))}),A.observe(document.getElementById(I))}),je(()=>{var t;try{(t=a==null?void 0:a.facet.timer)==null||t.stop(),a==null||a.destroy(),a=null,A==null||A.disconnect()}catch(e){console.warn(e)}});const Te=k(()=>at()?{height:20*v.value+8+"px",width:100/v.value+"%!important",left:50*(1-1/v.value)+"%",transform:"scale("+v.value+") translateZ(0)"}:{zoom:v.value}),xe=k(()=>{var t;return[{"--de-pager-color":(t=Y.value.component.seniorStyleSetting)==null?void 0:t.pagerColor}]}),Be=k(()=>{var t;return["#ffffff","#ffffffff","#a6a6a6ff"].includes((t=Y.value.component.seniorStyleSetting)==null?void 0:t.pagerColor.toLowerCase())&&"table-page-info_dark"});return(t,e)=>{const l=Fe,n=He;return y(),ae(We,null,[C("div",ct,[le(Ke,{ref_key:"viewTrack",ref:Q,"track-menu":h.value,"font-family":W.fontFamily,class:"track-bar",style:j(o.trackBarStyle),onTrackClick:L,"is-data-v-mobile":O(K),onMousemove:ee},null,8,["track-menu","font-family","style","is-data-v-mobile"]),P.value?N("",!0):(y(),ae("div",dt,[C("div",{id:I,style:{position:"relative",height:"100%"},onMousemove:ee,onMouseleave:he},null,32)])),ke.value&&!P.value?(y(),B(l,{key:1,style:j(Te.value)},{default:ne(()=>[C("div",{class:Oe(["table-page-info",Be.value]),style:j(xe.value),onKeydown:e[4]||(e[4]=re(()=>{},["stop"])),onKeyup:e[5]||(e[5]=re(()=>{},["stop"]))},[C("div",null,"共"+Ne(o.pageInfo.total)+"条",1),o.pageStyle!=="general"?(y(),B(O(ie),{key:0,class:"table-page-content",layout:"prev, pager, next","page-size":o.pageInfo.pageSize,"onUpdate:pageSize":e[0]||(e[0]=i=>o.pageInfo.pageSize=i),"current-page":o.pageInfo.currentPage,"onUpdate:currentPage":[e[1]||(e[1]=i=>o.pageInfo.currentPage=i),te],"pager-count":5,total:o.pageInfo.total},null,8,["page-size","current-page","total"])):(y(),B(O(ie),{key:1,class:"table-page-content",layout:"prev, pager, next, sizes, jumper","page-size":o.pageInfo.pageSize,"onUpdate:pageSize":[e[2]||(e[2]=i=>o.pageInfo.pageSize=i),ye],"current-page":o.pageInfo.currentPage,"onUpdate:currentPage":[e[3]||(e[3]=i=>o.pageInfo.currentPage=i),te],"pager-count":5,total:o.pageInfo.total},null,8,["page-size","current-page","total"]))],38)]),_:1},8,["style"])):N("",!0),P.value?(y(),B(Xe,{key:2,"err-msg":X.value},null,8,["err-msg"])):N("",!0)]),le(n,{modelValue:o.imgEnlarge,"onUpdate:modelValue":e[6]||(e[6]=i=>o.imgEnlarge=i),"append-to-body":"",class:"image-dialog"},{default:ne(()=>[C("div",ft,[C("img",{src:o.imgSrc,style:{width:"100%",height:"100%","object-fit":"contain"}},null,8,gt)])]),_:1},8,["modelValue"])],64)}}});const Ri=mt(vt,[["__scopeId","data-v-e517e62c"]]);export{Ri as default};

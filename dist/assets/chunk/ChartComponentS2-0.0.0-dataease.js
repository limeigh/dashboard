import{a as Fe}from"./index-0.0.0-dataease.js";import{E as De}from"./el-dialog-0.0.0-dataease.js";import{i as He,ax as Me,N as Le}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{E as Ve}from"./el-row-0.0.0-dataease.js";import{d as qe,af as je,t as Re,r as j,x as Oe,X as Ne,s as We,y as k,o as Je,a as Ue,f as y,O as oe,P as C,j as ie,T as R,u as O,_ as N,g as x,i as le,S as Ye,a8 as ne,a4 as Ge,W as Ke,n as re,al as Xe}from"./vue-0.0.0-dataease.js";import{b as Ze}from"./chart-0.0.0-dataease2.js";import{c as Qe}from"./index-0.0.0-dataease21.js";import{d as $e}from"./dvMain-0.0.0-dataease.js";import{V as et}from"./ViewTrackBar-0.0.0-dataease.js";import{E as se}from"./el-pagination-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import tt from"./ChartError-0.0.0-dataease.js";import{p as at,B as ot}from"./chart-0.0.0-dataease.js";import{r as ue,e as it,f as lt}from"./canvasStyle-0.0.0-dataease.js";import{x as nt,P as rt}from"./canvasUtils-0.0.0-dataease.js";import{h as st,D as ut,e as ct}from"./lodash-0.0.0-dataease.js";import{_ as pt}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./index-0.0.0-dataease3.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./constants-0.0.0-dataease.js";import"./dataset-0.0.0-dataease.js";import"./antv-0.0.0-dataease.js";import"./index-0.0.0-dataease22.js";import"./pureFunctionsAny.generated-0.0.0-dataease.js";import"./extends-0.0.0-dataease.js";import"./decimal-0.0.0-dataease.js";import"./tslib.es6-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./el-col-0.0.0-dataease.js";import"./_commonjs-dynamic-modules-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./el-dropdown-menu-0.0.0-dataease.js";import"./index-0.0.0-dataease4.js";import"./dropdown-0.0.0-dataease.js";import"./el-dropdown-item-0.0.0-dataease.js";import"./index-0.0.0-dataease6.js";import"./token-0.0.0-dataease.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease5.js";import"./el-main-0.0.0-dataease.js";import"./index-0.0.0-dataease16.js";import"./app-0.0.0-dataease.js";import"./translate-0.0.0-dataease.js";import"./eventBus-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease.js";import"./snapshot-0.0.0-dataease.js";import"./ModelUtil-0.0.0-dataease.js";const dt={class:"canvas-area"},mt={key:0,class:"canvas-content"},ft={class:"enlarge-image"},gt=["src"],ce=1,vt=qe({__name:"ChartComponentS2",props:{element:{type:Object,default(){return{propValue:null}}},view:{type:Object,default(){return{propValue:null}}},showPosition:{type:String,required:!1,default:"canvas"},scale:{type:Number,required:!1,default:1},terminal:{type:String,default:"pc"},drillLength:{type:Number,required:!1,default:0},suffixId:{type:String,required:!1,default:"common"},fontFamily:{type:String,required:!1,default:"inherit"}},emits:["onPointClick","onChartClick","onDrillFilters","onJumpClick"],setup(W,{expose:pe,emit:de}){const b=$e(),{nowPanelTrackInfo:J,nowPanelJumpInfo:U,mobileInPc:_,canvasStyleData:Y,embeddedCallBack:me,inMobile:B}=je(b),{emitter:G}=Fe(),f=W,P=de,K=!nt()&&He(),{view:s,showPosition:T,scale:v,terminal:X,drillLength:fe,suffixId:ge}=Re(f),w=j(!1),Z=j(""),E=Oe("chartExtRequest"),a=Ne({curActionId:null,curTrackMenu:[],trackBarStyle:{position:"absolute",left:"50px",top:"50px"},linkageActiveParam:null,pointParam:null,loading:!1,data:{fields:[]},pageInfo:{total:0,pageSize:20,currentPage:1},totalItems:0,showPage:!1,pageStyle:"simple",currentPageSize:0,imgEnlarge:!1,imgSrc:""}),F=["table-info","table-normal"];let S=We({fields:[]});const I="container-"+T.value+"-"+s.value.id+"-"+ge.value,Q=j(null),D=(t,e,l=!0)=>{var n;if(t.customAttr.basicStyle.tablePageStyle==="general"?a.currentPageSize!==0?(t.chartExtRequest.pageSize=a.currentPageSize,a.pageInfo.pageSize=a.currentPageSize):t.chartExtRequest.pageSize=a.pageInfo.pageSize:(n=t.chartExtRequest)==null||delete n.pageSize,t.tableId||t.dataFrom==="template"){w.value=!1;const o=JSON.parse(JSON.stringify(t));Ze(o).then(r=>{r.code&&r.code!==0?(w.value=!0,Z.value=r.msg):(S.value=r==null?void 0:r.data,a.totalItems=r==null?void 0:r.totalItems,b.setViewDataDetails(t.id,r),P("onDrillFilters",r==null?void 0:r.drillFilters),H(r,l)),e==null||e()}).catch(()=>{e==null||e()})}else e==null||e()};let i=null,m;const ve=(t,e)=>{S.value=e,H(t,!1)},Se=t=>{var l,n;const e=at(t.customAttr);if(e.tableCell.mergeCells===void 0&&(e.tableCell.mergeCells=!1),t.type==="table-pivot"){(n=(l=e.tableTotal)==null?void 0:l.row)!=null&&n.subTotalsDimensionsNew||(e.tableTotal.row.subTotalsDimensionsNew=!!e.tableTotal.row.subTotalsDimensionsNew);const{tableHeader:o}=e;o.tableHeaderColBgColor||(o.tableHeaderColBgColor=o.tableHeaderBgColor,o.tableHeaderColFontColor=o.tableHeaderFontColor,o.tableTitleColFontSize=o.tableTitleFontSize,o.tableHeaderColAlign=o.tableHeaderAlign,o.isColBolder=o.isBolder,o.isColItalic=o.isItalic,o.tableHeaderCornerBgColor=o.tableHeaderBgColor,o.tableHeaderCornerFontColor=o.tableHeaderFontColor,o.tableTitleCornerFontSize=o.tableTitleFontSize,o.tableHeaderCornerAlign=o.tableHeaderAlign,o.isCornerBolder=o.isBolder,o.isCornerItalic=o.isItalic)}},H=(t,e)=>{t&&(Se(t),m=Le({...ut(t,ct(ot)),data:S.value,fontFamily:f.fontFamily}),ue(it,m.customAttr,v.value,X.value),ue(lt,m.customStyle,v.value,X.value),be(m,e),re(()=>$(e)))},$=st(()=>{var e,l,n,o;(l=(e=i==null?void 0:i.facet)==null?void 0:e.timer)==null||l.stop(),(n=i==null?void 0:i.facet)==null||n.cancelScrollFrame(),i==null||i.destroy(),(o=i==null?void 0:i.getCanvasElement())==null||o.remove(),i=Qe.getChartView(m.render,m.type).drawChart({container:I,chart:Xe(m),chartObj:i,pageInfo:a.pageInfo,action:we,resizeAction:ze,touchAction:Pe}),i==null||i.render(),b.setViewInstanceInfo(m.id,i),z()},500),be=(t,e)=>{const l=t.customAttr;if(!F.includes(t.type)||l.basicStyle.tablePageMode!=="page"){a.showPage=!1;return}const n=a.pageInfo;a.pageStyle=l.basicStyle.tablePageStyle,a.pageStyle!=="general"&&(n.pageSize=l.basicStyle.tablePageSize??20),a.totalItems>a.pageInfo.pageSize||a.pageStyle==="general"?(n.total=a.totalItems,a.showPage=!0):a.showPage=!1,e&&(a.pageInfo.currentPage=1),b.setViewPageInfo(t.id,a.pageInfo)},ee=()=>{var t,e;(e=(t=i==null?void 0:i.facet)==null?void 0:t.timer)==null||e.stop()},he=()=>{z()};let M;const z=()=>{M&&clearTimeout(M),M=setTimeout(()=>{var l,n,o;const t=m==null?void 0:m.customAttr,e=m==null?void 0:m.senior;if(i&&((l=e==null?void 0:e.scrollCfg)!=null&&l.open)&&((n=S.value.tableRow)!=null&&n.length)&&F.includes(f.view.type)&&!a.showPage){(o=i.facet.timer)==null||o.stop();let r=i.store.get("scrollY")||0;const p=document.getElementById(I).offsetHeight;if(!p)return;const c=t.tableCell.tableItemHeight,d=t.tableHeader.showTableHeader===!1?1:t.tableHeader.tableTitleHeight,u=i.theme.scrollBar.size,q=c*S.value.tableRow.length+d-p+u;if(q<u)return;r>=q-1&&(i.store.set("scrollY",0),i.render(),r=0);const _e=p-d-u+r,Be=(S.value.tableRow.length-_e/c)/e.scrollCfg.row*e.scrollCfg.interval;i.facet.scrollWithAnimation({offsetY:{value:q,animate:!1}},Be,z)}},1500)},ke=k(()=>F.includes(s.value.type)?a.showPage:!1),te=t=>{let e={goPage:t};E.value&&(e={...e,...E.value});const l={...s.value,chartExtRequest:e};D(l,null,!1)},ye=t=>{a.pageStyle==="general"&&(a.currentPageSize=t,G.emit("set-page-size",t));let e={pageSize:t};E.value&&(e={...e,...E.value});const l={...s.value,chartExtRequest:e};D(l,null,!1)},Ce=()=>{me.value==="yes"&&L("pointClick")},Pe=(t,e)=>{e&&(a.curActionId=e),h.value.length||t==null||t()},we=t=>{if(a.pointParam=t,a.curActionId=t.data.name,a.curTrackMenu=ae(a.curActionId),Ce(),h.value.length<2)L(h.value[0]);else{const e={left:t.x-50,top:t.y+10};rt(f.element,e,f.scale,h.value.length),K?(a.trackBarStyle.left=e.left+40+"px",a.trackBarStyle.top=e.top+70+"px"):(a.trackBarStyle.left=e.left+"px",a.trackBarStyle.top=e.top+"px"),Q.value.trackButtonClick(s.value.id)}},L=t=>{var r,p;const e=a.pointParam;if(!((r=e==null?void 0:e.data)!=null&&r.dimensionList))return;const l={option:"linkage",name:a.pointParam.data.name,viewId:s.value.id,dimensionList:a.pointParam.data.dimensionList,quotaList:a.pointParam.data.quotaList};if(["table-info","table-normal"].includes(s.value.type)){l.quotaList=[];const c=[],d=[];s.value.xAxis.forEach(u=>{u.groupType==="d"?c.push(u.id):d.push(u.id)}),s.value.yAxis.forEach(u=>{u.groupType==="d"?c.push(u.id):d.push(u.id)}),c.includes(e.data.name)?l.dimensionList=l.dimensionList.filter(u=>u.id===e.data.name):d.includes(e.data.name)&&(l.dimensionList=l.dimensionList.filter(u=>c.includes(u.id))),s.value}const n={option:"jump",name:a.pointParam.data.name,viewId:s.value.id,dimensionList:a.pointParam.data.dimensionList,quotaList:a.pointParam.data.quotaList,sourceType:a.pointParam.data.sourceType},o={option:"pointClick",name:a.pointParam.data.name,viewId:s.value.id,dimensionList:a.pointParam.data.dimensionList,quotaList:a.pointParam.data.quotaList};switch(t){case"pointClick":P("onPointClick",o);break;case"linkageAndDrill":b.addViewTrackFilter(l),P("onChartClick",e);break;case"drill":P("onChartClick",e);break;case"linkage":b.addViewTrackFilter(l);break;case"jump":if(_.value&&!B.value)return;P("onJumpClick",n);break;case"enlarge":s.value.type==="table-info"&&((p=e.data.dimensionList)==null||p.forEach(c=>{c.id===a.curActionId&&(a.imgSrc=c.value,a.imgEnlarge=!0)}));break}},h=k(()=>["table-info","table-normal"].includes(s.value.type)&&a.curActionId?ae(a.curActionId):Ie.value),Ie=k(()=>{var n,o,r,p;let t=[];if(T.value==="viewDialog")return t;let e=0,l=0;return(o=(n=S.value)==null?void 0:n.fields)==null||o.forEach(c=>{const d=s.value.id+"#"+c.id;J.value[d]&&e++,U.value[d]&&l++}),l&&((r=s.value)!=null&&r.jumpActive)&&(!_.value||B.value)&&t.push("jump"),e&&((p=s.value)!=null&&p.linkageActive)&&t.push("linkage"),s.value.drillFields.length&&t.push("drill"),t.length===3&&f.element.actionSelection.linkageActive==="auto"?t=["jump","linkageAndDrill"]:t.length===2&&f.element.actionSelection.linkageActive==="auto"&&!t.includes("jump")&&(t=["linkageAndDrill"]),t}),ae=t=>{var p,c,d;let e=[];if(T.value==="viewDialog")return e;let l=0,n=0,o=0;const r=s.value.id+"#"+t;return J.value[r]&&l++,U.value[r]&&n++,n&&((p=s.value)!=null&&p.jumpActive)&&(!_.value||B.value)&&e.push("jump"),l&&((c=s.value)!=null&&c.linkageActive)&&e.push("linkage"),s.value.drillFields.length&&s.value.drillFields[fe.value].id===t&&o++,o&&e.push("drill"),e.length===3&&f.element.actionSelection.linkageActive==="auto"?e=["jump","linkageAndDrill"]:e.length===2&&f.element.actionSelection.linkageActive==="auto"&&!e.includes("jump")&&(e=["linkageAndDrill"]),s.value.type==="table-info"&&((d=s.value.xAxis)==null||d.forEach(u=>{u.id===t&&u.deType===7&&e.push("enlarge")})),e},ze=t=>{var c,d;if(i!=null&&i.facet.timer&&(i==null||i.facet.timer.stop(),re(z)),T.value!=="canvas")return;const e=t.info.meta.field,{basicStyle:l}=s.value.customAttr,n=document.getElementById(I).offsetWidth,o=(c=l.tableFieldWidth)==null?void 0:c.find(u=>u.fieldId===e);let r;const p=parseFloat((t.info.resizedWidth/n*100).toFixed(2));if(o)o.width=p,r=[...l.tableFieldWidth];else{const u={fieldId:e,width:p};r=(d=l.tableFieldWidth)!=null&&d.length?[...l.tableFieldWidth,u]:[u]}G.emit("set-table-column-width",r)};pe({calcData:D,renderChart:H,renderChartFromDialog:ve,trackMenu:h});let V;const Ae=(t,e)=>{V&&clearTimeout(V),V=setTimeout(()=>{var l,n;i!=null&&i.facet?((n=(l=i==null?void 0:i.facet)==null?void 0:l.timer)==null||n.stop(),i==null||i.changeSheetSize(t,e),i==null||i.render()):$(!1),z()},500)},g=[0,0];let A;Je(()=>{A=new ResizeObserver(([t]=[])=>{const[e]=t.borderBoxSize||[];g[0]||g[1]||(g[0]=e.inlineSize,g[1]=e.blockSize);const l=Math.abs(e.inlineSize-g[0]),n=Math.abs(e.blockSize-g[1]);l<ce&&n<ce||(g[0]=e.inlineSize,g[1]=e.blockSize,Ae(e.inlineSize,Math.round(e.blockSize)))}),A.observe(document.getElementById(I))}),Ue(()=>{var t;try{(t=i==null?void 0:i.facet.timer)==null||t.stop(),i==null||i.destroy(),i=null,A==null||A.disconnect()}catch(e){console.warn(e)}});const Te=k(()=>Me()?{height:20*v.value+8+"px",width:100/v.value+"%!important",left:50*(1-1/v.value)+"%",transform:"scale("+v.value+") translateZ(0)"}:{zoom:v.value}),Ee=k(()=>{var t;return[{"--de-pager-color":(t=Y.value.component.seniorStyleSetting)==null?void 0:t.pagerColor}]}),xe=k(()=>{var t;return["#ffffff","#ffffffff","#a6a6a6ff"].includes((t=Y.value.component.seniorStyleSetting)==null?void 0:t.pagerColor.toLowerCase())&&"table-page-info_dark"});return(t,e)=>{const l=Ve,n=De;return y(),oe(Ke,null,[C("div",dt,[ie(et,{ref_key:"viewTrack",ref:Q,"track-menu":h.value,"font-family":W.fontFamily,class:"track-bar",style:R(a.trackBarStyle),onTrackClick:L,"is-data-v-mobile":O(K),onMousemove:ee},null,8,["track-menu","font-family","style","is-data-v-mobile"]),w.value?N("",!0):(y(),oe("div",mt,[C("div",{id:I,style:{position:"relative",height:"100%"},onMousemove:ee,onMouseleave:he},null,32)])),ke.value&&!w.value?(y(),x(l,{key:1,style:R(Te.value)},{default:le(()=>[C("div",{class:Ye(["table-page-info",xe.value]),style:R(Ee.value),onKeydown:e[4]||(e[4]=ne(()=>{},["stop"])),onKeyup:e[5]||(e[5]=ne(()=>{},["stop"]))},[C("div",null,"共"+Ge(a.pageInfo.total)+"条",1),a.pageStyle!=="general"?(y(),x(O(se),{key:0,class:"table-page-content",layout:"prev, pager, next","page-size":a.pageInfo.pageSize,"onUpdate:pageSize":e[0]||(e[0]=o=>a.pageInfo.pageSize=o),"current-page":a.pageInfo.currentPage,"onUpdate:currentPage":[e[1]||(e[1]=o=>a.pageInfo.currentPage=o),te],"pager-count":5,total:a.pageInfo.total},null,8,["page-size","current-page","total"])):(y(),x(O(se),{key:1,class:"table-page-content",layout:"prev, pager, next, sizes, jumper","page-size":a.pageInfo.pageSize,"onUpdate:pageSize":[e[2]||(e[2]=o=>a.pageInfo.pageSize=o),ye],"current-page":a.pageInfo.currentPage,"onUpdate:currentPage":[e[3]||(e[3]=o=>a.pageInfo.currentPage=o),te],"pager-count":5,total:a.pageInfo.total},null,8,["page-size","current-page","total"]))],38)]),_:1},8,["style"])):N("",!0),w.value?(y(),x(tt,{key:2,"err-msg":Z.value},null,8,["err-msg"])):N("",!0)]),ie(n,{modelValue:a.imgEnlarge,"onUpdate:modelValue":e[6]||(e[6]=o=>a.imgEnlarge=o),"append-to-body":"",class:"image-dialog"},{default:le(()=>[C("div",ft,[C("img",{src:a.imgSrc,style:{width:"100%",height:"100%","object-fit":"contain"}},null,8,gt)])]),_:1},8,["modelValue"])],64)}}});const Ca=pt(vt,[["__scopeId","data-v-e517e62c"]]);export{Ca as default};

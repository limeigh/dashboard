import{b as C,z as V}from"./index-0.0.0-dataease.js";import{o as D,K as E,x as q,y as z}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import{E as B,a as F}from"./el-form-item-0.0.0-dataease.js";import{d as O,r as p,X as S,o as N,R as P,f as R,O as A,P as o,a4 as v,u as c,j as u,i as w,a8 as L,a3 as M}from"./vue-0.0.0-dataease.js";import{useAppStoreWithOut as U}from"./app-0.0.0-dataease.js";import{r as K}from"./encryption-0.0.0-dataease.js";import{_ as T}from"./CustomPassword.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{_ as W}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./index-0.0.0-dataease4.js";import"./index-0.0.0-dataease3.js";import"./_commonjs-dynamic-modules-0.0.0-dataease.js";import"./dataset-0.0.0-dataease.js";import"./icon_visible_outlined-0.0.0-dataease.js";import"./icon_invisible_outlined-0.0.0-dataease.js";const X={class:"pwd-body"},Z={class:"pwd-wrapper"},j={class:"pwd-content"},G={class:"span-header"},H={class:"bi-text"},J={style:{"text-align":"center"}},Q={class:"input-layout"},Y={class:"input-main"},ee={class:"div-input"},te={class:"abs-input"},se={class:"input-text"},oe={class:"auth-root-class"},ae=O({__name:"pwd",setup(re){const{wsCache:_}=C(),h=U(),{t:i}=D(),g=p(""),m=p(!0),f=p(),b=p(""),l=p({password:""}),k=S({password:[{required:!0,message:i("pblink.key_pwd"),trigger:"blur"},{required:!0,pattern:/^[A-Za-z\d!@#$%^&*()_+]{4,10}$/,message:i("pblink.pwd_format_error"),trigger:"blur"}]}),y=async e=>{e&&await e.validate((t,s)=>{if(t){const r=b.value,a=l.value.password,n=`${r},${a}`,d=K(n);q.post({url:"/share/validate",data:{ciphertext:d}}).then($=>{$.data?(_.set(`link-${r}`,d),window.location.reload()):g.value="密码错误"})}else console.error("error submit!",s)})},I=e=>{try{return decodeURIComponent(e)}catch{return e}},x=()=>{const e=window.location.href,t=e.lastIndexOf("?"),s=e.substring(e.lastIndexOf("de-link/")+8,t>0?t:e.length);let r=null,a=null;if(s!=null&&s.includes(",")){const n=s.indexOf(",");r=s.substring(0,n),s.length>n+1&&(a=s.substring(n+1))}else r=s;b.value=r,a&&(a=I(a),l.value.password=a,y(f.value))};return N(()=>{_.get(h.getDekey)?(x(),m.value=!1):E().then(e=>{_.set(h.getDekey,e.data),x()}).finally(()=>{m.value=!1})}),(e,t)=>{const s=B,r=F,a=z,n=V;return P((R(),A("div",X,[o("div",Z,[o("div",j,[o("div",G,[o("div",H,[o("span",J,v(c(i)("pblink.key_pwd")),1)])]),o("div",Q,[o("div",Y,[o("div",ee,[u(r,{ref_key:"pwdForm",ref:f,model:l.value,rules:k,size:"small",onSubmit:t[1]||(t[1]=L(()=>{},["stop","prevent"]))},{default:w(()=>[u(s,{label:"",prop:"password"},{default:w(()=>[u(c(T),{modelValue:l.value.password,"onUpdate:modelValue":t[0]||(t[0]=d=>l.value.password=d),maxlength:"10",minlength:"4","show-password":"",class:"real-input",placeholder:c(i)("pblink.input_placeholder")},null,8,["modelValue","placeholder"])]),_:1})]),_:1},8,["model","rules"])])]),o("div",te,[o("div",se,v(g.value),1)])]),o("div",oe,[u(a,{size:"small",type:"primary",onClick:t[2]||(t[2]=d=>y(f.value))},{default:w(()=>[M(v(c(i)("pblink.sure_bt")),1)]),_:1})])])])])),[[n,m.value]])}}});const Ce=W(ae,[["__scopeId","data-v-52a69bb2"]]);export{Ce as default};

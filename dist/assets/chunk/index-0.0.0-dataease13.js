import{E as fe,e as be,i as Te,h as ye,p as we,r as ke,y as Se,t as ge,v as Ce,A as xe}from"./element-plus-secondary-0.0.0-dataease.js";import{i as Fe,f as Me,e as Pe}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as Ee,r as $,k,l as Ae,w as M,b as Ie,n as C,ae as Z,o as n,c as T,$ as v,a0 as f,T as c,U as o,W as l,a as _,Y as b,_ as P,u,R as x,S as y,a8 as E,z as Ve,Z as Ue}from"./@vue-0.0.0-dataease.js";import{n as Ne,a as Re}from"./templateMarket-0.0.0-dataease.js";import{a as Oe,e as Le,g as O,x as We,u as ze}from"./index-0.0.0-dataease.js";import{useAppStoreWithOut as Be}from"./app-0.0.0-dataease.js";import{e as De}from"./element-resize-detector-0.0.0-dataease.js";import $e from"./MarketPreviewV2-0.0.0-dataease.js";import{i as J}from"./imgUtils-0.0.0-dataease.js";import q from"./CategoryTemplateV2-0.0.0-dataease.js";import Ze from"./TemplateSkeleton-0.0.0-dataease.js";import{i as Je}from"./interactive-0.0.0-dataease.js";import{g as H}from"./js-base64-0.0.0-dataease.js";import{_ as qe}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./lodash-es-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./pinia-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./fast-png-0.0.0-dataease.js";import"./iobuffer-0.0.0-dataease.js";import"./pako-0.0.0-dataease.js";import"./vue-router_2-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";import"./login-0.0.0-dataease.js";import"./batch-processor-0.0.0-dataease.js";import"./icon_left_outlined-0.0.0-dataease.js";import"./icon-filter-0.0.0-dataease.js";import"./TemplateMarketPreviewItem-0.0.0-dataease.js";import"./html2canvas-0.0.0-dataease.js";import"./dvMain-0.0.0-dataease.js";import"./chart-0.0.0-dataease.js";import"./chart-0.0.0-dataease2.js";import"./dataset-0.0.0-dataease.js";import"./decimal.js-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./snowflake-id-0.0.0-dataease.js";import"./index-0.0.0-dataease12.js";import"./@antv-0.0.0-dataease.js";import"./eventemitter3-0.0.0-dataease.js";import"./@mapbox-0.0.0-dataease.js";import"./pbf-0.0.0-dataease.js";import"./ieee754-0.0.0-dataease.js";import"./supercluster-0.0.0-dataease.js";import"./gl-matrix-0.0.0-dataease.js";import"./tslib-0.0.0-dataease.js";import"./detect-browser-0.0.0-dataease.js";import"./size-sensor-0.0.0-dataease.js";import"./d3-regression-0.0.0-dataease.js";import"./d3-hierarchy-0.0.0-dataease.js";import"./fmin-0.0.0-dataease.js";import"./pdfast-0.0.0-dataease.js";import"./d3-ease-0.0.0-dataease.js";import"./d3-interpolate-0.0.0-dataease.js";import"./d3-color-0.0.0-dataease.js";import"./d3-timer-0.0.0-dataease.js";import"./fecha-0.0.0-dataease.js";import"./topojson-client-0.0.0-dataease.js";import"./viewport-mercator-project-0.0.0-dataease.js";import"./@turf-0.0.0-dataease.js";import"./polygon-clipping-0.0.0-dataease.js";import"./splaytree-0.0.0-dataease.js";import"./robust-predicates-0.0.0-dataease.js";import"./d3-scale-0.0.0-dataease.js";import"./d3-collection-0.0.0-dataease.js";import"./d3-format-0.0.0-dataease.js";import"./d3-time-format-0.0.0-dataease.js";import"./d3-time-0.0.0-dataease.js";import"./d3-array-0.0.0-dataease.js";import"./earcut-0.0.0-dataease.js";import"./regl-0.0.0-dataease.js";import"./mapbox-gl-0.0.0-dataease.js";import"./d3-dsv-0.0.0-dataease.js";import"./geojson-vt-0.0.0-dataease.js";import"./hammerjs-0.0.0-dataease.js";import"./d3-hexbin-0.0.0-dataease.js";import"./mathjs-0.0.0-dataease.js";import"./typed-function-0.0.0-dataease.js";import"./complex.js-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./exceljs-0.0.0-dataease.js";import"./file-saver-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./less-0.0.0-dataease.js";import"./copy-anything-0.0.0-dataease.js";import"./is-what-0.0.0-dataease.js";import"./html-to-image-0.0.0-dataease.js";import"./TemplateMarketV2Item-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease.js";import"./datasource-0.0.0-dataease.js";const He=["src"],Ge={class:"template-left"},Xe=["title"],je={id:"template-show-area",class:"template-right",style:{"padding-top":"16px"}},Ye={style:{"text-align":"center"}},Ke=Ee({__name:"index",emits:["close"],setup(Qe,{expose:G,emit:X}){const{t:i}=Me(),{wsCache:A}=Oe(),S=Le(),L=Be(),j=Je(),d=$("full"),Y=X,W=()=>{Y("close")},K=k(()=>e.curPosition==="branch"?i("work_branch.template_center"):i("work_branch.new_using_template")),Q=k(()=>L.getIsDataEaseBi||L.getIsIframe),e=Ae({initReady:!0,curPosition:"branch",pid:null,treeProps:{value:"label",label:"label"},templateType:"all",templateSourceType:"all",templateClassifyType:"all",treeShow:!0,templateClassifyOptions:[{value:"all",label:i("visualization.all_type")},{value:"app",label:i("visualization.apply_template")},{value:"template",label:i("visualization.style_template")}],templateSourceOptions:[{value:"all",label:i("work_branch.all_source")},{value:"market",label:i("visualization.template_market")},{value:"manage",label:i("template_manage.name")}],templateTypeOptions:[{value:"all",label:i("work_branch.all_types")},{value:"PANEL",label:i("work_branch.dashboard")},{value:"SCREEN",label:i("work_branch.big_data_screen")}],loading:!1,hasResult:!0,templateMiniWidth:250,templateCurWidth:310,templateSpan:"25%",previewVisible:!1,templatePreviewId:"",marketTabs:[],marketActiveTab:null,searchText:null,dvCreateForm:{resourceName:null,name:null,pid:null,nodeType:"panel",templateUrl:null,newFrom:"new_market_template",templateId:null,panelType:"self",panelStyle:{},panelData:"[]"},panelGroupList:[],curApplyTemplate:null,folderSelectShow:!1,baseUrl:"https://dataease.io/templates",currentMarketTemplateShowList:[],curTemplateShowFilter:[],curTemplateIndex:0,curTemplate:null,networkStatus:!0,rule:{name:[{required:!0,message:i("visualization.template_name_tips"),trigger:"blur"}],pid:[{required:!0,message:"",trigger:"blur"}]}}),I=k(()=>{var a,p,s,h;const t=j.getData;return{PANEL:((a=t[0])==null?void 0:a.menuAuth)&&((p=t[0])==null?void 0:p.anyManage),SCREEN:((s=t[1])==null?void 0:s.menuAuth)&&((h=t[1])==null?void 0:h.anyManage)}}),z=k(()=>{let t;return e.templateSourceType==="all"?t=e.marketTabs:t=e.marketTabs.filter(a=>a.source==="public"||a.source===e.templateSourceType),t}),ee=k(()=>e.curTemplate.thumbnail.indexOf("http")>-1||e.curTemplate.thumbnail.indexOf("static-resource")>-1?J(e.curTemplate.thumbnail):J(e.baseUrl+e.curTemplate.thumbnail)),te=k(()=>e.curPosition==="branch"&&d.value!=="marketPreview"),ae=t=>{e.initReady=!1,e.curPosition=t.curPosition,e.templateType=t.templateType,d.value="full",e.pid=t.pid,C(()=>{e.initReady=!0})};M(()=>e.searchText,()=>{w()}),M(()=>e.templateType,()=>{w()}),M(()=>e.templateSourceType,()=>{e.treeShow=!1,w(),C(()=>{e.treeShow=!0,V()})}),M(()=>e.templateClassifyType,()=>{e.treeShow=!1,w(),C(()=>{e.treeShow=!0,V()})});const le=t=>{e.marketActiveTab=t.label,w()},re=()=>{d.value="full"},oe=async()=>{await Re().then(t=>{e.baseUrl=t.data.baseUrl,e.currentMarketTemplateShowList=t.data.contents,V(),w();const a=We(e.currentMarketTemplateShowList);e.marketTabs=t.data.categories.filter(p=>a.has(p.label)),e.marketActiveTab=e.marketTabs[1].label}).catch(t=>{console.error("searchMarket:",t),e.networkStatus=!1})},V=()=>{C(()=>{const t=document.querySelector(".custom-market-tree"),a=document.createElement("hr");a.classList.add("custom-line"),t.firstElementChild.appendChild(a)})},ie=()=>{e.curTemplateIndex>0&&(e.curTemplateIndex--,e.curTemplate=e.curTemplateShowFilter[e.curTemplateIndex])},pe=()=>{e.curTemplateIndex<e.curTemplateShowFilter.length-1&&(e.curTemplateIndex++,e.curTemplate=e.curTemplateShowFilter[e.curTemplateIndex])},F=t=>{e.curApplyTemplate=t,e.dvCreateForm.name=t.title,e.dvCreateForm.nodeType=t.templateType,t.source==="market"?(e.dvCreateForm.newFrom="new_market_template",e.dvCreateForm.templateUrl=t.metas.theme_repo,e.dvCreateForm.resourceName=t.id):(e.dvCreateForm.newFrom="new_inner_template",e.dvCreateForm.templateId=t.id),ne()},ne=()=>{if(e.dvCreateForm.newFrom==="new_market_template"&&!e.dvCreateForm.templateUrl)return fe.warning(i("template_manage.get_download_link_hint")),!1;const t={newFrom:e.dvCreateForm.newFrom,templateUrl:e.dvCreateForm.templateUrl,resourceName:e.dvCreateForm.resourceName,templateId:e.dvCreateForm.templateId};e.curApplyTemplate.recentUseTime=Date.now(),e.curApplyTemplate.categoryNames.push(i("work_branch.recent"));const a=(["dataV","SCREEN"].includes(e.dvCreateForm.nodeType)?"#/dvCanvas?opt=create&createType=template":"#/dashboard?opt=create&createType=template")+"&templateParams="+encodeURIComponent(H.encode(JSON.stringify(t)));let p=null;if(Q.value){S.clearState(),S.setCreateType("template"),S.setTemplateParams(encodeURIComponent(H.encode(JSON.stringify(t)))),S.setOpt("create"),e.pid&&S.setPid(e.pid),ze().emitter.emit("changeCurrentComponent",["dataV","SCREEN"].includes(e.dvCreateForm.nodeType)?"VisualizationEditor":"DashboardEditor");return}const s=A.get(O("open-backend"))==="1"?"_self":"_blank";e.pid?p=window.open(a+`&pid=${e.pid}`,s):p=window.open(a,s),me(p)},g=$(null),me=t=>{if(g!=null&&g.value){const a={methodName:"initOpenHandler",args:t};g.value.invokeMethod(a)}},w=()=>{let t=!1;e.currentMarketTemplateShowList.forEach(a=>{a.showFlag=se(a),a.showFlag&&(t=!0)}),e.currentMarketTemplateShowList.length>0&&(e.hasResult=t)},se=t=>{let a=!1,p=!1,s=!1,h=!1;return(!e.searchText||t.title.indexOf(e.searchText)>-1)&&(a=!0),(e.templateType==="all"||t.templateType===e.templateType)&&(p=!0),(e.templateSourceType==="all"||t.source===e.templateSourceType)&&(s=!0),(e.templateClassifyType==="all"||t.classify===e.templateClassifyType)&&(h=!0),a&&p&&s&&h},U=t=>{e.curPosition==="branch"?(e.templatePreviewId=t,d.value="marketPreview"):(e.curTemplateShowFilter=e.marketActiveTab===i("work_branch.recommend")?e.currentMarketTemplateShowList.filter(a=>a.showFlag):e.currentMarketTemplateShowList.filter(a=>{var p;return a.showFlag&&((p=a.categoryNames)==null?void 0:p.includes(e.marketActiveTab))}),e.curTemplateIndex=e.curTemplateShowFilter.findIndex(a=>a.id===t),e.curTemplate=e.curTemplateShowFilter[e.curTemplateIndex],d.value="createPreview")};Ie(()=>{ue(),oe();const t=De(),a=document.getElementById("template-show-area");a&&t.listenTo(a,()=>{C(()=>{const p=a.offsetWidth-26,s=Math.trunc(p/e.templateMiniWidth);e.templateSpan=100/Math.trunc(p/e.templateMiniWidth)+"%",e.templateCurWidth=Math.trunc(p/s)-33})})});const ue=()=>{const t=A.get(O("template-preview-id"));t&&(U(t),A.delete(O("template-preview-id")))};return G({optInit:ae}),(t,a)=>{const p=Z("ArrowLeft"),s=be,h=Te,B=ye,D=Z("Close"),m=we,ce=ke,N=xe,R=Se,de=ge,he=Pe,_e=Ce;return n(),T(y,null,[v((n(),c(m,{class:Ve(["template-outer-body",{"template-outer-body-padding":te.value}])},{default:o(()=>[v(l($e,{"preview-id":e.templatePreviewId,"create-auth":I.value,onClosePreview:re,onTemplateApply:F},null,8,["preview-id","create-auth"]),[[f,d.value==="marketPreview"]]),d.value==="createPreview"?(n(),c(m,{key:0,class:"main-container"},{default:o(()=>[l(m,{class:"market-head"},{default:o(()=>[l(s,{class:"custom-back-icon hover-icon",onClick:a[0]||(a[0]=r=>d.value="full")},{default:o(()=>[l(p)]),_:1}),_("span",null,b(e.curTemplate.title),1),l(m,{class:"head-right"},{default:o(()=>[l(h,{secondary:"",disabled:e.curTemplateIndex===0,style:{float:"right"},onClick:ie},{default:o(()=>[P(b(u(i)("work_branch.last")),1)]),_:1},8,["disabled"]),l(h,{disabled:e.curTemplateIndex===e.curTemplateShowFilter.length-1,style:{float:"right"},secondary:"",onClick:pe},{default:o(()=>[P(b(u(i)("work_branch.next")),1)]),_:1},8,["disabled"]),l(h,{style:{float:"right"},type:"primary",onClick:a[1]||(a[1]=r=>F(e.curTemplate))},{default:o(()=>[P(b(u(i)("visualization.apply_this_template")),1)]),_:1}),l(B,{class:"custom-divider-line",direction:"vertical"}),l(s,{class:"custom-market-icon hover-icon_custom",onClick:W},{default:o(()=>[l(D)]),_:1})]),_:1})]),_:1}),l(m,{class:"template-area"},{default:o(()=>[l(m,{class:"img-main-create"},{default:o(()=>[_("img",{style:{height:"100%"},src:ee.value,alt:""},null,8,He)]),_:1})]),_:1})]),_:1})):x("",!0),v(l(m,{class:"main-container"},{default:o(()=>[l(m,{class:"market-head"},{default:o(()=>[_("span",null,b(K.value),1),l(m,{class:"head-right"},{default:o(()=>[l(ce,{class:"title-search",modelValue:e.searchText,"onUpdate:modelValue":a[2]||(a[2]=r=>e.searchText=r),"prefix-icon":"Search",placeholder:u(i)("visualization.enter_template_name_tips"),clearable:!0},null,8,["modelValue","placeholder"]),l(R,{class:"title-type",modelValue:e.templateSourceType,"onUpdate:modelValue":a[3]||(a[3]=r=>e.templateSourceType=r),placeholder:"Select"},{default:o(()=>[(n(!0),T(y,null,E(e.templateSourceOptions,r=>(n(),c(N,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),["branchCreate","branch"].includes(e.curPosition)?(n(),c(R,{key:0,class:"title-type",modelValue:e.templateType,"onUpdate:modelValue":a[4]||(a[4]=r=>e.templateType=r),placeholder:"Select"},{default:o(()=>[(n(!0),T(y,null,E(e.templateTypeOptions,r=>(n(),c(N,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):x("",!0),l(R,{class:"title-type",modelValue:e.templateClassifyType,"onUpdate:modelValue":a[5]||(a[5]=r=>e.templateClassifyType=r),placeholder:"Select"},{default:o(()=>[(n(!0),T(y,null,E(e.templateClassifyOptions,r=>(n(),c(N,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),["branchCreate","create"].includes(e.curPosition)?(n(),T(y,{key:1},[l(B,{class:"custom-divider-line",direction:"vertical"}),l(s,{class:"custom-market-icon hover-icon_custom",onClick:W},{default:o(()=>[l(D)]),_:1})],64)):x("",!0)]),_:1})]),_:1}),l(m,{class:"template-area"},{default:o(()=>[_("div",Ge,[e.treeShow?(n(),c(de,{key:0,menu:"",class:"custom-market-tree",modelValue:e.marketActiveTab,"onUpdate:modelValue":a[6]||(a[6]=r=>e.marketActiveTab=r),data:z.value,props:e.treeProps,"node-key":"label","default-expand-all":"","highlight-current":"","current-node-key":e.marketActiveTab,onNodeClick:le},{default:o(({data:r})=>[_("span",{title:r.label,class:"ed-tree-node__label"},b(r.label),9,Xe)]),_:1},8,["modelValue","data","props","current-node-key"])):x("",!0)]),v(_("div",je,[e.marketActiveTab===null?(n(),c(m,{key:0},{default:o(()=>[l(Ze,{width:e.templateCurWidth},null,8,["width"])]),_:1})):(n(),T(y,{key:1},[v(l(m,null,{default:o(()=>[l(q,{"search-text":e.searchText,label:e.marketActiveTab,"full-template-show-list":e.currentMarketTemplateShowList,"template-span":e.templateSpan,"base-url":e.baseUrl,"template-cur-width":e.templateCurWidth,"cur-position":e.curPosition,"create-auth":I.value,onTemplateApply:F,onTemplatePreview:U},null,8,["search-text","label","full-template-show-list","template-span","base-url","template-cur-width","cur-position","create-auth"])]),_:1},512),[[f,e.marketActiveTab!==u(i)("work_branch.recommend")]]),v(l(m,null,{default:o(()=>[(n(!0),T(y,null,E(z.value,(r,ve)=>(n(),c(m,{style:Ue([{display:"inline",width:"100%","margin-bottom":"32px"},{marginBottom:r.label!==u(i)("work_branch.recent")?"32px":0}]),key:ve},{default:o(()=>[r.label!==u(i)("work_branch.recent")?(n(),c(q,{key:0,"search-text":e.searchText,label:r.label,"full-template-show-list":e.currentMarketTemplateShowList,"template-span":e.templateSpan,"base-url":e.baseUrl,"template-cur-width":e.templateCurWidth,"cur-position":e.curPosition,"create-auth":I.value,onTemplateApply:F,onTemplatePreview:U},null,8,["search-text","label","full-template-show-list","template-span","base-url","template-cur-width","cur-position","create-auth"])):x("",!0)]),_:2},1032,["style"]))),128))]),_:1},512),[[f,e.marketActiveTab===u(i)("work_branch.recommend")]])],64))],512),[[f,e.networkStatus&&e.hasResult]]),v(l(m,{class:"template-empty"},{default:o(()=>[_("div",Ye,[l(he,{name:"no_result"},{default:o(()=>[l(u(Ne),{style:{"margin-bottom":"16px","font-size":"75px"},class:"svg-icon"})]),_:1}),a[7]||(a[7]=_("br",null,null,-1)),_("span",null,b(u(i)("work_branch.relevant_templates_found")),1)])]),_:1},512),[[f,e.networkStatus&&!e.hasResult]]),v(l(m,{class:"template-empty"},{default:o(()=>[P(" 111 "+b(u(i)("visualization.market_network_tips",[e.baseUrl])),1)]),_:1},512),[[f,!e.networkStatus]])]),_:1})]),_:1},512),[[f,d.value==="full"]])]),_:1},8,["class"])),[[_e,e.loading],[f,e.initReady]]),l(u(Fe),{ref_key:"openHandler",ref:g,jsname:"L2NvbXBvbmVudC9lbWJlZGRlZC1pZnJhbWUvT3BlbkhhbmRsZXI="},null,512)],64)}}});const xl=qe(Ke,[["__scopeId","data-v-b2ba3a8b"]]);export{xl as default};

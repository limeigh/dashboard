import{aO as Tt,a as xa,z as Ol,b as xn,R as Ln}from"./index-0.0.0-dataease.js";import{n as Ga,j as Ht,y as nt,o as ha,D as Oe,G as zt,F as hl,i as Ut,ax as Yn}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{f as c,O as q,P as h,d as Pe,r as K,g as U,i as r,j as u,a3 as J,a4 as w,u as a,s as it,y as N,a6 as _e,W as ie,a8 as Ge,t as ia,w as ce,aj as qa,_ as j,S as Te,l as ze,G as Un,ao as Bn,n as Me,a2 as Qt,x as Ue,T as Ae,ah as Il,ai as Gn,o as Kt,R as Xa,aD as Ct,af as Mt,X as Al,U as El,at as Ya,L as ga,m as Pn,a9 as _l,a as Wn}from"./vue-0.0.0-dataease.js";import{i as Ua}from"./icon_edit_outlined-0.0.0-dataease.js";import{i as Zt}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import{e as jn}from"./eventBus-0.0.0-dataease.js";import{_ as Ja,c as ba}from"./appearance-0.0.0-dataease.js";import{s as Nl}from"./snapshot-0.0.0-dataease.js";import{b as Hn}from"./library-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import{E as zn,a as Qn}from"./el-form-item-0.0.0-dataease.js";import{E as Jt}from"./el-dialog-0.0.0-dataease.js";import{E as Rl}from"./el-popover-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import{a as Pa,E as Ye}from"./el-select-0.0.0-dataease.js";import"./el-tree-0.0.0-dataease.js";import{E as Xt,a as Kn}from"./el-checkbox-0.0.0-dataease.js";import{E as xl}from"./el-tree-select-0.0.0-dataease.js";import"./el-checkbox-group-0.0.0-dataease.js";import{E as Zn,a as Jn}from"./el-tabs-0.0.0-dataease.js";import"./el-radio-group-0.0.0-dataease.js";import"./el-radio-0.0.0-dataease.js";import{_ as Xn}from"./HandleMore.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import{m as ei}from"./more_v-0.0.0-dataease.js";import{i as bt}from"./icon_add_outlined-0.0.0-dataease.js";import{i as ai}from"./icon_drag_outlined-0.0.0-dataease.js";import{i as ti}from"./icon_visible_outlined-0.0.0-dataease.js";import{d as gl}from"./dv-folder-0.0.0-dataease.js";import{i as bl}from"./icon_dataset-0.0.0-dataease.js";import{i as li}from"./icon_warning_filled-0.0.0-dataease.js";import{i as ni}from"./icon_info_outlined-0.0.0-dataease.js";import{G as ii,C as Ll,H as ui,I as ri,J as oi,K as Vl,a as si}from"./dataset-0.0.0-dataease.js";import{d as Yl}from"./vuedraggable-es-0.0.0-dataease.js";import{e as qe,c as di,g as ci,h as Ul}from"./lodash-0.0.0-dataease.js";import{g as Bl}from"./util-0.0.0-dataease.js";import{g as et,a as mi,b as vi,c as pi,d as fi,e as yi,f as hi,h as _i,i as gi,j as bi}from"./time-format-0.0.0-dataease.js";import{d as ut}from"./dvMain-0.0.0-dataease.js";import{g as ya,a as Ze,b as el,c as wa,d as at}from"./time-format-dayjs-0.0.0-dataease.js";import{f as Se}from"./attr-0.0.0-dataease23.js";import{E as Bt}from"./EmptyBackground-0.0.0-dataease.js";import{d as ke}from"./dayjs.min-0.0.0-dataease.js";import{E as Vi}from"./el-time-picker-0.0.0-dataease.js";import"./el-input-number-0.0.0-dataease.js";import{i as ki}from"./icon_admin_outlined-0.0.0-dataease.js";import{E as rt}from"./el-date-picker-0.0.0-dataease.js";import{E as ot,a as st}from"./index-0.0.0-dataease27.js";import{E as Ft}from"./index-0.0.0-dataease20.js";import{s as Ti}from"./index-0.0.0-dataease28.js";import{c as Wa,i as Ci,e as $a,a as kt,n as Gt,m as ft,b as tt,u as Gl,d as Pl,p as Wl,f as Va,t as jl,g as Hl,h as Mi,j as lt,k as Fi,l as Si,o as Ia,q as zl,w as St,r as kl}from"./index-0.0.0-dataease29.js";import{u as wi,a as wt}from"./use-route-0.0.0-dataease.js";import{L as $i}from"./index-0.0.0-dataease31.js";import{H as Tl,B as qi}from"./index-0.0.0-dataease30.js";import{T as Di,a as Oi}from"./index-0.0.0-dataease32.js";import"./index-0.0.0-dataease33.js";import"./el-virtual-list-0.0.0-dataease.js";import{E as Ii}from"./el-select-v2-0.0.0-dataease.js";import{_ as ja}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import{E as al}from"./index-0.0.0-dataease4.js";import{a as Ai}from"./chart-list-0.0.0-dataease.js";import{i as oa}from"./field-list-0.0.0-dataease.js";import{t as Ei}from"./treeSortUtils-0.0.0-dataease.js";const Ni={width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"};function Ri(o,_){return c(),q("svg",Ni,[..._[0]||(_[0]=[h("path",{d:"M8.00022 9.99975C7.56203 9.99975 7.13323 9.96523 6.71734 9.89921L6.38535 11.1382C6.33771 11.316 6.15493 11.4216 5.9771 11.3739L5.33315 11.2014C5.15533 11.1537 5.0498 10.9709 5.09745 10.7931L5.42255 9.57985C4.88013 9.39561 4.37096 9.15494 3.90491 8.86629L2.8454 9.9258C2.71522 10.056 2.50417 10.056 2.37399 9.9258L1.90259 9.4544C1.77242 9.32422 1.77242 9.11317 1.90259 8.98299L2.83565 8.04994C2.35424 7.59918 1.95209 7.0852 1.64812 6.52421C1.64492 6.51832 1.64162 6.51215 1.63823 6.50575C1.5136 6.27038 1.56023 5.97574 1.75709 5.79635C1.92051 5.64743 2.03596 5.5461 2.13639 5.44567C2.14538 5.43669 2.15521 5.42666 2.16569 5.41583C2.31108 5.2656 2.55902 5.32152 2.64417 5.51246C3.47427 7.37398 5.46211 8.66641 8.00022 8.66641C10.4321 8.66641 12.4664 7.40872 13.2829 5.68239C13.3042 5.63747 13.328 5.5809 13.3519 5.52084C13.4276 5.33064 13.6741 5.27325 13.8188 5.41801C13.9259 5.52508 14.0687 5.66784 14.2471 5.8463C14.4235 6.0227 14.4713 6.29211 14.356 6.51334C14.3279 6.56715 14.3006 6.61785 14.2774 6.65816C13.9638 7.20109 13.5572 7.69751 13.0754 8.1321L13.9263 8.98299C14.0565 9.11317 14.0565 9.32422 13.9263 9.4544L13.4549 9.9258C13.3247 10.056 13.1136 10.056 12.9835 9.9258L11.9888 8.93112C11.5521 9.19111 11.0792 9.40958 10.5779 9.57985L10.903 10.7931C10.9506 10.9709 10.8451 11.1537 10.6673 11.2014L10.0233 11.3739C9.84552 11.4216 9.66274 11.316 9.61509 11.1382L9.2831 9.89921C8.86721 9.96523 8.43842 9.99975 8.00022 9.99975Z"},null,-1)])])}const xi={render:Ri},Li={t:"1652583161182",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2172",width:"200",height:"200"};function Yi(o,_){return c(),q("svg",Li,[..._[0]||(_[0]=[h("path",{d:"M362.666667 192m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"2173"},null,-1),h("path",{d:"M661.333333 192m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"2174"},null,-1),h("path",{d:"M362.666667 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"2175"},null,-1),h("path",{d:"M661.333333 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"2176"},null,-1),h("path",{d:"M362.666667 832m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"2177"},null,-1),h("path",{d:"M661.333333 832m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"2178"},null,-1)])])}const Ui={render:Yi},Bi=["title"],Gi={class:"item-span"},Pi={class:"dialog-footer"},Wi=Pe({__name:"CustomSortFilter",emits:["save"],setup(o,{expose:_,emit:n}){const t=K([]),d=K(!1),s=R=>{f(R),d.value=!0},f=R=>{t.value=qe(R)},M=n,D=()=>{d.value=!1},k=()=>{M("save",a(t)),D()};return _({sortInit:s}),(R,B)=>{const m=Ga,V=Ht,F=nt,X=Jt;return c(),U(X,{"destroy-on-close":"","append-to-body":"",title:R.$t("v_query.custom_sort"),modelValue:d.value,"onUpdate:modelValue":B[0]||(B[0]=T=>d.value=T),class:"custom-sort_filter",width:"300px"},{footer:r(()=>[h("div",Pi,[u(F,{onClick:D},{default:r(()=>[J(w(R.$t("common.cancel")),1)]),_:1}),u(F,{type:"primary",onClick:k},{default:r(()=>[J(w(R.$t("chart.confirm")),1)]),_:1})])]),default:r(()=>[h("div",null,[u(a(Yl),{list:t.value,animation:"300",class:"drag-list"},{item:r(({element:T})=>[(c(),q("span",{key:T.name,class:"item-dimension",title:T},[u(V,{size:"20px"},{default:r(()=>[u(m,{name:"drag"},{default:r(()=>[u(a(Ui),{class:"svg-icon"})]),_:1})]),_:1}),h("span",Gi,w(T),1)],8,Bi))]),_:1},8,["list"])])]),_:1},8,["title","modelValue"])}}});const{t:ji}=ha(),Ql=o=>{const{id:_,name:n,deType:t,type:d,datasetId:s}=o;return{id:Bl(),name:n,showError:!0,timeGranularity:"date",timeGranularityMultiple:"datetimerange",field:{id:_,type:d,name:n,deType:t},displayId:_,sortId:"",sort:"asc",defaultMapValue:[],mapValue:[],conditionType:0,conditionValueOperatorF:"eq",conditionValueF:"",conditionValueOperatorS:"like",conditionValueS:"",defaultConditionValueOperatorF:"eq",defaultConditionValueF:"",defaultConditionValueOperatorS:"like",defaultConditionValueS:"",timeType:"fixed",relativeToCurrent:"custom",required:!1,timeNum:0,relativeToCurrentType:"date",around:"f",parametersStart:null,parametersEnd:null,arbitraryTime:new Date,timeNumRange:0,relativeToCurrentTypeRange:"date",aroundRange:"f",arbitraryTimeRange:new Date,auto:!1,defaultValue:void 0,selectValue:void 0,optionValueSource:0,valueSource:[],dataset:{id:s,name:"",fields:[]},visible:!0,defaultValueCheck:!1,multiple:!1,displayType:"0",checkedFields:[],parameters:[],parametersCheck:!1,parametersList:[],checkedFieldsMap:{}}},Hi=()=>{const o={id:"",name:ji("v_query.unnamed"),deType:0,type:"VARCHAR",datasetId:""};return Ql(o)},zi={class:"cascade-content"},Qi={style:{display:"flex","align-items":"center","justify-content":"space-between"}},Ki={class:"cascade-item"},Zi={class:"label"},Ji={class:"item-name"},Xi={class:"label"},eu={class:"item-name"},au={class:"dialog-footer"},tu=Pe({__name:"TreeFieldDialog",emits:["saveTree"],setup(o,{expose:_,emit:n}){const t=K(!1),d=K([]),s=it([]),f=n,{t:M}=ha(),D=()=>{d.value.push({field:{id:""},id:Bl()})},k=()=>{t.value=!1},R=(ae,Q)=>{s.value=qe(ae),d.value=qe(Q).map(H=>({field:H,id:H.id})),t.value=!0},B=N(()=>d.value.map(ae=>ae.field).map(ae=>ae.id)),m=()=>{k()},V=()=>{let ae=!1;return{arr:qe(d.value).map(H=>{var O;return(O=H.field)!=null&&O.id||(ae=!0),H.field}),isError:ae}},F=()=>{const{isError:ae,arr:Q}=V();if(ae){Oe.error(M("v_query.select_a_field"));return}f("saveTree",Q),k()},X=[M("visualization.number1"),M("visualization.number2"),M("visualization.number3"),M("visualization.number4"),M("visualization.number5")],T=ae=>{d.value.splice(ae,1)};return _({init:R}),(ae,Q)=>{const H=Ga,O=nt,g=Pa,se=Ye,fe=Jt;return c(),U(fe,{modelValue:t.value,"onUpdate:modelValue":Q[0]||(Q[0]=e=>t.value=e),width:"600","modal-class":"tree-field_dialog","before-close":k,onMousedown:Q[1]||(Q[1]=Ge(()=>{},["stop"])),onMousedup:Q[2]||(Q[2]=Ge(()=>{},["stop"])),title:a(M)("v_query.tree_structure_design")},{footer:r(()=>[h("div",au,[u(O,{secondary:"",onClick:m},{default:r(()=>[J(w(a(M)("common.cancel")),1)]),_:1}),u(O,{type:"primary",onClick:F},{default:r(()=>[J(w(a(M)("pblink.sure_bt")),1)]),_:1})])]),default:r(()=>[h("div",zi,[h("div",Qi,[u(O,{disabled:d.value.length===5,text:"",onClick:D},{icon:r(()=>[u(H,{name:"icon_add_outlined"},{default:r(()=>[u(a(bt),{class:"svg-icon"})]),_:1})]),default:r(()=>[J(" "+w(a(M)("v_query.add_level")),1)]),_:1},8,["disabled"])]),h("div",Ki,[h("div",Zi,w(a(M)("visualization.level")),1),h("div",Ji,w(a(M)("v_query.tree_query_field")),1)]),(c(!0),q(ie,null,_e(d.value,(e,Ce)=>(c(),q("div",{class:"cascade-item",key:e.id},[h("div",Xi,w(a(M)("visualization.level"))+w(X[Ce]),1),h("div",eu,[u(se,{"value-key":"id",modelValue:e.field,"onUpdate:modelValue":oe=>e.field=oe,style:{width:"300px"}},{default:r(()=>[(c(!0),q(ie,null,_e(s.value,oe=>(c(),U(g,{disabled:B.value.includes(oe.id),key:oe.id,label:oe.name,value:oe},null,8,["disabled","label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"])]),u(O,{onClick:oe=>T(Ce),class:"cascade-delete",text:""},{icon:r(()=>[u(H,{name:"icon_delete-trash_outlined"},{default:r(()=>[u(a(Zt),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]))),128))])]),_:1},8,["modelValue","title"])}}});const Kl=Pe({__name:"DynamicTimeFiltering",props:{config:{type:Object,default:()=>({regularOrTrendsValue:"",intervalType:"none",regularOrTrends:"fixed",relativeToCurrent:"custom",timeNum:0,relativeToCurrentType:"year",around:"f"})},timeGranularityMultiple:{type:String,default:()=>"yearrange"}},setup(o){const _=o,{config:n}=ia(_),t=N(()=>{const{relativeToCurrent:f,regularOrTrends:M,intervalType:D,timeNum:k,relativeToCurrentType:R,around:B}=n.value;return{relativeToCurrent:f,timeNum:k,regularOrTrends:M,intervalType:D,relativeToCurrentType:R,around:B,timeGranularityMultiple:_.timeGranularityMultiple}});ce(()=>t.value,()=>{s()},{deep:!0});const d=N(()=>{const f=_.timeGranularityMultiple.split("time").join("");return n.value.intervalType==="timeInterval"?f:f.split("range")[0]}),s=()=>{const{relativeToCurrent:f,regularOrTrends:M,timeNum:D,relativeToCurrentType:k,around:R}=t.value;if(M==="fixed"){if(n.value.regularOrTrendsValue&&!Array.isArray(n.value.regularOrTrendsValue))return;n.value.regularOrTrendsValue=new Date;return}if(f==="custom")n.value.regularOrTrendsValue=ya(k,R==="f"?"subtract":"add",D);else switch(f){case"thisYear":n.value.regularOrTrendsValue=Ze("year");break;case"lastYear":n.value.regularOrTrendsValue=wa("year");break;case"thisMonth":n.value.regularOrTrendsValue=Ze("month");break;case"lastMonth":n.value.regularOrTrendsValue=wa("month");break;case"today":n.value.regularOrTrendsValue=Ze("day");break;case"yesterday":n.value.regularOrTrendsValue=wa("day");break;case"monthBeginning":n.value.regularOrTrendsValue=Ze("month");break;case"monthEnd":n.value.regularOrTrendsValue=el("month");break;case"yearBeginning":n.value.regularOrTrendsValue=Ze("year");break}};return qa(()=>{s()}),(f,M)=>{const D=rt;return c(),U(D,{disabled:a(n).regularOrTrends!=="fixed",key:d.value,modelValue:a(n).regularOrTrendsValue,"onUpdate:modelValue":M[0]||(M[0]=k=>a(n).regularOrTrendsValue=k),type:d.value,"prefix-icon":a(Tt),placeholder:f.$t("commons.date.select_date_time")},null,8,["disabled","modelValue","type","prefix-icon","placeholder"])}}}),Zl=Pe({__name:"DynamicTimeRangeFiltering",props:{config:{type:Object,default:()=>({timeGranularityMultiple:"daterange",regularOrTrendsValue:[],regularOrTrends:"fixed",timeNum:0,intervalType:"none",relativeToCurrentRange:"custom",relativeToCurrentType:"year",around:"f",timeGranularity:"date",timeNumRange:0,relativeToCurrentTypeRange:"year",aroundRange:"f"})},timeGranularityMultiple:{type:String,default:()=>"yearrange"}},setup(o){const _=o,{config:n}=ia(_),t=N(()=>{const{timeNum:M,relativeToCurrentType:D,around:k,relativeToCurrentRange:R,intervalType:B,regularOrTrends:m,timeGranularity:V,timeNumRange:F,relativeToCurrentTypeRange:X,aroundRange:T}=n.value;return{timeNum:M,relativeToCurrentType:D,around:k,intervalType:B,relativeToCurrentRange:R,regularOrTrends:m,timeGranularity:V,timeNumRange:F,relativeToCurrentTypeRange:X,aroundRange:T,timeGranularityMultiple:_.timeGranularityMultiple}}),d=N(()=>{const M=_.timeGranularityMultiple.split("time").join("");return n.value.intervalType==="timeInterval"?M:M.split("range")[0]});ce(()=>t.value,()=>{s()},{deep:!0});const s=()=>{const{timeNum:M,relativeToCurrentType:D,around:k,relativeToCurrentRange:R,regularOrTrends:B,timeNumRange:m,relativeToCurrentTypeRange:V,aroundRange:F}=t.value;if(B==="fixed"){if(Array.isArray(n.value.regularOrTrendsValue)&&n.value.regularOrTrendsValue.length)return;n.value.regularOrTrendsValue=[ya(V,"add",0),ya(V,"add",1)];return}const X=ya(D,k==="f"?"subtract":"add",M),T=ya(V,F==="f"?"subtract":"add",m);if(R&&R!=="custom"){n.value.regularOrTrendsValue=at(R);return}n.value.regularOrTrendsValue=[X,T]};qa(()=>{s()});const f=N(()=>_.timeGranularityMultiple==="yearrange"?"YYYY":void 0);return(M,D)=>{const k=rt;return c(),U(k,{disabled:a(n).regularOrTrends!=="fixed",modelValue:a(n).regularOrTrendsValue,"onUpdate:modelValue":D[0]||(D[0]=R=>a(n).regularOrTrendsValue=R),key:d.value,type:d.value,"prefix-icon":a(Tt),format:f.value,"popper-class":"custom-dynamic-time-range-filter-popper_class","range-separator":M.$t("cron.to"),"start-placeholder":M.$t("datasource.start_time"),"end-placeholder":M.$t("datasource.end_time")},null,8,["disabled","modelValue","type","prefix-icon","format","range-separator","start-placeholder","end-placeholder"])}}});const lu={class:"set-time-filtering-range"},nu={class:"title"},iu={class:"list-item"},uu={class:"label"},ru={class:"setting-content"},ou={class:"setting"},su={key:0,class:"list-item"},du={class:"label"},cu={class:"setting-content"},mu={class:"setting"},vu={key:0,class:"setting"},pu={class:"setting-label"},fu={class:"setting-value select"},yu={key:1,class:"setting"},hu={class:"setting-input"},_u={class:"setting"},gu={class:"setting-label"},bu={class:"setting-value select"},Vu={class:"setting-label"},ku={class:"setting-input range"},Tu={class:"setting-label"},Cu={class:"setting-input range"},Mu={key:0,class:"setting-label"},Fu={class:"list-item"},Su={class:"label"},wu={key:0,class:"setting-content maximum-single-query"},$u=Pe({__name:"RangeFilterTime",props:{timeRange:{type:Object,default:()=>({intervalType:"none",dynamicWindow:!1,maximumSingleQuery:0,regularOrTrends:"fixed",relativeToCurrentRange:"custom",regularOrTrendsValue:"",relativeToCurrent:"custom",timeNum:0,relativeToCurrentType:"year",around:"f",timeNumRange:0,relativeToCurrentTypeRange:"year",aroundRange:"f"})},timeGranularityMultiple:{type:String,default:"yearrange"}},setup(o){const _=o,{t:n}=ha(),t=[{label:n("chart.line_symbol_none"),value:"none"},{label:n("v_query.start_at"),value:"start"},{label:n("v_query.end_at"),value:"end"},{label:n("v_query.time_interval"),value:"timeInterval"}],d=N(()=>t.find(V=>V.value===s.value.intervalType).label),{timeRange:s}=ia(_),f=N(()=>s.value.regularOrTrends!=="fixed"),M=N(()=>{const{intervalType:V}=s.value;return V==="timeInterval"?Zl:Kl}),D=[{label:n("dynamic_time.before"),value:"f"},{label:n("dynamic_time.after"),value:"b"}],k=N(()=>{if(!s.value)return[];let V=["yearrange","monthrange","daterange","datetimerange"].indexOf(_.timeGranularityMultiple)+1;return[{label:n("dynamic_time.year"),value:"year"},{label:n("dynamic_time.month"),value:"month"},{label:n("dynamic_time.date"),value:"day"}].slice(0,V)}),R=N(()=>(k.value[k.value.length-1]||{}).label),B=N(()=>{let V=[];if(!s.value)return V;switch(_.timeGranularityMultiple){case"yearrange":V=[{label:n("dynamic_year.current"),value:"thisYear"},{label:n("dynamic_year.last"),value:"lastYear"}];break;case"monthrange":V=[{label:n("cron.this_month"),value:"thisMonth"},{label:n("dynamic_month.last"),value:"lastMonth"}];break;case"daterange":V=[{label:n("dynamic_time.today"),value:"today"},{label:n("dynamic_time.yesterday"),value:"yesterday"},{label:n("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:n("dynamic_time.endOfMonth"),value:"monthEnd"},{label:n("dynamic_time.firstOfYear"),value:"yearBeginning"}];break;case"datetimerange":V=[{label:n("dynamic_time.today"),value:"today"},{label:n("dynamic_time.yesterday"),value:"yesterday"},{label:n("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:n("dynamic_time.endOfMonth"),value:"monthEnd"},{label:n("dynamic_time.firstOfYear"),value:"yearBeginning"}];break}return[...V,{label:n("dynamic_time.custom"),value:"custom"}]}),m=N(()=>{let V=[];if(!s.value)return V;switch(_.timeGranularityMultiple){case"yearrange":V=[{label:n("dynamic_year.current"),value:"thisYear"},{label:n("dynamic_year.last"),value:"lastYear"}];break;case"monthrange":V=[{label:n("cron.this_month"),value:"thisMonth"},{label:n("dynamic_month.last"),value:"lastMonth"},{label:n("v_query.last_3_months"),value:"LastThreeMonths"},{label:n("v_query.last_6_months"),value:"LastSixMonths"},{label:n("v_query.last_12_months"),value:"LastTwelveMonths"}];break;case"daterange":case"datetimerange":V=[{label:n("dynamic_time.today"),value:"today"},{label:n("dynamic_time.yesterday"),value:"yesterday"},{label:n("v_query.last_3_days"),value:"LastThreeDays"},{label:n("v_query.month_to_date"),value:"monthBeginning"},{label:n("v_query.year_to_date"),value:"yearBeginning"}];break}return[...V,{label:n("dynamic_time.custom"),value:"custom"}]});return ce(()=>m.value,V=>{V.some(F=>F.value===s.value.relativeToCurrentRange)||(s.value.relativeToCurrentRange=V[0].value)},{immediate:!0}),ce(()=>B.value,V=>{V.some(F=>F.value===s.value.relativeToCurrent)||(s.value.relativeToCurrent=V[0].value)},{immediate:!0}),ce(()=>k.value,V=>{V.some(F=>F.value===s.value.relativeToCurrentType)||(s.value.relativeToCurrentType=V[0].value),V.some(F=>F.value===s.value.relativeToCurrentTypeRange)||(s.value.relativeToCurrentTypeRange=V[0].value)},{immediate:!0}),(V,F)=>{const X=ot,T=st,ae=Pa,Q=Ye,H=Ft,O=Xt;return c(),q("div",lu,[h("div",nu,w(a(n)("v_query.time_filter_range")),1),h("div",iu,[h("div",uu,w(a(n)("v_query.interval_type")),1),h("div",ru,[h("div",ou,[u(T,{modelValue:a(s).intervalType,"onUpdate:modelValue":F[0]||(F[0]=g=>a(s).intervalType=g)},{default:r(()=>[(c(),q(ie,null,_e(t,g=>u(X,{key:g.value,label:g.value},{default:r(()=>[J(w(g.label),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])])])]),a(s).intervalType!=="none"?(c(),q("div",su,[h("div",du,w(d.value),1),h("div",cu,[h("div",mu,[u(T,{modelValue:a(s).regularOrTrends,"onUpdate:modelValue":F[1]||(F[1]=g=>a(s).regularOrTrends=g)},{default:r(()=>[u(X,{label:"fixed"},{default:r(()=>[J(w(a(n)("dynamic_time.fix")),1)]),_:1}),u(X,{label:"dynamic"},{default:r(()=>[J(w(a(n)("dynamic_time.dynamic")),1)]),_:1})]),_:1},8,["modelValue"])]),f.value&&a(s).intervalType!=="timeInterval"?(c(),q(ie,{key:0},[a(s).intervalType!=="timeInterval"?(c(),q("div",vu,[h("div",pu,w(a(n)("dynamic_time.relative")),1),h("div",fu,[u(Q,{teleported:!1,modelValue:a(s).relativeToCurrent,"onUpdate:modelValue":F[2]||(F[2]=g=>a(s).relativeToCurrent=g)},{default:r(()=>[(c(!0),q(ie,null,_e(B.value,g=>(c(),U(ae,{key:g.value,label:g.label,value:g.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])):j("",!0),a(s).relativeToCurrent==="custom"?(c(),q("div",yu,[h("div",hu,[u(H,{modelValue:a(s).timeNum,"onUpdate:modelValue":F[3]||(F[3]=g=>a(s).timeNum=g),min:0,"controls-position":"right"},null,8,["modelValue"]),u(Q,{teleported:!1,modelValue:a(s).relativeToCurrentType,"onUpdate:modelValue":F[4]||(F[4]=g=>a(s).relativeToCurrentType=g)},{default:r(()=>[(c(!0),q(ie,null,_e(k.value,g=>(c(),U(ae,{key:g.value,label:g.label,value:g.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u(Q,{teleported:!1,modelValue:a(s).around,"onUpdate:modelValue":F[5]||(F[5]=g=>a(s).around=g)},{default:r(()=>[(c(),q(ie,null,_e(D,g=>u(ae,{key:g.value,label:g.label,value:g.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])])):j("",!0)],64)):f.value&&a(s).intervalType==="timeInterval"?(c(),q(ie,{key:1},[h("div",_u,[h("div",gu,w(a(n)("dynamic_time.relative")),1),h("div",bu,[u(Q,{teleported:!1,modelValue:a(s).relativeToCurrentRange,"onUpdate:modelValue":F[6]||(F[6]=g=>a(s).relativeToCurrentRange=g)},{default:r(()=>[(c(!0),q(ie,null,_e(m.value,g=>(c(),U(ae,{key:g.value,label:g.label,value:g.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),a(s).relativeToCurrentRange==="custom"?(c(),q(ie,{key:0},[h("div",{class:Te(["setting",["yearrange","monthrange"].includes(o.timeGranularityMultiple)&&"is-year-month-range"])},[h("div",Vu,w(a(n)("datasource.start_time")),1),h("div",ku,[u(H,{"step-strictly":"",modelValue:a(s).timeNum,"onUpdate:modelValue":F[7]||(F[7]=g=>a(s).timeNum=g),min:0,"controls-position":"right"},null,8,["modelValue"]),u(Q,{teleported:!1,modelValue:a(s).relativeToCurrentType,"onUpdate:modelValue":F[8]||(F[8]=g=>a(s).relativeToCurrentType=g)},{default:r(()=>[(c(!0),q(ie,null,_e(k.value,g=>(c(),U(ae,{key:g.value,label:g.label,value:g.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u(Q,{teleported:!1,modelValue:a(s).around,"onUpdate:modelValue":F[9]||(F[9]=g=>a(s).around=g)},{default:r(()=>[(c(),q(ie,null,_e(D,g=>u(ae,{key:g.value,label:g.label,value:g.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])],2),h("div",{class:Te(["setting",["yearrange","monthrange"].includes(o.timeGranularityMultiple)&&"is-year-month-range"])},[h("div",Tu,w(a(n)("datasource.end_time")),1),h("div",Cu,[u(H,{modelValue:a(s).timeNumRange,"onUpdate:modelValue":F[10]||(F[10]=g=>a(s).timeNumRange=g),min:0,"step-strictly":"","controls-position":"right"},null,8,["modelValue"]),u(Q,{teleported:!1,modelValue:a(s).relativeToCurrentTypeRange,"onUpdate:modelValue":F[11]||(F[11]=g=>a(s).relativeToCurrentTypeRange=g)},{default:r(()=>[(c(!0),q(ie,null,_e(k.value,g=>(c(),U(ae,{key:g.value,label:g.label,value:g.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u(Q,{teleported:!1,modelValue:a(s).aroundRange,"onUpdate:modelValue":F[12]||(F[12]=g=>a(s).aroundRange=g)},{default:r(()=>[(c(),q(ie,null,_e(D,g=>u(ae,{key:g.value,label:g.label,value:g.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])],2)],64)):j("",!0)],64)):j("",!0)]),h("div",{class:Te(["parameters",f.value&&"setting"])},[f.value?(c(),q("div",Mu,w(a(n)("template_manage.preview")),1)):j("",!0),h("div",{class:Te(f.value?"setting-value":"w100")},[(c(),U(ze(M.value),{config:a(s),timeGranularityMultiple:o.timeGranularityMultiple,ref:"inputCom"},null,8,["config","timeGranularityMultiple"]))],2)],2)])):j("",!0),h("div",Fu,[h("div",Su,[u(O,{modelValue:a(s).dynamicWindow,"onUpdate:modelValue":F[13]||(F[13]=g=>a(s).dynamicWindow=g),label:a(n)("v_query.query_time_window")},null,8,["modelValue","label"])]),a(s).dynamicWindow?(c(),q("div",wu,[J(w(a(n)("v_query.maximum_single_query"))+" ",1),u(H,{modelValue:a(s).maximumSingleQuery,"onUpdate:modelValue":F[14]||(F[14]=g=>a(s).maximumSingleQuery=g),min:1,"controls-position":"right"},null,8,["modelValue"]),J(" "+w(R.value),1)])):j("",!0)])])}}});const qu={class:"set-time-filtering-range"},Du={class:"title"},Ou={class:"list-item"},Iu={class:"label"},Au={class:"setting-content"},Eu={class:"setting"},Nu={key:0,class:"list-item"},Ru={class:"label"},xu={class:"setting-content"},Lu={class:"setting"},Yu={key:0,class:"setting"},Uu={class:"setting-label"},Bu={class:"setting-value select"},Gu={key:1,class:"setting"},Pu={class:"setting-input"},Wu={class:"setting"},ju={class:"setting-label"},Hu={class:"setting-value select"},zu={class:"setting-label"},Qu={class:"setting-input range"},Ku={class:"setting-label"},Zu={class:"setting-input range"},Ju={key:0,class:"setting-label"},Xu=Pe({__name:"FilterTime",props:{timeRange:{default:()=>({intervalType:"none",dynamicWindow:!1,maximumSingleQuery:0,regularOrTrends:"fixed",relativeToCurrentRange:"custom",regularOrTrendsValue:"",relativeToCurrent:"custom",timeNum:0,relativeToCurrentType:"year",around:"f",timeNumRange:0,relativeToCurrentTypeRange:"year",aroundRange:"f"})},timeGranularity:{default:"year"}},setup(o){const _=o,{t:n}=ha(),t=[{label:n("chart.line_symbol_none"),value:"none"},{label:n("v_query.start_at"),value:"start"},{label:n("v_query.end_at"),value:"end"},{label:n("v_query.time_interval"),value:"timeInterval"}],d=N(()=>t.find(V=>V.value===s.value.intervalType).label),{timeRange:s}=ia(_),f=N(()=>s.value.regularOrTrends!=="fixed"),M=N(()=>{const{intervalType:V}=s.value;return V==="timeInterval"?Zl:Kl}),D=N(()=>_.timeGranularity+"range"),k=[{label:n("dynamic_time.before"),value:"f"},{label:n("dynamic_time.after"),value:"b"}],R=N(()=>{if(!s.value)return[];let V=["year","month","date","datetime"].indexOf(_.timeGranularity)+1;return[{label:n("dynamic_time.year"),value:"year"},{label:n("dynamic_time.month"),value:"month"},{label:n("dynamic_time.date"),value:"day"}].slice(0,V)}),B=N(()=>{let V=[];if(!s.value)return V;switch(_.timeGranularity){case"year":V=[{label:n("dynamic_year.current"),value:"thisYear"},{label:n("dynamic_year.last"),value:"lastYear"}];break;case"month":V=[{label:n("cron.this_month"),value:"thisMonth"},{label:n("dynamic_month.last"),value:"lastMonth"}];break;case"date":V=[{label:n("dynamic_time.today"),value:"today"},{label:n("dynamic_time.yesterday"),value:"yesterday"},{label:n("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:n("dynamic_time.firstOfYear"),value:"yearBeginning"}];break;case"datetime":V=[{label:n("dynamic_time.today"),value:"today"},{label:n("dynamic_time.yesterday"),value:"yesterday"},{label:n("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:n("dynamic_time.firstOfYear"),value:"yearBeginning"}];break}return[...V,{label:n("dynamic_time.custom"),value:"custom"}]}),m=N(()=>{let V=[];if(!s.value)return V;switch(_.timeGranularity){case"year":V=[{label:n("dynamic_year.current"),value:"thisYear"},{label:n("dynamic_year.last"),value:"lastYear"}];break;case"month":V=[{label:n("cron.this_month"),value:"thisMonth"},{label:n("dynamic_month.last"),value:"lastMonth"},{label:n("v_query.last_3_months"),value:"LastThreeMonths"},{label:n("v_query.last_6_months"),value:"LastSixMonths"},{label:n("v_query.last_12_months"),value:"LastTwelveMonths"}];break;case"date":case"datetime":V=[{label:n("dynamic_time.today"),value:"today"},{label:n("dynamic_time.yesterday"),value:"yesterday"},{label:n("v_query.last_3_days"),value:"LastThreeDays"},{label:n("v_query.month_to_date"),value:"monthBeginning"},{label:n("v_query.year_to_date"),value:"yearBeginning"}];break}return[...V,{label:n("dynamic_time.custom"),value:"custom"}]});return ce(()=>m.value,V=>{V.some(F=>F.value===s.value.relativeToCurrentRange)||(s.value.relativeToCurrentRange=V[0].value)},{immediate:!0}),ce(()=>B.value,V=>{V.some(F=>F.value===s.value.relativeToCurrent)||(s.value.relativeToCurrent=V[0].value)},{immediate:!0}),ce(()=>R.value,V=>{V.some(F=>F.value===s.value.relativeToCurrentType)||(s.value.relativeToCurrentType=V[0].value)},{immediate:!0}),(V,F)=>{const X=ot,T=st,ae=Pa,Q=Ye,H=Ft;return c(),q("div",qu,[h("div",Du,w(a(n)("v_query.time_filter_range")),1),h("div",Ou,[h("div",Iu,w(a(n)("v_query.interval_type")),1),h("div",Au,[h("div",Eu,[u(T,{modelValue:a(s).intervalType,"onUpdate:modelValue":F[0]||(F[0]=O=>a(s).intervalType=O)},{default:r(()=>[(c(),q(ie,null,_e(t,O=>u(X,{key:O.value,label:O.value},{default:r(()=>[J(w(O.label),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])])])]),a(s).intervalType!=="none"?(c(),q("div",Nu,[h("div",Ru,w(d.value),1),h("div",xu,[h("div",Lu,[u(T,{modelValue:a(s).regularOrTrends,"onUpdate:modelValue":F[1]||(F[1]=O=>a(s).regularOrTrends=O)},{default:r(()=>[u(X,{label:"fixed"},{default:r(()=>[J(w(a(n)("dynamic_time.fix")),1)]),_:1}),u(X,{label:"dynamic"},{default:r(()=>[J(w(a(n)("dynamic_time.dynamic")),1)]),_:1})]),_:1},8,["modelValue"])]),f.value&&a(s).intervalType!=="timeInterval"?(c(),q(ie,{key:0},[a(s).intervalType!=="timeInterval"?(c(),q("div",Yu,[h("div",Uu,w(a(n)("dynamic_time.relative")),1),h("div",Bu,[u(Q,{teleported:!1,modelValue:a(s).relativeToCurrent,"onUpdate:modelValue":F[2]||(F[2]=O=>a(s).relativeToCurrent=O)},{default:r(()=>[(c(!0),q(ie,null,_e(B.value,O=>(c(),U(ae,{key:O.value,label:O.label,value:O.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])):j("",!0),a(s).relativeToCurrent==="custom"?(c(),q("div",Gu,[h("div",Pu,[u(H,{modelValue:a(s).timeNum,"onUpdate:modelValue":F[3]||(F[3]=O=>a(s).timeNum=O),min:0,"controls-position":"right"},null,8,["modelValue"]),u(Q,{teleported:!1,modelValue:a(s).relativeToCurrentType,"onUpdate:modelValue":F[4]||(F[4]=O=>a(s).relativeToCurrentType=O)},{default:r(()=>[(c(!0),q(ie,null,_e(R.value,O=>(c(),U(ae,{key:O.value,label:O.label,value:O.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u(Q,{teleported:!1,modelValue:a(s).around,"onUpdate:modelValue":F[5]||(F[5]=O=>a(s).around=O)},{default:r(()=>[(c(),q(ie,null,_e(k,O=>u(ae,{key:O.value,label:O.label,value:O.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])])):j("",!0)],64)):f.value&&a(s).intervalType==="timeInterval"?(c(),q(ie,{key:1},[h("div",Wu,[h("div",ju,w(a(n)("dynamic_time.relative")),1),h("div",Hu,[u(Q,{teleported:!1,modelValue:a(s).relativeToCurrentRange,"onUpdate:modelValue":F[6]||(F[6]=O=>a(s).relativeToCurrentRange=O)},{default:r(()=>[(c(!0),q(ie,null,_e(m.value,O=>(c(),U(ae,{key:O.value,label:O.label,value:O.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),a(s).relativeToCurrentRange==="custom"?(c(),q(ie,{key:0},[h("div",{class:Te(["setting",["year","month"].includes(V.timeGranularity)&&"is-year-month-range"])},[h("div",zu,w(a(n)("datasource.start_time")),1),h("div",Qu,[u(H,{"step-strictly":"",modelValue:a(s).timeNum,"onUpdate:modelValue":F[7]||(F[7]=O=>a(s).timeNum=O),min:0,"controls-position":"right"},null,8,["modelValue"]),u(Q,{teleported:!1,modelValue:a(s).relativeToCurrentType,"onUpdate:modelValue":F[8]||(F[8]=O=>a(s).relativeToCurrentType=O)},{default:r(()=>[(c(!0),q(ie,null,_e(R.value,O=>(c(),U(ae,{key:O.value,label:O.label,value:O.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u(Q,{teleported:!1,modelValue:a(s).around,"onUpdate:modelValue":F[9]||(F[9]=O=>a(s).around=O)},{default:r(()=>[(c(),q(ie,null,_e(k,O=>u(ae,{key:O.value,label:O.label,value:O.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])],2),h("div",{class:Te(["setting",["year","month"].includes(V.timeGranularity)&&"is-year-month-range"])},[h("div",Ku,w(a(n)("datasource.end_time")),1),h("div",Zu,[u(H,{modelValue:a(s).timeNumRange,"onUpdate:modelValue":F[10]||(F[10]=O=>a(s).timeNumRange=O),min:0,"step-strictly":"","controls-position":"right"},null,8,["modelValue"]),u(Q,{teleported:!1,modelValue:a(s).relativeToCurrentTypeRange,"onUpdate:modelValue":F[11]||(F[11]=O=>a(s).relativeToCurrentTypeRange=O)},{default:r(()=>[(c(!0),q(ie,null,_e(R.value,O=>(c(),U(ae,{key:O.value,label:O.label,value:O.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u(Q,{teleported:!1,modelValue:a(s).aroundRange,"onUpdate:modelValue":F[12]||(F[12]=O=>a(s).aroundRange=O)},{default:r(()=>[(c(),q(ie,null,_e(k,O=>u(ae,{key:O.value,label:O.label,value:O.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])],2)],64)):j("",!0)],64)):j("",!0)]),h("div",{class:Te(["parameters",f.value&&"setting"])},[f.value?(c(),q("div",Ju,w(a(n)("template_manage.preview")),1)):j("",!0),h("div",{class:Te(f.value?"setting-value":"w100")},[(c(),U(ze(M.value),{config:a(s),timeGranularityMultiple:D.value,ref:"inputCom"},null,8,["config","timeGranularityMultiple"]))],2)],2)])):j("",!0)])}}});const er=Pe({__name:"DynamicTime",props:{config:{type:Object,default:()=>({defaultValue:"",selectValue:"",timeType:"fixed",relativeToCurrent:"custom",timeNum:0,relativeToCurrentType:"year",around:"f",arbitraryTime:new Date,defaultValueCheck:!1,timeGranularity:"date"})}},setup(o){const _=o,n=K(),{config:t}=ia(_),d=N(()=>{const{relativeToCurrent:f,timeNum:M,relativeToCurrentType:D,around:k,defaultValueCheck:R,arbitraryTime:B,timeGranularity:m}=t.value;return{relativeToCurrent:f,timeNum:M,relativeToCurrentType:D,around:k,defaultValueCheck:R,arbitraryTime:B,timeGranularity:m}});ce(()=>d.value,()=>{s()},{deep:!0}),ce(()=>n.value,f=>{t.value.defaultValue=f,t.value.selectValue=f}),ce(()=>t.value.id,()=>{s()});const s=()=>{const{relativeToCurrent:f,timeNum:M,relativeToCurrentType:D,around:k,defaultValueCheck:R,arbitraryTime:B,timeGranularity:m}=d.value;if(!R){n.value=null;return}if(f==="custom")n.value=et(M,D,m,k,m==="datetime"?B:null);else switch(f){case"thisYear":n.value=bi();break;case"lastYear":n.value=gi();break;case"thisMonth":n.value=_i();break;case"lastMonth":n.value=hi();break;case"today":n.value=yi();break;case"yesterday":n.value=fi();break;case"monthBeginning":n.value=pi();break;case"monthEnd":n.value=vi();break;case"yearBeginning":n.value=mi();break}};return qa(()=>{s()}),(f,M)=>{const D=rt;return c(),U(D,{disabled:"",key:a(t).timeGranularity,modelValue:n.value,"onUpdate:modelValue":M[0]||(M[0]=k=>n.value=k),type:a(t).timeGranularity,"prefix-icon":a(Tt),"popper-class":"custom-dynamic-time-popper_class",placeholder:f.$t("commons.date.select_date_time")},null,8,["modelValue","type","prefix-icon","placeholder"])}}});const ar=Pe({__name:"DynamicTimeRange",props:{config:{type:Object,default:()=>({timeGranularityMultiple:"datetimerange",defaultValue:[],selectValue:[],timeType:"fixed",timeNum:0,relativeToCurrentType:"year",around:"f",arbitraryTime:new Date,defaultValueCheck:!1,timeGranularity:"date",timeNumRange:0,relativeToCurrentRange:"custom",relativeToCurrentTypeRange:"year",aroundRange:"f",arbitraryTimeRange:new Date})}},setup(o){const _=o,n=K([new Date,new Date]),{config:t}=ia(_),d=N(()=>{const{timeNum:M,relativeToCurrentType:D,timeGranularityMultiple:k,around:R,relativeToCurrentRange:B,defaultValueCheck:m,arbitraryTime:V,timeGranularity:F,timeNumRange:X,relativeToCurrentTypeRange:T,aroundRange:ae,arbitraryTimeRange:Q}=t.value;return{timeNum:M,relativeToCurrentType:D,around:R,relativeToCurrentRange:B,timeGranularityMultiple:k,defaultValueCheck:m,arbitraryTime:V,timeGranularity:F,timeNumRange:X,relativeToCurrentTypeRange:T,aroundRange:ae,arbitraryTimeRange:Q}});ce(()=>d.value,()=>{s()},{deep:!0}),ce(()=>n.value,M=>{t.value.defaultValue=M,t.value.selectValue=M}),ce(()=>t.value.id,()=>{s()});const s=()=>{const{timeNum:M,relativeToCurrentType:D,around:k,defaultValueCheck:R,arbitraryTime:B,timeGranularity:m,timeGranularityMultiple:V,timeNumRange:F,relativeToCurrentTypeRange:X,aroundRange:T,relativeToCurrentRange:ae,arbitraryTimeRange:Q}=d.value;if(!R){n.value=[new Date,new Date];return}if(ae!=="custom"){n.value=at(ae);return}const H=et(M,D,m,k,B,V,"start-config"),O=et(F,X,m,T,Q,V,"end-config");n.value=[H,O]};qa(()=>{s()});const f=N(()=>t.value.timeGranularityMultiple==="yearrange"?"YYYY":void 0);return(M,D)=>{const k=rt;return c(),U(k,{disabled:"",modelValue:n.value,"onUpdate:modelValue":D[0]||(D[0]=R=>n.value=R),key:a(t).timeGranularityMultiple,type:a(t).timeGranularityMultiple,"prefix-icon":a(Tt),format:f.value,"popper-class":"custom-dynamic-time-range-popper_class","range-separator":M.$t("cron.to"),"start-placeholder":M.$t("datasource.start_time"),"end-placeholder":M.$t("datasource.end_time")},null,8,["modelValue","type","prefix-icon","format","range-separator","start-placeholder","end-placeholder"])}}});var Jl={exports:{}};(function(o,_){(function(n,t){o.exports=t()})(di,function(){var n="month",t="quarter";return function(d,s){var f=s.prototype;f.quarter=function(k){return this.$utils().u(k)?Math.ceil((this.month()+1)/3):this.month(this.month()%3+3*(k-1))};var M=f.add;f.add=function(k,R){return k=Number(k),this.$utils().p(R)===t?this.add(3*k,n):M.bind(this)(k,R)};var D=f.startOf;f.startOf=function(k,R){var B=this.$utils(),m=!!B.u(R)||R;if(B.p(k)===t){var V=this.quarter()-1;return m?this.month(3*V).startOf(n).startOf("day"):this.month(3*V+2).endOf(n).endOf("day")}return D.bind(this)(k,R)}}})})(Jl);var tr=Jl.exports;const lr=ci(tr),{t:nr}=ha();ke.extend(lr);function yt(o="month"){return new Date(ke().startOf(o).format("YYYY/MM/DD HH:mm:ss"))}function ht(o="month"){return new Date(ke().endOf(o).format("YYYY/MM/DD HH:mm:ss"))}function _t(o="month"){return new Date(ke().subtract(1,o).startOf(o).format("YYYY/MM/DD HH:mm:ss"))}function gt(o="month"){return new Date(ke().subtract(1,o).endOf(o).format("YYYY/MM/DD HH:mm:ss"))}let Fa=()=>{};const Xl=[{text:"dynamic_time.cweek",onClick:({emit:o})=>{const _=new Date(+new Date(yt("week"))+864e5),n=new Date(+new Date(ht("week"))+24*1e3*3600);Fa([_,n])||o("pick",[ke(_),ke(n)])}},{text:"dynamic_month.current",onClick:({emit:o})=>{const _=yt("month"),n=ht("month");Fa([_,n])||o("pick",[ke(_),ke(n)])}},{text:"dynamic_time.cquarter",onClick:({emit:o})=>{const _=yt("quarter"),n=ht("quarter");Fa([_,n])||o("pick",[ke(_),ke(n)])}},{text:"dynamic_year.current",onClick:({emit:o})=>{const _=yt("year"),n=ht("year");Fa([_,n])||o("pick",[ke(_),ke(n)])}},{text:"dynamic_time.lweek",onClick:({emit:o})=>{const _=new Date(+new Date(_t("week"))+864e5),n=new Date(+new Date(gt("week"))+24*1e3*3600);Fa([_,n])||o("pick",[ke(_),ke(n)])}},{text:"dynamic_month.last",onClick:({emit:o})=>{const _=_t("month"),n=gt("month");Fa([_,n])||o("pick",[ke(_),ke(n)])}},{text:"dynamic_time.lquarter",onClick:({emit:o})=>{const _=_t("quarter"),n=gt("quarter");Fa([_,n])||o("pick",[ke(_),ke(n)])}},{text:"dynamic_year.last",onClick:({emit:o})=>{const _=_t("year"),n=gt("year");Fa([_,n])||o("pick",[ke(_),ke(n)])}}];Xl.forEach(o=>{o.text=nr(o.text)});const ir=o=>(Fa=o,{shortcuts:Xl}),[ur,Sa,Cl]=Wa("picker"),en=o=>o.find(_=>!_.disabled)||o[0];function rr(o,_){const n=o[0];if(n){if(Array.isArray(n))return"multiple";if(_.children in n)return"cascade"}return"default"}function Vt(o,_){_=kt(_,0,o.length);for(let n=_;n<o.length;n++)if(!o[n].disabled)return n;for(let n=_-1;n>=0;n--)if(!o[n].disabled)return n;return 0}const Ml=(o,_,n)=>_!==void 0&&o.some(t=>t[n.value]===_);function jt(o,_,n){const t=o.findIndex(s=>s[n.value]===_),d=Vt(o,t);return o[d]}function or(o,_,n){const t=[];let d={[_.children]:o},s=0;for(;d&&d[_.children];){const f=d[_.children],M=n.value[s];if(d=Ci(M)?jt(f,M,_):void 0,!d&&f.length){const D=en(f)[_.value];d=jt(f,D,_)}s++,t.push(f)}return t}function sr(o){const{transform:_}=window.getComputedStyle(o),n=_.slice(7,_.length-1).split(", ")[5];return Number(n)}function dr(o){return $a({text:"text",value:"value",children:"children"},o)}const Fl=200,Sl=300,cr=15,[an,Pt]=Wa("picker-column"),tn=Symbol(an);var mr=Pe({name:an,props:{value:Gt,fields:ft(Object),options:tt(),readonly:Boolean,allowHtml:Boolean,optionHeight:ft(Number),swipeDuration:ft(Gt),visibleOptionNum:ft(Gt)},emits:["change","clickOption","scrollInto"],setup(o,{emit:_,slots:n}){let t,d,s,f,M;const D=K(),k=K(),R=K(0),B=K(0),m=wi(),V=()=>o.options.length,F=()=>o.optionHeight*(+o.visibleOptionNum-1)/2,X=oe=>{let le=Vt(o.options,oe);const S=-le*o.optionHeight,y=()=>{le>V()-1&&(le=Vt(o.options,oe));const ee=o.options[le][o.fields.value];ee!==o.value&&_("change",ee)};t&&S!==R.value?M=y:y(),R.value=S},T=()=>o.readonly||!o.options.length,ae=oe=>{t||T()||(M=null,B.value=Fl,X(oe),_("clickOption",o.options[oe]))},Q=oe=>kt(Math.round(-oe/o.optionHeight),0,V()-1),H=N(()=>Q(R.value)),O=(oe,le)=>{const S=Math.abs(oe/le);oe=R.value+S/.003*(oe<0?-1:1);const y=Q(oe);B.value=+o.swipeDuration,X(y)},g=()=>{t=!1,B.value=0,M&&(M(),M=null)},se=oe=>{if(!T()){if(m.start(oe),t){const le=sr(k.value);R.value=Math.min(0,le-F())}B.value=0,d=R.value,s=Date.now(),f=d,M=null}},fe=oe=>{if(T())return;m.move(oe),m.isVertical()&&(t=!0,Wl(oe,!0));const le=kt(d+m.deltaY.value,-(V()*o.optionHeight),o.optionHeight),S=Q(le);S!==H.value&&_("scrollInto",o.options[S]),R.value=le;const y=Date.now();y-s>Sl&&(s=y,f=le)},e=()=>{if(T())return;const oe=R.value-f,le=Date.now()-s;if(le<Sl&&Math.abs(oe)>cr){O(oe,le);return}const y=Q(R.value);B.value=Fl,X(y),setTimeout(()=>{t=!1},0)},Ce=()=>{const oe={height:`${o.optionHeight}px`};return o.options.map((le,S)=>{const y=le[o.fields.text],{disabled:ee}=le,P=le[o.fields.value],ye={role:"button",style:oe,tabindex:ee?-1:0,class:[Pt("item",{disabled:ee,selected:P===o.value}),le.className],onClick:()=>ae(S)},me={class:"van-ellipsis",[o.allowHtml?"innerHTML":"textContent"]:y};return u("li",ye,[n.option?n.option(le,S):u("div",me,null)])})};return Gl(tn),wt({stopMomentum:g}),Un(()=>{const oe=t?Math.floor(-R.value/o.optionHeight):o.options.findIndex(y=>y[o.fields.value]===o.value),le=Vt(o.options,oe),S=-le*o.optionHeight;t&&le<oe&&g(),R.value=S}),Pl("touchmove",fe,{target:D}),()=>u("div",{ref:D,class:Pt(),onTouchstartPassive:se,onTouchend:e,onTouchcancel:e},[u("ul",{ref:k,style:{transform:`translate3d(0, ${R.value+F()}px, 0)`,transitionDuration:`${B.value}ms`,transitionProperty:B.value?"all":"none"},class:Pt("wrapper"),onTransitionend:g},[Ce()])])}});const[vr]=Wa("picker-toolbar"),$t={title:String,cancelButtonText:String,confirmButtonText:String},ln=["cancel","confirm","title","toolbar"],pr=Object.keys($t);var nn=Pe({name:vr,props:$t,emits:["confirm","cancel"],setup(o,{emit:_,slots:n}){const t=()=>{if(n.title)return n.title();if(o.title)return u("div",{class:[Sa("title"),"van-ellipsis"]},[o.title])},d=()=>_("cancel"),s=()=>_("confirm"),f=()=>{var D;const k=(D=o.cancelButtonText)!=null?D:Cl("cancel");if(!(!n.cancel&&!k))return u("button",{type:"button",class:[Sa("cancel"),Tl],onClick:d},[n.cancel?n.cancel():k])},M=()=>{var D;const k=(D=o.confirmButtonText)!=null?D:Cl("confirm");if(!(!n.confirm&&!k))return u("button",{type:"button",class:[Sa("confirm"),Tl],onClick:s},[n.confirm?n.confirm():k])};return()=>u("div",{class:Sa("toolbar")},[n.toolbar?n.toolbar():[f(),t(),M()]])}});const fr=(o,_)=>{const n=K(o());return ce(o,t=>{t!==n.value&&(n.value=t)}),ce(n,t=>{t!==o()&&_(t)}),n},[un,Wt]=Wa("picker-group"),rn=Symbol(un),yr=$a({tabs:tt(),activeTab:Va(0),nextStepText:String,showToolbar:jl},$t);var hr=Pe({name:un,props:yr,emits:["confirm","cancel","update:activeTab"],setup(o,{emit:_,slots:n}){const t=fr(()=>o.activeTab,k=>_("update:activeTab",k)),{children:d,linkChildren:s}=Hl(rn);s();const f=()=>+t.value<o.tabs.length-1&&o.nextStepText,M=()=>{f()?t.value=+t.value+1:_("confirm",d.map(k=>k.confirm()))},D=()=>_("cancel");return()=>{var k,R;let B=(R=(k=n.default)==null?void 0:k.call(n))==null?void 0:R.filter(V=>V.type!==Bn).map(V=>V.type===ie?V.children:V);B&&(B=Mi(B));const m=f()?o.nextStepText:o.confirmButtonText;return u("div",{class:Wt()},[o.showToolbar?u(nn,{title:o.title,cancelButtonText:o.cancelButtonText,confirmButtonText:m,onConfirm:M,onCancel:D},lt(n,ln)):null,u(Di,{active:t.value,"onUpdate:active":V=>t.value=V,class:Wt("tabs"),shrink:!0,animated:!0,lazyRender:!1},{default:()=>[o.tabs.map((V,F)=>u(Oi,{title:V,titleClass:Wt("tab-title")},{default:()=>[B==null?void 0:B[F]]}))]})])}}});const tl=$a({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:Va(44),showToolbar:jl,swipeDuration:Va(1e3),visibleOptionNum:Va(6)},$t),_r=$a({},tl,{columns:tt(),modelValue:tt(),toolbarPosition:Fi("top"),columnsFieldNames:Object});var gr=Pe({name:ur,props:_r,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(o,{emit:_,slots:n}){const t=K(),d=K(o.modelValue.slice(0)),{parent:s}=Gl(rn),{children:f,linkChildren:M}=Hl(tn);M();const D=N(()=>dr(o.columnsFieldNames)),k=N(()=>Si(o.optionHeight)),R=N(()=>rr(o.columns,D.value)),B=N(()=>{const{columns:S}=o;switch(R.value){case"multiple":return S;case"cascade":return or(S,D.value,d);default:return[S]}}),m=N(()=>B.value.some(S=>S.length)),V=N(()=>B.value.map((S,y)=>jt(S,d.value[y],D.value))),F=N(()=>B.value.map((S,y)=>S.findIndex(ee=>ee[D.value.value]===d.value[y]))),X=(S,y)=>{if(d.value[S]!==y){const ee=d.value.slice(0);ee[S]=y,d.value=ee}},T=()=>({selectedValues:d.value.slice(0),selectedOptions:V.value,selectedIndexes:F.value}),ae=(S,y)=>{X(y,S),R.value==="cascade"&&d.value.forEach((ee,P)=>{const ye=B.value[P];Ml(ye,ee,D.value)||X(P,ye.length?ye[0][D.value.value]:void 0)}),Me(()=>{_("change",$a({columnIndex:y},T()))})},Q=(S,y)=>{const ee={columnIndex:y,currentOption:S};_("clickOption",$a(T(),ee)),_("scrollInto",ee)},H=()=>{f.forEach(y=>y.stopMomentum());const S=T();return Me(()=>{const y=T();_("confirm",y)}),S},O=()=>_("cancel",T()),g=()=>B.value.map((S,y)=>u(mr,{value:d.value[y],fields:D.value,options:S,readonly:o.readonly,allowHtml:o.allowHtml,optionHeight:k.value,swipeDuration:o.swipeDuration,visibleOptionNum:o.visibleOptionNum,onChange:ee=>ae(ee,y),onClickOption:ee=>Q(ee,y),onScrollInto:ee=>{_("scrollInto",{currentOption:ee,columnIndex:y})}},{option:n.option})),se=S=>{if(m.value){const y={height:`${k.value}px`},ee={backgroundSize:`100% ${(S-k.value)/2}px`};return[u("div",{class:Sa("mask"),style:ee},null),u("div",{class:[qi,Sa("frame")],style:y},null)]}},fe=()=>{const S=k.value*+o.visibleOptionNum,y={height:`${S}px`};return!o.loading&&!m.value&&n.empty?n.empty():u("div",{ref:t,class:Sa("columns"),style:y},[g(),se(S)])},e=()=>{if(o.showToolbar&&!s)return u(nn,Qt(lt(o,pr),{onConfirm:H,onCancel:O}),lt(n,ln))},Ce=S=>{S.forEach((y,ee)=>{y.length&&!Ml(y,d.value[ee],D.value)&&X(ee,en(y)[D.value.value])})};ce(B,S=>Ce(S),{immediate:!0});let oe;return ce(()=>o.modelValue,S=>{!Ia(S,d.value)&&!Ia(S,oe)&&(d.value=S.slice(0),oe=S.slice(0)),o.modelValue.length===0&&Ce(B.value)},{deep:!0}),ce(d,S=>{Ia(S,o.modelValue)||(oe=S.slice(0),_("update:modelValue",oe))},{immediate:!0}),Pl("touchmove",Wl,{target:t}),wt({confirm:H,getSelectedOptions:()=>V.value}),()=>{var S,y;return u("div",{class:Sa()},[o.toolbarPosition==="top"?e():null,o.loading?u($i,{class:Sa("loading")},null):null,(S=n["columns-top"])==null?void 0:S.call(n),fe(),(y=n["columns-bottom"])==null?void 0:y.call(n),o.toolbarPosition==="bottom"?e():null])}}});const on=$a({},tl,{modelValue:tt(),filter:Function,formatter:{type:Function,default:(o,_)=>_}}),sn=Object.keys(tl);function br(o,_){if(o<0)return[];const n=Array(o);let t=-1;for(;++t<o;)n[t]=_(t);return n}const Vr=(o,_)=>32-new Date(o,_-1,32).getDate(),Ba=(o,_,n,t,d,s)=>{const f=br(_-o+1,M=>{const D=zl(o+M);return t(n,{text:D,value:D})});return d?d(n,f,s):f},dn=(o,_)=>o.map((n,t)=>{const d=_[t];if(d.length){const s=+d[0].value,f=+d[d.length-1].value;return zl(kt(+n,s,f))}return n}),cn=St(gr),wl=new Date().getFullYear(),[kr]=Wa("date-picker"),Tr=$a({},on,{columnsType:{type:Array,default:()=>["year","month","day"]},minDate:{type:Date,default:()=>new Date(wl-10,0,1),validator:kl},maxDate:{type:Date,default:()=>new Date(wl+10,11,31),validator:kl}});var Cr=Pe({name:kr,props:Tr,emits:["confirm","cancel","change","update:modelValue"],setup(o,{emit:_,slots:n}){const t=K(o.modelValue),d=K(!1),s=K(),f=N(()=>d.value?o.modelValue:t.value),M=g=>g===o.minDate.getFullYear(),D=g=>g===o.maxDate.getFullYear(),k=g=>g===o.minDate.getMonth()+1,R=g=>g===o.maxDate.getMonth()+1,B=g=>{const{minDate:se,columnsType:fe}=o,e=fe.indexOf(g),Ce=f.value[e];if(Ce)return+Ce;switch(g){case"year":return se.getFullYear();case"month":return se.getMonth()+1;case"day":return se.getDate()}},m=()=>{const g=o.minDate.getFullYear(),se=o.maxDate.getFullYear();return Ba(g,se,"year",o.formatter,o.filter,f.value)},V=()=>{const g=B("year"),se=M(g)?o.minDate.getMonth()+1:1,fe=D(g)?o.maxDate.getMonth()+1:12;return Ba(se,fe,"month",o.formatter,o.filter,f.value)},F=()=>{const g=B("year"),se=B("month"),fe=M(g)&&k(se)?o.minDate.getDate():1,e=D(g)&&R(se)?o.maxDate.getDate():Vr(g,se);return Ba(fe,e,"day",o.formatter,o.filter,f.value)},X=()=>{var g;return(g=s.value)==null?void 0:g.confirm()},T=()=>t.value,ae=N(()=>o.columnsType.map(g=>{switch(g){case"year":return m();case"month":return V();case"day":return F();default:return[]}}));ce(t,g=>{Ia(g,o.modelValue)||_("update:modelValue",g)}),ce(()=>o.modelValue,(g,se)=>{d.value=Ia(se,t.value),g=dn(g,ae.value),Ia(g,t.value)||(t.value=g),d.value=!1},{immediate:!0});const Q=(...g)=>_("change",...g),H=(...g)=>_("cancel",...g),O=(...g)=>_("confirm",...g);return wt({confirm:X,getSelectedDate:T}),()=>u(cn,Qt({ref:s,modelValue:t.value,"onUpdate:modelValue":g=>t.value=g,columns:ae.value,onChange:Q,onCancel:H,onConfirm:O},lt(o,sn)),n)}});const Mr=St(Cr);var $l=Mr;const[Fr]=Wa("time-picker"),ql=o=>/^([01]\d|2[0-3]):([0-5]\d):([0-5]\d)$/.test(o),Sr=["hour","minute","second"],wr=$a({},on,{minHour:Va(0),maxHour:Va(23),minMinute:Va(0),maxMinute:Va(59),minSecond:Va(0),maxSecond:Va(59),minTime:{type:String,validator:ql},maxTime:{type:String,validator:ql},columnsType:{type:Array,default:()=>["hour","minute"]}});var $r=Pe({name:Fr,props:wr,emits:["confirm","cancel","change","update:modelValue"],setup(o,{emit:_,slots:n}){const t=K(o.modelValue),d=K(),s=m=>{const V=m.split(":");return Sr.map((F,X)=>o.columnsType.includes(F)?V[X]:"00")},f=()=>{var m;return(m=d.value)==null?void 0:m.confirm()},M=()=>t.value,D=N(()=>{let{minHour:m,maxHour:V,minMinute:F,maxMinute:X,minSecond:T,maxSecond:ae}=o;if(o.minTime||o.maxTime){const Q={hour:0,minute:0,second:0};o.columnsType.forEach((g,se)=>{var fe;Q[g]=(fe=t.value[se])!=null?fe:0});const{hour:H,minute:O}=Q;if(o.minTime){const[g,se,fe]=s(o.minTime);m=g,F=+H<=+m?se:"00",T=+H<=+m&&+O<=+F?fe:"00"}if(o.maxTime){const[g,se,fe]=s(o.maxTime);V=g,X=+H>=+V?se:"59",ae=+H>=+V&&+O>=+X?fe:"59"}}return o.columnsType.map(Q=>{const{filter:H,formatter:O}=o;switch(Q){case"hour":return Ba(+m,+V,Q,O,H,t.value);case"minute":return Ba(+F,+X,Q,O,H,t.value);case"second":return Ba(+T,+ae,Q,O,H,t.value);default:return[]}})});ce(t,m=>{Ia(m,o.modelValue)||_("update:modelValue",m)}),ce(()=>o.modelValue,m=>{m=dn(m,D.value),Ia(m,t.value)||(t.value=m)},{immediate:!0});const k=(...m)=>_("change",...m),R=(...m)=>_("cancel",...m),B=(...m)=>_("confirm",...m);return wt({confirm:f,getSelectedTime:M}),()=>u(cn,Qt({ref:d,modelValue:t.value,"onUpdate:modelValue":m=>t.value=m,columns:D.value,onChange:k,onCancel:R,onConfirm:B},lt(o,sn)),n)}});const qr=St($r);var Dr=qr;const Or=St(hr);var Ir=Or;const mn=Pe({__name:"Time",props:{config:{type:Object,default:()=>({selectValue:"",defaultValue:"",queryConditionWidth:0,defaultValueCheck:!1,displayType:"1",timeGranularity:"date",setTimeRange:!1,timeGranularityMultiple:"daterange",timeRange:{intervalType:"none",dynamicWindow:!1,maximumSingleQuery:0,regularOrTrends:"fixed",regularOrTrendsValue:"",relativeToCurrent:"custom",timeNum:0,relativeToCurrentType:"year",around:"f",timeNumRange:0,relativeToCurrentTypeRange:"year",aroundRange:"f"}})},isConfig:{type:Boolean,default:!1}},setup(o,{expose:_}){const{t:n}=ha(),t=o,d=Ue("placeholder"),s=N(()=>{var I;return(I=d==null?void 0:d.value)!=null&&I.placeholderShow?t.config.placeholder:" "}),f=K(),M=K(!1),D=ut(),{config:k}=ia(t),R=new Date("1970/1/1"),B=new Date("2100/1/1");ce(()=>k.value.defaultValue,I=>{if(t.isConfig)return;const W=k.value.displayType==="7";W&&(M.value=W),f.value=Array.isArray(I)?[...I]:I,Me(()=>{M.value=W})});const m=I=>{y.value=I[0];const W=I.some(be=>Ee(be));return y.value=0,W},{shortcuts:V}=ir(m);ce(()=>k.value.id,()=>{T()});const F=()=>{t.isConfig&&(M.value&&k.value.displayType==="7"||(f.value=k.value.displayType==="7"?[]:void 0,M.value=k.value.displayType==="7",k.value.defaultValue=M.value?[]:void 0,f.value=M.value?[]:void 0))};ce(()=>k.value.selectValue,I=>{t.isConfig||(k.value.displayType==="7"&&(f.value=Array.isArray(I)?[...I]:I),Me(()=>{M.value=k.value.displayType==="7",M.value||(f.value=Array.isArray(k.value.selectValue)?[...k.value.selectValue]:k.value.selectValue)}))});const X=()=>{f.value=Array.isArray(f.value)?f.value.map(W=>W&&ke(W).format("YYYY/MM/DD HH:mm:ss")):f.value&&ke(f.value).format("YYYY/MM/DD HH:mm:ss");const I=Array.isArray(f.value)?[...f.value]:f.value;if(!t.isConfig){k.value.selectValue=Array.isArray(f.value)?[...f.value]:f.value,Me(()=>{H(k.value.id)});return}k.value.defaultValue=Array.isArray(I)?I.map(W=>new Date(W).toLocaleString()):new Date(I).toLocaleString()},T=()=>{const{defaultValueCheck:I,displayType:W,defaultValue:be}=k.value,Fe=W==="7";I?(k.value.selectValue=Array.isArray(be)?[...be]:be,f.value=Array.isArray(be)?[...be]:be):(k.value.selectValue=Fe?[]:void 0,f.value=Fe?[]:void 0),M.value=k.value.displayType==="7",e.value=e.value.slice(0,S()+1)},ae=Ue("com-width",Function,!0),Q=()=>{var I;return(I=d==null?void 0:d.value)!=null&&I.placeholderShow?t.config.queryConditionWidth===void 0?ae():t.config.queryConditionWidth:227},H=Ue("is-confirm-search",Function,!0),O=N(()=>t.isConfig?{}:{width:(M.value?Q()*2:Q())+"px !important"}),g=N(()=>D.mobileInPc?["year","month","day"].slice(0,S()+1):[]),se=N(()=>D.mobileInPc?(M.value?k.value.timeGranularityMultiple:k.value.timeGranularity).includes("datetime"):!1),fe=K([]),e=K(["2021","01","01"]),Ce=K(!1),oe=N(()=>D.mobileInPc?+k.value.displayType==7:!1),le=()=>{var W;const I=((W=f.value)==null?void 0:W.length)>1?f.value[1]:null;if(I){const be=new Date(I);e.value=[`${be.getFullYear()}`,`${be.getMonth()+1}`,`${be.getDate()}`].slice(0,S()+1),se.value&&(fe.value=[`${be.getHours()}`,`${be.getMinutes()}`,`${be.getSeconds()}`])}sa.value=!0,Ce.value=!0},S=()=>{const I=M.value?k.value.timeGranularityMultiple:k.value.timeGranularity;return["year","month","date"].findIndex(be=>I.includes(be))},y=K(0),ee=I=>{y.value=+new Date(I[0])},P=K(),ye=I=>{var W;y.value=0,I||(W=P.value)==null||W.blur()},me=N(()=>{const I=k.value.timeGranularityMultiple.split("time").join("").split("range")[0];return I==="date"?"day":I}),Ee=I=>{const W=+new Date(I);if(!k.value.setTimeRange)return!1;const{intervalType:be,regularOrTrends:Fe,regularOrTrendsValue:va,relativeToCurrent:ua,relativeToCurrentRange:ea,timeNum:pa,relativeToCurrentType:Ta,around:ca,dynamicWindow:Da,maximumSingleQuery:_a,timeNumRange:Y,relativeToCurrentTypeRange:te,aroundRange:z}=k.value.timeRange||{};let ue=!1;if(y.value&&Da&&(ue=ke(y.value).add(_a,me.value).startOf(me.value).valueOf()-1e3<W||ke(y.value).subtract(_a,me.value).startOf(me.value).valueOf()+1e3>W),be==="none")return Da?ue:!1;let pe;if(ua==="custom")pe=ya(Ta,ca==="f"?"subtract":"add",pa);else switch(ua){case"thisYear":pe=Ze("year");break;case"lastYear":pe=wa("year");break;case"thisMonth":pe=Ze("month");break;case"lastMonth":pe=wa("month");break;case"thisQuarter":pe=Ze("quarter");break;case"thisWeek":pe=new Date(ke().startOf("week").add(1,"day").startOf("day").format("YYYY/MM/DD HH:mm:ss"));break;case"today":pe=Ze("day");break;case"yesterday":pe=wa("day");break;case"monthBeginning":pe=Ze("month");break;case"monthEnd":pe=el("month");break;case"yearBeginning":pe=Ze("year");break}const De=Fe==="fixed"?va:pe;if(be==="start")return W<+new Date(De)||ue;if(be==="end")return W>+new Date(De)||ue;if(be==="timeInterval"){let xe;return ea==="custom"?(pe=Fe==="fixed"?new Date(ke(new Date(va[0])).startOf(me.value).format("YYYY/MM/DD HH:mm:ss")):ya(Ta,ca==="f"?"subtract":"add",pa),xe=Fe==="fixed"?new Date(ke(new Date(va[1])).endOf(me.value).format("YYYY/MM/DD HH:mm:ss")):ya(te,z==="f"?"subtract":"add",Y)):[pe,xe]=at(ea),W<+new Date(pe)-1e3||W>+new Date(xe)||ue}},We=()=>{if(oe.value){const[I]=f.value||[];if(I){const W=new Date(I);e.value=[`${W.getFullYear()}`,`${W.getMonth()+1}`,`${W.getDate()}`].slice(0,S()+1),se.value&&(fe.value=[`${W.getHours()}`,`${W.getMinutes()}`,`${W.getSeconds()}`])}}else{const I=f.value?new Date(f.value):new Date;e.value=[`${I.getFullYear()}`,`${I.getMonth()+1}`,`${I.getDate()}`].slice(0,S()+1),se.value&&(fe.value=[`${I.getHours()}`,`${I.getMinutes()}`,`${I.getSeconds()}`])}sa.value=!1,Ce.value=!0},Qe=()=>{Ce.value=!1},sa=K(!1),da=()=>{e.value=e.value.slice(0,S()+1);const I=[1,2].includes(e.value.length)?e.value.concat(Array([0,2,1][e.value.length]).fill("01")):e.value;if(oe.value){const[W,be]=f.value||[];sa.value?f.value=[W||new Date(`${I.join("/")} ${fe.value.join(":")}`),new Date(`${I.join("/")} ${fe.value.join(":")}`)]:f.value=[new Date(`${I.join("/")} ${fe.value.join(":")}`),be||new Date(`${I.join("/")} ${fe.value.join(":")}`)]}else f.value=new Date(`${I.join("/")} ${fe.value.join(":")}`)},ka=()=>{Ce.value=!1;const{displayType:I}=k.value,W=I==="7";k.value.selectValue=W?[]:void 0,f.value=W?[]:void 0,X()},Ke=()=>{da(),X(),Ce.value=!1};qa(()=>{T()}),_({displayTypeChange:F});const E=N(()=>k.value.timeGranularityMultiple==="yearrange"?"YYYY":void 0);return(I,W)=>{const be=rt;return c(),q(ie,null,[M.value?(c(),U(be,{modelValue:f.value,"onUpdate:modelValue":W[0]||(W[0]=Fe=>f.value=Fe),key:a(k).timeGranularityMultiple,type:a(k).timeGranularityMultiple,style:Ae(O.value),ref_key:"datePicker",ref:P,onVisibleChange:ye,"disabled-date":Ee,onCalendarChange:ee,format:E.value,shortcuts:["datetimerange","daterange"].includes(a(k).timeGranularityMultiple)?a(V):[],onChange:X,editable:!1,"range-separator":I.$t("cron.to"),"start-placeholder":s.value,"end-placeholder":s.value},null,8,["modelValue","type","style","format","shortcuts","range-separator","start-placeholder","end-placeholder"])):(c(),U(be,{key:a(k).timeGranularity+1,modelValue:f.value,"onUpdate:modelValue":W[1]||(W[1]=Fe=>f.value=Fe),onVisibleChange:ye,"disabled-date":Ee,type:a(k).timeGranularity,onChange:X,style:Ae(O.value),placeholder:s.value},null,8,["modelValue","type","style","placeholder"])),a(D).mobileInPc?(c(),q("div",{key:2,class:Te(["vant-mobile",oe.value&&"wl50"]),onClick:We},null,2)):j("",!0),a(D).mobileInPc&&oe.value?(c(),q("div",{key:3,class:"vant-mobile wr50",onClick:le})):j("",!0),a(D).mobileInPc?(c(),U(a(Ti),{key:4,teleport:"body",position:"bottom",show:Ce.value,"onUpdate:show":W[5]||(W[5]=Fe=>Ce.value=Fe)},{default:r(()=>[se.value?(c(),U(a(Ir),{key:0,onConfirm:Ke,onCancel:Qe,title:a(n)("v_query.time_selection"),tabs:[a(n)("dataset.select_date"),a(n)("dataset.select_time")],"next-step-text":a(n)("sync_datasource.next")},{default:r(()=>[u(a($l),{"min-date":a(R),"max-date":a(B),"columns-type":g.value,modelValue:e.value,"onUpdate:modelValue":W[2]||(W[2]=Fe=>e.value=Fe)},null,8,["min-date","max-date","columns-type","modelValue"]),u(a(Dr),{"columns-type":["hour","minute","second"],modelValue:fe.value,"onUpdate:modelValue":W[3]||(W[3]=Fe=>fe.value=Fe)},null,8,["modelValue"])]),_:1},8,["title","tabs","next-step-text"])):j("",!0),se.value?j("",!0):(c(),U(a($l),{key:1,title:a(n)("dataset.select_date"),"columns-type":g.value,onConfirm:Ke,onCancel:Qe,"min-date":a(R),"max-date":a(B),modelValue:e.value,"onUpdate:modelValue":W[4]||(W[4]=Fe=>e.value=Fe)},null,8,["title","columns-type","min-date","max-date","modelValue"]))]),_:1},8,["show"])):j("",!0),Ce.value?(c(),U(Il,{key:5,to:".van-picker__toolbar"},[h("button",{style:{position:"absolute",top:"0",right:"60px"},onClick:ka,class:"van-picker__confirm van-haptics-feedback oooo"},w(a(n)("commons.clear")),1)])):j("",!0)],64)}}});function Ar(o,_,n){o=Math.max(0,Math.min(255,o)),_=Math.max(0,Math.min(255,_)),n=Math.max(0,Math.min(255,n));const t=o.toString(16).padStart(2,"0"),d=_.toString(16).padStart(2,"0"),s=n.toString(16).padStart(2,"0");return`#${t}${d}${s}`.toUpperCase()}function Er(o,_,n,t){const d=Math.max(0,Math.min(255,o)).toString(16).padStart(2,"0"),s=Math.max(0,Math.min(255,_)).toString(16).padStart(2,"0"),f=Math.max(0,Math.min(255,n)).toString(16).padStart(2,"0"),M=t!==void 0?Math.round(Math.max(0,Math.min(1,t))*255).toString(16).padStart(2,"0"):"";return`#${d}${s}${f}${M}`.toUpperCase()}function vn(o){const _=/^(rgb|rgba)\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)$/,n=o.match(_);if(!n)return null;const t=parseInt(n[2]),d=parseInt(n[3]),s=parseInt(n[4]),f=n[5]?parseFloat(n[5]):void 0;return f!==void 0?Er(t,d,s,f):Ar(t,d,s)}const Nr=Pe({__name:"Select",props:{config:{type:Object,default:()=>({selectValue:"",queryConditionWidth:0,resultMode:0,defaultValue:"",displayType:"",defaultValueCheck:!1,optionValueSource:0,multiple:!1,checkedFieldsMap:{}})},isConfig:{type:Boolean,default:!1}},setup(o,{expose:_}){Ct(Y=>({"73d9d24c":Da.value,e8f728a6:_a.value}));const{t:n}=ha(),t=o,{config:d}=ia(t);let s=[];const f=K(),M=K(!1),D=K(!1),k=it([]),R=Ue("unmount-select"),B=Ue("placeholder"),m=Ue("release-unmount-select",Function,!0),V=Ue("query-data-for-id",Function,!0),F=Ue("is-confirm-search",Function,!0),X=Ue("com-width",Function,!0),T=Ue("cascade-list",Function,!0),ae=Ue("set-cascade-default",Function,!0),Q=Ue("$custom-style-filter"),H=N(()=>{var Y;return(Y=B==null?void 0:B.value)!=null&&Y.placeholderShow?["",void 0].includes(t.config.placeholder)?" ":t.config.placeholder:" "}),O=N(()=>T()||[]);let g;const se=N(()=>{const{defaultValueFirstItem:Y,optionValueSource:te,multiple:z}=t.config;return Y&&te===1&&!z}),fe=Y=>{const{displayId:te,field:z}=d.value;if(d.value.optionValueSource!==1)return[];let ue={},pe=[];return Y.forEach(De=>{ue[De]=[]}),s.forEach(De=>{ue[De[te||(z==null?void 0:z.id)]]&&ue[De[te||(z==null?void 0:z.id)]].push(De[z==null?void 0:z.id])}),Object.values(ue).forEach(De=>{pe=[...new Set([...pe,...De])]}),pe};Gn(()=>{clearTimeout(g),s=[]});const e=Y=>{O.value.forEach(te=>{te.forEach(z=>{z.datasetId.split("--")[1]===d.value.id&&(t.isConfig&&(z.selectValue=Array.isArray(Y)?[...Y]:Y),z.currentSelectValue=Array.isArray(Y)?[...Y]:Y)})})},Ce=()=>{O.value.forEach(Y=>{let te=!1;Y.forEach(z=>{z.datasetId.split("--")[1]===d.value.id?te=!0:te&&(xa().emitter.emit(`${z.datasetId.split("--")[1]}-select`),te=!1)})})},oe=()=>{const Y=[];return O.value.forEach(te=>{let z=!1;te.forEach(ue=>{ue.datasetId.split("--")[1]===d.value.id?z=!0:z&&(Y.push(ue.datasetId.split("--")[1]),z=!1)})}),Y},le=()=>{const Y=[];return O.value.forEach(te=>{let z=null;te.forEach(ue=>{var ta,Oa;const[pe,De,xe]=ue.datasetId.split("--");De===d.value.id&&z?(ue.fieldId&&(z.fieldId=ue.fieldId),Y.push(z)):t.isConfig?(ta=ue.selectValue)!=null&&ta.length&&(z={fieldId:xe,operator:"in",value:[...ue.selectValue]}):(Oa=ue.currentSelectValue)!=null&&Oa.length&&(z={fieldId:xe,operator:"in",value:[...ue.currentSelectValue]})})}),Y},S=()=>{const Y=Array.isArray(f.value)?[...f.value]:f.value;if(!t.isConfig){d.value.selectValue=Array.isArray(f.value)?[...f.value]:f.value,d.value.mapValue=fe(Array.isArray(f.value)?[...f.value]:[f.value]),e(d.value.mapValue),Ce(),Me(()=>{F(d.value.id,se.value)});return}ae(oe()),d.value.defaultValue=Y,d.value.mapValue=fe(Array.isArray(f.value)?[...f.value]:[f.value]),d.value.defaultMapValue=fe(Array.isArray(f.value)?[...f.value]:[f.value]),e(d.value.mapValue)},y=()=>{t.isConfig&&(d.value.defaultValue=d.value.multiple?[]:void 0,f.value=d.value.multiple?[]:void 0,d.value.defaultValueFirstItem=!1)},ee=Y=>{M.value=!0,ii({fieldIds:Y,resultMode:d.value.resultMode||0}).then(te=>{k.value=(te||[]).filter(z=>z!==null).map(z=>({label:`${z}`,value:`${z}`}))}).finally(()=>{M.value=!1,d.value.defaultValueCheck?f.value=Array.isArray(d.value.defaultValue)?[...d.value.defaultValue]:d.value.defaultValue:f.value=Array.isArray(f.value)?[...f.value]:f.value,Qe()})},P=Y=>{const{displayId:te}=d.value;if(!te)return[];let z={},ue=[];return Y.forEach(pe=>{z[pe]=[]}),s.forEach(pe=>{z[pe[te]]&&z[pe[te]].push(pe)}),Object.values(z).forEach(pe=>{ue=[...ue,...pe]}),ue},ye=()=>{var Y;(Y=d.value.sortList)!=null&&Y.length&&d.value.sort==="customSort"&&(k.value=[...k.value.sort(te=>{if(d.value.sortList.indexOf(te.value)!==-1)return-1}).sort((te,z)=>d.value.sortList.indexOf(te.value)===-1?0:d.value.sortList.indexOf(te.value)-d.value.sortList.indexOf(z.value))])},me=Y=>{M.value=!0,Ll(Y).then(te=>{var pe;let z=[],ue=[];(pe=f.value)!=null&&pe.length&&d.value.multiple&&(z=[...f.value],ue=P(z)),s=[...te||[],...ue],k.value=[...new Set((te||[]).map(De=>`${De[Y.displayId||Y.queryId]}`).concat(z))].map(De=>({label:`${De}`,value:`${De}`,checked:z.includes(De)})),ye()}).finally(()=>{var te;if(M.value=!1,d.value.defaultValueCheck&&!da.value){f.value=Array.isArray(d.value.defaultValue)?[...d.value.defaultValue]:d.value.defaultValue;let z=!1;if(R.value.includes(d.value.id)){const ue=fe(Array.isArray(f.value)?[...f.value]:[f.value]);(ue==null?void 0:ue.length)!==((te=d.value.defaultMapValue)==null?void 0:te.length)?z=!0:ue.every(pe=>d.value.defaultMapValue.includes(pe))||(z=!0),m(d.value.id)}d.value.mapValue=fe(Array.isArray(f.value)?[...f.value]:[f.value]),z&&V(d.value.id)}else f.value=Array.isArray(f.value)?[...f.value]:f.value;se.value&&(g=setTimeout(()=>{clearTimeout(g),We()},300)),da.value=!1})},Ee=K(!1);ce(()=>d.value.showEmpty,()=>{Qe()});const We=()=>{k.value.length&&(f.value=k.value[0].value,S())};ce(()=>d.value.defaultValueFirstItem,Y=>{Y&&We()});const Qe=()=>{const{showEmpty:Y,displayType:te,optionValueSource:z}=d.value;if(+te!=0||z===1)return;const[ue]=k.value;Y?(ue==null?void 0:ue.value)!=="_empty_$"&&(k.value=[{label:n("v_query.empty_data"),value:"_empty_$"},...k.value]):(ue==null?void 0:ue.value)==="_empty_$"&&(k.value=k.value.slice(1))};ce(()=>d.value.defaultValue,Y=>{d.value.multiple&&(f.value=Array.isArray(Y)?[...Y]:Y),Me(()=>{D.value=d.value.multiple})}),ce(()=>d.value.id,()=>{E()}),ce(()=>d.value.selectValue,Y=>{t.isConfig||(d.value.multiple&&(f.value=Array.isArray(Y)?[...Y]:Y),Me(()=>{D.value=d.value.multiple,d.value.multiple||(f.value=Array.isArray(d.value.selectValue)?[...d.value.selectValue]:d.value.selectValue)}))}),ce(()=>d.value.multiple,Y=>{t.isConfig&&(Y&&(f.value=[]),Me(()=>{D.value=Y,d.value.defaultValueFirstItem=!1,Y||Me(()=>{f.value=void 0})}))}),ce([()=>d.value.field.id,()=>d.value.displayId,()=>d.value.sort,()=>d.value.sortId],Y=>{Y&&Ke(1)}),ce([()=>d.value.sortList],Y=>{!(Y!=null&&Y.length)||d.value.sort!=="customSort"||ye()}),ce(()=>d.value.optionValueSource,(Y,te)=>{t.isConfig&&([Y,te].includes(2)&&(f.value=Array.isArray(f.value)?[]:void 0,d.value.selectValue=qe(f.value),d.value.defaultValue=qe(f.value)),Ke(Y),d.value.defaultValueFirstItem=!1)}),ce([()=>d.value.checkedFields,()=>d.value.checkedFieldsMap],()=>{Ke(d.value.optionValueSource)},{deep:!0});const sa=K(""),da=K(!1);ce(()=>d.value.valueSource,()=>{d.value.optionValueSource===2&&Ke(2)});const Ke=Ul(Y=>{if(Y!==d.value.optionValueSource)return;const{optionValueSource:te,checkedFieldsMap:z,checkedFields:ue,field:pe,valueSource:De,displayId:xe,sort:ta,sortId:Oa}=d.value;switch(te){case 0:const ma=Object.values(z).filter($=>!!$);ue.length&&ma.length?ee(ue.map($=>z[$]).filter($=>!!$)):k.value=[];break;case 1:pe.id?me({queryId:pe.id,displayId:xe||pe.id,sort:ta==="customSort"?"asc":ta,sortId:ta==="customSort"?"":Oa,resultMode:d.value.resultMode||0,searchText:sa.value,filter:le()}):k.value=[];break;case 2:k.value=qe((De||[]).map($=>({label:`${$}`,value:`${$}`}))),Qe();break}},300),E=()=>{const{defaultValueCheck:Y,multiple:te,defaultValue:z,optionValueSource:ue}=d.value;Y?(d.value.selectValue=Array.isArray(z)?[...z]:z,f.value=Array.isArray(z)?[...z]:z):(d.value.selectValue=te?[]:void 0,f.value=te?[]:void 0),Me(()=>{D.value=d.value.multiple}),Ke(ue)},I=()=>{var Y;return(Y=B==null?void 0:B.value)!=null&&Y.placeholderShow?t.config.queryConditionWidth===void 0?X():t.config.queryConditionWidth:227},W=N(()=>t.isConfig?{}:{width:I()+"px"}),be=K(),Fe=K(),va=()=>{d.value.optionValueSource!==1||![0,2,5].includes(+d.value.displayType)||(d.value.selectValue=d.value.multiple?[]:void 0,f.value=d.value.multiple?[]:void 0,da.value=!0,Ke(1))},ua=()=>{xa().emitter.emit("select-hide_lick",d.value.id)},ea=Y=>{var z;if(Y===d.value.id)return;const te=Fe.value||be.value;(z=te==null?void 0:te.handleClickOutside)==null||z.call(te)};qa(()=>{E(),xa({name:`${d.value.id}-select`,callback:va}),xa({name:"select-hide_lick",callback:ea})});const pa=K(!1),Ta=N(()=>{let Y="filter-select-popper_class";return Ee.value&&(Y="load-select "+Y),pa.value&&(Y=Y+" color-scrollbar__thumb"),Y});Kt(()=>{pa.value=!!document.querySelector("#canvas-dv-outer")||!!document.querySelector(".datav-preview")});const ca=N(()=>{if(!Q||["#FFFFFF","rgba(255, 255, 255, 1)","rgb(255, 255, 255)"].includes(Q.background))return"";if(Q.background==="#131C42")return"rgb(38, 53, 82)";const Y=Q.background.startsWith("#")?Q.background:vn(Q.background);return Ja.mix(new ba("ffffff"),new ba(Y.substr(1)),{value:20}).toRGB()}),Da=N(()=>(I()-65)/2+"px"),_a=N(()=>(I()-65)/2-20+"px");return _({displayTypeChange:y,mult:be,single:Fe}),(Y,te)=>{const z=Ii,ue=ot,pe=st,De=Ol;return D.value?Xa((c(),U(z,{key:"multiple",ref_key:"mult",ref:be,modelValue:f.value,"onUpdate:modelValue":te[0]||(te[0]=xe=>f.value=xe),placeholder:H.value,filterable:"",onClick:ua,onChange:S,"popper-class":Ta.value,multiple:"","show-checked":"",tagColor:ca.value,"scrollbar-always-on":"",clearable:"",style:Ae(W.value),"collapse-tags":"",options:k.value,"collapse-tags-tooltip":""},null,8,["modelValue","placeholder","popper-class","tagColor","style","options"])),[[De,M.value]]):Xa((c(),U(z,{modelValue:f.value,"onUpdate:modelValue":te[2]||(te[2]=xe=>f.value=xe),key:"single",onClick:ua,placeholder:H.value,"scrollbar-always-on":"",onChange:S,clearable:"",disabled:se.value&&t.isConfig,ref_key:"single",ref:Fe,style:Ae(W.value),filterable:"",radio:"","popper-class":Ta.value,options:k.value},{default:r(({item:xe})=>[u(pe,{modelValue:f.value,"onUpdate:modelValue":te[1]||(te[1]=ta=>f.value=ta)},{default:r(()=>[u(ue,{title:xe.label,label:xe.value},{default:r(()=>[J(w(xe.label),1)]),_:2},1032,["title","label"])]),_:2},1032,["modelValue"])]),_:1},8,["modelValue","placeholder","disabled","style","popper-class","options"])),[[De,M.value]])}}});const pn=ja(Nr,[["__scopeId","data-v-ee1234c9"]]),Rr=Pe({__name:"Tree",props:{config:{type:Object,default:()=>({selectValue:"",defaultValue:"",queryConditionWidth:0,displayType:"",resultMode:0,defaultValueCheck:!1,multiple:!1,checkedFieldsMap:{},treeFieldList:[]})},isConfig:{type:Boolean,default:!1}},setup(o){Ct(P=>({"3cf55b24":F.value,"7c53e975":V.value,"8cd70e70":X.value}));const _=Ue("$custom-style-filter"),n=o,t=Ue("placeholder"),d=N(()=>{var P;return(P=t==null?void 0:t.value)!=null&&P.placeholderShow?["",void 0].includes(n.config.placeholder)?" ":n.config.placeholder:" "}),{config:s}=ia(n),f=K(!1),M=K(!1),D=P=>{le.value=P,k()},k=()=>{f.value=!0;const P=Array.isArray(le.value)?[...le.value]:le.value;if(!n.isConfig){s.value.selectValue=Array.isArray(le.value)?[...le.value]:le.value,Me(()=>{f.value=!1,Q(s.value.id)});return}s.value.defaultValue=P,f.value=!1},R=K(!1);ce(()=>s.value.id,()=>{R.value=!0,m(),Me(()=>{R.value=!1})});let B;ce(()=>s.value.treeFieldList,P=>{let ye=P.map(me=>me.id).join("-");R.value||ye===B||(B=ye,le.value=s.value.multiple?[]:void 0,s.value.defaultValue=s.value.multiple?[]:void 0,s.value.selectValue=s.value.multiple?[]:void 0,T.value=!1,Ce())});const m=()=>{e.value=!0;const{defaultValueCheck:P,multiple:ye,defaultValue:me}=s.value;P?(s.value.selectValue=Array.isArray(me)?qe([...me]):me,le.value=Array.isArray(me)?qe([...me]):me):(s.value.selectValue=ye?[]:void 0,le.value=ye?[]:void 0),Me(()=>{var Ee;B=(Ee=s.value.treeFieldList)==null?void 0:Ee.map(We=>We.id).join("-"),M.value=s.value.multiple}),Ce()},V=N(()=>Math.min(S()/3,50)+"px"),F=N(()=>S()-40+"px"),X=N(()=>Math.min(S()/3,50)-25+"px"),T=K(!0),ae=Ue("com-width",Function,!0),Q=Ue("is-confirm-search",Function,!0);ce(()=>s.value.id,()=>{Ce()}),Kt(()=>{setTimeout(()=>{m()},0)}),ce(()=>s.value.defaultValue,P=>{n.isConfig||(s.value.multiple&&(le.value=Array.isArray(P)?[...P]:P),Me(()=>{M.value=s.value.multiple}))}),ce(()=>s.value.selectValue,P=>{n.isConfig||f.value||(s.value.multiple&&(le.value=Array.isArray(P)?[...P]:P),Me(()=>{M.value=s.value.multiple,s.value.multiple||(le.value=Array.isArray(s.value.selectValue)?[...s.value.selectValue]:s.value.selectValue)}))});const H=K(!1);ce(()=>s.value.multiple,P=>{!n.isConfig||R.value||(H.value=!1,P&&(le.value=[]),Me(()=>{M.value=P,P||Me(()=>{le.value=void 0}),Me(()=>{H.value=!0})}))});let O="",g=it([]);const se=(P,ye)=>(ye.label??"").toLowerCase().includes((P??"").toLowerCase()),fe=P=>(P||[]).map(ye=>{var Ee;let me=[];return(Ee=ye.children)!=null&&Ee.length&&(me=fe(ye.children)),{...ye,value:ye.id,label:ye.text,children:me}}),e=K(!1),Ce=Ul(()=>{e.value=!0,ui({fieldIds:n.config.treeFieldList.map(P=>P.id),resultMode:s.value.resultMode||0}).then(P=>{g.value=fe(P)}).finally(()=>{e.value=!1,H.value=!0})},300);ce(()=>n.config.treeFieldList,P=>{if(!n.isConfig)return;const ye=P.map(me=>me.id).join("");O!==P.map(me=>me.id).join("")&&(O=ye,Ce())});const oe=K(""),le=K(),S=()=>{var P;return(P=t==null?void 0:t.value)!=null&&P.placeholderShow?n.config.queryConditionWidth!==void 0?n.config.queryConditionWidth:ae():227},y=N(()=>n.isConfig?{}:{width:S()+"px"}),ee=N(()=>{if(!_||["#FFFFFF","rgba(255, 255, 255, 1)","rgb(255, 255, 255)"].includes(_.background))return"";if(_.background==="#131C42")return"rgb(38, 53, 82)";const P=_.background.startsWith("#")?_.background:vn(_.background);return Ja.mix(new ba("ffffff"),new ba(P.substr(1)),{value:20}).toRGB()});return(P,ye)=>{const me=xl,Ee=Ol;return M.value&&!e.value?(c(),U(me,{modelValue:le.value,"onUpdate:modelValue":ye[0]||(ye[0]=We=>le.value=We),data:a(g),clearable:"",onTreeSelectConfirm:D,"render-after-expand":!1,"show-checkbox":"",showBtn:"",onChange:k,placeholder:d.value,"collapse-tags":"","filter-node-method":se,showWholePath:H.value,"collapse-tags-tooltip":"",tagColor:ee.value,key:"multipleTree"+S(),filterable:"",style:Ae(y.value),multiple:""},null,8,["modelValue","data","placeholder","showWholePath","tagColor","style"])):!M.value&&!e.value?(c(),U(me,{modelValue:le.value,"onUpdate:modelValue":ye[1]||(ye[1]=We=>le.value=We),onChange:k,data:a(g),"check-strictly":"",clearable:"","filter-node-method":se,placeholder:d.value,"render-after-expand":!1,key:"singleTree"+S(),showWholePath:H.value,style:Ae(y.value),filterable:""},null,8,["modelValue","data","placeholder","showWholePath","style"])):Xa((c(),U(me,{modelValue:oe.value,"onUpdate:modelValue":ye[2]||(ye[2]=We=>oe.value=We),data:[],placeholder:d.value,"render-after-expand":!1,key:"fakeTree",style:Ae(y.value)},null,8,["modelValue","placeholder","style"])),[[Ee,e.value]])}}});const fn=ja(Rr,[["__scopeId","data-v-d3b0bef9"]]),xr={class:"label"},Lr={class:"condition-type"},Yr={key:0,class:"condition-type"},Ur={class:"condition-type-tip"},Br={class:"label"},Gr={class:"setting-content",style:{display:"flex","align-items":"center"}},Pr={key:2,class:"list-item"},Wr={class:"label"},jr={class:"value"},Hr={key:3,class:"list-item"},zr={class:"label"},Qr={class:"setting-content"},Kr={key:0,class:"config-flag range-filter-time-flag"},Zr={key:4,class:"list-item"},Jr={class:"label"},Xr={key:5,class:"list-item"},eo={class:"label"},ao={key:0,class:"setting-content"},to={class:"setting"},lo={class:"setting"},no=["title"],io={class:"setting-value select"},uo={key:0,class:"setting"},ro={class:"setting"},oo={class:"setting-label"},so={class:"setting-value select"},co={class:"setting-label"},mo={class:"setting-input with-date range"},vo={class:"setting-label"},po={class:"setting-input with-date range"},fo={key:0,class:"setting-label"},yo={key:1,class:"first-item",style:{"margin-bottom":"8px"}},ho=Pe({__name:"ConditionDefaultConfiguration",props:{curComponent:{type:Object,required:!0},showPosition:{type:String,default:"main"}},emits:["handleTimeTypeChange"],setup(o,{expose:_,emit:n}){const{t}=ha(),d=K(!1),s=()=>{d.value=!1},f=S=>{S.stopPropagation(),d.value=!d.value},M=N(()=>{const{displayType:S,timeType:y="fixed"}=m.value;return["1","7"].includes(S)?y==="dynamic"?S==="1"?er:ar:mn:S==="9"?fn:pn}),D=n,k=S=>{S==="dynamic"&&D("handleTimeTypeChange")},R=o,B=N(()=>R.showPosition==="main"),{curComponent:m}=ia(R),V=K(!0);ce(()=>m.value.id,S=>{S&&(V.value=!1,Me(()=>{V.value=!0}))},{immediate:!0});const F=N(()=>{if(!m.value)return[];let S=["year","month","date","datetime"].indexOf(m.value.timeGranularity)+1;return+m.value.displayType==7&&(S=["yearrange","monthrange","daterange","datetimerange"].indexOf(m.value.timeGranularityMultiple)+1),[{label:t("dynamic_time.year"),value:"year"},{label:t("dynamic_time.month"),value:"month"},{label:t("dynamic_time.date"),value:"date"}].slice(0,S)}),X=N(()=>{let S=[];if(!m.value)return S;switch(m.value.timeGranularity){case"year":S=[{label:t("dynamic_year.current"),value:"thisYear"},{label:t("dynamic_year.last"),value:"lastYear"}];break;case"month":S=[{label:t("cron.this_month"),value:"thisMonth"},{label:t("dynamic_month.last"),value:"lastMonth"}];break;case"date":S=[{label:t("dynamic_time.today"),value:"today"},{label:t("dynamic_time.yesterday"),value:"yesterday"},{label:t("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:t("dynamic_time.endOfMonth"),value:"monthEnd"},{label:t("dynamic_time.firstOfYear"),value:"yearBeginning"}];break;case"datetime":S=[{label:t("dynamic_time.today"),value:"today"},{label:t("dynamic_time.yesterday"),value:"yesterday"},{label:t("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:t("dynamic_time.endOfMonth"),value:"monthEnd"},{label:t("dynamic_time.firstOfYear"),value:"yearBeginning"}];break}return[...S,{label:t("dynamic_time.custom"),value:"custom"}]}),T=N(()=>{let S=[];if(!m.value)return S;switch(m.value.timeGranularityMultiple){case"yearrange":S=[{label:t("dynamic_year.current"),value:"thisYear"},{label:t("dynamic_year.last"),value:"lastYear"}];break;case"monthrange":S=[{label:t("cron.this_month"),value:"thisMonth"},{label:t("dynamic_month.last"),value:"lastMonth"},{label:t("dynamic_time.tquarter"),value:"thisQuarter"},{label:t("v_query.last_3_months"),value:"LastThreeMonths"},{label:t("v_query.last_6_months"),value:"LastSixMonths"},{label:t("v_query.last_12_months"),value:"LastTwelveMonths"}];break;case"daterange":case"datetimerange":S=[{label:t("dynamic_time.today"),value:"today"},{label:t("dynamic_time.yesterday"),value:"yesterday"},{label:t("dynamic_time.cweek"),value:"thisWeek"},{label:t("v_query.last_3_days"),value:"LastThreeDays"},{label:t("v_query.month_to_date"),value:"monthBeginning"},{label:t("v_query.year_to_date"),value:"yearBeginning"}];break}return[...S,{label:t("dynamic_time.custom"),value:"custom"}]}),ae=N(()=>{const{displayType:S,optionValueSource:y,multiple:ee}=m.value;return+S==0&&y===1&&!ee}),Q=[{label:t("dynamic_time.before"),value:"f"},{label:t("dynamic_time.after"),value:"b"}],H=N(()=>{const{displayType:S,timeType:y}=m.value;return y==="dynamic"&&[1,7].includes(+S)}),O=[{label:t("v_query.exact_match"),value:"eq"},{label:t("v_query.fuzzy_match"),value:"like"}],g=K(!1),se=(S,y=!1)=>{y&&(m.value.defaultValue=S?[]:void 0);const{defaultValue:ee}=m.value;if(Array.isArray(ee)?m.value.selectValue=S?ee:void 0:m.value.selectValue=S?ee!==void 0?[ee]:[]:ee,m.value.field.deType===1){m.value.multiple=S;return}m.value.multiple=S},fe=S=>{g.value=S},e=K();return _({multipleChange:se,handleDialogClick:s,changeMultiple:fe,displayTypeChange:()=>{var S,y;(y=(S=e.value)==null?void 0:S.displayTypeChange)==null||y.call(S)},mult:()=>{var S,y,ee;(ee=(y=(S=e.value)==null?void 0:S.mult)==null?void 0:y.handleClickOutside)==null||ee.call(y)},single:()=>{var S,y,ee;(ee=(y=(S=e.value)==null?void 0:S.single)==null?void 0:y.handleClickOutside)==null||ee.call(y)}}),(S,y)=>{const ee=Pa,P=zt,ye=Xt,me=Ft,Ee=ot,We=st,Qe=Ga,sa=nt,da=Rl,ka=al,Ke=Vi;return c(),q(ie,null,[a(m).displayType==="8"?(c(),q("div",{key:0,class:"list-item top-item",onClick:y[4]||(y[4]=Ge(()=>{},["stop"]))},[h("div",xr,w(a(t)("dynamic_time.set_default")),1),h("div",{class:Te(["value",a(m).hideConditionSwitching&&"hide-condition_switching"])},[h("div",Lr,[a(m).hideConditionSwitching?j("",!0):(c(),U(a(Ye),{key:0,class:"condition-value-select","popper-class":"condition-value-select-popper",modelValue:a(m).defaultConditionValueOperatorF,"onUpdate:modelValue":y[0]||(y[0]=E=>a(m).defaultConditionValueOperatorF=E)},{default:r(()=>[(c(),q(ie,null,_e(O,E=>u(ee,{key:E.value,label:E.label,value:E.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])),u(P,{class:"condition-value-input",modelValue:a(m).defaultConditionValueF,"onUpdate:modelValue":y[1]||(y[1]=E=>a(m).defaultConditionValueF=E)},null,8,["modelValue"]),y[31]||(y[31]=h("div",{class:"bottom-line"},null,-1))]),[1,2].includes(a(m).conditionType)?(c(),q("div",Yr,[h("span",Ur,w(a(m).conditionType===1?a(t)("chart.and"):a(t)("chart.or")),1),a(m).hideConditionSwitching?j("",!0):(c(),U(a(Ye),{key:0,class:"condition-value-select","popper-class":"condition-value-select-popper",modelValue:a(m).defaultConditionValueOperatorS,"onUpdate:modelValue":y[2]||(y[2]=E=>a(m).defaultConditionValueOperatorS=E)},{default:r(()=>[(c(),q(ie,null,_e(O,E=>u(ee,{key:E.value,label:E.label,value:E.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])),u(P,{class:"condition-value-input",modelValue:a(m).defaultConditionValueS,"onUpdate:modelValue":y[3]||(y[3]=E=>a(m).defaultConditionValueS=E)},null,8,["modelValue"]),y[32]||(y[32]=h("div",{class:"bottom-line next-line"},null,-1))])):j("",!0)],2)])):j("",!0),a(m).displayType==="22"?(c(),q("div",{key:1,class:"list-item top-item",onClick:y[8]||(y[8]=Ge(()=>{},["stop"]))},[h("div",Br,[u(ye,{modelValue:a(m).defaultValueCheck,"onUpdate:modelValue":y[5]||(y[5]=E=>a(m).defaultValueCheck=E),label:a(t)("dynamic_time.set_default")},null,8,["modelValue","label"])]),h("div",Gr,[u(me,{disabled:!a(m).defaultValueCheck,placeholder:a(t)("system.the_minimum_value"),style:{width:"192.5px"},"controls-position":"right",modelValue:a(m).defaultNumValueStart,"onUpdate:modelValue":y[6]||(y[6]=E=>a(m).defaultNumValueStart=E)},null,8,["disabled","placeholder","modelValue"]),y[33]||(y[33]=h("div",{class:"num-value_line"},null,-1)),u(me,{placeholder:a(t)("system.the_maximum_value"),style:{width:"192.5px"},"controls-position":"right",disabled:!a(m).defaultValueCheck,modelValue:a(m).defaultNumValueEnd,"onUpdate:modelValue":y[7]||(y[7]=E=>a(m).defaultNumValueEnd=E)},null,8,["placeholder","disabled","modelValue"])])])):j("",!0),!["1","7","8","22"].includes(a(m).displayType)&&B.value?(c(),q("div",Pr,[h("div",Wr,w(a(t)("v_query.option_type")),1),h("div",jr,[u(We,{class:"larger-radio",onChange:y[9]||(y[9]=E=>se(E,!0)),modelValue:g.value,"onUpdate:modelValue":y[10]||(y[10]=E=>g.value=E)},{default:r(()=>[u(Ee,{label:!1},{default:r(()=>[J(w(a(t)("visualization.single_choice")),1)]),_:1}),u(Ee,{label:!0},{default:r(()=>[J(w(a(t)("visualization.multiple_choice")),1)]),_:1})]),_:1},8,["modelValue"])])])):j("",!0),["7","1"].includes(a(m).displayType)&&B.value?(c(),q("div",Hr,[h("div",zr,[u(ye,{modelValue:a(m).setTimeRange,"onUpdate:modelValue":y[11]||(y[11]=E=>a(m).setTimeRange=E),label:a(t)("v_query.time_filter_range")},null,8,["modelValue","label"])]),h("div",Qr,[u(da,{"show-arrow":!1,"popper-class":"range-filter-time",placement:"bottom-start",width:452,visible:d.value,offset:4},{reference:r(()=>[u(sa,{disabled:!a(m).setTimeRange,onClick:y[12]||(y[12]=E=>f(E)),text:"",style:{"margin-left":"-4px"}},{icon:r(()=>[u(Qe,{name:"icon_admin_outlined"},{default:r(()=>[u(a(ki),{class:"svg-icon"})]),_:1})]),default:r(()=>[J(" "+w(a(t)("dynamic_time.set")),1)]),_:1},8,["disabled"])]),default:r(()=>[a(m).displayType==="7"?(c(),U($u,{key:0,timeRange:a(m).timeRange,timeGranularityMultiple:a(m).timeGranularityMultiple},null,8,["timeRange","timeGranularityMultiple"])):(c(),U(Xu,{key:1,timeRange:a(m).timeRange,timeGranularity:a(m).timeGranularity},null,8,["timeRange","timeGranularity"]))]),_:1},8,["visible"]),a(m).timeRange&&(a(m).timeRange.intervalType!=="none"||a(m).timeRange.dynamicWindow)?(c(),q("span",Kr,w(a(t)("v_query.configured")),1)):j("",!0)])])):j("",!0),+a(m).displayType==0&&a(m).optionValueSource!==1&&B.value?(c(),q("div",Zr,[h("div",Jr,[u(ka,{effect:"dark",content:a(t)("v_query.is_not_supported"),disabled:!a(m).parametersCheck,placement:"top"},{default:r(()=>[u(ye,{disabled:a(m).parametersCheck,modelValue:a(m).showEmpty,"onUpdate:modelValue":y[13]||(y[13]=E=>a(m).showEmpty=E),label:a(t)("v_query.contains_empty_data")},null,8,["disabled","modelValue","label"])]),_:1},8,["content","disabled"])])])):j("",!0),["8","22"].includes(a(m).displayType)?j("",!0):(c(),q("div",Xr,[h("div",eo,[u(ye,{modelValue:a(m).defaultValueCheck,"onUpdate:modelValue":y[14]||(y[14]=E=>a(m).defaultValueCheck=E),label:a(t)("dynamic_time.set_default")},null,8,["modelValue","label"])]),a(m).defaultValueCheck&&["1","7"].includes(a(m).displayType)?(c(),q("div",ao,[h("div",to,[u(We,{onChange:k,modelValue:a(m).timeType,"onUpdate:modelValue":y[15]||(y[15]=E=>a(m).timeType=E)},{default:r(()=>[u(Ee,{label:"fixed"},{default:r(()=>[J(w(a(t)("dynamic_time.fix")),1)]),_:1}),u(Ee,{label:"dynamic"},{default:r(()=>[J(w(a(t)("dynamic_time.dynamic")),1)]),_:1})]),_:1},8,["modelValue"])]),H.value&&a(m).displayType==="1"?(c(),q(ie,{key:0},[h("div",lo,[h("div",{title:a(t)("dynamic_time.relative"),class:"setting-label ellipsis"},w(a(t)("dynamic_time.relative")),9,no),h("div",io,[u(a(Ye),{onFocus:s,modelValue:a(m).relativeToCurrent,"onUpdate:modelValue":y[16]||(y[16]=E=>a(m).relativeToCurrent=E)},{default:r(()=>[(c(!0),q(ie,null,_e(X.value,E=>(c(),U(ee,{key:E.value,label:E.label,value:E.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),a(m).relativeToCurrent==="custom"?(c(),q("div",uo,[h("div",{class:Te(["setting-input",a(m).timeGranularity==="datetime"&&"with-date"])},[u(me,{"step-strictly":"",modelValue:a(m).timeNum,"onUpdate:modelValue":y[17]||(y[17]=E=>a(m).timeNum=E),min:0,"controls-position":"right"},null,8,["modelValue"]),u(a(Ye),{onFocus:s,modelValue:a(m).relativeToCurrentType,"onUpdate:modelValue":y[18]||(y[18]=E=>a(m).relativeToCurrentType=E)},{default:r(()=>[(c(!0),q(ie,null,_e(F.value,E=>(c(),U(ee,{key:E.value,label:E.label,value:E.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u(a(Ye),{onFocus:s,modelValue:a(m).around,"onUpdate:modelValue":y[19]||(y[19]=E=>a(m).around=E)},{default:r(()=>[(c(),q(ie,null,_e(Q,E=>u(ee,{key:E.value,label:E.label,value:E.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),a(m).timeGranularity==="datetime"?(c(),U(Ke,{key:0,modelValue:a(m).arbitraryTime,"onUpdate:modelValue":y[20]||(y[20]=E=>a(m).arbitraryTime=E)},null,8,["modelValue"])):j("",!0)],2)])):j("",!0)],64)):H.value&&a(m).displayType==="7"?(c(),q(ie,{key:1},[h("div",ro,[h("div",oo,w(a(t)("dynamic_time.relative")),1),h("div",so,[u(a(Ye),{onFocus:s,modelValue:a(m).relativeToCurrentRange,"onUpdate:modelValue":y[21]||(y[21]=E=>a(m).relativeToCurrentRange=E)},{default:r(()=>[(c(!0),q(ie,null,_e(T.value,E=>(c(),U(ee,{key:E.value,label:E.label,value:E.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),a(m).relativeToCurrentRange==="custom"?(c(),q("div",{key:0,class:Te(["setting",["yearrange","monthrange","daterange"].includes(a(m).timeGranularityMultiple)&&"is-year-month-range"])},[h("div",co,w(a(t)("datasource.start_time")),1),h("div",mo,[u(me,{"step-strictly":"",modelValue:a(m).timeNum,"onUpdate:modelValue":y[22]||(y[22]=E=>a(m).timeNum=E),min:0,"controls-position":"right"},null,8,["modelValue"]),u(a(Ye),{onFocus:s,modelValue:a(m).relativeToCurrentType,"onUpdate:modelValue":y[23]||(y[23]=E=>a(m).relativeToCurrentType=E)},{default:r(()=>[(c(!0),q(ie,null,_e(F.value,E=>(c(),U(ee,{key:E.value,label:E.label,value:E.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u(a(Ye),{onFocus:s,modelValue:a(m).around,"onUpdate:modelValue":y[24]||(y[24]=E=>a(m).around=E)},{default:r(()=>[(c(),q(ie,null,_e(Q,E=>u(ee,{key:E.value,label:E.label,value:E.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),u(Ke,{modelValue:a(m).arbitraryTime,"onUpdate:modelValue":y[25]||(y[25]=E=>a(m).arbitraryTime=E)},null,8,["modelValue"])])],2)):j("",!0),a(m).relativeToCurrentRange==="custom"?(c(),q("div",{key:1,class:Te(["setting",["yearrange","monthrange","daterange"].includes(a(m).timeGranularityMultiple)&&"is-year-month-range"])},[h("div",vo,w(a(t)("datasource.end_time")),1),h("div",po,[u(me,{modelValue:a(m).timeNumRange,"onUpdate:modelValue":y[26]||(y[26]=E=>a(m).timeNumRange=E),min:0,"step-strictly":"","controls-position":"right"},null,8,["modelValue"]),u(a(Ye),{onFocus:s,modelValue:a(m).relativeToCurrentTypeRange,"onUpdate:modelValue":y[27]||(y[27]=E=>a(m).relativeToCurrentTypeRange=E)},{default:r(()=>[(c(!0),q(ie,null,_e(F.value,E=>(c(),U(ee,{key:E.value,label:E.label,value:E.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u(a(Ye),{onFocus:s,modelValue:a(m).aroundRange,"onUpdate:modelValue":y[28]||(y[28]=E=>a(m).aroundRange=E)},{default:r(()=>[(c(),q(ie,null,_e(Q,E=>u(ee,{key:E.value,label:E.label,value:E.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),u(Ke,{modelValue:a(m).arbitraryTimeRange,"onUpdate:modelValue":y[29]||(y[29]=E=>a(m).arbitraryTimeRange=E)},null,8,["modelValue"])])],2)):j("",!0)],64)):j("",!0)])):j("",!0),a(m).defaultValueCheck&&V.value?(c(),q("div",{key:1,class:Te(["parameters",H.value&&"setting"])},[H.value?(c(),q("div",fo,w(a(t)("template_manage.preview")),1)):j("",!0),ae.value?(c(),q("div",yo,[u(ye,{modelValue:a(m).defaultValueFirstItem,"onUpdate:modelValue":y[30]||(y[30]=E=>a(m).defaultValueFirstItem=E)},{default:r(()=>[J(w(S.$t("common.first_item")),1)]),_:1},8,["modelValue"])])):j("",!0),h("div",{class:Te(H.value?"setting-value":"w100")},[(c(),U(ze(M.value),{config:a(m),isConfig:"",ref_key:"inputCom",ref:e},null,8,["config"]))],2)],2)):j("",!0)]))],64)}}});const _o=ja(ho,[["__scopeId","data-v-889e0362"]]),go={class:"query-condition-list"},bo={class:"title"},Vo=["onDblclick","onClick"],ko=["title"],To={class:"condition-icon flex-align-center"},Co=["onClick"],Mo={key:0,class:"mask"},Fo={class:"title flex-align-center"},So={class:"flex-align-center"},wo={class:"select-all"},$o={class:"field-list"},qo=["title"],Do=["title"],Oo={class:"flex-align-center icon"},Io=["title"],Ao=["onClick"],Eo={class:"flex-align-center icon"},No=["title"],Ro=["onClick"],xo=["title"],Lo=["title"],Yo=["onClick"],Uo={key:3,style:{width:"172px","margin-left":"12px"}},Bo={key:0,class:"mask condition"},Go={class:"title flex-align-center"},Po={class:"configuration-list"},Wo={class:"list-item"},jo={class:"label"},Ho={class:"value"},zo={key:0,class:"list-item"},Qo=["title"],Ko={class:"value"},Zo={key:1,class:"list-item"},Jo=["title"],Xo={class:"value"},es={class:"content"},as=["title"],ts={key:2,class:"list-item"},ls={class:"label",style:{width:"135px",height:"26px","line-height":"26px"}},ns={class:"search-tree"},is={class:"level-index"},us={class:"field-type"},rs=["title"],os={key:0,class:"field-relationship_chart"},ss={key:1,class:"field-relationship_chart"},ds={key:3,class:"list-item"},cs=["title"],ms={class:"value"},vs={key:4,class:"list-item top-item"},ps=["title"],fs={class:"value"},ys={class:"value"},hs={class:"value"},_s={class:"content"},gs=["title"],bs={style:{display:"flex","align-items":"center"},class:"value ellipsis"},Vs=["title"],ks=["title"],Ts={style:{display:"flex","align-items":"center"},class:"value"},Cs=["title"],Ms=["title"],Fs={class:"value"},Ss={class:"label"},ws=["title"],$s={key:1,class:"value flex-align-center"},qs={class:"manual-input-container"},Ds={class:"title"},Os={class:"select-value"},Is={class:"add-btn"},As={class:"manual-footer flex-align-center"},Es={key:0,class:"config-flag flex-align-center"},Ns=["title"],Rs={class:"value",style:{"margin-top":"10.5px"}},xs={key:5,class:"list-item top-item"},Ls=["title"],Ys={class:"value"},Us={class:"value"},Bs={key:6,style:{"margin-bottom":"10.5px"}},Gs={key:1,class:"empty"},Ps={key:2,class:"empty"},Ws={key:3,class:"empty"},js={class:"dialog-footer"},Hs=Pe({__name:"QueryConditionConfiguration",props:{queryElement:{type:Object,default(){return{id:null,propValue:[]}}}},emits:["queryData","reRenderAll"],setup(o,{expose:_,emit:n}){const{t}=ha(),{wsCache:d}=xn(),s=ut(),{componentData:f,canvasViewInfo:M}=Mt(s),D=K(null),k=o,R=K(!1),B=K([]),m=K([]),V=K([]),F=K(!1),X=Al({id:"",name:"",visible:!1}),T={},ae=Nl(),Q=()=>{let l=f.value.filter(i=>!["VQuery","DeTabs"].includes(i.innerType)&&i.component!=="Group");return f.value.forEach(i=>{i.innerType==="DeTabs"?i.propValue.forEach(v=>{l=[...l,...v.componentData.filter(b=>!["VQuery","DeTabs"].includes(b.innerType)&&b.component!=="Group")],v.componentData.forEach(b=>{b.component==="Group"&&(l=[...l,b.propValue.filter(L=>!["VQuery","DeTabs"].includes(L.innerType)&&L.component!=="Group")])})}):i.component==="Group"&&(l=[...l,i.propValue.filter(v=>!["VQuery","DeTabs"].includes(v.innerType)&&v.component!=="Group")],i.propValue.forEach(v=>{v.innerType==="DeTabs"&&v.propValue.forEach(b=>{l=[...l,...b.componentData.filter(L=>!["VQuery","DeTabs"].includes(L.innerType)&&L.component!=="Group")]})}))}),l.flat()},H=N(()=>Q().map(l=>{const i=M.value[l.id];if(!i)return null;const{id:v,title:b,tableId:L,type:A}=i;return v&&L?{id:v,type:A,title:b,tableId:L}:null}).filter(l=>!!l)),O=l=>{V.value.forEach(i=>{i.optionValueSource===1&&[0,2,5].includes(+i.displayType)&&l.includes(i.id)&&(i.selectValue=Array.isArray(i.selectValue)?[]:void 0,i.defaultValue=Array.isArray(i.defaultValue)?[]:void 0,i.mapValue=Array.isArray(i.mapValue)?[]:void 0,i.defaultMapValue=Array.isArray(i.defaultMapValue)?[]:void 0)})};let g=[];const se=l=>{g=l},fe=()=>g;ga("set-cascade-default",O),ga("cascade-list",fe);const e=K(),Ce=K(),oe=K(""),le=K(!1),S=it([]),y=K(),{queryElement:ee}=ia(k),P=(l,i)=>{var v;return(v=i.flat().find(b=>b.id===l))==null?void 0:v.deType},ye=N(()=>{var l;return!e.value||!((l=e.value.checkedFields)!=null&&l.length)?!1:e.value.checkedFields.some(i=>!!e.value.checkedFieldsMap[i])}),me=N(()=>{var b,L;if(!e.value||!((b=e.value.checkedFields)!=null&&b.length)||!((L=y.value)!=null&&L.length))return!1;if(e.value.parameters.length&&$.value){const A=e.value.parameters.map(ge=>ge.type[1]),[G]=A;if(A.some(ge=>ge!==G))return!0}let l=null,i=0,v=e.value.checkedFields.every(A=>{var G,ge;return(ge=(G=e.value.checkedFieldsMapArrNum)==null?void 0:G[A])==null?void 0:ge.length})&&["22"].includes(e.value.displayType);return e.value.checkedFields.some(A=>{var he,Le,Ne,we,Ve,ra,Xe,He,$e;if(v)return!1;if((Le=(he=e.value.checkedFieldsMapArrNum)==null?void 0:he[A])!=null&&Le.length&&["22","2"].includes(e.value.displayType)&&(i===0&&(i=1),i===2)||!((we=(Ne=e.value.checkedFieldsMapArrNum)==null?void 0:Ne[A])!=null&&we.length)&&["22","2"].includes(e.value.displayType)&&e.value.parameters.some(aa=>[2,3].includes(aa.deType))&&e.value.checkedFieldsMap[A]&&(i===0&&(i=2),i===1))return!0;const G=y.value.find(aa=>aa.componentId===A),ge=(Ve=e.value.checkedFieldsMap)==null?void 0:Ve[A],ne=pe(Object.values((G==null?void 0:G.fields)||{}).flat()).find(aa=>ge===aa.id);if(!ne)return!1;if(l===null)return l=ne,!1;if((l==null?void 0:l.deType)===(ne==null?void 0:ne.deType)&&(l==null?void 0:l.deType)===1){if(!Array.isArray(ne.type)||!Array.isArray(l.type)||!((ra=l.type)!=null&&ra.length)&&!((Xe=ne.type)!=null&&Xe.length))return!1;if(((He=l.type)==null?void 0:He.length)!==(($e=ne.type)==null?void 0:$e.length))return!0}return[2,3].includes(ne==null?void 0:ne.deType)&&[2,3].includes(l.deType)?!1:l.deType!==(ne==null?void 0:ne.deType)})}),Ee=[{label:t("data_fill.rename"),command:"rename"},{label:t("data_fill.delete"),command:"del"}],We=l=>{e.value.checkedFields=l?y.value.map(i=>i.componentId):[],le.value=!1,l&&sa()},Qe=l=>{la();const i=l.length;F.value=i===y.value.length,le.value=i>0&&i<y.value.length,e.value.displayType!=="8"&&xe()},sa=()=>{const l={};Object.keys(e.value.checkedFieldsMap).forEach(i=>{e.value.checkedFieldsMap[i]&&y.value.forEach(v=>{var b;v.componentId===i&&((b=e.value.checkedFields)!=null&&b.includes(v.componentId))&&(l[v.id]=e.value.checkedFieldsMap[v.componentId],l[`active-${v.id}`]=v.activelist)})}),Object.keys(e.value.checkedFieldsMap).forEach(i=>{e.value.checkedFieldsMap[i]||y.value.forEach(v=>{var b;v.componentId===i&&((b=e.value.checkedFields)!=null&&b.includes(v.componentId))&&l[v.id]&&(e.value.checkedFieldsMap[v.componentId]=l[v.id],v.activelist=l[`active-${v.id}`])})})},da=l=>{la();const i=l.length;F.value=i===y.value.length,le.value=i>0&&i<y.value.length,sa(),e.value.displayType!=="8"&&(ca(),Rt(),xe())},ka=l=>{let i=!1;return!C.value&&$.value&&de.value.length&&l.deType!==1&&(i=!0),i},Ke=(l,i)=>{var L,A;(A=(L=e.value.checkedFieldsMapArr)==null?void 0:L[i])!=null&&A.length&&(e.value.checkedFieldsMapArr[i]=[],e.value.checkedFieldsMapEnd[i]="",e.value.checkedFieldsMapStart[i]="");const v=e.value.checkedFieldsMapStartNum[i],b=e.value.checkedFieldsMapEndNum[i];v&&(e.value.checkedFieldsMapEndNum[i]=l.find(G=>G!==v)),b&&(e.value.checkedFieldsMapStartNum[i]=l.find(G=>G!==b)),l.length||(e.value.checkedFieldsMap[i]="",e.value.checkedFieldsMapEndNum[i]="",e.value.checkedFieldsMapStartNum[i]="",e.value.parametersArr[i]=[]),e.value.checkedFieldsMapArrNum[i].length&&Y(i),ma()},E=(l,i)=>{var L,A;(A=(L=e.value.checkedFieldsMapArrNum)==null?void 0:L[i])!=null&&A.length&&(e.value.checkedFieldsMapArrNum[i]=[],e.value.checkedFieldsMapEndNum[i]="",e.value.checkedFieldsMapStartNum[i]="");const v=e.value.checkedFieldsMapStart[i],b=e.value.checkedFieldsMapEnd[i];v&&(e.value.checkedFieldsMapEnd[i]=l.find(G=>G!==v)),b&&(e.value.checkedFieldsMapStart[i]=l.find(G=>G!==b)),l.length||(e.value.checkedFieldsMap[i]="",e.value.checkedFieldsMapEnd[i]="",e.value.checkedFieldsMapStart[i]="",e.value.displayType="1",e.value.parametersArr[i]=[],e.value.timeGranularity="",e.value.timeGranularityMultiple=""),e.value.checkedFieldsMapArr[i].length&&te(i),ma()};let I="",W="";const be=K(!1),Fe=K(0),va=K(""),ua=K(!1),ea=K(0),pa=K(""),Ta=()=>{e.value.checkedFieldsMapArr[I]||(e.value.checkedFieldsMapArr[I]=[]),Fe.value===0&&(e.value.checkedFieldsMap[I]=W,e.value.checkedFieldsMapArr[I]=[],e.value.checkedFieldsMapStart[I]="",e.value.checkedFieldsMapEnd[I]=""),Fe.value===1&&(e.value.checkedFieldsMapStart[I]=W,e.value.checkedFieldsMapArr[I]=[...new Set([...e.value.checkedFieldsMapArr[I],W])],e.value.checkedFieldsMapArr[I].length===1?e.value.checkedFieldsMapEnd[I]="":e.value.checkedFieldsMapEnd[I]=e.value.checkedFieldsMapArr[I].length===2?e.value.checkedFieldsMapArr[I].find(l=>l!==W):W),Fe.value===2&&(e.value.checkedFieldsMapArr[I]=[...new Set([...e.value.checkedFieldsMapArr[I],W])],e.value.checkedFieldsMapEnd[I]=W,e.value.checkedFieldsMapArr[I].length===1?e.value.checkedFieldsMapStart[I]="":e.value.checkedFieldsMapStart[I]=e.value.checkedFieldsMapArr[I].length===2?e.value.checkedFieldsMapArr[I].find(l=>l!==W):W),e.value.displayType=e.value.checkedFieldsMapArr[I].length?"7":"1",te(I),ma(),be.value=!1},ca=()=>{if(!(e.value.displayType!=="9"||Je.value!==0)&&e.value.checkedFields.length){let l="";y.value.forEach(i=>{var v;e.value.checkedFields.includes(i.componentId)&&e.value.checkedFieldsMap[i.componentId]&&!l&&(l=(v=H.value.find(b=>b.id===i.componentId))==null?void 0:v.tableId)}),l&&!e.value.treeDatasetId&&(e.value.treeDatasetId=l,Ka(e.value.treeDatasetId,e.value))}},Da=l=>{if(l.checkedFields.length){let i="";y.value.forEach(v=>{var b;v.checkedFields.includes(v.componentId)&&v.checkedFieldsMap[v.componentId]&&!i&&(i=(b=H.value.find(L=>L.id===v.componentId))==null?void 0:b.tableId)}),i&&!l.treeDatasetId&&(l.treeDatasetId=i)}},_a=()=>{e.value.checkedFieldsMapArrNum[I]||(e.value.checkedFieldsMapArrNum[I]=[]),ea.value===0&&(e.value.checkedFieldsMap[I]=W,e.value.checkedFieldsMapArrNum[I]=[],e.value.checkedFieldsMapStartNum[I]="",e.value.checkedFieldsMapEndNum[I]=""),ea.value===1&&(e.value.checkedFieldsMapStartNum[I]=W,e.value.checkedFieldsMapArrNum[I]=[...new Set([...e.value.checkedFieldsMapArrNum[I],W])],e.value.checkedFieldsMapArrNum[I].length===1?e.value.checkedFieldsMapEndNum[I]="":e.value.checkedFieldsMapEndNum[I]=e.value.checkedFieldsMapArrNum[I].length===2?e.value.checkedFieldsMapArrNum[I].find(l=>l!==W):W),ea.value===2&&(e.value.checkedFieldsMapArrNum[I]=[...new Set([...e.value.checkedFieldsMapArrNum[I],W])],e.value.checkedFieldsMapEndNum[I]=W,e.value.checkedFieldsMapArrNum[I].length===1?e.value.checkedFieldsMapStartNum[I]="":e.value.checkedFieldsMapStartNum[I]=e.value.checkedFieldsMapArrNum[I].length===2?e.value.checkedFieldsMapArrNum[I].find(l=>l!==W):W),e.value.displayType=e.value.checkedFieldsMapArrNum[I].length?"22":"2",Y(I),ma(),ua.value=!1},Y=l=>{e.value.parametersArr[l]=pe(a(y).filter(i=>i.componentId===l).map(i=>Object.values((i==null?void 0:i.fields)||{}).flat()).flat().filter(i=>[e.value.checkedFieldsMapEndNum[l],e.value.checkedFieldsMapStartNum[l]].filter(v=>!!v).includes(i.id)&&!!i.variableName))},te=l=>{if(e.value.parametersArr[l]=pe(a(y).filter(b=>b.componentId===l).map(b=>Object.values((b==null?void 0:b.fields)||{}).flat()).flat().filter(b=>[e.value.checkedFieldsMapEnd[l],e.value.checkedFieldsMapStart[l]].filter(L=>!!L).includes(b.id)&&!!b.variableName)),!e.value.parametersArr[l].length)return;const[i,v]=e.value.parametersArr[l][0].type;e.value.timeGranularityMultiple=je[v||i]?`${je[v||i]}range`:"",e.value.timeGranularity=je[v||i]},z=(l,i)=>{ea.value=i.id===e.value.checkedFieldsMapStartNum[l]?1:i.id===e.value.checkedFieldsMapEndNum[l]?2:0,I=l,W=i.id,pa.value=i.variableName,ua.value=!0},ue=(l,i)=>{Fe.value=i.id===e.value.checkedFieldsMapStart[l]?1:i.id===e.value.checkedFieldsMapEnd[l]?2:0,I=l,W=i.id,va.value=i.variableName,be.value=!0},pe=l=>{const i=[];let v=l.map(b=>b.id);for(let b=0;b<l.length;b++){const L=l[b];v.includes(L.id)&&(i.push(L),v=v.filter(A=>A!==L.id))}return i},De=l=>{const i=Object.values(e.value.checkedFieldsMap).filter(b=>!!b);e.value.parameters=pe(Object.values((l==null?void 0:l.fields)||{}).flat().filter(b=>i.includes(b.id)&&!!b.variableName).concat(e.value.parameters.filter(b=>i.includes(b.id)))),y.value.forEach(b=>{var L;b.id===l.id&&((L=e.value.checkedFields)!=null&&L.includes(b.componentId))&&!e.value.checkedFieldsMap[b.componentId]&&(b.activelist=l.activelist,e.value.checkedFieldsMap[b.componentId]=e.value.checkedFieldsMap[l.componentId])});const v=e.value.checkedFields.some(b=>e.value.checkedFieldsMapStart[b]||e.value.checkedFieldsMapEnd[b])&&+e.value.displayType==7;Me(()=>{if($.value&&!v){const b=e.value.parameters.find(L=>L.deType===1);e.value.timeGranularity=je[b.type[1]||b.type[0]],e.value.displayType="1"}if(e.value.parameters.length&&(e.value.conditionType=0,e.value.optionValueSource===0&&(e.value.optionValueSource=1)),e.value.displayType==="22"){const b=e.value.checkedFields.some(A=>{var G;return(G=e.value.parameters)==null?void 0:G.some(ge=>[2,3].includes(ge.deType)&&e.value.checkedFieldsMap[A]===ge.id)});e.value.checkedFields.every(A=>{var G,ge;return!((ge=(G=e.value.checkedFieldsMapArr)==null?void 0:G[A])!=null&&ge.length)})&&b&&(e.value.displayType="2")}ma()}),!v&&(xe(),ca(),Rt())},xe=()=>{var l,i;if((l=e.value.checkedFields)!=null&&l.length){const[v]=e.value.checkedFields,b=y.value.find(G=>G.componentId===v),L=(i=e.value.checkedFieldsMap)==null?void 0:i[v],A=Object.values((b==null?void 0:b.fields)||{}).flat().find(G=>L===G.id);if((A==null?void 0:A.deType)!==void 0){let G=e.value.displayType;if(["22"].includes(e.value.displayType)&&[2,3].includes(A==null?void 0:A.deType)||["9"].includes(e.value.displayType))return;(A==null?void 0:A.deType)===1&&e.value.displayType==="7"||(e.value.displayType=`${[3,4].includes(A==null?void 0:A.deType)?2:A==null?void 0:A.deType}`),(A==null?void 0:A.deType)===7&&(e.value.displayType="0"),+G!=+e.value.displayType&&!([3,4].includes(+G)&&+e.value.displayType==2)&&ma()}}e.value.checkedFields.some(v=>e.value.checkedFieldsMapStart[v]||e.value.checkedFieldsMapEnd[v])&&+e.value.displayType==1&&(e.value.displayType="7")};let ta;const Oa=()=>{let l=e.value.displayType;ta==="9"&&["0","8"].includes(l)?(e.value.displayType="9",hl.confirm(t("common.changing_the_display"),{confirmButtonType:"primary",type:"warning",cancelButtonText:t("common.cancel"),autofocus:!1,showClose:!1}).then(()=>{e.value.displayType=l,ma()})):ma()},ma=()=>{la(),Me(()=>{var l,i,v;e.value.field.id="",(i=(l=D.value)==null?void 0:l.displayTypeChange)==null||i.call(l),+e.value.displayType==7&&["yearrange","monthrange","daterange","datetimerange"].includes(e.value.timeGranularity)&&(e.value.timeGranularityMultiple=e.value.timeGranularity),ca(),Rt(),e.value.displayType==="0"&&((v=e.value.treeFieldList)!=null&&v.length)&&(e.value.treeFieldList=[],e.value.treeCheckedList=[]),ta=e.value.displayType})},$=N(()=>e.value.checkedFields.some(l=>{var i;return(i=e.value.parameters)==null?void 0:i.some(v=>v.deType===1&&!!v.variableName&&e.value.checkedFieldsMap[l]===v.id)})),C=N(()=>{var l;return(l=e.value.parameters)==null?void 0:l.some(i=>[2,3].includes(i.deType)&&!!i.variableName)}),re=N(()=>e.value.checkedFields.some(l=>{var i;return((i=e.value.checkedFieldsMapArrNum[l])==null?void 0:i.length)>0})),ve=N(()=>e.value.checkedFields.every(l=>{var i,v;return((v=(i=e.value.checkedFieldsMapArrNum)==null?void 0:i[l])==null?void 0:v.length)>0})?!1:e.value.checkedFields.some(l=>{var i;return(i=e.value.parameters)==null?void 0:i.some(v=>[2,3].includes(v.deType)&&e.value.checkedFieldsMap[l]===v.id)})),Z=N(()=>e.value.checkedFields.some(l=>{var i;return((i=e.value.checkedFieldsMapArr[l])==null?void 0:i.length)>0})),de=N(()=>{const l=a(y).map(b=>Object.values((b==null?void 0:b.fields)||{}).flat()).flat(),i=Object.values(e.value.checkedFieldsMapArr||{}).flat(),v=l.find(b=>b.id===i[0]);return(v==null?void 0:v.type)||[]}),Ie=[{label:t("dynamic_time.year"),value:"year"},{label:t("chart.y_M"),value:"month"},{label:t("chart.y_M_d"),value:"date"},{label:t("chart.y_M_d_H_m_s"),value:"datetime"}],je={"DATETIME-YEAR":"year","YYYY-MM":"month","YYYY/MM":"month","YYYY-MM-DD":"date","YYYY/MM/DD":"date","YYYY-MM-DD HH:mm:ss":"datetime","YYYY/MM/DD HH:mm:ss":"datetime"},Ca=N(()=>{var b;if(!$.value)return Ie;const[l,i]=(b=e.value.parameters)==null?void 0:b.filter(L=>L.deType===1&&!!L.variableName)[0].type;let v=!1;return Ie.reduce((L,A)=>(A.value===(je[i]||je[l])?(v=!0,L.push(A)):v||L.push(A),L),[])}),Aa=()=>{la(),R.value=!1},Ha=()=>{si({}).then(l=>{var v;const i=l||[];((v=i[0])==null?void 0:v.id)==="0"?dt(Lt(i[0].children)):dt(Lt(i))})},dt=l=>{const i=d.get("TreeSort-dataset")||"time_desc";S.value=Ei(l,i)};let La="",Ea="";const qt=l=>{var b,L,A;if(!((b=e.value.dataset)!=null&&b.id))return;let i=`${(L=e.value.dataset)==null?void 0:L.id}--${e.value.id}`,v=!1;for(let G in g){const[ge,ne]=g[G];(ge!=null&&ge.datasetId.includes(i)||ne!=null&&ne.datasetId.includes(i))&&(v=!0)}v&&(Ea=(A=e.value.dataset)==null?void 0:A.id,La=l.id)},Dt=()=>{e.value.dataset.id=La,Na(`${Ea}--${e.value.id}`),La="",Ea="",ct()},ct=()=>{if(La&&Ea){e.value.dataset.id=Ea,hl.confirm(t("v_query.to_modify_it"),{confirmButtonType:"primary",type:"warning",confirmButtonText:t("commons.confirm"),cancelButtonText:t("commons.cancel"),autofocus:!1,showClose:!1}).then(()=>{Dt()});return}e.value.field.id="",e.value.displayId="",e.value.sortId="",Ka(e.value.dataset.id,e.value)},Ot=()=>{e.value.treeFieldList=[],e.value.treeCheckedList=[],Je.value=0,e.value.oldTreeLoad=!0,Ka(e.value.treeDatasetId,e.value)},za=()=>{e.value.defaultValueCheck&&(e.value.defaultValue=e.value.multiple?[]:void 0,e.value.displayId||(e.value.displayId=e.value.field.id))},mt=()=>{if(e.value.defaultValue=e.value.multiple?[]:void 0,Qa(e.value.multiple),e.value.optionValueSource===1&&!e.value.dataset.id){let l="",i="";Object.keys(e.value.checkedFieldsMap).forEach(v=>{e.value.checkedFieldsMap[v]&&(i=v,l=e.value.checkedFieldsMap[v])}),y.value.forEach(v=>{v.componentId===i&&(e.value.dataset.id=v.id)}),e.value.displayId=l,e.value.sortId=l,e.value.field.id=l,Ka(e.value.dataset.id,e.value)}},Qa=(l,i=!1)=>{i&&(e.value.defaultValue=l?[]:void 0);const{defaultValue:v}=e.value;Array.isArray(v)?e.value.selectValue=l?v:void 0:e.value.selectValue=l?v!==void 0?[v]:[]:v,e.value.multiple=l},It=(l,i,v)=>{const{intervalType:b,regularOrTrends:L,regularOrTrendsValue:A,relativeToCurrent:G,timeNum:ge,relativeToCurrentType:ne,around:he,dynamicWindow:Le,maximumSingleQuery:Ne,timeNumRange:we,relativeToCurrentRange:Ve,relativeToCurrentTypeRange:ra,aroundRange:Xe}=l.timeRange||{};let He=!1;const $e=l.timeGranularityMultiple.split("time").join("").split("range")[0],aa=$e==="date"?"day":$e;if(i&&Le&&(He=ke(i).add(Ne,aa).startOf(aa).valueOf()-1e3<v),b==="none")return Le?He:!1;let Re;if(G==="custom")Re=ya(ne,he==="f"?"subtract":"add",ge);else switch(G){case"thisYear":Re=Ze("year");break;case"lastYear":Re=wa("year");break;case"thisMonth":Re=Ze("month");break;case"lastMonth":Re=wa("month");break;case"thisQuarter":Re=Ze("quarter");break;case"thisWeek":Re=new Date(ke().startOf("week").add(1,"day").startOf("day").format("YYYY/MM/DD HH:mm:ss"));break;case"today":Re=Ze("day");break;case"yesterday":Re=wa("day");break;case"monthBeginning":Re=Ze("month");break;case"monthEnd":Re=el("month");break;case"yearBeginning":Re=Ze("year");break}const fa=L==="fixed"?A:Re;if(b==="start")return i<+new Date(fa)||He;if(b==="end")return v>+new Date(fa)||He;if(b==="timeInterval"){let na;return Ve==="custom"?(Re=L==="fixed"?new Date(ke(new Date(A[0])).startOf($e).format("YYYY/MM/DD HH:mm:ss")):ya(ne,he==="f"?"subtract":"add",ge),na=L==="fixed"?new Date(ke(new Date(A[1])).endOf($e).format("YYYY/MM/DD HH:mm:ss")):ya(ra,Xe==="f"?"subtract":"add",we)):[Re,na]=at(Ve),i<+new Date(Re)-1e3||v>+new Date(na)||He}},At=Pn(()=>Hn(()=>import("./QueryCascade-0.0.0-dataease.js"),[],import.meta.url)),vt=K(),Et=()=>{const l=V.value.filter(i=>{var v;return[0,2,5].includes(+i.displayType)&&i.optionValueSource===1&&!!((v=i.checkedFields)!=null&&v.length)&&!!Object.values(i.checkedFieldsMap).filter(b=>!!b).length}).reduce((i,v)=>{var b,L,A;return i[v.id]={datasetId:v.dataset.id,name:v.name,queryId:v.id,fieldId:v.field.id,deType:(A=(((L=(b=T[v.dataset.id])==null?void 0:b.fields)==null?void 0:L.dimensionList)||v.dataset.fields).find(G=>G.id===v.field.id))==null?void 0:A.deType},i},{});vt.value.init(l,g)},Na=l=>{for(let i in g){const[v,b]=g[i];v!=null&&v.datasetId.includes(l)?g[i]=[]:b!=null&&b.datasetId.includes(l)&&(g[i]=[v])}g=g.filter(i=>!!i.length)},yn=[t("visualization.number1"),t("visualization.number2"),t("visualization.number3"),t("visualization.number4"),t("visualization.number5")],hn=({defaultConditionValueF:l,defaultConditionValueS:i,conditionType:v})=>v===0?l==="":l===""||i==="",ll=l=>{const{defaultConditionValueOperatorF:i,defaultConditionValueF:v,defaultConditionValueOperatorS:b,defaultConditionValueS:L}=l;l.conditionValueOperatorF=i,l.conditionValueF=v,l.conditionValueOperatorS=b,l.conditionValueS=L},_n=()=>V.value.some(l=>{var L,A,G,ge,ne;if(l.auto)return!1;if(!((L=l.checkedFields)!=null&&L.length)||l.checkedFields.some(he=>!l.checkedFieldsMap[he]))return Oe.error(t("v_query.be_linked_first")),!0;if(l.displayType==="0"&&l.defaultValueCheck&&(Array.isArray(l.defaultValue)&&!l.defaultValue.length||!l.defaultValue))return Oe.error(t("report.filter.title")),!0;if(l.displayType==="9"){if(l.defaultValueCheck&&(Array.isArray(l.defaultValue)&&!l.defaultValue.length||!l.defaultValue))return Oe.error(t("report.filter.title")),!0;if(!l.treeDatasetId)return Da(l),l.treeDatasetId||Oe.error(t("data_set.dataset_cannot_be")),!0;if(!((A=l.treeFieldList)!=null&&A.length))return Oe.error(t("common.tree_structure")),!0;if((G=l.treeCheckedList)!=null&&G.slice(0,l.treeFieldList.length).some(he=>{var Le;return!((Le=he.checkedFields)!=null&&Le.length)||he.checkedFields.some(Ne=>!he.checkedFieldsMap[Ne])}))return Oe.error(t("v_query.be_linked_first")),!0}if(l.displayType==="22"&&l.defaultValueCheck){if(l.numValueEnd=l.defaultNumValueEnd,l.numValueStart=l.defaultNumValueStart,l.defaultNumValueEnd!==0&&!l.defaultNumValueEnd||l.defaultNumValueStart!==0&&!l.defaultNumValueStart)return Oe.error(t("v_query.cannot_be_empty_de")),!0;if(!isNaN(l.defaultNumValueEnd)&&!isNaN(l.defaultNumValueStart)&&l.defaultNumValueEnd<l.defaultNumValueStart)return Oe.error(t("v_query.the_minimum_value")),!0}let i=null,v=t("v_query.cannot_be_performed"),b=0;if(l.checkedFields.some(he=>{var Ve,ra,Xe,He,$e,aa,Re,fa,na,p,x,Be,Ra;if((ra=(Ve=l.checkedFieldsMapArrNum)==null?void 0:Ve[he])!=null&&ra.length&&(b===0&&(b=1),b===2)||!((He=(Xe=l.checkedFieldsMapArrNum)==null?void 0:Xe[he])!=null&&He.length)&&["22"].includes(l.displayType)&&l.parameters.length&&(b===0&&(b=2),b===1))return!0;if(((aa=($e=l.checkedFieldsMapArrNum)==null?void 0:$e[he])==null?void 0:aa.length)===1&&l.displayType==="22")return v=t("v_query.numerical_parameter_configuration"),!0;if(((fa=(Re=l.checkedFieldsMapArr)==null?void 0:Re[he])==null?void 0:fa.length)===1&&l.displayType==="7")return v=t("v_query.and_end_time"),!0;const Le=y.value.find(Ma=>Ma.componentId===he),Ne=(na=l.checkedFieldsMap)==null?void 0:na[he],we=pe(Object.values((Le==null?void 0:Le.fields)||{}).flat()).find(Ma=>Ne===Ma.id);if(!we)return!1;if(i===null)return i=we,!1;if((i==null?void 0:i.deType)===(we==null?void 0:we.deType)&&(i==null?void 0:i.deType)===1){if(!Array.isArray(we.type)||!Array.isArray(i.type)||!((p=i.type)!=null&&p.length)&&!((x=we.type)!=null&&x.length))return!1;if(((Be=i.type)==null?void 0:Be.length)!==((Ra=we.type)==null?void 0:Ra.length))return v=t("v_query.format_is_inconsistent"),!0;for(let Ma=0;Ma<i.type.length;Ma++)if(i.type[Ma]!==we.type[Ma])return v=t("v_query.format_is_inconsistent"),!0}return i.deType!==(we==null?void 0:we.deType)}))return Oe.error(v),!0;if(l.required){if(l.displayType==="8"){ll(l);const he=hn(l);return he&&Oe.error(t("v_query.cannot_be_empty_de")),he}if(!l.defaultValueCheck)return Oe.error(t("v_query.cannot_be_empty_de")),!0;if(l.displayType==="22")return l.defaultNumValueEnd!==0&&!l.defaultNumValueEnd||l.defaultNumValueStart!==0&&!l.defaultNumValueStart?(Oe.error(t("v_query.cannot_be_empty_de")),!0):!1;if(Array.isArray(l.defaultValue)&&!l.defaultValue.length||l.defaultValue!==0&&!l.defaultValue)return Oe.error(t("v_query.cannot_be_empty_de")),!0}if(l.displayType==="8")return ll(l),!1;if(!l.defaultValueCheck){const he=+l.displayType==7||l.multiple;l.selectValue=he?[]:void 0,l.defaultValue=he?[]:void 0}if(l.displayType==="1"){if(!l.defaultValueCheck)return!1;if(l.timeType==="fixed"&&!l.defaultValue)return Oe.error(t("v_query.cannot_be_empty_time")),!0}if(l.displayType==="2"){if(!l.defaultValueCheck)return!1;if(Array.isArray(l.defaultValue)&&!l.defaultValue.length||!Array.isArray(l.defaultValue)&&["",void 0,null].includes(l.defaultValue))return Oe.error(t("report.filter.title")),!0}if(+l.displayType==7){if(!l.defaultValueCheck)return!1;if(l.timeType==="fixed"){const[x,Be]=l.defaultValue||[];if(!x||!Be)return Oe.error(t("v_query.cannot_be_empty_time")),!0}const{timeNum:he,relativeToCurrentType:Le,around:Ne,relativeToCurrentRange:we,timeGranularityMultiple:Ve,arbitraryTime:ra,timeGranularity:Xe,timeNumRange:He,relativeToCurrentTypeRange:$e,aroundRange:aa,arbitraryTimeRange:Re,timeType:fa}=l;let na=fa==="dynamic"?et(he,Le,Xe,Ne,ra,Ve,"start-config"):new Date(l.defaultValue[0]),p=fa==="dynamic"?et(He,$e,Xe,aa,Re,Ve,"end-config"):new Date(l.defaultValue[1]);return we&&we!=="custom"&&([na,p]=at(we)),+na>+p?(Oe.error(t("v_query.the_start_time")),!0):l.setTimeRange&&It(l,Ve.includes("time")?ke(+na).startOf("day").valueOf():+na,Ve.includes("time")?ke(+p).startOf("day").valueOf():+p)?(Oe.error(t("v_query.range_please_reset")),!0):!1}if(l.displayType!=="9"&&l.optionValueSource===2&&!((ge=l.valueSource)!=null&&ge.filter(he=>!!he).length))return Oe.error(t("v_query.cannot_be_empty_input")),!0;if(!["9","22","1","7"].includes(l.displayType)&&l.optionValueSource===1&&!l.field.id)return Oe.error((ne=l.dataset)!=null&&ne.id?t("v_query.the_data_set"):t("v_query.option_value_field")),!0}),gn=()=>{var l,i;(l=D.value)==null||l.mult(),(i=D.value)==null||i.single(),la(),e.value.id="",Je.value=0,R.value=!1},nl=n,bn=()=>{var i,v;if(_n())return;(i=D.value)==null||i.mult(),(v=D.value)==null||v.single(),la(),R.value=!1,V.value.forEach(b=>{e.value=b,Qa(["1","7"].includes(e.value.displayType)?e.value.displayType==="7":e.value.multiple)});const l=qe(a(ee.value.propValue));ee.value.propValue=[],Me(()=>{V.value.forEach(b=>{g.forEach(L=>{L.forEach(A=>{if(A.datasetId.split("--")[1]===b.id&&b.defaultValueCheck){const G=b.mapValue;A.selectValue=Array.isArray(G)?[...G]:G,A.currentSelectValue=Array.isArray(G)?[...G]:G}})})}),ee.value.cascade=qe(g),g=[],ee.value.propValue=qe(V.value),ae.recordSnapshotCache("confirmClick"),e.value.id="",Je.value=0,Me(()=>{nl("reRenderAll",l,qe(a(V))),nl("queryData")})})},Vn=N(()=>e.value.dataset.fields.filter(l=>l.deType===+e.value.displayType||[0,2,3,4].includes(l.deType)&&[0,2].includes(+e.value.displayType)||l.deType===7&&+e.value.displayType==0)),il=()=>{m.value=qe(e.value.valueSource),m.value.length||m.value.push(""),Ce.value.hide()},kn=()=>{if(m.value.some(l=>typeof l=="string"?!l.trim():!1)){Oe.error(t("v_query.cannot_be_empty_input"));return}e.value.valueSource=qe(m.value.filter(l=>typeof l=="string"?l.trim():!0)),mt(),il()},Tn=l=>{V.value=(qe(k.queryElement.propValue)||[]).map(i=>Nt(i)),rl(l)},Cn=()=>{V.value=(qe(k.queryElement.propValue)||[]).map(l=>Nt(l)),Yt(),rl(V.value[V.value.length-1].id)},ul=(l,i)=>{let v="dimensionList";return l.some((b,L)=>(b||[]).some(A=>A.id===i)?(v=["dimensionList","quotaList","parameterList"][L],!0):!1),v},rl=l=>{Ha(),Je.value=0,B.value=[],pt({id:l}),g=qe(ee.value.cascade||[]),R.value=!0;const i=H.value.map(L=>L.tableId);for(const L in T)i.includes(L)||delete T[L];const v=Object.keys(T);i.every(L=>v.includes(L))&&(y.value=H.value.map(L=>T[L.tableId]?{...T[L.tableId],componentId:L.id}:null).filter(L=>!!L));const b=[...new Set(H.value.map(L=>L.tableId).filter(L=>!!L))];b.length&&Promise.all([ri(b),oi(b)]).then(([L,A])=>{L.filter(G=>!!G).forEach(G=>{G.activelist="dimensionList",G.fields.parameterList=A.filter(ge=>{var ne;return ge.datasetGroupId===G.id&&!((ne=ge.params)!=null&&ne.length)}),G.hasParameter=!!G.fields.parameterList.length,G.fields.dimensionList=(G.fields.dimensionList||[]).filter(ge=>{var ne;return!((ne=ge.params)!=null&&ne.length)}),G.fields.quotaList=(G.fields.quotaList||[]).filter(ge=>{var ne;return!((ne=ge.params)!=null&&ne.length)}),T[G.id]=G}),y.value=H.value.map(G=>{if(!T[G.tableId])return null;const ge=T[G.tableId].fields||{},ne=ul([ge.dimensionList,ge.quotaList,ge.parameterList],e.value.checkedFieldsMap[G.id]);return{...T[G.tableId],componentId:G.id,activelist:ne}}).filter(G=>!!G)}).finally(()=>{e.value.treeDatasetId||Me(()=>{ca()}),Qe(e.value.checkedFields)})},ol=()=>{m.value=Array.from(new Set(m.value))},Nt=l=>(Object.entries({timeType:"fixed",hideConditionSwitching:!1,required:!1,defaultMapValue:[],mapValue:[],parametersStart:null,conditionType:0,conditionValueOperatorF:"eq",conditionValueF:"",conditionValueOperatorS:"like",conditionValueS:"",resultMode:0,defaultConditionValueOperatorF:"eq",defaultConditionValueF:"",defaultConditionValueOperatorS:"like",defaultConditionValueS:"",parametersEnd:null,relativeToCurrent:"custom",timeNum:0,relativeToCurrentRange:"custom",relativeToCurrentType:"year",around:"f",arbitraryTime:new Date,timeNumRange:0,relativeToCurrentTypeRange:"year",aroundRange:"f",treeDatasetId:"",displayId:"",sortId:"",sort:"asc",arbitraryTimeRange:new Date,setTimeRange:!1,showEmpty:!1,defaultNumValueStart:null,defaultNumValueEnd:null,numValueEnd:null,numValueStart:null,timeRange:{intervalType:"none",dynamicWindow:!1,maximumSingleQuery:0,regularOrTrends:"fixed",regularOrTrendsValue:"",relativeToCurrent:"custom",timeNum:0,relativeToCurrentType:"year",around:"f",timeNumRange:0,relativeToCurrentTypeRange:"year",aroundRange:"f"},oldTreeLoad:!1,treeCheckedList:[],defaultValueFirstItem:!1,treeFieldList:[]}).forEach(([v,b])=>{l[v]??(l[v]=b)}),l.treeDatasetId||(l.treeDatasetId=l.dataset.id),l.timeRange.relativeToCurrentRange||(l.timeRange.relativeToCurrentRange="custom"),l),pt=(l,i=0)=>{var L;if(la(),X.id)return;oe.value=l.id;const v=V.value.find(A=>A.id===l.id);v.checkedFieldsMapArr||(v.checkedFieldsMapArr={},v.checkedFieldsMapArrNum={},v.checkedFieldsMapStart={},v.checkedFieldsMapStartNum={},v.checkedFieldsMapEnd={},v.checkedFieldsMapEndNum={},v.parametersArr={}),e.value=v,e.value.dataset.fields=[],Me(()=>{D.value.changeMultiple(e.value.multiple)}),e.value.dataset.id&&Vl(e.value.dataset.id).then(A=>{e.value.dataset.fields=A.data}),e.value.checkedFieldsMapStart||(e.value.checkedFieldsMapStart={}),e.value.checkedFieldsMapStartNum||(e.value.checkedFieldsMapStartNum={}),e.value.checkedFieldsMapEnd||(e.value.checkedFieldsMapEnd={}),e.value.checkedFieldsMapEndNum||(e.value.checkedFieldsMapEndNum={}),e.value.checkedFieldsMapArr||(e.value.checkedFieldsMapArr={}),e.value.checkedFieldsMapArrNum||(e.value.checkedFieldsMapArrNum={}),e.value.parametersArr||(e.value.parametersArr={}),H.value.forEach(A=>{e.value.checkedFieldsMap[A.id]||(e.value.checkedFieldsMap[A.id]=""),e.value.checkedFieldsMapStart[A.id]||(e.value.checkedFieldsMapStart[A.id]=""),e.value.checkedFieldsMapStartNum[A.id]||(e.value.checkedFieldsMapStartNum[A.id]=""),e.value.checkedFieldsMapEnd[A.id]||(e.value.checkedFieldsMapEnd[A.id]=""),e.value.checkedFieldsMapEndNum[A.id]||(e.value.checkedFieldsMapEndNum[A.id]=""),e.value.checkedFieldsMapArr[A.id]||(e.value.checkedFieldsMapArr[A.id]=[]),e.value.checkedFieldsMapArrNum[A.id]||(e.value.checkedFieldsMapArrNum[A.id]=[]),e.value.parametersArr[A.id]||(e.value.parametersArr[A.id]=[])});const b=H.value.map(A=>A.id);e.value.checkedFields=e.value.checkedFields.filter(A=>b.includes(A)),(L=y.value)!=null&&L.length&&(y.value.forEach(A=>{const G=A.fields;A.activelist=ul([G.dimensionList,G.quotaList,G.parameterList],e.value.checkedFieldsMap[A.componentId])}),Qe(e.value.checkedFields)),Qa(e.value.multiple),m.value=qe(e.value.valueSource),m.value.length||m.value.push(""),Me(()=>{var A;e.value.displayType==="9"&&(ta="9",xt(i,!0),!e.value.treeDatasetId&&((A=y.value)!=null&&A.length)?Me(()=>{ca()}):e.value.treeDatasetId&&Ka(e.value.treeDatasetId,e.value)),e.value.showError=ml.value,e.value.auto&&(document.querySelector(".chart-field").scrollTop=0)})},Ka=(l,i)=>{Vl(l).then(v=>{i.dataset.fields=v.data})},Mn=()=>{za(),e.value.sortList=[],Za.value&&(e.value.sort="")},Fn=()=>{Za.value&&(e.value.sort=""),e.value.defaultValueCheck&&(e.value.defaultValue=e.value.multiple?[]:void 0)},sl=K(),Sn=l=>{e.value.sortList=qe(l)},wn=async()=>{if(Za.value||e.value.sort!=="customSort")return;let l=qe(e.value.sortList||[]);l.length||(l=(await Ll({queryId:e.value.sortId,searchText:""})).map(v=>v[e.value.sortId])),sl.value.sortInit([...new Set(l)])},Za=N(()=>{const{sortId:l,displayId:i}=e.value;return l&&i&&l!==i}),dl=K(),cl=()=>{dl.value.init(e.value.dataset.fields.filter(l=>l.groupType==="d"&&l.deType===0),e.value.treeFieldList)},$n=l=>{e.value.treeFieldList=l,qn()},qn=()=>{e.value.treeFieldList.forEach((l,i)=>{e.value.treeCheckedList[i]||(e.value.treeCheckedList=[...e.value.treeCheckedList,{checkedFields:[...e.value.checkedFields],checkedFieldsMap:qe(e.value.checkedFieldsMap)}]),y.value.forEach(v=>{v.fields.dimensionList.map(L=>L.id).includes(l.id)&&(e.value.treeCheckedList[i].checkedFieldsMap[v.componentId]=l.id)})}),e.value.checkedFields=e.value.treeCheckedList[Je.value].checkedFields,e.value.checkedFieldsMap=e.value.treeCheckedList[Je.value].checkedFieldsMap},ml=N(()=>{if(!e.value)return!1;const{optionValueSource:l,checkedFieldsMap:i,checkedFields:v,field:b,valueSource:L,displayType:A,treeCheckedList:G,treeFieldList:ge}=e.value,ne=v.filter(he=>!!i[he]);if(!v.length||!ne.length)return!0;if(+A==9)for(const he in G){if(he>ge.length)continue;const Le=G[he].checkedFields.filter(Ne=>!!G[he].checkedFieldsMap[Ne]);if(!G[he].checkedFields.length||!Le.length)return!0}return[1,7,8,22,9].includes(+A)?!1:l===1&&!b.id||l===2&&!L.length}),la=()=>{var l;(l=D.value)==null||l.handleDialogClick()},Dn=N(()=>{let l=[];if(!e.value)return l;switch(e.value.timeGranularity){case"year":l=[{label:t("dynamic_year.current"),value:"thisYear"},{label:t("dynamic_year.last"),value:"lastYear"}];break;case"month":l=[{label:t("cron.this_month"),value:"thisMonth"},{label:t("dynamic_month.last"),value:"lastMonth"}];break;case"date":l=[{label:t("dynamic_time.today"),value:"today"},{label:t("dynamic_time.yesterday"),value:"yesterday"},{label:t("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:t("dynamic_time.endOfMonth"),value:"monthEnd"},{label:t("dynamic_time.firstOfYear"),value:"yearBeginning"}];break;case"datetime":l=[{label:t("dynamic_time.today"),value:"today"},{label:t("dynamic_time.yesterday"),value:"yesterday"},{label:t("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:t("dynamic_time.endOfMonth"),value:"monthEnd"},{label:t("dynamic_time.firstOfYear"),value:"yearBeginning"}];break}return[...l,{label:t("dynamic_time.custom"),value:"custom"}]}),On=N(()=>{let l=[];if(!e.value)return l;switch(e.value.timeGranularityMultiple){case"yearrange":l=[{label:t("dynamic_year.current"),value:"thisYear"},{label:t("dynamic_year.last"),value:"lastYear"}];break;case"monthrange":l=[{label:t("cron.this_month"),value:"thisMonth"},{label:t("dynamic_month.last"),value:"lastMonth"},{label:t("v_query.last_3_months"),value:"LastThreeMonths"},{label:t("v_query.last_6_months"),value:"LastSixMonths"},{label:t("v_query.last_12_months"),value:"LastTwelveMonths"}];break;case"daterange":case"datetimerange":l=[{label:t("dynamic_time.today"),value:"today"},{label:t("dynamic_time.yesterday"),value:"yesterday"},{label:t("v_query.last_3_days"),value:"LastThreeDays"},{label:t("v_query.month_to_date"),value:"monthBeginning"},{label:t("v_query.year_to_date"),value:"yearBeginning"}];break}return[...l,{label:t("dynamic_time.custom"),value:"custom"}]}),vl=l=>{var i;e.value.relativeToCurrentType=["date","datetime"].includes(l)?"date":l,e.value.relativeToCurrent!=="custom"&&(e.value.relativeToCurrent=(i=Dn.value[0])==null?void 0:i.value)},In=()=>{e.value.displayType==="1"?vl(e.value.timeGranularity):pl(e.value.timeGranularityMultiple)},pl=l=>{var i;la(),e.value.relativeToCurrentType=["daterange","datetimerange"].includes(l)?"date":l.split("range")[0],e.value.relativeToCurrentTypeRange=e.value.relativeToCurrentType,e.value.relativeToCurrentRange!=="custom"&&(e.value.relativeToCurrentRange=(i=On.value[0])==null?void 0:i.value),e.value.timeRange={intervalType:"none",dynamicWindow:!1,maximumSingleQuery:0,regularOrTrends:"fixed",regularOrTrendsValue:"",relativeToCurrent:"custom",relativeToCurrentRange:"custom",timeNum:0,relativeToCurrentType:e.value.relativeToCurrentRange,around:"f",timeNumRange:0,relativeToCurrentTypeRange:e.value.relativeToCurrentRange,aroundRange:"f"}};ce(()=>ml.value,l=>{e.value.showError=l});const An=l=>{B.value.push(l)},Je=K(0),En=(l,i)=>{oe.value!==l.id?pt(l,i):xt(i)},Rt=()=>{e.value.treeCheckedList[Je.value]={checkedFields:[...e.value.checkedFields],checkedFieldsMap:qe(e.value.checkedFieldsMap)}},xt=(l,i=!1)=>{var A,G,ge,ne,he,Le,Ne,we,Ve;if((A=e.value.treeCheckedList)!=null&&A.length&&!i&&(e.value.treeCheckedList[Je.value]={checkedFields:[...e.value.checkedFields],checkedFieldsMap:qe(e.value.checkedFieldsMap)}),Je.value=l,!((ge=(G=e.value)==null?void 0:G.treeCheckedList)!=null&&ge.length)&&!e.value.oldTreeLoad?e.value.treeCheckedList=e.value.treeFieldList.map(ra=>({checkedFields:[...e.value.checkedFields],checkedFieldsMap:e.value.checkedFields.reduce((Xe,He)=>(Xe[He]=ra.id,Xe),{})})):!((he=(ne=e.value)==null?void 0:ne.treeCheckedList)!=null&&he.length)&&e.value.oldTreeLoad&&(e.value.treeCheckedList=e.value.treeFieldList.map(()=>({checkedFields:[...e.value.checkedFields],checkedFieldsMap:qe(e.value.checkedFieldsMap)}))),!((Le=e.value)!=null&&Le.treeCheckedList[l]))return;const{checkedFields:v,checkedFieldsMap:b}=(Ne=e.value)==null?void 0:Ne.treeCheckedList[l];e.value.checkedFields=v,e.value.checkedFieldsMap=b;const L=v==null?void 0:v.length;F.value=L===((we=y.value)==null?void 0:we.length),le.value=L>0&&L<((Ve=y.value)==null?void 0:Ve.length)},fl=(l,i,v)=>{switch(l){case"del":B.value=[],V.value.splice(v,1),e.value=null;break;case"rename":B.value=[],Object.assign(X,i),setTimeout(()=>{Me(()=>{B.value[0].focus()})},400);break}},yl={label:"name",children:"children",value:"id",isLeaf:l=>{var i;return!((i=l.children)!=null&&i.length)}},Lt=l=>l.filter(i=>{var v,b;return(v=i.children)!=null&&v.length&&!i.leaf?(i.children=Lt(i.children),!!((b=i.children)!=null&&b.length)):i.leaf}),Nn=()=>{var l;if(X.name.trim()===""){Oe.error(t("v_query.cannot_be_empty_name")),(l=B.value[0])==null||l.focus();return}V.value.some(i=>X.id===i.id?(i.name=X.name,!0):!1),X.id=""},Yt=()=>{Je.value=0,V.value.push(Nt(Hi()))},Rn=()=>{Yt(),pt(V.value[V.value.length-1])};return _({setCondition:Tn,addCriteriaConfig:()=>(Yt(),V.value[V.value.length-1].id),setConditionOut:Cn}),(l,i)=>{const v=Ga,b=Ht,L=Ga,A=Xn,G=zt,ge=al,ne=ot,he=st,Le=Xt,Ne=Zn,we=Jn,Ve=Pa,ra=Kn,Xe=Ln,He=xl,$e=nt,aa=Rl,Re=Jt,fa=zn,na=Qn;return c(),q(ie,null,[u(Re,{class:"query-condition-configuration",modelValue:R.value,"onUpdate:modelValue":i[21]||(i[21]=p=>R.value=p),width:"1200px",title:a(t)("v_query.query_condition_setting"),onClick:i[22]||(i[22]=Ge(()=>{},["stop"])),"before-close":gn,onMousedown:i[23]||(i[23]=Ge(()=>{},["stop"])),onMousedup:i[24]||(i[24]=Ge(()=>{},["stop"]))},{footer:r(()=>[h("div",js,[u($e,{class:"query-cascade",onClick:Et},{default:r(()=>[J(w(a(t)("v_query.component_cascade_configuration")),1)]),_:1}),u($e,{onClick:Aa},{default:r(()=>[J(w(a(t)("chart.cancel")),1)]),_:1}),u($e,{onClick:bn,type:"primary"},{default:r(()=>[J(w(a(t)("chart.confirm")),1)]),_:1})])]),default:r(()=>[h("div",{class:"container",onClick:la},[h("div",go,[h("div",bo,[J(w(a(t)("v_query.query_condition"))+" ",1),u(b,{onClick:Rn},{default:r(()=>[u(v,{name:"icon_add_outlined"},{default:r(()=>[u(a(bt),{class:"svg-icon"})]),_:1})]),_:1})]),u(a(Yl),{tag:"div",list:V.value,handle:".handle"},{item:r(({element:p,index:x})=>[(c(),q("div",{key:p.id,onDblclick:Ge(Be=>fl("rename",p,x),["stop"]),onClick:Ge(Be=>pt(p),["stop"]),class:"list-item_box",style:Ae({marginBottom:p.treeFieldList?p.treeFieldList.slice(1).length*40+"px":0})},[h("div",{class:Te(["list-item_primary",p.id===oe.value&&Je.value===0&&"active"])},[u(b,{class:"handle"},{default:r(()=>[u(v,{name:"icon_drag_outlined"},{default:r(()=>[u(a(ai),{class:"svg-icon"})]),_:1})]),_:1}),h("div",{class:"label flex-align-center icon",title:p.name},[!p.auto&&p.showError?(c(),U(b,{key:0,style:{"font-size":"16px",color:"#f54a45"}},{default:r(()=>[u(L,{name:"icon_warning_filled"},{default:r(()=>[u(a(li),{class:"svg-icon"})]),_:1})]),_:1})):j("",!0),J(" "+w(p.name),1)],8,ko),h("div",To,[u(A,{onHandleCommand:Be=>fl(Be,p,x),"menu-list":Ee,"icon-name":a(ei),placement:"bottom-end"},null,8,["onHandleCommand","icon-name"]),p.visible?(c(),U(b,{key:0,class:"hover-icon",onClick:Ge(Be=>p.visible=!p.visible,["stop"])},{default:r(()=>[u(v,{name:"icon_visible_outlined"},{default:r(()=>[u(a(ti),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])):(c(),U(b,{key:1,class:"hover-icon",onClick:Ge(Be=>p.visible=!p.visible,["stop"])},{default:r(()=>[u(v,{name:"de_pwd_invisible"},{default:r(()=>[u(a(xi),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"]))]),X.id===p.id?(c(),q("div",{key:0,onClick:i[1]||(i[1]=Ge(()=>{},["stop"])),class:"rename"},[u(G,{onBlur:Nn,ref:An,modelValue:X.name,"onUpdate:modelValue":i[0]||(i[0]=Be=>X.name=Be)},null,8,["modelValue"])])):j("",!0)],2),p.treeFieldList?(c(!0),q(ie,{key:0},_e(p.treeFieldList.slice(1),(Be,Ra)=>(c(),q("div",{class:Te([p.id===oe.value&&Je.value===Ra+1&&"active","list-item_primary list-tree_primary"]),style:Ae({top:40*(Ra+1)+"px",paddingLeft:32+16*(Ra+1)+"px"}),key:Be.field,onClick:Ge(Ma=>En(p,Ra+1),["stop"])},w(Be.name),15,Co))),128)):j("",!0)],44,Vo))]),_:1},8,["list"])]),e.value?(c(),q("div",{key:0,class:Te(["chart-field",e.value.auto&&"hidden"])},[u(Xe,null,{default:r(()=>[e.value.auto?(c(),q("div",Mo)):j("",!0),h("div",Fo,[J(w(a(t)("v_query.chart_and_field"))+" ",1),u(he,{class:"ml-4 larger-radio",modelValue:e.value.auto,"onUpdate:modelValue":i[2]||(i[2]=p=>e.value.auto=p)},{default:r(()=>[u(ne,{disabled:!e.value.auto,label:!0},{default:r(()=>[h("div",So,[J(w(a(t)("chart.margin_model_auto"))+" ",1),u(ge,{effect:"dark",placement:"top"},{content:r(()=>[h("div",null,[J(w(a(t)("v_query.be_switched_to"))+" ",1),i[31]||(i[31]=h("br",null,null,-1)),J(" "+w(a(t)("v_query.to_automatic_again")),1)])]),default:r(()=>[u(b,{style:{"margin-left":"4px",color:"#646a73"}},{default:r(()=>[u(L,{name:"icon_info_outlined"},{default:r(()=>[u(a(ni),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})])]),_:1},8,["disabled"]),u(ne,{label:!1},{default:r(()=>[J(w(a(t)("commons.custom")),1)]),_:1})]),_:1},8,["modelValue"])]),h("div",wo,[u(Le,{modelValue:F.value,"onUpdate:modelValue":i[3]||(i[3]=p=>F.value=p),indeterminate:le.value,onChange:We},{default:r(()=>[J(w(a(t)("dataset.check_all")),1)]),_:1},8,["modelValue","indeterminate"])]),h("div",$o,[u(ra,{modelValue:e.value.checkedFields,"onUpdate:modelValue":i[4]||(i[4]=p=>e.value.checkedFields=p),onChange:da},{default:r(()=>[(c(!0),q(ie,null,_e(y.value,p=>(c(),q("div",{key:p.componentId,class:"list-item_field_de"},[u(Le,{label:p.componentId},{default:r(()=>[u(b,{class:"component-type"},{default:r(()=>[u(v,null,{default:r(()=>[(c(),U(ze(a(Ai)[a(M)[p.componentId].type])))]),_:2},1024)]),_:2},1024),h("span",{title:a(M)[p.componentId].title,class:"checkbox-name ellipsis"},w(a(M)[p.componentId].title),9,qo)]),_:2},1032,["label"]),h("span",{title:p.name,class:"dataset ellipsis"},w(p.name),9,Do),e.value.checkedFields.includes(p.componentId)&&e.value.checkedFieldsMapArr&&e.value.checkedFieldsMapArr[p.componentId]&&e.value.checkedFieldsMapArr[p.componentId].length?(c(),U(a(Ye),{onChange:x=>E(x,p.componentId),onFocus:la,multiple:"",filterable:"","collapse-tags":"","collapse-tags-tooltip":"",key:"checkedFieldsMapArrTime","multiple-limit":2,class:"field-select--input",style:{"margin-left":"12px"},"popper-class":"field-select--dqp",modelValue:e.value.checkedFieldsMapArr[p.componentId],"onUpdate:modelValue":x=>e.value.checkedFieldsMapArr[p.componentId]=x,clearable:""},Ya({header:r(()=>[u(we,{stretch:"",class:"params-select--header",modelValue:p.activelist,"onUpdate:modelValue":x=>p.activelist=x},{default:r(()=>[u(Ne,{disabled:"",label:a(t)("chart.dimension"),name:"dimensionList"},null,8,["label"]),u(Ne,{disabled:"",label:a(t)("chart.quota"),name:"quotaList"},null,8,["label"]),u(Ne,{label:a(t)("dataset.param"),name:"parameterList"},null,8,["label"])]),_:1},8,["modelValue","onUpdate:modelValue"])]),default:r(()=>[(c(!0),q(ie,null,_e(p.fields[p.activelist],x=>(c(),U(Ve,{key:x.id,label:x.name||x.variableName,value:x.id,disabled:ka(x)},{default:r(()=>[h("div",Oo,[u(b,null,{default:r(()=>[u(v,{className:`field-icon-${a(Se)[x.deType]}`},{default:r(()=>[(c(),U(ze(a(oa)[a(Se)[x.deType]]),{class:Te(["svg-icon",`field-icon-${a(Se)[x.deType]}`])},null,8,["class"]))]),_:2},1032,["className"])]),_:2},1024),h("span",{title:x.name||x.variableName,class:"ellipsis"},w(x.name||x.variableName),9,Io),e.value.checkedFieldsMapArr[p.componentId].includes(x.id)&&p.activelist==="parameterList"?(c(),q("span",{key:0,onClick:Ge(Be=>ue(p.componentId,x),["stop"]),class:"range-time_setting"},[J(w(e.value.checkedFieldsMapStart[p.componentId]===x.id?a(t)("dataset.start_time"):e.value.checkedFieldsMapEnd[p.componentId]===x.id?a(t)("dataset.end_time"):"")+" ",1),u(b,null,{default:r(()=>[u(v,null,{default:r(()=>[u(a(Ua),{class:"svg-icon"})]),_:1})]),_:1})],8,Ao)):j("",!0)])]),_:2},1032,["label","value","disabled"]))),128))]),_:2},[e.value.checkedFieldsMap[p.componentId]?{name:"prefix",fn:r(()=>[u(b,null,{default:r(()=>[u(v,null,{default:r(()=>[(c(),U(ze(a(oa)[a(Se)[P(e.value.checkedFieldsMap[p.componentId],Object.values(p.fields))]]),{class:Te(`field-icon-${a(Se)[P(e.value.checkedFieldsMap[p.componentId],Object.values(p.fields))]}`)},null,8,["class"]))]),_:2},1024)]),_:2},1024)]),key:"0"}:void 0]),1032,["onChange","modelValue","onUpdate:modelValue"])):e.value.checkedFields.includes(p.componentId)&&e.value.checkedFieldsMapArrNum&&e.value.checkedFieldsMapArrNum[p.componentId]&&e.value.checkedFieldsMapArrNum[p.componentId].length?(c(),U(a(Ye),{onChange:x=>Ke(x,p.componentId),onFocus:la,multiple:"",filterable:"","collapse-tags":"","collapse-tags-tooltip":"",key:"checkedFieldsMapArr","multiple-limit":2,class:"field-select--input",style:{"margin-left":"12px"},"popper-class":"field-select--dqp",modelValue:e.value.checkedFieldsMapArrNum[p.componentId],"onUpdate:modelValue":x=>e.value.checkedFieldsMapArrNum[p.componentId]=x,clearable:""},Ya({header:r(()=>[u(we,{stretch:"",class:"params-select--header",modelValue:p.activelist,"onUpdate:modelValue":x=>p.activelist=x},{default:r(()=>[u(Ne,{disabled:"",label:a(t)("chart.dimension"),name:"dimensionList"},null,8,["label"]),u(Ne,{disabled:"",label:a(t)("chart.quota"),name:"quotaList"},null,8,["label"]),u(Ne,{label:a(t)("dataset.param"),name:"parameterList"},null,8,["label"])]),_:1},8,["modelValue","onUpdate:modelValue"])]),default:r(()=>[(c(!0),q(ie,null,_e(p.fields[p.activelist],x=>(c(),U(Ve,{key:x.id,label:x.name||x.variableName,value:x.id,disabled:![2,3].includes(x.deType)},{default:r(()=>[h("div",Eo,[u(b,null,{default:r(()=>[u(v,{className:`field-icon-${a(Se)[x.deType]}`},{default:r(()=>[(c(),U(ze(a(oa)[a(Se)[x.deType]]),{class:Te(["svg-icon",`field-icon-${a(Se)[x.deType]}`])},null,8,["class"]))]),_:2},1032,["className"])]),_:2},1024),h("span",{title:x.name||x.variableName,class:"ellipsis"},w(x.name||x.variableName),9,No),e.value.checkedFieldsMapArrNum[p.componentId].includes(x.id)&&p.activelist==="parameterList"?(c(),q("span",{key:0,onClick:Ge(Be=>z(p.componentId,x),["stop"]),class:"range-time_setting"},[J(w(e.value.checkedFieldsMapStartNum[p.componentId]===x.id?a(t)("chart.min"):e.value.checkedFieldsMapEndNum[p.componentId]===x.id?a(t)("chart.max"):"")+" ",1),u(b,null,{default:r(()=>[u(v,null,{default:r(()=>[u(a(Ua),{class:"svg-icon"})]),_:1})]),_:1})],8,Ro)):j("",!0)])]),_:2},1032,["label","value","disabled"]))),128))]),_:2},[e.value.checkedFieldsMap[p.componentId]?{name:"prefix",fn:r(()=>[u(b,null,{default:r(()=>[u(v,null,{default:r(()=>[(c(),U(ze(a(oa)[a(Se)[P(e.value.checkedFieldsMap[p.componentId],Object.values(p.fields))]]),{class:Te(`field-icon-${a(Se)[P(e.value.checkedFieldsMap[p.componentId],Object.values(p.fields))]}`)},null,8,["class"]))]),_:2},1024)]),_:2},1024)]),key:"0"}:void 0]),1032,["onChange","modelValue","onUpdate:modelValue"])):e.value.checkedFields.includes(p.componentId)?(c(),U(a(Ye),{key:2,onChange:x=>De(p),onFocus:la,filterable:"",style:{"margin-left":"12px"},"popper-class":"field-select--dqp",modelValue:e.value.checkedFieldsMap[p.componentId],"onUpdate:modelValue":x=>e.value.checkedFieldsMap[p.componentId]=x,clearable:""},Ya({header:r(()=>[u(we,{stretch:"",class:"params-select--header",modelValue:p.activelist,"onUpdate:modelValue":x=>p.activelist=x},{default:r(()=>[u(Ne,{label:a(t)("chart.dimension"),name:"dimensionList"},null,8,["label"]),u(Ne,{disabled:e.value.displayType==="9",label:a(t)("chart.quota"),name:"quotaList"},null,8,["disabled","label"]),p.hasParameter?(c(),U(Ne,{key:0,label:a(t)("dataset.param"),disabled:e.value.displayType==="9",name:"parameterList"},null,8,["label","disabled"])):j("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),default:r(()=>[(c(!0),q(ie,null,_e(p.fields[p.activelist],x=>(c(),U(Ve,{key:x.id,label:x.name||x.variableName,value:x.id,disabled:x.desensitized||e.value.displayType==="9"&&x.deType===1||ka(x)},{default:r(()=>[h("div",{class:"flex-align-center icon",title:x.desensitized?a(t)("v_query.as_query_conditions"):""},[u(b,null,{default:r(()=>[u(v,{className:`field-icon-${a(Se)[x.deType]}`},{default:r(()=>[(c(),U(ze(a(oa)[a(Se)[x.deType]]),{class:Te(["svg-icon",`field-icon-${a(Se)[x.deType]}`])},null,8,["class"]))]),_:2},1032,["className"])]),_:2},1024),h("span",{title:x.name||x.variableName,class:"ellipsis"},w(x.name||x.variableName),9,Lo),e.value.checkedFieldsMap[p.componentId]===x.id&&p.activelist==="parameterList"&&($.value||C.value)?(c(),q("span",{key:0,onClick:Ge(()=>C.value?z(p.componentId,x):ue(p.componentId,x),["stop"]),class:"range-time_setting"},[J(w(C.value?a(t)("chart.value_formatter_value"):a(t)("dataset.time"))+" ",1),u(b,null,{default:r(()=>[u(v,null,{default:r(()=>[u(a(Ua),{class:"svg-icon"})]),_:1})]),_:1})],8,Yo)):j("",!0)],8,xo)]),_:2},1032,["label","value","disabled"]))),128))]),_:2},[e.value.checkedFieldsMap[p.componentId]?{name:"prefix",fn:r(()=>[u(b,null,{default:r(()=>[u(v,null,{default:r(()=>[(c(),U(ze(a(oa)[a(Se)[P(e.value.checkedFieldsMap[p.componentId],Object.values(p.fields))]]),{class:Te(`field-icon-${a(Se)[P(e.value.checkedFieldsMap[p.componentId],Object.values(p.fields))]}`)},null,8,["class"]))]),_:2},1024)]),_:2},1024)]),key:"0"}:void 0]),1032,["onChange","modelValue","onUpdate:modelValue"])):(c(),q("span",Uo))]))),128))]),_:1},8,["modelValue"])])]),_:1})],2)):j("",!0),e.value?(c(),q("div",{key:1,class:Te(["condition-configuration",e.value.auto&&"condition-configuration_hide"])},[u(Xe,null,{default:r(()=>[e.value.auto?(c(),q("div",Bo)):j("",!0),h("div",Go,[J(w(a(t)("v_query.query_condition_configuration"))+" ",1),u(Le,{disabled:e.value.auto||e.value.displayType==="9"&&Je.value!==0,modelValue:e.value.required,"onUpdate:modelValue":i[5]||(i[5]=p=>e.value.required=p),label:a(t)("v_query.required_items")},null,8,["disabled","modelValue","label"])]),Xa(h("div",Po,[h("div",Wo,[h("div",jo,w(a(t)("v_query.display_type")),1),h("div",Ho,[u(a(Ye),{onFocus:la,onChange:Oa,modelValue:e.value.displayType,"onUpdate:modelValue":i[6]||(i[6]=p=>e.value.displayType=p)},{default:r(()=>[u(Ve,{disabled:!["0","8","9"].includes(e.value.displayType),label:a(t)("v_query.text_drop_down"),value:"0"},null,8,["disabled","label"]),u(Ve,{disabled:!["0","8","9"].includes(e.value.displayType),label:a(t)("v_query.text_search"),value:"8"},null,8,["disabled","label"]),u(Ve,{disabled:!["0","8","9"].includes(e.value.displayType)||!!e.value.parameters.length,label:a(t)("v_query.drop_down_tree"),value:"9"},null,8,["disabled","label"]),["2","22"].includes(e.value.displayType)?(c(),q(ie,{key:0},[u(Ve,{disabled:!["2","22"].includes(e.value.displayType)||re.value,label:a(t)("v_query.number_drop_down"),value:"2"},null,8,["disabled","label"]),u(Ve,{disabled:!["2","22"].includes(e.value.displayType)||ve.value,label:a(t)("v_query.number_range"),value:"22"},null,8,["disabled","label"])],64)):(c(),U(Ve,{key:1,disabled:e.value.displayType!=="5",label:a(t)("v_query.number_drop_down"),value:"5"},null,8,["disabled","label"])),u(Ve,{disabled:!["1","7"].includes(e.value.displayType)||$.value&&Z.value,label:a(t)("dataset.time"),value:"1"},null,8,["disabled","label"]),u(Ve,{disabled:!["1","7"].includes(e.value.displayType)||$.value&&!Z.value,label:a(t)("common.component.dateRange"),value:"7"},null,8,["disabled","label"])]),_:1},8,["modelValue"])])]),e.value.displayType==="9"?(c(),q("div",zo,[h("div",{title:a(t)("v_query.of_option_values"),class:"label ellipsis"},w(a(t)("v_query.of_option_values")),9,Qo),h("div",Ko,[u(he,{class:"larger-radio",modelValue:e.value.resultMode,"onUpdate:modelValue":i[7]||(i[7]=p=>e.value.resultMode=p)},{default:r(()=>[u(ne,{label:0},{default:r(()=>[J(w(a(t)("login.default_login")),1)]),_:1}),u(ne,{label:1},{default:r(()=>[J(w(a(t)("chart.result_mode_all")),1)]),_:1})]),_:1},8,["modelValue"])])])):j("",!0),e.value.displayType==="9"?(c(),q("div",Zo,[h("div",{title:a(t)("copilot.pls_choose_dataset"),class:"label ellipsis"},w(a(t)("copilot.pls_choose_dataset")),9,Jo),h("div",Xo,[u(He,{teleported:!1,modelValue:e.value.treeDatasetId,"onUpdate:modelValue":i[8]||(i[8]=p=>e.value.treeDatasetId=p),data:S.value,placeholder:a(t)("copilot.pls_choose_dataset"),onChange:Ot,props:yl,placement:"bottom","render-after-expand":!1,filterable:"","popper-class":"dataset-tree"},{default:r(({node:p,data:x})=>[h("div",es,[x.leaf?j("",!0):(c(),U(b,{key:0,size:"18px"},{default:r(()=>[u(v,null,{default:r(()=>[u(a(gl),{class:"svg-icon"})]),_:1})]),_:1})),x.leaf?(c(),U(b,{key:1,size:"18px"},{default:r(()=>[u(v,null,{default:r(()=>[u(a(bl),{class:"svg-icon"})]),_:1})]),_:1})):j("",!0),h("span",{class:"label-tree ellipsis",style:{"margin-left":"8px"},title:p.label},w(p.label),9,as)])]),_:1},8,["modelValue","data","placeholder"])])])):j("",!0),e.value.displayType==="9"?(c(),q("div",ts,[h("div",ls,[J(w(a(t)("v_query.tree_structure_design"))+" ",1),e.value.treeFieldList&&e.value.treeFieldList.length?(c(),U($e,{key:0,text:"",onClick:cl},{icon:r(()=>[u(L,null,{default:r(()=>[u(a(Ua),{class:"svg-icon"})]),_:1})]),_:1})):j("",!0)]),h("div",ns,[e.value.treeFieldList&&e.value.treeFieldList.length?(c(!0),q(ie,{key:0},_e(e.value.treeFieldList,(p,x)=>(c(),q("div",{key:p.id,class:"tree-field"},[h("span",is,w(a(t)("visualization.level"))+w(yn[x]),1),h("span",us,[u(b,null,{default:r(()=>[u(v,null,{default:r(()=>[(c(),U(ze(a(oa)[a(Se)[p.deType]]),{class:Te([`field-icon-${a(Se)[p.deType]}`,"svg-icon"])},null,8,["class"]))]),_:2},1024)]),_:2},1024)]),h("span",{class:"field-tree_name ellipsis",title:p.name},w(p.name),9,rs),x===0?(c(),q("span",os,w(a(t)("common.associated_chart_first")),1)):(c(),q("span",ss,[u($e,{text:"",onClick:Be=>xt(x)},{default:r(()=>[J(w(a(t)("common.associated_chart")),1)]),_:1},8,["onClick"])]))]))),128)):(c(),U($e,{key:1,class:"start-tree_design",onClick:cl,text:""},{icon:r(()=>[u(v,{name:"icon_add_outlined"},{default:r(()=>[u(a(bt),{class:"svg-icon"})]),_:1})]),default:r(()=>[J(" "+w(a(t)("v_query.the_tree_structure")),1)]),_:1}))]),u(tu,{ref_key:"treeDialog",ref:dl,onSaveTree:$n},null,512)])):j("",!0),["1","7"].includes(e.value.displayType)?(c(),q("div",ds,[h("div",{title:a(t)("v_query.time_granularity"),class:"label ellipsis"},w(a(t)("v_query.time_granularity")),9,cs),h("div",ms,[e.value.displayType==="7"&&!$.value?(c(),U(a(Ye),{key:0,onChange:pl,placeholder:a(t)("v_query.the_time_granularity"),onFocus:la,modelValue:e.value.timeGranularityMultiple,"onUpdate:modelValue":i[9]||(i[9]=p=>e.value.timeGranularityMultiple=p)},{default:r(()=>[u(Ve,{label:a(t)("chart.y"),value:"yearrange"},null,8,["label"]),u(Ve,{label:a(t)("chart.y_M"),value:"monthrange"},null,8,["label"]),u(Ve,{label:a(t)("chart.y_M_d"),value:"daterange"},null,8,["label"]),u(Ve,{label:a(t)("chart.y_M_d_H_m_s"),value:"datetimerange"},null,8,["label"])]),_:1},8,["placeholder","modelValue"])):(c(),U(a(Ye),{key:1,onChange:vl,placeholder:a(t)("v_query.the_time_granularity"),modelValue:e.value.timeGranularity,"onUpdate:modelValue":i[10]||(i[10]=p=>e.value.timeGranularity=p)},{default:r(()=>[(c(!0),q(ie,null,_e(Ca.value,p=>(c(),U(Ve,{key:p.value,label:p.label,value:p.value},null,8,["label","value"]))),128))]),_:1},8,["placeholder","modelValue"]))])])):j("",!0),["1","7","8","9","22"].includes(e.value.displayType)?j("",!0):(c(),q("div",vs,[h("div",{title:a(t)("v_query.option_value_source"),class:"label ellipsis"},w(a(t)("v_query.option_value_source")),9,ps),h("div",fs,[h("div",ys,[u(he,{class:"larger-radio",onChange:mt,modelValue:e.value.optionValueSource,"onUpdate:modelValue":i[11]||(i[11]=p=>e.value.optionValueSource=p)},{default:r(()=>[u(ne,{disabled:!!e.value.parameters.length,label:0},{default:r(()=>[J(w(a(t)("chart.margin_model_auto")),1)]),_:1},8,["disabled"]),u(ne,{label:1},{default:r(()=>[J(w(a(t)("chart.select_dataset")),1)]),_:1}),u(ne,{label:2},{default:r(()=>[J(w(a(t)("v_query.manual_input")),1)]),_:1})]),_:1},8,["modelValue"])]),e.value.optionValueSource===1?(c(),q(ie,{key:0},[h("div",hs,[u(He,{teleported:!1,modelValue:e.value.dataset.id,"onUpdate:modelValue":i[12]||(i[12]=p=>e.value.dataset.id=p),data:S.value,placeholder:a(t)("copilot.pls_choose_dataset"),onChange:ct,onCurrentChange:qt,props:yl,placement:"bottom","render-after-expand":!1,filterable:"","popper-class":"dataset-tree"},{default:r(({node:p,data:x})=>[h("div",_s,[x.leaf?j("",!0):(c(),U(b,{key:0,size:"18px"},{default:r(()=>[u(v,{name:"dv-folder"},{default:r(()=>[u(a(gl),{class:"svg-icon"})]),_:1})]),_:1})),x.leaf?(c(),U(b,{key:1,size:"18px"},{default:r(()=>[u(v,{name:"icon_dataset"},{default:r(()=>[u(a(bl),{class:"svg-icon"})]),_:1})]),_:1})):j("",!0),h("span",{class:"label-tree ellipsis",style:{"margin-left":"8px"},title:p.label},w(p.label),9,gs)])]),_:1},8,["modelValue","data","placeholder"])]),h("div",bs,[h("span",{title:a(t)("v_query.query_field"),class:"label"},w(a(t)("v_query.query_field")),9,Vs),u(a(Ye),{onChange:za,placeholder:a(t)("v_query.query_field"),class:"search-field",modelValue:e.value.field.id,"onUpdate:modelValue":i[13]||(i[13]=p=>e.value.field.id=p)},Ya({default:r(()=>[(c(!0),q(ie,null,_e(e.value.dataset.fields.filter(p=>p.deType===+e.value.displayType||[3,4].includes(p.deType)&&+e.value.displayType==2||p.deType===7&&+e.value.displayType==0),p=>(c(),U(Ve,{key:p.id,label:p.name,value:p.id,disabled:p.desensitized},{default:r(()=>[h("div",{class:"flex-align-center icon",title:p.desensitized?a(t)("v_query.as_query_conditions"):""},[u(b,null,{default:r(()=>[u(v,{className:`field-icon-${a(Se)[p.deType]}`},{default:r(()=>[(c(),U(ze(a(oa)[a(Se)[p.deType]]),{class:Te(["svg-icon",`field-icon-${a(Se)[p.deType]}`])},null,8,["class"]))]),_:2},1032,["className"])]),_:2},1024),h("span",null,w(p.name),1)],8,ks)]),_:2},1032,["label","value","disabled"]))),128))]),_:2},[e.value.field.id?{name:"prefix",fn:r(()=>[u(b,null,{default:r(()=>[u(v,null,{default:r(()=>[(c(),U(ze(a(oa)[a(Se)[P(e.value.field.id,e.value.dataset.fields)]]),{class:Te(["svg-icon",`field-icon-${a(Se)[P(e.value.field.id,e.value.dataset.fields)]}`])},null,8,["class"]))]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["placeholder","modelValue"])]),h("div",Ts,[h("span",{title:a(t)("v_query.display_field"),class:"label ellipsis"},w(a(t)("v_query.display_field")),9,Cs),u(a(Ye),{placeholder:a(t)("v_query.display_field"),class:"search-field",modelValue:e.value.displayId,"onUpdate:modelValue":i[14]||(i[14]=p=>e.value.displayId=p),onChange:Fn},Ya({default:r(()=>[(c(!0),q(ie,null,_e(Vn.value,p=>(c(),U(Ve,{key:p.id,label:p.name,value:p.id,disabled:p.desensitized},{default:r(()=>[h("div",{class:"flex-align-center icon",title:p.desensitized?a(t)("v_query.as_query_conditions"):""},[u(b,null,{default:r(()=>[u(v,{className:`field-icon-${a(Se)[p.deType]}`},{default:r(()=>[(c(),U(ze(a(oa)[a(Se)[p.deType]]),{class:Te(["svg-icon",`field-icon-${a(Se)[p.deType]}`])},null,8,["class"]))]),_:2},1032,["className"])]),_:2},1024),h("span",null,w(p.name),1)],8,Ms)]),_:2},1032,["label","value","disabled"]))),128))]),_:2},[e.value.displayId?{name:"prefix",fn:r(()=>[u(b,null,{default:r(()=>[u(v,null,{default:r(()=>[(c(),U(ze(a(oa)[a(Se)[P(e.value.displayId,e.value.dataset.fields)]]),{class:Te(["svg-icon",`field-icon-${a(Se)[P(e.value.displayId,e.value.dataset.fields)]}`])},null,8,["class"]))]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["placeholder","modelValue"])]),h("div",Fs,[h("span",Ss,w(a(t)("chart.total_sort_field")),1),h("div",null,[u(a(Ye),{clearable:"",placeholder:a(t)("v_query.the_sorting_field"),modelValue:e.value.sortId,"onUpdate:modelValue":i[15]||(i[15]=p=>e.value.sortId=p),class:"sort-field",style:{width:"240px"},onChange:Mn},Ya({default:r(()=>[(c(!0),q(ie,null,_e(e.value.dataset.fields,p=>(c(),U(Ve,{key:p.id,label:p.name,value:p.id,disabled:p.desensitized},{default:r(()=>[h("div",{class:"flex-align-center icon",title:p.desensitized?a(t)("v_query.as_query_conditions"):""},[u(b,null,{default:r(()=>[u(v,null,{default:r(()=>[(c(),U(ze(a(oa)[a(Se)[p.deType]]),{class:Te([`field-icon-${a(Se)[p.deType]}`,"svg-icon"])},null,8,["class"]))]),_:2},1024)]),_:2},1024),h("span",null,w(p.name),1)],8,ws)]),_:2},1032,["label","value","disabled"]))),128))]),_:2},[e.value.sortId?{name:"prefix",fn:r(()=>[u(b,null,{default:r(()=>[u(v,null,{default:r(()=>[(c(),U(ze(a(oa)[a(Se)[P(e.value.sortId,e.value.dataset.fields)]]),{class:Te(["svg-icon",`field-icon-${a(Se)[P(e.value.sortId,e.value.dataset.fields)]}`])},null,8,["class"]))]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["placeholder","modelValue"]),u(a(Ye),{class:"sort-type",modelValue:e.value.sort,"onUpdate:modelValue":i[16]||(i[16]=p=>e.value.sort=p),onChange:za},{default:r(()=>[u(Ve,{label:a(t)("chart.asc"),value:"asc"},null,8,["label"]),u(Ve,{label:a(t)("chart.desc"),value:"desc"},null,8,["label"]),u(Ve,{onClick:wn,title:Za.value?l.$t("v_query.display_sort"):"",disabled:Za.value,label:a(t)("v_query.custom_sort"),value:"customSort"},null,8,["title","disabled","label"])]),_:1},8,["modelValue"])])])],64)):j("",!0),e.value.optionValueSource===2?(c(),q("div",$s,[u(aa,{placement:"bottom-start","popper-class":"manual-input",ref_key:"manual",ref:Ce,width:358,trigger:"click"},{reference:r(()=>[u($e,{text:""},{icon:r(()=>[u(v,{name:"icon_edit_outlined"},{default:r(()=>[u(a(Ua),{class:"svg-icon"})]),_:1})]),default:r(()=>[J(" "+w(a(t)("common.edit")),1)]),_:1})]),default:r(()=>[h("div",qs,[h("div",Ds,w(a(t)("auth.manual_input")),1),h("div",Os,[h("span",null,w(a(t)("data_fill.form.option_value")),1),(c(!0),q(ie,null,_e(m.value,(p,x)=>(c(),q("div",{key:x,class:"select-item"},[e.value.displayType==="2"?(c(),U(G,{key:0,maxlength:"64",onBlur:ol,modelValue:m.value[x],"onUpdate:modelValue":Be=>m.value[x]=Be,modelModifiers:{number:!0}},null,8,["modelValue","onUpdate:modelValue"])):(c(),U(G,{key:1,maxlength:"64",onBlur:ol,modelValue:m.value[x],"onUpdate:modelValue":Be=>m.value[x]=Be},null,8,["modelValue","onUpdate:modelValue"])),m.value.length!==1?(c(),U($e,{key:2,onClick:Be=>m.value.splice(x,1),class:"value",text:""},{icon:r(()=>[u(v,{name:"icon_delete-trash_outlined"},{default:r(()=>[u(a(Zt),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])):j("",!0)]))),128))]),h("div",Is,[u($e,{onClick:i[17]||(i[17]=p=>m.value.push("")),text:""},{icon:r(()=>[u(v,{name:"icon_add_outlined"},{default:r(()=>[u(a(bt),{class:"svg-icon"})]),_:1})]),default:r(()=>[J(" "+w(a(t)("data_fill.form.add_option")),1)]),_:1})]),h("div",As,[u($e,{onClick:il},{default:r(()=>[J(w(a(t)("chart.cancel")),1)]),_:1}),u($e,{onClick:kn,type:"primary"},{default:r(()=>[J(w(a(t)("chart.confirm")),1)]),_:1})])])]),_:1},512),e.value.valueSource.length?(c(),q("div",Es,w(a(t)("v_query.configured")),1)):j("",!0)])):j("",!0)]),h("div",{class:"label ellipsis",title:a(t)("v_query.of_option_values"),style:{"margin-top":"10.5px"}},w(a(t)("v_query.of_option_values")),9,Ns),h("div",Rs,[u(he,{class:"larger-radio",modelValue:e.value.resultMode,"onUpdate:modelValue":i[18]||(i[18]=p=>e.value.resultMode=p)},{default:r(()=>[u(ne,{label:0},{default:r(()=>[J(w(a(t)("chart.default")),1)]),_:1}),u(ne,{label:1},{default:r(()=>[J(w(a(t)("data_set.all")),1)]),_:1})]),_:1},8,["modelValue"])])])),e.value.displayType==="8"?(c(),q("div",xs,[h("div",{title:a(t)("v_query.condition_type"),class:"label ellipsis"},w(a(t)("v_query.condition_type")),9,Ls),h("div",Ys,[h("div",Us,[u(he,{class:"larger-radio",modelValue:e.value.conditionType,"onUpdate:modelValue":i[19]||(i[19]=p=>e.value.conditionType=p)},{default:r(()=>[u(ne,{label:0},{default:r(()=>[J(w(a(t)("v_query.single_condition")),1)]),_:1}),u(ne,{label:1,disabled:!!e.value.parameters.length},{default:r(()=>[J(w(a(t)("v_query.with_condition")),1)]),_:1},8,["disabled"]),u(ne,{label:2,disabled:!!e.value.parameters.length},{default:r(()=>[J(w(a(t)("v_query.or_condition")),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue"])])])])):j("",!0),e.value.displayType==="8"?(c(),q("div",Bs,[u(Le,{modelValue:e.value.hideConditionSwitching,"onUpdate:modelValue":i[20]||(i[20]=p=>e.value.hideConditionSwitching=p),label:a(t)("v_query.hide_condition_switch")},null,8,["modelValue","label"])])):j("",!0),u(_o,{ref_key:"defaultConfigurationRef",ref:D,onHandleTimeTypeChange:In,"cur-component":e.value},null,8,["cur-component"])],512),[[El,e.value.displayType!=="9"&&ye.value&&!me.value||e.value.displayType==="9"&&Je.value==0]]),me.value&&ye.value?(c(),q("div",Gs,[u(Bt,{description:a(t)("v_query.cannot_be_performed"),"img-type":"error"},null,8,["description"])])):e.value.displayType==="9"&&Je.value!==0?(c(),q("div",Ps,[u(Bt,{description:a(t)("common.other_levels"),"img-type":"error"},null,8,["description"])])):ye.value?j("",!0):(c(),q("div",Ws,[u(Bt,{description:a(t)("v_query.be_linked_first"),"img-type":"noneWhite"},null,8,["description"])]))]),_:1})],2)):j("",!0)])]),_:1},8,["modelValue","title"]),u(Re,{title:va.value,modelValue:be.value,"onUpdate:modelValue":i[27]||(i[27]=p=>be.value=p),width:"420px"},{footer:r(()=>[u($e,{secondary:"",onClick:i[26]||(i[26]=p=>be.value=!1)},{default:r(()=>[J(w(a(t)("chart.cancel")),1)]),_:1}),u($e,{type:"primary",onClick:Ta},{default:r(()=>[J(w(a(t)("chart.confirm")),1)]),_:1})]),default:r(()=>[u(na,{"label-position":"top"},{default:r(()=>[u(fa,{label:a(t)("v_query.time_type"),class:"form-item",prop:"name"},{default:r(()=>[u(he,{modelValue:Fe.value,"onUpdate:modelValue":i[25]||(i[25]=p=>Fe.value=p)},{default:r(()=>[u(ne,{label:0},{default:r(()=>[J(w(a(t)("data_set.time")),1)]),_:1}),u(ne,{label:1},{default:r(()=>[J(w(a(t)("datasource.start_time")),1)]),_:1}),u(ne,{label:2},{default:r(()=>[J(w(a(t)("datasource.end_time")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1},8,["title","modelValue"]),u(Re,{title:pa.value,modelValue:ua.value,"onUpdate:modelValue":i[30]||(i[30]=p=>ua.value=p),width:"420px"},{footer:r(()=>[u($e,{secondary:"",onClick:i[29]||(i[29]=p=>ua.value=!1)},{default:r(()=>[J(w(a(t)("dataset.cancel")),1)]),_:1}),u($e,{type:"primary",onClick:_a},{default:r(()=>[J(w(a(t)("dataset.confirm")),1)]),_:1})]),default:r(()=>[u(na,{"label-position":"top"},{default:r(()=>[u(fa,{label:a(t)("chart.map_line_type"),class:"form-item",prop:"name"},{default:r(()=>[u(he,{modelValue:ea.value,"onUpdate:modelValue":i[28]||(i[28]=p=>ea.value=p)},{default:r(()=>[u(ne,{label:0},{default:r(()=>[J(w(a(t)("chart.value_formatter_value")),1)]),_:1}),u(ne,{label:1},{default:r(()=>[J(w(a(t)("chart.min")),1)]),_:1}),u(ne,{label:2},{default:r(()=>[J(w(a(t)("chart.max")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1},8,["title","modelValue"]),u(Wi,{ref_key:"customSortFilterRef",ref:sl,onSave:Sn},null,512),u(a(At),{onSaveCascade:se,ref_key:"cascadeDialog",ref:vt},null,512)],64)}}});const zs=ut(),{componentData:Dl,canvasViewInfo:Qs}=Mt(zs),Ks=()=>{const o=()=>{let n=Dl.value.filter(t=>!["VQuery","DeTabs"].includes(t.innerType)&&t.component!=="Group");return Dl.value.forEach(t=>{t.innerType==="DeTabs"?t.propValue.forEach(d=>{n=[...n,...d.componentData.filter(s=>!["VQuery","DeTabs"].includes(s.innerType)&&s.component!=="Group")],d.componentData.forEach(s=>{s.component==="Group"&&(n=[...n,s.propValue.filter(f=>!["VQuery","DeTabs"].includes(f.innerType)&&f.component!=="Group")])})}):t.component==="Group"&&(n=[...n,t.propValue.filter(d=>!["VQuery","DeTabs"].includes(d.innerType)&&d.component!=="Group")],t.propValue.forEach(d=>{d.innerType==="DeTabs"&&d.propValue.forEach(s=>{n=[...n,...s.componentData.filter(f=>!["VQuery","DeTabs"].includes(f.innerType)&&f.component!=="Group")]})}))}),n.flat()};return{datasetFieldList:N(()=>o().map(n=>{const t=Qs.value[n.id];if(!t)return null;const{id:d,title:s,tableId:f,type:M}=t;return d&&f?{id:d,type:M,title:s,tableId:f}:null}).filter(n=>!!n))}},Zs={class:"condition-type"},Js={key:0,class:"condition-type"},Xs={class:"condition-type-tip"},ed=Pe({__name:"TextSearch",props:{config:{type:Object,default:()=>({id:"",conditionType:0,queryConditionWidth:0,conditionValueOperatorF:"eq",conditionValueF:"",conditionValueOperatorS:"like",conditionValueS:"",defaultConditionValueOperatorF:"eq",defaultConditionValueF:"",defaultConditionValueOperatorS:"like",defaultConditionValueS:""})},isConfig:{type:Boolean,default:!1}},setup(o){const _=Ue("placeholder"),{t:n}=ha(),t=N(()=>{var H;return(H=_==null?void 0:_.value)!=null&&H.placeholderShow?M.config.placeholder:" "}),d=[{label:n("v_query.exact_match"),value:"eq"},{label:n("v_query.fuzzy_match"),value:"like"}],s=ut(),{dvInfo:f}=Mt(s),M=o,{config:D}=ia(M),k=()=>{const{defaultConditionValueOperatorF:H,defaultConditionValueF:O,defaultConditionValueOperatorS:g,defaultConditionValueS:se}=D.value;D.value.conditionValueOperatorF=H,D.value.conditionValueF=O,D.value.conditionValueOperatorS=g,D.value.conditionValueS=se};qa(()=>{k()});const R=Ue("com-width",Function,!0),B=Ue("$custom-style-filter"),m=Ue("is-confirm-search",Function,!0),V=()=>{var H;return(H=_==null?void 0:_.value)!=null&&H.placeholderShow?M.config.queryConditionWidth===void 0?R():M.config.queryConditionWidth:227},F=N(()=>({width:V()+"px"})),X=()=>{if(!M.isConfig){Me(()=>{m(D.value.id)});return}},T=N(()=>({width:V()-15+"px",background:B.border})),ae=()=>{X()},Q=H=>{H.stopPropagation()};return(H,O)=>{const g=Pa,se=Ye,fe=zt;return c(),q("div",{onMousedown:Q,class:"text-search-select",style:Ae({background:a(B).background})},[h("div",Zs,[a(D).hideConditionSwitching?j("",!0):(c(),U(se,{key:0,class:"condition-value-select",onChange:X,effect:a(f).type==="dataV"?"dark":"","popper-class":"condition-value-select-popper",modelValue:a(D).conditionValueOperatorF,"onUpdate:modelValue":O[0]||(O[0]=e=>a(D).conditionValueOperatorF=e)},{default:r(()=>[(c(),q(ie,null,_e(d,e=>u(g,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["effect","modelValue"])),u(fe,{style:Ae(F.value),placeholder:t.value,onBlur:X,onKeydown:_l(ae,["enter"]),class:"condition-value-input",modelValue:a(D).conditionValueF,"onUpdate:modelValue":O[1]||(O[1]=e=>a(D).conditionValueF=e)},null,8,["style","placeholder","modelValue"]),h("div",{style:Ae(T.value),class:"bottom-line"},null,4)]),[1,2].includes(a(D).conditionType)?(c(),q("div",Js,[h("span",Xs,w(a(D).conditionType===1?a(n)("chart.and"):a(n)("chart.or")),1),a(D).hideConditionSwitching?j("",!0):(c(),U(se,{key:0,class:"condition-value-select",onChange:X,effect:a(f).type==="dataV"?"dark":"","popper-class":"condition-value-select-popper",modelValue:a(D).conditionValueOperatorS,"onUpdate:modelValue":O[2]||(O[2]=e=>a(D).conditionValueOperatorS=e)},{default:r(()=>[(c(),q(ie,null,_e(d,e=>u(g,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["effect","modelValue"])),u(fe,{style:Ae(F.value),onBlur:X,placeholder:t.value,onKeydown:_l(ae,["enter"]),class:"condition-value-input",modelValue:a(D).conditionValueS,"onUpdate:modelValue":O[3]||(O[3]=e=>a(D).conditionValueS=e)},null,8,["style","placeholder","modelValue"]),h("div",{style:Ae(T.value),class:"bottom-line next-line"},null,4)])):j("",!0)],36)}}});const ad=ja(ed,[["__scopeId","data-v-7609c165"]]),td=Pe({__name:"NumberInput",props:{config:{type:Object,default:()=>({id:"",queryConditionWidth:0,defaultNumValueEnd:"",defaultNumValueStart:"",numValueEnd:"",numValueStart:"",defaultValueCheck:!1})},isConfig:{type:Boolean,default:!1}},setup(o){Ct(V=>({"1a26f7c8":m.value}));const _=Ue("placeholder"),n=N(()=>{var V;return(V=_==null?void 0:_.value)!=null&&V.placeholderShow?t.config.placeholder:" "}),t=o,{config:d}=ia(t),s=()=>{if(!d.value.defaultValueCheck){d.value.numValueEnd=void 0,d.value.numValueStart=void 0;return}const{defaultNumValueEnd:V,defaultNumValueStart:F}=d.value;d.value.numValueEnd=V,d.value.numValueStart=F};qa(()=>{s()});const f=Ue("com-width",Function,!0),M=Ue("$custom-style-filter"),D=Ue("is-confirm-search",Function,!0),k=()=>{var V;return(V=_==null?void 0:_.value)!=null&&V.placeholderShow?t.config.queryConditionWidth===void 0?f():t.config.queryConditionWidth:227},R=N(()=>({width:k()+"px"})),B=()=>{if(!t.isConfig){Me(()=>{D(d.value.id)});return}},m=N(()=>M.border);return(V,F)=>{const X=Ft;return c(),q("div",{class:"num-search-select",style:Ae({background:a(M).background})},[u(X,{placeholder:n.value,onChange:B,style:Ae(R.value),"controls-position":"right",modelValue:a(d).numValueStart,"onUpdate:modelValue":F[0]||(F[0]=T=>a(d).numValueStart=T)},null,8,["placeholder","style","modelValue"]),F[2]||(F[2]=h("div",{class:"num-value_line"},null,-1)),u(X,{placeholder:n.value,style:Ae(R.value),onChange:B,"controls-position":"right",modelValue:a(d).numValueEnd,"onUpdate:modelValue":F[1]||(F[1]=T=>a(d).numValueEnd=T)},null,8,["placeholder","style","modelValue"])],4)}}});const ld=ja(td,[["__scopeId","data-v-a8f5ce09"]]),nd=Pe({__name:"StyleInject",props:{config:{type:Object,default:()=>({selectValue:"",defaultValue:"",displayType:"",defaultValueCheck:!1,optionValueSource:0,multiple:!1,checkedFieldsMap:{}})},customStyle:{type:Object,default:()=>({border:"",background:"",text:""})}},setup(o){const _=o,n=t=>t==="8"?ad:t==="22"?ld:["1","7"].includes(t)?mn:t==="9"?fn:pn;return ga("$custom-style-filter",_.customStyle),(t,d)=>(c(),U(ze(n(o.config.displayType)),{config:o.config,"is-config":!1},null,8,["config"]))}}),id={key:0,class:"no-list-label flex-align-center"},ud={class:"container flex-align-center"},rd={class:"query-fields-container"},od={class:"label-wrapper"},sd={key:0,class:"required"},dd={key:0,class:"label-wrapper-tooltip"},cd={class:"query-select"},md={key:0,class:"query-button"},vd=Pe({__name:"Component",props:{view:{type:Object,default(){return{customStyle:""}}},element:{type:Object,default(){return{id:null,propValue:[]}}},showPosition:{type:String,required:!0,default:""},scale:{type:Number,required:!1,default:1}},setup(o){Ct($=>({"96fc8394":te.value,"00b37138":oe.value,"7c31e292":z.value,b1237f5a:se.value.rawColor,"9162e482":se.value.hoverColor,"5e4339bc":fe.value,"0a65b1b0":e.value,"5b545c7c":Ce.value}));const _=o,{element:n,view:t,scale:d}=ia(_),{t:s}=ha(),f=K(),M=ut(),{curComponent:D,canvasViewInfo:k,mobileInPc:R,firstLoadMap:B,editMode:m}=Mt(M),V=K(!1),F=K(),T=Al({...{border:"",placeholderSize:14,placeholderShow:!0,background:"",text:"",layout:"horizontal",btnList:["sure"],titleLayout:"left",titleShow:!1,titleColor:"",textColorShow:!1,labelShow:!0,title:"",labelColor:"#1f2329",fontSize:"14",fontWeight:"",fontStyle:"",fontSizeBtn:"14",fontWeightBtn:"",fontStyleBtn:"",queryConditionWidth:227,nameboxSpacing:8,queryConditionSpacing:16,queryConditionHeight:32,btnColor:"#3370ff",labelColorBtn:"#ffffff"}}),ae=Nl(),Q=navigator.userAgent.toLowerCase(),H=/lark/i.test(Q),O=N(()=>{const $={color:T.labelColorBtn};return T.fontSizeBtn&&($.fontSize=T.fontSizeBtn+"px"),T.fontWeightBtn&&($.fontWeight=T.fontWeightBtn),T.fontStyleBtn&&($.fontStyle=T.fontStyleBtn),$});function g($){let C=$.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),re=parseFloat(C[3]||1),ve=Math.floor(re*parseInt(C[0])+(1-re)*255),Z=Math.floor(re*parseInt(C[1])+(1-re)*255),de=Math.floor(re*parseInt(C[2])+(1-re)*255);return"#"+("0"+ve.toString(16)).slice(-2)+("0"+Z.toString(16)).slice(-2)+("0"+de.toString(16)).slice(-2)}const se=N(()=>{let $=T.btnColor;return T.btnColor.startsWith("rgb")&&($=g(T.btnColor)),$.startsWith("#")&&($=$.substr(1)),{rawColor:T.btnColor??"#3370ff",hoverColor:T.btnColor?Ja.mix(new ba("ffffff"),new ba($),{value:15}).toRGB():"#5285FF",activeColor:T.btnColor?Ja.mix(new ba("000000"),new ba($),{value:15}).toRGB():"#2B5FD9"}}),fe=N(()=>se.value.rawColor),e=N(()=>se.value.hoverColor),Ce=N(()=>se.value.activeColor),oe=N(()=>T.background&&!T.background.toLowerCase().includes("#ffffff")?Ja.mix(new ba("ffffff"),new ba(T.background.substr(1)),{value:15}).toRGB():"#f0f2f5"),le=N(()=>{const $={backgroundColor:"transparent",borderColor:T.btnColor,color:T.btnColor};return T.fontSizeBtn&&($.fontSize=T.fontSizeBtn+"px"),T.fontWeightBtn&&($.fontWeight=T.fontWeightBtn),T.fontStyleBtn&&($.fontStyle=T.fontStyleBtn),$}),S=N(()=>(k.value[n.value.id]||{}).customStyle),{datasetFieldList:y}=Ks(),ee=$=>{const{borderColor:C,btnList:re,titleLayout:ve,labelColor:Z,text:de,bgColor:Ie,layout:je,titleShow:Ca,titleColor:Aa,title:Ha,fontSize:dt,fontWeight:La,fontStyle:Ea,fontSizeBtn:qt,fontWeightBtn:Dt,fontStyleBtn:ct,queryConditionWidth:Ot,nameboxSpacing:za,queryConditionSpacing:mt,queryConditionHeight:Qa,labelColorBtn:It,btnColor:At,placeholderSize:vt,placeholderShow:Et,labelShow:Na}=$;T.background=Ie||"",T.border=C||"",T.btnList=[...re],T.layout=je,T.placeholderShow=Et??!0,T.placeholderSize=vt??14,Me(()=>{f.value.style.setProperty("--ed-component-size",`${T.placeholderSize+18}px`)}),T.titleShow=Ca,T.titleColor=Aa,T.labelColor=Na&&Z||"",T.fontSize=Na&&dt||"14",T.fontWeight=Na&&La||"",T.fontStyle=Na&&Ea||"",T.title=Ha,T.text=T.placeholderShow&&de||"",T.titleLayout=ve,T.fontSizeBtn=qt||"14",T.fontWeightBtn=Dt,T.fontStyleBtn=ct,T.queryConditionWidth=Ot??227,T.nameboxSpacing=za??8,T.queryConditionSpacing=mt??16,T.queryConditionHeight=Qa??32,T.labelColorBtn=It||"#ffffff",T.labelShow=Na??!0,T.btnColor=At||"#3370ff",ae.recordSnapshotCache("setCustomStyle")};ce(()=>t.value,$=>{var C,re;(C=$==null?void 0:$.customStyle)!=null&&C.component&&ee((re=$==null?void 0:$.customStyle)==null?void 0:re.component)},{deep:!0,immediate:!0}),ce(()=>S.value,$=>{$!=null&&$.component&&ee($==null?void 0:$.component)},{deep:!0,immediate:!0});const P=K([]);ce(()=>_.element.propValue,()=>{P.value=[..._.element.propValue]},{immediate:!0});const ye=()=>{D.value.id!==n.value.id&&(V.value=!1)},{emitter:me}=xa(),Ee=it([]);qa(()=>{Ee.value=P.value.map($=>$.id),(_.element.cascade||[]).forEach($=>{$.forEach(C=>{C.currentSelectValue=C.selectValue})})});const We=$=>{Ee.value=Ee.value.filter(C=>C!==$)},Qe=$=>{var re;let C=Object.entries($.checkedFieldsMap).filter(ve=>$.checkedFields.includes(ve[0]));return $.displayType==="9"&&(C=((re=$.treeCheckedList)!=null&&re.length?$.treeCheckedList.filter((ve,Z)=>Z<$.treeFieldList.length):$.treeFieldList.map(()=>({checkedFields:[...$.checkedFields],checkedFieldsMap:qe($.checkedFieldsMap)}))).map(ve=>Object.entries(ve.checkedFieldsMap).filter(Z=>ve.checkedFields.includes(Z[0]))).flat()),C.filter(ve=>!!ve[1]).map(ve=>ve[0])},sa=$=>{n.value.propValue.forEach(C=>{var re;if($.some(ve=>C.checkedFields.includes(ve))&&C.required)if(C.displayType==="8"){const{conditionValueF:ve,conditionValueS:Z,conditionType:de}=C;de===0&&ve===""?C.conditionValueF=C.defaultConditionValueF:(ve===""||Z==="")&&(C.conditionValueF=C.defaultConditionValueF,C.conditionValueS=C.defaultConditionValueS)}else C.displayType==="22"?(C.numValueStart!==0&&!C.numValueStart||C.numValueEnd!==0&&!C.numValueEnd)&&(C.numValueStart=C.defaultNumValueStart,C.numValueEnd=C.defaultNumValueEnd):(Array.isArray(C.selectValue)&&!C.selectValue.length||C.selectValue!==0&&!C.selectValue)&&(C.optionValueSource===1&&((re=C.defaultMapValue)!=null&&re.length||C.displayId)&&![1,7].includes(+C.displayType)?(C.mapValue=C.defaultMapValue,C.selectValue=C.multiple?C.defaultMapValue:C.defaultMapValue[0]):C.selectValue=C.defaultValue)})},da=$=>{let C="",re="";const ve=(n.value.propValue||[]).filter(Z=>Z.id===$).reduce((Z,de)=>{if(de.required)if(de.defaultValueCheck||(C=de.name),de.displayType==="8"){const{conditionValueF:je,conditionValueS:Ca,conditionType:Aa}=de;Aa===0?C=je===""?de.name:"":C=[je||"",Ca||""].filter(Ha=>Ha!=="").length<2?de.name:""}else de.displayType==="22"?(de.numValueStart!==0&&!de.numValueStart||de.numValueEnd!==0&&!de.numValueEnd)&&(C=de.name):(Array.isArray(de.selectValue)&&!de.selectValue.length||de.selectValue!==0&&!de.selectValue)&&(C=de.name);de.displayType==="22"&&(!isNaN(de.numValueEnd)&&!isNaN(de.numValueStart)&&de.numValueEnd<de.numValueStart&&(re=de.name),[de.numValueEnd,de.numValueStart].filter(je=>![null,void 0,""].includes(je)).length===1&&(C=de.name));const Ie=Qe(de);return Z=[...new Set([...Ie,...Z])],Z},[]);if(C){Oe.error(`【${C}】${s("v_query.before_querying")}`);return}if(re){Oe.error(`【${re}】${s("v_query.the_minimum_value")}`);return}ve.length&&(sa(ve),ve.forEach(Z=>{me.emit(`query-data-${Z}`)}))},ka=()=>T.queryConditionWidth,Ke=()=>_.element.cascade,E=N(()=>({placeholderShow:T.placeholderShow}));ga("is-confirm-search",($,C=!1)=>{Y.value&&!C||da($)}),ga("unmount-select",Ee),ga("release-unmount-select",We),ga("query-data-for-id",da),ga("com-width",ka),ga("cascade-list",Ke),ga("placeholder",E),Wn(()=>{me.off(`addQueryCriteria${n.value.id}`),me.off(`editQueryCriteria${n.value.id}`),me.off(`updateQueryCriteria${n.value.id}`),jn.off("componentClick",ye)});const W=()=>{M.mobileInPc&&!Ut()||Array.isArray(n.value.propValue)&&n.value.propValue.forEach($=>{if($.auto){const C={datasetId:$.dataset.id,id:$.field.id},re=[],ve={};y.value.forEach(Z=>{Z.tableId===C.datasetId&&(re.push(Z.id),ve[Z.id]=C.id)}),$.checkedFields=re,$.checkedFieldsMap=ve}else{if(!$.dataset.id||$.parameters.length||$.optionValueSource!==1||![0,2,5].includes(+$.displayType))return;const C=y.value.map(re=>re.id);$.checkedFields.forEach(re=>{C.includes(re)||($.checkedFieldsMap[re]="")}),$.checkedFields=$.checkedFields.filter(re=>C.includes(re))}})};Kt(()=>{me.on(`addQueryCriteria${n.value.id}`,ea),me.on(`editQueryCriteria${n.value.id}`,ua),me.on(`updateQueryCriteria${n.value.id}`,W),W(),M.mobileInPc&&!Ut()&&ue()});const be=()=>{},Fe=$=>{JSON.parse($.dataTransfer.getData("dimension")||"{}").forEach(re=>{const ve=[],Z={};y.value.forEach(Ie=>{Ie.tableId===re.datasetId&&(ve.push(Ie.id),Z[Ie.id]=re.id)});const de=re.deType===7?0:`${re.deType}`;P.value.push({...Ql(re),auto:!0,optionValueSource:1,checkedFields:ve,checkedFieldsMap:Z,displayType:de})}),n.value.propValue=[...P.value],ae.recordSnapshotCache("drop")},va=$=>{F.value.setCondition($)},ua=()=>{if(!P.value.length){ea();return}va(P.value[0].id)},ea=()=>{F.value.setConditionOut()},pa=($,C)=>{const re=C.map(Z=>Z.id),ve=($||[]).reduce((Z,de)=>{if(re.includes(de.id))return Z;const Ie=Qe(de);return Z=[...new Set([...Ie,...Z])],Z},[]);ve.length&&ve.forEach(Z=>{me.emit(`query-data-${Z}`)})},Ta=$=>{const C=qe(a(P));P.value.splice($,1),n.value.propValue=[...P.value],ae.recordSnapshotCache("delQueryConfig"),pa(C,qe(a(P)))},ca=()=>{(P.value||[]).reduce(($,C)=>{var ve;C.conditionValueF=C.defaultConditionValueF,C.conditionValueOperatorF=C.defaultConditionValueOperatorF,C.conditionValueS=C.defaultConditionValueS,C.conditionValueOperatorS=C.defaultConditionValueOperatorS,C.displayType==="22"&&(C.numValueEnd=C.defaultNumValueEnd,C.numValueStart=C.defaultNumValueStart),C.defaultValueCheck||(C.defaultValue=C.multiple||+C.displayType==7?[]:void 0),C.selectValue=Array.isArray(C.defaultValue)?[...C.defaultValue]:C.defaultValue,C.optionValueSource===1&&((ve=C.defaultMapValue)!=null&&ve.length)&&(C.mapValue=Array.isArray(C.defaultMapValue)?[...C.defaultMapValue]:C.defaultMapValue),(_.element.cascade||[]).forEach(Z=>{Z.forEach(de=>{const Ie=de.datasetId.split("--")[1];C.id===Ie&&(de.currentSelectValue=Array.isArray(C.selectValue)?C.selectValue:[C.selectValue].filter(je=>![null,void 0].includes(je)),xa().emitter.emit(`${de.datasetId.split("--")[1]}-select`))})});const re=Qe(C);return $=[...new Set([...re,...$])],$},[]),!Y.value&&ue()},Da=()=>{(_.element.cascade||[]).forEach($=>{$.forEach(C=>{var re;(re=C.currentSelectValue)!=null&&re.length&&(xa().emitter.emit(`${C.datasetId.split("--")[1]}-select`),C.currentSelectValue=[])})}),(P.value||[]).reduce(($,C)=>{var ve;if(!C.visible)return $;C.selectValue=C.multiple||+C.displayType==7?[]:void 0,C.optionValueSource===1&&((ve=C.defaultMapValue)!=null&&ve.length)&&(C.mapValue=C.multiple?[]:void 0),C.conditionValueF="",C.conditionValueS="",C.displayType==="22"&&(C.numValueEnd=void 0,C.numValueStart=void 0);const re=Qe(C);return $=[...new Set([...re,...$])],$},[]),!Y.value&&ue()},_a=N(()=>P.value.filter($=>$.visible)),Y=N(()=>T.btnList.includes("sure"));ce(()=>Y.value,($,C)=>{!$&&C&&ue()},{immediate:!1});const te=N(()=>`${T.placeholderSize}px`),z=N(()=>`${T.queryConditionHeight||32}px`),ue=()=>{let $="",C="";const re=(n.value.propValue||[]).reduce((ve,Z)=>{if(Z.required)if(Z.defaultValueCheck||($=Z.name),Z.displayType==="8"){const{conditionValueF:Ie,conditionValueS:je,conditionType:Ca}=Z;Ca===0?$=Ie===""?Z.name:"":$=[Ie||"",je||""].filter(Aa=>Aa!=="").length<2?Z.name:""}else Z.displayType==="22"?(Z.numValueEnd!==0&&!Z.numValueEnd||Z.numValueStart!==0&&!Z.numValueStart)&&($=Z.name):(Array.isArray(Z.selectValue)&&!Z.selectValue.length||Z.selectValue!==0&&!Z.selectValue)&&($=Z.name);Z.displayType==="22"&&(!isNaN(Z.numValueEnd)&&!isNaN(Z.numValueStart)&&Z.numValueEnd<Z.numValueStart&&(C=Z.name),[Z.numValueEnd,Z.numValueStart].filter(Ie=>![null,void 0,""].includes(Ie)).length===1&&($=Z.name));const de=Qe(Z);return ve=[...new Set([...de,...ve])],ve},[]);if($){Oe.error(`【${$}】${s("v_query.before_querying")}`);return}if(C){Oe.error(`【${C}】${s("v_query.the_minimum_value")}`);return}re.length&&(M.mobileInPc&&!Ut()||M.setFirstLoadMap([...new Set([...re,...B.value])]),re.forEach(ve=>{me.emit(`query-data-${ve}`)}))},pe=N(()=>({textAlign:T.titleLayout||"left",color:T.titleColor||"#1f2329"})),De=N(()=>{const $={fontSize:T.fontSize+"px",lineHeight:+T.fontSize+8+"px"};return T.fontWeight&&($.fontWeight=T.fontWeight),T.fontStyle&&($.fontStyle=T.fontStyle),T.labelColor&&($.color=T.labelColor),$}),xe=N(()=>T.labelShow?T.layout:"horizontal"),ta=N(()=>({paddingTop:xe.value!=="horizontal"?T.nameboxSpacing+22+"px":"0"})),Oa=N(()=>({marginRight:xe.value==="horizontal"?T.nameboxSpacing+"px":"8px"})),ma=N(()=>Yn()||H?{position:"absolute",height:100/d.value+"%!important",width:100/d.value+"%!important",left:50*(1-1/d.value)+"%",top:50*(1-1/d.value)+"%",transform:"scale("+d.value+") translateZ(0)"}:{zoom:d.value});return($,C)=>{const re=nt,ve=al,Z=Ga,de=Ht;return c(),q(ie,null,[h("div",{class:"v-query-container",ref_key:"vQueryRef",ref:f,style:Ae(ma.value),onKeydown:C[0]||(C[0]=Ge(()=>{},["stop"])),onKeyup:C[1]||(C[1]=Ge(()=>{},["stop"]))},[T.titleShow?(c(),q("p",{key:0,class:"title",style:Ae(pe.value)},w(T.title),5)):j("",!0),h("div",{class:Te(["v-query",xe.value,T.titleShow&&!!T.title&&"title-show"]),onDragover:Ge(be,["prevent","stop"]),onDrop:Ge(Fe,["prevent","stop"])},[_a.value.length?j("",!0):(c(),q("div",id,[h("div",ud,[J(w(a(s)("v_query.here_or_click"))+" ",1),u(re,{disabled:o.showPosition==="preview"||a(R)||a(m)==="preview",onClick:ea,style:{"font-family":"inherit"},text:""},{default:r(()=>[J(w(a(s)("v_query.add_query_condition")),1)]),_:1},8,["disabled"])])])),h("div",rd,[(c(!0),q(ie,null,_e(_a.value,(Ie,je)=>(c(),q("div",{class:"query-item",style:Ae({marginRight:`${T.queryConditionSpacing}px`}),key:Ie.id},[h("div",{class:"query-field",style:Ae(ta.value)},[h("div",{class:"label",style:Ae(Oa.value)},[Xa(h("div",od,[h("div",{class:"label-wrapper-text",style:Ae(De.value)},[u(ve,{"popper-class":"label-wrapper-text_tooltip",effect:"dark",content:Ie.name,"show-arrow":!1,placement:"top-start"},{default:r(()=>[J(w(Ie.name),1)]),_:2},1032,["content"])],4),Ie.required?(c(),q("span",sd,"*")):j("",!0)],512),[[El,T.labelShow]]),o.showPosition!=="preview"&&!a(M).mobileInPc&&a(m)!=="preview"?(c(),q("div",dd,[u(ve,{effect:"dark",content:a(s)("v_query.set_filter_condition"),placement:"top"},{default:r(()=>[u(de,{onClick:Ca=>va(Ie.id)},{default:r(()=>[u(Z,{name:"icon_edit_outlined"},{default:r(()=>[u(a(Ua),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["content"]),u(ve,{effect:"dark",content:a(s)("v_query.delete_condition"),placement:"top"},{default:r(()=>[u(de,{style:{"margin-left":"8px"},onClick:Ca=>Ta(je)},{default:r(()=>[u(Z,{name:"icon_delete-trash_outlined"},{default:r(()=>[u(a(Zt),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["content"])])):j("",!0)],4),h("div",cd,[T.queryConditionWidth!==0?(c(),U(nd,{key:0,customStyle:T,config:Ie},null,8,["customStyle","config"])):j("",!0)])],4)],4))),128)),_a.value.length?(c(),q("div",md,[T.btnList.includes("clear")?(c(),U(re,{key:0,onClick:Ge(Da,["stop"]),style:Ae(le.value),plain:""},{default:r(()=>[J(w(a(s)("commons.clear")),1)]),_:1},8,["style"])):j("",!0),T.btnList.includes("reset")?(c(),U(re,{key:1,onClick:Ge(ca,["stop"]),style:Ae(le.value),plain:""},{default:r(()=>[J(w(a(s)("chart.reset")),1)]),_:1},8,["style"])):j("",!0),Y.value?(c(),U(re,{key:2,onClick:Ge(ue,["stop"]),style:Ae([{"margin-right":"7px"},O.value]),type:"primary"},{default:r(()=>[J(w(a(s)("commons.adv_search.search")),1)]),_:1},8,["style"])):j("",!0)])):j("",!0)])],34)],36),(c(),U(Il,{to:"body"},[u(Hs,{"query-element":a(n),onQueryData:ue,ref_key:"queryConfig",ref:F,onReRenderAll:pa},null,8,["query-element"])]))],64)}}});const pd=ja(vd,[["__scopeId","data-v-d64136b5"]]),Mc=Object.freeze(Object.defineProperty({__proto__:null,default:pd},Symbol.toStringTag,{value:"Module"}));export{Mc as C,pd as V,Ui as d};

import{e as ql,i as Za,M as $l,E as $e,A as xa,y as Ue,_ as Ka,P as Ja,Q as Xa,B as vl,z as Al,a8 as jt,v as nt,s as it,r as Il,g as ut,f as Dl,a9 as Pt,q as Kl,aa as zt,b as Ht,w as Qt,x as Zt,R as Kt,S as Jt}from"./element-plus-secondary-0.0.0-dataease.js";import{e as La,f as _a}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{o as s,c as k,a as m,d as Ke,r as Z,T as R,U as r,W as i,_ as z,Y as b,u as a,x as el,k as O,a8 as ce,S as X,X as Be,t as ia,w as me,a7 as Sa,R as G,z as be,V as ze,i as Ye,Z as Ie,a6 as rt,n as Me,j as Xt,b as Nl,$ as za,bI as ml,l as st,a0 as ot,aa as Ea,q as ga,aV as en,a9 as Jl,e as an}from"./@vue-0.0.0-dataease.js";import{i as Ra}from"./icon_edit_outlined-0.0.0-dataease.js";import{i as Ol}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import{e as ln}from"./eventBus-0.0.0-dataease.js";import{_ as Pa,c as ba}from"./less-0.0.0-dataease.js";import{u as Na,a as tn,g as nn,i as Sl,B as un}from"./index-0.0.0-dataease.js";import{s as dt}from"./snapshot-0.0.0-dataease.js";import{_ as rn}from"./jspdf-0.0.0-dataease.js";import{_ as sn}from"./HandleMore.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import{m as on}from"./more_v-0.0.0-dataease.js";import{i as cl}from"./icon_add_outlined-0.0.0-dataease.js";import{i as dn}from"./icon_drag_outlined-0.0.0-dataease.js";import{i as cn}from"./icon_visible_outlined-0.0.0-dataease.js";import{d as Xl}from"./dv-folder-0.0.0-dataease.js";import{i as et}from"./icon_dataset-0.0.0-dataease.js";import{i as vn}from"./icon_warning_filled-0.0.0-dataease.js";import{i as mn}from"./icon_info_outlined-0.0.0-dataease.js";import{s as pl}from"./pinia-0.0.0-dataease.js";import{F as pn,B as ct,G as fn,H as yn,I as _n,J as at,g as hn}from"./dataset-0.0.0-dataease.js";import{d as vt}from"./vuedraggable-0.0.0-dataease.js";import{h as we,d as mt}from"./lodash-es-0.0.0-dataease.js";import{g as pt}from"./util-0.0.0-dataease.js";import{g as Ha,a as gn,b as bn,c as Vn,d as kn,e as Tn,f as Cn,h as Mn,i as Fn,j as Sn}from"./time-format-0.0.0-dataease.js";import{d as al}from"./dvMain-0.0.0-dataease.js";import{g as ya,a as Ze,b as El,c as Fa,d as Qa}from"./time-format-dayjs-0.0.0-dataease.js";import{f as ke}from"./attr-0.0.0-dataease23.js";import{E as wl}from"./EmptyBackground-0.0.0-dataease.js";import{d as he,q as wn}from"./dayjs-0.0.0-dataease.js";import{i as qn}from"./icon_admin_outlined-0.0.0-dataease.js";import{D as fl}from"./@element-plus-0.0.0-dataease.js";import{s as $n,a as lt,b as An,c as In}from"./vant-0.0.0-dataease.js";import{_ as Ua}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import{a as Dn}from"./chart-list-0.0.0-dataease.js";import{i as sa}from"./field-list-0.0.0-dataease.js";import{t as Nn}from"./treeSortUtils-0.0.0-dataease.js";const On={width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"};function En(L,w){return s(),k("svg",On,[...w[0]||(w[0]=[m("path",{d:"M8.00022 9.99975C7.56203 9.99975 7.13323 9.96523 6.71734 9.89921L6.38535 11.1382C6.33771 11.316 6.15493 11.4216 5.9771 11.3739L5.33315 11.2014C5.15533 11.1537 5.0498 10.9709 5.09745 10.7931L5.42255 9.57985C4.88013 9.39561 4.37096 9.15494 3.90491 8.86629L2.8454 9.9258C2.71522 10.056 2.50417 10.056 2.37399 9.9258L1.90259 9.4544C1.77242 9.32422 1.77242 9.11317 1.90259 8.98299L2.83565 8.04994C2.35424 7.59918 1.95209 7.0852 1.64812 6.52421C1.64492 6.51832 1.64162 6.51215 1.63823 6.50575C1.5136 6.27038 1.56023 5.97574 1.75709 5.79635C1.92051 5.64743 2.03596 5.5461 2.13639 5.44567C2.14538 5.43669 2.15521 5.42666 2.16569 5.41583C2.31108 5.2656 2.55902 5.32152 2.64417 5.51246C3.47427 7.37398 5.46211 8.66641 8.00022 8.66641C10.4321 8.66641 12.4664 7.40872 13.2829 5.68239C13.3042 5.63747 13.328 5.5809 13.3519 5.52084C13.4276 5.33064 13.6741 5.27325 13.8188 5.41801C13.9259 5.52508 14.0687 5.66784 14.2471 5.8463C14.4235 6.0227 14.4713 6.29211 14.356 6.51334C14.3279 6.56715 14.3006 6.61785 14.2774 6.65816C13.9638 7.20109 13.5572 7.69751 13.0754 8.1321L13.9263 8.98299C14.0565 9.11317 14.0565 9.32422 13.9263 9.4544L13.4549 9.9258C13.3247 10.056 13.1136 10.056 12.9835 9.9258L11.9888 8.93112C11.5521 9.19111 11.0792 9.40958 10.5779 9.57985L10.903 10.7931C10.9506 10.9709 10.8451 11.1537 10.6673 11.2014L10.0233 11.3739C9.84552 11.4216 9.66274 11.316 9.61509 11.1382L9.2831 9.89921C8.86721 9.96523 8.43842 9.99975 8.00022 9.99975Z"},null,-1)])])}const Rn={render:En},Ln={t:"1652583161182",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2172",width:"200",height:"200"};function xn(L,w){return s(),k("svg",Ln,[...w[0]||(w[0]=[m("path",{d:"M362.666667 192m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"2173"},null,-1),m("path",{d:"M661.333333 192m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"2174"},null,-1),m("path",{d:"M362.666667 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"2175"},null,-1),m("path",{d:"M661.333333 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"2176"},null,-1),m("path",{d:"M362.666667 832m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"2177"},null,-1),m("path",{d:"M661.333333 832m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z","p-id":"2178"},null,-1)])])}const Un={render:xn},Yn=["title"],Gn={class:"item-span"},Bn={class:"dialog-footer"},Wn=Ke({__name:"CustomSortFilter",emits:["save"],setup(L,{expose:w,emit:u}){const t=Z([]),v=Z(!1),d=H=>{f(H),v.value=!0},f=H=>{t.value=we(H)},F=u,x=()=>{v.value=!1},S=()=>{F("save",a(t)),x()};return w({sortInit:d}),(H,ee)=>{const p=La,T=ql,C=Za,ie=$l;return s(),R(ie,{"destroy-on-close":"","append-to-body":"",title:H.$t("v_query.custom_sort"),modelValue:v.value,"onUpdate:modelValue":ee[0]||(ee[0]=g=>v.value=g),class:"custom-sort_filter",width:"300px"},{footer:r(()=>[m("div",Bn,[i(C,{onClick:x},{default:r(()=>[z(b(H.$t("common.cancel")),1)]),_:1}),i(C,{type:"primary",onClick:S},{default:r(()=>[z(b(H.$t("chart.confirm")),1)]),_:1})])]),default:r(()=>[m("div",null,[i(a(vt),{list:t.value,animation:"300",class:"drag-list"},{item:r(({element:g})=>[(s(),k("span",{key:g.name,class:"item-dimension",title:g},[i(T,{size:"20px"},{default:r(()=>[i(p,{name:"drag"},{default:r(()=>[i(a(Un),{class:"svg-icon"})]),_:1})]),_:1}),m("span",Gn,b(g),1)],8,Yn))]),_:1},8,["list"])])]),_:1},8,["title","modelValue"])}}});const{t:jn}=_a(),ft=L=>{const{id:w,name:u,deType:t,type:v,datasetId:d}=L;return{id:pt(),name:u,showError:!0,timeGranularity:"date",timeGranularityMultiple:"datetimerange",field:{id:w,type:v,name:u,deType:t},displayId:w,sortId:"",sort:"asc",defaultMapValue:[],mapValue:[],conditionType:0,conditionValueOperatorF:"eq",conditionValueF:"",conditionValueOperatorS:"like",conditionValueS:"",defaultConditionValueOperatorF:"eq",defaultConditionValueF:"",defaultConditionValueOperatorS:"like",defaultConditionValueS:"",timeType:"fixed",relativeToCurrent:"custom",required:!1,timeNum:0,relativeToCurrentType:"date",around:"f",parametersStart:null,parametersEnd:null,arbitraryTime:new Date,timeNumRange:0,relativeToCurrentTypeRange:"date",aroundRange:"f",arbitraryTimeRange:new Date,auto:!1,defaultValue:void 0,selectValue:void 0,optionValueSource:0,valueSource:[],dataset:{id:d,name:"",fields:[]},visible:!0,defaultValueCheck:!1,multiple:!1,displayType:"0",checkedFields:[],parameters:[],parametersCheck:!1,parametersList:[],checkedFieldsMap:{}}},Pn=()=>{const L={id:"",name:jn("v_query.unnamed"),deType:0,type:"VARCHAR",datasetId:""};return ft(L)},zn={class:"cascade-content"},Hn={style:{display:"flex","align-items":"center","justify-content":"space-between"}},Qn={class:"cascade-item"},Zn={class:"label"},Kn={class:"item-name"},Jn={class:"label"},Xn={class:"item-name"},ei={class:"dialog-footer"},ai=Ke({__name:"TreeFieldDialog",emits:["saveTree"],setup(L,{expose:w,emit:u}){const t=Z(!1),v=Z([]),d=el([]),f=u,{t:F}=_a(),x=()=>{v.value.push({field:{id:""},id:pt()})},S=()=>{t.value=!1},H=(ne,te)=>{d.value=we(ne),v.value=we(te).map(J=>({field:J,id:J.id})),t.value=!0},ee=O(()=>v.value.map(ne=>ne.field).map(ne=>ne.id)),p=()=>{S()},T=()=>{let ne=!1;return{arr:we(v.value).map(J=>{var I;return(I=J.field)!=null&&I.id||(ne=!0),J.field}),isError:ne}},C=()=>{const{isError:ne,arr:te}=T();if(ne){$e.error(F("v_query.select_a_field"));return}f("saveTree",te),S()},ie=[F("visualization.number1"),F("visualization.number2"),F("visualization.number3"),F("visualization.number4"),F("visualization.number5")],g=ne=>{v.value.splice(ne,1)};return w({init:H}),(ne,te)=>{const J=La,I=Za,A=xa,Te=Ue,Ce=$l;return s(),R(Ce,{modelValue:t.value,"onUpdate:modelValue":te[0]||(te[0]=e=>t.value=e),width:"600","modal-class":"tree-field_dialog","before-close":S,onMousedown:te[1]||(te[1]=Be(()=>{},["stop"])),onMousedup:te[2]||(te[2]=Be(()=>{},["stop"])),title:a(F)("v_query.tree_structure_design")},{footer:r(()=>[m("div",ei,[i(I,{secondary:"",onClick:p},{default:r(()=>[z(b(a(F)("common.cancel")),1)]),_:1}),i(I,{type:"primary",onClick:C},{default:r(()=>[z(b(a(F)("pblink.sure_bt")),1)]),_:1})])]),default:r(()=>[m("div",zn,[m("div",Hn,[i(I,{disabled:v.value.length===5,text:"",onClick:x},{icon:r(()=>[i(J,{name:"icon_add_outlined"},{default:r(()=>[i(a(cl),{class:"svg-icon"})]),_:1})]),default:r(()=>[z(" "+b(a(F)("v_query.add_level")),1)]),_:1},8,["disabled"])]),m("div",Qn,[m("div",Zn,b(a(F)("visualization.level")),1),m("div",Kn,b(a(F)("v_query.tree_query_field")),1)]),(s(!0),k(X,null,ce(v.value,(e,Re)=>(s(),k("div",{class:"cascade-item",key:e.id},[m("div",Jn,b(a(F)("visualization.level"))+b(ie[Re]),1),m("div",Xn,[i(Te,{"value-key":"id",modelValue:e.field,"onUpdate:modelValue":De=>e.field=De,style:{width:"300px"}},{default:r(()=>[(s(!0),k(X,null,ce(d.value,De=>(s(),R(A,{disabled:ee.value.includes(De.id),key:De.id,label:De.name,value:De},null,8,["disabled","label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"])]),i(I,{onClick:De=>g(Re),class:"cascade-delete",text:""},{icon:r(()=>[i(J,{name:"icon_delete-trash_outlined"},{default:r(()=>[i(a(Ol),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]))),128))])]),_:1},8,["modelValue","title"])}}});const yt=Ke({__name:"DynamicTimeFiltering",props:{config:{type:Object,default:()=>({regularOrTrendsValue:"",intervalType:"none",regularOrTrends:"fixed",relativeToCurrent:"custom",timeNum:0,relativeToCurrentType:"year",around:"f"})},timeGranularityMultiple:{type:String,default:()=>"yearrange"}},setup(L){const w=L,{config:u}=ia(w),t=O(()=>{const{relativeToCurrent:f,regularOrTrends:F,intervalType:x,timeNum:S,relativeToCurrentType:H,around:ee}=u.value;return{relativeToCurrent:f,timeNum:S,regularOrTrends:F,intervalType:x,relativeToCurrentType:H,around:ee,timeGranularityMultiple:w.timeGranularityMultiple}});me(()=>t.value,()=>{d()},{deep:!0});const v=O(()=>{const f=w.timeGranularityMultiple.split("time").join("");return u.value.intervalType==="timeInterval"?f:f.split("range")[0]}),d=()=>{const{relativeToCurrent:f,regularOrTrends:F,timeNum:x,relativeToCurrentType:S,around:H}=t.value;if(F==="fixed"){if(u.value.regularOrTrendsValue&&!Array.isArray(u.value.regularOrTrendsValue))return;u.value.regularOrTrendsValue=new Date;return}if(f==="custom")u.value.regularOrTrendsValue=ya(S,H==="f"?"subtract":"add",x);else switch(f){case"thisYear":u.value.regularOrTrendsValue=Ze("year");break;case"lastYear":u.value.regularOrTrendsValue=Fa("year");break;case"thisMonth":u.value.regularOrTrendsValue=Ze("month");break;case"lastMonth":u.value.regularOrTrendsValue=Fa("month");break;case"today":u.value.regularOrTrendsValue=Ze("day");break;case"yesterday":u.value.regularOrTrendsValue=Fa("day");break;case"monthBeginning":u.value.regularOrTrendsValue=Ze("month");break;case"monthEnd":u.value.regularOrTrendsValue=El("month");break;case"yearBeginning":u.value.regularOrTrendsValue=Ze("year");break}};return Sa(()=>{d()}),(f,F)=>{const x=Ka;return s(),R(x,{disabled:a(u).regularOrTrends!=="fixed",key:v.value,modelValue:a(u).regularOrTrendsValue,"onUpdate:modelValue":F[0]||(F[0]=S=>a(u).regularOrTrendsValue=S),type:v.value,"prefix-icon":a(fl),placeholder:f.$t("commons.date.select_date_time")},null,8,["disabled","modelValue","type","prefix-icon","placeholder"])}}}),_t=Ke({__name:"DynamicTimeRangeFiltering",props:{config:{type:Object,default:()=>({timeGranularityMultiple:"daterange",regularOrTrendsValue:[],regularOrTrends:"fixed",timeNum:0,intervalType:"none",relativeToCurrentRange:"custom",relativeToCurrentType:"year",around:"f",timeGranularity:"date",timeNumRange:0,relativeToCurrentTypeRange:"year",aroundRange:"f"})},timeGranularityMultiple:{type:String,default:()=>"yearrange"}},setup(L){const w=L,{config:u}=ia(w),t=O(()=>{const{timeNum:F,relativeToCurrentType:x,around:S,relativeToCurrentRange:H,intervalType:ee,regularOrTrends:p,timeGranularity:T,timeNumRange:C,relativeToCurrentTypeRange:ie,aroundRange:g}=u.value;return{timeNum:F,relativeToCurrentType:x,around:S,intervalType:ee,relativeToCurrentRange:H,regularOrTrends:p,timeGranularity:T,timeNumRange:C,relativeToCurrentTypeRange:ie,aroundRange:g,timeGranularityMultiple:w.timeGranularityMultiple}}),v=O(()=>{const F=w.timeGranularityMultiple.split("time").join("");return u.value.intervalType==="timeInterval"?F:F.split("range")[0]});me(()=>t.value,()=>{d()},{deep:!0});const d=()=>{const{timeNum:F,relativeToCurrentType:x,around:S,relativeToCurrentRange:H,regularOrTrends:ee,timeNumRange:p,relativeToCurrentTypeRange:T,aroundRange:C}=t.value;if(ee==="fixed"){if(Array.isArray(u.value.regularOrTrendsValue)&&u.value.regularOrTrendsValue.length)return;u.value.regularOrTrendsValue=[ya(T,"add",0),ya(T,"add",1)];return}const ie=ya(x,S==="f"?"subtract":"add",F),g=ya(T,C==="f"?"subtract":"add",p);if(H&&H!=="custom"){u.value.regularOrTrendsValue=Qa(H);return}u.value.regularOrTrendsValue=[ie,g]};Sa(()=>{d()});const f=O(()=>w.timeGranularityMultiple==="yearrange"?"YYYY":void 0);return(F,x)=>{const S=Ka;return s(),R(S,{disabled:a(u).regularOrTrends!=="fixed",modelValue:a(u).regularOrTrendsValue,"onUpdate:modelValue":x[0]||(x[0]=H=>a(u).regularOrTrendsValue=H),key:v.value,type:v.value,"prefix-icon":a(fl),format:f.value,"popper-class":"custom-dynamic-time-range-filter-popper_class","range-separator":F.$t("cron.to"),"start-placeholder":F.$t("datasource.start_time"),"end-placeholder":F.$t("datasource.end_time")},null,8,["disabled","modelValue","type","prefix-icon","format","range-separator","start-placeholder","end-placeholder"])}}});const li={class:"set-time-filtering-range"},ti={class:"title"},ni={class:"list-item"},ii={class:"label"},ui={class:"setting-content"},ri={class:"setting"},si={key:0,class:"list-item"},oi={class:"label"},di={class:"setting-content"},ci={class:"setting"},vi={key:0,class:"setting"},mi={class:"setting-label"},pi={class:"setting-value select"},fi={key:1,class:"setting"},yi={class:"setting-input"},_i={class:"setting"},hi={class:"setting-label"},gi={class:"setting-value select"},bi={class:"setting-label"},Vi={class:"setting-input range"},ki={class:"setting-label"},Ti={class:"setting-input range"},Ci={key:0,class:"setting-label"},Mi={class:"list-item"},Fi={class:"label"},Si={key:0,class:"setting-content maximum-single-query"},wi=Ke({__name:"RangeFilterTime",props:{timeRange:{type:Object,default:()=>({intervalType:"none",dynamicWindow:!1,maximumSingleQuery:0,regularOrTrends:"fixed",relativeToCurrentRange:"custom",regularOrTrendsValue:"",relativeToCurrent:"custom",timeNum:0,relativeToCurrentType:"year",around:"f",timeNumRange:0,relativeToCurrentTypeRange:"year",aroundRange:"f"})},timeGranularityMultiple:{type:String,default:"yearrange"}},setup(L){const w=L,{t:u}=_a(),t=[{label:u("chart.line_symbol_none"),value:"none"},{label:u("v_query.start_at"),value:"start"},{label:u("v_query.end_at"),value:"end"},{label:u("v_query.time_interval"),value:"timeInterval"}],v=O(()=>t.find(T=>T.value===d.value.intervalType).label),{timeRange:d}=ia(w),f=O(()=>d.value.regularOrTrends!=="fixed"),F=O(()=>{const{intervalType:T}=d.value;return T==="timeInterval"?_t:yt}),x=[{label:u("dynamic_time.before"),value:"f"},{label:u("dynamic_time.after"),value:"b"}],S=O(()=>{if(!d.value)return[];let T=["yearrange","monthrange","daterange","datetimerange"].indexOf(w.timeGranularityMultiple)+1;return[{label:u("dynamic_time.year"),value:"year"},{label:u("dynamic_time.month"),value:"month"},{label:u("dynamic_time.date"),value:"day"}].slice(0,T)}),H=O(()=>(S.value[S.value.length-1]||{}).label),ee=O(()=>{let T=[];if(!d.value)return T;switch(w.timeGranularityMultiple){case"yearrange":T=[{label:u("dynamic_year.current"),value:"thisYear"},{label:u("dynamic_year.last"),value:"lastYear"}];break;case"monthrange":T=[{label:u("cron.this_month"),value:"thisMonth"},{label:u("dynamic_month.last"),value:"lastMonth"}];break;case"daterange":T=[{label:u("dynamic_time.today"),value:"today"},{label:u("dynamic_time.yesterday"),value:"yesterday"},{label:u("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:u("dynamic_time.endOfMonth"),value:"monthEnd"},{label:u("dynamic_time.firstOfYear"),value:"yearBeginning"}];break;case"datetimerange":T=[{label:u("dynamic_time.today"),value:"today"},{label:u("dynamic_time.yesterday"),value:"yesterday"},{label:u("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:u("dynamic_time.endOfMonth"),value:"monthEnd"},{label:u("dynamic_time.firstOfYear"),value:"yearBeginning"}];break}return[...T,{label:u("dynamic_time.custom"),value:"custom"}]}),p=O(()=>{let T=[];if(!d.value)return T;switch(w.timeGranularityMultiple){case"yearrange":T=[{label:u("dynamic_year.current"),value:"thisYear"},{label:u("dynamic_year.last"),value:"lastYear"}];break;case"monthrange":T=[{label:u("cron.this_month"),value:"thisMonth"},{label:u("dynamic_month.last"),value:"lastMonth"},{label:u("v_query.last_3_months"),value:"LastThreeMonths"},{label:u("v_query.last_6_months"),value:"LastSixMonths"},{label:u("v_query.last_12_months"),value:"LastTwelveMonths"}];break;case"daterange":case"datetimerange":T=[{label:u("dynamic_time.today"),value:"today"},{label:u("dynamic_time.yesterday"),value:"yesterday"},{label:u("v_query.last_3_days"),value:"LastThreeDays"},{label:u("v_query.month_to_date"),value:"monthBeginning"},{label:u("v_query.year_to_date"),value:"yearBeginning"}];break}return[...T,{label:u("dynamic_time.custom"),value:"custom"}]});return me(()=>p.value,T=>{T.some(C=>C.value===d.value.relativeToCurrentRange)||(d.value.relativeToCurrentRange=T[0].value)},{immediate:!0}),me(()=>ee.value,T=>{T.some(C=>C.value===d.value.relativeToCurrent)||(d.value.relativeToCurrent=T[0].value)},{immediate:!0}),me(()=>S.value,T=>{T.some(C=>C.value===d.value.relativeToCurrentType)||(d.value.relativeToCurrentType=T[0].value),T.some(C=>C.value===d.value.relativeToCurrentTypeRange)||(d.value.relativeToCurrentTypeRange=T[0].value)},{immediate:!0}),(T,C)=>{const ie=Ja,g=Xa,ne=xa,te=Ue,J=vl,I=Al;return s(),k("div",li,[m("div",ti,b(a(u)("v_query.time_filter_range")),1),m("div",ni,[m("div",ii,b(a(u)("v_query.interval_type")),1),m("div",ui,[m("div",ri,[i(g,{modelValue:a(d).intervalType,"onUpdate:modelValue":C[0]||(C[0]=A=>a(d).intervalType=A)},{default:r(()=>[(s(),k(X,null,ce(t,A=>i(ie,{key:A.value,label:A.value},{default:r(()=>[z(b(A.label),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])])])]),a(d).intervalType!=="none"?(s(),k("div",si,[m("div",oi,b(v.value),1),m("div",di,[m("div",ci,[i(g,{modelValue:a(d).regularOrTrends,"onUpdate:modelValue":C[1]||(C[1]=A=>a(d).regularOrTrends=A)},{default:r(()=>[i(ie,{label:"fixed"},{default:r(()=>[z(b(a(u)("dynamic_time.fix")),1)]),_:1}),i(ie,{label:"dynamic"},{default:r(()=>[z(b(a(u)("dynamic_time.dynamic")),1)]),_:1})]),_:1},8,["modelValue"])]),f.value&&a(d).intervalType!=="timeInterval"?(s(),k(X,{key:0},[a(d).intervalType!=="timeInterval"?(s(),k("div",vi,[m("div",mi,b(a(u)("dynamic_time.relative")),1),m("div",pi,[i(te,{teleported:!1,modelValue:a(d).relativeToCurrent,"onUpdate:modelValue":C[2]||(C[2]=A=>a(d).relativeToCurrent=A)},{default:r(()=>[(s(!0),k(X,null,ce(ee.value,A=>(s(),R(ne,{key:A.value,label:A.label,value:A.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])):G("",!0),a(d).relativeToCurrent==="custom"?(s(),k("div",fi,[m("div",yi,[i(J,{modelValue:a(d).timeNum,"onUpdate:modelValue":C[3]||(C[3]=A=>a(d).timeNum=A),min:0,"controls-position":"right"},null,8,["modelValue"]),i(te,{teleported:!1,modelValue:a(d).relativeToCurrentType,"onUpdate:modelValue":C[4]||(C[4]=A=>a(d).relativeToCurrentType=A)},{default:r(()=>[(s(!0),k(X,null,ce(S.value,A=>(s(),R(ne,{key:A.value,label:A.label,value:A.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i(te,{teleported:!1,modelValue:a(d).around,"onUpdate:modelValue":C[5]||(C[5]=A=>a(d).around=A)},{default:r(()=>[(s(),k(X,null,ce(x,A=>i(ne,{key:A.value,label:A.label,value:A.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])])):G("",!0)],64)):f.value&&a(d).intervalType==="timeInterval"?(s(),k(X,{key:1},[m("div",_i,[m("div",hi,b(a(u)("dynamic_time.relative")),1),m("div",gi,[i(te,{teleported:!1,modelValue:a(d).relativeToCurrentRange,"onUpdate:modelValue":C[6]||(C[6]=A=>a(d).relativeToCurrentRange=A)},{default:r(()=>[(s(!0),k(X,null,ce(p.value,A=>(s(),R(ne,{key:A.value,label:A.label,value:A.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),a(d).relativeToCurrentRange==="custom"?(s(),k(X,{key:0},[m("div",{class:be(["setting",["yearrange","monthrange"].includes(L.timeGranularityMultiple)&&"is-year-month-range"])},[m("div",bi,b(a(u)("datasource.start_time")),1),m("div",Vi,[i(J,{"step-strictly":"",modelValue:a(d).timeNum,"onUpdate:modelValue":C[7]||(C[7]=A=>a(d).timeNum=A),min:0,"controls-position":"right"},null,8,["modelValue"]),i(te,{teleported:!1,modelValue:a(d).relativeToCurrentType,"onUpdate:modelValue":C[8]||(C[8]=A=>a(d).relativeToCurrentType=A)},{default:r(()=>[(s(!0),k(X,null,ce(S.value,A=>(s(),R(ne,{key:A.value,label:A.label,value:A.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i(te,{teleported:!1,modelValue:a(d).around,"onUpdate:modelValue":C[9]||(C[9]=A=>a(d).around=A)},{default:r(()=>[(s(),k(X,null,ce(x,A=>i(ne,{key:A.value,label:A.label,value:A.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])],2),m("div",{class:be(["setting",["yearrange","monthrange"].includes(L.timeGranularityMultiple)&&"is-year-month-range"])},[m("div",ki,b(a(u)("datasource.end_time")),1),m("div",Ti,[i(J,{modelValue:a(d).timeNumRange,"onUpdate:modelValue":C[10]||(C[10]=A=>a(d).timeNumRange=A),min:0,"step-strictly":"","controls-position":"right"},null,8,["modelValue"]),i(te,{teleported:!1,modelValue:a(d).relativeToCurrentTypeRange,"onUpdate:modelValue":C[11]||(C[11]=A=>a(d).relativeToCurrentTypeRange=A)},{default:r(()=>[(s(!0),k(X,null,ce(S.value,A=>(s(),R(ne,{key:A.value,label:A.label,value:A.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i(te,{teleported:!1,modelValue:a(d).aroundRange,"onUpdate:modelValue":C[12]||(C[12]=A=>a(d).aroundRange=A)},{default:r(()=>[(s(),k(X,null,ce(x,A=>i(ne,{key:A.value,label:A.label,value:A.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])],2)],64)):G("",!0)],64)):G("",!0)]),m("div",{class:be(["parameters",f.value&&"setting"])},[f.value?(s(),k("div",Ci,b(a(u)("template_manage.preview")),1)):G("",!0),m("div",{class:be(f.value?"setting-value":"w100")},[(s(),R(ze(F.value),{config:a(d),timeGranularityMultiple:L.timeGranularityMultiple,ref:"inputCom"},null,8,["config","timeGranularityMultiple"]))],2)],2)])):G("",!0),m("div",Mi,[m("div",Fi,[i(I,{modelValue:a(d).dynamicWindow,"onUpdate:modelValue":C[13]||(C[13]=A=>a(d).dynamicWindow=A),label:a(u)("v_query.query_time_window")},null,8,["modelValue","label"])]),a(d).dynamicWindow?(s(),k("div",Si,[z(b(a(u)("v_query.maximum_single_query"))+" ",1),i(J,{modelValue:a(d).maximumSingleQuery,"onUpdate:modelValue":C[14]||(C[14]=A=>a(d).maximumSingleQuery=A),min:1,"controls-position":"right"},null,8,["modelValue"]),z(" "+b(H.value),1)])):G("",!0)])])}}});const qi={class:"set-time-filtering-range"},$i={class:"title"},Ai={class:"list-item"},Ii={class:"label"},Di={class:"setting-content"},Ni={class:"setting"},Oi={key:0,class:"list-item"},Ei={class:"label"},Ri={class:"setting-content"},Li={class:"setting"},xi={key:0,class:"setting"},Ui={class:"setting-label"},Yi={class:"setting-value select"},Gi={key:1,class:"setting"},Bi={class:"setting-input"},Wi={class:"setting"},ji={class:"setting-label"},Pi={class:"setting-value select"},zi={class:"setting-label"},Hi={class:"setting-input range"},Qi={class:"setting-label"},Zi={class:"setting-input range"},Ki={key:0,class:"setting-label"},Ji=Ke({__name:"FilterTime",props:{timeRange:{default:()=>({intervalType:"none",dynamicWindow:!1,maximumSingleQuery:0,regularOrTrends:"fixed",relativeToCurrentRange:"custom",regularOrTrendsValue:"",relativeToCurrent:"custom",timeNum:0,relativeToCurrentType:"year",around:"f",timeNumRange:0,relativeToCurrentTypeRange:"year",aroundRange:"f"})},timeGranularity:{default:"year"}},setup(L){const w=L,{t:u}=_a(),t=[{label:u("chart.line_symbol_none"),value:"none"},{label:u("v_query.start_at"),value:"start"},{label:u("v_query.end_at"),value:"end"},{label:u("v_query.time_interval"),value:"timeInterval"}],v=O(()=>t.find(T=>T.value===d.value.intervalType).label),{timeRange:d}=ia(w),f=O(()=>d.value.regularOrTrends!=="fixed"),F=O(()=>{const{intervalType:T}=d.value;return T==="timeInterval"?_t:yt}),x=O(()=>w.timeGranularity+"range"),S=[{label:u("dynamic_time.before"),value:"f"},{label:u("dynamic_time.after"),value:"b"}],H=O(()=>{if(!d.value)return[];let T=["year","month","date","datetime"].indexOf(w.timeGranularity)+1;return[{label:u("dynamic_time.year"),value:"year"},{label:u("dynamic_time.month"),value:"month"},{label:u("dynamic_time.date"),value:"day"}].slice(0,T)}),ee=O(()=>{let T=[];if(!d.value)return T;switch(w.timeGranularity){case"year":T=[{label:u("dynamic_year.current"),value:"thisYear"},{label:u("dynamic_year.last"),value:"lastYear"}];break;case"month":T=[{label:u("cron.this_month"),value:"thisMonth"},{label:u("dynamic_month.last"),value:"lastMonth"}];break;case"date":T=[{label:u("dynamic_time.today"),value:"today"},{label:u("dynamic_time.yesterday"),value:"yesterday"},{label:u("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:u("dynamic_time.firstOfYear"),value:"yearBeginning"}];break;case"datetime":T=[{label:u("dynamic_time.today"),value:"today"},{label:u("dynamic_time.yesterday"),value:"yesterday"},{label:u("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:u("dynamic_time.firstOfYear"),value:"yearBeginning"}];break}return[...T,{label:u("dynamic_time.custom"),value:"custom"}]}),p=O(()=>{let T=[];if(!d.value)return T;switch(w.timeGranularity){case"year":T=[{label:u("dynamic_year.current"),value:"thisYear"},{label:u("dynamic_year.last"),value:"lastYear"}];break;case"month":T=[{label:u("cron.this_month"),value:"thisMonth"},{label:u("dynamic_month.last"),value:"lastMonth"},{label:u("v_query.last_3_months"),value:"LastThreeMonths"},{label:u("v_query.last_6_months"),value:"LastSixMonths"},{label:u("v_query.last_12_months"),value:"LastTwelveMonths"}];break;case"date":case"datetime":T=[{label:u("dynamic_time.today"),value:"today"},{label:u("dynamic_time.yesterday"),value:"yesterday"},{label:u("v_query.last_3_days"),value:"LastThreeDays"},{label:u("v_query.month_to_date"),value:"monthBeginning"},{label:u("v_query.year_to_date"),value:"yearBeginning"}];break}return[...T,{label:u("dynamic_time.custom"),value:"custom"}]});return me(()=>p.value,T=>{T.some(C=>C.value===d.value.relativeToCurrentRange)||(d.value.relativeToCurrentRange=T[0].value)},{immediate:!0}),me(()=>ee.value,T=>{T.some(C=>C.value===d.value.relativeToCurrent)||(d.value.relativeToCurrent=T[0].value)},{immediate:!0}),me(()=>H.value,T=>{T.some(C=>C.value===d.value.relativeToCurrentType)||(d.value.relativeToCurrentType=T[0].value)},{immediate:!0}),(T,C)=>{const ie=Ja,g=Xa,ne=xa,te=Ue,J=vl;return s(),k("div",qi,[m("div",$i,b(a(u)("v_query.time_filter_range")),1),m("div",Ai,[m("div",Ii,b(a(u)("v_query.interval_type")),1),m("div",Di,[m("div",Ni,[i(g,{modelValue:a(d).intervalType,"onUpdate:modelValue":C[0]||(C[0]=I=>a(d).intervalType=I)},{default:r(()=>[(s(),k(X,null,ce(t,I=>i(ie,{key:I.value,label:I.value},{default:r(()=>[z(b(I.label),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])])])]),a(d).intervalType!=="none"?(s(),k("div",Oi,[m("div",Ei,b(v.value),1),m("div",Ri,[m("div",Li,[i(g,{modelValue:a(d).regularOrTrends,"onUpdate:modelValue":C[1]||(C[1]=I=>a(d).regularOrTrends=I)},{default:r(()=>[i(ie,{label:"fixed"},{default:r(()=>[z(b(a(u)("dynamic_time.fix")),1)]),_:1}),i(ie,{label:"dynamic"},{default:r(()=>[z(b(a(u)("dynamic_time.dynamic")),1)]),_:1})]),_:1},8,["modelValue"])]),f.value&&a(d).intervalType!=="timeInterval"?(s(),k(X,{key:0},[a(d).intervalType!=="timeInterval"?(s(),k("div",xi,[m("div",Ui,b(a(u)("dynamic_time.relative")),1),m("div",Yi,[i(te,{teleported:!1,modelValue:a(d).relativeToCurrent,"onUpdate:modelValue":C[2]||(C[2]=I=>a(d).relativeToCurrent=I)},{default:r(()=>[(s(!0),k(X,null,ce(ee.value,I=>(s(),R(ne,{key:I.value,label:I.label,value:I.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])):G("",!0),a(d).relativeToCurrent==="custom"?(s(),k("div",Gi,[m("div",Bi,[i(J,{modelValue:a(d).timeNum,"onUpdate:modelValue":C[3]||(C[3]=I=>a(d).timeNum=I),min:0,"controls-position":"right"},null,8,["modelValue"]),i(te,{teleported:!1,modelValue:a(d).relativeToCurrentType,"onUpdate:modelValue":C[4]||(C[4]=I=>a(d).relativeToCurrentType=I)},{default:r(()=>[(s(!0),k(X,null,ce(H.value,I=>(s(),R(ne,{key:I.value,label:I.label,value:I.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i(te,{teleported:!1,modelValue:a(d).around,"onUpdate:modelValue":C[5]||(C[5]=I=>a(d).around=I)},{default:r(()=>[(s(),k(X,null,ce(S,I=>i(ne,{key:I.value,label:I.label,value:I.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])])):G("",!0)],64)):f.value&&a(d).intervalType==="timeInterval"?(s(),k(X,{key:1},[m("div",Wi,[m("div",ji,b(a(u)("dynamic_time.relative")),1),m("div",Pi,[i(te,{teleported:!1,modelValue:a(d).relativeToCurrentRange,"onUpdate:modelValue":C[6]||(C[6]=I=>a(d).relativeToCurrentRange=I)},{default:r(()=>[(s(!0),k(X,null,ce(p.value,I=>(s(),R(ne,{key:I.value,label:I.label,value:I.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),a(d).relativeToCurrentRange==="custom"?(s(),k(X,{key:0},[m("div",{class:be(["setting",["year","month"].includes(T.timeGranularity)&&"is-year-month-range"])},[m("div",zi,b(a(u)("datasource.start_time")),1),m("div",Hi,[i(J,{"step-strictly":"",modelValue:a(d).timeNum,"onUpdate:modelValue":C[7]||(C[7]=I=>a(d).timeNum=I),min:0,"controls-position":"right"},null,8,["modelValue"]),i(te,{teleported:!1,modelValue:a(d).relativeToCurrentType,"onUpdate:modelValue":C[8]||(C[8]=I=>a(d).relativeToCurrentType=I)},{default:r(()=>[(s(!0),k(X,null,ce(H.value,I=>(s(),R(ne,{key:I.value,label:I.label,value:I.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i(te,{teleported:!1,modelValue:a(d).around,"onUpdate:modelValue":C[9]||(C[9]=I=>a(d).around=I)},{default:r(()=>[(s(),k(X,null,ce(S,I=>i(ne,{key:I.value,label:I.label,value:I.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])],2),m("div",{class:be(["setting",["year","month"].includes(T.timeGranularity)&&"is-year-month-range"])},[m("div",Qi,b(a(u)("datasource.end_time")),1),m("div",Zi,[i(J,{modelValue:a(d).timeNumRange,"onUpdate:modelValue":C[10]||(C[10]=I=>a(d).timeNumRange=I),min:0,"step-strictly":"","controls-position":"right"},null,8,["modelValue"]),i(te,{teleported:!1,modelValue:a(d).relativeToCurrentTypeRange,"onUpdate:modelValue":C[11]||(C[11]=I=>a(d).relativeToCurrentTypeRange=I)},{default:r(()=>[(s(!0),k(X,null,ce(H.value,I=>(s(),R(ne,{key:I.value,label:I.label,value:I.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i(te,{teleported:!1,modelValue:a(d).aroundRange,"onUpdate:modelValue":C[12]||(C[12]=I=>a(d).aroundRange=I)},{default:r(()=>[(s(),k(X,null,ce(S,I=>i(ne,{key:I.value,label:I.label,value:I.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])])],2)],64)):G("",!0)],64)):G("",!0)]),m("div",{class:be(["parameters",f.value&&"setting"])},[f.value?(s(),k("div",Ki,b(a(u)("template_manage.preview")),1)):G("",!0),m("div",{class:be(f.value?"setting-value":"w100")},[(s(),R(ze(F.value),{config:a(d),timeGranularityMultiple:x.value,ref:"inputCom"},null,8,["config","timeGranularityMultiple"]))],2)],2)])):G("",!0)])}}});const Xi=Ke({__name:"DynamicTime",props:{config:{type:Object,default:()=>({defaultValue:"",selectValue:"",timeType:"fixed",relativeToCurrent:"custom",timeNum:0,relativeToCurrentType:"year",around:"f",arbitraryTime:new Date,defaultValueCheck:!1,timeGranularity:"date"})}},setup(L){const w=L,u=Z(),{config:t}=ia(w),v=O(()=>{const{relativeToCurrent:f,timeNum:F,relativeToCurrentType:x,around:S,defaultValueCheck:H,arbitraryTime:ee,timeGranularity:p}=t.value;return{relativeToCurrent:f,timeNum:F,relativeToCurrentType:x,around:S,defaultValueCheck:H,arbitraryTime:ee,timeGranularity:p}});me(()=>v.value,()=>{d()},{deep:!0}),me(()=>u.value,f=>{t.value.defaultValue=f,t.value.selectValue=f}),me(()=>t.value.id,()=>{d()});const d=()=>{const{relativeToCurrent:f,timeNum:F,relativeToCurrentType:x,around:S,defaultValueCheck:H,arbitraryTime:ee,timeGranularity:p}=v.value;if(!H){u.value=null;return}if(f==="custom")u.value=Ha(F,x,p,S,p==="datetime"?ee:null);else switch(f){case"thisYear":u.value=Sn();break;case"lastYear":u.value=Fn();break;case"thisMonth":u.value=Mn();break;case"lastMonth":u.value=Cn();break;case"today":u.value=Tn();break;case"yesterday":u.value=kn();break;case"monthBeginning":u.value=Vn();break;case"monthEnd":u.value=bn();break;case"yearBeginning":u.value=gn();break}};return Sa(()=>{d()}),(f,F)=>{const x=Ka;return s(),R(x,{disabled:"",key:a(t).timeGranularity,modelValue:u.value,"onUpdate:modelValue":F[0]||(F[0]=S=>u.value=S),type:a(t).timeGranularity,"prefix-icon":a(fl),"popper-class":"custom-dynamic-time-popper_class",placeholder:f.$t("commons.date.select_date_time")},null,8,["modelValue","type","prefix-icon","placeholder"])}}});const eu=Ke({__name:"DynamicTimeRange",props:{config:{type:Object,default:()=>({timeGranularityMultiple:"datetimerange",defaultValue:[],selectValue:[],timeType:"fixed",timeNum:0,relativeToCurrentType:"year",around:"f",arbitraryTime:new Date,defaultValueCheck:!1,timeGranularity:"date",timeNumRange:0,relativeToCurrentRange:"custom",relativeToCurrentTypeRange:"year",aroundRange:"f",arbitraryTimeRange:new Date})}},setup(L){const w=L,u=Z([new Date,new Date]),{config:t}=ia(w),v=O(()=>{const{timeNum:F,relativeToCurrentType:x,timeGranularityMultiple:S,around:H,relativeToCurrentRange:ee,defaultValueCheck:p,arbitraryTime:T,timeGranularity:C,timeNumRange:ie,relativeToCurrentTypeRange:g,aroundRange:ne,arbitraryTimeRange:te}=t.value;return{timeNum:F,relativeToCurrentType:x,around:H,relativeToCurrentRange:ee,timeGranularityMultiple:S,defaultValueCheck:p,arbitraryTime:T,timeGranularity:C,timeNumRange:ie,relativeToCurrentTypeRange:g,aroundRange:ne,arbitraryTimeRange:te}});me(()=>v.value,()=>{d()},{deep:!0}),me(()=>u.value,F=>{t.value.defaultValue=F,t.value.selectValue=F}),me(()=>t.value.id,()=>{d()});const d=()=>{const{timeNum:F,relativeToCurrentType:x,around:S,defaultValueCheck:H,arbitraryTime:ee,timeGranularity:p,timeGranularityMultiple:T,timeNumRange:C,relativeToCurrentTypeRange:ie,aroundRange:g,relativeToCurrentRange:ne,arbitraryTimeRange:te}=v.value;if(!H){u.value=[new Date,new Date];return}if(ne!=="custom"){u.value=Qa(ne);return}const J=Ha(F,x,p,S,ee,T,"start-config"),I=Ha(C,ie,p,g,te,T,"end-config");u.value=[J,I]};Sa(()=>{d()});const f=O(()=>t.value.timeGranularityMultiple==="yearrange"?"YYYY":void 0);return(F,x)=>{const S=Ka;return s(),R(S,{disabled:"",modelValue:u.value,"onUpdate:modelValue":x[0]||(x[0]=H=>u.value=H),key:a(t).timeGranularityMultiple,type:a(t).timeGranularityMultiple,"prefix-icon":a(fl),format:f.value,"popper-class":"custom-dynamic-time-range-popper_class","range-separator":F.$t("cron.to"),"start-placeholder":F.$t("datasource.start_time"),"end-placeholder":F.$t("datasource.end_time")},null,8,["modelValue","type","prefix-icon","format","range-separator","start-placeholder","end-placeholder"])}}});const{t:au}=_a();he.extend(wn);function rl(L="month"){return new Date(he().startOf(L).format("YYYY/MM/DD HH:mm:ss"))}function sl(L="month"){return new Date(he().endOf(L).format("YYYY/MM/DD HH:mm:ss"))}function ol(L="month"){return new Date(he().subtract(1,L).startOf(L).format("YYYY/MM/DD HH:mm:ss"))}function dl(L="month"){return new Date(he().subtract(1,L).endOf(L).format("YYYY/MM/DD HH:mm:ss"))}let Ma=()=>{};const ht=[{text:"dynamic_time.cweek",onClick:({emit:L})=>{const w=new Date(+new Date(rl("week"))+864e5),u=new Date(+new Date(sl("week"))+24*1e3*3600);Ma([w,u])||L("pick",[he(w),he(u)])}},{text:"dynamic_month.current",onClick:({emit:L})=>{const w=rl("month"),u=sl("month");Ma([w,u])||L("pick",[he(w),he(u)])}},{text:"dynamic_time.cquarter",onClick:({emit:L})=>{const w=rl("quarter"),u=sl("quarter");Ma([w,u])||L("pick",[he(w),he(u)])}},{text:"dynamic_year.current",onClick:({emit:L})=>{const w=rl("year"),u=sl("year");Ma([w,u])||L("pick",[he(w),he(u)])}},{text:"dynamic_time.lweek",onClick:({emit:L})=>{const w=new Date(+new Date(ol("week"))+864e5),u=new Date(+new Date(dl("week"))+24*1e3*3600);Ma([w,u])||L("pick",[he(w),he(u)])}},{text:"dynamic_month.last",onClick:({emit:L})=>{const w=ol("month"),u=dl("month");Ma([w,u])||L("pick",[he(w),he(u)])}},{text:"dynamic_time.lquarter",onClick:({emit:L})=>{const w=ol("quarter"),u=dl("quarter");Ma([w,u])||L("pick",[he(w),he(u)])}},{text:"dynamic_year.last",onClick:({emit:L})=>{const w=ol("year"),u=dl("year");Ma([w,u])||L("pick",[he(w),he(u)])}}];ht.forEach(L=>{L.text=au(L.text)});const lu=L=>(Ma=L,{shortcuts:ht}),gt=Ke({__name:"Time",props:{config:{type:Object,default:()=>({selectValue:"",defaultValue:"",queryConditionWidth:0,defaultValueCheck:!1,displayType:"1",timeGranularity:"date",setTimeRange:!1,timeGranularityMultiple:"daterange",timeRange:{intervalType:"none",dynamicWindow:!1,maximumSingleQuery:0,regularOrTrends:"fixed",regularOrTrendsValue:"",relativeToCurrent:"custom",timeNum:0,relativeToCurrentType:"year",around:"f",timeNumRange:0,relativeToCurrentTypeRange:"year",aroundRange:"f"}})},isConfig:{type:Boolean,default:!1}},setup(L,{expose:w}){const{t:u}=_a(),t=L,v=Ye("placeholder"),d=O(()=>{var M;return(M=v==null?void 0:v.value)!=null&&M.placeholderShow?t.config.placeholder:" "}),f=Z(),F=Z(!1),x=al(),{config:S}=ia(t),H=new Date("1970/1/1"),ee=new Date("2100/1/1");me(()=>S.value.defaultValue,M=>{if(t.isConfig)return;const Y=S.value.displayType==="7";Y&&(F.value=Y),f.value=Array.isArray(M)?[...M]:M,Me(()=>{F.value=Y})});const p=M=>{h.value=M[0];const Y=M.some(fe=>Ne(fe));return h.value=0,Y},{shortcuts:T}=lu(p);me(()=>S.value.id,()=>{g()});const C=()=>{t.isConfig&&(F.value&&S.value.displayType==="7"||(f.value=S.value.displayType==="7"?[]:void 0,F.value=S.value.displayType==="7",S.value.defaultValue=F.value?[]:void 0,f.value=F.value?[]:void 0))};me(()=>S.value.selectValue,M=>{t.isConfig||(S.value.displayType==="7"&&(f.value=Array.isArray(M)?[...M]:M),Me(()=>{F.value=S.value.displayType==="7",F.value||(f.value=Array.isArray(S.value.selectValue)?[...S.value.selectValue]:S.value.selectValue)}))});const ie=()=>{f.value=Array.isArray(f.value)?f.value.map(Y=>Y&&he(Y).format("YYYY/MM/DD HH:mm:ss")):f.value&&he(f.value).format("YYYY/MM/DD HH:mm:ss");const M=Array.isArray(f.value)?[...f.value]:f.value;if(!t.isConfig){S.value.selectValue=Array.isArray(f.value)?[...f.value]:f.value,Me(()=>{J(S.value.id)});return}S.value.defaultValue=Array.isArray(M)?M.map(Y=>new Date(Y).toLocaleString()):new Date(M).toLocaleString()},g=()=>{const{defaultValueCheck:M,displayType:Y,defaultValue:fe}=S.value,Ve=Y==="7";M?(S.value.selectValue=Array.isArray(fe)?[...fe]:fe,f.value=Array.isArray(fe)?[...fe]:fe):(S.value.selectValue=Ve?[]:void 0,f.value=Ve?[]:void 0),F.value=S.value.displayType==="7",e.value=e.value.slice(0,W()+1)},ne=Ye("com-width",Function,!0),te=()=>{var M;return(M=v==null?void 0:v.value)!=null&&M.placeholderShow?t.config.queryConditionWidth===void 0?ne():t.config.queryConditionWidth:227},J=Ye("is-confirm-search",Function,!0),I=O(()=>t.isConfig?{}:{width:(F.value?te()*2:te())+"px !important"}),A=O(()=>x.mobileInPc?["year","month","day"].slice(0,W()+1):[]),Te=O(()=>x.mobileInPc?(F.value?S.value.timeGranularityMultiple:S.value.timeGranularity).includes("datetime"):!1),Ce=Z([]),e=Z(["2021","01","01"]),Re=Z(!1),De=O(()=>x.mobileInPc?+S.value.displayType==7:!1),ge=()=>{var Y;const M=((Y=f.value)==null?void 0:Y.length)>1?f.value[1]:null;if(M){const fe=new Date(M);e.value=[`${fe.getFullYear()}`,`${fe.getMonth()+1}`,`${fe.getDate()}`].slice(0,W()+1),Te.value&&(Ce.value=[`${fe.getHours()}`,`${fe.getMinutes()}`,`${fe.getSeconds()}`])}oa.value=!0,Re.value=!0},W=()=>{const M=F.value?S.value.timeGranularityMultiple:S.value.timeGranularity;return["year","month","date"].findIndex(fe=>M.includes(fe))},h=Z(0),ye=M=>{h.value=+new Date(M[0])},B=Z(),pe=M=>{var Y;h.value=0,M||(Y=B.value)==null||Y.blur()},oe=O(()=>{const M=S.value.timeGranularityMultiple.split("time").join("").split("range")[0];return M==="date"?"day":M}),Ne=M=>{const Y=+new Date(M);if(!S.value.setTimeRange)return!1;const{intervalType:fe,regularOrTrends:Ve,regularOrTrendsValue:ma,relativeToCurrent:ua,relativeToCurrentRange:ea,timeNum:pa,relativeToCurrentType:ka,around:ca,dynamicWindow:wa,maximumSingleQuery:ha,timeNumRange:E,relativeToCurrentTypeRange:Q,aroundRange:j}=S.value.timeRange||{};let ae=!1;if(h.value&&wa&&(ae=he(h.value).add(ha,oe.value).startOf(oe.value).valueOf()-1e3<Y||he(h.value).subtract(ha,oe.value).startOf(oe.value).valueOf()+1e3>Y),fe==="none")return wa?ae:!1;let se;if(ua==="custom")se=ya(ka,ca==="f"?"subtract":"add",pa);else switch(ua){case"thisYear":se=Ze("year");break;case"lastYear":se=Fa("year");break;case"thisMonth":se=Ze("month");break;case"lastMonth":se=Fa("month");break;case"thisQuarter":se=Ze("quarter");break;case"thisWeek":se=new Date(he().startOf("week").add(1,"day").startOf("day").format("YYYY/MM/DD HH:mm:ss"));break;case"today":se=Ze("day");break;case"yesterday":se=Fa("day");break;case"monthBeginning":se=Ze("month");break;case"monthEnd":se=El("month");break;case"yearBeginning":se=Ze("year");break}const qe=Ve==="fixed"?ma:se;if(fe==="start")return Y<+new Date(qe)||ae;if(fe==="end")return Y>+new Date(qe)||ae;if(fe==="timeInterval"){let Le;return ea==="custom"?(se=Ve==="fixed"?new Date(he(new Date(ma[0])).startOf(oe.value).format("YYYY/MM/DD HH:mm:ss")):ya(ka,ca==="f"?"subtract":"add",pa),Le=Ve==="fixed"?new Date(he(new Date(ma[1])).endOf(oe.value).format("YYYY/MM/DD HH:mm:ss")):ya(Q,j==="f"?"subtract":"add",E)):[se,Le]=Qa(ea),Y<+new Date(se)-1e3||Y>+new Date(Le)||ae}},We=()=>{if(De.value){const[M]=f.value||[];if(M){const Y=new Date(M);e.value=[`${Y.getFullYear()}`,`${Y.getMonth()+1}`,`${Y.getDate()}`].slice(0,W()+1),Te.value&&(Ce.value=[`${Y.getHours()}`,`${Y.getMinutes()}`,`${Y.getSeconds()}`])}}else{const M=f.value?new Date(f.value):new Date;e.value=[`${M.getFullYear()}`,`${M.getMonth()+1}`,`${M.getDate()}`].slice(0,W()+1),Te.value&&(Ce.value=[`${M.getHours()}`,`${M.getMinutes()}`,`${M.getSeconds()}`])}oa.value=!1,Re.value=!0},He=()=>{Re.value=!1},oa=Z(!1),da=()=>{e.value=e.value.slice(0,W()+1);const M=[1,2].includes(e.value.length)?e.value.concat(Array([0,2,1][e.value.length]).fill("01")):e.value;if(De.value){const[Y,fe]=f.value||[];oa.value?f.value=[Y||new Date(`${M.join("/")} ${Ce.value.join(":")}`),new Date(`${M.join("/")} ${Ce.value.join(":")}`)]:f.value=[new Date(`${M.join("/")} ${Ce.value.join(":")}`),fe||new Date(`${M.join("/")} ${Ce.value.join(":")}`)]}else f.value=new Date(`${M.join("/")} ${Ce.value.join(":")}`)},Va=()=>{Re.value=!1;const{displayType:M}=S.value,Y=M==="7";S.value.selectValue=Y?[]:void 0,f.value=Y?[]:void 0,ie()},Qe=()=>{da(),ie(),Re.value=!1};Sa(()=>{g()}),w({displayTypeChange:C});const $=O(()=>S.value.timeGranularityMultiple==="yearrange"?"YYYY":void 0);return(M,Y)=>{const fe=Ka;return s(),k(X,null,[F.value?(s(),R(fe,{modelValue:f.value,"onUpdate:modelValue":Y[0]||(Y[0]=Ve=>f.value=Ve),key:a(S).timeGranularityMultiple,type:a(S).timeGranularityMultiple,style:Ie(I.value),ref_key:"datePicker",ref:B,onVisibleChange:pe,"disabled-date":Ne,onCalendarChange:ye,format:$.value,shortcuts:["datetimerange","daterange"].includes(a(S).timeGranularityMultiple)?a(T):[],onChange:ie,editable:!1,"range-separator":M.$t("cron.to"),"start-placeholder":d.value,"end-placeholder":d.value},null,8,["modelValue","type","style","format","shortcuts","range-separator","start-placeholder","end-placeholder"])):(s(),R(fe,{key:a(S).timeGranularity+1,modelValue:f.value,"onUpdate:modelValue":Y[1]||(Y[1]=Ve=>f.value=Ve),onVisibleChange:pe,"disabled-date":Ne,type:a(S).timeGranularity,onChange:ie,style:Ie(I.value),placeholder:d.value},null,8,["modelValue","type","style","placeholder"])),a(x).mobileInPc?(s(),k("div",{key:2,class:be(["vant-mobile",De.value&&"wl50"]),onClick:We},null,2)):G("",!0),a(x).mobileInPc&&De.value?(s(),k("div",{key:3,class:"vant-mobile wr50",onClick:ge})):G("",!0),a(x).mobileInPc?(s(),R(a(In),{key:4,teleport:"body",position:"bottom",show:Re.value,"onUpdate:show":Y[5]||(Y[5]=Ve=>Re.value=Ve)},{default:r(()=>[Te.value?(s(),R(a($n),{key:0,onConfirm:Qe,onCancel:He,title:a(u)("v_query.time_selection"),tabs:[a(u)("dataset.select_date"),a(u)("dataset.select_time")],"next-step-text":a(u)("sync_datasource.next")},{default:r(()=>[i(a(lt),{"min-date":a(H),"max-date":a(ee),"columns-type":A.value,modelValue:e.value,"onUpdate:modelValue":Y[2]||(Y[2]=Ve=>e.value=Ve)},null,8,["min-date","max-date","columns-type","modelValue"]),i(a(An),{"columns-type":["hour","minute","second"],modelValue:Ce.value,"onUpdate:modelValue":Y[3]||(Y[3]=Ve=>Ce.value=Ve)},null,8,["modelValue"])]),_:1},8,["title","tabs","next-step-text"])):G("",!0),Te.value?G("",!0):(s(),R(a(lt),{key:1,title:a(u)("dataset.select_date"),"columns-type":A.value,onConfirm:Qe,onCancel:He,"min-date":a(H),"max-date":a(ee),modelValue:e.value,"onUpdate:modelValue":Y[4]||(Y[4]=Ve=>e.value=Ve)},null,8,["title","columns-type","min-date","max-date","modelValue"]))]),_:1},8,["show"])):G("",!0),Re.value?(s(),R(rt,{key:5,to:".van-picker__toolbar"},[m("button",{style:{position:"absolute",top:"0",right:"60px"},onClick:Va,class:"van-picker__confirm van-haptics-feedback oooo"},b(a(u)("commons.clear")),1)])):G("",!0)],64)}}});function tu(L,w,u){L=Math.max(0,Math.min(255,L)),w=Math.max(0,Math.min(255,w)),u=Math.max(0,Math.min(255,u));const t=L.toString(16).padStart(2,"0"),v=w.toString(16).padStart(2,"0"),d=u.toString(16).padStart(2,"0");return`#${t}${v}${d}`.toUpperCase()}function nu(L,w,u,t){const v=Math.max(0,Math.min(255,L)).toString(16).padStart(2,"0"),d=Math.max(0,Math.min(255,w)).toString(16).padStart(2,"0"),f=Math.max(0,Math.min(255,u)).toString(16).padStart(2,"0"),F=t!==void 0?Math.round(Math.max(0,Math.min(1,t))*255).toString(16).padStart(2,"0"):"";return`#${v}${d}${f}${F}`.toUpperCase()}function bt(L){const w=/^(rgb|rgba)\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)$/,u=L.match(w);if(!u)return null;const t=parseInt(u[2]),v=parseInt(u[3]),d=parseInt(u[4]),f=u[5]?parseFloat(u[5]):void 0;return f!==void 0?nu(t,v,d,f):tu(t,v,d)}const iu=Ke({__name:"Select",props:{config:{type:Object,default:()=>({selectValue:"",queryConditionWidth:0,resultMode:0,defaultValue:"",displayType:"",defaultValueCheck:!1,optionValueSource:0,multiple:!1,checkedFieldsMap:{}})},isConfig:{type:Boolean,default:!1}},setup(L,{expose:w}){ml(E=>({"73d9d24c":wa.value,e8f728a6:ha.value}));const{t:u}=_a(),t=L,{config:v}=ia(t);let d=[];const f=Z(),F=Z(!1),x=Z(!1),S=el([]),H=Ye("unmount-select"),ee=Ye("placeholder"),p=Ye("release-unmount-select",Function,!0),T=Ye("query-data-for-id",Function,!0),C=Ye("is-confirm-search",Function,!0),ie=Ye("com-width",Function,!0),g=Ye("cascade-list",Function,!0),ne=Ye("set-cascade-default",Function,!0),te=Ye("$custom-style-filter"),J=O(()=>{var E;return(E=ee==null?void 0:ee.value)!=null&&E.placeholderShow?["",void 0].includes(t.config.placeholder)?" ":t.config.placeholder:" "}),I=O(()=>g()||[]);let A;const Te=O(()=>{const{defaultValueFirstItem:E,optionValueSource:Q,multiple:j}=t.config;return E&&Q===1&&!j}),Ce=E=>{const{displayId:Q,field:j}=v.value;if(v.value.optionValueSource!==1)return[];let ae={},se=[];return E.forEach(qe=>{ae[qe]=[]}),d.forEach(qe=>{ae[qe[Q||(j==null?void 0:j.id)]]&&ae[qe[Q||(j==null?void 0:j.id)]].push(qe[j==null?void 0:j.id])}),Object.values(ae).forEach(qe=>{se=[...new Set([...se,...qe])]}),se};Xt(()=>{clearTimeout(A),d=[]});const e=E=>{I.value.forEach(Q=>{Q.forEach(j=>{j.datasetId.split("--")[1]===v.value.id&&(t.isConfig&&(j.selectValue=Array.isArray(E)?[...E]:E),j.currentSelectValue=Array.isArray(E)?[...E]:E)})})},Re=()=>{I.value.forEach(E=>{let Q=!1;E.forEach(j=>{j.datasetId.split("--")[1]===v.value.id?Q=!0:Q&&(Na().emitter.emit(`${j.datasetId.split("--")[1]}-select`),Q=!1)})})},De=()=>{const E=[];return I.value.forEach(Q=>{let j=!1;Q.forEach(ae=>{ae.datasetId.split("--")[1]===v.value.id?j=!0:j&&(E.push(ae.datasetId.split("--")[1]),j=!1)})}),E},ge=()=>{const E=[];return I.value.forEach(Q=>{let j=null;Q.forEach(ae=>{var la,qa;const[se,qe,Le]=ae.datasetId.split("--");qe===v.value.id&&j?(ae.fieldId&&(j.fieldId=ae.fieldId),E.push(j)):t.isConfig?(la=ae.selectValue)!=null&&la.length&&(j={fieldId:Le,operator:"in",value:[...ae.selectValue]}):(qa=ae.currentSelectValue)!=null&&qa.length&&(j={fieldId:Le,operator:"in",value:[...ae.currentSelectValue]})})}),E},W=()=>{const E=Array.isArray(f.value)?[...f.value]:f.value;if(!t.isConfig){v.value.selectValue=Array.isArray(f.value)?[...f.value]:f.value,v.value.mapValue=Ce(Array.isArray(f.value)?[...f.value]:[f.value]),e(v.value.mapValue),Re(),Me(()=>{C(v.value.id,Te.value)});return}ne(De()),v.value.defaultValue=E,v.value.mapValue=Ce(Array.isArray(f.value)?[...f.value]:[f.value]),v.value.defaultMapValue=Ce(Array.isArray(f.value)?[...f.value]:[f.value]),e(v.value.mapValue)},h=()=>{t.isConfig&&(v.value.defaultValue=v.value.multiple?[]:void 0,f.value=v.value.multiple?[]:void 0,v.value.defaultValueFirstItem=!1)},ye=E=>{F.value=!0,pn({fieldIds:E,resultMode:v.value.resultMode||0}).then(Q=>{S.value=(Q||[]).filter(j=>j!==null).map(j=>({label:`${j}`,value:`${j}`}))}).finally(()=>{F.value=!1,v.value.defaultValueCheck?f.value=Array.isArray(v.value.defaultValue)?[...v.value.defaultValue]:v.value.defaultValue:f.value=Array.isArray(f.value)?[...f.value]:f.value,He()})},B=E=>{const{displayId:Q}=v.value;if(!Q)return[];let j={},ae=[];return E.forEach(se=>{j[se]=[]}),d.forEach(se=>{j[se[Q]]&&j[se[Q]].push(se)}),Object.values(j).forEach(se=>{ae=[...ae,...se]}),ae},pe=()=>{var E;(E=v.value.sortList)!=null&&E.length&&v.value.sort==="customSort"&&(S.value=[...S.value.sort(Q=>{if(v.value.sortList.indexOf(Q.value)!==-1)return-1}).sort((Q,j)=>v.value.sortList.indexOf(Q.value)===-1?0:v.value.sortList.indexOf(Q.value)-v.value.sortList.indexOf(j.value))])},oe=E=>{F.value=!0,ct(E).then(Q=>{var se;let j=[],ae=[];(se=f.value)!=null&&se.length&&v.value.multiple&&(j=[...f.value],ae=B(j)),d=[...Q||[],...ae],S.value=[...new Set((Q||[]).map(qe=>`${qe[E.displayId||E.queryId]}`).concat(j))].map(qe=>({label:`${qe}`,value:`${qe}`,checked:j.includes(qe)})),pe()}).finally(()=>{var Q;if(F.value=!1,v.value.defaultValueCheck&&!da.value){f.value=Array.isArray(v.value.defaultValue)?[...v.value.defaultValue]:v.value.defaultValue;let j=!1;if(H.value.includes(v.value.id)){const ae=Ce(Array.isArray(f.value)?[...f.value]:[f.value]);(ae==null?void 0:ae.length)!==((Q=v.value.defaultMapValue)==null?void 0:Q.length)?j=!0:ae.every(se=>v.value.defaultMapValue.includes(se))||(j=!0),p(v.value.id)}v.value.mapValue=Ce(Array.isArray(f.value)?[...f.value]:[f.value]),j&&T(v.value.id)}else f.value=Array.isArray(f.value)?[...f.value]:f.value;Te.value&&(A=setTimeout(()=>{clearTimeout(A),We()},300)),da.value=!1})},Ne=Z(!1);me(()=>v.value.showEmpty,()=>{He()});const We=()=>{S.value.length&&(f.value=S.value[0].value,W())};me(()=>v.value.defaultValueFirstItem,E=>{E&&We()});const He=()=>{const{showEmpty:E,displayType:Q,optionValueSource:j}=v.value;if(+Q!=0||j===1)return;const[ae]=S.value;E?(ae==null?void 0:ae.value)!=="_empty_$"&&(S.value=[{label:u("v_query.empty_data"),value:"_empty_$"},...S.value]):(ae==null?void 0:ae.value)==="_empty_$"&&(S.value=S.value.slice(1))};me(()=>v.value.defaultValue,E=>{v.value.multiple&&(f.value=Array.isArray(E)?[...E]:E),Me(()=>{x.value=v.value.multiple})}),me(()=>v.value.id,()=>{$()}),me(()=>v.value.selectValue,E=>{t.isConfig||(v.value.multiple&&(f.value=Array.isArray(E)?[...E]:E),Me(()=>{x.value=v.value.multiple,v.value.multiple||(f.value=Array.isArray(v.value.selectValue)?[...v.value.selectValue]:v.value.selectValue)}))}),me(()=>v.value.multiple,E=>{t.isConfig&&(E&&(f.value=[]),Me(()=>{x.value=E,v.value.defaultValueFirstItem=!1,E||Me(()=>{f.value=void 0})}))}),me([()=>v.value.field.id,()=>v.value.displayId,()=>v.value.sort,()=>v.value.sortId],E=>{E&&Qe(1)}),me([()=>v.value.sortList],E=>{!(E!=null&&E.length)||v.value.sort!=="customSort"||pe()}),me(()=>v.value.optionValueSource,(E,Q)=>{t.isConfig&&([E,Q].includes(2)&&(f.value=Array.isArray(f.value)?[]:void 0,v.value.selectValue=we(f.value),v.value.defaultValue=we(f.value)),Qe(E),v.value.defaultValueFirstItem=!1)}),me([()=>v.value.checkedFields,()=>v.value.checkedFieldsMap],()=>{Qe(v.value.optionValueSource)},{deep:!0});const oa=Z(""),da=Z(!1);me(()=>v.value.valueSource,()=>{v.value.optionValueSource===2&&Qe(2)});const Qe=mt(E=>{if(E!==v.value.optionValueSource)return;const{optionValueSource:Q,checkedFieldsMap:j,checkedFields:ae,field:se,valueSource:qe,displayId:Le,sort:la,sortId:qa}=v.value;switch(Q){case 0:const va=Object.values(j).filter(V=>!!V);ae.length&&va.length?ye(ae.map(V=>j[V]).filter(V=>!!V)):S.value=[];break;case 1:se.id?oe({queryId:se.id,displayId:Le||se.id,sort:la==="customSort"?"asc":la,sortId:la==="customSort"?"":qa,resultMode:v.value.resultMode||0,searchText:oa.value,filter:ge()}):S.value=[];break;case 2:S.value=we((qe||[]).map(V=>({label:`${V}`,value:`${V}`}))),He();break}},300),$=()=>{const{defaultValueCheck:E,multiple:Q,defaultValue:j,optionValueSource:ae}=v.value;E?(v.value.selectValue=Array.isArray(j)?[...j]:j,f.value=Array.isArray(j)?[...j]:j):(v.value.selectValue=Q?[]:void 0,f.value=Q?[]:void 0),Me(()=>{x.value=v.value.multiple}),Qe(ae)},M=()=>{var E;return(E=ee==null?void 0:ee.value)!=null&&E.placeholderShow?t.config.queryConditionWidth===void 0?ie():t.config.queryConditionWidth:227},Y=O(()=>t.isConfig?{}:{width:M()+"px"}),fe=Z(),Ve=Z(),ma=()=>{v.value.optionValueSource!==1||![0,2,5].includes(+v.value.displayType)||(v.value.selectValue=v.value.multiple?[]:void 0,f.value=v.value.multiple?[]:void 0,da.value=!0,Qe(1))},ua=()=>{Na().emitter.emit("select-hide_lick",v.value.id)},ea=E=>{var j;if(E===v.value.id)return;const Q=Ve.value||fe.value;(j=Q==null?void 0:Q.handleClickOutside)==null||j.call(Q)};Sa(()=>{$(),Na({name:`${v.value.id}-select`,callback:ma}),Na({name:"select-hide_lick",callback:ea})});const pa=Z(!1),ka=O(()=>{let E="filter-select-popper_class";return Ne.value&&(E="load-select "+E),pa.value&&(E=E+" color-scrollbar__thumb"),E});Nl(()=>{pa.value=!!document.querySelector("#canvas-dv-outer")||!!document.querySelector(".datav-preview")});const ca=O(()=>{if(!te||["#FFFFFF","rgba(255, 255, 255, 1)","rgb(255, 255, 255)"].includes(te.background))return"";if(te.background==="#131C42")return"rgb(38, 53, 82)";const E=te.background.startsWith("#")?te.background:bt(te.background);return Pa.mix(new ba("ffffff"),new ba(E.substr(1)),{value:20}).toRGB()}),wa=O(()=>(M()-65)/2+"px"),ha=O(()=>(M()-65)/2-20+"px");return w({displayTypeChange:h,mult:fe,single:Ve}),(E,Q)=>{const j=jt,ae=Ja,se=Xa,qe=nt;return x.value?za((s(),R(j,{key:"multiple",ref_key:"mult",ref:fe,modelValue:f.value,"onUpdate:modelValue":Q[0]||(Q[0]=Le=>f.value=Le),placeholder:J.value,filterable:"",onClick:ua,onChange:W,"popper-class":ka.value,multiple:"","show-checked":"",tagColor:ca.value,"scrollbar-always-on":"",clearable:"",style:Ie(Y.value),"collapse-tags":"",options:S.value,"collapse-tags-tooltip":""},null,8,["modelValue","placeholder","popper-class","tagColor","style","options"])),[[qe,F.value]]):za((s(),R(j,{modelValue:f.value,"onUpdate:modelValue":Q[2]||(Q[2]=Le=>f.value=Le),key:"single",onClick:ua,placeholder:J.value,"scrollbar-always-on":"",onChange:W,clearable:"",disabled:Te.value&&t.isConfig,ref_key:"single",ref:Ve,style:Ie(Y.value),filterable:"",radio:"","popper-class":ka.value,options:S.value},{default:r(({item:Le})=>[i(se,{modelValue:f.value,"onUpdate:modelValue":Q[1]||(Q[1]=la=>f.value=la)},{default:r(()=>[i(ae,{title:Le.label,label:Le.value},{default:r(()=>[z(b(Le.label),1)]),_:2},1032,["title","label"])]),_:2},1032,["modelValue"])]),_:1},8,["modelValue","placeholder","disabled","style","popper-class","options"])),[[qe,F.value]])}}});const Vt=Ua(iu,[["__scopeId","data-v-ee1234c9"]]),uu=Ke({__name:"Tree",props:{config:{type:Object,default:()=>({selectValue:"",defaultValue:"",queryConditionWidth:0,displayType:"",resultMode:0,defaultValueCheck:!1,multiple:!1,checkedFieldsMap:{},treeFieldList:[]})},isConfig:{type:Boolean,default:!1}},setup(L){ml(B=>({"3cf55b24":C.value,"7c53e975":T.value,"8cd70e70":ie.value}));const w=Ye("$custom-style-filter"),u=L,t=Ye("placeholder"),v=O(()=>{var B;return(B=t==null?void 0:t.value)!=null&&B.placeholderShow?["",void 0].includes(u.config.placeholder)?" ":u.config.placeholder:" "}),{config:d}=ia(u),f=Z(!1),F=Z(!1),x=B=>{ge.value=B,S()},S=()=>{f.value=!0;const B=Array.isArray(ge.value)?[...ge.value]:ge.value;if(!u.isConfig){d.value.selectValue=Array.isArray(ge.value)?[...ge.value]:ge.value,Me(()=>{f.value=!1,te(d.value.id)});return}d.value.defaultValue=B,f.value=!1},H=Z(!1);me(()=>d.value.id,()=>{H.value=!0,p(),Me(()=>{H.value=!1})});let ee;me(()=>d.value.treeFieldList,B=>{let pe=B.map(oe=>oe.id).join("-");H.value||pe===ee||(ee=pe,ge.value=d.value.multiple?[]:void 0,d.value.defaultValue=d.value.multiple?[]:void 0,d.value.selectValue=d.value.multiple?[]:void 0,g.value=!1,Re())});const p=()=>{e.value=!0;const{defaultValueCheck:B,multiple:pe,defaultValue:oe}=d.value;B?(d.value.selectValue=Array.isArray(oe)?we([...oe]):oe,ge.value=Array.isArray(oe)?we([...oe]):oe):(d.value.selectValue=pe?[]:void 0,ge.value=pe?[]:void 0),Me(()=>{var Ne;ee=(Ne=d.value.treeFieldList)==null?void 0:Ne.map(We=>We.id).join("-"),F.value=d.value.multiple}),Re()},T=O(()=>Math.min(W()/3,50)+"px"),C=O(()=>W()-40+"px"),ie=O(()=>Math.min(W()/3,50)-25+"px"),g=Z(!0),ne=Ye("com-width",Function,!0),te=Ye("is-confirm-search",Function,!0);me(()=>d.value.id,()=>{Re()}),Nl(()=>{setTimeout(()=>{p()},0)}),me(()=>d.value.defaultValue,B=>{u.isConfig||(d.value.multiple&&(ge.value=Array.isArray(B)?[...B]:B),Me(()=>{F.value=d.value.multiple}))}),me(()=>d.value.selectValue,B=>{u.isConfig||f.value||(d.value.multiple&&(ge.value=Array.isArray(B)?[...B]:B),Me(()=>{F.value=d.value.multiple,d.value.multiple||(ge.value=Array.isArray(d.value.selectValue)?[...d.value.selectValue]:d.value.selectValue)}))});const J=Z(!1);me(()=>d.value.multiple,B=>{!u.isConfig||H.value||(J.value=!1,B&&(ge.value=[]),Me(()=>{F.value=B,B||Me(()=>{ge.value=void 0}),Me(()=>{J.value=!0})}))});let I="",A=el([]);const Te=(B,pe)=>(pe.label??"").toLowerCase().includes((B??"").toLowerCase()),Ce=B=>(B||[]).map(pe=>{var Ne;let oe=[];return(Ne=pe.children)!=null&&Ne.length&&(oe=Ce(pe.children)),{...pe,value:pe.id,label:pe.text,children:oe}}),e=Z(!1),Re=mt(()=>{e.value=!0,fn({fieldIds:u.config.treeFieldList.map(B=>B.id),resultMode:d.value.resultMode||0}).then(B=>{A.value=Ce(B)}).finally(()=>{e.value=!1,J.value=!0})},300);me(()=>u.config.treeFieldList,B=>{if(!u.isConfig)return;const pe=B.map(oe=>oe.id).join("");I!==B.map(oe=>oe.id).join("")&&(I=pe,Re())});const De=Z(""),ge=Z(),W=()=>{var B;return(B=t==null?void 0:t.value)!=null&&B.placeholderShow?u.config.queryConditionWidth!==void 0?u.config.queryConditionWidth:ne():227},h=O(()=>u.isConfig?{}:{width:W()+"px"}),ye=O(()=>{if(!w||["#FFFFFF","rgba(255, 255, 255, 1)","rgb(255, 255, 255)"].includes(w.background))return"";if(w.background==="#131C42")return"rgb(38, 53, 82)";const B=w.background.startsWith("#")?w.background:bt(w.background);return Pa.mix(new ba("ffffff"),new ba(B.substr(1)),{value:20}).toRGB()});return(B,pe)=>{const oe=it,Ne=nt;return F.value&&!e.value?(s(),R(oe,{modelValue:ge.value,"onUpdate:modelValue":pe[0]||(pe[0]=We=>ge.value=We),data:a(A),clearable:"",onTreeSelectConfirm:x,"render-after-expand":!1,"show-checkbox":"",showBtn:"",onChange:S,placeholder:v.value,"collapse-tags":"","filter-node-method":Te,showWholePath:J.value,"collapse-tags-tooltip":"",tagColor:ye.value,key:"multipleTree"+W(),filterable:"",style:Ie(h.value),multiple:""},null,8,["modelValue","data","placeholder","showWholePath","tagColor","style"])):!F.value&&!e.value?(s(),R(oe,{modelValue:ge.value,"onUpdate:modelValue":pe[1]||(pe[1]=We=>ge.value=We),onChange:S,data:a(A),"check-strictly":"",clearable:"","filter-node-method":Te,placeholder:v.value,"render-after-expand":!1,key:"singleTree"+W(),showWholePath:J.value,style:Ie(h.value),filterable:""},null,8,["modelValue","data","placeholder","showWholePath","style"])):za((s(),R(oe,{modelValue:De.value,"onUpdate:modelValue":pe[2]||(pe[2]=We=>De.value=We),data:[],placeholder:v.value,"render-after-expand":!1,key:"fakeTree",style:Ie(h.value)},null,8,["modelValue","placeholder","style"])),[[Ne,e.value]])}}});const kt=Ua(uu,[["__scopeId","data-v-d3b0bef9"]]),ru={class:"label"},su={class:"condition-type"},ou={key:0,class:"condition-type"},du={class:"condition-type-tip"},cu={class:"label"},vu={class:"setting-content",style:{display:"flex","align-items":"center"}},mu={key:2,class:"list-item"},pu={class:"label"},fu={class:"value"},yu={key:3,class:"list-item"},_u={class:"label"},hu={class:"setting-content"},gu={key:0,class:"config-flag range-filter-time-flag"},bu={key:4,class:"list-item"},Vu={class:"label"},ku={key:5,class:"list-item"},Tu={class:"label"},Cu={key:0,class:"setting-content"},Mu={class:"setting"},Fu={class:"setting"},Su=["title"],wu={class:"setting-value select"},qu={key:0,class:"setting"},$u={class:"setting"},Au={class:"setting-label"},Iu={class:"setting-value select"},Du={class:"setting-label"},Nu={class:"setting-input with-date range"},Ou={class:"setting-label"},Eu={class:"setting-input with-date range"},Ru={key:0,class:"setting-label"},Lu={key:1,class:"first-item",style:{"margin-bottom":"8px"}},xu=Ke({__name:"ConditionDefaultConfiguration",props:{curComponent:{type:Object,required:!0},showPosition:{type:String,default:"main"}},emits:["handleTimeTypeChange"],setup(L,{expose:w,emit:u}){const{t}=_a(),v=Z(!1),d=()=>{v.value=!1},f=W=>{W.stopPropagation(),v.value=!v.value},F=O(()=>{const{displayType:W,timeType:h="fixed"}=p.value;return["1","7"].includes(W)?h==="dynamic"?W==="1"?Xi:eu:gt:W==="9"?kt:Vt}),x=u,S=W=>{W==="dynamic"&&x("handleTimeTypeChange")},H=L,ee=O(()=>H.showPosition==="main"),{curComponent:p}=ia(H),T=Z(!0);me(()=>p.value.id,W=>{W&&(T.value=!1,Me(()=>{T.value=!0}))},{immediate:!0});const C=O(()=>{if(!p.value)return[];let W=["year","month","date","datetime"].indexOf(p.value.timeGranularity)+1;return+p.value.displayType==7&&(W=["yearrange","monthrange","daterange","datetimerange"].indexOf(p.value.timeGranularityMultiple)+1),[{label:t("dynamic_time.year"),value:"year"},{label:t("dynamic_time.month"),value:"month"},{label:t("dynamic_time.date"),value:"date"}].slice(0,W)}),ie=O(()=>{let W=[];if(!p.value)return W;switch(p.value.timeGranularity){case"year":W=[{label:t("dynamic_year.current"),value:"thisYear"},{label:t("dynamic_year.last"),value:"lastYear"}];break;case"month":W=[{label:t("cron.this_month"),value:"thisMonth"},{label:t("dynamic_month.last"),value:"lastMonth"}];break;case"date":W=[{label:t("dynamic_time.today"),value:"today"},{label:t("dynamic_time.yesterday"),value:"yesterday"},{label:t("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:t("dynamic_time.endOfMonth"),value:"monthEnd"},{label:t("dynamic_time.firstOfYear"),value:"yearBeginning"}];break;case"datetime":W=[{label:t("dynamic_time.today"),value:"today"},{label:t("dynamic_time.yesterday"),value:"yesterday"},{label:t("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:t("dynamic_time.endOfMonth"),value:"monthEnd"},{label:t("dynamic_time.firstOfYear"),value:"yearBeginning"}];break}return[...W,{label:t("dynamic_time.custom"),value:"custom"}]}),g=O(()=>{let W=[];if(!p.value)return W;switch(p.value.timeGranularityMultiple){case"yearrange":W=[{label:t("dynamic_year.current"),value:"thisYear"},{label:t("dynamic_year.last"),value:"lastYear"}];break;case"monthrange":W=[{label:t("cron.this_month"),value:"thisMonth"},{label:t("dynamic_month.last"),value:"lastMonth"},{label:t("dynamic_time.tquarter"),value:"thisQuarter"},{label:t("v_query.last_3_months"),value:"LastThreeMonths"},{label:t("v_query.last_6_months"),value:"LastSixMonths"},{label:t("v_query.last_12_months"),value:"LastTwelveMonths"}];break;case"daterange":case"datetimerange":W=[{label:t("dynamic_time.today"),value:"today"},{label:t("dynamic_time.yesterday"),value:"yesterday"},{label:t("dynamic_time.cweek"),value:"thisWeek"},{label:t("v_query.last_3_days"),value:"LastThreeDays"},{label:t("v_query.month_to_date"),value:"monthBeginning"},{label:t("v_query.year_to_date"),value:"yearBeginning"}];break}return[...W,{label:t("dynamic_time.custom"),value:"custom"}]}),ne=O(()=>{const{displayType:W,optionValueSource:h,multiple:ye}=p.value;return+W==0&&h===1&&!ye}),te=[{label:t("dynamic_time.before"),value:"f"},{label:t("dynamic_time.after"),value:"b"}],J=O(()=>{const{displayType:W,timeType:h}=p.value;return h==="dynamic"&&[1,7].includes(+W)}),I=[{label:t("v_query.exact_match"),value:"eq"},{label:t("v_query.fuzzy_match"),value:"like"}],A=Z(!1),Te=(W,h=!1)=>{h&&(p.value.defaultValue=W?[]:void 0);const{defaultValue:ye}=p.value;if(Array.isArray(ye)?p.value.selectValue=W?ye:void 0:p.value.selectValue=W?ye!==void 0?[ye]:[]:ye,p.value.field.deType===1){p.value.multiple=W;return}p.value.multiple=W},Ce=W=>{A.value=W},e=Z();return w({multipleChange:Te,handleDialogClick:d,changeMultiple:Ce,displayTypeChange:()=>{var W,h;(h=(W=e.value)==null?void 0:W.displayTypeChange)==null||h.call(W)},mult:()=>{var W,h,ye;(ye=(h=(W=e.value)==null?void 0:W.mult)==null?void 0:h.handleClickOutside)==null||ye.call(h)},single:()=>{var W,h,ye;(ye=(h=(W=e.value)==null?void 0:W.single)==null?void 0:h.handleClickOutside)==null||ye.call(h)}}),(W,h)=>{const ye=xa,B=Il,pe=Al,oe=vl,Ne=Ja,We=Xa,He=La,oa=Za,da=ut,Va=Dl,Qe=Pt;return s(),k(X,null,[a(p).displayType==="8"?(s(),k("div",{key:0,class:"list-item top-item",onClick:h[4]||(h[4]=Be(()=>{},["stop"]))},[m("div",ru,b(a(t)("dynamic_time.set_default")),1),m("div",{class:be(["value",a(p).hideConditionSwitching&&"hide-condition_switching"])},[m("div",su,[a(p).hideConditionSwitching?G("",!0):(s(),R(a(Ue),{key:0,class:"condition-value-select","popper-class":"condition-value-select-popper",modelValue:a(p).defaultConditionValueOperatorF,"onUpdate:modelValue":h[0]||(h[0]=$=>a(p).defaultConditionValueOperatorF=$)},{default:r(()=>[(s(),k(X,null,ce(I,$=>i(ye,{key:$.value,label:$.label,value:$.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])),i(B,{class:"condition-value-input",modelValue:a(p).defaultConditionValueF,"onUpdate:modelValue":h[1]||(h[1]=$=>a(p).defaultConditionValueF=$)},null,8,["modelValue"]),h[31]||(h[31]=m("div",{class:"bottom-line"},null,-1))]),[1,2].includes(a(p).conditionType)?(s(),k("div",ou,[m("span",du,b(a(p).conditionType===1?a(t)("chart.and"):a(t)("chart.or")),1),a(p).hideConditionSwitching?G("",!0):(s(),R(a(Ue),{key:0,class:"condition-value-select","popper-class":"condition-value-select-popper",modelValue:a(p).defaultConditionValueOperatorS,"onUpdate:modelValue":h[2]||(h[2]=$=>a(p).defaultConditionValueOperatorS=$)},{default:r(()=>[(s(),k(X,null,ce(I,$=>i(ye,{key:$.value,label:$.label,value:$.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])),i(B,{class:"condition-value-input",modelValue:a(p).defaultConditionValueS,"onUpdate:modelValue":h[3]||(h[3]=$=>a(p).defaultConditionValueS=$)},null,8,["modelValue"]),h[32]||(h[32]=m("div",{class:"bottom-line next-line"},null,-1))])):G("",!0)],2)])):G("",!0),a(p).displayType==="22"?(s(),k("div",{key:1,class:"list-item top-item",onClick:h[8]||(h[8]=Be(()=>{},["stop"]))},[m("div",cu,[i(pe,{modelValue:a(p).defaultValueCheck,"onUpdate:modelValue":h[5]||(h[5]=$=>a(p).defaultValueCheck=$),label:a(t)("dynamic_time.set_default")},null,8,["modelValue","label"])]),m("div",vu,[i(oe,{disabled:!a(p).defaultValueCheck,placeholder:a(t)("system.the_minimum_value"),style:{width:"192.5px"},"controls-position":"right",modelValue:a(p).defaultNumValueStart,"onUpdate:modelValue":h[6]||(h[6]=$=>a(p).defaultNumValueStart=$)},null,8,["disabled","placeholder","modelValue"]),h[33]||(h[33]=m("div",{class:"num-value_line"},null,-1)),i(oe,{placeholder:a(t)("system.the_maximum_value"),style:{width:"192.5px"},"controls-position":"right",disabled:!a(p).defaultValueCheck,modelValue:a(p).defaultNumValueEnd,"onUpdate:modelValue":h[7]||(h[7]=$=>a(p).defaultNumValueEnd=$)},null,8,["placeholder","disabled","modelValue"])])])):G("",!0),!["1","7","8","22"].includes(a(p).displayType)&&ee.value?(s(),k("div",mu,[m("div",pu,b(a(t)("v_query.option_type")),1),m("div",fu,[i(We,{class:"larger-radio",onChange:h[9]||(h[9]=$=>Te($,!0)),modelValue:A.value,"onUpdate:modelValue":h[10]||(h[10]=$=>A.value=$)},{default:r(()=>[i(Ne,{label:!1},{default:r(()=>[z(b(a(t)("visualization.single_choice")),1)]),_:1}),i(Ne,{label:!0},{default:r(()=>[z(b(a(t)("visualization.multiple_choice")),1)]),_:1})]),_:1},8,["modelValue"])])])):G("",!0),["7","1"].includes(a(p).displayType)&&ee.value?(s(),k("div",yu,[m("div",_u,[i(pe,{modelValue:a(p).setTimeRange,"onUpdate:modelValue":h[11]||(h[11]=$=>a(p).setTimeRange=$),label:a(t)("v_query.time_filter_range")},null,8,["modelValue","label"])]),m("div",hu,[i(da,{"show-arrow":!1,"popper-class":"range-filter-time",placement:"bottom-start",width:452,visible:v.value,offset:4},{reference:r(()=>[i(oa,{disabled:!a(p).setTimeRange,onClick:h[12]||(h[12]=$=>f($)),text:"",style:{"margin-left":"-4px"}},{icon:r(()=>[i(He,{name:"icon_admin_outlined"},{default:r(()=>[i(a(qn),{class:"svg-icon"})]),_:1})]),default:r(()=>[z(" "+b(a(t)("dynamic_time.set")),1)]),_:1},8,["disabled"])]),default:r(()=>[a(p).displayType==="7"?(s(),R(wi,{key:0,timeRange:a(p).timeRange,timeGranularityMultiple:a(p).timeGranularityMultiple},null,8,["timeRange","timeGranularityMultiple"])):(s(),R(Ji,{key:1,timeRange:a(p).timeRange,timeGranularity:a(p).timeGranularity},null,8,["timeRange","timeGranularity"]))]),_:1},8,["visible"]),a(p).timeRange&&(a(p).timeRange.intervalType!=="none"||a(p).timeRange.dynamicWindow)?(s(),k("span",gu,b(a(t)("v_query.configured")),1)):G("",!0)])])):G("",!0),+a(p).displayType==0&&a(p).optionValueSource!==1&&ee.value?(s(),k("div",bu,[m("div",Vu,[i(Va,{effect:"dark",content:a(t)("v_query.is_not_supported"),disabled:!a(p).parametersCheck,placement:"top"},{default:r(()=>[i(pe,{disabled:a(p).parametersCheck,modelValue:a(p).showEmpty,"onUpdate:modelValue":h[13]||(h[13]=$=>a(p).showEmpty=$),label:a(t)("v_query.contains_empty_data")},null,8,["disabled","modelValue","label"])]),_:1},8,["content","disabled"])])])):G("",!0),["8","22"].includes(a(p).displayType)?G("",!0):(s(),k("div",ku,[m("div",Tu,[i(pe,{modelValue:a(p).defaultValueCheck,"onUpdate:modelValue":h[14]||(h[14]=$=>a(p).defaultValueCheck=$),label:a(t)("dynamic_time.set_default")},null,8,["modelValue","label"])]),a(p).defaultValueCheck&&["1","7"].includes(a(p).displayType)?(s(),k("div",Cu,[m("div",Mu,[i(We,{onChange:S,modelValue:a(p).timeType,"onUpdate:modelValue":h[15]||(h[15]=$=>a(p).timeType=$)},{default:r(()=>[i(Ne,{label:"fixed"},{default:r(()=>[z(b(a(t)("dynamic_time.fix")),1)]),_:1}),i(Ne,{label:"dynamic"},{default:r(()=>[z(b(a(t)("dynamic_time.dynamic")),1)]),_:1})]),_:1},8,["modelValue"])]),J.value&&a(p).displayType==="1"?(s(),k(X,{key:0},[m("div",Fu,[m("div",{title:a(t)("dynamic_time.relative"),class:"setting-label ellipsis"},b(a(t)("dynamic_time.relative")),9,Su),m("div",wu,[i(a(Ue),{onFocus:d,modelValue:a(p).relativeToCurrent,"onUpdate:modelValue":h[16]||(h[16]=$=>a(p).relativeToCurrent=$)},{default:r(()=>[(s(!0),k(X,null,ce(ie.value,$=>(s(),R(ye,{key:$.value,label:$.label,value:$.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),a(p).relativeToCurrent==="custom"?(s(),k("div",qu,[m("div",{class:be(["setting-input",a(p).timeGranularity==="datetime"&&"with-date"])},[i(oe,{"step-strictly":"",modelValue:a(p).timeNum,"onUpdate:modelValue":h[17]||(h[17]=$=>a(p).timeNum=$),min:0,"controls-position":"right"},null,8,["modelValue"]),i(a(Ue),{onFocus:d,modelValue:a(p).relativeToCurrentType,"onUpdate:modelValue":h[18]||(h[18]=$=>a(p).relativeToCurrentType=$)},{default:r(()=>[(s(!0),k(X,null,ce(C.value,$=>(s(),R(ye,{key:$.value,label:$.label,value:$.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i(a(Ue),{onFocus:d,modelValue:a(p).around,"onUpdate:modelValue":h[19]||(h[19]=$=>a(p).around=$)},{default:r(()=>[(s(),k(X,null,ce(te,$=>i(ye,{key:$.value,label:$.label,value:$.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),a(p).timeGranularity==="datetime"?(s(),R(Qe,{key:0,modelValue:a(p).arbitraryTime,"onUpdate:modelValue":h[20]||(h[20]=$=>a(p).arbitraryTime=$)},null,8,["modelValue"])):G("",!0)],2)])):G("",!0)],64)):J.value&&a(p).displayType==="7"?(s(),k(X,{key:1},[m("div",$u,[m("div",Au,b(a(t)("dynamic_time.relative")),1),m("div",Iu,[i(a(Ue),{onFocus:d,modelValue:a(p).relativeToCurrentRange,"onUpdate:modelValue":h[21]||(h[21]=$=>a(p).relativeToCurrentRange=$)},{default:r(()=>[(s(!0),k(X,null,ce(g.value,$=>(s(),R(ye,{key:$.value,label:$.label,value:$.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),a(p).relativeToCurrentRange==="custom"?(s(),k("div",{key:0,class:be(["setting",["yearrange","monthrange","daterange"].includes(a(p).timeGranularityMultiple)&&"is-year-month-range"])},[m("div",Du,b(a(t)("datasource.start_time")),1),m("div",Nu,[i(oe,{"step-strictly":"",modelValue:a(p).timeNum,"onUpdate:modelValue":h[22]||(h[22]=$=>a(p).timeNum=$),min:0,"controls-position":"right"},null,8,["modelValue"]),i(a(Ue),{onFocus:d,modelValue:a(p).relativeToCurrentType,"onUpdate:modelValue":h[23]||(h[23]=$=>a(p).relativeToCurrentType=$)},{default:r(()=>[(s(!0),k(X,null,ce(C.value,$=>(s(),R(ye,{key:$.value,label:$.label,value:$.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i(a(Ue),{onFocus:d,modelValue:a(p).around,"onUpdate:modelValue":h[24]||(h[24]=$=>a(p).around=$)},{default:r(()=>[(s(),k(X,null,ce(te,$=>i(ye,{key:$.value,label:$.label,value:$.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),i(Qe,{modelValue:a(p).arbitraryTime,"onUpdate:modelValue":h[25]||(h[25]=$=>a(p).arbitraryTime=$)},null,8,["modelValue"])])],2)):G("",!0),a(p).relativeToCurrentRange==="custom"?(s(),k("div",{key:1,class:be(["setting",["yearrange","monthrange","daterange"].includes(a(p).timeGranularityMultiple)&&"is-year-month-range"])},[m("div",Ou,b(a(t)("datasource.end_time")),1),m("div",Eu,[i(oe,{modelValue:a(p).timeNumRange,"onUpdate:modelValue":h[26]||(h[26]=$=>a(p).timeNumRange=$),min:0,"step-strictly":"","controls-position":"right"},null,8,["modelValue"]),i(a(Ue),{onFocus:d,modelValue:a(p).relativeToCurrentTypeRange,"onUpdate:modelValue":h[27]||(h[27]=$=>a(p).relativeToCurrentTypeRange=$)},{default:r(()=>[(s(!0),k(X,null,ce(C.value,$=>(s(),R(ye,{key:$.value,label:$.label,value:$.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),i(a(Ue),{onFocus:d,modelValue:a(p).aroundRange,"onUpdate:modelValue":h[28]||(h[28]=$=>a(p).aroundRange=$)},{default:r(()=>[(s(),k(X,null,ce(te,$=>i(ye,{key:$.value,label:$.label,value:$.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),i(Qe,{modelValue:a(p).arbitraryTimeRange,"onUpdate:modelValue":h[29]||(h[29]=$=>a(p).arbitraryTimeRange=$)},null,8,["modelValue"])])],2)):G("",!0)],64)):G("",!0)])):G("",!0),a(p).defaultValueCheck&&T.value?(s(),k("div",{key:1,class:be(["parameters",J.value&&"setting"])},[J.value?(s(),k("div",Ru,b(a(t)("template_manage.preview")),1)):G("",!0),ne.value?(s(),k("div",Lu,[i(pe,{modelValue:a(p).defaultValueFirstItem,"onUpdate:modelValue":h[30]||(h[30]=$=>a(p).defaultValueFirstItem=$)},{default:r(()=>[z(b(W.$t("common.first_item")),1)]),_:1},8,["modelValue"])])):G("",!0),m("div",{class:be(J.value?"setting-value":"w100")},[(s(),R(ze(F.value),{config:a(p),isConfig:"",ref_key:"inputCom",ref:e},null,8,["config"]))],2)],2)):G("",!0)]))],64)}}});const Uu=Ua(xu,[["__scopeId","data-v-889e0362"]]),Yu={class:"query-condition-list"},Gu={class:"title"},Bu=["onDblclick","onClick"],Wu=["title"],ju={class:"condition-icon flex-align-center"},Pu=["onClick"],zu={key:0,class:"mask"},Hu={class:"title flex-align-center"},Qu={class:"flex-align-center"},Zu={class:"select-all"},Ku={class:"field-list"},Ju=["title"],Xu=["title"],er={class:"flex-align-center icon"},ar=["title"],lr=["onClick"],tr={class:"flex-align-center icon"},nr=["title"],ir=["onClick"],ur=["title"],rr=["title"],sr=["onClick"],or={key:3,style:{width:"172px","margin-left":"12px"}},dr={key:0,class:"mask condition"},cr={class:"title flex-align-center"},vr={class:"configuration-list"},mr={class:"list-item"},pr={class:"label"},fr={class:"value"},yr={key:0,class:"list-item"},_r=["title"],hr={class:"value"},gr={key:1,class:"list-item"},br=["title"],Vr={class:"value"},kr={class:"content"},Tr=["title"],Cr={key:2,class:"list-item"},Mr={class:"label",style:{width:"135px",height:"26px","line-height":"26px"}},Fr={class:"search-tree"},Sr={class:"level-index"},wr={class:"field-type"},qr=["title"],$r={key:0,class:"field-relationship_chart"},Ar={key:1,class:"field-relationship_chart"},Ir={key:3,class:"list-item"},Dr=["title"],Nr={class:"value"},Or={key:4,class:"list-item top-item"},Er=["title"],Rr={class:"value"},Lr={class:"value"},xr={class:"value"},Ur={class:"content"},Yr=["title"],Gr={style:{display:"flex","align-items":"center"},class:"value ellipsis"},Br=["title"],Wr=["title"],jr={style:{display:"flex","align-items":"center"},class:"value"},Pr=["title"],zr=["title"],Hr={class:"value"},Qr={class:"label"},Zr=["title"],Kr={key:1,class:"value flex-align-center"},Jr={class:"manual-input-container"},Xr={class:"title"},es={class:"select-value"},as={class:"add-btn"},ls={class:"manual-footer flex-align-center"},ts={key:0,class:"config-flag flex-align-center"},ns=["title"],is={class:"value",style:{"margin-top":"10.5px"}},us={key:5,class:"list-item top-item"},rs=["title"],ss={class:"value"},os={class:"value"},ds={key:6,style:{"margin-bottom":"10.5px"}},cs={key:1,class:"empty"},vs={key:2,class:"empty"},ms={key:3,class:"empty"},ps={class:"dialog-footer"},fs=Ke({__name:"QueryConditionConfiguration",props:{queryElement:{type:Object,default(){return{id:null,propValue:[]}}}},emits:["queryData","reRenderAll"],setup(L,{expose:w,emit:u}){const{t}=_a(),{wsCache:v}=tn(),d=al(),{componentData:f,canvasViewInfo:F}=pl(d),x=Z(null),S=L,H=Z(!1),ee=Z([]),p=Z([]),T=Z([]),C=Z(!1),ie=st({id:"",name:"",visible:!1}),g={},ne=dt(),te=()=>{let l=f.value.filter(n=>!["VQuery","DeTabs"].includes(n.innerType)&&n.component!=="Group");return f.value.forEach(n=>{n.innerType==="DeTabs"?n.propValue.forEach(o=>{l=[...l,...o.componentData.filter(y=>!["VQuery","DeTabs"].includes(y.innerType)&&y.component!=="Group")],o.componentData.forEach(y=>{y.component==="Group"&&(l=[...l,y.propValue.filter(N=>!["VQuery","DeTabs"].includes(N.innerType)&&N.component!=="Group")])})}):n.component==="Group"&&(l=[...l,n.propValue.filter(o=>!["VQuery","DeTabs"].includes(o.innerType)&&o.component!=="Group")],n.propValue.forEach(o=>{o.innerType==="DeTabs"&&o.propValue.forEach(y=>{l=[...l,...y.componentData.filter(N=>!["VQuery","DeTabs"].includes(N.innerType)&&N.component!=="Group")]})}))}),l.flat()},J=O(()=>te().map(l=>{const n=F.value[l.id];if(!n)return null;const{id:o,title:y,tableId:N,type:q}=n;return o&&N?{id:o,type:q,title:y,tableId:N}:null}).filter(l=>!!l)),I=l=>{T.value.forEach(n=>{n.optionValueSource===1&&[0,2,5].includes(+n.displayType)&&l.includes(n.id)&&(n.selectValue=Array.isArray(n.selectValue)?[]:void 0,n.defaultValue=Array.isArray(n.defaultValue)?[]:void 0,n.mapValue=Array.isArray(n.mapValue)?[]:void 0,n.defaultMapValue=Array.isArray(n.defaultMapValue)?[]:void 0)})};let A=[];const Te=l=>{A=l},Ce=()=>A;ga("set-cascade-default",I),ga("cascade-list",Ce);const e=Z(),Re=Z(),De=Z(""),ge=Z(!1),W=el([]),h=Z(),{queryElement:ye}=ia(S),B=(l,n)=>{var o;return(o=n.flat().find(y=>y.id===l))==null?void 0:o.deType},pe=O(()=>{var l;return!e.value||!((l=e.value.checkedFields)!=null&&l.length)?!1:e.value.checkedFields.some(n=>!!e.value.checkedFieldsMap[n])}),oe=O(()=>{var y,N;if(!e.value||!((y=e.value.checkedFields)!=null&&y.length)||!((N=h.value)!=null&&N.length))return!1;if(e.value.parameters.length&&V.value){const q=e.value.parameters.map(ve=>ve.type[1]),[U]=q;if(q.some(ve=>ve!==U))return!0}let l=null,n=0,o=e.value.checkedFields.every(q=>{var U,ve;return(ve=(U=e.value.checkedFieldsMapArrNum)==null?void 0:U[q])==null?void 0:ve.length})&&["22"].includes(e.value.displayType);return e.value.checkedFields.some(q=>{var de,xe,Oe,Fe,_e,ra,Xe,Pe,Se;if(o)return!1;if((xe=(de=e.value.checkedFieldsMapArrNum)==null?void 0:de[q])!=null&&xe.length&&["22","2"].includes(e.value.displayType)&&(n===0&&(n=1),n===2)||!((Fe=(Oe=e.value.checkedFieldsMapArrNum)==null?void 0:Oe[q])!=null&&Fe.length)&&["22","2"].includes(e.value.displayType)&&e.value.parameters.some(aa=>[2,3].includes(aa.deType))&&e.value.checkedFieldsMap[q]&&(n===0&&(n=2),n===1))return!0;const U=h.value.find(aa=>aa.componentId===q),ve=(_e=e.value.checkedFieldsMap)==null?void 0:_e[q],K=se(Object.values((U==null?void 0:U.fields)||{}).flat()).find(aa=>ve===aa.id);if(!K)return!1;if(l===null)return l=K,!1;if((l==null?void 0:l.deType)===(K==null?void 0:K.deType)&&(l==null?void 0:l.deType)===1){if(!Array.isArray(K.type)||!Array.isArray(l.type)||!((ra=l.type)!=null&&ra.length)&&!((Xe=K.type)!=null&&Xe.length))return!1;if(((Pe=l.type)==null?void 0:Pe.length)!==((Se=K.type)==null?void 0:Se.length))return!0}return[2,3].includes(K==null?void 0:K.deType)&&[2,3].includes(l.deType)?!1:l.deType!==(K==null?void 0:K.deType)})}),Ne=[{label:t("data_fill.rename"),command:"rename"},{label:t("data_fill.delete"),command:"del"}],We=l=>{e.value.checkedFields=l?h.value.map(n=>n.componentId):[],ge.value=!1,l&&oa()},He=l=>{ta();const n=l.length;C.value=n===h.value.length,ge.value=n>0&&n<h.value.length,e.value.displayType!=="8"&&Le()},oa=()=>{const l={};Object.keys(e.value.checkedFieldsMap).forEach(n=>{e.value.checkedFieldsMap[n]&&h.value.forEach(o=>{var y;o.componentId===n&&((y=e.value.checkedFields)!=null&&y.includes(o.componentId))&&(l[o.id]=e.value.checkedFieldsMap[o.componentId],l[`active-${o.id}`]=o.activelist)})}),Object.keys(e.value.checkedFieldsMap).forEach(n=>{e.value.checkedFieldsMap[n]||h.value.forEach(o=>{var y;o.componentId===n&&((y=e.value.checkedFields)!=null&&y.includes(o.componentId))&&l[o.id]&&(e.value.checkedFieldsMap[o.componentId]=l[o.id],o.activelist=l[`active-${o.id}`])})})},da=l=>{ta();const n=l.length;C.value=n===h.value.length,ge.value=n>0&&n<h.value.length,oa(),e.value.displayType!=="8"&&(ca(),Tl(),Le())},Va=l=>{let n=!1;return!_.value&&V.value&&ue.value.length&&l.deType!==1&&(n=!0),n},Qe=(l,n)=>{var N,q;(q=(N=e.value.checkedFieldsMapArr)==null?void 0:N[n])!=null&&q.length&&(e.value.checkedFieldsMapArr[n]=[],e.value.checkedFieldsMapEnd[n]="",e.value.checkedFieldsMapStart[n]="");const o=e.value.checkedFieldsMapStartNum[n],y=e.value.checkedFieldsMapEndNum[n];o&&(e.value.checkedFieldsMapEndNum[n]=l.find(U=>U!==o)),y&&(e.value.checkedFieldsMapStartNum[n]=l.find(U=>U!==y)),l.length||(e.value.checkedFieldsMap[n]="",e.value.checkedFieldsMapEndNum[n]="",e.value.checkedFieldsMapStartNum[n]="",e.value.parametersArr[n]=[]),e.value.checkedFieldsMapArrNum[n].length&&E(n),va()},$=(l,n)=>{var N,q;(q=(N=e.value.checkedFieldsMapArrNum)==null?void 0:N[n])!=null&&q.length&&(e.value.checkedFieldsMapArrNum[n]=[],e.value.checkedFieldsMapEndNum[n]="",e.value.checkedFieldsMapStartNum[n]="");const o=e.value.checkedFieldsMapStart[n],y=e.value.checkedFieldsMapEnd[n];o&&(e.value.checkedFieldsMapEnd[n]=l.find(U=>U!==o)),y&&(e.value.checkedFieldsMapStart[n]=l.find(U=>U!==y)),l.length||(e.value.checkedFieldsMap[n]="",e.value.checkedFieldsMapEnd[n]="",e.value.checkedFieldsMapStart[n]="",e.value.displayType="1",e.value.parametersArr[n]=[],e.value.timeGranularity="",e.value.timeGranularityMultiple=""),e.value.checkedFieldsMapArr[n].length&&Q(n),va()};let M="",Y="";const fe=Z(!1),Ve=Z(0),ma=Z(""),ua=Z(!1),ea=Z(0),pa=Z(""),ka=()=>{e.value.checkedFieldsMapArr[M]||(e.value.checkedFieldsMapArr[M]=[]),Ve.value===0&&(e.value.checkedFieldsMap[M]=Y,e.value.checkedFieldsMapArr[M]=[],e.value.checkedFieldsMapStart[M]="",e.value.checkedFieldsMapEnd[M]=""),Ve.value===1&&(e.value.checkedFieldsMapStart[M]=Y,e.value.checkedFieldsMapArr[M]=[...new Set([...e.value.checkedFieldsMapArr[M],Y])],e.value.checkedFieldsMapArr[M].length===1?e.value.checkedFieldsMapEnd[M]="":e.value.checkedFieldsMapEnd[M]=e.value.checkedFieldsMapArr[M].length===2?e.value.checkedFieldsMapArr[M].find(l=>l!==Y):Y),Ve.value===2&&(e.value.checkedFieldsMapArr[M]=[...new Set([...e.value.checkedFieldsMapArr[M],Y])],e.value.checkedFieldsMapEnd[M]=Y,e.value.checkedFieldsMapArr[M].length===1?e.value.checkedFieldsMapStart[M]="":e.value.checkedFieldsMapStart[M]=e.value.checkedFieldsMapArr[M].length===2?e.value.checkedFieldsMapArr[M].find(l=>l!==Y):Y),e.value.displayType=e.value.checkedFieldsMapArr[M].length?"7":"1",Q(M),va(),fe.value=!1},ca=()=>{if(!(e.value.displayType!=="9"||Je.value!==0)&&e.value.checkedFields.length){let l="";h.value.forEach(n=>{var o;e.value.checkedFields.includes(n.componentId)&&e.value.checkedFieldsMap[n.componentId]&&!l&&(l=(o=J.value.find(y=>y.id===n.componentId))==null?void 0:o.tableId)}),l&&!e.value.treeDatasetId&&(e.value.treeDatasetId=l,Wa(e.value.treeDatasetId,e.value))}},wa=l=>{if(l.checkedFields.length){let n="";h.value.forEach(o=>{var y;o.checkedFields.includes(o.componentId)&&o.checkedFieldsMap[o.componentId]&&!n&&(n=(y=J.value.find(N=>N.id===o.componentId))==null?void 0:y.tableId)}),n&&!l.treeDatasetId&&(l.treeDatasetId=n)}},ha=()=>{e.value.checkedFieldsMapArrNum[M]||(e.value.checkedFieldsMapArrNum[M]=[]),ea.value===0&&(e.value.checkedFieldsMap[M]=Y,e.value.checkedFieldsMapArrNum[M]=[],e.value.checkedFieldsMapStartNum[M]="",e.value.checkedFieldsMapEndNum[M]=""),ea.value===1&&(e.value.checkedFieldsMapStartNum[M]=Y,e.value.checkedFieldsMapArrNum[M]=[...new Set([...e.value.checkedFieldsMapArrNum[M],Y])],e.value.checkedFieldsMapArrNum[M].length===1?e.value.checkedFieldsMapEndNum[M]="":e.value.checkedFieldsMapEndNum[M]=e.value.checkedFieldsMapArrNum[M].length===2?e.value.checkedFieldsMapArrNum[M].find(l=>l!==Y):Y),ea.value===2&&(e.value.checkedFieldsMapArrNum[M]=[...new Set([...e.value.checkedFieldsMapArrNum[M],Y])],e.value.checkedFieldsMapEndNum[M]=Y,e.value.checkedFieldsMapArrNum[M].length===1?e.value.checkedFieldsMapStartNum[M]="":e.value.checkedFieldsMapStartNum[M]=e.value.checkedFieldsMapArrNum[M].length===2?e.value.checkedFieldsMapArrNum[M].find(l=>l!==Y):Y),e.value.displayType=e.value.checkedFieldsMapArrNum[M].length?"22":"2",E(M),va(),ua.value=!1},E=l=>{e.value.parametersArr[l]=se(a(h).filter(n=>n.componentId===l).map(n=>Object.values((n==null?void 0:n.fields)||{}).flat()).flat().filter(n=>[e.value.checkedFieldsMapEndNum[l],e.value.checkedFieldsMapStartNum[l]].filter(o=>!!o).includes(n.id)&&!!n.variableName))},Q=l=>{if(e.value.parametersArr[l]=se(a(h).filter(y=>y.componentId===l).map(y=>Object.values((y==null?void 0:y.fields)||{}).flat()).flat().filter(y=>[e.value.checkedFieldsMapEnd[l],e.value.checkedFieldsMapStart[l]].filter(N=>!!N).includes(y.id)&&!!y.variableName)),!e.value.parametersArr[l].length)return;const[n,o]=e.value.parametersArr[l][0].type;e.value.timeGranularityMultiple=je[o||n]?`${je[o||n]}range`:"",e.value.timeGranularity=je[o||n]},j=(l,n)=>{ea.value=n.id===e.value.checkedFieldsMapStartNum[l]?1:n.id===e.value.checkedFieldsMapEndNum[l]?2:0,M=l,Y=n.id,pa.value=n.variableName,ua.value=!0},ae=(l,n)=>{Ve.value=n.id===e.value.checkedFieldsMapStart[l]?1:n.id===e.value.checkedFieldsMapEnd[l]?2:0,M=l,Y=n.id,ma.value=n.variableName,fe.value=!0},se=l=>{const n=[];let o=l.map(y=>y.id);for(let y=0;y<l.length;y++){const N=l[y];o.includes(N.id)&&(n.push(N),o=o.filter(q=>q!==N.id))}return n},qe=l=>{const n=Object.values(e.value.checkedFieldsMap).filter(y=>!!y);e.value.parameters=se(Object.values((l==null?void 0:l.fields)||{}).flat().filter(y=>n.includes(y.id)&&!!y.variableName).concat(e.value.parameters.filter(y=>n.includes(y.id)))),h.value.forEach(y=>{var N;y.id===l.id&&((N=e.value.checkedFields)!=null&&N.includes(y.componentId))&&!e.value.checkedFieldsMap[y.componentId]&&(y.activelist=l.activelist,e.value.checkedFieldsMap[y.componentId]=e.value.checkedFieldsMap[l.componentId])});const o=e.value.checkedFields.some(y=>e.value.checkedFieldsMapStart[y]||e.value.checkedFieldsMapEnd[y])&&+e.value.displayType==7;Me(()=>{if(V.value&&!o){const y=e.value.parameters.find(N=>N.deType===1);e.value.timeGranularity=je[y.type[1]||y.type[0]],e.value.displayType="1"}if(e.value.parameters.length&&(e.value.conditionType=0,e.value.optionValueSource===0&&(e.value.optionValueSource=1)),e.value.displayType==="22"){const y=e.value.checkedFields.some(q=>{var U;return(U=e.value.parameters)==null?void 0:U.some(ve=>[2,3].includes(ve.deType)&&e.value.checkedFieldsMap[q]===ve.id)});e.value.checkedFields.every(q=>{var U,ve;return!((ve=(U=e.value.checkedFieldsMapArr)==null?void 0:U[q])!=null&&ve.length)})&&y&&(e.value.displayType="2")}va()}),!o&&(Le(),ca(),Tl())},Le=()=>{var l,n;if((l=e.value.checkedFields)!=null&&l.length){const[o]=e.value.checkedFields,y=h.value.find(U=>U.componentId===o),N=(n=e.value.checkedFieldsMap)==null?void 0:n[o],q=Object.values((y==null?void 0:y.fields)||{}).flat().find(U=>N===U.id);if((q==null?void 0:q.deType)!==void 0){let U=e.value.displayType;if(["22"].includes(e.value.displayType)&&[2,3].includes(q==null?void 0:q.deType)||["9"].includes(e.value.displayType))return;(q==null?void 0:q.deType)===1&&e.value.displayType==="7"||(e.value.displayType=`${[3,4].includes(q==null?void 0:q.deType)?2:q==null?void 0:q.deType}`),(q==null?void 0:q.deType)===7&&(e.value.displayType="0"),+U!=+e.value.displayType&&!([3,4].includes(+U)&&+e.value.displayType==2)&&va()}}e.value.checkedFields.some(o=>e.value.checkedFieldsMapStart[o]||e.value.checkedFieldsMapEnd[o])&&+e.value.displayType==1&&(e.value.displayType="7")};let la;const qa=()=>{let l=e.value.displayType;la==="9"&&["0","8"].includes(l)?(e.value.displayType="9",Kl.confirm(t("common.changing_the_display"),{confirmButtonType:"primary",type:"warning",cancelButtonText:t("common.cancel"),autofocus:!1,showClose:!1}).then(()=>{e.value.displayType=l,va()})):va()},va=()=>{ta(),Me(()=>{var l,n,o;e.value.field.id="",(n=(l=x.value)==null?void 0:l.displayTypeChange)==null||n.call(l),+e.value.displayType==7&&["yearrange","monthrange","daterange","datetimerange"].includes(e.value.timeGranularity)&&(e.value.timeGranularityMultiple=e.value.timeGranularity),ca(),Tl(),e.value.displayType==="0"&&((o=e.value.treeFieldList)!=null&&o.length)&&(e.value.treeFieldList=[],e.value.treeCheckedList=[]),la=e.value.displayType})},V=O(()=>e.value.checkedFields.some(l=>{var n;return(n=e.value.parameters)==null?void 0:n.some(o=>o.deType===1&&!!o.variableName&&e.value.checkedFieldsMap[l]===o.id)})),_=O(()=>{var l;return(l=e.value.parameters)==null?void 0:l.some(n=>[2,3].includes(n.deType)&&!!n.variableName)}),le=O(()=>e.value.checkedFields.some(l=>{var n;return((n=e.value.checkedFieldsMapArrNum[l])==null?void 0:n.length)>0})),re=O(()=>e.value.checkedFields.every(l=>{var n,o;return((o=(n=e.value.checkedFieldsMapArrNum)==null?void 0:n[l])==null?void 0:o.length)>0})?!1:e.value.checkedFields.some(l=>{var n;return(n=e.value.parameters)==null?void 0:n.some(o=>[2,3].includes(o.deType)&&e.value.checkedFieldsMap[l]===o.id)})),P=O(()=>e.value.checkedFields.some(l=>{var n;return((n=e.value.checkedFieldsMapArr[l])==null?void 0:n.length)>0})),ue=O(()=>{const l=a(h).map(y=>Object.values((y==null?void 0:y.fields)||{}).flat()).flat(),n=Object.values(e.value.checkedFieldsMapArr||{}).flat(),o=l.find(y=>y.id===n[0]);return(o==null?void 0:o.type)||[]}),Ae=[{label:t("dynamic_time.year"),value:"year"},{label:t("chart.y_M"),value:"month"},{label:t("chart.y_M_d"),value:"date"},{label:t("chart.y_M_d_H_m_s"),value:"datetime"}],je={"DATETIME-YEAR":"year","YYYY-MM":"month","YYYY/MM":"month","YYYY-MM-DD":"date","YYYY/MM/DD":"date","YYYY-MM-DD HH:mm:ss":"datetime","YYYY/MM/DD HH:mm:ss":"datetime"},Ta=O(()=>{var y;if(!V.value)return Ae;const[l,n]=(y=e.value.parameters)==null?void 0:y.filter(N=>N.deType===1&&!!N.variableName)[0].type;let o=!1;return Ae.reduce((N,q)=>(q.value===(je[n]||je[l])?(o=!0,N.push(q)):o||N.push(q),N),[])}),$a=()=>{ta(),H.value=!1},Ya=()=>{hn({}).then(l=>{var o;const n=l||[];((o=n[0])==null?void 0:o.id)==="0"?ll(Ml(n[0].children)):ll(Ml(n))})},ll=l=>{const n=v.get(nn("TreeSort-dataset"))||"time_desc";W.value=Nn(l,n)};let Oa="",Aa="";const yl=l=>{var y,N,q;if(!((y=e.value.dataset)!=null&&y.id))return;let n=`${(N=e.value.dataset)==null?void 0:N.id}--${e.value.id}`,o=!1;for(let U in A){const[ve,K]=A[U];(ve!=null&&ve.datasetId.includes(n)||K!=null&&K.datasetId.includes(n))&&(o=!0)}o&&(Aa=(q=e.value.dataset)==null?void 0:q.id,Oa=l.id)},_l=()=>{e.value.dataset.id=Oa,Ia(`${Aa}--${e.value.id}`),Oa="",Aa="",tl()},tl=()=>{if(Oa&&Aa){e.value.dataset.id=Aa,Kl.confirm(t("v_query.to_modify_it"),{confirmButtonType:"primary",type:"warning",confirmButtonText:t("commons.confirm"),cancelButtonText:t("commons.cancel"),autofocus:!1,showClose:!1}).then(()=>{_l()});return}e.value.field.id="",e.value.displayId="",e.value.sortId="",Wa(e.value.dataset.id,e.value)},hl=()=>{e.value.treeFieldList=[],e.value.treeCheckedList=[],Je.value=0,e.value.oldTreeLoad=!0,Wa(e.value.treeDatasetId,e.value)},Ga=()=>{e.value.defaultValueCheck&&(e.value.defaultValue=e.value.multiple?[]:void 0,e.value.displayId||(e.value.displayId=e.value.field.id))},nl=()=>{if(e.value.defaultValue=e.value.multiple?[]:void 0,Ba(e.value.multiple),e.value.optionValueSource===1&&!e.value.dataset.id){let l="",n="";Object.keys(e.value.checkedFieldsMap).forEach(o=>{e.value.checkedFieldsMap[o]&&(n=o,l=e.value.checkedFieldsMap[o])}),h.value.forEach(o=>{o.componentId===n&&(e.value.dataset.id=o.id)}),e.value.displayId=l,e.value.sortId=l,e.value.field.id=l,Wa(e.value.dataset.id,e.value)}},Ba=(l,n=!1)=>{n&&(e.value.defaultValue=l?[]:void 0);const{defaultValue:o}=e.value;Array.isArray(o)?e.value.selectValue=l?o:void 0:e.value.selectValue=l?o!==void 0?[o]:[]:o,e.value.multiple=l},gl=(l,n,o)=>{const{intervalType:y,regularOrTrends:N,regularOrTrendsValue:q,relativeToCurrent:U,timeNum:ve,relativeToCurrentType:K,around:de,dynamicWindow:xe,maximumSingleQuery:Oe,timeNumRange:Fe,relativeToCurrentRange:_e,relativeToCurrentTypeRange:ra,aroundRange:Xe}=l.timeRange||{};let Pe=!1;const Se=l.timeGranularityMultiple.split("time").join("").split("range")[0],aa=Se==="date"?"day":Se;if(n&&xe&&(Pe=he(n).add(Oe,aa).startOf(aa).valueOf()-1e3<o),y==="none")return xe?Pe:!1;let Ee;if(U==="custom")Ee=ya(K,de==="f"?"subtract":"add",ve);else switch(U){case"thisYear":Ee=Ze("year");break;case"lastYear":Ee=Fa("year");break;case"thisMonth":Ee=Ze("month");break;case"lastMonth":Ee=Fa("month");break;case"thisQuarter":Ee=Ze("quarter");break;case"thisWeek":Ee=new Date(he().startOf("week").add(1,"day").startOf("day").format("YYYY/MM/DD HH:mm:ss"));break;case"today":Ee=Ze("day");break;case"yesterday":Ee=Fa("day");break;case"monthBeginning":Ee=Ze("month");break;case"monthEnd":Ee=El("month");break;case"yearBeginning":Ee=Ze("year");break}const fa=N==="fixed"?q:Ee;if(y==="start")return n<+new Date(fa)||Pe;if(y==="end")return o>+new Date(fa)||Pe;if(y==="timeInterval"){let na;return _e==="custom"?(Ee=N==="fixed"?new Date(he(new Date(q[0])).startOf(Se).format("YYYY/MM/DD HH:mm:ss")):ya(K,de==="f"?"subtract":"add",ve),na=N==="fixed"?new Date(he(new Date(q[1])).endOf(Se).format("YYYY/MM/DD HH:mm:ss")):ya(ra,Xe==="f"?"subtract":"add",Fe)):[Ee,na]=Qa(_e),n<+new Date(Ee)-1e3||o>+new Date(na)||Pe}},bl=en(()=>rn(()=>import("./QueryCascade-0.0.0-dataease.js"),["./QueryCascade-0.0.0-dataease.js","./element-plus-secondary-0.0.0-dataease.js","./@vue-0.0.0-dataease.js","./@vueuse-0.0.0-dataease.js","./@element-plus-0.0.0-dataease.js","./lodash-es-0.0.0-dataease.js","./dayjs-0.0.0-dataease.js","./@amap-0.0.0-dataease.js","./@popperjs-0.0.0-dataease.js","./async-validator-0.0.0-dataease.js","./@ctrl-0.0.0-dataease.js","./normalize-wheel-es-0.0.0-dataease.js","./memoize-one-0.0.0-dataease.js","../css/element-plus-secondary-0.0.0-dataease.css","./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js","./pinia-0.0.0-dataease.js","./vue-demi-0.0.0-dataease.js","./index-0.0.0-dataease.js","./mitt-0.0.0-dataease.js","./web-storage-cache-0.0.0-dataease.js","./vue-types-0.0.0-dataease.js","./is-plain-object-0.0.0-dataease.js","../css/index-0.0.0-dataease.css","./axios-0.0.0-dataease.js","./qs-0.0.0-dataease.js","./side-channel-0.0.0-dataease.js","./es-errors-0.0.0-dataease.js","./object-inspect-0.0.0-dataease.js","./crypto-js-0.0.0-dataease.js","./side-channel-list-0.0.0-dataease.js","./side-channel-map-0.0.0-dataease.js","./get-intrinsic-0.0.0-dataease.js","./es-object-atoms-0.0.0-dataease.js","./math-intrinsics-0.0.0-dataease.js","./gopd-0.0.0-dataease.js","./es-define-property-0.0.0-dataease.js","./has-symbols-0.0.0-dataease.js","./get-proto-0.0.0-dataease.js","./dunder-proto-0.0.0-dataease.js","./call-bind-apply-helpers-0.0.0-dataease.js","./function-bind-0.0.0-dataease.js","./hasown-0.0.0-dataease.js","./call-bound-0.0.0-dataease.js","./side-channel-weakmap-0.0.0-dataease.js","./jspdf-0.0.0-dataease.js","./@babel-0.0.0-dataease.js","./fflate-0.0.0-dataease.js","./fast-png-0.0.0-dataease.js","./iobuffer-0.0.0-dataease.js","./pako-0.0.0-dataease.js","./vue-router_2-0.0.0-dataease.js","./lodash-0.0.0-dataease.js","./vue-0.0.0-dataease.js","./vue-i18n-0.0.0-dataease.js","./@intlify-0.0.0-dataease.js","./echarts-0.0.0-dataease.js","./zrender-0.0.0-dataease.js","./tinymce-0.0.0-dataease.js","../css/ConfigGlobal-0.0.0-dataease.css","./icon_info_colorful-0.0.0-dataease.js","./icon_add_outlined-0.0.0-dataease.js","./icon_delete-trash_outlined-0.0.0-dataease.js","./join-join-0.0.0-dataease.js","./util-0.0.0-dataease.js","./snowflake-id-0.0.0-dataease.js","./dataset-0.0.0-dataease.js","./js-base64-0.0.0-dataease.js","./_plugin-vue_export-helper-0.0.0-dataease.js","../css/QueryCascade-0.0.0-dataease.css"],import.meta.url)),il=Z(),Vl=()=>{const l=T.value.filter(n=>{var o;return[0,2,5].includes(+n.displayType)&&n.optionValueSource===1&&!!((o=n.checkedFields)!=null&&o.length)&&!!Object.values(n.checkedFieldsMap).filter(y=>!!y).length}).reduce((n,o)=>{var y,N,q;return n[o.id]={datasetId:o.dataset.id,name:o.name,queryId:o.id,fieldId:o.field.id,deType:(q=(((N=(y=g[o.dataset.id])==null?void 0:y.fields)==null?void 0:N.dimensionList)||o.dataset.fields).find(U=>U.id===o.field.id))==null?void 0:q.deType},n},{});il.value.init(l,A)},Ia=l=>{for(let n in A){const[o,y]=A[n];o!=null&&o.datasetId.includes(l)?A[n]=[]:y!=null&&y.datasetId.includes(l)&&(A[n]=[o])}A=A.filter(n=>!!n.length)},Tt=[t("visualization.number1"),t("visualization.number2"),t("visualization.number3"),t("visualization.number4"),t("visualization.number5")],Ct=({defaultConditionValueF:l,defaultConditionValueS:n,conditionType:o})=>o===0?l==="":l===""||n==="",Rl=l=>{const{defaultConditionValueOperatorF:n,defaultConditionValueF:o,defaultConditionValueOperatorS:y,defaultConditionValueS:N}=l;l.conditionValueOperatorF=n,l.conditionValueF=o,l.conditionValueOperatorS=y,l.conditionValueS=N},Mt=()=>T.value.some(l=>{var N,q,U,ve,K;if(l.auto)return!1;if(!((N=l.checkedFields)!=null&&N.length)||l.checkedFields.some(de=>!l.checkedFieldsMap[de]))return $e.error(t("v_query.be_linked_first")),!0;if(l.displayType==="0"&&l.defaultValueCheck&&(Array.isArray(l.defaultValue)&&!l.defaultValue.length||!l.defaultValue))return $e.error(t("report.filter.title")),!0;if(l.displayType==="9"){if(l.defaultValueCheck&&(Array.isArray(l.defaultValue)&&!l.defaultValue.length||!l.defaultValue))return $e.error(t("report.filter.title")),!0;if(!l.treeDatasetId)return wa(l),l.treeDatasetId||$e.error(t("data_set.dataset_cannot_be")),!0;if(!((q=l.treeFieldList)!=null&&q.length))return $e.error(t("common.tree_structure")),!0;if((U=l.treeCheckedList)!=null&&U.slice(0,l.treeFieldList.length).some(de=>{var xe;return!((xe=de.checkedFields)!=null&&xe.length)||de.checkedFields.some(Oe=>!de.checkedFieldsMap[Oe])}))return $e.error(t("v_query.be_linked_first")),!0}if(l.displayType==="22"&&l.defaultValueCheck){if(l.numValueEnd=l.defaultNumValueEnd,l.numValueStart=l.defaultNumValueStart,l.defaultNumValueEnd!==0&&!l.defaultNumValueEnd||l.defaultNumValueStart!==0&&!l.defaultNumValueStart)return $e.error(t("v_query.cannot_be_empty_de")),!0;if(!isNaN(l.defaultNumValueEnd)&&!isNaN(l.defaultNumValueStart)&&l.defaultNumValueEnd<l.defaultNumValueStart)return $e.error(t("v_query.the_minimum_value")),!0}let n=null,o=t("v_query.cannot_be_performed"),y=0;if(l.checkedFields.some(de=>{var _e,ra,Xe,Pe,Se,aa,Ee,fa,na,c,D,Ge,Da;if((ra=(_e=l.checkedFieldsMapArrNum)==null?void 0:_e[de])!=null&&ra.length&&(y===0&&(y=1),y===2)||!((Pe=(Xe=l.checkedFieldsMapArrNum)==null?void 0:Xe[de])!=null&&Pe.length)&&["22"].includes(l.displayType)&&l.parameters.length&&(y===0&&(y=2),y===1))return!0;if(((aa=(Se=l.checkedFieldsMapArrNum)==null?void 0:Se[de])==null?void 0:aa.length)===1&&l.displayType==="22")return o=t("v_query.numerical_parameter_configuration"),!0;if(((fa=(Ee=l.checkedFieldsMapArr)==null?void 0:Ee[de])==null?void 0:fa.length)===1&&l.displayType==="7")return o=t("v_query.and_end_time"),!0;const xe=h.value.find(Ca=>Ca.componentId===de),Oe=(na=l.checkedFieldsMap)==null?void 0:na[de],Fe=se(Object.values((xe==null?void 0:xe.fields)||{}).flat()).find(Ca=>Oe===Ca.id);if(!Fe)return!1;if(n===null)return n=Fe,!1;if((n==null?void 0:n.deType)===(Fe==null?void 0:Fe.deType)&&(n==null?void 0:n.deType)===1){if(!Array.isArray(Fe.type)||!Array.isArray(n.type)||!((c=n.type)!=null&&c.length)&&!((D=Fe.type)!=null&&D.length))return!1;if(((Ge=n.type)==null?void 0:Ge.length)!==((Da=Fe.type)==null?void 0:Da.length))return o=t("v_query.format_is_inconsistent"),!0;for(let Ca=0;Ca<n.type.length;Ca++)if(n.type[Ca]!==Fe.type[Ca])return o=t("v_query.format_is_inconsistent"),!0}return n.deType!==(Fe==null?void 0:Fe.deType)}))return $e.error(o),!0;if(l.required){if(l.displayType==="8"){Rl(l);const de=Ct(l);return de&&$e.error(t("v_query.cannot_be_empty_de")),de}if(!l.defaultValueCheck)return $e.error(t("v_query.cannot_be_empty_de")),!0;if(l.displayType==="22")return l.defaultNumValueEnd!==0&&!l.defaultNumValueEnd||l.defaultNumValueStart!==0&&!l.defaultNumValueStart?($e.error(t("v_query.cannot_be_empty_de")),!0):!1;if(Array.isArray(l.defaultValue)&&!l.defaultValue.length||l.defaultValue!==0&&!l.defaultValue)return $e.error(t("v_query.cannot_be_empty_de")),!0}if(l.displayType==="8")return Rl(l),!1;if(!l.defaultValueCheck){const de=+l.displayType==7||l.multiple;l.selectValue=de?[]:void 0,l.defaultValue=de?[]:void 0}if(l.displayType==="1"){if(!l.defaultValueCheck)return!1;if(l.timeType==="fixed"&&!l.defaultValue)return $e.error(t("v_query.cannot_be_empty_time")),!0}if(l.displayType==="2"){if(!l.defaultValueCheck)return!1;if(Array.isArray(l.defaultValue)&&!l.defaultValue.length||!Array.isArray(l.defaultValue)&&["",void 0,null].includes(l.defaultValue))return $e.error(t("report.filter.title")),!0}if(+l.displayType==7){if(!l.defaultValueCheck)return!1;if(l.timeType==="fixed"){const[D,Ge]=l.defaultValue||[];if(!D||!Ge)return $e.error(t("v_query.cannot_be_empty_time")),!0}const{timeNum:de,relativeToCurrentType:xe,around:Oe,relativeToCurrentRange:Fe,timeGranularityMultiple:_e,arbitraryTime:ra,timeGranularity:Xe,timeNumRange:Pe,relativeToCurrentTypeRange:Se,aroundRange:aa,arbitraryTimeRange:Ee,timeType:fa}=l;let na=fa==="dynamic"?Ha(de,xe,Xe,Oe,ra,_e,"start-config"):new Date(l.defaultValue[0]),c=fa==="dynamic"?Ha(Pe,Se,Xe,aa,Ee,_e,"end-config"):new Date(l.defaultValue[1]);return Fe&&Fe!=="custom"&&([na,c]=Qa(Fe)),+na>+c?($e.error(t("v_query.the_start_time")),!0):l.setTimeRange&&gl(l,_e.includes("time")?he(+na).startOf("day").valueOf():+na,_e.includes("time")?he(+c).startOf("day").valueOf():+c)?($e.error(t("v_query.range_please_reset")),!0):!1}if(l.displayType!=="9"&&l.optionValueSource===2&&!((ve=l.valueSource)!=null&&ve.filter(de=>!!de).length))return $e.error(t("v_query.cannot_be_empty_input")),!0;if(!["9","22","1","7"].includes(l.displayType)&&l.optionValueSource===1&&!l.field.id)return $e.error((K=l.dataset)!=null&&K.id?t("v_query.the_data_set"):t("v_query.option_value_field")),!0}),Ft=()=>{var l,n;(l=x.value)==null||l.mult(),(n=x.value)==null||n.single(),ta(),e.value.id="",Je.value=0,H.value=!1},Ll=u,St=()=>{var n,o;if(Mt())return;(n=x.value)==null||n.mult(),(o=x.value)==null||o.single(),ta(),H.value=!1,T.value.forEach(y=>{e.value=y,Ba(["1","7"].includes(e.value.displayType)?e.value.displayType==="7":e.value.multiple)});const l=we(a(ye.value.propValue));ye.value.propValue=[],Me(()=>{T.value.forEach(y=>{A.forEach(N=>{N.forEach(q=>{if(q.datasetId.split("--")[1]===y.id&&y.defaultValueCheck){const U=y.mapValue;q.selectValue=Array.isArray(U)?[...U]:U,q.currentSelectValue=Array.isArray(U)?[...U]:U}})})}),ye.value.cascade=we(A),A=[],ye.value.propValue=we(T.value),ne.recordSnapshotCache("confirmClick"),e.value.id="",Je.value=0,Me(()=>{Ll("reRenderAll",l,we(a(T))),Ll("queryData")})})},wt=O(()=>e.value.dataset.fields.filter(l=>l.deType===+e.value.displayType||[0,2,3,4].includes(l.deType)&&[0,2].includes(+e.value.displayType)||l.deType===7&&+e.value.displayType==0)),xl=()=>{p.value=we(e.value.valueSource),p.value.length||p.value.push(""),Re.value.hide()},qt=()=>{if(p.value.some(l=>typeof l=="string"?!l.trim():!1)){$e.error(t("v_query.cannot_be_empty_input"));return}e.value.valueSource=we(p.value.filter(l=>typeof l=="string"?l.trim():!0)),nl(),xl()},$t=l=>{T.value=(we(S.queryElement.propValue)||[]).map(n=>kl(n)),Yl(l)},At=()=>{T.value=(we(S.queryElement.propValue)||[]).map(l=>kl(l)),Fl(),Yl(T.value[T.value.length-1].id)},Ul=(l,n)=>{let o="dimensionList";return l.some((y,N)=>(y||[]).some(q=>q.id===n)?(o=["dimensionList","quotaList","parameterList"][N],!0):!1),o},Yl=l=>{Ya(),Je.value=0,ee.value=[],ul({id:l}),A=we(ye.value.cascade||[]),H.value=!0;const n=J.value.map(N=>N.tableId);for(const N in g)n.includes(N)||delete g[N];const o=Object.keys(g);n.every(N=>o.includes(N))&&(h.value=J.value.map(N=>g[N.tableId]?{...g[N.tableId],componentId:N.id}:null).filter(N=>!!N));const y=[...new Set(J.value.map(N=>N.tableId).filter(N=>!!N))];y.length&&Promise.all([yn(y),_n(y)]).then(([N,q])=>{N.filter(U=>!!U).forEach(U=>{U.activelist="dimensionList",U.fields.parameterList=q.filter(ve=>{var K;return ve.datasetGroupId===U.id&&!((K=ve.params)!=null&&K.length)}),U.hasParameter=!!U.fields.parameterList.length,U.fields.dimensionList=(U.fields.dimensionList||[]).filter(ve=>{var K;return!((K=ve.params)!=null&&K.length)}),U.fields.quotaList=(U.fields.quotaList||[]).filter(ve=>{var K;return!((K=ve.params)!=null&&K.length)}),g[U.id]=U}),h.value=J.value.map(U=>{if(!g[U.tableId])return null;const ve=g[U.tableId].fields||{},K=Ul([ve.dimensionList,ve.quotaList,ve.parameterList],e.value.checkedFieldsMap[U.id]);return{...g[U.tableId],componentId:U.id,activelist:K}}).filter(U=>!!U)}).finally(()=>{e.value.treeDatasetId||Me(()=>{ca()}),He(e.value.checkedFields)})},Gl=()=>{p.value=Array.from(new Set(p.value))},kl=l=>(Object.entries({timeType:"fixed",hideConditionSwitching:!1,required:!1,defaultMapValue:[],mapValue:[],parametersStart:null,conditionType:0,conditionValueOperatorF:"eq",conditionValueF:"",conditionValueOperatorS:"like",conditionValueS:"",resultMode:0,defaultConditionValueOperatorF:"eq",defaultConditionValueF:"",defaultConditionValueOperatorS:"like",defaultConditionValueS:"",parametersEnd:null,relativeToCurrent:"custom",timeNum:0,relativeToCurrentRange:"custom",relativeToCurrentType:"year",around:"f",arbitraryTime:new Date,timeNumRange:0,relativeToCurrentTypeRange:"year",aroundRange:"f",treeDatasetId:"",displayId:"",sortId:"",sort:"asc",arbitraryTimeRange:new Date,setTimeRange:!1,showEmpty:!1,defaultNumValueStart:null,defaultNumValueEnd:null,numValueEnd:null,numValueStart:null,timeRange:{intervalType:"none",dynamicWindow:!1,maximumSingleQuery:0,regularOrTrends:"fixed",regularOrTrendsValue:"",relativeToCurrent:"custom",timeNum:0,relativeToCurrentType:"year",around:"f",timeNumRange:0,relativeToCurrentTypeRange:"year",aroundRange:"f"},oldTreeLoad:!1,treeCheckedList:[],defaultValueFirstItem:!1,treeFieldList:[]}).forEach(([o,y])=>{l[o]??(l[o]=y)}),l.treeDatasetId||(l.treeDatasetId=l.dataset.id),l.timeRange.relativeToCurrentRange||(l.timeRange.relativeToCurrentRange="custom"),l),ul=(l,n=0)=>{var N;if(ta(),ie.id)return;De.value=l.id;const o=T.value.find(q=>q.id===l.id);o.checkedFieldsMapArr||(o.checkedFieldsMapArr={},o.checkedFieldsMapArrNum={},o.checkedFieldsMapStart={},o.checkedFieldsMapStartNum={},o.checkedFieldsMapEnd={},o.checkedFieldsMapEndNum={},o.parametersArr={}),e.value=o,e.value.dataset.fields=[],Me(()=>{x.value.changeMultiple(e.value.multiple)}),e.value.dataset.id&&at(e.value.dataset.id).then(q=>{e.value.dataset.fields=q.data}),e.value.checkedFieldsMapStart||(e.value.checkedFieldsMapStart={}),e.value.checkedFieldsMapStartNum||(e.value.checkedFieldsMapStartNum={}),e.value.checkedFieldsMapEnd||(e.value.checkedFieldsMapEnd={}),e.value.checkedFieldsMapEndNum||(e.value.checkedFieldsMapEndNum={}),e.value.checkedFieldsMapArr||(e.value.checkedFieldsMapArr={}),e.value.checkedFieldsMapArrNum||(e.value.checkedFieldsMapArrNum={}),e.value.parametersArr||(e.value.parametersArr={}),J.value.forEach(q=>{e.value.checkedFieldsMap[q.id]||(e.value.checkedFieldsMap[q.id]=""),e.value.checkedFieldsMapStart[q.id]||(e.value.checkedFieldsMapStart[q.id]=""),e.value.checkedFieldsMapStartNum[q.id]||(e.value.checkedFieldsMapStartNum[q.id]=""),e.value.checkedFieldsMapEnd[q.id]||(e.value.checkedFieldsMapEnd[q.id]=""),e.value.checkedFieldsMapEndNum[q.id]||(e.value.checkedFieldsMapEndNum[q.id]=""),e.value.checkedFieldsMapArr[q.id]||(e.value.checkedFieldsMapArr[q.id]=[]),e.value.checkedFieldsMapArrNum[q.id]||(e.value.checkedFieldsMapArrNum[q.id]=[]),e.value.parametersArr[q.id]||(e.value.parametersArr[q.id]=[])});const y=J.value.map(q=>q.id);e.value.checkedFields=e.value.checkedFields.filter(q=>y.includes(q)),(N=h.value)!=null&&N.length&&(h.value.forEach(q=>{const U=q.fields;q.activelist=Ul([U.dimensionList,U.quotaList,U.parameterList],e.value.checkedFieldsMap[q.componentId])}),He(e.value.checkedFields)),Ba(e.value.multiple),p.value=we(e.value.valueSource),p.value.length||p.value.push(""),Me(()=>{var q;e.value.displayType==="9"&&(la="9",Cl(n,!0),!e.value.treeDatasetId&&((q=h.value)!=null&&q.length)?Me(()=>{ca()}):e.value.treeDatasetId&&Wa(e.value.treeDatasetId,e.value)),e.value.showError=Pl.value,e.value.auto&&(document.querySelector(".chart-field").scrollTop=0)})},Wa=(l,n)=>{at(l).then(o=>{n.dataset.fields=o.data})},It=()=>{Ga(),e.value.sortList=[],ja.value&&(e.value.sort="")},Dt=()=>{ja.value&&(e.value.sort=""),e.value.defaultValueCheck&&(e.value.defaultValue=e.value.multiple?[]:void 0)},Bl=Z(),Nt=l=>{e.value.sortList=we(l)},Ot=async()=>{if(ja.value||e.value.sort!=="customSort")return;let l=we(e.value.sortList||[]);l.length||(l=(await ct({queryId:e.value.sortId,searchText:""})).map(o=>o[e.value.sortId])),Bl.value.sortInit([...new Set(l)])},ja=O(()=>{const{sortId:l,displayId:n}=e.value;return l&&n&&l!==n}),Wl=Z(),jl=()=>{Wl.value.init(e.value.dataset.fields.filter(l=>l.groupType==="d"&&l.deType===0),e.value.treeFieldList)},Et=l=>{e.value.treeFieldList=l,Rt()},Rt=()=>{e.value.treeFieldList.forEach((l,n)=>{e.value.treeCheckedList[n]||(e.value.treeCheckedList=[...e.value.treeCheckedList,{checkedFields:[...e.value.checkedFields],checkedFieldsMap:we(e.value.checkedFieldsMap)}]),h.value.forEach(o=>{o.fields.dimensionList.map(N=>N.id).includes(l.id)&&(e.value.treeCheckedList[n].checkedFieldsMap[o.componentId]=l.id)})}),e.value.checkedFields=e.value.treeCheckedList[Je.value].checkedFields,e.value.checkedFieldsMap=e.value.treeCheckedList[Je.value].checkedFieldsMap},Pl=O(()=>{if(!e.value)return!1;const{optionValueSource:l,checkedFieldsMap:n,checkedFields:o,field:y,valueSource:N,displayType:q,treeCheckedList:U,treeFieldList:ve}=e.value,K=o.filter(de=>!!n[de]);if(!o.length||!K.length)return!0;if(+q==9)for(const de in U){if(de>ve.length)continue;const xe=U[de].checkedFields.filter(Oe=>!!U[de].checkedFieldsMap[Oe]);if(!U[de].checkedFields.length||!xe.length)return!0}return[1,7,8,22,9].includes(+q)?!1:l===1&&!y.id||l===2&&!N.length}),ta=()=>{var l;(l=x.value)==null||l.handleDialogClick()},Lt=O(()=>{let l=[];if(!e.value)return l;switch(e.value.timeGranularity){case"year":l=[{label:t("dynamic_year.current"),value:"thisYear"},{label:t("dynamic_year.last"),value:"lastYear"}];break;case"month":l=[{label:t("cron.this_month"),value:"thisMonth"},{label:t("dynamic_month.last"),value:"lastMonth"}];break;case"date":l=[{label:t("dynamic_time.today"),value:"today"},{label:t("dynamic_time.yesterday"),value:"yesterday"},{label:t("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:t("dynamic_time.endOfMonth"),value:"monthEnd"},{label:t("dynamic_time.firstOfYear"),value:"yearBeginning"}];break;case"datetime":l=[{label:t("dynamic_time.today"),value:"today"},{label:t("dynamic_time.yesterday"),value:"yesterday"},{label:t("dynamic_time.firstOfMonth"),value:"monthBeginning"},{label:t("dynamic_time.endOfMonth"),value:"monthEnd"},{label:t("dynamic_time.firstOfYear"),value:"yearBeginning"}];break}return[...l,{label:t("dynamic_time.custom"),value:"custom"}]}),xt=O(()=>{let l=[];if(!e.value)return l;switch(e.value.timeGranularityMultiple){case"yearrange":l=[{label:t("dynamic_year.current"),value:"thisYear"},{label:t("dynamic_year.last"),value:"lastYear"}];break;case"monthrange":l=[{label:t("cron.this_month"),value:"thisMonth"},{label:t("dynamic_month.last"),value:"lastMonth"},{label:t("v_query.last_3_months"),value:"LastThreeMonths"},{label:t("v_query.last_6_months"),value:"LastSixMonths"},{label:t("v_query.last_12_months"),value:"LastTwelveMonths"}];break;case"daterange":case"datetimerange":l=[{label:t("dynamic_time.today"),value:"today"},{label:t("dynamic_time.yesterday"),value:"yesterday"},{label:t("v_query.last_3_days"),value:"LastThreeDays"},{label:t("v_query.month_to_date"),value:"monthBeginning"},{label:t("v_query.year_to_date"),value:"yearBeginning"}];break}return[...l,{label:t("dynamic_time.custom"),value:"custom"}]}),zl=l=>{var n;e.value.relativeToCurrentType=["date","datetime"].includes(l)?"date":l,e.value.relativeToCurrent!=="custom"&&(e.value.relativeToCurrent=(n=Lt.value[0])==null?void 0:n.value)},Ut=()=>{e.value.displayType==="1"?zl(e.value.timeGranularity):Hl(e.value.timeGranularityMultiple)},Hl=l=>{var n;ta(),e.value.relativeToCurrentType=["daterange","datetimerange"].includes(l)?"date":l.split("range")[0],e.value.relativeToCurrentTypeRange=e.value.relativeToCurrentType,e.value.relativeToCurrentRange!=="custom"&&(e.value.relativeToCurrentRange=(n=xt.value[0])==null?void 0:n.value),e.value.timeRange={intervalType:"none",dynamicWindow:!1,maximumSingleQuery:0,regularOrTrends:"fixed",regularOrTrendsValue:"",relativeToCurrent:"custom",relativeToCurrentRange:"custom",timeNum:0,relativeToCurrentType:e.value.relativeToCurrentRange,around:"f",timeNumRange:0,relativeToCurrentTypeRange:e.value.relativeToCurrentRange,aroundRange:"f"}};me(()=>Pl.value,l=>{e.value.showError=l});const Yt=l=>{ee.value.push(l)},Je=Z(0),Gt=(l,n)=>{De.value!==l.id?ul(l,n):Cl(n)},Tl=()=>{e.value.treeCheckedList[Je.value]={checkedFields:[...e.value.checkedFields],checkedFieldsMap:we(e.value.checkedFieldsMap)}},Cl=(l,n=!1)=>{var q,U,ve,K,de,xe,Oe,Fe,_e;if((q=e.value.treeCheckedList)!=null&&q.length&&!n&&(e.value.treeCheckedList[Je.value]={checkedFields:[...e.value.checkedFields],checkedFieldsMap:we(e.value.checkedFieldsMap)}),Je.value=l,!((ve=(U=e.value)==null?void 0:U.treeCheckedList)!=null&&ve.length)&&!e.value.oldTreeLoad?e.value.treeCheckedList=e.value.treeFieldList.map(ra=>({checkedFields:[...e.value.checkedFields],checkedFieldsMap:e.value.checkedFields.reduce((Xe,Pe)=>(Xe[Pe]=ra.id,Xe),{})})):!((de=(K=e.value)==null?void 0:K.treeCheckedList)!=null&&de.length)&&e.value.oldTreeLoad&&(e.value.treeCheckedList=e.value.treeFieldList.map(()=>({checkedFields:[...e.value.checkedFields],checkedFieldsMap:we(e.value.checkedFieldsMap)}))),!((xe=e.value)!=null&&xe.treeCheckedList[l]))return;const{checkedFields:o,checkedFieldsMap:y}=(Oe=e.value)==null?void 0:Oe.treeCheckedList[l];e.value.checkedFields=o,e.value.checkedFieldsMap=y;const N=o==null?void 0:o.length;C.value=N===((Fe=h.value)==null?void 0:Fe.length),ge.value=N>0&&N<((_e=h.value)==null?void 0:_e.length)},Ql=(l,n,o)=>{switch(l){case"del":ee.value=[],T.value.splice(o,1),e.value=null;break;case"rename":ee.value=[],Object.assign(ie,n),setTimeout(()=>{Me(()=>{ee.value[0].focus()})},400);break}},Zl={label:"name",children:"children",value:"id",isLeaf:l=>{var n;return!((n=l.children)!=null&&n.length)}},Ml=l=>l.filter(n=>{var o,y;return(o=n.children)!=null&&o.length&&!n.leaf?(n.children=Ml(n.children),!!((y=n.children)!=null&&y.length)):n.leaf}),Bt=()=>{var l;if(ie.name.trim()===""){$e.error(t("v_query.cannot_be_empty_name")),(l=ee.value[0])==null||l.focus();return}T.value.some(n=>ie.id===n.id?(n.name=ie.name,!0):!1),ie.id=""},Fl=()=>{Je.value=0,T.value.push(kl(Pn()))},Wt=()=>{Fl(),ul(T.value[T.value.length-1])};return w({setCondition:$t,addCriteriaConfig:()=>(Fl(),T.value[T.value.length-1].id),setConditionOut:At}),(l,n)=>{const o=La,y=ql,N=La,q=sn,U=Il,ve=Dl,K=Ja,de=Xa,xe=Al,Oe=Kt,Fe=Jt,_e=xa,ra=zt,Xe=Ht,Pe=it,Se=Za,aa=ut,Ee=$l,fa=Qt,na=Zt;return s(),k(X,null,[i(Ee,{class:"query-condition-configuration",modelValue:H.value,"onUpdate:modelValue":n[21]||(n[21]=c=>H.value=c),width:"1200px",title:a(t)("v_query.query_condition_setting"),onClick:n[22]||(n[22]=Be(()=>{},["stop"])),"before-close":Ft,onMousedown:n[23]||(n[23]=Be(()=>{},["stop"])),onMousedup:n[24]||(n[24]=Be(()=>{},["stop"]))},{footer:r(()=>[m("div",ps,[i(Se,{class:"query-cascade",onClick:Vl},{default:r(()=>[z(b(a(t)("v_query.component_cascade_configuration")),1)]),_:1}),i(Se,{onClick:$a},{default:r(()=>[z(b(a(t)("chart.cancel")),1)]),_:1}),i(Se,{onClick:St,type:"primary"},{default:r(()=>[z(b(a(t)("chart.confirm")),1)]),_:1})])]),default:r(()=>[m("div",{class:"container",onClick:ta},[m("div",Yu,[m("div",Gu,[z(b(a(t)("v_query.query_condition"))+" ",1),i(y,{onClick:Wt},{default:r(()=>[i(o,{name:"icon_add_outlined"},{default:r(()=>[i(a(cl),{class:"svg-icon"})]),_:1})]),_:1})]),i(a(vt),{tag:"div",list:T.value,handle:".handle"},{item:r(({element:c,index:D})=>[(s(),k("div",{key:c.id,onDblclick:Be(Ge=>Ql("rename",c,D),["stop"]),onClick:Be(Ge=>ul(c),["stop"]),class:"list-item_box",style:Ie({marginBottom:c.treeFieldList?c.treeFieldList.slice(1).length*40+"px":0})},[m("div",{class:be(["list-item_primary",c.id===De.value&&Je.value===0&&"active"])},[i(y,{class:"handle"},{default:r(()=>[i(o,{name:"icon_drag_outlined"},{default:r(()=>[i(a(dn),{class:"svg-icon"})]),_:1})]),_:1}),m("div",{class:"label flex-align-center icon",title:c.name},[!c.auto&&c.showError?(s(),R(y,{key:0,style:{"font-size":"16px",color:"#f54a45"}},{default:r(()=>[i(N,{name:"icon_warning_filled"},{default:r(()=>[i(a(vn),{class:"svg-icon"})]),_:1})]),_:1})):G("",!0),z(" "+b(c.name),1)],8,Wu),m("div",ju,[i(q,{onHandleCommand:Ge=>Ql(Ge,c,D),"menu-list":Ne,"icon-name":a(on),placement:"bottom-end"},null,8,["onHandleCommand","icon-name"]),c.visible?(s(),R(y,{key:0,class:"hover-icon",onClick:Be(Ge=>c.visible=!c.visible,["stop"])},{default:r(()=>[i(o,{name:"icon_visible_outlined"},{default:r(()=>[i(a(cn),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])):(s(),R(y,{key:1,class:"hover-icon",onClick:Be(Ge=>c.visible=!c.visible,["stop"])},{default:r(()=>[i(o,{name:"de_pwd_invisible"},{default:r(()=>[i(a(Rn),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"]))]),ie.id===c.id?(s(),k("div",{key:0,onClick:n[1]||(n[1]=Be(()=>{},["stop"])),class:"rename"},[i(U,{onBlur:Bt,ref:Yt,modelValue:ie.name,"onUpdate:modelValue":n[0]||(n[0]=Ge=>ie.name=Ge)},null,8,["modelValue"])])):G("",!0)],2),c.treeFieldList?(s(!0),k(X,{key:0},ce(c.treeFieldList.slice(1),(Ge,Da)=>(s(),k("div",{class:be([c.id===De.value&&Je.value===Da+1&&"active","list-item_primary list-tree_primary"]),style:Ie({top:40*(Da+1)+"px",paddingLeft:32+16*(Da+1)+"px"}),key:Ge.field,onClick:Be(Ca=>Gt(c,Da+1),["stop"])},b(Ge.name),15,Pu))),128)):G("",!0)],44,Bu))]),_:1},8,["list"])]),e.value?(s(),k("div",{key:0,class:be(["chart-field",e.value.auto&&"hidden"])},[i(Xe,null,{default:r(()=>[e.value.auto?(s(),k("div",zu)):G("",!0),m("div",Hu,[z(b(a(t)("v_query.chart_and_field"))+" ",1),i(de,{class:"ml-4 larger-radio",modelValue:e.value.auto,"onUpdate:modelValue":n[2]||(n[2]=c=>e.value.auto=c)},{default:r(()=>[i(K,{disabled:!e.value.auto,label:!0},{default:r(()=>[m("div",Qu,[z(b(a(t)("chart.margin_model_auto"))+" ",1),i(ve,{effect:"dark",placement:"top"},{content:r(()=>[m("div",null,[z(b(a(t)("v_query.be_switched_to"))+" ",1),n[31]||(n[31]=m("br",null,null,-1)),z(" "+b(a(t)("v_query.to_automatic_again")),1)])]),default:r(()=>[i(y,{style:{"margin-left":"4px",color:"#646a73"}},{default:r(()=>[i(N,{name:"icon_info_outlined"},{default:r(()=>[i(a(mn),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})])]),_:1},8,["disabled"]),i(K,{label:!1},{default:r(()=>[z(b(a(t)("commons.custom")),1)]),_:1})]),_:1},8,["modelValue"])]),m("div",Zu,[i(xe,{modelValue:C.value,"onUpdate:modelValue":n[3]||(n[3]=c=>C.value=c),indeterminate:ge.value,onChange:We},{default:r(()=>[z(b(a(t)("dataset.check_all")),1)]),_:1},8,["modelValue","indeterminate"])]),m("div",Ku,[i(ra,{modelValue:e.value.checkedFields,"onUpdate:modelValue":n[4]||(n[4]=c=>e.value.checkedFields=c),onChange:da},{default:r(()=>[(s(!0),k(X,null,ce(h.value,c=>(s(),k("div",{key:c.componentId,class:"list-item_field_de"},[i(xe,{label:c.componentId},{default:r(()=>[i(y,{class:"component-type"},{default:r(()=>[i(o,null,{default:r(()=>[(s(),R(ze(a(Dn)[a(F)[c.componentId].type])))]),_:2},1024)]),_:2},1024),m("span",{title:a(F)[c.componentId].title,class:"checkbox-name ellipsis"},b(a(F)[c.componentId].title),9,Ju)]),_:2},1032,["label"]),m("span",{title:c.name,class:"dataset ellipsis"},b(c.name),9,Xu),e.value.checkedFields.includes(c.componentId)&&e.value.checkedFieldsMapArr&&e.value.checkedFieldsMapArr[c.componentId]&&e.value.checkedFieldsMapArr[c.componentId].length?(s(),R(a(Ue),{onChange:D=>$(D,c.componentId),onFocus:ta,multiple:"",filterable:"","collapse-tags":"","collapse-tags-tooltip":"",key:"checkedFieldsMapArrTime","multiple-limit":2,class:"field-select--input",style:{"margin-left":"12px"},"popper-class":"field-select--dqp",modelValue:e.value.checkedFieldsMapArr[c.componentId],"onUpdate:modelValue":D=>e.value.checkedFieldsMapArr[c.componentId]=D,clearable:""},Ea({header:r(()=>[i(Fe,{stretch:"",class:"params-select--header",modelValue:c.activelist,"onUpdate:modelValue":D=>c.activelist=D},{default:r(()=>[i(Oe,{disabled:"",label:a(t)("chart.dimension"),name:"dimensionList"},null,8,["label"]),i(Oe,{disabled:"",label:a(t)("chart.quota"),name:"quotaList"},null,8,["label"]),i(Oe,{label:a(t)("dataset.param"),name:"parameterList"},null,8,["label"])]),_:1},8,["modelValue","onUpdate:modelValue"])]),default:r(()=>[(s(!0),k(X,null,ce(c.fields[c.activelist],D=>(s(),R(_e,{key:D.id,label:D.name||D.variableName,value:D.id,disabled:Va(D)},{default:r(()=>[m("div",er,[i(y,null,{default:r(()=>[i(o,{className:`field-icon-${a(ke)[D.deType]}`},{default:r(()=>[(s(),R(ze(a(sa)[a(ke)[D.deType]]),{class:be(["svg-icon",`field-icon-${a(ke)[D.deType]}`])},null,8,["class"]))]),_:2},1032,["className"])]),_:2},1024),m("span",{title:D.name||D.variableName,class:"ellipsis"},b(D.name||D.variableName),9,ar),e.value.checkedFieldsMapArr[c.componentId].includes(D.id)&&c.activelist==="parameterList"?(s(),k("span",{key:0,onClick:Be(Ge=>ae(c.componentId,D),["stop"]),class:"range-time_setting"},[z(b(e.value.checkedFieldsMapStart[c.componentId]===D.id?a(t)("dataset.start_time"):e.value.checkedFieldsMapEnd[c.componentId]===D.id?a(t)("dataset.end_time"):"")+" ",1),i(y,null,{default:r(()=>[i(o,null,{default:r(()=>[i(a(Ra),{class:"svg-icon"})]),_:1})]),_:1})],8,lr)):G("",!0)])]),_:2},1032,["label","value","disabled"]))),128))]),_:2},[e.value.checkedFieldsMap[c.componentId]?{name:"prefix",fn:r(()=>[i(y,null,{default:r(()=>[i(o,null,{default:r(()=>[(s(),R(ze(a(sa)[a(ke)[B(e.value.checkedFieldsMap[c.componentId],Object.values(c.fields))]]),{class:be(`field-icon-${a(ke)[B(e.value.checkedFieldsMap[c.componentId],Object.values(c.fields))]}`)},null,8,["class"]))]),_:2},1024)]),_:2},1024)]),key:"0"}:void 0]),1032,["onChange","modelValue","onUpdate:modelValue"])):e.value.checkedFields.includes(c.componentId)&&e.value.checkedFieldsMapArrNum&&e.value.checkedFieldsMapArrNum[c.componentId]&&e.value.checkedFieldsMapArrNum[c.componentId].length?(s(),R(a(Ue),{onChange:D=>Qe(D,c.componentId),onFocus:ta,multiple:"",filterable:"","collapse-tags":"","collapse-tags-tooltip":"",key:"checkedFieldsMapArr","multiple-limit":2,class:"field-select--input",style:{"margin-left":"12px"},"popper-class":"field-select--dqp",modelValue:e.value.checkedFieldsMapArrNum[c.componentId],"onUpdate:modelValue":D=>e.value.checkedFieldsMapArrNum[c.componentId]=D,clearable:""},Ea({header:r(()=>[i(Fe,{stretch:"",class:"params-select--header",modelValue:c.activelist,"onUpdate:modelValue":D=>c.activelist=D},{default:r(()=>[i(Oe,{disabled:"",label:a(t)("chart.dimension"),name:"dimensionList"},null,8,["label"]),i(Oe,{disabled:"",label:a(t)("chart.quota"),name:"quotaList"},null,8,["label"]),i(Oe,{label:a(t)("dataset.param"),name:"parameterList"},null,8,["label"])]),_:1},8,["modelValue","onUpdate:modelValue"])]),default:r(()=>[(s(!0),k(X,null,ce(c.fields[c.activelist],D=>(s(),R(_e,{key:D.id,label:D.name||D.variableName,value:D.id,disabled:![2,3].includes(D.deType)},{default:r(()=>[m("div",tr,[i(y,null,{default:r(()=>[i(o,{className:`field-icon-${a(ke)[D.deType]}`},{default:r(()=>[(s(),R(ze(a(sa)[a(ke)[D.deType]]),{class:be(["svg-icon",`field-icon-${a(ke)[D.deType]}`])},null,8,["class"]))]),_:2},1032,["className"])]),_:2},1024),m("span",{title:D.name||D.variableName,class:"ellipsis"},b(D.name||D.variableName),9,nr),e.value.checkedFieldsMapArrNum[c.componentId].includes(D.id)&&c.activelist==="parameterList"?(s(),k("span",{key:0,onClick:Be(Ge=>j(c.componentId,D),["stop"]),class:"range-time_setting"},[z(b(e.value.checkedFieldsMapStartNum[c.componentId]===D.id?a(t)("chart.min"):e.value.checkedFieldsMapEndNum[c.componentId]===D.id?a(t)("chart.max"):"")+" ",1),i(y,null,{default:r(()=>[i(o,null,{default:r(()=>[i(a(Ra),{class:"svg-icon"})]),_:1})]),_:1})],8,ir)):G("",!0)])]),_:2},1032,["label","value","disabled"]))),128))]),_:2},[e.value.checkedFieldsMap[c.componentId]?{name:"prefix",fn:r(()=>[i(y,null,{default:r(()=>[i(o,null,{default:r(()=>[(s(),R(ze(a(sa)[a(ke)[B(e.value.checkedFieldsMap[c.componentId],Object.values(c.fields))]]),{class:be(`field-icon-${a(ke)[B(e.value.checkedFieldsMap[c.componentId],Object.values(c.fields))]}`)},null,8,["class"]))]),_:2},1024)]),_:2},1024)]),key:"0"}:void 0]),1032,["onChange","modelValue","onUpdate:modelValue"])):e.value.checkedFields.includes(c.componentId)?(s(),R(a(Ue),{key:2,onChange:D=>qe(c),onFocus:ta,filterable:"",style:{"margin-left":"12px"},"popper-class":"field-select--dqp",modelValue:e.value.checkedFieldsMap[c.componentId],"onUpdate:modelValue":D=>e.value.checkedFieldsMap[c.componentId]=D,clearable:""},Ea({header:r(()=>[i(Fe,{stretch:"",class:"params-select--header",modelValue:c.activelist,"onUpdate:modelValue":D=>c.activelist=D},{default:r(()=>[i(Oe,{label:a(t)("chart.dimension"),name:"dimensionList"},null,8,["label"]),i(Oe,{disabled:e.value.displayType==="9",label:a(t)("chart.quota"),name:"quotaList"},null,8,["disabled","label"]),c.hasParameter?(s(),R(Oe,{key:0,label:a(t)("dataset.param"),disabled:e.value.displayType==="9",name:"parameterList"},null,8,["label","disabled"])):G("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),default:r(()=>[(s(!0),k(X,null,ce(c.fields[c.activelist],D=>(s(),R(_e,{key:D.id,label:D.name||D.variableName,value:D.id,disabled:D.desensitized||e.value.displayType==="9"&&D.deType===1||Va(D)},{default:r(()=>[m("div",{class:"flex-align-center icon",title:D.desensitized?a(t)("v_query.as_query_conditions"):""},[i(y,null,{default:r(()=>[i(o,{className:`field-icon-${a(ke)[D.deType]}`},{default:r(()=>[(s(),R(ze(a(sa)[a(ke)[D.deType]]),{class:be(["svg-icon",`field-icon-${a(ke)[D.deType]}`])},null,8,["class"]))]),_:2},1032,["className"])]),_:2},1024),m("span",{title:D.name||D.variableName,class:"ellipsis"},b(D.name||D.variableName),9,rr),e.value.checkedFieldsMap[c.componentId]===D.id&&c.activelist==="parameterList"&&(V.value||_.value)?(s(),k("span",{key:0,onClick:Be(()=>_.value?j(c.componentId,D):ae(c.componentId,D),["stop"]),class:"range-time_setting"},[z(b(_.value?a(t)("chart.value_formatter_value"):a(t)("dataset.time"))+" ",1),i(y,null,{default:r(()=>[i(o,null,{default:r(()=>[i(a(Ra),{class:"svg-icon"})]),_:1})]),_:1})],8,sr)):G("",!0)],8,ur)]),_:2},1032,["label","value","disabled"]))),128))]),_:2},[e.value.checkedFieldsMap[c.componentId]?{name:"prefix",fn:r(()=>[i(y,null,{default:r(()=>[i(o,null,{default:r(()=>[(s(),R(ze(a(sa)[a(ke)[B(e.value.checkedFieldsMap[c.componentId],Object.values(c.fields))]]),{class:be(`field-icon-${a(ke)[B(e.value.checkedFieldsMap[c.componentId],Object.values(c.fields))]}`)},null,8,["class"]))]),_:2},1024)]),_:2},1024)]),key:"0"}:void 0]),1032,["onChange","modelValue","onUpdate:modelValue"])):(s(),k("span",or))]))),128))]),_:1},8,["modelValue"])])]),_:1})],2)):G("",!0),e.value?(s(),k("div",{key:1,class:be(["condition-configuration",e.value.auto&&"condition-configuration_hide"])},[i(Xe,null,{default:r(()=>[e.value.auto?(s(),k("div",dr)):G("",!0),m("div",cr,[z(b(a(t)("v_query.query_condition_configuration"))+" ",1),i(xe,{disabled:e.value.auto||e.value.displayType==="9"&&Je.value!==0,modelValue:e.value.required,"onUpdate:modelValue":n[5]||(n[5]=c=>e.value.required=c),label:a(t)("v_query.required_items")},null,8,["disabled","modelValue","label"])]),za(m("div",vr,[m("div",mr,[m("div",pr,b(a(t)("v_query.display_type")),1),m("div",fr,[i(a(Ue),{onFocus:ta,onChange:qa,modelValue:e.value.displayType,"onUpdate:modelValue":n[6]||(n[6]=c=>e.value.displayType=c)},{default:r(()=>[i(_e,{disabled:!["0","8","9"].includes(e.value.displayType),label:a(t)("v_query.text_drop_down"),value:"0"},null,8,["disabled","label"]),i(_e,{disabled:!["0","8","9"].includes(e.value.displayType),label:a(t)("v_query.text_search"),value:"8"},null,8,["disabled","label"]),i(_e,{disabled:!["0","8","9"].includes(e.value.displayType)||!!e.value.parameters.length,label:a(t)("v_query.drop_down_tree"),value:"9"},null,8,["disabled","label"]),["2","22"].includes(e.value.displayType)?(s(),k(X,{key:0},[i(_e,{disabled:!["2","22"].includes(e.value.displayType)||le.value,label:a(t)("v_query.number_drop_down"),value:"2"},null,8,["disabled","label"]),i(_e,{disabled:!["2","22"].includes(e.value.displayType)||re.value,label:a(t)("v_query.number_range"),value:"22"},null,8,["disabled","label"])],64)):(s(),R(_e,{key:1,disabled:e.value.displayType!=="5",label:a(t)("v_query.number_drop_down"),value:"5"},null,8,["disabled","label"])),i(_e,{disabled:!["1","7"].includes(e.value.displayType)||V.value&&P.value,label:a(t)("dataset.time"),value:"1"},null,8,["disabled","label"]),i(_e,{disabled:!["1","7"].includes(e.value.displayType)||V.value&&!P.value,label:a(t)("common.component.dateRange"),value:"7"},null,8,["disabled","label"])]),_:1},8,["modelValue"])])]),e.value.displayType==="9"?(s(),k("div",yr,[m("div",{title:a(t)("v_query.of_option_values"),class:"label ellipsis"},b(a(t)("v_query.of_option_values")),9,_r),m("div",hr,[i(de,{class:"larger-radio",modelValue:e.value.resultMode,"onUpdate:modelValue":n[7]||(n[7]=c=>e.value.resultMode=c)},{default:r(()=>[i(K,{label:0},{default:r(()=>[z(b(a(t)("login.default_login")),1)]),_:1}),i(K,{label:1},{default:r(()=>[z(b(a(t)("chart.result_mode_all")),1)]),_:1})]),_:1},8,["modelValue"])])])):G("",!0),e.value.displayType==="9"?(s(),k("div",gr,[m("div",{title:a(t)("copilot.pls_choose_dataset"),class:"label ellipsis"},b(a(t)("copilot.pls_choose_dataset")),9,br),m("div",Vr,[i(Pe,{teleported:!1,modelValue:e.value.treeDatasetId,"onUpdate:modelValue":n[8]||(n[8]=c=>e.value.treeDatasetId=c),data:W.value,placeholder:a(t)("copilot.pls_choose_dataset"),onChange:hl,props:Zl,placement:"bottom","render-after-expand":!1,filterable:"","popper-class":"dataset-tree"},{default:r(({node:c,data:D})=>[m("div",kr,[D.leaf?G("",!0):(s(),R(y,{key:0,size:"18px"},{default:r(()=>[i(o,null,{default:r(()=>[i(a(Xl),{class:"svg-icon"})]),_:1})]),_:1})),D.leaf?(s(),R(y,{key:1,size:"18px"},{default:r(()=>[i(o,null,{default:r(()=>[i(a(et),{class:"svg-icon"})]),_:1})]),_:1})):G("",!0),m("span",{class:"label-tree ellipsis",style:{"margin-left":"8px"},title:c.label},b(c.label),9,Tr)])]),_:1},8,["modelValue","data","placeholder"])])])):G("",!0),e.value.displayType==="9"?(s(),k("div",Cr,[m("div",Mr,[z(b(a(t)("v_query.tree_structure_design"))+" ",1),e.value.treeFieldList&&e.value.treeFieldList.length?(s(),R(Se,{key:0,text:"",onClick:jl},{icon:r(()=>[i(N,null,{default:r(()=>[i(a(Ra),{class:"svg-icon"})]),_:1})]),_:1})):G("",!0)]),m("div",Fr,[e.value.treeFieldList&&e.value.treeFieldList.length?(s(!0),k(X,{key:0},ce(e.value.treeFieldList,(c,D)=>(s(),k("div",{key:c.id,class:"tree-field"},[m("span",Sr,b(a(t)("visualization.level"))+b(Tt[D]),1),m("span",wr,[i(y,null,{default:r(()=>[i(o,null,{default:r(()=>[(s(),R(ze(a(sa)[a(ke)[c.deType]]),{class:be([`field-icon-${a(ke)[c.deType]}`,"svg-icon"])},null,8,["class"]))]),_:2},1024)]),_:2},1024)]),m("span",{class:"field-tree_name ellipsis",title:c.name},b(c.name),9,qr),D===0?(s(),k("span",$r,b(a(t)("common.associated_chart_first")),1)):(s(),k("span",Ar,[i(Se,{text:"",onClick:Ge=>Cl(D)},{default:r(()=>[z(b(a(t)("common.associated_chart")),1)]),_:1},8,["onClick"])]))]))),128)):(s(),R(Se,{key:1,class:"start-tree_design",onClick:jl,text:""},{icon:r(()=>[i(o,{name:"icon_add_outlined"},{default:r(()=>[i(a(cl),{class:"svg-icon"})]),_:1})]),default:r(()=>[z(" "+b(a(t)("v_query.the_tree_structure")),1)]),_:1}))]),i(ai,{ref_key:"treeDialog",ref:Wl,onSaveTree:Et},null,512)])):G("",!0),["1","7"].includes(e.value.displayType)?(s(),k("div",Ir,[m("div",{title:a(t)("v_query.time_granularity"),class:"label ellipsis"},b(a(t)("v_query.time_granularity")),9,Dr),m("div",Nr,[e.value.displayType==="7"&&!V.value?(s(),R(a(Ue),{key:0,onChange:Hl,placeholder:a(t)("v_query.the_time_granularity"),onFocus:ta,modelValue:e.value.timeGranularityMultiple,"onUpdate:modelValue":n[9]||(n[9]=c=>e.value.timeGranularityMultiple=c)},{default:r(()=>[i(_e,{label:a(t)("chart.y"),value:"yearrange"},null,8,["label"]),i(_e,{label:a(t)("chart.y_M"),value:"monthrange"},null,8,["label"]),i(_e,{label:a(t)("chart.y_M_d"),value:"daterange"},null,8,["label"]),i(_e,{label:a(t)("chart.y_M_d_H_m_s"),value:"datetimerange"},null,8,["label"])]),_:1},8,["placeholder","modelValue"])):(s(),R(a(Ue),{key:1,onChange:zl,placeholder:a(t)("v_query.the_time_granularity"),modelValue:e.value.timeGranularity,"onUpdate:modelValue":n[10]||(n[10]=c=>e.value.timeGranularity=c)},{default:r(()=>[(s(!0),k(X,null,ce(Ta.value,c=>(s(),R(_e,{key:c.value,label:c.label,value:c.value},null,8,["label","value"]))),128))]),_:1},8,["placeholder","modelValue"]))])])):G("",!0),["1","7","8","9","22"].includes(e.value.displayType)?G("",!0):(s(),k("div",Or,[m("div",{title:a(t)("v_query.option_value_source"),class:"label ellipsis"},b(a(t)("v_query.option_value_source")),9,Er),m("div",Rr,[m("div",Lr,[i(de,{class:"larger-radio",onChange:nl,modelValue:e.value.optionValueSource,"onUpdate:modelValue":n[11]||(n[11]=c=>e.value.optionValueSource=c)},{default:r(()=>[i(K,{disabled:!!e.value.parameters.length,label:0},{default:r(()=>[z(b(a(t)("chart.margin_model_auto")),1)]),_:1},8,["disabled"]),i(K,{label:1},{default:r(()=>[z(b(a(t)("chart.select_dataset")),1)]),_:1}),i(K,{label:2},{default:r(()=>[z(b(a(t)("v_query.manual_input")),1)]),_:1})]),_:1},8,["modelValue"])]),e.value.optionValueSource===1?(s(),k(X,{key:0},[m("div",xr,[i(Pe,{teleported:!1,modelValue:e.value.dataset.id,"onUpdate:modelValue":n[12]||(n[12]=c=>e.value.dataset.id=c),data:W.value,placeholder:a(t)("copilot.pls_choose_dataset"),onChange:tl,onCurrentChange:yl,props:Zl,placement:"bottom","render-after-expand":!1,filterable:"","popper-class":"dataset-tree"},{default:r(({node:c,data:D})=>[m("div",Ur,[D.leaf?G("",!0):(s(),R(y,{key:0,size:"18px"},{default:r(()=>[i(o,{name:"dv-folder"},{default:r(()=>[i(a(Xl),{class:"svg-icon"})]),_:1})]),_:1})),D.leaf?(s(),R(y,{key:1,size:"18px"},{default:r(()=>[i(o,{name:"icon_dataset"},{default:r(()=>[i(a(et),{class:"svg-icon"})]),_:1})]),_:1})):G("",!0),m("span",{class:"label-tree ellipsis",style:{"margin-left":"8px"},title:c.label},b(c.label),9,Yr)])]),_:1},8,["modelValue","data","placeholder"])]),m("div",Gr,[m("span",{title:a(t)("v_query.query_field"),class:"label"},b(a(t)("v_query.query_field")),9,Br),i(a(Ue),{onChange:Ga,placeholder:a(t)("v_query.query_field"),class:"search-field",modelValue:e.value.field.id,"onUpdate:modelValue":n[13]||(n[13]=c=>e.value.field.id=c)},Ea({default:r(()=>[(s(!0),k(X,null,ce(e.value.dataset.fields.filter(c=>c.deType===+e.value.displayType||[3,4].includes(c.deType)&&+e.value.displayType==2||c.deType===7&&+e.value.displayType==0),c=>(s(),R(_e,{key:c.id,label:c.name,value:c.id,disabled:c.desensitized},{default:r(()=>[m("div",{class:"flex-align-center icon",title:c.desensitized?a(t)("v_query.as_query_conditions"):""},[i(y,null,{default:r(()=>[i(o,{className:`field-icon-${a(ke)[c.deType]}`},{default:r(()=>[(s(),R(ze(a(sa)[a(ke)[c.deType]]),{class:be(["svg-icon",`field-icon-${a(ke)[c.deType]}`])},null,8,["class"]))]),_:2},1032,["className"])]),_:2},1024),m("span",null,b(c.name),1)],8,Wr)]),_:2},1032,["label","value","disabled"]))),128))]),_:2},[e.value.field.id?{name:"prefix",fn:r(()=>[i(y,null,{default:r(()=>[i(o,null,{default:r(()=>[(s(),R(ze(a(sa)[a(ke)[B(e.value.field.id,e.value.dataset.fields)]]),{class:be(["svg-icon",`field-icon-${a(ke)[B(e.value.field.id,e.value.dataset.fields)]}`])},null,8,["class"]))]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["placeholder","modelValue"])]),m("div",jr,[m("span",{title:a(t)("v_query.display_field"),class:"label ellipsis"},b(a(t)("v_query.display_field")),9,Pr),i(a(Ue),{placeholder:a(t)("v_query.display_field"),class:"search-field",modelValue:e.value.displayId,"onUpdate:modelValue":n[14]||(n[14]=c=>e.value.displayId=c),onChange:Dt},Ea({default:r(()=>[(s(!0),k(X,null,ce(wt.value,c=>(s(),R(_e,{key:c.id,label:c.name,value:c.id,disabled:c.desensitized},{default:r(()=>[m("div",{class:"flex-align-center icon",title:c.desensitized?a(t)("v_query.as_query_conditions"):""},[i(y,null,{default:r(()=>[i(o,{className:`field-icon-${a(ke)[c.deType]}`},{default:r(()=>[(s(),R(ze(a(sa)[a(ke)[c.deType]]),{class:be(["svg-icon",`field-icon-${a(ke)[c.deType]}`])},null,8,["class"]))]),_:2},1032,["className"])]),_:2},1024),m("span",null,b(c.name),1)],8,zr)]),_:2},1032,["label","value","disabled"]))),128))]),_:2},[e.value.displayId?{name:"prefix",fn:r(()=>[i(y,null,{default:r(()=>[i(o,null,{default:r(()=>[(s(),R(ze(a(sa)[a(ke)[B(e.value.displayId,e.value.dataset.fields)]]),{class:be(["svg-icon",`field-icon-${a(ke)[B(e.value.displayId,e.value.dataset.fields)]}`])},null,8,["class"]))]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["placeholder","modelValue"])]),m("div",Hr,[m("span",Qr,b(a(t)("chart.total_sort_field")),1),m("div",null,[i(a(Ue),{clearable:"",placeholder:a(t)("v_query.the_sorting_field"),modelValue:e.value.sortId,"onUpdate:modelValue":n[15]||(n[15]=c=>e.value.sortId=c),class:"sort-field",style:{width:"240px"},onChange:It},Ea({default:r(()=>[(s(!0),k(X,null,ce(e.value.dataset.fields,c=>(s(),R(_e,{key:c.id,label:c.name,value:c.id,disabled:c.desensitized},{default:r(()=>[m("div",{class:"flex-align-center icon",title:c.desensitized?a(t)("v_query.as_query_conditions"):""},[i(y,null,{default:r(()=>[i(o,null,{default:r(()=>[(s(),R(ze(a(sa)[a(ke)[c.deType]]),{class:be([`field-icon-${a(ke)[c.deType]}`,"svg-icon"])},null,8,["class"]))]),_:2},1024)]),_:2},1024),m("span",null,b(c.name),1)],8,Zr)]),_:2},1032,["label","value","disabled"]))),128))]),_:2},[e.value.sortId?{name:"prefix",fn:r(()=>[i(y,null,{default:r(()=>[i(o,null,{default:r(()=>[(s(),R(ze(a(sa)[a(ke)[B(e.value.sortId,e.value.dataset.fields)]]),{class:be(["svg-icon",`field-icon-${a(ke)[B(e.value.sortId,e.value.dataset.fields)]}`])},null,8,["class"]))]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["placeholder","modelValue"]),i(a(Ue),{class:"sort-type",modelValue:e.value.sort,"onUpdate:modelValue":n[16]||(n[16]=c=>e.value.sort=c),onChange:Ga},{default:r(()=>[i(_e,{label:a(t)("chart.asc"),value:"asc"},null,8,["label"]),i(_e,{label:a(t)("chart.desc"),value:"desc"},null,8,["label"]),i(_e,{onClick:Ot,title:ja.value?l.$t("v_query.display_sort"):"",disabled:ja.value,label:a(t)("v_query.custom_sort"),value:"customSort"},null,8,["title","disabled","label"])]),_:1},8,["modelValue"])])])],64)):G("",!0),e.value.optionValueSource===2?(s(),k("div",Kr,[i(aa,{placement:"bottom-start","popper-class":"manual-input",ref_key:"manual",ref:Re,width:358,trigger:"click"},{reference:r(()=>[i(Se,{text:""},{icon:r(()=>[i(o,{name:"icon_edit_outlined"},{default:r(()=>[i(a(Ra),{class:"svg-icon"})]),_:1})]),default:r(()=>[z(" "+b(a(t)("common.edit")),1)]),_:1})]),default:r(()=>[m("div",Jr,[m("div",Xr,b(a(t)("auth.manual_input")),1),m("div",es,[m("span",null,b(a(t)("data_fill.form.option_value")),1),(s(!0),k(X,null,ce(p.value,(c,D)=>(s(),k("div",{key:D,class:"select-item"},[e.value.displayType==="2"?(s(),R(U,{key:0,maxlength:"64",onBlur:Gl,modelValue:p.value[D],"onUpdate:modelValue":Ge=>p.value[D]=Ge,modelModifiers:{number:!0}},null,8,["modelValue","onUpdate:modelValue"])):(s(),R(U,{key:1,maxlength:"64",onBlur:Gl,modelValue:p.value[D],"onUpdate:modelValue":Ge=>p.value[D]=Ge},null,8,["modelValue","onUpdate:modelValue"])),p.value.length!==1?(s(),R(Se,{key:2,onClick:Ge=>p.value.splice(D,1),class:"value",text:""},{icon:r(()=>[i(o,{name:"icon_delete-trash_outlined"},{default:r(()=>[i(a(Ol),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])):G("",!0)]))),128))]),m("div",as,[i(Se,{onClick:n[17]||(n[17]=c=>p.value.push("")),text:""},{icon:r(()=>[i(o,{name:"icon_add_outlined"},{default:r(()=>[i(a(cl),{class:"svg-icon"})]),_:1})]),default:r(()=>[z(" "+b(a(t)("data_fill.form.add_option")),1)]),_:1})]),m("div",ls,[i(Se,{onClick:xl},{default:r(()=>[z(b(a(t)("chart.cancel")),1)]),_:1}),i(Se,{onClick:qt,type:"primary"},{default:r(()=>[z(b(a(t)("chart.confirm")),1)]),_:1})])])]),_:1},512),e.value.valueSource.length?(s(),k("div",ts,b(a(t)("v_query.configured")),1)):G("",!0)])):G("",!0)]),m("div",{class:"label ellipsis",title:a(t)("v_query.of_option_values"),style:{"margin-top":"10.5px"}},b(a(t)("v_query.of_option_values")),9,ns),m("div",is,[i(de,{class:"larger-radio",modelValue:e.value.resultMode,"onUpdate:modelValue":n[18]||(n[18]=c=>e.value.resultMode=c)},{default:r(()=>[i(K,{label:0},{default:r(()=>[z(b(a(t)("chart.default")),1)]),_:1}),i(K,{label:1},{default:r(()=>[z(b(a(t)("data_set.all")),1)]),_:1})]),_:1},8,["modelValue"])])])),e.value.displayType==="8"?(s(),k("div",us,[m("div",{title:a(t)("v_query.condition_type"),class:"label ellipsis"},b(a(t)("v_query.condition_type")),9,rs),m("div",ss,[m("div",os,[i(de,{class:"larger-radio",modelValue:e.value.conditionType,"onUpdate:modelValue":n[19]||(n[19]=c=>e.value.conditionType=c)},{default:r(()=>[i(K,{label:0},{default:r(()=>[z(b(a(t)("v_query.single_condition")),1)]),_:1}),i(K,{label:1,disabled:!!e.value.parameters.length},{default:r(()=>[z(b(a(t)("v_query.with_condition")),1)]),_:1},8,["disabled"]),i(K,{label:2,disabled:!!e.value.parameters.length},{default:r(()=>[z(b(a(t)("v_query.or_condition")),1)]),_:1},8,["disabled"])]),_:1},8,["modelValue"])])])])):G("",!0),e.value.displayType==="8"?(s(),k("div",ds,[i(xe,{modelValue:e.value.hideConditionSwitching,"onUpdate:modelValue":n[20]||(n[20]=c=>e.value.hideConditionSwitching=c),label:a(t)("v_query.hide_condition_switch")},null,8,["modelValue","label"])])):G("",!0),i(Uu,{ref_key:"defaultConfigurationRef",ref:x,onHandleTimeTypeChange:Ut,"cur-component":e.value},null,8,["cur-component"])],512),[[ot,e.value.displayType!=="9"&&pe.value&&!oe.value||e.value.displayType==="9"&&Je.value==0]]),oe.value&&pe.value?(s(),k("div",cs,[i(wl,{description:a(t)("v_query.cannot_be_performed"),"img-type":"error"},null,8,["description"])])):e.value.displayType==="9"&&Je.value!==0?(s(),k("div",vs,[i(wl,{description:a(t)("common.other_levels"),"img-type":"error"},null,8,["description"])])):pe.value?G("",!0):(s(),k("div",ms,[i(wl,{description:a(t)("v_query.be_linked_first"),"img-type":"noneWhite"},null,8,["description"])]))]),_:1})],2)):G("",!0)])]),_:1},8,["modelValue","title"]),i(Ee,{title:ma.value,modelValue:fe.value,"onUpdate:modelValue":n[27]||(n[27]=c=>fe.value=c),width:"420px"},{footer:r(()=>[i(Se,{secondary:"",onClick:n[26]||(n[26]=c=>fe.value=!1)},{default:r(()=>[z(b(a(t)("chart.cancel")),1)]),_:1}),i(Se,{type:"primary",onClick:ka},{default:r(()=>[z(b(a(t)("chart.confirm")),1)]),_:1})]),default:r(()=>[i(na,{"label-position":"top"},{default:r(()=>[i(fa,{label:a(t)("v_query.time_type"),class:"form-item",prop:"name"},{default:r(()=>[i(de,{modelValue:Ve.value,"onUpdate:modelValue":n[25]||(n[25]=c=>Ve.value=c)},{default:r(()=>[i(K,{label:0},{default:r(()=>[z(b(a(t)("data_set.time")),1)]),_:1}),i(K,{label:1},{default:r(()=>[z(b(a(t)("datasource.start_time")),1)]),_:1}),i(K,{label:2},{default:r(()=>[z(b(a(t)("datasource.end_time")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1},8,["title","modelValue"]),i(Ee,{title:pa.value,modelValue:ua.value,"onUpdate:modelValue":n[30]||(n[30]=c=>ua.value=c),width:"420px"},{footer:r(()=>[i(Se,{secondary:"",onClick:n[29]||(n[29]=c=>ua.value=!1)},{default:r(()=>[z(b(a(t)("dataset.cancel")),1)]),_:1}),i(Se,{type:"primary",onClick:ha},{default:r(()=>[z(b(a(t)("dataset.confirm")),1)]),_:1})]),default:r(()=>[i(na,{"label-position":"top"},{default:r(()=>[i(fa,{label:a(t)("chart.map_line_type"),class:"form-item",prop:"name"},{default:r(()=>[i(de,{modelValue:ea.value,"onUpdate:modelValue":n[28]||(n[28]=c=>ea.value=c)},{default:r(()=>[i(K,{label:0},{default:r(()=>[z(b(a(t)("chart.value_formatter_value")),1)]),_:1}),i(K,{label:1},{default:r(()=>[z(b(a(t)("chart.min")),1)]),_:1}),i(K,{label:2},{default:r(()=>[z(b(a(t)("chart.max")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1},8,["title","modelValue"]),i(Wn,{ref_key:"customSortFilterRef",ref:Bl,onSave:Nt},null,512),i(a(bl),{onSaveCascade:Te,ref_key:"cascadeDialog",ref:il},null,512)],64)}}});const ys=al(),{componentData:tt,canvasViewInfo:_s}=pl(ys),hs=()=>{const L=()=>{let u=tt.value.filter(t=>!["VQuery","DeTabs"].includes(t.innerType)&&t.component!=="Group");return tt.value.forEach(t=>{t.innerType==="DeTabs"?t.propValue.forEach(v=>{u=[...u,...v.componentData.filter(d=>!["VQuery","DeTabs"].includes(d.innerType)&&d.component!=="Group")],v.componentData.forEach(d=>{d.component==="Group"&&(u=[...u,d.propValue.filter(f=>!["VQuery","DeTabs"].includes(f.innerType)&&f.component!=="Group")])})}):t.component==="Group"&&(u=[...u,t.propValue.filter(v=>!["VQuery","DeTabs"].includes(v.innerType)&&v.component!=="Group")],t.propValue.forEach(v=>{v.innerType==="DeTabs"&&v.propValue.forEach(d=>{u=[...u,...d.componentData.filter(f=>!["VQuery","DeTabs"].includes(f.innerType)&&f.component!=="Group")]})}))}),u.flat()};return{datasetFieldList:O(()=>L().map(u=>{const t=_s.value[u.id];if(!t)return null;const{id:v,title:d,tableId:f,type:F}=t;return v&&f?{id:v,type:F,title:d,tableId:f}:null}).filter(u=>!!u))}},gs={class:"condition-type"},bs={key:0,class:"condition-type"},Vs={class:"condition-type-tip"},ks=Ke({__name:"TextSearch",props:{config:{type:Object,default:()=>({id:"",conditionType:0,queryConditionWidth:0,conditionValueOperatorF:"eq",conditionValueF:"",conditionValueOperatorS:"like",conditionValueS:"",defaultConditionValueOperatorF:"eq",defaultConditionValueF:"",defaultConditionValueOperatorS:"like",defaultConditionValueS:""})},isConfig:{type:Boolean,default:!1}},setup(L){const w=Ye("placeholder"),{t:u}=_a(),t=O(()=>{var J;return(J=w==null?void 0:w.value)!=null&&J.placeholderShow?F.config.placeholder:" "}),v=[{label:u("v_query.exact_match"),value:"eq"},{label:u("v_query.fuzzy_match"),value:"like"}],d=al(),{dvInfo:f}=pl(d),F=L,{config:x}=ia(F),S=()=>{const{defaultConditionValueOperatorF:J,defaultConditionValueF:I,defaultConditionValueOperatorS:A,defaultConditionValueS:Te}=x.value;x.value.conditionValueOperatorF=J,x.value.conditionValueF=I,x.value.conditionValueOperatorS=A,x.value.conditionValueS=Te};Sa(()=>{S()});const H=Ye("com-width",Function,!0),ee=Ye("$custom-style-filter"),p=Ye("is-confirm-search",Function,!0),T=()=>{var J;return(J=w==null?void 0:w.value)!=null&&J.placeholderShow?F.config.queryConditionWidth===void 0?H():F.config.queryConditionWidth:227},C=O(()=>({width:T()+"px"})),ie=()=>{if(!F.isConfig){Me(()=>{p(x.value.id)});return}},g=O(()=>({width:T()-15+"px",background:ee.border})),ne=()=>{ie()},te=J=>{J.stopPropagation()};return(J,I)=>{const A=xa,Te=Ue,Ce=Il;return s(),k("div",{onMousedown:te,class:"text-search-select",style:Ie({background:a(ee).background})},[m("div",gs,[a(x).hideConditionSwitching?G("",!0):(s(),R(Te,{key:0,class:"condition-value-select",onChange:ie,effect:a(f).type==="dataV"?"dark":"","popper-class":"condition-value-select-popper",modelValue:a(x).conditionValueOperatorF,"onUpdate:modelValue":I[0]||(I[0]=e=>a(x).conditionValueOperatorF=e)},{default:r(()=>[(s(),k(X,null,ce(v,e=>i(A,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["effect","modelValue"])),i(Ce,{style:Ie(C.value),placeholder:t.value,onBlur:ie,onKeydown:Jl(ne,["enter"]),class:"condition-value-input",modelValue:a(x).conditionValueF,"onUpdate:modelValue":I[1]||(I[1]=e=>a(x).conditionValueF=e)},null,8,["style","placeholder","modelValue"]),m("div",{style:Ie(g.value),class:"bottom-line"},null,4)]),[1,2].includes(a(x).conditionType)?(s(),k("div",bs,[m("span",Vs,b(a(x).conditionType===1?a(u)("chart.and"):a(u)("chart.or")),1),a(x).hideConditionSwitching?G("",!0):(s(),R(Te,{key:0,class:"condition-value-select",onChange:ie,effect:a(f).type==="dataV"?"dark":"","popper-class":"condition-value-select-popper",modelValue:a(x).conditionValueOperatorS,"onUpdate:modelValue":I[2]||(I[2]=e=>a(x).conditionValueOperatorS=e)},{default:r(()=>[(s(),k(X,null,ce(v,e=>i(A,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["effect","modelValue"])),i(Ce,{style:Ie(C.value),onBlur:ie,placeholder:t.value,onKeydown:Jl(ne,["enter"]),class:"condition-value-input",modelValue:a(x).conditionValueS,"onUpdate:modelValue":I[3]||(I[3]=e=>a(x).conditionValueS=e)},null,8,["style","placeholder","modelValue"]),m("div",{style:Ie(g.value),class:"bottom-line next-line"},null,4)])):G("",!0)],36)}}});const Ts=Ua(ks,[["__scopeId","data-v-7609c165"]]),Cs=Ke({__name:"NumberInput",props:{config:{type:Object,default:()=>({id:"",queryConditionWidth:0,defaultNumValueEnd:"",defaultNumValueStart:"",numValueEnd:"",numValueStart:"",defaultValueCheck:!1})},isConfig:{type:Boolean,default:!1}},setup(L){ml(T=>({"1a26f7c8":p.value}));const w=Ye("placeholder"),u=O(()=>{var T;return(T=w==null?void 0:w.value)!=null&&T.placeholderShow?t.config.placeholder:" "}),t=L,{config:v}=ia(t),d=()=>{if(!v.value.defaultValueCheck){v.value.numValueEnd=void 0,v.value.numValueStart=void 0;return}const{defaultNumValueEnd:T,defaultNumValueStart:C}=v.value;v.value.numValueEnd=T,v.value.numValueStart=C};Sa(()=>{d()});const f=Ye("com-width",Function,!0),F=Ye("$custom-style-filter"),x=Ye("is-confirm-search",Function,!0),S=()=>{var T;return(T=w==null?void 0:w.value)!=null&&T.placeholderShow?t.config.queryConditionWidth===void 0?f():t.config.queryConditionWidth:227},H=O(()=>({width:S()+"px"})),ee=()=>{if(!t.isConfig){Me(()=>{x(v.value.id)});return}},p=O(()=>F.border);return(T,C)=>{const ie=vl;return s(),k("div",{class:"num-search-select",style:Ie({background:a(F).background})},[i(ie,{placeholder:u.value,onChange:ee,style:Ie(H.value),"controls-position":"right",modelValue:a(v).numValueStart,"onUpdate:modelValue":C[0]||(C[0]=g=>a(v).numValueStart=g)},null,8,["placeholder","style","modelValue"]),C[2]||(C[2]=m("div",{class:"num-value_line"},null,-1)),i(ie,{placeholder:u.value,style:Ie(H.value),onChange:ee,"controls-position":"right",modelValue:a(v).numValueEnd,"onUpdate:modelValue":C[1]||(C[1]=g=>a(v).numValueEnd=g)},null,8,["placeholder","style","modelValue"])],4)}}});const Ms=Ua(Cs,[["__scopeId","data-v-a8f5ce09"]]),Fs=Ke({__name:"StyleInject",props:{config:{type:Object,default:()=>({selectValue:"",defaultValue:"",displayType:"",defaultValueCheck:!1,optionValueSource:0,multiple:!1,checkedFieldsMap:{}})},customStyle:{type:Object,default:()=>({border:"",background:"",text:""})}},setup(L){const w=L,u=t=>t==="8"?Ts:t==="22"?Ms:["1","7"].includes(t)?gt:t==="9"?kt:Vt;return ga("$custom-style-filter",w.customStyle),(t,v)=>(s(),R(ze(u(L.config.displayType)),{config:L.config,"is-config":!1},null,8,["config"]))}}),Ss={key:0,class:"no-list-label flex-align-center"},ws={class:"container flex-align-center"},qs={class:"query-fields-container"},$s={class:"label-wrapper"},As={key:0,class:"required"},Is={key:0,class:"label-wrapper-tooltip"},Ds={class:"query-select"},Ns={key:0,class:"query-button"},Os=Ke({__name:"Component",props:{view:{type:Object,default(){return{customStyle:""}}},element:{type:Object,default(){return{id:null,propValue:[]}}},showPosition:{type:String,required:!0,default:""},scale:{type:Number,required:!1,default:1}},setup(L){ml(V=>({"96fc8394":Q.value,"00b37138":De.value,"7c31e292":j.value,b1237f5a:Te.value.rawColor,"9162e482":Te.value.hoverColor,"5e4339bc":Ce.value,"0a65b1b0":e.value,"5b545c7c":Re.value}));const w=L,{element:u,view:t,scale:v}=ia(w),{t:d}=_a(),f=Z(),F=al(),{curComponent:x,canvasViewInfo:S,mobileInPc:H,firstLoadMap:ee,editMode:p}=pl(F),T=Z(!1),C=Z(),g=st({...{border:"",placeholderSize:14,placeholderShow:!0,background:"",text:"",layout:"horizontal",btnList:["sure"],titleLayout:"left",titleShow:!1,titleColor:"",textColorShow:!1,labelShow:!0,title:"",labelColor:"#1f2329",fontSize:"14",fontWeight:"",fontStyle:"",fontSizeBtn:"14",fontWeightBtn:"",fontStyleBtn:"",queryConditionWidth:227,nameboxSpacing:8,queryConditionSpacing:16,queryConditionHeight:32,btnColor:"#3370ff",labelColorBtn:"#ffffff"}}),ne=dt(),te=navigator.userAgent.toLowerCase(),J=/lark/i.test(te),I=O(()=>{const V={color:g.labelColorBtn};return g.fontSizeBtn&&(V.fontSize=g.fontSizeBtn+"px"),g.fontWeightBtn&&(V.fontWeight=g.fontWeightBtn),g.fontStyleBtn&&(V.fontStyle=g.fontStyleBtn),V});function A(V){let _=V.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(","),le=parseFloat(_[3]||1),re=Math.floor(le*parseInt(_[0])+(1-le)*255),P=Math.floor(le*parseInt(_[1])+(1-le)*255),ue=Math.floor(le*parseInt(_[2])+(1-le)*255);return"#"+("0"+re.toString(16)).slice(-2)+("0"+P.toString(16)).slice(-2)+("0"+ue.toString(16)).slice(-2)}const Te=O(()=>{let V=g.btnColor;return g.btnColor.startsWith("rgb")&&(V=A(g.btnColor)),V.startsWith("#")&&(V=V.substr(1)),{rawColor:g.btnColor??"#3370ff",hoverColor:g.btnColor?Pa.mix(new ba("ffffff"),new ba(V),{value:15}).toRGB():"#5285FF",activeColor:g.btnColor?Pa.mix(new ba("000000"),new ba(V),{value:15}).toRGB():"#2B5FD9"}}),Ce=O(()=>Te.value.rawColor),e=O(()=>Te.value.hoverColor),Re=O(()=>Te.value.activeColor),De=O(()=>g.background&&!g.background.toLowerCase().includes("#ffffff")?Pa.mix(new ba("ffffff"),new ba(g.background.substr(1)),{value:15}).toRGB():"#f0f2f5"),ge=O(()=>{const V={backgroundColor:"transparent",borderColor:g.btnColor,color:g.btnColor};return g.fontSizeBtn&&(V.fontSize=g.fontSizeBtn+"px"),g.fontWeightBtn&&(V.fontWeight=g.fontWeightBtn),g.fontStyleBtn&&(V.fontStyle=g.fontStyleBtn),V}),W=O(()=>(S.value[u.value.id]||{}).customStyle),{datasetFieldList:h}=hs(),ye=V=>{const{borderColor:_,btnList:le,titleLayout:re,labelColor:P,text:ue,bgColor:Ae,layout:je,titleShow:Ta,titleColor:$a,title:Ya,fontSize:ll,fontWeight:Oa,fontStyle:Aa,fontSizeBtn:yl,fontWeightBtn:_l,fontStyleBtn:tl,queryConditionWidth:hl,nameboxSpacing:Ga,queryConditionSpacing:nl,queryConditionHeight:Ba,labelColorBtn:gl,btnColor:bl,placeholderSize:il,placeholderShow:Vl,labelShow:Ia}=V;g.background=Ae||"",g.border=_||"",g.btnList=[...le],g.layout=je,g.placeholderShow=Vl??!0,g.placeholderSize=il??14,Me(()=>{f.value.style.setProperty("--ed-component-size",`${g.placeholderSize+18}px`)}),g.titleShow=Ta,g.titleColor=$a,g.labelColor=Ia&&P||"",g.fontSize=Ia&&ll||"14",g.fontWeight=Ia&&Oa||"",g.fontStyle=Ia&&Aa||"",g.title=Ya,g.text=g.placeholderShow&&ue||"",g.titleLayout=re,g.fontSizeBtn=yl||"14",g.fontWeightBtn=_l,g.fontStyleBtn=tl,g.queryConditionWidth=hl??227,g.nameboxSpacing=Ga??8,g.queryConditionSpacing=nl??16,g.queryConditionHeight=Ba??32,g.labelColorBtn=gl||"#ffffff",g.labelShow=Ia??!0,g.btnColor=bl||"#3370ff",ne.recordSnapshotCache("setCustomStyle")};me(()=>t.value,V=>{var _,le;(_=V==null?void 0:V.customStyle)!=null&&_.component&&ye((le=V==null?void 0:V.customStyle)==null?void 0:le.component)},{deep:!0,immediate:!0}),me(()=>W.value,V=>{V!=null&&V.component&&ye(V==null?void 0:V.component)},{deep:!0,immediate:!0});const B=Z([]);me(()=>w.element.propValue,()=>{B.value=[...w.element.propValue]},{immediate:!0});const pe=()=>{x.value.id!==u.value.id&&(T.value=!1)},{emitter:oe}=Na(),Ne=el([]);Sa(()=>{Ne.value=B.value.map(V=>V.id),(w.element.cascade||[]).forEach(V=>{V.forEach(_=>{_.currentSelectValue=_.selectValue})})});const We=V=>{Ne.value=Ne.value.filter(_=>_!==V)},He=V=>{var le;let _=Object.entries(V.checkedFieldsMap).filter(re=>V.checkedFields.includes(re[0]));return V.displayType==="9"&&(_=((le=V.treeCheckedList)!=null&&le.length?V.treeCheckedList.filter((re,P)=>P<V.treeFieldList.length):V.treeFieldList.map(()=>({checkedFields:[...V.checkedFields],checkedFieldsMap:we(V.checkedFieldsMap)}))).map(re=>Object.entries(re.checkedFieldsMap).filter(P=>re.checkedFields.includes(P[0]))).flat()),_.filter(re=>!!re[1]).map(re=>re[0])},oa=V=>{u.value.propValue.forEach(_=>{var le;if(V.some(re=>_.checkedFields.includes(re))&&_.required)if(_.displayType==="8"){const{conditionValueF:re,conditionValueS:P,conditionType:ue}=_;ue===0&&re===""?_.conditionValueF=_.defaultConditionValueF:(re===""||P==="")&&(_.conditionValueF=_.defaultConditionValueF,_.conditionValueS=_.defaultConditionValueS)}else _.displayType==="22"?(_.numValueStart!==0&&!_.numValueStart||_.numValueEnd!==0&&!_.numValueEnd)&&(_.numValueStart=_.defaultNumValueStart,_.numValueEnd=_.defaultNumValueEnd):(Array.isArray(_.selectValue)&&!_.selectValue.length||_.selectValue!==0&&!_.selectValue)&&(_.optionValueSource===1&&((le=_.defaultMapValue)!=null&&le.length||_.displayId)&&![1,7].includes(+_.displayType)?(_.mapValue=_.defaultMapValue,_.selectValue=_.multiple?_.defaultMapValue:_.defaultMapValue[0]):_.selectValue=_.defaultValue)})},da=V=>{let _="",le="";const re=(u.value.propValue||[]).filter(P=>P.id===V).reduce((P,ue)=>{if(ue.required)if(ue.defaultValueCheck||(_=ue.name),ue.displayType==="8"){const{conditionValueF:je,conditionValueS:Ta,conditionType:$a}=ue;$a===0?_=je===""?ue.name:"":_=[je||"",Ta||""].filter(Ya=>Ya!=="").length<2?ue.name:""}else ue.displayType==="22"?(ue.numValueStart!==0&&!ue.numValueStart||ue.numValueEnd!==0&&!ue.numValueEnd)&&(_=ue.name):(Array.isArray(ue.selectValue)&&!ue.selectValue.length||ue.selectValue!==0&&!ue.selectValue)&&(_=ue.name);ue.displayType==="22"&&(!isNaN(ue.numValueEnd)&&!isNaN(ue.numValueStart)&&ue.numValueEnd<ue.numValueStart&&(le=ue.name),[ue.numValueEnd,ue.numValueStart].filter(je=>![null,void 0,""].includes(je)).length===1&&(_=ue.name));const Ae=He(ue);return P=[...new Set([...Ae,...P])],P},[]);if(_){$e.error(`${_}${d("v_query.before_querying")}`);return}if(le){$e.error(`${le}${d("v_query.the_minimum_value")}`);return}re.length&&(oa(re),re.forEach(P=>{oe.emit(`query-data-${P}`)}))},Va=()=>g.queryConditionWidth,Qe=()=>w.element.cascade,$=O(()=>({placeholderShow:g.placeholderShow}));ga("is-confirm-search",(V,_=!1)=>{E.value&&!_||da(V)}),ga("unmount-select",Ne),ga("release-unmount-select",We),ga("query-data-for-id",da),ga("com-width",Va),ga("cascade-list",Qe),ga("placeholder",$),an(()=>{oe.off(`addQueryCriteria${u.value.id}`),oe.off(`editQueryCriteria${u.value.id}`),oe.off(`updateQueryCriteria${u.value.id}`),ln.off("componentClick",pe)});const Y=()=>{F.mobileInPc&&!Sl()||Array.isArray(u.value.propValue)&&u.value.propValue.forEach(V=>{if(V.auto){const _={datasetId:V.dataset.id,id:V.field.id},le=[],re={};h.value.forEach(P=>{P.tableId===_.datasetId&&(le.push(P.id),re[P.id]=_.id)}),V.checkedFields=le,V.checkedFieldsMap=re}else{if(!V.dataset.id||V.parameters.length||V.optionValueSource!==1||![0,2,5].includes(+V.displayType))return;const _=h.value.map(le=>le.id);V.checkedFields.forEach(le=>{_.includes(le)||(V.checkedFieldsMap[le]="")}),V.checkedFields=V.checkedFields.filter(le=>_.includes(le))}})};Nl(()=>{oe.on(`addQueryCriteria${u.value.id}`,ea),oe.on(`editQueryCriteria${u.value.id}`,ua),oe.on(`updateQueryCriteria${u.value.id}`,Y),Y(),F.mobileInPc&&!Sl()&&ae()});const fe=()=>{},Ve=V=>{JSON.parse(V.dataTransfer.getData("dimension")||"{}").forEach(le=>{const re=[],P={};h.value.forEach(Ae=>{Ae.tableId===le.datasetId&&(re.push(Ae.id),P[Ae.id]=le.id)});const ue=le.deType===7?0:`${le.deType}`;B.value.push({...ft(le),auto:!0,optionValueSource:1,checkedFields:re,checkedFieldsMap:P,displayType:ue})}),u.value.propValue=[...B.value],ne.recordSnapshotCache("drop")},ma=V=>{C.value.setCondition(V)},ua=()=>{if(!B.value.length){ea();return}ma(B.value[0].id)},ea=()=>{C.value.setConditionOut()},pa=(V,_)=>{const le=_.map(P=>P.id),re=(V||[]).reduce((P,ue)=>{if(le.includes(ue.id))return P;const Ae=He(ue);return P=[...new Set([...Ae,...P])],P},[]);re.length&&re.forEach(P=>{oe.emit(`query-data-${P}`)})},ka=V=>{const _=we(a(B));B.value.splice(V,1),u.value.propValue=[...B.value],ne.recordSnapshotCache("delQueryConfig"),pa(_,we(a(B)))},ca=()=>{(B.value||[]).reduce((V,_)=>{var re;_.conditionValueF=_.defaultConditionValueF,_.conditionValueOperatorF=_.defaultConditionValueOperatorF,_.conditionValueS=_.defaultConditionValueS,_.conditionValueOperatorS=_.defaultConditionValueOperatorS,_.displayType==="22"&&(_.numValueEnd=_.defaultNumValueEnd,_.numValueStart=_.defaultNumValueStart),_.defaultValueCheck||(_.defaultValue=_.multiple||+_.displayType==7?[]:void 0),_.selectValue=Array.isArray(_.defaultValue)?[..._.defaultValue]:_.defaultValue,_.optionValueSource===1&&((re=_.defaultMapValue)!=null&&re.length)&&(_.mapValue=Array.isArray(_.defaultMapValue)?[..._.defaultMapValue]:_.defaultMapValue),(w.element.cascade||[]).forEach(P=>{P.forEach(ue=>{const Ae=ue.datasetId.split("--")[1];_.id===Ae&&(ue.currentSelectValue=Array.isArray(_.selectValue)?_.selectValue:[_.selectValue].filter(je=>![null,void 0].includes(je)),Na().emitter.emit(`${ue.datasetId.split("--")[1]}-select`))})});const le=He(_);return V=[...new Set([...le,...V])],V},[]),!E.value&&ae()},wa=()=>{(w.element.cascade||[]).forEach(V=>{V.forEach(_=>{var le;(le=_.currentSelectValue)!=null&&le.length&&(Na().emitter.emit(`${_.datasetId.split("--")[1]}-select`),_.currentSelectValue=[])})}),(B.value||[]).reduce((V,_)=>{var re;if(!_.visible)return V;_.selectValue=_.multiple||+_.displayType==7?[]:void 0,_.optionValueSource===1&&((re=_.defaultMapValue)!=null&&re.length)&&(_.mapValue=_.multiple?[]:void 0),_.conditionValueF="",_.conditionValueS="",_.displayType==="22"&&(_.numValueEnd=void 0,_.numValueStart=void 0);const le=He(_);return V=[...new Set([...le,...V])],V},[]),!E.value&&ae()},ha=O(()=>B.value.filter(V=>V.visible)),E=O(()=>g.btnList.includes("sure"));me(()=>E.value,(V,_)=>{!V&&_&&ae()},{immediate:!1});const Q=O(()=>`${g.placeholderSize}px`),j=O(()=>`${g.queryConditionHeight||32}px`),ae=()=>{let V="",_="";const le=(u.value.propValue||[]).reduce((re,P)=>{if(P.required)if(P.defaultValueCheck||(V=P.name),P.displayType==="8"){const{conditionValueF:Ae,conditionValueS:je,conditionType:Ta}=P;Ta===0?V=Ae===""?P.name:"":V=[Ae||"",je||""].filter($a=>$a!=="").length<2?P.name:""}else P.displayType==="22"?(P.numValueEnd!==0&&!P.numValueEnd||P.numValueStart!==0&&!P.numValueStart)&&(V=P.name):(Array.isArray(P.selectValue)&&!P.selectValue.length||P.selectValue!==0&&!P.selectValue)&&(V=P.name);P.displayType==="22"&&(!isNaN(P.numValueEnd)&&!isNaN(P.numValueStart)&&P.numValueEnd<P.numValueStart&&(_=P.name),[P.numValueEnd,P.numValueStart].filter(Ae=>![null,void 0,""].includes(Ae)).length===1&&(V=P.name));const ue=He(P);return re=[...new Set([...ue,...re])],re},[]);if(V){$e.error(`${V}${d("v_query.before_querying")}`);return}if(_){$e.error(`${_}${d("v_query.the_minimum_value")}`);return}le.length&&(F.mobileInPc&&!Sl()||F.setFirstLoadMap([...new Set([...le,...ee.value])]),le.forEach(re=>{oe.emit(`query-data-${re}`)}))},se=O(()=>({textAlign:g.titleLayout||"left",color:g.titleColor||"#1f2329"})),qe=O(()=>{const V={fontSize:g.fontSize+"px",lineHeight:+g.fontSize+8+"px"};return g.fontWeight&&(V.fontWeight=g.fontWeight),g.fontStyle&&(V.fontStyle=g.fontStyle),g.labelColor&&(V.color=g.labelColor),V}),Le=O(()=>g.labelShow?g.layout:"horizontal"),la=O(()=>({paddingTop:Le.value!=="horizontal"?g.nameboxSpacing+22+"px":"0"})),qa=O(()=>({marginRight:Le.value==="horizontal"?g.nameboxSpacing+"px":"8px"})),va=O(()=>un()||J?{position:"absolute",height:100/v.value+"%!important",width:100/v.value+"%!important",left:50*(1-1/v.value)+"%",top:50*(1-1/v.value)+"%",transform:"scale("+v.value+") translateZ(0)"}:{zoom:v.value});return(V,_)=>{const le=Za,re=Dl,P=La,ue=ql;return s(),k(X,null,[m("div",{class:"v-query-container",ref_key:"vQueryRef",ref:f,style:Ie(va.value),onKeydown:_[0]||(_[0]=Be(()=>{},["stop"])),onKeyup:_[1]||(_[1]=Be(()=>{},["stop"]))},[g.titleShow?(s(),k("p",{key:0,class:"title",style:Ie(se.value)},b(g.title),5)):G("",!0),m("div",{class:be(["v-query",Le.value,g.titleShow&&!!g.title&&"title-show"]),onDragover:Be(fe,["prevent","stop"]),onDrop:Be(Ve,["prevent","stop"])},[ha.value.length?G("",!0):(s(),k("div",Ss,[m("div",ws,[z(b(a(d)("v_query.here_or_click"))+" ",1),i(le,{disabled:L.showPosition==="preview"||a(H)||a(p)==="preview",onClick:ea,style:{"font-family":"inherit"},text:""},{default:r(()=>[z(b(a(d)("v_query.add_query_condition")),1)]),_:1},8,["disabled"])])])),m("div",qs,[(s(!0),k(X,null,ce(ha.value,(Ae,je)=>(s(),k("div",{class:"query-item",style:Ie({marginRight:`${g.queryConditionSpacing}px`}),key:Ae.id},[m("div",{class:"query-field",style:Ie(la.value)},[m("div",{class:"label",style:Ie(qa.value)},[za(m("div",$s,[m("div",{class:"label-wrapper-text",style:Ie(qe.value)},[i(re,{"popper-class":"label-wrapper-text_tooltip",effect:"dark",content:Ae.name,"show-arrow":!1,placement:"top-start"},{default:r(()=>[z(b(Ae.name),1)]),_:2},1032,["content"])],4),Ae.required?(s(),k("span",As,"*")):G("",!0)],512),[[ot,g.labelShow]]),L.showPosition!=="preview"&&!a(F).mobileInPc&&a(p)!=="preview"?(s(),k("div",Is,[i(re,{effect:"dark",content:a(d)("v_query.set_filter_condition"),placement:"top"},{default:r(()=>[i(ue,{onClick:Ta=>ma(Ae.id)},{default:r(()=>[i(P,{name:"icon_edit_outlined"},{default:r(()=>[i(a(Ra),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["content"]),i(re,{effect:"dark",content:a(d)("v_query.delete_condition"),placement:"top"},{default:r(()=>[i(ue,{style:{"margin-left":"8px"},onClick:Ta=>ka(je)},{default:r(()=>[i(P,{name:"icon_delete-trash_outlined"},{default:r(()=>[i(a(Ol),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["content"])])):G("",!0)],4),m("div",Ds,[g.queryConditionWidth!==0?(s(),R(Fs,{key:0,customStyle:g,config:Ae},null,8,["customStyle","config"])):G("",!0)])],4)],4))),128)),ha.value.length?(s(),k("div",Ns,[g.btnList.includes("clear")?(s(),R(le,{key:0,onClick:Be(wa,["stop"]),style:Ie(ge.value),plain:""},{default:r(()=>[z(b(a(d)("commons.clear")),1)]),_:1},8,["style"])):G("",!0),g.btnList.includes("reset")?(s(),R(le,{key:1,onClick:Be(ca,["stop"]),style:Ie(ge.value),plain:""},{default:r(()=>[z(b(a(d)("chart.reset")),1)]),_:1},8,["style"])):G("",!0),E.value?(s(),R(le,{key:2,onClick:Be(ae,["stop"]),style:Ie([{"margin-right":"7px"},I.value]),type:"primary"},{default:r(()=>[z(b(a(d)("commons.adv_search.search")),1)]),_:1},8,["style"])):G("",!0)])):G("",!0)])],34)],36),(s(),R(rt,{to:"body"},[i(fs,{"query-element":a(u),onQueryData:ae,ref_key:"queryConfig",ref:C,onReRenderAll:pa},null,8,["query-element"])]))],64)}}});const Es=Ua(Os,[["__scopeId","data-v-d64136b5"]]),ko=Object.freeze(Object.defineProperty({__proto__:null,default:Es},Symbol.toStringTag,{value:"Module"}));export{ko as C,Es as V,Un as d};

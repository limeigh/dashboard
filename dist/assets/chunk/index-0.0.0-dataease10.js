import{b as jl,c as Pl,u as Yl,y as Zl,S as Xl,a as zl,R as Jl,z as Wl}from"./index-0.0.0-dataease.js";import{E as Kl}from"./el-date-picker-0.0.0-dataease.js";import{n as y,j as V,v as Ft,o as Ql,F as lt,D as fe,Q as eo,G as to,y as ao}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import"./el-input-number-0.0.0-dataease.js";import{E as lo}from"./el-row-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import{E as oo,a as so}from"./el-select-0.0.0-dataease.js";import{E as no}from"./el-col-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import{E as io,a as ro}from"./el-form-item-0.0.0-dataease.js";import{E as uo}from"./el-dialog-0.0.0-dataease.js";import{E as co}from"./el-drawer-0.0.0-dataease.js";import{E as mo,a as po}from"./el-collapse-item-0.0.0-dataease.js";import{r as ga,E as fo}from"./AddSql-0.0.0-dataease.js";import"./el-cascader-panel-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import"./el-radio-0.0.0-dataease.js";import{a as vo,E as _o}from"./el-table-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import{E as go}from"./el-tree-0.0.0-dataease.js";import{E as ho,a as yo}from"./el-tabs-0.0.0-dataease.js";import{E as bo}from"./el-tree-select-0.0.0-dataease.js";import{E as Co}from"./el-switch-0.0.0-dataease.js";import{f as c,O as h,a5 as Na,d as wo,r as v,X as kt,w as To,s as Ye,y as Ze,o as xo,a as Fo,n as ve,R as K,P as m,j as l,i as s,u as a,W as de,a4 as p,_ as A,a3 as T,U as Ee,T as Xe,S,g as b,l as O,a6 as Ne,h as ko,L as ha,al as Vo,ak as Eo}from"./vue-0.0.0-dataease.js";import{d as No}from"./dv-folder-0.0.0-dataease.js";import{i as ya}from"./icon_left_outlined-0.0.0-dataease.js";import{i as Lo}from"./icon_right_outlined-0.0.0-dataease.js";import{i as Do}from"./icon_organization_outlined-0.0.0-dataease.js";import{i as So}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{i as ba}from"./icon_add_outlined-0.0.0-dataease.js";import{i as Io}from"./icon_refresh_outlined-0.0.0-dataease.js";import{i as Ca}from"./icon_expand-right_filled-0.0.0-dataease.js";import{F as wa,i as Ta}from"./FieldMore-0.0.0-dataease.js";import{i as xa}from"./icon_copy_outlined-0.0.0-dataease.js";import{i as Vt}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import{i as Fa}from"./icon_edit_outlined-0.0.0-dataease.js";import{i as Uo}from"./icon_info_outlined-0.0.0-dataease.js";import{d as ka}from"./dayjs.min-0.0.0-dataease.js";import{i as Ao,a as Mo}from"./field-calculated-list-0.0.0-dataease.js";import{n as $o,o as qo,h as Ho,q as Ro,r as Bo,s as Va,t as Oo}from"./dataset-0.0.0-dataease.js";import{F as Go}from"./fixed-size-list-0.0.0-dataease.js";import{E as jo}from"./EmptyBackground-0.0.0-dataease.js";import Po from"./CalcFieldEdit-0.0.0-dataease.js";import Yo from"./UnionEdit-0.0.0-dataease.js";import Zo from"./CreatDsGroup-0.0.0-dataease.js";import{a as Xo,g as Le,b as Ea}from"./util-0.0.0-dataease.js";import{f as G}from"./attr-0.0.0-dataease23.js";import{useAppStoreWithOut as zo}from"./app-0.0.0-dataease.js";import{_ as Jo}from"./DatasetUnion.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import{i as X}from"./field-list-0.0.0-dataease.js";import{i as Wo}from"./datasource-list-0.0.0-dataease.js";import{e as M,h as Ko}from"./lodash-0.0.0-dataease.js";import{E as Qo}from"./index-0.0.0-dataease4.js";import{E as es}from"./index-0.0.0-dataease20.js";import{_ as ts}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./arrays-0.0.0-dataease.js";import"./index-0.0.0-dataease18.js";import"./index-0.0.0-dataease5.js";import"./axios-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./constants-0.0.0-dataease.js";import"./index-0.0.0-dataease6.js";import"./token-0.0.0-dataease.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease3.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./index-0.0.0-dataease15.js";import"./el-empty-0.0.0-dataease.js";import"./el-virtual-list-0.0.0-dataease.js";import"./raf-0.0.0-dataease.js";import"./el-table-v2-0.0.0-dataease.js";import"./el-popover-0.0.0-dataease.js";import"./dropdown-0.0.0-dataease.js";import"./el-divider-0.0.0-dataease.js";import"./icon_close_outlined-0.0.0-dataease.js";import"./icon_info_colorful-0.0.0-dataease.js";import"./index-0.0.0-dataease19.js";import"./CodeMirror-0.0.0-dataease.js";import"./GridTable-0.0.0-dataease.js";import"./el-pagination-0.0.0-dataease.js";import"./ModelUtil-0.0.0-dataease.js";import"./index-0.0.0-dataease27.js";import"./dv-rename-0.0.0-dataease.js";import"./icon_calendar_outlined-0.0.0-dataease.js";import"./more_v-0.0.0-dataease.js";import"./none-0.0.0-dataease.js";import"./nothing-tree-0.0.0-dataease.js";import"./icon_adjustment_outlined-0.0.0-dataease.js";import"./UnionFieldList-0.0.0-dataease.js";import"./UnionItemEdit-0.0.0-dataease.js";import"./icon_right-association-0.0.0-dataease.js";import"./join-join-0.0.0-dataease.js";import"./treeSortUtils-0.0.0-dataease.js";import"./icon_rename_outlined-0.0.0-dataease.js";import"./icon_more-vertical_outlined-0.0.0-dataease.js";import"./HandleMore.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import"./el-dropdown-menu-0.0.0-dataease.js";import"./el-dropdown-item-0.0.0-dataease.js";import"./icon_more_outlined-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./tslib.es6-0.0.0-dataease.js";import"./antv-0.0.0-dataease.js";const as={width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"};function ls(_e,re){return c(),h("svg",as,[...re[0]||(re[0]=[Na('<g id="icon_sql_outlined"><g id="Union"><path d="M3.73875 8.736V8.60266H2.66342L2.66143 8.73398C2.65762 8.98596 2.70337 9.21143 2.8045 9.40559C2.90241 9.59358 3.03463 9.74989 3.2009 9.87261L3.20211 9.87349C3.3693 9.99402 3.55876 10.0807 3.76906 10.1343C3.97937 10.1906 4.19515 10.2187 4.41609 10.2187C4.68545 10.2187 4.92669 10.1874 5.1378 10.1222C5.34961 10.0578 5.53149 9.96695 5.67904 9.84731C5.82907 9.72491 5.94364 9.57892 6.02023 9.40962C6.09609 9.24194 6.13342 9.06129 6.13342 8.86933C6.13342 8.638 6.08342 8.4359 5.97261 8.27307C5.87491 8.12108 5.7558 7.99733 5.61464 7.90457C5.48072 7.81656 5.34269 7.75187 5.20064 7.71214C5.07741 7.67346 4.97621 7.64561 4.899 7.62994C4.66262 7.56996 4.4704 7.52058 4.32226 7.48178C4.18072 7.4438 4.0736 7.40713 3.99797 7.37258C3.92618 7.33811 3.89834 7.30959 3.88964 7.29545C3.87812 7.27672 3.86675 7.24291 3.86675 7.184C3.86675 7.12132 3.88029 7.0814 3.89769 7.05529C3.92312 7.01714 3.95447 6.98562 3.99243 6.96002C4.03522 6.93355 4.0822 6.91475 4.13422 6.9038C4.19294 6.89144 4.25129 6.88533 4.30942 6.88533C4.405 6.88533 4.48995 6.89359 4.56489 6.9092L4.56594 6.90941C4.64097 6.92441 4.70351 6.94919 4.75555 6.98206C4.80217 7.0115 4.83972 7.05217 4.86856 7.10724L4.87099 7.11148C4.9008 7.16365 4.92211 7.23655 4.92835 7.33631L4.93616 7.46133H6.00542V7.328C6.00542 7.09131 5.95973 6.88155 5.86141 6.70462C5.76997 6.5303 5.64409 6.38644 5.48455 6.27477C5.32744 6.16479 5.1483 6.08729 4.94889 6.04109C4.75657 5.9922 4.55573 5.968 4.34675 5.968C4.1639 5.968 3.98152 5.99278 3.7999 6.04197C3.61506 6.09203 3.44764 6.1696 3.29886 6.27531C3.14805 6.38246 3.02504 6.51755 2.93035 6.67931L2.92983 6.6802C2.83438 6.84621 2.78942 7.03894 2.78942 7.25333C2.78942 7.44367 2.82432 7.61498 2.90011 7.76235L2.90236 7.76637C2.9785 7.90262 3.07744 8.01798 3.19896 8.11115C3.31621 8.20104 3.44808 8.27454 3.59378 8.33205L3.59666 8.33311C3.73574 8.38435 3.87835 8.42826 4.02447 8.46486C4.16423 8.50425 4.3023 8.54011 4.43869 8.57241C4.56867 8.60319 4.68311 8.63868 4.78257 8.67846C4.87681 8.71616 4.94548 8.76069 4.99377 8.80898L4.99639 8.81146C5.03435 8.84742 5.05609 8.89446 5.05609 8.96533C5.05609 9.03643 5.03834 9.08573 5.01058 9.12208C4.9741 9.16593 4.92816 9.20162 4.87076 9.22895C4.80857 9.25856 4.74142 9.2797 4.66879 9.29204C4.5892 9.30189 4.51569 9.30666 4.44809 9.30666C4.34875 9.30666 4.2533 9.29554 4.16148 9.27356C4.07296 9.24893 3.99768 9.21464 3.93414 9.17183C3.87737 9.12793 3.83023 9.07132 3.79305 8.99982C3.75907 8.93447 3.73875 8.84836 3.73875 8.736Z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M10.2467 9.94025L9.76461 9.50152C9.89584 9.33145 9.99908 9.1408 10.0745 8.93029C10.1655 8.67632 10.2103 8.40319 10.2103 8.112C10.2103 7.8142 10.1656 7.53601 10.0748 7.27859C9.98421 7.01824 9.85316 6.78963 9.68094 6.59445C9.50771 6.39812 9.29635 6.24476 9.04862 6.13423C8.79781 6.02233 8.51571 5.968 8.20496 5.968C7.89747 5.968 7.61574 6.02243 7.36199 6.13393L7.3613 6.13423C7.11358 6.24476 6.90221 6.39812 6.72898 6.59445C6.55676 6.78963 6.42571 7.01824 6.33512 7.27859C6.24431 7.53601 6.19963 7.8142 6.19963 8.112C6.19963 8.40321 6.24468 8.67847 6.33544 8.93563C6.42627 9.18921 6.55759 9.41246 6.72985 9.60386C6.90306 9.79631 7.11415 9.94752 7.36129 10.0578L7.36355 10.0587C7.61689 10.1662 7.89807 10.2187 8.20496 10.2187C8.54665 10.2187 8.84912 10.1569 9.10796 10.0284L9.67299 10.5375L10.2467 9.94025ZM7.99391 9.01558L8.25457 9.2529C8.23915 9.25318 8.22262 9.25333 8.20496 9.25333C8.03365 9.25333 7.89703 9.22114 7.78956 9.16335C7.67575 9.09853 7.585 9.01485 7.5154 8.91196C7.44287 8.80474 7.3886 8.68419 7.35307 8.54932C7.32015 8.4071 7.30363 8.26139 7.30363 8.112C7.30363 7.95492 7.32028 7.80354 7.35333 7.65762C7.38906 7.5153 7.44346 7.39173 7.51541 7.28538L7.51639 7.28389C7.586 7.17796 7.67614 7.09532 7.78838 7.03465L7.79077 7.03329C7.8979 6.97249 8.03399 6.93866 8.20496 6.93866C8.37593 6.93866 8.51201 6.97251 8.61913 7.03331L8.62156 7.03463C8.73379 7.09529 8.82391 7.17797 8.89352 7.28389L8.89452 7.28537C8.96615 7.39126 9.01866 7.51431 9.05091 7.65622L9.05161 7.659C9.08798 7.80449 9.10629 7.95539 9.10629 8.112C9.10629 8.30607 9.08578 8.46482 9.04792 8.59102C9.02689 8.6611 9.00256 8.72358 8.97527 8.77894L8.56563 8.4047L7.99391 9.01558Z"></path><path d="M11.62 6.05866H10.516V10.1333H13.476V9.16266H11.62V6.05866Z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M1.33341 2C0.965225 2 0.666748 2.29848 0.666748 2.66667V13.3333C0.666748 13.7015 0.965225 14 1.33341 14H14.6667C15.0349 14 15.3334 13.7015 15.3334 13.3333V2.66667C15.3334 2.29848 15.0349 2 14.6667 2H1.33341ZM2.00008 3.33333V12.6667H14.0001V3.33333H2.00008Z"></path></g></g>',1)])])}const os={render:ls},ss={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function ns(_e,re){return c(),h("svg",ss,[...re[0]||(re[0]=[Na('<g clip-path="url(#clip0_1052_111876)"><path d="M8.00033 15.3332C12.0504 15.3332 15.3337 12.0499 15.3337 7.99984C15.3337 3.94975 12.0504 0.666504 8.00033 0.666504C3.95024 0.666504 0.666992 3.94975 0.666992 7.99984C0.666992 12.0499 3.95024 15.3332 8.00033 15.3332Z" fill="#FF8800"></path><path d="M7.66634 4.6665C7.48225 4.6665 7.33301 4.81574 7.33301 4.99984V8.99984C7.33301 9.18393 7.48225 9.33317 7.66634 9.33317H8.33301C8.5171 9.33317 8.66634 9.18393 8.66634 8.99984V4.99984C8.66634 4.81574 8.5171 4.6665 8.33301 4.6665H7.66634Z" fill="white"></path><path d="M7.66634 9.99984C7.48225 9.99984 7.33301 10.1491 7.33301 10.3332V10.9998C7.33301 11.1839 7.48225 11.3332 7.66634 11.3332H8.33301C8.5171 11.3332 8.66634 11.1839 8.66634 10.9998V10.3332C8.66634 10.1491 8.5171 9.99984 8.33301 9.99984H7.66634Z" fill="white"></path></g><defs><clipPath id="clip0_1052_111876"><rect width="16" height="16" fill="white"></rect></clipPath></defs>',2)])])}const is={render:ns},ds={class:"de-dataset-form"},rs={class:"top"},us={class:"name"},cs={key:0,class:"ed-form-item__error"},ms={class:"oprate"},ps={class:"table-list-top"},fs={class:"select-ds"},vs={class:"left-outlined"},_s={class:"flex-align-center icon"},gs={key:0},hs={class:"select-ds table-num"},ys={class:"num"},bs={key:0,class:"el-empty"},Cs={class:"el-empty__description",style:{"margin-top":"80px",color:"#5e6d82","text-align":"center"}},ws={key:1,class:"table-checkbox-list"},Ts={class:"label"},xs=["title","onDragstart","onClick"],Fs={class:"label"},ks={key:0,class:"different-datasource"},Vs={class:"sql-title"},Es={class:"field-data"},Ns={class:"table-preview"},Ls={class:"preview-field"},Ds={class:"custom-tree-node father"},Ss=["title"],Is={class:"operate child"},Us={class:"custom-tree-node father"},As=["title"],Ms={class:"operate child"},$s={class:"preview-data"},qs={class:"flex-align-center"},Hs=["title"],Rs={class:"batch-area"},Bs={class:"manage-container"},Os={class:"column-style"},Gs={class:"column-style"},js={key:0,style:{color:"#8d9199"}},Ps={key:1,style:{color:"#8d9199"}},Ys={key:2},Zs={class:"column-style"},Xs={key:0},zs={key:1,style:{color:"#8d9199"}},Js={key:1,style:{"padding-left":"30px"}},Ws={class:"select-svg-icon"},Ks={class:"column-style"},Qs={key:0,style:{color:"#8d9199"}},en={key:1,style:{color:"#8d9199"}},tn={key:2,class:"flex-align-center icon"},an={class:"column-style"},ln={class:"column-style"},on={key:0},sn={key:1,style:{color:"#8d9199"}},nn={class:"column-style"},dn={key:0},rn={key:1,style:{color:"#8d9199"}},un={class:"select-svg-icon"},cn={class:"column-style"},mn={key:0,style:{color:"#8d9199"}},pn={key:1,style:{color:"#8d9199"}},fn={key:2,class:"flex-align-center icon"},vn={key:0,class:"batch-operate flex-align-center"},_n={class:"flex-align-center"},gn={class:"num"},hn={class:"cascader-batch"},yn={class:"select-svg-icon"},bn={class:"grouping_settings_label"},Cn={style:{width:"100%"}},wn={key:1,class:"group-fields_num"},Tn={class:"name"},xn={class:"group-fields_item",style:{"align-items":"center"}};function Fn(_e){return typeof _e=="function"||Object.prototype.toString.call(_e)==="[object Object]"&&!Eo(_e)}const kn=wo({__name:"index",setup(_e){const{wsCache:re}=jl(),De=zo(),le=Pl(),{t:d}=Ql(),ot=Yl(),{push:La}=Zl()||{push:t=>{le.getToken||(window.location.href=t)}},ze=v(238),Et=v(),ge=v(!1),j=v(),he=v(!1),N=v(),Q=v(d("data_set.unnamed_dataset")),ye=v("preview"),Da=v(""),oe=v(""),Se=v(""),Ie=v(!1),st=v(!1),ue=v(240),Nt=v(0),Lt=v(0),be=v(!0),Je=v(!1),Ce=v(!1),se=v(!1),Dt=v(),nt=v({}),E=v({dateFormat:"",id:"",dateFormatType:"",name:"",idArr:[]}),P=v(!1);let it=!1;const St=t=>[d("dataset.text"),d("dataset.time"),d("dataset.value"),d("dataset.value")+"("+d("dataset.float")+")",d("dataset.value"),d("dataset.location")][t],dt=()=>{it=!0},rt=[{label:d("dataset.text"),value:0},{label:d("dataset.time"),value:1,children:[{value:"yyyy-MM-dd",label:"yyyy-MM-dd"},{value:"yyyy/MM/dd",label:"yyyy/MM/dd"},{value:"yyyy-MM-dd HH:mm:ss",label:"yyyy-MM-dd HH:mm:ss"},{value:"yyyy/MM/dd HH:mm:ss",label:"yyyy/MM/dd HH:mm:ss"},{value:"custom",label:d("visualization.custom")}]},{label:d("dataset.location"),value:5},{label:d("dataset.value"),value:2},{label:d("dataset.value")+"("+d("dataset.float")+")",value:3},{label:"URL",value:7}],ut=[{label:d("dataset.text"),value:0},{label:d("dataset.time"),value:1},{label:d("dataset.location"),value:5},{label:d("dataset.value"),value:2},{label:d("dataset.value")+"("+d("dataset.float")+")",value:3},{label:"URL",value:7}],It=v(),Ut=v(),Sa={name:[{required:!0,message:d("data_set.cannot_be_empty_time"),trigger:"blur"}]},Ia={name:[{required:!0,message:d("dataset.input_edit_name"),trigger:"blur"}]},ct=kt({datasourceId:"",name:"",tableName:d("data_set.custom_sql"),type:"sql"});let Y={id:"",pid:"",name:""};const At={children:"children",label:"label"},q=v(260);let mt=[];const Mt=(t,e)=>{let n="";return t.some(i=>{var u;return i.id===e?(n=i.name,!0):((u=i.children)!=null&&u.length&&(n=Mt(i.children,e)||n),!1)}),n},{height:Ua}=Xl(),pt=t=>t.filter(e=>{var n,i;return e.leaf?!0:((n=e.children)!=null&&n.length&&(e.children=pt(e.children||[])),!!((i=e.children)!=null&&i.length))}),Aa=t=>Mt(H.dataSourceList,t),Ue=()=>{if(re.set("dataset-info-id",Y.id),De.isDataEaseBi){le.clearState(),zl().emitter.emit("changeCurrentComponent","Dataset");return}const t=le.getToken&&De.getIsIframe?"dataset-embedded":"dataset";history.state.back&&!De.getIsIframe?history.back():La({name:t,params:{id:Y.id}})},Ma=()=>{it?lt.confirm(d("data_set.want_to_exit"),{confirmButtonText:d("dataset.confirm"),cancelButtonText:d("common.cancel"),showCancelButton:!0,confirmButtonType:"primary",type:"warning",autofocus:!1,showClose:!1}).then(()=>{Ue()}):Ue()},$a=()=>{if(E.value.idArr.length){const{idArr:t}=E.value;f.value.forEach(e=>{t.includes(e.id)&&Object.assign(e,{deTypeArr:[...et]})}),delete E.value.name,Fe()}else te.value.concat(ee.value).some(t=>t.id===E.value.id?(delete E.value.name,Object.assign(t,{deTypeArr:[...et]}),!0):!1);E.value.idArr=[],E.value.id="",se.value=!1},qa=()=>{if(E.value.idArr.length){const{name:t,idArr:e}=E.value;f.value.forEach(n=>{e.includes(n.id)&&Object.assign(n,{deType:1,dateFormatType:"custom",dateFormat:t,deTypeArr:[1,"custom"]})}),delete E.value.name,Fe(),se.value=!1}else It.value.validate(t=>{t&&(te.value.concat(ee.value).some(e=>e.id===E.value.id?(e.dateFormat=E.value.name,e.deType=1,e.dateFormatType="custom",!0):!1),se.value=!1)})};To(Se,t=>{J.value=mt.filter(e=>e.tableName.toLowerCase().includes(t.toLowerCase()))});const Ha=()=>{const t=[];Ce.value=!0,Te(t,N.value.getNodeList()),Oo({...Y,name:Q.value,union:t,isCross:P.value,allFields:f.value,nodeType:"dataset"}).then(()=>{it=!1,fe.success(d("data_set.saved_successfully")),xt&&Ue()}).finally(()=>{Ce.value=!1})},z=(t,e)=>{dt(),ye.value==="manage"&&(Be.value=me.value.getSelectionRows().map(i=>i.id),Oe.value=ce.value.getSelectionRows().map(i=>i.id));const n=["text","time","value","float","value","location","binary","url"];if(n.includes(e)){t.deType=n.indexOf(e),t.dateFormat="";return}switch(Xo.includes(e)&&(E.value.dateFormat=t.dateFormat,E.value.dateFormatType=t.dateFormatType,t.deType=1,t.dateFormatType=e,t.dateFormat=e),e){case"copy":t.extField===3?Ga(t):Ba(t);break;case"delete":Pa(t);break;case"translate":Ra(t.id);break;case"editor":t.extField===3?cl(t):Xa(t);break;case"rename":Za(t);break;case"custom":E.value.id=t.id,se.value=!0;break}ye.value==="manage"&&Fe()},Ra=t=>{const e=f.value.find(n=>n.id===t);e.groupType=e.groupType==="d"?"q":"d"},$t=t=>{const e=pe.value.map(n=>n.id);f.value.forEach(n=>{e.includes(n.id)&&(n.groupType=t)}),Fe()},Ba=t=>{const e=M(t);e.id=Le(),e.extField=2,e.originName=t.extField===2?t.originName:"["+t.id+"]",e.name=Ea(te.value.concat(ee.value),t.name),e.dataeaseName=null,e.lastSyncTime=null;const n=f.value.findIndex(i=>i.id===t.id);f.value.splice(n+1,0,e)},Oa=t=>![3].includes(t.extField),Ga=t=>{const e=M(t);e.id=Le(),e.name=Ea(te.value.concat(ee.value),t.name);const n=f.value.findIndex(i=>i.id===t.id);f.value.splice(n+1,0,e)},qt=t=>{const e=[...t];for(;e.length;){const[n]=e;e.shift(),f.value=f.value.filter(r=>r.id!==n);const i=f.value.reduce((r,g)=>(g.extField===2&&(r=[...r,...(g.params||[]).map(F=>F.id)]),r),[]),u=f.value.map(r=>r.id).concat(i);f.value=f.value.filter(r=>{if(![2,3].includes(r.extField))return!0;const g=r.originName.match(/\[(.+?)\]/g)||[];return!g||g.every(L=>{const k=L.slice(1,-1);return u.includes(k)})?!0:(e.push(r.id),!1)})}ll()},ja=(t,e)=>{const n=[...t];let i=[];for(;n.length;){const[u]=n;n.shift(),e=e.filter(g=>g.id!==u);const r=e.map(g=>g.id);e=e.filter(g=>{if(![2,3].includes(g.extField))return!0;const F=g.originName.match(/\[(.+?)\]/g)||[];return!F||F.every(k=>{var w;return(w=g.params)==null?void 0:w.map(I=>I.id).includes(k.slice(1,-1))})||F.every(k=>{const w=k.slice(1,-1);return r.includes(w)})?!0:(n.push(g.id),i.push(g.id),!1)})}return i},Pa=t=>{let e="";e=f.value.reduce((i,u)=>{if(![2,3].includes(u.extField))return i;let r=u.originName.match(/\[(.+?)\]/g)||[];return r=r.filter(F=>{var L;return!((L=u.params)!=null&&L.map(k=>k.id).includes(F.slice(1,-1)))}),i=[...r.map(F=>F.slice(1,-1)),...i],i},[]).includes(t.id)?d("data_set.deleted_confirm_deletion"):"",lt.confirm(d("data_set.delete_field_a",{a:t.name}),{confirmButtonText:d("dataset.confirm"),tip:e,cancelButtonText:d("common.cancel"),showCancelButton:!0,confirmButtonType:"danger",type:"warning",autofocus:!1,showClose:!1,callback:i=>{i==="confirm"&&(qt([t.id]),N.value.dfsNodeFieldBackReal(t),fe({message:d("chart.delete_success"),type:"success"}))}})},Ya=t=>{ge.value=!0,ft.value=d("dataset.add_calc_field"),ve(()=>{j.value.initEdit({groupType:t,id:Le()},te.value.filter(e=>e.extField!==3),ee.value.filter(e=>e.extField!==3))})},We=v(!1),ne=v({id:"",name:""}),Za=t=>{const{id:e,name:n}=t;ne.value={id:e,name:n},We.value=!0},ft=v(""),Xa=t=>{ge.value=!0,ve(()=>{ft.value=d("dataset.edit_calc_field"),j.value.initEdit(t,te.value,ee.value)})},Ht=()=>{ne.value.id="",ne.value.name="",We.value=!1},za=()=>{Ut.value.validate(t=>{t&&(f.value.some(e=>e.id===ne.value.id?(e.name=ne.value.name,!0):!1),Ht())})},Ja=()=>{ge.value=!1},Wa=()=>{j.value.formField.validate(t=>{if(t){if(j.value.setFieldForm(),!j.value.fieldForm.originName.trim()){fe.error(d("data_set.cannot_be_empty_de_"));return}const e=M(j.value.fieldForm),{deType:n,dateFormat:i,deExtractType:u}=e;e.dateFormat=n===1?i:"",e.dateFormatType=n===1?i:"",e.deTypeArr=n===1&&u===0?[n,i]:[n];const r=f.value.findIndex(g=>e.id===g.id);r!==-1?f.value.splice(r,1,e):f.value.push(e),ge.value=!1}})},Ka=t=>t.map(e=>({key:e.dataeaseName,deType:e.deType,dataKey:e.dataeaseName,title:e.name,width:150,headerCellRenderer:({column:n})=>{let i;return l("div",{class:"flex-align-center"},[l(V,null,{default:()=>[l(y,null,Fn(i=ko(X[G[n.deType]],{class:`svg-icon field-icon-${G[n.deType]}`}))?i:{default:()=>[i]})]}),l("span",{class:"ellipsis",title:n.title,style:{width:"120px",marginLeft:"4px"}},[n.title])])}})),vt=t=>(st.value=!0,ct.datasourceId=oe.value,qo({datasourceId:t}).then(e=>{mt=e||[],J.value=[...mt]}).finally(()=>{st.value=!1})),Qa=async(t,e)=>{await vt(t),e&&(Se.value=e)},Ae=v(!1),Rt=v(),el=async()=>{var u;let{id:t,datasourceId:e,tableName:n}=ot.query,{id:i}=ot.params;if(De.getIsDataEaseBi&&(t=le.datasetId,e=le.datasourceId,n=le.tableName,i=le.datasetCopyId||i),Ae.value=!1,i||t){const r=await Ho(i||t);if(!r||!r.id)return;Ae.value=!0}if(e&&(oe.value=e,Qa(e,n)),!(!t&&!i)){Ce.value=!0;try{const r=await Ro(i||t);Ce.value=!1;let g=[];const{pid:F,name:L}=r||{};Y={id:(r==null?void 0:r.id)||null,pid:F,name:i?d("data_set.copy_a_dataset"):L},i&&(Y.id=""),Q.value=Y.name,f.value=r.allFields||[],P.value=r.isCross||!1,pa(g,r.union||[]);const[k]=r.union;oe.value=(u=k==null?void 0:k.currentDs)==null?void 0:u.datasourceId,vt(oe.value),N.value.initState(g)}catch(r){console.error(r),Ce.value=!1}}},tl=t=>{H.editArr=M(t),he.value=!0,ve(()=>{He.value.initState()})},Me=Ye([]),_t=Ye([]),ee=Ze(()=>f.value.filter(t=>t.groupType==="q")),te=Ze(()=>f.value.filter(t=>t.groupType==="d")),Bt=(t,e)=>{t.forEach(n=>{var i;e[n.id]=n.tableName,(i=n.children)!=null&&i.length&&Bt(n.children,e)})},Ot=t=>{t!=="preview"&&(ht(),f.value.forEach(e=>{if(!Array.isArray(e.deTypeArr))e.deTypeArr=e.deType===1&&e.deExtractType===0?[e.deType,e.dateFormatType]:[e.deType];else{const[n]=e.deTypeArr;e.deTypeArr.length&&n!==e.deType&&e.deTypeArr.splice(0,1,e.deType)}}))},gt=()=>{var t,e,n;H.nodeNameList=[...N.value.nodeNameList],dt(),(t=H.nodeNameList)!=null&&t.length||(Me.value=[],_t.value=[]),(n=(e=eo)["/datasetData/previewData"])==null||n.call(e),ae.value=!1,ht()},ht=()=>{Bt(N.value.getNodeList(),nt.value)},H=kt({nodeNameList:[],editArr:[],dataSourceList:[],fieldCollapse:["dimension","quota"]}),J=Ye([]),W=t=>{if(t===1)return"time";if(t===0)return"text";if([2,3,4].includes(t))return"value";if(t===5)return"location";if(t===7)return"url"},f=v([]);ha("allfields",f),ha("isCross",P);let al=+new Date;const $e=v(!0),qe=v(!0),Gt=(t,e,n,i)=>{t.forEach(u=>{var r;u.id||(u.id=((r=i.find(g=>g.originName===u.originName))==null?void 0:r.id)||`${++al}`,u.datasetTableId=e,u.datasourceId=n)})},jt=(t,e)=>{e.forEach(n=>{var u;(u=n.children)!=null&&u.length&&jt(t,n.children);const{currentDsFields:i}=n;t.push(...M(i))})},Pt=(t,e)=>{const n=t.map(i=>i.id);return[...e.filter(i=>![2,3].includes(i.extField)).filter(i=>!n.includes(i.id)),...e.filter(i=>[2,3].includes(i.extField))]},Yt=(t,e)=>{const n=t.map(r=>r.id),i=e.map(r=>r.id),u=t.filter(r=>!i.includes(r.id));return M([...e.filter(r=>[2,3].includes(r.extField)),...u,...e.filter(r=>n.includes(r.id))])},Zt=()=>{pl(),He.value.clearState(),he.value=!1},He=v(),yt=()=>{var n;const t=[];jt(t,N.value.getNodeList());const e=Pt(t,f.value);f.value=Yt(t,f.value),qt(e),Ot("manage"),(n=He.value)==null||n.clearState()},ll=()=>{const t=[],e=f.value.map(i=>i.id);f.value.filter(i=>i.extField===3).forEach(i=>{e.includes(i.originName)||t.push(i.id)}),f.value=f.value.filter(i=>!t.includes(i.id))},bt=(t,e)=>t.reduce((n,i)=>{var u;return i.id===e?n=[...i.currentDsFields]:(u=i.children)!=null&&u.length&&(n=bt(i.children,e)),n},[]),Xt=(t,e,n)=>{e.forEach(i=>{var u;if((u=i.children)!=null&&u.length&&Xt(t,i.children,n),!n.includes(i.id)){const{currentDsFields:r}=i;t.push(...M(r))}})},ol=()=>{const{node:t,parent:e}=He.value,n=t.id,i=e.id;if(t.unionFields.some(U=>{const{currentField:D,parentField:Z}=U;return!D||!Z})){fe.error(d("data_set.cannot_be_empty_de_field"));return}const r=bt(N.value.getNodeList(),n),g=bt(N.value.getNodeList(),i);Gt(t.currentDsFields,t.id,t.datasourceId,r),Gt(e.currentDsFields,e.id,e.datasourceId,g);const F=M(t),L=M(e);let k=[];Xt(k,N.value.getNodeList(),[t.id,e.id]),k=[...k,...t.currentDsFields,...e.currentDsFields];const w=Pt(k,f.value);let I=Yt(k,f.value);const B=ja(w,I);if(B.length){const U=f.value.reduce((D,Z)=>(B.includes(Z.id)&&(D=[...(Z.originName.match(/\[(.+?)\]/g)||[]).map(Ve=>Ve.slice(1,-1)),...D]),D),[]);lt.confirm(d("data_set.field_selection"),{confirmButtonText:d("dataset.confirm"),cancelButtonText:d("common.cancel"),showCancelButton:!0,tip:`${d("data_set.field")}: ${f.value.filter(D=>[...new Set(U)].includes(D.id)&&![2,3].includes(D.extField)).map(D=>D.name).join(",")}, ${d("data_set.confirm_the_deletion")}`,confirmButtonType:"danger",type:"warning",autofocus:!1,showClose:!1,callback:D=>{D==="confirm"&&(N.value.setStateBack(F,L),yt(),he.value=!1,gt(),N.value.setChangeStatus(n,i))}});return}N.value.setStateBack(F,L),yt(),he.value=!1,gt(),N.value.setChangeStatus(n,i)},sl=()=>{yt()},zt=[{value:"lt",label:"<"},{value:"le",label:"<="}],Jt=(t,e,n)=>{!e||!e.length?n(new Error(d("chart.value_can_not_empty"))):n()},Ke=v([]),nl={name:[{required:!0,message:d("dataset.input_edit_name"),trigger:"blur"}]},Wt={name:"",id:+new Date,datasourceId:"",datasetTableId:"",datasetGroupId:"",originName:"",otherGroup:"",groupType:"d",deType:0,type:"ANY",deExtractType:0,extField:3,deTypeOrigin:null,groupList:[{name:"",text:[],time:"",minTerm:"lt",maxTerm:"lt",min:null,max:null}]},x=kt(M(Wt)),Kt=v(),we=v(!1),Ct=v(!1),Qe=Ye([]),Qt=Ye([]),il=()=>{Qe.value=f.value.filter(t=>![2,3].includes(t.extField)),Object.assign(x,M(Wt)),x.id=Le(),wt.value=d("dataset.create_grouping_field"),we.value=!0},ea=t=>{const e=Qe.value.find(r=>r.id===t),{deType:n}=e;if((n!==x.deExtractType||n===0)&&(Ke.value=[],x.groupList=[{name:"",text:[],time:"",minTerm:"lt",maxTerm:"lt",min:null,max:null}]),x.deTypeOrigin=n,n!==0)return;Ct.value=!0;const i=[],u=M(a(f));Te(i,N.value.getNodeList()),Bo({dataset:{union:i,allFields:u,isCross:P.value},field:e}).then(r=>{Qt.value=r||[]}).finally(()=>{Ct.value=!1})},dl=()=>{we.value=!1},rl=Ze(()=>{var t;return(t=x.groupList)==null?void 0:t.map(e=>e.text).flat()}),ul=(t,e)=>rl.value.includes(t)&&!e.includes(t),wt=v(d("dataset.create_grouping_field")),cl=t=>{Qe.value=f.value.filter(n=>![2,3].includes(n.extField)),Object.assign(x,t);const e=[];t.groupList.forEach(n=>{const{name:i,text:u=[],startTime:r,endTime:g,min:F,max:L,minTerm:k,maxTerm:w}=n,I={name:i,text:u,min:F,max:L,minTerm:k,maxTerm:w,time:[]};r&&g&&(I.time=[r,g]),e.push(I)}),ea(x.originName),x.groupList=e,wt.value=d("dataset.editing_grouping_field"),we.value=!0},ml=()=>{Kt.value.validate(t=>{let e=0,n;Ke.value.forEach(i=>{i==null||i.validate(u=>{u&&e++})}),n=setTimeout(()=>{if(clearTimeout(n),n=null,t&&e===x.groupList.length){const i=[];x.groupList.forEach(r=>{const{name:g,text:F=[],time:L,min:k,max:w,minTerm:I,maxTerm:B}=r,U={name:g,text:F,min:k,max:w,minTerm:I,maxTerm:B,startTime:"",endTime:""};if(x.deTypeOrigin===1){const[D,Z]=L;U.startTime=ka(D).format("YYYY-MM-DD HH:mm:ss"),U.endTime=ka(Z).format("YYYY-MM-DD HH:mm:ss")}i.push(U)});const u=f.value.findIndex(r=>r.id===x.id);u!==-1?f.value.splice(u,1,{...x,groupList:i}):f.value.push({...x,groupList:i}),we.value=!1}},1e3)})},pl=()=>{N.value.notConfirm()},fl=()=>{x.groupList.push({name:"",text:[],time:"",minTerm:"lt",maxTerm:"lt",min:null,max:null})},vl=t=>{x.groupList.splice(t,1),Ke.value.splice(t,1)},ta=(t,e)=>{Nt.value=t.offsetX,Lt.value=t.offsetY,t.dataTransfer.setData("text/plain",JSON.stringify(e)),Je.value=!0},aa=t=>{t.unableCheck||(Da.value=t.tableName)},_l=()=>{ae.value||j.value.formField.validate(t=>{if(t){if(j.value.setFieldForm(),!j.value.fieldForm.originName.trim()){fe.error(d("data_set.cannot_be_empty_de_"));return}const e=M(j.value.fieldForm),{deType:n,dateFormat:i,deExtractType:u}=e;e.dateFormat=n===1?i:"",e.dateFormatType=n===1?i:"",e.deTypeArr=n===1&&u===0?[n,i]:[n];const r=f.value.findIndex(L=>e.id===L.id),g=M(a(f));r!==-1?g.splice(r,1,e):g.push(e);const F=[];Te(F,N.value.getNodeList()),ae.value=!0,Va({union:F,allFields:g,isCross:P.value}).then(()=>{fe.success(d("data_set.validation_succeeded"))}).finally(()=>{ae.value=!1})}})},Tt=v(!1),gl=()=>{Tt.value=!0,document.querySelector("body").style.userSelect="none",document.querySelector(".dataset-db").addEventListener("mousemove",la)},hl=()=>{Tt.value=!1,document.querySelector("body").style.userSelect="auto";const t=document.querySelector(".dataset-db");t.removeEventListener("mousemove",la),t.removeEventListener("mousemove",oa)},Re=Ze(()=>{var t;return(t=N.value)==null?void 0:t.crossDatasources}),la=t=>{if(t.pageX<240){ue.value=240;return}if(t.pageX>500){ue.value=500;return}ue.value=t.pageX},yl=()=>{document.querySelector(".dataset-db").addEventListener("mousemove",oa)},oa=t=>{const e=document.documentElement.clientHeight;if(t.pageY-56<64){q.value=64,R.value=e-q.value-56;return}if(t.pageY>e-57){q.value=e-113,R.value=e-q.value-56;return}q.value=t.pageY-56,R.value=e-q.value-56,ze.value=R.value-242},R=v(0),sa=Ko(()=>{const t=document.documentElement.clientHeight;if(t-R.value-56<64){q.value=64,R.value=t-q.value-56;return}q.value=t-R.value-56},60);let xt=!1;const bl=()=>{xt&&Ue()};let na=null;const ia=()=>na(!0);xo(async()=>{Ae.value=!1,await new Promise(t=>na=t),await el(),wl(Ae.value?0:2),window.addEventListener("resize",sa),Cl(),ze.value=R.value-242}),Fo(()=>{window.removeEventListener("resize",sa)});const Cl=()=>{R.value=document.querySelector(".sql-result").offsetHeight},wl=t=>{$o(t).then(e=>{const n=e||[];n&&n.length>0&&n[0].id==="0"?H.dataSourceList=pt(n[0].children):H.dataSourceList=pt(n),ve(()=>{var u;const i={methodName:"execute",args:null};(u=Rt.value)==null||u.invokeMethod(i)})})},da=(t,e)=>{var n;for(let i in t){const u=Le();e[t[i].currentDs.id]=u,t[i].currentDs.id=u,(n=t[i].childrenDs)!=null&&n.length&&da(t[i].childrenDs,e)}},Tl=t=>{const e={};for(let n in f.value){const i=Le();e[f.value[n].id]=i,f.value[n].id=i,f.value[n].datasetGroupId=""}return da(t,e),e},xl=(t,e)=>{let n=JSON.stringify(t),i=JSON.stringify(Vo(N.value.getNodeList())),u=JSON.stringify(a(f.value));return Object.entries(e).forEach(([r,g])=>{n=n.replaceAll(r,g),u=u.replaceAll(r,g),i=i.replaceAll(r,g)}),f.value=JSON.parse(u),N.value.initState(JSON.parse(i)),JSON.parse(n)},ra=()=>{if(Y.id){Ha();return}let t=[];Te(t,N.value.getNodeList());const e=De.getIsDataEaseBi?le.datasetPid:ot.query.pid||Y.pid;if(!t.length){fe.error(d("data_set.dataset_cannot_be"));return}Y.pid&&!Y.id&&(t=xl(t,Tl(t))),Et.value.createInit("dataset",{id:e||"0",union:t,allfields:f.value,isCross:P.value},"",Q.value)},Fl=()=>{xt=!0,ra()},ae=v(!1),kl=()=>{if(ae.value)return;const t=[];Te(t,N.value.getNodeList()),ae.value=!0,Va({union:t,allFields:f.value,isCross:P.value}).then(e=>{Me.value=Ka(e.data.fields||[]),_t.value=e.data.data||[]}).finally(()=>{ae.value=!1})},Te=(t,e)=>{e.forEach(n=>{var U;const i=[];(U=n.children)!=null&&U.length&&Te(i,n.children);const{tableName:u,type:r,datasourceId:g,id:F,info:L,unionType:k,unionFields:w,currentDsFields:I,sqlVariableDetails:B}=n;t.push({currentDs:{sqlVariableDetails:B,tableName:u,type:r,datasourceId:g,id:F,info:L},currentDsFields:I,childrenDs:i,unionToParent:{unionType:k,unionFields:w}})})},ce=v(),me=v(),Be=v([]),Oe=v([]),xe=v([]),pe=v([]),ua=Ze(()=>!!xe.value.length&&Array.from(new Set(xe.value)).length===1),Vl=()=>{me.value.clearSelection(),ce.value.clearSelection()},ie=v([]),ca=()=>{pe.value=[...me.value.getSelectionRows(),...ce.value.getSelectionRows()],xe.value=pe.value.map(n=>n.deExtractType);let t=pe.value.map(n=>n.deType);const[e]=pe.value;if(ve(()=>{Be.value=me.value.getSelectionRows().map(n=>n.id),Oe.value=ce.value.getSelectionRows().map(n=>n.id)}),Array.from(new Set(t)).length!==1){ie.value=[];return}ie.value=e.deType===1&&e.deExtractType===0?[1,e.dateFormatType]:[e.deType]},El=(t,e,n)=>{const i=n.target.parentNode.parentNode;if([...i.classList].includes("no-hide")){i.classList.remove("no-hide");return}i.classList.add("no-hide")};let et=[];const Nl=t=>{const[e,n]=t;Be.value=me.value.getSelectionRows().map(u=>u.id),Oe.value=ce.value.getSelectionRows().map(u=>u.id);const i=[...Oe.value,...Be.value];if(n==="custom"){const[u]=f.value.filter(r=>i.includes(r.id));et=u.deType===1?[1,u.dateFormatType]:[u.deType],E.value.id="",E.value.idArr=[...i],E.value.dateFormat="",E.value.dateFormatType=n,se.value=!0,Fe();return}f.value.forEach(u=>{i.includes(u.id)&&(u.deType=e,u.dateFormat=e===1?n:"",u.dateFormatType=e===1?n:"",u.deTypeArr=e===1&&u.deExtractType===0?[e,n]:[e])}),Fe()},Ll=(t,e)=>{var n;return t?(n=e.name)==null?void 0:n.toLowerCase().includes(t.toLowerCase()):!0},Fe=()=>{ve(()=>{ee.value.forEach(t=>{Oe.value.includes(t.id)&&ce.value.toggleRowSelection(t,!0)}),te.value.forEach(t=>{Be.value.includes(t.id)&&me.value.toggleRowSelection(t,!0)})})},Dl=()=>{Je.value=!1},ma=(t,e)=>{const[n,i]=e;if(i==="custom"){et=t.deType===1?[1,t.dateFormatType]:[t.deType],E.value.id=t.id,se.value=!0;return}t.deType=n,t.dateFormat=n===1?i:"",t.dateFormatType=n===1?i:""},pa=(t,e)=>{e.forEach(n=>{var Z;const i=[];(Z=n.childrenDs)!=null&&Z.length&&pa(i,n.childrenDs);const{unionToParent:u,currentDsFields:r,currentDs:g}=n,{tableName:F,type:L,datasourceId:k,id:w,info:I,sqlVariableDetails:B}=g||{},{unionType:U,unionFields:D}=u||{};t.push({sqlVariableDetails:B,tableName:F,type:L,datasourceId:k,id:w,info:I,currentDsFields:r,children:i,unionType:U,unionFields:D})})},Sl=()=>{Ie.value=!0,ve(()=>{Dt.value.focus()})},Il=t=>{t||Re.value&&(P.value=!t,lt.confirm(d("common.source_tips"),{confirmButtonText:d("dataset.confirm"),cancelButtonText:d("common.cancel"),showCancelButton:!0,confirmButtonType:"primary",type:"warning",autofocus:!1,showClose:!1}).then(()=>{P.value=t}))},Ul=t=>{const{id:e,pid:n,name:i}=t;Q.value=i,Y={id:e,pid:n,name:i},f.value=t.allFields||[]},ke=v(""),Al=()=>{ke.value="",Q.value.trim()||(ke.value=d("commons.input_content")),Q.value.trim().length<1&&(ke.value=d("datasource.input_limit_1_64",[1,64])),Ie.value=!!ke.value},Ml={children:"children",label:"name",disabled:t=>{var e;return!((e=t.children)!=null&&e.length)&&!t.leaf||t.extraFlag<0&&t.type!=="API"}},Ge=v([]),$l=t=>{Ge.value=t},ql=t=>{if((Ge==null?void 0:Ge.value.length)===0||!t.leaf)return null;const e=Ge.value.filter(n=>n.type===t.type);return e&&e.length>0?e[0].icon:null},Hl=t=>t.leaf?Wo[t.type]:No,fa=(t,e,n=!1)=>e===2?(n?Ao:Mo)[t]:X[G[t]];return(t,e)=>{const n=to,i=ao,u=Co,r=Qo,g=bo,F=ho,L=yo,k=go,w=vo,I=_o,B=fo,U=mo,D=po,Z=co,je=uo,$=io,Ve=ro,va=no,tt=so,at=oo,Rl=lo,_a=es,Bl=Kl,Ol=Jl,Pe=Wl;return c(),h(de,null,[K((c(),h("div",ds,[m("div",rs,[m("span",us,[l(a(V),{onClick:Ma},{default:s(()=>[l(a(y),{name:"icon_left_outlined"},{default:s(()=>[l(a(ya),{class:"svg-icon"})]),_:1})]),_:1}),Ie.value?(c(),h(de,{key:0},[l(n,{maxlength:"64",ref_key:"editerName",ref:Dt,modelValue:Q.value,"onUpdate:modelValue":e[0]||(e[0]=o=>Q.value=o),onBlur:Al},null,8,["modelValue"]),ke.value?(c(),h("div",cs,p(ke.value),1)):A("",!0)],64)):(c(),h("span",{key:1,onClick:Sl,class:"dataset-name ellipsis",style:{"margin-left":"12px"}},p(Q.value),1))]),m("span",ms,[l(i,{disabled:Ie.value,type:"primary",onClick:Fl},{default:s(()=>[T(p(a(d)("data_set.save_and_return")),1)]),_:1},8,["disabled"]),l(i,{disabled:Ie.value,type:"primary",onClick:ra},{default:s(()=>[T(p(a(d)("data_set.save")),1)]),_:1},8,["disabled"])])]),m("div",{class:"container dataset-db",onMouseup:hl},[K(m("p",{class:"arrow-right",onClick:e[1]||(e[1]=o=>be.value=!0)},[l(a(V),null,{default:s(()=>[l(a(y),null,{default:s(()=>[l(a(Lo),{class:"svg-icon"})]),_:1})]),_:1})],512),[[Ee,!be.value]]),K(m("div",{style:Xe({left:ue.value+"px"}),class:S(["drag-left",Tt.value&&"is-dragging"]),onMousedown:gl},null,38),[[Ee,be.value]]),K((c(),h("div",{class:"table-list",style:Xe({width:ue.value+"px"})},[m("div",ps,[l(u,{style:{"margin-bottom":"8px"},modelValue:P.value,"onUpdate:modelValue":e[2]||(e[2]=o=>P.value=o),onChange:Il,"active-text":t.$t("common.cross_source"),"inactive-text":t.$t("common.single_source")},null,8,["modelValue","active-text","inactive-text"]),m("p",fs,[T(p(a(d)("data_set.select_data_source"))+" ",1),m("span",vs,[l(a(V),{style:{color:"#1f2329"},onClick:e[3]||(e[3]=o=>be.value=!1)},{default:s(()=>[l(a(y),{name:"icon_left_outlined"},{default:s(()=>[l(a(ya),{class:"svg-icon"})]),_:1})]),_:1})])]),l(g,{"check-strictly":!1,onChange:vt,placeholder:a(d)("dataset.pls_slc_data_source"),class:"ds-list","filter-node-method":Ll,filterable:"","popper-class":"tree-select-ds_popper",modelValue:oe.value,"onUpdate:modelValue":e[4]||(e[4]=o=>oe.value=o),"node-key":"id",props:Ml,data:H.dataSourceList,"render-after-expand":!1},{default:s(({data:{name:o,leaf:_,type:C,extraFlag:Gl}})=>[m("div",_s,[l(a(V),null,{default:s(()=>[l(a(y),{"static-content":ql({leaf:_,type:C})},{default:s(()=>[(c(),b(O(Hl({leaf:_,type:C})),{class:"svg-icon"}))]),_:2},1032,["static-content"])]),_:2},1024),!_||Gl>-1?(c(),h("span",gs,p(o),1)):(c(),b(r,{key:1,effect:"dark",content:`${a(d)("data_set.invalid_data_source")}:${o}`,placement:"top"},{default:s(()=>[m("span",null,p(o),1)]),_:2},1032,["content"]))])]),_:1},8,["placeholder","modelValue","data"]),m("p",hs,[T(p(a(d)("datasource.data_table"))+" ",1),m("span",ys,[l(a(V),{class:"icon-color"},{default:s(()=>[l(a(y),{name:"reference-table"},{default:s(()=>[l(a(ga),{class:"svg-icon"})]),_:1})]),_:1}),T(" "+p(J.value.length),1)])]),l(n,{modelValue:Se.value,"onUpdate:modelValue":e[5]||(e[5]=o=>Se.value=o),class:"search",placeholder:a(d)("deDataset.by_table_name"),clearable:""},{prefix:s(()=>[l(a(V),null,{default:s(()=>[l(a(y),{name:"icon_search-outline_outlined"},{default:s(()=>[l(a(So),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"])]),!J.value.length&&Se.value!==""?(c(),h("div",bs,[m("div",Cs,p(a(d)("data_set.relevant_content_found")),1)])):(c(),h("div",ws,[oe.value?(c(),h("div",{key:0,class:"list-item_primary",onDragstart:e[6]||(e[6]=o=>ta(o,ct)),onDragend:Dl,draggable:!0,onClick:e[7]||(e[7]=o=>aa(ct))},[l(a(V),{class:"icon-color"},{default:s(()=>[l(a(y),{name:"icon_sql_outlined_1"},{default:s(()=>[l(a(os),{class:"svg-icon"})]),_:1})]),_:1}),m("span",Ts,p(a(d)("data_set.custom_sql")),1)],32)):A("",!0),l(a(Go),{itemSize:40,data:J.value,total:J.value.length,width:ue.value-17,height:a(Ua)-305,scrollbarAlwaysOn:!1,"class-name":"el-select-dropdown__list",layout:"vertical"},{default:s(({index:o,style:_})=>[m("div",{class:"list-item_primary",style:Xe(_),title:J.value[o].tableName,onDragstart:C=>ta(C,J.value[o]),onDragend:e[8]||(e[8]=C=>Je.value=!1),draggable:!0,onClick:C=>aa(J.value[o])},[l(a(V),{class:"icon-color"},{default:s(()=>[l(a(y),{name:"reference-table"},{default:s(()=>[l(a(ga),{class:"svg-icon"})]),_:1})]),_:1}),m("span",Fs,p(J.value[o].tableName),1)],44,xs)]),_:1},8,["data","total","width","height"])]))],4)),[[Pe,st.value],[Ee,be.value]]),m("div",{class:"drag-right",style:Xe({width:`calc(100vw - ${be.value?ue.value:0}px)`})},[Re.value?(c(),h("div",ks,[l(a(V),null,{default:s(()=>[l(a(y),{name:"icon_warning_colorful"},{default:s(()=>[l(a(is),{class:"svg-icon"})]),_:1})]),_:1}),T(" "+p(a(d)("data_set.be_reported_incorrectly")),1)])):A("",!0),l(Jo,{onReGetName:ht,onJoinEditor:tl,onChangeUpdate:dt,maskShow:Je.value,dragHeight:q.value,getDsName:Aa,offsetX:Nt.value,offsetY:Lt.value,ref_key:"datasetDrag",ref:N,onUpdateAllfields:sl,onAddComplete:gt},null,8,["maskShow","dragHeight","offsetX","offsetY"]),m("div",{class:"sql-result",style:Xe({height:R.value?`${Re.value?R.value-40:R.value}px`:`calc(100% - ${Re.value?q.value+40:q.value}px)`})},[m("div",Vs,[m("span",{class:"drag",onMousedown:yl},null,32),m("div",Es,[l(i,{disabled:!f.value.length,onClick:e[9]||(e[9]=o=>Ya("q")),secondary:""},{icon:s(()=>[l(a(V),null,{default:s(()=>[l(a(y),{name:"icon_add_outlined"},{default:s(()=>[l(a(ba),{class:"svg-icon"})]),_:1})]),_:1})]),default:s(()=>[T(" "+p(a(d)("dataset.add_calc_field")),1)]),_:1},8,["disabled"]),l(i,{disabled:!f.value.length,onClick:il,secondary:""},{icon:s(()=>[l(a(V),null,{default:s(()=>[l(a(y),null,{default:s(()=>[l(a(Do),{class:"svg-icon"})]),_:1})]),_:1})]),default:s(()=>[T(" "+p(a(d)("dataset.create_grouping_field")),1)]),_:1},8,["disabled"]),K((c(),b(i,{style:{"min-width":"70px"},disabled:!f.value.length,onClick:kl,secondary:""},{icon:s(()=>[l(a(V),null,{default:s(()=>[l(a(y),{name:"icon_refresh_outlined"},{default:s(()=>[l(a(Io),{class:"svg-icon"})]),_:1})]),_:1})]),default:s(()=>[T(" "+p(a(d)("data_set.refresh_data")),1)]),_:1},8,["disabled"])),[[Pe,ae.value]])])]),l(L,{class:"padding-24",modelValue:ye.value,"onUpdate:modelValue":e[10]||(e[10]=o=>ye.value=o),onTabChange:Ot},{default:s(()=>[l(F,{label:a(d)("chart.data_preview"),name:"preview"},null,8,["label"]),l(F,{label:a(d)("dataset.batch_manage"),name:"manage"},null,8,["label"])]),_:1},8,["modelValue"]),K(m("div",Ns,[m("div",Ls,[m("div",{class:S(["field-d",{open:$e.value}])},[m("div",{class:S(["title",{expanded:$e.value}]),onClick:e[11]||(e[11]=o=>$e.value=!$e.value)},[l(a(V),{class:"expand"},{default:s(()=>[l(a(y),{name:"icon_expand-right_filled"},{default:s(()=>[l(a(Ca),{class:"svg-icon"})]),_:1})]),_:1}),T("  "+p(a(d)("chart.dimension")),1)],2),$e.value?(c(),b(k,{key:0,data:te.value,props:At},{default:s(({data:o})=>[m("span",Ds,[l(a(V),null,{default:s(()=>[l(a(y),null,{default:s(()=>[(c(),b(O(fa(o.deType,o.extField)),{class:S(["svg-icon",`field-icon-${a(G)[[2,3].includes(o.deType)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),m("span",{title:o.name,class:"label-tooltip"},p(o.name),9,Ss),m("div",Is,[l(wa,{extField:o.extField,"trans-type":a(d)("data_set.convert_to_indicator"),"show-time":o.deExtractType===0,onHandleCommand:_=>z(o,_)},null,8,["extField","trans-type","show-time","onHandleCommand"])])])]),_:1},8,["data"])):A("",!0)],2),m("div",{class:S(["field-q",{open:qe.value}])},[m("div",{class:S(["title",{expanded:qe.value}]),onClick:e[12]||(e[12]=o=>qe.value=!qe.value)},[l(a(V),{class:"expand"},{default:s(()=>[l(a(y),{name:"icon_expand-right_filled"},{default:s(()=>[l(a(Ca),{class:"svg-icon"})]),_:1})]),_:1}),T("  "+p(a(d)("chart.quota")),1)],2),qe.value?(c(),b(k,{key:0,data:ee.value,props:At},{default:s(({data:o})=>[m("span",Us,[l(a(V),null,{default:s(()=>[l(a(y),null,{default:s(()=>[(c(),b(O(fa(o.deType,o.extField,!0)),{class:S(["svg-icon",`field-icon-${a(G)[[2,3].includes(o.deType)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),m("span",{title:o.name,class:"label-tooltip"},p(o.name),9,As),m("div",Ms,[l(wa,{"trans-type":a(d)("data_set.convert_to_dimension"),typeColor:"green-color","show-time":o.deExtractType===0,extField:o.extField,onHandleCommand:_=>z(o,_)},null,8,["trans-type","show-time","extField","onHandleCommand"])])])]),_:1},8,["data"])):A("",!0)],2)]),m("div",$s,[K((c(),b(I,{class:"dataset-preview_table",onRowClick:El,"header-class":"header-cell",data:_t.value,border:"",style:{width:"100%",height:"100%"}},{empty:s(()=>[l(jo,{description:a(d)("data_set.no_data"),"img-type":"noneWhite"},null,8,["description"])]),default:s(()=>[(c(!0),h(de,null,Ne(Me.value,(o,_)=>(c(),b(w,{key:o.dataKey+o.deType,prop:o.dataKey,label:o.title,width:Me.value.length-1===_?150:"auto",fixed:Me.value.length-1===_?"right":!1},{header:s(()=>[m("div",qs,[l(a(V),{style:{"margin-right":"6px"}},{default:s(()=>[l(a(y),null,{default:s(()=>[(c(),b(O(a(X)[a(G)[o.deType]]),{class:S(["svg-icon",`field-icon-${a(G)[[2,3].includes(o.deType)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),m("span",{class:"ellipsis",title:o.title,style:{width:"120px"}},p(o.title),9,Hs)])]),_:2},1032,["prop","label","width","fixed"]))),128))]),_:1},8,["data"])),[[Pe,ae.value]])])],512),[[Ee,ye.value==="preview"&&!!f.value.length]]),K(m("div",Rs,[m("div",Bs,[l(D,{modelValue:H.fieldCollapse,"onUpdate:modelValue":e[13]||(e[13]=o=>H.fieldCollapse=o),class:"style-collapse"},{default:s(()=>[l(U,{name:"dimension",title:a(d)("chart.dimension"),class:"dimension-manage-header manage-header"},{default:s(()=>[l(I,{onSelectionChange:ca,ref_key:"dimensionsTable",ref:me,data:te.value,height:ze.value,style:{width:"100%"}},{default:s(()=>[l(w,{selectable:Oa,type:"selection",width:"40"}),l(w,{prop:"name",label:a(d)("dataset.field_name"),width:"264"},{default:s(o=>[m("div",Os,[l(n,{modelValue:o.row.name,"onUpdate:modelValue":_=>o.row.name=_,placeholder:a(d)("commons.input_content")},null,8,["modelValue","onUpdate:modelValue","placeholder"])])]),_:1},8,["label"]),l(w,{prop:"originName",label:a(d)("dataset.origin_name"),width:"240"},{default:s(o=>[m("div",Gs,[o.row.extField===2?(c(),h("span",js,p(a(d)("dataset.calc_field")),1)):o.row.extField===3?(c(),h("span",Ps,p(a(d)("dataset.grouping_field")),1)):(c(),h("span",Ys,p(o.row.originName),1))])]),_:1},8,["label"]),l(w,{prop:"description",label:a(d)("deDataset.description"),width:"240"},{default:s(o=>[m("div",Zs,[o.row.extField===0?(c(),h("span",Xs,p(o.row.description),1)):(c(),h("span",zs," "))])]),_:1},8,["label"]),l(w,{prop:"datasetTableId",label:a(d)("data_set.table_name_de"),width:"240"},{default:s(o=>[T(p(o.row.extField===0?nt.value[o.row.datasetTableId]:""),1)]),_:1},8,["label"]),l(w,{prop:"deType",label:a(d)("dataset.field_type"),width:"200"},{default:s(o=>[o.row.extField!==3?(c(),b(B,{key:0,class:S(!!o.row.deTypeArr&&!!o.row.deTypeArr.length&&"select-type"),"popper-class":"cascader-panel",modelValue:o.row.deTypeArr,"onUpdate:modelValue":_=>o.row.deTypeArr=_,onChange:_=>ma(o.row,_),options:o.row.deExtractType===0?rt:ut},{default:s(({data:_})=>[l(a(V),null,{default:s(()=>[l(a(y),null,{default:s(()=>[(c(),b(O(a(X)[W(_.value)]),{class:S(["svg-icon",`field-icon-${a(G)[[2,3].includes(_.value)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),m("span",null,p(_.label),1)]),_:1},8,["class","modelValue","onUpdate:modelValue","onChange","options"])):(c(),h("div",Js,p(t.$t("data_set.text")),1)),m("span",Ws,[l(a(V),null,{default:s(()=>[l(a(y),null,{default:s(()=>[(c(),b(O(a(X)[W(o.row.deType)]),{class:S(["svg-icon",`field-icon-${a(G)[[2,3].includes(o.row.deType)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024)])]),_:1},8,["label"]),l(w,{prop:"deExtraType",label:a(d)("dataset.origin_type"),width:"168"},{default:s(o=>[m("div",Ks,[o.row.extField===2?(c(),h("span",Qs,p(a(d)("dataset.calc_field")),1)):o.row.extField===3?(c(),h("span",en,p(a(d)("dataset.grouping_field")),1)):o.row.extField===0?(c(),h("span",tn,[l(a(V),null,{default:s(()=>[l(a(y),{className:"primary-color"},{default:s(()=>[(c(),b(O(a(X)[W(o.row.deExtractType)]),{class:"svg-icon primary-color"}))]),_:2},1024)]),_:2},1024),T(" "+p(St(o.row.deExtractType)),1)])):A("",!0)])]),_:1},8,["label"]),l(w,{fixed:"right",label:a(d)("chart.dimension")},{default:s(o=>[l(r,{effect:"dark",content:a(d)("data_set.convert_to_indicator"),placement:"top"},{default:s(()=>[[3].includes(o.row.extField)?A("",!0):(c(),b(i,{key:0,text:"",onClick:_=>z(o.row,"translate")},{icon:s(()=>[l(a(y),{name:"icon_switch_outlined"},{default:s(()=>[l(a(Ta),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"]))]),_:2},1032,["content"])]),_:1},8,["label"]),l(w,{fixed:"right",width:"168",label:a(d)("dataset.operator")},{default:s(o=>[l(r,{effect:"dark",content:a(d)("dataset.copy"),placement:"top"},{default:s(()=>[l(i,{text:"",onClick:_=>z(o.row,"copy")},{icon:s(()=>[l(a(y),{name:"icon_copy_outlined"},{default:s(()=>[l(a(xa),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["content"]),l(r,{effect:"dark",content:a(d)("dataset.delete"),placement:"top"},{default:s(()=>[l(i,{text:"",onClick:_=>z(o.row,"delete")},{icon:s(()=>[l(a(y),{name:"icon_delete-trash_outlined"},{default:s(()=>[l(a(Vt),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["content"]),l(r,{effect:"dark",content:a(d)("dataset.edit"),placement:"top"},{default:s(()=>[[2,3].includes(o.row.extField)?(c(),b(i,{key:0,text:"",onClick:_=>z(o.row,"editor")},{icon:s(()=>[l(a(y),{name:"icon_edit_outlined"},{default:s(()=>[l(a(Fa),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])):A("",!0)]),_:2},1032,["content"])]),_:1},8,["label"])]),_:1},8,["data","height"])]),_:1},8,["title"]),l(U,{name:"quota",title:a(d)("chart.quota"),class:"quota-manage-header manage-header"},{default:s(()=>[l(I,{onSelectionChange:ca,ref_key:"quotaTable",ref:ce,height:ze.value,data:ee.value,style:{width:"100%"}},{default:s(()=>[l(w,{type:"selection",width:"40"}),l(w,{prop:"name",label:a(d)("dataset.field_name"),width:"264"},{default:s(o=>[m("div",an,[l(n,{modelValue:o.row.name,"onUpdate:modelValue":_=>o.row.name=_,placeholder:a(d)("commons.input_content")},null,8,["modelValue","onUpdate:modelValue","placeholder"])])]),_:1},8,["label"]),l(w,{prop:"originName",label:a(d)("dataset.origin_name"),width:"240"},{default:s(o=>[m("div",ln,[o.row.extField===0?(c(),h("span",on,p(o.row.originName),1)):(c(),h("span",sn,p(a(d)("dataset.calc_field")),1))])]),_:1},8,["label"]),l(w,{prop:"description",label:a(d)("deDataset.description"),width:"240"},{default:s(o=>[m("div",nn,[o.row.extField===0?(c(),h("span",dn,p(o.row.description),1)):(c(),h("span",rn," "))])]),_:1},8,["label"]),l(w,{prop:"datasetTableId",label:a(d)("data_set.table_name_de"),width:"240"},{default:s(o=>[T(p(o.row.extField===0?nt.value[o.row.datasetTableId]:""),1)]),_:1},8,["label"]),l(w,{prop:"deType",label:a(d)("dataset.field_type"),width:"200"},{default:s(o=>[l(B,{class:S(!!o.row.deTypeArr&&!!o.row.deTypeArr.length&&"select-type"),"popper-class":"cascader-panel",modelValue:o.row.deTypeArr,"onUpdate:modelValue":_=>o.row.deTypeArr=_,onChange:_=>ma(o.row,_),options:o.row.deExtractType===0?rt:ut},{default:s(({data:_})=>[l(a(V),null,{default:s(()=>[l(a(y),null,{default:s(()=>[(c(),b(O(a(X)[W(_.value)]),{class:S(["svg-icon",`field-icon-${a(G)[[2,3].includes(_.value)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),m("span",null,p(_.label),1)]),_:1},8,["class","modelValue","onUpdate:modelValue","onChange","options"]),m("span",un,[l(a(V),null,{default:s(()=>[l(a(y),null,{default:s(()=>[(c(),b(O(a(X)[W(o.row.deType)]),{class:S(["svg-icon",`field-icon-${a(G)[[2,3].includes(o.row.deType)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024)])]),_:1},8,["label"]),l(w,{prop:"deExtraType",label:a(d)("dataset.origin_type"),width:"168"},{default:s(o=>[m("div",cn,[o.row.extField===2?(c(),h("span",mn,p(a(d)("dataset.calc_field")),1)):o.row.extField===3?(c(),h("span",pn,p(a(d)("dataset.grouping_field")),1)):o.row.extField===0?(c(),h("span",fn,[l(a(V),null,{default:s(()=>[l(a(y),{className:"green-color"},{default:s(()=>[(c(),b(O(a(X)[W(o.row.deExtractType)]),{class:"svg-icon green-color"}))]),_:2},1024)]),_:2},1024),T(" "+p(St(o.row.deExtractType)),1)])):A("",!0)])]),_:1},8,["label"]),l(w,{fixed:"right",label:a(d)("chart.quota")},{default:s(o=>[l(r,{effect:"dark",content:a(d)("data_set.convert_to_dimension"),placement:"top"},{default:s(()=>[l(i,{text:"",onClick:_=>z(o.row,"translate")},{icon:s(()=>[l(a(y),{name:"icon_switch_outlined"},{default:s(()=>[l(a(Ta),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["content"])]),_:1},8,["label"]),l(w,{fixed:"right",width:"168",label:a(d)("dataset.operator")},{default:s(o=>[l(r,{effect:"dark",content:a(d)("dataset.copy"),placement:"top"},{default:s(()=>[l(i,{text:"",onClick:_=>z(o.row,"copy")},{icon:s(()=>[l(a(y),{name:"icon_copy_outlined"},{default:s(()=>[l(a(xa),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["content"]),l(r,{effect:"dark",content:a(d)("dataset.delete"),placement:"top"},{default:s(()=>[l(i,{text:"",onClick:_=>z(o.row,"delete")},{icon:s(()=>[l(a(y),{name:"icon_delete-trash_outlined"},{default:s(()=>[l(a(Vt),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["content"]),l(r,{effect:"dark",content:a(d)("dataset.edit"),placement:"top"},{default:s(()=>[o.row.extField===2?(c(),b(i,{key:0,text:"",onClick:_=>z(o.row,"editor")},{icon:s(()=>[l(a(y),{name:"icon_edit_outlined"},{default:s(()=>[l(a(Fa),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])):A("",!0)]),_:2},1032,["content"])]),_:1},8,["label"])]),_:1},8,["height","data"])]),_:1},8,["title"])]),_:1},8,["modelValue"])]),xe.value.length?(c(),h("div",vn,[m("div",_n,[T(p(a(d)("data_set.selected"))+" ",1),m("span",gn,p(xe.value.length),1),T(" "+p(a(d)("data_set.bar"))+" ",1),l(i,{onClick:Vl,text:"",style:{"margin-left":"16px"}},{default:s(()=>[T(p(a(d)("commons.clear")),1)]),_:1})]),m("div",hn,[l(B,{disabled:!ua.value,class:S(!!ie.value.length&&"select-type"),modelValue:ie.value,"onUpdate:modelValue":e[14]||(e[14]=o=>ie.value=o),onChange:Nl,"popper-class":"cascader-panel",options:xe.value.every(o=>o===0)?rt:ut},{default:s(({data:o})=>[l(a(V),null,{default:s(()=>[l(a(y),null,{default:s(()=>[(c(),b(O(a(X)[W(o.value)]),{class:S(["svg-icon",`field-icon-${a(G)[[2,3].includes(o.value)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),m("span",null,p(o.label),1)]),_:1},8,["disabled","class","modelValue","options"]),m("span",yn,[l(a(V),null,{default:s(()=>[l(a(y),{className:`field-icon-${W(ie.value[0])}`},{default:s(()=>[(c(),b(O(a(X)[W(ie.value[0])]),{class:S(["svg-icon",`field-icon-${W(ie.value[0])}`])},null,8,["class"]))]),_:1},8,["className"])]),_:1})]),l(r,{class:"item",effect:"dark",placement:"top"},{content:s(()=>[m("div",null,p(a(d)("dataset.field_diff")),1)]),default:s(()=>[K(l(a(V),{size:"16px",style:{"margin-left":"6px"}},{default:s(()=>[l(a(y),{name:"icon_info_outlined"},{default:s(()=>[l(a(Uo),{class:"svg-icon tip-icon"})]),_:1})]),_:1},512),[[Ee,!ua.value]])]),_:1})]),pe.value.every(o=>o.groupType==="d")?(c(),b(i,{key:0,onClick:e[15]||(e[15]=o=>$t("q")),plain:"",style:{"margin-left":"200px"}},{default:s(()=>[T(p(a(d)("data_set.convert_to_indicator")),1)]),_:1})):pe.value.every(o=>o.groupType==="q")?(c(),b(i,{key:1,onClick:e[16]||(e[16]=o=>$t("d")),plain:"",style:{"margin-left":"200px"}},{default:s(()=>[T(p(a(d)("data_set.convert_to_dimension")),1)]),_:1})):A("",!0)])):A("",!0)],512),[[Ee,ye.value!=="preview"&&!!f.value.length]])],4)],4)],32),l(Z,{title:a(d)("dataset.edit_union_relation"),modelValue:he.value,"onUpdate:modelValue":e[17]||(e[17]=o=>he.value=o),"modal-class":"union-dataset-drawer",size:"840px","before-close":Zt,direction:"rtl"},{footer:s(()=>[l(i,{secondary:"",onClick:Zt},{default:s(()=>[T(p(a(d)("dataset.cancel")),1)]),_:1}),l(i,{type:"primary",onClick:ol},{default:s(()=>[T(p(a(d)("dataset.confirm")),1)]),_:1})]),default:s(()=>[l(Yo,{ref_key:"fieldUnion",ref:He,editArr:H.editArr},null,8,["editArr"])]),_:1},8,["title","modelValue"])])),[[Pe,Ce.value]]),l(Zo,{onFinish:Ul,onOnDatasetSave:bl,ref_key:"creatDsFolder",ref:Et},null,512),l(je,{"modal-class":"calc-field-edit-dialog",modelValue:ge.value,"onUpdate:modelValue":e[20]||(e[20]=o=>ge.value=o),width:"1000px",title:ft.value},{footer:s(()=>[l(i,{secondary:"",onClick:e[18]||(e[18]=o=>Ja())},{default:s(()=>[T(p(a(d)("dataset.cancel")),1)]),_:1}),l(i,{secondary:"",onClick:_l},{default:s(()=>[T(p(a(d)("datasource.validate")),1)]),_:1}),l(i,{type:"primary",onClick:e[19]||(e[19]=o=>Wa())},{default:s(()=>[T(p(a(d)("dataset.confirm")),1)]),_:1})]),default:s(()=>[l(Po,{ref_key:"calcEdit",ref:j,crossDs:Re.value},null,8,["crossDs"])]),_:1},8,["modelValue","title"]),l(je,{class:"create-dialog",title:a(d)("data_set.format_edit"),modelValue:se.value,"onUpdate:modelValue":e[24]||(e[24]=o=>se.value=o),width:"1000px"},{footer:s(()=>[l(i,{secondary:"",onClick:e[22]||(e[22]=o=>$a())},{default:s(()=>[T(p(a(d)("dataset.cancel")),1)]),_:1}),l(i,{type:"primary",onClick:e[23]||(e[23]=o=>qa())},{default:s(()=>[T(p(a(d)("dataset.confirm")),1)]),_:1})]),default:s(()=>[l(Ve,{ref_key:"ruleFormRef",ref:It,rules:Sa,model:E.value,"label-width":"120px"},{default:s(()=>[l($,{prop:"name",label:a(d)("data_set.custom_time_format")},{default:s(()=>[l(n,{modelValue:E.value.name,"onUpdate:modelValue":e[21]||(e[21]=o=>E.value.name=o)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),l(je,{class:"create-dialog",title:a(d)("datasource.field_rename"),modelValue:We.value,"onUpdate:modelValue":e[28]||(e[28]=o=>We.value=o),width:"420px"},{footer:s(()=>[l(i,{secondary:"",onClick:e[26]||(e[26]=o=>Ht())},{default:s(()=>[T(p(a(d)("dataset.cancel")),1)]),_:1}),l(i,{type:"primary",onClick:e[27]||(e[27]=o=>za())},{default:s(()=>[T(p(a(d)("dataset.confirm")),1)]),_:1})]),default:s(()=>[l(Ve,{ref_key:"ruleFormFieldRef",ref:Ut,rules:Ia,model:ne.value,"require-asterisk-position":"right","label-position":"top","label-width":"120px"},{default:s(()=>[l($,{prop:"name",label:a(d)("dataset.field_name")},{default:s(()=>[l(n,{modelValue:ne.value.name,"onUpdate:modelValue":e[25]||(e[25]=o=>ne.value.name=o)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),l(je,{class:"create-dialog group-fields_dialog",title:wt.value,modelValue:we.value,"onUpdate:modelValue":e[32]||(e[32]=o=>we.value=o),width:"1000px"},{footer:s(()=>[l(i,{secondary:"",onClick:dl},{default:s(()=>[T(p(a(d)("dataset.cancel")),1)]),_:1}),l(i,{type:"primary",onClick:ml},{default:s(()=>[T(p(a(d)("dataset.confirm")),1)]),_:1})]),default:s(()=>[K((c(),b(Ve,{ref_key:"ruleGroupFieldRef",ref:Kt,rules:nl,model:x,"require-asterisk-position":"right","label-position":"top","label-width":"120px"},{default:s(()=>[l(Rl,{gutter:24},{default:s(()=>[l(va,{span:12},{default:s(()=>[l($,{prop:"name",label:a(d)("dataset.field_name")},{default:s(()=>[l(n,{placeholder:a(d)("dataset.input_edit_name"),modelValue:x.name,"onUpdate:modelValue":e[29]||(e[29]=o=>x.name=o)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])]),_:1}),l(va,{span:12},{default:s(()=>[l($,{prop:"originName",label:a(d)("dataset.grouping_field")},{default:s(()=>[l(at,{onChange:ea,modelValue:x.originName,"onUpdate:modelValue":e[30]||(e[30]=o=>x.originName=o),style:{width:"100%"}},{default:s(()=>[(c(!0),h(de,null,Ne(Qe.value,o=>(c(),b(tt,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),l($,{style:{"margin-top":"16px"}},{label:s(()=>[m("div",bn,p(a(d)("dataset.grouping_settings")),1)]),default:s(()=>[m("div",Cn,[l(Ol,{"max-height":"393px"},{default:s(()=>[(c(!0),h(de,null,Ne(x.groupList,(o,_)=>(c(),h("div",{class:"group-fields_item",key:_},[(c(),b(Ve,{ref_for:!0,ref:C=>Ke.value[_]=C,model:o,inline:"",key:_,"label-width":"auto",class:"form-dynamic"},{default:s(()=>[(c(),b($,{key:_+"name",prop:"name",rules:{required:!0,message:a(d)("chart.value_can_not_empty"),trigger:"blur"}},{default:s(()=>[l(n,{style:{width:"278px"},modelValue:o.name,"onUpdate:modelValue":C=>o.name=C,placeholder:a(d)("common.inputText")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["rules"])),[0,null].includes(x.deTypeOrigin)?(c(),b($,{key:_+"text",prop:"text",style:{width:"100%","margin-left":"24px"},rules:{validator:Jt,required:!0,trigger:"change"}},{default:s(()=>[l(at,{style:{width:"100%"},multiple:"","collapse-tags":"",filterable:"","collapse-tags-tooltip":"","max-collapse-tags":2,modelValue:o.text,"onUpdate:modelValue":C=>o.text=C},{default:s(()=>[(c(!0),h(de,null,Ne(Qt.value,C=>(c(),b(tt,{key:C,label:C,disabled:ul(C,o.text),value:C},null,8,["label","disabled","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["rules"])):[2,3,4].includes(x.deTypeOrigin)?(c(),h("div",wn,[(c(),b($,{key:_+"min",prop:"min",rules:{required:!0,message:a(d)("chart.value_can_not_empty"),trigger:"blur"}},{default:s(()=>[l(_a,{placeholder:a(d)("dataset.please_enter_number"),modelValue:o.min,"onUpdate:modelValue":C=>o.min=C,"controls-position":"right"},null,8,["placeholder","modelValue","onUpdate:modelValue"])]),_:2},1032,["rules"])),(c(),b($,{key:_+"minTerm"},{default:s(()=>[l(at,{modelValue:o.minTerm,"onUpdate:modelValue":C=>o.minTerm=C},{default:s(()=>[(c(),h(de,null,Ne(zt,C=>l(tt,{key:C.value,label:C.label,value:C.value},null,8,["label","value"])),64))]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1024)),m("div",Tn,p(a(d)("dataset.field_value")),1),(c(),b($,{key:_+"maxTerm"},{default:s(()=>[l(at,{modelValue:o.maxTerm,"onUpdate:modelValue":C=>o.maxTerm=C},{default:s(()=>[(c(),h(de,null,Ne(zt,C=>l(tt,{key:C.value,label:C.label,value:C.value},null,8,["label","value"])),64))]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1024)),(c(),b($,{key:_+"max",prop:"max",rules:{required:!0,message:a(d)("chart.value_can_not_empty"),trigger:"blur"}},{default:s(()=>[l(_a,{placeholder:a(d)("dataset.please_enter_number"),modelValue:o.max,"onUpdate:modelValue":C=>o.max=C,"validate-even":!1,"controls-position":"right"},null,8,["placeholder","modelValue","onUpdate:modelValue"])]),_:2},1032,["rules"]))])):[1].includes(x.deTypeOrigin)?(c(),b($,{key:_+"time",prop:"time",class:"group-fields_num",rules:{required:!0,validator:Jt,trigger:"change"}},{default:s(()=>[l(Bl,{"end-placeholder":a(d)("commons.date.end_date"),"start-placeholder":a(d)("commons.date.start_date"),modelValue:o.time,"onUpdate:modelValue":C=>o.time=C,type:"daterange"},null,8,["end-placeholder","start-placeholder","modelValue","onUpdate:modelValue"])]),_:2},1032,["rules"])):A("",!0)]),_:2},1032,["model"])),x.groupList.length!==1?(c(),b(i,{key:0,class:"variable_del",text:"",onClick:C=>vl(_)},{icon:s(()=>[l(a(y),null,{default:s(()=>[l(a(Vt),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])):A("",!0)]))),128))]),_:1})])]),_:1}),l(i,{style:{"margin-top":"-20px"},onClick:fl,text:""},{icon:s(()=>[l(a(y),null,{default:s(()=>[l(a(ba),{class:"svg-icon"})]),_:1})]),default:s(()=>[T(" "+p(a(d)("auth.add_condition")),1)]),_:1}),e[33]||(e[33]=m("div",{class:"line"},null,-1)),m("div",xn,[l(n,{placeholder:a(d)("common.inputText"),style:{width:"278px","margin-right":"24px"},modelValue:x.otherGroup,"onUpdate:modelValue":e[31]||(e[31]=o=>x.otherGroup=o)},null,8,["placeholder","modelValue"]),T(" "+p(a(d)("dataset.ungrouped_value")),1)])]),_:1},8,["model"])),[[Pe,Ct.value]])]),_:1},8,["title","modelValue"]),l(a(Ft),{jsname:"L2NvbXBvbmVudC9lbWJlZGRlZC1pZnJhbWUvTmV3V2luZG93SGFuZGxlcg==",onLoaded:ia,onLoadFail:ia}),l(a(Ft),{jsname:"L2NvbXBvbmVudC9wbHVnaW5zLWhhbmRsZXIvRHNDYXRlZ29yeUhhbmRsZXI=",onLoadDsPlugin:$l}),H.dataSourceList?(c(),b(a(Ft),{key:0,ref_key:"datasetCheckRef",ref:Rt,"is-edit":Ae.value,"ds-list":H.dataSourceList,"ds-id":oe.value,onBack:Ue,jsname:"L2NvbXBvbmVudC9kYXRhc2V0L2luZGV4"},null,8,["is-edit","ds-list","ds-id"])):A("",!0)],64)}}});const kd=ts(kn,[["__scopeId","data-v-0b845791"]]);export{kd as default};

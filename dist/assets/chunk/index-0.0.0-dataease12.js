import{c as Ce,b as ye,A as xe}from"./index-0.0.0-dataease.js";import{E as we}from"./el-tree-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as ke}from"./el-tree-select-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import{o as Le,F as Te,n as be,j as ie,G as Ee}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{f as c,O as E,a5 as Se,P as s,d as Be,s as q,r as u,y as V,w as Fe,j as o,i as l,u as n,a3 as N,a4 as g,T as ne,W as Ie,a6 as Me,g as p,_ as b,S as v,a8 as $e,a9 as De,l as A,R as U,U as z,n as re}from"./vue-0.0.0-dataease.js";import{c as Re}from"./copilot-0.0.0-dataease.js";import{t as qe}from"./treeSortUtils-0.0.0-dataease.js";import{i as Ve}from"./icon_right_outlined-0.0.0-dataease.js";import{i as Ne}from"./icon_left_outlined-0.0.0-dataease.js";import{d as Ae}from"./dv-folder-0.0.0-dataease.js";import{i as Ue}from"./icon_dataset-0.0.0-dataease.js";import{i as ce}from"./icon_expand-right_filled-0.0.0-dataease.js";import{a as ze,b as Ge,c as Oe,d as Ze,e as Pe}from"./dataset-0.0.0-dataease.js";import{f as B}from"./attr-0.0.0-dataease23.js";import G from"./DialogueChart-0.0.0-dataease.js";import{i as de}from"./field-list-0.0.0-dataease.js";import{e as ue}from"./lodash-0.0.0-dataease.js";import{E as We}from"./index-0.0.0-dataease4.js";import{_ as je}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./token-0.0.0-dataease.js";import"./index-0.0.0-dataease15.js";import"./index-0.0.0-dataease6.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease5.js";import"./axios-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./el-divider-0.0.0-dataease.js";import"./el-empty-0.0.0-dataease.js";import"./el-virtual-list-0.0.0-dataease.js";import"./raf-0.0.0-dataease.js";import"./el-table-v2-0.0.0-dataease.js";import"./antv-0.0.0-dataease.js";import"./imgUtils-0.0.0-dataease.js";import"./dvMain-0.0.0-dataease.js";import"./chart-0.0.0-dataease.js";import"./chart-0.0.0-dataease2.js";import"./app-0.0.0-dataease.js";import"./decimal-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./index-0.0.0-dataease21.js";import"./index-0.0.0-dataease22.js";import"./pureFunctionsAny.generated-0.0.0-dataease.js";import"./extends-0.0.0-dataease.js";import"./tslib.es6-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./el-col-0.0.0-dataease.js";import"./constants-0.0.0-dataease.js";import"./el-row-0.0.0-dataease.js";import"./_commonjs-dynamic-modules-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./index-0.0.0-dataease3.js";const He={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Ke(F,m){return c(),E("svg",He,[...m[0]||(m[0]=[Se('<path d="M20.1716 1.68834C20.6753 1.53273 21.0458 2.16193 20.6652 2.52691L12.2658 10.5836C11.0058 11.7921 9.32754 12.4668 7.5817 12.4668C5.68044 12.4668 3.8669 11.667 2.58487 10.263L1.45879 9.02985C1.33225 8.90313 1.24137 8.74527 1.19534 8.5722C1.14931 8.39913 1.14974 8.21698 1.19661 8.04413C1.24347 7.87129 1.3351 7.71386 1.46225 7.58775C1.5894 7.46164 1.74757 7.3713 1.92079 7.32585L20.1716 1.68834Z" fill="url(#paint0_linear_15885_149847)"></path><path d="M12 16.1851C12 14.2766 12.7377 12.4419 14.0588 11.0646L21.4664 3.34177C21.8268 2.96601 22.4499 3.32266 22.3084 3.82374L17.143 22.1182C17.0971 22.291 17.0064 22.4487 16.8801 22.5754C16.7538 22.7021 16.5964 22.7932 16.4237 22.8397C16.251 22.8862 16.0691 22.8864 15.8964 22.8402C15.7236 22.794 15.566 22.7031 15.4395 22.5767L14.4439 21.6791C12.8881 20.2764 12 18.2799 12 16.1851Z" fill="url(#paint1_linear_15885_149847)"></path><defs><linearGradient id="paint0_linear_15885_149847" x1="22.3289" y1="13.1532" x2="1.16113" y2="13.1532" gradientUnits="userSpaceOnUse"><stop stop-color="#9258F7"></stop><stop offset="1" stop-color="#3370FF"></stop></linearGradient><linearGradient id="paint1_linear_15885_149847" x1="22.3289" y1="13.1532" x2="1.16113" y2="13.1532" gradientUnits="userSpaceOnUse"><stop stop-color="#9258F7"></stop><stop offset="1" stop-color="#3370FF"></stop></linearGradient></defs>',3)])])}const Qe={render:Ke},Je={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Xe(F,m){return c(),E("svg",Je,[...m[0]||(m[0]=[s("path",{d:"M20.1716 1.68834C20.6753 1.53273 21.0458 2.16193 20.6652 2.52691L12.2658 10.5836C11.0058 11.7921 9.32754 12.4668 7.5817 12.4668C5.68044 12.4668 3.8669 11.667 2.58487 10.263L1.45879 9.02985C1.33225 8.90313 1.24137 8.74527 1.19534 8.5722C1.14931 8.39913 1.14974 8.21698 1.19661 8.04413C1.24347 7.87129 1.3351 7.71386 1.46225 7.58775C1.5894 7.46164 1.74757 7.3713 1.92079 7.32585L20.1716 1.68834Z",fill:"#BBBFC4"},null,-1),s("path",{d:"M12 16.1851C12 14.2766 12.7377 12.4419 14.0588 11.0646L21.4664 3.34177C21.8268 2.96601 22.4499 3.32266 22.3084 3.82374L17.143 22.1182C17.0971 22.291 17.0064 22.4487 16.8801 22.5754C16.7538 22.7021 16.5964 22.7932 16.4237 22.8397C16.251 22.8862 16.0691 22.8864 15.8964 22.8402C15.7236 22.794 15.566 22.7031 15.4395 22.5767L14.4439 21.6791C12.8881 20.2764 12 18.2799 12 16.1851Z",fill:"#BBBFC4"},null,-1)])])}const Ye={render:Xe},et={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function tt(F,m){return c(),E("svg",et,[...m[0]||(m[0]=[s("path",{d:"M5.29008 5.22068L5.29008 5.22068C3.5148 6.99712 2.49805 9.40416 2.49805 11.97C2.49805 17.2342 6.75182 21.5024 12.0004 21.5024C17.249 21.5024 21.5027 17.2342 21.5027 11.97C21.5027 11.6777 21.3866 11.3973 21.1799 11.1906C20.9731 10.9838 20.6928 10.8677 20.4004 10.8677C20.108 10.8677 19.8276 10.9838 19.6209 11.1906C19.4142 11.3973 19.298 11.6777 19.298 11.97C19.298 16.0178 16.0303 19.2977 12.0004 19.2977C7.97048 19.2977 4.70273 16.0178 4.70273 11.97M5.29008 5.22068L4.80039 11.97M5.29008 5.22068C5.39243 5.11826 5.51394 5.037 5.64769 4.98154C5.78145 4.92608 5.92481 4.89751 6.0696 4.89746C6.2144 4.89741 6.35778 4.92588 6.49157 4.98124C6.62536 5.0366 6.74694 5.11777 6.84936 5.22012C6.95178 5.32247 7.03304 5.44398 7.0885 5.57774C7.14396 5.71149 7.17253 5.85485 7.17258 5.99965C7.17263 6.14444 7.14417 6.28782 7.0888 6.42161C7.03344 6.55541 6.95227 6.67698 6.84992 6.7794M5.29008 5.22068L6.919 6.84843M4.70273 11.97H4.80039M4.70273 11.97C4.70273 11.9701 4.70273 11.9702 4.70273 11.9702L4.80039 11.97M4.70273 11.97C4.701 11.0061 4.88979 10.0512 5.25827 9.16045C5.62676 8.26965 6.16768 7.46047 6.84992 6.7794M4.80039 11.97C4.79865 11.0189 4.98493 10.0767 5.34851 9.19778C5.7121 8.31884 6.24582 7.52042 6.919 6.84843M6.84992 6.7794L6.919 6.84843M6.84992 6.7794C6.84995 6.77937 6.84998 6.77935 6.85001 6.77932L6.919 6.84843",fill:"#3370FF",stroke:"#3370FF","stroke-width":"0.195312"},null,-1)])])}const ot={render:tt},lt={class:"copilot"},at={class:"copilot-analysis"},st={class:"copilot-service"},it={class:"dialogue"},nt={style:{width:"100%",height:"calc(100% - 16px)"}},rt={class:"title-dataset_select"},ct={style:{margin:"0 16px"},class:"tree-select"},dt={class:"content"},ut=["title"],pt={class:"preview-field"},mt={class:"custom-tree-node father"},ft=["title"],_t={class:"custom-tree-node father"},vt=["title"],ht=Be({__name:"index",setup(F){const m=Ce(),{wsCache:O}=ye(),{t:f}=Le(),Z=q([]),P=q([]),C=q([]),_=u([]),d=u(""),y=u(""),x=u(!1),W={children:"children",label:"name"},pe={label:"name",children:"children",value:"id",isLeaf:t=>{var e;return!((e=t.children)!=null&&e.length)}},w=u(!0),k=u(!0),I=t=>t.filter(e=>{var a,r;return(a=e.children)!=null&&a.length&&!e.leaf?(e.children=I(e.children),!!((r=e.children)!=null&&r.length)):e.leaf}),j=u([]),H=V(()=>{var t;return((t=C.value[0])==null?void 0:t.id)==="0"?I(C.value[0].children):I(C.value)}),M=V(()=>y.value.trim().length&&!!d.value),me=["time_asc","time_desc","name_asc","name_desc"],fe=async()=>{await ze({}).then(t=>{C.value=t||[];let e=me[Number(O.get("TreeSort-backend"))??1];e=O.get("TreeSort-dataset")??e,j.value=ue(n(C)),C.value=qe(j.value,e)}),Ge().then(t=>{var a;const e=t||[];S=((a=e[e.length-1])==null?void 0:a.history)||[],_.value=ue(e).map(r=>({...r,loading:!1})),e.length&&(d.value=e[0].datasetGroupId,h=d.value,d.value&&D(d.value),h&&!L&&re(()=>{Q(H.value)}))})},$=u();let h="",K="",L="";const _e=V(()=>m.baseUrl?{height:"100%"}:{height:`calc(100vh - ${X+152}px)`}),Q=t=>t.filter(e=>{var a,r;return e.id===h&&(L=e.name),(a=e.children)!=null&&a.length&&!e.leaf?(e.children=Q(e.children),!!((r=e.children)!=null&&r.length)):e.leaf}),ve=()=>{if(h&&_.value.length){K=d.value,d.value=h;const t=f("copilot.ds_prefix")+L+f("copilot.ds_suffix");Te.confirm(f("copilot.confirm"),{confirmButtonType:"primary",type:"warning",tip:t,autofocus:!1,showClose:!1}).then(()=>{d.value=K,h=d.value,L=$.value.getCurrentNode().name,D(d.value),Oe().then(()=>{_.value=[],S=[]})})}else h=d.value,L=$.value.getCurrentNode().name,D(d.value)},D=t=>{Ze(t).then(e=>{var a,r;P.value=((a=e.data)==null?void 0:a.dimensionList)||[],Z.value=((r=e.data)==null?void 0:r.quotaList)||[]})};fe();let S=[];const J=u(),R=u(!1),{height:X}=xe(J);Fe(()=>X.value,t=>{R.value=t>48});const Y=t=>{x.value=t,_.value.forEach(e=>{e.loading=!0}),setTimeout(()=>{_.value.forEach(e=>{e.loading=!1})},300)},T=u(!1),ee=u(),te=t=>{if((t==null?void 0:t.keyCode)===229)return;(t==null?void 0:t.keyCode)===13&&t.preventDefault();let e=y.value;!M.value||T.value||(y.value="",ee.value.blur(),re(()=>{R.value=!1}),_.value.push({msgType:"user",chart:{},id:`${+new Date}`,question:e,chartData:{data:{},title:""},msgStatus:1}),T.value=!0,Pe({datasetGroupId:d.value,question:e,history:S}).then(a=>{_.value.push({...a||{},loading:!1}),S=a.history||[]}).finally(()=>{T.value=!1}))};return(t,e)=>{const a=be,r=ie,he=Ee,oe=We,ge=ke,le=ie,ae=we;return c(),E("div",lt,[s("div",at,[o(r,{style:{"margin-right":"8px","font-size":"24px"}},{default:l(()=>[o(a,{name:"copilot"},{default:l(()=>[o(n(Re),{class:"svg-icon"})]),_:1})]),_:1}),N(" "+g(n(f)("copilot.talking_analysis")),1)]),s("div",st,[s("div",it,[s("div",{class:"copilot-dialogue",style:ne(_e.value)},[o(G,{key:"isWelcome",isWelcome:""}),(c(!0),E(Ie,null,Me(_.value,i=>(c(),p(G,{copilotInfo:i,key:i.id},null,8,["copilotInfo"]))),128)),T.value?(c(),p(G,{key:"isAnswer",isAnswer:""})):b("",!0)],4),s("div",{class:v(["question-input",R.value&&"over-height"]),ref_key:"questionInputRef",ref:J},[o(he,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=i=>y.value=i),onKeydown:[e[1]||(e[1]=$e(()=>{},["stop"])),De(te,["enter"])],ref_key:"inputRef",ref:ee,autosize:{minRows:1,maxRows:8},type:"textarea",placeholder:t.$t("common.inputText")},null,8,["modelValue","placeholder"]),T.value?(c(),p(r,{key:0,class:"copilot-icon circular-input_icon"},{default:l(()=>[o(a,{name:"icon_loading_outlined"},{default:l(()=>[o(n(ot),{class:"svg-icon"})]),_:1})]),_:1})):(c(),p(r,{key:1,class:v(["copilot-icon",M.value&&"active"]),onClick:te},{default:l(()=>[o(a,null,{default:l(()=>[(c(),p(A(M.value?n(Qe):n(Ye)),{class:"svg-icon"}))]),_:1})]),_:1},8,["class"]))],2)]),s("div",{class:"dataset-select",style:ne({width:x.value?0:"280px"})},[o(oe,{effect:"dark",content:n(f)("relation.retract"),placement:"left"},{default:l(()=>[U(s("p",{class:"arrow-right",onClick:e[2]||(e[2]=i=>Y(!0))},[o(r,null,{default:l(()=>[o(a,{name:"icon_right_outlined"},{default:l(()=>[o(n(Ve),{class:"svg-icon"})]),_:1})]),_:1})],512),[[z,!x.value]])]),_:1},8,["content"]),o(oe,{effect:"dark",content:n(f)("relation.expand"),placement:"left"},{default:l(()=>[U(s("p",{class:"left-outlined",onClick:e[3]||(e[3]=i=>Y(!1))},[o(r,null,{default:l(()=>[o(a,{name:"icon_left_outlined"},{default:l(()=>[o(n(Ne),{class:"svg-icon"})]),_:1})]),_:1})],512),[[z,x.value]])]),_:1},8,["content"]),U(s("div",nt,[s("div",rt,g(n(f)("copilot.choose_dataset")),1),s("div",ct,[o(ge,{modelValue:d.value,"onUpdate:modelValue":e[4]||(e[4]=i=>d.value=i),data:H.value,placeholder:n(f)("copilot.pls_choose_dataset"),onChange:ve,props:pe,style:{width:"100%"},"node-key":"id",ref_key:"treeSelectRef",ref:$,placement:"bottom","render-after-expand":!1,filterable:"","popper-class":"dataset-tree"},{default:l(({node:i,data:se})=>[s("div",dt,[se.leaf?b("",!0):(c(),p(r,{key:0,size:"18px"},{default:l(()=>[o(a,{name:"dv-folder"},{default:l(()=>[o(n(Ae),{class:"svg-icon"})]),_:1})]),_:1})),se.leaf?(c(),p(r,{key:1,size:"18px"},{default:l(()=>[o(a,{name:"icon_dataset"},{default:l(()=>[o(n(Ue),{class:"svg-icon"})]),_:1})]),_:1})):b("",!0),s("span",{class:"label ellipsis",style:{"margin-left":"8px"},title:i.label},g(i.label),9,ut)])]),_:1},8,["modelValue","data","placeholder"])]),s("div",pt,[s("div",{class:v(["field-d",{open:w.value}])},[s("div",{class:v(["title",{expanded:w.value}]),onClick:e[5]||(e[5]=i=>w.value=!w.value)},[o(le,{class:"expand"},{default:l(()=>[o(a,null,{default:l(()=>[o(n(ce),{class:"svg-icon"})]),_:1})]),_:1}),N("  "+g(t.$t("chart.dimension")),1)],2),w.value?(c(),p(ae,{key:0,data:P.value,props:W},{default:l(({data:i})=>[s("span",mt,[o(r,null,{default:l(()=>[o(a,null,{default:l(()=>[(c(),p(A(n(de)[n(B)[i.deExtractType]]),{class:v(["svg-icon",`field-icon-${n(B)[[2,3].includes(i.deExtractType)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),s("span",{title:i.name,class:"label-tooltip"},g(i.name),9,ft)])]),_:1},8,["data"])):b("",!0)],2),e[7]||(e[7]=s("div",{class:"line-bottom"},null,-1)),s("div",{class:v(["field-q",{open:k.value}])},[s("div",{class:v(["title",{expanded:k.value}]),onClick:e[6]||(e[6]=i=>k.value=!k.value)},[o(le,{class:"expand"},{default:l(()=>[o(a,{name:"icon_expand-right_filled"},{default:l(()=>[o(n(ce),{class:"svg-icon"})]),_:1})]),_:1}),N("  "+g(t.$t("chart.quota")),1)],2),k.value?(c(),p(ae,{key:0,data:Z.value,props:W},{default:l(({data:i})=>[s("span",_t,[o(r,null,{default:l(()=>[o(a,null,{default:l(()=>[(c(),p(A(n(de)[n(B)[i.deExtractType]]),{class:v(["svg-icon",`field-icon-${n(B)[[2,3].includes(i.deExtractType)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),s("span",{title:i.name,class:"label-tooltip"},g(i.name),9,vt)])]),_:1},8,["data"])):b("",!0)],2)])],512),[[z,!x.value]])],4)])])}}});const bo=je(ht,[["__scopeId","data-v-93a5b6f9"]]);export{bo as default};

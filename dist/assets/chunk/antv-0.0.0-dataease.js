import{g as sa,c as Nm,i as qft,a as I7,r as L7}from"./lodash-0.0.0-dataease.js";import{_ as FM,a as zf}from"./library-0.0.0-dataease.js";const SI=Object.freeze(Object.defineProperty({__proto__:null,get Base(){return np},get Circle(){return rYt},get Ellipse(){return nYt},get Image(){return iYt},get Line(){return aYt},get Marker(){return gYt},get Path(){return YN},get Polygon(){return wYt},get Polyline(){return CYt},get Rect(){return AYt},get Text(){return MYt}},Symbol.toStringTag,{value:"Module"})),TI=Object.freeze(Object.defineProperty({__proto__:null,get Base(){return od},get Circle(){return FYt},get Dom(){return BYt},get Ellipse(){return NYt},get Image(){return kYt},get Line(){return zYt},get Marker(){return UYt},get Path(){return $Yt},get Polygon(){return HYt},get Polyline(){return VYt},get Rect(){return WYt},get Text(){return ZYt}},Symbol.toStringTag,{value:"Module"}));var uD=function(e,t){return uD=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])},uD(e,t)};function $t(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");uD(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var $=function(){return $=Object.assign||function(t){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},$.apply(this,arguments)};function fi(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}function HZ(e,t,r,n){var i=arguments.length,a=i<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(e,t,r,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a}function VZ(e,t){return function(r,n){t(r,n,e)}}function GZ(e,t,r,n,i,a){function o(S){if(S!==void 0&&typeof S!="function")throw new TypeError("Function expected");return S}for(var s=n.kind,l=s==="getter"?"get":s==="setter"?"set":"value",u=!t&&e?n.static?e:e.prototype:null,c=t||(u?Object.getOwnPropertyDescriptor(u,n.name):{}),f,d=!1,v=r.length-1;v>=0;v--){var g={};for(var x in n)g[x]=x==="access"?{}:n[x];for(var x in n.access)g.access[x]=n.access[x];g.addInitializer=function(S){if(d)throw new TypeError("Cannot add initializers after decoration has completed");a.push(o(S||null))};var w=(0,r[v])(s==="accessor"?{get:c.get,set:c.set}:c[l],g);if(s==="accessor"){if(w===void 0)continue;if(w===null||typeof w!="object")throw new TypeError("Object expected");(f=o(w.get))&&(c.get=f),(f=o(w.set))&&(c.set=f),(f=o(w.init))&&i.unshift(f)}else(f=o(w))&&(s==="field"?i.unshift(f):c[l]=f)}u&&Object.defineProperty(u,n.name,c),d=!0}function WZ(e,t,r){for(var n=arguments.length>2,i=0;i<t.length;i++)r=n?t[i].call(e,r):t[i].call(e);return n?r:void 0}function XZ(e){return typeof e=="symbol"?e:"".concat(e)}function jZ(e,t,r){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})}function YZ(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)}function lu(e,t,r,n){function i(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function s(c){try{u(n.next(c))}catch(f){o(f)}}function l(c){try{u(n.throw(c))}catch(f){o(f)}}function u(c){c.done?a(c.value):i(c.value).then(s,l)}u((n=n.apply(e,t||[])).next())})}function $h(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(u){return function(c){return l([u,c])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(r=0)),r;)try{if(n=1,i&&(a=u[0]&2?i.return:u[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,u[1])).done)return a;switch(i=0,a&&(u=[u[0]&2,a.value]),u[0]){case 0:case 1:a=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!a||u[1]>a[0]&&u[1]<a[3])){r.label=u[1];break}if(u[0]===6&&r.label<a[1]){r.label=a[1],a=u;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(u);break}a[2]&&r.ops.pop(),r.trys.pop();continue}u=t.call(e,r)}catch(c){u=[6,c],i=0}finally{n=a=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var AI=Object.create?function(e,t,r,n){n===void 0&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]};function ZZ(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&AI(t,e,r)}function yi(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Pr(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,a=[],o;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)a.push(i.value)}catch(s){o={error:s}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return a}function qZ(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(Pr(arguments[t]));return e}function Jy(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),i=0,t=0;t<r;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)n[i]=a[o];return n}function on(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,a;n<i;n++)(a||!(n in t))&&(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))}function Ux(e){return this instanceof Ux?(this.v=e,this):new Ux(e)}function KZ(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),i,a=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(v){return function(g){return Promise.resolve(g).then(v,f)}}function s(v,g){n[v]&&(i[v]=function(x){return new Promise(function(w,S){a.push([v,x,w,S])>1||l(v,x)})},g&&(i[v]=g(i[v])))}function l(v,g){try{u(n[v](g))}catch(x){d(a[0][3],x)}}function u(v){v.value instanceof Ux?Promise.resolve(v.value.v).then(c,f):d(a[0][2],v)}function c(v){l("next",v)}function f(v){l("throw",v)}function d(v,g){v(g),a.shift(),a.length&&l(a[0][0],a[0][1])}}function QZ(e){var t,r;return t={},n("next"),n("throw",function(i){throw i}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(i,a){t[i]=e[i]?function(o){return(r=!r)?{value:Ux(e[i](o)),done:!1}:a?a(o):o}:a}}function JZ(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof yi=="function"?yi(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(a){r[a]=e[a]&&function(o){return new Promise(function(s,l){o=e[a](o),i(s,l,o.done,o.value)})}}function i(a,o,s,l){Promise.resolve(l).then(function(u){a({value:u,done:s})},o)}}function tq(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var Kft=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},cD=function(e){return cD=Object.getOwnPropertyNames||function(t){var r=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[r.length]=n);return r},cD(e)};function eq(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=cD(e),n=0;n<r.length;n++)r[n]!=="default"&&AI(t,e,r[n]);return Kft(t,e),t}function rq(e){return e&&e.__esModule?e:{default:e}}function nq(e,t,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(e):n?n.value:t.get(e)}function iq(e,t,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(e,r):i?i.value=r:t.set(e,r),r}function aq(e,t){if(t===null||typeof t!="object"&&typeof t!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof e=="function"?t===e:e.has(t)}function oq(e,t,r){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var n,i;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");n=t[Symbol.asyncDispose]}if(n===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");n=t[Symbol.dispose],r&&(i=n)}if(typeof n!="function")throw new TypeError("Object not disposable.");i&&(n=function(){try{i.call(this)}catch(a){return Promise.reject(a)}}),e.stack.push({value:t,dispose:n,async:r})}else r&&e.stack.push({async:!0});return t}var Qft=typeof SuppressedError=="function"?SuppressedError:function(e,t,r){var n=new Error(r);return n.name="SuppressedError",n.error=e,n.suppressed=t,n};function sq(e){function t(a){e.error=e.hasError?new Qft(a,e.error,"An error was suppressed during disposal."):a,e.hasError=!0}var r,n=0;function i(){for(;r=e.stack.pop();)try{if(!r.async&&n===1)return n=0,e.stack.push(r),Promise.resolve().then(i);if(r.dispose){var a=r.dispose.call(r.value);if(r.async)return n|=2,Promise.resolve(a).then(i,function(o){return t(o),i()})}else n|=1}catch(o){t(o)}if(n===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return i()}function lq(e,t){return typeof e=="string"&&/^\.\.?\//.test(e)?e.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(r,n,i,a,o){return n?t?".jsx":".js":i&&(!a||!o)?r:i+a+"."+o.toLowerCase()+"js"}):e}const Jft={__extends:$t,__assign:$,__rest:fi,__decorate:HZ,__param:VZ,__esDecorate:GZ,__runInitializers:WZ,__propKey:XZ,__setFunctionName:jZ,__metadata:YZ,__awaiter:lu,__generator:$h,__createBinding:AI,__exportStar:ZZ,__values:yi,__read:Pr,__spread:qZ,__spreadArrays:Jy,__spreadArray:on,__await:Ux,__asyncGenerator:KZ,__asyncDelegator:QZ,__asyncValues:JZ,__makeTemplateObject:tq,__importStar:eq,__importDefault:rq,__classPrivateFieldGet:nq,__classPrivateFieldSet:iq,__classPrivateFieldIn:aq,__addDisposableResource:oq,__disposeResources:sq,__rewriteRelativeImportExtension:lq},PLe=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:oq,get __assign(){return $},__asyncDelegator:QZ,__asyncGenerator:KZ,__asyncValues:JZ,__await:Ux,__awaiter:lu,__classPrivateFieldGet:nq,__classPrivateFieldIn:aq,__classPrivateFieldSet:iq,__createBinding:AI,__decorate:HZ,__disposeResources:sq,__esDecorate:GZ,__exportStar:ZZ,__extends:$t,__generator:$h,__importDefault:rq,__importStar:eq,__makeTemplateObject:tq,__metadata:YZ,__param:VZ,__propKey:XZ,__read:Pr,__rest:fi,__rewriteRelativeImportExtension:lq,__runInitializers:WZ,__setFunctionName:jZ,__spread:qZ,__spreadArray:on,__spreadArrays:Jy,__values:yi,default:Jft},Symbol.toStringTag,{value:"Module"}));function tdt(e,t){if(FM(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(FM(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function uq(e){var t=tdt(e,"string");return FM(t)=="symbol"?t:t+""}function U(e,t,r){return(t=uq(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var bw,sO,cq,hD;function edt(){bw=document.createElement("table"),sO=document.createElement("tr"),cq=/^\s*<(\w+|!)[^>]*>/,hD={tr:document.createElement("tbody"),tbody:bw,thead:bw,tfoot:bw,td:sO,th:sO,"*":document.createElement("div")}}function hg(e){bw||edt();var t=cq.test(e)&&RegExp.$1;(!t||!(t in hD))&&(t="*");var r=hD[t];e=typeof e=="string"?e.replace(/(^\s*)|(\s*$)/g,""):e,r.innerHTML=""+e;var n=r.childNodes[0];return n&&r.contains(n)&&r.removeChild(n),n}const P5="l7plot-legend l7plot-legend__category",D5="l7plot-legend__title",F5="l7plot-legend__category-list",hq="l7plot-legend__list-item",fq="l7plot-legend__category-marker",dq="l7plot-legend__category-value",rdt=`<div class="${P5}">
  <div class="${D5}"></div>
  <ul class="${F5}"></ul>
</div>`,O7=`<li class="${hq}" data-index={index}>
  <span class="${fq}" style="background:{color}"></span>
  <span class="${dq}">{value}</span>
</li>`;function Tb(e,t){return!e||!t?e:e.replace(/\\?\{([^{}]+)\}/g,function(r,n){return r.charAt(0)==="\\"?r.slice(1):t[n]===void 0?"":t[n]})}var pq={},vq={},P7=e=>vq[e],qh=(e,t)=>{vq[e]=t},ndt=e=>pq[e],Ab=(e,t)=>{pq[e]=t},D7={},lO={},uO=34,NE=10,cO=13;function gq(e){return new Function("d","return {"+e.map(function(t,r){return JSON.stringify(t)+": d["+r+'] || ""'}).join(",")+"}")}function idt(e,t){var r=gq(e);return function(n,i){return t(r(n),i,e)}}function F7(e){var t=Object.create(null),r=[];return e.forEach(function(n){for(var i in n)i in t||r.push(t[i]=i)}),r}function Fc(e,t){var r=e+"",n=r.length;return n<t?new Array(t-n+1).join(0)+r:r}function adt(e){return e<0?"-"+Fc(-e,6):e>9999?"+"+Fc(e,6):Fc(e,4)}function odt(e){var t=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":adt(e.getUTCFullYear())+"-"+Fc(e.getUTCMonth()+1,2)+"-"+Fc(e.getUTCDate(),2)+(i?"T"+Fc(t,2)+":"+Fc(r,2)+":"+Fc(n,2)+"."+Fc(i,3)+"Z":n?"T"+Fc(t,2)+":"+Fc(r,2)+":"+Fc(n,2)+"Z":r||t?"T"+Fc(t,2)+":"+Fc(r,2)+"Z":"")}function sdt(e){var t=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(f,d){var v,g,x=i(f,function(w,S){if(v)return v(w,S-1);g=w,v=d?idt(w,d):gq(w)});return x.columns=g||[],x}function i(f,d){var v=[],g=f.length,x=0,w=0,S,M=g<=0,R=!1;f.charCodeAt(g-1)===NE&&--g,f.charCodeAt(g-1)===cO&&--g;function I(){if(M)return lO;if(R)return R=!1,D7;var k,z=x,G;if(f.charCodeAt(z)===uO){for(;x++<g&&f.charCodeAt(x)!==uO||f.charCodeAt(++x)===uO;);return(k=x)>=g?M=!0:(G=f.charCodeAt(x++))===NE?R=!0:G===cO&&(R=!0,f.charCodeAt(x)===NE&&++x),f.slice(z+1,k-1).replace(/""/g,'"')}for(;x<g;){if((G=f.charCodeAt(k=x++))===NE)R=!0;else if(G===cO)R=!0,f.charCodeAt(x)===NE&&++x;else if(G!==r)continue;return f.slice(z,k)}return M=!0,f.slice(z,g)}for(;(S=I())!==lO;){for(var P=[];S!==D7&&S!==lO;)P.push(S),S=I();d&&(P=d(P,w++))==null||v.push(P)}return v}function a(f,d){return f.map(function(v){return d.map(function(g){return c(v[g])}).join(e)})}function o(f,d){return d==null&&(d=F7(f)),[d.map(c).join(e)].concat(a(f,d)).join(`
`)}function s(f,d){return d==null&&(d=F7(f)),a(f,d).join(`
`)}function l(f){return f.map(u).join(`
`)}function u(f){return f.map(c).join(e)}function c(f){return f==null?"":f instanceof Date?odt(f):t.test(f+="")?'"'+f.replace(/"/g,'""')+'"':f}return{parse:n,parseRows:i,format:o,formatBody:s,formatRows:l,formatRow:u,formatValue:c}}var ldt=sdt(","),udt=ldt.parse,Oc=63710088e-1,cdt={centimeters:Oc*100,centimetres:Oc*100,degrees:Oc/111325,feet:Oc*3.28084,inches:Oc*39.37,kilometers:Oc/1e3,kilometres:Oc/1e3,meters:Oc,metres:Oc,miles:Oc/1609.344,millimeters:Oc*1e3,millimetres:Oc*1e3,nauticalmiles:Oc/1852,radians:1,yards:Oc*1.0936};function yC(e,t,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=t||{},n.geometry=e,n}function B5(e,t,r){r===void 0&&(r={});for(var n=0,i=e;n<i.length;n++){var a=i[n];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var o=0;o<a[a.length-1].length;o++)if(a[a.length-1][o]!==a[0][o])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:e};return yC(s,t,r)}function hdt(e,t,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return yC(n,t,r)}function fdt(e,t){t===void 0&&(t={});var r={type:"FeatureCollection"};return t.id&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.features=e,r}function ddt(e,t,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return yC(n,t,r)}function pdt(e,t){t===void 0&&(t="kilometers");var r=cdt[t];if(!r)throw new Error(t+" units is invalid");return e*r}function ET(e){var t=e%360;return t*Math.PI/180}function mq(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function B7(e){return e.type==="Feature"?e.geometry:e}function yq(e,t,r){if(e!==null)for(var n,i,a,o,s,l,u,c=0,f=0,d,v=e.type,g=v==="FeatureCollection",x=v==="Feature",w=g?e.features.length:1,S=0;S<w;S++){u=g?e.features[S].geometry:x?e.geometry:e,d=u?u.type==="GeometryCollection":!1,s=d?u.geometries.length:1;for(var M=0;M<s;M++){var R=0,I=0;if(o=d?u.geometries[M]:u,o!==null){l=o.coordinates;var P=o.type;switch(c=r&&(P==="Polygon"||P==="MultiPolygon")?1:0,P){case null:break;case"Point":if(t(l,f,S,R,I)===!1)return!1;f++,R++;break;case"LineString":case"MultiPoint":for(n=0;n<l.length;n++){if(t(l[n],f,S,R,I)===!1)return!1;f++,P==="MultiPoint"&&R++}P==="LineString"&&R++;break;case"Polygon":case"MultiLineString":for(n=0;n<l.length;n++){for(i=0;i<l[n].length-c;i++){if(t(l[n][i],f,S,R,I)===!1)return!1;f++}P==="MultiLineString"&&R++,P==="Polygon"&&I++}P==="Polygon"&&R++;break;case"MultiPolygon":for(n=0;n<l.length;n++){for(I=0,i=0;i<l[n].length;i++){for(a=0;a<l[n][i].length-c;a++){if(t(l[n][i][a],f,S,R,I)===!1)return!1;f++}I++}R++}break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)if(yq(o.geometries[n],t,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function vdt(e,t){var r,n,i,a,o,s,l,u,c,f,d=0,v=e.type==="FeatureCollection",g=e.type==="Feature",x=v?e.features.length:1;for(r=0;r<x;r++){for(s=v?e.features[r].geometry:g?e.geometry:e,u=v?e.features[r].properties:g?e.properties:{},c=v?e.features[r].bbox:g?e.bbox:void 0,f=v?e.features[r].id:g?e.id:void 0,l=s?s.type==="GeometryCollection":!1,o=l?s.geometries.length:1,i=0;i<o;i++){if(a=l?s.geometries[i]:s,a===null){if(t(null,d,u,c,f)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(a,d,u,c,f)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<a.geometries.length;n++)if(t(a.geometries[n],d,u,c,f)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}d++}}function _q(e,t){vdt(e,function(r,n,i,a,o){var s=r===null?null:r.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return t(yC(r,i,{bbox:a,id:o}),n,0)===!1?!1:void 0}var l;switch(s){case"MultiPoint":l="Point";break;case"MultiLineString":l="LineString";break;case"MultiPolygon":l="Polygon";break}for(var u=0;u<r.coordinates.length;u++){var c=r.coordinates[u],f={type:l,coordinates:c};if(t(yC(f,i),n,u)===!1)return!1}})}var KA={REGISTERED_PROTOCOLS:{}},gdt=Object.defineProperty,mdt=Object.defineProperties,ydt=Object.getOwnPropertyDescriptors,N7=Object.getOwnPropertySymbols,_dt=Object.prototype.hasOwnProperty,xdt=Object.prototype.propertyIsEnumerable,k7=(e,t,r)=>t in e?gdt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,N5=(e,t)=>{for(var r in t||(t={}))_dt.call(t,r)&&k7(e,r,t[r]);if(N7)for(var r of N7(t))xdt.call(t,r)&&k7(e,r,t[r]);return e},k5=(e,t)=>mdt(e,ydt(t)),z5=e=>KA.REGISTERED_PROTOCOLS[e.substring(0,e.indexOf("://"))],bdt=class extends Error{constructor(e,t,r,n){super(`AJAXError: ${t} (${e}): ${r}`),this.status=e,this.statusText=t,this.url=r,this.body=n}};function xq(e,t){const r=new XMLHttpRequest,n=Array.isArray(e.url)?e.url[0]:e.url;r.open(e.method||"GET",n,!0),e.type==="arrayBuffer"&&(r.responseType="arraybuffer");for(const i in e.headers)e.headers.hasOwnProperty(i)&&r.setRequestHeader(i,e.headers[i]);return e.type==="json"&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials=e.credentials==="include",r.onerror=()=>{t(new Error(r.statusText))},r.onload=()=>{if((r.status>=200&&r.status<300||r.status===0)&&r.response!==null){let i=r.response;if(e.type==="json")try{i=JSON.parse(r.response)}catch(a){return t(a)}t(null,i,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"),r)}else{const i=new Blob([r.response],{type:r.getResponseHeader("Content-Type")});t(new bdt(r.status,r.statusText,n.toString(),i))}},r.cancel=r.abort,r.send(e.body),r}function Edt(e){return new Promise((t,r)=>{xq(e,(n,i,a,o,s)=>{n?r({err:n,data:null,xhr:s}):t({err:null,data:i,cacheControl:a,expires:o,xhr:s})})})}function U5(e,t){return xq(e,t)}var wdt=(e,t)=>(z5(e.url)||U5)(k5(N5({},e),{type:"json"}),t),$5=(e,t)=>(z5(e.url)||U5)(k5(N5({},e),{type:"arrayBuffer"}),t),Cdt=(e,t)=>U5(k5(N5({},e),{method:"GET"}),t),z7="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function bq(e,t){const r=new window.Image,n=window.URL||window.webkitURL;r.crossOrigin="anonymous",r.onload=()=>{t(null,r),n.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(()=>{r.src=z7})},r.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const i=new Blob([new Uint8Array(e)],{type:"image/png"});r.src=e.byteLength?n.createObjectURL(i):z7}function Eq(e,t){const r=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(r).then(n=>{t(null,n)}).catch(n=>{t(new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}var fD=(e,t,r)=>{const n=(i,a)=>{if(i)t(i);else if(a){const o=typeof createImageBitmap=="function",s=r?r(a):a;o?Eq(s,t):bq(s,t)}};return e.type==="json"?wdt(e,n):$5(e,n)},Sdt=(e,t)=>{typeof createImageBitmap=="function"?Eq(e,t):bq(e,t)},MI=(e=>(e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e["BOTTOM-RIGHT"]="bottom-right",e.LEFT="left",e.RIGHT="right",e))(MI||{}),BM={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function wq(e,t,r){const n=e.classList;for(const i in BM)BM.hasOwnProperty(i)&&n.remove(`l7-${r}-anchor-${i}`);n.add(`l7-${r}-anchor-${t}`)}function H5(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function Cq(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function RS(){}var _C=.7,NM=1/_C,mx="\\s*([+-]?\\d+)\\s*",xC="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",jp="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Tdt=/^#([0-9a-f]{3,8})$/,Adt=new RegExp("^rgb\\("+[mx,mx,mx]+"\\)$"),Mdt=new RegExp("^rgb\\("+[jp,jp,jp]+"\\)$"),Rdt=new RegExp("^rgba\\("+[mx,mx,mx,xC]+"\\)$"),Idt=new RegExp("^rgba\\("+[jp,jp,jp,xC]+"\\)$"),Ldt=new RegExp("^hsl\\("+[xC,jp,jp]+"\\)$"),Odt=new RegExp("^hsla\\("+[xC,jp,jp,xC]+"\\)$"),U7={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};H5(RS,t0,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:$7,formatHex:$7,formatHsl:Pdt,formatRgb:H7,toString:H7});function $7(){return this.rgb().formatHex()}function Pdt(){return Sq(this).formatHsl()}function H7(){return this.rgb().formatRgb()}function t0(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=Tdt.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?V7(t):r===3?new zh(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?wT(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?wT(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Adt.exec(e))?new zh(t[1],t[2],t[3],1):(t=Mdt.exec(e))?new zh(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Rdt.exec(e))?wT(t[1],t[2],t[3],t[4]):(t=Idt.exec(e))?wT(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Ldt.exec(e))?X7(t[1],t[2]/100,t[3]/100,1):(t=Odt.exec(e))?X7(t[1],t[2]/100,t[3]/100,t[4]):U7.hasOwnProperty(e)?V7(U7[e]):e==="transparent"?new zh(NaN,NaN,NaN,0):null}function V7(e){return new zh(e>>16&255,e>>8&255,e&255,1)}function wT(e,t,r,n){return n<=0&&(e=t=r=NaN),new zh(e,t,r,n)}function Ddt(e){return e instanceof RS||(e=t0(e)),e?(e=e.rgb(),new zh(e.r,e.g,e.b,e.opacity)):new zh}function e0(e,t,r,n){return arguments.length===1?Ddt(e):new zh(e,t,r,n??1)}function zh(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}H5(zh,e0,Cq(RS,{brighter:function(e){return e=e==null?NM:Math.pow(NM,e),new zh(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?_C:Math.pow(_C,e),new zh(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:G7,formatHex:G7,formatRgb:W7,toString:W7}));function G7(){return"#"+hO(this.r)+hO(this.g)+hO(this.b)}function W7(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function hO(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function X7(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new kp(e,t,r,n)}function Sq(e){if(e instanceof kp)return new kp(e.h,e.s,e.l,e.opacity);if(e instanceof RS||(e=t0(e)),!e)return new kp;if(e instanceof kp)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,i=Math.min(t,r,n),a=Math.max(t,r,n),o=NaN,s=a-i,l=(a+i)/2;return s?(t===a?o=(r-n)/s+(r<n)*6:r===a?o=(n-t)/s+2:o=(t-r)/s+4,s/=l<.5?a+i:2-a-i,o*=60):s=l>0&&l<1?0:o,new kp(o,s,l,e.opacity)}function Fdt(e,t,r,n){return arguments.length===1?Sq(e):new kp(e,t,r,n??1)}function kp(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}H5(kp,Fdt,Cq(RS,{brighter:function(e){return e=e==null?NM:Math.pow(NM,e),new kp(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?_C:Math.pow(_C,e),new kp(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,i=2*r-n;return new zh(fO(e>=240?e-240:e+120,i,n),fO(e,i,n),fO(e<120?e+240:e-120,i,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function fO(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}function eo(e){const t=t0(e),r=[0,0,0,0];return t!=null&&(r[0]=t.r/255,r[1]=t.g/255,r[2]=t.b/255,r[3]=t.opacity),r}function Uy(e){const t=e&&e[0],r=e&&e[1],n=e&&e[2];return t+r*256+n*65536-1}function $x(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function Tq(e){let t=window.document.createElement("canvas"),r=t.getContext("2d");t.width=256,t.height=1;let n=null;const i=r.createLinearGradient(0,0,256,1),a=e.positions[0],o=e.positions[e.positions.length-1];for(let s=0;s<e.colors.length;++s){const l=(e.positions[s]-a)/(o-a);i.addColorStop(l,e.colors[s])}return r.fillStyle=i,r.fillRect(0,0,256,1),n=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),t=null,r=null,{data:n,width:256,height:1}}function Bdt(e,t){let r=window.document.createElement("canvas"),n=r.getContext("2d");r.width=256,r.height=1;const i=n.createLinearGradient(0,0,256,1),a=t[1]-t[0];for(let l=0;l<e.colors.length;++l){const u=Math.max((e.positions[l]-t[0])/a,0);i.addColorStop(u,e.colors[l])}n.fillStyle=i,n.fillRect(0,0,256,1);const o=n.getImageData(0,0,256,1).data,s=V5(n,o);return r=null,n=null,s}function Ndt(e){let t=window.document.createElement("canvas"),r=t.getContext("2d");t.width=256,t.height=1;const n=r.createImageData(256,1);return n.data.fill(0),e.positions.forEach((i,a)=>{const o=eo(e.colors[a]);n.data[i*4+0]=o[0]*255,n.data[i*4+1]=o[1]*255,n.data[i*4+2]=o[2]*255,n.data[i*4+3]=o[3]*255}),t=null,r=null,n}function kdt(e){let t=window.document.createElement("canvas"),r=t.getContext("2d");r.globalAlpha=1,t.width=256,t.height=1;const n=256/e.colors.length;for(let o=0;o<e.colors.length;o++)r.beginPath(),r.lineWidth=2,r.strokeStyle=e.colors[o],r.moveTo(o*n,0),r.lineTo((o+1)*n,0),r.stroke();const i=r.getImageData(0,0,256,1).data,a=V5(r,i);return t=null,r=null,a}function zdt(e,t){let r=window.document.createElement("canvas"),n=r.getContext("2d");n.globalAlpha=1,r.width=256,r.height=1;const i=t[1]-t[0];e.positions.length-e.colors.length!==1&&console.warn("positions 的数字个数应当比 colors 的样式多一个,poisitions 的首尾值一般为数据的最大最新值");for(let s=0;s<e.colors.length;s++)n.beginPath(),n.lineWidth=2,n.strokeStyle=e.colors[s],n.moveTo((e.positions[s]-t[0])/i*255,0),n.lineTo((e.positions[s+1]-t[0])/i*255,0),n.stroke();const a=n.getImageData(0,0,256,1).data,o=V5(n,a);return r=null,n=null,o}function V5(e,t){const r=e.createImageData(256,1);for(let n=0;n<r.data.length;n+=4)r.data[n+0]=t[n+0],r.data[n+1]=t[n+1],r.data[n+2]=t[n+2],r.data[n+3]=t[n+3];return r}function G5(e){switch(e==null?void 0:e.type){case"cat":return[0,255];default:return[0,1]}}function Udt(e,t,r){return e===e&&(r!==void 0&&(e=e<=r?e:r),t!==void 0&&(e=e>=t?e:t)),e}var $dt=Udt,Hdt=/\s/;function Vdt(e){for(var t=e.length;t--&&Hdt.test(e.charAt(t)););return t}var Gdt=Vdt,Wdt=Gdt,Xdt=/^\s+/;function jdt(e){return e&&e.slice(0,Wdt(e)+1).replace(Xdt,"")}var Ydt=jdt;function Zdt(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var rd=Zdt;const qdt=sa(rd);var Kdt=typeof Nm=="object"&&Nm&&Nm.Object===Object&&Nm,Aq=Kdt,Qdt=Aq,Jdt=typeof self=="object"&&self&&self.Object===Object&&self,tpt=Qdt||Jdt||Function("return this")(),Jd=tpt,ept=Jd,rpt=ept.Symbol,IS=rpt,j7=IS,Mq=Object.prototype,npt=Mq.hasOwnProperty,ipt=Mq.toString,kE=j7?j7.toStringTag:void 0;function apt(e){var t=npt.call(e,kE),r=e[kE];try{e[kE]=void 0;var n=!0}catch{}var i=ipt.call(e);return n&&(t?e[kE]=r:delete e[kE]),i}var opt=apt,spt=Object.prototype,lpt=spt.toString;function upt(e){return lpt.call(e)}var cpt=upt,Y7=IS,hpt=opt,fpt=cpt,dpt="[object Null]",ppt="[object Undefined]",Z7=Y7?Y7.toStringTag:void 0;function vpt(e){return e==null?e===void 0?ppt:dpt:Z7&&Z7 in Object(e)?hpt(e):fpt(e)}var Tg=vpt;function gpt(e){return e!=null&&typeof e=="object"}var nd=gpt,mpt=Tg,ypt=nd,_pt="[object Symbol]";function xpt(e){return typeof e=="symbol"||ypt(e)&&mpt(e)==_pt}var RI=xpt,bpt=Ydt,q7=rd,Ept=RI,K7=0/0,wpt=/^[-+]0x[0-9a-f]+$/i,Cpt=/^0b[01]+$/i,Spt=/^0o[0-7]+$/i,Tpt=parseInt;function Apt(e){if(typeof e=="number")return e;if(Ept(e))return K7;if(q7(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=q7(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=bpt(e);var r=Cpt.test(e);return r||Spt.test(e)?Tpt(e.slice(2),r?2:8):wpt.test(e)?K7:+e}var Rq=Apt,Mpt=$dt,dO=Rq;function Rpt(e,t,r){return r===void 0&&(r=t,t=void 0),r!==void 0&&(r=dO(r),r=r===r?r:0),t!==void 0&&(t=dO(t),t=t===t?t:0),Mpt(dO(e),t,r)}var Ipt=Rpt;const Lpt=sa(Ipt);function Opt(){this.__data__=[],this.size=0}var Ppt=Opt;function Dpt(e,t){return e===t||e!==e&&t!==t}var LS=Dpt,Fpt=LS;function Bpt(e,t){for(var r=e.length;r--;)if(Fpt(e[r][0],t))return r;return-1}var II=Bpt,Npt=II,kpt=Array.prototype,zpt=kpt.splice;function Upt(e){var t=this.__data__,r=Npt(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():zpt.call(t,r,1),--this.size,!0}var $pt=Upt,Hpt=II;function Vpt(e){var t=this.__data__,r=Hpt(t,e);return r<0?void 0:t[r][1]}var Gpt=Vpt,Wpt=II;function Xpt(e){return Wpt(this.__data__,e)>-1}var jpt=Xpt,Ypt=II;function Zpt(e,t){var r=this.__data__,n=Ypt(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}var qpt=Zpt,Kpt=Ppt,Qpt=$pt,Jpt=Gpt,tvt=jpt,evt=qpt;function Mb(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Mb.prototype.clear=Kpt;Mb.prototype.delete=Qpt;Mb.prototype.get=Jpt;Mb.prototype.has=tvt;Mb.prototype.set=evt;var LI=Mb,rvt=LI;function nvt(){this.__data__=new rvt,this.size=0}var ivt=nvt;function avt(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var ovt=avt;function svt(e){return this.__data__.get(e)}var lvt=svt;function uvt(e){return this.__data__.has(e)}var cvt=uvt,hvt=Tg,fvt=rd,dvt="[object AsyncFunction]",pvt="[object Function]",vvt="[object GeneratorFunction]",gvt="[object Proxy]";function mvt(e){if(!fvt(e))return!1;var t=hvt(e);return t==pvt||t==vvt||t==dvt||t==gvt}var OI=mvt;const yvt=sa(OI);var _vt=Jd,xvt=_vt["__core-js_shared__"],bvt=xvt,pO=bvt,Q7=function(){var e=/[^.]+$/.exec(pO&&pO.keys&&pO.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Evt(e){return!!Q7&&Q7 in e}var wvt=Evt,Cvt=Function.prototype,Svt=Cvt.toString;function Tvt(e){if(e!=null){try{return Svt.call(e)}catch{}try{return e+""}catch{}}return""}var Iq=Tvt,Avt=OI,Mvt=wvt,Rvt=rd,Ivt=Iq,Lvt=/[\\^$.*+?()[\]{}|]/g,Ovt=/^\[object .+?Constructor\]$/,Pvt=Function.prototype,Dvt=Object.prototype,Fvt=Pvt.toString,Bvt=Dvt.hasOwnProperty,Nvt=RegExp("^"+Fvt.call(Bvt).replace(Lvt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function kvt(e){if(!Rvt(e)||Mvt(e))return!1;var t=Avt(e)?Nvt:Ovt;return t.test(Ivt(e))}var zvt=kvt;function Uvt(e,t){return e==null?void 0:e[t]}var $vt=Uvt,Hvt=zvt,Vvt=$vt;function Gvt(e,t){var r=Vvt(e,t);return Hvt(r)?r:void 0}var T_=Gvt,Wvt=T_,Xvt=Jd,jvt=Wvt(Xvt,"Map"),W5=jvt,Yvt=T_,Zvt=Yvt(Object,"create"),PI=Zvt,J7=PI;function qvt(){this.__data__=J7?J7(null):{},this.size=0}var Kvt=qvt;function Qvt(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var Jvt=Qvt,tgt=PI,egt="__lodash_hash_undefined__",rgt=Object.prototype,ngt=rgt.hasOwnProperty;function igt(e){var t=this.__data__;if(tgt){var r=t[e];return r===egt?void 0:r}return ngt.call(t,e)?t[e]:void 0}var agt=igt,ogt=PI,sgt=Object.prototype,lgt=sgt.hasOwnProperty;function ugt(e){var t=this.__data__;return ogt?t[e]!==void 0:lgt.call(t,e)}var cgt=ugt,hgt=PI,fgt="__lodash_hash_undefined__";function dgt(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=hgt&&t===void 0?fgt:t,this}var pgt=dgt,vgt=Kvt,ggt=Jvt,mgt=agt,ygt=cgt,_gt=pgt;function Rb(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Rb.prototype.clear=vgt;Rb.prototype.delete=ggt;Rb.prototype.get=mgt;Rb.prototype.has=ygt;Rb.prototype.set=_gt;var xgt=Rb,tz=xgt,bgt=LI,Egt=W5;function wgt(){this.size=0,this.__data__={hash:new tz,map:new(Egt||bgt),string:new tz}}var Cgt=wgt;function Sgt(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var Tgt=Sgt,Agt=Tgt;function Mgt(e,t){var r=e.__data__;return Agt(t)?r[typeof t=="string"?"string":"hash"]:r.map}var DI=Mgt,Rgt=DI;function Igt(e){var t=Rgt(this,e).delete(e);return this.size-=t?1:0,t}var Lgt=Igt,Ogt=DI;function Pgt(e){return Ogt(this,e).get(e)}var Dgt=Pgt,Fgt=DI;function Bgt(e){return Fgt(this,e).has(e)}var Ngt=Bgt,kgt=DI;function zgt(e,t){var r=kgt(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}var Ugt=zgt,$gt=Cgt,Hgt=Lgt,Vgt=Dgt,Ggt=Ngt,Wgt=Ugt;function Ib(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Ib.prototype.clear=$gt;Ib.prototype.delete=Hgt;Ib.prototype.get=Vgt;Ib.prototype.has=Ggt;Ib.prototype.set=Wgt;var X5=Ib,Xgt=LI,jgt=W5,Ygt=X5,Zgt=200;function qgt(e,t){var r=this.__data__;if(r instanceof Xgt){var n=r.__data__;if(!jgt||n.length<Zgt-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Ygt(n)}return r.set(e,t),this.size=r.size,this}var Kgt=qgt,Qgt=LI,Jgt=ivt,tmt=ovt,emt=lvt,rmt=cvt,nmt=Kgt;function Lb(e){var t=this.__data__=new Qgt(e);this.size=t.size}Lb.prototype.clear=Jgt;Lb.prototype.delete=tmt;Lb.prototype.get=emt;Lb.prototype.has=rmt;Lb.prototype.set=nmt;var j5=Lb;function imt(e,t){for(var r=-1,n=e==null?0:e.length;++r<n&&t(e[r],r,e)!==!1;);return e}var amt=imt,omt=T_,smt=function(){try{var e=omt(Object,"defineProperty");return e({},"",{}),e}catch{}}(),Lq=smt,ez=Lq;function lmt(e,t,r){t=="__proto__"&&ez?ez(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var Y5=lmt,umt=Y5,cmt=LS,hmt=Object.prototype,fmt=hmt.hasOwnProperty;function dmt(e,t,r){var n=e[t];(!(fmt.call(e,t)&&cmt(n,r))||r===void 0&&!(t in e))&&umt(e,t,r)}var Oq=dmt,pmt=Oq,vmt=Y5;function gmt(e,t,r,n){var i=!r;r||(r={});for(var a=-1,o=t.length;++a<o;){var s=t[a],l=n?n(r[s],e[s],s,r,e):void 0;l===void 0&&(l=e[s]),i?vmt(r,s,l):pmt(r,s,l)}return r}var OS=gmt;function mmt(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var ymt=mmt,_mt=Tg,xmt=nd,bmt="[object Arguments]";function Emt(e){return xmt(e)&&_mt(e)==bmt}var wmt=Emt,rz=wmt,Cmt=nd,Pq=Object.prototype,Smt=Pq.hasOwnProperty,Tmt=Pq.propertyIsEnumerable,Amt=rz(function(){return arguments}())?rz:function(e){return Cmt(e)&&Smt.call(e,"callee")&&!Tmt.call(e,"callee")},Dq=Amt,Mmt=Array.isArray,Ag=Mmt,kM={exports:{}};function Rmt(){return!1}var Imt=Rmt;kM.exports;(function(e,t){var r=Jd,n=Imt,i=t&&!t.nodeType&&t,a=i&&!0&&e&&!e.nodeType&&e,o=a&&a.exports===i,s=o?r.Buffer:void 0,l=s?s.isBuffer:void 0,u=l||n;e.exports=u})(kM,kM.exports);var FI=kM.exports,Lmt=9007199254740991,Omt=/^(?:0|[1-9]\d*)$/;function Pmt(e,t){var r=typeof e;return t=t??Lmt,!!t&&(r=="number"||r!="symbol"&&Omt.test(e))&&e>-1&&e%1==0&&e<t}var Fq=Pmt,Dmt=9007199254740991;function Fmt(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Dmt}var Bq=Fmt,Bmt=Tg,Nmt=Bq,kmt=nd,zmt="[object Arguments]",Umt="[object Array]",$mt="[object Boolean]",Hmt="[object Date]",Vmt="[object Error]",Gmt="[object Function]",Wmt="[object Map]",Xmt="[object Number]",jmt="[object Object]",Ymt="[object RegExp]",Zmt="[object Set]",qmt="[object String]",Kmt="[object WeakMap]",Qmt="[object ArrayBuffer]",Jmt="[object DataView]",t0t="[object Float32Array]",e0t="[object Float64Array]",r0t="[object Int8Array]",n0t="[object Int16Array]",i0t="[object Int32Array]",a0t="[object Uint8Array]",o0t="[object Uint8ClampedArray]",s0t="[object Uint16Array]",l0t="[object Uint32Array]",ko={};ko[t0t]=ko[e0t]=ko[r0t]=ko[n0t]=ko[i0t]=ko[a0t]=ko[o0t]=ko[s0t]=ko[l0t]=!0;ko[zmt]=ko[Umt]=ko[Qmt]=ko[$mt]=ko[Jmt]=ko[Hmt]=ko[Vmt]=ko[Gmt]=ko[Wmt]=ko[Xmt]=ko[jmt]=ko[Ymt]=ko[Zmt]=ko[qmt]=ko[Kmt]=!1;function u0t(e){return kmt(e)&&Nmt(e.length)&&!!ko[Bmt(e)]}var c0t=u0t;function h0t(e){return function(t){return e(t)}}var BI=h0t,zM={exports:{}};zM.exports;(function(e,t){var r=Aq,n=t&&!t.nodeType&&t,i=n&&!0&&e&&!e.nodeType&&e,a=i&&i.exports===n,o=a&&r.process,s=function(){try{var l=i&&i.require&&i.require("util").types;return l||o&&o.binding&&o.binding("util")}catch{}}();e.exports=s})(zM,zM.exports);var Z5=zM.exports,f0t=c0t,d0t=BI,nz=Z5,iz=nz&&nz.isTypedArray,p0t=iz?d0t(iz):f0t,NI=p0t;const v0t=sa(NI);var g0t=ymt,m0t=Dq,y0t=Ag,_0t=FI,x0t=Fq,b0t=NI,E0t=Object.prototype,w0t=E0t.hasOwnProperty;function C0t(e,t){var r=y0t(e),n=!r&&m0t(e),i=!r&&!n&&_0t(e),a=!r&&!n&&!i&&b0t(e),o=r||n||i||a,s=o?g0t(e.length,String):[],l=s.length;for(var u in e)(t||w0t.call(e,u))&&!(o&&(u=="length"||i&&(u=="offset"||u=="parent")||a&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||x0t(u,l)))&&s.push(u);return s}var Nq=C0t,S0t=Object.prototype;function T0t(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||S0t;return e===r}var q5=T0t;function A0t(e,t){return function(r){return e(t(r))}}var kq=A0t,M0t=kq,R0t=M0t(Object.keys,Object),I0t=R0t,L0t=q5,O0t=I0t,P0t=Object.prototype,D0t=P0t.hasOwnProperty;function F0t(e){if(!L0t(e))return O0t(e);var t=[];for(var r in Object(e))D0t.call(e,r)&&r!="constructor"&&t.push(r);return t}var B0t=F0t,N0t=OI,k0t=Bq;function z0t(e){return e!=null&&k0t(e.length)&&!N0t(e)}var kI=z0t,U0t=Nq,$0t=B0t,H0t=kI;function V0t(e){return H0t(e)?U0t(e):$0t(e)}var K5=V0t,G0t=OS,W0t=K5;function X0t(e,t){return e&&G0t(t,W0t(t),e)}var j0t=X0t;function Y0t(e){var t=[];if(e!=null)for(var r in Object(e))t.push(r);return t}var Z0t=Y0t,q0t=rd,K0t=q5,Q0t=Z0t,J0t=Object.prototype,tyt=J0t.hasOwnProperty;function eyt(e){if(!q0t(e))return Q0t(e);var t=K0t(e),r=[];for(var n in e)n=="constructor"&&(t||!tyt.call(e,n))||r.push(n);return r}var ryt=eyt,nyt=Nq,iyt=ryt,ayt=kI;function oyt(e){return ayt(e)?nyt(e,!0):iyt(e)}var PS=oyt,syt=OS,lyt=PS;function uyt(e,t){return e&&syt(t,lyt(t),e)}var cyt=uyt,UM={exports:{}};UM.exports;(function(e,t){var r=Jd,n=t&&!t.nodeType&&t,i=n&&!0&&e&&!e.nodeType&&e,a=i&&i.exports===n,o=a?r.Buffer:void 0,s=o?o.allocUnsafe:void 0;function l(u,c){if(c)return u.slice();var f=u.length,d=s?s(f):new u.constructor(f);return u.copy(d),d}e.exports=l})(UM,UM.exports);var zq=UM.exports;function hyt(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}var Q5=hyt;function fyt(e,t){for(var r=-1,n=e==null?0:e.length,i=0,a=[];++r<n;){var o=e[r];t(o,r,e)&&(a[i++]=o)}return a}var dyt=fyt;function pyt(){return[]}var Uq=pyt,vyt=dyt,gyt=Uq,myt=Object.prototype,yyt=myt.propertyIsEnumerable,az=Object.getOwnPropertySymbols,_yt=az?function(e){return e==null?[]:(e=Object(e),vyt(az(e),function(t){return yyt.call(e,t)}))}:gyt,J5=_yt,xyt=OS,byt=J5;function Eyt(e,t){return xyt(e,byt(e),t)}var wyt=Eyt;function Cyt(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}var $q=Cyt,Syt=kq,Tyt=Syt(Object.getPrototypeOf,Object),t4=Tyt,Ayt=$q,Myt=t4,Ryt=J5,Iyt=Uq,Lyt=Object.getOwnPropertySymbols,Oyt=Lyt?function(e){for(var t=[];e;)Ayt(t,Ryt(e)),e=Myt(e);return t}:Iyt,Hq=Oyt,Pyt=OS,Dyt=Hq;function Fyt(e,t){return Pyt(e,Dyt(e),t)}var Byt=Fyt,Nyt=$q,kyt=Ag;function zyt(e,t,r){var n=t(e);return kyt(e)?n:Nyt(n,r(e))}var Vq=zyt,Uyt=Vq,$yt=J5,Hyt=K5;function Vyt(e){return Uyt(e,Hyt,$yt)}var Gq=Vyt,Gyt=Vq,Wyt=Hq,Xyt=PS;function jyt(e){return Gyt(e,Xyt,Wyt)}var Yyt=jyt,Zyt=T_,qyt=Jd,Kyt=Zyt(qyt,"DataView"),Qyt=Kyt,Jyt=T_,t_t=Jd,e_t=Jyt(t_t,"Promise"),r_t=e_t,n_t=T_,i_t=Jd,a_t=n_t(i_t,"Set"),Wq=a_t,o_t=T_,s_t=Jd,l_t=o_t(s_t,"WeakMap"),u_t=l_t,dD=Qyt,pD=W5,vD=r_t,gD=Wq,mD=u_t,Xq=Tg,Ob=Iq,oz="[object Map]",c_t="[object Object]",sz="[object Promise]",lz="[object Set]",uz="[object WeakMap]",cz="[object DataView]",h_t=Ob(dD),f_t=Ob(pD),d_t=Ob(vD),p_t=Ob(gD),v_t=Ob(mD),xy=Xq;(dD&&xy(new dD(new ArrayBuffer(1)))!=cz||pD&&xy(new pD)!=oz||vD&&xy(vD.resolve())!=sz||gD&&xy(new gD)!=lz||mD&&xy(new mD)!=uz)&&(xy=function(e){var t=Xq(e),r=t==c_t?e.constructor:void 0,n=r?Ob(r):"";if(n)switch(n){case h_t:return cz;case f_t:return oz;case d_t:return sz;case p_t:return lz;case v_t:return uz}return t});var zI=xy,g_t=Object.prototype,m_t=g_t.hasOwnProperty;function y_t(e){var t=e.length,r=new e.constructor(t);return t&&typeof e[0]=="string"&&m_t.call(e,"index")&&(r.index=e.index,r.input=e.input),r}var __t=y_t,x_t=Jd,b_t=x_t.Uint8Array,jq=b_t,hz=jq;function E_t(e){var t=new e.constructor(e.byteLength);return new hz(t).set(new hz(e)),t}var e4=E_t,w_t=e4;function C_t(e,t){var r=t?w_t(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}var S_t=C_t,T_t=/\w*$/;function A_t(e){var t=new e.constructor(e.source,T_t.exec(e));return t.lastIndex=e.lastIndex,t}var M_t=A_t,fz=IS,dz=fz?fz.prototype:void 0,pz=dz?dz.valueOf:void 0;function R_t(e){return pz?Object(pz.call(e)):{}}var I_t=R_t,L_t=e4;function O_t(e,t){var r=t?L_t(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}var Yq=O_t,P_t=e4,D_t=S_t,F_t=M_t,B_t=I_t,N_t=Yq,k_t="[object Boolean]",z_t="[object Date]",U_t="[object Map]",$_t="[object Number]",H_t="[object RegExp]",V_t="[object Set]",G_t="[object String]",W_t="[object Symbol]",X_t="[object ArrayBuffer]",j_t="[object DataView]",Y_t="[object Float32Array]",Z_t="[object Float64Array]",q_t="[object Int8Array]",K_t="[object Int16Array]",Q_t="[object Int32Array]",J_t="[object Uint8Array]",t1t="[object Uint8ClampedArray]",e1t="[object Uint16Array]",r1t="[object Uint32Array]";function n1t(e,t,r){var n=e.constructor;switch(t){case X_t:return P_t(e);case k_t:case z_t:return new n(+e);case j_t:return D_t(e,r);case Y_t:case Z_t:case q_t:case K_t:case Q_t:case J_t:case t1t:case e1t:case r1t:return N_t(e,r);case U_t:return new n;case $_t:case G_t:return new n(e);case H_t:return F_t(e);case V_t:return new n;case W_t:return B_t(e)}}var i1t=n1t,a1t=rd,vz=Object.create,o1t=function(){function e(){}return function(t){if(!a1t(t))return{};if(vz)return vz(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),s1t=o1t,l1t=s1t,u1t=t4,c1t=q5;function h1t(e){return typeof e.constructor=="function"&&!c1t(e)?l1t(u1t(e)):{}}var Zq=h1t,f1t=zI,d1t=nd,p1t="[object Map]";function v1t(e){return d1t(e)&&f1t(e)==p1t}var g1t=v1t,m1t=g1t,y1t=BI,gz=Z5,mz=gz&&gz.isMap,_1t=mz?y1t(mz):m1t,x1t=_1t,b1t=zI,E1t=nd,w1t="[object Set]";function C1t(e){return E1t(e)&&b1t(e)==w1t}var S1t=C1t,T1t=S1t,A1t=BI,yz=Z5,_z=yz&&yz.isSet,M1t=_z?A1t(_z):T1t,R1t=M1t,I1t=j5,L1t=amt,O1t=Oq,P1t=j0t,D1t=cyt,F1t=zq,B1t=Q5,N1t=wyt,k1t=Byt,z1t=Gq,U1t=Yyt,$1t=zI,H1t=__t,V1t=i1t,G1t=Zq,W1t=Ag,X1t=FI,j1t=x1t,Y1t=rd,Z1t=R1t,q1t=K5,K1t=PS,Q1t=1,J1t=2,txt=4,qq="[object Arguments]",ext="[object Array]",rxt="[object Boolean]",nxt="[object Date]",ixt="[object Error]",Kq="[object Function]",axt="[object GeneratorFunction]",oxt="[object Map]",sxt="[object Number]",Qq="[object Object]",lxt="[object RegExp]",uxt="[object Set]",cxt="[object String]",hxt="[object Symbol]",fxt="[object WeakMap]",dxt="[object ArrayBuffer]",pxt="[object DataView]",vxt="[object Float32Array]",gxt="[object Float64Array]",mxt="[object Int8Array]",yxt="[object Int16Array]",_xt="[object Int32Array]",xxt="[object Uint8Array]",bxt="[object Uint8ClampedArray]",Ext="[object Uint16Array]",wxt="[object Uint32Array]",Co={};Co[qq]=Co[ext]=Co[dxt]=Co[pxt]=Co[rxt]=Co[nxt]=Co[vxt]=Co[gxt]=Co[mxt]=Co[yxt]=Co[_xt]=Co[oxt]=Co[sxt]=Co[Qq]=Co[lxt]=Co[uxt]=Co[cxt]=Co[hxt]=Co[xxt]=Co[bxt]=Co[Ext]=Co[wxt]=!0;Co[ixt]=Co[Kq]=Co[fxt]=!1;function QA(e,t,r,n,i,a){var o,s=t&Q1t,l=t&J1t,u=t&txt;if(r&&(o=i?r(e,n,i,a):r(e)),o!==void 0)return o;if(!Y1t(e))return e;var c=W1t(e);if(c){if(o=H1t(e),!s)return B1t(e,o)}else{var f=$1t(e),d=f==Kq||f==axt;if(X1t(e))return F1t(e,s);if(f==Qq||f==qq||d&&!i){if(o=l||d?{}:G1t(e),!s)return l?k1t(e,D1t(o,e)):N1t(e,P1t(o,e))}else{if(!Co[f])return i?e:{};o=V1t(e,f,s)}}a||(a=new I1t);var v=a.get(e);if(v)return v;a.set(e,o),Z1t(e)?e.forEach(function(w){o.add(QA(w,t,r,w,e,a))}):j1t(e)&&e.forEach(function(w,S){o.set(S,QA(w,t,r,S,e,a))});var g=u?l?U1t:z1t:l?K1t:q1t,x=c?void 0:g(e);return L1t(x||e,function(w,S){x&&(S=w,w=e[S]),O1t(o,S,QA(w,t,r,S,e,a))}),o}var Cxt=QA,Sxt=Cxt,Txt=1,Axt=4;function Mxt(e){return Sxt(e,Txt|Axt)}var Rxt=Mxt;const Ixt=sa(Rxt);var Lxt=Jd,Oxt=function(){return Lxt.Date.now()},Pxt=Oxt,Dxt=rd,vO=Pxt,xz=Rq,Fxt="Expected a function",Bxt=Math.max,Nxt=Math.min;function kxt(e,t,r){var n,i,a,o,s,l,u=0,c=!1,f=!1,d=!0;if(typeof e!="function")throw new TypeError(Fxt);t=xz(t)||0,Dxt(r)&&(c=!!r.leading,f="maxWait"in r,a=f?Bxt(xz(r.maxWait)||0,t):a,d="trailing"in r?!!r.trailing:d);function v(k){var z=n,G=i;return n=i=void 0,u=k,o=e.apply(G,z),o}function g(k){return u=k,s=setTimeout(S,t),c?v(k):o}function x(k){var z=k-l,G=k-u,J=t-z;return f?Nxt(J,a-G):J}function w(k){var z=k-l,G=k-u;return l===void 0||z>=t||z<0||f&&G>=a}function S(){var k=vO();if(w(k))return M(k);s=setTimeout(S,x(k))}function M(k){return s=void 0,d&&n?v(k):(n=i=void 0,o)}function R(){s!==void 0&&clearTimeout(s),u=0,n=l=i=s=void 0}function I(){return s===void 0?o:M(vO())}function P(){var k=vO(),z=w(k);if(n=arguments,i=this,l=k,z){if(s===void 0)return g(l);if(f)return clearTimeout(s),s=setTimeout(S,t),v(l)}return s===void 0&&(s=setTimeout(S,t)),o}return P.cancel=R,P.flush=I,P}var Jq=kxt;const zxt=sa(Jq);var Uxt=Ag,$xt=RI,Hxt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Vxt=/^\w*$/;function Gxt(e,t){if(Uxt(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||$xt(e)?!0:Vxt.test(e)||!Hxt.test(e)||t!=null&&e in Object(t)}var Wxt=Gxt,tK=X5,Xxt="Expected a function";function r4(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(Xxt);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],a=r.cache;if(a.has(i))return a.get(i);var o=e.apply(this,n);return r.cache=a.set(i,o)||a,o};return r.cache=new(r4.Cache||tK),r}r4.Cache=tK;var jxt=r4,Yxt=jxt,Zxt=500;function qxt(e){var t=Yxt(e,function(n){return r.size===Zxt&&r.clear(),n}),r=t.cache;return t}var Kxt=qxt,Qxt=Kxt,Jxt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,tbt=/\\(\\)?/g,ebt=Qxt(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Jxt,function(r,n,i,a){t.push(i?a.replace(tbt,"$1"):n||r)}),t}),rbt=ebt;function nbt(e,t){for(var r=-1,n=e==null?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}var eK=nbt,bz=IS,ibt=eK,abt=Ag,obt=RI,sbt=1/0,Ez=bz?bz.prototype:void 0,wz=Ez?Ez.toString:void 0;function rK(e){if(typeof e=="string")return e;if(abt(e))return ibt(e,rK)+"";if(obt(e))return wz?wz.call(e):"";var t=e+"";return t=="0"&&1/e==-sbt?"-0":t}var lbt=rK,ubt=lbt;function cbt(e){return e==null?"":ubt(e)}var Pb=cbt,hbt=Ag,fbt=Wxt,dbt=rbt,pbt=Pb;function vbt(e,t){return hbt(e)?e:fbt(e,t)?[e]:dbt(pbt(e))}var gbt=vbt,mbt=RI,ybt=1/0;function _bt(e){if(typeof e=="string"||mbt(e))return e;var t=e+"";return t=="0"&&1/e==-ybt?"-0":t}var xbt=_bt,bbt=gbt,Ebt=xbt;function wbt(e,t){t=bbt(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[Ebt(t[r++])];return r&&r==n?e:void 0}var Cbt=wbt,Sbt=Cbt;function Tbt(e,t,r){var n=e==null?void 0:Sbt(e,t);return n===void 0?r:n}var Abt=Tbt;const Mbt=sa(Abt);var Rbt=Tg,Ibt=nd,Lbt="[object Boolean]";function Obt(e){return e===!0||e===!1||Ibt(e)&&Rbt(e)==Lbt}var Pbt=Obt;const Dbt=sa(Pbt);var Fbt="__lodash_hash_undefined__";function Bbt(e){return this.__data__.set(e,Fbt),this}var Nbt=Bbt;function kbt(e){return this.__data__.has(e)}var zbt=kbt,Ubt=X5,$bt=Nbt,Hbt=zbt;function $M(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new Ubt;++t<r;)this.add(e[t])}$M.prototype.add=$M.prototype.push=$bt;$M.prototype.has=Hbt;var nK=$M;function Vbt(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var Gbt=Vbt;function Wbt(e,t){return e.has(t)}var iK=Wbt,Xbt=nK,jbt=Gbt,Ybt=iK,Zbt=1,qbt=2;function Kbt(e,t,r,n,i,a){var o=r&Zbt,s=e.length,l=t.length;if(s!=l&&!(o&&l>s))return!1;var u=a.get(e),c=a.get(t);if(u&&c)return u==t&&c==e;var f=-1,d=!0,v=r&qbt?new Xbt:void 0;for(a.set(e,t),a.set(t,e);++f<s;){var g=e[f],x=t[f];if(n)var w=o?n(x,g,f,t,e,a):n(g,x,f,e,t,a);if(w!==void 0){if(w)continue;d=!1;break}if(v){if(!jbt(t,function(S,M){if(!Ybt(v,M)&&(g===S||i(g,S,r,n,a)))return v.push(M)})){d=!1;break}}else if(!(g===x||i(g,x,r,n,a))){d=!1;break}}return a.delete(e),a.delete(t),d}var aK=Kbt;function Qbt(e){var t=-1,r=Array(e.size);return e.forEach(function(n,i){r[++t]=[i,n]}),r}var Jbt=Qbt;function tEt(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var n4=tEt,Cz=IS,Sz=jq,eEt=LS,rEt=aK,nEt=Jbt,iEt=n4,aEt=1,oEt=2,sEt="[object Boolean]",lEt="[object Date]",uEt="[object Error]",cEt="[object Map]",hEt="[object Number]",fEt="[object RegExp]",dEt="[object Set]",pEt="[object String]",vEt="[object Symbol]",gEt="[object ArrayBuffer]",mEt="[object DataView]",Tz=Cz?Cz.prototype:void 0,gO=Tz?Tz.valueOf:void 0;function yEt(e,t,r,n,i,a,o){switch(r){case mEt:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case gEt:return!(e.byteLength!=t.byteLength||!a(new Sz(e),new Sz(t)));case sEt:case lEt:case hEt:return eEt(+e,+t);case uEt:return e.name==t.name&&e.message==t.message;case fEt:case pEt:return e==t+"";case cEt:var s=nEt;case dEt:var l=n&aEt;if(s||(s=iEt),e.size!=t.size&&!l)return!1;var u=o.get(e);if(u)return u==t;n|=oEt,o.set(e,t);var c=rEt(s(e),s(t),n,i,a,o);return o.delete(e),c;case vEt:if(gO)return gO.call(e)==gO.call(t)}return!1}var _Et=yEt,Az=Gq,xEt=1,bEt=Object.prototype,EEt=bEt.hasOwnProperty;function wEt(e,t,r,n,i,a){var o=r&xEt,s=Az(e),l=s.length,u=Az(t),c=u.length;if(l!=c&&!o)return!1;for(var f=l;f--;){var d=s[f];if(!(o?d in t:EEt.call(t,d)))return!1}var v=a.get(e),g=a.get(t);if(v&&g)return v==t&&g==e;var x=!0;a.set(e,t),a.set(t,e);for(var w=o;++f<l;){d=s[f];var S=e[d],M=t[d];if(n)var R=o?n(M,S,d,t,e,a):n(S,M,d,e,t,a);if(!(R===void 0?S===M||i(S,M,r,n,a):R)){x=!1;break}w||(w=d=="constructor")}if(x&&!w){var I=e.constructor,P=t.constructor;I!=P&&"constructor"in e&&"constructor"in t&&!(typeof I=="function"&&I instanceof I&&typeof P=="function"&&P instanceof P)&&(x=!1)}return a.delete(e),a.delete(t),x}var CEt=wEt,mO=j5,SEt=aK,TEt=_Et,AEt=CEt,Mz=zI,Rz=Ag,Iz=FI,MEt=NI,REt=1,Lz="[object Arguments]",Oz="[object Array]",CT="[object Object]",IEt=Object.prototype,Pz=IEt.hasOwnProperty;function LEt(e,t,r,n,i,a){var o=Rz(e),s=Rz(t),l=o?Oz:Mz(e),u=s?Oz:Mz(t);l=l==Lz?CT:l,u=u==Lz?CT:u;var c=l==CT,f=u==CT,d=l==u;if(d&&Iz(e)){if(!Iz(t))return!1;o=!0,c=!1}if(d&&!c)return a||(a=new mO),o||MEt(e)?SEt(e,t,r,n,i,a):TEt(e,t,l,r,n,i,a);if(!(r&REt)){var v=c&&Pz.call(e,"__wrapped__"),g=f&&Pz.call(t,"__wrapped__");if(v||g){var x=v?e.value():e,w=g?t.value():t;return a||(a=new mO),i(x,w,r,n,a)}}return d?(a||(a=new mO),AEt(e,t,r,n,i,a)):!1}var OEt=LEt,PEt=OEt,Dz=nd;function oK(e,t,r,n,i){return e===t?!0:e==null||t==null||!Dz(e)&&!Dz(t)?e!==e&&t!==t:PEt(e,t,r,n,oK,i)}var DEt=oK,FEt=DEt;function BEt(e,t){return FEt(e,t)}var NEt=BEt;const kEt=sa(NEt);function zEt(e){return e==null}var UEt=zEt;const $Et=sa(UEt);var HEt=Tg,VEt=nd,GEt="[object Number]";function WEt(e){return typeof e=="number"||VEt(e)&&HEt(e)==GEt}var XEt=WEt;const jEt=sa(XEt);var YEt=Tg,ZEt=t4,qEt=nd,KEt="[object Object]",QEt=Function.prototype,JEt=Object.prototype,sK=QEt.toString,twt=JEt.hasOwnProperty,ewt=sK.call(Object);function rwt(e){if(!qEt(e)||YEt(e)!=KEt)return!1;var t=ZEt(e);if(t===null)return!0;var r=twt.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&sK.call(r)==ewt}var lK=rwt;const nwt=sa(lK);var iwt=Tg,awt=Ag,owt=nd,swt="[object String]";function lwt(e){return typeof e=="string"||!awt(e)&&owt(e)&&iwt(e)==swt}var uwt=lwt;const cwt=sa(uwt);var hwt=Y5,fwt=LS;function dwt(e,t,r){(r!==void 0&&!fwt(e[t],r)||r===void 0&&!(t in e))&&hwt(e,t,r)}var uK=dwt;function pwt(e){return function(t,r,n){for(var i=-1,a=Object(t),o=n(t),s=o.length;s--;){var l=o[e?s:++i];if(r(a[l],l,a)===!1)break}return t}}var vwt=pwt,gwt=vwt,mwt=gwt(),ywt=mwt,_wt=kI,xwt=nd;function bwt(e){return xwt(e)&&_wt(e)}var Ewt=bwt;function wwt(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var cK=wwt,Cwt=OS,Swt=PS;function Twt(e){return Cwt(e,Swt(e))}var Awt=Twt,Fz=uK,Mwt=zq,Rwt=Yq,Iwt=Q5,Lwt=Zq,Bz=Dq,Nz=Ag,Owt=Ewt,Pwt=FI,Dwt=OI,Fwt=rd,Bwt=lK,Nwt=NI,kz=cK,kwt=Awt;function zwt(e,t,r,n,i,a,o){var s=kz(e,r),l=kz(t,r),u=o.get(l);if(u){Fz(e,r,u);return}var c=a?a(s,l,r+"",e,t,o):void 0,f=c===void 0;if(f){var d=Nz(l),v=!d&&Pwt(l),g=!d&&!v&&Nwt(l);c=l,d||v||g?Nz(s)?c=s:Owt(s)?c=Iwt(s):v?(f=!1,c=Mwt(l,!0)):g?(f=!1,c=Rwt(l,!0)):c=[]:Bwt(l)||Bz(l)?(c=s,Bz(s)?c=kwt(s):(!Fwt(s)||Dwt(s))&&(c=Lwt(l))):f=!1}f&&(o.set(l,c),i(c,l,n,a,o),o.delete(l)),Fz(e,r,c)}var Uwt=zwt,$wt=j5,Hwt=uK,Vwt=ywt,Gwt=Uwt,Wwt=rd,Xwt=PS,jwt=cK;function hK(e,t,r,n,i){e!==t&&Vwt(t,function(a,o){if(i||(i=new $wt),Wwt(a))Gwt(e,t,o,r,hK,n,i);else{var s=n?n(jwt(e,o),a,o+"",e,t,i):void 0;s===void 0&&(s=a),Hwt(e,o,s)}},Xwt)}var fK=hK;function Ywt(e){return e}var dK=Ywt;function Zwt(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var qwt=Zwt,Kwt=qwt,zz=Math.max;function Qwt(e,t,r){return t=zz(t===void 0?e.length-1:t,0),function(){for(var n=arguments,i=-1,a=zz(n.length-t,0),o=Array(a);++i<a;)o[i]=n[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=n[i];return s[t]=r(o),Kwt(e,this,s)}}var Jwt=Qwt;function tCt(e){return function(){return e}}var eCt=tCt,rCt=eCt,Uz=Lq,nCt=dK,iCt=Uz?function(e,t){return Uz(e,"toString",{configurable:!0,enumerable:!1,value:rCt(t),writable:!0})}:nCt,aCt=iCt,oCt=800,sCt=16,lCt=Date.now;function uCt(e){var t=0,r=0;return function(){var n=lCt(),i=sCt-(n-r);if(r=n,i>0){if(++t>=oCt)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var cCt=uCt,hCt=aCt,fCt=cCt,dCt=fCt(hCt),pCt=dCt,vCt=dK,gCt=Jwt,mCt=pCt;function yCt(e,t){return mCt(gCt(e,t,vCt),e+"")}var pK=yCt,_Ct=LS,xCt=kI,bCt=Fq,ECt=rd;function wCt(e,t,r){if(!ECt(r))return!1;var n=typeof t;return(n=="number"?xCt(r)&&bCt(t,r.length):n=="string"&&t in r)?_Ct(r[t],e):!1}var CCt=wCt,SCt=pK,TCt=CCt;function ACt(e){return SCt(function(t,r){var n=-1,i=r.length,a=i>1?r[i-1]:void 0,o=i>2?r[2]:void 0;for(a=e.length>3&&typeof a=="function"?(i--,a):void 0,o&&TCt(r[0],r[1],o)&&(a=i<3?void 0:a,i=1),t=Object(t);++n<i;){var s=r[n];s&&e(t,s,n,a)}return t})}var vK=ACt,MCt=fK,RCt=vK,ICt=RCt(function(e,t,r){MCt(e,t,r)}),LCt=ICt;const OCt=sa(LCt);var PCt=fK,DCt=vK,FCt=DCt(function(e,t,r,n){PCt(e,t,r,n)}),BCt=FCt;const NCt=sa(BCt);function kCt(e,t,r,n){for(var i=e.length,a=r+(n?1:-1);n?a--:++a<i;)if(t(e[a],a,e))return a;return-1}var zCt=kCt;function UCt(e){return e!==e}var $Ct=UCt;function HCt(e,t,r){for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return-1}var VCt=HCt,GCt=zCt,WCt=$Ct,XCt=VCt;function jCt(e,t,r){return t===t?XCt(e,t,r):GCt(e,WCt,r)}var gK=jCt;function YCt(e,t,r,n){for(var i=r-1,a=e.length;++i<a;)if(n(e[i],t))return i;return-1}var ZCt=YCt,qCt=eK,KCt=gK,QCt=ZCt,JCt=BI,tSt=Q5,eSt=Array.prototype,$z=eSt.splice;function rSt(e,t,r,n){var i=n?QCt:KCt,a=-1,o=t.length,s=e;for(e===t&&(t=tSt(t)),r&&(s=qCt(e,JCt(r)));++a<o;)for(var l=0,u=t[a],c=r?r(u):u;(l=i(s,c,l,n))>-1;)s!==e&&$z.call(s,l,1),$z.call(e,l,1);return e}var nSt=rSt,iSt=nSt;function aSt(e,t){return e&&e.length&&t&&t.length?iSt(e,t):e}var oSt=aSt,sSt=pK,lSt=oSt,uSt=sSt(lSt),cSt=uSt;const hSt=sa(cSt);var fSt=Jq,dSt=rd,pSt="Expected a function";function vSt(e,t,r){var n=!0,i=!0;if(typeof e!="function")throw new TypeError(pSt);return dSt(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),fSt(e,t,{leading:n,maxWait:t,trailing:i})}var gSt=vSt;const mSt=sa(gSt);var ySt=gK;function _St(e,t){var r=e==null?0:e.length;return!!r&&ySt(e,t,0)>-1}var xSt=_St;function bSt(e,t,r){for(var n=-1,i=e==null?0:e.length;++n<i;)if(r(t,e[n]))return!0;return!1}var ESt=bSt;function wSt(){}var CSt=wSt,yO=Wq,SSt=CSt,TSt=n4,ASt=1/0,MSt=yO&&1/TSt(new yO([,-0]))[1]==ASt?function(e){return new yO(e)}:SSt,RSt=MSt,ISt=nK,LSt=xSt,OSt=ESt,PSt=iK,DSt=RSt,FSt=n4,BSt=200;function NSt(e,t,r){var n=-1,i=LSt,a=e.length,o=!0,s=[],l=s;if(r)o=!1,i=OSt;else if(a>=BSt){var u=t?null:DSt(e);if(u)return FSt(u);o=!1,i=PSt,l=new ISt}else l=t?[]:s;t:for(;++n<a;){var c=e[n],f=t?t(c):c;if(c=r||c!==0?c:0,o&&f===f){for(var d=l.length;d--;)if(l[d]===f)continue t;t&&l.push(f),s.push(c)}else i(l,f,r)||(l!==s&&l.push(f),s.push(c))}return s}var kSt=NSt,zSt=kSt;function USt(e){return e&&e.length?zSt(e):[]}var $St=USt;const HSt=sa($St);function VSt(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),r=r>i?i:r,r<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var a=Array(i);++n<i;)a[n]=e[n+t];return a}var GSt=VSt,WSt=GSt;function XSt(e,t,r){var n=e.length;return r=r===void 0?n:r,!t&&r>=n?e:WSt(e,t,r)}var jSt=XSt,YSt="\\ud800-\\udfff",ZSt="\\u0300-\\u036f",qSt="\\ufe20-\\ufe2f",KSt="\\u20d0-\\u20ff",QSt=ZSt+qSt+KSt,JSt="\\ufe0e\\ufe0f",t2t="\\u200d",e2t=RegExp("["+t2t+YSt+QSt+JSt+"]");function r2t(e){return e2t.test(e)}var mK=r2t;function n2t(e){return e.split("")}var i2t=n2t,yK="\\ud800-\\udfff",a2t="\\u0300-\\u036f",o2t="\\ufe20-\\ufe2f",s2t="\\u20d0-\\u20ff",l2t=a2t+o2t+s2t,u2t="\\ufe0e\\ufe0f",c2t="["+yK+"]",yD="["+l2t+"]",_D="\\ud83c[\\udffb-\\udfff]",h2t="(?:"+yD+"|"+_D+")",_K="[^"+yK+"]",xK="(?:\\ud83c[\\udde6-\\uddff]){2}",bK="[\\ud800-\\udbff][\\udc00-\\udfff]",f2t="\\u200d",EK=h2t+"?",wK="["+u2t+"]?",d2t="(?:"+f2t+"(?:"+[_K,xK,bK].join("|")+")"+wK+EK+")*",p2t=wK+EK+d2t,v2t="(?:"+[_K+yD+"?",yD,xK,bK,c2t].join("|")+")",g2t=RegExp(_D+"(?="+_D+")|"+v2t+p2t,"g");function m2t(e){return e.match(g2t)||[]}var y2t=m2t,_2t=i2t,x2t=mK,b2t=y2t;function E2t(e){return x2t(e)?b2t(e):_2t(e)}var w2t=E2t,C2t=jSt,S2t=mK,T2t=w2t,A2t=Pb;function M2t(e){return function(t){t=A2t(t);var r=S2t(t)?T2t(t):void 0,n=r?r[0]:t.charAt(0),i=r?C2t(r,1).join(""):t.slice(1);return n[e]()+i}}var R2t=M2t,I2t=R2t,L2t=I2t("toUpperCase"),CK=L2t;const O2t=sa(CK);function P2t(e){return e===void 0}var D2t=P2t;const F2t=sa(D2t);var B2t=Pb,N2t=CK;function k2t(e){return N2t(B2t(e).toLowerCase())}var z2t=k2t;function U2t(e,t,r,n){var i=-1,a=e==null?0:e.length;for(n&&a&&(r=e[++i]);++i<a;)r=t(r,e[i],i,e);return r}var $2t=U2t;function H2t(e){return function(t){return e==null?void 0:e[t]}}var V2t=H2t,G2t=V2t,W2t={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},X2t=G2t(W2t),j2t=X2t,Y2t=j2t,Z2t=Pb,q2t=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,K2t="\\u0300-\\u036f",Q2t="\\ufe20-\\ufe2f",J2t="\\u20d0-\\u20ff",tTt=K2t+Q2t+J2t,eTt="["+tTt+"]",rTt=RegExp(eTt,"g");function nTt(e){return e=Z2t(e),e&&e.replace(q2t,Y2t).replace(rTt,"")}var iTt=nTt,aTt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function oTt(e){return e.match(aTt)||[]}var sTt=oTt,lTt=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function uTt(e){return lTt.test(e)}var cTt=uTt,SK="\\ud800-\\udfff",hTt="\\u0300-\\u036f",fTt="\\ufe20-\\ufe2f",dTt="\\u20d0-\\u20ff",pTt=hTt+fTt+dTt,TK="\\u2700-\\u27bf",AK="a-z\\xdf-\\xf6\\xf8-\\xff",vTt="\\xac\\xb1\\xd7\\xf7",gTt="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",mTt="\\u2000-\\u206f",yTt=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",MK="A-Z\\xc0-\\xd6\\xd8-\\xde",_Tt="\\ufe0e\\ufe0f",RK=vTt+gTt+mTt+yTt,IK="['’]",Hz="["+RK+"]",xTt="["+pTt+"]",LK="\\d+",bTt="["+TK+"]",OK="["+AK+"]",PK="[^"+SK+RK+LK+TK+AK+MK+"]",ETt="\\ud83c[\\udffb-\\udfff]",wTt="(?:"+xTt+"|"+ETt+")",CTt="[^"+SK+"]",DK="(?:\\ud83c[\\udde6-\\uddff]){2}",FK="[\\ud800-\\udbff][\\udc00-\\udfff]",Z1="["+MK+"]",STt="\\u200d",Vz="(?:"+OK+"|"+PK+")",TTt="(?:"+Z1+"|"+PK+")",Gz="(?:"+IK+"(?:d|ll|m|re|s|t|ve))?",Wz="(?:"+IK+"(?:D|LL|M|RE|S|T|VE))?",BK=wTt+"?",NK="["+_Tt+"]?",ATt="(?:"+STt+"(?:"+[CTt,DK,FK].join("|")+")"+NK+BK+")*",MTt="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",RTt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ITt=NK+BK+ATt,LTt="(?:"+[bTt,DK,FK].join("|")+")"+ITt,OTt=RegExp([Z1+"?"+OK+"+"+Gz+"(?="+[Hz,Z1,"$"].join("|")+")",TTt+"+"+Wz+"(?="+[Hz,Z1+Vz,"$"].join("|")+")",Z1+"?"+Vz+"+"+Gz,Z1+"+"+Wz,RTt,MTt,LK,LTt].join("|"),"g");function PTt(e){return e.match(OTt)||[]}var DTt=PTt,FTt=sTt,BTt=cTt,NTt=Pb,kTt=DTt;function zTt(e,t,r){return e=NTt(e),t=r?void 0:t,t===void 0?BTt(e)?kTt(e):FTt(e):e.match(t)||[]}var UTt=zTt,$Tt=$2t,HTt=iTt,VTt=UTt,GTt="['’]",WTt=RegExp(GTt,"g");function XTt(e){return function(t){return $Tt(VTt(HTt(t).replace(WTt,"")),e,"")}}var jTt=XTt,YTt=z2t,ZTt=jTt,qTt=ZTt(function(e,t,r){return t=t.toLowerCase(),e+(r?YTt(t):t)}),KTt=qTt;const QTt=sa(KTt);var JTt=Pb,tAt=0;function eAt(e){var t=++tAt;return JTt(e)+t}var rAt=eAt;const nAt=sa(rAt);var as={isNil:$Et,merge:OCt,throttle:mSt,isString:cwt,debounce:zxt,pull:hSt,isTypedArray:v0t,isPlainObject:nwt,isNumber:jEt,isBoolean:Dbt,isEqual:kEt,cloneDeep:Ixt,uniq:HSt,clamp:Lpt,upperFirst:O2t,get:Mbt,mergeWith:NCt,isFunction:yvt,isObject:qdt,isUndefined:F2t,camelCase:QTt,uniqueId:nAt};function kK(e){let t=e;return typeof e=="string"&&(t=window.document.getElementById(e)),t}function zK(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function UK(e){return zK(e).split(/\s+/)}function iAt(e){var t;const r=(t=document==null?void 0:document.documentElement)==null?void 0:t.style;if(!r)return e[0];for(const n in e)if(e[n]&&e[n]in r)return e[n];return e[0]}function Ua(e,t,r){const n=window.document.createElement(e);return t&&(n.className=t||""),r&&r.appendChild(n),n}function kh(e){const t=e.parentNode;t&&t.removeChild(e)}function Yp(e,t){if(e.classList!==void 0){const r=UK(t);for(let n=0,i=r.length;n<i;n++)e.classList.add(r[n])}else if(!aAt(e,t)){const r=i4(e);$K(e,(r?r+" ":"")+t)}}function Hx(e,t){e.classList!==void 0?UK(t).forEach(n=>{e.classList.remove(n)}):$K(e,zK((" "+i4(e)+" ").replace(" "+t+" "," ")))}function aAt(e,t){if(e.classList!==void 0)return e.classList.contains(t);const r=i4(e);return r.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(r)}function $K(e,t){e instanceof HTMLElement?e.className=t:e.className.baseVal=t}function i4(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}var oAt=iAt(["transform","WebkitTransform"]);function HK(e,t){e.style[oAt]=t}function sAt(){var e;const t=window.document.querySelector('meta[name="viewport"]');if(!t)return 1;const n=((e=t.content)==null?void 0:e.split(",")).find(i=>{const[a]=i.split("=");return a==="initial-scale"});return n?n.split("=")[1]*1:1}var Nc=sAt()<1?1:window.devicePixelRatio;function a4(e,t){e.setAttribute("style",`${e.style.cssText}${t}`)}function lAt(e){return Object.entries(e).map(([t,r])=>`${t}: ${r}`).join(";")}function uAt(e,t){return{left:e.left-t.left,top:e.top-t.top,right:t.left+t.width-e.left-e.width,bottom:t.top+t.height-e.top-e.height}}function DS(e){e.innerHTML=""}function cAt(e){e.setAttribute("draggable","false")}function Ty(e,t){if(typeof t=="string"){const r=document.createElement("div");for(r.innerHTML=t;r.firstChild;)e.append(r.firstChild)}else Array.isArray(t)?e.append(...t):e.append(t)}function hAt(e,t){var r;const n=Array.isArray(t)?t:[t];let i=e;for(;i instanceof Element&&i!==window.document.body;){if(n.find(a=>i==null?void 0:i.matches(a)))return i;i=(r=i==null?void 0:i.parentElement)!=null?r:null}}function fAt(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap}var HM=navigator==null?void 0:navigator.userAgent;HM.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);HM.indexOf("Android")>-1||HM.indexOf("Adr")>-1;function dAt(){const e=HM,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"];let r=!0;for(const n of t)if(e.indexOf(n)>0){r=!1;break}return r}function pAt(e,t){e.forEach(r=>{t[r]&&(t[r]=t[r].bind(t))})}function xD(e){var t=[1/0,1/0,-1/0,-1/0];return yq(e,function(r){t[0]>r[0]&&(t[0]=r[0]),t[1]>r[1]&&(t[1]=r[1]),t[2]<r[0]&&(t[2]=r[0]),t[3]<r[1]&&(t[3]=r[1])}),t}xD.default=xD;function _O(e){return typeof e=="number"}function nl(e){return e-Math.fround(e)}var Xz=2*Math.PI*6378137/2;function vAt(e,t){const[r,n,i,a]=t;return e.lng>r&&e.lng<=i&&e.lat>n&&e.lat<=a}function gAt(e){const t=[1/0,1/0,-1/0,-1/0];return e.forEach(r=>{const{coordinates:n}=r;VK(t,n)}),t}function VK(e,t){return Array.isArray(t[0])?t.forEach(r=>{VK(e,r)}):(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])),e}function JA(e,t=!0,r={enable:!0,decimal:1}){e=_At(e,t);const n=e[0],i=e[1];let a=n*Xz/180,o=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return o=o*Xz/180,r.enable&&(a=Number(a.toFixed(r.decimal)),o=Number(o.toFixed(r.decimal))),e.length===3?[a,o,e[2]]:[a,o]}function mAt(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function yAt(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function _At(e,t){if(t===!1)return e;const r=mAt(e[0]);let n=yAt(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function Nf(e){const t=85.0511287798,r=Math.max(Math.min(t,e[1]),-t),n=256<<20;let i=Math.PI/180,a=e[0]*i,o=r*i;o=Math.log(Math.tan(Math.PI/4+o/2));const s=.5/Math.PI,l=.5,u=-.5/Math.PI;return i=.5,a=n*(s*a+l),o=n*(u*o+i),[Math.floor(a),Math.floor(o)]}function xO(e,t){const r=85.0511287798,n=Math.PI/180,i=6378137;return t=Math.max(Math.min(r,t),-r),e*=n,t*=n,t=Math.log(Math.tan(Math.PI/4+t/2)),[e*i,t*i]}function xAt(e,t,r){const n=ET(t[1]-e[1]),i=ET(t[0]-e[0]),a=ET(e[1]),o=ET(t[1]),s=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(a)*Math.cos(o);return pdt(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)),"meters")}function o4(e,t){const r=Math.abs(e[1][1]-e[0][1])*t,n=Math.abs(e[1][0]-e[0][0])*t;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function GK(e,t){return e[0][0]<=t[0][0]&&e[0][1]<=t[0][1]&&e[1][0]>=t[1][0]&&e[1][1]>=t[1][1]}function VM(e){return[[e[0],e[1]],[e[2],e[3]]]}function bAt(e){const t=EAt(e,[0,0]);return[e[0]/t,e[1]/t]}function EAt(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function t_(e){if(_O(e[0]))return e;if(_O(e[0][0]))throw new Error("当前数据不支持标注");if(_O(e[0][0][0])){const t=e;let r=0,n=0,i=0;return t.forEach(a=>{a.forEach(o=>{r+=o[0],n+=o[1],i++})}),[r/i,n/i,0]}else throw new Error("当前数据不支持标注")}function wAt(e){let t=e[0],r=e[1],n=e[0],i=e[1],a=0,o=0,s=0;for(let l=0;l<e.length;l+=2){const u=e[l],c=e[l+1];u&&c&&(t=Math.max(u,t),r=Math.max(c,r),n=Math.min(u,n),i=Math.min(c,i),a+=u,o+=c,s++)}return{center:[a/s,o/s],radius:Math.sqrt(Math.pow(t-n,2)+Math.pow(r-i,2))/2}}function CAt(e){return xD(fdt([hdt(e)]))}function SAt(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}var TAt=class{constructor(e=50,t){this.limit=e,this.destroy=t||this.defaultDestroy,this.order=[],this.clear()}clear(){this.order.forEach(e=>{this.delete(e)}),this.cache={},this.order=[]}get(e){const t=this.cache[e];return t&&(this.deleteOrder(e),this.appendOrder(e)),t}set(e,t){this.cache[e]?(this.delete(e),this.cache[e]=t,this.appendOrder(e)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[e]=t,this.appendOrder(e))}delete(e){const t=this.cache[e];t&&(this.deleteCache(e),this.deleteOrder(e),this.destroy(t,e))}deleteCache(e){delete this.cache[e]}deleteOrder(e){const t=this.order.findIndex(r=>r===e);t>=0&&this.order.splice(t,1)}appendOrder(e){this.order.push(e)}defaultDestroy(e,t){return null}};function AAt(e){if(e.length===0)throw new Error("max requires at least one data point");let t=e[0];for(let r=1;r<e.length;r++)e[r]>t&&(t=e[r]);return t*1}function MAt(e){if(e.length===0)throw new Error("min requires at least one data point");let t=e[0];for(let r=1;r<e.length;r++)e[r]<t&&(t=e[r]);return t*1}function WK(e){if(e.length===0)return 0;let t=e[0]*1;for(let r=1;r<e.length;r++)t+=e[r]*1;return t}function RAt(e){if(e.length===0)throw new Error("mean requires at least one data point");return WK(e)/e.length}function IAt(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();let t=e[0],r=NaN,n=0,i=1;for(let a=1;a<e.length+1;a++)e[a]!==t?(i>n&&(n=i,r=t),i=1,t=e[a]):i++;return r*1}var XK={min:MAt,max:AAt,mean:RAt,sum:WK,mode:IAt};function jK(e,t){return e.map(r=>r[t])}function LAt(e,t){t===void 0&&(t={});var r=Number(e[0]),n=Number(e[1]),i=Number(e[2]),a=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var o=[r,n],s=[r,a],l=[i,a],u=[i,n];return B5([[o,u,l,s,o]],t.properties,{bbox:e,id:t.id})}var YK={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function i(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function a(l,u,c,f,d){if(typeof c!="function")throw new TypeError("The listener must be a function");var v=new i(c,f||l,d),g=r?r+u:u;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],v]:l._events[g].push(v):(l._events[g]=v,l._eventsCount++),l}function o(l,u){--l._eventsCount===0?l._events=new n:delete l._events[u]}function s(){this._events=new n,this._eventsCount=0}s.prototype.eventNames=function(){var u=[],c,f;if(this._eventsCount===0)return u;for(f in c=this._events)t.call(c,f)&&u.push(r?f.slice(1):f);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},s.prototype.listeners=function(u){var c=r?r+u:u,f=this._events[c];if(!f)return[];if(f.fn)return[f.fn];for(var d=0,v=f.length,g=new Array(v);d<v;d++)g[d]=f[d].fn;return g},s.prototype.listenerCount=function(u){var c=r?r+u:u,f=this._events[c];return f?f.fn?1:f.length:0},s.prototype.emit=function(u,c,f,d,v,g){var x=r?r+u:u;if(!this._events[x])return!1;var w=this._events[x],S=arguments.length,M,R;if(w.fn){switch(w.once&&this.removeListener(u,w.fn,void 0,!0),S){case 1:return w.fn.call(w.context),!0;case 2:return w.fn.call(w.context,c),!0;case 3:return w.fn.call(w.context,c,f),!0;case 4:return w.fn.call(w.context,c,f,d),!0;case 5:return w.fn.call(w.context,c,f,d,v),!0;case 6:return w.fn.call(w.context,c,f,d,v,g),!0}for(R=1,M=new Array(S-1);R<S;R++)M[R-1]=arguments[R];w.fn.apply(w.context,M)}else{var I=w.length,P;for(R=0;R<I;R++)switch(w[R].once&&this.removeListener(u,w[R].fn,void 0,!0),S){case 1:w[R].fn.call(w[R].context);break;case 2:w[R].fn.call(w[R].context,c);break;case 3:w[R].fn.call(w[R].context,c,f);break;case 4:w[R].fn.call(w[R].context,c,f,d);break;default:if(!M)for(P=1,M=new Array(S-1);P<S;P++)M[P-1]=arguments[P];w[R].fn.apply(w[R].context,M)}}return!0},s.prototype.on=function(u,c,f){return a(this,u,c,f,!1)},s.prototype.once=function(u,c,f){return a(this,u,c,f,!0)},s.prototype.removeListener=function(u,c,f,d){var v=r?r+u:u;if(!this._events[v])return this;if(!c)return o(this,v),this;var g=this._events[v];if(g.fn)g.fn===c&&(!d||g.once)&&(!f||g.context===f)&&o(this,v);else{for(var x=0,w=[],S=g.length;x<S;x++)(g[x].fn!==c||d&&!g[x].once||f&&g[x].context!==f)&&w.push(g[x]);w.length?this._events[v]=w.length===1?w[0]:w:o(this,v)}return this},s.prototype.removeAllListeners=function(u){var c;return u?(c=r?r+u:u,this._events[c]&&o(this,c)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s})(YK);var Gu=YK.exports;const s4=sa(Gu);var jw=(e=>(e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace",e))(jw||{}),If=(e=>(e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled",e))(If||{}),ZK=0,jz=1,UI=2;function OAt(e){e.forEach(t=>{t.isCurrent&&(t.isVisible=t.isLoaded)})}function PAt(e){e.forEach(t=>{t.properties.state=ZK}),e.forEach(t=>{t.isCurrent&&!qK(t)&&l4(t)}),e.forEach(t=>{t.isVisible=!!(t.properties.state&UI)})}function DAt(e){e.forEach(r=>{r.properties.state=ZK}),e.forEach(r=>{r.isCurrent&&qK(r)}),e.slice().sort((r,n)=>r.z-n.z).forEach(r=>{r.isVisible=!!(r.properties.state&UI),r.children.length&&(r.isVisible||r.properties.state&jz)?r.children.forEach(n=>{n.properties.state=jz}):r.isCurrent&&l4(r)})}function qK(e){for(;e;){if(e.isLoaded)return e.properties.state|=UI,!0;e=e.parent}return!1}function l4(e){e.children.forEach(t=>{t.isLoaded?t.properties.state|=UI:l4(t)})}var KK=[-1/0,-1/0,1/0,1/0],FAt=.2,BAt=5,NAt={[jw.Realtime]:OAt,[jw.Overlap]:PAt,[jw.Replace]:DAt},kAt=()=>{};function bD(e,t,r){const n=Math.floor((e+180)/360*Math.pow(2,r)),i=Math.floor((1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,r));return[n,i]}function Yz(e,t,r){const n=e/Math.pow(2,r)*360-180,i=Math.PI-2*Math.PI*t/Math.pow(2,r),a=180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)));return[n,a]}var QK=(e,t,r)=>{const[n,i]=Yz(e,t,r),[a,o]=Yz(e+1,t+1,r);return[n,o,a,i]};function zAt({zoom:e,latLonBounds:t,maxZoom:r=1/0,minZoom:n=0,zoomOffset:i=0,extent:a=KK}){let o=Math.ceil(e)+i;if(Number.isFinite(n)&&o<n)return[];Number.isFinite(r)&&o>r&&(o=r);const[s,l,u,c]=t,f=[Math.max(s,a[0]),Math.max(l,a[1]),Math.min(u,a[2]),Math.min(c,a[3])],d=[],[v,g]=bD(f[0],f[1],o),[x,w]=bD(f[2],f[3],o);for(let I=v;I<=x;I++)for(let P=w;P<=g;P++)d.push({x:I,y:P,z:o});const S=(x+v)/2,M=(g+w)/2,R=(I,P)=>Math.abs(I-S)+Math.abs(P-M);return d.sort((I,P)=>R(I.x,I.y)-R(P.x,P.y)),d}var UAt=(e,t,r,n=!0)=>{const i=Math.pow(2,r),a=i-1,o=i;let s=e;const l=t;return n&&(s<0?s=s+o:s>a&&(s=s%o)),{warpX:s,warpY:l}},$At=(e,t,r)=>new Promise((n,i)=>{var a=l=>{try{s(r.next(l))}catch(u){i(u)}},o=l=>{try{s(r.throw(l))}catch(u){i(u)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(a,o);s((r=r.apply(e,t)).next())}),HAt=class extends Gu.EventEmitter{constructor(e){super(),this.tileSize=256,this.isVisible=!1,this.isCurrent=!1,this.isVisibleChange=!1,this.loadedLayers=0,this.isLayerLoaded=!1,this.isLoad=!1,this.isChildLoad=!1,this.parent=null,this.children=[],this.data=null,this.properties={},this.loadDataId=0;const{x:t,y:r,z:n,tileSize:i,warp:a=!0}=e;this.x=t,this.y=r,this.z=n,this.warp=a||!0,this.tileSize=i}get isLoading(){return this.loadStatus===If.Loading}get isLoaded(){return this.loadStatus===If.Loaded}get isFailure(){return this.loadStatus===If.Failure}setTileLayerLoaded(){this.isLayerLoaded=!0}get isCancelled(){return this.loadStatus===If.Cancelled}get isDone(){return[If.Loaded,If.Cancelled,If.Failure].includes(this.loadStatus)}get bounds(){return QK(this.x,this.y,this.z)}get bboxPolygon(){const[e,t,r,n]=this.bounds,i=[(r-e)/2,(n-t)/2];return LAt(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:i,meta:`
      ${this.key}
      `}})}get key(){return`${this.x}_${this.y}_${this.z}`}layerLoad(){this.loadedLayers++,this.emit("layerLoaded")}loadData(e){return $At(this,arguments,function*({getData:t,onLoad:r,onError:n}){this.loadDataId++;const i=this.loadDataId;this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=If.Loading;let a=null,o;try{const{x:s,y:l,z:u,bounds:c,tileSize:f,warp:d}=this,{warpX:v,warpY:g}=UAt(s,l,u,d),{signal:x}=this.abortController;a=yield t({x:v,y:g,z:u,bounds:c,tileSize:f,signal:x,warp:d},this)}catch(s){o=s}if(i===this.loadDataId&&!(this.isCancelled&&!a)){if(o||!a){this.loadStatus=If.Failure,n(o,this);return}this.loadStatus=If.Loaded,this.data=a,r(this)}})}reloadData(e){this.isLoading&&this.abortLoad(),this.loadData(e)}abortLoad(){this.isLoaded||this.isCancelled||(this.loadStatus=If.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}},VAt=(e,t)=>{const r=VM(e),n=o4(r,t),i=360*3-180,a=85.0511287798065;return[Math.max(n[0][0],-i),Math.max(n[0][1],-a),Math.min(n[1][0],i),Math.min(n[1][1],a)]},GAt=(e,t)=>{const r=VM(e),n=VM(t);return GK(r,n)},WAt=Object.defineProperty,XAt=Object.defineProperties,jAt=Object.getOwnPropertyDescriptors,Zz=Object.getOwnPropertySymbols,YAt=Object.prototype.hasOwnProperty,ZAt=Object.prototype.propertyIsEnumerable,qz=(e,t,r)=>t in e?WAt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Kz=(e,t)=>{for(var r in t||(t={}))YAt.call(t,r)&&qz(e,r,t[r]);if(Zz)for(var r of Zz(t))ZAt.call(t,r)&&qz(e,r,t[r]);return e},qAt=(e,t)=>XAt(e,jAt(t)),{throttle:KAt}=as,QAt=class extends s4{constructor(e){super(),this.currentTiles=[],this.cacheTiles=new Map,this.throttleUpdate=KAt((t,r)=>{this.update(t,r)},16),this.onTileLoad=t=>{this.emit("tile-loaded",t),this.updateTileVisible(),this.loadFinished()},this.onTileError=(t,r)=>{this.emit("tile-error",{error:t,tile:r}),this.updateTileVisible(),this.loadFinished()},this.onTileUnload=t=>{this.emit("tile-unload",t),this.loadFinished()},this.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:KK,getTileData:kAt,warp:!0,updateStrategy:jw.Replace},this.updateOptions(e)}get isLoaded(){return this.currentTiles.every(e=>e.isDone)}get tiles(){return Array.from(this.cacheTiles.values()).sort((t,r)=>t.z-r.z)}updateOptions(e){const t=e.minZoom===void 0?this.options.minZoom:Math.ceil(e.minZoom),r=e.maxZoom===void 0?this.options.maxZoom:Math.floor(e.maxZoom);this.options=qAt(Kz(Kz({},this.options),e),{minZoom:t,maxZoom:r})}update(e,t){const r=Math.max(0,Math.ceil(e));if(this.lastViewStates&&this.lastViewStates.zoom===r&&GAt(this.lastViewStates.latLonBoundsBuffer,t))return;const n=VAt(t,FAt);this.lastViewStates={zoom:r,latLonBounds:t,latLonBoundsBuffer:n},this.currentZoom=r;let i=!1;const a=this.getTileIndices(r,n).filter(o=>this.options.warp||o.x>=0&&o.x<Math.pow(2,r));this.emit("tiles-load-start"),this.currentTiles=a.map(({x:o,y:s,z:l})=>{let u=this.getTile(o,s,l);return u?(((u==null?void 0:u.isFailure)||(u==null?void 0:u.isCancelled))&&u.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),u):(u=this.createTile(o,s,l),i=!0,u)}),i&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}reloadAll(){for(const[e,t]of this.cacheTiles){if(!this.currentTiles.includes(t)){this.cacheTiles.delete(e),this.onTileUnload(t);return}this.onTileUnload(t),t.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}reloadTileById(e,t,r){const n=this.cacheTiles.get(`${t},${r},${e}`);n&&(this.onTileUnload(n),n.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}reloadTileByLnglat(e,t,r){const n=this.getTileByLngLat(e,t,r);n&&this.reloadTileById(n.z,n.x,n.y)}reloadTileByExtent(e,t){this.getTileIndices(t,e).forEach(n=>{this.reloadTileById(n.z,n.x,n.y)})}pruneRequests(){const e=[];for(const t of this.cacheTiles.values())t.isLoading&&!t.isCurrent&&!t.isVisible&&e.push(t);for(;e.length>0;)e.shift().abortLoad()}getTileByLngLat(e,t,r){const{zoomOffset:n}=this.options,i=Math.ceil(r)+n,a=bD(e,t,i);return this.tiles.filter(s=>s.key===`${a[0]}_${a[1]}_${i}`)[0]}getTileExtent(e,t){return this.getTileIndices(t,e)}getTileByZXY(e,t,r){return this.tiles.filter(i=>i.key===`${t}_${r}_${e}`)[0]}clear(){for(const e of this.cacheTiles.values())e.isLoading?e.abortLoad():this.onTileUnload(e);this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}destroy(){this.clear(),this.removeAllListeners()}updateTileVisible(){const e=this.options.updateStrategy,t=new Map;for(const i of this.cacheTiles.values())t.set(i.key,i.isVisible),i.isCurrent=!1,i.isVisible=!1;for(const i of this.currentTiles)i.isCurrent=!0,i.isVisible=!0;const r=Array.from(this.cacheTiles.values());typeof e=="function"?e(r):NAt[e](r);let n=!1;Array.from(this.cacheTiles.values()).forEach(i=>{i.isVisible!==t.get(i.key)?(i.isVisibleChange=!0,n=!0):i.isVisibleChange=!1}),n&&this.emit("tile-update")}getTileIndices(e,t){const{tileSize:r,extent:n,zoomOffset:i}=this.options,a=Math.floor(this.options.maxZoom),o=Math.ceil(this.options.minZoom);return zAt({maxZoom:a,minZoom:o,zoomOffset:i,tileSize:r,zoom:e,latLonBounds:t,extent:n})}getTileId(e,t,r){return`${e},${t},${r}`}loadFinished(){const e=!this.currentTiles.some(t=>!t.isDone);return e&&this.emit("tiles-load-finished"),e}getTile(e,t,r){const n=this.getTileId(e,t,r);return this.cacheTiles.get(n)}createTile(e,t,r){const n=this.getTileId(e,t,r),i=new HAt({x:e,y:t,z:r,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(n,i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),i}resizeCacheTiles(){const e=BAt*this.currentTiles.length;if(this.cacheTiles.size>e){for(const[r,n]of this.cacheTiles)if(!n.isVisible&&!this.currentTiles.includes(n)&&(this.cacheTiles.delete(r),this.onTileUnload(n)),this.cacheTiles.size<=e)break}this.rebuildTileTree()}rebuildTileTree(){for(const e of this.cacheTiles.values())e.parent=null,e.children.length=0;for(const e of this.cacheTiles.values()){const t=this.getNearestAncestor(e.x,e.y,e.z);e.parent=t,t!=null&&t.children&&t.children.push(e)}}getNearestAncestor(e,t,r){for(;r>this.options.minZoom;){e=Math.floor(e/2),t=Math.floor(t/2),r=r-1;const n=this.getTile(e,t,r);if(n)return n}return null}};function JK(e){const t=[];let r=/\{([a-z])-([a-z])\}/.exec(e);if(r){const n=r[1].charCodeAt(0),i=r[2].charCodeAt(0);let a;for(a=n;a<=i;++a)t.push(e.replace(r[0],String.fromCharCode(a)));return t}if(r=/\{(\d+)-(\d+)\}/.exec(e),r){const n=parseInt(r[2],10);for(let i=parseInt(r[1],10);i<=n;i++)t.push(e.replace(r[0],i.toString()));return t}return t.push(e),t}function yx(e,t){if(!e||!e.length)throw new Error("url is not allowed to be empty");const{x:r,y:n,z:i}=t,a=JK(e),o=Math.abs(r+n)%a.length;return(z5(a[o])?`${a[o]}/{z}/{x}/{y}`:a[o]).replace(/\{x\}/g,r.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,i.toString()).replace(/\{bbox\}/g,QK(r,n,i).join(",")).replace(/\{-y\}/g,(Math.pow(2,i)-n-1).toString())}function JAt(e,t){const{x:r,y:n,z:i,layer:a,version:o="1.0.0",style:s="default",format:l,service:u="WMTS",tileMatrixset:c}=t,f=JK(e),d=Math.abs(r+n)%f.length;return`${f[d]}&SERVICE=${u}&REQUEST=GetTile&VERSION=${o}&LAYER=${a}&STYLE=${s}&TILEMATRIXSET=${c}&FORMAT=${l}&TILECOL=${r}&TILEROW=${n}&TILEMATRIX=${i}`}function zE(e,t){return e??t}var tMt=tM;function tM(e,t){var r=e&&e.type,n;if(r==="FeatureCollection")for(n=0;n<e.features.length;n++)tM(e.features[n],t);else if(r==="GeometryCollection")for(n=0;n<e.geometries.length;n++)tM(e.geometries[n],t);else if(r==="Feature")tM(e.geometry,t);else if(r==="Polygon")Qz(e.coordinates,t);else if(r==="MultiPolygon")for(n=0;n<e.coordinates.length;n++)Qz(e.coordinates[n],t);return e}function Qz(e,t){if(e.length!==0){Jz(e[0],t);for(var r=1;r<e.length;r++)Jz(e[r],!t)}}function Jz(e,t){for(var r=0,n=0,i=0,a=e.length,o=a-1;i<a;o=i++){var s=(e[i][0]-e[o][0])*(e[o][1]+e[i][1]),l=r+s;n+=Math.abs(r)>=Math.abs(s)?r-l+s:s-l+r,r=l}r+n>=0!=!!t&&e.reverse()}const eMt=sa(tMt);function rMt(e,t){return e.map(r=>r[t]*1)}function tQ(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function ED(e){const t=Object.isFrozen(e)?as.cloneDeep(e):e;return eMt(t,!0),t}function Db(e,t){return e||[[t[0],t[3]],[t[2],t[3]],[t[2],t[1]],[t[0],t[1]]]}var nMt=Object.defineProperty,iMt=Object.defineProperties,aMt=Object.getOwnPropertyDescriptors,tU=Object.getOwnPropertySymbols,oMt=Object.prototype.hasOwnProperty,sMt=Object.prototype.propertyIsEnumerable,eU=(e,t,r)=>t in e?nMt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,rU=(e,t)=>{for(var r in t||(t={}))oMt.call(t,r)&&eU(e,r,t[r]);if(tU)for(var r of tU(t))sMt.call(t,r)&&eU(e,r,t[r]);return e},nU=(e,t)=>iMt(e,aMt(t));function eQ(e,t){const{x:r,y:n,x1:i,y1:a,coordinates:o,geometry:s}=t,l=[];if(!Array.isArray(e))return{dataArray:[]};if(s)return e.filter(u=>u[s]&&u[s].type&&u[s].coordinates&&u[s].coordinates.length>0).forEach((u,c)=>{const f=ED(u[s]);_q(f,d=>{const v=mq(d),g=nU(rU({},u),{_id:c,coordinates:v});l.push(g)})}),{dataArray:l};for(let u=0;u<e.length;u++){const c=e[u];let f=[];if(o){let v="Polygon";Array.isArray(o[0])||(v="Point"),Array.isArray(o[0])&&!Array.isArray(o[0][0])&&(v="LineString"),f=ED({type:v,coordinates:c[o]}).coordinates}else if(r&&n&&i&&a){const v=[parseFloat(c[r]),parseFloat(c[n])],g=[parseFloat(c[i]),parseFloat(c[a])];f=[v,g]}else r&&n&&(f=[parseFloat(c[r]),parseFloat(c[n])]);const d=nU(rU({},c),{_id:u,coordinates:f});l.push(d)}return{dataArray:l}}function lMt(e,t){const r=udt(e);return eQ(r,t)}var uMt=Object.defineProperty,cMt=Object.defineProperties,hMt=Object.getOwnPropertyDescriptors,iU=Object.getOwnPropertySymbols,fMt=Object.prototype.hasOwnProperty,dMt=Object.prototype.propertyIsEnumerable,aU=(e,t,r)=>t in e?uMt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,pMt=(e,t)=>{for(var r in t||(t={}))fMt.call(t,r)&&aU(e,r,t[r]);if(iU)for(var r of iU(t))dMt.call(t,r)&&aU(e,r,t[r]);return e},vMt=(e,t)=>cMt(e,hMt(t));function gMt(e){const t=e.toString();let r=5381,n=t.length;for(;n;)r=r*33^t.charCodeAt(--n);return r>>>0}function mMt(e,t){return t===void 0?null:isNaN(e.properties[t]*1)?e.properties&&e.properties[t]?gMt(e.properties[t]+"")%1000019:null:e.properties[t]*1}function yMt(e,t){const r=[],n={};return e.features?(e.features=e.features.filter(i=>{const a=i.geometry;return i!=null&&a&&a.type&&a.coordinates&&a.coordinates.length>0}),e=ED(e),e.features.length===0?{dataArray:[],featureKeys:n}:(_q(e,(i,a)=>{let o=mMt(i,t==null?void 0:t.featureId);o===null&&(o=a);const s=o,l=mq(i),u=vMt(pMt({},i.properties),{coordinates:l,_id:s});r.push(u)}),{dataArray:r,featureKeys:n})):(e.features=[],{dataArray:[]})}function wD(e,t,r,n){for(var i=n,a=r-t>>1,o=r-t,s,l=e[t],u=e[t+1],c=e[r],f=e[r+1],d=t+3;d<r;d+=3){var v=_Mt(e[d],e[d+1],l,u,c,f);if(v>i)s=d,i=v;else if(v===i){var g=Math.abs(d-a);g<o&&(s=d,o=g)}}i>n&&(s-t>3&&wD(e,t,s,n),e[s+2]=i,r-s>3&&wD(e,s,r,n))}function _Mt(e,t,r,n,i,a){var o=i-r,s=a-n;if(o!==0||s!==0){var l=((e-r)*o+(t-n)*s)/(o*o+s*s);l>1?(r=i,n=a):l>0&&(r+=o*l,n+=s*l)}return o=e-r,s=t-n,o*o+s*s}function bC(e,t,r,n){var i={id:typeof e>"u"?null:e,type:t,geometry:r,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return xMt(i),i}function xMt(e){var t=e.geometry,r=e.type;if(r==="Point"||r==="MultiPoint"||r==="LineString")bO(e,t);else if(r==="Polygon"||r==="MultiLineString")for(var n=0;n<t.length;n++)bO(e,t[n]);else if(r==="MultiPolygon")for(n=0;n<t.length;n++)for(var i=0;i<t[n].length;i++)bO(e,t[n][i])}function bO(e,t){for(var r=0;r<t.length;r+=3)e.minX=Math.min(e.minX,t[r]),e.minY=Math.min(e.minY,t[r+1]),e.maxX=Math.max(e.maxX,t[r]),e.maxY=Math.max(e.maxY,t[r+1])}function bMt(e,t){var r=[];if(e.type==="FeatureCollection")for(var n=0;n<e.features.length;n++)eM(r,e.features[n],t,n);else e.type==="Feature"?eM(r,e,t):eM(r,{geometry:e},t);return r}function eM(e,t,r,n){if(t.geometry){var i=t.geometry.coordinates,a=t.geometry.type,o=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),s=[],l=t.id;if(r.promoteId?l=t.properties[r.promoteId]:r.generateId&&(l=n||0),a==="Point")oU(i,s);else if(a==="MultiPoint")for(var u=0;u<i.length;u++)oU(i[u],s);else if(a==="LineString")CD(i,s,o,!1);else if(a==="MultiLineString")if(r.lineMetrics){for(u=0;u<i.length;u++)s=[],CD(i[u],s,o,!1),e.push(bC(l,"LineString",s,t.properties));return}else EO(i,s,o,!1);else if(a==="Polygon")EO(i,s,o,!0);else if(a==="MultiPolygon")for(u=0;u<i.length;u++){var c=[];EO(i[u],c,o,!0),s.push(c)}else if(a==="GeometryCollection"){for(u=0;u<t.geometry.geometries.length;u++)eM(e,{id:l,geometry:t.geometry.geometries[u],properties:t.properties},r,n);return}else throw new Error("Input data is not a valid GeoJSON object.");e.push(bC(l,a,s,t.properties))}}function oU(e,t){t.push(rQ(e[0])),t.push(nQ(e[1])),t.push(0)}function CD(e,t,r,n){for(var i,a,o=0,s=0;s<e.length;s++){var l=rQ(e[s][0]),u=nQ(e[s][1]);t.push(l),t.push(u),t.push(0),s>0&&(n?o+=(i*u-l*a)/2:o+=Math.sqrt(Math.pow(l-i,2)+Math.pow(u-a,2))),i=l,a=u}var c=t.length-3;t[2]=1,wD(t,0,c,r),t[c+2]=1,t.size=Math.abs(o),t.start=0,t.end=t.size}function EO(e,t,r,n){for(var i=0;i<e.length;i++){var a=[];CD(e[i],a,r,n),t.push(a)}}function rQ(e){return e/360+.5}function nQ(e){var t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function Jv(e,t,r,n,i,a,o,s){if(r/=t,n/=t,a>=r&&o<n)return e;if(o<r||a>=n)return null;for(var l=[],u=0;u<e.length;u++){var c=e[u],f=c.geometry,d=c.type,v=i===0?c.minX:c.minY,g=i===0?c.maxX:c.maxY;if(v>=r&&g<n){l.push(c);continue}else if(g<r||v>=n)continue;var x=[];if(d==="Point"||d==="MultiPoint")EMt(f,x,r,n,i);else if(d==="LineString")iQ(f,x,r,n,i,!1,s.lineMetrics);else if(d==="MultiLineString")wO(f,x,r,n,i,!1);else if(d==="Polygon")wO(f,x,r,n,i,!0);else if(d==="MultiPolygon")for(var w=0;w<f.length;w++){var S=[];wO(f[w],S,r,n,i,!0),S.length&&x.push(S)}if(x.length){if(s.lineMetrics&&d==="LineString"){for(w=0;w<x.length;w++)l.push(bC(c.id,d,x[w],c.tags));continue}(d==="LineString"||d==="MultiLineString")&&(x.length===1?(d="LineString",x=x[0]):d="MultiLineString"),(d==="Point"||d==="MultiPoint")&&(d=x.length===3?"Point":"MultiPoint"),l.push(bC(c.id,d,x,c.tags))}}return l.length?l:null}function EMt(e,t,r,n,i){for(var a=0;a<e.length;a+=3){var o=e[a+i];o>=r&&o<=n&&(t.push(e[a]),t.push(e[a+1]),t.push(e[a+2]))}}function iQ(e,t,r,n,i,a,o){for(var s=sU(e),l=i===0?wMt:CMt,u=e.start,c,f,d=0;d<e.length-3;d+=3){var v=e[d],g=e[d+1],x=e[d+2],w=e[d+3],S=e[d+4],M=i===0?v:g,R=i===0?w:S,I=!1;o&&(c=Math.sqrt(Math.pow(v-w,2)+Math.pow(g-S,2))),M<r?R>r&&(f=l(s,v,g,w,S,r),o&&(s.start=u+c*f)):M>n?R<n&&(f=l(s,v,g,w,S,n),o&&(s.start=u+c*f)):CO(s,v,g,x),R<r&&M>=r&&(f=l(s,v,g,w,S,r),I=!0),R>n&&M<=n&&(f=l(s,v,g,w,S,n),I=!0),!a&&I&&(o&&(s.end=u+c*f),t.push(s),s=sU(e)),o&&(u+=c)}var P=e.length-3;v=e[P],g=e[P+1],x=e[P+2],M=i===0?v:g,M>=r&&M<=n&&CO(s,v,g,x),P=s.length-3,a&&P>=3&&(s[P]!==s[0]||s[P+1]!==s[1])&&CO(s,s[0],s[1],s[2]),s.length&&t.push(s)}function sU(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function wO(e,t,r,n,i,a){for(var o=0;o<e.length;o++)iQ(e[o],t,r,n,i,a,!1)}function CO(e,t,r,n){e.push(t),e.push(r),e.push(n)}function wMt(e,t,r,n,i,a){var o=(a-t)/(n-t);return e.push(a),e.push(r+(i-r)*o),e.push(1),o}function CMt(e,t,r,n,i,a){var o=(a-r)/(i-r);return e.push(t+(n-t)*o),e.push(a),e.push(1),o}function SMt(e,t){var r=t.buffer/t.extent,n=e,i=Jv(e,1,-1-r,r,0,-1,2,t),a=Jv(e,1,1-r,2+r,0,-1,2,t);return(i||a)&&(n=Jv(e,1,-r,1+r,0,-1,2,t)||[],i&&(n=lU(i,1).concat(n)),a&&(n=n.concat(lU(a,-1)))),n}function lU(e,t){for(var r=[],n=0;n<e.length;n++){var i=e[n],a=i.type,o;if(a==="Point"||a==="MultiPoint"||a==="LineString")o=SO(i.geometry,t);else if(a==="MultiLineString"||a==="Polygon"){o=[];for(var s=0;s<i.geometry.length;s++)o.push(SO(i.geometry[s],t))}else if(a==="MultiPolygon")for(o=[],s=0;s<i.geometry.length;s++){for(var l=[],u=0;u<i.geometry[s].length;u++)l.push(SO(i.geometry[s][u],t));o.push(l)}r.push(bC(i.id,a,o,i.tags))}return r}function SO(e,t){var r=[];r.size=e.size,e.start!==void 0&&(r.start=e.start,r.end=e.end);for(var n=0;n<e.length;n+=3)r.push(e[n]+t,e[n+1],e[n+2]);return r}function uU(e,t){if(e.transformed)return e;var r=1<<e.z,n=e.x,i=e.y,a,o,s;for(a=0;a<e.features.length;a++){var l=e.features[a],u=l.geometry,c=l.type;if(l.geometry=[],c===1)for(o=0;o<u.length;o+=2)l.geometry.push(cU(u[o],u[o+1],t,r,n,i));else for(o=0;o<u.length;o++){var f=[];for(s=0;s<u[o].length;s+=2)f.push(cU(u[o][s],u[o][s+1],t,r,n,i));l.geometry.push(f)}}return e.transformed=!0,e}function cU(e,t,r,n,i,a){return[Math.round(r*(e*n-i)),Math.round(r*(t*n-a))]}function TMt(e,t,r,n,i){for(var a=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){o.numFeatures++,AMt(o,e[s],a,i);var l=e[s].minX,u=e[s].minY,c=e[s].maxX,f=e[s].maxY;l<o.minX&&(o.minX=l),u<o.minY&&(o.minY=u),c>o.maxX&&(o.maxX=c),f>o.maxY&&(o.maxY=f)}return o}function AMt(e,t,r,n){var i=t.geometry,a=t.type,o=[];if(a==="Point"||a==="MultiPoint")for(var s=0;s<i.length;s+=3)o.push(i[s]),o.push(i[s+1]),e.numPoints++,e.numSimplified++;else if(a==="LineString")TO(o,i,e,r,!1,!1);else if(a==="MultiLineString"||a==="Polygon")for(s=0;s<i.length;s++)TO(o,i[s],e,r,a==="Polygon",s===0);else if(a==="MultiPolygon")for(var l=0;l<i.length;l++){var u=i[l];for(s=0;s<u.length;s++)TO(o,u[s],e,r,!0,s===0)}if(o.length){var c=t.tags||null;if(a==="LineString"&&n.lineMetrics){c={};for(var f in t.tags)c[f]=t.tags[f];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var d={geometry:o,type:a==="Polygon"||a==="MultiPolygon"?3:a==="LineString"||a==="MultiLineString"?2:1,tags:c};t.id!==null&&(d.id=t.id),e.features.push(d)}}function TO(e,t,r,n,i,a){var o=n*n;if(n>0&&t.size<(i?o:n)){r.numPoints+=t.length/3;return}for(var s=[],l=0;l<t.length;l+=3)(n===0||t[l+2]>o)&&(r.numSimplified++,s.push(t[l]),s.push(t[l+1])),r.numPoints++;i&&MMt(s,a),e.push(s)}function MMt(e,t){for(var r=0,n=0,i=e.length,a=i-2;n<i;a=n,n+=2)r+=(e[n]-e[a])*(e[n+1]+e[a+1]);if(r>0===t)for(n=0,i=e.length;n<i/2;n+=2){var o=e[n],s=e[n+1];e[n]=e[i-2-n],e[n+1]=e[i-1-n],e[i-2-n]=o,e[i-1-n]=s}}function RMt(e,t){return new $I(e,t)}function $I(e,t){t=this.options=IMt(Object.create(this.options),t);var r=t.debug;if(r&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=bMt(e,t);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=SMt(n,t),n.length&&this.splitTile(n,0,0,0),r&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}$I.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};$I.prototype.splitTile=function(e,t,r,n,i,a,o){for(var s=[e,t,r,n],l=this.options,u=l.debug;s.length;){n=s.pop(),r=s.pop(),t=s.pop(),e=s.pop();var c=1<<t,f=SD(t,r,n),d=this.tiles[f];if(!d&&(u>1&&console.time("creation"),d=this.tiles[f]=TMt(e,t,r,n,l),this.tileCoords.push({z:t,x:r,y:n}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,r,n,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var v="z"+t;this.stats[v]=(this.stats[v]||0)+1,this.total++}if(d.source=e,i){if(t===l.maxZoom||t===i)continue;var g=1<<i-t;if(r!==Math.floor(a/g)||n!==Math.floor(o/g))continue}else if(t===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue;if(d.source=null,e.length!==0){u>1&&console.time("clipping");var x=.5*l.buffer/l.extent,w=.5-x,S=.5+x,M=1+x,R,I,P,k,z,G;R=I=P=k=null,z=Jv(e,c,r-x,r+S,0,d.minX,d.maxX,l),G=Jv(e,c,r+w,r+M,0,d.minX,d.maxX,l),e=null,z&&(R=Jv(z,c,n-x,n+S,1,d.minY,d.maxY,l),I=Jv(z,c,n+w,n+M,1,d.minY,d.maxY,l),z=null),G&&(P=Jv(G,c,n-x,n+S,1,d.minY,d.maxY,l),k=Jv(G,c,n+w,n+M,1,d.minY,d.maxY,l),G=null),u>1&&console.timeEnd("clipping"),s.push(R||[],t+1,r*2,n*2),s.push(I||[],t+1,r*2,n*2+1),s.push(P||[],t+1,r*2+1,n*2),s.push(k||[],t+1,r*2+1,n*2+1)}}};$I.prototype.getTile=function(e,t,r){var n=this.options,i=n.extent,a=n.debug;if(e<0||e>24)return null;var o=1<<e;t=(t%o+o)%o;var s=SD(e,t,r);if(this.tiles[s])return uU(this.tiles[s],i);a>1&&console.log("drilling down to z%d-%d-%d",e,t,r);for(var l=e,u=t,c=r,f;!f&&l>0;)l--,u=Math.floor(u/2),c=Math.floor(c/2),f=this.tiles[SD(l,u,c)];return!f||!f.source?null:(a>1&&console.log("found parent tile z%d-%d-%d",l,u,c),a>1&&console.time("drilling down"),this.splitTile(f.source,l,u,c,e,t,r),a>1&&console.timeEnd("drilling down"),this.tiles[s]?uU(this.tiles[s],i):null)};function SD(e,t,r){return((1<<e)*r+t)*32+e}function IMt(e,t){for(var r in t)e[r]=t[r];return e}var Ew=class{constructor(t,r,n,i){this.vectorLayerCache={},this.x=r,this.y=n,this.z=i,this.vectorTile=t}getTileData(t){return!t||!this.vectorTile.layers[t]?[]:this.vectorLayerCache[t]?this.vectorLayerCache[t]:this.vectorTile.layers[t].features}getFeatureById(){throw new Error("Method not implemented.")}},LMt=Object.defineProperty,OMt=Object.defineProperties,PMt=Object.getOwnPropertyDescriptors,hU=Object.getOwnPropertySymbols,DMt=Object.prototype.hasOwnProperty,FMt=Object.prototype.propertyIsEnumerable,fU=(e,t,r)=>t in e?LMt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,GM=(e,t)=>{for(var r in t||(t={}))DMt.call(t,r)&&fU(e,r,t[r]);if(hU)for(var r of hU(t))FMt.call(t,r)&&fU(e,r,t[r]);return e},BMt=(e,t)=>OMt(e,PMt(t)),NMt=(e,t,r)=>new Promise((n,i)=>{var a=l=>{try{s(r.next(l))}catch(u){i(u)}},o=l=>{try{s(r.throw(l))}catch(u){i(u)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(a,o);s((r=r.apply(e,t)).next())}),kMt={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function zMt(e){let t=0;for(let r=0,n=e.length,i=n-1,a,o;r<n;i=r++)a=e[r],o=e[i],t+=(o.x-a.x)*(a.y+o.y);return t}function UMt(e){const t=e.length;if(t<=1)return[e];const r=[];let n,i;for(let a=0;a<t;a++){const o=zMt(e[a]);o!==0&&(i===void 0&&(i=o<0),i===o<0?(n&&r.push(n),n=[e[a]]):n.push(e[a]))}return n&&r.push(n),r}var $Mt=["Unknown","Point","LineString","Polygon"];function HMt(e,t,r,n,i){let a=i.geometry;const o=i.type,s=i.tags,l=i.id,u=e*Math.pow(2,n),c=e*t,f=e*r;let d=$Mt[o],v,g;function x(S){for(let M=0;M<S.length;M++){const R=S[M];if(R[3])break;const I=180-(R[1]+f)*360/u,P=(R[0]+c)*360/u-180,k=360/Math.PI*Math.atan(Math.exp(I*Math.PI/180))-90;S[M]=[P,k,0,1]}}switch(o){case 1:const S=[];for(v=0;v<a.length;v++)S[v]=a[v][0];a=S,x(a);break;case 2:for(v=0;v<a.length;v++)x(a[v]);break;case 3:for(a=UMt(a),v=0;v<a.length;v++)for(g=0;g<a[v].length;g++)x(a[v][g]);break}return a.length===1?a=a[0]:d="Multi"+d,{type:"Feature",geometry:{type:d,coordinates:a},properties:s,id:l,relativeOrigin:[0,0],coord:""}}var VMt=(e,t,r,n)=>NMt(void 0,null,function*(){return new Promise(i=>{const a=t.getTile(e.z,e.x,e.y),s={layers:{defaultLayer:{features:a?a.features.map(u=>HMt(n,r.x,r.y,r.z,u)):[]}}},l=new Ew(s,e.x,e.y,e.z);i(l)})});function GMt(e){const t={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||typeof e.geojsonvtOptions>"u"?t:GM(GM({},t),e.geojsonvtOptions)}function WMt(e,t){const r=GMt(t),n=r.extent||4096,i=RMt(e,r),a=(s,l)=>VMt(l,i,s,n),o=BMt(GM(GM({},kMt),t),{getTileData:a});return{data:e,dataArray:[],tilesetOptions:o,isTile:!0}}var XMt=Object.defineProperty,jMt=Object.defineProperties,YMt=Object.getOwnPropertyDescriptors,dU=Object.getOwnPropertySymbols,ZMt=Object.prototype.hasOwnProperty,qMt=Object.prototype.propertyIsEnumerable,pU=(e,t,r)=>t in e?XMt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,vU=(e,t)=>{for(var r in t||(t={}))ZMt.call(t,r)&&pU(e,r,t[r]);if(dU)for(var r of dU(t))qMt.call(t,r)&&pU(e,r,t[r]);return e},gU=(e,t)=>jMt(e,YMt(t));function aQ(e,t){const{extent:r=[121.168,30.2828,121.384,30.4219],coordinates:n,requestParameters:i={}}=t,a=new Promise(l=>{e instanceof HTMLImageElement||fAt(e)?l([e]):KMt(e,i,u=>{l(u)})}),o=Db(n,r);return{originData:e,images:a,_id:1,dataArray:[{_id:0,coordinates:o}]}}function KMt(e,t,r){const n=[];if(typeof e=="string")fD(gU(vU({},t),{url:e}),(i,a)=>{a&&(n.push(a),r(n))});else{const i=e.length;let a=0;e.forEach(o=>{fD(gU(vU({},t),{url:o}),(s,l)=>{a++,l&&n.push(l),a===i&&r(n)})})}return aQ}var QMt=Object.defineProperty,JMt=Object.defineProperties,tRt=Object.getOwnPropertyDescriptors,mU=Object.getOwnPropertySymbols,eRt=Object.prototype.hasOwnProperty,rRt=Object.prototype.propertyIsEnumerable,yU=(e,t,r)=>t in e?QMt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,oQ=(e,t)=>{for(var r in t||(t={}))eRt.call(t,r)&&yU(e,r,t[r]);if(mU)for(var r of mU(t))rRt.call(t,r)&&yU(e,r,t[r]);return e},sQ=(e,t)=>JMt(e,tRt(t)),nRt=(e,t,r)=>new Promise((n,i)=>{var a=l=>{try{s(r.next(l))}catch(u){i(u)}},o=l=>{try{s(r.throw(l))}catch(u){i(u)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(a,o);s((r=r.apply(e,t)).next())}),iRt=(e,t,r,n)=>nRt(void 0,null,function*(){const i={x:t.x,y:t.y,z:t.z},a=yx(e,i);return new Promise(o=>{n?n(i,(s,l)=>{if(s||!l){const u={layers:{defaultLayer:{features:[]}}},c=new Ew(u,t.x,t.y,t.z);o(c)}else{const u={layers:{defaultLayer:{features:l.features}}},c=new Ew(u,t.x,t.y,t.z);o(c)}}):Cdt(sQ(oQ({},r),{url:a}),(s,l)=>{if(s||!l){const u={layers:{defaultLayer:{features:[]}}},c=new Ew(u,t.x,t.y,t.z);o(c)}else{const c={layers:{defaultLayer:{features:JSON.parse(l)}}},f=new Ew(c,t.x,t.y,t.z);o(f)}})})});function aRt(e,t){const r=(i,a)=>iRt(e,a,t==null?void 0:t.requestParameters,t.getCustomData),n=sQ(oQ({},t),{getTileData:r});return{dataArray:[],tilesetOptions:n,isTile:!0}}var lQ=_x;function _x(e,t){this.x=e,this.y=t}_x.prototype={clone:function(){return new _x(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,r=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=r,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),n=t*this.x-r*this.y,i=r*this.x+t*this.y;return this.x=n,this.y=i,this},_rotateAround:function(e,t){var r=Math.cos(e),n=Math.sin(e),i=t.x+r*(this.x-t.x)-n*(this.y-t.y),a=t.y+n*(this.x-t.x)+r*(this.y-t.y);return this.x=i,this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}};_x.convert=function(e){return e instanceof _x?e:Array.isArray(e)?new _x(e[0],e[1]):e};const ca=sa(lQ);var oRt=lQ,sRt=Vx;function Vx(e,t,r,n,i){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=i,e.readFields(lRt,this,t)}function lRt(e,t,r){e==1?t.id=r.readVarint():e==2?uRt(r,t):e==3?t.type=r.readVarint():e==4&&(t._geometry=r.pos)}function uRt(e,t){for(var r=e.readVarint()+e.pos;e.pos<r;){var n=t._keys[e.readVarint()],i=t._values[e.readVarint()];t.properties[n]=i}}Vx.types=["Unknown","Point","LineString","Polygon"];Vx.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,n=0,i=0,a=0,o=[],s;e.pos<t;){if(n<=0){var l=e.readVarint();r=l&7,n=l>>3}if(n--,r===1||r===2)i+=e.readSVarint(),a+=e.readSVarint(),r===1&&(s&&o.push(s),s=[]),s.push(new oRt(i,a));else if(r===7)s&&s.push(s[0].clone());else throw new Error("unknown command "+r)}return s&&o.push(s),o};Vx.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,n=0,i=0,a=0,o=1/0,s=-1/0,l=1/0,u=-1/0;e.pos<t;){if(n<=0){var c=e.readVarint();r=c&7,n=c>>3}if(n--,r===1||r===2)i+=e.readSVarint(),a+=e.readSVarint(),i<o&&(o=i),i>s&&(s=i),a<l&&(l=a),a>u&&(u=a);else if(r!==7)throw new Error("unknown command "+r)}return[o,l,s,u]};Vx.prototype.toGeoJSON=function(e,t,r){var n=this.extent*Math.pow(2,r),i=this.extent*e,a=this.extent*t,o=this.loadGeometry(),s=Vx.types[this.type],l,u;function c(v){for(var g=0;g<v.length;g++){var x=v[g],w=180-(x.y+a)*360/n;v[g]=[(x.x+i)*360/n-180,360/Math.PI*Math.atan(Math.exp(w*Math.PI/180))-90]}}switch(this.type){case 1:var f=[];for(l=0;l<o.length;l++)f[l]=o[l][0];o=f,c(o);break;case 2:for(l=0;l<o.length;l++)c(o[l]);break;case 3:for(o=cRt(o),l=0;l<o.length;l++)for(u=0;u<o[l].length;u++)c(o[l][u]);break}o.length===1?o=o[0]:s="Multi"+s;var d={type:"Feature",geometry:{type:s,coordinates:o},properties:this.properties};return"id"in this&&(d.id=this.id),d};function cRt(e){var t=e.length;if(t<=1)return[e];for(var r=[],n,i,a=0;a<t;a++){var o=hRt(e[a]);o!==0&&(i===void 0&&(i=o<0),i===o<0?(n&&r.push(n),n=[e[a]]):n.push(e[a]))}return n&&r.push(n),r}function hRt(e){for(var t=0,r=0,n=e.length,i=n-1,a,o;r<n;i=r++)a=e[r],o=e[i],t+=(o.x-a.x)*(a.y+o.y);return t}var fRt=sRt,dRt=uQ;function uQ(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(pRt,this,t),this.length=this._features.length}function pRt(e,t,r){e===15?t.version=r.readVarint():e===1?t.name=r.readString():e===5?t.extent=r.readVarint():e===2?t._features.push(r.pos):e===3?t._keys.push(r.readString()):e===4&&t._values.push(vRt(r))}function vRt(e){for(var t=null,r=e.readVarint()+e.pos;e.pos<r;){var n=e.readVarint()>>3;t=n===1?e.readString():n===2?e.readFloat():n===3?e.readDouble():n===4?e.readVarint64():n===5?e.readVarint():n===6?e.readSVarint():n===7?e.readBoolean():null}return t}uQ.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new fRt(this._pbf,t,this.extent,this._keys,this._values)};var gRt=dRt,mRt=yRt;function yRt(e,t){this.layers=e.readFields(_Rt,{},t)}function _Rt(e,t,r){if(e===3){var n=new gRt(r,r.readVarint()+r.pos);n.length&&(t[n.name]=n)}}var xRt=mRt,u4={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */u4.read=function(e,t,r,n,i){var a,o,s=i*8-n-1,l=(1<<s)-1,u=l>>1,c=-7,f=r?i-1:0,d=r?-1:1,v=e[t+f];for(f+=d,a=v&(1<<-c)-1,v>>=-c,c+=s;c>0;a=a*256+e[t+f],f+=d,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=n;c>0;o=o*256+e[t+f],f+=d,c-=8);if(a===0)a=1-u;else{if(a===l)return o?NaN:(v?-1:1)*(1/0);o=o+Math.pow(2,n),a=a-u}return(v?-1:1)*o*Math.pow(2,a-n)};u4.write=function(e,t,r,n,i,a){var o,s,l,u=a*8-i-1,c=(1<<u)-1,f=c>>1,d=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,v=n?0:a-1,g=n?1:-1,x=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+f>=1?t+=d/l:t+=d*Math.pow(2,1-f),t*l>=2&&(o++,l/=2),o+f>=c?(s=0,o=c):o+f>=1?(s=(t*l-1)*Math.pow(2,i),o=o+f):(s=t*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;e[r+v]=s&255,v+=g,s/=256,i-=8);for(o=o<<i|s,u+=i;u>0;e[r+v]=o&255,v+=g,o/=256,u-=8);e[r+v-g]|=x*128};var bRt=Ba,ST=u4;function Ba(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Ba.Varint=0;Ba.Fixed64=1;Ba.Bytes=2;Ba.Fixed32=5;var TD=65536*65536,_U=1/TD,ERt=12,cQ=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");Ba.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,a=this.pos;this.type=n&7,e(i,t,this),this.pos===a&&this.skip(n)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=TT(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=bU(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=TT(this.buf,this.pos)+TT(this.buf,this.pos+4)*TD;return this.pos+=8,e},readSFixed64:function(){var e=TT(this.buf,this.pos)+bU(this.buf,this.pos+4)*TD;return this.pos+=8,e},readFloat:function(){var e=ST.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=ST.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t=this.buf,r,n;return n=t[this.pos++],r=n&127,n<128||(n=t[this.pos++],r|=(n&127)<<7,n<128)||(n=t[this.pos++],r|=(n&127)<<14,n<128)||(n=t[this.pos++],r|=(n&127)<<21,n<128)?r:(n=t[this.pos],r|=(n&15)<<28,wRt(r,e,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2===1?(e+1)/-2:e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=ERt&&cQ?NRt(this.buf,t,e):BRt(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Ba.Bytes)return e.push(this.readVarint(t));var r=Xv(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Ba.Bytes)return e.push(this.readSVarint());var t=Xv(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Ba.Bytes)return e.push(this.readBoolean());var t=Xv(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Ba.Bytes)return e.push(this.readFloat());var t=Xv(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Ba.Bytes)return e.push(this.readDouble());var t=Xv(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Ba.Bytes)return e.push(this.readFixed32());var t=Xv(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Ba.Bytes)return e.push(this.readSFixed32());var t=Xv(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Ba.Bytes)return e.push(this.readFixed64());var t=Xv(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Ba.Bytes)return e.push(this.readSFixed64());var t=Xv(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=e&7;if(t===Ba.Varint)for(;this.buf[this.pos++]>127;);else if(t===Ba.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Ba.Fixed32)this.pos+=4;else if(t===Ba.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+t)},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),O1(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),O1(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),O1(this.buf,e&-1,this.pos),O1(this.buf,Math.floor(e*_U),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),O1(this.buf,e&-1,this.pos),O1(this.buf,Math.floor(e*_U),this.pos+4),this.pos+=8},writeVarint:function(e){if(e=+e||0,e>268435455||e<0){CRt(e,this);return}this.realloc(4),this.buf[this.pos++]=e&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=e>>>7&127)))},writeSVarint:function(e){this.writeVarint(e<0?-e*2-1:e*2)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e),this.realloc(e.length*4),this.pos++;var t=this.pos;this.pos=kRt(this.buf,e,this.pos);var r=this.pos-t;r>=128&&xU(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),ST.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),ST.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var n=this.pos-r;n>=128&&xU(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(e,t,r){this.writeTag(e,Ba.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,ARt,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,MRt,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,LRt,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,RRt,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,IRt,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,ORt,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,PRt,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,DRt,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,FRt,t)},writeBytesField:function(e,t){this.writeTag(e,Ba.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Ba.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Ba.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Ba.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Ba.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Ba.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Ba.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Ba.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Ba.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Ba.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,!!t)}};function wRt(e,t,r){var n=r.buf,i,a;if(a=n[r.pos++],i=(a&112)>>4,a<128||(a=n[r.pos++],i|=(a&127)<<3,a<128)||(a=n[r.pos++],i|=(a&127)<<10,a<128)||(a=n[r.pos++],i|=(a&127)<<17,a<128)||(a=n[r.pos++],i|=(a&127)<<24,a<128)||(a=n[r.pos++],i|=(a&1)<<31,a<128))return L1(e,i,t);throw new Error("Expected varint not more than 10 bytes")}function Xv(e){return e.type===Ba.Bytes?e.readVarint()+e.pos:e.pos+1}function L1(e,t,r){return r?t*4294967296+(e>>>0):(t>>>0)*4294967296+(e>>>0)}function CRt(e,t){var r,n;if(e>=0?(r=e%4294967296|0,n=e/4294967296|0):(r=~(-e%4294967296),n=~(-e/4294967296),r^4294967295?r=r+1|0:(r=0,n=n+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),SRt(r,n,t),TRt(n,t)}function SRt(e,t,r){r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos]=e&127}function TRt(e,t){var r=(e&7)<<4;t.buf[t.pos++]|=r|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127)))))}function xU(e,t,r){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(Math.LN2*7));r.realloc(n);for(var i=r.pos-1;i>=e;i--)r.buf[i+n]=r.buf[i]}function ARt(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function MRt(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function RRt(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function IRt(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function LRt(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function ORt(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function PRt(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function DRt(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function FRt(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function TT(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+e[t+3]*16777216}function O1(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function bU(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function BRt(e,t,r){for(var n="",i=t;i<r;){var a=e[i],o=null,s=a>239?4:a>223?3:a>191?2:1;if(i+s>r)break;var l,u,c;s===1?a<128&&(o=a):s===2?(l=e[i+1],(l&192)===128&&(o=(a&31)<<6|l&63,o<=127&&(o=null))):s===3?(l=e[i+1],u=e[i+2],(l&192)===128&&(u&192)===128&&(o=(a&15)<<12|(l&63)<<6|u&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):s===4&&(l=e[i+1],u=e[i+2],c=e[i+3],(l&192)===128&&(u&192)===128&&(c&192)===128&&(o=(a&15)<<18|(l&63)<<12|(u&63)<<6|c&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,s=1):o>65535&&(o-=65536,n+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),n+=String.fromCharCode(o),i+=s}return n}function NRt(e,t,r){return cQ.decode(e.subarray(t,r))}function kRt(e,t,r){for(var n=0,i,a;n<t.length;n++){if(i=t.charCodeAt(n),i>55295&&i<57344)if(a)if(i<56320){e[r++]=239,e[r++]=191,e[r++]=189,a=i;continue}else i=a-55296<<10|i-56320|65536,a=null;else{i>56319||n+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):a=i;continue}else a&&(e[r++]=239,e[r++]=191,e[r++]=189,a=null);i<128?e[r++]=i:(i<2048?e[r++]=i>>6|192:(i<65536?e[r++]=i>>12|224:(e[r++]=i>>18|240,e[r++]=i>>12&63|128),e[r++]=i>>6&63|128),e[r++]=i&63|128)}return r}const zRt=sa(bRt);var URt=Object.defineProperty,$Rt=Object.defineProperties,HRt=Object.getOwnPropertyDescriptors,EU=Object.getOwnPropertySymbols,VRt=Object.prototype.hasOwnProperty,GRt=Object.prototype.propertyIsEnumerable,wU=(e,t,r)=>t in e?URt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,CU=(e,t)=>{for(var r in t||(t={}))VRt.call(t,r)&&wU(e,r,t[r]);if(EU)for(var r of EU(t))GRt.call(t,r)&&wU(e,r,t[r]);return e},WRt=(e,t)=>$Rt(e,HRt(t)),SU=class{constructor(e,t,r,n){this.vectorLayerCache={},this.x=t,this.y=r,this.z=n,this.vectorTile=new xRt(new zRt(e))}getTileData(e){if(!e||!this.vectorTile.layers[e])return[];if(this.vectorLayerCache[e])return this.vectorLayerCache[e];const t=this.vectorTile.layers[e];if(Array.isArray(t.features))return this.vectorLayerCache[e]=t.features,t.features;const r=[];for(let n=0;n<t.length;n++){const a=t.feature(n).toGeoJSON(this.x,this.y,this.z);r.push(WRt(CU({},a),{properties:CU({id:a.id},a.properties)}))}return this.vectorLayerCache[e]=r,r}getFeatureById(){throw new Error("Method not implemented.")}},XRt=Object.defineProperty,jRt=Object.defineProperties,YRt=Object.getOwnPropertyDescriptors,TU=Object.getOwnPropertySymbols,ZRt=Object.prototype.hasOwnProperty,qRt=Object.prototype.propertyIsEnumerable,AU=(e,t,r)=>t in e?XRt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,AD=(e,t)=>{for(var r in t||(t={}))ZRt.call(t,r)&&AU(e,r,t[r]);if(TU)for(var r of TU(t))qRt.call(t,r)&&AU(e,r,t[r]);return e},hQ=(e,t)=>jRt(e,YRt(t)),KRt=(e,t,r)=>new Promise((n,i)=>{var a=l=>{try{s(r.next(l))}catch(u){i(u)}},o=l=>{try{s(r.throw(l))}catch(u){i(u)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(a,o);s((r=r.apply(e,t)).next())}),QRt={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},JRt=(e,t,r,n,i)=>KRt(void 0,null,function*(){const a=yx(e,t);return new Promise(o=>{if(i)i({x:r.x,y:r.y,z:r.z},(s,l)=>{if(s||!l)o(void 0);else{const u=new SU(l,r.x,r.y,r.z);o(u)}});else{const s=$5(hQ(AD({},n),{url:a}),(l,u)=>{if(l||!u)o(void 0);else{const c=new SU(u,r.x,r.y,r.z);o(c)}});r.xhrCancel=()=>s.cancel()}})});function tIt(e,t){const r=Array.isArray(e)?e[0]:e,n=(a,o)=>JRt(r,a,o,t==null?void 0:t.requestParameters,t==null?void 0:t.getCustomData),i=hQ(AD(AD({},QRt),t),{getTileData:n});return{data:r,dataArray:[],tilesetOptions:i,isTile:!0}}function eIt(e,t,r){switch(e){case"+":return t+r;case"-":return t-r;case"*":return t*r;case"/":return t/r;case"%":return t%r;case"^":return Math.pow(t,r);case"abs":return Math.abs(t);case"floor":return Math.floor(t);case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"sin":return Math.sin(t);case"cos":return Math.cos(t);case"atan":return r===-1?Math.atan(t):Math.atan2(t,r);case"min":return Math.min(t,r);case"max":return Math.max(t,r);case"log10":return Math.log(t);case"log2":return Math.log2(t);default:return console.warn("Calculate symbol err! Return default 0"),0}}function Yw(e,t){const{width:r,height:n}=t[0],i=t.map(l=>l.rasterData),a=r*n,o=[],s=JSON.stringify(e);for(let l=0;l<a;l++){const u=JSON.parse(s),c=fQ(u,i,l);if(typeof c=="number")o.push(c);else{const f=MD(u);o.push(f)}}return o}function fQ(e,t,r){if(e.length===2&&e[0]==="band"&&typeof e[1]=="number")try{return t[e[1]][r]}catch{return console.warn("Raster Data err!"),0}e.map((n,i)=>{if(Array.isArray(n)&&n.length>0)switch(n[0]){case"band":try{e[i]=t[n[1]][r]}catch{console.warn("Raster Data err!"),e[i]=0}break;default:fQ(n,t,r)}})}function rIt(e){const[t,r=-1,n=-1]=e;return t===void 0?(console.warn("Express err!"),["+",0,0]):[t.replace(/\s+/g,""),r,n]}function MD(e){const t=rIt(e),r=t[0];let n=t[1],i=t[2];return Array.isArray(n)&&(n=MD(e[1])),Array.isArray(i)&&(i=MD(e[2])),eIt(r,n,i)}var nIt={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:iIt}};function iIt(e,t){const r=e[0].rasterData,n=e[1].rasterData,i=e[2].rasterData,a=[],[o,s]=(t==null?void 0:t.countCut)||[2,98],l=(t==null?void 0:t.RMinMax)||xx(r,o,s),u=(t==null?void 0:t.GMinMax)||xx(n,o,s),c=(t==null?void 0:t.BMinMax)||xx(i,o,s);for(let f=0;f<r.length;f++)a.push(Math.max(0,r[f]-l[0])),a.push(Math.max(0,n[f]-u[0])),a.push(Math.max(0,i[f]-c[0]));return{rasterData:a,rMinMax:l,gMinMax:u,bMinMax:c}}function xx(e,t,r){const n=e.slice().sort((s,l)=>s-l),i=n.length,a=n[Math.ceil(i*t/100)],o=n[Math.ceil(i*r/100)];return[a,o]}var aIt=Object.defineProperty,oIt=Object.defineProperties,sIt=Object.getOwnPropertyDescriptors,MU=Object.getOwnPropertySymbols,lIt=Object.prototype.hasOwnProperty,uIt=Object.prototype.propertyIsEnumerable,RU=(e,t,r)=>t in e?aIt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,cIt=(e,t)=>{for(var r in t||(t={}))lIt.call(t,r)&&RU(e,r,t[r]);if(MU)for(var r of MU(t))uIt.call(t,r)&&RU(e,r,t[r]);return e},hIt=(e,t)=>oIt(e,sIt(t)),dQ=(e,t,r)=>new Promise((n,i)=>{var a=l=>{try{s(r.next(l))}catch(u){i(u)}},o=l=>{try{s(r.throw(l))}catch(u){i(u)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(a,o);s((r=r.apply(e,t)).next())});function c4(e,t,r){return dQ(this,null,function*(){if(e.length===0)return{rasterData:[0],width:1,heigh:1};const n=yield Promise.all(e.map(({data:l,bands:u=[0]})=>t(l,u))),i=[];n.forEach(l=>{Array.isArray(l)?i.push(...l):i.push(l)});const{width:a,height:o}=i[0];let s;switch(typeof r){case"function":s=r(i);break;case"object":Array.isArray(r)?s={rasterData:Yw(r,i)}:s=fIt(r,i);break;default:s={rasterData:i[0].rasterData}}return hIt(cIt({},s),{width:a,height:o})})}function fIt(e,t){const r=nIt[e.type];if(r.type==="function")return r.method(t,e==null?void 0:e.options);if(r.type==="operation")return e.type==="rgb"?dIt(r.expression,t):{rasterData:Yw(r.expression,t)}}function dIt(e,t){e.r===void 0&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),e.g===void 0&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),e.b===void 0&&console.warn("Channel B lost in Operation! Use band[0] to fill!");const r=Yw(e.r||["band",0],t),n=Yw(e.g||["band",0],t),i=Yw(e.b||["band",0],t);return[r,n,i]}function RD(e,t,r,n){return dQ(this,null,function*(){const i=yield c4(e,t,r);n(null,{data:i})})}function pIt(e,t){const{extent:r=[121.168,30.2828,121.384,30.4219],coordinates:n,width:i,height:a,min:o,max:s,format:l,operation:u}=t;let c,f,d;if(l===void 0||tQ(e))c=Array.from(e),f=i,d=a;else{const x=Array.isArray(e)?e:[e];c=c4(x,l,u)}const v=Db(n,r);return{_id:1,dataArray:[{_id:1,data:c,width:f,height:d,min:o,max:s,coordinates:v}]}}function IU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Ce(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?IU(Object(r),!0).forEach(function(n){U(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):IU(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}let FS=function(e){return e.Normal="normal",e.PostProcessing="post-processing",e}({}),K=function(e){return e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e}({});const vIt=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,{camelCase:gIt,isNil:mIt,upperFirst:yIt}=as;class Mg{constructor(){U(this,"shaderModuleService",void 0),U(this,"rendererService",void 0),U(this,"config",void 0),U(this,"quad",vIt),U(this,"enabled",!0),U(this,"renderToScreen",!1),U(this,"model",void 0),U(this,"name",void 0),U(this,"optionsToUpdate",{})}getName(){return this.name}setName(t){this.name=t}getType(){return FS.PostProcessing}init(t,r){this.config=r,this.rendererService=t.getContainer().rendererService,this.shaderModuleService=t.getContainer().shaderModuleService;const{createAttribute:n,createBuffer:i,createModel:a}=this.rendererService,{vs:o,fs:s,uniforms:l}=this.setupShaders();this.model=a({vs:o,fs:s,attributes:{a_Position:n({buffer:i({data:[-4,-4,4,-4,0,4],type:K.FLOAT}),size:2})},uniforms:Ce(Ce({u_Texture:null},l),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}render(t,r){const n=t.multiPassRenderer.getPostProcessor(),{useFramebuffer:i,getViewportSize:a,clear:o}=this.rendererService,{width:s,height:l}=a();i(this.renderToScreen?null:n.getWriteFBO(),()=>{o({framebuffer:n.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});const u=Ce({u_BloomFinal:0,u_Texture:n.getReadFBO(),u_ViewportSize:[s,l]},this.convertOptionsToUniforms(this.optionsToUpdate));r&&(u.u_BloomFinal=1,u.u_Texture2=r),this.model.draw({uniforms:u})})}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}setRenderToScreen(t){this.renderToScreen=t}updateOptions(t){this.optionsToUpdate=Ce(Ce({},this.optionsToUpdate),t)}setupShaders(){throw new Error("Method not implemented.")}convertOptionsToUniforms(t){const r={};return Object.keys(t).forEach(n=>{mIt(t[n])||(r[`u_${yIt(gIt(n))}`]=t[n])}),r}}function _It(e){let t=0;switch(e){case"vec2":case"ivec2":t=2;break;case"vec3":case"ivec3":t=3;break;case"vec4":case"ivec4":case"mat2":t=4;break;case"mat3":t=9;break;case"mat4":t=16;break}return t}const pQ=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function LU(e,t=!1){const r={};return e=e.replace(pQ,(n,i,a)=>{const o=a.split(":"),s=o[0].trim();let l="";switch(o.length>1&&(l=o[1].trim()),i){case"bool":l=l==="true";break;case"float":case"int":l=Number(l);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":l?l=l.replace("[","").replace("]","").split(",").reduce((u,c)=>(u.push(Number(c.trim())),u),[]):l=new Array(_It(i)).fill(0);break}return r[s]=l,`${t?"uniform ":""}${i} ${s};
`}),{content:e,uniforms:r}}function AO(e){let{content:t,uniforms:r}=LU(e,!0);return t=t.replace(/(\s*uniform\s*.*\s*){((?:\s*.*\s*)*?)};/g,(n,i,a)=>{a=a.trim().replace(/^.*$/gm,l=>`uniform ${l}`);const{content:o,uniforms:s}=LU(a);return Object.assign(r,s),`${i}{
${o}
};`}),{content:t,uniforms:r}}function OU(e){const t={};return e.replace(pQ,(r,n,i)=>{const a=i.trim();return t[a]?"":(t[a]=!0,`uniform ${n} ${a};
`)})}const cy={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"};let Gx=function(e){return e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom",e}({}),Wx=function(e){return e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.METER_OFFSET=5]="METER_OFFSET",e}({});const P1={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",RelativeOrigin:"u_RelativeOrigin"};var El={MapInitStart:"mapInitStart",LayerInitStart:"layerInitStart",LayerInitEnd:"layerInitEnd",SourceInitStart:"sourceInitStart",SourceInitEnd:"sourceInitEnd",ScaleInitStart:"scaleInitStart",ScaleInitEnd:"scaleInitEnd",MappingStart:"mappingStart",MappingEnd:"mappingEnd",BuildModelStart:"buildModelStart",BuildModelEnd:"buildModelEnd"};let kc=function(e){return e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag",e}({}),Am=function(e){return e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none",e}({}),Ry=function(e){return e.MULTIPLE="MULTIPLE",e.SINGLE="SINGLE",e}({}),HI=function(e){return e.AND="and",e.OR="or",e}({}),uu=function(e){return e.INIT="init",e.UPDATE="update",e}({}),Na=function(e){return e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging",e.CUSTOM="threshold",e}({}),D1=function(e){return e.CONSTANT="constant",e.VARIABLE="variable",e}({}),Jr=function(e){return e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform",e}({});const e_=["mapload","mapchange","mapAfterFrameChange"];var h4={exports:{}};h4.exports=BS;h4.exports.default=BS;var bx=1e20;function BS(e,t,r,n,i,a){this.fontSize=e||24,this.buffer=t===void 0?3:t,this.cutoff=n||.25,this.fontFamily=i||"sans-serif",this.fontWeight=a||"normal",this.radius=r||8;var o=this.size=this.fontSize+this.buffer*2,s=o+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=o,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(o/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function xIt(e,t,r,n,i,a,o){a.fill(bx,0,t*r),o.fill(0,0,t*r);for(var s=(t-n)/2,l=0;l<i;l++)for(var u=0;u<n;u++){var c=(l+s)*t+u+s,f=e.data[4*(l*n+u)+3]/255;if(f===1)a[c]=0,o[c]=bx;else if(f===0)a[c]=bx,o[c]=0;else{var d=Math.max(0,.5-f),v=Math.max(0,f-.5);a[c]=d*d,o[c]=v*v}}}function bIt(e,t,r,n,i,a,o){for(var s=0;s<t*r;s++){var l=Math.sqrt(n[s])-Math.sqrt(i[s]);e[s]=Math.round(255-255*(l/a+o))}}BS.prototype._draw=function(e,t){var r=this.ctx.measureText(e),n=r.width,i=2*this.buffer,a,o,s,l,u,c,f,d;t&&this.useMetrics?(u=Math.floor(r.actualBoundingBoxAscent),d=this.buffer+Math.ceil(r.actualBoundingBoxAscent),c=this.buffer,f=this.buffer,o=Math.min(this.size,Math.ceil(r.actualBoundingBoxRight-r.actualBoundingBoxLeft)),l=Math.min(this.size-c,Math.ceil(r.actualBoundingBoxAscent+r.actualBoundingBoxDescent)),a=o+i,s=l+i,this.ctx.textBaseline="alphabetic"):(a=o=this.size,s=l=this.size,u=19*this.fontSize/24,c=f=0,d=this.middle,this.ctx.textBaseline="middle");var v;o&&l&&(this.ctx.clearRect(f,c,o,l),this.ctx.fillText(e,this.buffer,d),v=this.ctx.getImageData(f,c,o,l));var g=new Uint8ClampedArray(a*s);return xIt(v,a,s,o,l,this.gridOuter,this.gridInner),PU(this.gridOuter,a,s,this.f,this.v,this.z),PU(this.gridInner,a,s,this.f,this.v,this.z),bIt(g,a,s,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:g,metrics:{width:o,height:l,sdfWidth:a,sdfHeight:s,top:u,left:0,advance:n}}};BS.prototype.draw=function(e){return this._draw(e,!1).data};BS.prototype.drawWithMetrics=function(e){return this._draw(e,!0)};function PU(e,t,r,n,i,a){for(var o=0;o<t;o++)DU(e,o,t,r,n,i,a);for(var s=0;s<r;s++)DU(e,s*t,1,t,n,i,a)}function DU(e,t,r,n,i,a,o){var s,l,u,c;for(a[0]=0,o[0]=-bx,o[1]=bx,s=0;s<n;s++)i[s]=e[t+s*r];for(s=1,l=0,u=0;s<n;s++){do c=a[l],u=(i[s]-i[c]+s*s-c*c)/(s-c)/2;while(u<=o[l]&&--l>-1);l++,a[l]=s,o[l]=u,o[l+1]=bx}for(s=0,l=0;s<n;s++){for(;o[l+1]<s;)l++;c=a[l],e[t+s*r]=i[c]+(s-c)*(s-c)}}var EIt=h4.exports;const wIt=sa(EIt),UE=30;function CIt({characterSet:e,getFontWidth:t,fontHeight:r,buffer:n,maxCanvasWidth:i,mapping:a={},xOffset:o=0,yOffset:s=0}){let l=0,u=o;Array.from(e).forEach((f,d)=>{if(!a[f]){const v=t(f,d);u+UE>i&&(u=0,l++),a[f]={x:u,y:s+l*UE,width:UE,height:UE,advance:v},u+=UE}});const c=r+n*2;return{mapping:a,xOffset:u,yOffset:s+l*c,canvasHeight:vQ(s+(l+1)*c)}}function SIt(e,t,r){let n=0,i=0,a=0,o=[];const s={};for(const u of e)if(!s[u.id]){const{size:c}=u;n+c+t>r&&(FU(s,o,i),n=0,i=a+i+t,a=0,o=[]),o.push({icon:u,xOffset:n}),n=n+c+t,a=Math.max(a,c)}o.length>0&&FU(s,o,i);const l=vQ(a+i+t);return{mapping:s,canvasHeight:l}}function FU(e,t,r){for(const n of t){const{icon:i,xOffset:a}=n;e[i.id]=Ce(Ce({},i),{},{x:a,y:r,image:i.image,width:i.width,height:i.height})}}function vQ(e){return Math.pow(2,Math.ceil(Math.log2(e)))}const TIt=FIt(),AIt="sans-serif",MIt="normal",RIt=24,IIt=3,LIt=.25,OIt=8,BU=1024,PIt=1,NU=1,DIt=3;function FIt(){const e=[];for(let t=32;t<128;t++)e.push(String.fromCharCode(t));return e}function kU(e,t,r,n){e.font=`${n} ${r}px ${t}`,e.fillStyle="black",e.textBaseline="middle"}function zU(e,t){for(let r=0;r<e.length;r++)t.data[4*r+3]=e[r]}class BIt extends Gu.EventEmitter{constructor(...t){super(...t),U(this,"fontAtlas",void 0),U(this,"iconFontMap",void 0),U(this,"iconFontGlyphs",{}),U(this,"fontOptions",void 0),U(this,"key",void 0),U(this,"cache",new TAt(DIt))}get scale(){return NU}get canvas(){const t=this.cache.get(this.key);return t&&t.data}get mapping(){const t=this.cache.get(this.key);return t&&t.mapping||{}}getCanvasByKey(t){const r=this.cache.get(t);return r&&r.data}getMappingByKey(t){const r=this.cache.get(t);return r&&r.mapping||{}}init(){this.cache.clear(),this.fontOptions={fontFamily:AIt,fontWeight:MIt,characterSet:TIt,fontSize:RIt,buffer:IIt,sdf:!0,cutoff:LIt,radius:OIt,iconfont:!1},this.key="",this.iconFontMap=new Map}addIconGlyphs(t){t.forEach(r=>{this.iconFontGlyphs[r.name]=r.unicode})}addIconFont(t,r){this.iconFontMap.set(t,r)}getIconFontKey(t){return this.iconFontMap.get(t)||t}getGlyph(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}setFontOptions(t){this.fontOptions=Ce(Ce({},this.fontOptions),t),this.key=this.getKey();const r=this.getNewChars(this.key,this.fontOptions.characterSet),n=this.cache.get(this.key);if(n&&r.length===0)return;const i=this.generateFontAtlas(this.key,r,n);this.fontAtlas=i,this.cache.set(this.key,i)}addFontFace(t,r){const n=document.createElement("style");n.type="text/css",n.innerText=`
        @font-face{
            font-family: '${t}';
            src: url('${r}') format('woff2'),
            url('${r}') format('woff'),
            url('${r}') format('truetype');
        }`,n.onload=()=>{if(document.fonts)try{document.fonts.load(`24px ${t}`,"L7text"),document.fonts.ready.then(()=>{this.emit("fontloaded",{fontFamily:t})})}catch(i){console.warn("当前环境不支持 document.fonts !"),console.warn("当前环境不支持 iconfont !"),console.warn(i)}},document.getElementsByTagName("head")[0].appendChild(n)}destroy(){this.cache.clear(),this.iconFontMap.clear()}generateFontAtlas(t,r,n){const{fontFamily:i,fontWeight:a,fontSize:o,buffer:s,sdf:l,radius:u,cutoff:c,iconfont:f}=this.fontOptions;let d=n&&n.data;d||(d=window.document.createElement("canvas"),d.width=BU);const v=d.getContext("2d",{willReadFrequently:!0});kU(v,i,o,a);const{mapping:g,canvasHeight:x,xOffset:w,yOffset:S}=CIt(Ce({getFontWidth:R=>v.measureText(R).width,fontHeight:o*NU,buffer:s,characterSet:r,maxCanvasWidth:BU},n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset})),M=v.getImageData(0,0,d.width,d.height);if(d.height=x,v.putImageData(M,0,0),kU(v,i,o,a),l){const R=new wIt(o,s,u,c,i,a),I=v.getImageData(0,0,R.size,R.size);for(const P of r){if(f){const k=String.fromCharCode(parseInt(P.replace("&#x","").replace(";",""),16)),z=R.draw(k);zU(z,I)}else zU(R.draw(P),I);v.putImageData(I,g[P].x,g[P].y)}}else for(const R of r)v.fillText(R,g[R].x,g[R].y+o*PIt);return{xOffset:w,yOffset:S,mapping:g,data:d,width:d.width,height:d.height}}getKey(){const{fontFamily:t,fontWeight:r}=this.fontOptions;return`${t}_${r}`}getNewChars(t,r){const n=this.cache.get(t);if(!n)return r;const i=[],a=n.mapping,o=new Set(Object.keys(a));return new Set(r).forEach(l=>{o.has(l)||i.push(l)}),i}}function UU(e,t,r,n,i,a,o){try{var s=e[a](o),l=s.value}catch(u){return void r(u)}s.done?t(l):Promise.resolve(l).then(n,i)}function Oe(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var a=e.apply(t,r);function o(l){UU(a,n,i,o,s,"next",l)}function s(l){UU(a,n,i,o,s,"throw",l)}o(void 0)})}}const NIt=3,$U=1024,$E=64;class kIt extends Gu.EventEmitter{constructor(...t){super(...t),U(this,"canvasHeight",128),U(this,"texture",void 0),U(this,"canvas",void 0),U(this,"iconData",void 0),U(this,"iconMap",void 0),U(this,"ctx",void 0),U(this,"loadingImageCount",0)}isLoading(){return this.loadingImageCount===0}init(){this.iconData=[],this.iconMap={},this.canvas=window.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}addImage(t,r){var n=this;return Oe(function*(){let i=new Image;n.loadingImageCount++,n.hasImage(t)?console.warn("Image Id already exists"):n.iconData.push({id:t,size:$E}),n.updateIconMap(),i=yield n.loadImage(r);const a=n.iconData.find(o=>o.id===t);a&&(a.image=i,a.width=i.width,a.height=i.height),n.update()})()}addImageMini(t,r,n){const i=n.getSceneConfig().canvas;let a=i.createImage();if(this.loadingImageCount++,this.hasImage(t))throw new Error("Image Id already exists");this.iconData.push({id:t,size:$E}),this.updateIconMap(),this.loadImageMini(r,i).then(o=>{a=o;const s=this.iconData.find(l=>l.id===t);s&&(s.image=a,s.width=a.width,s.height=a.height),this.update()})}getTexture(){return this.texture}getIconMap(){return this.iconMap}getCanvas(){return this.canvas}hasImage(t){return this.iconMap.hasOwnProperty(t)}removeImage(t){this.hasImage(t)&&(this.iconData=this.iconData.filter(r=>r.id!==t),delete this.iconMap[t],this.update())}destroy(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}loadImage(t){return new Promise((r,n)=>{if(t instanceof HTMLImageElement){r(t);return}const i=new Image;i.crossOrigin="anonymous",i.onload=()=>{r(i)},i.onerror=()=>{n(new Error("Could not load image at "+t))},i.src=t instanceof File?URL.createObjectURL(t):t})}update(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}updateIconAtlas(){this.canvas.width=$U,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(t=>{const{x:r,y:n,image:i,width:a=64,height:o=64}=this.iconMap[t],l=Math.max(a,o)/$E,u=o/l,c=a/l;i&&this.ctx.drawImage(i,r+($E-c)/2,n+($E-u)/2,c,u)})}updateIconMap(){const{mapping:t,canvasHeight:r}=SIt(this.iconData,NIt,$U);this.iconMap=t,this.canvasHeight=r}loadImageMini(t,r){return new Promise((n,i)=>{const a=r.createImage();a.crossOrigin="anonymous",a.onload=()=>{n(a)},a.onerror=()=>{i(new Error("Could not load image at "+t))},a.src=t})}}var Lu=1e-6,th=typeof Float32Array<"u"?Float32Array:Array;function zIt(){var e=new th(4);return th!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}function UIt(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l+a*s,e[1]=i*l+o*s,e[2]=n*-s+a*l,e[3]=i*-s+o*l,e}function $It(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],f=c*o-s*u,d=-c*a+s*l,v=u*a-o*l,g=r*f+n*d+i*v;return g?(g=1/g,e[0]=f*g,e[1]=(-c*n+i*u)*g,e[2]=(s*n-i*o)*g,e[3]=d*g,e[4]=(c*r-i*l)*g,e[5]=(-s*r+i*a)*g,e[6]=v*g,e[7]=(-u*r+n*l)*g,e[8]=(o*r-n*a)*g,e):null}function VI(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],f=t[8],d=r[0],v=r[1],g=r[2],x=r[3],w=r[4],S=r[5],M=r[6],R=r[7],I=r[8];return e[0]=d*n+v*o+g*u,e[1]=d*i+v*s+g*c,e[2]=d*a+v*l+g*f,e[3]=x*n+w*o+S*u,e[4]=x*i+w*s+S*c,e[5]=x*a+w*l+S*f,e[6]=M*n+R*o+I*u,e[7]=M*i+R*s+I*c,e[8]=M*a+R*l+I*f,e}function HIt(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function VIt(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=-r,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function GIt(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function A_(){var e=new th(16);return th!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function WIt(e,t,r,n,i,a,o,s,l,u,c,f,d,v,g,x){var w=new th(16);return w[0]=e,w[1]=t,w[2]=r,w[3]=n,w[4]=i,w[5]=a,w[6]=o,w[7]=s,w[8]=l,w[9]=u,w[10]=c,w[11]=f,w[12]=d,w[13]=v,w[14]=g,w[15]=x,w}function HU(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function EC(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],f=t[9],d=t[10],v=t[11],g=t[12],x=t[13],w=t[14],S=t[15],M=r*s-n*o,R=r*l-i*o,I=r*u-a*o,P=n*l-i*s,k=n*u-a*s,z=i*u-a*l,G=c*x-f*g,J=c*w-d*g,Z=c*S-v*g,X=f*w-d*x,et=f*S-v*x,at=d*S-v*w,wt=M*at-R*et+I*X+P*Z-k*J+z*G;return wt?(wt=1/wt,e[0]=(s*at-l*et+u*X)*wt,e[1]=(i*et-n*at-a*X)*wt,e[2]=(x*z-w*k+S*P)*wt,e[3]=(d*k-f*z-v*P)*wt,e[4]=(l*Z-o*at-u*J)*wt,e[5]=(r*at-i*Z+a*J)*wt,e[6]=(w*I-g*z-S*R)*wt,e[7]=(c*z-d*I+v*R)*wt,e[8]=(o*et-s*Z+u*G)*wt,e[9]=(n*Z-r*et-a*G)*wt,e[10]=(g*k-x*I+S*M)*wt,e[11]=(f*I-c*k-v*M)*wt,e[12]=(s*J-o*X-l*G)*wt,e[13]=(r*X-n*J+i*G)*wt,e[14]=(x*R-g*P-w*M)*wt,e[15]=(c*P-f*R+d*M)*wt,e):null}function Wm(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],f=t[8],d=t[9],v=t[10],g=t[11],x=t[12],w=t[13],S=t[14],M=t[15],R=r[0],I=r[1],P=r[2],k=r[3];return e[0]=R*n+I*s+P*f+k*x,e[1]=R*i+I*l+P*d+k*w,e[2]=R*a+I*u+P*v+k*S,e[3]=R*o+I*c+P*g+k*M,R=r[4],I=r[5],P=r[6],k=r[7],e[4]=R*n+I*s+P*f+k*x,e[5]=R*i+I*l+P*d+k*w,e[6]=R*a+I*u+P*v+k*S,e[7]=R*o+I*c+P*g+k*M,R=r[8],I=r[9],P=r[10],k=r[11],e[8]=R*n+I*s+P*f+k*x,e[9]=R*i+I*l+P*d+k*w,e[10]=R*a+I*u+P*v+k*S,e[11]=R*o+I*c+P*g+k*M,R=r[12],I=r[13],P=r[14],k=r[15],e[12]=R*n+I*s+P*f+k*x,e[13]=R*i+I*l+P*d+k*w,e[14]=R*a+I*u+P*v+k*S,e[15]=R*o+I*c+P*g+k*M,e}function Bh(e,t,r){var n=r[0],i=r[1],a=r[2],o,s,l,u,c,f,d,v,g,x,w,S;return t===e?(e[12]=t[0]*n+t[4]*i+t[8]*a+t[12],e[13]=t[1]*n+t[5]*i+t[9]*a+t[13],e[14]=t[2]*n+t[6]*i+t[10]*a+t[14],e[15]=t[3]*n+t[7]*i+t[11]*a+t[15]):(o=t[0],s=t[1],l=t[2],u=t[3],c=t[4],f=t[5],d=t[6],v=t[7],g=t[8],x=t[9],w=t[10],S=t[11],e[0]=o,e[1]=s,e[2]=l,e[3]=u,e[4]=c,e[5]=f,e[6]=d,e[7]=v,e[8]=g,e[9]=x,e[10]=w,e[11]=S,e[12]=o*n+c*i+g*a+t[12],e[13]=s*n+f*i+x*a+t[13],e[14]=l*n+d*i+w*a+t[14],e[15]=u*n+v*i+S*a+t[15]),e}function Nh(e,t,r){var n=r[0],i=r[1],a=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function M_(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[4],o=t[5],s=t[6],l=t[7],u=t[8],c=t[9],f=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*i+u*n,e[5]=o*i+c*n,e[6]=s*i+f*n,e[7]=l*i+d*n,e[8]=u*i-a*n,e[9]=c*i-o*n,e[10]=f*i-s*n,e[11]=d*i-l*n,e}function NS(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[0],o=t[1],s=t[2],l=t[3],u=t[8],c=t[9],f=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i-u*n,e[1]=o*i-c*n,e[2]=s*i-f*n,e[3]=l*i-d*n,e[8]=a*n+u*i,e[9]=o*n+c*i,e[10]=s*n+f*i,e[11]=l*n+d*i,e}function Fb(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[0],o=t[1],s=t[2],l=t[3],u=t[4],c=t[5],f=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i+u*n,e[1]=o*i+c*n,e[2]=s*i+f*n,e[3]=l*i+d*n,e[4]=u*i-a*n,e[5]=c*i-o*n,e[6]=f*i-s*n,e[7]=d*i-l*n,e}function XIt(e,t,r,n,i){var a=1/Math.tan(t/2);if(e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0){var o=1/(n-i);e[10]=(i+n)*o,e[14]=2*i*n*o}else e[10]=-1,e[14]=-2*n;return e}var gQ=XIt;function VU(e,t){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],l=e[6],u=e[7],c=e[8],f=e[9],d=e[10],v=e[11],g=e[12],x=e[13],w=e[14],S=e[15],M=t[0],R=t[1],I=t[2],P=t[3],k=t[4],z=t[5],G=t[6],J=t[7],Z=t[8],X=t[9],et=t[10],at=t[11],wt=t[12],Tt=t[13],vt=t[14],zt=t[15];return Math.abs(r-M)<=Lu*Math.max(1,Math.abs(r),Math.abs(M))&&Math.abs(n-R)<=Lu*Math.max(1,Math.abs(n),Math.abs(R))&&Math.abs(i-I)<=Lu*Math.max(1,Math.abs(i),Math.abs(I))&&Math.abs(a-P)<=Lu*Math.max(1,Math.abs(a),Math.abs(P))&&Math.abs(o-k)<=Lu*Math.max(1,Math.abs(o),Math.abs(k))&&Math.abs(s-z)<=Lu*Math.max(1,Math.abs(s),Math.abs(z))&&Math.abs(l-G)<=Lu*Math.max(1,Math.abs(l),Math.abs(G))&&Math.abs(u-J)<=Lu*Math.max(1,Math.abs(u),Math.abs(J))&&Math.abs(c-Z)<=Lu*Math.max(1,Math.abs(c),Math.abs(Z))&&Math.abs(f-X)<=Lu*Math.max(1,Math.abs(f),Math.abs(X))&&Math.abs(d-et)<=Lu*Math.max(1,Math.abs(d),Math.abs(et))&&Math.abs(v-at)<=Lu*Math.max(1,Math.abs(v),Math.abs(at))&&Math.abs(g-wt)<=Lu*Math.max(1,Math.abs(g),Math.abs(wt))&&Math.abs(x-Tt)<=Lu*Math.max(1,Math.abs(x),Math.abs(Tt))&&Math.abs(w-vt)<=Lu*Math.max(1,Math.abs(w),Math.abs(vt))&&Math.abs(S-zt)<=Lu*Math.max(1,Math.abs(S),Math.abs(zt))}function ww(){var e=new th(3);return th!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function su(e,t,r){var n=new th(3);return n[0]=e,n[1]=t,n[2]=r,n}function jIt(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function YIt(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function Cw(e,t){var r=t[0],n=t[1],i=t[2],a=r*r+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function ZIt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function qIt(e,t,r){var n=t[0],i=t[1],a=t[2],o=r[0],s=r[1],l=r[2];return e[0]=i*l-a*s,e[1]=a*o-n*l,e[2]=n*s-i*o,e}function AT(e,t,r){var n=t[0],i=t[1],a=t[2],o=r[3]*n+r[7]*i+r[11]*a+r[15];return o=o||1,e[0]=(r[0]*n+r[4]*i+r[8]*a+r[12])/o,e[1]=(r[1]*n+r[5]*i+r[9]*a+r[13])/o,e[2]=(r[2]*n+r[6]*i+r[10]*a+r[14])/o,e}function wC(e,t,r){var n=t[0],i=t[1],a=t[2];return e[0]=n*r[0]+i*r[3]+a*r[6],e[1]=n*r[1]+i*r[4]+a*r[7],e[2]=n*r[2]+i*r[5]+a*r[8],e}function GU(e,t){var r=e[0],n=e[1],i=e[2],a=t[0],o=t[1],s=t[2],l=Math.sqrt((r*r+n*n+i*i)*(a*a+o*o+s*s)),u=l&&ZIt(e,t)/l;return Math.acos(Math.min(Math.max(u,-1),1))}var WU=jIt;(function(){var e=ww();return function(t,r,n,i,a,o){var s,l;for(r||(r=3),n||(n=0),i?l=Math.min(i*r+n,t.length):l=t.length,s=n;s<l;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}})();function mQ(){var e=new th(4);return th!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function KIt(e,t,r,n){var i=new th(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i}function QIt(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function Dm(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*o,e[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*o,e[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*o,e[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*o,e}(function(){var e=mQ();return function(t,r,n,i,a,o){var s,l;for(r||(r=4),n||(n=0),i?l=Math.min(i*r+n,t.length):l=t.length,s=n;s<l;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}})();function Uc(){var e=new th(2);return th!=Float32Array&&(e[0]=0,e[1]=0),e}function ID(e,t){var r=new th(2);return r[0]=e,r[1]=t,r}function MO(e,t){return e[0]=t[0],e[1]=t[1],e}function JIt(e,t,r){return e[0]=t,e[1]=r,e}function Vl(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function WM(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function $l(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function Hl(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function oc(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function Xx(e,t){var r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)}function nx(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function t3t(e,t){return e[0]=-t[0],e[1]=-t[1],e}function jx(e,t){var r=t[0],n=t[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e}function XM(e,t){return e[0]*t[0]+e[1]*t[1]}function e3t(e,t,r,n){var i=t[0],a=t[1];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e}function r3t(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[3]*i+r[6],e[1]=r[1]*n+r[4]*i+r[7],e}function LD(e,t){var r=e[0],n=e[1],i=t[0],a=t[1];return Math.abs(Math.atan2(n*i-r*a,r*i+n*a))}function n3t(e,t){return e[0]===t[0]&&e[1]===t[1]}var fg=WM;(function(){var e=Uc();return function(t,r,n,i,a,o){var s,l;for(r||(r=2),n||(n=0),i?l=Math.min(i*r+n,t.length):l=t.length,s=n;s<l;s+=r)e[0]=t[s],e[1]=t[s+1],a(e,e,o),t[s]=e[0],t[s+1]=e[1];return t}})();class i3t{constructor(){U(this,"viewport",void 0),U(this,"overridedViewProjectionMatrix",void 0),U(this,"viewMatrixInverse",void 0),U(this,"cameraPosition",void 0)}init(){}update(t){this.viewport=t,this.viewMatrixInverse=A_(),EC(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}getProjectionMatrix(){return this.viewport.getProjectionMatrix()}getModelMatrix(){return this.viewport.getModelMatrix()}getViewMatrix(){return this.viewport.getViewMatrix()}getViewMatrixUncentered(){return this.viewport.getViewMatrixUncentered()}getViewProjectionMatrixUncentered(){return this.viewport.getViewProjectionMatrixUncentered()}getViewProjectionMatrix(){return this.overridedViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}getZoom(){return this.viewport.getZoom()}getZoomScale(){return this.viewport.getZoomScale()}getCenter(){const[t,r]=this.viewport.getCenter();return[t,r]}getFocalDistance(){return this.viewport.getFocalDistance()}getCameraPosition(){return this.cameraPosition}projectFlat(t,r){return this.viewport.projectFlat(t,r)}setViewProjectionMatrix(t){this.overridedViewProjectionMatrix=t}}const a3t={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"};class o3t{constructor(){U(this,"container",void 0),U(this,"controlCorners",void 0),U(this,"controlContainer",void 0),U(this,"scene",void 0),U(this,"mapsService",void 0),U(this,"controls",[]),U(this,"unAddControls",[])}init(t,r){this.container=t.container,this.scene=r,this.mapsService=r.mapService,this.initControlPos()}addControl(t,r){r.mapService.map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}getControlByName(t){return this.controls.find(r=>r.controlOption.name===t)}removeControl(t){const r=this.controls.indexOf(t);return r>-1&&this.controls.splice(r,1),t.remove(),this}addControls(){this.unAddControls.forEach(t=>{t.addTo(this.scene),this.controls.push(t)}),this.unAddControls=[]}destroy(){for(const t of this.controls)t.remove();this.controls=[],this.clearControlPos()}initControlPos(){const t=this.controlCorners={},r="l7-",n=this.controlContainer=Ua("div",r+"control-container",this.container);function i(o=[]){const s=o.map(l=>r+l).join(" ");t[o.filter(l=>!["row","column"].includes(l)).join("")]=Ua("div",s,n)}function a(o){return[...o.replace(/^(top|bottom|left|right|center)/,"$1-").split("-"),a3t[o]]}Object.values(Gx).forEach(o=>{i(a(o))}),this.checkCornerOverlap()}clearControlPos(){for(const t in this.controlCorners)this.controlCorners[t]&&kh(this.controlCorners[t]);this.controlContainer&&kh(this.controlContainer)}checkCornerOverlap(){const t=window.MutationObserver;if(t)for(const r of Object.keys(this.controlCorners)){const n=r.match(/^(top|bottom)(left|right)$/);if(n){const[,i,a]=n,o=this.controlCorners[`${i}${a}`];new t(([{target:l}])=>{o&&(o.style[i]=l.clientHeight+"px")}).observe(this.controlCorners[`${a}${i}`],{childList:!0,attributes:!0})}}}}class s3t{constructor(){U(this,"container",void 0),U(this,"scene",void 0),U(this,"mapsService",void 0),U(this,"markers",[]),U(this,"markerLayers",[]),U(this,"unAddMarkers",[]),U(this,"unAddMarkerLayers",[])}addMarkerLayer(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}removeMarkerLayer(t){t.destroy(),this.markerLayers.indexOf(t);const r=this.markerLayers.indexOf(t);r>-1&&this.markerLayers.splice(r,1)}addMarker(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}addMarkers(){this.unAddMarkers.forEach(t=>{t.addTo(this.scene),this.markers.push(t)}),this.unAddMarkers=[]}addMarkerLayers(){this.unAddMarkerLayers.forEach(t=>{this.markerLayers.push(t),t.addTo(this.scene)}),this.unAddMarkers=[]}removeMarker(t){t.remove(),this.markers.indexOf(t);const r=this.markers.indexOf(t);r>-1&&this.markers.splice(r,1)}removeAllMarkers(){this.destroy()}init(t){this.scene=t,this.mapsService=t.mapService}destroy(){this.markers.forEach(t=>{t.remove()}),this.markers=[],this.markerLayers.forEach(t=>{t.destroy()}),this.markerLayers=[]}removeMakerLayerMarker(t){t.destroy()}}class l3t{constructor(){U(this,"scene",void 0),U(this,"mapsService",void 0),U(this,"popups",[]),U(this,"unAddPopups",[])}get isMarkerReady(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}removePopup(t){t!=null&&t.isOpen()&&t.remove();const r=this.popups.indexOf(t);r>-1&&this.popups.splice(r,1);const n=this.unAddPopups.indexOf(t);n>-1&&this.unAddPopups.splice(n,1)}destroy(){this.popups.forEach(t=>t.remove())}addPopup(t){t&&t.getOptions().autoClose&&[...this.popups,...this.unAddPopups].forEach(r=>{r.getOptions().autoClose&&this.removePopup(r)}),this.isMarkerReady?(t.addTo(this.scene),this.popups.push(t)):this.unAddPopups.push(t),t.on("close",()=>{this.removePopup(t)})}initPopup(){this.unAddPopups.length&&this.unAddPopups.forEach(t=>{this.addPopup(t),this.unAddPopups=[]})}init(t){this.scene=t,this.mapsService=t.mapService}}const u3t={MapToken:"您正在使用 Demo 测试 Token, 生产环境务必自行注册 Token 确保服务稳定 高德地图申请地址 https://lbs.amap.com/api/javascript-api/guide/abc/prepare  Mapbox地图申请地址 https://docs.mapbox.com/help/glossary/access-token/",SDK:"请确认引入了mapbox-gl api且在L7之前引入"},{merge:c3t}=as,h3t={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},f3t={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:HI.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0};class d3t{constructor(){U(this,"sceneConfigCache",{}),U(this,"layerConfigCache",{}),U(this,"layerAttributeConfigCache",{})}getSceneConfig(t){return this.sceneConfigCache[t]}getSceneWarninfo(t){return u3t[t]}setSceneConfig(t,r){this.sceneConfigCache[t]=Ce(Ce({},h3t),r)}getLayerConfig(t){return this.layerConfigCache[t]}setLayerConfig(t,r,n){this.layerConfigCache[r]=Ce({},c3t({},this.sceneConfigCache[t],f3t,n))}getAttributeConfig(t){return this.layerAttributeConfigCache[t]}setAttributeConfig(t,r){this.layerAttributeConfigCache[t]=Ce(Ce({},this.layerAttributeConfigCache[t]),r)}clean(){this.sceneConfigCache={},this.layerConfigCache={}}}const RO=Math.PI/180,p3t=512,XU=4003e4;function jU({latitude:e=0,zoom:t=0,scale:r,highPrecision:n=!1,flipY:i=!1}){r=r!==void 0?r:Math.pow(2,t);const a={},o=p3t*r,s=Math.cos(e*RO),l=o/360,u=l/s,c=o/XU/s;if(a.pixelsPerMeter=[c,-c,c],a.metersPerPixel=[1/c,-1/c,1/c],a.pixelsPerDegree=[l,-u,c],a.degreesPerPixel=[1/l,-1/u,1/c],n){const f=RO*Math.tan(e*RO)/s,d=l*f/2,v=o/XU*f,g=v/u*c;a.pixelsPerDegree2=[0,-d,v],a.pixelsPerMeter2=[g,0,g],i&&(a.pixelsPerDegree2[1]=-a.pixelsPerDegree2[1],a.pixelsPerMeter2[1]=-a.pixelsPerMeter2[1])}return i&&(a.pixelsPerMeter[1]=-a.pixelsPerMeter[1],a.metersPerPixel[1]=-a.metersPerPixel[1],a.pixelsPerDegree[1]=-a.pixelsPerDegree[1],a.degreesPerPixel[1]=-a.degreesPerPixel[1]),a}const v3t=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];class g3t{constructor(t){U(this,"needRefresh",!0),U(this,"coordinateSystem",void 0),U(this,"viewportCenter",void 0),U(this,"viewportCenterProjection",void 0),U(this,"pixelsPerDegree",void 0),U(this,"pixelsPerDegree2",void 0),U(this,"pixelsPerMeter",void 0),this.cameraService=t}refresh(t){const r=this.cameraService.getZoom(),n=t||this.cameraService.getCenter(),{pixelsPerMeter:i,pixelsPerDegree:a}=jU({latitude:n[1],zoom:r});this.viewportCenter=n,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=i,this.pixelsPerDegree=a,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Wx.LNGLAT?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Wx.LNGLAT_OFFSET&&this.calculateLnglatOffset(n,r),this.needRefresh=!1}getCoordinateSystem(){return this.coordinateSystem}setCoordinateSystem(t){this.coordinateSystem=t}getViewportCenter(){return this.viewportCenter}setViewportCenter(t){this.refresh(t)}getViewportCenterProjection(){return this.viewportCenterProjection}getPixelsPerDegree(){return this.pixelsPerDegree}getPixelsPerDegree2(){return this.pixelsPerDegree2}getPixelsPerMeter(){return this.pixelsPerMeter}calculateLnglatOffset(t,r,n,i){const{pixelsPerMeter:a,pixelsPerDegree:o,pixelsPerDegree2:s}=jU({latitude:t[1],zoom:r,scale:n,flipY:i,highPrecision:!0});let l=this.cameraService.getViewMatrix();const u=this.cameraService.getProjectionMatrix();let c=Wm([],u,l);const f=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,r));this.viewportCenterProjection=Dm([],[f[0],f[1],0,1],c),l=this.cameraService.getViewMatrixUncentered()||l,c=Wm([],u,l),c=Wm([],c,v3t),this.cameraService.setViewProjectionMatrix(c),this.pixelsPerMeter=a,this.pixelsPerDegree=o,this.pixelsPerDegree2=s}}class m3t extends Gu.EventEmitter{constructor(...t){super(...t),U(this,"renderMap",new Map),U(this,"enable",!1),U(this,"renderEnable",!1),U(this,"cacheLogs",{})}setEnable(t){this.enable=!!t}log(t,r){if(!this.enable)return;const n=t.split(".");let i=null;n.forEach((a,o)=>{i!==null?(i[a]||(i[a]={}),o!==n.length-1&&(i=i[a])):(this.cacheLogs[a]||(this.cacheLogs[a]={}),o!==n.length-1&&(i=this.cacheLogs[a])),o===n.length-1&&(i[a]=Ce(Ce({time:Date.now()},i[a]),r))})}getLog(t){switch(typeof t){case"string":return this.cacheLogs[t];case"object":return t.map(r=>this.cacheLogs[r]).filter(r=>r!==void 0);case"undefined":return this.cacheLogs}}removeLog(t){delete this.cacheLogs[t]}generateRenderUid(){return this.renderEnable?SAt():""}renderDebug(t){this.renderEnable=t}renderStart(t){if(!this.renderEnable||!this.enable)return;const r=this.renderMap.get(t)||{};this.renderMap.set(t,Ce(Ce({},r),{},{renderUid:t,renderStart:Date.now()}))}renderEnd(t){if(!this.renderEnable||!this.enable)return;const r=this.renderMap.get(t);if(r){const n=r.renderStart,i=Date.now();this.emit("renderEnd",Ce(Ce({},r),{},{renderEnd:i,renderDuration:i-n})),this.renderMap.delete(t)}}destroy(){this.cacheLogs=null,this.renderMap.clear()}}var yQ={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(e){(function(t,r,n,i){var a=["","webkit","Moz","MS","ms","o"],o=r.createElement("div"),s="function",l=Math.round,u=Math.abs,c=Date.now;function f(st,gt,Gt){return setTimeout(R(st,Gt),gt)}function d(st,gt,Gt){return Array.isArray(st)?(v(st,Gt[gt],Gt),!0):!1}function v(st,gt,Gt){var ye;if(st)if(st.forEach)st.forEach(gt,Gt);else if(st.length!==i)for(ye=0;ye<st.length;)gt.call(Gt,st[ye],ye,st),ye++;else for(ye in st)st.hasOwnProperty(ye)&&gt.call(Gt,st[ye],ye,st)}function g(st,gt,Gt){var ye="DEPRECATED METHOD: "+gt+`
`+Gt+` AT 
`;return function(){var cr=new Error("get-stack-trace"),an=cr&&cr.stack?cr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ii=t.console&&(t.console.warn||t.console.log);return Ii&&Ii.call(t.console,ye,an),st.apply(this,arguments)}}var x;typeof Object.assign!="function"?x=function(gt){if(gt===i||gt===null)throw new TypeError("Cannot convert undefined or null to object");for(var Gt=Object(gt),ye=1;ye<arguments.length;ye++){var cr=arguments[ye];if(cr!==i&&cr!==null)for(var an in cr)cr.hasOwnProperty(an)&&(Gt[an]=cr[an])}return Gt}:x=Object.assign;var w=g(function(gt,Gt,ye){for(var cr=Object.keys(Gt),an=0;an<cr.length;)(!ye||ye&&gt[cr[an]]===i)&&(gt[cr[an]]=Gt[cr[an]]),an++;return gt},"extend","Use `assign`."),S=g(function(gt,Gt){return w(gt,Gt,!0)},"merge","Use `assign`.");function M(st,gt,Gt){var ye=gt.prototype,cr;cr=st.prototype=Object.create(ye),cr.constructor=st,cr._super=ye,Gt&&x(cr,Gt)}function R(st,gt){return function(){return st.apply(gt,arguments)}}function I(st,gt){return typeof st==s?st.apply(gt&&gt[0]||i,gt):st}function P(st,gt){return st===i?gt:st}function k(st,gt,Gt){v(Z(gt),function(ye){st.addEventListener(ye,Gt,!1)})}function z(st,gt,Gt){v(Z(gt),function(ye){st.removeEventListener(ye,Gt,!1)})}function G(st,gt){for(;st;){if(st==gt)return!0;st=st.parentNode}return!1}function J(st,gt){return st.indexOf(gt)>-1}function Z(st){return st.trim().split(/\s+/g)}function X(st,gt,Gt){if(st.indexOf&&!Gt)return st.indexOf(gt);for(var ye=0;ye<st.length;){if(Gt&&st[ye][Gt]==gt||!Gt&&st[ye]===gt)return ye;ye++}return-1}function et(st){return Array.prototype.slice.call(st,0)}function at(st,gt,Gt){for(var ye=[],cr=[],an=0;an<st.length;){var Ii=gt?st[an][gt]:st[an];X(cr,Ii)<0&&ye.push(st[an]),cr[an]=Ii,an++}return Gt&&(gt?ye=ye.sort(function(hs,Go){return hs[gt]>Go[gt]}):ye=ye.sort()),ye}function wt(st,gt){for(var Gt,ye,cr=gt[0].toUpperCase()+gt.slice(1),an=0;an<a.length;){if(Gt=a[an],ye=Gt?Gt+cr:gt,ye in st)return ye;an++}return i}var Tt=1;function vt(){return Tt++}function zt(st){var gt=st.ownerDocument||st;return gt.defaultView||gt.parentWindow||t}var oe=/mobile|tablet|ip(ad|hone|od)|android/i,Qt="ontouchstart"in t,ne=wt(t,"PointerEvent")!==i,de=Qt&&oe.test(navigator.userAgent),De="touch",Ze="pen",ke="mouse",Be="kinect",Zr=25,Wr=1,In=2,re=4,nr=8,zr=1,Ne=2,Vr=4,xn=8,Qn=16,gn=Ne|Vr,bn=xn|Qn,ci=gn|bn,Mo=["x","y"],ra=["clientX","clientY"];function la(st,gt){var Gt=this;this.manager=st,this.callback=gt,this.element=st.element,this.target=st.options.inputTarget,this.domHandler=function(ye){I(st.options.enable,[st])&&Gt.handler(ye)},this.init()}la.prototype={handler:function(){},init:function(){this.evEl&&k(this.element,this.evEl,this.domHandler),this.evTarget&&k(this.target,this.evTarget,this.domHandler),this.evWin&&k(zt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&z(this.element,this.evEl,this.domHandler),this.evTarget&&z(this.target,this.evTarget,this.domHandler),this.evWin&&z(zt(this.element),this.evWin,this.domHandler)}};function os(st){var gt,Gt=st.options.inputClass;return Gt?gt=Gt:ne?gt=gc:de?gt=jt:Qt?gt=se:gt=ph,new gt(st,Et)}function Et(st,gt,Gt){var ye=Gt.pointers.length,cr=Gt.changedPointers.length,an=gt&Wr&&ye-cr===0,Ii=gt&(re|nr)&&ye-cr===0;Gt.isFirst=!!an,Gt.isFinal=!!Ii,an&&(st.session={}),Gt.eventType=gt,ss(st,Gt),st.emit("hammer.input",Gt),st.recognize(Gt),st.session.prevInput=Gt}function ss(st,gt){var Gt=st.session,ye=gt.pointers,cr=ye.length;Gt.firstInput||(Gt.firstInput=Xu(gt)),cr>1&&!Gt.firstMultiple?Gt.firstMultiple=Xu(gt):cr===1&&(Gt.firstMultiple=!1);var an=Gt.firstInput,Ii=Gt.firstMultiple,bo=Ii?Ii.center:an.center,hs=gt.center=ma(ye);gt.timeStamp=c(),gt.deltaTime=gt.timeStamp-an.timeStamp,gt.angle=vc(bo,hs),gt.distance=cs(bo,hs),_u(Gt,gt),gt.offsetDirection=ol(gt.deltaX,gt.deltaY);var Go=us(gt.deltaTime,gt.deltaX,gt.deltaY);gt.overallVelocityX=Go.x,gt.overallVelocityY=Go.y,gt.overallVelocity=u(Go.x)>u(Go.y)?Go.x:Go.y,gt.scale=Ii?ju(Ii.pointers,ye):1,gt.rotation=Ii?vo(Ii.pointers,ye):0,gt.maxPointers=Gt.prevInput?gt.pointers.length>Gt.prevInput.maxPointers?gt.pointers.length:Gt.prevInput.maxPointers:gt.pointers.length,ls(Gt,gt);var bu=st.element;G(gt.srcEvent.target,bu)&&(bu=gt.srcEvent.target),gt.target=bu}function _u(st,gt){var Gt=gt.center,ye=st.offsetDelta||{},cr=st.prevDelta||{},an=st.prevInput||{};(gt.eventType===Wr||an.eventType===re)&&(cr=st.prevDelta={x:an.deltaX||0,y:an.deltaY||0},ye=st.offsetDelta={x:Gt.x,y:Gt.y}),gt.deltaX=cr.x+(Gt.x-ye.x),gt.deltaY=cr.y+(Gt.y-ye.y)}function ls(st,gt){var Gt=st.lastInterval||gt,ye=gt.timeStamp-Gt.timeStamp,cr,an,Ii,bo;if(gt.eventType!=nr&&(ye>Zr||Gt.velocity===i)){var hs=gt.deltaX-Gt.deltaX,Go=gt.deltaY-Gt.deltaY,bu=us(ye,hs,Go);an=bu.x,Ii=bu.y,cr=u(bu.x)>u(bu.y)?bu.x:bu.y,bo=ol(hs,Go),st.lastInterval=gt}else cr=Gt.velocity,an=Gt.velocityX,Ii=Gt.velocityY,bo=Gt.direction;gt.velocity=cr,gt.velocityX=an,gt.velocityY=Ii,gt.direction=bo}function Xu(st){for(var gt=[],Gt=0;Gt<st.pointers.length;)gt[Gt]={clientX:l(st.pointers[Gt].clientX),clientY:l(st.pointers[Gt].clientY)},Gt++;return{timeStamp:c(),pointers:gt,center:ma(gt),deltaX:st.deltaX,deltaY:st.deltaY}}function ma(st){var gt=st.length;if(gt===1)return{x:l(st[0].clientX),y:l(st[0].clientY)};for(var Gt=0,ye=0,cr=0;cr<gt;)Gt+=st[cr].clientX,ye+=st[cr].clientY,cr++;return{x:l(Gt/gt),y:l(ye/gt)}}function us(st,gt,Gt){return{x:gt/st||0,y:Gt/st||0}}function ol(st,gt){return st===gt?zr:u(st)>=u(gt)?st<0?Ne:Vr:gt<0?xn:Qn}function cs(st,gt,Gt){Gt||(Gt=Mo);var ye=gt[Gt[0]]-st[Gt[0]],cr=gt[Gt[1]]-st[Gt[1]];return Math.sqrt(ye*ye+cr*cr)}function vc(st,gt,Gt){Gt||(Gt=Mo);var ye=gt[Gt[0]]-st[Gt[0]],cr=gt[Gt[1]]-st[Gt[1]];return Math.atan2(cr,ye)*180/Math.PI}function vo(st,gt){return vc(gt[1],gt[0],ra)+vc(st[1],st[0],ra)}function ju(st,gt){return cs(gt[0],gt[1],ra)/cs(st[0],st[1],ra)}var Ml={mousedown:Wr,mousemove:In,mouseup:re},dh="mousedown",ud="mousemove mouseup";function ph(){this.evEl=dh,this.evWin=ud,this.pressed=!1,la.apply(this,arguments)}M(ph,la,{handler:function(gt){var Gt=Ml[gt.type];Gt&Wr&&gt.button===0&&(this.pressed=!0),Gt&In&&gt.which!==1&&(Gt=re),this.pressed&&(Gt&re&&(this.pressed=!1),this.callback(this.manager,Gt,{pointers:[gt],changedPointers:[gt],pointerType:ke,srcEvent:gt}))}});var sp={pointerdown:Wr,pointermove:In,pointerup:re,pointercancel:nr,pointerout:nr},vh={2:De,3:Ze,4:ke,5:Be},ql="pointerdown",Kl="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(ql="MSPointerDown",Kl="MSPointerMove MSPointerUp MSPointerCancel");function gc(){this.evEl=ql,this.evWin=Kl,la.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}M(gc,la,{handler:function(gt){var Gt=this.store,ye=!1,cr=gt.type.toLowerCase().replace("ms",""),an=sp[cr],Ii=vh[gt.pointerType]||gt.pointerType,bo=Ii==De,hs=X(Gt,gt.pointerId,"pointerId");an&Wr&&(gt.button===0||bo)?hs<0&&(Gt.push(gt),hs=Gt.length-1):an&(re|nr)&&(ye=!0),!(hs<0)&&(Gt[hs]=gt,this.callback(this.manager,an,{pointers:Gt,changedPointers:[gt],pointerType:Ii,srcEvent:gt}),ye&&Gt.splice(hs,1))}});var cd={touchstart:Wr,touchmove:In,touchend:re,touchcancel:nr},Hi="touchstart",tt="touchstart touchmove touchend touchcancel";function nt(){this.evTarget=Hi,this.evWin=tt,this.started=!1,la.apply(this,arguments)}M(nt,la,{handler:function(gt){var Gt=cd[gt.type];if(Gt===Wr&&(this.started=!0),!!this.started){var ye=ot.call(this,gt,Gt);Gt&(re|nr)&&ye[0].length-ye[1].length===0&&(this.started=!1),this.callback(this.manager,Gt,{pointers:ye[0],changedPointers:ye[1],pointerType:De,srcEvent:gt})}}});function ot(st,gt){var Gt=et(st.touches),ye=et(st.changedTouches);return gt&(re|nr)&&(Gt=at(Gt.concat(ye),"identifier",!0)),[Gt,ye]}var yt={touchstart:Wr,touchmove:In,touchend:re,touchcancel:nr},Rt="touchstart touchmove touchend touchcancel";function jt(){this.evTarget=Rt,this.targetIds={},la.apply(this,arguments)}M(jt,la,{handler:function(gt){var Gt=yt[gt.type],ye=Jt.call(this,gt,Gt);ye&&this.callback(this.manager,Gt,{pointers:ye[0],changedPointers:ye[1],pointerType:De,srcEvent:gt})}});function Jt(st,gt){var Gt=et(st.touches),ye=this.targetIds;if(gt&(Wr|In)&&Gt.length===1)return ye[Gt[0].identifier]=!0,[Gt,Gt];var cr,an,Ii=et(st.changedTouches),bo=[],hs=this.target;if(an=Gt.filter(function(Go){return G(Go.target,hs)}),gt===Wr)for(cr=0;cr<an.length;)ye[an[cr].identifier]=!0,cr++;for(cr=0;cr<Ii.length;)ye[Ii[cr].identifier]&&bo.push(Ii[cr]),gt&(re|nr)&&delete ye[Ii[cr].identifier],cr++;if(bo.length)return[at(an.concat(bo),"identifier",!0),bo]}var ht=2500,Dt=25;function se(){la.apply(this,arguments);var st=R(this.handler,this);this.touch=new jt(this.manager,st),this.mouse=new ph(this.manager,st),this.primaryTouch=null,this.lastTouches=[]}M(se,la,{handler:function(gt,Gt,ye){var cr=ye.pointerType==De,an=ye.pointerType==ke;if(!(an&&ye.sourceCapabilities&&ye.sourceCapabilities.firesTouchEvents)){if(cr)Pe.call(this,Gt,ye);else if(an&&Ae.call(this,ye))return;this.callback(gt,Gt,ye)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Pe(st,gt){st&Wr?(this.primaryTouch=gt.changedPointers[0].identifier,er.call(this,gt)):st&(re|nr)&&er.call(this,gt)}function er(st){var gt=st.changedPointers[0];if(gt.identifier===this.primaryTouch){var Gt={x:gt.clientX,y:gt.clientY};this.lastTouches.push(Gt);var ye=this.lastTouches,cr=function(){var an=ye.indexOf(Gt);an>-1&&ye.splice(an,1)};setTimeout(cr,ht)}}function Ae(st){for(var gt=st.srcEvent.clientX,Gt=st.srcEvent.clientY,ye=0;ye<this.lastTouches.length;ye++){var cr=this.lastTouches[ye],an=Math.abs(gt-cr.x),Ii=Math.abs(Gt-cr.y);if(an<=Dt&&Ii<=Dt)return!0}return!1}var qe=wt(o.style,"touchAction"),Yr=qe!==i,Hr="compute",Ie="auto",Mr="manipulation",pr="none",mr="pan-x",Un="pan-y",Cr=oi();function hi(st,gt){this.manager=st,this.set(gt)}hi.prototype={set:function(st){st==Hr&&(st=this.compute()),Yr&&this.manager.element.style&&Cr[st]&&(this.manager.element.style[qe]=st),this.actions=st.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var st=[];return v(this.manager.recognizers,function(gt){I(gt.options.enable,[gt])&&(st=st.concat(gt.getTouchAction()))}),na(st.join(" "))},preventDefaults:function(st){var gt=st.srcEvent,Gt=st.offsetDirection;if(this.manager.session.prevented){gt.preventDefault();return}var ye=this.actions,cr=J(ye,pr)&&!Cr[pr],an=J(ye,Un)&&!Cr[Un],Ii=J(ye,mr)&&!Cr[mr];if(cr){var bo=st.pointers.length===1,hs=st.distance<2,Go=st.deltaTime<250;if(bo&&hs&&Go)return}if(!(Ii&&an)&&(cr||an&&Gt&gn||Ii&&Gt&bn))return this.preventSrc(gt)},preventSrc:function(st){this.manager.session.prevented=!0,st.preventDefault()}};function na(st){if(J(st,pr))return pr;var gt=J(st,mr),Gt=J(st,Un);return gt&&Gt?pr:gt||Gt?gt?mr:Un:J(st,Mr)?Mr:Ie}function oi(){if(!Yr)return!1;var st={},gt=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Gt){st[Gt]=gt?t.CSS.supports("touch-action",Gt):!0}),st}var Ci=1,$n=2,go=4,vi=8,ia=vi,Bi=16,Hn=32;function si(st){this.options=x({},this.defaults,st||{}),this.id=vt(),this.manager=null,this.options.enable=P(this.options.enable,!0),this.state=Ci,this.simultaneous={},this.requireFail=[]}si.prototype={defaults:{},set:function(st){return x(this.options,st),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(st){if(d(st,"recognizeWith",this))return this;var gt=this.simultaneous;return st=ao(st,this),gt[st.id]||(gt[st.id]=st,st.recognizeWith(this)),this},dropRecognizeWith:function(st){return d(st,"dropRecognizeWith",this)?this:(st=ao(st,this),delete this.simultaneous[st.id],this)},requireFailure:function(st){if(d(st,"requireFailure",this))return this;var gt=this.requireFail;return st=ao(st,this),X(gt,st)===-1&&(gt.push(st),st.requireFailure(this)),this},dropRequireFailure:function(st){if(d(st,"dropRequireFailure",this))return this;st=ao(st,this);var gt=X(this.requireFail,st);return gt>-1&&this.requireFail.splice(gt,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(st){return!!this.simultaneous[st.id]},emit:function(st){var gt=this,Gt=this.state;function ye(cr){gt.manager.emit(cr,st)}Gt<vi&&ye(gt.options.event+ws(Gt)),ye(gt.options.event),st.additionalEvent&&ye(st.additionalEvent),Gt>=vi&&ye(gt.options.event+ws(Gt))},tryEmit:function(st){if(this.canEmit())return this.emit(st);this.state=Hn},canEmit:function(){for(var st=0;st<this.requireFail.length;){if(!(this.requireFail[st].state&(Hn|Ci)))return!1;st++}return!0},recognize:function(st){var gt=x({},st);if(!I(this.options.enable,[this,gt])){this.reset(),this.state=Hn;return}this.state&(ia|Bi|Hn)&&(this.state=Ci),this.state=this.process(gt),this.state&($n|go|vi|Bi)&&this.tryEmit(gt)},process:function(st){},getTouchAction:function(){},reset:function(){}};function ws(st){return st&Bi?"cancel":st&vi?"end":st&go?"move":st&$n?"start":""}function nf(st){return st==Qn?"down":st==xn?"up":st==Ne?"left":st==Vr?"right":""}function ao(st,gt){var Gt=gt.manager;return Gt?Gt.get(st):st}function Fa(){si.apply(this,arguments)}M(Fa,si,{defaults:{pointers:1},attrTest:function(st){var gt=this.options.pointers;return gt===0||st.pointers.length===gt},process:function(st){var gt=this.state,Gt=st.eventType,ye=gt&($n|go),cr=this.attrTest(st);return ye&&(Gt&nr||!cr)?gt|Bi:ye||cr?Gt&re?gt|vi:gt&$n?gt|go:$n:Hn}});function af(){Fa.apply(this,arguments),this.pX=null,this.pY=null}M(af,Fa,{defaults:{event:"pan",threshold:10,pointers:1,direction:ci},getTouchAction:function(){var st=this.options.direction,gt=[];return st&gn&&gt.push(Un),st&bn&&gt.push(mr),gt},directionTest:function(st){var gt=this.options,Gt=!0,ye=st.distance,cr=st.direction,an=st.deltaX,Ii=st.deltaY;return cr&gt.direction||(gt.direction&gn?(cr=an===0?zr:an<0?Ne:Vr,Gt=an!=this.pX,ye=Math.abs(st.deltaX)):(cr=Ii===0?zr:Ii<0?xn:Qn,Gt=Ii!=this.pY,ye=Math.abs(st.deltaY))),st.direction=cr,Gt&&ye>gt.threshold&&cr&gt.direction},attrTest:function(st){return Fa.prototype.attrTest.call(this,st)&&(this.state&$n||!(this.state&$n)&&this.directionTest(st))},emit:function(st){this.pX=st.deltaX,this.pY=st.deltaY;var gt=nf(st.direction);gt&&(st.additionalEvent=this.options.event+gt),this._super.emit.call(this,st)}});function xu(){Fa.apply(this,arguments)}M(xu,Fa,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[pr]},attrTest:function(st){return this._super.attrTest.call(this,st)&&(Math.abs(st.scale-1)>this.options.threshold||this.state&$n)},emit:function(st){if(st.scale!==1){var gt=st.scale<1?"in":"out";st.additionalEvent=this.options.event+gt}this._super.emit.call(this,st)}});function Ra(){si.apply(this,arguments),this._timer=null,this._input=null}M(Ra,si,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Ie]},process:function(st){var gt=this.options,Gt=st.pointers.length===gt.pointers,ye=st.distance<gt.threshold,cr=st.deltaTime>gt.time;if(this._input=st,!ye||!Gt||st.eventType&(re|nr)&&!cr)this.reset();else if(st.eventType&Wr)this.reset(),this._timer=f(function(){this.state=ia,this.tryEmit()},gt.time,this);else if(st.eventType&re)return ia;return Hn},reset:function(){clearTimeout(this._timer)},emit:function(st){this.state===ia&&(st&&st.eventType&re?this.manager.emit(this.options.event+"up",st):(this._input.timeStamp=c(),this.manager.emit(this.options.event,this._input)))}});function gh(){Fa.apply(this,arguments)}M(gh,Fa,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[pr]},attrTest:function(st){return this._super.attrTest.call(this,st)&&(Math.abs(st.rotation)>this.options.threshold||this.state&$n)}});function Vo(){Fa.apply(this,arguments)}M(Vo,Fa,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:gn|bn,pointers:1},getTouchAction:function(){return af.prototype.getTouchAction.call(this)},attrTest:function(st){var gt=this.options.direction,Gt;return gt&(gn|bn)?Gt=st.overallVelocity:gt&gn?Gt=st.overallVelocityX:gt&bn&&(Gt=st.overallVelocityY),this._super.attrTest.call(this,st)&&gt&st.offsetDirection&&st.distance>this.options.threshold&&st.maxPointers==this.options.pointers&&u(Gt)>this.options.velocity&&st.eventType&re},emit:function(st){var gt=nf(st.offsetDirection);gt&&this.manager.emit(this.options.event+gt,st),this.manager.emit(this.options.event,st)}});function Ia(){si.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}M(Ia,si,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Mr]},process:function(st){var gt=this.options,Gt=st.pointers.length===gt.pointers,ye=st.distance<gt.threshold,cr=st.deltaTime<gt.time;if(this.reset(),st.eventType&Wr&&this.count===0)return this.failTimeout();if(ye&&cr&&Gt){if(st.eventType!=re)return this.failTimeout();var an=this.pTime?st.timeStamp-this.pTime<gt.interval:!0,Ii=!this.pCenter||cs(this.pCenter,st.center)<gt.posThreshold;this.pTime=st.timeStamp,this.pCenter=st.center,!Ii||!an?this.count=1:this.count+=1,this._input=st;var bo=this.count%gt.taps;if(bo===0)return this.hasRequireFailures()?(this._timer=f(function(){this.state=ia,this.tryEmit()},gt.interval,this),$n):ia}return Hn},failTimeout:function(){return this._timer=f(function(){this.state=Hn},this.options.interval,this),Hn},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ia&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function oo(st,gt){return gt=gt||{},gt.recognizers=P(gt.recognizers,oo.defaults.preset),new Ns(st,gt)}oo.VERSION="2.0.7",oo.defaults={domEvents:!1,touchAction:Hr,enable:!0,inputTarget:null,inputClass:null,preset:[[gh,{enable:!1}],[xu,{enable:!1},["rotate"]],[Vo,{direction:gn}],[af,{direction:gn},["swipe"]],[Ia],[Ia,{event:"doubletap",taps:2},["tap"]],[Ra]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ya=1,js=2;function Ns(st,gt){this.options=x({},oo.defaults,gt||{}),this.options.inputTarget=this.options.inputTarget||st,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=st,this.input=os(this),this.touchAction=new hi(this,this.options.touchAction),mv(this,!0),v(this.options.recognizers,function(Gt){var ye=this.add(new Gt[0](Gt[1]));Gt[2]&&ye.recognizeWith(Gt[2]),Gt[3]&&ye.requireFailure(Gt[3])},this)}Ns.prototype={set:function(st){return x(this.options,st),st.touchAction&&this.touchAction.update(),st.inputTarget&&(this.input.destroy(),this.input.target=st.inputTarget,this.input.init()),this},stop:function(st){this.session.stopped=st?js:ya},recognize:function(st){var gt=this.session;if(!gt.stopped){this.touchAction.preventDefaults(st);var Gt,ye=this.recognizers,cr=gt.curRecognizer;(!cr||cr&&cr.state&ia)&&(cr=gt.curRecognizer=null);for(var an=0;an<ye.length;)Gt=ye[an],gt.stopped!==js&&(!cr||Gt==cr||Gt.canRecognizeWith(cr))?Gt.recognize(st):Gt.reset(),!cr&&Gt.state&($n|go|vi)&&(cr=gt.curRecognizer=Gt),an++}},get:function(st){if(st instanceof si)return st;for(var gt=this.recognizers,Gt=0;Gt<gt.length;Gt++)if(gt[Gt].options.event==st)return gt[Gt];return null},add:function(st){if(d(st,"add",this))return this;var gt=this.get(st.options.event);return gt&&this.remove(gt),this.recognizers.push(st),st.manager=this,this.touchAction.update(),st},remove:function(st){if(d(st,"remove",this))return this;if(st=this.get(st),st){var gt=this.recognizers,Gt=X(gt,st);Gt!==-1&&(gt.splice(Gt,1),this.touchAction.update())}return this},on:function(st,gt){if(st!==i&&gt!==i){var Gt=this.handlers;return v(Z(st),function(ye){Gt[ye]=Gt[ye]||[],Gt[ye].push(gt)}),this}},off:function(st,gt){if(st!==i){var Gt=this.handlers;return v(Z(st),function(ye){gt?Gt[ye]&&Gt[ye].splice(X(Gt[ye],gt),1):delete Gt[ye]}),this}},emit:function(st,gt){this.options.domEvents&&Rl(st,gt);var Gt=this.handlers[st]&&this.handlers[st].slice();if(!(!Gt||!Gt.length)){gt.type=st,gt.preventDefault=function(){gt.srcEvent.preventDefault()};for(var ye=0;ye<Gt.length;)Gt[ye](gt),ye++}},destroy:function(){this.element&&mv(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function mv(st,gt){var Gt=st.element;if(Gt.style){var ye;v(st.options.cssProps,function(cr,an){ye=wt(Gt.style,an),gt?(st.oldCssProps[ye]=Gt.style[ye],Gt.style[ye]=cr):Gt.style[ye]=st.oldCssProps[ye]||""}),gt||(st.oldCssProps={})}}function Rl(st,gt){var Gt=r.createEvent("Event");Gt.initEvent(st,!0,!0),Gt.gesture=gt,gt.target.dispatchEvent(Gt)}x(oo,{INPUT_START:Wr,INPUT_MOVE:In,INPUT_END:re,INPUT_CANCEL:nr,STATE_POSSIBLE:Ci,STATE_BEGAN:$n,STATE_CHANGED:go,STATE_ENDED:vi,STATE_RECOGNIZED:ia,STATE_CANCELLED:Bi,STATE_FAILED:Hn,DIRECTION_NONE:zr,DIRECTION_LEFT:Ne,DIRECTION_RIGHT:Vr,DIRECTION_UP:xn,DIRECTION_DOWN:Qn,DIRECTION_HORIZONTAL:gn,DIRECTION_VERTICAL:bn,DIRECTION_ALL:ci,Manager:Ns,Input:la,TouchAction:hi,TouchInput:jt,MouseInput:ph,PointerEventInput:gc,TouchMouseInput:se,SingleTouchInput:nt,Recognizer:si,AttrRecognizer:Fa,Tap:Ia,Pan:af,Swipe:Vo,Pinch:xu,Rotate:gh,Press:Ra,on:k,off:z,each:v,merge:S,extend:w,assign:x,inherit:M,bindFn:R,prefixed:wt});var P0=typeof t<"u"?t:typeof self<"u"?self:{};P0.Hammer=oo,typeof i=="function"&&i.amd?i(function(){return oo}):e.exports?e.exports=oo:t[n]=oo})(window,document,"Hammer")})(yQ);var y3t=yQ.exports;const HE=sa(y3t),_3t={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"};class x3t extends s4{get mapService(){return this.container.mapService}constructor(t){super(),U(this,"indragging",!1),U(this,"hammertime",void 0),U(this,"lastClickTime",0),U(this,"lastClickXY",[-1,-1]),U(this,"clickTimer",void 0),U(this,"$containter",void 0),U(this,"onDrag",r=>{const n=this.interactionEvent(r);n.type=_3t[n.type],n.type==="dragging"?this.indragging=!0:this.indragging=!1,this.emit(kc.Drag,n)}),U(this,"onHammer",r=>{r.srcEvent.stopPropagation();const n=this.interactionEvent(r);this.emit(kc.Hover,n)}),U(this,"onTouch",r=>{const n=r.touches[0];this.onHover({clientX:n.clientX,clientY:n.clientY,type:"touchstart"})}),U(this,"onTouchEnd",r=>{if(r.changedTouches.length>0){const n=r.changedTouches[0];this.onHover({clientX:n.clientX,clientY:n.clientY,type:"touchend"})}}),U(this,"onTouchMove",r=>{const n=r.changedTouches[0];this.onHover({clientX:n.clientX,clientY:n.clientY,type:"touchmove"})}),U(this,"onHover",r=>{const{clientX:n,clientY:i}=r;let a=n,o=i;const s=r.type,l=this.mapService.getMapContainer();if(l){const{top:c,left:f}=l.getBoundingClientRect();a=a-f-l.clientLeft,o=o-c-l.clientTop}const u=this.mapService.containerToLngLat([a,o]);if(s==="click"){this.isDoubleTap(a,o,u);return}if(s==="touch"){this.isDoubleTap(a,o,u);return}s!=="click"&&s!=="dblclick"&&this.emit(kc.Hover,{x:a,y:o,lngLat:u,type:s,target:r})}),this.container=t}init(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}destroy(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(kc.Hover)}triggerHover({x:t,y:r}){this.emit(kc.Hover,{x:t,y:r})}triggerSelect(t){this.emit(kc.Select,{featureId:t})}triggerActive(t){this.emit(kc.Active,{featureId:t})}addEventListenerOnMap(){const t=this.mapService.getMapContainer();if(t){const r=new HE.Manager(t);r.add(new HE.Tap({event:"dblclick",taps:2})),r.add(new HE.Tap({event:"click"})),r.add(new HE.Pan({threshold:0,pointers:0})),r.add(new HE.Press({})),r.on("dblclick click",this.onHammer),r.on("panstart panmove panend pancancel",this.onDrag),t.addEventListener("touchstart",this.onTouch),t.addEventListener("touchend",this.onTouchEnd),t.addEventListener("mousemove",this.onHover),t.addEventListener("touchmove",this.onTouchMove),t.addEventListener("mousedown",this.onHover,!0),t.addEventListener("mouseup",this.onHover),t.addEventListener("contextmenu",this.onHover),this.hammertime=r}}removeEventListenerOnMap(){const t=this.mapService.getMapContainer();t&&(t.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),t.removeEventListener("touchstart",this.onTouch),t.removeEventListener("touchend",this.onTouchEnd),t.removeEventListener("mousedown",this.onHover),t.removeEventListener("mouseup",this.onHover),t.removeEventListener("contextmenu",this.onHover))}interactionEvent(t){const{type:r,pointerType:n}=t;let i,a;n==="touch"?(a=Math.floor(t.pointers[0].clientY),i=Math.floor(t.pointers[0].clientX)):(a=Math.floor(t.srcEvent.y),i=Math.floor(t.srcEvent.x));const o=this.mapService.getMapContainer();if(o){const{top:l,left:u}=o.getBoundingClientRect();i-=u,a-=l}const s=this.mapService.containerToLngLat([i,a]);return{x:i,y:a,lngLat:s,type:r,target:t.srcEvent}}isDoubleTap(t,r,n){const i=new Date().getTime();let a="click";i-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-t)<10&&Math.abs(this.lastClickXY[1]-r)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),a="dblclick",this.emit(kc.Hover,{x:t,y:r,lngLat:n,type:a})):(this.lastClickTime=i,this.lastClickXY=[t,r],this.clickTimer=setTimeout(()=>{a="click",this.emit(kc.Hover,{x:t,y:r,lngLat:n,type:a})},400))}}let b3t=0;function E3t(e){let t=e;if(typeof e=="string"&&(t=document.getElementById(e)),t){const r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id=`l7-scene-${b3t++}`,r.classList.add("l7-scene"),t.appendChild(r),r}return null}function w3t(e){var t;let r=!0;if((e==null||(t=e.target)===null||t===void 0?void 0:t.target)instanceof HTMLElement){var n;let a=e==null||(n=e.target)===null||n===void 0?void 0:n.target;for(;a;){var i;const o=Array.from(a.classList);if(o.includes("l7-marker")||o.includes("l7-popup")){r=!1;break}a=(i=a)===null||i===void 0?void 0:i.parentElement}}return r}let r_=function(e){return e[e.SAMPLED=0]="SAMPLED",e[e.RENDER_TARGET=1]="RENDER_TARGET",e}({});class C3t{constructor(t){var r=this;U(this,"pickedColors",void 0),U(this,"pickedTileLayers",[]),U(this,"pickingFBO",void 0),U(this,"width",0),U(this,"height",0),U(this,"alreadyInPicking",!1),U(this,"pickBufferScale",1),U(this,"pickFromPickingFBO",function(){var n=Oe(function*(i,{x:a,y:o,lngLat:s,type:l,target:u}){var c;let f=!1;const{readPixels:d,readPixelsAsync:v,getViewportSize:g,queryVerdorInfo:x}=r.rendererService,{width:w,height:S}=g(),{enableHighlight:M,enableSelect:R}=i.getLayerConfig(),I=a*Nc,P=o*Nc;if(I>w-1*Nc||I<0||P>S-1*Nc||P<0)return!1;let k;if(x()==="WebGPU"?k=yield v({x:Math.floor(I/r.pickBufferScale),y:Math.floor((S-(o+1)*Nc)/r.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:r.pickingFBO}):k=d({x:Math.floor(I/r.pickBufferScale),y:Math.floor((S-(o+1)*Nc)/r.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:r.pickingFBO}),r.pickedColors=k,k[0]!==0||k[1]!==0||k[2]!==0){const G=Uy(k),J=i.layerPickService.getFeatureById(G);G!==i.getCurrentPickId()&&l==="mousemove"&&(l="mouseenter");const Z={x:a,y:o,type:l,lngLat:s,featureId:G,feature:J,target:u};J&&(f=!0,i.setCurrentPickId(G),r.triggerHoverOnLayer(i,Z))}else{const G={x:a,y:o,lngLat:s,type:i.getCurrentPickId()!==null&&l==="mousemove"?"mouseout":"un"+l,featureId:null,target:u,feature:null};r.triggerHoverOnLayer(i,Ce(Ce({},G),{},{type:"unpick"})),r.triggerHoverOnLayer(i,G),i.setCurrentPickId(null)}if(M&&i.layerPickService.highlightPickedFeature(k),R&&l==="click"&&((c=k)===null||c===void 0?void 0:c.toString())!==[0,0,0,0].toString()){const G=Uy(k);i.getCurrentSelectedId()===null||G!==i.getCurrentSelectedId()?(i.layerPickService.selectFeature(k),i.setCurrentSelectedId(G)):(i.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),i.setCurrentSelectedId(null))}return f});return function(i,a){return n.apply(this,arguments)}}()),this.container=t}get mapService(){return this.container.mapService}get rendererService(){return this.container.rendererService}get configService(){return this.container.globalConfigService}get interactionService(){return this.container.interactionService}get layerService(){return this.container.layerService}init(t){const{createTexture2D:r,createFramebuffer:n,getViewportSize:i}=this.rendererService;let{width:a,height:o}=i();this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,a=Math.round(a/this.pickBufferScale),o=Math.round(o/this.pickBufferScale);const s=r({width:a,height:o,usage:r_.RENDER_TARGET,label:"Picking Texture"});this.pickingFBO=n({color:s,depth:!0,width:a,height:o}),this.interactionService.on(kc.Hover,this.pickingAllLayer.bind(this))}boxPickLayer(t,r,n){var i=this;return Oe(function*(){const{useFramebufferAsync:a,clear:o}=i.rendererService;i.resizePickingFBO(),t.hooks.beforePickingEncode.call(),yield a(i.pickingFBO,Oe(function*(){o({framebuffer:i.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),t.renderModels({ispick:!0})})),t.hooks.afterPickingEncode.call();const s=yield i.pickBox(t,r);n(s)})()}pickBox(t,r){var n=this;return Oe(function*(){const[i,a,o,s]=r.map(S=>{const M=S<0?0:S;return Math.floor(M*Nc/n.pickBufferScale)}),{readPixelsAsync:l,getViewportSize:u}=n.rendererService,{width:c,height:f}=u();if(i>(c-1)*Nc/n.pickBufferScale||o<0||a>(f-1)*Nc/n.pickBufferScale||s<0)return[];const d=Math.min(c/n.pickBufferScale,o)-i,v=Math.min(f/n.pickBufferScale,s)-a,g=yield l({x:i,y:Math.floor(f/n.pickBufferScale-(s+1)),width:d,height:v,data:new Uint8Array(d*v*4),framebuffer:n.pickingFBO}),x=[],w={};for(let S=0;S<g.length/4;S=S+1){const M=g.slice(S*4,S*4+4),R=Uy(M);if(R!==-1&&!w[R]){const I=t.layerPickService.getFeatureById(R);x.push(Ce(Ce({},I),{},{pickedFeatureIdx:R})),w[R]=!0}}return x})()}handleCursor(t,r){const{cursor:n="",cursorEnabled:i}=t.getLayerConfig();if(i){const o=this.mapService.getType()==="amap"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),s=o==null?void 0:o.style.getPropertyValue("cursor");r==="unmousemove"&&s!==""?o==null||o.style.setProperty("cursor",""):r==="mousemove"&&(o==null||o.style.setProperty("cursor",n))}}destroy(){this.pickingFBO.destroy(),this.pickingFBO=null}pickingAllLayer(t){var r=this;return Oe(function*(){!r.layerService.needPick(t.type)||!r.isPickingAllLayer()||(r.alreadyInPicking=!0,yield r.pickingLayers(t),r.layerService.renderLayers(),r.alreadyInPicking=!1)})()}isPickingAllLayer(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}resizePickingFBO(){const{getViewportSize:t}=this.rendererService,{width:r,height:n}=t();(this.width!==r||this.height!==n)&&(this.pickingFBO.resize({width:Math.round(r/this.pickBufferScale),height:Math.round(n/this.pickBufferScale)}),this.width=r,this.height=n)}pickingLayers(t){var r=this;return Oe(function*(){const{clear:n,useFramebufferAsync:i}=r.rendererService;r.resizePickingFBO();const a=r.layerService.getRenderList();for(const o of a.filter(s=>s.needPick(t.type)).reverse()){yield i(r.pickingFBO,Oe(function*(){n({framebuffer:r.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),o.layerPickService.pickRender(t)}));const s=yield r.pickFromPickingFBO(o,t);if(r.layerService.pickedLayerId=s?+o.id:-1,s&&!o.getLayerConfig().enablePropagation)break}})()}triggerHoverOnLayer(t,r){w3t(r)&&(this.handleCursor(t,r.type),t.emit(r.type,r))}}class S3t{constructor(t=!0){U(this,"autoStart",void 0),U(this,"startTime",0),U(this,"oldTime",0),U(this,"running",!1),U(this,"elapsedTime",0),this.autoStart=t}start(){this.startTime=(typeof performance>"u"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const r=(typeof performance>"u"?Date:performance).now();t=(r-this.oldTime)/1e3,this.oldTime=r,this.elapsedTime+=t}return t}}const{throttle:YU}=as;class T3t extends Gu.EventEmitter{get renderService(){return this.container.rendererService}get mapService(){return this.container.mapService}get debugService(){return this.container.debugService}constructor(t){super(),U(this,"pickedLayerId",-1),U(this,"clock",new S3t),U(this,"alreadyInRendering",!1),U(this,"layers",[]),U(this,"layerList",[]),U(this,"layerRenderID",void 0),U(this,"sceneInited",!1),U(this,"animateInstanceCount",0),U(this,"shaderPicking",!0),U(this,"enableRender",!0),U(this,"reRender",YU(()=>{this.renderLayers()},32)),U(this,"throttleRenderLayers",YU(()=>{this.renderLayers()},16)),this.container=t}needPick(t){return this.updateLayerRenderList(),this.layerList.some(r=>r.needPick(t))}add(t){this.layers.push(t),this.sceneInited&&t.init().then(()=>{this.renderLayers()})}addMask(t){this.sceneInited&&t.init().then(()=>{this.renderLayers()})}initLayers(){var t=this;return Oe(function*(){t.sceneInited=!0,t.layers.forEach(function(){var r=Oe(function*(n){n.startInit||(yield n.init(),t.updateLayerRenderList())});return function(n){return r.apply(this,arguments)}}())})()}getSceneInited(){return this.sceneInited}getRenderList(){return this.layerList}getLayers(){return this.layers}getLayer(t){return this.layers.find(r=>r.id===t)}getLayerByName(t){return this.layers.find(r=>r.name===t)}remove(t,r){var n=this;return Oe(function*(){if(r){r.layerChildren||(r.layerChildren=[]);const i=r.layerChildren.findIndex(a=>a.id===t.id);i>-1&&r.layerChildren.splice(i,1)}else{const i=n.layers.findIndex(a=>a.id===t.id);i>-1&&n.layers.splice(i,1)}t.destroy(),n.reRender(),n.emit("layerChange",n.layers)})()}removeAllLayers(){var t=this;return Oe(function*(){t.destroy(),t.reRender()})()}setEnableRender(t){this.enableRender=t}renderLayers(){var t=this;return Oe(function*(){if(t.alreadyInRendering||!t.enableRender)return;t.updateLayerRenderList();const r=t.debugService.generateRenderUid();t.debugService.renderStart(r),t.alreadyInRendering=!0,t.clear();for(const n of t.layerList)n.prerender();t.renderService.beginFrame();for(const n of t.layerList){const{enableMask:i}=n.getLayerConfig();n.masks.filter(a=>a.inited).length>0&&i&&t.renderMask(n.masks),n.getLayerConfig().enableMultiPassRenderer?yield n.renderMultiPass():n.render()}t.renderService.endFrame(),t.debugService.renderEnd(r),t.alreadyInRendering=!1})()}renderMask(t){let r=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});const n=t.length>1?Ry.MULTIPLE:Ry.SINGLE;for(const i of t)i.render({isStencil:!0,stencilType:n,stencilIndex:r++})}beforeRenderData(t){var r=this;return Oe(function*(){(yield t.hooks.beforeRenderData.promise())&&r.renderLayers()})()}renderTileLayerMask(t){let r=0;const{enableMask:n=!0}=t.getLayerConfig();let i=t.tileMask?1:0;const a=t.masks.filter(s=>s.inited);i=i+(n?a.length:1);const o=i>1?Ry.MULTIPLE:Ry.SINGLE;if((t.tileMask||a.length&&n)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),a.length&&n)for(const s of a)s.render({isStencil:!0,stencilType:o,stencilIndex:r++});t.tileMask&&t.tileMask.render({isStencil:!0,stencilType:o,stencilIndex:r++,stencilOperation:HI.OR})}renderTileLayer(t){var r=this;return Oe(function*(){r.renderTileLayerMask(t),t.getLayerConfig().enableMultiPassRenderer?yield t.renderMultiPass():yield t.render()})()}updateLayerRenderList(){this.layerList=[],this.layers.filter(t=>t.inited).filter(t=>t.isVisible()).sort((t,r)=>t.zIndex-r.zIndex).forEach(t=>{this.layerList.push(t)})}destroy(){this.layers.forEach(t=>{t.destroy()}),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}startAnimate(){this.animateInstanceCount++===0&&(this.clock.start(),this.runRender())}stopAnimate(){--this.animateInstanceCount===0&&(this.stopRender(),this.clock.stop())}getOESTextureFloat(){return this.renderService.extensionObject.OES_texture_float}enableShaderPick(){this.shaderPicking=!0}disableShaderPick(){this.shaderPicking=!1}getShaderPickStat(){return this.shaderPicking}clear(){const t=eo(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}runRender(){this.renderLayers(),this.layerRenderID=window.requestAnimationFrame(this.runRender.bind(this))}stopRender(){window.cancelAnimationFrame(this.layerRenderID)}}function A3t(e,t){if(e==null)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(t.indexOf(n)!==-1)continue;r[n]=e[n]}return r}function Gh(e,t){if(e==null)return{};var r,n,i=A3t(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}const{isNil:M3t}=as;class R3t{constructor(t){U(this,"name",void 0),U(this,"type",void 0),U(this,"scale",void 0),U(this,"descriptor",void 0),U(this,"featureBufferLayout",[]),U(this,"needRescale",!1),U(this,"needRemapping",!1),U(this,"needRegenerateVertices",!1),U(this,"featureRange",{startIndex:0,endIndex:1/0}),U(this,"vertexAttribute",void 0),U(this,"defaultCallback",r=>{if(r.length===0){var n;return((n=this.scale)===null||n===void 0?void 0:n.defaultValues)||[]}return r.map((i,a)=>{var o;return((o=this.scale)===null||o===void 0?void 0:o.scalers[a].func)(i)})}),this.setProps(t)}setProps(t){Object.assign(this,t)}mapping(t){var r;if((r=this.scale)!==null&&r!==void 0&&r.callback){var n;const i=(n=this.scale)===null||n===void 0?void 0:n.callback(...t);if(!M3t(i))return[i]}return this.defaultCallback(t)}resetDescriptor(){this.descriptor&&(this.descriptor.buffer.data=[])}}const I3t=["buffer","update","name"],L3t=["buffer","update","name"],O3t={[K.FLOAT]:4,[K.UNSIGNED_BYTE]:1,[K.UNSIGNED_SHORT]:2};class P3t{constructor(t){U(this,"attributesAndIndices",void 0),U(this,"attributes",[]),U(this,"triangulation",void 0),U(this,"featureLayout",{sizePerElement:0,elements:[]}),this.rendererService=t}registerStyleAttribute(t){let r=this.getLayerStyleAttribute(t.name||"");return r?r.setProps(t):(r=new R3t(t),this.attributes.push(r)),r}unRegisterStyleAttribute(t){const r=this.attributes.findIndex(n=>n.name===t);r>-1&&this.attributes.splice(r,1)}updateScaleAttribute(t){this.attributes.forEach(r=>{var n;const i=r.name,a=(n=r.scale)===null||n===void 0?void 0:n.field;(t[i]||a&&t[a])&&(r.needRescale=!0,r.needRemapping=!0,r.needRegenerateVertices=!0)})}updateStyleAttribute(t,r,n){let i=this.getLayerStyleAttribute(t);i||(i=this.registerStyleAttribute(Ce(Ce({},r),{},{name:t})));const{scale:a}=r;a&&i&&(i.scale=a,i.needRescale=!0,i.needRemapping=!0,i.needRegenerateVertices=!0,n&&n.featureRange&&(i.featureRange=n.featureRange))}getLayerStyleAttributes(){return this.attributes}getLayerStyleAttribute(t){return this.attributes.find(r=>r.name===t)}getLayerAttributeScale(t){var r;const n=this.getLayerStyleAttribute(t),i=n==null||(r=n.scale)===null||r===void 0?void 0:r.scalers;return i&&i[0]?i[0].func:null}updateAttributeByFeatureRange(t,r,n=0,i,a){const o=this.attributes.find(s=>s.name===t);if(o&&o.descriptor){const{descriptor:s}=o,{update:l,buffer:u,size:c=0}=s,f=O3t[u.type||K.FLOAT];if(l){const{elements:d,sizePerElement:v}=this.featureLayout,g=d.slice(n,i);if(!g.length)return;const{offset:x}=g[0],w=x*c*f,S=g.map(({featureIdx:M,vertices:R,normals:I},P)=>{const k=R.length/v,z=[];for(let G=0;G<k;G++){const J=I?I.slice(G*3,G*3+3):[];z.push(...l(r[M],M,R.slice(G*v,G*v+v),P,J))}return z}).flat();o.vertexAttribute.updateBuffer({data:S,offset:w}),a==null||a.emit(`legend:${t}`,a.getLegend(t))}}}createAttributesAndIndices(t,r,n,i){this.featureLayout={sizePerElement:0,elements:[]},r&&(this.triangulation=r);const a=this.attributes.map(x=>(x.resetDescriptor(),x.descriptor));let o=0,s=0;const l=[];let u=3;t.forEach((x,w)=>{const{indices:S,vertices:M,normals:R,size:I,indexes:P,count:k}=this.triangulation(x,n);typeof k=="number"&&(s+=k),S.forEach(G=>{l.push(G+o)}),u=I;const z=M.length/I;this.featureLayout.sizePerElement=u,this.featureLayout.elements.push({featureIdx:w,vertices:M,normals:R,offset:o}),o+=z;for(let G=0;G<z;G++){const J=(R==null?void 0:R.slice(G*3,G*3+3))||[],Z=M.slice(G*I,G*I+I);let X=0;P&&P[G]!==void 0&&(X=P[G]),a.forEach((et,at)=>{et&&et.update&&et.buffer.data.push(...et.update(x,w,Z,G,J,X))})}});const{createAttribute:c,createBuffer:f,createElements:d}=this.rendererService,v={};a.forEach((x,w)=>{if(x){const{buffer:S,update:M,name:R}=x,I=Gh(x,I3t),P=c(Ce({buffer:f(S)},I));v[x.name||""]=P,this.attributes[w].vertexAttribute=P}});const g=d({data:l,type:K.UNSIGNED_INT,count:l.length});return this.attributesAndIndices={attributes:v,elements:g,count:s},Object.values(this.attributes).filter(x=>x.scale).forEach(x=>{const w=x.name;i==null||i.emit(`legend:${w}`,i.getLegend(w))}),this.attributesAndIndices}createAttributes(t,r){this.featureLayout={sizePerElement:0,elements:[]},r&&(this.triangulation=r);const n=this.attributes.map(u=>(u.resetDescriptor(),u.descriptor));let i=0,a=3;t.forEach((u,c)=>{const{indices:f,vertices:d,normals:v,size:g,indexes:x}=this.triangulation(u);f.forEach(S=>{}),a=g;const w=d.length/g;this.featureLayout.sizePerElement=a,this.featureLayout.elements.push({featureIdx:c,vertices:d,normals:v,offset:i}),i+=w;for(let S=0;S<w;S++){const M=(v==null?void 0:v.slice(S*3,S*3+3))||[],R=d.slice(S*g,S*g+g);let I=0;x&&x[S]!==void 0&&(I=x[S]),n.forEach((P,k)=>{P&&P.update&&P.buffer.data.push(...P.update(u,c,R,S,M,I))})}});const{createAttribute:o,createBuffer:s}=this.rendererService,l={};return n.forEach((u,c)=>{if(u){const{buffer:f,update:d,name:v}=u,g=Gh(u,L3t),x=o(Ce({buffer:s(f)},g));l[u.name||""]=x,this.attributes[c].vertexAttribute=x}}),{attributes:l}}clearAllAttributes(){var t;this.attributes.forEach(r=>{r.vertexAttribute&&r.vertexAttribute.destroy()}),(t=this.attributesAndIndices)===null||t===void 0||t.elements.destroy(),this.attributes=[]}}function _Q(e,t,r,n){function i(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function s(c){try{u(n.next(c))}catch(f){o(f)}}function l(c){try{u(n.throw(c))}catch(f){o(f)}}function u(c){c.done?a(c.value):i(c.value).then(s,l)}u((n=n.apply(e,t||[])).next())})}function xQ(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(u){return function(c){return l([u,c])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=u[0]&2?i.return:u[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,u[1])).done)return a;switch(i=0,a&&(u=[u[0]&2,a.value]),u[0]){case 0:case 1:a=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!a||u[1]>a[0]&&u[1]<a[3])){r.label=u[1];break}if(u[0]===6&&r.label<a[1]){r.label=a[1],a=u;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(u);break}a[2]&&r.ops.pop(),r.trys.pop();continue}u=t.call(e,r)}catch(c){u=[6,c],i=0}finally{n=a=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function f4(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,a=[],o;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)a.push(i.value)}catch(s){o={error:s}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return a}function d4(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,a;n<i;n++)(a||!(n in t))&&(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))}function bQ(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var OD={exports:{}},jM={exports:{}},CC={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1===0}e.exports=t.default})(CC,CC.exports);var qc={},PD={exports:{}},DD={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(r){return function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];var a=n.pop();return r.call(this,n,a)}},e.exports=t.default})(DD,DD.exports);var y0={};Object.defineProperty(y0,"__esModule",{value:!0});y0.fallback=EQ;y0.wrap=wQ;var D3t=y0.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,F3t=y0.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,B3t=y0.hasNextTick=typeof process=="object"&&typeof process.nextTick=="function";function EQ(e){setTimeout(e,0)}function wQ(e){return function(t){for(var r=[],n=arguments.length-1;n-- >0;)r[n]=arguments[n+1];return e(function(){return t.apply(void 0,r)})}}var Sw;D3t?Sw=queueMicrotask:F3t?Sw=setImmediate:B3t?Sw=process.nextTick:Sw=EQ;y0.default=wQ(Sw);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=l;var r=DD.exports,n=s(r),i=y0,a=s(i),o=qc;function s(f){return f&&f.__esModule?f:{default:f}}function l(f){return(0,o.isAsync)(f)?function(){for(var d=[],v=arguments.length;v--;)d[v]=arguments[v];var g=d.pop(),x=f.apply(this,d);return u(x,g)}:(0,n.default)(function(d,v){var g;try{g=f.apply(this,d)}catch(x){return v(x)}if(g&&typeof g.then=="function")return u(g,v);v(null,g)})}function u(f,d){return f.then(function(v){c(d,null,v)},function(v){c(d,v&&v.message?v:new Error(v))})}function c(f,d,v){try{f(d,v)}catch(g){(0,a.default)(function(x){throw x},g)}}e.exports=t.default})(PD,PD.exports);Object.defineProperty(qc,"__esModule",{value:!0});qc.isAsyncIterable=qc.isAsyncGenerator=qc.isAsync=void 0;var N3t=PD.exports,k3t=z3t(N3t);function z3t(e){return e&&e.__esModule?e:{default:e}}function CQ(e){return e[Symbol.toStringTag]==="AsyncFunction"}function U3t(e){return e[Symbol.toStringTag]==="AsyncGenerator"}function $3t(e){return typeof e[Symbol.asyncIterator]=="function"}function H3t(e){if(typeof e!="function")throw new Error("expected a function");return CQ(e)?(0,k3t.default)(e):e}qc.default=H3t;qc.isAsync=CQ;qc.isAsyncGenerator=U3t;qc.isAsyncIterable=$3t;var n_={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(n,i){if(i===void 0&&(i=n.length),!i)throw new Error("arity is undefined");function a(){for(var o=this,s=[],l=arguments.length;l--;)s[l]=arguments[l];return typeof s[i-1]=="function"?n.apply(this,s):new Promise(function(u,c){s[i-1]=function(f){for(var d=[],v=arguments.length-1;v-- >0;)d[v]=arguments[v+1];if(f)return c(f);u(d.length>1?d:d[0])},n.apply(o,s)})}return a}e.exports=t.default})(n_,n_.exports);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=CC.exports,n=l(r),i=qc,a=l(i),o=n_.exports,s=l(o);function l(u){return u&&u.__esModule?u:{default:u}}t.default=(0,s.default)(function(u,c,f){var d=(0,n.default)(c)?[]:{};u(c,function(v,g,x){(0,a.default)(v)(function(w){for(var S,M=[],R=arguments.length-1;R-- >0;)M[R]=arguments[R+1];M.length<2&&(S=M,M=S[0]),d[g]=M,x(w)})},function(v){return f(v,d)})},3),e.exports=t.default})(jM,jM.exports);var FD={exports:{}},YM={exports:{}},BD={exports:{}},SC={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(n){function i(){for(var a=[],o=arguments.length;o--;)a[o]=arguments[o];if(n!==null){var s=n;n=null,s.apply(this,a)}}return Object.assign(i,n),i}e.exports=t.default})(SC,SC.exports);var ND={exports:{}},kD={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=t.default})(kD,kD.exports);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=c;var r=CC.exports,n=o(r),i=kD.exports,a=o(i);function o(f){return f&&f.__esModule?f:{default:f}}function s(f){var d=-1,v=f.length;return function(){return++d<v?{value:f[d],key:d}:null}}function l(f){var d=-1;return function(){var g=f.next();return g.done?null:(d++,{value:g.value,key:d})}}function u(f){var d=f?Object.keys(f):[],v=-1,g=d.length;return function x(){var w=d[++v];return w==="__proto__"?x():v<g?{value:f[w],key:w}:null}}function c(f){if((0,n.default)(f))return s(f);var d=(0,a.default)(f);return d?l(d):u(f)}e.exports=t.default})(ND,ND.exports);var TC={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(n){return function(){for(var i=[],a=arguments.length;a--;)i[a]=arguments[a];if(n===null)throw new Error("Callback was already called.");var o=n;n=null,o.apply(this,i)}}e.exports=t.default})(TC,TC.exports);var zD={exports:{}},AC={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r={};t.default=r,e.exports=t.default})(AC,AC.exports);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=a;var r=AC.exports,n=i(r);function i(o){return o&&o.__esModule?o:{default:o}}function a(o,s,l,u){var c=!1,f=!1,d=!1,v=0,g=0;function x(){v>=s||d||c||(d=!0,o.next().then(function(M){var R=M.value,I=M.done;if(!(f||c)){if(d=!1,I){c=!0,v<=0&&u(null);return}v++,l(R,g,w),g++,x()}}).catch(S))}function w(M,R){if(v-=1,!f){if(M)return S(M);if(M===!1){c=!0,f=!0;return}if(R===n.default||c&&v<=0)return c=!0,u(null);x()}}function S(M){f||(d=!1,c=!0,u(M))}x()}e.exports=t.default})(zD,zD.exports);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=SC.exports,n=v(r),i=ND.exports,a=v(i),o=TC.exports,s=v(o),l=qc,u=zD.exports,c=v(u),f=AC.exports,d=v(f);function v(g){return g&&g.__esModule?g:{default:g}}t.default=function(g){return function(x,w,S){if(S=(0,n.default)(S),g<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!x)return S(null);if((0,l.isAsyncGenerator)(x))return(0,c.default)(x,g,w,S);if((0,l.isAsyncIterable)(x))return(0,c.default)(x[Symbol.asyncIterator](),g,w,S);var M=(0,a.default)(x),R=!1,I=!1,P=0,k=!1;function z(J,Z){if(!I)if(P-=1,J)R=!0,S(J);else if(J===!1)R=!0,I=!0;else{if(Z===d.default||R&&P<=0)return R=!0,S(null);k||G()}}function G(){for(k=!0;P<g&&!R;){var J=M();if(J===null){R=!0,P<=0&&S(null);return}P+=1,w(J.value,J.key,(0,s.default)(z))}k=!1}G()}},e.exports=t.default})(BD,BD.exports);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=BD.exports,n=l(r),i=qc,a=l(i),o=n_.exports,s=l(o);function l(c){return c&&c.__esModule?c:{default:c}}function u(c,f,d,v){return(0,n.default)(f)(c,(0,a.default)(d),v)}t.default=(0,s.default)(u,4),e.exports=t.default})(YM,YM.exports);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=YM.exports,n=o(r),i=n_.exports,a=o(i);function o(l){return l&&l.__esModule?l:{default:l}}function s(l,u,c){return(0,n.default)(l,1,u,c)}t.default=(0,a.default)(s,3),e.exports=t.default})(FD,FD.exports);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var r=jM.exports,n=o(r),i=FD.exports,a=o(i);function o(l){return l&&l.__esModule?l:{default:l}}function s(l,u){return(0,n.default)(a.default,l,u)}e.exports=t.default})(OD,OD.exports);var GI=bQ(OD.exports),Dp=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var t=arguments,r=[],n=0;n<arguments.length;n++)r[n]=t[n];return this.args=r,GI(this.tasks)},e.prototype.tap=function(t,r){var n=this;this.tasks.push(function(i){r.apply(void 0,d4([],f4(n.args),!1)),i(null,t)})},e}(),ZU={exports:{}},UD={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=CC.exports,n=w(r),i=AC.exports,a=w(i),o=YM.exports,s=w(o),l=SC.exports,u=w(l),c=TC.exports,f=w(c),d=qc,v=w(d),g=n_.exports,x=w(g);function w(I){return I&&I.__esModule?I:{default:I}}function S(I,P,k){k=(0,u.default)(k);var z=0,G=0,J=I.length,Z=!1;J===0&&k(null);function X(et,at){et===!1&&(Z=!0),Z!==!0&&(et?k(et):(++G===J||at===a.default)&&k(null))}for(;z<J;z++)P(I[z],z,(0,f.default)(X))}function M(I,P,k){return(0,s.default)(I,1/0,P,k)}function R(I,P,k){var z=(0,n.default)(I)?S:M;return z(I,(0,v.default)(P),k)}t.default=(0,x.default)(R,3),e.exports=t.default})(UD,UD.exports);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var r=UD.exports,n=o(r),i=jM.exports,a=o(i);function o(l){return l&&l.__esModule?l:{default:l}}function s(l,u){return(0,a.default)(n.default,l,u)}e.exports=t.default})(ZU,ZU.exports);var $D={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=SC.exports,n=c(r),i=TC.exports,a=c(i),o=qc,s=c(o),l=n_.exports,u=c(l);function c(d){return d&&d.__esModule?d:{default:d}}function f(d,v){if(v=(0,n.default)(v),!Array.isArray(d))return v(new Error("First argument to waterfall must be an array of functions"));if(!d.length)return v();var g=0;function x(S){var M=(0,s.default)(d[g++]);M.apply(void 0,S.concat([(0,a.default)(w)]))}function w(S){for(var M=[],R=arguments.length-1;R-- >0;)M[R]=arguments[R+1];if(S!==!1){if(S||g===d.length)return v.apply(void 0,[S].concat(M));x(M)}}x([])}t.default=(0,u.default)(f),e.exports=t.default})($D,$D.exports);var V3t=bQ($D.exports),qU=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return GI(this.tasks)},e.prototype.tap=function(t,r){this.tasks.push(function(n){var i=r();n(i,t)})},e}(),G3t=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var t=arguments,r=[],n=0;n<arguments.length;n++)r[n]=t[n];return this.args=r,GI(this.tasks)},e.prototype.tapPromise=function(t,r){var n=this;this.tasks.push(function(i){return _Q(n,void 0,void 0,function(){return xQ(this,function(a){switch(a.label){case 0:return[4,r.apply(void 0,d4([],f4(this.args),!1))];case 1:return a.sent(),i(null,t),[2]}})})})},e}(),W3t=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var t=arguments,r=[],n=0;n<arguments.length;n++)r[n]=t[n];return this.args=r,GI(this.tasks)},e.prototype.tapPromise=function(t,r){var n=this;this.tasks.push(function(i){return _Q(n,void 0,void 0,function(){var a;return xQ(this,function(o){switch(o.label){case 0:return[4,r.apply(void 0,d4([],f4(this.args),!1))];case 1:return a=o.sent(),i(a,t),[2]}})})})},e}(),X3t=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return V3t(this.tasks)},e.prototype.tapPromise=function(t,r){this.tasks.length===0?this.tasks.push(function(n){r().then(function(i){n(null,i)})}):this.tasks.push(function(n,i){r(n).then(function(a){i(null,a)})})},e}(),SQ={exports:{}},j3t=SQ.exports={};j3t.forEach=function(e,t){for(var r=0;r<e.length;r++){var n=t(e[r]);if(n)return n}};var TQ=SQ.exports,Y3t=function(e){var t=e.stateHandler.getState;function r(o){var s=t(o);return s&&!!s.isDetectable}function n(o){t(o).isDetectable=!0}function i(o){return!!t(o).busy}function a(o,s){t(o).busy=!!s}return{isDetectable:r,markAsDetectable:n,isBusy:i,markBusy:a}},Z3t=function(e){var t={};function r(o){var s=e.get(o);return s===void 0?[]:t[s]||[]}function n(o,s){var l=e.get(o);t[l]||(t[l]=[]),t[l].push(s)}function i(o,s){for(var l=r(o),u=0,c=l.length;u<c;++u)if(l[u]===s){l.splice(u,1);break}}function a(o){var s=r(o);s&&(s.length=0)}return{get:r,add:n,removeListener:i,removeAllListeners:a}},q3t=function(){var e=1;function t(){return e++}return{generate:t}},K3t=function(e){var t=e.idGenerator,r=e.stateHandler.getState;function n(a){var o=r(a);return o&&o.id!==void 0?o.id:null}function i(a){var o=r(a);if(!o)throw new Error("setId required the element to have a resize detection state.");var s=t.generate();return o.id=s,s}return{get:n,set:i}},Q3t=function(e){function t(){}var r={log:t,warn:t,error:t};if(!e&&window.console){var n=function(i,a){i[a]=function(){var s=console[a];if(s.apply)s.apply(console,arguments);else for(var l=0;l<arguments.length;l++)s(arguments[l])}};n(r,"log"),n(r,"warn"),n(r,"error")}return r},AQ={exports:{}},MQ=AQ.exports={};MQ.isIE=function(e){function t(){var n=navigator.userAgent.toLowerCase();return n.indexOf("msie")!==-1||n.indexOf("trident")!==-1||n.indexOf(" edge/")!==-1}if(!t())return!1;if(!e)return!0;var r=function(){var n,i=3,a=document.createElement("div"),o=a.getElementsByTagName("i");do a.innerHTML="<!--[if gt IE "+ ++i+"]><i></i><![endif]-->";while(o[0]);return i>4?i:n}();return e===r};MQ.isLegacyOpera=function(){return!!window.opera};var RQ=AQ.exports,IQ={exports:{}},J3t=IQ.exports={};J3t.getOption=tLt;function tLt(e,t,r){var n=e[t];return n==null&&r!==void 0?r:n}var eLt=IQ.exports,KU=eLt,rLt=function(t){t=t||{};var r=t.reporter,n=KU.getOption(t,"async",!0),i=KU.getOption(t,"auto",!0);i&&!n&&(r&&r.warn("Invalid options combination. auto=true and async=false is invalid. Setting async=true."),n=!0);var a=QU(),o,s=!1;function l(g,x){!s&&i&&n&&a.size()===0&&f(),a.add(g,x)}function u(){for(s=!0;a.size();){var g=a;a=QU(),g.process()}s=!1}function c(g){s||(g===void 0&&(g=n),o&&(d(o),o=null),g?f():u())}function f(){o=v(u)}function d(g){var x=clearTimeout;return x(g)}function v(g){var x=function(w){return setTimeout(w,0)};return x(g)}return{add:l,force:c}};function QU(){var e={},t=0,r=0,n=0;function i(s,l){l||(l=s,s=0),s>r?r=s:s<n&&(n=s),e[s]||(e[s]=[]),e[s].push(l),t++}function a(){for(var s=n;s<=r;s++)for(var l=e[s],u=0;u<l.length;u++){var c=l[u];c()}}function o(){return t}return{add:i,process:a,size:o}}var p4="_erd";function nLt(e){return e[p4]={},LQ(e)}function LQ(e){return e[p4]}function iLt(e){delete e[p4]}var aLt={initState:nLt,getState:LQ,cleanState:iLt},VE=RQ,oLt=function(e){e=e||{};var t=e.reporter,r=e.batchProcessor,n=e.stateHandler.getState;if(!t)throw new Error("Missing required dependency: reporter.");function i(u,c){function f(){c(u)}if(VE.isIE(8))n(u).object={proxy:f},u.attachEvent("onresize",f);else{var d=s(u);if(!d)throw new Error("Element is not detectable by this strategy.");d.contentDocument.defaultView.addEventListener("resize",f)}}function a(u){var c=e.important?" !important; ":"; ";return(u.join(c)+c).trim()}function o(u,c,f){f||(f=c,c=u,u=null),u=u||{},u.debug;function d(v,g){var x=a(["display: block","position: absolute","top: 0","left: 0","width: 100%","height: 100%","border: none","padding: 0","margin: 0","opacity: 0","z-index: -1000","pointer-events: none"]),w=!1,S=window.getComputedStyle(v),M=v.offsetWidth,R=v.offsetHeight;n(v).startSize={width:M,height:R};function I(){function P(){if(S.position==="static"){v.style.setProperty("position","relative",u.important?"important":"");var G=function(J,Z,X,et){function at(Tt){return Tt.replace(/[^-\d\.]/g,"")}var wt=X[et];wt!=="auto"&&at(wt)!=="0"&&(J.warn("An element that is positioned static has style."+et+"="+wt+" which is ignored due to the static positioning. The element will need to be positioned relative, so the style."+et+" will be set to 0. Element: ",Z),Z.style.setProperty(et,"0",u.important?"important":""))};G(t,v,S,"top"),G(t,v,S,"right"),G(t,v,S,"bottom"),G(t,v,S,"left")}}function k(){w||P();function G(Z,X){if(!Z.contentDocument){var et=n(Z);et.checkForObjectDocumentTimeoutId&&window.clearTimeout(et.checkForObjectDocumentTimeoutId),et.checkForObjectDocumentTimeoutId=setTimeout(function(){et.checkForObjectDocumentTimeoutId=0,G(Z,X)},100);return}X(Z.contentDocument)}var J=this;G(J,function(X){g(v)})}S.position!==""&&(P(),w=!0);var z=document.createElement("object");z.style.cssText=x,z.tabIndex=-1,z.type="text/html",z.setAttribute("aria-hidden","true"),z.onload=k,VE.isIE()||(z.data="about:blank"),n(v)&&(v.appendChild(z),n(v).object=z,VE.isIE()&&(z.data="about:blank"))}r?r.add(I):I()}VE.isIE(8)?f(c):d(c,f)}function s(u){return n(u).object}function l(u){if(n(u)){var c=s(u);c&&(VE.isIE(8)?u.detachEvent("onresize",c.proxy):u.removeChild(c),n(u).checkForObjectDocumentTimeoutId&&window.clearTimeout(n(u).checkForObjectDocumentTimeoutId),delete n(u).object)}}return{makeDetectable:o,addListener:i,uninstall:l}},sLt=TQ.forEach,lLt=function(e){e=e||{};var t=e.reporter,r=e.batchProcessor,n=e.stateHandler.getState;e.stateHandler.hasState;var i=e.idHandler;if(!r)throw new Error("Missing required dependency: batchProcessor");if(!t)throw new Error("Missing required dependency: reporter.");var a=c(),o="erd_scroll_detection_scrollbar_style",s="erd_scroll_detection_container";function l(I){f(I,o,s)}l(window.document);function u(I){var P=e.important?" !important; ":"; ";return(I.join(P)+P).trim()}function c(){var I=500,P=500,k=document.createElement("div");k.style.cssText=u(["position: absolute","width: "+I*2+"px","height: "+P*2+"px","visibility: hidden","margin: 0","padding: 0"]);var z=document.createElement("div");z.style.cssText=u(["position: absolute","width: "+I+"px","height: "+P+"px","overflow: scroll","visibility: none","top: "+-I*3+"px","left: "+-P*3+"px","visibility: hidden","margin: 0","padding: 0"]),z.appendChild(k),document.body.insertBefore(z,document.body.firstChild);var G=I-z.clientWidth,J=P-z.clientHeight;return document.body.removeChild(z),{width:G,height:J}}function f(I,P,k){function z(X,et){et=et||function(wt){I.head.appendChild(wt)};var at=I.createElement("style");return at.innerHTML=X,at.id=P,et(at),at}if(!I.getElementById(P)){var G=k+"_animation",J=k+"_animation_active",Z=`/* Created by the element-resize-detector library. */
`;Z+="."+k+" > div::-webkit-scrollbar { "+u(["display: none"])+` }

`,Z+="."+J+" { "+u(["-webkit-animation-duration: 0.1s","animation-duration: 0.1s","-webkit-animation-name: "+G,"animation-name: "+G])+` }
`,Z+="@-webkit-keyframes "+G+` { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }
`,Z+="@keyframes "+G+" { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }",z(Z)}}function d(I){I.className+=" "+s+"_animation_active"}function v(I,P,k){if(I.addEventListener)I.addEventListener(P,k);else if(I.attachEvent)I.attachEvent("on"+P,k);else return t.error("[scroll] Don't know how to add event listeners.")}function g(I,P,k){if(I.removeEventListener)I.removeEventListener(P,k);else if(I.detachEvent)I.detachEvent("on"+P,k);else return t.error("[scroll] Don't know how to remove event listeners.")}function x(I){return n(I).container.childNodes[0].childNodes[0].childNodes[0]}function w(I){return n(I).container.childNodes[0].childNodes[0].childNodes[1]}function S(I,P){var k=n(I).listeners;if(!k.push)throw new Error("Cannot add listener to an element that is not detectable.");n(I).listeners.push(P)}function M(I,P,k){k||(k=P,P=I,I=null),I=I||{};function z(){if(I.debug){var re=Array.prototype.slice.call(arguments);if(re.unshift(i.get(P),"Scroll: "),t.log.apply)t.log.apply(null,re);else for(var nr=0;nr<re.length;nr++)t.log(re[nr])}}function G(re){function nr(zr){var Ne=zr.getRootNode&&zr.getRootNode().contains(zr);return zr===zr.ownerDocument.body||zr.ownerDocument.body.contains(zr)||Ne}return!nr(re)||window.getComputedStyle(re)===null}function J(re){var nr=n(re).container.childNodes[0],zr=window.getComputedStyle(nr);return!zr.width||zr.width.indexOf("px")===-1}function Z(){var re=window.getComputedStyle(P),nr={};return nr.position=re.position,nr.width=P.offsetWidth,nr.height=P.offsetHeight,nr.top=re.top,nr.right=re.right,nr.bottom=re.bottom,nr.left=re.left,nr.widthCSS=re.width,nr.heightCSS=re.height,nr}function X(){var re=Z();n(P).startSize={width:re.width,height:re.height},z("Element start size",n(P).startSize)}function et(){n(P).listeners=[]}function at(){if(z("storeStyle invoked."),!n(P)){z("Aborting because element has been uninstalled");return}var re=Z();n(P).style=re}function wt(re,nr,zr){n(re).lastWidth=nr,n(re).lastHeight=zr}function Tt(re){return x(re).childNodes[0]}function vt(){return 2*a.width+1}function zt(){return 2*a.height+1}function oe(re){return re+10+vt()}function Qt(re){return re+10+zt()}function ne(re){return re*2+vt()}function de(re){return re*2+zt()}function De(re,nr,zr){var Ne=x(re),Vr=w(re),xn=oe(nr),Qn=Qt(zr),gn=ne(nr),bn=de(zr);Ne.scrollLeft=xn,Ne.scrollTop=Qn,Vr.scrollLeft=gn,Vr.scrollTop=bn}function Ze(){var re=n(P).container;if(!re){re=document.createElement("div"),re.className=s,re.style.cssText=u(["visibility: hidden","display: inline","width: 0px","height: 0px","z-index: -1","overflow: hidden","margin: 0","padding: 0"]),n(P).container=re,d(re),P.appendChild(re);var nr=function(){n(P).onRendered&&n(P).onRendered()};v(re,"animationstart",nr),n(P).onAnimationStart=nr}return re}function ke(){function re(){var ma=n(P).style;if(ma.position==="static"){P.style.setProperty("position","relative",I.important?"important":"");var us=function(ol,cs,vc,vo){function ju(dh){return dh.replace(/[^-\d\.]/g,"")}var Ml=vc[vo];Ml!=="auto"&&ju(Ml)!=="0"&&(ol.warn("An element that is positioned static has style."+vo+"="+Ml+" which is ignored due to the static positioning. The element will need to be positioned relative, so the style."+vo+" will be set to 0. Element: ",cs),cs.style[vo]=0)};us(t,P,ma,"top"),us(t,P,ma,"right"),us(t,P,ma,"bottom"),us(t,P,ma,"left")}}function nr(ma,us,ol,cs){return ma=ma?ma+"px":"0",us=us?us+"px":"0",ol=ol?ol+"px":"0",cs=cs?cs+"px":"0",["left: "+ma,"top: "+us,"right: "+cs,"bottom: "+ol]}if(z("Injecting elements"),!n(P)){z("Aborting because element has been uninstalled");return}re();var zr=n(P).container;zr||(zr=Ze());var Ne=a.width,Vr=a.height,xn=u(["position: absolute","flex: none","overflow: hidden","z-index: -1","visibility: hidden","width: 100%","height: 100%","left: 0px","top: 0px"]),Qn=u(["position: absolute","flex: none","overflow: hidden","z-index: -1","visibility: hidden"].concat(nr(-(1+Ne),-(1+Vr),-Vr,-Ne))),gn=u(["position: absolute","flex: none","overflow: scroll","z-index: -1","visibility: hidden","width: 100%","height: 100%"]),bn=u(["position: absolute","flex: none","overflow: scroll","z-index: -1","visibility: hidden","width: 100%","height: 100%"]),ci=u(["position: absolute","left: 0","top: 0"]),Mo=u(["position: absolute","width: 200%","height: 200%"]),ra=document.createElement("div"),la=document.createElement("div"),os=document.createElement("div"),Et=document.createElement("div"),ss=document.createElement("div"),_u=document.createElement("div");ra.dir="ltr",ra.style.cssText=xn,ra.className=s,la.className=s,la.style.cssText=Qn,os.style.cssText=gn,Et.style.cssText=ci,ss.style.cssText=bn,_u.style.cssText=Mo,os.appendChild(Et),ss.appendChild(_u),la.appendChild(os),la.appendChild(ss),ra.appendChild(la),zr.appendChild(ra);function ls(){var ma=n(P);ma&&ma.onExpand?ma.onExpand():z("Aborting expand scroll handler: element has been uninstalled")}function Xu(){var ma=n(P);ma&&ma.onShrink?ma.onShrink():z("Aborting shrink scroll handler: element has been uninstalled")}v(os,"scroll",ls),v(ss,"scroll",Xu),n(P).onExpandScroll=ls,n(P).onShrinkScroll=Xu}function Be(){function re(gn,bn,ci){var Mo=Tt(gn),ra=oe(bn),la=Qt(ci);Mo.style.setProperty("width",ra+"px",I.important?"important":""),Mo.style.setProperty("height",la+"px",I.important?"important":"")}function nr(gn){var bn=P.offsetWidth,ci=P.offsetHeight,Mo=bn!==n(P).lastWidth||ci!==n(P).lastHeight;z("Storing current size",bn,ci),wt(P,bn,ci),r.add(0,function(){if(Mo){if(!n(P)){z("Aborting because element has been uninstalled");return}if(!zr()){z("Aborting because element container has not been initialized");return}if(I.debug){var la=P.offsetWidth,os=P.offsetHeight;(la!==bn||os!==ci)&&t.warn(i.get(P),"Scroll: Size changed before updating detector elements.")}re(P,bn,ci)}}),r.add(1,function(){if(!n(P)){z("Aborting because element has been uninstalled");return}if(!zr()){z("Aborting because element container has not been initialized");return}De(P,bn,ci)}),Mo&&gn&&r.add(2,function(){if(!n(P)){z("Aborting because element has been uninstalled");return}if(!zr()){z("Aborting because element container has not been initialized");return}gn()})}function zr(){return!!n(P).container}function Ne(){function gn(){return n(P).lastNotifiedWidth===void 0}z("notifyListenersIfNeeded invoked");var bn=n(P);if(gn()&&bn.lastWidth===bn.startSize.width&&bn.lastHeight===bn.startSize.height)return z("Not notifying: Size is the same as the start size, and there has been no notification yet.");if(bn.lastWidth===bn.lastNotifiedWidth&&bn.lastHeight===bn.lastNotifiedHeight)return z("Not notifying: Size already notified");z("Current size not notified, notifying..."),bn.lastNotifiedWidth=bn.lastWidth,bn.lastNotifiedHeight=bn.lastHeight,sLt(n(P).listeners,function(ci){ci(P)})}function Vr(){if(z("startanimation triggered."),J(P)){z("Ignoring since element is still unrendered...");return}z("Element rendered.");var gn=x(P),bn=w(P);(gn.scrollLeft===0||gn.scrollTop===0||bn.scrollLeft===0||bn.scrollTop===0)&&(z("Scrollbars out of sync. Updating detector elements..."),nr(Ne))}function xn(){if(z("Scroll detected."),J(P)){z("Scroll event fired while unrendered. Ignoring...");return}nr(Ne)}if(z("registerListenersAndPositionElements invoked."),!n(P)){z("Aborting because element has been uninstalled");return}n(P).onRendered=Vr,n(P).onExpand=xn,n(P).onShrink=xn;var Qn=n(P).style;re(P,Qn.width,Qn.height)}function Zr(){if(z("finalizeDomMutation invoked."),!n(P)){z("Aborting because element has been uninstalled");return}var re=n(P).style;wt(P,re.width,re.height),De(P,re.width,re.height)}function Wr(){k(P)}function In(){z("Installing..."),et(),X(),r.add(0,at),r.add(1,ke),r.add(2,Be),r.add(3,Zr),r.add(4,Wr)}z("Making detectable..."),G(P)?(z("Element is detached"),Ze(),z("Waiting until element is attached..."),n(P).onRendered=function(){z("Element is now attached"),In()}):In()}function R(I){var P=n(I);P&&(P.onExpandScroll&&g(x(I),"scroll",P.onExpandScroll),P.onShrinkScroll&&g(w(I),"scroll",P.onShrinkScroll),P.onAnimationStart&&g(P.container,"animationstart",P.onAnimationStart),P.container&&I.removeChild(P.container))}return{makeDetectable:M,addListener:S,uninstall:R,initDocument:l}},Tw=TQ.forEach,uLt=Y3t,cLt=Z3t,hLt=q3t,fLt=K3t,dLt=Q3t,JU=RQ,pLt=rLt,vm=aLt,vLt=oLt,gLt=lLt;function t9(e){return Array.isArray(e)||e.length!==void 0}function e9(e){if(Array.isArray(e))return e;var t=[];return Tw(e,function(r){t.push(r)}),t}function r9(e){return e&&e.nodeType===1}var mLt=function(e){e=e||{};var t;if(e.idHandler)t={get:function(M){return e.idHandler.get(M,!0)},set:e.idHandler.set};else{var r=hLt(),n=fLt({idGenerator:r,stateHandler:vm});t=n}var i=e.reporter;if(!i){var a=i===!1;i=dLt(a)}var o=gm(e,"batchProcessor",pLt({reporter:i})),s={};s.callOnAdd=!!gm(e,"callOnAdd",!0),s.debug=!!gm(e,"debug",!1);var l=cLt(t),u=uLt({stateHandler:vm}),c,f=gm(e,"strategy","object"),d=gm(e,"important",!1),v={reporter:i,batchProcessor:o,stateHandler:vm,idHandler:t,important:d};if(f==="scroll"&&(JU.isLegacyOpera()?(i.warn("Scroll strategy is not supported on legacy Opera. Changing to object strategy."),f="object"):JU.isIE(9)&&(i.warn("Scroll strategy is not supported on IE9. Changing to object strategy."),f="object")),f==="scroll")c=gLt(v);else if(f==="object")c=vLt(v);else throw new Error("Invalid strategy name: "+f);var g={};function x(M,R,I){function P(X){var et=l.get(X);Tw(et,function(wt){wt(X)})}function k(X,et,at){l.add(et,at),X&&at(et)}if(I||(I=R,R=M,M={}),!R)throw new Error("At least one element required.");if(!I)throw new Error("Listener required.");if(r9(R))R=[R];else if(t9(R))R=e9(R);else return i.error("Invalid arguments. Must be a DOM element or a collection of DOM elements.");var z=0,G=gm(M,"callOnAdd",s.callOnAdd),J=gm(M,"onReady",function(){}),Z=gm(M,"debug",s.debug);Tw(R,function(et){vm.getState(et)||(vm.initState(et),t.set(et));var at=t.get(et);if(Z&&i.log("Attaching listener to element",at,et),!u.isDetectable(et)){if(Z&&i.log(at,"Not detectable."),u.isBusy(et)){Z&&i.log(at,"System busy making it detectable"),k(G,et,I),g[at]=g[at]||[],g[at].push(function(){z++,z===R.length&&J()});return}return Z&&i.log(at,"Making detectable..."),u.markBusy(et,!0),c.makeDetectable({debug:Z,important:d},et,function(Tt){if(Z&&i.log(at,"onElementDetectable"),vm.getState(Tt)){u.markAsDetectable(Tt),u.markBusy(Tt,!1),c.addListener(Tt,P),k(G,Tt,I);var vt=vm.getState(Tt);if(vt&&vt.startSize){var zt=Tt.offsetWidth,oe=Tt.offsetHeight;(vt.startSize.width!==zt||vt.startSize.height!==oe)&&P(Tt)}g[at]&&Tw(g[at],function(Qt){Qt()})}else Z&&i.log(at,"Element uninstalled before being detectable.");delete g[at],z++,z===R.length&&J()})}Z&&i.log(at,"Already detecable, adding listener."),k(G,et,I),z++}),z===R.length&&J()}function w(M){if(!M)return i.error("At least one element is required.");if(r9(M))M=[M];else if(t9(M))M=e9(M);else return i.error("Invalid arguments. Must be a DOM element or a collection of DOM elements.");Tw(M,function(R){l.removeAllListeners(R),c.uninstall(R),vm.cleanState(R)})}function S(M){c.initDocument&&c.initDocument(M)}return{listenTo:x,removeListener:l.removeListener,removeAllListeners:l.removeAllListeners,uninstall:w,initDocument:S}};function gm(e,t,r){var n=e[t];return n==null&&r!==void 0?r:n}const yLt=sa(mLt);let _Lt=class extends Gu.EventEmitter{get iconService(){return this.container.iconService}get fontService(){return this.container.fontService}get controlService(){return this.container.controlService}get configService(){return this.container.globalConfigService}get map(){return this.container.mapService}get coordinateSystemService(){return this.container.coordinateSystemService}get rendererService(){return this.container.rendererService}get layerService(){return this.container.layerService}get debugService(){return this.container.debugService}get cameraService(){return this.container.cameraService}get interactionService(){return this.container.interactionService}get pickingService(){return this.container.pickingService}get shaderModuleService(){return this.container.shaderModuleService}get markerService(){return this.container.markerService}get popupService(){return this.container.popupService}constructor(t){super(),U(this,"destroyed",!1),U(this,"loaded",!1),U(this,"id",void 0),U(this,"inited",!1),U(this,"rendering",!1),U(this,"$container",void 0),U(this,"canvas",void 0),U(this,"markerContainer",void 0),U(this,"resizeDetector",void 0),U(this,"hooks",void 0),U(this,"handleWindowResized",()=>{this.emit("resize"),this.$container&&(this.initContainer(),this.coordinateSystemService.needRefresh=!0,this.render())}),U(this,"handleMapCameraChanged",r=>{this.cameraService.update(r),this.render()}),this.container=t,this.hooks={init:new G3t},this.id=t.id}init(t){var r=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",()=>this.render()),this.fontService.init(),this.hooks.init.tapPromise("initMap",Oe(function*(){r.debugService.log("map.mapInitStart",{type:r.map.version}),yield new Promise(n=>{r.map.onCameraChanged(i=>{r.cameraService.init(),r.cameraService.update(i),n()}),r.map.init()}),r.map.onCameraChanged(r.handleMapCameraChanged),r.map.addMarkerContainer(),r.markerService.addMarkers(),r.markerService.addMarkerLayers(),r.popupService.initPopup(),r.interactionService.init(),r.interactionService.on(kc.Drag,r.addSceneEvent.bind(r))})),this.hooks.init.tapPromise("initRenderer",Oe(function*(){var n;const i=((n=r.map)===null||n===void 0?void 0:n.getOverlayContainer())||void 0;if(i?r.$container=i:r.$container=E3t(r.configService.getSceneConfig(r.id).id||""),r.$container){const{canvas:o}=t;if(r.canvas=o||Ua("canvas","",r.$container),r.setCanvas(),yield r.rendererService.init(r.canvas,r.configService.getSceneConfig(r.id),t.gl),r.registerContextLost(),r.initContainer(),r.resizeDetector=yLt({strategy:"scroll"}),r.resizeDetector.listenTo(r.$container,r.handleWindowResized),window.matchMedia){var a;(a=window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||a===void 0||a.addListener(r.handleWindowResized.bind("screen"))}}else console.error("容器 id 不存在");r.pickingService.init(r.id)})),this.render()}registerContextLost(){const t=this.rendererService.getCanvas();t&&t.addEventListener("webglcontextlost",()=>this.emit("webglcontextlost"))}addLayer(t){this.layerService.sceneService=this,this.layerService.add(t)}addMask(t){this.layerService.sceneService=this,this.layerService.addMask(t)}render(){var t=this;return Oe(function*(){t.rendering||t.destroyed||(t.rendering=!0,t.inited?(yield t.layerService.initLayers(),yield t.layerService.renderLayers()):(yield t.hooks.init.promise(),t.destroyed&&t.destroy(),yield t.layerService.initLayers(),t.layerService.renderLayers(),t.controlService.addControls(),t.loaded=!0,t.emit("loaded"),t.inited=!0),t.rendering=!1)})()}addFontFace(t,r){this.fontService.addFontFace(t,r)}getSceneContainer(){return this.$container}exportPng(t){var r=this;return Oe(function*(){var n;const i=(n=r.$container)===null||n===void 0?void 0:n.getElementsByTagName("canvas")[0];return yield r.render(),t==="jpg"?i==null?void 0:i.toDataURL("image/jpeg"):i==null?void 0:i.toDataURL("image/png")})()}getSceneConfig(){return this.configService.getSceneConfig(this.id)}getPointSizeRange(){return this.rendererService.getPointSizeRange()}addMarkerContainer(){const t=this.$container.parentElement;t!==null&&(this.markerContainer=Ua("div","l7-marker-container",t))}getMarkerContainer(){return this.markerContainer}destroy(){var t;if(!this.inited){this.destroyed=!0;return}this.resizeDetector.removeListener(this.$container,this.handleWindowResized),this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout(()=>{var r;(r=this.$container)===null||r===void 0||r.removeChild(this.canvas),this.canvas=null,this.rendererService.destroy()}),(t=this.$container)===null||t===void 0||(t=t.parentNode)===null||t===void 0||t.removeChild(this.$container),this.emit("destroy")}initContainer(){var t,r;const n=Nc,i=((t=this.$container)===null||t===void 0?void 0:t.clientWidth)||400,a=((r=this.$container)===null||r===void 0?void 0:r.clientHeight)||300,o=this.canvas;o&&(o.width=i*n,o.height=a*n),this.rendererService.viewport({x:0,y:0,width:n*i,height:n*a})}setCanvas(){var t,r;const n=Nc,i=((t=this.$container)===null||t===void 0?void 0:t.clientWidth)||400,a=((r=this.$container)===null||r===void 0?void 0:r.clientHeight)||300,o=this.canvas;o.width=i*n,o.height=a*n,o.style.width="100%",o.style.height="100%"}addSceneEvent(t){this.emit(t.type,t)}};const{uniq:xLt}=as,n9="#define PI 3.14159265359",bLt=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,ELt=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,wLt=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}


vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  return weight;
}
`,CLt=`
in vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  float activeType = v_PickingResult.a;
  if(activeType > 0.0) {
    vec4 highLightColor =  activeType > 1.5 ? u_SelectColor : u_HighlightColor;
    highLightColor = highLightColor * COLOR_SCALE;
    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));
    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  }
  else {
    return color;
  }

  
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // 过滤多余的 shader 计算
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // 过滤多余的 shader 计算
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,SLt=`layout(location = ATTRIBUTE_LOCATION_PICKING_COLOR) in vec3 a_PickingColor;
out vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return distance(vertexColor,u_PickingColor.rgb) < 0.01;
}

// 判断当前点是否已经被 select 选中
bool isVertexSelected(vec3 vertexColor) {
  return distance(vertexColor,u_CurrentSelectedId.rgb) < 0.01;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  if(u_PickingStage == PICKING_HIGHLIGHT) {
    if(isVertexPicked(pickingColor)) {
       v_PickingResult = vec4(pickingColor.rgb * COLOR_SCALE,HIGHLIGHT);
       return;
    }
    if(isVertexSelected(pickingColor)) {
     v_PickingResult = vec4(u_CurrentSelectedId.rgb * COLOR_SCALE,SELECT);
      return;
    }

  } else {
      v_PickingResult= vec4(pickingColor.rgb * COLOR_SCALE,NORMAL);
      return;
  }

  // // v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && (isVertexPicked(pickingColor) || isVertexPicked(u_CurrentSelectedId)));

  // // Stores the picking color so that the fragment shader can render it during picking
  // v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,i9=`layout(std140) uniform PickingUniforms {
  vec4 u_HighlightColor;
  vec4 u_SelectColor;
  vec3 u_PickingColor;
  float u_PickingStage;
  vec3 u_CurrentSelectedId;
  float u_PickingThreshold;
  float u_PickingBuffer;
  float u_shaderPick;
  float u_activeMix;
};`,TLt=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // 经纬度 => 平面坐标
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // 平面坐标 => 经纬度
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,a9=`#define TILE_SIZE (512.0)
#define PI (3.1415926536)
#define WORLD_SCALE (TILE_SIZE / (PI * 2.0))
#define EARTH_CIRCUMFERENCE (40.03e6)

#define COORDINATE_SYSTEM_LNGLAT (1.0) // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET (2.0) // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE (3.0)
#define COORDINATE_SYSTEM_IDENTITY (4.0)
#define COORDINATE_SYSTEM_METER_OFFSET (5.0)

#pragma include "scene_uniforms"

const vec2 ZERO_64_XY_LOW = vec2(0.0, 0.0);

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(radians(x) + PI, PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5)));
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}

// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1.0, 1.0);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (
    u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 &&
      u_CoordinateSystem > COORDINATE_SYSTEM_LNGLAT - 0.01 ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}

vec4 project_position(vec4 position, vec2 position64xyLow) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(
      vec4(X + position64xyLow.x, Y + position64xyLow.y, position.z, position.w)
    );
  }
  if (
    u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 &&
    u_CoordinateSystem > COORDINATE_SYSTEM_LNGLAT - 0.01
  ) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  return position;
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_XY_LOW);
}

vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

// 适配纹理贴图的等像素大小
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom) * u_FocalDistance;
  }

  return pixel * 2.0 * u_FocalDistance;
}

// 在不论什么底图下需要统一处理的时候使用
float project_float_pixel(float pixel) {
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // mapbox 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1
    return pixel * pow(2.0, 19.0 - u_Zoom) * u_FocalDistance;
  }

  return pixel * u_FocalDistance;
}

// Project meter into the unit of pixel which used in the camera world space
float project_float_meter(float meter) {
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // Since the zoom level uniform is updated by mapservice and it's alread been subtracted by 1
    // Not sure if we are supposed to do that again
    return meter;
  } else {
    return project_float_pixel(meter);
  }

  // TODO: change the following code to make adaptations for amap
  // return u_FocalDistance * TILE_SIZE * pow(2.0, u_Zoom) * meter / EARTH_CIRCUMFERENCE;

}

float project_pixel(float pixel) {
  return pixel * u_FocalDistance;
}

vec2 project_pixel(vec2 pixel) {
  return pixel * -1.0 * u_FocalDistance;
}

vec3 project_pixel(vec3 pixel) {
  return pixel * -1.0 * u_FocalDistance;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}

bool isEqual(float a, float b) {
  return a < b + 0.001 && a > b - 0.001;
}

`,ALt=`vec2 rotate_matrix(vec2 v, float a) {
    float b = a / 180.0 * 3.1415926535897932384626433832795;
    float s = sin(b);
    float c = cos(b);
    mat2 m = mat2(c, s, -s, c);
    return m * v;
}`,o9=`layout(std140) uniform SceneUniforms {
  mat4 u_ViewMatrix;
  mat4 u_ProjectionMatrix;
  mat4 u_ViewProjectionMatrix;
  mat4 u_ModelMatrix;
  vec4 u_ViewportCenterProjection;
  vec3 u_PixelsPerDegree;
  float u_Zoom;
  vec3 u_PixelsPerDegree2;
  float u_ZoomScale;
  vec3 u_PixelsPerMeter;
  float u_CoordinateSystem;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_ViewportCenter;
  vec2 u_ViewportSize;
  float u_FocalDistance;
};
`,MLt=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,s9=/precision\s+(high|low|medium)p\s+float/,l9=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,RLt=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,ILt=/void\s+main\s*\([^)]*\)\s*\{\n?/;class LLt{constructor(){U(this,"moduleCache",{}),U(this,"rawContentCache",{})}registerBuiltinModules(){this.destroy(),this.registerModule("common",{vs:n9,fs:n9}),this.registerModule("decode",{vs:ELt,fs:""}),this.registerModule("scene_uniforms",{vs:o9,fs:o9}),this.registerModule("picking_uniforms",{vs:i9,fs:i9}),this.registerModule("projection",{vs:a9,fs:a9}),this.registerModule("project",{vs:TLt,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:MLt}),this.registerModule("lighting",{vs:wLt,fs:""}),this.registerModule("light",{vs:bLt,fs:""}),this.registerModule("picking",{vs:SLt,fs:CLt}),this.registerModule("rotation_2d",{vs:ALt,fs:""})}registerModule(t,r){r.vs=r.vs.replace(/\r\n/g,`
`),r.fs=r.fs.replace(/\r\n/g,`
`);const{vs:n,fs:i,uniforms:a,defines:o,inject:s}=r,{content:l,uniforms:u}=AO(n),{content:c,uniforms:f}=AO(i);this.rawContentCache[t]={fs:c,defines:o,inject:s,uniforms:Ce(Ce(Ce({},u),f),a),vs:l}}getModule(t){let r=this.rawContentCache[t].vs,n=this.rawContentCache[t].fs;const{defines:i={},inject:a={}}=this.rawContentCache[t];let o={};a["vs:#decl"]&&(r=a["vs:#decl"]+r,o=AO(a["vs:#decl"]).uniforms),a["vs:#main-start"]&&(r=r.replace(ILt,x=>x+a["vs:#main-start"])),a["fs:#decl"]&&(n=a["fs:#decl"]+n),r=OLt(i)+r;const{content:l,includeList:u}=this.processModule(r,[],"vs"),{content:c,includeList:f}=this.processModule(n,[],"fs"),d=xLt(u.concat(f).concat(t)).reduce((x,w)=>Ce(Ce({},x),this.rawContentCache[w].uniforms),Ce({},o)),v=(s9.test(c)?"":l9)+l,g=(s9.test(c)?"":l9)+c;return this.moduleCache[t]={vs:v.trim(),fs:g.trim(),uniforms:d},this.moduleCache[t]}destroy(){this.moduleCache={},this.rawContentCache={}}processModule(t,r,n){return{content:t.replace(RLt,(a,o)=>{const l=o.split(" ")[0].replace(/"/g,"");if(r.indexOf(l)>-1)return"";const u=this.rawContentCache[l][n];r.push(l);const{content:c}=this.processModule(u,r,n);return c}),includeList:r}}}function OLt(e){return Object.keys(e).reduce((r,n)=>r+`#define ${n.toUpperCase()} ${e[n]}
`,`
`)}class v4{constructor(){U(this,"shaderModuleService",void 0),U(this,"rendererService",void 0),U(this,"cameraService",void 0),U(this,"mapService",void 0),U(this,"interactionService",void 0),U(this,"layerService",void 0),U(this,"config",void 0)}getName(){return""}getType(){return FS.Normal}init(t,r){this.config=r,this.rendererService=t.getContainer().rendererService,this.cameraService=t.getContainer().cameraService,this.mapService=t.getContainer().mapService,this.interactionService=t.getContainer().interactionService,this.layerService=t.getContainer().layerService,this.shaderModuleService=t.getContainer().shaderModuleService}render(t){}}class PLt extends v4{getName(){return"clear"}init(t,r){super.init(t,r)}render(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}class DLt{constructor(t){U(this,"passes",[]),U(this,"layer",void 0),U(this,"renderFlag",void 0),U(this,"width",0),U(this,"height",0),this.postProcessor=t}setLayer(t){this.layer=t}setRenderFlag(t){this.renderFlag=t}getRenderFlag(){return this.renderFlag}getPostProcessor(){return this.postProcessor}render(){var t=this;return Oe(function*(){for(const r of t.passes)yield r.render(t.layer);yield t.postProcessor.render(t.layer)})()}resize(t,r){(this.width!==t||this.height!==r)&&(this.postProcessor.resize(t,r),this.width=t,this.height=r)}add(t,r){t.getType()===FS.PostProcessing?this.postProcessor.add(t,this.layer,r):(t.init(this.layer,r),this.passes.push(t))}insert(t,r,n){t.init(this.layer,r),this.passes.splice(n,0,t)}destroy(){this.passes.length=0}}class FLt extends v4{constructor(...t){var r;super(...t),r=this,U(this,"pickingFBO",void 0),U(this,"layer",void 0),U(this,"width",0),U(this,"height",0),U(this,"alreadyInRendering",!1),U(this,"pickFromPickingFBO",({x:n,y:i,lngLat:a,type:o})=>{if(!this.layer.isVisible()||!this.layer.needPick(o))return;const{getViewportSize:s,readPixelsAsync:l,useFramebuffer:u}=this.rendererService,{width:c,height:f}=s(),{enableHighlight:d,enableSelect:v}=this.layer.getLayerConfig(),g=n*Nc,x=i*Nc;if(g>c||g<0||x>f||x<0)return;let w;u(this.pickingFBO,Oe(function*(){var S;if(w=yield l({x:Math.round(g),y:Math.round(f-(i+1)*Nc),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:r.pickingFBO}),w[0]!==0||w[1]!==0||w[2]!==0){const M=Uy(w),R=r.layer.getSource().getFeatureById(M),I={x:n,y:i,type:o,lngLat:a,featureId:M,feature:R};R&&(r.layer.setCurrentPickId(M),r.triggerHoverOnLayer(I))}else{const M={x:n,y:i,lngLat:a,type:r.layer.getCurrentPickId()===null?"un"+o:"mouseout",featureId:null,feature:null};r.triggerHoverOnLayer(Ce(Ce({},M),{},{type:"unpick"})),r.triggerHoverOnLayer(M),r.layer.setCurrentPickId(null)}d&&r.highlightPickedFeature(w),v&&o==="click"&&((S=w)===null||S===void 0?void 0:S.toString())!==[0,0,0,0].toString()&&r.selectFeature(w)}))})}getType(){return FS.Normal}getName(){return"pixelPicking"}init(t,r){super.init(t,r),this.layer=t;const{createTexture2D:n,createFramebuffer:i,getViewportSize:a}=this.rendererService,{width:o,height:s}=a(),l=n({width:o,height:s,wrapS:K.CLAMP_TO_EDGE,wrapT:K.CLAMP_TO_EDGE,label:"Picking Texture"});this.pickingFBO=i({color:l}),this.interactionService.on(kc.Hover,this.pickFromPickingFBO),this.interactionService.on(kc.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(kc.Active,this.highlightFeatureHandle.bind(this))}render(t){if(this.alreadyInRendering)return;const{getViewportSize:r,useFramebuffer:n,clear:i}=this.rendererService,{width:a,height:o}=r();this.alreadyInRendering=!0,(this.width!==a||this.height!==o)&&(this.pickingFBO.resize({width:a,height:o}),this.width=a,this.height=o),n(this.pickingFBO,()=>{i({framebuffer:this.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});const s=this.layer.multiPassRenderer.getRenderFlag();this.layer.multiPassRenderer.setRenderFlag(!1),t.hooks.beforePickingEncode.call(),t.render(),t.hooks.afterPickingEncode.call(),this.layer.multiPassRenderer.setRenderFlag(s),this.alreadyInRendering=!1})}triggerHoverOnLayer(t){this.layer.emit(t.type,t)}highlightPickedFeature(t){const[r,n,i]=t;this.layer.hooks.beforeHighlight.call([r,n,i]),this.layerService.renderLayers()}selectFeature(t){const[r,n,i]=t;this.layer.hooks.beforeSelect.call([r,n,i]),this.layerService.renderLayers()}selectFeatureHandle({featureId:t}){const r=$x(t);this.selectFeature(new Uint8Array(r))}highlightFeatureHandle({featureId:t}){const r=$x(t);this.highlightPickedFeature(new Uint8Array(r))}}class BLt{constructor(t){U(this,"passes",[]),U(this,"readFBO",void 0),U(this,"writeFBO",void 0),this.rendererService=t,this.init()}getReadFBO(){return this.readFBO}getWriteFBO(){return this.writeFBO}getCurrentFBOTex(){const{getViewportSize:t,createTexture2D:r}=this.rendererService,{width:n,height:i}=t();return r({x:0,y:0,width:n,height:i,copy:!0})}getReadFBOTex(){var t=this;const{useFramebuffer:r}=this.rendererService;return new Promise(n=>{r(this.readFBO,Oe(function*(){n(t.getCurrentFBOTex())}))})}renderBloomPass(t,r){var n=this;return Oe(function*(){const i=yield n.getReadFBOTex();let a=0;for(;a<4;)yield r.render(t,i),n.swap(),a++})()}render(t){var r=this;return Oe(function*(){for(let n=0;n<r.passes.length;n++){const i=r.passes[n];i.setRenderToScreen(r.isLastEnabledPass(n)),i.getName()==="bloom"?yield r.renderBloomPass(t,i):(yield i.render(t),n!==r.passes.length-1&&r.swap())}})()}resize(t,r){this.readFBO.resize({width:t,height:r}),this.writeFBO.resize({width:t,height:r})}add(t,r,n){t.init(r,n),this.passes.push(t)}insert(t,r,n,i){t.init(n,i),this.passes.splice(r,0,t)}getPostProcessingPassByName(t){return this.passes.find(r=>r.getName()===t)}init(){const{createFramebuffer:t,createTexture2D:r}=this.rendererService;this.readFBO=t({color:r({width:1,height:1,wrapS:K.CLAMP_TO_EDGE,wrapT:K.CLAMP_TO_EDGE,usage:r_.RENDER_TARGET})}),this.writeFBO=t({color:r({width:1,height:1,wrapS:K.CLAMP_TO_EDGE,wrapT:K.CLAMP_TO_EDGE,usage:r_.RENDER_TARGET})})}isLastEnabledPass(t){for(let r=t+1;r<this.passes.length;r++)if(this.passes[r].isEnabled())return!1;return!0}swap(){const t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}class NLt extends v4{getType(){return FS.Normal}getName(){return"render"}init(t,r){super.init(t,r)}render(t){const{useFramebuffer:r,clear:n}=this.rendererService,i=t.multiPassRenderer.getPostProcessor().getReadFBO();r(i,()=>{n({color:[0,0,0,0],depth:1,stencil:0,framebuffer:i}),t.multiPassRenderer.setRenderFlag(!1),t.models.forEach(a=>{a.draw({uniforms:t.layerModel.getUninforms()})}),t.multiPassRenderer.setRenderFlag(!0)})}}const kLt=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,zLt=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,{isNil:IO}=as;class ULt extends Mg{setupShaders(){this.shaderModuleService.registerModule("blur-pass",{vs:zLt,fs:kLt});const{vs:t,fs:r,uniforms:n}=this.shaderModuleService.getModule("blur-pass"),{width:i,height:a}=this.rendererService.getViewportSize();return{vs:t,fs:r,uniforms:Ce(Ce({},n),{},{u_ViewportSize:[i,a]})}}convertOptionsToUniforms(t){const r={};return IO(t.bloomRadius)||(r.u_radius=t.bloomRadius),IO(t.bloomIntensity)||(r.u_intensity=t.bloomIntensity),IO(t.bloomBaseRadio)||(r.u_baseRadio=t.bloomBaseRadio),r}}const $Lt=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,HLt=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,{isNil:VLt}=as;class GLt extends Mg{setupShaders(){this.shaderModuleService.registerModule("blur-pass",{vs:HLt,fs:$Lt});const{vs:t,fs:r,uniforms:n}=this.shaderModuleService.getModule("blur-pass"),{width:i,height:a}=this.rendererService.getViewportSize();return{vs:t,fs:r,uniforms:Ce(Ce({},n),{},{u_ViewportSize:[i,a]})}}convertOptionsToUniforms(t){const r={};return VLt(t.blurRadius)||(r.u_BlurDir=[t.blurRadius,0]),r}}const WLt=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,XLt=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,{isNil:jLt}=as;class YLt extends Mg{setupShaders(){this.shaderModuleService.registerModule("blur-pass",{vs:XLt,fs:WLt});const{vs:t,fs:r,uniforms:n}=this.shaderModuleService.getModule("blur-pass"),{width:i,height:a}=this.rendererService.getViewportSize();return{vs:t,fs:r,uniforms:Ce(Ce({},n),{},{u_ViewportSize:[i,a]})}}convertOptionsToUniforms(t){const r={};return jLt(t.blurRadius)||(r.u_BlurDir=[0,t.blurRadius]),r}}const ZLt=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,qLt=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class KLt extends Mg{setupShaders(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:qLt,fs:ZLt});const{vs:t,fs:r,uniforms:n}=this.shaderModuleService.getModule("colorhalftone-pass"),{width:i,height:a}=this.rendererService.getViewportSize();return{vs:t,fs:r,uniforms:Ce(Ce({},n),{},{u_ViewportSize:[i,a]})}}}const QLt=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,JLt=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class tOt extends Mg{setupShaders(){return this.shaderModuleService.registerModule("copy-pass",{vs:JLt,fs:QLt}),this.shaderModuleService.getModule("copy-pass")}}const eOt=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,rOt=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class nOt extends Mg{setupShaders(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:rOt,fs:eOt});const{vs:t,fs:r,uniforms:n}=this.shaderModuleService.getModule("hexagonalpixelate-pass"),{width:i,height:a}=this.rendererService.getViewportSize();return{vs:t,fs:r,uniforms:Ce(Ce({},n),{},{u_ViewportSize:[i,a]})}}}const iOt=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,aOt=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class oOt extends Mg{setupShaders(){this.shaderModuleService.registerModule("ink-pass",{vs:aOt,fs:iOt});const{vs:t,fs:r,uniforms:n}=this.shaderModuleService.getModule("ink-pass"),{width:i,height:a}=this.rendererService.getViewportSize();return{vs:t,fs:r,uniforms:Ce(Ce({},n),{},{u_ViewportSize:[i,a]})}}}const sOt=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,lOt=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class uOt extends Mg{setupShaders(){return this.shaderModuleService.registerModule("noise-pass",{vs:lOt,fs:sOt}),this.shaderModuleService.getModule("noise-pass")}}const cOt=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,hOt=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`;class fOt extends Mg{setupShaders(){return this.shaderModuleService.registerModule("sepia-pass",{vs:cOt,fs:hOt}),this.shaderModuleService.getModule("sepia-pass")}}const OQ=new d3t;let dOt=0;function pOt(){const e=new LLt,t=new m3t,r=new i3t,n=new g3t(r),i=new BIt,a=new kIt,o=new s3t,s=new l3t,l=new o3t,u={id:`${dOt++}`,globalConfigService:OQ,shaderModuleService:e,debugService:t,cameraService:r,coordinateSystemService:n,fontService:i,iconService:a,markerService:o,popupService:s,controlService:l,customRenderService:{}},c=new T3t(u);u.layerService=c;const f=new _Lt(u);u.sceneService=f;const d=new x3t(u);u.interactionService=d;const v=new C3t(u);u.pickingService=v;const g={clear:new PLt,pixelPicking:new FLt,render:new NLt};u.normalPassFactory=w=>g[w];const x={copy:new tOt,bloom:new ULt,blurH:new GLt,blurV:new YLt,noise:new uOt,sepia:new fOt,colorHalftone:new KLt,hexagonalPixelate:new nOt,ink:new oOt};return u.postProcessingPass=x,u.postProcessingPassFactory=w=>x[w],u}function Zw(e){const t=Ce({},e);return t.postProcessor=new BLt(t.rendererService),t.multiPassRenderer=new DLt(t.postProcessor),t.styleAttributeService=new P3t(t.rendererService),t}const MT=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"];let ou=function(e){return e.IMAGE="image",e.CUSTOMIMAGE="customImage",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb",e.TERRAINRGB="terrainRGB",e.CUSTOMRGB="customRGB",e.CUSTOMARRAYBUFFER="customArrayBuffer",e.CUSTOMTERRAINRGB="customTerrainRGB",e}({});var PQ=(e,t,r)=>new Promise((n,i)=>{var a=l=>{try{s(r.next(l))}catch(u){i(u)}},o=l=>{try{s(r.throw(l))}catch(u){i(u)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(a,o);s((r=r.apply(e,t)).next())}),vOt=(e,t,r,n)=>PQ(void 0,null,function*(){return new Promise((i,a)=>{t({x:e.x,y:e.y,z:e.z},(o,s)=>{if(o||s.length===0){a(o);return}s&&RD([{data:s,bands:[0]}],r,n,(l,u)=>{l?a(l):u&&i(u)})})})}),gOt=(e,t)=>PQ(void 0,null,function*(){return new Promise((r,n)=>{t({x:e.x,y:e.y,z:e.z},(i,a)=>{if(i||!a){n(i);return}a instanceof ArrayBuffer?Sdt(a,(o,s)=>{o&&n(o),r(s)}):a instanceof HTMLImageElement?r(a):n(i)})})});function mOt(e,t){return Array.isArray(e)?typeof e[0]=="string"?e.map(r=>yx(r,t)):e.map(r=>({url:yx(r.url,t),bands:r.bands||[0]})):yx(e,t)}function yOt(e){return typeof e=="string"?[{url:e,bands:[0]}]:typeof e[0]=="string"?e.map(t=>({url:t,bands:[0]})):e}function u9(e,t){e.xhrCancel=()=>{t.map(r=>{r.abort()})}}var _Ot=Object.defineProperty,xOt=Object.defineProperties,bOt=Object.getOwnPropertyDescriptors,c9=Object.getOwnPropertySymbols,EOt=Object.prototype.hasOwnProperty,wOt=Object.prototype.propertyIsEnumerable,h9=(e,t,r)=>t in e?_Ot(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,f9=(e,t)=>{for(var r in t||(t={}))EOt.call(t,r)&&h9(e,r,t[r]);if(c9)for(var r of c9(t))wOt.call(t,r)&&h9(e,r,t[r]);return e},d9=(e,t)=>xOt(e,bOt(t)),DQ=(e,t,r)=>new Promise((n,i)=>{var a=l=>{try{s(r.next(l))}catch(u){i(u)}},o=l=>{try{s(r.throw(l))}catch(u){i(u)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(a,o);s((r=r.apply(e,t)).next())}),COt=(e,t,r,n,i)=>DQ(void 0,null,function*(){const a=yOt(t.url);if(a.length>1){const{rasterFiles:o,xhrList:s,errList:l}=yield SOt(a,t);if(u9(e,s),l.length>0){r(l,null);return}RD(o,n,i,r)}else{const o=$5(t,(s,l)=>{if(s)r(s);else if(l){const u=[{data:l,bands:a[0].bands}];RD(u,n,i,r)}});u9(e,[o])}});function SOt(e,t){return DQ(this,null,function*(){const r=[],n=[],i=[];for(let a=0;a<e.length;a++){const o=e[a],s=d9(f9({},t),{url:o.url}),l=o.bands,{err:u,data:c,xhr:f}=yield Edt(d9(f9({},s),{type:"arrayBuffer"}));u&&i.push(u),n.push(f),r.push({data:c,bands:l})}return{rasterFiles:r,xhrList:n,errList:i}})}var TOt=Object.defineProperty,AOt=Object.defineProperties,MOt=Object.getOwnPropertyDescriptors,p9=Object.getOwnPropertySymbols,ROt=Object.prototype.hasOwnProperty,IOt=Object.prototype.propertyIsEnumerable,v9=(e,t,r)=>t in e?TOt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,rM=(e,t)=>{for(var r in t||(t={}))ROt.call(t,r)&&v9(e,r,t[r]);if(p9)for(var r of p9(t))IOt.call(t,r)&&v9(e,r,t[r]);return e},FQ=(e,t)=>AOt(e,MOt(t)),BQ=(e,t,r)=>new Promise((n,i)=>{var a=l=>{try{s(r.next(l))}catch(u){i(u)}},o=l=>{try{s(r.throw(l))}catch(u){i(u)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(a,o);s((r=r.apply(e,t)).next())}),LOt=(e,t,r,n)=>BQ(void 0,null,function*(){const{format:i=NQ,operation:a,requestParameters:o={}}=n,s=FQ(rM({},o),{url:mOt(e,t)});return new Promise((l,u)=>{COt(r,s,(c,f)=>{c?u(c):f&&l(f)},i,a)})}),g9=(e,t,r,n)=>BQ(void 0,null,function*(){let i;const a=Array.isArray(e)?e[0]:e;return n.wmtsOptions?i=((n==null?void 0:n.getURLFromTemplate)||JAt)(a,rM(rM({},t),n.wmtsOptions)):i=((n==null?void 0:n.getURLFromTemplate)||yx)(a,t),new Promise((o,s)=>{var l;const u=fD(FQ(rM({},n==null?void 0:n.requestParameters),{url:i,type:((l=n==null?void 0:n.requestParameters)==null?void 0:l.type)||"arrayBuffer"}),(c,f)=>{c?s(c):f&&o(f)},n.transformResponse);r.xhrCancel=()=>u.cancel()})}),NQ=()=>({rasterData:new Uint8Array([0]),width:1,height:1}),OOt=Object.defineProperty,POt=Object.defineProperties,DOt=Object.getOwnPropertyDescriptors,m9=Object.getOwnPropertySymbols,FOt=Object.prototype.hasOwnProperty,BOt=Object.prototype.propertyIsEnumerable,y9=(e,t,r)=>t in e?OOt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,_9=(e,t)=>{for(var r in t||(t={}))FOt.call(t,r)&&y9(e,r,t[r]);if(m9)for(var r of m9(t))BOt.call(t,r)&&y9(e,r,t[r]);return e},NOt=(e,t)=>POt(e,DOt(t)),kOt={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0};ou.ARRAYBUFFER,ou.RGB;function zOt(e){return!!(Array.isArray(e)&&e.length===0||!Array.isArray(e)&&typeof e!="string")}function UOt(e,t={}){if(zOt(e))throw new Error("tile server url is error");const{extent:r=[1/0,1/0,-1/0,-1/0],coordinates:n}=t;let i=(t==null?void 0:t.dataType)||ou.IMAGE;i===ou.RGB&&(i=ou.ARRAYBUFFER);const a=(l,u)=>{switch(i){case ou.IMAGE:return g9(e,l,u,t);case ou.CUSTOMIMAGE:case ou.CUSTOMTERRAINRGB:return gOt(u,t==null?void 0:t.getCustomData);case ou.ARRAYBUFFER:return LOt(e,l,u,t);case ou.CUSTOMARRAYBUFFER:case ou.CUSTOMRGB:return vOt(u,t==null?void 0:t.getCustomData,(t==null?void 0:t.format)||NQ,t==null?void 0:t.operation);default:return g9(e,l,u,t)}},o=NOt(_9(_9({},kOt),t),{getTileData:a}),s=Db(n,r);return{data:e,dataArray:[{_id:1,coordinates:s}],tilesetOptions:o,isTile:!0}}var $Ot=Object.defineProperty,HOt=Object.defineProperties,VOt=Object.getOwnPropertyDescriptors,ZM=Object.getOwnPropertySymbols,kQ=Object.prototype.hasOwnProperty,zQ=Object.prototype.propertyIsEnumerable,x9=(e,t,r)=>t in e?$Ot(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,GOt=(e,t)=>{for(var r in t||(t={}))kQ.call(t,r)&&x9(e,r,t[r]);if(ZM)for(var r of ZM(t))zQ.call(t,r)&&x9(e,r,t[r]);return e},WOt=(e,t)=>HOt(e,VOt(t)),XOt=(e,t)=>{var r={};for(var n in e)kQ.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&ZM)for(var n of ZM(e))t.indexOf(n)<0&&zQ.call(e,n)&&(r[n]=e[n]);return r};function jOt(e,t){const r=t,{extent:n=[121.168,30.2828,121.384,30.4219],coordinates:i,width:a,height:o}=r,s=XOt(r,["extent","coordinates","width","height"]);e.length<2&&console.warn("RGB解析需要2个波段的数据");const[l,u]=s.bands||[0,1],c=[e[l],e[u]],f=[];for(let g=0;g<c[0].length;g++)f.push((c[1][g]-c[0][g])/(c[1][g]+c[0][g]));const d=Db(i,n);return{_id:1,dataArray:[WOt(GOt({_id:1,data:f,width:a,height:o},s),{coordinates:d})]}}var YOt=Object.defineProperty,ZOt=Object.defineProperties,qOt=Object.getOwnPropertyDescriptors,qM=Object.getOwnPropertySymbols,UQ=Object.prototype.hasOwnProperty,$Q=Object.prototype.propertyIsEnumerable,b9=(e,t,r)=>t in e?YOt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,KOt=(e,t)=>{for(var r in t||(t={}))UQ.call(t,r)&&b9(e,r,t[r]);if(qM)for(var r of qM(t))$Q.call(t,r)&&b9(e,r,t[r]);return e},QOt=(e,t)=>ZOt(e,qOt(t)),JOt=(e,t)=>{var r={};for(var n in e)UQ.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&qM)for(var n of qM(e))t.indexOf(n)<0&&$Q.call(e,n)&&(r[n]=e[n]);return r};function tPt(e,t){const r=t,{extent:n,coordinates:i,width:a,height:o}=r,s=JOt(r,["extent","coordinates","width","height"]);e.length<3&&console.warn("RGB解析需要三个波段的数据");const[l,u,c]=s.bands||[0,1,2],f=[e[l],e[u],e[c]],d=[],[v,g]=(s==null?void 0:s.countCut)||[2,98],x=(s==null?void 0:s.RMinMax)||xx(f[0],v,g),w=(s==null?void 0:s.GMinMax)||xx(f[1],v,g),S=(s==null?void 0:s.BMinMax)||xx(f[2],v,g);for(let I=0;I<f[0].length;I++)d.push(Math.max(0,f[0][I]-x[0])),d.push(Math.max(0,f[1][I]-w[0])),d.push(Math.max(0,f[2][I]-S[0]));const M=Db(i,n);return{_id:1,dataArray:[QOt(KOt({_id:1,data:d,width:a,height:o,rMinMax:x,gMinMax:w,bMinMax:S},s),{coordinates:M})]}}var ePt=Object.defineProperty,rPt=Object.defineProperties,nPt=Object.getOwnPropertyDescriptors,KM=Object.getOwnPropertySymbols,HQ=Object.prototype.hasOwnProperty,VQ=Object.prototype.propertyIsEnumerable,E9=(e,t,r)=>t in e?ePt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,iPt=(e,t)=>{for(var r in t||(t={}))HQ.call(t,r)&&E9(e,r,t[r]);if(KM)for(var r of KM(t))VQ.call(t,r)&&E9(e,r,t[r]);return e},aPt=(e,t)=>rPt(e,nPt(t)),oPt=(e,t)=>{var r={};for(var n in e)HQ.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&KM)for(var n of KM(e))t.indexOf(n)<0&&VQ.call(e,n)&&(r[n]=e[n]);return r};function sPt(e,t){const r=t,{extent:n,coordinates:i,min:a,max:o,width:s,height:l,format:u,operation:c}=r,f=oPt(r,["extent","coordinates","min","max","width","height","format","operation"]);let d;if(u===void 0||tQ(e))d=Array.from(e);else{const x=Array.isArray(e)?e:[e];d=c4(x,u,c)}const v=Db(i,n);return{_id:1,dataArray:[aPt(iPt({_id:1,data:d,width:s,height:l},f),{min:a,max:o,coordinates:v})]}}var lPt=Object.defineProperty,uPt=Object.defineProperties,cPt=Object.getOwnPropertyDescriptors,w9=Object.getOwnPropertySymbols,hPt=Object.prototype.hasOwnProperty,fPt=Object.prototype.propertyIsEnumerable,C9=(e,t,r)=>t in e?lPt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,S9=(e,t)=>{for(var r in t||(t={}))hPt.call(t,r)&&C9(e,r,t[r]);if(w9)for(var r of w9(t))fPt.call(t,r)&&C9(e,r,t[r]);return e},dPt=(e,t)=>uPt(e,cPt(t)),pPt=(e,t,r)=>new Promise((n,i)=>{var a=l=>{try{s(r.next(l))}catch(u){i(u)}},o=l=>{try{s(r.throw(l))}catch(u){i(u)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(a,o);s((r=r.apply(e,t)).next())}),vPt={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},gPt=e=>pPt(void 0,null,function*(){return new Promise(t=>{const[r,n,i,a]=e.bounds,o={layers:{testTile:{features:[{type:"Feature",properties:{key:e.x+"/"+e.y+"/"+e.z,x:(r+i)/2,y:(n+a)/2},geometry:{type:"LineString",coordinates:[[i,a],[i,n],[r,n],[r,n]]}}]}}};t(o)})});function mPt(e,t){const r=i=>gPt(i),n=dPt(S9(S9({},vPt),t),{getTileData:r});return{data:e,dataArray:[],tilesetOptions:n,isTile:!0}}var GQ={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(Nm,function(){function r(Z,X,et,at,wt,Tt){if(!(wt-at<=et)){var vt=at+wt>>1;n(Z,X,vt,at,wt,Tt%2),r(Z,X,et,at,vt-1,Tt+1),r(Z,X,et,vt+1,wt,Tt+1)}}function n(Z,X,et,at,wt,Tt){for(;wt>at;){if(wt-at>600){var vt=wt-at+1,zt=et-at+1,oe=Math.log(vt),Qt=.5*Math.exp(2*oe/3),ne=.5*Math.sqrt(oe*Qt*(vt-Qt)/vt)*(zt-vt/2<0?-1:1),de=Math.max(at,Math.floor(et-zt*Qt/vt+ne)),De=Math.min(wt,Math.floor(et+(vt-zt)*Qt/vt+ne));n(Z,X,et,de,De,Tt)}var Ze=X[2*et+Tt],ke=at,Be=wt;for(i(Z,X,at,et),X[2*wt+Tt]>Ze&&i(Z,X,at,wt);ke<Be;){for(i(Z,X,ke,Be),ke++,Be--;X[2*ke+Tt]<Ze;)ke++;for(;X[2*Be+Tt]>Ze;)Be--}X[2*at+Tt]===Ze?i(Z,X,at,Be):(Be++,i(Z,X,Be,wt)),Be<=et&&(at=Be+1),et<=Be&&(wt=Be-1)}}function i(Z,X,et,at){a(Z,et,at),a(X,2*et,2*at),a(X,2*et+1,2*at+1)}function a(Z,X,et){var at=Z[X];Z[X]=Z[et],Z[et]=at}function o(Z,X,et,at,wt,Tt,vt){for(var zt=[0,Z.length-1,0],oe=[],Qt,ne;zt.length;){var de=zt.pop(),De=zt.pop(),Ze=zt.pop();if(De-Ze<=vt){for(var ke=Ze;ke<=De;ke++)Qt=X[2*ke],ne=X[2*ke+1],Qt>=et&&Qt<=wt&&ne>=at&&ne<=Tt&&oe.push(Z[ke]);continue}var Be=Math.floor((Ze+De)/2);Qt=X[2*Be],ne=X[2*Be+1],Qt>=et&&Qt<=wt&&ne>=at&&ne<=Tt&&oe.push(Z[Be]);var Zr=(de+1)%2;(de===0?et<=Qt:at<=ne)&&(zt.push(Ze),zt.push(Be-1),zt.push(Zr)),(de===0?wt>=Qt:Tt>=ne)&&(zt.push(Be+1),zt.push(De),zt.push(Zr))}return oe}function s(Z,X,et,at,wt,Tt){for(var vt=[0,Z.length-1,0],zt=[],oe=wt*wt;vt.length;){var Qt=vt.pop(),ne=vt.pop(),de=vt.pop();if(ne-de<=Tt){for(var De=de;De<=ne;De++)l(X[2*De],X[2*De+1],et,at)<=oe&&zt.push(Z[De]);continue}var Ze=Math.floor((de+ne)/2),ke=X[2*Ze],Be=X[2*Ze+1];l(ke,Be,et,at)<=oe&&zt.push(Z[Ze]);var Zr=(Qt+1)%2;(Qt===0?et-wt<=ke:at-wt<=Be)&&(vt.push(de),vt.push(Ze-1),vt.push(Zr)),(Qt===0?et+wt>=ke:at+wt>=Be)&&(vt.push(Ze+1),vt.push(ne),vt.push(Zr))}return zt}function l(Z,X,et,at){var wt=Z-et,Tt=X-at;return wt*wt+Tt*Tt}var u=function(Z){return Z[0]},c=function(Z){return Z[1]},f=function(X,et,at,wt,Tt){et===void 0&&(et=u),at===void 0&&(at=c),wt===void 0&&(wt=64),Tt===void 0&&(Tt=Float64Array),this.nodeSize=wt,this.points=X;for(var vt=X.length<65536?Uint16Array:Uint32Array,zt=this.ids=new vt(X.length),oe=this.coords=new Tt(X.length*2),Qt=0;Qt<X.length;Qt++)zt[Qt]=Qt,oe[2*Qt]=et(X[Qt]),oe[2*Qt+1]=at(X[Qt]);r(zt,oe,wt,0,zt.length-1,0)};f.prototype.range=function(X,et,at,wt){return o(this.ids,this.coords,X,et,at,wt,this.nodeSize)},f.prototype.within=function(X,et,at){return s(this.ids,this.coords,X,et,at,this.nodeSize)};var d={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Z){return Z}},v=Math.fround||function(Z){return function(X){return Z[0]=+X,Z[0]}}(new Float32Array(1)),g=function(X){this.options=z(Object.create(d),X),this.trees=new Array(this.options.maxZoom+1)};g.prototype.load=function(X){var et=this.options,at=et.log,wt=et.minZoom,Tt=et.maxZoom,vt=et.nodeSize;at&&console.time("total time");var zt="prepare "+X.length+" points";at&&console.time(zt),this.points=X;for(var oe=[],Qt=0;Qt<X.length;Qt++)X[Qt].geometry&&oe.push(w(X[Qt],Qt));this.trees[Tt+1]=new f(oe,G,J,vt,Float32Array),at&&console.timeEnd(zt);for(var ne=Tt;ne>=wt;ne--){var de=+Date.now();oe=this._cluster(oe,ne),this.trees[ne]=new f(oe,G,J,vt,Float32Array),at&&console.log("z%d: %d clusters in %dms",ne,oe.length,+Date.now()-de)}return at&&console.timeEnd("total time"),this},g.prototype.getClusters=function(X,et){var at=((X[0]+180)%360+360)%360-180,wt=Math.max(-90,Math.min(90,X[1])),Tt=X[2]===180?180:((X[2]+180)%360+360)%360-180,vt=Math.max(-90,Math.min(90,X[3]));if(X[2]-X[0]>=360)at=-180,Tt=180;else if(at>Tt){var zt=this.getClusters([at,wt,180,vt],et),oe=this.getClusters([-180,wt,Tt,vt],et);return zt.concat(oe)}for(var Qt=this.trees[this._limitZoom(et)],ne=Qt.range(R(at),I(vt),R(Tt),I(wt)),de=[],De=0,Ze=ne;De<Ze.length;De+=1){var ke=Ze[De],Be=Qt.points[ke];de.push(Be.numPoints?S(Be):this.points[Be.index])}return de},g.prototype.getChildren=function(X){var et=this._getOriginId(X),at=this._getOriginZoom(X),wt="No cluster with the specified id.",Tt=this.trees[at];if(!Tt)throw new Error(wt);var vt=Tt.points[et];if(!vt)throw new Error(wt);for(var zt=this.options.radius/(this.options.extent*Math.pow(2,at-1)),oe=Tt.within(vt.x,vt.y,zt),Qt=[],ne=0,de=oe;ne<de.length;ne+=1){var De=de[ne],Ze=Tt.points[De];Ze.parentId===X&&Qt.push(Ze.numPoints?S(Ze):this.points[Ze.index])}if(Qt.length===0)throw new Error(wt);return Qt},g.prototype.getLeaves=function(X,et,at){et=et||10,at=at||0;var wt=[];return this._appendLeaves(wt,X,et,at,0),wt},g.prototype.getTile=function(X,et,at){var wt=this.trees[this._limitZoom(X)],Tt=Math.pow(2,X),vt=this.options,zt=vt.extent,oe=vt.radius,Qt=oe/zt,ne=(at-Qt)/Tt,de=(at+1+Qt)/Tt,De={features:[]};return this._addTileFeatures(wt.range((et-Qt)/Tt,ne,(et+1+Qt)/Tt,de),wt.points,et,at,Tt,De),et===0&&this._addTileFeatures(wt.range(1-Qt/Tt,ne,1,de),wt.points,Tt,at,Tt,De),et===Tt-1&&this._addTileFeatures(wt.range(0,ne,Qt/Tt,de),wt.points,-1,at,Tt,De),De.features.length?De:null},g.prototype.getClusterExpansionZoom=function(X){for(var et=this._getOriginZoom(X)-1;et<=this.options.maxZoom;){var at=this.getChildren(X);if(et++,at.length!==1)break;X=at[0].properties.cluster_id}return et},g.prototype._appendLeaves=function(X,et,at,wt,Tt){for(var vt=this.getChildren(et),zt=0,oe=vt;zt<oe.length;zt+=1){var Qt=oe[zt],ne=Qt.properties;if(ne&&ne.cluster?Tt+ne.point_count<=wt?Tt+=ne.point_count:Tt=this._appendLeaves(X,ne.cluster_id,at,wt,Tt):Tt<wt?Tt++:X.push(Qt),X.length===at)break}return Tt},g.prototype._addTileFeatures=function(X,et,at,wt,Tt,vt){for(var zt=0,oe=X;zt<oe.length;zt+=1){var Qt=oe[zt],ne=et[Qt],de=ne.numPoints,De=void 0,Ze=void 0,ke=void 0;if(de)De=M(ne),Ze=ne.x,ke=ne.y;else{var Be=this.points[ne.index];De=Be.properties,Ze=R(Be.geometry.coordinates[0]),ke=I(Be.geometry.coordinates[1])}var Zr={type:1,geometry:[[Math.round(this.options.extent*(Ze*Tt-at)),Math.round(this.options.extent*(ke*Tt-wt))]],tags:De},Wr=void 0;de?Wr=ne.id:this.options.generateId?Wr=ne.index:this.points[ne.index].id&&(Wr=this.points[ne.index].id),Wr!==void 0&&(Zr.id=Wr),vt.features.push(Zr)}},g.prototype._limitZoom=function(X){return Math.max(this.options.minZoom,Math.min(Math.floor(+X),this.options.maxZoom+1))},g.prototype._cluster=function(X,et){for(var at=[],wt=this.options,Tt=wt.radius,vt=wt.extent,zt=wt.reduce,oe=wt.minPoints,Qt=Tt/(vt*Math.pow(2,et)),ne=0;ne<X.length;ne++){var de=X[ne];if(!(de.zoom<=et)){de.zoom=et;for(var De=this.trees[et+1],Ze=De.within(de.x,de.y,Qt),ke=de.numPoints||1,Be=ke,Zr=0,Wr=Ze;Zr<Wr.length;Zr+=1){var In=Wr[Zr],re=De.points[In];re.zoom>et&&(Be+=re.numPoints||1)}if(Be>ke&&Be>=oe){for(var nr=de.x*ke,zr=de.y*ke,Ne=zt&&ke>1?this._map(de,!0):null,Vr=(ne<<5)+(et+1)+this.points.length,xn=0,Qn=Ze;xn<Qn.length;xn+=1){var gn=Qn[xn],bn=De.points[gn];if(!(bn.zoom<=et)){bn.zoom=et;var ci=bn.numPoints||1;nr+=bn.x*ci,zr+=bn.y*ci,bn.parentId=Vr,zt&&(Ne||(Ne=this._map(de,!0)),zt(Ne,this._map(bn)))}}de.parentId=Vr,at.push(x(nr/Be,zr/Be,Vr,Be,Ne))}else if(at.push(de),Be>1)for(var Mo=0,ra=Ze;Mo<ra.length;Mo+=1){var la=ra[Mo],os=De.points[la];os.zoom<=et||(os.zoom=et,at.push(os))}}}return at},g.prototype._getOriginId=function(X){return X-this.points.length>>5},g.prototype._getOriginZoom=function(X){return(X-this.points.length)%32},g.prototype._map=function(X,et){if(X.numPoints)return et?z({},X.properties):X.properties;var at=this.points[X.index].properties,wt=this.options.map(at);return et&&wt===at?z({},wt):wt};function x(Z,X,et,at,wt){return{x:v(Z),y:v(X),zoom:1/0,id:et,parentId:-1,numPoints:at,properties:wt}}function w(Z,X){var et=Z.geometry.coordinates,at=et[0],wt=et[1];return{x:v(R(at)),y:v(I(wt)),zoom:1/0,index:X,parentId:-1}}function S(Z){return{type:"Feature",id:Z.id,properties:M(Z),geometry:{type:"Point",coordinates:[P(Z.x),k(Z.y)]}}}function M(Z){var X=Z.numPoints,et=X>=1e4?Math.round(X/1e3)+"k":X>=1e3?Math.round(X/100)/10+"k":X;return z(z({},Z.properties),{cluster:!0,cluster_id:Z.id,point_count:X,point_count_abbreviated:et})}function R(Z){return Z/360+.5}function I(Z){var X=Math.sin(Z*Math.PI/180),et=.5-.25*Math.log((1+X)/(1-X))/Math.PI;return et<0?0:et>1?1:et}function P(Z){return(Z-.5)*360}function k(Z){var X=(180-Z*360)*Math.PI/180;return 360*Math.atan(Math.exp(X))/Math.PI-90}function z(Z,X){for(var et in X)Z[et]=X[et];return Z}function G(Z){return Z.x}function J(Z){return Z.y}return g})})(GQ);var yPt=GQ.exports;const _Pt=sa(yPt);var xPt=Object.defineProperty,T9=Object.getOwnPropertySymbols,bPt=Object.prototype.hasOwnProperty,EPt=Object.prototype.propertyIsEnumerable,A9=(e,t,r)=>t in e?xPt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,WQ=(e,t)=>{for(var r in t||(t={}))bPt.call(t,r)&&A9(e,r,t[r]);if(T9)for(var r of T9(t))EPt.call(t,r)&&A9(e,r,t[r]);return e};function XQ(e,t){const{radius:r=40,maxZoom:n=18,minZoom:i=0,zoom:a=2}=t;if(e.pointIndex){const l=e.pointIndex.getClusters(e.extent,Math.floor(a));return e.dataArray=wPt(l),e}const o=new _Pt({radius:r,minZoom:i,maxZoom:n}),s={type:"FeatureCollection",features:[]};return s.features=e.dataArray.map(l=>({type:"Feature",geometry:{type:"Point",coordinates:l.coordinates},properties:WQ({},l)})),o.load(s.features),o}function wPt(e){return e.map((t,r)=>WQ({coordinates:t.geometry.coordinates,_id:r+1},t.properties))}function CPt(e){if(e.length===0)throw new Error("max requires at least one data point");let t=e[0];for(let r=1;r<e.length;r++)e[r]>t&&(t=e[r]);return t}function SPt(e){if(e.length===0)throw new Error("min requires at least one data point");let t=e[0];for(let r=1;r<e.length;r++)e[r]<t&&(t=e[r]);return t}function jQ(e){if(e.length===0)return 0;let t=e[0],r=0,n;for(let i=1;i<e.length;i++)n=t+e[i]*1,Math.abs(t)>=Math.abs(e[i])?r+=t-n+e[i]:r+=e[i]-n+t,t=n;return t+r*1}function TPt(e){if(e.length===0)throw new Error("mean requires at least one data point");return jQ(e)/e.length}var APt={min:SPt,max:CPt,mean:TPt,sum:jQ},MPt=Object.defineProperty,M9=Object.getOwnPropertySymbols,RPt=Object.prototype.hasOwnProperty,IPt=Object.prototype.propertyIsEnumerable,R9=(e,t,r)=>t in e?MPt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,GE=(e,t)=>{for(var r in t||(t={}))RPt.call(t,r)&&R9(e,r,t[r]);if(M9)for(var r of M9(t))IPt.call(t,r)&&R9(e,r,t[r]);return e},I9=(e,t,r)=>new Promise((n,i)=>{var a=l=>{try{s(r.next(l))}catch(u){i(u)}},o=l=>{try{s(r.throw(l))}catch(u){i(u)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(a,o);s((r=r.apply(e,t)).next())}),{cloneDeep:LPt,isFunction:L9,isString:OPt,mergeWith:PPt}=as;function DPt(e,t){if(Array.isArray(t))return t}var FPt=class extends Gu.EventEmitter{constructor(e,t){super(),this.type="source",this.isTile=!1,this.inited=!1,this.hooks={init:new Dp},this.parser={type:"geojson"},this.transforms=[],this.cluster=!1,this.clusterOptions={enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"},this.invalidExtent=!1,this.dataArrayChanged=!1,this.cfg={autoRender:!0},this.originData=e,this.initCfg(t),this.init().then(()=>{this.inited=!0,this.emit("update",{type:"inited"})})}getSourceCfg(){return this.cfg}getClusters(e){return this.clusterIndex.getClusters(this.caculClusterExtent(2),e)}getClustersLeaves(e){return this.clusterIndex.getLeaves(e,1/0)}getParserType(){return this.parser.type}updateClusterData(e){const{method:t="sum",field:r}=this.clusterOptions;let n=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(e));this.clusterOptions.zoom=e,n.forEach(i=>{i.id||(i.properties.point_count=1)}),(r||L9(t))&&(n=n.map(i=>{const a=i.id;if(a){const s=this.clusterIndex.getLeaves(a,1/0).map(u=>u.properties);let l;if(OPt(t)&&r){const u=rMt(s,r);l=APt[t](u)}L9(t)&&(l=t(s)),i.properties.stat=l}else i.properties.point_count=1;return i})),this.data=P7("geojson")({type:"FeatureCollection",features:n}),this.executeTrans()}getFeatureById(e){const{type:t="geojson",geometry:r}=this.parser;if(t==="geojson"&&!this.cluster){const n=e<this.originData.features.length?this.originData.features[e]:"null",i=LPt(n);if(i!=null&&i.properties&&(this.transforms.length!==0||this.dataArrayChanged)){const a=this.data.dataArray.find(o=>o._id===e);i.properties=a}return i}else return t==="json"&&r?this.data.dataArray.find(n=>n._id===e):e<this.data.dataArray.length?this.data.dataArray[e]:"null"}updateFeaturePropertiesById(e,t){this.data.dataArray=this.data.dataArray.map(r=>r._id===e?GE(GE({},r),t):r),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}getFeatureId(e,t){const r=this.data.dataArray.find(n=>n[e]===t);return r==null?void 0:r._id}setData(e,t){this.originData=e,this.dataArrayChanged=!1,this.initCfg(t),this.init().then(()=>{this.emit("update",{type:"update"})})}reloadAllTile(){var e;(e=this.tileset)==null||e.reloadAll()}reloadTilebyId(e,t,r){var n;(n=this.tileset)==null||n.reloadTileById(e,t,r)}reloadTileByLnglat(e,t,r){var n;(n=this.tileset)==null||n.reloadTileByLnglat(e,t,r)}getTileExtent(e,t){var r;return(r=this.tileset)==null?void 0:r.getTileExtent(e,t)}getTileByZXY(e,t,r){var n;return(n=this.tileset)==null?void 0:n.getTileByZXY(e,t,r)}reloadTileByExtent(e,t){var r;(r=this.tileset)==null||r.reloadTileByExtent(e,t)}destroy(){var e;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(e=this.tileset)==null||e.destroy()}processData(){return I9(this,null,function*(){return new Promise((e,t)=>{try{this.excuteParser(),this.initCluster(),this.executeTrans(),e({})}catch(r){t(r)}})})}initCfg(e){this.cfg=PPt(this.cfg,e,DPt);const t=this.cfg;t&&(t.parser&&(this.parser=t.parser),t.transforms&&(this.transforms=t.transforms),this.cluster=t.cluster||!1,t.clusterOptions&&(this.cluster=!0,this.clusterOptions=GE(GE({},this.clusterOptions),t.clusterOptions)))}init(){return I9(this,null,function*(){this.inited=!1,yield this.processData(),this.inited=!0})}excuteParser(){const e=this.parser,t=e.type||"geojson",r=P7(t);this.data=r(this.originData,e),this.tileset=this.initTileset(),!e.cancelExtent&&(this.extent=gAt(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}setCenter(e){this.center=[(e[0]+e[2])/2,(e[1]+e[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}initTileset(){const{tilesetOptions:e}=this.data;return e?(this.isTile=!0,this.tileset?(this.tileset.updateOptions(e),this.tileset):new QAt(GE({},e))):void 0}executeTrans(){this.transforms.forEach(t=>{const{type:r}=t,n=ndt(r)(this.data,t);Object.assign(this.data,n)})}initCluster(){if(!this.cluster)return;const e=this.clusterOptions||{};this.clusterIndex=XQ(this.data,e)}caculClusterExtent(e){let t=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(t=o4(VM(this.extent),e)),t[0].concat(t[1])}};function BPt(e,t){const{callback:r}=t;return r&&(e.dataArray=e.dataArray.filter(r)),e}var g4=6378e3;function NPt(e,t){const r=e.dataArray,{size:n=10}=t,i=n/(2*Math.PI*g4)*(256<<20)/2,{gridHash:a,gridOffset:o}=kPt(r,n),s=HPt(a,o,t);return{yOffset:i,xOffset:i,radius:i,type:"grid",dataArray:s}}function kPt(e,t){let r=1/0,n=-1/0,i;for(const l of e)i=l.coordinates[1],Number.isFinite(i)&&(r=i<r?i:r,n=i>n?i:n);const a=(r+n)/2,o=zPt(t,a);if(o.xOffset<=0||o.yOffset<=0)return{gridHash:{},gridOffset:o};const s={};for(const l of e){const u=l.coordinates[1],c=l.coordinates[0];if(Number.isFinite(u)&&Number.isFinite(c)){const f=Math.floor((u+90)/o.yOffset),d=Math.floor((c+180)/o.xOffset),v=`${f}-${d}`;s[v]=s[v]||{count:0,points:[]},s[v].count+=1,s[v].points.push(l)}}return{gridHash:s,gridOffset:o}}function zPt(e,t){const r=UPt(e),n=$Pt(t,e);return{yOffset:r,xOffset:n}}function UPt(e){return e/g4*(180/Math.PI)}function $Pt(e,t){return t/g4*(180/Math.PI)/Math.cos(e*Math.PI/180)}function HPt(e,t,r){return Object.keys(e).reduce((n,i,a)=>{const o=i.split("-"),s=parseInt(o[0],10),l=parseInt(o[1],10),u={};if(r.field&&r.method){const c=jK(e[i].points,r.field);u[r.method]=XK[r.method](c)}return Object.assign(u,{_id:a,coordinates:Nf([-180+t.xOffset*(l+.5),-90+t.yOffset*(s+.5)]),rawData:e[i].points,count:e[i].count}),n.push(u),n},[])}var q1=Math.PI/3,VPt=[0,q1,2*q1,3*q1,4*q1,5*q1];function GPt(e){return e[0]}function WPt(e){return e[1]}function XPt(){var e=0,t=0,r=1,n=1,i=GPt,a=WPt,o,s,l;function u(f){var d={},v=[],g,x=f.length;for(g=0;g<x;++g)if(!(isNaN(S=+i.call(null,w=f[g],g,f))||isNaN(M=+a.call(null,w,g,f)))){var w,S,M,R=Math.round(M=M/l),I=Math.round(S=S/s-(R&1)/2),P=M-R;if(Math.abs(P)*3>1){var k=S-I,z=I+(S<I?-1:1)/2,G=R+(M<R?-1:1),J=S-z,Z=M-G;k*k+P*P>J*J+Z*Z&&(I=z+(R&1?1:-1)/2,R=G)}var X=I+"-"+R,et=d[X];et?et.push(w):(v.push(et=d[X]=[w]),et.x=(I+(R&1)/2)*s,et.y=R*l)}return v}function c(f){var d=0,v=0;return VPt.map(function(g){var x=Math.sin(g)*f,w=-Math.cos(g)*f,S=x-d,M=w-v;return d=x,v=w,[S,M]})}return u.hexagon=function(f){return"m"+c(f==null?o:+f).join("l")+"z"},u.centers=function(){for(var f=[],d=Math.round(t/l),v=Math.round(e/s),g=d*l;g<n+o;g+=l,++d)for(var x=v*s+(d&1)*s/2;x<r+s/2;x+=s)f.push([x,g]);return f},u.mesh=function(){var f=c(o).slice(0,4).join("l");return u.centers().map(function(d){return"M"+d+"m"+f}).join("")},u.x=function(f){return arguments.length?(i=f,u):i},u.y=function(f){return arguments.length?(a=f,u):a},u.radius=function(f){return arguments.length?(o=+f,s=o*2*Math.sin(q1),l=o*1.5,u):o},u.size=function(f){return arguments.length?(e=t=0,r=+f[0],n=+f[1],u):[r-e,n-t]},u.extent=function(f){return arguments.length?(e=+f[0][0],t=+f[0][1],r=+f[1][0],n=+f[1][1],u):[[e,t],[r,n]]},u.radius(1)}var jPt=Object.defineProperty,YPt=Object.defineProperties,ZPt=Object.getOwnPropertyDescriptors,O9=Object.getOwnPropertySymbols,qPt=Object.prototype.hasOwnProperty,KPt=Object.prototype.propertyIsEnumerable,P9=(e,t,r)=>t in e?jPt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,QPt=(e,t)=>{for(var r in t||(t={}))qPt.call(t,r)&&P9(e,r,t[r]);if(O9)for(var r of O9(t))KPt.call(t,r)&&P9(e,r,t[r]);return e},JPt=(e,t)=>YPt(e,ZPt(t)),tDt=6378e3;function eDt(e,t){const r=e.dataArray,{size:n=10,method:i="sum"}=t,a=n/(2*Math.PI*tDt)*(256<<20)/2,o=r.map(c=>{const[f,d]=Nf(c.coordinates);return JPt(QPt({},c),{coordinates:[f,d]})});return{dataArray:XPt().radius(a).x(c=>c.coordinates[0]).y(c=>c.coordinates[1])(o).map((c,f)=>{if(t.field&&i){const d=jK(c,t.field);c[i]=XK[i](d)}return{[t.method]:c[i],count:c.length,rawData:c,coordinates:[c.x,c.y],_id:f}}),radius:a,xOffset:a,yOffset:a,type:"hexagon"}}var rDt=Object.defineProperty,D9=Object.getOwnPropertySymbols,nDt=Object.prototype.hasOwnProperty,iDt=Object.prototype.propertyIsEnumerable,F9=(e,t,r)=>t in e?rDt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,B9=(e,t)=>{for(var r in t||(t={}))nDt.call(t,r)&&F9(e,r,t[r]);if(D9)for(var r of D9(t))iDt.call(t,r)&&F9(e,r,t[r]);return e};function aDt(e,t){const{sourceField:r,targetField:n,data:i}=t,a={};return i.forEach(o=>{a[o[r]]=o}),e.dataArray=e.dataArray.map(o=>{const s=o[n];return B9(B9({},o),a[s])}),e}function oDt(e,t){const{callback:r}=t;return r&&(e.dataArray=e.dataArray.map(r)),e}var sDt=Object.defineProperty,lDt=Object.defineProperties,uDt=Object.getOwnPropertyDescriptors,N9=Object.getOwnPropertySymbols,cDt=Object.prototype.hasOwnProperty,hDt=Object.prototype.propertyIsEnumerable,k9=(e,t,r)=>t in e?sDt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,fDt=(e,t)=>{for(var r in t||(t={}))cDt.call(t,r)&&k9(e,r,t[r]);if(N9)for(var r of N9(t))hDt.call(t,r)&&k9(e,r,t[r]);return e},dDt=(e,t)=>lDt(e,uDt(t));function pDt(e){let t=1/0,r=-1/0,n=1/0,i=-1/0;e.forEach(s=>{const l=s.coordinates;if(!l)return;const u=c=>{if(typeof c[0]=="number"&&typeof c[1]=="number"){const[f,d]=c;t=Math.min(t,f),r=Math.max(r,f),n=Math.min(n,d),i=Math.max(i,d)}else Array.isArray(c[0])&&c.forEach(u)};u(l)});const a=(t+r)/2,o=(n+i)/2;return[a,o]}function vDt(e,t){const[r,n]=t;return e.map(i=>{if(!i.coordinates)return i;const a=o=>{if(typeof o[0]=="number"&&typeof o[1]=="number"){const s=Number((o[0]-r).toPrecision(15)),l=Number((o[1]-n).toPrecision(15));return[s,l,...o.slice(2)||[]]}else if(Array.isArray(o[0]))return o.map(a);return o};return dDt(fDt({},i),{coordinates:a(i.coordinates)})})}function gDt(e,t={}){const{enableRelativeCoordinates:r=!1,relativeOrigin:n}=t;if(!r)return{dataArray:e,relativeOrigin:[0,0],originalExtent:[0,0,0,0]};let i=1/0,a=-1/0,o=1/0,s=-1/0;e.forEach(f=>{const d=f.coordinates;if(!d)return;const v=g=>{if(typeof g[0]=="number"&&typeof g[1]=="number"){const[x,w]=g;i=Math.min(i,x),a=Math.max(a,x),o=Math.min(o,w),s=Math.max(s,w)}else Array.isArray(g[0])&&g.forEach(v)};v(d)});const l=[i,o,a,s],u=n||pDt(e);return{dataArray:vDt(e,u),relativeOrigin:u,originalExtent:l}}qh("rasterTile",UOt);qh("mvt",tIt);qh("geojsonvt",WMt);qh("testTile",mPt);qh("geojson",yMt);qh("jsonTile",aRt);qh("image",aQ);qh("csv",lMt);qh("json",eQ);qh("raster",pIt);qh("rasterRgb",sPt);qh("rgb",tPt);qh("ndi",jOt);Ab("cluster",XQ);Ab("filter",BPt);Ab("join",aDt);Ab("map",oDt);Ab("grid",NPt);Ab("hexagon",eDt);var WI=FPt;let z9=class extends Gu.EventEmitter{getMarkerLayerContainerSize(){}constructor(t){super(),U(this,"markerOption",void 0),U(this,"popup",void 0),U(this,"mapsService",void 0),U(this,"lngLat",void 0),U(this,"scene",void 0),U(this,"added",!1),U(this,"preLngLat",{lng:0,lat:0}),U(this,"onMarkerDragStart",r=>{const n=this.mapsService.getContainer();if(!n)return;this.mapsService.setMapStatus({dragEnable:!1,zoomEnable:!1});const{left:i,top:a}=n.getClientRects()[0],{x:o,y:s}=r;this.preLngLat=this.mapsService.containerToLngLat([o-i,s-a]),this.mapsService.on("mousemove",this.onMarkerDragMove),document.addEventListener("mouseup",this.onMarkerDragEnd),this.emit("dragstart",this.lngLat)}),U(this,"onMarkerDragMove",r=>{const n=r.lngLat||r.lnglat,{lng:i,lat:a}=this.preLngLat,{lng:o,lat:s}=n,l={lng:this.lngLat.lng+o-i,lat:this.lngLat.lat+s-a};this.setLnglat(l),this.preLngLat=n,this.emit("dragging",l)}),U(this,"onMarkerDragEnd",()=>{this.mapsService.setMapStatus({dragEnable:!0,zoomEnable:!0}),this.mapsService.off("mousemove",this.onMarkerDragMove),document.removeEventListener("mouseup",this.onMarkerDragEnd),this.emit("dragend",this.lngLat)}),U(this,"eventHandle",r=>{this.polyfillEvent(r),this.emit(r.type,{target:r,data:this.markerOption.extData,lngLat:this.lngLat})}),U(this,"touchStartTime",void 0),this.markerOption=Ce(Ce({},this.getDefault()),t),pAt(["update","onMove","onMapClick","updatePositionWhenZoom"],this),this.init()}getDefault(){return{element:void 0,anchor:MI.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1,overflowHide:!0}}addTo(t){this.scene=t,this.mapsService=t.mapService;const{element:r}=this.markerOption;return this.mapsService.getMarkerContainer().appendChild(r),this.registerMarkerEvent(r),this.mapsService.on("camerachange",this.update),this.update(),this.updateDraggable(),this.added=!0,this.emit("added"),this}remove(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();const{element:t}=this.markerOption;return t&&kh(t),this.popup&&this.popup.remove(),this}setLnglat(t){return this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}getLnglat(){return this.lngLat}getElement(){return this.markerOption.element}setElement(t){if(!this.added)return this.once("added",()=>{this.setElement(t)}),this;const{element:r}=this.markerOption;return r&&kh(r),this.markerOption.element=t,this.init(),this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.updateDraggable(),this.update(),this}openPopup(){if(!this.added)return this.once("added",()=>{this.openPopup()}),this;const t=this.popup;return t?(t.isOpen()||t.addTo(this.scene),this):this}closePopup(){this.added||this.once("added",()=>{this.closePopup()});const t=this.popup;return t&&t.remove(),this}setPopup(t){return this.popup=t,this.lngLat&&this.popup.setLnglat(this.lngLat),this}togglePopup(){const t=this.popup;if(t)t.isOpen()?t.remove():t.addTo(this.scene);else return this;return this}getPopup(){return this.popup}getOffset(){return this.markerOption.offsets}setDraggable(t){this.markerOption.draggable=t,this.updateDraggable()}getDraggable(){return this.markerOption.draggable}getExtData(){return this.markerOption.extData}setExtData(t){this.markerOption.extData=t}update(){if(!this.mapsService)return;const{element:t,anchor:r}=this.markerOption;this.updatePosition(),HK(t,`${BM[r]}`)}updatePositionWhenZoom(t){if(!this.mapsService)return;const{element:r,offsets:n}=this.markerOption,{lng:i,lat:a}=this.lngLat;if(r){r.style.display="block",r.style.whiteSpace="nowrap";const{containerHeight:o,containerWidth:s,bounds:l}=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize();if(!l)return;const u=t.map,c=t.center,f=t.zoom,d=u.DE(this.lngLat,f,c);if(d.x=Math.round(d.x+n[0]),d.y=Math.round(d.y-n[1]),Math.abs(l[0][0])>180||Math.abs(l[1][0])>180){if(d.x>s){const v=this.mapsService.lngLatToContainer([i-360,a]);d.x=v.x}if(d.x<0){const v=this.mapsService.lngLatToContainer([i+360,a]);d.x=v.x}}(d.x>s||d.x<0||d.y>o||d.y<0)&&(r.style.display="none"),r.style.left=d.x+"px",r.style.top=d.y+"px",r.style.transition="left 0.25s cubic-bezier(0,0,0.25,1), top 0.25s cubic-bezier(0,0,0.25,1)"}}onMapClick(t){const{element:r}=this.markerOption;this.popup&&r&&this.togglePopup()}getCurrentContainerSize(){const t=this.mapsService.getContainer();return{containerHeight:(t==null?void 0:t.scrollHeight)||0,containerWidth:(t==null?void 0:t.scrollWidth)||0,bounds:this.mapsService.getBounds()}}updateDraggable(){const{element:t}=this.markerOption;t==null||t.removeEventListener("mousedown",this.onMarkerDragStart),this.mapsService.off("mousemove",this.onMarkerDragMove),document.removeEventListener("mouseup",this.onMarkerDragEnd),this.markerOption.draggable&&(t==null||t.addEventListener("mousedown",this.onMarkerDragStart))}updatePosition(){if(!this.mapsService)return;const{element:t,offsets:r}=this.markerOption,{lng:n,lat:i}=this.lngLat,a=this.mapsService.lngLatToContainer([n,i]);if(t){t.style.display="block",t.style.whiteSpace="nowrap";const{containerHeight:o,containerWidth:s,bounds:l}=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize();if(!l)return;if(Math.abs(l[0][0])>180||Math.abs(l[1][0])>180){if(a.x>s){const u=this.mapsService.lngLatToContainer([n-360,i]);a.x=u.x}if(a.x<0){const u=this.mapsService.lngLatToContainer([n+360,i]);a.x=u.x}}this.markerOption.overflowHide&&(a.x>s||a.x<0||a.y>o||a.y<0)&&(t.style.display="none"),t.style.left=a.x+r[0]+"px",t.style.top=a.y-r[1]+"px"}}init(){let{element:t}=this.markerOption;const{color:r,anchor:n}=this.markerOption;if(!t){t=Ua("div"),this.markerOption.element=t;const i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttributeNS(null,"display","block"),i.setAttributeNS(null,"height","48px"),i.setAttributeNS(null,"width","48px"),i.setAttributeNS(null,"viewBox","0 0 1024 1024");const a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),a.setAttributeNS(null,"fill",r),i.appendChild(a),t.appendChild(i)}Yp(t,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(i=>{var a,o;const s=((a=this.markerOption)===null||a===void 0?void 0:a.style)&&((o=this.markerOption)===null||o===void 0?void 0:o.style[i]);t&&(t.style[i]=s)}),wq(t,n,"marker")}registerMarkerEvent(t){t.addEventListener("click",this.onMapClick),t.addEventListener("mousemove",this.eventHandle),t.addEventListener("click",this.eventHandle),t.addEventListener("mousedown",this.eventHandle),t.addEventListener("mouseup",this.eventHandle),t.addEventListener("dblclick",this.eventHandle),t.addEventListener("contextmenu",this.eventHandle),t.addEventListener("mouseover",this.eventHandle),t.addEventListener("mouseout",this.eventHandle),t.addEventListener("touchstart",this.eventHandle),t.addEventListener("touchend",this.eventHandle)}unRegisterMarkerEvent(){const t=this.getElement();t.removeEventListener("click",this.onMapClick),t.removeEventListener("mousemove",this.eventHandle),t.removeEventListener("click",this.eventHandle),t.removeEventListener("mousedown",this.eventHandle),t.removeEventListener("mouseup",this.eventHandle),t.removeEventListener("dblclick",this.eventHandle),t.removeEventListener("contextmenu",this.eventHandle),t.removeEventListener("mouseover",this.eventHandle),t.removeEventListener("mouseout",this.eventHandle),t.removeEventListener("touchstart",this.eventHandle),t.removeEventListener("touchend",this.eventHandle)}polyfillEvent(t){!this.mapsService||this.mapsService.getType()!=="amap"||dAt()||(t.type==="touchstart"&&(this.touchStartTime=Date.now()),t.type==="touchend"&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:t,data:this.markerOption.extData,lngLat:this.lngLat}))}addDragHandler(t){return null}onUp(t){throw new Error("Method not implemented.")}};window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(e){try{let u=function(){s||(s=!0,a())},c=function(){try{o.documentElement.doScroll("left")}catch{return void setTimeout(c,50)}u()};var r=(r=document.getElementsByTagName("script"))[r.length-1],t=r.getAttribute("data-injectcss"),r=r.getAttribute("data-disable-injectsvg");if(!r){var n,i,a,o,s,l=function(f,d){d.parentNode.insertBefore(f,d)};if(t&&!e.__iconfont__svg__cssinject__){e.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(f){console&&console.log(f)}}n=function(){var f,d=document.createElement("div");d.innerHTML=e._iconfont_svg_string_3580659,(d=d.getElementsByTagName("svg")[0])&&(d.setAttribute("aria-hidden","true"),d.style.position="absolute",d.style.width=0,d.style.height=0,d.style.overflow="hidden",d=d,(f=document.body).firstChild?l(d,f.firstChild):f.appendChild(d))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(n,0):(i=function(){document.removeEventListener("DOMContentLoaded",i,!1),n()},document.addEventListener("DOMContentLoaded",i,!1)):document.attachEvent&&(a=n,o=e.document,s=!1,c(),o.onreadystatechange=function(){o.readyState=="complete"&&(o.onreadystatechange=null,u())})}}catch{}}(window);class yg extends s4{constructor(t){super(),U(this,"controlOption",void 0),U(this,"container",void 0),U(this,"isShow",void 0),U(this,"sceneContainer",void 0),U(this,"scene",void 0),U(this,"mapsService",void 0),U(this,"renderService",void 0),U(this,"layerService",void 0),U(this,"controlService",void 0),U(this,"configService",void 0),yg.controlCount++,this.controlOption=Ce(Ce({},this.getDefault(t)),t||{})}getOptions(){return this.controlOption}setOptions(t){const r=this.getDefault(t);Object.entries(t).forEach(([n,i])=>{i===void 0&&(t[n]=r[n])}),"position"in t&&this.setPosition(t.position),"className"in t&&this.setClassName(t.className),"style"in t&&this.setStyle(t.style),this.controlOption=Ce(Ce({},this.controlOption),t)}addTo(t){this.mapsService=t.mapService,this.renderService=t.rendererService,this.layerService=t.layerService,this.controlService=t.controlService,this.configService=t.globalConfigService,this.scene=t.sceneService,this.sceneContainer=t,this.isShow=!0,this.container=this.onAdd(),Yp(this.container,"l7-control");const{className:r,style:n}=this.controlOption;return r&&this.setClassName(r),n&&this.setStyle(n),this.insertContainer(),this.emit("add",this),this}remove(){if(!this.mapsService)return this;kh(this.container),this.onRemove(),this.emit("remove",this)}onAdd(){return Ua("div")}onRemove(){}show(){const t=this.container;Hx(t,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}hide(){const t=this.container;Yp(t,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}getDefault(t){return{position:Gx.TOPRIGHT,name:`${yg.controlCount}`}}getContainer(){return this.container}getIsShow(){return this.isShow}_refocusOnMap(t){if(this.mapsService&&t&&t.screenX>0&&t.screenY>0){const r=this.mapsService.getContainer();r!==null&&r.focus()}}setPosition(t=Gx.TOPLEFT){const r=this.controlService;return r&&r.removeControl(this),this.controlOption.position=t,r&&r.addControl(this,this.sceneContainer),this}setClassName(t){const r=this.container,{className:n}=this.controlOption;n&&Hx(r,n),t&&Yp(r,t)}setStyle(t){const r=this.container;t?r.setAttribute("style",t):r.removeAttribute("style")}insertContainer(){const t=this.controlOption.position,r=this.container;if(t instanceof Element)t.appendChild(r);else{const n=this.controlService.controlCorners[t];["bottomleft","bottomright","righttop","rightbottom"].includes(t)?n.insertBefore(r,n.firstChild):n.appendChild(r)}}checkUpdateOption(t,r){return r.some(n=>n in t)}}U(yg,"controlCount",0);class mDt extends yg{constructor(...t){super(...t),U(this,"isDisable",!1),U(this,"button",void 0),U(this,"buttonText",void 0),U(this,"buttonIcon",void 0)}setIsDisable(t){if(this.isDisable=t,t){var r;(r=this.button)===null||r===void 0||r.setAttribute("disabled","true")}else{var n;(n=this.button)===null||n===void 0||n.removeAttribute("disabled")}}createButton(t=""){return Ua("button",`l7-button-control ${t}`)}onAdd(){this.button=this.createButton(),this.isDisable=!1;const{title:t,btnText:r,btnIcon:n}=this.controlOption;return this.setBtnTitle(t),this.setBtnText(r),this.setBtnIcon(n),this.button}onRemove(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}setOptions(t){const{title:r,btnText:n,btnIcon:i}=t;this.checkUpdateOption(t,["title"])&&this.setBtnTitle(r),this.checkUpdateOption(t,["btnIcon"])&&this.setBtnIcon(i),this.checkUpdateOption(t,["btnText"])&&this.setBtnText(n),super.setOptions(t)}setBtnTitle(t){var r;(r=this.button)===null||r===void 0||r.setAttribute("title",t??"")}setBtnIcon(t){if(this.buttonIcon&&kh(this.buttonIcon),t){var r;const a=(r=this.button)===null||r===void 0?void 0:r.firstChild;if(a){var n;(n=this.button)===null||n===void 0||n.insertBefore(t,a)}else{var i;(i=this.button)===null||i===void 0||i.appendChild(t)}this.buttonIcon=t}}setBtnText(t){if(this.button)if(Hx(this.button,"l7-button-control--row"),Hx(this.button,"l7-button-control--column"),t){let n=this.buttonText;if(!n){var r;n=Ua("div","l7-button-control__text"),(r=this.button)===null||r===void 0||r.appendChild(n),this.buttonText=n}n.innerText=t,Yp(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!t&&this.buttonText&&(kh(this.buttonText),this.buttonText=void 0)}}class QM extends Gu.EventEmitter{get buttonRect(){return this.button.getBoundingClientRect()}constructor(t,r){super(),U(this,"popperDOM",void 0),U(this,"contentDOM",void 0),U(this,"button",void 0),U(this,"option",void 0),U(this,"isShow",!1),U(this,"content",void 0),U(this,"timeout",null),U(this,"show",()=>this.isShow||!this.contentDOM.innerHTML?this:(this.resetPopperPosition(),Hx(this.popperDOM,"l7-popper-hide"),this.isShow=!0,this.option.unique&&QM.conflictPopperList.forEach(n=>{n!==this&&n.isShow&&n.hide()}),this.emit("show"),window.addEventListener("pointerdown",this.onPopperUnClick),this)),U(this,"hide",()=>this.isShow?(Yp(this.popperDOM,"l7-popper-hide"),this.isShow=!1,this.emit("hide"),window.removeEventListener("pointerdown",this.onPopperUnClick),this):this),U(this,"setHideTimeout",()=>{this.timeout||(this.timeout=window.setTimeout(()=>{this.isShow&&(this.hide(),this.timeout=null)},300))}),U(this,"clearHideTimeout",()=>{this.timeout&&(window.clearTimeout(this.timeout),this.timeout=null)}),U(this,"onBtnClick",()=>{this.isShow?this.hide():this.show()}),U(this,"onPopperUnClick",n=>{hAt(n.target,[".l7-button-control",".l7-popper-content"])||this.hide()}),U(this,"onBtnMouseLeave",()=>{this.setHideTimeout()}),U(this,"onBtnMouseMove",()=>{this.clearHideTimeout(),!this.isShow&&this.show()}),this.button=t,this.option=r,this.init(),r.unique&&QM.conflictPopperList.push(this)}getPopperDOM(){return this.popperDOM}getIsShow(){return this.isShow}getContent(){return this.content}setContent(t){typeof t=="string"?this.contentDOM.innerHTML=t:t instanceof HTMLElement&&(DS(this.contentDOM),this.contentDOM.appendChild(t)),this.content=t}init(){const{trigger:t}=this.option;this.popperDOM=this.createPopper(),t==="click"?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}destroy(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),kh(this.popperDOM)}resetPopperPosition(){const t={},{container:r,offset:n=[0,0],placement:i}=this.option,[a,o]=n,s=this.button.getBoundingClientRect(),l=r.getBoundingClientRect(),{left:u,right:c,top:f,bottom:d}=uAt(s,l);let v=!1,g=!1;/^(left|right)/.test(i)?(i.includes("left")?t.right=`${s.width+c}px`:i.includes("right")&&(t.left=`${s.width+u}px`),i.includes("start")?t.top=`${f}px`:i.includes("end")?t.bottom=`${d}px`:(t.top=`${f+s.height/2}px`,g=!0,t.transform=`translate(${a}px, calc(${o}px - 50%))`)):/^(top|bottom)/.test(i)&&(i.includes("top")?t.bottom=`${s.height+d}px`:i.includes("bottom")&&(t.top=`${s.height+f}px`),i.includes("start")?t.left=`${u}px`:i.includes("end")?t.right=`${c}px`:(t.left=`${u+s.width/2}px`,v=!0,t.transform=`translate(calc(${a}px - 50%), ${o}px)`)),t.transform=`translate(calc(${a}px - ${v?"50%":"0%"}), calc(${o}px - ${g?"50%":"0%"})`;const x=i.split("-");x.length&&Yp(this.popperDOM,x.map(w=>`l7-popper-${w}`).join(" ")),a4(this.popperDOM,lAt(t))}createPopper(){const{container:t,className:r="",content:n}=this.option,i=Ua("div",`l7-popper l7-popper-hide ${r}`),a=Ua("div","l7-popper-content"),o=Ua("div","l7-popper-arrow");return i.appendChild(a),i.appendChild(o),t.appendChild(i),this.popperDOM=i,this.contentDOM=a,n&&this.setContent(n),i}}U(QM,"conflictPopperList",[]);const JM=e=>{const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("l7-iconfont"),t.setAttribute("aria-hidden","true");const r=document.createElementNS("http://www.w3.org/2000/svg","use");return r.setAttributeNS("http://www.w3.org/1999/xlink","href",`#${e}`),t.appendChild(r),t};class NLe extends mDt{constructor(...t){var r;super(...t),r=this,U(this,"onClick",Oe(function*(){const{onExport:n}=r.controlOption;n==null||n(yield r.getImage())})),U(this,"mergeImage",Oe(function*(...n){var i,a;const{imageType:o}=r.controlOption,{width:s=0,height:l=0}=(i=(a=r.mapsService.getContainer())===null||a===void 0?void 0:a.getBoundingClientRect())!==null&&i!==void 0?i:{},u=document.createElement("canvas");u.width=s,u.height=l;const c=u.getContext("2d");return(yield Promise.all(n.map(d=>new Promise(v=>{const g=new Image;g.onload=()=>{v(g)},g.src=d})))).forEach(d=>{c==null||c.drawImage(d,0,0,s,l)}),u.toDataURL(`image/${o}`)}))}onAdd(){const t=super.onAdd();return t.addEventListener("click",this.onClick),t}getDefault(t){return Ce(Ce({},super.getDefault(t)),{},{title:"导出图片",btnIcon:JM("l7-icon-export-picture"),imageType:"png"})}getImage(){var t=this;return Oe(function*(){const r=yield t.mapsService.exportMap("png"),n=yield t.scene.exportPng("png");return t.mergeImage(...[r,n].filter(i=>i))})()}}const U9=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],dg=(()=>{if(typeof document>"u")return!1;const e=U9[0],t={};for(const r of U9)if((r==null?void 0:r[1])in document){for(const[i,a]of r.entries())t[e[i]]=a;return t}return!1})(),$9={change:dg.fullscreenchange,error:dg.fullscreenerror};let Of={request(e=document.documentElement,t){return new Promise((r,n)=>{const i=()=>{Of.off("change",i),r()};Of.on("change",i);const a=e[dg.requestFullscreen](t);a instanceof Promise&&a.then(i).catch(n)})},exit(){return new Promise((e,t)=>{if(!Of.isFullscreen){e();return}const r=()=>{Of.off("change",r),e()};Of.on("change",r);const n=document[dg.exitFullscreen]();n instanceof Promise&&n.then(r).catch(t)})},toggle(e,t){return Of.isFullscreen?Of.exit():Of.request(e,t)},onchange(e){Of.on("change",e)},onerror(e){Of.on("error",e)},on(e,t){const r=$9[e];r&&document.addEventListener(r,t,!1)},off(e,t){const r=$9[e];r&&document.removeEventListener(r,t,!1)},raw:dg};Object.defineProperties(Of,{isFullscreen:{get:()=>!!document[dg.fullscreenElement]},element:{enumerable:!0,get:()=>{var e;return(e=document[dg.fullscreenElement])!==null&&e!==void 0?e:void 0}},isEnabled:{enumerable:!0,get:()=>!!document[dg.fullscreenEnabled]}});dg||(Of={isEnabled:!1});class yDt extends yg{getDefault(){return{position:Gx.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}onAdd(){const t=Ua("div","l7-control-logo");return this.setLogoContent(t),t}onRemove(){return null}setOptions(t){super.setOptions(t),this.checkUpdateOption(t,["img","href"])&&(DS(this.container),this.setLogoContent(this.container))}setLogoContent(t){const{href:r,img:n}=this.controlOption,i=Ua("img");if(i.setAttribute("src",n),i.setAttribute("aria-label","AntV logo"),cAt(i),r){const a=Ua("a","l7-control-logo-link");a.target="_blank",a.href=r,a.rel="noopener nofollow",a.setAttribute("rel","noopener nofollow"),a.appendChild(i),t.appendChild(a)}else t.appendChild(i)}}let _Dt=class extends yg{constructor(...t){super(...t),U(this,"mScale",void 0),U(this,"iScale",void 0),U(this,"update",()=>{const r=this.mapsService,{maxWidth:n}=this.controlOption,i=r.getSize()[1]/2,a=r.containerToLngLat([0,i]),o=r.containerToLngLat([n,i]),s=xAt([a.lng,a.lat],[o.lng,o.lat]);this.updateScales(s)})}getDefault(t){return Ce(Ce({},super.getDefault(t)),{},{name:"scale",position:Gx.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}onAdd(){const r=Ua("div","l7-control-scale");this.resetScaleLines(r);const{updateWhenIdle:n}=this.controlOption;return this.mapsService.on(n?"moveend":"mapmove",this.update),this.mapsService.on(n?"zoomend":"zoomchange",this.update),r}onRemove(){const{updateWhenIdle:t}=this.controlOption;this.mapsService.off(t?"zoomend":"zoomchange",this.update),this.mapsService.off(t?"moveend":"mapmove",this.update)}setOptions(t){super.setOptions(t),this.checkUpdateOption(t,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}updateScales(t){const{metric:r,imperial:n}=this.controlOption;r&&t&&this.updateMetric(t),n&&t&&this.updateImperial(t)}resetScaleLines(t){DS(t);const{metric:r,imperial:n,maxWidth:i,lockWidth:a}=this.controlOption;a&&a4(t,`width: ${i}px`),r&&(this.mScale=Ua("div","l7-control-scale-line",t)),n&&(this.iScale=Ua("div","l7-control-scale-line",t)),this.update()}updateScale(t,r,n){const{maxWidth:i}=this.controlOption;t.style.width=Math.round(i*n)+"px",t.innerHTML=r}getRoundNum(t){const r=Math.pow(10,(Math.floor(t)+"").length-1);let n=t/r;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1,r*n}updateMetric(t){const r=this.getRoundNum(t),n=r<1e3?r+" m":r/1e3+" km";this.updateScale(this.mScale,n,r/t)}updateImperial(t){const r=t*3.2808399;let n,i,a;r>5280?(n=r/5280,i=this.getRoundNum(n),this.updateScale(this.iScale,i+" mi",i/n)):(a=this.getRoundNum(r),this.updateScale(this.iScale,a+" ft",a/r))}};class xDt{constructor(){U(this,"mapService",void 0),U(this,"fontService",void 0)}apply(t,{styleAttributeService:r,mapService:n,fontService:i}){var a=this;this.mapService=n,this.fontService=i,t.hooks.init.tapPromise("DataMappingPlugin",Oe(function*(){t.log(El.MappingStart,uu.INIT),a.generateMaping(t,{styleAttributeService:r}),t.log(El.MappingEnd,uu.INIT)})),t.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var o=Oe(function*(s){if(!s)return s;t.dataState.dataMappingNeedUpdate=!1,t.log(El.MappingStart,uu.UPDATE);const l=a.generateMaping(t,{styleAttributeService:r});return t.log(El.MappingEnd,uu.UPDATE),l});return function(s){return o.apply(this,arguments)}}()),t.hooks.beforeRender.tap("DataMappingPlugin",()=>{const o=t.getSource();if(t.layerModelNeedUpdate||!o||!o.inited)return;const s=r.getLayerStyleAttributes()||[],l=r.getLayerStyleAttribute("filter"),{dataArray:u}=o.data;if(Array.isArray(u)&&u.length===0)return;const c=s.filter(d=>d.needRemapping);let f=u;if(l!=null&&l.needRemapping&&l!==null&&l!==void 0&&l.scale&&(f=u.filter(d=>this.applyAttributeMapping(l,d)[0])),c.length){const d=this.mapping(t,c,f,t.getEncodedData());t.setEncodedData(d)}})}generateMaping(t,{styleAttributeService:r}){const n=r.getLayerStyleAttributes()||[],i=r.getLayerStyleAttribute("filter"),{dataArray:a}=t.getSource().data;let o=a;i!=null&&i.scale&&(o=a.filter(l=>this.applyAttributeMapping(i,l)[0])),o=t.processData(o);const s=this.mapping(t,n,o,void 0);return t.setEncodedData(s),t.emit("dataUpdate",null),!0}mapping(t,r,n,i){const a=r.filter(s=>s.scale!==void 0).filter(s=>s.name!=="filter"),o=n.map((s,l)=>{const u=i?i[l]:{},c=Ce({id:s._id,coordinates:s.coordinates},u);return a.forEach(f=>{let d=this.applyAttributeMapping(f,s);(f.name==="color"||f.name==="stroke")&&(d=d.map(v=>eo(v))),c[f.name]=Array.isArray(d)&&d.length===1?d[0]:d,f.name==="shape"&&(c.shape=this.fontService.getIconFontKey(c[f.name]))}),c});return r.forEach(s=>{s.needRemapping=!1}),this.adjustData2SimpleCoordinates(o),o}adjustData2SimpleCoordinates(t){t.length>0&&this.mapService.version==="SIMPLE"&&t.map(r=>{r.simpleCoordinate||(r.coordinates=this.unProjectCoordinates(r.coordinates),r.simpleCoordinate=!0)})}unProjectCoordinates(t){if(typeof t[0]=="number")return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){const r=[];return t.map(n=>{const i=[];n.map(a=>{i.push(this.mapService.simpleMapCoord.unproject(a))}),r.push(i)}),r}else{const r=[];return t.map(n=>{r.push(this.mapService.simpleMapCoord.unproject(n))}),r}}applyAttributeMapping(t,r){var n;if(!t.scale)return[];const i=(t==null||(n=t.scale)===null||n===void 0?void 0:n.scalers)||[],a=[];return i.forEach(({field:s})=>{var l;(r.hasOwnProperty(s)||((l=t.scale)===null||l===void 0?void 0:l.type)==="variable")&&a.push(r[s])}),t.mapping?t.mapping(a):[]}getArrowPoints(t,r){const n=[r[0]-t[0],r[1]-t[1]],i=bAt(n);return[t[0]+i[0]*1e-4,t[1]+i[1]*1e-4]}}class bDt{constructor(){U(this,"mapService",void 0)}apply(t){var r=this;this.mapService=t.getContainer().mapService,t.hooks.init.tapPromise("DataSourcePlugin",Oe(function*(){t.log(El.SourceInitStart,uu.INIT);let n=t.getSource();if(!n){const{data:i,options:a}=t.sourceOption||t.defaultSourceConfig;n=new WI(i,a),t.setSource(n)}n.inited?(r.updateClusterData(t),t.log(El.SourceInitEnd,uu.INIT)):yield new Promise(i=>{n.on("update",a=>{a.type==="inited"&&(r.updateClusterData(t),t.log(El.SourceInitEnd,uu.INIT)),i(null)})})})),t.hooks.beforeRenderData.tapPromise("DataSourcePlugin",Oe(function*(){const n=r.updateClusterData(t),i=t.dataState.dataSourceNeedUpdate;return t.dataState.dataSourceNeedUpdate=!1,n||i}))}updateClusterData(t){if(t.isTileLayer||t.tileLayer||!t.getSource())return!1;const r=t.getSource(),n=r.cluster,{zoom:i=0}=r.clusterOptions,a=this.mapService.getZoom()-1,o=t.dataState.dataSourceNeedUpdate;return n&&o&&r.updateClusterData(Math.floor(a)),n&&Math.abs(t.clusterZoom-a)>=1?(i!==Math.floor(a)&&r.updateClusterData(Math.floor(a)),t.clusterZoom=a,!0):!1}}function H9(e,t){let r,n;if(t===void 0)for(const i of e)i!=null&&(r===void 0?i>=i&&(r=n=i):(r>i&&(r=i),n<i&&(n=i)));else{let i=-1;for(let a of e)(a=t(a,++i,e))!=null&&(r===void 0?a>=a&&(r=n=a):(r>a&&(r=a),n<a&&(n=a)))}return[r,n]}function EDt(e,t,r,n,i){var a=e*e,o=a*e;return((1-3*e+3*a-o)*t+(4-6*a+3*o)*r+(1+3*e+3*a-3*o)*n+o*i)/6}function wDt(e){var t=e.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,t-1):Math.floor(r*t),i=e[n],a=e[n+1],o=n>0?e[n-1]:2*i-a,s=n<t-1?e[n+2]:2*a-i;return EDt((r-n/t)*t,o,i,a,s)}}function YQ(e){return function(){return e}}function CDt(e,t){return function(r){return e+r*t}}function SDt(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function TDt(e){return(e=+e)==1?ZQ:function(t,r){return r-t?SDt(t,r,e):YQ(isNaN(t)?r:t)}}function ZQ(e,t){var r=t-e;return r?CDt(e,r):YQ(isNaN(e)?t:e)}(function e(t){var r=TDt(t);function n(i,a){var o=r((i=e0(i)).r,(a=e0(a)).r),s=r(i.g,a.g),l=r(i.b,a.b),u=ZQ(i.opacity,a.opacity);return function(c){return i.r=o(c),i.g=s(c),i.b=l(c),i.opacity=u(c),i+""}}return n.gamma=e,n})(1);function ADt(e){return function(t){var r=t.length,n=new Array(r),i=new Array(r),a=new Array(r),o,s;for(o=0;o<r;++o)s=e0(t[o]),n[o]=s.r||0,i[o]=s.g||0,a[o]=s.b||0;return n=e(n),i=e(i),a=e(a),s.opacity=1,function(l){return s.r=n(l),s.g=i(l),s.b=a(l),s+""}}}var MDt=ADt(wDt);function m4(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function qQ(e){return e.length===1&&(e=RDt(e)),{left:function(t,r,n,i){for(n==null&&(n=0),i==null&&(i=t.length);n<i;){var a=n+i>>>1;e(t[a],r)<0?n=a+1:i=a}return n},right:function(t,r,n,i){for(n==null&&(n=0),i==null&&(i=t.length);n<i;){var a=n+i>>>1;e(t[a],r)>0?i=a:n=a+1}return n}}}function RDt(e){return function(t,r){return m4(e(t),r)}}var IDt=qQ(m4),XI=IDt.right;function LDt(e){return e===null?NaN:+e}var HD=Math.sqrt(50),VD=Math.sqrt(10),GD=Math.sqrt(2);function KQ(e,t,r){var n,i=-1,a,o,s;if(t=+t,e=+e,r=+r,e===t&&r>0)return[e];if((n=t<e)&&(a=e,e=t,t=a),(s=nM(e,t,r))===0||!isFinite(s))return[];if(s>0)for(e=Math.ceil(e/s),t=Math.floor(t/s),o=new Array(a=Math.ceil(t-e+1));++i<a;)o[i]=(e+i)*s;else for(e=Math.floor(e*s),t=Math.ceil(t*s),o=new Array(a=Math.ceil(e-t+1));++i<a;)o[i]=(e-i)/s;return n&&o.reverse(),o}function nM(e,t,r){var n=(t-e)/Math.max(0,r),i=Math.floor(Math.log(n)/Math.LN10),a=n/Math.pow(10,i);return i>=0?(a>=HD?10:a>=VD?5:a>=GD?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=HD?10:a>=VD?5:a>=GD?2:1)}function WD(e,t,r){var n=Math.abs(t-e)/Math.max(0,r),i=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),a=n/i;return a>=HD?i*=10:a>=VD?i*=5:a>=GD&&(i*=2),t<e?-i:i}function ODt(e,t,r){if(r==null&&(r=LDt),!!(n=e.length)){if((t=+t)<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,i=(n-1)*t,a=Math.floor(i),o=+r(e[a],a,e),s=+r(e[a+1],a+1,e);return o+(s-o)*(i-a)}}function _0(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function QQ(e,t){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(t).domain(e);break}return this}var Lf="$";function tR(){}tR.prototype=eR.prototype={constructor:tR,has:function(e){return Lf+e in this},get:function(e){return this[Lf+e]},set:function(e,t){return this[Lf+e]=t,this},remove:function(e){var t=Lf+e;return t in this&&delete this[t]},clear:function(){for(var e in this)e[0]===Lf&&delete this[e]},keys:function(){var e=[];for(var t in this)t[0]===Lf&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)t[0]===Lf&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)t[0]===Lf&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)t[0]===Lf&&++e;return e},empty:function(){for(var e in this)if(e[0]===Lf)return!1;return!0},each:function(e){for(var t in this)t[0]===Lf&&e(this[t],t.slice(1),this)}};function eR(e,t){var r=new tR;if(e instanceof tR)e.each(function(s,l){r.set(l,s)});else if(Array.isArray(e)){var n=-1,i=e.length,a;if(t==null)for(;++n<i;)r.set(n,e[n]);else for(;++n<i;)r.set(t(a=e[n],n,e),a)}else if(e)for(var o in e)r.set(o,e[o]);return r}function V9(){}var hy=eR.prototype;V9.prototype={constructor:V9,has:hy.has,add:function(e){return e+="",this[Lf+e]=e,this},remove:hy.remove,clear:hy.clear,values:hy.keys,size:hy.size,empty:hy.empty,each:hy.each};var JQ=Array.prototype,tJ=JQ.map,i_=JQ.slice,G9={name:"implicit"};function rR(){var e=eR(),t=[],r=[],n=G9;function i(a){var o=a+"",s=e.get(o);if(!s){if(n!==G9)return n;e.set(o,s=t.push(a))}return r[(s-1)%r.length]}return i.domain=function(a){if(!arguments.length)return t.slice();t=[],e=eR();for(var o=-1,s=a.length,l,u;++o<s;)e.has(u=(l=a[o])+"")||e.set(u,t.push(l));return i},i.range=function(a){return arguments.length?(r=i_.call(a),i):r.slice()},i.unknown=function(a){return arguments.length?(n=a,i):n},i.copy=function(){return rR(t,r).unknown(n)},_0.apply(i,arguments),i}function y4(e){return function(){return e}}function PDt(e,t){return function(r){return e+r*t}}function DDt(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function FDt(e){return(e=+e)==1?eJ:function(t,r){return r-t?DDt(t,r,e):y4(isNaN(t)?r:t)}}function eJ(e,t){var r=t-e;return r?PDt(e,r):y4(isNaN(e)?t:e)}const W9=function e(t){var r=FDt(t);function n(i,a){var o=r((i=e0(i)).r,(a=e0(a)).r),s=r(i.g,a.g),l=r(i.b,a.b),u=eJ(i.opacity,a.opacity);return function(c){return i.r=o(c),i.g=s(c),i.b=l(c),i.opacity=u(c),i+""}}return n.gamma=e,n}(1);function BDt(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),i;return function(a){for(i=0;i<r;++i)n[i]=e[i]*(1-a)+t[i]*a;return n}}function NDt(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function kDt(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,i=new Array(n),a=new Array(r),o;for(o=0;o<n;++o)i[o]=_4(e[o],t[o]);for(;o<r;++o)a[o]=t[o];return function(s){for(o=0;o<n;++o)a[o]=i[o](s);return a}}function zDt(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function nR(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function UDt(e,t){var r={},n={},i;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in e?r[i]=_4(e[i],t[i]):n[i]=t[i];return function(a){for(i in r)n[i]=r[i](a);return n}}var XD=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,LO=new RegExp(XD.source,"g");function $Dt(e){return function(){return e}}function HDt(e){return function(t){return e(t)+""}}function VDt(e,t){var r=XD.lastIndex=LO.lastIndex=0,n,i,a,o=-1,s=[],l=[];for(e=e+"",t=t+"";(n=XD.exec(e))&&(i=LO.exec(t));)(a=i.index)>r&&(a=t.slice(r,a),s[o]?s[o]+=a:s[++o]=a),(n=n[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,l.push({i:o,x:nR(n,i)})),r=LO.lastIndex;return r<t.length&&(a=t.slice(r),s[o]?s[o]+=a:s[++o]=a),s.length<2?l[0]?HDt(l[0].x):$Dt(t):(t=l.length,function(u){for(var c=0,f;c<t;++c)s[(f=l[c]).i]=f.x(u);return s.join("")})}function _4(e,t){var r=typeof t,n;return t==null||r==="boolean"?y4(t):(r==="number"?nR:r==="string"?(n=t0(t))?(t=n,W9):VDt:t instanceof t0?W9:t instanceof Date?zDt:NDt(t)?BDt:Array.isArray(t)?kDt:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?UDt:nR)(e,t)}function GDt(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function WDt(e){return function(){return e}}function XDt(e){return+e}var X9=[0,1];function Fu(e){return e}function jD(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:WDt(isNaN(t)?NaN:.5)}function j9(e){var t=e[0],r=e[e.length-1],n;return t>r&&(n=t,t=r,r=n),function(i){return Math.max(t,Math.min(r,i))}}function jDt(e,t,r){var n=e[0],i=e[1],a=t[0],o=t[1];return i<n?(n=jD(i,n),a=r(o,a)):(n=jD(n,i),a=r(a,o)),function(s){return a(n(s))}}function YDt(e,t,r){var n=Math.min(e.length,t.length)-1,i=new Array(n),a=new Array(n),o=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<n;)i[o]=jD(e[o],e[o+1]),a[o]=r(t[o],t[o+1]);return function(s){var l=XI(e,s,1,n)-1;return a[l](i[l](s))}}function jI(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function x4(){var e=X9,t=X9,r=_4,n,i,a,o=Fu,s,l,u;function c(){return s=Math.min(e.length,t.length)>2?YDt:jDt,l=u=null,f}function f(d){return isNaN(d=+d)?a:(l||(l=s(e.map(n),t,r)))(n(o(d)))}return f.invert=function(d){return o(i((u||(u=s(t,e.map(n),nR)))(d)))},f.domain=function(d){return arguments.length?(e=tJ.call(d,XDt),o===Fu||(o=j9(e)),c()):e.slice()},f.range=function(d){return arguments.length?(t=i_.call(d),c()):t.slice()},f.rangeRound=function(d){return t=i_.call(d),r=GDt,c()},f.clamp=function(d){return arguments.length?(o=d?j9(e):Fu,f):o!==Fu},f.interpolate=function(d){return arguments.length?(r=d,c()):r},f.unknown=function(d){return arguments.length?(a=d,f):a},function(d,v){return n=d,i=v,c()}}function rJ(e,t){return x4()(e,t)}function ZDt(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function iR(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function Yx(e){return e=iR(Math.abs(e)),e?e[1]:NaN}function qDt(e,t){return function(r,n){for(var i=r.length,a=[],o=0,s=e[0],l=0;i>0&&s>0&&(l+s+1>n&&(s=Math.max(1,n-l)),a.push(r.substring(i-=s,i+s)),!((l+=s+1)>n));)s=e[o=(o+1)%e.length];return a.reverse().join(t)}}function KDt(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var QDt=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function aR(e){if(!(t=QDt.exec(e)))throw new Error("invalid format: "+e);var t;return new b4({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}aR.prototype=b4.prototype;function b4(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}b4.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function JDt(e){t:for(var t=e.length,r=1,n=-1,i;r<t;++r)switch(e[r]){case".":n=i=r;break;case"0":n===0&&(n=r),i=r;break;default:if(!+e[r])break t;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(i+1):e}var nJ;function tFt(e,t){var r=iR(e,t);if(!r)return e+"";var n=r[0],i=r[1],a=i-(nJ=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=n.length;return a===o?n:a>o?n+new Array(a-o+1).join("0"):a>0?n.slice(0,a)+"."+n.slice(a):"0."+new Array(1-a).join("0")+iR(e,Math.max(0,t+a-1))[0]}function Y9(e,t){var r=iR(e,t);if(!r)return e+"";var n=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}const Z9={"%":function(e,t){return(e*100).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:ZDt,e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return Y9(e*100,t)},r:Y9,s:tFt,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function q9(e){return e}var K9=Array.prototype.map,Q9=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function eFt(e){var t=e.grouping===void 0||e.thousands===void 0?q9:qDt(K9.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",a=e.numerals===void 0?q9:KDt(K9.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",s=e.minus===void 0?"-":e.minus+"",l=e.nan===void 0?"NaN":e.nan+"";function u(f){f=aR(f);var d=f.fill,v=f.align,g=f.sign,x=f.symbol,w=f.zero,S=f.width,M=f.comma,R=f.precision,I=f.trim,P=f.type;P==="n"?(M=!0,P="g"):Z9[P]||(R===void 0&&(R=12),I=!0,P="g"),(w||d==="0"&&v==="=")&&(w=!0,d="0",v="=");var k=x==="$"?r:x==="#"&&/[boxX]/.test(P)?"0"+P.toLowerCase():"",z=x==="$"?n:/[%p]/.test(P)?o:"",G=Z9[P],J=/[defgprs%]/.test(P);R=R===void 0?6:/[gprs]/.test(P)?Math.max(1,Math.min(21,R)):Math.max(0,Math.min(20,R));function Z(X){var et=k,at=z,wt,Tt,vt;if(P==="c")at=G(X)+at,X="";else{X=+X;var zt=X<0||1/X<0;if(X=isNaN(X)?l:G(Math.abs(X),R),I&&(X=JDt(X)),zt&&+X==0&&g!=="+"&&(zt=!1),et=(zt?g==="("?g:s:g==="-"||g==="("?"":g)+et,at=(P==="s"?Q9[8+nJ/3]:"")+at+(zt&&g==="("?")":""),J){for(wt=-1,Tt=X.length;++wt<Tt;)if(vt=X.charCodeAt(wt),48>vt||vt>57){at=(vt===46?i+X.slice(wt+1):X.slice(wt))+at,X=X.slice(0,wt);break}}}M&&!w&&(X=t(X,1/0));var oe=et.length+X.length+at.length,Qt=oe<S?new Array(S-oe+1).join(d):"";switch(M&&w&&(X=t(Qt+X,Qt.length?S-at.length:1/0),Qt=""),v){case"<":X=et+X+at+Qt;break;case"=":X=et+Qt+X+at;break;case"^":X=Qt.slice(0,oe=Qt.length>>1)+et+X+at+Qt.slice(oe);break;default:X=Qt+et+X+at;break}return a(X)}return Z.toString=function(){return f+""},Z}function c(f,d){var v=u((f=aR(f),f.type="f",f)),g=Math.max(-8,Math.min(8,Math.floor(Yx(d)/3)))*3,x=Math.pow(10,-g),w=Q9[8+g/3];return function(S){return v(x*S)+w}}return{format:u,formatPrefix:c}}var RT,E4,iJ;rFt({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function rFt(e){return RT=eFt(e),E4=RT.format,iJ=RT.formatPrefix,RT}function nFt(e){return Math.max(0,-Yx(Math.abs(e)))}function iFt(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Yx(t)/3)))*3-Yx(Math.abs(e)))}function aFt(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Yx(t)-Yx(e))+1}function oFt(e,t,r,n){var i=WD(e,t,r),a;switch(n=aR(n??",f"),n.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(a=iFt(i,o))&&(n.precision=a),iJ(n,o)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(a=aFt(i,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=a-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(a=nFt(i))&&(n.precision=a-(n.type==="%")*2);break}}return E4(n)}function kS(e){var t=e.domain;return e.ticks=function(r){var n=t();return KQ(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var i=t();return oFt(i[0],i[i.length-1],r??10,n)},e.nice=function(r){r==null&&(r=10);var n=t(),i=0,a=n.length-1,o=n[i],s=n[a],l;return s<o&&(l=o,o=s,s=l,l=i,i=a,a=l),l=nM(o,s,r),l>0?(o=Math.floor(o/l)*l,s=Math.ceil(s/l)*l,l=nM(o,s,r)):l<0&&(o=Math.ceil(o*l)/l,s=Math.floor(s*l)/l,l=nM(o,s,r)),l>0?(n[i]=Math.floor(o/l)*l,n[a]=Math.ceil(s/l)*l,t(n)):l<0&&(n[i]=Math.ceil(o*l)/l,n[a]=Math.floor(s*l)/l,t(n)),e},e}function aJ(){var e=rJ(Fu,Fu);return e.copy=function(){return jI(e,aJ())},_0.apply(e,arguments),kS(e)}function oJ(e,t){e=e.slice();var r=0,n=e.length-1,i=e[r],a=e[n],o;return a<i&&(o=r,r=n,n=o,o=i,i=a,a=o),e[r]=t.floor(i),e[n]=t.ceil(a),e}function J9(e){return Math.log(e)}function t$(e){return Math.exp(e)}function sFt(e){return-Math.log(-e)}function lFt(e){return-Math.exp(-e)}function uFt(e){return isFinite(e)?+("1e"+e):e<0?0:e}function cFt(e){return e===10?uFt:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}function hFt(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}function e$(e){return function(t){return-e(-t)}}function fFt(e){var t=e(J9,t$),r=t.domain,n=10,i,a;function o(){return i=hFt(n),a=cFt(n),r()[0]<0?(i=e$(i),a=e$(a),e(sFt,lFt)):e(J9,t$),t}return t.base=function(s){return arguments.length?(n=+s,o()):n},t.domain=function(s){return arguments.length?(r(s),o()):r()},t.ticks=function(s){var l=r(),u=l[0],c=l[l.length-1],f;(f=c<u)&&(d=u,u=c,c=d);var d=i(u),v=i(c),g,x,w,S=s==null?10:+s,M=[];if(!(n%1)&&v-d<S){if(d=Math.round(d)-1,v=Math.round(v)+1,u>0){for(;d<v;++d)for(x=1,g=a(d);x<n;++x)if(w=g*x,!(w<u)){if(w>c)break;M.push(w)}}else for(;d<v;++d)for(x=n-1,g=a(d);x>=1;--x)if(w=g*x,!(w<u)){if(w>c)break;M.push(w)}}else M=KQ(d,v,Math.min(v-d,S)).map(a);return f?M.reverse():M},t.tickFormat=function(s,l){if(l==null&&(l=n===10?".0e":","),typeof l!="function"&&(l=E4(l)),s===1/0)return l;s==null&&(s=10);var u=Math.max(1,n*s/t.ticks().length);return function(c){var f=c/a(Math.round(i(c)));return f*n<n-.5&&(f*=n),f<=u?l(c):""}},t.nice=function(){return r(oJ(r(),{floor:function(s){return a(Math.floor(i(s)))},ceil:function(s){return a(Math.ceil(i(s)))}}))},t}function sJ(){var e=fFt(x4()).domain([1,10]);return e.copy=function(){return jI(e,sJ()).base(e.base())},_0.apply(e,arguments),e}function r$(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function dFt(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function pFt(e){return e<0?-e*e:e*e}function vFt(e){var t=e(Fu,Fu),r=1;function n(){return r===1?e(Fu,Fu):r===.5?e(dFt,pFt):e(r$(r),r$(1/r))}return t.exponent=function(i){return arguments.length?(r=+i,n()):r},kS(t)}function lJ(){var e=vFt(x4());return e.copy=function(){return jI(e,lJ()).exponent(e.exponent())},_0.apply(e,arguments),e}function uJ(){var e=[],t=[],r=[],n;function i(){var o=0,s=Math.max(1,t.length);for(r=new Array(s-1);++o<s;)r[o-1]=ODt(e,o/s);return a}function a(o){return isNaN(o=+o)?n:t[XI(r,o)]}return a.invertExtent=function(o){var s=t.indexOf(o);return s<0?[NaN,NaN]:[s>0?r[s-1]:e[0],s<r.length?r[s]:e[e.length-1]]},a.domain=function(o){if(!arguments.length)return e.slice();e=[];for(var s=0,l=o.length,u;s<l;++s)u=o[s],u!=null&&!isNaN(u=+u)&&e.push(u);return e.sort(m4),i()},a.range=function(o){return arguments.length?(t=i_.call(o),i()):t.slice()},a.unknown=function(o){return arguments.length?(n=o,a):n},a.quantiles=function(){return r.slice()},a.copy=function(){return uJ().domain(e).range(t).unknown(n)},_0.apply(a,arguments)}function cJ(){var e=0,t=1,r=1,n=[.5],i=[0,1],a;function o(l){return l<=l?i[XI(n,l,0,r)]:a}function s(){var l=-1;for(n=new Array(r);++l<r;)n[l]=((l+1)*t-(l-r)*e)/(r+1);return o}return o.domain=function(l){return arguments.length?(e=+l[0],t=+l[1],s()):[e,t]},o.range=function(l){return arguments.length?(r=(i=i_.call(l)).length-1,s()):i.slice()},o.invertExtent=function(l){var u=i.indexOf(l);return u<0?[NaN,NaN]:u<1?[e,n[0]]:u>=r?[n[r-1],t]:[n[u-1],n[u]]},o.unknown=function(l){return arguments.length&&(a=l),o},o.thresholds=function(){return n.slice()},o.copy=function(){return cJ().domain([e,t]).range(i).unknown(a)},_0.apply(kS(o),arguments)}function hJ(){var e=[.5],t=[0,1],r,n=1;function i(a){return a<=a?t[XI(e,a,0,n)]:r}return i.domain=function(a){return arguments.length?(e=i_.call(a),n=Math.min(e.length,t.length-1),i):e.slice()},i.range=function(a){return arguments.length?(t=i_.call(a),n=Math.min(e.length,t.length-1),i):t.slice()},i.invertExtent=function(a){var o=t.indexOf(a);return[e[o-1],e[o]]},i.unknown=function(a){return arguments.length?(r=a,i):r},i.copy=function(){return hJ().domain(e).range(t).unknown(r)},_0.apply(i,arguments)}var OO=new Date,PO=new Date;function fc(e,t,r,n){function i(a){return e(a=arguments.length===0?new Date:new Date(+a)),a}return i.floor=function(a){return e(a=new Date(+a)),a},i.ceil=function(a){return e(a=new Date(a-1)),t(a,1),e(a),a},i.round=function(a){var o=i(a),s=i.ceil(a);return a-o<s-a?o:s},i.offset=function(a,o){return t(a=new Date(+a),o==null?1:Math.floor(o)),a},i.range=function(a,o,s){var l=[],u;if(a=i.ceil(a),s=s==null?1:Math.floor(s),!(a<o)||!(s>0))return l;do l.push(u=new Date(+a)),t(a,s),e(a);while(u<a&&a<o);return l},i.filter=function(a){return fc(function(o){if(o>=o)for(;e(o),!a(o);)o.setTime(o-1)},function(o,s){if(o>=o)if(s<0)for(;++s<=0;)for(;t(o,-1),!a(o););else for(;--s>=0;)for(;t(o,1),!a(o););})},r&&(i.count=function(a,o){return OO.setTime(+a),PO.setTime(+o),e(OO),e(PO),Math.floor(r(OO,PO))},i.every=function(a){return a=Math.floor(a),!isFinite(a)||!(a>0)?null:a>1?i.filter(n?function(o){return n(o)%a===0}:function(o){return i.count(0,o)%a===0}):i}),i}var oR=fc(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});oR.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?fc(function(t){t.setTime(Math.floor(t/e)*e)},function(t,r){t.setTime(+t+r*e)},function(t,r){return(r-t)/e}):oR};const gFt=oR;oR.range;var sR=1e3,MC=6e4,n$=36e5,fJ=864e5,dJ=6048e5,pJ=fc(function(e){e.setTime(e-e.getMilliseconds())},function(e,t){e.setTime(+e+t*sR)},function(e,t){return(t-e)/sR},function(e){return e.getUTCSeconds()});const mFt=pJ;pJ.range;var vJ=fc(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*sR)},function(e,t){e.setTime(+e+t*MC)},function(e,t){return(t-e)/MC},function(e){return e.getMinutes()});const yFt=vJ;vJ.range;var gJ=fc(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*sR-e.getMinutes()*MC)},function(e,t){e.setTime(+e+t*n$)},function(e,t){return(t-e)/n$},function(e){return e.getHours()});const _Ft=gJ;gJ.range;var mJ=fc(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*MC)/fJ},function(e){return e.getDate()-1});const w4=mJ;mJ.range;function R_(e){return fc(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(t,r){t.setDate(t.getDate()+r*7)},function(t,r){return(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*MC)/dJ})}var C4=R_(0),lR=R_(1),xFt=R_(2),bFt=R_(3),Zx=R_(4),EFt=R_(5),wFt=R_(6);C4.range;lR.range;xFt.range;bFt.range;Zx.range;EFt.range;wFt.range;var yJ=fc(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()});const CFt=yJ;yJ.range;var S4=fc(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});S4.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:fc(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,r){t.setFullYear(t.getFullYear()+r*e)})};const qx=S4;S4.range;var _J=fc(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/fJ},function(e){return e.getUTCDate()-1});const xJ=_J;_J.range;function I_(e){return fc(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(t,r){t.setUTCDate(t.getUTCDate()+r*7)},function(t,r){return(r-t)/dJ})}var bJ=I_(0),uR=I_(1),SFt=I_(2),TFt=I_(3),Kx=I_(4),AFt=I_(5),MFt=I_(6);bJ.range;uR.range;SFt.range;TFt.range;Kx.range;AFt.range;MFt.range;var T4=fc(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});T4.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:fc(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,r){t.setUTCFullYear(t.getUTCFullYear()+r*e)})};const RC=T4;T4.range;function DO(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function FO(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function WE(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function RFt(e){var t=e.dateTime,r=e.date,n=e.time,i=e.periods,a=e.days,o=e.shortDays,s=e.months,l=e.shortMonths,u=XE(i),c=jE(i),f=XE(a),d=jE(a),v=XE(o),g=jE(o),x=XE(s),w=jE(s),S=XE(l),M=jE(l),R={a:zt,A:oe,b:Qt,B:ne,c:null,d:u$,e:u$,f:QFt,g:lBt,G:cBt,H:ZFt,I:qFt,j:KFt,L:EJ,m:JFt,M:tBt,p:de,q:De,Q:f$,s:d$,S:eBt,u:rBt,U:nBt,V:iBt,w:aBt,W:oBt,x:null,X:null,y:sBt,Y:uBt,Z:hBt,"%":h$},I={a:Ze,A:ke,b:Be,B:Zr,c:null,d:c$,e:c$,f:vBt,g:SBt,G:ABt,H:fBt,I:dBt,j:pBt,L:CJ,m:gBt,M:mBt,p:Wr,q:In,Q:f$,s:d$,S:yBt,u:_Bt,U:xBt,V:bBt,w:EBt,W:wBt,x:null,X:null,y:CBt,Y:TBt,Z:MBt,"%":h$},P={a:Z,A:X,b:et,B:at,c:wt,d:s$,e:s$,f:WFt,g:o$,G:a$,H:l$,I:l$,j:$Ft,L:GFt,m:UFt,M:HFt,p:J,q:zFt,Q:jFt,s:YFt,S:VFt,u:DFt,U:FFt,V:BFt,w:PFt,W:NFt,x:Tt,X:vt,y:o$,Y:a$,Z:kFt,"%":XFt};R.x=k(r,R),R.X=k(n,R),R.c=k(t,R),I.x=k(r,I),I.X=k(n,I),I.c=k(t,I);function k(re,nr){return function(zr){var Ne=[],Vr=-1,xn=0,Qn=re.length,gn,bn,ci;for(zr instanceof Date||(zr=new Date(+zr));++Vr<Qn;)re.charCodeAt(Vr)===37&&(Ne.push(re.slice(xn,Vr)),(bn=i$[gn=re.charAt(++Vr)])!=null?gn=re.charAt(++Vr):bn=gn==="e"?" ":"0",(ci=nr[gn])&&(gn=ci(zr,bn)),Ne.push(gn),xn=Vr+1);return Ne.push(re.slice(xn,Vr)),Ne.join("")}}function z(re,nr){return function(zr){var Ne=WE(1900,void 0,1),Vr=G(Ne,re,zr+="",0),xn,Qn;if(Vr!=zr.length)return null;if("Q"in Ne)return new Date(Ne.Q);if("s"in Ne)return new Date(Ne.s*1e3+("L"in Ne?Ne.L:0));if(nr&&!("Z"in Ne)&&(Ne.Z=0),"p"in Ne&&(Ne.H=Ne.H%12+Ne.p*12),Ne.m===void 0&&(Ne.m="q"in Ne?Ne.q:0),"V"in Ne){if(Ne.V<1||Ne.V>53)return null;"w"in Ne||(Ne.w=1),"Z"in Ne?(xn=FO(WE(Ne.y,0,1)),Qn=xn.getUTCDay(),xn=Qn>4||Qn===0?uR.ceil(xn):uR(xn),xn=xJ.offset(xn,(Ne.V-1)*7),Ne.y=xn.getUTCFullYear(),Ne.m=xn.getUTCMonth(),Ne.d=xn.getUTCDate()+(Ne.w+6)%7):(xn=DO(WE(Ne.y,0,1)),Qn=xn.getDay(),xn=Qn>4||Qn===0?lR.ceil(xn):lR(xn),xn=w4.offset(xn,(Ne.V-1)*7),Ne.y=xn.getFullYear(),Ne.m=xn.getMonth(),Ne.d=xn.getDate()+(Ne.w+6)%7)}else("W"in Ne||"U"in Ne)&&("w"in Ne||(Ne.w="u"in Ne?Ne.u%7:"W"in Ne?1:0),Qn="Z"in Ne?FO(WE(Ne.y,0,1)).getUTCDay():DO(WE(Ne.y,0,1)).getDay(),Ne.m=0,Ne.d="W"in Ne?(Ne.w+6)%7+Ne.W*7-(Qn+5)%7:Ne.w+Ne.U*7-(Qn+6)%7);return"Z"in Ne?(Ne.H+=Ne.Z/100|0,Ne.M+=Ne.Z%100,FO(Ne)):DO(Ne)}}function G(re,nr,zr,Ne){for(var Vr=0,xn=nr.length,Qn=zr.length,gn,bn;Vr<xn;){if(Ne>=Qn)return-1;if(gn=nr.charCodeAt(Vr++),gn===37){if(gn=nr.charAt(Vr++),bn=P[gn in i$?nr.charAt(Vr++):gn],!bn||(Ne=bn(re,zr,Ne))<0)return-1}else if(gn!=zr.charCodeAt(Ne++))return-1}return Ne}function J(re,nr,zr){var Ne=u.exec(nr.slice(zr));return Ne?(re.p=c[Ne[0].toLowerCase()],zr+Ne[0].length):-1}function Z(re,nr,zr){var Ne=v.exec(nr.slice(zr));return Ne?(re.w=g[Ne[0].toLowerCase()],zr+Ne[0].length):-1}function X(re,nr,zr){var Ne=f.exec(nr.slice(zr));return Ne?(re.w=d[Ne[0].toLowerCase()],zr+Ne[0].length):-1}function et(re,nr,zr){var Ne=S.exec(nr.slice(zr));return Ne?(re.m=M[Ne[0].toLowerCase()],zr+Ne[0].length):-1}function at(re,nr,zr){var Ne=x.exec(nr.slice(zr));return Ne?(re.m=w[Ne[0].toLowerCase()],zr+Ne[0].length):-1}function wt(re,nr,zr){return G(re,t,nr,zr)}function Tt(re,nr,zr){return G(re,r,nr,zr)}function vt(re,nr,zr){return G(re,n,nr,zr)}function zt(re){return o[re.getDay()]}function oe(re){return a[re.getDay()]}function Qt(re){return l[re.getMonth()]}function ne(re){return s[re.getMonth()]}function de(re){return i[+(re.getHours()>=12)]}function De(re){return 1+~~(re.getMonth()/3)}function Ze(re){return o[re.getUTCDay()]}function ke(re){return a[re.getUTCDay()]}function Be(re){return l[re.getUTCMonth()]}function Zr(re){return s[re.getUTCMonth()]}function Wr(re){return i[+(re.getUTCHours()>=12)]}function In(re){return 1+~~(re.getUTCMonth()/3)}return{format:function(re){var nr=k(re+="",R);return nr.toString=function(){return re},nr},parse:function(re){var nr=z(re+="",!1);return nr.toString=function(){return re},nr},utcFormat:function(re){var nr=k(re+="",I);return nr.toString=function(){return re},nr},utcParse:function(re){var nr=z(re+="",!0);return nr.toString=function(){return re},nr}}}var i$={"-":"",_:" ",0:"0"},jl=/^\s*\d+/,IFt=/^%/,LFt=/[\\^$*+?|[\]().{}]/g;function Da(e,t,r){var n=e<0?"-":"",i=(n?-e:e)+"",a=i.length;return n+(a<r?new Array(r-a+1).join(t)+i:i)}function OFt(e){return e.replace(LFt,"\\$&")}function XE(e){return new RegExp("^(?:"+e.map(OFt).join("|")+")","i")}function jE(e){for(var t={},r=-1,n=e.length;++r<n;)t[e[r].toLowerCase()]=r;return t}function PFt(e,t,r){var n=jl.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function DFt(e,t,r){var n=jl.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function FFt(e,t,r){var n=jl.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function BFt(e,t,r){var n=jl.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function NFt(e,t,r){var n=jl.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function a$(e,t,r){var n=jl.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function o$(e,t,r){var n=jl.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function kFt(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function zFt(e,t,r){var n=jl.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function UFt(e,t,r){var n=jl.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function s$(e,t,r){var n=jl.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function $Ft(e,t,r){var n=jl.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function l$(e,t,r){var n=jl.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function HFt(e,t,r){var n=jl.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function VFt(e,t,r){var n=jl.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function GFt(e,t,r){var n=jl.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function WFt(e,t,r){var n=jl.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function XFt(e,t,r){var n=IFt.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function jFt(e,t,r){var n=jl.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function YFt(e,t,r){var n=jl.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function u$(e,t){return Da(e.getDate(),t,2)}function ZFt(e,t){return Da(e.getHours(),t,2)}function qFt(e,t){return Da(e.getHours()%12||12,t,2)}function KFt(e,t){return Da(1+w4.count(qx(e),e),t,3)}function EJ(e,t){return Da(e.getMilliseconds(),t,3)}function QFt(e,t){return EJ(e,t)+"000"}function JFt(e,t){return Da(e.getMonth()+1,t,2)}function tBt(e,t){return Da(e.getMinutes(),t,2)}function eBt(e,t){return Da(e.getSeconds(),t,2)}function rBt(e){var t=e.getDay();return t===0?7:t}function nBt(e,t){return Da(C4.count(qx(e)-1,e),t,2)}function wJ(e){var t=e.getDay();return t>=4||t===0?Zx(e):Zx.ceil(e)}function iBt(e,t){return e=wJ(e),Da(Zx.count(qx(e),e)+(qx(e).getDay()===4),t,2)}function aBt(e){return e.getDay()}function oBt(e,t){return Da(lR.count(qx(e)-1,e),t,2)}function sBt(e,t){return Da(e.getFullYear()%100,t,2)}function lBt(e,t){return e=wJ(e),Da(e.getFullYear()%100,t,2)}function uBt(e,t){return Da(e.getFullYear()%1e4,t,4)}function cBt(e,t){var r=e.getDay();return e=r>=4||r===0?Zx(e):Zx.ceil(e),Da(e.getFullYear()%1e4,t,4)}function hBt(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Da(t/60|0,"0",2)+Da(t%60,"0",2)}function c$(e,t){return Da(e.getUTCDate(),t,2)}function fBt(e,t){return Da(e.getUTCHours(),t,2)}function dBt(e,t){return Da(e.getUTCHours()%12||12,t,2)}function pBt(e,t){return Da(1+xJ.count(RC(e),e),t,3)}function CJ(e,t){return Da(e.getUTCMilliseconds(),t,3)}function vBt(e,t){return CJ(e,t)+"000"}function gBt(e,t){return Da(e.getUTCMonth()+1,t,2)}function mBt(e,t){return Da(e.getUTCMinutes(),t,2)}function yBt(e,t){return Da(e.getUTCSeconds(),t,2)}function _Bt(e){var t=e.getUTCDay();return t===0?7:t}function xBt(e,t){return Da(bJ.count(RC(e)-1,e),t,2)}function SJ(e){var t=e.getUTCDay();return t>=4||t===0?Kx(e):Kx.ceil(e)}function bBt(e,t){return e=SJ(e),Da(Kx.count(RC(e),e)+(RC(e).getUTCDay()===4),t,2)}function EBt(e){return e.getUTCDay()}function wBt(e,t){return Da(uR.count(RC(e)-1,e),t,2)}function CBt(e,t){return Da(e.getUTCFullYear()%100,t,2)}function SBt(e,t){return e=SJ(e),Da(e.getUTCFullYear()%100,t,2)}function TBt(e,t){return Da(e.getUTCFullYear()%1e4,t,4)}function ABt(e,t){var r=e.getUTCDay();return e=r>=4||r===0?Kx(e):Kx.ceil(e),Da(e.getUTCFullYear()%1e4,t,4)}function MBt(){return"+0000"}function h$(){return"%"}function f$(e){return+e}function d$(e){return Math.floor(+e/1e3)}var F1,TJ;RBt({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function RBt(e){return F1=RFt(e),TJ=F1.format,F1.parse,F1.utcFormat,F1.utcParse,F1}var Aw=1e3,Mw=Aw*60,Rw=Mw*60,IC=Rw*24,IBt=IC*7,p$=IC*30,BO=IC*365;function LBt(e){return new Date(e)}function OBt(e){return e instanceof Date?+e:+new Date(+e)}function AJ(e,t,r,n,i,a,o,s,l){var u=rJ(Fu,Fu),c=u.invert,f=u.domain,d=l(".%L"),v=l(":%S"),g=l("%I:%M"),x=l("%I %p"),w=l("%a %d"),S=l("%b %d"),M=l("%B"),R=l("%Y"),I=[[o,1,Aw],[o,5,5*Aw],[o,15,15*Aw],[o,30,30*Aw],[a,1,Mw],[a,5,5*Mw],[a,15,15*Mw],[a,30,30*Mw],[i,1,Rw],[i,3,3*Rw],[i,6,6*Rw],[i,12,12*Rw],[n,1,IC],[n,2,2*IC],[r,1,IBt],[t,1,p$],[t,3,3*p$],[e,1,BO]];function P(z){return(o(z)<z?d:a(z)<z?v:i(z)<z?g:n(z)<z?x:t(z)<z?r(z)<z?w:S:e(z)<z?M:R)(z)}function k(z,G,J,Z){if(z==null&&(z=10),typeof z=="number"){var X=Math.abs(J-G)/z,et=qQ(function(at){return at[2]}).right(I,X);et===I.length?(Z=WD(G/BO,J/BO,z),z=e):et?(et=I[X/I[et-1][2]<I[et][2]/X?et-1:et],Z=et[1],z=et[0]):(Z=Math.max(WD(G,J,z),1),z=s)}return Z==null?z:z.every(Z)}return u.invert=function(z){return new Date(c(z))},u.domain=function(z){return arguments.length?f(tJ.call(z,OBt)):f().map(LBt)},u.ticks=function(z,G){var J=f(),Z=J[0],X=J[J.length-1],et=X<Z,at;return et&&(at=Z,Z=X,X=at),at=k(z,Z,X,G),at=at?at.range(Z,X+1):[],et?at.reverse():at},u.tickFormat=function(z,G){return G==null?P:l(G)},u.nice=function(z,G){var J=f();return(z=k(z,J[0],J[J.length-1],G))?f(oJ(J,z)):u},u.copy=function(){return jI(u,AJ(e,t,r,n,i,a,o,s,l))},u}function PBt(){return _0.apply(AJ(qx,CFt,C4,w4,_Ft,yFt,mFt,gFt,TJ).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function DBt(){var e=0,t=1,r,n,i,a,o=Fu,s=!1,l;function u(c){return isNaN(c=+c)?l:o(i===0?.5:(c=(a(c)-r)*i,s?Math.max(0,Math.min(1,c)):c))}return u.domain=function(c){return arguments.length?(r=a(e=+c[0]),n=a(t=+c[1]),i=r===n?0:1/(n-r),u):[e,t]},u.clamp=function(c){return arguments.length?(s=!!c,u):s},u.interpolator=function(c){return arguments.length?(o=c,u):o},u.unknown=function(c){return arguments.length?(l=c,u):l},function(c){return a=c,r=c(e),n=c(t),i=r===n?0:1/(n-r),u}}function MJ(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function RJ(){var e=kS(DBt()(Fu));return e.copy=function(){return MJ(e,RJ())},QQ.apply(e,arguments)}function FBt(){var e=0,t=.5,r=1,n,i,a,o,s,l=Fu,u,c=!1,f;function d(v){return isNaN(v=+v)?f:(v=.5+((v=+u(v))-i)*(v<i?o:s),l(c?Math.max(0,Math.min(1,v)):v))}return d.domain=function(v){return arguments.length?(n=u(e=+v[0]),i=u(t=+v[1]),a=u(r=+v[2]),o=n===i?0:.5/(i-n),s=i===a?0:.5/(a-i),d):[e,t,r]},d.clamp=function(v){return arguments.length?(c=!!v,d):c},d.interpolator=function(v){return arguments.length?(l=v,d):l},d.unknown=function(v){return arguments.length?(f=v,d):f},function(v){return u=v,n=v(e),i=v(t),a=v(r),o=n===i?0:.5/(i-n),s=i===a?0:.5/(a-i),d}}function IJ(){var e=kS(FBt()(Fu));return e.copy=function(){return MJ(e,IJ())},QQ.apply(e,arguments)}function LJ(e){let t,r=[];function n(i){return i??t}return n.invert=n,n.domain=n.range=i=>i?(r=i,i):r,n.unknown=i=>i?(t=i,i):t,n.copy=()=>LJ().unknown(t),n}const{isNil:NO,isString:BBt,uniq:NBt}=as,kBt=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,zBt={[Na.LINEAR]:aJ,[Na.POWER]:lJ,[Na.LOG]:sJ,[Na.IDENTITY]:LJ,[Na.SEQUENTIAL]:RJ,[Na.TIME]:PBt,[Na.QUANTILE]:uJ,[Na.QUANTIZE]:cJ,[Na.THRESHOLD]:hJ,[Na.CAT]:rR,[Na.DIVERGING]:IJ};class UBt{constructor(){U(this,"scaleOptions",{})}apply(t,{styleAttributeService:r}){var n=this;t.hooks.init.tapPromise("FeatureScalePlugin",Oe(function*(){var i;t.log(El.ScaleInitStart,uu.INIT),n.scaleOptions=t.getScaleOptions();const a=r.getLayerStyleAttributes(),o=(i=t.getSource())===null||i===void 0?void 0:i.data.dataArray;Array.isArray(o)&&o.length===0||(n.caculateScalesForAttributes(a||[],o),t.log(El.ScaleInitEnd,uu.INIT))})),t.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var i=Oe(function*(a){if(!a)return a;t.log(El.ScaleInitStart,uu.UPDATE),n.scaleOptions=t.getScaleOptions();const o=r.getLayerStyleAttributes(),s=t.getSource().data.dataArray;return Array.isArray(s)&&s.length===0||(n.caculateScalesForAttributes(o||[],s),t.log(El.ScaleInitEnd,uu.UPDATE),t.layerModelNeedUpdate=!0),!0});return function(a){return i.apply(this,arguments)}}()),t.hooks.beforeRender.tap("FeatureScalePlugin",()=>{if(t.layerModelNeedUpdate)return;this.scaleOptions=t.getScaleOptions();const i=r.getLayerStyleAttributes(),a=t.getSource().data.dataArray;if(!(Array.isArray(a)&&a.length===0)&&i){const o=i.filter(s=>s.needRescale);o.length&&this.caculateScalesForAttributes(o,a)}})}isNumber(t){return!isNaN(parseFloat(t))&&isFinite(t)}caculateScalesForAttributes(t,r){t.forEach(n=>{if(n.scale){const i=n.scale,a=n.scale.field;i.names=this.parseFields(NO(a)?[]:a);const o=[];i.names.forEach(s=>{var l;o.push(this.createScale(s,n.name,(l=n.scale)===null||l===void 0?void 0:l.values,r))}),o.some(s=>s.type===D1.VARIABLE)?(i.type=D1.VARIABLE,o.forEach(s=>{if(!i.callback&&i.values!=="text"){var l;switch((l=s.option)===null||l===void 0?void 0:l.type){case Na.LOG:case Na.LINEAR:case Na.POWER:if(i.values&&i.values.length>2){const c=s.scale.ticks(i.values.length);s.scale.domain(c)}i.values?s.scale.range(i.values):s.scale.range(s.option.domain);break;case Na.QUANTILE:case Na.QUANTIZE:case Na.THRESHOLD:s.scale.range(i.values);break;case Na.IDENTITY:break;case Na.CAT:i.values?s.scale.range(i.values):s.scale.range(s.option.domain);break;case Na.DIVERGING:case Na.SEQUENTIAL:s.scale.interpolator(MDt(i.values));break}}if(i.values==="text"){var u;s.scale.range((u=s.option)===null||u===void 0?void 0:u.domain)}})):(i.type=D1.CONSTANT,i.defaultValues=o.map((s,l)=>s.scale(i.names[l]))),i.scalers=o.map(s=>({field:s.field,func:s.scale,option:s.option})),n.needRescale=!1}})}parseFields(t){return Array.isArray(t)?t:BBt(t)?t.split("*"):[t]}createScale(t,r,n,i){var a,o;const s=this.scaleOptions[r]&&((a=this.scaleOptions[r])===null||a===void 0?void 0:a.field)===t?this.scaleOptions[r]:this.scaleOptions[t],l={field:t,scale:void 0,type:D1.VARIABLE,option:s};if(!i||!i.length)return s&&s.type?l.scale=this.createDefaultScale(s):(l.scale=rR([t]),l.type=D1.CONSTANT),l;const u=(o=i.find(c=>!NO(c[t])))===null||o===void 0?void 0:o[t];if(this.isNumber(t)||NO(u)&&!s)l.scale=rR([t]),l.type=D1.CONSTANT;else{let c=s&&s.type||this.getDefaultType(u);n==="text"&&(c=Na.CAT),n===void 0&&(c=Na.IDENTITY);const f=this.createScaleConfig(c,t,s,i);l.scale=this.createDefaultScale(f),l.option=f}return l}getDefaultType(t){let r=Na.LINEAR;return typeof t=="string"&&(r=kBt.test(t)?Na.TIME:Na.CAT),r}createScaleConfig(t,r,n,i){const a=Ce(Ce({},n),{},{type:t});if(a!=null&&a.domain)return a;let o=[];if(t===Na.QUANTILE){const s=new Map;i==null||i.forEach(l=>{s.set(l._id,l[r])}),o=Array.from(s.values())}else o=(i==null?void 0:i.map(s=>s[r]))||[];if(t===Na.CAT||t===Na.IDENTITY)a.domain=NBt(o);else if(t===Na.QUANTILE)a.domain=o;else if(t===Na.DIVERGING){const s=H9(o),l=(n==null?void 0:n.neutral)!==void 0?n==null?void 0:n.neutral:(s[0]+s[1])/2;a.domain=[s[0],l,s[1]]}else a.domain=H9(o);return a}createDefaultScale({type:t,domain:r,unknown:n,clamp:i,nice:a}){const o=zBt[t]();return r&&o.domain&&o.domain(r),n&&o.unknown(n),i!==void 0&&o.clamp&&o.clamp(i),a!==void 0&&o.nice&&o.nice(a),o}}class $Bt{apply(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",()=>{t.animateStatus&&t.models.forEach(n=>{n.addUniforms(Ce({},t.layerModel.getAnimateUniforms()))})})}}let HBt=class{apply(t){t.hooks.afterInit.tap("LayerMaskPlugin",()=>{const{maskLayers:r,enableMask:n}=t.getLayerConfig();!t.tileLayer&&r&&r.length>0&&t.updateLayerConfig({mask:n})})}};class VBt{build(t){return Oe(function*(){t.prepareBuildModel(),yield t.buildModels()})()}initLayerModel(t){var r=this;return Oe(function*(){yield r.build(t),t.styleNeedUpdate=!1})()}prepareLayerModel(t){var r=this;return Oe(function*(){yield r.build(t),t.styleNeedUpdate=!1})()}apply(t){var r=this;t.hooks.init.tapPromise("LayerModelPlugin",Oe(function*(){if(t.getSource().isTile){t.prepareBuildModel();return}t.log(El.BuildModelStart,uu.INIT),yield r.initLayerModel(t),t.log(El.BuildModelEnd,uu.INIT)})),t.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var n=Oe(function*(i){return!i||t.getSource().isTile?!1:(t.log(El.BuildModelStart,uu.UPDATE),yield r.prepareLayerModel(t),t.log(El.BuildModelEnd,uu.UPDATE),!0)});return function(i){return n.apply(this,arguments)}}())}}class GBt{apply(t){t.hooks.afterInit.tap("LayerStylePlugin",()=>{const{autoFit:r,fitBoundsOptions:n}=t.getLayerConfig();r&&t.fitBounds(n),t.styleNeedUpdate=!1})}}const WBt=["type"],v$={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},XBt={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},jBt={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},YBt={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function ZBt(e){const t={u_DirectionalLights:new Array(3).fill(Ce({},jBt)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(Ce({},YBt)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[XBt]),e.forEach(r=>{let{type:n="directional"}=r,i=Gh(r,WBt);const a=v$[n].lights,o=v$[n].num,s=t[o];t[a][s]=Ce(Ce({},t[a][s]),i),t[o]++}),t}class qBt{apply(t){t.hooks.beforeRender.tap("LightingPlugin",()=>{const{enableLighting:r}=t.getLayerConfig();r&&t.models.forEach(n=>n.addUniforms(Ce({},ZBt())))})}}function OJ(e){return e.map(t=>(typeof t=="string"&&(t=[t,{}]),t))}function PJ(e,t,r,n){const i=e.multiPassRenderer;return i.add(n("render")),OJ(t).forEach(a=>{const[o,s]=a;i.add(r(o),s)}),i.add(r("copy")),i}class KBt{constructor(){U(this,"enabled",void 0)}apply(t,{rendererService:r,postProcessingPassFactory:n,normalPassFactory:i}){t.hooks.init.tapPromise("MultiPassRendererPlugin",()=>{const{enableMultiPassRenderer:a,passes:o=[]}=t.getLayerConfig();this.enabled=!!a&&t.getLayerConfig().enableMultiPassRenderer!==!1,this.enabled&&(t.multiPassRenderer=PJ(t,o,n,i),t.multiPassRenderer.setRenderFlag(!0))}),t.hooks.beforeRender.tap("MultiPassRendererPlugin",()=>{if(this.enabled){const{width:a,height:o}=r.getViewportSize();t.multiPassRenderer.resize(a,o)}})}}const km={POSITION:0,POSITION_64LOW:1,COLOR:2,PICKING_COLOR:3,STROKE:4,OPACITY:5,OFFSETS:6,ROTATION:7,MAX:8};function QBt(e){switch(e){case"rotation":return{name:"Rotation",type:Jr.Attribute,descriptor:{name:"a_Rotation",shaderLocation:km.ROTATION,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:t=>{const{rotation:r=0}=t;return Array.isArray(r)?[r[0]]:[r]}}};case"stroke":return{name:"stroke",type:Jr.Attribute,descriptor:{name:"a_Stroke",shaderLocation:km.STROKE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:4,update:t=>{const{stroke:r=[1,1,1,1]}=t;return r}}};case"opacity":return{name:"opacity",type:Jr.Attribute,descriptor:{name:"a_Opacity",shaderLocation:km.OPACITY,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:1,update:t=>{const{opacity:r=1}=t;return[r]}}};case"offsets":return{name:"offsets",type:Jr.Attribute,descriptor:{name:"a_Offsets",shaderLocation:km.OFFSETS,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:2,update:t=>{const{offsets:r}=t;return r}}};default:return}}const{isNumber:JBt}=as,B1={NONE:0,ENCODE:1,HIGHLIGHT:2};class t5t{constructor(){U(this,"pickingUniformMap",void 0)}pickOption2Array(){const t=[];return this.pickingUniformMap.forEach(r=>{JBt(r)?t.push(r):t.push(...r)}),t}updatePickOption(t,r){Object.keys(t).forEach(o=>{this.pickingUniformMap.set(o,t[o])});const n=r.getLayerConfig().pickingBuffer||0,i=Number(r.getShaderPickStat());this.pickingUniformMap.set("u_PickingBuffer",n),this.pickingUniformMap.set("u_shaderPick",i),r.getPickingUniformBuffer().subData({offset:0,data:this.pickOption2Array()})}apply(t,{styleAttributeService:r}){this.pickingUniformMap=new Map([["u_HighlightColor",[1,0,0,1]],["u_SelectColor",[1,0,0,1]],["u_PickingColor",[0,0,0]],["u_PickingStage",0],["u_CurrentSelectedId",[0,0,0]],["u_PickingThreshold",10],["u_PickingBuffer",0],["u_shaderPick",0],["u_activeMix",0]]),t.hooks.init.tapPromise("PixelPickingPlugin",()=>{const{enablePicking:n}=t.getLayerConfig();r.registerStyleAttribute({name:"pickingColor",type:Jr.Attribute,descriptor:{name:"a_PickingColor",shaderLocation:km.PICKING_COLOR,buffer:{data:[],type:K.FLOAT},size:3,update:i=>{const{id:a}=i;return n?$x(a):[0,0,0]}}})}),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",()=>{const{enablePicking:n}=t.getLayerConfig();n&&t.isVisible()&&(this.updatePickOption({u_PickingStage:B1.ENCODE},t),t.models.forEach(i=>i.addUniforms({u_PickingStage:B1.ENCODE})))}),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",()=>{const{enablePicking:n}=t.getLayerConfig();n&&t.isVisible()&&(this.updatePickOption({u_PickingStage:B1.HIGHLIGHT},t),t.models.forEach(i=>i.addUniforms({u_PickingStage:B1.HIGHLIGHT})))}),t.hooks.beforeHighlight.tap("PixelPickingPlugin",n=>{const{highlightColor:i,activeMix:a=0}=t.getLayerConfig(),o=typeof i=="string"?eo(i):i||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Uy(new Uint8Array(n))});const s={u_PickingStage:B1.HIGHLIGHT,u_PickingColor:n,u_HighlightColor:o.map(l=>l*255),u_activeMix:a};this.updatePickOption(s,t),t.models.forEach(l=>l.addUniforms(s))}),t.hooks.beforeSelect.tap("PixelPickingPlugin",n=>{const{selectColor:i,selectMix:a=0}=t.getLayerConfig(),o=typeof i=="string"?eo(i):i||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Uy(new Uint8Array(n))});const s={u_PickingStage:B1.HIGHLIGHT,u_PickingColor:n,u_HighlightColor:o.map(l=>l*255),u_activeMix:a,u_CurrentSelectedId:n,u_SelectColor:o.map(l=>l*255)};this.updatePickOption(s,t),t.models.forEach(l=>l.addUniforms(s))})}}const e5t=["mvt","geojsonvt","testTile"];function r5t(e){const t=e.getSource();return e5t.includes(t.parser.type)}class n5t{apply(t,{styleAttributeService:r}){t.hooks.init.tapPromise("RegisterStyleAttributePlugin",()=>{r5t(t)||this.registerBuiltinAttributes(r,t)})}registerBuiltinAttributes(t,r){if(r.type==="MaskLayer"){this.registerPositionAttribute(t);return}this.registerPositionAttribute(t),this.registerColorAttribute(t)}registerPositionAttribute(t){t.registerStyleAttribute({name:"position",type:Jr.Attribute,descriptor:{name:"a_Position",shaderLocation:km.POSITION,buffer:{data:[],type:K.FLOAT},size:3,update:(r,n,i)=>i.length===2?[i[0],i[1],0]:[i[0],i[1],i[2]]}})}registerColorAttribute(t){t.registerStyleAttribute({name:"color",type:Jr.Attribute,descriptor:{name:"a_Color",shaderLocation:km.COLOR,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:4,update:r=>{const{color:n}=r;return!n||!n.length?[1,1,1,1]:n}}})}}class i5t{constructor(){U(this,"cameraService",void 0),U(this,"coordinateSystemService",void 0),U(this,"rendererService",void 0),U(this,"mapService",void 0),U(this,"layerService",void 0)}apply(t,{rendererService:r,mapService:n,layerService:i,coordinateSystemService:a,cameraService:o}){this.rendererService=r,this.mapService=n,this.layerService=i,this.coordinateSystemService=a,this.cameraService=o;let s;this.rendererService.uniformBuffers[0]||(s=this.rendererService.createBuffer({data:new Float32Array(96),isUBO:!0,label:"renderUniformBuffer"}),this.rendererService.uniformBuffers[0]=s),t.hooks.beforeRender.tap("ShaderUniformPlugin",()=>{const u=t.getRelativeOrigin&&t.getRelativeOrigin()||[0,0];this.coordinateSystemService.refresh(),u&&(Math.abs(u[0])>1e-4||Math.abs(u[1])>1e-4)&&this.coordinateSystemService.getCoordinateSystem()===2&&this.coordinateSystemService.setViewportCenter(u);const{width:f,height:d}=this.rendererService.getViewportSize(),{data:v,uniforms:g}=this.generateUBO(f,d,u);this.layerService.alreadyInRendering&&this.rendererService.uniformBuffers[0]&&this.rendererService.uniformBuffers[0].subData({offset:0,data:v}),this.rendererService.queryVerdorInfo()==="WebGL1"&&t.models.forEach(w=>{w.addUniforms(Ce(Ce({},g),{},{u_PickingBuffer:t.getLayerConfig().pickingBuffer||0,u_shaderPick:Number(t.getShaderPickStat())}))})})}generateUBO(t,r,n){const i=this.cameraService.getProjectionMatrix(),a=this.cameraService.getViewMatrix(),o=this.cameraService.getViewProjectionMatrix(),s=this.cameraService.getModelMatrix(),l=this.coordinateSystemService.getViewportCenterProjection(),u=this.coordinateSystemService.getPixelsPerDegree(),c=this.cameraService.getZoom(),f=this.coordinateSystemService.getPixelsPerDegree2(),d=this.cameraService.getZoomScale(),v=this.coordinateSystemService.getPixelsPerMeter(),g=this.coordinateSystemService.getCoordinateSystem(),x=this.cameraService.getCameraPosition(),w=window.devicePixelRatio,S=this.coordinateSystemService.getViewportCenter(),M=[t,r],R=this.cameraService.getFocalDistance(),I=n&&n.length>=2?[n[0],n[1]]:[0,0];return{data:[...a,...i,...o,...s,...l,...u,c,...f,d,...v,g,...x,w,...S,...M,R,...I,0],uniforms:{[cy.ProjectionMatrix]:i,[cy.ViewMatrix]:a,[cy.ViewProjectionMatrix]:o,[cy.Zoom]:c,[cy.ZoomScale]:d,[cy.FocalDistance]:R,[cy.CameraPosition]:x,[P1.CoordinateSystem]:g,[P1.ViewportCenter]:S,[P1.ViewportCenterProjection]:l,[P1.PixelsPerDegree]:u,[P1.PixelsPerDegree2]:f,[P1.PixelsPerMeter]:v,u_ViewportSize:M,u_ModelMatrix:s,u_DevicePixelRatio:w,u_RelativeOrigin:I}}}}class a5t{apply(t){t.hooks.beforeRender.tap("UpdateModelPlugin",()=>{t.layerModel&&t.layerModel.needUpdate().then(r=>{r&&t.renderLayers()})}),t.hooks.afterRender.tap("UpdateModelPlugin",()=>{t.layerModelNeedUpdate=!1})}}class o5t{apply(t,{styleAttributeService:r}){t.hooks.init.tapPromise("UpdateStyleAttributePlugin",()=>{this.initStyleAttribute(t,{styleAttributeService:r})}),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",()=>{t.layerModelNeedUpdate||t.inited&&this.updateStyleAttribute(t,{styleAttributeService:r})})}updateStyleAttribute(t,{styleAttributeService:r}){const n=r.getLayerStyleAttributes()||[],i=r.getLayerStyleAttribute("filter");if(i&&i.needRegenerateVertices){t.layerModelNeedUpdate=!0,n.forEach(a=>a.needRegenerateVertices=!1);return}n.filter(a=>a.needRegenerateVertices).forEach(a=>{r.updateAttributeByFeatureRange(a.name,t.getEncodedData(),a.featureRange.startIndex,a.featureRange.endIndex,t),a.needRegenerateVertices=!1})}initStyleAttribute(t,{styleAttributeService:r}){(r.getLayerStyleAttributes()||[]).filter(i=>i.needRegenerateVertices).forEach(i=>{r.updateAttributeByFeatureRange(i.name,t.getEncodedData(),i.featureRange.startIndex,i.featureRange.endIndex),i.needRegenerateVertices=!1})}}function s5t(){return[new bDt,new n5t,new UBt,new xDt,new GBt,new HBt,new o5t,new a5t,new KBt,new i5t,new $Bt,new qBt,new t5t,new VBt]}const DJ={[Am.additive]:{enable:!0,func:{srcRGB:K.ONE,dstRGB:K.ONE,srcAlpha:1,dstAlpha:1}},[Am.none]:{enable:!1},[Am.normal]:{enable:!0,func:{srcRGB:K.SRC_ALPHA,dstRGB:K.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}},[Am.subtractive]:{enable:!0,func:{srcRGB:K.ONE,dstRGB:K.ONE,srcAlpha:K.ZERO,dstAlpha:K.ONE_MINUS_SRC_COLOR},equation:{rgb:K.FUNC_SUBTRACT,alpha:K.FUNC_SUBTRACT}},[Am.max]:{enable:!0,func:{srcRGB:K.ONE,dstRGB:K.ONE},equation:{rgb:K.MAX_EXT}},[Am.min]:{enable:!0,func:{srcRGB:K.ONE,dstRGB:K.ONE},equation:{rgb:K.MIN_EXT}}};class l5t{constructor(t){U(this,"layer",void 0),this.layer=t}pickRender(t){const n=this.layer.getContainer().layerService,i=this.layer;if(i.tileLayer)return i.tileLayer.pickRender(t);i.hooks.beforePickingEncode.call(),n.renderTileLayerMask(i),i.renderModels({ispick:!0}),i.hooks.afterPickingEncode.call()}pick(t,r){var n=this;return Oe(function*(){const a=n.layer.getContainer().pickingService;return t.type==="RasterLayer"?n.pickRasterLayer(t,r):(n.pickRender(r),a.pickFromPickingFBO(t,r))})()}pickRasterLayer(t,r,n){const i=this.layer.getContainer(),a=i.pickingService,o=i.mapService,s=this.layer.getSource().extent,l=vAt(r.lngLat,s),u={x:r.x,y:r.y,type:r.type,lngLat:r.lngLat,target:r,rasterValue:null},c=n||t;if(l){const f=this.readRasterValue(t,s,o,r.x,r.y);return u.rasterValue=f,a.triggerHoverOnLayer(c,u),!0}else return u.type=r.type==="mousemove"?"mouseout":"un"+r.type,a.triggerHoverOnLayer(c,Ce(Ce({},u),{},{type:"unpick"})),a.triggerHoverOnLayer(c,u),!1}readRasterValue(t,r,n,i,a){const o=t.getSource().data.dataArray[0],[s=0,l=0,u=10,c=-10]=r,f=n.lngLatToContainer([s,l]),d=n.lngLatToContainer([u,c]),v=d.x-f.x,g=f.y-d.y,x=[(i-f.x)/v,(a-d.y)/g],w=o.width||1,S=o.height||1,M=Math.floor(x[0]*w),R=Math.floor(x[1]*S),I=Math.max(0,R-1)*w+M;return o.data[I]}selectFeature(t){const r=this.layer,[n,i,a]=t;r.hooks.beforeSelect.call([n,i,a])}highlightPickedFeature(t){const[r,n,i]=t;this.layer.hooks.beforeHighlight.call([r,n,i])}getFeatureById(t){return this.layer.getSource().getFeatureById(t)}}class u5t{constructor(t){U(this,"layer",void 0),U(this,"rendererService",void 0),U(this,"colorTexture",void 0),U(this,"key",void 0),this.layer=t;const r=this.layer.getContainer();this.rendererService=r.rendererService}getColorTexture(t,r){const n=this.getTextureKey(t,r);return this.key===n?this.colorTexture:(this.createColorTexture(t,r),this.key=n,this.colorTexture)}createColorTexture(t,r){const{createTexture2D:n}=this.rendererService,i=this.getColorRampBar(t,r),a=n({data:new Uint8Array(i.data),width:i.width,height:i.height,flipY:!1,unorm:!0});return this.colorTexture=a,a}setColorTexture(t,r,n){this.key=this.getTextureKey(r,n),this.colorTexture=t}destroy(){var t;(t=this.colorTexture)===null||t===void 0||t.destroy()}getColorRampBar(t,r){switch(t.type){case"cat":return Ndt(t);case"quantize":return kdt(t);case"custom":return zdt(t,r);case"linear":return Bdt(t,r);default:return Tq(t)}}getTextureKey(t,r){var n;return`${t.colors.join("_")}_${t==null||(n=t.positions)===null||n===void 0?void 0:n.join("_")}_${t.type}_${r==null?void 0:r.join("_")}`}}const c5t=["passes"],h5t=["moduleName","vertexShader","fragmentShader","defines","inject","triangulation","styleOption","pickingEnabled"],{isEqual:kO,isFunction:g$,isNumber:m$,isObject:au,isPlainObject:f5t,isUndefined:d5t}=as;let y$=0;class L_ extends Gu.EventEmitter{get shaderModuleService(){return this.container.shaderModuleService}get cameraService(){return this.container.cameraService}get coordinateService(){return this.container.coordinateSystemService}get iconService(){return this.container.iconService}get fontService(){return this.container.fontService}get pickingService(){return this.container.pickingService}get rendererService(){return this.container.rendererService}get layerService(){return this.container.layerService}get debugService(){return this.container.debugService}get interactionService(){return this.container.interactionService}get mapService(){var t;return(t=this.container)===null||t===void 0?void 0:t.mapService}get normalPassFactory(){return this.container.normalPassFactory}constructor(t={}){super(),U(this,"id",`${y$++}`),U(this,"name",`${y$}`),U(this,"parent",void 0),U(this,"coordCenter",void 0),U(this,"type",void 0),U(this,"visible",!0),U(this,"zIndex",0),U(this,"minZoom",void 0),U(this,"maxZoom",void 0),U(this,"inited",!1),U(this,"layerModelNeedUpdate",!1),U(this,"pickedFeatureID",null),U(this,"selectedFeatureID",null),U(this,"styleNeedUpdate",!1),U(this,"rendering",void 0),U(this,"forceRender",!1),U(this,"clusterZoom",0),U(this,"layerType",void 0),U(this,"triangulation",void 0),U(this,"layerPickService",void 0),U(this,"textureService",void 0),U(this,"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),U(this,"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),U(this,"hooks",{init:new W3t,afterInit:new qU,beforeRender:new qU,beforeRenderData:new X3t,afterRender:new Dp,beforePickingEncode:new Dp,afterPickingEncode:new Dp,beforeHighlight:new Dp(["pickedColor"]),afterHighlight:new Dp,beforeSelect:new Dp(["pickedColor"]),afterSelect:new Dp,beforeDestroy:new Dp,afterDestroy:new Dp}),U(this,"models",[]),U(this,"multiPassRenderer",void 0),U(this,"plugins",void 0),U(this,"startInit",!1),U(this,"sourceOption",void 0),U(this,"layerModel",void 0),U(this,"shapeOption",void 0),U(this,"tileLayer",void 0),U(this,"layerChildren",[]),U(this,"masks",[]),U(this,"configService",OQ),U(this,"styleAttributeService",void 0),U(this,"layerSource",void 0),U(this,"postProcessingPassFactory",void 0),U(this,"animateOptions",{enable:!1}),U(this,"relativeOrigin",[0,0]),U(this,"originalExtent",[0,0,0,0]),U(this,"absoluteDataArray",[]),U(this,"container",void 0),U(this,"encodedData",void 0),U(this,"currentPickId",null),U(this,"rawConfig",void 0),U(this,"needUpdateConfig",void 0),U(this,"encodeStyleAttribute",{}),U(this,"enableShaderEncodeStyles",[]),U(this,"enableDataEncodeStyles",[]),U(this,"pendingStyleAttributes",[]),U(this,"scaleOptions",{}),U(this,"animateStartTime",void 0),U(this,"animateStatus",!1),U(this,"isDestroyed",!1),U(this,"uniformBuffers",[]),U(this,"encodeDataLength",0),U(this,"sourceEvent",()=>{this.dataState.dataSourceNeedUpdate=!0,this.processRelativeCoordinates();const r=this.getLayerConfig();r&&r.autoFit&&this.fitBounds(r.fitBoundsOptions),this.layerSource.getSourceCfg().autoRender&&setTimeout(()=>{this.reRender()},10)}),this.name=t.name||this.id,this.zIndex=t.zIndex||0,this.rawConfig=t,this.masks=t.maskLayers||[]}addMask(t){this.masks.push(t),this.updateLayerConfig({maskLayers:this.masks}),this.enableMask()}removeMask(t){const r=this.masks.indexOf(t);r>-1&&this.masks.splice(r,1),this.updateLayerConfig({maskLayers:this.masks})}disableMask(){this.updateLayerConfig({enableMask:!1})}enableMask(){this.updateLayerConfig({enableMask:!0})}addMaskLayer(t){this.masks.push(t)}removeMaskLayer(t){const r=this.masks.indexOf(t);r>-1&&this.masks.splice(r,1),t.destroy()}getAttribute(t){return this.styleAttributeService.getLayerStyleAttribute(t)}getLayerConfig(){return this.configService.getLayerConfig(this.id)}updateLayerConfig(t){if(Object.keys(t).map(r=>{r in this.rawConfig&&(this.rawConfig[r]=t[r])}),!this.startInit)this.needUpdateConfig=Ce(Ce({},this.needUpdateConfig),t);else{const r=this.container.id;this.configService.setLayerConfig(r,this.id,Ce(Ce(Ce({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),t)),this.needUpdateConfig={}}}setContainer(t){this.container=t}getContainer(){return this.container}addPlugin(t){return this.plugins.push(t),this}init(){var t=this;return Oe(function*(){const r=t.container.id;t.startInit=!0,t.configService.setLayerConfig(r,t.id,t.rawConfig),t.layerType=t.rawConfig.layerType;const{enableMultiPassRenderer:n,passes:i}=t.getLayerConfig();n&&i!==null&&i!==void 0&&i.length&&i.length>0&&t.mapService.on("mapAfterFrameChange",()=>{t.renderLayers()}),t.postProcessingPassFactory=t.container.postProcessingPassFactory,t.styleAttributeService=t.container.styleAttributeService,n&&(t.multiPassRenderer=t.container.multiPassRenderer,t.multiPassRenderer.setLayer(t)),t.pendingStyleAttributes.forEach(({attributeName:a,attributeField:o,attributeValues:s,updateOptions:l})=>{t.styleAttributeService.updateStyleAttribute(a,{scale:Ce({field:o},t.splitValuesAndCallbackInAttribute(s,o?void 0:t.getLayerConfig()[a]))},l)}),t.pendingStyleAttributes=[],t.plugins=s5t();for(const a of t.plugins)a.apply(t,t.container);t.layerPickService=new l5t(t),t.textureService=new u5t(t),t.log(El.LayerInitStart),yield t.hooks.init.promise(),t.log(El.LayerInitEnd),t.inited=!0,t.emit("inited",{target:t,type:"inited"}),t.emit("add",{target:t,type:"add"}),t.hooks.afterInit.call()})()}log(t,r="init"){var n;if(this.tileLayer||this.isTileLayer)return;const i=`${this.id}.${r}.${t}`,a={id:this.id,type:this.type};(n=this.debugService)===null||n===void 0||n.log(i,a)}updateModelData(t){t.attributes&&t.elements?this.models.map(r=>{r.updateAttributesAndElements(t.attributes,t.elements)}):console.warn("data error")}setLayerPickService(t){this.layerPickService=t}prepareBuildModel(){Object.keys(this.needUpdateConfig||{}).length!==0&&this.updateLayerConfig({});const{animateOption:t}=this.getLayerConfig();t!=null&&t.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}color(t,r,n){return this.updateStyleAttribute("color",t,r,n),this}texture(t,r,n){return this.updateStyleAttribute("texture",t,r,n),this}rotate(t,r,n){return this.updateStyleAttribute("rotate",t,r,n),this}size(t,r,n){return this.updateStyleAttribute("size",t,r,n),this}filter(t,r,n){const i=this.updateStyleAttribute("filter",t,r,n);return this.dataState.dataSourceNeedUpdate=i&&this.inited,this}shape(t,r,n){this.shapeOption={field:t,values:r};const i=this.updateStyleAttribute("shape",t,r,n);return this.dataState.dataSourceNeedUpdate=i&&this.inited,this}label(t,r,n){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:t,attributeValues:r,updateOptions:n}),this}animate(t){let r={};return au(t)?(r.enable=!0,r=Ce(Ce({},r),t)):r.enable=t,this.updateLayerConfig({animateOption:r}),this}source(t,r){return(t==null?void 0:t.type)==="source"?(this.setSource(t),this):(this.sourceOption={data:t,options:r},this.clusterZoom=0,this)}setData(t,r){return this.inited?(this.dataUpdatelog(),this.layerSource.setData(t,r)):this.on("inited",()=>{this.dataUpdatelog(),this.layerSource.setData(t,r)}),this}dataUpdatelog(){this.log(El.SourceInitStart,uu.UPDATE),this.layerSource.once("update",()=>{this.log(El.SourceInitEnd,uu.UPDATE)})}style(t){const{passes:r}=t,n=Gh(t,c5t);r&&OJ(r).forEach(a=>{const o=this.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(a[0]);o&&o.updateOptions(a[1])}),n.borderColor&&(n.stroke=n.borderColor),n.borderWidth&&(n.strokeWidth=n.borderWidth);const i=n;return Object.keys(n).forEach(a=>{const o=n[a];Array.isArray(o)&&o.length===2&&!m$(o[0])&&!m$(o[1])&&(i[a]={field:o[0],value:o[1]})}),this.encodeStyle(i),this.updateLayerConfig(i),this}encodeStyle(t){Object.keys(t).forEach(r=>{[...this.enableShaderEncodeStyles,...this.enableDataEncodeStyles].includes(r)&&f5t(t[r])&&(t[r].field||t[r].value)&&!kO(this.encodeStyleAttribute[r],t[r])?(this.encodeStyleAttribute[r]=t[r],this.updateStyleAttribute(r,t[r].field,t[r].value),this.inited&&(this.dataState.dataMappingNeedUpdate=!0)):this.encodeStyleAttribute[r]&&(delete this.encodeStyleAttribute[r],this.dataState.dataSourceNeedUpdate=!0)})}scale(t,r){const n=Ce({},this.scaleOptions);if(au(t)?this.scaleOptions=Ce(Ce({},this.scaleOptions),t):this.scaleOptions[t]=r,this.styleAttributeService&&!kO(n,this.scaleOptions)){const i=au(t)?t:{[t]:r};this.styleAttributeService.updateScaleAttribute(i)}return this}renderLayers(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}prerender(){}render(t={}){return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(t),this))}renderMultiPass(){var t=this;return Oe(function*(){t.encodeDataLength<=0&&!t.forceRender||(t.multiPassRenderer&&t.multiPassRenderer.getRenderFlag()?yield t.multiPassRenderer.render():t.renderModels())})()}active(t){const r={};return r.enableHighlight=au(t)?!0:t,au(t)?(r.enableHighlight=!0,t.color&&(r.highlightColor=t.color),t.mix&&(r.activeMix=t.mix)):r.enableHighlight=!!t,this.updateLayerConfig(r),this}setActive(t,r){if(au(t)){const{x:n=0,y:i=0}=t;this.updateLayerConfig({highlightColor:au(r)?r.color:this.getLayerConfig().highlightColor,activeMix:au(r)?r.mix:this.getLayerConfig().activeMix}),this.pick({x:n,y:i})}else this.updateLayerConfig({pickedFeatureID:t,highlightColor:au(r)?r.color:this.getLayerConfig().highlightColor,activeMix:au(r)?r.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call($x(t)).then(()=>{setTimeout(()=>{this.reRender()},1)})}select(t){const r={};return r.enableSelect=au(t)?!0:t,au(t)?(r.enableSelect=!0,t.color&&(r.selectColor=t.color),t.mix&&(r.selectMix=t.mix)):r.enableSelect=!!t,this.updateLayerConfig(r),this}setSelect(t,r){if(au(t)){const{x:n=0,y:i=0}=t;this.updateLayerConfig({selectColor:au(r)?r.color:this.getLayerConfig().selectColor,selectMix:au(r)?r.mix:this.getLayerConfig().selectMix}),this.pick({x:n,y:i})}else this.updateLayerConfig({pickedFeatureID:t,selectColor:au(r)?r.color:this.getLayerConfig().selectColor,selectMix:au(r)?r.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call($x(t)).then(()=>{setTimeout(()=>{this.reRender()},1)})}setBlend(t){return this.updateLayerConfig({blend:t}),this.reRender(),this}show(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}hide(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}setIndex(t){return this.zIndex=t,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}setCurrentPickId(t){this.currentPickId=t}getCurrentPickId(){return this.currentPickId}setCurrentSelectedId(t){this.selectedFeatureID=t}getCurrentSelectedId(){return this.selectedFeatureID}isVisible(){const t=this.mapService.getZoom(),{visible:r,minZoom:n=-1/0,maxZoom:i=1/0}=this.getLayerConfig();return!!r&&t>=n&&t<i}setMultiPass(t,r){if(this.updateLayerConfig({enableMultiPassRenderer:t}),r&&this.updateLayerConfig({passes:r}),t){const{passes:n=[]}=this.getLayerConfig();this.multiPassRenderer=PJ(this,n,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);const{width:i,height:a}=this.rendererService.getViewportSize();this.multiPassRenderer.resize(i,a)}return this}setMinZoom(t){return this.updateLayerConfig({minZoom:t}),this}getMinZoom(){const{minZoom:t}=this.getLayerConfig();return t}getMaxZoom(){const{maxZoom:t}=this.getLayerConfig();return t}get(t){return this.getLayerConfig()[t]}setMaxZoom(t){return this.updateLayerConfig({maxZoom:t}),this}setAutoFit(t){return this.updateLayerConfig({autoFit:t}),this}fitBounds(t){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;const n=this.getSource().extent;return n.some(a=>Math.abs(a)===1/0)?this:(this.mapService.fitBounds([[n[0],n[1]],[n[2],n[3]]],t),this)}destroy(t=!0){var r,n,i,a,o;if(this.isDestroyed)return;(r=this.layerModel)===null||r===void 0||r.uniformBuffers.forEach(l=>{l.destroy()}),this.layerChildren.map(l=>l.destroy(!1)),this.layerChildren=[];const{maskfence:s}=this.getLayerConfig();s&&(this.masks.map(l=>l.destroy(!1)),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(n=this.multiPassRenderer)===null||n===void 0||n.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(i=this.layerModel)===null||i===void 0||i.clearModels(t),(a=this.tileLayer)===null||a===void 0||a.destroy(),this.models=[],(o=this.debugService)===null||o===void 0||o.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}clear(){this.styleAttributeService.clearAllAttributes()}clearModels(){var t;this.models.forEach(r=>r.destroy()),(t=this.layerModel)===null||t===void 0||t.clearModels(),this.models=[]}isDirty(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(t=>t.needRescale||t.needRemapping||t.needRegenerateVertices).length}setSource(t){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=t,this.clusterZoom=0,this.inited&&this.layerSource.cluster){const r=this.mapService.getZoom();this.layerSource.updateClusterData(r)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",({type:r})=>{if(this.coordCenter===void 0){const n=this.layerSource.center;this.coordCenter=n}if(r==="update"){if(this.tileLayer){this.tileLayer.reload();return}this.sourceEvent()}r==="inited"&&this.processRelativeCoordinates()})}getSource(){return this.layerSource}getScaleOptions(){return this.scaleOptions}setEncodedData(t){this.encodedData=t,this.encodeDataLength=t.length}getEncodedData(){return this.encodedData}getScale(t){return this.styleAttributeService.getLayerAttributeScale(t)}getLegend(t){var r,n,i;const a=this.styleAttributeService.getLayerStyleAttribute(t);return{type:(n=((a==null||(r=a.scale)===null||r===void 0?void 0:r.scalers)||[])[0])===null||n===void 0||(n=n.option)===null||n===void 0?void 0:n.type,field:a==null||(i=a.scale)===null||i===void 0?void 0:i.field,items:this.getLegendItems(t)}}getLegendItems(t){const r=this.styleAttributeService.getLayerAttributeScale(t);return r?r.invertExtent?r.range().map(i=>({value:r.invertExtent(i),[t]:i})):r.ticks?r.ticks().map(i=>({value:i,[t]:r(i)})):r!=null&&r.domain?r.domain().filter(i=>!d5t(i)).map(i=>({value:i,[t]:r(i)})):[]:[]}pick({x:t,y:r}){this.interactionService.triggerHover({x:t,y:r})}boxSelect(t,r){this.pickingService.boxPickLayer(this,t,r)}buildLayerModel(t){var r=this;return Oe(function*(){const{moduleName:n,vertexShader:i,fragmentShader:a,defines:o,inject:s,triangulation:l,styleOption:u,pickingEnabled:c=!0}=t,f=Gh(t,h5t);r.shaderModuleService.registerModule(n,{vs:i,fs:a,defines:o,inject:s});const{vs:d,fs:v,uniforms:g}=r.shaderModuleService.getModule(n),{createModel:x}=r.rendererService;return new Promise(w=>{const{attributes:S,elements:M,count:R}=r.styleAttributeService.createAttributesAndIndices(r.encodedData,l,u,r),I=[...r.layerModel.uniformBuffers,...r.rendererService.uniformBuffers];c&&I.push(r.getPickingUniformBuffer());const P=Ce({attributes:S,uniforms:g,fs:v,vs:d,elements:M,blend:DJ[Am.normal],uniformBuffers:I,textures:r.layerModel.textures},f);R&&(P.count=R);const k=x(P);w(k)})})()}createAttributes(t){const{triangulation:r}=t,{attributes:n}=this.styleAttributeService.createAttributes(this.encodedData,r);return n}getTime(){return this.layerService.clock.getDelta()}setAnimateStartTime(){this.animateStartTime=this.layerService.clock.getElapsedTime()}stopAnimate(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}getLayerAnimateTime(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}needPick(t){const{enableHighlight:r=!0,enableSelect:n=!0}=this.getLayerConfig();let i=this.eventNames().indexOf(t)!==-1||this.eventNames().indexOf("un"+t)!==-1;return(t==="click"||t==="dblclick")&&n&&(i=!0),t==="mousemove"&&(r||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(i=!0),this.isVisible()&&i}buildModels(){return Oe(function*(){throw new Error("Method not implemented.")})()}rebuildModels(){var t=this;return Oe(function*(){yield t.buildModels()})()}renderMulPass(t){return Oe(function*(){yield t.render()})()}renderModels(t={}){return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach(r=>{r.draw({uniforms:this.layerModel.getUninforms(),blend:this.layerModel.getBlend(),stencil:this.layerModel.getStencil(t),textures:this.layerModel.textures},(t==null?void 0:t.ispick)||!1)}),this.hooks.afterRender.call(),this)}updateStyleAttribute(t,r,n,i){const a=this.configService.getAttributeConfig(this.id)||{};return kO(a[t],{field:r,values:n})?!1:(["color","size","texture","rotate","filter","label","shape"].indexOf(t)!==-1&&this.configService.setAttributeConfig(this.id,{[t]:{field:r,values:n}}),this.startInit?this.styleAttributeService.updateStyleAttribute(t,{scale:Ce({field:r},this.splitValuesAndCallbackInAttribute(n,this.getLayerConfig()[r]))},i):this.pendingStyleAttributes.push({attributeName:t,attributeField:r,attributeValues:n,updateOptions:i}),!0)}getLayerAttributeConfig(){return this.configService.getAttributeConfig(this.id)}getShaderPickStat(){return this.layerService.getShaderPickStat()}setEarthTime(t){console.warn("empty fn")}processData(t){return t}getModelType(){throw new Error("Method not implemented.")}getDefaultConfig(){return{}}processRelativeCoordinates(){if(!this.getLayerConfig().enableRelativeCoordinates||!this.layerSource||!this.layerSource.data)return;this.absoluteDataArray=[...this.layerSource.data.dataArray];const n=gDt(this.layerSource.data.dataArray,{enableRelativeCoordinates:!0});this.layerSource.data.dataArray=n.dataArray,this.relativeOrigin=n.relativeOrigin,this.originalExtent=n.originalExtent}getAbsoluteData(){return this.absoluteDataArray}getRelativeOrigin(){return this.relativeOrigin}getOriginalExtent(){return this.originalExtent}initLayerModels(){var t=this;return Oe(function*(){t.models.forEach(n=>n.destroy()),t.models=[],t.uniformBuffers.forEach(n=>{n.destroy()}),t.uniformBuffers=[];const r=t.rendererService.createBuffer({data:new Float32Array(20).fill(0),isUBO:!0,label:"pickingUniforms"});t.uniformBuffers.push(r),t.models=yield t.layerModel.initModels()})()}getPickingUniformBuffer(){return this.uniformBuffers[0]}reRender(){this.inited&&this.layerService.reRender()}splitValuesAndCallbackInAttribute(t){return{values:g$(t)?void 0:t,callback:g$(t)?t:void 0}}}function p5t(e,t){return{enable:e,mask:255,func:{cmp:K.EQUAL,ref:t?1:0,mask:1}}}function _$(e){return e.maskOperation===HI.OR?{enable:!0,mask:255,func:{cmp:K.ALWAYS,ref:1,mask:255},opFront:{fail:K.KEEP,zfail:K.REPLACE,zpass:K.REPLACE}}:{enable:!0,mask:255,func:{cmp:e.stencilType===Ry.SINGLE||e.stencilIndex===0?K.ALWAYS:K.LESS,ref:e.stencilType===Ry.SINGLE?1:e.stencilIndex===0?2:1,mask:255},opFront:{fail:K.KEEP,zfail:K.REPLACE,zpass:K.REPLACE}}}const v5t={opacity:1,stroke:[1,0,0,1],offsets:[0,0],rotation:0,extrusionBase:0,strokeOpacity:1,thetaOffset:.314},IT={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2",rotation:"float",extrusionBase:"float",strokeOpacity:"float",thetaOffset:"float"};var A4={exports:{}};A4.exports=YI;A4.exports.default=YI;function YI(e,t,r){r=r||2;var n=t&&t.length,i=n?t[0]*r:e.length,a=FJ(e,0,i,r,!0),o=[];if(!a||a.next===a.prev)return o;var s,l,u,c,f,d,v;if(n&&(a=x5t(e,t,a,r)),e.length>80*r){s=u=e[0],l=c=e[1];for(var g=r;g<i;g+=r)f=e[g],d=e[g+1],f<s&&(s=f),d<l&&(l=d),f>u&&(u=f),d>c&&(c=d);v=Math.max(u-s,c-l),v=v!==0?32767/v:0}return LC(a,o,r,s,l,v,0),o}function FJ(e,t,r,n,i){var a,o;if(i===qD(e,t,r,n)>0)for(a=t;a<r;a+=n)o=x$(a,e[a],e[a+1],o);else for(a=r-n;a>=t;a-=n)o=x$(a,e[a],e[a+1],o);return o&&ZI(o,o.next)&&(PC(o),o=o.next),o}function a_(e,t){if(!e)return e;t||(t=e);var r=e,n;do if(n=!1,!r.steiner&&(ZI(r,r.next)||xs(r.prev,r,r.next)===0)){if(PC(r),r=t=r.prev,r===r.next)break;n=!0}else r=r.next;while(n||r!==t);return t}function LC(e,t,r,n,i,a,o){if(e){!o&&a&&S5t(e,n,i,a);for(var s=e,l,u;e.prev!==e.next;){if(l=e.prev,u=e.next,a?m5t(e,n,i,a):g5t(e)){t.push(l.i/r|0),t.push(e.i/r|0),t.push(u.i/r|0),PC(e),e=u.next,s=u.next;continue}if(e=u,e===s){o?o===1?(e=y5t(a_(e),t,r),LC(e,t,r,n,i,a,2)):o===2&&_5t(e,t,r,n,i,a):LC(a_(e),t,r,n,i,a,1);break}}}}function g5t(e){var t=e.prev,r=e,n=e.next;if(xs(t,r,n)>=0)return!1;for(var i=t.x,a=r.x,o=n.x,s=t.y,l=r.y,u=n.y,c=i<a?i<o?i:o:a<o?a:o,f=s<l?s<u?s:u:l<u?l:u,d=i>a?i>o?i:o:a>o?a:o,v=s>l?s>u?s:u:l>u?l:u,g=n.next;g!==t;){if(g.x>=c&&g.x<=d&&g.y>=f&&g.y<=v&&ix(i,s,a,l,o,u,g.x,g.y)&&xs(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function m5t(e,t,r,n){var i=e.prev,a=e,o=e.next;if(xs(i,a,o)>=0)return!1;for(var s=i.x,l=a.x,u=o.x,c=i.y,f=a.y,d=o.y,v=s<l?s<u?s:u:l<u?l:u,g=c<f?c<d?c:d:f<d?f:d,x=s>l?s>u?s:u:l>u?l:u,w=c>f?c>d?c:d:f>d?f:d,S=YD(v,g,t,r,n),M=YD(x,w,t,r,n),R=e.prevZ,I=e.nextZ;R&&R.z>=S&&I&&I.z<=M;){if(R.x>=v&&R.x<=x&&R.y>=g&&R.y<=w&&R!==i&&R!==o&&ix(s,c,l,f,u,d,R.x,R.y)&&xs(R.prev,R,R.next)>=0||(R=R.prevZ,I.x>=v&&I.x<=x&&I.y>=g&&I.y<=w&&I!==i&&I!==o&&ix(s,c,l,f,u,d,I.x,I.y)&&xs(I.prev,I,I.next)>=0))return!1;I=I.nextZ}for(;R&&R.z>=S;){if(R.x>=v&&R.x<=x&&R.y>=g&&R.y<=w&&R!==i&&R!==o&&ix(s,c,l,f,u,d,R.x,R.y)&&xs(R.prev,R,R.next)>=0)return!1;R=R.prevZ}for(;I&&I.z<=M;){if(I.x>=v&&I.x<=x&&I.y>=g&&I.y<=w&&I!==i&&I!==o&&ix(s,c,l,f,u,d,I.x,I.y)&&xs(I.prev,I,I.next)>=0)return!1;I=I.nextZ}return!0}function y5t(e,t,r){var n=e;do{var i=n.prev,a=n.next.next;!ZI(i,a)&&BJ(i,n,n.next,a)&&OC(i,a)&&OC(a,i)&&(t.push(i.i/r|0),t.push(n.i/r|0),t.push(a.i/r|0),PC(n),PC(n.next),n=e=a),n=n.next}while(n!==e);return a_(n)}function _5t(e,t,r,n,i,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&M5t(o,s)){var l=NJ(o,s);o=a_(o,o.next),l=a_(l,l.next),LC(o,t,r,n,i,a,0),LC(l,t,r,n,i,a,0);return}s=s.next}o=o.next}while(o!==e)}function x5t(e,t,r,n){var i=[],a,o,s,l,u;for(a=0,o=t.length;a<o;a++)s=t[a]*n,l=a<o-1?t[a+1]*n:e.length,u=FJ(e,s,l,n,!1),u===u.next&&(u.steiner=!0),i.push(A5t(u));for(i.sort(b5t),a=0;a<i.length;a++)r=E5t(i[a],r);return r}function b5t(e,t){return e.x-t.x}function E5t(e,t){var r=w5t(e,t);if(!r)return t;var n=NJ(r,e);return a_(n,n.next),a_(r,r.next)}function w5t(e,t){var r=t,n=e.x,i=e.y,a=-1/0,o;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var s=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=n&&s>a&&(a=s,o=r.x<r.next.x?r:r.next,s===n))return o}r=r.next}while(r!==t);if(!o)return null;var l=o,u=o.x,c=o.y,f=1/0,d;r=o;do n>=r.x&&r.x>=u&&n!==r.x&&ix(i<c?n:a,i,u,c,i<c?a:n,i,r.x,r.y)&&(d=Math.abs(i-r.y)/(n-r.x),OC(r,e)&&(d<f||d===f&&(r.x>o.x||r.x===o.x&&C5t(o,r)))&&(o=r,f=d)),r=r.next;while(r!==l);return o}function C5t(e,t){return xs(e.prev,e,t.prev)<0&&xs(t.next,e,e.next)<0}function S5t(e,t,r,n){var i=e;do i.z===0&&(i.z=YD(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,T5t(i)}function T5t(e){var t,r,n,i,a,o,s,l,u=1;do{for(r=e,e=null,a=null,o=0;r;){for(o++,n=r,s=0,t=0;t<u&&(s++,n=n.nextZ,!!n);t++);for(l=u;s>0||l>0&&n;)s!==0&&(l===0||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;r=n}a.nextZ=null,u*=2}while(o>1);return e}function YD(e,t,r,n,i){return e=(e-r)*i|0,t=(t-n)*i|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function A5t(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function ix(e,t,r,n,i,a,o,s){return(i-o)*(t-s)>=(e-o)*(a-s)&&(e-o)*(n-s)>=(r-o)*(t-s)&&(r-o)*(a-s)>=(i-o)*(n-s)}function M5t(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!R5t(e,t)&&(OC(e,t)&&OC(t,e)&&I5t(e,t)&&(xs(e.prev,e,t.prev)||xs(e,t.prev,t))||ZI(e,t)&&xs(e.prev,e,e.next)>0&&xs(t.prev,t,t.next)>0)}function xs(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function ZI(e,t){return e.x===t.x&&e.y===t.y}function BJ(e,t,r,n){var i=OT(xs(e,t,r)),a=OT(xs(e,t,n)),o=OT(xs(r,n,e)),s=OT(xs(r,n,t));return!!(i!==a&&o!==s||i===0&&LT(e,r,t)||a===0&&LT(e,n,t)||o===0&&LT(r,e,n)||s===0&&LT(r,t,n))}function LT(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function OT(e){return e>0?1:e<0?-1:0}function R5t(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&BJ(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function OC(e,t){return xs(e.prev,e,e.next)<0?xs(e,t,e.next)>=0&&xs(e,e.prev,t)>=0:xs(e,t,e.prev)<0||xs(e,e.next,t)<0}function I5t(e,t){var r=e,n=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;while(r!==e);return n}function NJ(e,t){var r=new ZD(e.i,e.x,e.y),n=new ZD(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function x$(e,t,r,n){var i=new ZD(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function PC(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function ZD(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}YI.deviation=function(e,t,r,n){var i=t&&t.length,a=i?t[0]*r:e.length,o=Math.abs(qD(e,0,a,r));if(i)for(var s=0,l=t.length;s<l;s++){var u=t[s]*r,c=s<l-1?t[s+1]*r:e.length;o-=Math.abs(qD(e,u,c,r))}var f=0;for(s=0;s<n.length;s+=3){var d=n[s]*r,v=n[s+1]*r,g=n[s+2]*r;f+=Math.abs((e[d]-e[g])*(e[v+1]-e[d+1])-(e[d]-e[v])*(e[g+1]-e[d+1]))}return o===0&&f===0?0:Math.abs((f-o)/o)};function qD(e,t,r,n){for(var i=0,a=t,o=r-n;a<r;a+=n)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}YI.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var a=0;a<e[i].length;a++)for(var o=0;o<t;o++)r.vertices.push(e[i][a][o]);i>0&&(n+=e[i-1].length,r.holes.push(n))}return r};var L5t=A4.exports;const _g=sa(L5t);function b$(e){return Math.max(Math.ceil(e/4)*4,4)}function kJ(e,t,r,n=!0){const i=r===3;if(n){e=e.slice();const o=[];for(let s=0;s<e.length;s+=r){o[0]=e[s],o[1]=e[s+1],i&&(o[2]=e[s+2]);const l=JA(o,!0,{enable:!1,decimal:1});e[s]=l[0],e[s+1]=l[1],i&&(e[s+2]=l[2])}}return _g(e,t,r)}const zJ="ATTRIBUTE_LOCATION_";class Ha{get attributeLocation(){return Ce({},km)}constructor(t){U(this,"triangulation",void 0),U(this,"uniformBuffers",[]),U(this,"textures",[]),U(this,"createTexture2D",void 0),U(this,"preStyleAttribute",{}),U(this,"encodeStyleAttribute",{}),U(this,"layer",void 0),U(this,"dataTexture",void 0),U(this,"DATA_TEXTURE_WIDTH",void 0),U(this,"dataTextureTest",void 0),U(this,"configService",void 0),U(this,"shaderModuleService",void 0),U(this,"rendererService",void 0),U(this,"iconService",void 0),U(this,"fontService",void 0),U(this,"styleAttributeService",void 0),U(this,"mapService",void 0),U(this,"cameraService",void 0),U(this,"layerService",void 0),U(this,"pickingService",void 0),U(this,"attributeUnifoms",void 0),U(this,"commonUnifoms",void 0),this.layer=t,this.configService=t.getContainer().globalConfigService,this.rendererService=t.getContainer().rendererService,this.pickingService=t.getContainer().pickingService,this.shaderModuleService=t.getContainer().shaderModuleService,this.styleAttributeService=t.getContainer().styleAttributeService,this.mapService=t.getContainer().mapService,this.iconService=t.getContainer().iconService,this.fontService=t.getContainer().fontService,this.cameraService=t.getContainer().cameraService,this.layerService=t.getContainer().layerService,this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();const{createTexture2D:r}=this.rendererService;this.createTexture2D=r}getBlend(){const{blend:t="normal"}=this.layer.getLayerConfig();return DJ[Am[t]]}getStencil(t){const{mask:r=!1,maskInside:n=!0,enableMask:i,maskOperation:a=HI.AND}=this.layer.getLayerConfig();if(this.layer.type==="MaskLayer")return _$({isStencil:!0,stencilType:Ry.SINGLE});if(t.isStencil)return _$(Ce(Ce({},t),{},{maskOperation:a}));const o=r||i&&this.layer.masks.length!==0||this.layer.tileMask!==void 0;return p5t(o,n)}getDefaultStyle(){return{}}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());this.updateStyleUnifoms();const n=Ce(Ce({},r.uniformsOption),t.uniformsOption);return Object.keys(n).forEach(i=>{typeof n[i]=="boolean"&&(n[i]=n[i]?1:0)}),!this.rendererService.hasOwnProperty("device")&&this.textures&&this.textures.length===1&&(n.u_texture=this.textures[0]),n}getAnimateUniforms(){return{}}needUpdate(){return Oe(function*(){return!1})()}buildModels(){return Oe(function*(){throw new Error("Method not implemented.")})()}initModels(){return Oe(function*(){throw new Error("Method not implemented.")})()}clearModels(t=!0){}getAttribute(){throw new Error("Method not implemented.")}prerender(){}render(t){throw new Error("Method not implemented.")}registerBuiltinAttributes(){throw new Error("Method not implemented.")}animateOption2Array(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}startModelAnimate(){const{animateOption:t}=this.layer.getLayerConfig();t.enable&&this.layer.setAnimateStartTime()}getInject(){return O5t(this.layer.enableShaderEncodeStyles,this.layer.encodeStyleAttribute)}getDefines(){const t=Object.keys(this.attributeLocation).reduce((r,n)=>{const i=zJ+n;return r[i]=this.attributeLocation[n],r},{});return Ce({},t)}getStyleAttribute(){const t={};return this.layer.enableShaderEncodeStyles.forEach(r=>{if(!this.layer.encodeStyleAttribute[r]){const n=this.layer.getLayerConfig()[r];let i=typeof n>"u"?v5t[r]:n;r==="stroke"&&(i=eo(i)),t["u_"+r]=i}}),t}registerStyleAttribute(){Object.keys(this.layer.encodeStyleAttribute).forEach(t=>{const r=QBt(t);r&&this.styleAttributeService.registerStyleAttribute(r)})}registerPosition64LowAttribute(t=!0){this.styleAttributeService.registerStyleAttribute({name:"position64Low",type:Jr.Attribute,descriptor:{name:"a_Position64Low",shaderLocation:this.attributeLocation.POSITION_64LOW,buffer:{data:[],type:K.FLOAT},size:2,update:(r,n,i)=>t?[nl(i[0]),nl(i[1])]:[0,0]}})}updateEncodeAttribute(t,r){this.encodeStyleAttribute[t]=r}initUniformsBuffer(){const t=this.getUniformsBufferInfo(this.getStyleAttribute()),r=this.getCommonUniformsInfo();t.uniformsLength!==0&&(this.attributeUnifoms=this.rendererService.createBuffer({data:new Float32Array(b$(t.uniformsLength)).fill(0),isUBO:!0,label:"layerModelAttributeUnifoms"}),this.uniformBuffers.push(this.attributeUnifoms)),r.uniformsLength!==0&&(this.commonUnifoms=this.rendererService.createBuffer({data:new Float32Array(b$(r.uniformsLength)).fill(0),isUBO:!0,label:"layerModelCommonUnifoms"}),this.uniformBuffers.push(this.commonUnifoms))}getUniformsBufferInfo(t){let r=0;const n=[];return Object.values(t).forEach(i=>{Array.isArray(i)?(n.push(...i),r+=i.length):typeof i=="number"?(n.push(i),r+=1):typeof i=="boolean"&&(n.push(Number(i)),r+=1)}),{uniformsOption:t,uniformsLength:r,uniformsArray:n}}getCommonUniformsInfo(){return{uniformsLength:0,uniformsArray:[],uniformsOption:{}}}updateStyleUnifoms(){var t,r;const{uniformsArray:n}=this.getUniformsBufferInfo(this.getStyleAttribute()),{uniformsArray:i}=this.getCommonUniformsInfo();(t=this.attributeUnifoms)===null||t===void 0||t.subData({offset:0,data:new Uint8Array(new Float32Array(n).buffer)}),(r=this.commonUnifoms)===null||r===void 0||r.subData({offset:0,data:new Uint8Array(new Float32Array(i).buffer)})}}function O5t(e,t){const r=[];let n="";e.forEach(o=>{const s=o.replace(/([a-z])([A-Z])/g,"$1_$2").toUpperCase(),l=zJ+s;t[o]?n+=`#define USE_ATTRIBUTE_${s} 0.0 
`:r.push(`  ${IT[o]} u_${o};`),n+=`
#ifdef USE_ATTRIBUTE_${s}
layout(location = ${l}) in ${IT[o]} a_${o.charAt(0).toUpperCase()+o.slice(1)};
#endif 
`});const i=r.length?`
layout(std140) uniform AttributeUniforms {
  ${r.join(`
`)}
};
`:"";n+=i;let a="";return e.forEach(o=>{const s=o.replace(/([a-z])([A-Z])/g,"$1_$2").toUpperCase();a+=`
  #ifdef USE_ATTRIBUTE_${s}
    ${IT[o]} ${o} = a_${o.charAt(0).toUpperCase()+o.slice(1)};
  #else
    ${IT[o]} ${o} = u_${o};
  #endif
  `}),{"vs:#decl":n,"fs:#decl":i,"vs:#main-start":a}}let E$=function(e){return e.VERTICAL="vertical",e.HORIZONTAL="horizontal",e}({}),P5t=function(e){return e.NORMAL="normal",e.REPLACE="replace",e}({}),M4=function(e){return e[e.pixel=0]="pixel",e[e.meter=1]="meter",e}({});const UJ=100;function w$(e){return e/180*Math.acos(-1)}function $J(e){const t=w$(e[0])+Math.PI/2,r=w$(e[1]),n=UJ+Math.random()*.4,i=n*Math.cos(r)*Math.cos(t),a=n*Math.cos(r)*Math.sin(t),o=n*Math.sin(r);return[a,o,i]}const C$=Uc();Uc();const Rf=Uc(),YE=Uc(),PT=Uc();function S$(e,t,r,n,i){Vl(e,r,n),jx(e,e),t=ID(-e[1],e[0]);const a=ID(-r[1],r[0]);return[i/XM(t,a),t]}function ZE(e,t){return JIt(e,-t[1],t[0])}function DT(e,t,r){return fg(e,t,r),jx(e,e),e}function T$(e,t){return e[0]===t[0]&&e[1]===t[1]}class D5t{constructor(t={}){U(this,"complex",void 0),U(this,"join",void 0),U(this,"cap",void 0),U(this,"miterLimit",void 0),U(this,"thickness",void 0),U(this,"normal",void 0),U(this,"lastFlip",-1),U(this,"miter",ID(0,0)),U(this,"started",!1),U(this,"dash",!1),U(this,"totalDistance",0),U(this,"currentIndex",0),this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}simpleExtrude(t){const r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;const n=t.length;let i=r.startIndex;for(let a=1;a<n;a++){const o=t[a-1],s=t[a],l=a<t.length-1?t[a+1]:null,u=this.simpleSegment(r,i,o,s,l);i+=u}if(this.dash)for(let a=0;a<r.positions.length/6;a++)r.positions[a*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}extrude(t){const r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;const n=t.length;let i=r.startIndex;for(let a=1;a<n;a++){const o=t[a-1],s=t[a],l=a<t.length-1?t[a+1]:null,u=this.segment(r,i,o,s,l);i+=u}if(this.dash)for(let a=0;a<r.positions.length/6;a++)r.positions[a*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}simpleSegment(t,r,n,i,a){let o=0;const s=t.indices,l=t.positions,u=t.normals,c=Nf([i[0],i[1]]),f=Nf([n[0],n[1]]);DT(Rf,c,f);let d=0;if(this.dash&&(d=this.lineSegmentDistance(c,f),this.totalDistance+=d),this.normal||(this.normal=Uc(),ZE(this.normal,Rf)),this.started||(this.started=!0,this.extrusions(l,u,n,this.normal,this.thickness,this.totalDistance-d)),s.push(r+0,r+1,r+2),!a)ZE(this.normal,Rf),this.extrusions(l,u,i,this.normal,this.thickness,this.totalDistance),s.push(...this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3]),o+=2;else{const v=Nf([a[0],a[1]]);T$(c,v)&&Vl(v,c,jx(v,WM(v,c,f))),DT(YE,v,c);const[g,x]=S$(PT,Uc(),Rf,YE,this.thickness);let w=XM(PT,this.normal)<0?-1:1;this.extrusions(l,u,i,x,g,this.totalDistance),s.push(...this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3]),w=-1,MO(this.normal,x),o+=2,this.lastFlip=w}return o}segment(t,r,n,i,a){let o=0;const s=t.indices,l=t.positions,u=t.normals,c=this.cap==="square",f=this.join==="bevel",d=Nf([i[0],i[1]]),v=Nf([n[0],n[1]]);DT(Rf,d,v);let g=0;if(this.dash&&(g=this.lineSegmentDistance(d,v),this.totalDistance+=g),this.normal||(this.normal=Uc(),ZE(this.normal,Rf)),!this.started)if(this.started=!0,c){const x=Uc(),w=Uc();Vl(x,this.normal,Rf),Vl(w,this.normal,Rf),u.push(w[0],w[1],0),u.push(x[0],x[1],0),l.push(n[0],n[1],n[2]|0,this.totalDistance-g,-this.thickness,n[2]|0),this.complex.indexes.push(this.currentIndex),l.push(n[0],n[1],n[2]|0,this.totalDistance-g,this.thickness,n[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,u,n,this.normal,this.thickness,this.totalDistance-g);if(s.push(r+0,r+1,r+2),a){const x=Nf([a[0],a[1]]);T$(d,x)&&Vl(x,d,jx(x,WM(x,d,v))),DT(YE,x,d);const[w,S]=S$(PT,Uc(),Rf,YE,this.thickness);let M=XM(PT,this.normal)<0?-1:1,R=f;!R&&this.join==="miter"&&w>this.miterLimit&&(R=!0),R?(u.push(this.normal[0],this.normal[1],0),u.push(S[0],S[1],0),l.push(i[0],i[1],i[2]|0,this.totalDistance,-this.thickness*M,i[2]|0),this.complex.indexes.push(this.currentIndex),l.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness*M,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,s.push(...this.lastFlip!==-M?[r,r+2,r+3]:[r+2,r+1,r+3]),s.push(r+2,r+3,r+4),ZE(C$,YE),MO(this.normal,C$),u.push(this.normal[0],this.normal[1],0),l.push(i[0],i[1],i[2]|0,this.totalDistance,-this.thickness*M,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,o+=3):(this.extrusions(l,u,i,S,w,this.totalDistance),s.push(...this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3]),M=-1,MO(this.normal,S),o+=2),this.lastFlip=M}else{if(ZE(this.normal,Rf),c){const x=Uc(),w=Uc();fg(w,Rf,this.normal),Vl(x,Rf,this.normal),u.push(w[0],w[1],0),u.push(x[0],x[1],0),l.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),l.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,u,i,this.normal,this.thickness,this.totalDistance);s.push(...this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3]),o+=2}return o}extrusions(t,r,n,i,a,o){r.push(i[0],i[1],0),r.push(i[0],i[1],0),t.push(n[0],n[1],n[2]|0,o,-a,n[2]|0),this.complex.indexes.push(this.currentIndex),t.push(n[0],n[1],n[2]|0,o,a,n[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}lineSegmentDistance(t,r){const n=r[0]-t[0],i=r[1]-t[1];return Math.sqrt(n*n+i*i)}}let qE=function(e){return e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn",e}({}),KE=function(e){return e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon",e}({});function zS(e,t=0){const r=Math.PI*2/e,n=[];for(let a=0;a<e;a++)n.push(r*a+t*Math.PI/12);return n.map(a=>{const o=Math.sin(a+Math.PI/4),s=Math.cos(a+Math.PI/4);return[o,s,0]})}function KD(){return zS(30)}function A$(){return zS(4)}function M$(){return zS(3)}function R$(){return zS(6,1)}function I$(){return zS(5)}const Ex={[KE.CIRCLE]:KD,[KE.HEXAGON]:R$,[KE.TRIANGLE]:M$,[KE.SQUARE]:A$,[KE.PENTAGON]:I$,[qE.CYLINDER]:KD,[qE.HEXAGONCOLUMN]:R$,[qE.TRIANGLECOLUMN]:M$,[qE.SQUARECOLUMN]:A$,[qE.PENTAGONCOLUMN]:I$};function F5t(e){const t=e[0][0],r=e[0][e[0].length-1];t[0]===r[0]&&t[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));const n=e[0].length,i=_g.flatten(e),{vertices:a,dimensions:o}=i,s=[],l=[];for(let c=0;c<a.length/o;c++)o===2?s.push(a[c*2],a[c*2+1],1):s.push(a[c*3],a[c*3+1],1);const u=_g(i.vertices,i.holes,i.dimensions);l.push(...u);for(let c=0;c<n;c++){const f=i.vertices.slice(c*o,(c+1)*o);let d=i.vertices.slice((c+1)*o,(c+2)*o);d.length===0&&(d=i.vertices.slice(0,o));const v=s.length/3;s.push(f[0],f[1],1,d[0],d[1],1,f[0],f[1],0,d[0],d[1],0),l.push(...[0,2,1,2,3,1].map(g=>g+v))}return{positions:s,index:l}}function B5t(e){const t=_g.flatten(e),r=_g(t.vertices,t.holes,t.dimensions);return{positions:t.vertices,index:r}}function HJ(e,t=!1){const r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));const i=e[0].length,a=_g.flatten(e),{vertices:o,dimensions:s,holes:l}=a,u=[],c=[],f=[];for(let v=0;v<o.length/s;v++)u.push(o[v*s],o[v*s+1],1,-1,-1),f.push(0,0,1);const d=kJ(o,l,s,t);c.push(...d);for(let v=0;v<i;v++){const g=a.vertices.slice(v*s,(v+1)*s);let x=a.vertices.slice((v+1)*s,(v+2)*s);x.length===0&&(x=a.vertices.slice(0,s));const w=u.length/5;u.push(g[0],g[1],1,0,0,x[0],x[1],1,.1,0,g[0],g[1],0,0,.8,x[0],x[1],0,.1,.8);const S=N5t([x[0],x[1],1],[g[0],g[1],0],[g[0],g[1],1],t);f.push(...S,...S,...S,...S),c.push(...[1,2,0,3,2,1].map(M=>M+w))}return{positions:u,index:c,normals:f}}function N5t(e,t,r,n=!1){const i=ww(),a=ww(),o=ww();n&&(e=JA(e),t=JA(t),r=JA(r));const s=su(...e),l=su(...t),u=su(...r);WU(i,u,l),WU(a,s,l),qIt(o,i,a);const c=ww();return Cw(c,o),c}const FT={};function $y(e){const t=t_(e.coordinates);return{vertices:[...t,...t,...t,...t],indices:[0,1,2,2,3,0],size:t.length}}function L$(e){const t=t_(e.coordinates),r=$J(t);return{vertices:[...r,...r,...r,...r],indices:[0,1,2,2,3,0],size:r.length}}function R4(e){const{shape:t}=e,{positions:r,index:n,normals:i}=V5t(t,!1);return{vertices:r,indices:n,normals:i,size:5}}function k5t(e){const t=t_(e.coordinates);return{vertices:[...t],indices:[0],size:t.length}}function QD(e){const{coordinates:t}=e,r=new D5t({dash:!0,join:"bevel"});let n=t;n[0]&&!Array.isArray(n[0][0])&&(n=[t]),n.forEach(a=>{r.extrude(a)});const i=r.complex;return{vertices:i.positions,indices:i.indices,normals:i.normals,indexes:i.indexes,size:6}}function z5t(e){const{coordinates:t}=e,r=[];if(!Array.isArray(t[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};const{results:n,totalDistance:i}=U5t(t);return n.map(a=>{r.push(a[0],a[1],a[2],a[3],0,i)}),{vertices:r,indices:[],normals:[],size:6,count:n.length}}function O$(e,t){const r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)}function zO(e,t){return e.length<3&&e.push(0),t!==void 0&&e.push(t),e}function U5t(e){let t=e;Array.isArray(t)&&Array.isArray(t[0])&&Array.isArray(t[0][0])&&(t=e.flat());let r=0;if(t.length<2)return{results:t,totalDistance:0};{const n=[],i=zO(t[0],r);n.push(i);for(let o=1;o<t.length-1;o++){const s=O$(Nf(t[o-1]),Nf(t[o]));r+=s;const l=zO(t[o],r);n.push(l),n.push(l)}const a=O$(Nf(t[t.length-2]),Nf(t[t.length-1]));return r+=a,n.push(zO(t[t.length-1],r)),{results:n,totalDistance:r}}}function US(e){const{coordinates:t}=e,r=_g.flatten(t),{vertices:n,dimensions:i,holes:a}=r;return{indices:kJ(n,a,i),vertices:n,size:i}}function $5t(e){const{indices:t,vertices:r,size:n}=US(e);return{indices:t,vertices:H5t(r),size:n+4}}function H5t(e){const t=[],{center:r,radius:n}=wAt(e);for(let i=0;i<e.length;i+=2){const a=e[i],o=e[i+1];t.push(a,o,0,...r,n)}return t}function VJ(e){const t=e.coordinates,{positions:r,index:n,normals:i}=HJ(t,!0);return{vertices:r,indices:n,normals:i,size:5}}function GJ(e){const{shape:t}=e,{positions:r,index:n}=G5t(t);return{vertices:r,indices:n,size:3}}function qI(e){const t=e.coordinates;return{vertices:[...t[0],0,0,0,...t[1],0,1,0,...t[2],0,1,1,...t[3],0,0,1],indices:[0,1,2,0,2,3],size:5}}function I4(e,t){const{segmentNumber:r=30}=t,n=e.coordinates,i=[],a=[];for(let o=0;o<r;o++)i.push(o,1,o,n[0][0],n[0][1],n[1][0],n[1][1],o,-1,o,n[0][0],n[0][1],n[1][0],n[1][1]),o!==r-1&&a.push(...[0,1,2,1,3,2].map(s=>o*2+s));return{vertices:i,indices:a,size:7}}function P$(e){const t=e.coordinates;t.length===2&&t.push(0);const r=BT(-1,1),n=BT(1,1),i=BT(-1,-1),a=BT(1,-1);return{vertices:[...t,...r,...t,...i,...t,...a,...t,...n],indices:[0,1,2,3,0,2],size:5}}function V5t(e,t=!1){if(FT&&FT[e])return FT[e];const r=Ex[e]?Ex[e]():Ex.cylinder(),n=HJ([r],t);return FT[e]=n,n}function G5t(e){const t=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=Ex[e]?Ex[e]():Ex.circle();return t.indexOf(e)===-1?B5t([r]):F5t([r])}function BT(e,t){const r=(e+1)/2,n=(t+1)/2;return[r,n]}function WJ(e,t){return{type:e.type,field:"value",items:e.positions.map((r,n)=>({[t]:n>=e.colors.length?null:e.colors[n],value:r}))}}const W5t=`in vec4 v_color;

#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,X5t=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location =  ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;

layout(std140) uniform commonUniforms {
    vec2 u_radius;
    float u_opacity;
    float u_coverage;
    float u_angle;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
  v_color.a *= u_opacity;

  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage;

  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
  vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  gl_Position = project_common_position_to_clipspace(project_pos);

  setPickingColor(a_PickingColor);
}
`;class j5t extends Ha{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,POS:9})}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Ce(Ce({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{opacity:t,coverage:r,angle:n}=this.layer.getLayerConfig(),i={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:t||1,u_coverage:r||.9,u_angle:n||0};return this.getUniformsBufferInfo(i)}initModels(){var t=this;return Oe(function*(){return t.buildModels()})()}buildModels(){var t=this;return Oe(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:X5t,fragmentShader:W5t,defines:t.getDefines(),triangulation:GJ,primitive:K.TRIANGLES,depth:{enable:!1}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Jr.Attribute,descriptor:{shaderLocation:this.attributeLocation.POS,name:"a_Pos",buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:3,update:t=>{const r=t.coordinates;return[r[0],r[1],0]}}})}}const Y5t=`in vec4 v_color;

layout(std140) uniform commonUniforms {
  vec2 u_radius;
  float u_opacity;
  float u_coverage;
  float u_angle;
};

#pragma include "scene_uniforms"
#pragma include "picking"

out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,Z5t=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
  vec2 u_radius;
  float u_opacity;
  float u_coverage;
  float u_angle;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"

void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset = vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage);

  vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // 实际的经纬度
  vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

  float lightWeight = calc_lighting(project_pos);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  gl_Position = project_common_position_to_clipspace(project_pos);

  setPickingColor(a_PickingColor);
}
`;class q5t extends Ha{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,POS:10,NORMAL:11})}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Ce(Ce({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{opacity:t,coverage:r,angle:n}=this.layer.getLayerConfig(),i={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:t||1,u_coverage:r||.9,u_angle:n||0};return this.getUniformsBufferInfo(i)}initModels(){var t=this;return Oe(function*(){return t.buildModels()})()}buildModels(){var t=this;return Oe(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:Z5t,fragmentShader:Y5t,defines:t.getDefines(),triangulation:R4,primitive:K.TRIANGLES,depth:{enable:!0}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Jr.Attribute,descriptor:{shaderLocation:this.attributeLocation.SIZE,name:"a_Size",buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:t=>{const{size:r}=t;return Array.isArray(r)?[r[0]]:[r]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Jr.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:3,update:(t,r,n,i,a)=>a}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Jr.Attribute,descriptor:{name:"a_Pos",shaderLocation:this.attributeLocation.POS,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:3,update:t=>{const r=t.coordinates;return[r[0],r[1],0]}}})}}function K5t(e,t){const r=[],n=[],i=[],a=e+1,o=t+1,s=e/2,l=t/2;for(let u=0;u<o;u++){const c=u-l;for(let f=0;f<a;f++){const d=f-s;n.push(d/s,-c/l,0),i.push(f/e),i.push(1-u/t)}}for(let u=0;u<t;u++)for(let c=0;c<e;c++){const f=c+a*u,d=c+a*(u+1),v=c+1+a*(u+1),g=c+1+a*u;r.push(f,d,g),r.push(d,v,g)}return{vertices:n,indices:r,uvs:i}}const Q5t=`layout(std140) uniform commonUniforms {
  mat4 u_ViewProjectionMatrixUncentered;
  mat4 u_InverseViewProjectionMatrix;
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

in vec2 v_texCoord;
in float v_intensity;
out vec4 outputColor;

void main(){
   
    float intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;
    vec4 color = texture(SAMPLER_2D(u_colorTexture),vec2(intensity, 0));
    outputColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
   outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,J5t=`layout(location = 0) in vec3 a_Position;
layout(location = 10) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  mat4 u_ViewProjectionMatrixUncentered;
  mat4 u_InverseViewProjectionMatrix;
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

out vec2 v_texCoord;
out float v_intensity;

vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
  float t2 = t * t;
  float one_minus_t = 1.0 - t;
  float one_minus_t2 = one_minus_t * one_minus_t;
  return P0 * one_minus_t2 * one_minus_t +
  P1 * 3.0 * t * one_minus_t2 +
  P2 * 3.0 * t2 * one_minus_t +
  P3 * t2 * t;
}
vec2 toBezier(float t, vec4 p) {
  return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}

#pragma include "projection"
#pragma include "project"

void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // 将原本 0 -> 1 的 uv 转换为 -1 -> 1 的标准坐标空间（NDC）

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y 平面上的点（z == 0）可以认为是三维上的点被投影到平面后的点
  vec4 p2 = vec4(pos, 1.0, 1.0); // 平行于x/y平面、z==1 的平面上的点

  vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // 根据视图投影矩阵的逆矩阵平面上的反算出三维空间中的点（p1平面上的点）
  vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // 归一化操作（归一化后为世界坐标）
  inverseP2 = inverseP2 / inverseP2.w;

  float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
  vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b = vec4(0.5, 0.0, 1.0, 0.5);
  float fh;

  v_intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.0), 1.0);

}
`,t4t=`uniform sampler2D u_texture;        // 热力强度图
uniform sampler2D u_colorTexture;   // 根据强度分布的色带

layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};
in vec2 v_texCoord;
out vec4 outputColor;

#pragma include "scene_uniforms"

float getBlurIndusty() {
    float vW = 2.0/ u_ViewportSize.x;
    float vH = 2.0/ u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture(SAMPLER_2D(u_texture), vec2( vUv.x , vUv.y) ).r;
    float i23 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(intensity, 0.0));
    outputColor = color;
    outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,e4t=`layout(location = 0) in vec3 a_Position;
layout(location = 10) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

#pragma include "scene_uniforms"

out vec2 v_texCoord;
void main() {
  v_texCoord = a_Uv;
  #ifdef VIEWPORT_ORIGIN_TL
  v_texCoord.y = 1.0 - v_texCoord.y;
  #endif

  gl_Position = vec4(a_Position.xy, 0, 1.0);
}
`,r4t=`layout(std140) uniform commonUniforms {
  float u_radius;
  float u_intensity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
};

in vec2 v_extrude;
in float v_weight;
out vec4 outputColor;
#define GAUSS_COEF  0.3989422804014327

void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    outputColor = vec4(val, 1., 1., 1.);
}
`,n4t=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_DIR) in vec2 a_Dir;

layout(std140) uniform commonUniforms {
  float u_radius;
  float u_intensity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
};

out vec2 v_extrude;
out float v_weight;

#define GAUSS_COEF (0.3989422804014327)

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 picking_color_placeholder = u_PickingColor;

  v_weight = a_Size;
  float ZERO = 1.0 / 255.0 / 16.0;
  float extrude_x = a_Dir.x * 2.0 - 1.0;
  float extrude_y = a_Dir.y * 2.0 - 1.0;
  vec2 extrude_dir = normalize(vec2(extrude_x, extrude_y));
  float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
  v_extrude = extrude_dir * S;

  vec2 offset = project_pixel(v_extrude * u_radius);
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

}
`,{isEqual:i4t}=as;class D$ extends Ha{constructor(...t){super(...t),U(this,"texture",void 0),U(this,"colorTexture",void 0),U(this,"heatmapFramerBuffer",void 0),U(this,"heatmapTexture",void 0),U(this,"intensityModel",void 0),U(this,"colorModel",void 0),U(this,"shapeType",void 0),U(this,"preRampColors",void 0),U(this,"colorModelUniformBuffer",[]),U(this,"heat3DModelUniformBuffer",[])}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,UV:10,DIR:11})}prerender(){const{clear:t,useFramebuffer:r}=this.rendererService;r(this.heatmapFramerBuffer,()=>{t({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.heatmapFramerBuffer}),this.drawIntensityMode()})}render(t){const{rampColors:r}=this.layer.getLayerConfig();i4t(this.preRampColors,r)||this.updateColorTexture(),this.shapeType==="heatmap"?this.drawHeatMap(t):this.draw3DHeatMap(t)}getUninforms(){throw new Error("Method not implemented.")}initModels(){var t=this;return Oe(function*(){var r;const{createFramebuffer:n,getViewportSize:i,createTexture2D:a}=t.rendererService,o=t.styleAttributeService.getLayerStyleAttribute("shape"),s=(o==null||(r=o.scale)===null||r===void 0?void 0:r.field)||"heatmap";t.shapeType=s,t.intensityModel=yield t.buildHeatMapIntensity(),t.colorModel=s==="heatmap"?t.buildHeatmap():t.build3dHeatMap();const{width:l,height:u}=i();return t.heatmapTexture=a({width:Math.floor(l/4),height:Math.floor(u/4),wrapS:K.CLAMP_TO_EDGE,wrapT:K.CLAMP_TO_EDGE,min:K.LINEAR,mag:K.LINEAR,usage:r_.RENDER_TARGET}),t.heatmapFramerBuffer=n({color:t.heatmapTexture,depth:!0,width:Math.floor(l/4),height:Math.floor(u/4)}),t.updateColorTexture(),[t.intensityModel,t.colorModel]})()}buildModels(){var t=this;return Oe(function*(){return t.initModels()})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Jr.Attribute,descriptor:{name:"a_Dir",shaderLocation:this.attributeLocation.DIR,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:(t,r,n)=>[n[3],n[4]]}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Jr.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:t=>{const{size:r=1}=t;return[r]}}})}buildHeatMapIntensity(){var t=this;return Oe(function*(){return t.uniformBuffers=[t.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})],t.layer.triangulation=P$,yield t.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:n4t,fragmentShader:r4t,triangulation:P$,defines:t.getDefines(),depth:{enable:!1},cull:{enable:!0,face:K.FRONT}})})()}buildHeatmap(){this.shaderModuleService.registerModule("heatmapColor",{vs:e4t,fs:t4t}),this.colorModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})];const{vs:t,fs:r,uniforms:n}=this.shaderModuleService.getModule("heatmapColor"),{createAttribute:i,createElements:a,createBuffer:o,createModel:s}=this.rendererService;return s({vs:t,fs:r,uniformBuffers:[...this.colorModelUniformBuffer,...this.rendererService.uniformBuffers],attributes:{a_Position:i({shaderLocation:this.attributeLocation.POSITION,buffer:o({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:K.FLOAT}),size:3}),a_Uv:i({shaderLocation:this.attributeLocation.UV,buffer:o({data:[0,1,1,1,0,0,1,0],type:K.FLOAT}),size:2})},uniforms:Ce({},n),depth:{enable:!1},elements:a({data:[0,2,1,2,3,1],type:K.UNSIGNED_INT,count:6})})}build3dHeatMap(){const{getViewportSize:t}=this.rendererService,{width:r,height:n}=t(),i=K5t(r/4,n/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:J5t,fs:Q5t}),this.heat3DModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(16*2+4).fill(0),isUBO:!0})];const{vs:a,fs:o,uniforms:s}=this.shaderModuleService.getModule("heatmap3dColor"),{createAttribute:l,createElements:u,createBuffer:c,createModel:f}=this.rendererService;return f({vs:a,fs:o,attributes:{a_Position:l({shaderLocation:this.attributeLocation.POSITION,buffer:c({data:i.vertices,type:K.FLOAT}),size:3}),a_Uv:l({shaderLocation:this.attributeLocation.UV,buffer:c({data:i.uvs,type:K.FLOAT}),size:2})},primitive:K.TRIANGLES,uniformBuffers:[...this.heat3DModelUniformBuffer,...this.rendererService.uniformBuffers],uniforms:Ce({},s),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:K.SRC_ALPHA,srcAlpha:1,dstRGB:K.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:u({data:i.indices,type:K.UNSIGNED_INT,count:i.indices.length})})}drawIntensityMode(){var t;const{intensity:r=10,radius:n=5}=this.layer.getLayerConfig(),i={u_radius:n,u_intensity:r};this.uniformBuffers[0].subData({offset:0,data:[n,r]}),this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),(t=this.intensityModel)===null||t===void 0||t.draw({uniforms:i,blend:{enable:!0,func:{srcRGB:K.ONE,srcAlpha:1,dstRGB:K.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}drawHeatMap(t){var r;const{opacity:n=1}=this.layer.getLayerConfig(),i={u_opacity:n,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},a=[this.heatmapTexture,this.colorTexture];this.colorModelUniformBuffer[0].subData({offset:0,data:[n]}),(r=this.colorModel)===null||r===void 0||r.draw({uniforms:i,textures:a,blend:this.getBlend(),stencil:this.getStencil(t)})}draw3DHeatMap(t){var r;const{opacity:n=1}=this.layer.getLayerConfig(),i=A_();EC(i,this.cameraService.getViewProjectionMatrixUncentered());const a={u_opacity:n,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:[...i]};this.heat3DModelUniformBuffer[0].subData({offset:0,data:[...a.u_ViewProjectionMatrixUncentered,...a.u_InverseViewProjectionMatrix,n]});const o=[this.heatmapTexture,this.colorTexture];(r=this.colorModel)===null||r===void 0||r.draw({uniforms:a,textures:o,blend:{enable:!0,func:{srcRGB:K.SRC_ALPHA,srcAlpha:1,dstRGB:K.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(t)})}updateColorTexture(){const{createTexture2D:t}=this.rendererService;this.texture&&this.texture.destroy();const{rampColors:r}=this.layer.getLayerConfig(),n=Tq(r);this.colorTexture=t({data:n.data,usage:r_.SAMPLED,width:n.width,height:n.height,wrapS:K.CLAMP_TO_EDGE,wrapT:K.CLAMP_TO_EDGE,min:K.NEAREST,mag:K.NEAREST,flipY:!1,unorm:!0}),this.preRampColors=r}}const a4t=`in vec4 v_color;

#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,o4t=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;

layout(std140) uniform commonUniforms {
  vec2 u_radius;
  float u_opacity;
  float u_coverage;
  float u_angle;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
  v_color.a *= u_opacity;

  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset = vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage);
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);

  vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`;class s4t extends Ha{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,POS:9})}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Ce(Ce({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{opacity:t,coverage:r,angle:n}=this.layer.getLayerConfig(),i={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:t||1,u_coverage:r||.9,u_angle:n||0};return this.getUniformsBufferInfo(i)}initModels(){var t=this;return Oe(function*(){return t.buildModels()})()}buildModels(){var t=this;return Oe(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:o4t,fragmentShader:a4t,defines:t.getDefines(),triangulation:GJ,depth:{enable:!1},primitive:K.TRIANGLES})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Jr.Attribute,descriptor:{name:"a_Pos",shaderLocation:this.attributeLocation.POS,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:3,update:t=>{const r=t.coordinates;return[r[0],r[1],0]}}})}}const l4t={heatmap:D$,heatmap3d:D$,grid:j5t,grid3d:q5t,hexagon:s4t},u4t=l4t;class ULe extends L_{constructor(...t){super(...t),U(this,"type","HeatMapLayer")}buildModels(){var t=this;return Oe(function*(){const r=t.getModelType();t.layerModel=new u4t[r](t),yield t.initLayerModels()})()}prerender(){this.getModelType()==="heatmap"&&this.layerModel&&this.layerModel.prerender()}renderModels(t={}){return this.getModelType()==="heatmap"?(this.layerModel&&this.layerModel.render(t),this):this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(n=>n.draw({uniforms:this.layerModel.getUninforms(),blend:this.layerModel.getBlend(),stencil:this.layerModel.getStencil(t)})),this.hooks.afterRender.call(),this)}updateModelData(t){t.attributes&&t.elements?this.models[0].updateAttributesAndElements(t.attributes,t.elements):console.warn("data error")}getModelType(){var t;const r=this.styleAttributeService.getLayerStyleAttribute("shape"),{shape3d:n}=this.getLayerConfig(),a=this.getSource().data.type,o=(r==null||(t=r.scale)===null||t===void 0?void 0:t.field)||"heatmap";return o==="heatmap"||o==="heatmap3d"?"heatmap":a==="hexagon"?(n==null?void 0:n.indexOf(o))===-1?"hexagon":"grid3d":a==="grid"?(n==null?void 0:n.indexOf(o))===-1?"grid":"grid3d":"heatmap"}getLegend(t){if(this.getModelType()==="heatmap"){if(t!=="color")return{type:void 0,field:void 0,items:[]};const r=this.getLayerConfig().rampColors;return WJ(r,t)}else return super.getLegend(t)}}const c4t=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
    float u_opacity:1.0;
    float u_brightness:1.0;
    float u_contrast:1.0;
    float u_saturation:1.0;
    float u_gamma:1.0;
};

in vec2 v_texCoord;
out vec4 outputColor;
vec3 setContrast(vec3 rgb, float contrast) {
  vec3 color = mix(vec3(0.5), rgb, contrast);
  color = clamp(color, 0.0, 1.0);
  return color;
}
vec3 setSaturation(vec3 rgb, float adjustment) {
  const vec3 grayVector = vec3(0.2125, 0.7154, 0.0721);
  vec3 intensity = vec3(dot(rgb, grayVector));
  vec3 color = mix(intensity, rgb, adjustment);
  color = clamp(color, 0.0, 1.0);
  return color;
}
void main() {
  vec4 color = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y));
  //brightness
  color.rgb = mix(vec3(0.0, 0.0, 0.0), color.rgb, u_brightness);
  //contrast
  color.rgb = setContrast(color.rgb, u_contrast);
  // saturation
  color.rgb = setSaturation(color.rgb, u_saturation);
  // gamma
  color.rgb = pow(color.rgb, vec3(u_gamma));
  outputColor = color;
  outputColor.a *= u_opacity;
  if(outputColor.a < 0.01)
    discard;
}
`,h4t=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
    float u_opacity:1.0;
    float u_brightness:1.0;
    float u_contrast:1.0;
    float u_saturation:1.0;
    float u_gamma:1.0;
};

out vec2 v_texCoord;
#pragma include "projection"

void main() {
  v_texCoord = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
}
`;let f4t=class extends Ha{constructor(...t){super(...t),U(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getCommonUniformsInfo(){const{opacity:t,brightness:r,contrast:n,saturation:i,gamma:a}=this.layer.getLayerConfig(),o={u_opacity:zE(t,1),u_brightness:zE(r,1),u_contrast:zE(n,1),u_saturation:zE(i,1),u_gamma:zE(a,1)};return this.textures=[this.texture],this.getUniformsBufferInfo(o)}initModels(){var t=this;return Oe(function*(){return yield t.loadTexture(),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}loadTexture(){var t=this;return Oe(function*(){const{createTexture2D:r}=t.rendererService,i=yield t.layer.getSource().data.images;t.texture=r({data:i[0],width:i[0].width,height:i[0].height,mag:K.LINEAR,min:K.LINEAR})})()}buildModels(){var t=this;return Oe(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:h4t,fragmentShader:c4t,defines:t.getDefines(),triangulation:qI,primitive:K.TRIANGLES,blend:{enable:!0},depth:{enable:!1},pickingEnabled:!1})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Jr.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:(t,r,n)=>[n[3],n[4]]}})}};const d4t={image:f4t},p4t=d4t;class v4t extends L_{constructor(...t){super(...t),U(this,"type","ImageLayer")}buildModels(){var t=this;return Oe(function*(){const r=t.getModelType();t.layerModel=new p4t[r](t),yield t.initLayerModels()})()}getDefaultConfig(){const t=this.getModelType();return{image:{}}[t]}getModelType(){return"image"}}const g4t=`
#define Animate 0.0
#define LineTexture 1.0
uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_lineDir: 1.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_blur : 0.9;
  float u_line_type: 0.0;
  float u_time;
  float u_linearColor: 0.0;
};

in vec4 v_color;
in vec2 v_iconMapUV;
in vec4 v_lineData;
//dash
in vec4 v_dash_array;
in float v_distance_ratio;

out vec4 outputColor;
#pragma include "picking"

void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      discard;
    };
  }
  float animateSpeed = 0.0; // 运动速度
  outputColor = v_color;
  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      outputColor.a *= alpha;
  }

  // 当存在贴图时在底色上贴上贴图
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = v_lineData.g; // 贴图在弧线上重复的数量

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = v_lineData.a; // 横向 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
    
  } else {
     outputColor = filterColor(outputColor);
  }
}`,m4t=`#define Animate (0.0)
#define LineTexture (1.0)

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;
layout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_lineDir: 1.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_blur : 0.9;
  float u_line_type: 0.0;
  float u_time;
  float u_linearColor: 0.0;
};

out vec4 v_color;
out vec2 v_iconMapUV;
out vec4 v_lineData;
//dash
out vec4 v_dash_array;
out float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1.0 - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2 * cos(theta2) + source.x, r2 * sin(theta2) + source.y);
  if (u_lineDir == 1.0) {
    // 正向
    return mid;
  } else {
    // 逆向
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  // dash: index / (segmentNumber - 1.);
  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
  //  return index / (segmentNumber - 1.);
}
vec2 interpolate(vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x, t), bezier3(y, t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return dir_screenspace.xy * sign(offset_direction);
}

void main() {
  //vs中计算渐变色
  if (u_linearColor == 1.0) {
    float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置
    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex / segmentNumber);
  } else {
    v_color = a_Color;
  }
  v_color.a = v_color.a * opacity;

  vec2 source_world = a_Instance.rg; // 起始点
  vec2 target_world = a_Instance.ba; // 终点

  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  // 计算 dashArray 和 distanceRatio 输出到片元
  float total_Distance = pixelDistance(source_world, target_world) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  v_distance_ratio = segmentIndex / segmentNumber;

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

  v_lineData.b = d_distance_ratio;

  vec4 source = project_position(vec4(source_world, 0, 1.), a_Instance64Low.xy);
  vec4 target = project_position(vec4(target_world, 0, 1.), a_Instance64Low.zw);

  vec2 currPos = interpolate(source.xy, target.xy, segmentRatio, thetaOffset);
  vec2 nextPos = interpolate(source.xy, target.xy, nextSegmentRatio, thetaOffset);

  vec2 offset = project_pixel(
    getExtrusionOffset((nextPos.xy - currPos.xy) * indexDir, a_Position.y)
  );

  float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置
  v_lineData.r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // 开启贴图模式
    float arcDistrance = length(source - target); // 起始点和终点的距离
    arcDistrance = project_pixel(arcDistrance);

    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // 贴图沿弧线方向的长度 - 随地图缩放改变
    float texCount = floor(arcDistrance / pixelLen); // 贴图在弧线上重复的数量
    v_lineData.g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离
    float linePixelSize = project_pixel(a_Size); // 定点位置偏移
    v_lineData.a = lineOffsetWidth / linePixelSize; // 线图层贴图部分的 v 坐标值
  }

  gl_Position = project_common_position_to_clipspace(vec4(currPos.xy + offset, 0, 1.0));

  setPickingColor(a_PickingColor);
}
`,y4t={solid:0,dash:1};class _4t extends Ha{constructor(...t){super(...t),U(this,"texture",void 0),U(this,"updateTexture",()=>{const{createTexture2D:r}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=r({data:this.iconService.getCanvas(),mag:K.NEAREST,min:K.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,UV:12,THETA_OFFSET:13})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:r,textureBlend:n="normal",lineType:i="solid",dashArray:a=[10,5],forward:o=!0,lineTexture:s=!1,iconStep:l=100,segmentNumber:u=30}=this.layer.getLayerConfig(),{animateOption:c}=this.layer.getLayerConfig();let f=a;i!=="dash"&&(f=[0,0]),f.length===2&&f.push(0,0);let d=0,v=[0,0,0,0],g=[0,0,0,0];if(t&&r&&(v=eo(t),g=eo(r),d=1),this.rendererService.getDirty()){var x;(x=this.texture)===null||x===void 0||x.bind()}const w={u_animate:this.animateOption2Array(c),u_dash_array:f,u_sourceColor:v,u_targetColor:g,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:u,u_lineDir:o?1:-1,u_icon_step:l,u_line_texture:s?1:0,u_textureBlend:n==="normal"?0:1,u_blur:.9,u_line_type:y4t[i||"solid"],u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:d};return this.getUniformsBufferInfo(w)}initModels(){var t=this;return Oe(function*(){return t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}getShaders(){return{frag:g4t,vert:m4t,type:""}}buildModels(){var t=this;return Oe(function*(){t.initUniformsBuffer();const{segmentNumber:r=30}=t.layer.getLayerConfig(),{frag:n,vert:i,type:a}=t.getShaders();return[yield t.layer.buildLayerModel({moduleName:"lineArc2d"+a,vertexShader:i,fragmentShader:n,defines:t.getDefines(),inject:t.getInject(),triangulation:I4,depth:{enable:!1},styleOption:{segmentNumber:r}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Jr.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0]]:[r]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Jr.Attribute,descriptor:{name:"a_Instance",shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:4,update:(t,r,n)=>[n[3],n[4],n[5],n[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"instance64Low",type:Jr.Attribute,descriptor:{name:"a_Instance64Low",shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:4,update:(t,r,n)=>[nl(n[3]),nl(n[4]),nl(n[5]),nl(n[6])]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Jr.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:t=>{const r=this.iconService.getIconMap(),{texture:n}=t,{x:i,y:a}=r[n]||{x:0,y:0};return[i,a]}}}),this.styleAttributeService.registerStyleAttribute({name:"thetaOffset",type:Jr.Attribute,descriptor:{name:"a_ThetaOffset",shaderLocation:this.attributeLocation.THETA_OFFSET,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:1,update:t=>{const{thetaOffset:r=1}=t;return[r]}}})}}const x4t=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_globel;
  float u_globel_radius;
  float u_global_height: 10;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0.0;
};

in vec4 v_color;
in vec4 v_dash_array;
in float v_segmentIndex;
in vec2 v_iconMapUV;
in vec4 v_line_data;

out vec4 outputColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // 运动速度
  float d_distance_ratio = v_line_data.g; // 当前点位距离占线总长的比例
  outputColor = v_color;

  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    outputColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      outputColor.a *= alpha;

      // u_animate
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // 贴图在弧线上重复的数量

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // 线图层贴图部分的 v 坐标值
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          outputColor = filterColor(pattern);
        }
    }

  } else {
    outputColor = filterColor(outputColor);
  }
}
`,b4t=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;
layout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;


layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_globel;
  float u_globel_radius;
  float u_global_height: 10;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0.0;
};
out vec4 v_color;
out vec4 v_dash_array;
out float v_segmentIndex;
out vec2 v_iconMapUV;
out vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return dir_screenspace.xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 是为了对齐坐标
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // 手动增加一些偏移，减轻面的冲突
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  //vs中计算渐变色
  if(u_linearColor==1.0){
    float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置
    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  }
  else{
    v_color = a_Color;
  }
  v_color.a = v_color.a * opacity;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0), a_Instance64Low.xy).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0), a_Instance64Low.zw).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    float total_Distance = pixelDistance(source, target) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // 当前点位距离占线总长的比例

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // 开启贴图模式

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // 线横向偏移的距离
    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离
    v_line_data.a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值

    v_iconMapUV = a_iconMapUV;
  }


  gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z * thetaOffset, 1.0));

  // 地球模式
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // 线的偏移
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // 计算起始点和终止点的距离
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // 计算飞线各个节点相应的高度
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // 地球点位
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;

    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }


  setPickingColor(a_PickingColor);
}
`,E4t={solid:0,dash:1};class F$ extends Ha{constructor(...t){super(...t),U(this,"texture",void 0),U(this,"updateTexture",()=>{const{createTexture2D:r}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=r({data:this.iconService.getCanvas(),mag:K.NEAREST,min:K.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,UV:12,THETA_OFFSET:13})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:r,textureBlend:n="normal",lineType:i="solid",dashArray:a=[10,5],lineTexture:o=!1,iconStep:s=100,segmentNumber:l=30,globalArcHeight:u=10}=this.layer.getLayerConfig(),{animateOption:c}=this.layer.getLayerConfig();a.length===2&&a.push(0,0);let f=0,d=[0,0,0,0],v=[0,0,0,0];if(t&&r&&(d=eo(t),v=eo(r),f=1),this.rendererService.getDirty()){var g;(g=this.texture)===null||g===void 0||g.bind()}const x={u_animate:this.animateOption2Array(c),u_dash_array:a,u_sourceColor:d,u_targetColor:v,u_textSize:[1024,this.iconService.canvasHeight||128],u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:UJ,u_global_height:u,segmentNumber:l,u_line_type:E4t[i]||0,u_icon_step:s,u_line_texture:o?1:0,u_textureBlend:n==="normal"?0:1,u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:f};return this.getUniformsBufferInfo(x)}initModels(){var t=this;return Oe(function*(){return t.initUniformsBuffer(),t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}getShaders(){return{frag:x4t,vert:b4t,type:""}}buildModels(){var t=this;return Oe(function*(){const{segmentNumber:r=30}=t.layer.getLayerConfig(),{frag:n,vert:i,type:a}=t.getShaders();return[yield t.layer.buildLayerModel({moduleName:"lineArc3d"+a,vertexShader:i,fragmentShader:n,defines:t.getDefines(),inject:t.getInject(),triangulation:I4,styleOption:{segmentNumber:r}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Jr.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0]]:[r]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Jr.Attribute,descriptor:{name:"a_Instance",shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:4,update:(t,r,n)=>[n[3],n[4],n[5],n[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"instance64Low",type:Jr.Attribute,descriptor:{name:"a_Instance64Low",shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:4,update:(t,r,n)=>[nl(n[3]),nl(n[4]),nl(n[5]),nl(n[6])]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Jr.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:t=>{const r=this.iconService.getIconMap(),{texture:n}=t,{x:i,y:a}=r[n]||{x:0,y:0};return[i,a]}}}),this.styleAttributeService.registerStyleAttribute({name:"thetaOffset",type:Jr.Attribute,descriptor:{name:"a_ThetaOffset",shaderLocation:this.attributeLocation.THETA_OFFSET,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:1,update:t=>{const{thetaOffset:r=1}=t;return[r]}}})}}const B$={circle:2,triangle:2,diamond:4,rect:2,classic:3,halfTriangle:2,none:0},$c=1/2;function w4t(e,t){const{width:r=2,height:n=1}=t;return{vertices:[0,$c*e,1*e*r,-(n+$c)*e,1*e*r,(n-$c)*e,0,$c*e,1*e*r,-(n+$c)*e,1*e*r,(n-$c)*e],indices:[3,4,5],outLineIndices:[0,1,2],normals:[1*e,-2*e,1,-2*e,1.5*e,1,1*e,1.5*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function C4t(e,t){const{width:r=2,height:n=3}=t;return{vertices:[0,0,1*e*r,1*n,1*e*r,-1*n,0,0,1*e*r,1*n,1*e*r,-1*n],outLineIndices:[0,1,2],indices:[3,4,5],normals:[0,-1.5*e,1,2,1*e,1,-2,1*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function S4t(e,t){const{width:r=2,height:n=2}=t;return{vertices:[0,n/2,e*r*1,n/2,e*r*1,-n/2,0,-n/2,0,n/2,e*r*1,n/2,e*r*1,-n/2,0,-n/2],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function T4t(e,t){const{width:r=2,height:n=3}=t;return{vertices:[0,0,1*r*e,.5*n,2*r*e,0,1*r*e,-.5*n,0,0,1*r*e,.5*n,2*r*e,0,1*r*e,-.5*n],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function A4t(e,t){const{width:r=2,height:n=3}=t;return{vertices:[0,0,2*e*r,1*n,1.5*e*r,0,2*e*r,-1*n,0,0,2*e*r,1*n,1.5*e*r,0,2*e*r,-1*n],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function M4t(e,t){const{width:r=2,height:n=2}=t,i=KD(),a=_g.flatten([i]),o=_g(a.vertices,a.holes,a.dimensions),s=i.map(l=>[l[0]*r*e,l[1]*n]).flat();return{vertices:[...s,...s],dimensions:2,indices:o.map(l=>l+i.length),outLineIndices:o,normals:[...i.map(l=>[l[1]*n,l[0]*r*e,1]).flat(),...new Array(i.length*3).fill(0)]}}function R4t(e,t=0,r){const n=typeof r.source=="object"?r.source.type:r.source,i=typeof r.target=="object"?r.target.type:r.target,{width:a=n?B$[n]:0}=typeof r.source=="object"?r.source:{},{width:o=i?B$[i]:0}=typeof r.target=="object"?r.target:{};return{vertices:[0,$c,1*a,...e,1,$c,-1*o,...e,1,-$c,-1*o,...e,0,-$c,1*a,...e,0,$c,1*a,...e,1,$c,-1*o,...e,1,-$c,-1*o,...e,0,-$c,1*a,...e],outLineIndices:[0,1,2,0,2,3].map(s=>s+t),indices:[4,5,6,4,6,7].map(s=>s+t),normals:[1,-1,1,1,1,1,-1,0,1,-1,0,1,0,0,0,0,0,0,0,0,0,0,0,0],dimensions:2}}function N$(e,t){const r=typeof e=="object"?e.type:e,n=t==="source"?1:-1,i=typeof e=="object"?e:{};switch(r){case"circle":return M4t(n,i);case"triangle":return C4t(n,i);case"diamond":return T4t(n,i);case"rect":return S4t(n,i);case"classic":return A4t(n,i);case"halfTriangle":return w4t(n,i);default:return{vertices:[],indices:[],normals:[],dimensions:2,outLineIndices:[],outLineNormals:[]}}}function I4t(e){const t=e.coordinates.flat(),r=1,n=1;return{vertices:[1,0,0,...t,1,2,-3,...t,1,1,-3,...t,0,1,0,...t,0,0,0,...t,1,0,0,...t,1,2,-3,...t,1,1,-3,...t,0,1,0,...t,0,0,0,...t],normals:[-r,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-r,-n,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function L4t(e,t){return t?O4t(e,t):I4t(e)}function O4t(e,t){const r=e.coordinates.flat(),{target:n="classic",source:i="circle"}=t,a=k$(N$(i,"source"),r,0,0),o=R4t(r,a.vertices.length/7,t),s=k$(N$(n,"target"),r,1,a.vertices.length/7+o.vertices.length/7);return{vertices:[...a.vertices,...o.vertices,...s.vertices],indices:[...a.outLineIndices,...o.outLineIndices,...s.outLineIndices,...a.indices,...o.indices,...s.indices],normals:[...a.normals,...o.normals,...s.normals],size:7}}function k$(e,t,r=1,n=0){const i=[],{vertices:a,indices:o,dimensions:s,outLineIndices:l}=e;for(let u=0;u<a.length;u+=s)i.push(r,a[u+1],a[u],...t);return Ce(Ce({},e),{},{vertices:i,indices:o.map(u=>u+n),outLineIndices:l.map(u=>u+n)})}const P4t=`// #extension GL_OES_standard_derivatives : enable

in vec4 v_color;
out vec4 outputColor;


// line texture

#pragma include "picking"

void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,D4t=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec2 a_Size;
layout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;
layout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

layout(std140) uniform commonUniorm {
  float u_gap_width: 1.0;
  float u_stroke_width: 1.0;
  float u_stroke_opacity: 1.0;
};

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

out vec4 v_color;

vec2 project_pixel_offset(vec2 offsets) {
  vec2 data = project_pixel(offsets);

  return vec2(data.x, -data.y);
}

vec2 line_dir(vec2 target, vec2 source) {
  return normalize(ProjectFlat(target) - ProjectFlat(source));
}


void main() {
  // 透明度计算
  vec2 source_world = a_Instance.rg; // 起点
  vec2 target_world = a_Instance.ba; // 终点
  vec2 flowlineDir = line_dir(target_world, source_world);
  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x);

  vec2 position = mix(source_world, target_world, a_Position.x);
  vec2 position64Low = mix(a_Instance64Low.rg, a_Instance64Low.ba, a_Position.x);

  float lengthCommon = length(
    project_position(vec4(target_world, 0, 1)) - project_position(vec4(source_world, 0, 1))
  );
  vec2 offsetDistances = a_Size.x * project_pixel_offset(vec2(a_Position.y, a_Position.z)); // Mapbox || 高德
  vec2 limitedOffsetDistances = clamp(
    offsetDistances,
    project_pixel(-lengthCommon * 0.2),
    project_pixel(lengthCommon * 0.2)
  );

  float startOffsetCommon = project_pixel(offsets[0]);
  float endOffsetCommon = project_pixel(offsets[1]);
  float endpointOffset = mix(
    clamp(startOffsetCommon, 0.0, lengthCommon * 0.2),
    -clamp(endOffsetCommon, 0.0, lengthCommon * 0.2),
    a_Position.x
  );

  vec2 normalsCommon = u_stroke_width * project_pixel_offset(vec2(a_Normal.x, a_Normal.y));

  float gapCommon = -1. * project_pixel(u_gap_width);
  vec3 offsetCommon = vec3(
    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -
      perpendicularDir * (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),
    0.0
  );

  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0), position64Low);

  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);
  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy +  offsetCommon.xy, 0., 1.0));

  setPickingColor(a_PickingColor);
}
`;class F4t extends Ha{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,NORMAL:12})}getCommonUniformsInfo(){const{gapWidth:t=2,strokeWidth:r=1,strokeOpacity:n=1}=this.layer.getLayerConfig(),i={u_gap_width:t,u_stroke_width:r,u_stroke_opacity:n};return this.getUniformsBufferInfo(i)}initModels(){var t=this;return Oe(function*(){return t.initUniformsBuffer(),t.buildModels()})()}buildModels(){var t=this;return Oe(function*(){return[yield t.layer.buildLayerModel({moduleName:"flow_line",vertexShader:D4t,fragmentShader:P4t,defines:t.getDefines(),inject:t.getInject(),triangulation:L4t,styleOption:t.layer.getLayerConfig().symbol,primitive:K.TRIANGLES,depth:{enable:!1},pick:!1})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Jr.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0],r[1]]:[r,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Jr.Attribute,descriptor:{name:"a_Instance",shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:4,update:(t,r,n)=>[n[3],n[4],n[5],n[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"instance64Low",type:Jr.Attribute,descriptor:{name:"a_Instance64Low",shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:4,update:(t,r,n)=>[nl(n[3]),nl(n[4]),nl(n[5]),nl(n[6])]}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Jr.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:3,update:(t,r,n,i,a)=>a}})}}const B4t=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0;
};

in vec4 v_dash_array;
in vec4 v_color;
in vec2 v_iconMapUV;
in vec4 v_line_data;
in float v_distance_ratio;

out vec4 outputColor;
#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {

  float animateSpeed = 0.0;
  float d_segmentIndex = v_line_data.g;

  // 设置弧线的底色
  if(u_linearColor == 1.0) { // 使用渐变颜色
    outputColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
    outputColor.a *= v_color.a;
  } else { // 使用 color 方法传入的颜色
    outputColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // 实线部分
    } else {
      // 虚线部分
      discard;
    };
  }

  // 设置弧线的动画模式
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  // 设置弧线的贴图
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) {
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // 贴图在弧线上重复的数量
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = outputColor.a/v_color.a;
    }

    float v = v_line_data.a; // 线图层贴图部分的 v 坐标值

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    // 设置贴图和底色的叠加模式
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
  } else {
    outputColor = filterColor(outputColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,N4t=`#define LineTypeSolid (0.0)
#define LineTypeDash (1.0)
#define Animate (0.0)
#define LineTexture (1.0)

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;
layout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0;
};

out vec4 v_dash_array;
out vec4 v_color;
out vec2 v_iconMapUV;
out vec4 v_line_data;
out float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps(float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return index / (segmentNumber - 1.0);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(mix(source, target, segmentRatio), sqrt(max(0.0, vertex_height)));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return dir_screenspace.xy * sign(offset_direction);
}
float getAngularDist(vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) * sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2 * cos(theta2) + source.x, r2 * sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1.0 - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate(vec2 source, vec2 target, float angularDist, float t) {
  if (abs(angularDist - PI) < 0.001) {
    return (1.0 - t) * source + t * target;
  }
  float a = sin((1.0 - t) * angularDist) / sin(angularDist);
  float b = sin(t * angularDist) / sin(angularDist);
  vec2 sin_source = sin(source);
  vec2 cos_source = cos(source);
  vec2 sin_target = sin(target);
  vec2 cos_target = cos(target);
  float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
  float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
  float z = a * sin_source.y + b * sin_target.y;
  return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));

}

void main() {
  v_color = a_Color;
  v_color.a = v_color.a * opacity;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if (u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    float total_Distance = pixelDistance(source, target) / 2.0 * PI;
    total_Distance = total_Distance * 16.0; // total_Distance*16.0 调整默认的效果
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if (u_animate.x == Animate) {
    v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;

  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0), a_Instance64Low.xy);
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0), a_Instance64Low.zw);

  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_line_data.g = a_Position.x; // 该顶点在弧线上的分段排序
  if (LineTexture == u_line_texture) {
    float d_arcDistrance = length(source - target);
    d_arcDistrance = project_pixel(d_arcDistrance);

    float d_pixelLen = project_pixel(u_icon_step) / 8.0;
    v_line_data.b = floor(d_arcDistrance / d_pixelLen); // 贴图在弧线上重复的数量

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离
    float linePixelSize = project_pixel(a_Size); // 定点位置偏移，按地图等级缩放后的距离
    v_line_data.a = lineOffsetWidth / linePixelSize; // 线图层贴图部分的 v 坐标值

    v_iconMapUV = a_iconMapUV;
  }

  gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  setPickingColor(a_PickingColor);
}

`,k4t={solid:0,dash:1};class z4t extends Ha{constructor(...t){super(...t),U(this,"texture",void 0),U(this,"updateTexture",()=>{const{createTexture2D:r}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=r({data:this.iconService.getCanvas(),mag:K.NEAREST,min:K.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,UV:12})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:r,textureBlend:n="normal",lineType:i="solid",dashArray:a=[10,5],lineTexture:o=!1,iconStep:s=100,segmentNumber:l=30}=this.layer.getLayerConfig(),{animateOption:u}=this.layer.getLayerConfig();if(a.length===2&&a.push(0,0),this.rendererService.getDirty()){var c;(c=this.texture)===null||c===void 0||c.bind()}let f=0,d=[0,0,0,0],v=[0,0,0,0];t&&r&&(d=eo(t),v=eo(r),f=1);let g=this.layer.getLayerAnimateTime();isNaN(g)&&(g=0);const x={u_animate:this.animateOption2Array(u),u_dash_array:a,u_sourceColor:d,u_targetColor:v,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:l,u_line_type:k4t[i]||0,u_icon_step:s,u_line_texture:o?1:0,u_textureBlend:n==="normal"?0:1,u_time:g,u_linearColor:f};return this.getUniformsBufferInfo(x)}initModels(){var t=this;return Oe(function*(){return t.initUniformsBuffer(),t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var t=this;return Oe(function*(){const{segmentNumber:r=30}=t.layer.getLayerConfig();return[yield t.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:N4t,fragmentShader:B4t,triangulation:I4,styleOption:{segmentNumber:r},defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Jr.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0]]:[r]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Jr.Attribute,descriptor:{name:"a_Instance",shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:4,update:(t,r,n)=>[n[3],n[4],n[5],n[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"instance64Low",type:Jr.Attribute,descriptor:{name:"a_Instance64Low",shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:4,update:(t,r,n)=>[nl(n[3]),nl(n[4]),nl(n[5]),nl(n[6])]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Jr.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:t=>{const r=this.iconService.getIconMap(),{texture:n}=t,{x:i,y:a}=r[n]||{x:0,y:0};return[i,a]}}})}}const U4t=`// #extension GL_OES_standard_derivatives : enable
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_blur;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed: 0.0;
  float u_vertexScale: 1.0;
  float u_raisingHeight: 0.0;
  float u_strokeWidth: 0.0;
  float u_textureBlend;
  float u_line_texture;
  float u_linearDir: 1.0;
  float u_linearColor: 0;
  float u_time;
};

in vec4 v_color;
in vec4 v_stroke;
// dash
in vec4 v_dash_array;
in float v_d_distance_ratio;
in vec2 v_iconMapUV;
in vec4 v_texture_data;

out vec4 outputColor;
#pragma include "picking"

// [animate, duration, interval, trailLength],
void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      // 虚线部分
      discard;
    };
  }
  float animateSpeed = 0.0; // 运动速度
  float d_distance_ratio = v_texture_data.r; // 当前点位距离占线总长的比例
  if(u_linearDir < 1.0) {
    d_distance_ratio = v_texture_data.a;
  }
  if(u_linearColor == 1.0) { // 使用渐变颜色
    outputColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
    outputColor.a *= v_color.a;
  } else { // 使用 color 方法传入的颜色
     outputColor = v_color;
  }
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_texture_data.g;      // 当前顶点的距离
    float d_texPixelLen = v_texture_data.b;  // 贴图的像素长度，根据地图层级缩放
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_texture_data.a;  // 线图层贴图部分的 v 坐标值

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
     vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor += pattern;
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = pattern;
    }
  } 

  float v = v_texture_data.a;
  float strokeWidth = min(0.5, u_strokeWidth);
  // 绘制 border
  if(strokeWidth > 0.01) {
    float borderOuterWidth = strokeWidth / 2.0;


    if(v >= 1.0 - strokeWidth || v <= strokeWidth) {
      if(v > strokeWidth) { // 外侧
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - strokeWidth))/strokeWidth);
        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);
        outputColor.rgb = mix(outputColor.rgb, v_stroke.rgb, linear);
      } else if(v <= strokeWidth) {
        float linear = smoothstep(0.0, 1.0, v/strokeWidth);
        outputColor.rgb = mix(v_stroke.rgb, outputColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      outputColor.a = mix(0.0, outputColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = v_texture_data.a;
  if(blurV < 0.5) {
    outputColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    outputColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  outputColor = filterColor(outputColor);
}
`,$4t=`#define Animate (0.0)

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec2 a_Size;
layout(location = ATTRIBUTE_LOCATION_DISTANCE_INDEX) in vec3 a_DistanceAndIndexAndMiter;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec4 a_Normal_Total_Distance;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_blur;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed: 0.0;
  float u_vertexScale: 1.0;
  float u_raisingHeight: 0.0;
  float u_strokeWidth: 0.0;
  float u_textureBlend;
  float u_line_texture;
  float u_linearDir: 1.0;
  float u_linearColor: 0;
  float u_time;
};

out vec4 v_color;
out vec4 v_stroke;
//dash
out vec4 v_dash_array;
out float v_d_distance_ratio;
// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）
out vec2 v_iconMapUV;
out vec4 v_texture_data;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec2 a_DistanceAndIndex = a_DistanceAndIndexAndMiter.xy;
  float a_Miter = a_DistanceAndIndexAndMiter.z;
  vec3 a_Normal = a_Normal_Total_Distance.xyz;
  float a_Total_Distance = a_Normal_Total_Distance.w;
  //dash输出
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;

  // cal style mapping - 数据纹理映射部分的计算
  float d_texPixelLen; // 贴图的像素长度，根据地图层级缩放
  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);

  v_color = a_Color;
  v_color.a *= opacity;
  v_stroke = stroke;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * a_Normal;

  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // 线横向偏移的距离（向两侧偏移的和）
  float linePixelSize = project_pixel(a_Size.x) * 2.0; // 定点位置偏移，按地图等级缩放后的距离 单侧 * 2
  float texV = lineOffsetWidth / linePixelSize; // 线图层贴图部分的 v 坐标值

  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);
  // 设置数据集的参数

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0), a_Position64Low);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况 vertex height
  float lineHeight = a_Size.y; // size 第二个参数代表的高度 [linewidth, lineheight]

  // 兼容 mapbox 在线高度上的效果表现基本一致
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // mapbox
    // 保持高度相对不变
    float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
    h *= mapboxZoomScale;
    h += u_raisingHeight * mapboxZoomScale;
    if (u_heightfixed > 0.0) {
      lineHeight *= mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(
    vec4(project_pos.xy + offset, lineHeight + h, 1.0)
  );

  setPickingColor(a_PickingColor);
}
`;class XJ extends Ha{constructor(...t){super(...t),U(this,"textureEventFlag",!1),U(this,"texture",this.createTexture2D({data:new Uint8Array([0,0,0,0]),width:1,height:1})),U(this,"updateTexture",()=>{const{createTexture2D:r}=this.rendererService;if(this.textures.length===0&&(this.textures=[this.texture]),this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=r({data:this.iconService.getCanvas(),mag:K.NEAREST,min:K.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128})})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,DISTANCE_INDEX:10,NORMAL:11,UV:12})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:r,textureBlend:n="normal",lineType:i="solid",dashArray:a=[10,5,0,0],lineTexture:o=!1,iconStep:s=100,vertexHeightScale:l=20,strokeWidth:u=0,raisingHeight:c=0,heightfixed:f=!1,linearDir:d=E$.VERTICAL,blur:v=[1,1,1,0]}=this.layer.getLayerConfig();let g=a;if(i!=="dash"&&(g=[0,0,0,0]),g.length===2&&g.push(0,0),this.rendererService.getDirty()&&this.texture){var x;(x=this.texture)===null||x===void 0||x.bind()}const{animateOption:w}=this.layer.getLayerConfig();let S=0,M=[0,0,0,0],R=[0,0,0,0];t&&r&&(M=eo(t),R=eo(r),S=1);const I={u_animate:this.animateOption2Array(w),u_dash_array:g,u_blur:v,u_sourceColor:M,u_targetColor:R,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:s,u_heightfixed:Number(f),u_vertexScale:l,u_raisingHeight:Number(c),u_strokeWidth:u,u_textureBlend:n===P5t.NORMAL?0:1,u_line_texture:o?1:0,u_linearDir:d===E$.VERTICAL?1:0,u_linearColor:S,u_time:this.layer.getLayerAnimateTime()||0};return this.getUniformsBufferInfo(I)}initModels(){var t=this;return Oe(function*(){return t.initUniformsBuffer(),t.textureEventFlag||(t.textureEventFlag=!0,t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture)),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var t=this;return Oe(function*(){const{depth:r=!1}=t.layer.getLayerConfig(),{frag:n,vert:i,type:a}=t.getShaders();return t.layer.triangulation=QD,[yield t.layer.buildLayerModel({moduleName:"line"+a,vertexShader:i,fragmentShader:n,triangulation:QD,defines:t.getDefines(),inject:t.getInject(),depth:{enable:r}})]})()}getShaders(){return{frag:U4t,vert:$4t,type:""}}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Jr.Attribute,descriptor:{name:"a_DistanceAndIndexAndMiter",shaderLocation:this.attributeLocation.DISTANCE_INDEX,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:3,update:(t,r,n,i,a,o)=>o===void 0?[n[3],10,n[4]]:[n[3],o,n[4]]}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Jr.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0],r[1]]:[r,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal_total_distance",type:Jr.Attribute,descriptor:{name:"a_Normal_Total_Distance",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:4,update:(t,r,n,i,a)=>[...a,n[5]]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Jr.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:t=>{const r=this.iconService.getIconMap(),{texture:n}=t,{x:i,y:a}=r[n]||{x:0,y:0};return[i,a]}}})}}const H4t=`
layout(std140) uniform commonUniorm {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec4 u_dash_array;
  float u_vertexScale: 1.0;
  float u_linearColor: 0;
};
in float v_distanceScale;
in vec4 v_color;
//dash
in vec4 v_dash_array;

out vec4 outputColor;
void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_distanceScale, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      // 虚线部分
      discard;
    };
  }
  if(u_linearColor==1.0){
    outputColor = mix(u_sourceColor, u_targetColor, v_distanceScale);
    outputColor.a *= v_color.a; // 全局透明度
  }
  else{
    outputColor = v_color;
  }
}
`,V4t=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec4 a_SizeDistanceAndTotalDistance;

layout(std140) uniform commonUniorm {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec4 u_dash_array;
  float u_vertexScale: 1.0;
  float u_linearColor: 0;
};

#pragma include "projection"
#pragma include "picking"

out vec4 v_color;
out float v_distanceScale;
out vec4 v_dash_array;

void main() {
  //dash输出
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_SizeDistanceAndTotalDistance.a;

  v_color = a_Color;
  v_distanceScale = a_SizeDistanceAndTotalDistance.b / a_SizeDistanceAndTotalDistance.a;
  v_color.a = v_color.a * opacity;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0), a_Position64Low);

  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况

  float lineHeight = a_SizeDistanceAndTotalDistance.y;
  // 兼容 mapbox 在线高度上的效果表现基本一致
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // 保持高度相对不变
    h *= 2.0 / pow(2.0, 20.0 - u_Zoom);
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
  gl_PointSize = 10.0;

}
`;class G4t extends Ha{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:r,lineType:n="solid",dashArray:i=[10,5,0,0],vertexHeightScale:a=20}=this.layer.getLayerConfig();let o=i;n!=="dash"&&(o=[0,0,0,0]),o.length===2&&o.push(0,0);let s=0,l=[0,0,0,0],u=[0,0,0,0];t&&r&&(l=eo(t),u=eo(r),s=1);const c={u_sourceColor:l,u_targetColor:u,u_dash_array:o,u_vertexScale:a,u_linearColor:s};return this.getUniformsBufferInfo(c)}initModels(){var t=this;return Oe(function*(){return t.buildModels()})()}getShaders(){return{frag:H4t,vert:V4t,type:"lineSimpleNormal"}}buildModels(){var t=this;return Oe(function*(){t.initUniformsBuffer();const{frag:r,vert:n,type:i}=t.getShaders();return[yield t.layer.buildLayerModel({moduleName:i,vertexShader:n,fragmentShader:r,triangulation:z5t,defines:t.getDefines(),inject:t.getInject(),primitive:K.LINES,depth:{enable:!1},pick:!1})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"sizeDistanceAndTotalDistance",type:Jr.Attribute,descriptor:{name:"a_SizeDistanceAndTotalDistance",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:4,update:(t,r,n)=>{const{size:i=1}=t,a=Array.isArray(i)?[i[0],i[1]]:[i,0];return[a[0],a[1],n[3],n[5]]}}})}}const W4t=`#define Animate 0.0
#define LineTexture 1.0

// line texture

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed;
  float u_linearColor: 0;
  float u_line_texture;
  float u_textureBlend;
  float u_iconStepCount;
  float u_time;
};


in vec2 v_iconMapUV;
in vec4 v_color;
in float v_blur;
in vec4 v_dataset;

out vec4 outputColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // 运动速度
  float d_distance_ratio = v_dataset.r; // 当前点位距离占线总长的比例
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // 使用渐变颜色
    outputColor = mix(u_sourceColor, u_targetColor, v);
  } else { // 使用 color 方法传入的颜色
     outputColor = v_color;
  }

  outputColor.a *= v_color.a; // 全局透明度
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // 当前顶点的距离
    float d_texPixelLen = v_dataset.b;  // 贴图的像素长度，根据地图层级缩放
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // 线图层贴图部分的 v 坐标值

    // 计算纹理间隔 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // 计算纹理间隔 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    // Tip: 判断纹理间隔
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
  }


  // blur - AA
  if(v < v_blur) {
    outputColor.a = mix(0.0, outputColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  outputColor = filterColor(outputColor);
}
`,X4t=`#define Animate 0.0
layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec2 a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;
layout(location = ATTRIBUTE_LOCATION_DISTANCE_MITER_TOTAL) in vec3 a_Distance_Total_Miter;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed;
  float u_linearColor: 0;
  float u_line_texture;
  float u_textureBlend;
  float u_iconStepCount;
  float u_time;
};

// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）
out vec2 v_iconMapUV;
out vec4 v_color;
out float v_blur;
out vec4 v_dataset;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  float a_Distance = a_Distance_Total_Miter.x;
  float a_Miter = a_Distance_Total_Miter.y;
  float a_Total_Distance = a_Distance_Total_Miter.z;

  float d_distance_ratio; // 当前点位距离占线总长的比例
  float d_texPixelLen; // 贴图的像素长度，根据地图层级缩放

  v_iconMapUV = a_iconMapUV;
  if (u_heightfixed < 1.0) {
    // 高度随 zoom 调整
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }

  if (u_animate.x == Animate || u_linearColor == 1.0) {
    d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0) / 2.0;
  // 设置数据集的参数
  v_dataset[0] = d_distance_ratio; // 当前点位距离占线总长的比例
  v_dataset[1] = a_Distance; // 当前顶点的距离
  v_dataset[2] = d_texPixelLen; // 贴图的像素长度，根据地图层级缩放
  v_dataset[3] = miter; // 线图层贴图部分的 v 坐标值 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0), a_Position64Low);

  float originSize = a_Size.x; // 固定高度
  if (u_heightfixed < 1.0) {
    originSize = project_float_meter(a_Size.x); // 高度随 zoom 调整
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  // 兼容 mapbox 在线高度上的效果表现基本一致
  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    // mapbox
    // 保持高度相对不变
    float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
    if (u_heightfixed > 0.0) {
      wallHeight *= mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));

  setPickingColor(a_PickingColor);
}
`;class j4t extends Ha{constructor(...t){super(...t),U(this,"texture",void 0),U(this,"updateTexture",()=>{const{createTexture2D:r}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=r({data:this.iconService.getCanvas(),mag:K.NEAREST,min:K.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,NORMAL:12,UV:13,DISTANCE_MITER_TOTAL:15})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:r,textureBlend:n="normal",heightfixed:i=!1,lineTexture:a=!1,iconStep:o=100,iconStepCount:s=1}=this.layer.getLayerConfig(),{animateOption:l}=this.layer.getLayerConfig();if(this.rendererService.getDirty()){var u;(u=this.texture)===null||u===void 0||u.bind()}let c=0,f=[0,0,0,0],d=[0,0,0,0];t&&r&&(f=eo(t),d=eo(r),c=1);const v={u_animate:this.animateOption2Array(l),u_sourceColor:f,u_targetColor:d,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:o,u_heightfixed:Number(i),u_linearColor:c,u_line_texture:a?1:0,u_textureBlend:n==="normal"?0:1,u_iconStepCount:s,u_time:this.layer.getLayerAnimateTime()||0};return this.getUniformsBufferInfo(v)}initModels(){var t=this;return Oe(function*(){return t.initUniformsBuffer(),t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var t=this;return Oe(function*(){return[yield t.layer.buildLayerModel({moduleName:"lineWall",vertexShader:X4t,fragmentShader:W4t,triangulation:QD,defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1},blend:t.getBlend()})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"size",type:Jr.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0],r[1]]:[r,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Jr.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:3,update:(t,r,n,i,a)=>a}}),this.styleAttributeService.registerStyleAttribute({name:"distanceAndTotalAndMiter",type:Jr.Attribute,descriptor:{name:"a_Distance_Total_Miter",shaderLocation:this.attributeLocation.DISTANCE_MITER_TOTAL,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:3,update:(t,r,n)=>[n[3],n[4],n[5]]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Jr.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:t=>{const r=this.iconService.getIconMap(),{texture:n}=t,{x:i,y:a}=r[n]||{x:0,y:0};return[i,a]}}})}}const Y4t={arc:_4t,arc3d:F$,greatcircle:z4t,wall:j4t,line:XJ,simple:G4t,flowline:F4t,earthArc3d:F$},Z4t=Y4t;class Cx extends L_{constructor(...t){super(...t),U(this,"type","LineLayer"),U(this,"enableShaderEncodeStyles",["stroke","offsets","opacity","thetaOffset"]),U(this,"arrowInsertCount",0),U(this,"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}})}buildModels(){var t=this;return Oe(function*(){const r=t.getModelType();t.layerModel=new Z4t[r](t),yield t.initLayerModels()})()}getDefaultConfig(){const t=this.getModelType();return{line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{},arrow:{}}[t]}getModelType(){var t;if(this.layerType)return this.layerType;const r=this.styleAttributeService.getLayerStyleAttribute("shape");return(r==null||(t=r.scale)===null||t===void 0?void 0:t.field)||"line"}processData(t){if(this.getModelType()!=="simple")return t;const r=[];return t.map(n=>{if(Array.isArray(n.coordinates)&&Array.isArray(n.coordinates[0])&&Array.isArray(n.coordinates[0][0])){const i=Ce({},n);n.coordinates.map(a=>{r.push(Ce(Ce({},i),{},{coordinates:a}))})}else r.push(n)}),r}}const q4t=`
layout(std140) uniform commonUniorm {
  vec4 u_stroke_color;
  float u_additive;
  float u_stroke_opacity;
  float u_stroke_width;
};

in vec4 v_color;
in float v_blur;
in float v_innerRadius;

out vec4 outputColor;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  // Tip: 片元到中心点的距离 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: 片元的剪切成圆形
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // 当存在 stroke 且 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      outputColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      outputColor = mix(v_color, stroke, mixR);
    } else {
      outputColor = v_color;
    }
  } else {
    // 当不存在 stroke 或 stroke <= 0.01
    outputColor = v_color;
  }

  outputColor = filterColor(outputColor);
  
  if(u_additive > 0.0) {
    outputColor *= circleClipOpacity;
  } else {
    outputColor.a *= circleClipOpacity;
  }

}
`,K4t=`
layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;

layout(std140) uniform commonUniorm {
  vec4 u_stroke_color;
  float u_additive;
  float u_stroke_opacity;
  float u_stroke_width;
};

out vec4 v_color;
out float v_blur;
out float v_innerRadius;

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_blur = 1.0 - max(2.0 / a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  vec2 offset = project_pixel(u_offsets);

  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function z$(e){const t=e.coordinates;return{vertices:[...t],indices:[0],size:t.length}}class Q4t extends Ha{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9})}getDefaultStyle(){return{blend:"additive"}}getCommonUniformsInfo(){const{blend:t,strokeOpacity:r=1,strokeWidth:n=0,stroke:i="#fff"}=this.layer.getLayerConfig(),a={u_stroke_color:eo(i),u_additive:t==="additive"?1:0,u_stroke_opacity:r,u_stroke_width:n};return this.getUniformsBufferInfo(a)}initModels(){var t=this;return Oe(function*(){return t.buildModels()})()}buildModels(){var t=this;return Oe(function*(){return t.layer.triangulation=z$,t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:K4t,fragmentShader:q4t,defines:t.getDefines(),inject:t.getInject(),triangulation:z$,depth:{enable:!1},primitive:K.POINTS})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"size",type:Jr.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0]]:[r]}}})}}const J4t=`precision highp float;
in vec4 v_color;

#pragma include "picking"

layout(std140) uniform commonUniform {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor: 0;
  float u_heightfixed: 0.0; // 默认不固定
  float u_globel;
  float u_r;
  float u_pickLight: 0.0;
  float u_opacitylinear: 0.0;
  float u_opacitylinear_dir: 1.0;
  float u_lightEnable: 1.0;
};
in float v_lightWeight;
in float v_barLinearZ;
out vec4 outputColor;
void main() {

   outputColor = v_color;

  // 开启透明度渐变
  if(u_opacitylinear > 0.0) {
    outputColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,tNt=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec3 a_Size;
layout(location = ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

layout(std140) uniform commonUniform {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor: 0;
  float u_heightfixed: 0.0; // 默认不固定
  float u_globel;
  float u_r;
  float u_pickLight: 0.0;
  float u_opacitylinear: 0.0;
  float u_opacitylinear_dir: 1.0;
  float u_lightEnable: 1.0;
};

out vec4 v_color;
out float v_lightWeight;
out float v_barLinearZ;
// 用于将在顶点着色器中计算好的样式值传递给片元


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) +
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - 数据纹理映射部分的计算
  vec3 size = a_Size * a_Position;

  // a_Position.z 是在构建网格的时候传入的标准值 0 - 1，在插值器插值可以获取 0～1 线性渐变的值
  v_barLinearZ =  a_Position.z;

  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移
  if(u_heightfixed < 1.0) { // 圆柱体不固定高度
    //
  } else {// 圆柱体固定高度 （ 处理 mapbox ）
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r 控制圆柱的生长
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // 圆柱光照效果
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // 取消三元表达式，增强健壮性
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;
  // 设置圆柱的底色
  if(u_linearColor == 1.0) { // 使用渐变颜色
    v_color = mix(u_sourceColor, u_targetColor, v_barLinearZ);
    v_color.rgb *= lightWeight;
  } else { // 使用 color 方法传入的颜色
     v_color = a_Color;
  }
  v_color.a *= u_opacity;


  // 在地球模式下，将原本垂直于 xy 平面的圆柱调整姿态到适应圆的角度
  //旋转矩阵mx，创建绕x轴旋转矩阵
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//求解旋转角度余弦值
  float xsin = sin(xRadian);//求解旋转角度正弦值
  mat4 mx = mat4(
    1,0,0,0,
    0,xcos,-xsin,0,
    0,xsin,xcos,0,
    0,0,0,1);

  //旋转矩阵my，创建绕y轴旋转矩阵
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//求解旋转角度余弦值
  float ysin = sin(yRadian);//求解旋转角度正弦值
  mat4 my = mat4(
    ycos,0,-ysin,0,
    0,1,0,0,
    ysin,0,ycos,0,
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);


  setPickingColor(a_PickingColor);
}
`,{isNumber:eNt}=as;let rNt=class extends Ha{constructor(...t){super(...t),U(this,"raiseCount",0),U(this,"raiseRepeat",0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,POS:10,NORMAL:11})}getCommonUniformsInfo(){const{animateOption:t={enable:!1,speed:.01,repeat:!1},opacity:r=1,sourceColor:n,targetColor:i,pickLight:a=!1,heightfixed:o=!0,opacityLinear:s={enable:!1,dir:"up"},lightEnable:l=!0}=this.layer.getLayerConfig();let u=0,c=[0,0,0,0],f=[0,0,0,0];if(n&&i&&(c=eo(n),f=eo(i),u=1),this.raiseCount<1&&this.raiseRepeat>0&&t.enable){const{speed:g=.01}=t;this.raiseCount+=g,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}const d={u_sourceColor:c,u_targetColor:f,u_linearColor:u,u_pickLight:Number(a),u_heightfixed:Number(o),u_r:t.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:eNt(r)?r:1,u_opacitylinear:Number(s.enable),u_opacitylinear_dir:s.dir==="up"?1:0,u_lightEnable:Number(l)};return this.getUniformsBufferInfo(d)}initModels(){var t=this;return Oe(function*(){return t.initUniformsBuffer(),t.buildModels()})()}buildModels(){var t=this;return Oe(function*(){const{animateOption:{repeat:r=1}}=t.layer.getLayerConfig();return t.raiseRepeat=r,[yield t.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:tNt,fragmentShader:J4t,triangulation:R4,depth:{enable:!0},defines:t.getDefines(),inject:t.getInject(),cull:{enable:!0,face:K.FRONT},blend:t.getBlend()})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Jr.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:3,update:t=>{const{size:r}=t;if(r){let n=[];return Array.isArray(r)&&(n=r.length===2?[r[0],r[0],r[1]]:r),Array.isArray(r)||(n=[r,r,r]),n}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Jr.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:3,update:(t,r,n,i,a)=>a}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Jr.Attribute,descriptor:{name:"a_Pos",shaderLocation:this.attributeLocation.POS,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:3,update:t=>{const r=t_(t.coordinates);return $J([r[0],r[1]])}}})}};const nNt=`in vec4 v_data;
in vec4 v_color;
in float v_radius;

layout(std140) uniform commonUniform {
  float u_additive;
  float u_stroke_opacity : 1;
  float u_stroke_width : 2;
  float u_blur : 0.0;
};
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 strokeColor = u_stroke == vec4(0.0) ? v_color : u_stroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(u_stroke_width < 0.01) {
    outputColor = vec4(v_color.rgb, v_color.a * u_opacity);
  } else {
    outputColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor = filterColor(outputColor);
  }
}
`,iNt=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_SHAPE) in float a_Shape;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;

layout(std140) uniform commonUniform {
  float u_additive;
  float u_stroke_opacity : 1;
  float u_stroke_width : 2;
  float u_blur : 0.0;
};
out vec4 v_data;
out vec4 v_color;
out float v_radius;

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize 设置拾取大小
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) 是为了兼容地球模式
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + vec3(u_offsets,0.0), 1.0);

  setPickingColor(a_PickingColor);
}
`;let aNt=class extends Ha{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,SHAPE:10,EXTRUDE:11})}getCommonUniformsInfo(){const{strokeOpacity:t=1,strokeWidth:r=0,blend:n,blur:i=0}=this.layer.getLayerConfig();this.layer.getLayerConfig();const a={u_additive:n==="additive"?1:0,u_stroke_opacity:t,u_stroke_width:r,u_blur:i};return this.getUniformsBufferInfo(a)}initModels(){var t=this;return Oe(function*(){return t.initUniformsBuffer(),t.buildModels()})()}buildModels(){var t=this;return Oe(function*(){return t.layer.triangulation=L$,[yield t.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:iNt,fragmentShader:nNt,triangulation:L$,defines:t.getDefines(),inject:t.getInject(),depth:{enable:!0},blend:t.getBlend()})]})()}animateOption2Array(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Jr.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:3,update:(t,r,n,i)=>{const[a,o,s]=n,l=su(0,0,1),u=su(a,0,s),c=a>=0?GU(l,u):Math.PI*2-GU(l,u),f=Math.PI*2-Math.asin(o/100),d=A_();NS(d,d,c),M_(d,d,f);const v=su(1,1,0);AT(v,v,d),Cw(v,v);const g=su(-1,1,0);AT(g,g,d),Cw(g,g);const x=su(-1,-1,0);AT(x,x,d),Cw(x,x);const w=su(1,-1,0);AT(w,w,d),Cw(w,w);const S=[...v,...g,...x,...w],M=i%4*3;return[S[M],S[M+1],S[M+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Jr.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:t=>{const{size:r=5}=t;return Array.isArray(r)?[r[0]]:[r]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Jr.Attribute,descriptor:{name:"a_Shape",shaderLocation:this.attributeLocation.SHAPE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:t=>{const{shape:r=2}=t;return[this.layer.getLayerConfig().shape2d.indexOf(r)]}}})}};const oNt=`
in vec4 v_color;
in float v_lightWeight;
out vec4 outputColor;

layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};

#pragma include "scene_uniforms"
#pragma include "picking"

void main() {

  outputColor = v_color;
  // 开启透明度渐变
  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,sNt=`#define pi (3.1415926535)

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in vec3 a_Size;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec4 a_Extrude;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};
out vec4 v_color;
out float v_lightWeight;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if (x > 0.0 && z > 0.0) {
    return atan(x / z);
  } else if (x > 0.0 && z <= 0.0) {
    return atan(-z / x) + pi / 2.0;
  } else if (x <= 0.0 && z <= 0.0) {
    return pi + atan(x / z); //atan(x/z) +
  } else {
    return atan(z / -x) + pi * 3.0 / 2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y / r);
}

void main() {
  vec3 size = a_Size * a_Position;

  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移

  if (u_heightfixed < 1.0) {
    // 圆柱体不固定高度
  } else {
    // 圆柱体固定高度 （ 处理 mapbox ）
    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      offset *= 4.0 / pow(2.0, 21.0 - u_Zoom);
    }
  }

  vec2 positions = a_Extrude.xy;
  vec2 positions64Low = a_Extrude.zw;
  vec4 project_pos = project_position(vec4(positions, 0.0, 1.0), positions64Low);

  // u_r 控制圆柱的生长
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // // 圆柱光照效果
  float lightWeight = 1.0;

  if (u_lightEnable > 0.0) {
    // 取消三元表达式，增强健壮性
    lightWeight = calc_lighting(pos);
  }

  v_lightWeight = lightWeight;

  v_color = a_Color;

  // 设置圆柱的底色
  if (u_linearColor == 1.0) {
    // 使用渐变颜色
    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);
    v_color.a = v_color.a * opacity;
  } else {
    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);
  }

  if (u_opacitylinear > 0.0) {
    v_color.a *= u_opacitylinear_dir > 0.0 ? 1.0 - a_Position.z : a_Position.z;
  }

  gl_Position = project_common_position_to_clipspace(pos);

  setPickingColor(a_PickingColor);
}
`;let jJ=class extends Ha{constructor(...t){super(...t),U(this,"raiseCount",0),U(this,"raiseRepeat",0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,EXTRUDE:10,NORMAL:11})}getCommonUniformsInfo(){const{animateOption:t={enable:!1,speed:.01,repeat:!1},sourceColor:r,targetColor:n,pickLight:i=!1,heightfixed:a=!1,opacityLinear:o={enable:!1,dir:"up"},lightEnable:s=!0}=this.layer.getLayerConfig();let l=0,u=[0,0,0,0],c=[0,0,0,0];if(r&&n&&(u=eo(r),c=eo(n),l=1),this.raiseCount<1&&this.raiseRepeat>0&&t.enable){const{speed:v=.01}=t;this.raiseCount+=v,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}const f={u_pickLight:Number(i),u_heightfixed:Number(a),u_r:t.enable&&this.raiseRepeat>0?this.raiseCount:1,u_linearColor:l,u_sourceColor:u,u_targetColor:c,u_opacitylinear:Number(o.enable),u_opacitylinear_dir:o.dir==="up"?1:0,u_lightEnable:Number(s)};return this.getUniformsBufferInfo(f)}initModels(){var t=this;return Oe(function*(){return t.buildModels()})()}buildModels(){var t=this;return Oe(function*(){const{depth:r=!0,animateOption:{repeat:n=1}}=t.layer.getLayerConfig();return t.raiseRepeat=n,t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:sNt,fragmentShader:oNt,triangulation:R4,defines:t.getDefines(),inject:t.getInject(),cull:{enable:!0,face:K.FRONT},depth:{enable:r}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Jr.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:3,update:t=>{const{size:r}=t;if(r){let n=[];return Array.isArray(r)&&(n=r.length===2?[r[0],r[0],r[1]]:r),Array.isArray(r)||(n=[r,r,r]),n}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Jr.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:3,update:(t,r,n,i,a)=>a}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Jr.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:4,update:t=>{const r=t_(t.coordinates);return[r[0],r[1],nl(r[0]),nl(r[1])]}}})}};const lNt=`
layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
  float u_time;
  vec4 u_animate;
};

in vec4 v_color;
in vec4 v_stroke;
in vec4 v_data;
in float v_radius;

#pragma include "scene_uniforms"
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));
  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  if(u_stroke_width < 0.01) {
    outputColor = v_color;
  } else {
    outputColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);
  }
  float intensity = 1.0;
  if(u_time!=-1.0){
    //wave相关逻辑
    float d = length(v_data.xy);
    if(d > 0.5) {
      discard;
    }
    intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor *= intensity;//wave
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor.a *= intensity;//wave 
    outputColor = filterColor(outputColor);
  }
   // 作为 mask 模板时需要丢弃透明的像素
  if(outputColor.a < 0.01) {
    discard;
  } 
}
`,uNt=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_SHAPE) in float a_Shape;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;

layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
  float u_time;
  vec4 u_animate;
};

out vec4 v_color;
out vec4 v_stroke;
out vec4 v_data;
out float v_radius;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // 透明度计算
   v_stroke = stroke;
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize 设置拾取大小
  *  u_meter2coord 在等面积大小的时候设置单位
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;



  // unpack color(vec2)
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if(u_size_unit == 1.0) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

   v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);

  offset = project_pixel(offset);
  offset = rotate_matrix(offset,rotation);

  // TODP: /abs(extrude.x) 是为了兼容地球模式
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0), a_Position64Low);
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_blur_height_fixed.y;

  if(u_blur_height_fixed.z < 1.0) { // false
    raisingHeight = project_pixel(u_blur_height_fixed.y);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  setPickingColor(a_PickingColor);
}
`;let YJ=class extends Ha{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,SHAPE:10,EXTRUDE:11})}getCommonUniformsInfo(){const{strokeOpacity:t=1,strokeWidth:r=0,blend:n,blur:i=0,raisingHeight:a=0,heightfixed:o=!1,unit:s="pixel"}=this.layer.getLayerConfig();let l=this.getAnimateUniforms().u_time;isNaN(l)&&(l=-1);const u={u_blur_height_fixed:[i,Number(a),Number(o)],u_stroke_width:r,u_additive:n==="additive"?1:0,u_stroke_opacity:t,u_size_unit:M4[s],u_time:l,u_animate:this.getAnimateUniforms().u_animate};return this.getUniformsBufferInfo(u)}getAnimateUniforms(){const{animateOption:t={enable:!1}}=this.layer.getLayerConfig();return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}getAttribute(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),$y)}initModels(){var t=this;return Oe(function*(){return t.buildModels()})()}buildModels(){var t=this;return Oe(function*(){const{frag:r,vert:n,type:i}=t.getShaders();return t.layer.triangulation=$y,t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:i,vertexShader:n,fragmentShader:r,defines:t.getDefines(),inject:t.getInject(),triangulation:$y,depth:{enable:!1}})]})()}getShaders(){return{frag:lNt,vert:uNt,type:"pointFill"}}animateOption2Array(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}registerBuiltinAttributes(){const t=this.layer.getLayerConfig().shape2d;this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Jr.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:3,update:(r,n,i,a)=>{const o=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],s=a%4*3;return[o[s],o[s+1],o[s+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Jr.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:r=>{const{size:n=5}=r;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Jr.Attribute,descriptor:{name:"a_Shape",shaderLocation:this.attributeLocation.SHAPE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:r=>{const{shape:n=2}=r;return[t.indexOf(n)]}}})}};const cNt=`in vec2 v_uv;// 本身的 uv 坐标
in vec2 v_Iconuv;
in float v_opacity;
out vec4 outputColor;

uniform sampler2D u_texture;
layout(std140) uniform commonUniform {
  vec2 u_textSize;
  float u_heightfixed: 0.0;
  float u_raisingHeight: 0.0;
  float u_size_unit;
};

#pragma include "scene_uniforms"
#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  outputColor = texture(SAMPLER_2D(u_texture), pos);
  outputColor.a *= v_opacity;
  outputColor = filterColor(outputColor);
}
`,hNt=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniform {
  vec2 u_textSize;
  float u_heightfixed;
  float u_raisingHeight;
  float u_size_unit;
};

out vec2 v_uv;
out vec2 v_Iconuv;
out float v_opacity;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  vec3 extrude = a_Extrude;
  v_uv = (a_Extrude.xy + 1.0) / 2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;
  v_opacity = opacity;
  float newSize = a_Size;
  if (u_size_unit == 1.0) {
    newSize = newSize * u_PixelsPerMeter.z;
  }

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = extrude.xy * newSize + offsets;

  offset = rotate_matrix(offset, rotation);

  offset = project_pixel(offset);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`;class fNt extends Ha{constructor(...t){super(...t),U(this,"meter2coord",1),U(this,"texture",void 0),U(this,"isMeter",!1),U(this,"radian",0),U(this,"updateTexture",()=>{const{createTexture2D:r}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),this.layerService.throttleRenderLayers();return}this.texture=r({data:this.iconService.getCanvas(),mag:K.LINEAR,min:K.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128,mipmap:!0}),this.textures=[this.texture]})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,EXTRUDE:10,UV:11})}getCommonUniformsInfo(){const{raisingHeight:t=0,heightfixed:r=!1,unit:n="pixel"}=this.layer.getLayerConfig();if(this.rendererService.getDirty()){var i;(i=this.texture)===null||i===void 0||i.bind()}const a={u_textSize:[1024,this.iconService.canvasHeight||128],u_heightfixed:Number(r),u_raisingHeight:Number(t),u_size_unit:M4[n]};return this.getUniformsBufferInfo(a)}getAttribute(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),$y)}initModels(){var t=this;return Oe(function*(){return t.iconService.on("imageUpdate",t.updateTexture),t.updateTexture(),t.buildModels()})()}buildModels(){var t=this;return Oe(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:hNt,fragmentShader:cNt,triangulation:$y,depth:{enable:!1},defines:t.getDefines(),inject:t.getInject(),cull:{enable:!0,face:K.FRONT}})]})()}clearModels(){var t;this.iconService.off("imageUpdate",this.updateTexture),(t=this.texture)===null||t===void 0||t.destroy()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Jr.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:t=>{const r=this.iconService.getIconMap(),{shape:n}=t,{x:i,y:a}=r[n]||{x:-64,y:-64};return[i,a]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Jr.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:3,update:(t,r,n,i)=>{const a=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=i%4*3;return[a[o],a[o+1],a[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Jr.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:t=>{const{size:r=5}=t;return Array.isArray(r)?[r[0]]:[r]}}})}}const dNt=`layout(std140) uniform commonUniforms {
  vec2 u_textSize;
  float u_raisingHeight;
  float u_heightfixed;
};

uniform sampler2D u_texture;

in vec4 v_color;
in vec2 v_uv;
in float v_opacity;

#pragma include "picking"

out vec4 outputColor;

void main(){
  vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
  vec4 textureColor;

  // Y = 0.299R + 0.587G + 0.114B // 亮度提取
  
  textureColor = texture(SAMPLER_2D(u_texture), pos);

  // Tip: 去除边缘部分 mipmap 导致的混合变暗
  float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
  if(fragmengTocenter >= 0.5) {
        float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
        textureColor.a *= luma;
  }
  
  if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
        outputColor= textureColor;
  }else {
        outputColor= step(0.01, textureColor.z) * v_color;
  }
  outputColor.a *= v_opacity;
  if (outputColor.a < 0.01) {
      discard;
  }
  outputColor = filterColor(outputColor);
}
`,pNt=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_textSize;
  float u_raisingHeight;
  float u_heightfixed;
};

out vec4 v_color;
out vec2 v_uv;
out float v_opacity;

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - 数据纹理映射部分的计算
  v_color = a_Color;
  v_opacity = opacity;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);

  vec2 offset = project_pixel(offsets);

  float raisingHeight = u_raisingHeight;
  if (u_heightfixed < 1.0) {
    // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;class ZJ extends Ha{constructor(...t){super(...t),U(this,"texture",void 0),U(this,"updateTexture",()=>{const{createTexture2D:r}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),setTimeout(()=>{this.layerService.throttleRenderLayers()});return}this.texture=r({data:this.iconService.getCanvas(),mag:K.LINEAR,min:K.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128,mipmap:!0})})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,UV:10})}getUninforms(){if(this.rendererService.getDirty()){var t;(t=this.texture)===null||t===void 0||t.bind()}const r=this.getCommonUniformsInfo(),n=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Ce(Ce({},r.uniformsOption),n.uniformsOption)}getCommonUniformsInfo(){const{raisingHeight:t=0,heightfixed:r=!1}=this.layer.getLayerConfig(),n={u_textSize:[1024,this.iconService.canvasHeight||128],u_raisingHeight:Number(t),u_heightfixed:Number(r),u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(n)}initModels(){var t=this;return Oe(function*(){return t.iconService.on("imageUpdate",t.updateTexture),t.updateTexture(),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var t=this;return Oe(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointImage",vertexShader:pNt,fragmentShader:dNt,triangulation:k5t,defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1},primitive:K.POINTS})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"size",type:Jr.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:t=>{const{size:r=5}=t;return Array.isArray(r)?[r[0]]:[r]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Jr.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:t=>{const r=this.iconService.getIconMap(),{shape:n}=t,{x:i,y:a}=r[n]||{x:-64,y:-64};return[i,a]}}})}}const vNt=`in vec4 v_color;
out vec4 outputColor;
void main() {
  outputColor = v_color;
}`,gNt=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;

layout(std140) uniform u_Common {
  float u_size_scale;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(project_pos);

  gl_PointSize = a_Size * u_size_scale * 2.0 * u_DevicePixelRatio;
}
`;function U$(e){const t=e.coordinates;return{vertices:[...t],indices:[0],size:t.length}}class qJ extends Ha{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9})}getDefaultStyle(){return{blend:"additive"}}getCommonUniformsInfo(){const t={u_size_scale:.5};return this.getUniformsBufferInfo(t)}initModels(){var t=this;return Oe(function*(){return t.buildModels()})()}buildModels(){var t=this;return Oe(function*(){return t.layer.triangulation=U$,t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:gNt,fragmentShader:vNt,triangulation:U$,defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1},primitive:K.POINTS,pick:!1})]})()}clearModels(){}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"size",type:Jr.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0]]:[r]}}})}}const mNt=`
layout(std140) uniform commonUniorm{
  float u_additive;
  float u_size_unit;
  float u_speed: 1.0;
  float u_time;
};
in vec4 v_data;
in vec4 v_color;
in float v_radius;
in vec2 v_extrude;
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  outputColor = vec4(v_color.rgb, v_color.a);

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
  } else {
    outputColor.a *= opacity_t;
  }

  if(outputColor.a > 0.0) {
    outputColor = filterColor(outputColor);
  }

  vec2 extrude =  v_extrude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  outputColor.a *= radar_v;
}
`,yNt=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;

layout(std140) uniform commonUniorm {
  float u_additive;
  float u_size_unit;
  float u_speed: 1.0;
  float u_time;
};

out vec4 v_data;
out vec4 v_color;
out float v_radius;
out vec2 v_extrude;

#pragma include "projection"
#pragma include "picking"

void main() {
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2(
    cos(time), sin(time),
    -sin(time), cos(time)
  );
  v_extrude = rotateMatrix * a_Extrude.xy;

  v_color = a_Color;
  v_color.a *= opacity;

  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  if(u_size_unit == 1.) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  v_radius = newSize;

  vec2 offset = (a_Extrude.xy * (newSize));

  offset = project_pixel(offset);

  v_data = vec4(a_Extrude.x, a_Extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  setPickingColor(a_PickingColor);
}
`;class _Nt extends Ha{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,EXTRUDE:10})}getCommonUniformsInfo(){const{blend:t,speed:r=1,unit:n="pixel"}=this.layer.getLayerConfig(),i={u_additive:t==="additive"?1:0,u_size_unit:M4[n],u_speed:r,u_time:this.layer.getLayerAnimateTime()};return this.getUniformsBufferInfo(i)}getAnimateUniforms(){return{}}getAttribute(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),$y)}initModels(){var t=this;return Oe(function*(){return t.buildModels()})()}buildModels(){var t=this;return Oe(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:yNt,fragmentShader:mNt,triangulation:$y,defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1}})]})()}animateOption2Array(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Jr.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:3,update:(t,r,n,i)=>{const a=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=i%4*3;return[a[o],a[o+1],a[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Jr.Attribute,descriptor:{shaderLocation:this.attributeLocation.SIZE,name:"a_Size",buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:t=>{const{size:r=5}=t;return Array.isArray(r)?[r[0]]:[r]}}})}}class xNt{constructor(t,r,n){U(this,"boxCells",[]),U(this,"xCellCount",void 0),U(this,"yCellCount",void 0),U(this,"boxKeys",void 0),U(this,"bboxes",void 0),U(this,"width",void 0),U(this,"height",void 0),U(this,"xScale",void 0),U(this,"yScale",void 0),U(this,"boxUid",void 0);const i=this.boxCells;this.xCellCount=Math.ceil(t/n),this.yCellCount=Math.ceil(r/n);for(let a=0;a<this.xCellCount*this.yCellCount;a++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0}insert(t,r,n,i,a){this.forEachCell(r,n,i,a,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(a)}query(t,r,n,i,a){return this.queryHitTest(t,r,n,i,!1,a)}hitTest(t,r,n,i,a){return this.queryHitTest(t,r,n,i,!0,a)}insertBoxCell(t,r,n,i,a,o){this.boxCells[a].push(o)}queryHitTest(t,r,n,i,a,o){if(n<0||t>this.width||i<0||r>this.height)return a?!1:[];const s=[];if(t<=0&&r<=0&&this.width<=n&&this.height<=i){if(a)return!0;for(let u=0;u<this.boxKeys.length;u++)s.push({key:this.boxKeys[u],x1:this.bboxes[u*4],y1:this.bboxes[u*4+1],x2:this.bboxes[u*4+2],y2:this.bboxes[u*4+3]});return o?s.filter(o):s}const l={hitTest:a,seenUids:{box:{},circle:{}}};return this.forEachCell(t,r,n,i,this.queryCell,s,l,o),a?s.length>0:s}queryCell(t,r,n,i,a,o,s,l){const u=s.seenUids,c=this.boxCells[a];if(c!==null){const f=this.bboxes;for(const d of c)if(!u.box[d]){u.box[d]=!0;const v=d*4;if(t<=f[v+2]&&r<=f[v+3]&&n>=f[v+0]&&i>=f[v+1]&&(!l||l(this.boxKeys[d]))){if(s.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[d],x1:f[v],y1:f[v+1],x2:f[v+2],y2:f[v+3]})}}}return!1}forEachCell(t,r,n,i,a,o,s,l){const u=this.convertToXCellCoord(t),c=this.convertToYCellCoord(r),f=this.convertToXCellCoord(n),d=this.convertToYCellCoord(i);for(let v=u;v<=f;v++)for(let g=c;g<=d;g++){const x=this.xCellCount*g+v;if(a.call(this,t,r,n,i,x,o,s,l))return}}convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}const bNt=xNt;class ENt{constructor(t,r){U(this,"width",void 0),U(this,"height",void 0),U(this,"grid",void 0),U(this,"viewportPadding",100),U(this,"screenRightBoundary",void 0),U(this,"screenBottomBoundary",void 0),U(this,"gridRightBoundary",void 0),U(this,"gridBottomBoundary",void 0),this.width=t,this.height=r,this.viewportPadding=Math.max(t,r),this.grid=new bNt(t+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=t+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=t+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}placeCollisionBox(t){const r=t.x1+t.anchorPointX+this.viewportPadding,n=t.y1+t.anchorPointY+this.viewportPadding,i=t.x2+t.anchorPointX+this.viewportPadding,a=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(r,n,i,a)||this.grid.hitTest(r,n,i,a)?{box:[]}:{box:[r,n,i,a]}}insertCollisionBox(t,r){const n={featureIndex:r};this.grid.insert(n,t[0],t[1],t[2],t[3])}project(t,r,n){const i=KIt(r,n,0,1),a=mQ(),o=WIt(...t);return Dm(a,i,o),{x:(a[0]/a[3]+1)/2*this.width+this.viewportPadding,y:(-a[1]/a[3]+1)/2*this.height+this.viewportPadding}}isInsideGrid(t,r,n,i){return n>=0&&t<this.gridRightBoundary&&i>=0&&r<this.gridBottomBoundary}}function KJ(e){let t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0;break;default:t=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:t,verticalAlign:r}}function QJ(e,t,r,n,i){if(!i)return;const a=e[n],o=a.glyph;if(o){const s=t[o].advance*a.scale,l=(e[n].x+s)*i;for(let u=r;u<=n;u++)e[u].x-=l}}function JJ(e,t,r,n,i,a,o){const s=(t-r)*i,l=(-n*o+.5)*a;for(const u of e)u.x+=s,u.y+=l}function wNt(e,t,r,n,i,a,o){let l=0,u=-8,c=0;const f=e.positionedGlyphs,d=a==="right"?1:a==="left"?0:.5,v=f.length;r.forEach(S=>{if(S.split("").forEach(M=>{const R=t[M],I=0;R&&(f.push({glyph:M,x:l,y:u+I,vertical:!1,scale:1,metrics:R}),l+=R.advance+o)}),f.length!==v){const M=l-o;c=Math.max(M,c),QJ(f,t,v,f.length-1,d)}l=0,u-=n+5});const{horizontalAlign:g,verticalAlign:x}=KJ(i);JJ(f,d,g,x,c,n,r.length);const w=u- -8;e.top+=-x*w,e.bottom=e.top-w,e.left+=-g*c,e.right=e.left+c}function CNt(e,t,r,n,i,a,o){let l=0,u=-8,c=0;const f=e.positionedGlyphs,d=a==="right"?1:a==="left"?0:.5,v=f.length;r.forEach(S=>{const M=t[S],R=0;if(M&&(f.push({glyph:S,x:M.advance/2,y:u+R,vertical:!1,scale:1,metrics:M}),l+=M.advance+o),f.length!==v){const I=l-o;c=Math.max(I,c),QJ(f,t,v,f.length-1,d)}l=0,u-=n+5});const{horizontalAlign:g,verticalAlign:x}=KJ(i);JJ(f,d,g,x,c,n,r.length);const w=u- -8;e.top+=-x*w,e.bottom=e.top-w,e.left+=-g*c,e.right=e.left+c}function SNt(e,t,r,n,i,a,o=[0,0],s){const l=e.split(`
`),u=[],c={positionedGlyphs:u,top:o[1],bottom:o[1],left:o[0],right:o[0],lineCount:l.length,text:e};return s?CNt(c,t,l,r,n,i,a):wNt(c,t,l,r,n,i,a),u.length?c:!1}function TNt(e,t=[0,0],r){const{positionedGlyphs:n=[]}=e,i=[];for(const a of n){const o=a.metrics,s=4,l=o.advance*a.scale/2,u=r?[a.x+l,a.y]:[0,0],c=r?[0,0]:[a.x+l+t[0],a.y+t[1]],f=(0-s)*a.scale-l+c[0],d=(0-s)*a.scale+c[1],v=f+o.width*a.scale,g=d+o.height*a.scale,x={x:f,y:d},w={x:v,y:d},S={x:f,y:g},M={x:v,y:g};i.push({tl:x,tr:w,bl:S,br:M,tex:o,glyphOffset:u})}return i}const $$=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0

uniform sampler2D u_sdf_map;
layout(std140) uniform commonUniforms {
  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
  vec2 u_sdf_map_size;
  float u_raisingHeight: 0.0;
  float u_stroke_width : 2;
  float u_gamma_scale : 0.5;
  float u_halo_blur : 0.5;
};

in vec2 v_uv;
in float v_gamma_scale;
in vec4 v_color;
in vec4 v_stroke_color;
in float v_fontScale;

out vec4 outputColor;

#pragma include "picking"
void main() {
  // get style data mapping

  // get sdf from atlas
  float dist = texture(SAMPLER_2D(u_sdf_map), v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);

  outputColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));

  outputColor.a *= alpha;
   // 作为 mask 模板时需要丢弃透明的像素
  if (outputColor.a < 0.01) {
    discard;
  }
  outputColor = filterColor(outputColor);
}
`,H$=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0

layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_TEXT_OFFSETS) in vec2 a_textOffsets;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_tex;

layout(std140) uniform commonUniforms {
  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
  vec2 u_sdf_map_size;
  float u_raisingHeight: 0.0;
  float u_stroke_width : 2;
  float u_gamma_scale : 0.5;
  float u_halo_blur : 0.5;
};

out vec2 v_uv;
out float v_gamma_scale;
out vec4 v_color;
out vec4 v_stroke_color;
out float v_fontScale;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // cal style mapping - 数据纹理映射部分的计算

  v_uv = a_tex / u_sdf_map_size;



  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);

  // 文本缩放比例
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  vec2 offset = rotate_matrix(a_textOffsets,rotation);

  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));

  gl_Position = vec4(
    projected_position.xy / projected_position.w + offset * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`,{isEqual:QE}=as;function V$(e){const t=this,r=e.id,n=[],i=[];if(!t.glyphInfoMap||!t.glyphInfoMap[r])return{vertices:[],indices:[],size:7};const a=t.glyphInfoMap[r].centroid,o=a.length===2?[a[0],a[1],0]:a;return t.glyphInfoMap[r].glyphQuads.forEach((s,l)=>{n.push(...o,s.tex.x,s.tex.y+s.tex.height,s.tl.x,s.tl.y,...o,s.tex.x+s.tex.width,s.tex.y+s.tex.height,s.tr.x,s.tr.y,...o,s.tex.x+s.tex.width,s.tex.y,s.br.x,s.br.y,...o,s.tex.x,s.tex.y,s.bl.x,s.bl.y),i.push(0+l*4,1+l*4,2+l*4,2+l*4,3+l*4,0+l*4)}),{vertices:n,indices:i,size:7}}class ttt extends Ha{constructor(...t){var r;super(...t),r=this,U(this,"glyphInfo",void 0),U(this,"glyphInfoMap",{}),U(this,"rawEncodeData",void 0),U(this,"texture",void 0),U(this,"currentZoom",-1),U(this,"extent",void 0),U(this,"textureHeight",0),U(this,"textCount",0),U(this,"preTextStyle",{}),U(this,"mapping",Oe(function*(){r.initGlyph(),r.updateTexture(),yield r.reBuildModel()}))}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,TEXT_OFFSETS:10,UV:11})}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Ce(Ce(Ce({},t.uniformsOption),r.uniformsOption),{u_sdf_map:this.textures[0]})}getCommonUniformsInfo(){const{stroke:t="#fff",strokeWidth:r=0,halo:n=.5,gamma:i=2,raisingHeight:a=0}=this.layer.getLayerConfig(),o=this.getFontServiceMapping(),s=this.getFontServiceCanvas();o&&Object.keys(o).length!==this.textCount&&s&&(this.updateTexture(),this.textCount=Object.keys(o).length),this.preTextStyle=this.getTextStyle();const l={u_stroke_color:eo(t),u_sdf_map_size:[(s==null?void 0:s.width)||1,(s==null?void 0:s.height)||1],u_raisingHeight:Number(a),u_stroke_width:r,u_gamma_scale:i,u_halo_blur:n};return this.getUniformsBufferInfo(l)}initModels(){var t=this;return Oe(function*(){return t.bindEvent(),t.extent=t.textExtent(),t.rawEncodeData=t.layer.getEncodedData(),t.preTextStyle=t.getTextStyle(),t.initUniformsBuffer(),t.buildModels()})()}buildModels(){var t=this;return Oe(function*(){const{textAllowOverlap:r=!1}=t.layer.getLayerConfig();return t.initGlyph(),t.updateTexture(),r||t.filterGlyphs(),[yield t.layer.buildLayerModel({moduleName:"pointText",vertexShader:H$,fragmentShader:$$,defines:t.getDefines(),inject:t.getInject(),triangulation:V$.bind(t),depth:{enable:!1}})]})()}needUpdate(){var t=this;return Oe(function*(){const{textAllowOverlap:r=!1,textAnchor:n="center",textOffset:i,padding:a,fontFamily:o,fontWeight:s}=t.getTextStyle();if(!QE(a,t.preTextStyle.padding)||!QE(i,t.preTextStyle.textOffset)||!QE(n,t.preTextStyle.textAnchor)||!QE(o,t.preTextStyle.fontFamily)||!QE(s,t.preTextStyle.fontWeight))return yield t.mapping(),!0;if(r)return!1;const l=t.mapService.getZoom(),u=t.mapService.getBounds(),c=GK(t.extent,u);return Math.abs(t.currentZoom-l)>.5||!c||r!==t.preTextStyle.textAllowOverlap?(yield t.reBuildModel(),!0):!1})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.layer.off("remapping",this.mapping)}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Jr.Attribute,descriptor:{shaderLocation:this.attributeLocation.TEXT_OFFSETS,name:"a_textOffsets",buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:2,update:(t,r,n)=>[n[5],n[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Jr.Attribute,descriptor:{name:"a_tex",shaderLocation:this.attributeLocation.UV,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:(t,r,n)=>[n[3],n[4]]}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Jr.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:t=>{const{size:r=12}=t;return Array.isArray(r)?[r[0]]:[r]}}})}bindEvent(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}textExtent(){const t=this.mapService.getBounds();return o4(t,.5)}initTextFont(){const{fontWeight:t,fontFamily:r}=this.getTextStyle(),n=this.rawEncodeData,i=[];n.forEach(a=>{let{shape:o=""}=a;o=o.toString();for(const s of o)i.indexOf(s)===-1&&i.push(s)}),this.fontService.setFontOptions({characterSet:i,fontWeight:t,fontFamily:r,iconfont:!1})}initIconFontTex(){const{fontWeight:t,fontFamily:r}=this.getTextStyle(),n=this.rawEncodeData,i=[];n.forEach(a=>{let{shape:o=""}=a;o=`${o}`,i.indexOf(o)===-1&&i.push(o)}),this.fontService.setFontOptions({characterSet:i,fontWeight:t,fontFamily:r,iconfont:!0})}getTextStyle(){const{fontWeight:t="400",fontFamily:r="sans-serif",textAllowOverlap:n=!1,padding:i=[0,0],textAnchor:a="center",textOffset:o=[0,0],opacity:s=1,strokeOpacity:l=1,strokeWidth:u=0,stroke:c="#000"}=this.layer.getLayerConfig();return{fontWeight:t,fontFamily:r,textAllowOverlap:n,padding:i,textAnchor:a,textOffset:o,opacity:s,strokeOpacity:l,strokeWidth:u,stroke:c}}generateGlyphLayout(t){const r=this.getFontServiceMapping(),{spacing:n=2,textAnchor:i="center",textOffset:a}=this.layer.getLayerConfig(),o=this.rawEncodeData;this.glyphInfo=o.map(s=>{const{shape:l="",id:u,size:c=1}=s,f=s.textOffset?s.textOffset:a||[0,0],d=s.textAnchor?s.textAnchor:i||"center",v=SNt(l.toString(),r,c,d,"left",n,f,t),g=TNt(v,f,!1);return s.shaping=v,s.glyphQuads=g,s.centroid=t_(s.coordinates),this.glyphInfoMap[u]={shaping:v,glyphQuads:g,centroid:t_(s.coordinates)},s})}getFontServiceMapping(){const{fontWeight:t="400",fontFamily:r="sans-serif"}=this.layer.getLayerConfig();return this.fontService.getMappingByKey(`${r}_${t}`)}getFontServiceCanvas(){const{fontWeight:t="400",fontFamily:r="sans-serif"}=this.layer.getLayerConfig();return this.fontService.getCanvasByKey(`${r}_${t}`)}filterGlyphs(){const{padding:t=[0,0],textAllowOverlap:r=!1}=this.layer.getLayerConfig();if(r)return;this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();const{width:n,height:i}=this.rendererService.getViewportSize(),a=new ENt(n,i);this.glyphInfo.filter(s=>{const{shaping:l,id:u=0}=s,c=s.centroid,d=s.size/16,v=this.mapService.lngLatToContainer(c),{box:g}=a.placeCollisionBox({x1:l.left*d-t[0],x2:l.right*d+t[0],y1:l.top*d-t[1],y2:l.bottom*d+t[1],anchorPointX:v.x,anchorPointY:v.y});return g&&g.length?(a.insertCollisionBox(g,u),!0):!1}).forEach(s=>{this.glyphInfoMap[s.id]=s})}initGlyph(){const{iconfont:t=!1}=this.layer.getLayerConfig();t?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(t)}updateTexture(){const{createTexture2D:t}=this.rendererService,r=this.getFontServiceCanvas();this.textureHeight=r.height,this.texture&&this.texture.destroy(),this.texture=t({data:r,mag:K.LINEAR,min:K.LINEAR,width:r.width,height:r.height}),this.textures=[this.texture]}reBuildModel(){var t=this;return Oe(function*(){t.filterGlyphs();const r=yield t.layer.buildLayerModel({moduleName:"pointText",vertexShader:H$,fragmentShader:$$,triangulation:V$.bind(t),defines:t.getDefines(),inject:t.getInject(),depth:{enable:!1}});t.layer.models=[r]})()}}const ANt={fillImage:fNt,fill:YJ,radar:_Nt,image:ZJ,normal:qJ,simplePoint:Q4t,extrude:jJ,text:ttt,earthFill:aNt,earthExtrude:rNt},MNt=ANt;class DC extends L_{constructor(...t){super(...t),U(this,"type","PointLayer"),U(this,"enableShaderEncodeStyles",["stroke","offsets","opacity","rotation"]),U(this,"enableDataEncodeStyles",["textOffset","textAnchor"]),U(this,"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}})}buildModels(){var t=this;return Oe(function*(){const r=t.getModelType();t.layerModel&&t.layerModel.clearModels(),t.layerModel=new MNt[r](t),yield t.initLayerModels()})()}rebuildModels(){var t=this;return Oe(function*(){yield t.buildModels()})()}getModelTypeWillEmptyData(){if(this.shapeOption){const{field:t,values:r}=this.shapeOption,{shape2d:n}=this.getLayerConfig(),i=this.iconService.getIconMap();if(t&&(n==null?void 0:n.indexOf(t))!==-1)return"fill";if(r==="text")return"text";if(r&&r instanceof Array){for(const a of r)if(typeof a=="string"&&i.hasOwnProperty(a))return"image"}}return"normal"}getDefaultConfig(){const t=this.getModelType();return{fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}}[t]}getModelType(){const t=this.getEncodedData(),{shape2d:r,shape3d:n,billboard:i=!0}=this.getLayerConfig(),a=this.iconService.getIconMap(),o=t.find(s=>s.hasOwnProperty("shape"));if(o){const s=o.shape;return s==="dot"?"normal":s==="simple"?"simplePoint":s==="radar"?"radar":this.layerType==="fillImage"||i===!1?"fillImage":(r==null?void 0:r.indexOf(s))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(n==null?void 0:n.indexOf(s))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":a.hasOwnProperty(s)?"image":"text"}else return this.getModelTypeWillEmptyData()}}function RNt(e){return JD.apply(this,arguments)}function JD(){return JD=Oe(function*(e){if(window.createImageBitmap){const t=yield fetch(e);return yield createImageBitmap(yield t.blob())}else{const t=new window.Image;return new Promise(r=>{t.onload=()=>r(t),t.src=e,t.crossOrigin="Anonymous"})}}),JD.apply(this,arguments)}const INt=`layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // 默认不固定
  float u_raisingHeight;
};

in vec4 v_Color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    outputColor = v_Color;
  
  outputColor = filterColor(outputColor);
}
`,LNt=`
layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // 默认不固定
  float u_raisingHeight;
};

in vec4 v_Color;
in vec3 v_uvs;
in vec2 v_texture_data;
out vec4 outputColor;

#pragma include "scene_uniforms"
#pragma include "picking"

void main() {
  float isSide =  v_texture_data.x;
  float sidey = v_uvs[2];
  float lightWeight = v_texture_data.y;

  // Tip: 部分机型 GPU 计算精度兼容
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      outputColor = linearColor;
    } else {
      // side notuse linear
       outputColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    outputColor = v_Color;
  }

  outputColor = filterColorAlpha(outputColor, lightWeight);
}
`,ONt=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec3 a_uvs;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // 默认不固定
  float u_raisingHeight;
};

out vec4 v_Color;
out vec3 v_uvs;
out vec2 v_texture_data;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_uvs = a_uvs;
  // cal style mapping - 数据纹理映射部分的计算
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos, a_Position64Low);

  if (u_heightfixed > 0.0) {
    // 判断几何体是否固定高度
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  float lightWeight = calc_lighting(project_pos);
  v_texture_data = vec2(a_Position.z, lightWeight);

  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  setPickingColor(a_PickingColor);
}
`,PNt=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec3 a_uvs;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // 默认不固定
  float u_raisingHeight;
};

out vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  float isSide = a_Position.z;
  float topU = a_uvs[0];
  float topV = 1.0 - a_uvs[1];
  float sidey = a_uvs[2];

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);

  vec4 project_pos = project_position(pos, a_Position64Low);
  float lightWeight = calc_lighting(project_pos);

  if (u_heightfixed > 0.0) {
    // 判断几何体是否固定高度
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

 gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  // Tip: 部分机型 GPU 计算精度兼容
  if (isSide < 0.999) {
    // side face
    // if(u_sidesurface < 1.0) {
    //   discard;
    // }

    if (u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      v_Color = linearColor;
    } else {
      v_Color = a_Color;
    }

  } else {
    v_Color = a_Color;
  }

  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);

  setPickingColor(a_PickingColor);
}
`,DNt=`uniform sampler2D u_texture;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // 默认不固定
  float u_raisingHeight;
};

in vec4 v_Color;
in vec3 v_uvs;
in vec2 v_texture_data;

#pragma include "scene_uniforms"
#pragma include "picking"

out vec4 outputColor;

void main() {
  float opacity = u_opacity;
  float isSide = v_texture_data.x;
  float lightWeight = v_texture_data.y;
  float topU = v_uvs[0];
  float topV = 1.0 - v_uvs[1];
  float sidey = v_uvs[2];

  outputColor = texture(SAMPLER_2D(u_texture), vec2(topU, topV));
  // Tip: 部分机型 GPU 计算精度兼容
  if (isSide < 0.999) {// 是否是边缘
    // side face
    if (u_sidesurface < 1.0) {
      discard;
    }

    if (u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      outputColor = linearColor;
    } else {
      outputColor = v_Color;
    }
  } else {
     // top face
    if (u_topsurface < 1.0) {
      discard;
    }
  }
  
  outputColor.a *= opacity;
  outputColor = filterColor(outputColor);
}
`,FNt=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;
layout(location = ATTRIBUTE_LOCATION_UV) in vec3 a_uvs;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // 默认不固定
  float u_raisingHeight;
};

out vec4 v_Color;
out vec3 v_uvs;
out vec2 v_texture_data;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos, a_Position64Low);
  float lightWeight = calc_lighting(project_pos);
  v_uvs = a_uvs;
  v_Color = a_Color;
  v_Color.a *= opacity;

  v_texture_data = vec2(a_Position.z, lightWeight);

  if (u_heightfixed > 0.0) {
    // 判断几何体是否固定高度
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if (
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    ) {
      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}
`;class BNt extends Ha{constructor(...t){super(...t),U(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,NORMAL:10,UV:11})}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Ce(Ce({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{mapTexture:t,heightfixed:r=!1,raisingHeight:n=0,topsurface:i=!0,sidesurface:a=!0,sourceColor:o,targetColor:s}=this.layer.getLayerConfig();let l=0,u=[1,1,1,1],c=[1,1,1,1];o&&s&&(u=eo(o),c=eo(s),l=1);const f={u_sourceColor:u,u_targetColor:c,u_linearColor:l,u_topsurface:Number(i),u_sidesurface:Number(a),u_heightfixed:Number(r),u_raisingHeight:Number(n)};return t&&this.texture&&(f.u_texture=this.texture,this.textures=[this.texture]),this.getUniformsBufferInfo(f)}initModels(){var t=this;return Oe(function*(){return yield t.loadTexture(),t.buildModels()})()}buildModels(){var t=this;return Oe(function*(){const{frag:r,vert:n,type:i}=t.getShaders();return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:i,vertexShader:n,fragmentShader:r,depth:{enable:!0},defines:t.getDefines(),inject:t.getInject(),triangulation:VJ})]})()}getShaders(){const{pickLight:t,mapTexture:r}=this.layer.getLayerConfig();return r?{frag:DNt,vert:FNt,type:"polygonExtrudeTexture"}:t?{frag:LNt,vert:ONt,type:"polygonExtrudePickLight"}:{frag:INt,vert:PNt,type:"polygonExtrude"}}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.textures=[]}registerBuiltinAttributes(){const t=this.layer.getSource().extent,r=t[2]-t[0],n=t[3]-t[1];this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uvs",type:Jr.Attribute,descriptor:{name:"a_uvs",shaderLocation:this.attributeLocation.UV,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:3,update:(i,a,o)=>{const s=o[0],l=o[1];return[(s-t[0])/r,(l-t[1])/n,o[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Jr.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:3,update:(i,a,o,s,l)=>l}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Jr.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:i=>{const{size:a=10}=i;return Array.isArray(a)?[a[0]]:[a]}}})}loadTexture(){var t=this;return Oe(function*(){const{mapTexture:r}=t.layer.getLayerConfig(),{createTexture2D:n}=t.rendererService;if(t.texture=n({height:1,width:1}),r){const i=yield RNt(r);t.texture=n({data:i,width:i.width,height:i.height,wrapS:K.CLAMP_TO_EDGE,wrapT:K.CLAMP_TO_EDGE,min:K.LINEAR,mag:K.LINEAR})}})()}}const NNt=`
in vec4 v_Color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {

  outputColor = v_Color;
  outputColor = filterColor(outputColor);
}
`,kNt=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;
layout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;

out vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size + (1.0 - a_Position.z) * extrusionBase, 1.0);

  vec4 project_pos = project_position(pos, a_Position64Low);
  float lightWeight = calc_lighting(project_pos);
  v_Color = a_Color;
  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}
`;class zNt extends Ha{constructor(...t){super(...t),U(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,SIZE:9,NORMAL:10,EXTRUSION_BASE:11})}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Ce(Ce({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const t={};return this.getUniformsBufferInfo(t)}initModels(){var t=this;return Oe(function*(){return t.buildModels()})()}buildModels(){var t=this;return Oe(function*(){const{frag:r,vert:n,type:i}=t.getShaders();return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:i,vertexShader:n,fragmentShader:r,defines:t.getDefines(),inject:t.getInject(),triangulation:VJ,depth:{enable:!0}})]})()}getShaders(){return{frag:NNt,vert:kNt,type:"polygonExtrude"}}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Jr.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:3,update:(t,r,n,i,a)=>a}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Jr.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:1,update:t=>{const{size:r=10}=t;return Array.isArray(r)?[r[0]]:[r]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrusionBase",type:Jr.Attribute,descriptor:{name:"a_ExtrusionBase",shaderLocation:this.attributeLocation.EXTRUSION_BASE,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:1,update:t=>{const{extrusionBase:r=0}=t;return[r]}}})}}const UNt=`in vec4 v_color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,$Nt=`
layout(std140) uniform commonUniforms {
  float u_raisingHeight;
  float u_opacitylinear;
  float u_dir;
};

in vec4 v_color;
in vec3 v_linear;
in vec2 v_pos;
out vec4 outputColor;
#pragma include "scene_uniforms"
#pragma include "picking"

void main() {
  outputColor = v_color;
  if (u_opacitylinear > 0.0) {
    outputColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }
  outputColor = filterColor(outputColor);
}
`,HNt=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_LINEAR) in vec3 a_linear;

layout(std140) uniform commonUniforms {
  float u_raisingHeight;
  float u_opacitylinear;
  float u_dir;
};

out vec4 v_color;
out vec3 v_linear;
out vec2 v_pos;

#pragma include "projection"
#pragma include "picking"

void main() {
  if (u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  project_pos.z += u_raisingHeight;

  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  setPickingColor(a_PickingColor);
}
`,VNt=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;

layout(std140) uniform commonUniforms {
  float u_raisingHeight;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - 数据纹理映射部分的计算

  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);

  project_pos.z += u_raisingHeight;

  if (
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
  ) {
    float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}

`;class GNt extends Ha{get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,LINEAR:9})}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Ce(Ce({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{raisingHeight:t=0,opacityLinear:r={enable:!1,dir:"in"}}=this.layer.getLayerConfig(),n={u_raisingHeight:Number(t),u_opacitylinear:Number(r.enable),u_dir:r.dir==="in"?1:0};return this.getUniformsBufferInfo(n)}initModels(){var t=this;return Oe(function*(){return t.buildModels()})()}buildModels(){var t=this;return Oe(function*(){const{frag:r,vert:n,triangulation:i,type:a}=t.getModelParams();return t.initUniformsBuffer(),t.layer.triangulation=i,[yield t.layer.buildLayerModel({moduleName:a,vertexShader:n,fragmentShader:r,defines:t.getDefines(),inject:t.getInject(),triangulation:i,primitive:K.TRIANGLES,depth:{enable:!1}})]})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute();const{opacityLinear:t={enable:!1,dir:"in"}}=this.layer.getLayerConfig();t.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:Jr.Attribute,descriptor:{name:"a_linear",shaderLocation:this.attributeLocation.LINEAR,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:3,update:(r,n,i)=>[i[3],i[4],i[5]]}})}getModelParams(){const{opacityLinear:t={enable:!1}}=this.layer.getLayerConfig();return t.enable?{frag:$Nt,vert:HNt,type:"polygonLinear",triangulation:$5t}:{frag:UNt,vert:VNt,type:"polygonFill",triangulation:US}}}const WNt=`
layout(std140) uniform commonUniforms {
  vec4 u_watercolor;
  vec4 u_watercolor2;
  float u_time;
};

in vec2 v_uv;
in float v_opacity;
out vec4 outputColor;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;

vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture(SAMPLER_2D(u_texture2),p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture(SAMPLER_2D(u_texture1),fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture(SAMPLER_2D(u_texture3), fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    
  outputColor = vec4(col, v_opacity);  
}
`,XNt=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_uv;

layout(std140) uniform commonUniforms {
  vec4 u_watercolor;
  vec4 u_watercolor2;
  float u_time;
};

out vec2 v_uv;
out float v_opacity;

#pragma include "projection"

void main() {
  v_uv = a_uv;
  v_opacity = opacity;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
}

`;class jNt extends Ha{constructor(...t){super(...t),U(this,"texture1",void 0),U(this,"texture2",void 0),U(this,"texture3",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Ce(Ce({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{watercolor:t="#6D99A8",watercolor2:r="#0F121C"}=this.layer.getLayerConfig(),n={u_watercolor:eo(t),u_watercolor2:eo(r),u_time:this.layer.getLayerAnimateTime(),u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3};return this.textures=[this.texture1,this.texture2,this.texture3],this.getUniformsBufferInfo(n)}getAnimateUniforms(){return{u_time:this.layer.getLayerAnimateTime()}}initModels(){var t=this;return Oe(function*(){return t.loadTexture(),t.buildModels()})()}buildModels(){var t=this;return Oe(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:XNt,fragmentShader:WNt,defines:t.getDefines(),inject:t.getInject(),triangulation:US,primitive:K.TRIANGLES,depth:{enable:!1}})]})()}clearModels(){var t,r,n;(t=this.texture1)===null||t===void 0||t.destroy(),(r=this.texture2)===null||r===void 0||r.destroy(),(n=this.texture3)===null||n===void 0||n.destroy()}registerBuiltinAttributes(){const t=this.layer.getSource().extent,[r,n,i,a]=t,o=i-r,s=a-n;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:Jr.Attribute,descriptor:{name:"a_uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:2,update:(l,u,c)=>{const[f,d]=c;return[(f-r)/o,(d-n)/s]}}})}loadTexture(){const{createTexture2D:t}=this.rendererService,r={height:0,width:0};this.texture1=t(r),this.texture2=t(r),this.texture3=t(r),n(a=>{this.texture1=i(a[0]),this.texture2=i(a[1]),this.texture3=i(a[2]),this.layerService.reRender()});function n(a){let o=0;const s=[];["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"].map(u=>{const c=new Image;c.crossOrigin="",c.src=u,s.push(c),c.onload=()=>{o++,o===3&&a(s)}})}function i(a){return t({data:a,width:a.width,height:a.height,wrapS:K.MIRRORED_REPEAT,wrapT:K.MIRRORED_REPEAT,min:K.LINEAR,mag:K.LINEAR})}}}const YNt=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
  float u_speed;
  float u_time;
};

out vec4 outputColor;


in vec4 v_Color;
in vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {

  outputColor = v_Color;
  float spc = calSpc();
  outputColor += spc * 0.4;
}
`,ZNt=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_uv;

layout(std140) uniform commonUniforms {
  float u_speed;
  float u_time;
};
out vec4 v_Color;
out vec2 v_uv;

#pragma include "projection"

void main() {
  v_uv = a_uv;
  v_Color = a_Color;
  v_Color.a *= opacity;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
}

`;class qNt extends Ha{constructor(...t){super(...t),U(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Ce(Ce({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{speed:t=.5}=this.layer.getLayerConfig(),r={u_speed:t,u_time:this.layer.getLayerAnimateTime(),u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(r)}getAnimateUniforms(){return{u_time:this.layer.getLayerAnimateTime()}}initModels(){var t=this;return Oe(function*(){return t.loadTexture(),t.buildModels()})()}buildModels(){var t=this;return Oe(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:ZNt,fragmentShader:YNt,triangulation:US,defines:t.getDefines(),inject:t.getInject(),primitive:K.TRIANGLES,depth:{enable:!1},pickingEnabled:!1,diagnosticDerivativeUniformityEnabled:!1})]})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}registerBuiltinAttributes(){const t=this.layer.getSource().extent,[r,n,i,a]=t,o=i-r,s=a-n;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:Jr.Attribute,descriptor:{name:"a_uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:K.STATIC_DRAW,data:[],type:K.FLOAT},size:2,update:(l,u,c)=>{const[f,d]=c;return[(f-r)/o,(d-n)/s]}}})}loadTexture(){const{waterTexture:t}=this.layer.getLayerConfig(),{createTexture2D:r}=this.rendererService;this.texture=r({height:1,width:1});const n=new Image;n.crossOrigin="",t?(console.warn("L7 recommend：https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),n.src=t):n.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",n.onload=()=>{this.texture=r({data:n,width:n.width,height:n.height,wrapS:K.MIRRORED_REPEAT,wrapT:K.MIRRORED_REPEAT,min:K.LINEAR,mag:K.LINEAR}),this.layerService.reRender()}}}const KNt={fill:GNt,line:XJ,extrude:BNt,text:ttt,point_fill:YJ,point_image:ZJ,point_normal:qJ,point_extrude:jJ,water:qNt,ocean:jNt,extrusion:zNt},QNt=KNt;class cR extends L_{constructor(...t){super(...t),U(this,"type","PolygonLayer"),U(this,"enableShaderEncodeStyles",["opacity","extrusionBase","rotation","offsets","stroke"])}buildModels(){var t=this;return Oe(function*(){const r=t.getModelType();t.layerModel=new QNt[r](t),yield t.initLayerModels()})()}getModelType(){var t;const r=this.styleAttributeService.getLayerStyleAttribute("shape"),n=r==null||(t=r.scale)===null||t===void 0?void 0:t.field;return n==="fill"||!n?"fill":n==="extrude"?"extrude":n==="extrusion"?"extrusion":n==="water"?"water":n==="ocean"?"ocean":n==="line"?"line":this.getPointModelType()}getPointModelType(){const t=this.getEncodedData(),{shape2d:r,shape3d:n}=this.getLayerConfig(),i=this.iconService.getIconMap(),a=t.find(o=>o.hasOwnProperty("shape"));if(a){const o=a.shape;return o==="dot"?"point_normal":(r==null?void 0:r.indexOf(o))!==-1?"point_fill":(n==null?void 0:n.indexOf(o))!==-1?"point_extrude":i.hasOwnProperty(o)?"point_image":"text"}else return"fill"}}const JNt=`layout(std140) uniform commonUniforms {
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  float u_clampLow;
  float u_clampHigh;
};

uniform sampler2D u_rasterTexture;
uniform sampler2D u_colorTexture;

in vec2 v_texCoord;

bool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }

out vec4 outputColor;

void main() {
  // Can use any component here since u_rasterTexture is under luminance format.
  float value = texture(SAMPLER_2D(u_rasterTexture), vec2(v_texCoord.x, v_texCoord.y)).r;
  if (value == u_noDataValue || isnan_emu(value)) {
    discard;
  } else if ((u_clampLow < 0.5 && value < u_domain[0]) || (u_clampHigh < 0.5 && value > u_domain[1])) {
    discard;
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(normalisedValue, 0));
    
    outputColor = color;
    outputColor.a = outputColor.a * u_opacity ;
    if (outputColor.a < 0.01)
      discard;
  }
}
`,tkt=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  float u_clampLow;
  float u_clampHigh;
};

out vec2 v_texCoord;

#pragma include "projection"

void main() {
  v_texCoord = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
}
`;let G$=class extends Ha{constructor(...t){super(...t),U(this,"texture",void 0),U(this,"colorTexture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Ce(Ce({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{opacity:t=1,clampLow:r=!0,clampHigh:n=!0,noDataValue:i=-9999999,domain:a,rampColors:o}=this.layer.getLayerConfig(),s=a||G5(o);this.colorTexture=this.layer.textureService.getColorTexture(o,s);const l={u_domain:s,u_opacity:t||1,u_noDataValue:i,u_clampLow:r?1:0,u_clampHigh:(typeof n<"u"?n:r)?1:0,u_rasterTexture:this.texture,u_colorTexture:this.colorTexture};return this.textures=[this.texture,this.colorTexture],this.getUniformsBufferInfo(l)}getRasterData(t){return Oe(function*(){if(Array.isArray(t.data))return{data:t.data,width:t.width,height:t.height};{const{rasterData:r,width:n,height:i}=yield t.data;return{data:Array.from(r),width:n,height:i}}})()}initModels(){var t=this;return Oe(function*(){return t.buildModels()})()}buildModels(){var t=this;return Oe(function*(){t.initUniformsBuffer();const r=t.layer.getSource(),{createTexture2D:n,queryVerdorInfo:i}=t.rendererService,a=r.data.dataArray[0],{data:o,width:s,height:l}=yield t.getRasterData(a);return t.texture=n({data:new Float32Array(o),width:s,height:l,format:i()==="WebGL1"?K.LUMINANCE:K.RED,type:K.FLOAT,alignment:1}),[yield t.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:tkt,fragmentShader:JNt,defines:t.getDefines(),triangulation:qI,primitive:K.TRIANGLES,depth:{enable:!1},pickingEnabled:!1})]})()}clearModels(){var t,r;(t=this.texture)===null||t===void 0||t.destroy(),(r=this.colorTexture)===null||r===void 0||r.destroy()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Jr.Attribute,descriptor:{shaderLocation:this.attributeLocation.UV,name:"a_Uv",buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:(t,r,n)=>[n[3],n[4]]}})}};const ekt=["data"],rkt=["rasterData"],nkt=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
 vec2 u_rminmax;
 vec2 u_gminmax;
 vec2 u_bminmax;
 float u_opacity;
 float u_noDataValue;
};

in vec2 v_texCoord;

out vec4 outputColor;

void main() {

  vec3 rgb = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y)).rgb;

  if(rgb == vec3(u_noDataValue)) {
    outputColor = vec4(0.0, 0, 0, 0.0);
  } else {
    outputColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);
  }

  if(outputColor.a < 0.01)
    discard;
 
}`,ikt=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_rminmax;
  vec2 u_gminmax;
  vec2 u_bminmax;
  float u_opacity;
  float u_noDataValue;
};

out vec2 v_texCoord;

#pragma include "projection"

void main() {
  v_texCoord = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
}
`;class akt extends Ha{constructor(...t){super(...t),U(this,"texture",void 0),U(this,"dataOption",{})}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Ce(Ce({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{opacity:t=1,noDataValue:r=0}=this.layer.getLayerConfig(),{rMinMax:n=[0,255],gMinMax:i=[0,255],bMinMax:a=[0,255]}=this.dataOption,o={u_rminmax:n,u_gminmax:i,u_bminmax:a,u_opacity:t||1,u_noDataValue:r,u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(o)}getRasterData(t){var r=this;return Oe(function*(){if(Array.isArray(t.data)){const{data:o}=t,s=Gh(t,ekt);return r.dataOption=s,Ce({data:o},s)}const n=yield t.data,{rasterData:i}=n,a=Gh(n,rkt);return r.dataOption=a,Array.isArray(i)?Ce({data:i},a):Ce({data:Array.from(i)},a)})()}initModels(){var t=this;return Oe(function*(){t.initUniformsBuffer();const r=t.layer.getSource(),{createTexture2D:n}=t.rendererService,i=r.data.dataArray[0],{data:a,width:o,height:s}=yield t.getRasterData(i);return t.texture=n({data:new Float32Array(a),width:o,height:s,format:K.RGB,type:K.FLOAT}),[yield t.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:ikt,fragmentShader:nkt,defines:t.getDefines(),triangulation:qI,primitive:K.TRIANGLES,depth:{enable:!1},pickingEnabled:!1})]})()}buildModels(){var t=this;return Oe(function*(){return t.initModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Jr.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:(t,r,n)=>[n[3],n[4]]}})}}const okt=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

layout(std140) uniform commonUniforms {
 vec4 u_unpack;
 vec2 u_domain;
 float u_opacity;
 float u_noDataValue;
 float u_clampLow;
 float u_clampHigh;
};

in vec2 v_texCoord;
out vec4 outputColor;


float getElevation(vec2 coord, float bias) {
    // Convert encoded elevation value to meters
    vec4 data =  texture(SAMPLER_2D(u_texture), coord,bias) * 255.0;
    data.a = -1.0;
    return dot(data, u_unpack);
}

vec4 getColor(float value) {
   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec2 coord = vec2(normalisedValue, 0);
    return  texture(SAMPLER_2D(u_colorTexture), coord);
}

void main() {
  float value = getElevation(v_texCoord,0.0);
  if (value == u_noDataValue) {
    outputColor = vec4(0.0, 0, 0, 0.0);
  } else if ((u_clampLow < 0.5 && value < u_domain[0]) || (u_clampHigh < 0.5 && value > u_domain[1])) {
     outputColor = vec4(0.0, 0, 0, 0.0);
  } else {
   
    outputColor = getColor(value);
    outputColor.a =  outputColor.a * u_opacity ;
      if(outputColor.a < 0.01)
      discard;
  }
}
`,skt=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;
layout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec4 u_unpack;
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  float u_clampLow;
  float u_clampHigh;
};
out vec2 v_texCoord;
#pragma include "projection"

void main() {
  v_texCoord = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));
}
`;class lkt extends Ha{constructor(...t){super(...t),U(this,"texture",void 0)}get attributeLocation(){return Object.assign(super.attributeLocation,{MAX:super.attributeLocation.MAX,UV:9})}getCommonUniformsInfo(){const{opacity:t,clampLow:r=!0,clampHigh:n=!0,noDataValue:i=-9999999,domain:a,rampColors:o,colorTexture:s,rScaler:l=6553.6,gScaler:u=25.6,bScaler:c=.1,offset:f=1e4}=this.layer.getLayerConfig(),d=a||G5(o);let v=s;s?this.layer.textureService.setColorTexture(s,o,d):v=this.layer.textureService.getColorTexture(o,d);const g={u_unpack:[l,u,c,f],u_domain:d,u_opacity:t||1,u_noDataValue:i,u_clampLow:r,u_clampHigh:typeof n<"u"?n:r,u_texture:this.texture,u_colorTexture:v};return this.textures=[this.texture,v],this.getUniformsBufferInfo(g)}initModels(){var t=this;return Oe(function*(){t.initUniformsBuffer();const r=t.layer.getSource(),{createTexture2D:n}=t.rendererService,i=yield r.data.images;return t.texture=n({data:i[0],width:i[0].width,height:i[0].height,min:K.LINEAR,mag:K.LINEAR}),[yield t.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:skt,fragmentShader:okt,defines:t.getDefines(),triangulation:qI,primitive:K.TRIANGLES,depth:{enable:!1}})]})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}buildModels(){var t=this;return Oe(function*(){return t.initModels()})()}registerBuiltinAttributes(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Jr.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:K.DYNAMIC_DRAW,data:[],type:K.FLOAT},size:2,update:(t,r,n)=>[n[3],n[4]]}})}}const ukt={raster:G$,rasterRgb:akt,raster3d:G$,rasterTerrainRgb:lkt},ckt=ukt;class L4 extends L_{constructor(...t){super(...t),U(this,"type","RasterLayer")}buildModels(){var t=this;return Oe(function*(){const r=t.getModelType();t.layerModel=new ckt[r](t),yield t.initLayerModels()})()}getDefaultConfig(){const t=this.getModelType();return{raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}}[t]}getModelType(){switch(this.layerSource.getParserType()){case"raster":case"ndi":return"raster";case"rasterRgb":return"rasterRgb";case"rgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}getLegend(t){if(t!=="color")return{type:void 0,field:void 0,items:[]};const r=this.getLayerConfig().rampColors;return WJ(r,t)}}class hkt{constructor({rendererService:t,layerService:r,parent:n}){U(this,"tileResource",new Map),U(this,"rendererService",void 0),U(this,"layerService",void 0),U(this,"parent",void 0),U(this,"layerTiles",[]),this.rendererService=t,this.layerService=r,this.parent=n}get tiles(){return this.layerTiles}hasTile(t){return this.layerTiles.some(r=>r.key===t)}addTile(t){this.layerTiles.push(t)}getTile(t){return this.layerTiles.find(r=>r.key===t)}getVisibleTileBylngLat(t){return this.layerTiles.find(r=>r.isLoaded&&r.visible&&r.lnglatInBounds(t))}removeTile(t){const r=this.layerTiles.findIndex(i=>i.key===t),n=this.layerTiles.splice(r,1);n[0]&&n[0].destroy()}updateTileVisible(t){const r=this.getTile(t.key);if(t.isVisible)if(t.parent){const n=this.isChildrenLoaded(t.parent);r==null||r.updateVisible(n)}else r==null||r.updateVisible(!0);else if(t.parent){const n=this.isChildrenLoaded(t.parent);r==null||r.updateVisible(!n)}else r==null||r.updateVisible(!1)}isParentLoaded(t){const r=t.parent;if(!r)return!0;const n=this.getTile(r==null?void 0:r.key);return!!(n!=null&&n.isLoaded)}isChildrenLoaded(t){const r=t==null?void 0:t.children;return r.length===0?!0:r.every(n=>{const i=this.getTile(n==null?void 0:n.key);return i?(i==null?void 0:i.isLoaded)===!0:!0})}render(){var t=this;return Oe(function*(){const n=t.getRenderLayers().map(function(){var i=Oe(function*(a){yield t.layerService.renderTileLayer(a)});return function(a){return i.apply(this,arguments)}}());yield Promise.all(n)})()}getRenderLayers(){const t=this.layerTiles.filter(n=>n.visible&&n.isLoaded),r=[];return t.map(n=>r.push(...n.getLayers())),r}getLayers(){const t=this.layerTiles.filter(n=>n.isLoaded),r=[];return t.map(n=>r.push(...n.getLayers())),r}getTiles(){return this.layerTiles}destroy(){this.layerTiles.forEach(t=>t.destroy()),this.tileResource.clear()}}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function fkt(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(u){return function(c){return l([u,c])}}function l(u){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=u[0]&2?i.return:u[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,u[1])).done)return a;switch(i=0,a&&(u=[u[0]&2,a.value]),u[0]){case 0:case 1:a=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,i=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!a||u[1]>a[0]&&u[1]<a[3])){r.label=u[1];break}if(u[0]===6&&r.label<a[1]){r.label=a[1],a=u;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(u);break}a[2]&&r.ops.pop(),r.trys.pop();continue}u=t.call(e,r)}catch(c){u=[6,c],i=0}finally{n=a=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var r0=function(){function e(t,r){this.next=null,this.key=t,this.data=r,this.left=null,this.right=null}return e}();function dkt(e,t){return e>t?1:e<t?-1:0}function Fm(e,t,r){for(var n=new r0(null,null),i=n,a=n;;){var o=r(e,t.key);if(o<0){if(t.left===null)break;if(r(e,t.left.key)<0){var s=t.left;if(t.left=s.right,s.right=t,t=s,t.left===null)break}a.left=t,a=t,t=t.left}else if(o>0){if(t.right===null)break;if(r(e,t.right.key)>0){var s=t.right;if(t.right=s.left,s.left=t,t=s,t.right===null)break}i.right=t,i=t,t=t.right}else break}return i.right=t.left,a.left=t.right,t.left=n.right,t.right=n.left,t}function UO(e,t,r,n){var i=new r0(e,t);if(r===null)return i.left=i.right=null,i;r=Fm(e,r,n);var a=n(e,r.key);return a<0?(i.left=r.left,i.right=r,r.left=null):a>=0&&(i.right=r.right,i.left=r,r.right=null),i}function W$(e,t,r){var n=null,i=null;if(t){t=Fm(e,t,r);var a=r(t.key,e);a===0?(n=t.left,i=t.right):a<0?(i=t.right,t.right=null,n=t):(n=t.left,t.left=null,i=t)}return{left:n,right:i}}function pkt(e,t,r){return t===null?e:(e===null||(t=Fm(e.key,t,r),t.left=e),t)}function tF(e,t,r,n,i){if(e){n(""+t+(r?"└── ":"├── ")+i(e)+`
`);var a=t+(r?"    ":"│   ");e.left&&tF(e.left,a,!1,n,i),e.right&&tF(e.right,a,!0,n,i)}}var O4=function(){function e(t){t===void 0&&(t=dkt),this._root=null,this._size=0,this._comparator=t}return e.prototype.insert=function(t,r){return this._size++,this._root=UO(t,r,this._root,this._comparator)},e.prototype.add=function(t,r){var n=new r0(t,r);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,a=Fm(t,this._root,i),o=i(t,a.key);return o===0?this._root=a:(o<0?(n.left=a.left,n.right=a,a.left=null):o>0&&(n.right=a.right,n.left=a,a.right=null),this._size++,this._root=n),this._root},e.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},e.prototype._remove=function(t,r,n){var i;if(r===null)return null;r=Fm(t,r,n);var a=n(t,r.key);return a===0?(r.left===null?i=r.right:(i=Fm(t,r.left,n),i.right=r.right),this._size--,i):r},e.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=Fm(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},e.prototype.findStatic=function(t){for(var r=this._root,n=this._comparator;r;){var i=n(t,r.key);if(i===0)return r;i<0?r=r.left:r=r.right}return null},e.prototype.find=function(t){return this._root&&(this._root=Fm(t,this._root,this._comparator),this._comparator(t,this._root.key)!==0)?null:this._root},e.prototype.contains=function(t){for(var r=this._root,n=this._comparator;r;){var i=n(t,r.key);if(i===0)return!0;i<0?r=r.left:r=r.right}return!1},e.prototype.forEach=function(t,r){for(var n=this._root,i=[],a=!1;!a;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),t.call(r,n),n=n.right):a=!0;return this},e.prototype.range=function(t,r,n,i){for(var a=[],o=this._comparator,s=this._root,l;a.length!==0||s;)if(s)a.push(s),s=s.left;else{if(s=a.pop(),l=o(s.key,r),l>0)break;if(o(s.key,t)>=0&&n.call(i,s))return this;s=s.right}return this},e.prototype.keys=function(){var t=[];return this.forEach(function(r){var n=r.key;return t.push(n)}),t},e.prototype.values=function(){var t=[];return this.forEach(function(r){var n=r.data;return t.push(n)}),t},e.prototype.min=function(){return this._root?this.minNode(this._root).key:null},e.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},e.prototype.minNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.left;)t=t.left;return t},e.prototype.maxNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.right;)t=t.right;return t},e.prototype.at=function(t){for(var r=this._root,n=!1,i=0,a=[];!n;)if(r)a.push(r),r=r.left;else if(a.length>0){if(r=a.pop(),i===t)return r;i++,r=r.right}else n=!0;return null},e.prototype.next=function(t){var r=this._root,n=null;if(t.right){for(n=t.right;n.left;)n=n.left;return n}for(var i=this._comparator;r;){var a=i(t.key,r.key);if(a===0)break;a<0?(n=r,r=r.left):r=r.right}return n},e.prototype.prev=function(t){var r=this._root,n=null;if(t.left!==null){for(n=t.left;n.right;)n=n.right;return n}for(var i=this._comparator;r;){var a=i(t.key,r.key);if(a===0)break;a<0?r=r.left:(n=r,r=r.right)}return n},e.prototype.clear=function(){return this._root=null,this._size=0,this},e.prototype.toList=function(){return gkt(this._root)},e.prototype.load=function(t,r,n){r===void 0&&(r=[]),n===void 0&&(n=!1);var i=t.length,a=this._comparator;if(n&&nF(t,r,0,i-1,a),this._root===null)this._root=eF(t,r,0,i),this._size=i;else{var o=mkt(this.toList(),vkt(t,r),a);i=this._size+i,this._root=rF({head:o},0,i)}return this},e.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),e.prototype.toString=function(t){t===void 0&&(t=function(n){return String(n.key)});var r=[];return tF(this._root,"",!0,function(n){return r.push(n)},t),r.join("")},e.prototype.update=function(t,r,n){var i=this._comparator,a=W$(t,this._root,i),o=a.left,s=a.right;i(t,r)<0?s=UO(r,n,s,i):o=UO(r,n,o,i),this._root=pkt(o,s,i)},e.prototype.split=function(t){return W$(t,this._root,this._comparator)},e.prototype[Symbol.iterator]=function(){var t,r,n;return fkt(this,function(i){switch(i.label){case 0:t=this._root,r=[],n=!1,i.label=1;case 1:return n?[3,6]:t===null?[3,2]:(r.push(t),t=t.left,[3,5]);case 2:return r.length===0?[3,4]:(t=r.pop(),[4,t]);case 3:return i.sent(),t=t.right,[3,5];case 4:n=!0,i.label=5;case 5:return[3,1];case 6:return[2]}})},e}();function eF(e,t,r,n){var i=n-r;if(i>0){var a=r+Math.floor(i/2),o=e[a],s=t[a],l=new r0(o,s);return l.left=eF(e,t,r,a),l.right=eF(e,t,a+1,n),l}return null}function vkt(e,t){for(var r=new r0(null,null),n=r,i=0;i<e.length;i++)n=n.next=new r0(e[i],t[i]);return n.next=null,r.next}function gkt(e){for(var t=e,r=[],n=!1,i=new r0(null,null),a=i;!n;)t?(r.push(t),t=t.left):r.length>0?(t=a=a.next=r.pop(),t=t.right):n=!0;return a.next=null,i.next}function rF(e,t,r){var n=r-t;if(n>0){var i=t+Math.floor(n/2),a=rF(e,t,i),o=e.head;return o.left=a,e.head=e.head.next,o.right=rF(e,i+1,r),o}return null}function mkt(e,t,r){for(var n=new r0(null,null),i=n,a=e,o=t;a!==null&&o!==null;)r(a.key,o.key)<0?(i.next=a,a=a.next):(i.next=o,o=o.next),i=i.next;return a!==null?i.next=a:o!==null&&(i.next=o),n.next}function nF(e,t,r,n,i){if(!(r>=n)){for(var a=e[r+n>>1],o=r-1,s=n+1;;){do o++;while(i(e[o],a)<0);do s--;while(i(e[s],a)>0);if(o>=s)break;var l=e[o];e[o]=e[s],e[s]=l,l=t[o],t[o]=t[s],t[s]=l}nF(e,t,r,s,i),nF(e,t,s+1,n,i)}}const pg=11102230246251565e-32,Ou=134217729,ykt=(3+8*pg)*pg;function $O(e,t,r,n,i){let a,o,s,l,u=t[0],c=n[0],f=0,d=0;c>u==c>-u?(a=u,u=t[++f]):(a=c,c=n[++d]);let v=0;if(f<e&&d<r)for(c>u==c>-u?(o=u+a,s=a-(o-u),u=t[++f]):(o=c+a,s=a-(o-c),c=n[++d]),a=o,s!==0&&(i[v++]=s);f<e&&d<r;)c>u==c>-u?(o=a+u,l=o-a,s=a-(o-l)+(u-l),u=t[++f]):(o=a+c,l=o-a,s=a-(o-l)+(c-l),c=n[++d]),a=o,s!==0&&(i[v++]=s);for(;f<e;)o=a+u,l=o-a,s=a-(o-l)+(u-l),u=t[++f],a=o,s!==0&&(i[v++]=s);for(;d<r;)o=a+c,l=o-a,s=a-(o-l)+(c-l),c=n[++d],a=o,s!==0&&(i[v++]=s);return(a!==0||v===0)&&(i[v++]=a),v}function _kt(e,t){let r=t[0];for(let n=1;n<e;n++)r+=t[n];return r}function $S(e){return new Float64Array(e)}const xkt=(3+16*pg)*pg,bkt=(2+12*pg)*pg,Ekt=(9+64*pg)*pg*pg,N1=$S(4),X$=$S(8),j$=$S(12),Y$=$S(16),tc=$S(4);function wkt(e,t,r,n,i,a,o){let s,l,u,c,f,d,v,g,x,w,S,M,R,I,P,k,z,G;const J=e-i,Z=r-i,X=t-a,et=n-a;I=J*et,d=Ou*J,v=d-(d-J),g=J-v,d=Ou*et,x=d-(d-et),w=et-x,P=g*w-(I-v*x-g*x-v*w),k=X*Z,d=Ou*X,v=d-(d-X),g=X-v,d=Ou*Z,x=d-(d-Z),w=Z-x,z=g*w-(k-v*x-g*x-v*w),S=P-z,f=P-S,N1[0]=P-(S+f)+(f-z),M=I+S,f=M-I,R=I-(M-f)+(S-f),S=R-k,f=R-S,N1[1]=R-(S+f)+(f-k),G=M+S,f=G-M,N1[2]=M-(G-f)+(S-f),N1[3]=G;let at=_kt(4,N1),wt=bkt*o;if(at>=wt||-at>=wt||(f=e-J,s=e-(J+f)+(f-i),f=r-Z,u=r-(Z+f)+(f-i),f=t-X,l=t-(X+f)+(f-a),f=n-et,c=n-(et+f)+(f-a),s===0&&l===0&&u===0&&c===0)||(wt=Ekt*o+ykt*Math.abs(at),at+=J*c+et*s-(X*u+Z*l),at>=wt||-at>=wt))return at;I=s*et,d=Ou*s,v=d-(d-s),g=s-v,d=Ou*et,x=d-(d-et),w=et-x,P=g*w-(I-v*x-g*x-v*w),k=l*Z,d=Ou*l,v=d-(d-l),g=l-v,d=Ou*Z,x=d-(d-Z),w=Z-x,z=g*w-(k-v*x-g*x-v*w),S=P-z,f=P-S,tc[0]=P-(S+f)+(f-z),M=I+S,f=M-I,R=I-(M-f)+(S-f),S=R-k,f=R-S,tc[1]=R-(S+f)+(f-k),G=M+S,f=G-M,tc[2]=M-(G-f)+(S-f),tc[3]=G;const Tt=$O(4,N1,4,tc,X$);I=J*c,d=Ou*J,v=d-(d-J),g=J-v,d=Ou*c,x=d-(d-c),w=c-x,P=g*w-(I-v*x-g*x-v*w),k=X*u,d=Ou*X,v=d-(d-X),g=X-v,d=Ou*u,x=d-(d-u),w=u-x,z=g*w-(k-v*x-g*x-v*w),S=P-z,f=P-S,tc[0]=P-(S+f)+(f-z),M=I+S,f=M-I,R=I-(M-f)+(S-f),S=R-k,f=R-S,tc[1]=R-(S+f)+(f-k),G=M+S,f=G-M,tc[2]=M-(G-f)+(S-f),tc[3]=G;const vt=$O(Tt,X$,4,tc,j$);I=s*c,d=Ou*s,v=d-(d-s),g=s-v,d=Ou*c,x=d-(d-c),w=c-x,P=g*w-(I-v*x-g*x-v*w),k=l*u,d=Ou*l,v=d-(d-l),g=l-v,d=Ou*u,x=d-(d-u),w=u-x,z=g*w-(k-v*x-g*x-v*w),S=P-z,f=P-S,tc[0]=P-(S+f)+(f-z),M=I+S,f=M-I,R=I-(M-f)+(S-f),S=R-k,f=R-S,tc[1]=R-(S+f)+(f-k),G=M+S,f=G-M,tc[2]=M-(G-f)+(S-f),tc[3]=G;const zt=$O(vt,j$,4,tc,Y$);return Y$[zt-1]}function Ckt(e,t,r,n,i,a){const o=(t-a)*(r-i),s=(e-i)*(n-a),l=o-s,u=Math.abs(o+s);return Math.abs(l)>=xkt*u?l:-wkt(e,t,r,n,i,a,u)}const JE=(e,t)=>e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y,iF=(e,t)=>{if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;const r=e.ll.x<t.ll.x?t.ll.x:e.ll.x,n=e.ur.x<t.ur.x?e.ur.x:t.ur.x,i=e.ll.y<t.ll.y?t.ll.y:e.ll.y,a=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:r,y:i},ur:{x:n,y:a}}};let zm=Number.EPSILON;zm===void 0&&(zm=Math.pow(2,-52));const Skt=zm*zm,Z$=(e,t)=>{if(-zm<e&&e<zm&&-zm<t&&t<zm)return 0;const r=e-t;return r*r<Skt*e*t?0:e<t?-1:1};class Tkt{constructor(){this.reset()}reset(){this.xRounder=new q$,this.yRounder=new q$}round(t,r){return{x:this.xRounder.round(t),y:this.yRounder.round(r)}}}class q${constructor(){this.tree=new O4,this.round(0)}round(t){const r=this.tree.add(t),n=this.tree.prev(r);if(n!==null&&Z$(r.key,n.key)===0)return this.tree.remove(t),n.key;const i=this.tree.next(r);return i!==null&&Z$(r.key,i.key)===0?(this.tree.remove(t),i.key):t}}const FC=new Tkt,iM=(e,t)=>e.x*t.y-e.y*t.x,ett=(e,t)=>e.x*t.x+e.y*t.y,K$=(e,t,r)=>{const n=Ckt(e.x,e.y,t.x,t.y,r.x,r.y);return n>0?-1:n<0?1:0},hR=e=>Math.sqrt(ett(e,e)),Akt=(e,t,r)=>{const n={x:t.x-e.x,y:t.y-e.y},i={x:r.x-e.x,y:r.y-e.y};return iM(i,n)/hR(i)/hR(n)},Mkt=(e,t,r)=>{const n={x:t.x-e.x,y:t.y-e.y},i={x:r.x-e.x,y:r.y-e.y};return ett(i,n)/hR(i)/hR(n)},Q$=(e,t,r)=>t.y===0?null:{x:e.x+t.x/t.y*(r-e.y),y:r},J$=(e,t,r)=>t.x===0?null:{x:r,y:e.y+t.y/t.x*(r-e.x)},Rkt=(e,t,r,n)=>{if(t.x===0)return J$(r,n,e.x);if(n.x===0)return J$(e,t,r.x);if(t.y===0)return Q$(r,n,e.y);if(n.y===0)return Q$(e,t,r.y);const i=iM(t,n);if(i==0)return null;const a={x:r.x-e.x,y:r.y-e.y},o=iM(a,t)/i,s=iM(a,n)/i,l=e.x+s*t.x,u=r.x+o*n.x,c=e.y+s*t.y,f=r.y+o*n.y,d=(l+u)/2,v=(c+f)/2;return{x:d,y:v}};class Bf{static compare(t,r){const n=Bf.comparePoints(t.point,r.point);return n!==0?n:(t.point!==r.point&&t.link(r),t.isLeft!==r.isLeft?t.isLeft?1:-1:Xm.compare(t.segment,r.segment))}static comparePoints(t,r){return t.x<r.x?-1:t.x>r.x?1:t.y<r.y?-1:t.y>r.y?1:0}constructor(t,r){t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=r}link(t){if(t.point===this.point)throw new Error("Tried to link already linked events");const r=t.point.events;for(let n=0,i=r.length;n<i;n++){const a=r[n];this.point.events.push(a),a.point=this.point}this.checkForConsuming()}checkForConsuming(){const t=this.point.events.length;for(let r=0;r<t;r++){const n=this.point.events[r];if(n.segment.consumedBy===void 0)for(let i=r+1;i<t;i++){const a=this.point.events[i];a.consumedBy===void 0&&n.otherSE.point.events===a.otherSE.point.events&&n.segment.consume(a.segment)}}}getAvailableLinkedEvents(){const t=[];for(let r=0,n=this.point.events.length;r<n;r++){const i=this.point.events[r];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&t.push(i)}return t}getLeftmostComparator(t){const r=new Map,n=i=>{const a=i.otherSE;r.set(i,{sine:Akt(this.point,t.point,a.point),cosine:Mkt(this.point,t.point,a.point)})};return(i,a)=>{r.has(i)||n(i),r.has(a)||n(a);const{sine:o,cosine:s}=r.get(i),{sine:l,cosine:u}=r.get(a);return o>=0&&l>=0?s<u?1:s>u?-1:0:o<0&&l<0?s<u?-1:s>u?1:0:l<o?-1:l>o?1:0}}}let Ikt=0;class Xm{static compare(t,r){const n=t.leftSE.point.x,i=r.leftSE.point.x,a=t.rightSE.point.x,o=r.rightSE.point.x;if(o<n)return 1;if(a<i)return-1;const s=t.leftSE.point.y,l=r.leftSE.point.y,u=t.rightSE.point.y,c=r.rightSE.point.y;if(n<i){if(l<s&&l<u)return 1;if(l>s&&l>u)return-1;const f=t.comparePoint(r.leftSE.point);if(f<0)return 1;if(f>0)return-1;const d=r.comparePoint(t.rightSE.point);return d!==0?d:-1}if(n>i){if(s<l&&s<c)return-1;if(s>l&&s>c)return 1;const f=r.comparePoint(t.leftSE.point);if(f!==0)return f;const d=t.comparePoint(r.rightSE.point);return d<0?1:d>0?-1:1}if(s<l)return-1;if(s>l)return 1;if(a<o){const f=r.comparePoint(t.rightSE.point);if(f!==0)return f}if(a>o){const f=t.comparePoint(r.rightSE.point);if(f<0)return 1;if(f>0)return-1}if(a!==o){const f=u-s,d=a-n,v=c-l,g=o-i;if(f>d&&v<g)return 1;if(f<d&&v>g)return-1}return a>o?1:a<o||u<c?-1:u>c?1:t.id<r.id?-1:t.id>r.id?1:0}constructor(t,r,n,i){this.id=++Ikt,this.leftSE=t,t.segment=this,t.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=t,this.rings=n,this.windings=i}static fromRing(t,r,n){let i,a,o;const s=Bf.comparePoints(t,r);if(s<0)i=t,a=r,o=1;else if(s>0)i=r,a=t,o=-1;else throw new Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);const l=new Bf(i,!0),u=new Bf(a,!1);return new Xm(l,u,[n],[o])}replaceRightSE(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const t=this.leftSE.point.y,r=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<r?t:r},ur:{x:this.rightSE.point.x,y:t>r?t:r}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}comparePoint(t){if(this.isAnEndpoint(t))return 0;const r=this.leftSE.point,n=this.rightSE.point,i=this.vector();if(r.x===n.x)return t.x===r.x?0:t.x<r.x?1:-1;const a=(t.y-r.y)/i.y,o=r.x+a*i.x;if(t.x===o)return 0;const s=(t.x-r.x)/i.x,l=r.y+s*i.y;return t.y===l?0:t.y<l?-1:1}getIntersection(t){const r=this.bbox(),n=t.bbox(),i=iF(r,n);if(i===null)return null;const a=this.leftSE.point,o=this.rightSE.point,s=t.leftSE.point,l=t.rightSE.point,u=JE(r,s)&&this.comparePoint(s)===0,c=JE(n,a)&&t.comparePoint(a)===0,f=JE(r,l)&&this.comparePoint(l)===0,d=JE(n,o)&&t.comparePoint(o)===0;if(c&&u)return d&&!f?o:!d&&f?l:null;if(c)return f&&a.x===l.x&&a.y===l.y?null:a;if(u)return d&&o.x===s.x&&o.y===s.y?null:s;if(d&&f)return null;if(d)return o;if(f)return l;const v=Rkt(a,this.vector(),s,t.vector());return v===null||!JE(i,v)?null:FC.round(v.x,v.y)}split(t){const r=[],n=t.events!==void 0,i=new Bf(t,!0),a=new Bf(t,!1),o=this.rightSE;this.replaceRightSE(a),r.push(a),r.push(i);const s=new Xm(i,o,this.rings.slice(),this.windings.slice());return Bf.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),Bf.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(i.checkForConsuming(),a.checkForConsuming()),r}swapEvents(){const t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let r=0,n=this.windings.length;r<n;r++)this.windings[r]*=-1}consume(t){let r=this,n=t;for(;r.consumedBy;)r=r.consumedBy;for(;n.consumedBy;)n=n.consumedBy;const i=Xm.compare(r,n);if(i!==0){if(i>0){const a=r;r=n,n=a}if(r.prev===n){const a=r;r=n,n=a}for(let a=0,o=n.rings.length;a<o;a++){const s=n.rings[a],l=n.windings[a],u=r.rings.indexOf(s);u===-1?(r.rings.push(s),r.windings.push(l)):r.windings[u]+=l}n.rings=null,n.windings=null,n.consumedBy=r,n.leftSE.consumedBy=r.leftSE,n.rightSE.consumedBy=r.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};const r=this._afterState.rings,n=this._afterState.windings,i=this._afterState.multiPolys;for(let s=0,l=this.rings.length;s<l;s++){const u=this.rings[s],c=this.windings[s],f=r.indexOf(u);f===-1?(r.push(u),n.push(c)):n[f]+=c}const a=[],o=[];for(let s=0,l=r.length;s<l;s++){if(n[s]===0)continue;const u=r[s],c=u.poly;if(o.indexOf(c)===-1)if(u.isExterior)a.push(c);else{o.indexOf(c)===-1&&o.push(c);const f=a.indexOf(u.poly);f!==-1&&a.splice(f,1)}}for(let s=0,l=a.length;s<l;s++){const u=a[s].multiPoly;i.indexOf(u)===-1&&i.push(u)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const t=this.beforeState().multiPolys,r=this.afterState().multiPolys;switch(Bd.type){case"union":{const n=t.length===0,i=r.length===0;this._isInResult=n!==i;break}case"intersection":{let n,i;t.length<r.length?(n=t.length,i=r.length):(n=r.length,i=t.length),this._isInResult=i===Bd.numMultiPolys&&n<i;break}case"xor":{const n=Math.abs(t.length-r.length);this._isInResult=n%2===1;break}case"difference":{const n=i=>i.length===1&&i[0].isSubject;this._isInResult=n(t)!==n(r);break}default:throw new Error(`Unrecognized operation type found ${Bd.type}`)}return this._isInResult}}class tH{constructor(t,r,n){if(!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=r,this.isExterior=n,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const i=FC.round(t[0][0],t[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let a=i;for(let o=1,s=t.length;o<s;o++){if(typeof t[o][0]!="number"||typeof t[o][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let l=FC.round(t[o][0],t[o][1]);l.x===a.x&&l.y===a.y||(this.segments.push(Xm.fromRing(a,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),a=l)}(i.x!==a.x||i.y!==a.y)&&this.segments.push(Xm.fromRing(a,i,this))}getSweepEvents(){const t=[];for(let r=0,n=this.segments.length;r<n;r++){const i=this.segments[r];t.push(i.leftSE),t.push(i.rightSE)}return t}}class Lkt{constructor(t,r){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new tH(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,i=t.length;n<i;n++){const a=new tH(t[n],this,!1);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.interiorRings.push(a)}this.multiPoly=r}getSweepEvents(){const t=this.exteriorRing.getSweepEvents();for(let r=0,n=this.interiorRings.length;r<n;r++){const i=this.interiorRings[r].getSweepEvents();for(let a=0,o=i.length;a<o;a++)t.push(i[a])}return t}}class eH{constructor(t,r){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let n=0,i=t.length;n<i;n++){const a=new Lkt(t[n],this);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.polys.push(a)}this.isSubject=r}getSweepEvents(){const t=[];for(let r=0,n=this.polys.length;r<n;r++){const i=this.polys[r].getSweepEvents();for(let a=0,o=i.length;a<o;a++)t.push(i[a])}return t}}class fR{static factory(t){const r=[];for(let n=0,i=t.length;n<i;n++){const a=t[n];if(!a.isInResult()||a.ringOut)continue;let o=null,s=a.leftSE,l=a.rightSE;const u=[s],c=s.point,f=[];for(;o=s,s=l,u.push(s),s.point!==c;)for(;;){const d=s.getAvailableLinkedEvents();if(d.length===0){const x=u[0].point,w=u[u.length-1].point;throw new Error(`Unable to complete output ring starting at [${x.x}, ${x.y}]. Last matching segment found ends at [${w.x}, ${w.y}].`)}if(d.length===1){l=d[0].otherSE;break}let v=null;for(let x=0,w=f.length;x<w;x++)if(f[x].point===s.point){v=x;break}if(v!==null){const x=f.splice(v)[0],w=u.splice(x.index);w.unshift(w[0].otherSE),r.push(new fR(w.reverse()));continue}f.push({index:u.length,point:s.point});const g=s.getLeftmostComparator(o);l=d.sort(g)[0].otherSE;break}r.push(new fR(u))}return r}constructor(t){this.events=t;for(let r=0,n=t.length;r<n;r++)t[r].segment.ringOut=this;this.poly=null}getGeom(){let t=this.events[0].point;const r=[t];for(let u=1,c=this.events.length-1;u<c;u++){const f=this.events[u].point,d=this.events[u+1].point;K$(f,t,d)!==0&&(r.push(f),t=f)}if(r.length===1)return null;const n=r[0],i=r[1];K$(n,t,i)===0&&r.shift(),r.push(r[0]);const a=this.isExteriorRing()?1:-1,o=this.isExteriorRing()?0:r.length-1,s=this.isExteriorRing()?r.length:-1,l=[];for(let u=o;u!=s;u+=a)l.push([r[u].x,r[u].y]);return l}isExteriorRing(){if(this._isExteriorRing===void 0){const t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let t=this.events[0];for(let i=1,a=this.events.length;i<a;i++){const o=this.events[i];Bf.compare(t,o)>0&&(t=o)}let r=t.segment.prevInResult(),n=r?r.prevInResult():null;for(;;){if(!r)return null;if(!n)return r.ringOut;if(n.ringOut!==r.ringOut)return n.ringOut.enclosingRing()!==r.ringOut?r.ringOut:r.ringOut.enclosingRing();r=n.prevInResult(),n=r?r.prevInResult():null}}}class rH{constructor(t){this.exteriorRing=t,t.poly=this,this.interiorRings=[]}addInterior(t){this.interiorRings.push(t),t.poly=this}getGeom(){const t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(let r=0,n=this.interiorRings.length;r<n;r++){const i=this.interiorRings[r].getGeom();i!==null&&t.push(i)}return t}}class Okt{constructor(t){this.rings=t,this.polys=this._composePolys(t)}getGeom(){const t=[];for(let r=0,n=this.polys.length;r<n;r++){const i=this.polys[r].getGeom();i!==null&&t.push(i)}return t}_composePolys(t){const r=[];for(let n=0,i=t.length;n<i;n++){const a=t[n];if(!a.poly)if(a.isExteriorRing())r.push(new rH(a));else{const o=a.enclosingRing();o.poly||r.push(new rH(o)),o.poly.addInterior(a)}}return r}}class Pkt{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Xm.compare;this.queue=t,this.tree=new O4(r),this.segments=[]}process(t){const r=t.segment,n=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(r),n;const i=t.isLeft?this.tree.add(r):this.tree.find(r);if(!i)throw new Error(`Unable to find segment #${r.id} [${r.leftSE.point.x}, ${r.leftSE.point.y}] -> [${r.rightSE.point.x}, ${r.rightSE.point.y}] in SweepLine tree.`);let a=i,o=i,s,l;for(;s===void 0;)a=this.tree.prev(a),a===null?s=null:a.key.consumedBy===void 0&&(s=a.key);for(;l===void 0;)o=this.tree.next(o),o===null?l=null:o.key.consumedBy===void 0&&(l=o.key);if(t.isLeft){let u=null;if(s){const f=s.getIntersection(r);if(f!==null&&(r.isAnEndpoint(f)||(u=f),!s.isAnEndpoint(f))){const d=this._splitSafely(s,f);for(let v=0,g=d.length;v<g;v++)n.push(d[v])}}let c=null;if(l){const f=l.getIntersection(r);if(f!==null&&(r.isAnEndpoint(f)||(c=f),!l.isAnEndpoint(f))){const d=this._splitSafely(l,f);for(let v=0,g=d.length;v<g;v++)n.push(d[v])}}if(u!==null||c!==null){let f=null;u===null?f=c:c===null?f=u:f=Bf.comparePoints(u,c)<=0?u:c,this.queue.remove(r.rightSE),n.push(r.rightSE);const d=r.split(f);for(let v=0,g=d.length;v<g;v++)n.push(d[v])}n.length>0?(this.tree.remove(r),n.push(t)):(this.segments.push(r),r.prev=s)}else{if(s&&l){const u=s.getIntersection(l);if(u!==null){if(!s.isAnEndpoint(u)){const c=this._splitSafely(s,u);for(let f=0,d=c.length;f<d;f++)n.push(c[f])}if(!l.isAnEndpoint(u)){const c=this._splitSafely(l,u);for(let f=0,d=c.length;f<d;f++)n.push(c[f])}}}this.tree.remove(r)}return n}_splitSafely(t,r){this.tree.remove(t);const n=t.rightSE;this.queue.remove(n);const i=t.split(r);return i.push(n),t.consumedBy===void 0&&this.tree.add(t),i}}const nH=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Dkt=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class Fkt{run(t,r,n){Bd.type=t,FC.reset();const i=[new eH(r,!0)];for(let f=0,d=n.length;f<d;f++)i.push(new eH(n[f],!1));if(Bd.numMultiPolys=i.length,Bd.type==="difference"){const f=i[0];let d=1;for(;d<i.length;)iF(i[d].bbox,f.bbox)!==null?d++:i.splice(d,1)}if(Bd.type==="intersection")for(let f=0,d=i.length;f<d;f++){const v=i[f];for(let g=f+1,x=i.length;g<x;g++)if(iF(v.bbox,i[g].bbox)===null)return[]}const a=new O4(Bf.compare);for(let f=0,d=i.length;f<d;f++){const v=i[f].getSweepEvents();for(let g=0,x=v.length;g<x;g++)if(a.insert(v[g]),a.size>nH)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const o=new Pkt(a);let s=a.size,l=a.pop();for(;l;){const f=l.key;if(a.size===s){const v=f.segment;throw new Error(`Unable to pop() ${f.isLeft?"left":"right"} SweepEvent [${f.point.x}, ${f.point.y}] from segment #${v.id} [${v.leftSE.point.x}, ${v.leftSE.point.y}] -> [${v.rightSE.point.x}, ${v.rightSE.point.y}] from queue.`)}if(a.size>nH)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(o.segments.length>Dkt)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const d=o.process(f);for(let v=0,g=d.length;v<g;v++){const x=d[v];x.consumedBy===void 0&&a.insert(x)}s=a.size,l=a.pop()}FC.reset();const u=fR.factory(o.segments);return new Okt(u).getGeom()}}const Bd=new Fkt,Bkt=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return Bd.run("union",e,r)},Nkt=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return Bd.run("intersection",e,r)},kkt=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return Bd.run("xor",e,r)},zkt=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return Bd.run("difference",e,r)};var Ukt={union:Bkt,intersection:Nkt,xor:kkt,difference:zkt};function $kt(e,t,r){r===void 0&&(r={});var n=B7(e),i=B7(t),a=Ukt.union(n.coordinates,i.coordinates);return a.length===0?null:a.length===1?B5(a[0],r.properties):ddt(a,r.properties)}class Hkt{getCombineFeature(t){let r=null;const n=t[0];return t.map(i=>{const a=B5(i.coordinates);r===null?r=a:r=$kt(r,a)}),n&&(r.properties=Ce({},n)),r}}const tw="select",ew="active";class Vkt{constructor({layerService:t,tileLayerService:r,parent:n}){U(this,"layerService",void 0),U(this,"tileLayerService",void 0),U(this,"tileSourceService",void 0),U(this,"parent",void 0),U(this,"tilePickID",new Map),this.layerService=t,this.tileLayerService=r,this.parent=n,this.tileSourceService=new Hkt}pickRender(t){const r=this.tileLayerService.getVisibleTileBylngLat(t.lngLat);if(r){const n=r.getMainLayer();n==null||n.layerPickService.pickRender(t)}}pick(t,r){var n=this;return Oe(function*(){const a=n.parent.getContainer().pickingService;if(t.type==="RasterLayer"){const o=n.tileLayerService.getVisibleTileBylngLat(r.lngLat);if(o&&o.getMainLayer()!==void 0){const s=o.getMainLayer();return s.layerPickService.pickRasterLayer(s,r,n.parent)}return!1}return n.pickRender(r),a.pickFromPickingFBO(t,r)})()}selectFeature(t){const[r,n,i]=t,a=this.color2PickId(r,n,i);this.tilePickID.set(tw,a),this.updateHighLight(r,n,i,tw)}highlightPickedFeature(t){const[r,n,i]=t,a=this.color2PickId(r,n,i);this.tilePickID.set(ew,a),this.updateHighLight(r,n,i,ew)}updateHighLight(t,r,n,i){this.tileLayerService.tiles.map(a=>{const o=a.getMainLayer();switch(i){case tw:o==null||o.hooks.beforeSelect.call([t,r,n]);break;case ew:o==null||o.hooks.beforeHighlight.call([t,r,n]);break}})}setPickState(){const t=this.tilePickID.get(tw),r=this.tilePickID.get(ew);if(t){const[n,i,a]=this.pickId2Color(t);this.updateHighLight(n,i,a,tw);return}if(r){const[n,i,a]=this.pickId2Color(r);this.updateHighLight(n,i,a,ew);return}}color2PickId(t,r,n){return Uy(new Uint8Array([t,r,n]))}pickId2Color(t){return $x(t)}getFeatureById(t){const r=this.tileLayerService.getTiles().filter(i=>i.visible),n=[];return r.forEach(i=>{n.push(...i.getFeatureById(t))}),n}pickRasterLayer(){return!1}}function Gkt(e){return e==="PolygonLayer"?cR:e==="LineLayer"?Cx:DC}function Wkt(e){return["PolygonLayer","LineLayer"].indexOf(e)!==-1}class O_ extends Gu.EventEmitter{constructor(t,r){super(),U(this,"x",void 0),U(this,"y",void 0),U(this,"z",void 0),U(this,"key",void 0),U(this,"parent",void 0),U(this,"sourceTile",void 0),U(this,"visible",!0),U(this,"layers",[]),U(this,"isLoaded",!1),U(this,"tileMaskLayers",[]),U(this,"tileMask",void 0),this.parent=r,this.sourceTile=t,this.x=t.x,this.y=t.y,this.z=t.z,this.key=`${this.x}_${this.y}_${this.z}`}getLayers(){return this.layers}styleUpdate(...t){}lnglatInBounds(t){const[r,n,i,a]=this.sourceTile.bounds,{lng:o,lat:s}=t;return o>=r&&o<=i&&s>=n&&s<=a}getLayerOptions(){var t;const r=this.parent.getLayerConfig();return Ce(Ce({},r),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:Wkt(this.parent.type),mask:r.mask||((t=r.maskLayers)===null||t===void 0?void 0:t.length)!==0&&r.enableMask})}getMaskLayer(){const{maskLayers:t}=this.parent.getLayerConfig(),r=[];return t==null||t.forEach(n=>{if(!n.tileLayer)return r.push(n),n;const a=n.tileLayer.getTile(this.sourceTile.key),o=a==null?void 0:a.getLayers()[0];o&&r.push(o)}),r}addTileMask(){var t=this;return Oe(function*(){const r=new cR({name:"mask",visible:!0,enablePicking:!1}).source({type:"FeatureCollection",features:[t.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill").color("#0f0").style({opacity:.5}),n=Zw(t.parent.container);r.setContainer(n),yield r.init(),t.tileMask=r;const i=t.getMainLayer();return i!==void 0&&(i.tileMask=r),r})()}addMask(t,r){var n=this;return Oe(function*(){const i=Zw(n.parent.container);r.setContainer(i),yield r.init(),t.addMask(r),n.tileMaskLayers.push(r)})()}addLayer(t){var r=this;return Oe(function*(){t.isTileLayer=!0;const n=Zw(r.parent.container);t.setContainer(n),r.layers.push(t),yield t.init()})()}updateVisible(t){this.visible=t,this.updateOptions("visible",t)}updateOptions(t,r){this.layers.forEach(n=>{n.updateLayerConfig({[t]:r})})}getMainLayer(){return this.layers[0]}getFeatures(t){return[]}getFeatureById(t){return[]}destroy(){var t;(t=this.tileMask)===null||t===void 0||t.destroy(),this.layers.forEach(r=>r.destroy())}}class Xkt extends O_{initTileLayer(){var t=this;return Oe(function*(){const r=t.getSourceOption(),n=r.data.features[0].properties,i=new Cx().source(r.data,r.options).size(1).shape("line").color("red"),a=new DC({minZoom:t.z-1,maxZoom:t.z+1,textAllowOverlap:!0}).source([n],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(t.key).style({stroke:"#fff",strokeWidth:2});yield t.addLayer(i),yield t.addLayer(a),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource();return{data:{type:"FeatureCollection",features:this.sourceTile.data.layers.testTile.features},options:{parser:{type:"geojson"},transforms:t.transforms}}}}class jkt extends O_{initTileLayer(){var t=this;return Oe(function*(){const r=t.parent.getLayerAttributeConfig(),n=t.getLayerOptions(),i=t.getSourceOption(),a=new v4t(Ce({},n)).source(i.data,i.options);r&&Object.keys(r).forEach(o=>{var s,l;const u=o;a[u]((s=r[u])===null||s===void 0?void 0:s.field,(l=r[u])===null||l===void 0?void 0:l.values)}),yield t.addLayer(a),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}const Ykt=`layout(std140) uniform commonUniorm {
  vec4 u_color;
  float u_opacity;
};

out vec4 outputColor;

void main() {
  outputColor = u_color;
  outputColor.a *= u_opacity;
}
`,Zkt=`layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;

layout(std140) uniform commonUniorm {
  vec4 u_color;
  float u_opacity;
};

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
}

`;class qkt extends Ha{getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Ce(Ce({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{opacity:t=1,color:r="#000"}=this.layer.getLayerConfig(),n={u_color:eo(r),u_opacity:t||1};return this.getUniformsBufferInfo(n)}initModels(){var t=this;return Oe(function*(){return t.buildModels()})()}buildModels(){var t=this;return Oe(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"mask",vertexShader:Zkt,fragmentShader:Ykt,defines:t.getDefines(),triangulation:US,depth:{enable:!1},pick:!1})]})()}clearModels(t=!0){t&&this.layerService.clear()}registerBuiltinAttributes(){return""}}const Kkt={fill:qkt},Qkt=Kkt;class rtt extends L_{constructor(...t){super(...t),U(this,"type","MaskLayer")}buildModels(){var t=this;return Oe(function*(){const r=t.getModelType();t.layerModel=new Qkt[r](t),yield t.initLayerModels()})()}getModelType(){return"fill"}}class Jkt extends O_{initTileLayer(){var t=this;return Oe(function*(){const r=t.parent.getLayerAttributeConfig(),n=t.getLayerOptions(),i=t.getSourceOption(),a=new rtt(Ce({},n)).source(i.data,i.options);r&&Object.keys(r).forEach(o=>{var s,l;const u=o;a[u]((s=r[u])===null||s===void 0?void 0:s.field,(l=r[u])===null||l===void 0?void 0:l.values)}),yield t.addLayer(a),t.isLoaded=!0})()}getFeatures(t){return t?this.sourceTile.data.getTileData(t):[]}getSourceOption(){const t=this.parent.getSource(),{sourceLayer:r,featureId:n}=this.parent.getLayerConfig();return{data:{type:"FeatureCollection",features:this.getFeatures(r)},options:{parser:{type:"geojson",featureId:n},transforms:t.transforms}}}}const t6t=["rasterData"];let e6t=class extends O_{initTileLayer(){var t=this;return Oe(function*(){const r=t.parent.getLayerAttributeConfig(),n=t.getLayerOptions(),i=t.getSourceOption(),a=new L4(Ce({},n)).source(i.data,i.options);r&&Object.keys(r).forEach(o=>{var s,l;const u=o;a[u]((s=r[u])===null||s===void 0?void 0:s.field,(l=r[u])===null||l===void 0?void 0:l.values)}),yield t.addLayer(a),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource(),r=this.sourceTile.data.data,{rasterData:n}=r,i=Gh(r,t6t);return{data:n,options:{parser:Ce({type:"rasterRgb",extent:this.sourceTile.bounds},i),transforms:t.transforms}}}};class r6t extends O_{initTileLayer(){var t=this;return Oe(function*(){const r=t.parent.getLayerAttributeConfig(),n=t.getLayerOptions(),i=t.getSourceOption(),a=new L4(Ce({},n)).source(i.data,i.options);r&&Object.keys(r).forEach(o=>{var s,l;const u=o;a[u]((s=r[u])===null||s===void 0?void 0:s.field,(l=r[u])===null||l===void 0?void 0:l.values)}),yield t.addLayer(a),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}const n6t=["rasterData"],i6t={positions:[0,1],colors:["#000","#fff"]};class a6t extends O_{constructor(...t){super(...t),U(this,"colorTexture",void 0)}initTileLayer(){var t=this;return Oe(function*(){const r=t.parent.getLayerAttributeConfig(),n=t.getLayerOptions(),i=t.getSourceOption(),{rampColors:a,domain:o}=t.getLayerOptions();t.colorTexture=t.parent.textureService.getColorTexture(a,o);const s=new L4(Ce(Ce({},n),{},{colorTexture:t.colorTexture})).source(i.data,i.options);r&&Object.keys(r).forEach(l=>{var u,c;const f=l;s[f]((u=r[f])===null||u===void 0?void 0:u.field,(c=r[f])===null||c===void 0?void 0:c.values)}),yield t.addLayer(s),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource(),r=this.sourceTile.data.data,{rasterData:n}=r,i=Gh(r,n6t);return{data:n,options:{parser:Ce({type:"raster",extent:this.sourceTile.bounds},i),transforms:t.transforms}}}styleUpdate(...t){const{rampColors:r=i6t,domain:n}=t;this.colorTexture=this.parent.textureService.getColorTexture(r,n||G5(r)),this.layers.forEach(i=>i.style({colorTexture:this.colorTexture}))}destroy(){this.layers.forEach(t=>t.destroy())}}class NT extends O_{initTileLayer(){var t=this;return Oe(function*(){const r=t.parent.getLayerAttributeConfig(),n=t.getLayerOptions(),i=Gkt(t.parent.type),a=t.getSourceOption();if(!a){t.isLoaded=!0,t.emit("loaded");return}const o=new i(Ce({},n)).source(a.data,a.options);Object.keys(r).forEach(s=>{var l,u;const c=s;o[c]((l=r[c])===null||l===void 0?void 0:l.field,(u=r[c])===null||u===void 0?void 0:u.values)}),yield t.addLayer(o),n.tileMask&&(yield t.addTileMask()),t.setLayerMinMaxZoom(o),t.isLoaded=!0,t.emit("loaded")})()}getSourceOption(){const t=this.parent.getSource(),{sourceLayer:r="defaultLayer",featureId:n="id"}=this.parent.getLayerConfig();return{data:{type:"FeatureCollection",features:this.getFeatures(r)},options:{parser:{type:"geojson",featureId:n},transforms:t.transforms}}}setLayerMinMaxZoom(t){t.getModelType()==="text"&&t.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}getFeatures(t){return this.sourceTile.data.getTileData(t)}getFeatureById(t){const r=this.getMainLayer();return r?r.getSource().data.dataArray.filter(i=>i._id===t):[]}}function o6t(e){switch(e.type){case"PolygonLayer":return NT;case"LineLayer":return NT;case"PointLayer":return NT;case"TileDebugLayer":return Xkt;case"MaskLayer":return Jkt;case"RasterLayer":const{dataType:r}=e.getSource().parser;switch(r){case ou.RGB:case ou.CUSTOMRGB:return e6t;case ou.ARRAYBUFFER:case ou.CUSTOMARRAYBUFFER:return a6t;case ou.TERRAINRGB:case ou.CUSTOMTERRAINRGB:return r6t;default:return jkt}default:return NT}}const s6t=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask","addMask","removeMask"],{debounce:l6t}=as;class u6t{constructor(t){U(this,"parent",void 0),U(this,"tileLayerService",void 0),U(this,"mapService",void 0),U(this,"layerService",void 0),U(this,"rendererService",void 0),U(this,"pickingService",void 0),U(this,"tilePickService",void 0),U(this,"tilesetManager",void 0),U(this,"initedTileset",!1),U(this,"lastViewStates",void 0),U(this,"mapchange",()=>{var n;if(this.parent.isVisible()===!1)return;const{latLonBounds:i,zoom:a}=this.getCurrentView();this.lastViewStates&&this.lastViewStates.zoom===a&&this.lastViewStates.latLonBounds.toString()===i.toString()||(this.lastViewStates={zoom:a,latLonBounds:i},(n=this.tilesetManager)===null||n===void 0||n.throttleUpdate(a,i))}),U(this,"viewchange",l6t(this.mapchange,24)),this.parent=t;const r=this.parent.getContainer();this.rendererService=r.rendererService,this.layerService=r.layerService,this.mapService=r.mapService,this.pickingService=r.pickingService,this.tileLayerService=new hkt({rendererService:this.rendererService,layerService:this.layerService,parent:t}),this.tilePickService=new Vkt({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:t}),this.parent.setLayerPickService(this.tilePickService),this.proxy(t),this.initTileSetManager()}initTileSetManager(){var t;const r=this.parent.getSource();if(this.tilesetManager=r.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0),this.parent.isVisible()===!1)return;const{latLonBounds:n,zoom:i}=this.getCurrentView();(t=this.tilesetManager)===null||t===void 0||t.update(i,n)}getCurrentView(){const t=this.mapService.getBounds(),r=[t[0][0],t[0][1],t[1][0],t[1][1]],n=this.mapService.getZoom();return{latLonBounds:r,zoom:n}}bindTilesetEvent(){this.tilesetManager.on("tile-loaded",t=>{}),this.tilesetManager.on("tile-unload",t=>{this.tileUnLoad(t)}),this.tilesetManager.on("tile-error",(t,r)=>{this.tileError(t)}),this.tilesetManager.on("tile-update",()=>{this.tileUpdate()}),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}render(){this.tileLayerService.render()}getLayers(){return this.tileLayerService.getLayers()}getTiles(){return this.tileLayerService.getTiles()}getTile(t){return this.tileLayerService.getTile(t)}tileLoaded(t){}tileError(t){console.warn("error:",t)}destroy(){var t;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),(t=this.tilesetManager)===null||t===void 0||t.destroy(),this.tileLayerService.destroy()}reload(){var t;this.tilesetManager.clear();const{latLonBounds:r,zoom:n}=this.getCurrentView();(t=this.tilesetManager)===null||t===void 0||t.update(n,r)}tileUnLoad(t){this.tileLayerService.removeTile(t.key)}tileUpdate(){var t=this;return Oe(function*(){if(!t.tilesetManager)return;const r=t.parent.getMinZoom(),n=t.parent.getMaxZoom(),i=t.tilesetManager.tiles.filter(a=>a.isLoaded).filter(a=>a.isVisibleChange).filter(a=>a.data).filter(a=>a.z>=r&&a.z<n);yield Promise.all(i.map(function(){var a=Oe(function*(o){if(t.tileLayerService.hasTile(o.key))t.tileLayerService.updateTileVisible(o),t.tilePickService.setPickState(),t.layerService.reRender();else{const s=o6t(t.parent),l=new s(o,t.parent);yield l.initTileLayer(),t.tilePickService.setPickState(),l.getLayers().length!==0&&(t.tileLayerService.addTile(l),t.tileLayerService.updateTileVisible(o),t.layerService.reRender())}});return function(o){return a.apply(this,arguments)}}())),t.tilesetManager.isLoaded&&t.parent.emit("tiles-loaded",t.tilesetManager.currentTiles)})()}setPickState(t){}pickRender(t){this.tilePickService.pickRender(t)}selectFeature(t){this.tilePickService.selectFeature(t)}highlightPickedFeature(t){this.tilePickService.highlightPickedFeature(t)}proxy(t){s6t.forEach(r=>{const n=t[r].bind(t);t[r]=(...i)=>(n(...i),this.getLayers().map(a=>{a[r](...i)}),r==="style"&&this.getTiles().forEach(a=>a.styleUpdate(...i)),t)})}}class c6t extends yg{constructor(...t){super(...t),U(this,"disabled",void 0),U(this,"zoomInButton",void 0),U(this,"zoomOutButton",void 0),U(this,"zoomNumDiv",void 0),U(this,"zoomIn",()=>{!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}),U(this,"zoomOut",()=>{!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}),U(this,"updateDisabled",()=>{const r=this.mapsService;this.zoomInButton.removeAttribute("disabled"),this.zoomOutButton.removeAttribute("disabled"),(this.disabled||r.getZoom()<=r.getMinZoom())&&this.zoomOutButton.setAttribute("disabled","true"),this.controlOption.showZoom&&this.zoomNumDiv&&(this.zoomNumDiv.innerText=String(Math.floor(r.getZoom()))),(this.disabled||r.getZoom()>=r.getMaxZoom())&&this.zoomInButton.setAttribute("disabled","true")})}getDefault(t){return Ce(Ce({},super.getDefault(t)),{},{position:Gx.BOTTOMRIGHT,name:"zoom",zoomInText:JM("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:JM("l7-icon-narrow"),zoomOutTitle:"Zoom out",showZoom:!1})}setOptions(t){super.setOptions(t),this.checkUpdateOption(t,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","showZoom"])&&this.resetButtonGroup(this.container)}onAdd(){const t=Ua("div","l7-control-zoom");return this.resetButtonGroup(t),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),t}onRemove(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}disable(){return this.disabled=!0,this.updateDisabled(),this}enable(){return this.disabled=!1,this.updateDisabled(),this}resetButtonGroup(t){DS(t),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",t,this.zoomIn),this.controlOption.showZoom&&(this.zoomNumDiv=this.createButton("0","","l7-button-control l7-control-zoom__number",t)),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",t,this.zoomOut),this.updateDisabled()}createButton(t,r,n,i,a){const o=Ua("button",n,i);return typeof t=="string"?o.innerHTML=t:o.append(t),o.title=r,a&&o.addEventListener("click",a),o}}class h6t extends Gu.EventEmitter{get lngLat(){var t;return(t=this.popupOption.lngLat)!==null&&t!==void 0?t:{lng:0,lat:0}}set lngLat(t){this.popupOption.lngLat=t}constructor(t){super(),U(this,"popupOption",void 0),U(this,"mapsService",void 0),U(this,"sceneService",void 0),U(this,"layerService",void 0),U(this,"scene",void 0),U(this,"closeButton",void 0),U(this,"container",void 0),U(this,"content",void 0),U(this,"contentTitle",void 0),U(this,"contentPanel",void 0),U(this,"tip",void 0),U(this,"isShow",!0),U(this,"onMouseMove",n=>{var i;const a=this.mapsService.getMapContainer(),{left:o=0,top:s=0}=(i=a==null?void 0:a.getBoundingClientRect())!==null&&i!==void 0?i:{};this.setPopupPosition(n.clientX-o,n.clientY-s)}),U(this,"updateLngLatPosition",()=>{if(!this.mapsService||this.popupOption.followCursor)return;const{lng:n,lat:i}=this.lngLat,{x:a,y:o}=this.mapsService.lngLatToContainer([n,i]);this.setPopupPosition(a,o)}),U(this,"updateLngLatPositionWhenZoom",n=>{if(!this.mapsService||this.popupOption.followCursor)return;const i=n.map,a=i.getSize();a.x=a.x/2,a.y=a.y/2;const o=n.center,s=n.zoom,l=i.DE(this.lngLat,s,o);l.x=Math.round(l.x),l.y=Math.round(l.y),this.setPopupPosition(l.x,l.y,!0)}),U(this,"onKeyDown",n=>{n.keyCode===27&&this.remove()}),U(this,"onCloseButtonClick",n=>{n.stopPropagation&&n.stopPropagation(),this.hide()}),U(this,"updatePosition",(n,i=!0)=>{const a=!!this.lngLat,{className:o,style:s,maxWidth:l,anchor:u,stopPropagation:c}=this.popupOption;if(!this.mapsService||!a||!this.content)return;const f=this.mapsService.getMarkerContainer();if(!this.container&&f&&(this.container=Ua("div",`l7-popup ${o??""} ${this.isShow?"":"l7-popup-hide"}`,f),s&&this.container.setAttribute("style",s),this.tip=Ua("div","l7-popup-tip",this.container),this.container.appendChild(this.content),c&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(d=>{this.container.addEventListener(d,v=>{v.stopPropagation()})}),this.container.style.whiteSpace="nowrap"),i?this.updateLngLatPositionWhenZoom(n):this.updateLngLatPosition(),HK(this.container,`${BM[u]}`),wq(this.container,u,"popup"),l){const{width:d}=this.container.getBoundingClientRect();d>parseFloat(l)&&(this.container.style.width=l)}else this.container.style.removeProperty("width")}),U(this,"updateWhenZoom",n=>{this.updatePosition(n,!0)}),U(this,"update",()=>{this.updatePosition(null,!1)}),this.popupOption=Ce(Ce({},this.getDefault(t??{})),t);const{lngLat:r}=this.popupOption;r&&(this.lngLat=r)}getIsShow(){return this.isShow}addTo(t){this.mapsService=t.mapService,this.sceneService=t.sceneService,this.layerService=t.layerService,this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=t,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();const{html:r,text:n,title:i}=this.popupOption;return r?this.setHTML(r):n&&this.setText(n),i&&this.setTitle(i),this.emit("open"),this}remove(){if(this!==null&&this!==void 0&&this.isOpen())return this.content&&kh(this.content),this.container&&(kh(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}getOptions(){return this.popupOption}setOptions(t){this.show();const{className:r}=this.popupOption;if(this.popupOption=Ce(Ce({},this.popupOption),t),this.checkUpdateOption(t,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","lngLat","offsets"])&&(this.container&&(kh(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(t,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(t,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(t,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(t,["html"])&&t.html?this.setHTML(t.html):this.checkUpdateOption(t,["text"])&&t.text&&this.setText(t.text),this.checkUpdateOption(t,["className"])){var n;r&&this.container.classList.remove(r??""),this.container.classList.add((n=t.className)!==null&&n!==void 0?n:"")}if(this.checkUpdateOption(t,["style"])){var i;a4(this.container,(i=t.style)!==null&&i!==void 0?i:"")}return this.checkUpdateOption(t,["lngLat"])&&t.lngLat&&this.setLnglat(t.lngLat),this}open(){return this.addTo(this.scene),this}close(){return this.remove(),this}show(){if(!this.isShow)return this.container&&Hx(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}hide(){if(this.isShow)return this.container&&Yp(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}setHTML(t){return this.popupOption.html=t,this.setDOMContent(t)}setText(t){return this.popupOption.text=t,this.setDOMContent(window.document.createTextNode(t))}setTitle(t){this.show(),this.popupOption.title=t,t?(this.contentTitle||(this.contentTitle=Ua("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),DS(this.contentTitle),Ty(this.contentTitle,t)):this.contentTitle&&(kh(this.contentTitle),this.contentTitle=void 0)}panToPopup(){const{lng:t,lat:r}=this.lngLat;return this.popupOption.autoPan&&this.mapsService.panTo([t,r]),this}setLngLat(t){return this.setLnglat(t)}setLnglat(t){return this.show(),this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout(()=>{this.panToPopup()},0),this}getLnglat(){return this.lngLat}setMaxWidth(t){return this.popupOption.maxWidth=t,this.update(),this}isOpen(){return!!this.mapsService}getDefault(t){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:MI.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}setDOMContent(t){return this.show(),this.createContent(),Ty(this.contentPanel,t),this.update(),this}updateCloseOnClick(t){const r=this.mapsService;r&&(r==null||r.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!t&&requestAnimationFrame(()=>{r==null||r.on("click",this.onCloseButtonClick)}))}updateCloseOnEsc(t){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!t&&window.addEventListener("keydown",this.onKeyDown)}updateFollowCursor(t){var r;const n=(r=this.mapsService)===null||r===void 0?void 0:r.getContainer();n&&(n==null||n.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!t&&(n==null||n.addEventListener("mousemove",this.onMouseMove)))}createContent(){if(this.content&&kh(this.content),this.contentTitle=void 0,this.content=Ua("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){const t=JM("l7-icon-guanbi");Yp(t,"l7-popup-close-button"),this.content.appendChild(t),this.popupOption.closeButtonOffsets&&(t.style.right=this.popupOption.closeButtonOffsets[0]+"px",t.style.top=this.popupOption.closeButtonOffsets[1]+"px"),t.setAttribute("aria-label","Close popup"),t.addEventListener("click",()=>{this.hide()}),t.addEventListener("pointerup",r=>{r.stopPropagation()}),t.addEventListener("pointerdown",r=>{r.stopPropagation()}),this.closeButton=t}else this.closeButton=void 0;this.contentPanel=Ua("div","l7-popup-content__panel",this.content)}setPopupPosition(t,r,n=!1){if(this.container){const{offsets:i}=this.popupOption;this.container.style.left=t+i[0]+"px",this.container.style.top=r-i[1]+"px",n?this.container.style.transition="left 0.25s cubic-bezier(0,0,0.25,1), top 0.25s cubic-bezier(0,0,0.25,1)":this.container.style.transition=""}}checkUpdateOption(t,r){return r.some(n=>n in t)}}const{get:f6t}=as;class YLe extends h6t{constructor(...t){super(...t),U(this,"layerClickCountByFrame",0),U(this,"layerConfigMap",new WeakMap),U(this,"displayFeatureInfo",void 0),U(this,"onLayerClick",(r,n)=>{requestAnimationFrame(()=>{if(this.popupOption.closeOnClick&&this.layerClickCountByFrame++,this.isShow&&this.isSameFeature(r,n.featureId))this.hide();else{const{title:i,content:a}=this.getLayerInfoFrag(r,n);this.setDOMContent(a),this.setLnglat(n.lngLat),this.setTitle(i),this.setDisplayFeatureInfo({layer:r,featureId:n.featureId}),this.show()}})}),U(this,"onSceneClick",()=>{this.layerClickCountByFrame=0,requestAnimationFrame(()=>{this.layerClickCountByFrame||this.hide()})}),U(this,"onLayerHide",()=>{this.hide(),this.setDisplayFeatureInfo(void 0)}),U(this,"updateCloseOnClick",()=>{})}get layerConfigItems(){var t;const{config:r,items:n}=this.popupOption;return(t=r??n)!==null&&t!==void 0?t:[]}addTo(t){return super.addTo(t),this.bindLayerEvent(),this.hide(),this}remove(){return super.remove(),this.unbindLayerEvent(),this}setOptions(t){this.unbindLayerEvent();const r=Ce({},t),n=r.trigger||this.popupOption.trigger,i=r.items||this.popupOption.items,a=(i==null?void 0:i.length)===0;r.followCursor=n==="hover"&&!a;const o=this.isShow;return super.setOptions(r),this.bindLayerEvent(),(a||!o)&&this.hide(),this}getDefault(t){const r=t.trigger!=="click";return Ce(Ce({},super.getDefault(t)),{},{trigger:"hover",followCursor:r,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!0,autoClose:!1,closeOnEsc:!1})}bindLayerEvent(){const{trigger:t,closeOnClick:r}=this.popupOption;this.layerConfigItems.forEach(n=>{var i;const a=this.getLayerByConfig(n);if(!a)return;const o=Ce({},n);if(t==="hover"){const c=this.onLayerMouseMove.bind(this,a),f=this.onLayerMouseOut.bind(this,a);o.onMouseMove=c,o.onMouseOut=f,a==null||a.on("mousemove",c),a==null||a.on("mouseout",f)}else{var s;const c=this.onLayerClick.bind(this,a);o.onClick=c,a==null||a.on("click",c);const f=(s=this.mapsService)===null||s===void 0?void 0:s.getMapContainer();f&&r&&f.addEventListener("click",this.onSceneClick)}const l=a==null||(i=a.getSource)===null||i===void 0?void 0:i.call(a),u=this.onSourceUpdate.bind(this);l==null||l.on("update",u),o.onSourceUpdate=u,this.layerConfigMap.set(a,o)})}unbindLayerEvent(){this.layerConfigItems.forEach(t=>{var r;const n=this.getLayerByConfig(t),i=n&&this.layerConfigMap.get(n);if(!i)return;const{onMouseMove:a,onMouseOut:o,onClick:s,onSourceUpdate:l}=i;if(a&&n.off("mousemove",a),o&&n.off("mouseout",o),s&&n.off("click",s),l){var u;n==null||(u=n.getSource())===null||u===void 0||u.off("update",l)}const c=(r=this.mapsService)===null||r===void 0?void 0:r.getMapContainer();c&&c.removeEventListener("click",this.onSceneClick)})}onLayerMouseMove(t,r){if(!this.isSameFeature(t,r.featureId)){const{title:n,content:i}=this.getLayerInfoFrag(t,r);this.setDOMContent(i),this.setTitle(n),this.setDisplayFeatureInfo({layer:t,featureId:r.featureId}),this.show()}}onLayerMouseOut(t,r){this.setDisplayFeatureInfo(void 0),this.isShow&&this.hide()}onSourceUpdate(){this.hide(),this.setDisplayFeatureInfo(void 0)}getLayerInfoFrag(t,r){const n=this.layerConfigMap.get(t);let i;const a=document.createDocumentFragment();if(n){let o=r.feature;o.type==="Feature"&&"properties"in o&&"geometry"in o&&(o=o.properties);const{title:s,fields:l,customContent:u}=n;if(s){i=document.createDocumentFragment();const c=s instanceof Function?s(o):s;Ty(i,c)}if(u){const c=u instanceof Function?u(o):u;Ty(a,c)}else l!=null&&l.length&&(l==null||l.forEach(c=>{var f,d;const{field:v,formatField:g,formatValue:x,getValue:w}=typeof c=="string"?{field:c}:c,S=Ua("div","l7-layer-popup__row"),M=w?w(r.feature):f6t(o,v),R=(f=g instanceof Function?g(v,o):g)!==null&&f!==void 0?f:v;let I=(d=x instanceof Function?x(M,o):x)!==null&&d!==void 0?d:M;const P=Ua("span","l7-layer-popup__key",S);Ty(P,R),Ty(P,document.createTextNode("："));const k=Ua("span","l7-layer-popup__value",S);Array.isArray(I)&&I.every(z=>!(z instanceof Object))&&(I=I.map(z=>String(z)).join(",")),Ty(k,I),a.appendChild(S)}))}return{title:i,content:a}}getLayerByConfig(t){const r=t.layer;if(r instanceof Object)return r;if(typeof r=="string")return this.layerService.getLayer(r)||this.layerService.getLayerByName(r)}isSameFeature(t,r){const n=this.displayFeatureInfo;return n&&t===n.layer&&r===n.featureId}setDisplayFeatureInfo(t){const r=this.displayFeatureInfo;r&&r.layer.off("hide",this.onLayerHide),t&&t.layer.on("hide",this.onLayerHide),this.displayFeatureInfo=t}}function d6t(e,t){var r=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(r||n)&&(t||(t=document),!!t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var a=t.body||t.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):t.documentElement.appendChild(i)}var o=t.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(t.createTextNode(e)),i.appendChild(o),o}}d6t(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}
.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgba(181, 226, 140, 0.6);
  background-clip: padding-box;
  border-radius: 20px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font:
    12px 'Helvetica Neue',
    Arial,
    Helvetica,
    sans-serif;
  text-align: center;
  background-color: rgba(110, 204, 57, 0.6);
  border-radius: 15px;
}
.l7-marker-cluster span {
  line-height: 30px;
}
.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgba(0, 0, 0, 0.2);
}
.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}
.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 999;
  box-sizing: border-box;
}
.l7-control-container {
  font:
    12px/1.5 'Helvetica Neue',
    Arial,
    Helvetica,
    sans-serif;
}
.l7-control-container .l7-control {
  position: relative;
  z-index: 999;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblePainted;
  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control-container .l7-control.l7-control--hide {
  display: none;
}
.l7-control-container .l7-top {
  top: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}
.l7-control-container .l7-right {
  right: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}
.l7-control-container .l7-bottom {
  bottom: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}
.l7-control-container .l7-left {
  left: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}
.l7-control-container .l7-center {
  position: absolute;
  display: flex;
  justify-content: center;
}
.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}
.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}
.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}
.l7-control-container .l7-row {
  flex-direction: row;
}
.l7-control-container .l7-row.l7-top {
  align-items: flex-start;
}
.l7-control-container .l7-row.l7-bottom {
  align-items: flex-end;
}
.l7-control-container .l7-column {
  flex-direction: column;
}
.l7-control-container .l7-column.l7-left {
  align-items: flex-start;
}
.l7-control-container .l7-column.l7-right {
  align-items: flex-end;
}
.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 0 6px;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  line-height: 16px;
}
.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}
.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}
.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}
.l7-button-control.l7-button-control--column {
  height: 44px;
  flex-direction: column;
}
.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}
.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}
.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}
.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}
.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}
.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}
.l7-button-control:disabled:hover {
  background-color: #fafafa;
}
.l7-button-control:disabled:active {
  background-color: #fafafa;
}
.l7-popper {
  position: absolute;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 5;
  color: #595959;
}
.l7-popper.l7-popper-hide {
  display: none;
}
.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-left-color: transparent;
  border-right-color: transparent;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper.l7-popper-left {
  flex-direction: row;
}
.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-right {
  flex-direction: row-reverse;
}
.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-top {
  flex-direction: column;
}
.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-bottom {
  flex-direction: column-reverse;
}
.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-start {
  align-items: flex-start;
}
.l7-popper.l7-popper-end {
  align-items: flex-end;
}
.l7-select-control--normal {
  padding: 4px 0;
}
.l7-select-control--normal .l7-select-control-item {
  display: flex;
  align-items: center;
  height: 24px;
  padding: 0 16px;
  font-size: 12px;
  line-height: 24px;
}
.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}
.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  width: 14px;
  height: 14px;
}
.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}
.l7-select-control--image {
  display: flex;
  flex-wrap: wrap;
  align-items: flex-start;
  box-sizing: content-box;
  max-width: 460px;
  max-height: 400px;
  margin: 12px 0 0 12px;
  overflow-x: hidden;
  overflow-y: auto;
}
.l7-select-control--image .l7-select-control-item {
  position: relative;
  display: flex;
  flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);
  flex-direction: column;
  justify-content: center;
  box-sizing: content-box;
  margin-right: 12px;
  margin-bottom: 12px;
  overflow: hidden;
  font-size: 12px;
  border: 1px solid #fff;
  border-radius: 2px;
}
.l7-select-control--image .l7-select-control-item img {
  width: 100%;
  height: 80px;
}
.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  top: 0;
  right: 0;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: flex;
  align-items: center;
  justify-content: center;
  line-height: 26px;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}
.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}
.l7-select-control-item {
  cursor: pointer;
}
.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}
.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}
.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.l7-control-logo img {
  height: 100%;
  width: 100%;
}
.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}
.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}
.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  padding: 2px 4px;
  min-width: 130px;
}
.l7-control-zoom {
  overflow: hidden;
  border-radius: 2px;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-control-zoom .l7-button-control {
  font-size: 16px;
  border-bottom: 1px solid #f0f0f0;
  border-radius: 0;
  box-shadow: 0 0 0;
}
.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}
.l7-control-zoom .l7-button-control:last-child {
  border-bottom: 0;
}
.l7-control-zoom .l7-control-zoom__number {
  color: #595959;
  padding: 0;
}
.l7-control-zoom .l7-control-zoom__number:hover {
  background-color: #fff;
}
.l7-control-scale {
  display: flex;
  flex-direction: column;
}
.l7-control-scale .l7-control-scale-line {
  box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  transition: width 0.1s;
}
.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}
.l7-right .l7-control-scale {
  display: flex;
  align-items: flex-end;
}
.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: flex;
  will-change: transform;
  pointer-events: none;
}
.l7-popup.l7-popup-hide {
  display: none;
}
.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  font-size: 14px;
  background: #fff;
  border-radius: 3px;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.l7-popup .l7-popup-content .l7-popup-content__title {
  margin-bottom: 8px;
  font-weight: bold;
}
.l7-popup .l7-popup-content .l7-popup-close-button,
.l7-popup .l7-popup-content .l7-popup-content__title,
.l7-popup .l7-popup-content .l7-popup-content__panel {
  white-space: normal;
  -webkit-user-select: text;
     -moz-user-select: text;
      -ms-user-select: text;
          user-select: text;
  pointer-events: initial;
}
.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  padding: 0;
  font-size: 14px;
  line-height: 18px;
  text-align: center;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
}
.l7-popup .l7-popup-tip {
  position: relative;
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}
.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  flex-direction: column-reverse;
}
.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {
  bottom: 1px;
}
.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  flex-direction: column;
}
.l7-popup.l7-popup-anchor-top .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {
  top: 1px;
}
.l7-popup.l7-popup-anchor-left {
  flex-direction: row;
}
.l7-popup.l7-popup-anchor-right {
  flex-direction: row-reverse;
}
.l7-popup-anchor-top .l7-popup-tip {
  position: relative;
  align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-tip {
  align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}
.l7-popup-anchor-top-right .l7-popup-tip {
  align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-bottom .l7-popup-tip {
  align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}
.l7-popup-anchor-bottom-left .l7-popup-tip {
  align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}
.l7-popup-anchor-bottom-right .l7-popup-tip {
  align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}
.l7-popup-anchor-left .l7-popup-tip {
  align-self: center;
  border-right-color: #fff;
  border-left: none;
}
.l7-popup-anchor-right .l7-popup-tip {
  right: 1px;
  align-self: center;
  border-right: none;
  border-left-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}
.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}
.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}
.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}
.l7-popup-track-pointer {
  display: none;
}
.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}
.l7-map:hover .l7-popup-track-pointer {
  display: flex;
}
.l7-map:active .l7-popup-track-pointer {
  display: none;
}
.l7-layer-popup__row {
  font-size: 12px;
}
.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}
.l7-control-swipe {
  position: absolute;
  top: 50%;
  left: 50%;
  z-index: 6;
  -webkit-transform: translate(-50%, -50%);
          transform: translate(-50%, -50%);
  touch-action: none;
}
.l7-control-swipe_hide {
  display: none;
}
.l7-control-swipe:before {
  position: absolute;
  top: -5000px;
  bottom: -5000px;
  left: 50%;
  z-index: -1;
  width: 4px;
  background: #fff;
  -webkit-transform: translate(-2px, 0);
          transform: translate(-2px, 0);
  content: '';
}
.l7-control-swipe.horizontal:before {
  top: 50%;
  right: -5000px;
  bottom: auto;
  left: -5000px;
  width: auto;
  height: 4px;
}
.l7-control-swipe__button {
  display: block;
  width: 28px;
  height: 28px;
  margin: 0;
  padding: 0;
  color: #595959;
  font-weight: bold;
  font-size: inherit;
  text-align: center;
  text-decoration: none;
  background-color: #fff;
  border: none;
  border-radius: 2px;
  outline: none;
}
.l7-control-swipe,
.l7-control-swipe__button {
  cursor: ew-resize;
}
.l7-control-swipe.horizontal,
.l7-control-swipe.horizontal button {
  cursor: ns-resize;
}
.l7-control-swipe:after,
.l7-control-swipe__button:before,
.l7-control-swipe__button:after {
  position: absolute;
  top: 25%;
  bottom: 25%;
  left: 50%;
  width: 2px;
  background: currentColor;
  -webkit-transform: translate(-1px, 0);
          transform: translate(-1px, 0);
  content: '';
}
.l7-control-swipe__button:after {
  -webkit-transform: translateX(4px);
          transform: translateX(4px);
}
.l7-control-swipe__button:before {
  -webkit-transform: translateX(-6px);
          transform: translateX(-6px);
}
`);class HS{constructor(t){U(this,"configService",void 0),U(this,"config",void 0),this.config=t}setContainer(t,r){this.configService=t.globalConfigService,t.mapConfig=Ce(Ce({},this.config),{},{id:r}),t.mapService=new(this.getServiceConstructor())(t)}getServiceConstructor(){throw new Error("Method not implemented.")}}var ntt={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(Nm,function(){function r(f){var d=[];return f.AMapUI&&d.push(n(f.AMapUI)),f.Loca&&d.push(i(f.Loca)),Promise.all(d)}function n(f){return new Promise(function(d,v){var g=[];if(f.plugins)for(var x=0;x<f.plugins.length;x+=1)o.AMapUI.plugins.indexOf(f.plugins[x])==-1&&g.push(f.plugins[x]);if(s.AMapUI===a.failed)v("前次请求 AMapUI 失败");else if(s.AMapUI===a.notload){s.AMapUI=a.loading,o.AMapUI.version=f.version||o.AMapUI.version,x=o.AMapUI.version;var w=document.body||document.head,S=document.createElement("script");S.type="text/javascript",S.src="https://webapi.amap.com/ui/"+x+"/main.js",S.onerror=function(M){s.AMapUI=a.failed,v("请求 AMapUI 失败")},S.onload=function(){if(s.AMapUI=a.loaded,g.length)window.AMapUI.loadUI(g,function(){for(var M=0,R=g.length;M<R;M++){var I=g[M].split("/").slice(-1)[0];window.AMapUI[I]=arguments[M]}for(d();l.AMapUI.length;)l.AMapUI.splice(0,1)[0]()});else for(d();l.AMapUI.length;)l.AMapUI.splice(0,1)[0]()},w.appendChild(S)}else s.AMapUI===a.loaded?f.version&&f.version!==o.AMapUI.version?v("不允许多个版本 AMapUI 混用"):g.length?window.AMapUI.loadUI(g,function(){for(var M=0,R=g.length;M<R;M++){var I=g[M].split("/").slice(-1)[0];window.AMapUI[I]=arguments[M]}d()}):d():f.version&&f.version!==o.AMapUI.version?v("不允许多个版本 AMapUI 混用"):l.AMapUI.push(function(M){M?v(M):g.length?window.AMapUI.loadUI(g,function(){for(var R=0,I=g.length;R<I;R++){var P=g[R].split("/").slice(-1)[0];window.AMapUI[P]=arguments[R]}d()}):d()})})}function i(f){return new Promise(function(d,v){if(s.Loca===a.failed)v("前次请求 Loca 失败");else if(s.Loca===a.notload){s.Loca=a.loading,o.Loca.version=f.version||o.Loca.version;var g=o.Loca.version,x=o.AMap.version.startsWith("2"),w=g.startsWith("2");if(x&&!w||!x&&w)v("JSAPI 与 Loca 版本不对应！！");else{x=o.key,w=document.body||document.head;var S=document.createElement("script");S.type="text/javascript",S.src="https://webapi.amap.com/loca?v="+g+"&key="+x,S.onerror=function(M){s.Loca=a.failed,v("请求 AMapUI 失败")},S.onload=function(){for(s.Loca=a.loaded,d();l.Loca.length;)l.Loca.splice(0,1)[0]()},w.appendChild(S)}}else s.Loca===a.loaded?f.version&&f.version!==o.Loca.version?v("不允许多个版本 Loca 混用"):d():f.version&&f.version!==o.Loca.version?v("不允许多个版本 Loca 混用"):l.Loca.push(function(M){M?v(M):v()})})}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var a;(function(f){f.notload="notload",f.loading="loading",f.loaded="loaded",f.failed="failed"})(a||(a={}));var o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},s={AMap:a.notload,AMapUI:a.notload,Loca:a.notload},l={AMap:[],AMapUI:[],Loca:[]},u=[],c=function(f){typeof f=="function"&&(s.AMap===a.loaded?f(window.AMap):u.push(f))};return{load:function(f){return new Promise(function(d,v){if(s.AMap==a.failed)v("");else if(s.AMap==a.notload){var g=f.key,x=f.version,w=f.plugins;g?(window.AMap&&location.host!=="lbs.amap.com"&&v("禁止多种API加载方式混用"),o.key=g,o.AMap.version=x||o.AMap.version,o.AMap.plugins=w||o.AMap.plugins,s.AMap=a.loading,x=document.body||document.head,window.___onAPILoaded=function(M){if(delete window.___onAPILoaded,M)s.AMap=a.failed,v(M);else for(s.AMap=a.loaded,r(f).then(function(){d(window.AMap)}).catch(v);u.length;)u.splice(0,1)[0]()},w=document.createElement("script"),w.type="text/javascript",w.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+o.AMap.version+"&key="+g+"&plugin="+o.AMap.plugins.join(","),w.onerror=function(M){s.AMap=a.failed,v(M)},x.appendChild(w)):v("请填写key")}else if(s.AMap==a.loaded)if(f.key&&f.key!==o.key)v("多个不一致的 key");else if(f.version&&f.version!==o.AMap.version)v("不允许多个版本 JSAPI 混用");else{if(g=[],f.plugins)for(x=0;x<f.plugins.length;x+=1)o.AMap.plugins.indexOf(f.plugins[x])==-1&&g.push(f.plugins[x]);g.length?window.AMap.plugin(g,function(){r(f).then(function(){d(window.AMap)}).catch(v)}):r(f).then(function(){d(window.AMap)}).catch(v)}else if(f.key&&f.key!==o.key)v("多个不一致的 key");else if(f.version&&f.version!==o.AMap.version)v("不允许多个版本 JSAPI 混用");else{var S=[];if(f.plugins)for(x=0;x<f.plugins.length;x+=1)o.AMap.plugins.indexOf(f.plugins[x])==-1&&S.push(f.plugins[x]);c(function(){S.length?window.AMap.plugin(S,function(){r(f).then(function(){d(window.AMap)}).catch(v)}):r(f).then(function(){d(window.AMap)}).catch(v)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},s={AMap:a.notload,AMapUI:a.notload,Loca:a.notload},l={AMap:[],AMapUI:[],Loca:[]}}}})})(ntt);var p6t=ntt.exports;const v6t=sa(p6t);let itt=class{constructor(t){U(this,"size",1e4),this.size=t||1e4}setSize(t){this.size=t}getSize(){return[this.size,this.size]}mercatorXfromLng(t){return(180+t)/360*this.size}mercatorYfromLat(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}lngFromMercatorX(t){return t/this.size*360-180}latFromMercatorY(t){const r=180-(1-t/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90}project(t){const r=this.mercatorXfromLng(t[0]),n=this.mercatorYfromLat(t[1]);return[r,n]}unproject(t){const r=this.lngFromMercatorX(t[0]),n=this.latFromMercatorY(t[1]);return[r,n]}};const g6t=12;class m6t{constructor(t){U(this,"map",void 0),U(this,"simpleMapCoord",new itt),U(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),U(this,"config",void 0),U(this,"configService",void 0),U(this,"coordinateSystemService",void 0),U(this,"eventEmitter",void 0),U(this,"markerContainer",void 0),U(this,"mapContainer",void 0),U(this,"cameraChangedCallback",void 0),this.config=t.mapConfig,this.configService=t.globalConfigService,this.coordinateSystemService=t.coordinateSystemService,this.eventEmitter=new Gu.EventEmitter}onCameraChanged(t){this.cameraChangedCallback=t}updateView(t){var r;this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:t.bearing,center:t.center,viewportHeight:t.viewportHeight,pitch:t.pitch,viewportWidth:t.viewportWidth,zoom:t.zoom}),this.updateCoordinateSystemService(),(r=this.cameraChangedCallback)===null||r===void 0||r.call(this,this.viewport)}updateCoordinateSystemService(){const{offsetCoordinate:t=!0}=this.config;this.viewport.getZoom()>g6t&&t?this.coordinateSystemService.setCoordinateSystem(Wx.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(Wx.LNGLAT)}creatMapContainer(t){let r;return typeof t=="string"?r=document.getElementById(t):r=t,r}getMapStyleValue(t){var r;return(r=this.getMapStyleConfig()[t])!==null&&r!==void 0?r:t}setBgColor(t){this.bgColor=t}getMapContainer(){return this.mapContainer}getMarkerContainer(){return this.markerContainer}getOverlayContainer(){}getCanvasOverlays(){}emit(t,...r){this.eventEmitter.emit(t,...r)}once(t,r){this.eventEmitter.once(t,r)}meterToCoord(t,r){return 1}destroy(){this.eventEmitter.removeAllListeners()}}function att(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function iH(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,uq(n.key),n)}}function ott(e,t,r){return t&&iH(e.prototype,t),r&&iH(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Iw(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y6t(e,t){if(t&&(FM(t)=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Iw(e)}function aF(e){return aF=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},aF(e)}function oF(e,t){return oF=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,n){return r.__proto__=n,r},oF(e,t)}function _6t(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&oF(e,t)}function qw(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function aM(e,t){var r=Dm([],t,e);return QIt(r,r,1/r[3]),r}function o_(e,t){if(!e)throw new Error(t||"viewport-mercator-project: assertion failed.")}var Nd=Math.PI,stt=Nd/4,jm=Nd/180,aH=180/Nd,P4=512,oH=4003e4,x6t=1.5;function ltt(e){return Math.pow(2,e)}function HO(e,t){var r=zf(e,2),n=r[0],i=r[1];o_(Number.isFinite(n)&&Number.isFinite(t)),o_(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude"),t*=P4;var a=n*jm,o=i*jm,s=t*(a+Nd)/(2*Nd),l=t*(Nd-Math.log(Math.tan(stt+o*.5)))/(2*Nd);return[s,l]}function sH(e,t){var r=zf(e,2),n=r[0],i=r[1];t*=P4;var a=n/t*(2*Nd)-Nd,o=2*(Math.atan(Math.exp(Nd-i/t*(2*Nd)))-stt);return[a*aH,o*aH]}function b6t(e){var t=e.latitude,r=e.longitude,n=e.zoom,i=e.scale,a=e.highPrecision,o=a===void 0?!1:a;i=i!==void 0?i:ltt(n),o_(Number.isFinite(t)&&Number.isFinite(r)&&Number.isFinite(i));var s={},l=P4*i,u=Math.cos(t*jm),c=l/360,f=c/u,d=l/oH/u;if(s.pixelsPerMeter=[d,-d,d],s.metersPerPixel=[1/d,-1/d,1/d],s.pixelsPerDegree=[c,-f,d],s.degreesPerPixel=[1/c,-1/f,1/d],o){var v=jm*Math.tan(t*jm)/u,g=c*v/2,x=l/oH*v,w=x/f*d;s.pixelsPerDegree2=[0,-g,x],s.pixelsPerMeter2=[w,0,w]}return s}function E6t(e){var t=e.height,r=e.pitch,n=e.bearing,i=e.altitude,a=e.center,o=a===void 0?null:a,s=e.flipY,l=s===void 0?!1:s,u=qw();return Bh(u,u,[0,0,-i]),Nh(u,u,[1,1,1/t]),M_(u,u,-r*jm),Fb(u,u,n*jm),l&&Nh(u,u,[1,-1,1]),o&&Bh(u,u,YIt([],o)),u}function w6t(e){var t=e.width,r=e.height,n=e.altitude,i=n===void 0?x6t:n,a=e.pitch,o=a===void 0?0:a,s=e.nearZMultiplier,l=s===void 0?1:s,u=e.farZMultiplier,c=u===void 0?1:u,f=o*jm,d=Math.atan(.5/i),v=Math.sin(d)*i/Math.sin(Math.PI/2-f-d),g=Math.cos(Math.PI/2-f)*v+i;return{fov:2*Math.atan(r/2/i),aspect:t/r,focalDistance:i,near:l,far:g*c}}function C6t(e){var t=e.width,r=e.height,n=e.pitch,i=e.altitude,a=e.nearZMultiplier,o=e.farZMultiplier,s=w6t({width:t,height:r,altitude:i,pitch:n,nearZMultiplier:a,farZMultiplier:o}),l=s.fov,u=s.aspect,c=s.near,f=s.far,d=gQ([],l,u,c,f);return d}function S6t(e,t){var r=zf(e,3),n=r[0],i=r[1],a=r[2],o=a===void 0?0:a;return o_(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(o)),aM(t,[n,i,o,1])}function utt(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=zf(e,3),i=n[0],a=n[1],o=n[2];if(o_(Number.isFinite(i)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(o)){var s=aM(t,[i,a,o,1]);return s}var l=aM(t,[i,a,0,1]),u=aM(t,[i,a,1,1]),c=l[2],f=u[2],d=c===f?0:((r||0)-c)/(f-c);return e3t([],l,u,d)}var lH=qw(),T6t=function(){function e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.width,n=t.height,i=t.viewMatrix,a=i===void 0?lH:i,o=t.projectionMatrix,s=o===void 0?lH:o;att(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=a,this.projectionMatrix=s;var l=qw();Wm(l,l,this.projectionMatrix),Wm(l,l,this.viewMatrix),this.viewProjectionMatrix=l;var u=qw();Nh(u,u,[this.width/2,-this.height/2,1]),Bh(u,u,[1,-1,0]),Wm(u,u,this.viewProjectionMatrix);var c=EC(qw(),u);if(!c)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=u,this.pixelUnprojectionMatrix=c,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return ott(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&VU(r.projectionMatrix,this.projectionMatrix)&&VU(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,a=i===void 0?!0:i,o=this.projectPosition(r),s=S6t(o,this.pixelProjectionMatrix),l=zf(s,2),u=l[0],c=l[1],f=a?c:this.height-c;return r.length===2?[u,f]:[u,f,s[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,a=i===void 0?!0:i,o=n.targetZ,s=zf(r,3),l=s[0],u=s[1],c=s[2],f=a?u:this.height-u,d=o&&o*this.pixelsPerMeter,v=utt([l,f,c],this.pixelUnprojectionMatrix,d),g=this.unprojectPosition(v),x=zf(g,3),w=x[0],S=x[1],M=x[2];return Number.isFinite(c)?[w,S,M]:Number.isFinite(o)?[w,S,o]:[w,S]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),i=zf(n,2),a=i[0],o=i[1],s=(r[2]||0)*this.pixelsPerMeter;return[a,o,s]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),i=zf(n,2),a=i[0],o=i[1],s=(r[2]||0)/this.pixelsPerMeter;return[a,o,s]}},{key:"projectFlat",value:function(r){return arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale,r}},{key:"unprojectFlat",value:function(r){return arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale,r}}]),e}();function A6t(e){var t=e.width,r=e.height,n=e.bounds,i=e.minExtent,a=i===void 0?0:i,o=e.maxZoom,s=o===void 0?24:o,l=e.padding,u=l===void 0?0:l,c=e.offset,f=c===void 0?[0,0]:c,d=zf(n,2),v=zf(d[0],2),g=v[0],x=v[1],w=zf(d[1],2),S=w[0],M=w[1];if(Number.isFinite(u)){var R=u;u={top:R,bottom:R,left:R,right:R}}else o_(Number.isFinite(u.top)&&Number.isFinite(u.bottom)&&Number.isFinite(u.left)&&Number.isFinite(u.right));var I=new sF({width:t,height:r,longitude:0,latitude:0,zoom:0}),P=I.project([g,M]),k=I.project([S,x]),z=[Math.max(Math.abs(k[0]-P[0]),a),Math.max(Math.abs(k[1]-P[1]),a)],G=[t-u.left-u.right-Math.abs(f[0])*2,r-u.top-u.bottom-Math.abs(f[1])*2];o_(G[0]>0&&G[1]>0);var J=G[0]/z[0],Z=G[1]/z[1],X=(u.right-u.left)/2/J,et=(u.bottom-u.top)/2/Z,at=[(k[0]+P[0])/2+X,(k[1]+P[1])/2+et],wt=I.unproject(at),Tt=I.zoom+Math.log2(Math.abs(Math.min(J,Z)));return{longitude:wt[0],latitude:wt[1],zoom:Math.min(Tt,s)}}var sF=function(e){_6t(t,e);function t(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.width,a=n.height,o=n.latitude,s=o===void 0?0:o,l=n.longitude,u=l===void 0?0:l,c=n.zoom,f=c===void 0?0:c,d=n.pitch,v=d===void 0?0:d,g=n.bearing,x=g===void 0?0:g,w=n.altitude,S=w===void 0?1.5:w,M=n.nearZMultiplier,R=n.farZMultiplier;att(this,t),i=i||1,a=a||1;var I=ltt(f);S=Math.max(.75,S);var P=HO([u,s],I);P[2]=0;var k=C6t({width:i,height:a,pitch:v,bearing:x,altitude:S,nearZMultiplier:M||1/a,farZMultiplier:R||1.01}),z=E6t({height:a,center:P,pitch:v,bearing:x,altitude:S,flipY:!0});return r=y6t(this,aF(t).call(this,{width:i,height:a,viewMatrix:z,projectionMatrix:k})),r.latitude=s,r.longitude=u,r.zoom=f,r.pitch=v,r.bearing=x,r.altitude=S,r.scale=I,r.center=P,r.pixelsPerMeter=b6t(Iw(Iw(r))).pixelsPerMeter[2],Object.freeze(Iw(Iw(r))),r}return ott(t,[{key:"projectFlat",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return HO(n,i)}},{key:"unprojectFlat",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return sH(n,i)}},{key:"getMapCenterByLngLatPosition",value:function(n){var i=n.lngLat,a=n.pos,o=utt(a,this.pixelUnprojectionMatrix),s=HO(i,this.scale),l=Vl([],s,t3t([],o)),u=Vl([],this.center,l);return sH(u,this.scale)}},{key:"getLocationAtPoint",value:function(n){var i=n.lngLat,a=n.pos;return this.getMapCenterByLngLatPosition({lngLat:i,pos:a})}},{key:"fitBounds",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=this.width,o=this.height,s=A6t(Object.assign({width:a,height:o,bounds:n},i)),l=s.longitude,u=s.latitude,c=s.zoom;return new t({width:a,height:o,longitude:l,latitude:u,zoom:c})}}]),t}(T6t);class VS{constructor(){U(this,"viewport",new sF)}syncWithMapCamera(t){const{center:r,zoom:n,pitch:i,bearing:a,viewportHeight:o,viewportWidth:s}=t,l={width:this.viewport.width,height:this.viewport.height,longitude:this.viewport.center[0],latitude:this.viewport.center[1],zoom:this.viewport.zoom,pitch:this.viewport.pitch,bearing:this.viewport.bearing};this.viewport=new sF(Ce(Ce({},l),{},{width:s,height:o,longitude:r&&r[0],latitude:r&&r[1],zoom:n,pitch:i,bearing:a}))}getZoom(){return this.viewport.zoom}getZoomScale(){return Math.pow(2,this.getZoom())}getCenter(){return[this.viewport.longitude,this.viewport.latitude]}getProjectionMatrix(){return this.viewport.projectionMatrix}getModelMatrix(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}getViewMatrix(){return this.viewport.viewMatrix}getViewMatrixUncentered(){return this.viewport.viewMatrixUncentered}getViewProjectionMatrix(){return this.viewport.viewProjectionMatrix}getViewProjectionMatrixUncentered(){return this.viewport.viewProjectionMatrix}getFocalDistance(){return 1}projectFlat(t,r){return this.viewport.projectFlat(t,r)}}let ctt=function(e){return e.GAODE="GAODE",e.MAPBOX="MAPBOX",e.DEFAULT="DEFAUlTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e}({});function uH(e={}){const t={top:0,right:0,bottom:0,left:0};if(typeof e=="number")return{top:e,right:e,bottom:e,left:e};if(Array.isArray(e)){if(e.length===4)return{top:e[0],right:e[1],bottom:e[2],left:e[3]};if(e.length===2)return{top:e[0],right:e[1],bottom:e[0],left:e[1]}}return Ce(Ce({},t),e)}const M6t={normal:"amap://styles/normal",light:"amap://styles/c422f5c0cfced5be9fe3a83f05f28a68?isPublic=true",dark:"amap://styles/c9f1d10cae34f8ab05e425462c5a58d7?isPublic=true",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true",fresh:"amap://styles/fresh",grey:"amap://styles/grey",graffiti:"amap://styles/graffiti",macaron:"amap://styles/macaron",darkblue:"amap://styles/darkblue",wine:"amap://styles/wine"},R6t=["id","style","minZoom","maxZoom","token","mapInstance","plugin"];function I6t(e,t){var r=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(r||n)&&(t||(t=document),!!t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var a=t.body||t.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):t.documentElement.appendChild(i)}var o=t.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(t.createTextNode(e)),i.appendChild(o),o}}I6t(`.amap-logo {
  display: none !important;
}

.amap-copyright {
  display: none !important;
}

.amap-overlays {
  z-index: 3 !important;
}
`);const L6t="2.0",cH="f59bcf249433f8b05caaee19f349b3d7",fy=1;window.forceWebGL=!0;const hH={contextmenu:"rightclick",camerachange:"viewchange"};class O6t extends m6t{constructor(...t){super(...t),U(this,"viewport",new VS),U(this,"version",ctt.GAODE),U(this,"handleCameraChanged",()=>{const r=this.getViewState();this.updateView(r)})}getType(){return"amap"}init(){var t=this;return Oe(function*(){const r=t.config,{id:n,style:i="light",minZoom:a=0,maxZoom:o=24,token:s=cH,mapInstance:l,plugin:u=[]}=r,c=Gh(r,R6t);if(window.AMap||l||(u.push("Map3D"),yield v6t.load({key:s,version:L6t,plugins:u})),l)t.map=l,t.mapContainer=t.map.getContainer(),t.map.on("viewchange",t.handleCameraChanged);else{const f=Ce({mapStyle:t.getMapStyleValue(i),zooms:[a,o],viewMode:"3D"},c);if(f.zoom&&(f.zoom+=fy),s===cH&&(window._AMapSecurityConfig={securityJsCode:"2653011adeb04230b3a26cc9a780a800"},console.warn(`%c${t.configService.getSceneWarninfo("MapToken")}!`,"color: #873bf4;font-weigh:900;font-size: 16px;")),!n)throw Error("No container id specified");window.forceWebGL=!0,t.mapContainer=t.creatMapContainer(n);const d=new AMap.Map(t.mapContainer,f);t.map=d,d.on("viewchange",t.handleCameraChanged)}t.syncInitViewPort()})()}syncInitViewPort(){const t=this.getViewState();this.updateView(t)}getViewState(){const{center:t,zoom:r}=P6t(this.map);return{center:t,viewportWidth:this.map.getContainer().clientWidth,viewportHeight:this.map.getContainer().clientHeight,bearing:-this.map.getRotation(),pitch:this.map.getPitch(),zoom:r-fy}}creatMapContainer(t){const r=super.creatMapContainer(t),n=document.createElement("div");return n.style.cssText+=`
       position: absolute;
       top: 0;
       height: 100%;
       width: 100%;
     `,n.id=as.uniqueId("l7_amap_div"),r.appendChild(n),n}getContainer(){return this.map.getContainer()}addMarkerContainer(){if(!this.map)return;const t=this.map.getContainer();if(t!==null){const r=t.getElementsByClassName("amap-maps")[0];r.style.zIndex="auto",this.markerContainer=Ua("div","l7-marker-container2",r)}}getMarkerContainer(){return this.markerContainer}getCanvasOverlays(){var t;return(t=this.mapContainer)===null||t===void 0?void 0:t.querySelector(".amap-overlays")}on(t,r){e_.indexOf(t)!==-1?this.eventEmitter.on(t,r):this.map.on(hH[t]||t,r)}off(t,r){e_.indexOf(t)!==-1?this.eventEmitter.off(t,r):this.map.off(hH[t]||t,r)}getSize(){const t=this.map.getSize();return[t.getWidth(),t.getHeight()]}getMinZoom(){return this.map.getZooms()[0]-fy}getMaxZoom(){return this.map.getZooms()[1]-fy}getZoom(){return this.map.getZoom()-fy}getCenter(t){if(t!=null&&t.padding){const n=this.getCenter(),i=uH(t.padding),a=this.lngLatToPixel([n.lng,n.lat]),o=[(i.right-i.left)/2,(i.bottom-i.top)/2];return this.pixelToLngLat([a.x-o[0],a.y-o[1]])}const r=this.map.getCenter();return{lng:r.getLng(),lat:r.getLat()}}getPitch(){return this.map.getPitch()}getRotation(){return 360-this.map.getRotation()}getBounds(){const t=this.map.getBounds(),r=t.getNorthEast(),n=t.getSouthWest(),i=this.getCenter(),a=i.lng>r.getLng()||i.lng<n.getLng()?180-r.getLng():r.getLng();return[[i.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[a,r.getLat()]]}getMapContainer(){return this.mapContainer}getMapCanvasContainer(){var t;return(t=this.map.getContainer())===null||t===void 0?void 0:t.getElementsByClassName("amap-maps")[0]}getMapStyleConfig(){return M6t}getMapStyleValue(t){return this.getMapStyleConfig()[t]||t}getMapStyle(){return this.map.getMapStyle()}setMapStyle(t){this.map.setMapStyle(this.getMapStyleValue(t))}setRotation(t){return this.map.setRotation(t)}zoomIn(){this.map.zoomIn()}zoomOut(){this.map.zoomOut()}panTo(t){this.map.panTo(t)}panBy(t=0,r=0){this.map.panBy(t,r)}fitBounds(t){this.map.setBounds(new AMap.Bounds([t[0][0],t[0][1],t[1][0],t[1][1]]),!0)}setZoomAndCenter(t,r){this.map.setZoomAndCenter(t+fy,r)}setCenter(t,r){if(r!=null&&r.padding){const n=uH(r.padding),i=this.lngLatToPixel(t),a=[(n.right-n.left)/2,(n.bottom-n.top)/2],o=this.pixelToLngLat([i.x+a[0],i.y+a[1]]);this.map.setCenter([o.lng,o.lat])}else this.map.setCenter(t)}setPitch(t){return this.map.setPitch(t)}setZoom(t){return this.map.setZoom(t+fy)}setMaxZoom(t){throw new Error("Method not implemented.")}setMinZoom(t){throw new Error("Method not implemented.")}setMapStatus(t){this.map.setStatus(t)}meterToCoord(t,r){const n=AMap.GeometryUtil.distance(new AMap.LngLat(...t),new AMap.LngLat(...r)),[i,a]=xO(...t),[o,s]=xO(...r);return Math.sqrt(Math.pow(i-o,2)+Math.pow(a-s,2))/n}pixelToLngLat(t){const r=this.map.pixelToLngLat(new AMap.Pixel(t[0],t[1]));return{lng:r.getLng(),lat:r.getLat()}}lngLatToPixel(t){const r=this.map.lnglatToPixel(t);return{x:r.getX(),y:r.getY()}}containerToLngLat(t){const r=new AMap.Pixel(t[0],t[1]),n=this.map.containerToLngLat(r);return{lng:n==null?void 0:n.getLng(),lat:n==null?void 0:n.getLat()}}lngLatToContainer(t){const r=this.map.lngLatToContainer(t);return{x:r.getX(),y:r.getY()}}lngLatToMercator([t,r],n){const[i,a]=xO(t,r);return{x:i,y:a,z:n}}getModelMatrix(t,r,n,i=[1,1,1]){const a=this.viewport.projectFlat(t),o=A_();return Bh(o,o,su(a[0],a[1],r)),Nh(o,o,su(i[0],i[1],i[2])),M_(o,o,n[0]),NS(o,o,n[1]),Fb(o,o,n[2]),o}exportMap(t){var r;const n=(r=this.getContainer())===null||r===void 0?void 0:r.getElementsByClassName("amap-layer")[0];return t==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png")}destroy(){var t;super.destroy(),(t=this.mapContainer)===null||t===void 0||(t=t.parentNode)===null||t===void 0||t.removeChild(this.mapContainer),delete window.initAMap;const r=document.getElementById("amap-script");r&&document.head.removeChild(r),this.map.destroy()}}function P6t(e){const t=e._view.getOptions(),r=t.center,n=t.zoom;return{center:r,zoom:n}}class D4 extends HS{getServiceConstructor(){return O6t}}const D6t={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},fH={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},F6t=12;class KI{constructor(t){U(this,"version","DEFAUlTMAP"),U(this,"map",void 0),U(this,"simpleMapCoord",new itt),U(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),U(this,"config",void 0),U(this,"configService",void 0),U(this,"coordinateSystemService",void 0),U(this,"eventEmitter",void 0),U(this,"markerContainer",void 0),U(this,"cameraChangedCallback",void 0),U(this,"$mapContainer",void 0),U(this,"handleCameraChanged",r=>{const{lat:n,lng:i}=this.map.getCenter();this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:this.map.getBearing(),center:[i,n],viewportHeight:this.map.transform.height,pitch:this.map.getPitch(),viewportWidth:this.map.transform.width,zoom:this.map.getZoom(),cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}),this.config=t.mapConfig,this.configService=t.globalConfigService,this.coordinateSystemService=t.coordinateSystemService,this.eventEmitter=new Gu.EventEmitter}setBgColor(t){this.bgColor=t}addMarkerContainer(){const t=this.map.getCanvasContainer();this.markerContainer=Ua("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}getMarkerContainer(){return this.markerContainer}getOverlayContainer(){}getCanvasOverlays(){}on(t,r){e_.indexOf(t)!==-1?this.eventEmitter.on(t,r):this.map.on(fH[t]||t,r)}off(t,r){this.map.off(fH[t]||t,r),this.eventEmitter.off(t,r)}getContainer(){return this.map.getContainer()}getMapCanvasContainer(){return this.map.getCanvasContainer()}getSize(){if(this.version==="SIMPLE")return this.simpleMapCoord.getSize();const t=this.map.transform;return[t.width,t.height]}getType(){return"default"}getZoom(){return this.map.getZoom()}setZoom(t){return this.map.setZoom(t)}getCenter(){return this.map.getCenter()}setCenter(t){this.map.setCenter(t)}getPitch(){return this.map.getPitch()}getRotation(){return this.map.getBearing()}getBounds(){return this.map.getBounds().toArray()}getMinZoom(){return this.map.getMinZoom()}getMaxZoom(){return this.map.getMaxZoom()}setRotation(t){this.map.setBearing(t)}zoomIn(t,r){this.map.zoomIn(t,r)}zoomOut(t,r){this.map.zoomOut(t,r)}setPitch(t){return this.map.setPitch(t)}panTo(t){this.map.panTo(t)}panBy(t=0,r=0){this.map.panBy([t,r])}fitBounds(t,r){this.map.fitBounds(t,r)}setMaxZoom(t){this.map.setMaxZoom(t)}setMinZoom(t){this.map.setMinZoom(t)}setMapStatus(t){t.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),t.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),t.dragEnable===!1&&this.map.dragPan.disable(),t.dragEnable===!0&&this.map.dragPan.enable(),t.rotateEnable===!1&&this.map.dragRotate.disable(),t.dragEnable===!0&&this.map.dragRotate.enable(),t.keyboardEnable===!1&&this.map.keyboard.disable(),t.keyboardEnable===!0&&this.map.keyboard.enable(),t.zoomEnable===!1&&this.map.scrollZoom.disable(),t.zoomEnable===!0&&this.map.scrollZoom.enable()}setZoomAndCenter(t,r){this.map.flyTo({zoom:t,center:r})}setMapStyle(t){var r;(r=this.map)===null||r===void 0||r.setStyle(this.getMapStyleValue(t))}meterToCoord(t,r){return 1}pixelToLngLat(t){return this.map.unproject(t)}lngLatToPixel(t){return this.map.project(t)}containerToLngLat(t){return this.map.unproject(t)}lngLatToContainer(t){return this.map.project(t)}getMapStyle(){try{var t;const r=(t=this.map.getStyle().sprite)!==null&&t!==void 0?t:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(r)?r==null?void 0:r.replace(/\/\w+$/,"").replace(/sprites/,"styles"):r}catch{return""}}getMapStyleConfig(){return D6t}getMapStyleValue(t){var r;return(r=this.getMapStyleConfig()[t])!==null&&r!==void 0?r:t}destroy(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}emit(t,...r){this.eventEmitter.emit(t,...r)}once(t,...r){this.eventEmitter.once(t,...r)}getMapContainer(){return this.$mapContainer}exportMap(t){var r;const n=(r=this.map)===null||r===void 0?void 0:r.getCanvas();return t==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png")}onCameraChanged(t){this.cameraChangedCallback=t}creatMapContainer(t){let r=t;return typeof t=="string"&&(r=document.getElementById(t)),r}updateView(t){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:t.bearing,center:t.center,viewportHeight:t.viewportHeight,pitch:t.pitch,viewportWidth:t.viewportWidth,zoom:t.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}updateCoordinateSystemService(){const{offsetCoordinate:t=!0}=this.config;this.viewport.getZoom()>F6t&&t?this.coordinateSystemService.setCoordinateSystem(Wx.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(Wx.LNGLAT)}}var B6t=htt;function htt(e,t,r,n){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=r,this.p2y=n}htt.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(t===void 0&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var r=e,n=0;n<8;n++){var i=this.sampleCurveX(r)-e;if(Math.abs(i)<t)return r;var a=this.sampleCurveDerivativeX(r);if(Math.abs(a)<1e-6)break;r=r-i/a}var o=0,s=1;for(r=e,n=0;n<20&&(i=this.sampleCurveX(r),!(Math.abs(i-e)<t));n++)e>i?o=r:s=r,r=(s-o)*.5+o;return r},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};const N6t=sa(B6t),Uf={number:function(t,r,n){return t+n*(r-t)}};function zp(e,t,r){return Math.min(r,Math.max(t,e))}function ax(e,t,r){const n=r-t,i=((e-t)%n+n)%n+t;return i===t?r:i}let k6t=1;function z6t(){return k6t++}function ys(e,...t){for(const r of t)for(const n in r)e[n]=r[n];return e}function U6t(e,t){const r={};for(let n=0;n<t.length;n++){const i=t[n];i in e&&(r[i]=e[i])}return r}function F4(e,t,r,n){const i=new N6t(e,t,r,n);return a=>i.solve(a)}const lF=F4(.25,.1,.25,1),dH={};function $6t(e){dH[e]||(typeof console<"u"&&console.warn(e),dH[e]=!0)}function pH(e){return e*Math.PI/180}const ftt=63710088e-1;class xa{constructor(t,r){if(U(this,"lng",void 0),U(this,"lat",void 0),isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new xa(ax(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,n=this.lat*r,i=t.lat*r,a=Math.sin(n)*Math.sin(i)+Math.cos(n)*Math.cos(i)*Math.cos((t.lng-this.lng)*r);return ftt*Math.acos(Math.min(a,1))}static convert(t){if(t instanceof xa)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new xa(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new xa(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const dtt=2*Math.PI*ftt;function ptt(e){return dtt*Math.cos(e*Math.PI/180)}function oM(e){return(180+e)/360}function sM(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function vtt(e,t){return e/ptt(t)}function H6t(e){return e*360-180}function uF(e){const t=180-e*360;return 360/Math.PI*Math.atan(Math.exp(t*Math.PI/180))-90}function V6t(e,t){return e*ptt(uF(t))}function G6t(e){return 1/Math.cos(e*Math.PI/180)}class Hf{constructor(t,r,n=0){U(this,"x",void 0),U(this,"y",void 0),U(this,"z",void 0),this.x=+t,this.y=+r,this.z=+n}static fromLngLat(t,r=0){const n=xa.convert(t);return new Hf(oM(n.lng),sM(n.lat),vtt(r,n.lat))}toLngLat(){return new xa(H6t(this.x),uF(this.y))}toAltitude(){return V6t(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/dtt*G6t(uF(this.y))}}class Pd{constructor(t,r){U(this,"_ne",void 0),U(this,"_sw",void 0),t&&(r?this.setSouthWest(t).setNorthEast(r):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof xa?new xa(t.lng,t.lat):xa.convert(t),this}setSouthWest(t){return this._sw=t instanceof xa?new xa(t.lng,t.lat):xa.convert(t),this}extend(t){const r=this._sw,n=this._ne;let i,a;if(t instanceof xa)i=t,a=t;else if(t instanceof Pd){if(i=t._sw,a=t._ne,!i||!a)return this}else{if(Array.isArray(t))if(t.length===4||t.every(Array.isArray)){const o=t;return this.extend(Pd.convert(o))}else{const o=t;return this.extend(xa.convert(o))}else if(t&&("lng"in t||"lon"in t)&&"lat"in t)return this.extend(xa.convert(t));return this}return!r&&!n?(this._sw=new xa(i.lng,i.lat),this._ne=new xa(a.lng,a.lat)):(r.lng=Math.min(i.lng,r.lng),r.lat=Math.min(i.lat,r.lat),n.lng=Math.max(a.lng,n.lng),n.lat=Math.max(a.lat,n.lat)),this}getCenter(){return new xa((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new xa(this.getWest(),this.getNorth())}getSouthEast(){return new xa(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:r,lat:n}=xa.convert(t),i=this._sw.lat<=n&&n<=this._ne.lat;let a=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=r&&r>=this._ne.lng),i&&a}static convert(t){return t instanceof Pd?t:new Pd(t)}static fromLngLat(t,r=0){const i=360*r/40075017,a=i/Math.cos(Math.PI/180*t.lat);return new Pd(new xa(t.lng-a,t.lat-i),new xa(t.lng+a,t.lat+i))}}const W6t="AbortError";function X6t(){return new Error(W6t)}const j6t=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date);let VO;const Vf={now:j6t,frameAsync(e){return new Promise((t,r)=>{const n=requestAnimationFrame(t);e.signal.addEventListener("abort",()=>{cancelAnimationFrame(n),r(X6t())})})},get prefersReducedMotion(){return window.matchMedia?(VO==null&&(VO=window.matchMedia("(prefers-reduced-motion: reduce)")),VO.matches):!1}};function vH(e,t,r){r[e]&&r[e].indexOf(t)!==-1||(r[e]=r[e]||[],r[e].push(t))}function GO(e,t,r){if(r&&r[e]){const n=r[e].indexOf(t);n!==-1&&r[e].splice(n,1)}}let Wi=class{constructor(t,r={}){U(this,"type",void 0),ys(this,r),this.type=t}};class Y6t extends Wi{constructor(t,r={}){super("error",r),U(this,"error",void 0),this.error=t}}class Z6t{constructor(){U(this,"_listeners",void 0),U(this,"_oneTimeListeners",void 0),U(this,"_eventedParent",void 0),U(this,"_eventedParentData",void 0)}on(t,r){return this._listeners=this._listeners||{},vH(t,r,this._listeners),this}off(t,r){return GO(t,r,this._listeners),GO(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},vH(t,r,this._oneTimeListeners),this):new Promise(n=>this.once(t,n))}fire(t,r){typeof t=="string"&&(t=new Wi(t,r||{}));const n=t.type;if(this.listens(n)){t.target=this;const i=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const s of i)s.call(this,t);const a=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const s of a)GO(n,s,this._oneTimeListeners),s.call(this,t);const o=this._eventedParent;o&&(ys(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),o.fire(t))}else t instanceof Y6t&&console.error(t.error);return this}emit(t,r){return this.fire(t,r)}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return t&&(this._eventedParent=t),this._eventedParentData=r,this}}class q6t extends Z6t{constructor(t,r){super(),U(this,"transform",void 0),U(this,"handlers",void 0),U(this,"_moving",void 0),U(this,"_zooming",void 0),U(this,"_rotating",void 0),U(this,"_pitching",void 0),U(this,"_padding",void 0),U(this,"_bearingSnap",void 0),U(this,"_easeStart",void 0),U(this,"_easeOptions",void 0),U(this,"_easeId",void 0),U(this,"_onEaseFrame",void 0),U(this,"_onEaseEnd",void 0),U(this,"_easeFrameId",void 0),U(this,"_requestedCameraState",void 0),U(this,"transformCameraUpdate",void 0),U(this,"_renderFrameCallback",()=>{const n=Math.min((Vf.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(n)),n<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=r.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new xa(this.transform.center.lng,this.transform.center.lat)}setCenter(t,r){return this.jumpTo({center:t},r)}panBy(t,r,n){return t=ca.convert(t).mult(-1),this.panTo(this.transform.center,ys({offset:t},r),n)}panTo(t,r,n){return this.easeTo(ys({center:t},r),n)}getZoom(){return this.transform.zoom}setZoom(t,r){return this.jumpTo({zoom:t},r),this}zoomTo(t,r,n){return this.easeTo(ys({zoom:t},r),n)}zoomIn(t,r){return this.zoomTo(this.getZoom()+1,t,r),this}zoomOut(t,r){return this.zoomTo(this.getZoom()-1,t,r),this}getBearing(){return this.transform.bearing}setBearing(t,r){return this.jumpTo({bearing:t},r),this}getPadding(){return this.transform.padding}setPadding(t,r){return this.jumpTo({padding:t},r),this}rotateTo(t,r,n){return this.easeTo(ys({bearing:t},r),n)}resetNorth(t,r){return this.rotateTo(0,ys({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(ys({bearing:0,pitch:0,duration:1e3},t),r),this}snapToNorth(t,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,r):this}getPitch(){return this.transform.pitch}setPitch(t,r){return this.jumpTo({pitch:t},r),this}cameraForBounds(t,r){t=Pd.convert(t);const n=r&&r.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),n,r)}_cameraForBoxAndBearing(t,r,n,i){const a={top:0,bottom:0,right:0,left:0};if(i=ys({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},i),typeof i.padding=="number"){const vt=i.padding;i.padding={top:vt,bottom:vt,right:vt,left:vt}}i.padding=ys(a,i.padding);const o=this.transform,s=o.padding,l=new Pd(t,r),u=o.project(l.getNorthWest()),c=o.project(l.getNorthEast()),f=o.project(l.getSouthEast()),d=o.project(l.getSouthWest()),v=pH(-n),g=u.rotate(v),x=c.rotate(v),w=f.rotate(v),S=d.rotate(v),M=new ca(Math.max(g.x,x.x,S.x,w.x),Math.max(g.y,x.y,S.y,w.y)),R=new ca(Math.min(g.x,x.x,S.x,w.x),Math.min(g.y,x.y,S.y,w.y)),I=M.sub(R),P=(o.width-(s.left+s.right+i.padding.left+i.padding.right))/I.x,k=(o.height-(s.top+s.bottom+i.padding.top+i.padding.bottom))/I.y;if(k<0||P<0){$6t("Map cannot fit within canvas with the given bounds, padding, and/or offset.");return}const z=Math.min(o.scaleZoom(o.scale*Math.min(P,k)),i.maxZoom),G=ca.convert(i.offset),J=(i.padding.left-i.padding.right)/2,Z=(i.padding.top-i.padding.bottom)/2,et=new ca(J,Z).rotate(pH(n)),wt=G.add(et).mult(o.scale/o.zoomScale(z));return{center:o.unproject(u.add(f).div(2).sub(wt)),zoom:z,bearing:n}}fitBounds(t,r,n){return this._fitInternal(this.cameraForBounds(t,r),r,n)}fitScreenCoordinates(t,r,n,i,a){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(ca.convert(t)),this.transform.pointLocation(ca.convert(r)),n,i),i,a)}_fitInternal(t,r,n){return t?(r=ys(t,r),delete r.padding,r.linear?this.easeTo(r,n):this.flyTo(r,n)):this}jumpTo(t,r){this.stop();const n=this._getTransformForUpdate();let i=!1,a=!1,o=!1;return"zoom"in t&&n.zoom!==+t.zoom&&(i=!0,n.zoom=+t.zoom),t.center!==void 0&&(n.center=xa.convert(t.center)),"bearing"in t&&n.bearing!==+t.bearing&&(a=!0,n.bearing=+t.bearing),"pitch"in t&&n.pitch!==+t.pitch&&(o=!0,n.pitch=+t.pitch),t.padding!=null&&!n.isPaddingEqual(t.padding)&&(n.padding=t.padding),this._applyUpdatedTransform(n),this.fire(new Wi("movestart",r)).fire(new Wi("move",r)),i&&this.fire(new Wi("zoomstart",r)).fire(new Wi("zoom",r)).fire(new Wi("zoomend",r)),a&&this.fire(new Wi("rotatestart",r)).fire(new Wi("rotate",r)).fire(new Wi("rotateend",r)),o&&this.fire(new Wi("pitchstart",r)).fire(new Wi("pitch",r)).fire(new Wi("pitchend",r)),this.fire(new Wi("moveend",r))}calculateCameraOptionsFromTo(t,r,n,i=0){const a=Hf.fromLngLat(t,r),o=Hf.fromLngLat(n,i),s=o.x-a.x,l=o.y-a.y,u=o.z-a.z,c=Math.hypot(s,l,u);if(c===0)throw new Error("Can't calculate camera options with same From and To");const f=Math.hypot(s,l),d=this.transform.scaleZoom(this.transform.cameraToCenterDistance/c/this.transform.tileSize),v=Math.atan2(s,-l)*180/Math.PI;let g=Math.acos(f/c)*180/Math.PI;return g=u<0?90-g:90+g,{center:o.toLngLat(),zoom:d,pitch:g,bearing:v}}easeTo(t,r){var n;this._stop(!1,t.easeId),t=ys({offset:[0,0],duration:500,easing:lF},t),(t.animate===!1||!t.essential&&Vf.prefersReducedMotion)&&(t.duration=0);const i=this._getTransformForUpdate(),a=this.getZoom(),o=this.getBearing(),s=this.getPitch(),l=this.getPadding(),u="bearing"in t?this._normalizeBearing(t.bearing,o):o,c="pitch"in t?+t.pitch:s,f="padding"in t?t.padding:i.padding,d=ca.convert(t.offset);let v=i.centerPoint.add(d);const g=i.pointLocation(v),{center:x,zoom:w}=i.getConstrained(xa.convert(t.center||g),(n=t.zoom)!==null&&n!==void 0?n:a);this._normalizeCenter(x);const S=i.project(g),M=i.project(x).sub(S),R=i.zoomScale(w-a);let I,P;t.around&&(I=xa.convert(t.around),P=i.locationPoint(I));const k={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||w!==a,this._rotating=this._rotating||o!==u,this._pitching=this._pitching||c!==s,this._padding=!i.isPaddingEqual(f),this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,k),this._ease(z=>{if(this._zooming&&(i.zoom=Uf.number(a,w,z)),this._rotating&&(i.bearing=Uf.number(o,u,z)),this._pitching&&(i.pitch=Uf.number(s,c,z)),this._padding&&(i.interpolatePadding(l,f,z),v=i.centerPoint.add(d)),I)i.setLocationAtPoint(I,P);else{const G=i.zoomScale(i.zoom-a),J=w>a?Math.min(2,R):Math.max(.5,R),Z=Math.pow(J,1-z),X=i.unproject(S.add(M.mult(z*Z)).mult(G));i.setLocationAtPoint(i.renderWorldCopies?X.wrap():X,v)}this._applyUpdatedTransform(i),this._fireMoveEvents(r)},z=>{this._afterEase(r,z)},t),this}_prepareEase(t,r,n={}){this._moving=!0,!r&&!n.moving&&this.fire(new Wi("movestart",t)),this._zooming&&!n.zooming&&this.fire(new Wi("zoomstart",t)),this._rotating&&!n.rotating&&this.fire(new Wi("rotatestart",t)),this._pitching&&!n.pitching&&this.fire(new Wi("pitchstart",t))}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const r=t.clone(),{center:n,zoom:i,pitch:a,bearing:o,elevation:s}=this.transformCameraUpdate(r);n&&(r.center=n),i!==void 0&&(r.zoom=i),a!==void 0&&(r.pitch=a),o!==void 0&&(r.bearing=o),s!==void 0&&(r.elevation=s),this.transform.apply(r)}_fireMoveEvents(t){this.fire(new Wi("move",t)),this._zooming&&this.fire(new Wi("zoom",t)),this._rotating&&this.fire(new Wi("rotate",t)),this._pitching&&this.fire(new Wi("pitch",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;delete this._easeId;const n=this._zooming,i=this._rotating,a=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,n&&this.fire(new Wi("zoomend",t)),i&&this.fire(new Wi("rotateend",t)),a&&this.fire(new Wi("pitchend",t)),this.fire(new Wi("moveend",t))}flyTo(t,r){var n;if(!t.essential&&Vf.prefersReducedMotion){const zt=U6t(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(zt,r)}this.stop(),t=ys({offset:[0,0],speed:1.2,curve:1.42,easing:lF},t);const i=this._getTransformForUpdate(),a=this.getZoom(),o=this.getBearing(),s=this.getPitch(),l=this.getPadding(),u="bearing"in t?this._normalizeBearing(t.bearing,o):o,c="pitch"in t?+t.pitch:s,f="padding"in t?t.padding:i.padding,d=ca.convert(t.offset);let v=i.centerPoint.add(d);const g=i.pointLocation(v),{center:x,zoom:w}=i.getConstrained(xa.convert(t.center||g),(n=t.zoom)!==null&&n!==void 0?n:a);this._normalizeCenter(x);const S=i.zoomScale(w-a),M=i.project(g),R=i.project(x).sub(M);let I=t.curve;const P=Math.max(i.width,i.height),k=P/S,z=R.mag();if("minZoom"in t){const zt=zp(Math.min(t.minZoom,a,w),i.minZoom,i.maxZoom),oe=P/i.zoomScale(zt-a);I=Math.sqrt(oe/z*2)}const G=I*I;function J(zt){const oe=(k*k-P*P+(zt?-1:1)*G*G*z*z)/(2*(zt?k:P)*G*z);return Math.log(Math.sqrt(oe*oe+1)-oe)}function Z(zt){return(Math.exp(zt)-Math.exp(-zt))/2}function X(zt){return(Math.exp(zt)+Math.exp(-zt))/2}function et(zt){return Z(zt)/X(zt)}const at=J(!1);let wt=function(zt){return X(at)/X(at+I*zt)},Tt=function(zt){return P*((X(at)*et(at+I*zt)-Z(at))/G)/z},vt=(J(!0)-at)/I;if(Math.abs(z)<1e-6||!isFinite(vt)){if(Math.abs(P-k)<1e-6)return this.easeTo(t,r);const zt=k<P?-1:1;vt=Math.abs(Math.log(k/P))/I,Tt=()=>0,wt=oe=>Math.exp(zt*I*oe)}if("duration"in t)t.duration=+t.duration;else{const zt="screenSpeed"in t?+t.screenSpeed/I:+t.speed;t.duration=1e3*vt/zt}return t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=o!==u,this._pitching=c!==s,this._padding=!i.isPaddingEqual(f),this._prepareEase(r,!1),this._ease(zt=>{const oe=zt*vt,Qt=1/wt(oe);i.zoom=zt===1?w:a+i.scaleZoom(Qt),this._rotating&&(i.bearing=Uf.number(o,u,zt)),this._pitching&&(i.pitch=Uf.number(s,c,zt)),this._padding&&(i.interpolatePadding(l,f,zt),v=i.centerPoint.add(d));const ne=zt===1?x:i.unproject(M.add(R.mult(Tt(oe))).mult(Qt));i.setLocationAtPoint(i.renderWorldCopies?ne.wrap():ne,v),this._applyUpdatedTransform(i),this._fireMoveEvents(r)},()=>{this._afterEase(r)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,r){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const i=this._onEaseEnd;delete this._onEaseEnd,i.call(this,r)}if(!t){var n;(n=this.handlers)===null||n===void 0||n.stop(!1)}return this}_ease(t,r,n){n.animate===!1||n.duration===0?(t(1),r()):(this._easeStart=Vf.now(),this._easeOptions=n,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,r){t=ax(t,-180,180);const n=Math.abs(t-r);return Math.abs(t-360-r)<n&&(t-=360),Math.abs(t+360-r)<n&&(t+=360),t}_normalizeCenter(t){const r=this.transform;if(!r.renderWorldCopies||r.lngRange)return;const n=t.lng-r.center.lng;t.lng+=n>180?-360:n<-180?360:0}}class B4{constructor(t=0,r=0,n=0,i=0){if(U(this,"top",void 0),U(this,"bottom",void 0),U(this,"left",void 0),U(this,"right",void 0),isNaN(t)||t<0||isNaN(r)||r<0||isNaN(n)||n<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=r,this.left=n,this.right=i}interpolate(t,r,n){return r.top!=null&&t.top!=null&&(this.top=Uf.number(t.top,r.top,n)),r.bottom!=null&&t.bottom!=null&&(this.bottom=Uf.number(t.bottom,r.bottom,n)),r.left!=null&&t.left!=null&&(this.left=Uf.number(t.left,r.left,n)),r.right!=null&&t.right!=null&&(this.right=Uf.number(t.right,r.right,n)),this}getCenter(t,r){const n=zp((this.left+t-this.right)/2,0,t),i=zp((this.top+r-this.bottom)/2,0,r);return new ca(n,i)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new B4(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const kT=85.051129;class N4{constructor(t,r,n,i,a){U(this,"tileSize",void 0),U(this,"tileZoom",void 0),U(this,"lngRange",void 0),U(this,"latRange",void 0),U(this,"scale",void 0),U(this,"width",void 0),U(this,"height",void 0),U(this,"angle",void 0),U(this,"rotationMatrix",void 0),U(this,"pixelsToGLUnits",void 0),U(this,"cameraToCenterDistance",void 0),U(this,"mercatorMatrix",void 0),U(this,"projMatrix",void 0),U(this,"invProjMatrix",void 0),U(this,"alignedProjMatrix",void 0),U(this,"pixelMatrix",void 0),U(this,"pixelMatrix3D",void 0),U(this,"pixelMatrixInverse",void 0),U(this,"glCoordMatrix",void 0),U(this,"labelPlaneMatrix",void 0),U(this,"minElevationForCurrentTile",void 0),U(this,"_fov",void 0),U(this,"_pitch",void 0),U(this,"_zoom",void 0),U(this,"_unmodified",void 0),U(this,"_renderWorldCopies",void 0),U(this,"_minZoom",void 0),U(this,"_maxZoom",void 0),U(this,"_minPitch",void 0),U(this,"_maxPitch",void 0),U(this,"_center",void 0),U(this,"_elevation",void 0),U(this,"_pixelPerMeter",void 0),U(this,"_edgeInsets",void 0),U(this,"_constraining",void 0),U(this,"_posMatrixCache",void 0),U(this,"_alignedPosMatrixCache",void 0),this.tileSize=512,this._renderWorldCopies=a===void 0?!0:!!a,this._minZoom=t||0,this._maxZoom=r||22,this._minPitch=n??0,this._maxPitch=i??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new xa(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new B4,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const t=new N4(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this.minElevationForCurrentTile=t.minElevationForCurrentTile,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new ca(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const r=-ax(t,-180,180)*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=zIt(),UIt(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const r=zp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const r=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==r&&(this._unmodified=!1,this._zoom=r,this.tileZoom=Math.max(0,Math.floor(r)),this.scale=this.zoomScale(r),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,r,n){this._unmodified=!1,this._edgeInsets.interpolate(t,r,n),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const r=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,r)}resize(t,r){this.width=t,this.height=r,this.pixelsToGLUnits=[2/t,-2/r],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const r=zp(t.lat,-kT,kT);return new ca(oM(t.lng)*this.worldSize,sM(r)*this.worldSize)}unproject(t){return new Hf(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){const t=this.pointLocation(this.getCameraPoint()),r=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter;return{lngLat:t,altitude:r+this.elevation}}setLocationAtPoint(t,r){const n=this.pointCoordinate(r),i=this.pointCoordinate(this.centerPoint),a=this.locationCoordinate(t),o=new Hf(a.x-(n.x-i.x),a.y-(n.y-i.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t){return this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}locationCoordinate(t){return Hf.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t){const n=[t.x,t.y,0,1],i=[t.x,t.y,1,1];Dm(n,n,this.pixelMatrixInverse),Dm(i,i,this.pixelMatrixInverse);const a=n[3],o=i[3],s=n[0]/a,l=i[0]/o,u=n[1]/a,c=i[1]/o,f=n[2]/a,d=i[2]/o,v=f===d?0:(0-f)/(d-f);return new Hf(Uf.number(s,l,v)/this.worldSize,Uf.number(u,c,v)/this.worldSize)}coordinatePoint(t,r=0,n=this.pixelMatrix){const i=[t.x*this.worldSize,t.y*this.worldSize,r,1];return Dm(i,i,n),new ca(i[0]/i[3],i[1]/i[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new Pd().extend(this.pointLocation(new ca(0,t))).extend(this.pointLocation(new ca(this.width,t))).extend(this.pointLocation(new ca(this.width,this.height))).extend(this.pointLocation(new ca(0,this.height)))}getMaxBounds(){return!this.latRange||this.latRange.length!==2||!this.lngRange||this.lngRange.length!==2?null:new Pd([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]])}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-kT,kT])}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(t,r){r=zp(+r,this.minZoom,this.maxZoom);const n={center:new xa(t.lng,t.lat),zoom:r};let i=this.lngRange;if(!this._renderWorldCopies&&i===null){const P=179.9999999999;i=[-P,P]}const a=this.tileSize*this.zoomScale(n.zoom);let o=0,s=a,l=0,u=a,c=0,f=0;const{x:d,y:v}=this.size;if(this.latRange){const P=this.latRange;o=sM(P[1])*a,s=sM(P[0])*a,s-o<v&&(c=v/(s-o))}i&&(l=ax(oM(i[0])*a,0,a),u=ax(oM(i[1])*a,0,a),u<l&&(u+=a),u-l<d&&(f=d/(u-l)));const{x:g,y:x}=this.project.call({worldSize:a},t);let w,S;const M=Math.max(f||0,c||0);if(M){const P=new ca(f?(u+l)/2:g,c?(s+o)/2:x);return n.center=this.unproject.call({worldSize:a},P).wrap(),n.zoom+=this.scaleZoom(M),n}if(this.latRange){const P=v/2;x-P<o&&(S=o+P),x+P>s&&(S=s-P)}if(i){const P=(l+u)/2;let k=g;this._renderWorldCopies&&(k=ax(g,P-a/2,P+a/2));const z=d/2;k-z<l&&(w=l+z),k+z>u&&(w=u-z)}if(w!==void 0||S!==void 0){var R,I;const P=new ca((R=w)!==null&&R!==void 0?R:g,(I=S)!==null&&I!==void 0?I:x);n.center=this.unproject.call({worldSize:a},P).wrap()}return n}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:r,zoom:n}=this.getConstrained(this.center,this.zoom);this.center=r,this.zoom=n,this._unmodified=t,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this._fov/2,r=this.centerOffset,n=this.point.x,i=this.point.y;this.cameraToCenterDistance=.5/Math.tan(t)*this.height,this._pixelPerMeter=vtt(1,this.center.lat)*this.worldSize;let a=HU(new Float64Array(16));Nh(a,a,[this.width/2,-this.height/2,1]),Bh(a,a,[1,-1,0]),this.labelPlaneMatrix=a,a=HU(new Float64Array(16)),Nh(a,a,[1,-1,1]),Bh(a,a,[-1,-1,0]),Nh(a,a,[2/this.width,2/this.height,1]),this.glCoordMatrix=a;const o=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),s=Math.min(this.elevation,this.minElevationForCurrentTile),l=o-s*this._pixelPerMeter/Math.cos(this._pitch),u=s<0?l:o,c=Math.PI/2+this._pitch,f=this._fov*(.5+r.y/this.height),d=Math.sin(f)*u/Math.sin(zp(Math.PI-c-f,.01,Math.PI-.01)),v=this.getHorizon(),x=2*Math.atan(v/this.cameraToCenterDistance)*(.5+r.y/(v*2)),w=Math.sin(x)*u/Math.sin(zp(Math.PI-c-x,.01,Math.PI-.01)),S=Math.min(d,w),M=(Math.cos(Math.PI/2-this._pitch)*S+u)*1.01,R=this.height/50;a=new Float64Array(16),gQ(a,this._fov,this.width/this.height,R,M),a[8]=-r.x*2/this.width,a[9]=r.y*2/this.height,Nh(a,a,[1,-1,1]),Bh(a,a,[0,0,-this.cameraToCenterDistance]),M_(a,a,this._pitch),Fb(a,a,this.angle),Bh(a,a,[-n,-i,0]),this.mercatorMatrix=Nh([],a,[this.worldSize,this.worldSize,this.worldSize]),Nh(a,a,[1,1,this._pixelPerMeter]),this.pixelMatrix=Wm(new Float64Array(16),this.labelPlaneMatrix,a),Bh(a,a,[0,0,-this.elevation]),this.projMatrix=a,this.invProjMatrix=EC([],a),this.pixelMatrix3D=Wm(new Float64Array(16),this.labelPlaneMatrix,a);const I=this.width%2/2,P=this.height%2/2,k=Math.cos(this.angle),z=Math.sin(this.angle),G=n-Math.round(n)+k*I+z*P,J=i-Math.round(i)+k*P+z*I,Z=new Float64Array(a);if(Bh(Z,Z,[G>.5?G-1:G,J>.5?J-1:J,0]),this.alignedProjMatrix=Z,a=EC(new Float64Array(16),this.pixelMatrix),!a)throw new Error("failed to invert matrix");this.pixelMatrixInverse=a,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new ca(0,0)),r=[t.x*this.worldSize,t.y*this.worldSize,0,1];return Dm(r,r,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=this._pitch,r=Math.tan(t)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new ca(0,r))}getCameraQueryGeometry(t){const r=this.getCameraPoint();if(t.length===1)return[t[0],r];{let n=r.x,i=r.y,a=r.x,o=r.y;for(const s of t)n=Math.min(n,s.x),i=Math.min(i,s.y),a=Math.max(a,s.x),o=Math.max(o,s.y);return[new ca(n,i),new ca(a,i),new ca(a,o),new ca(n,o),new ca(n,i)]}}lngLatToCameraDepth(t,r){const n=this.locationCoordinate(t),i=[n.x*this.worldSize,n.y*this.worldSize,r,1];return Dm(i,i,this.projMatrix),i[2]/i[3]}}var k4;class Yn{static testProp(t){if(!Yn.docStyle)return t[0];for(let r=0;r<t.length;r++)if(t[r]in Yn.docStyle)return t[r];return t[0]}static create(t,r,n){const i=window.document.createElement(t);return r!==void 0&&(i.className=r),n&&n.appendChild(i),i}static createNS(t,r){return window.document.createElementNS(t,r)}static disableDrag(){Yn.docStyle&&Yn.selectProp&&(Yn.userSelect=Yn.docStyle[Yn.selectProp],Yn.docStyle[Yn.selectProp]="none")}static enableDrag(){Yn.docStyle&&Yn.selectProp&&(Yn.docStyle[Yn.selectProp]=Yn.userSelect)}static setTransform(t,r){t.style[Yn.transformProp]=r}static addEventListener(t,r,n,i={}){"passive"in i?t.addEventListener(r,n,i):t.addEventListener(r,n,i.capture)}static removeEventListener(t,r,n,i={}){"passive"in i?t.removeEventListener(r,n,i):t.removeEventListener(r,n,i.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",Yn.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Yn.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",Yn.suppressClickInternal,!0)},0)}static getScale(t){const r=t.getBoundingClientRect();return{x:r.width/t.offsetWidth||1,y:r.height/t.offsetHeight||1,boundingClientRect:r}}static getPoint(t,r,n){const i=r.boundingClientRect;return new ca((n.clientX-i.left)/r.x-t.clientLeft,(n.clientY-i.top)/r.y-t.clientTop)}static mousePos(t,r){const n=Yn.getScale(t);return Yn.getPoint(t,n,r)}static touchPos(t,r){const n=[],i=Yn.getScale(t);for(let a=0;a<r.length;a++)n.push(Yn.getPoint(t,i,r[a]));return n}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}k4=Yn;U(Yn,"docStyle",typeof window<"u"&&window.document&&window.document.documentElement.style);U(Yn,"userSelect",void 0);U(Yn,"selectProp",k4.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]));U(Yn,"transformProp",k4.testProp(["transform","WebkitTransform"]));class GS{constructor(t){U(this,"_map",void 0),this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(ca.convert(t))}}class K6t{constructor(t,r){U(this,"_map",void 0),U(this,"_tr",void 0),U(this,"_el",void 0),U(this,"_container",void 0),U(this,"_enabled",void 0),U(this,"_active",void 0),U(this,"_startPos",void 0),U(this,"_lastPos",void 0),U(this,"_box",void 0),U(this,"_clickTolerance",void 0),this._map=t,this._tr=new GS(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,r){this.isEnabled()&&t.shiftKey&&t.button===0&&(Yn.disableDrag(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(t,r){if(!this._active)return;const n=r;if(this._lastPos.equals(n)||!this._box&&n.dist(this._startPos)<this._clickTolerance)return;const i=this._startPos;this._lastPos=n,this._box||(this._box=Yn.create("div","l7-boxzoom",this._container),this._container.classList.add("l7-crosshair"),this._fireEvent("boxzoomstart",t));const a=Math.min(i.x,n.x),o=Math.max(i.x,n.x),s=Math.min(i.y,n.y),l=Math.max(i.y,n.y);Yn.setTransform(this._box,`translate(${a}px,${s}px)`),this._box.style.width=`${o-a}px`,this._box.style.height=`${l-s}px`}mouseupWindow(t,r){if(!this._active||t.button!==0)return;const n=this._startPos,i=r;if(this.reset(),Yn.suppressClick(),n.x===i.x&&n.y===i.y)this._fireEvent("boxzoomcancel",t);else return this._map.fire(new Wi("boxzoomend",{originalEvent:t})),{cameraAnimation:a=>a.fitScreenCoordinates(n,i,this._tr.bearing,{linear:!0})}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("l7-crosshair"),this._box&&(Yn.remove(this._box),this._box=null),Yn.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new Wi(t,{originalEvent:r}))}}class Q6t{constructor(t){U(this,"_tr",void 0),U(this,"_enabled",void 0),U(this,"_active",void 0),this._tr=new GS(t),this.reset()}reset(){this._active=!1}dblclick(t,r){return t.preventDefault(),{cameraAnimation:n=>{n.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(r)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class J6t{constructor(t,r){U(this,"_options",void 0),U(this,"_map",void 0),U(this,"_container",void 0),U(this,"_bypassKey",navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey"),U(this,"_enabled",void 0),this._map=t,this._options=r,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("l7-cooperative-gestures"),this._container=Yn.create("div","l7-cooperative-gesture-screen",t);const r=document.createElement("div");r.className="l7-desktop-message",r.textContent="Missing UI string",this._container.appendChild(r);const n=document.createElement("div");n.className="l7-mobile-message",n.textContent="Missing UI string",this._container.appendChild(n),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(Yn.remove(this._container),this._map.getCanvasContainer().classList.remove("l7-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(t){this._onCooperativeGesture(t.touches.length===1)}wheel(t){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!t[this._bypassKey])}_onCooperativeGesture(t){!this._enabled||!t||(this._container.classList.add("l7-show"),setTimeout(()=>{this._container.classList.remove("l7-show")},100))}}const t8t={panStep:100,bearingStep:15,pitchStep:10};class e8t{constructor(t){U(this,"_tr",void 0),U(this,"_enabled",void 0),U(this,"_active",void 0),U(this,"_panStep",void 0),U(this,"_bearingStep",void 0),U(this,"_pitchStep",void 0),U(this,"_rotationDisabled",void 0),this._tr=new GS(t);const r=t8t;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let r=0,n=0,i=0,a=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?n=-1:(t.preventDefault(),a=-1);break;case 39:t.shiftKey?n=1:(t.preventDefault(),a=1);break;case 38:t.shiftKey?i=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?i=-1:(t.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(n=0,i=0),{cameraAnimation:s=>{const l=this._tr;s.easeTo({duration:300,easeId:"keyboardHandler",easing:r8t,zoom:r?Math.round(l.zoom)+r*(t.shiftKey?2:1):l.zoom,bearing:l.bearing+n*this._bearingStep,pitch:l.pitch+i*this._pitchStep,offset:[-a*this._panStep,-o*this._panStep],center:l.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function r8t(e){return e*(2-e)}class n8t{constructor(t){U(this,"size",1e4),this.size=t||1e4}setSize(t){this.size=t}getSize(){return[this.size,this.size]}mercatorXfromLng(t){return(180+t)/360*this.size}mercatorYfromLat(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}lngFromMercatorX(t){return t/this.size*360-180}latFromMercatorY(t){const r=180-(1-t/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90}project(t){const r=this.mercatorXfromLng(t[0]),n=this.mercatorYfromLat(t[1]);return[r,n]}unproject(t){const r=this.lngFromMercatorX(t[0]),n=this.latFromMercatorY(t[1]);return[r,n]}}class tg extends Wi{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,n,i={}){super(t,i),U(this,"target",void 0),U(this,"originalEvent",void 0),U(this,"point",void 0),U(this,"lngLat",void 0),U(this,"_defaultPrevented",void 0);const a=Yn.mousePos(r.getCanvasContainer(),n),o=r.unproject(a);if(this.point=a,this.lngLat=o,this.originalEvent=n,this._defaultPrevented=!1,this.target=r,r.version==="SIMPLE"){const s=new n8t(r.mapSize),[l,u]=s.project([o.lng,o.lat]);this.lngLat={lng:l,lat:u}}}}class zT extends Wi{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,n){super(t),U(this,"target",void 0),U(this,"originalEvent",void 0),U(this,"lngLat",void 0),U(this,"point",void 0),U(this,"points",void 0),U(this,"lngLats",void 0),U(this,"_defaultPrevented",void 0);const i=t==="touchend"?n.changedTouches:n.touches,a=Yn.touchPos(r.getCanvasContainer(),i),o=a.map(u=>r.unproject(u)),s=a.reduce((u,c,f,d)=>u.add(c.div(d.length)),new ca(0,0)),l=r.unproject(s);this.target=r,this.points=a,this.point=s,this.lngLats=o,this.lngLat=l,this.originalEvent=n,this._defaultPrevented=!1}}class i8t extends Wi{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,n){super(t),U(this,"target",void 0),U(this,"originalEvent",void 0),U(this,"_defaultPrevented",void 0),this.target=r,this._defaultPrevented=!1,this.originalEvent=n}}class a8t{constructor(t,r){U(this,"_mousedownPos",void 0),U(this,"_clickTolerance",void 0),U(this,"_map",void 0),this._map=t,this._clickTolerance=r.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new i8t(t.type,this._map,t))}mousedown(t,r){return this._mousedownPos=r,this._firePreventable(new tg(t.type,this._map,t))}mouseup(t){this._map.fire(new tg(t.type,this._map,t))}click(t,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||this._map.fire(new tg(t.type,this._map,t))}dblclick(t){return this._firePreventable(new tg(t.type,this._map,t))}mouseover(t){this._map.fire(new tg(t.type,this._map,t))}mouseout(t){this._map.fire(new tg(t.type,this._map,t))}touchstart(t){return this._firePreventable(new zT(t.type,this._map,t))}touchmove(t){this._map.fire(new zT(t.type,this._map,t))}touchend(t){this._map.fire(new zT(t.type,this._map,t))}touchcancel(t){this._map.fire(new zT(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class o8t{constructor(t){U(this,"_map",void 0),U(this,"_delayContextMenu",void 0),U(this,"_ignoreContextMenu",void 0),U(this,"_contextMenuEvent",void 0),this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new tg(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new tg("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new tg(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class z4{constructor(t){U(this,"contextmenu",void 0),U(this,"mousedown",void 0),U(this,"mousemoveWindow",void 0),U(this,"mouseup",void 0),U(this,"touchstart",void 0),U(this,"touchmoveWindow",void 0),U(this,"touchend",void 0),U(this,"_clickTolerance",void 0),U(this,"_moveFunction",void 0),U(this,"_activateOnStart",void 0),U(this,"_active",void 0),U(this,"_enabled",void 0),U(this,"_moved",void 0),U(this,"_lastPoint",void 0),U(this,"_moveStateManager",void 0),this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const r=this._moveFunction(...t);if(r.bearingDelta||r.pitchDelta||r.around||r.panDelta)return this._active=!0,r}dragStart(t,r){!this.isEnabled()||this._lastPoint||this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=r.length?r[0]:r,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,r){if(!this.isEnabled())return;const n=this._lastPoint;if(!n)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t)){this.reset(t);return}const i=r.length?r[0]:r;if(!(!this._moved&&i.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=i,this._move(n,i)}dragEnd(t){!this.isEnabled()||!this._lastPoint||this._moveStateManager.isValidEndEvent(t)&&(this._moved&&Yn.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const s8t=0,l8t=2,u8t={[s8t]:1,[l8t]:2};function c8t(e,t){const r=u8t[t];return e.buttons===void 0||(e.buttons&r)!==r}class U4{constructor(t){U(this,"_eventButton",void 0),U(this,"_correctEvent",void 0),this._correctEvent=t.checkCorrectEvent}startMove(t){const r=Yn.mouseButton(t);this._eventButton=r}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!c8t(t,this._eventButton)}isValidEndEvent(t){return Yn.mouseButton(t)===this._eventButton}}const $4=0,gtt=2,H4=e=>{e.mousedown=e.dragStart,e.mousemoveWindow=e.dragMove,e.mouseup=e.dragEnd,e.contextmenu=t=>{t.preventDefault()}},h8t=({enable:e,clickTolerance:t})=>{const r=new U4({checkCorrectEvent:n=>Yn.mouseButton(n)===$4&&!n.ctrlKey});return new z4({clickTolerance:t,move:(n,i)=>({around:i,panDelta:i.sub(n)}),activateOnStart:!0,moveStateManager:r,enable:e,assignEvents:H4})},f8t=({enable:e,clickTolerance:t,bearingDegreesPerPixelMoved:r=.8})=>{const n=new U4({checkCorrectEvent:i=>Yn.mouseButton(i)===$4&&i.ctrlKey||Yn.mouseButton(i)===gtt});return new z4({clickTolerance:t,move:(i,a)=>({bearingDelta:(a.x-i.x)*r}),moveStateManager:n,enable:e,assignEvents:H4})},d8t=({enable:e,clickTolerance:t,pitchDegreesPerPixelMoved:r=-.5})=>{const n=new U4({checkCorrectEvent:i=>Yn.mouseButton(i)===$4&&i.ctrlKey||Yn.mouseButton(i)===gtt});return new z4({clickTolerance:t,move:(i,a)=>({pitchDelta:(a.y-i.y)*r}),moveStateManager:n,enable:e,assignEvents:H4})},gH=4.000244140625,p8t=1/100,v8t=1/450,g8t=2;class m8t{constructor(t,r){U(this,"_map",void 0),U(this,"_tr",void 0),U(this,"_enabled",void 0),U(this,"_active",void 0),U(this,"_zooming",void 0),U(this,"_aroundCenter",void 0),U(this,"_around",void 0),U(this,"_aroundPoint",void 0),U(this,"_type",void 0),U(this,"_lastValue",void 0),U(this,"_timeout",void 0),U(this,"_finishTimeout",void 0),U(this,"_lastWheelEvent",void 0),U(this,"_lastWheelEventTime",void 0),U(this,"_startZoom",void 0),U(this,"_targetZoom",void 0),U(this,"_delta",void 0),U(this,"_easing",void 0),U(this,"_prevEase",void 0),U(this,"_frameId",void 0),U(this,"_triggerRenderFrame",void 0),U(this,"_defaultZoomRate",void 0),U(this,"_wheelZoomRate",void 0),U(this,"_onTimeout",n=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}),this._map=t,this._tr=new GS(t),this._triggerRenderFrame=r,this._delta=0,this._defaultZoomRate=p8t,this._wheelZoomRate=v8t}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!t[this._map.cooperativeGestures._bypassKey])return;let r=t.deltaMode===WheelEvent.DOM_DELTA_LINE?t.deltaY*40:t.deltaY;const n=Vf.now(),i=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,r!==0&&r%gH===0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(i*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r=r/4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=Yn.mousePos(this._map.getCanvasContainer(),t),n=this._tr;r.y>n.transform.height/2-n.transform.getHorizon()?this._around=xa.convert(this._aroundCenter?n.center:n.unproject(r)):this._around=xa.convert(n.center),this._aroundPoint=n.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const s=this._type==="wheel"&&Math.abs(this._delta)>gH?this._wheelZoomRate:this._defaultZoomRate;let l=g8t/(1+Math.exp(-Math.abs(this._delta*s)));this._delta<0&&l!==0&&(l=1/l);const u=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(u*l))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const r=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,n=this._startZoom,i=this._easing;let a=!1,o;if(this._type==="wheel"&&n&&i){const s=Math.min((Vf.now()-this._lastWheelEventTime)/200,1),l=i(s);o=Uf.number(n,r,l),s<1?this._frameId||(this._frameId=!0):a=!0}else o=r,a=!0;return this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!a,zoomDelta:o-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=lF;if(this._prevEase){const n=this._prevEase,i=(Vf.now()-n.start)/n.duration,a=n.easing(i+.01)-n.easing(i),o=.27/Math.sqrt(a*a+1e-4)*.01,s=Math.sqrt(.27*.27-o*o);r=F4(o,s,.25,1)}return this._prevEase={start:Vf.now(),duration:t,easing:r},r}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class y8t{constructor(t,r){U(this,"_clickZoom",void 0),U(this,"_tapZoom",void 0),this._clickZoom=t,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class _8t{constructor(t,r,n){U(this,"_el",void 0),U(this,"_mousePan",void 0),U(this,"_touchPan",void 0),U(this,"_inertiaOptions",void 0),this._el=t,this._mousePan=r,this._touchPan=n}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("l7-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("l7-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class x8t{constructor(t,r,n){U(this,"_mouseRotate",void 0),U(this,"_mousePitch",void 0),U(this,"_pitchWithRotate",void 0),this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=r,this._mousePitch=n}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class b8t{constructor(t,r,n,i){U(this,"_el",void 0),U(this,"_touchZoom",void 0),U(this,"_touchRotate",void 0),U(this,"_tapDragZoom",void 0),U(this,"_rotationDisabled",void 0),U(this,"_enabled",void 0),this._el=t,this._touchZoom=r,this._touchRotate=n,this._tapDragZoom=i,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("l7-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("l7-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}function cF(e,t){if(e.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${e.length}, points ${t.length}`);const r={};for(let n=0;n<e.length;n++)r[e[n].identifier]=t[n];return r}function E8t(e){const t=new ca(0,0);for(const r of e)t._add(r);return t.div(e.length)}const mtt=500,w8t=500,V4=30;class C8t{constructor(t){U(this,"numTouches",void 0),U(this,"centroid",void 0),U(this,"startTime",void 0),U(this,"aborted",void 0),U(this,"touches",void 0),this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,r,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),!this.aborted&&(this.startTime===void 0&&(this.startTime=t.timeStamp),n.length===this.numTouches&&(this.centroid=E8t(r),this.touches=cF(n,r)))}touchmove(t,r,n){if(this.aborted||!this.centroid)return;const i=cF(n,r);for(const a in this.touches){const o=this.touches[a],s=i[a];(!s||s.dist(o)>V4)&&(this.aborted=!0)}}touchend(t,r,n){if((!this.centroid||t.timeStamp-this.startTime>w8t)&&(this.aborted=!0),n.length===0){const i=!this.aborted&&this.centroid;if(this.reset(),i)return i}}}class hF{constructor(t){U(this,"singleTap",void 0),U(this,"numTaps",void 0),U(this,"lastTime",void 0),U(this,"lastTap",void 0),U(this,"count",void 0),this.singleTap=new C8t(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,r,n){this.singleTap.touchstart(t,r,n)}touchmove(t,r,n){this.singleTap.touchmove(t,r,n)}touchend(t,r,n){const i=this.singleTap.touchend(t,r,n);if(i){const a=t.timeStamp-this.lastTime<mtt,o=!this.lastTap||this.lastTap.dist(i)<V4;if((!a||!o)&&this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=i,this.count===this.numTaps)return this.reset(),i}}}class S8t{constructor(){U(this,"_enabled",void 0),U(this,"_active",void 0),U(this,"_swipePoint",void 0),U(this,"_swipeTouch",void 0),U(this,"_tapTime",void 0),U(this,"_tapPoint",void 0),U(this,"_tap",void 0),this._tap=new hF({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,r,n){if(!this._swipePoint)if(!this._tapTime)this._tap.touchstart(t,r,n);else{const i=r[0],a=t.timeStamp-this._tapTime<mtt,o=this._tapPoint.dist(i)<V4;!a||!o?this.reset():n.length>0&&(this._swipePoint=i,this._swipeTouch=n[0].identifier)}}touchmove(t,r,n){if(!this._tapTime)this._tap.touchmove(t,r,n);else if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;const i=r[0],a=i.y-this._swipePoint.y;return this._swipePoint=i,t.preventDefault(),this._active=!0,{zoomDelta:a/128}}}touchend(t,r,n){if(this._tapTime)this._swipePoint&&n.length===0&&this.reset();else{const i=this._tap.touchend(t,r,n);i&&(this._tapTime=t.timeStamp,this._tapPoint=i)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class T8t{constructor(t){U(this,"_tr",void 0),U(this,"_enabled",void 0),U(this,"_active",void 0),U(this,"_zoomIn",void 0),U(this,"_zoomOut",void 0),this._tr=new GS(t),this._zoomIn=new hF({numTouches:1,numTaps:2}),this._zoomOut=new hF({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,r,n){this._zoomIn.touchstart(t,r,n),this._zoomOut.touchstart(t,r,n)}touchmove(t,r,n){this._zoomIn.touchmove(t,r,n),this._zoomOut.touchmove(t,r,n)}touchend(t,r,n){const i=this._zoomIn.touchend(t,r,n),a=this._zoomOut.touchend(t,r,n),o=this._tr;if(i)return this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:s=>s.easeTo({duration:300,zoom:o.zoom+1,around:o.unproject(i)},{originalEvent:t})};if(a)return this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:s=>s.easeTo({duration:300,zoom:o.zoom-1,around:o.unproject(a)},{originalEvent:t})}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class A8t{constructor(t,r){U(this,"_enabled",void 0),U(this,"_active",void 0),U(this,"_touches",void 0),U(this,"_clickTolerance",void 0),U(this,"_sum",void 0),U(this,"_map",void 0),this._clickTolerance=t.clickTolerance||1,this._map=r,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new ca(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(t,r,n){return this._calculateTransform(t,r,n)}touchmove(t,r,n){if(!(!this._active||n.length<this.minTouchs()))return t.preventDefault(),this._calculateTransform(t,r,n)}touchend(t,r,n){this._calculateTransform(t,r,n),this._active&&n.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,n){n.length>0&&(this._active=!0);const i=cF(n,r),a=new ca(0,0),o=new ca(0,0);let s=0;for(const c in i){const f=i[c],d=this._touches[c];d&&(a._add(f),o._add(f.sub(d)),s++,i[c]=f)}if(this._touches=i,s<this.minTouchs()||!o.mag())return;const l=o.div(s);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:a.div(s),panDelta:l}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class G4{constructor(){U(this,"_enabled",void 0),U(this,"_active",void 0),U(this,"_firstTwoTouches",void 0),U(this,"_vector",void 0),U(this,"_startVector",void 0),U(this,"_aroundCenter",void 0),this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,r,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([r[0],r[1]]))}touchmove(t,r,n){if(!this._firstTwoTouches)return;t.preventDefault();const[i,a]=this._firstTwoTouches,o=UT(n,r,i),s=UT(n,r,a);if(!o||!s)return;const l=this._aroundCenter?null:o.add(s).div(2);return this._move([o,s],l,t)}touchend(t,r,n){if(!this._firstTwoTouches)return;const[i,a]=this._firstTwoTouches,o=UT(n,r,i),s=UT(n,r,a);o&&s||(this._active&&Yn.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function UT(e,t,r){for(let n=0;n<e.length;n++)if(e[n].identifier===r)return t[n]}const M8t=.1;function mH(e,t){return Math.log(e/t)/Math.LN2}class R8t extends G4{constructor(...t){super(...t),U(this,"_distance",void 0),U(this,"_startDistance",void 0)}reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,r){const n=this._distance;if(this._distance=t[0].dist(t[1]),!(!this._active&&Math.abs(mH(this._distance,this._startDistance))<M8t))return this._active=!0,{zoomDelta:mH(this._distance,n),pinchAround:r}}}const I8t=25;function yH(e,t){return e.angleWith(t)*180/Math.PI}class L8t extends G4{constructor(...t){super(...t),U(this,"_minDiameter",void 0)}reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,r,n){const i=this._vector;if(this._vector=t[0].sub(t[1]),!(!this._active&&this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:yH(this._vector,i),pinchAround:r}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const r=Math.PI*this._minDiameter,n=I8t/r*360,i=yH(t,this._startVector);return Math.abs(i)<n}}function WO(e){return Math.abs(e.y)>Math.abs(e.x)}const O8t=100;class P8t extends G4{constructor(t){super(),U(this,"_valid",void 0),U(this,"_firstMove",void 0),U(this,"_lastPoints",void 0),U(this,"_map",void 0),U(this,"_currentTouchCount",0),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,r,n){super.touchstart(t,r,n),this._currentTouchCount=n.length}_start(t){this._lastPoints=t,WO(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,r,n){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const i=t[0].sub(this._lastPoints[0]),a=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(i,a,n.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(i.y+a.y)/2*-.5}):void 0}gestureBeginsVertically(t,r,n){if(this._valid!==void 0)return this._valid;const i=2,a=t.mag()>=i,o=r.mag()>=i;if(!a&&!o)return;if(!a||!o)return this._firstMove===void 0&&(this._firstMove=n),n-this._firstMove<O8t?void 0:!1;const s=t.y>0==r.y>0;return WO(t)&&WO(r)&&s}}const QI={linearity:.3,easing:F4(0,0,.3,1)},D8t=ys({deceleration:2500,maxSpeed:1400},QI),F8t=ys({deceleration:20,maxSpeed:1400},QI),B8t=ys({deceleration:1e3,maxSpeed:360},QI),N8t=ys({deceleration:1e3,maxSpeed:90},QI);class k8t{constructor(t){U(this,"_map",void 0),U(this,"_inertiaBuffer",void 0),this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Vf.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=Vf.now(),n=160;for(;t.length>0&&r-t[0].time>n;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,pan:new ca(0,0),pinchAround:void 0,around:void 0};for(const{settings:o}of this._inertiaBuffer)r.zoom+=o.zoomDelta||0,r.bearing+=o.bearingDelta||0,r.pitch+=o.pitchDelta||0,o.panDelta&&r.pan._add(o.panDelta),o.around&&(r.around=o.around),o.pinchAround&&(r.pinchAround=o.pinchAround);const i=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,a={};if(r.pan.mag()){const o=HT(r.pan.mag(),i,ys({},D8t,t||{}));a.offset=r.pan.mult(o.amount/r.pan.mag()),a.center=this._map.transform.center,$T(a,o)}if(r.zoom){const o=HT(r.zoom,i,F8t);a.zoom=this._map.transform.zoom+o.amount,$T(a,o)}if(r.bearing){const o=HT(r.bearing,i,B8t);a.bearing=this._map.transform.bearing+zp(o.amount,-179,179),$T(a,o)}if(r.pitch){const o=HT(r.pitch,i,N8t);a.pitch=this._map.transform.pitch+o.amount,$T(a,o)}if(a.zoom||a.bearing){const o=r.pinchAround===void 0?r.around:r.pinchAround;a.around=o?this._map.unproject(o):this._map.getCenter()}return this.clear(),ys(a,{noMoveStart:!0})}}function $T(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function HT(e,t,r){const{maxSpeed:n,linearity:i,deceleration:a}=r,o=zp(e*i/(t/1e3),-n,n),s=Math.abs(o)/(a*i);return{easing:r.easing,duration:s*1e3,amount:o*(s/2)}}const VT=e=>e.zoom||e.drag||e.pitch||e.rotate;class z8t extends Wi{constructor(t,r){super(t),U(this,"type","renderFrame"),U(this,"timeStamp",void 0),this.timeStamp=r}}function XO(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class U8t{constructor(t,r){U(this,"_map",void 0),U(this,"_el",void 0),U(this,"_handlers",void 0),U(this,"_eventsInProgress",void 0),U(this,"_frameId",void 0),U(this,"_inertia",void 0),U(this,"_bearingSnap",void 0),U(this,"_handlersById",void 0),U(this,"_updatingCamera",void 0),U(this,"_changes",void 0),U(this,"_zoom",void 0),U(this,"_previousActiveHandlers",void 0),U(this,"_listeners",void 0),U(this,"handleWindowEvent",i=>{this.handleEvent(i,`${i.type}Window`)}),U(this,"handleEvent",(i,a)=>{if(i.type==="blur"){this.stop(!0);return}this._updatingCamera=!0;const o=i.type==="renderFrame"?void 0:i,s={needsRenderFrame:!1},l={},u={},c=i.touches,f=c?this._getMapTouches(c):void 0,d=f?Yn.touchPos(this._map.getCanvasContainer(),f):Yn.mousePos(this._map.getCanvasContainer(),i);for(const{handlerName:x,handler:w,allowed:S}of this._handlers){if(!w.isEnabled())continue;let M;this._blockedByActive(u,S,x)?w.reset():w[a||i.type]&&(M=w[a||i.type](i,d,f),this.mergeHandlerResult(s,l,M,x,o),M&&M.needsRenderFrame&&this._triggerRenderFrame()),(M||w.isActive())&&(u[x]=w)}const v={};for(const x in this._previousActiveHandlers)u[x]||(v[x]=o);this._previousActiveHandlers=u,(Object.keys(v).length||XO(s))&&(this._changes.push([s,l,v]),this._triggerRenderFrame()),(Object.keys(u).length||XO(s))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:g}=s;g&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],g(this._map))}),this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new k8t(t),this._bearingSnap=r.bearingSnap||7,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r);const n=this._el;this._listeners=[[n,"touchstart",{passive:!0}],[n,"touchmove",{passive:!1}],[n,"touchend",void 0],[n,"touchcancel",void 0],[n,"mousedown",void 0],[n,"mousemove",void 0],[n,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[n,"mouseover",void 0],[n,"mouseout",void 0],[n,"dblclick",void 0],[n,"click",void 0],[n,"keydown",{capture:!1}],[n,"keyup",void 0],[n,"wheel",{passive:!1}],[n,"contextmenu",void 0],[window,"blur",void 0]];for(const[i,a,o]of this._listeners)Yn.addEventListener(i,a,i===document?this.handleWindowEvent:this.handleEvent,o)}destroy(){for(const[t,r,n]of this._listeners)Yn.removeEventListener(t,r,t===document?this.handleWindowEvent:this.handleEvent,n)}_addDefaultHandlers(t){const r=this._map,n=r.getCanvasContainer();this._add("mapEvent",new a8t(r,t));const i=r.boxZoom=new K6t(r,t);this._add("boxZoom",i),t.interactive&&t.boxZoom&&i.enable();const a=r.cooperativeGestures=new J6t(r,t.cooperativeGestures);this._add("cooperativeGestures",a),t.cooperativeGestures&&a.enable();const o=new T8t(r),s=new Q6t(r);r.doubleClickZoom=new y8t(s,o),this._add("tapZoom",o),this._add("clickZoom",s),t.interactive&&t.doubleClickZoom&&r.doubleClickZoom.enable();const l=new S8t;this._add("tapDragZoom",l);const u=r.touchPitch=new P8t(r);this._add("touchPitch",u),t.interactive&&t.touchPitch&&r.touchPitch.enable(t.touchPitch);const c=f8t(t),f=d8t(t);r.dragRotate=new x8t(t,c,f),this._add("mouseRotate",c,["mousePitch"]),this._add("mousePitch",f,["mouseRotate"]),t.interactive&&t.dragRotate&&r.dragRotate.enable();const d=h8t(t),v=new A8t(t,r);r.dragPan=new _8t(n,d,v),this._add("mousePan",d),this._add("touchPan",v,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&r.dragPan.enable(t.dragPan);const g=new L8t,x=new R8t;r.touchZoomRotate=new b8t(n,x,g,l),this._add("touchRotate",g,["touchPan","touchZoom"]),this._add("touchZoom",x,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&r.touchZoomRotate.enable(t.touchZoomRotate);const w=r.scrollZoom=new m8t(r,()=>this._triggerRenderFrame());this._add("scrollZoom",w,["mousePan"]),t.interactive&&t.scrollZoom&&r.scrollZoom.enable(t.scrollZoom);const S=r.keyboard=new e8t(r);this._add("keyboard",S),t.interactive&&t.keyboard&&r.keyboard.enable(),this._add("blockableMapEvent",new o8t(r))}_add(t,r,n){this._handlers.push({handlerName:t,handler:r,allowed:n}),this._handlersById[t]=r}stop(t){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!VT(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,r,n){for(const i in t)if(i!==n&&(!r||r.indexOf(i)<0))return!0;return!1}_getMapTouches(t){const r=[];for(const n of t){const i=n.target;this._el.contains(i)&&r.push(n)}return r}mergeHandlerResult(t,r,n,i,a){if(!n)return;ys(t,n);const o={handlerName:i,originalEvent:n.originalEvent||a};n.zoomDelta!==void 0&&(r.zoom=o),n.panDelta!==void 0&&(r.drag=o),n.pitchDelta!==void 0&&(r.pitch=o),n.bearingDelta!==void 0&&(r.rotate=o)}_applyChanges(){const t={},r={},n={};for(const[i,a,o]of this._changes)i.panDelta&&(t.panDelta=(t.panDelta||new ca(0,0))._add(i.panDelta)),i.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+i.zoomDelta),i.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+i.bearingDelta),i.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+i.pitchDelta),i.around!==void 0&&(t.around=i.around),i.pinchAround!==void 0&&(t.pinchAround=i.pinchAround),i.noInertia&&(t.noInertia=i.noInertia),ys(r,a),ys(n,o);this._updateMapTransform(t,r,n),this._changes=[]}_updateMapTransform(t,r,n){const i=this._map,a=i._getTransformForUpdate();if(!XO(t))return this._fireEvents(r,n,!0);const{panDelta:o,zoomDelta:s,bearingDelta:l,pitchDelta:u,pinchAround:c}=t;let{around:f}=t;c!==void 0&&(f=c),i._stop(!0),f=f||i.transform.centerPoint;const d=a.pointLocation(o?f.sub(o):f);l&&(a.bearing+=l),u&&(a.pitch+=u),s&&(a.zoom+=s),a.setLocationAtPoint(d,f),i._applyUpdatedTransform(a),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,n,!0)}_fireEvents(t,r,n){const i=VT(this._eventsInProgress),a=VT(t),o={};for(const f in t){const{originalEvent:d}=t[f];this._eventsInProgress[f]||(o[`${f}start`]=d),this._eventsInProgress[f]=t[f]}!i&&a&&this._fireEvent("movestart",a.originalEvent);for(const f in o)this._fireEvent(f,o[f]);a&&this._fireEvent("move",a.originalEvent);for(const f in t){const{originalEvent:d}=t[f];this._fireEvent(f,d)}const s={};let l;for(const f in this._eventsInProgress){const{handlerName:d,originalEvent:v}=this._eventsInProgress[f];this._handlersById[d].isActive()||(delete this._eventsInProgress[f],l=r[d]||v,s[`${f}end`]=l)}for(const f in s)this._fireEvent(f,s[f]);const u=VT(this._eventsInProgress);if(n&&((i||a)&&!u)){this._updatingCamera=!0;const f=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),d=v=>v!==0&&-this._bearingSnap<v&&v<this._bearingSnap;f&&(f.essential||!Vf.prefersReducedMotion)?(d(f.bearing||this._map.getBearing())&&(f.bearing=0),f.freezeElevation=!0,this._map.easeTo(f,{originalEvent:l})):(this._map.fire(new Wi("moveend",{originalEvent:l})),d(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new Wi(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new z8t("renderFrame",t)),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class $8t{constructor(){U(this,"_queue",void 0),U(this,"_id",void 0),U(this,"_cleared",void 0),U(this,"_currentlyRunning",void 0),this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const r=++this._id;return this._queue.push({callback:t,id:r,cancelled:!1}),r}remove(t){const r=this._currentlyRunning,n=r?this._queue.concat(r):this._queue;for(const i of n)if(i.id===t){i.cancelled=!0;return}}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const r=this._currentlyRunning=this._queue;this._queue=[];for(const n of r)if(!n.cancelled&&(n.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function H8t(e,t){var r=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(r||n)&&(t||(t=document),!!t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var a=t.body||t.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):t.documentElement.appendChild(i)}var o=t.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(t.createTextNode(e)),i.appendChild(o),o}}H8t(`.l7-map {
  font:
    12px/20px 'Helvetica Neue',
    Arial,
    Helvetica,
    sans-serif;
  overflow: hidden;
  position: relative;
  -webkit-tap-highlight-color: rgb(0 0 0 / 0%);
}

.l7-canvas {
  position: absolute;
  left: 0;
  top: 0;
}

.l7-map:full-screen {
  width: 100%;
  height: 100%;
}

.l7-canary {
  background-color: salmon;
}

.l7-canvas-container.l7-interactive,
.l7-ctrl-group button.l7-ctrl-compass {
  cursor: grab;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-canvas-container.l7-interactive.l7-track-pointer {
  cursor: pointer;
}

.l7-canvas-container.l7-interactive:active,
.l7-ctrl-group button.l7-ctrl-compass:active {
  cursor: grabbing;
}

.l7-canvas-container.l7-touch-zoom-rotate,
.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {
  touch-action: pan-x pan-y;
}

.l7-canvas-container.l7-touch-drag-pan,
.l7-canvas-container.l7-touch-drag-pan .l7-canvas {
  touch-action: pinch-zoom;
}

.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,
.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {
  touch-action: none;
}

.l7-canvas-container.l7-touch-drag-pan.l7-cooperative-gestures,
.l7-canvas-container.l7-touch-drag-pan.l7-cooperative-gestures .l7-canvas {
  touch-action: pan-x pan-y;
}

.l7-cooperative-gesture-screen {
  background: rgba(0 0 0 / 40%);
  position: absolute;
  inset: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  color: white;
  padding: 1rem;
  font-size: 1.4em;
  line-height: 1.2;
  opacity: 0;
  pointer-events: none;
  transition: opacity 1s ease 1s;
  z-index: 99999;
}

.l7-cooperative-gesture-screen.l7-show {
  opacity: 1;
  transition: opacity 0.05s;
}

.l7-cooperative-gesture-screen .l7-mobile-message {
  display: none;
}

@media (hover: none), (width <= 480px) {
  .l7-cooperative-gesture-screen .l7-desktop-message {
    display: none;
  }

  .l7-cooperative-gesture-screen .l7-mobile-message {
    display: block;
  }
}

.l7-ctrl-top-left,
.l7-ctrl-top-right,
.l7-ctrl-bottom-left,
.l7-ctrl-bottom-right {
  position: absolute;
  pointer-events: none;
  z-index: 2;
}

.l7-ctrl-top-left {
  top: 0;
  left: 0;
}

.l7-ctrl-top-right {
  top: 0;
  right: 0;
}

.l7-ctrl-bottom-left {
  bottom: 0;
  left: 0;
}

.l7-ctrl-bottom-right {
  right: 0;
  bottom: 0;
}

.l7-ctrl {
  clear: both;
  pointer-events: auto;

  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */
  -webkit-transform: translate(0, 0);
          transform: translate(0, 0);
}

.l7-ctrl-top-left .l7-ctrl {
  margin: 10px 0 0 10px;
  float: left;
}

.l7-ctrl-top-right .l7-ctrl {
  margin: 10px 10px 0 0;
  float: right;
}

.l7-ctrl-bottom-left .l7-ctrl {
  margin: 0 0 10px 10px;
  float: left;
}

.l7-ctrl-bottom-right .l7-ctrl {
  margin: 0 10px 10px 0;
  float: right;
}

.l7-crosshair,
.l7-crosshair .l7-interactive,
.l7-crosshair .l7-interactive:active {
  cursor: crosshair;
}

.l7-boxzoom {
  position: absolute;
  top: 0;
  left: 0;
  width: 0;
  height: 0;
  background: #fff;
  border: 2px dotted #202020;
  opacity: 0.5;
  z-index: 10;
}
`);const lM=-2,ytt=22,Sm=0,_tt=60,GT=85,V8t={interactive:!0,bearingSnap:7,scrollZoom:!0,minZoom:lM,maxZoom:ytt,minPitch:Sm,maxPitch:_tt,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,fadeDuration:300,clickTolerance:3,pitchWithRotate:!0};let G8t=class extends q6t{constructor(t){const r=Ce(Ce({},V8t),t);if(r.minZoom!=null&&r.maxZoom!=null&&r.minZoom>r.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(r.minPitch!=null&&r.maxPitch!=null&&r.minPitch>r.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(r.minPitch!=null&&r.minPitch<Sm)throw new Error(`minPitch must be greater than or equal to ${Sm}`);if(r.maxPitch!=null&&r.maxPitch>GT)throw new Error(`maxPitch must be less than or equal to ${GT}`);const n=new N4(r.minZoom,r.maxZoom,r.minPitch,r.maxPitch,r.renderWorldCopies);if(super(n,{bearingSnap:r.bearingSnap}),U(this,"_container",void 0),U(this,"_canvasContainer",void 0),U(this,"_interactive",void 0),U(this,"_frameRequest",void 0),U(this,"_loaded",void 0),U(this,"_idleTriggered",!1),U(this,"_fullyLoaded",void 0),U(this,"_trackResize",void 0),U(this,"_resizeObserver",void 0),U(this,"_preserveDrawingBuffer",void 0),U(this,"_failIfMajorPerformanceCaveat",void 0),U(this,"_fadeDuration",void 0),U(this,"_crossSourceCollisions",void 0),U(this,"_crossFadingFactor",1),U(this,"_collectResourceTiming",void 0),U(this,"_renderTaskQueue",new $8t),U(this,"_mapId",z6t()),U(this,"_removed",void 0),U(this,"_clickTolerance",void 0),U(this,"version",void 0),U(this,"mapSize",void 0),U(this,"scrollZoom",void 0),U(this,"boxZoom",void 0),U(this,"dragRotate",void 0),U(this,"dragPan",void 0),U(this,"keyboard",void 0),U(this,"doubleClickZoom",void 0),U(this,"touchZoomRotate",void 0),U(this,"touchPitch",void 0),U(this,"cooperativeGestures",void 0),U(this,"_onMapScroll",i=>{if(i.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}),this._interactive=r.interactive,this._trackResize=r.trackResize===!0,this._bearingSnap=r.bearingSnap,this._fadeDuration=r.fadeDuration,this._clickTolerance=r.clickTolerance,this.version=t.version,this.mapSize=t.mapSize,typeof r.container=="string"){if(this._container=document.getElementById(r.container),!this._container)throw new Error(`Container '${r.container}' not found.`)}else if(r.container instanceof HTMLElement)this._container=r.container;else throw new Error("Invalid type: 'container' must be a String or HTMLElement.");if(r.maxBounds&&this.setMaxBounds(r.maxBounds),this._setupContainer(),this.on("move",()=>this._update()).on("moveend",()=>this._update()).on("zoom",()=>this._update()).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){let i=!1;const a=as.throttle(o=>{this._trackResize&&!this._removed&&this.resize(o)._update()},50);this._resizeObserver=new ResizeObserver(o=>{if(!i){i=!0;return}a(o)}),this._resizeObserver.observe(this._container)}this.handlers=new U8t(this,r),this.jumpTo({center:r.center,zoom:r.zoom,bearing:r.bearing,pitch:r.pitch}),r.bounds&&(this.resize(),this.fitBounds(r.bounds,ys({},r.fitBoundsOptions,{duration:0}))),this.resize()}_getMapId(){return this._mapId}calculateCameraOptionsFromTo(t,r,n,i){return super.calculateCameraOptionsFromTo(t,r,n,i)}resize(t){var r;const n=this._containerDimensions(),i=n[0],a=n[1];this.transform.resize(i,a),(r=this._requestedCameraState)===null||r===void 0||r.resize(i,a);const o=!this._moving;return o&&(this.stop(),this.fire(new Wi("movestart",t)).fire(new Wi("move",t))),this.fire(new Wi("resize",t)),o&&this.fire(new Wi("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(t){return this.transform.setMaxBounds(t&&Pd.convert(t)),this._update()}setMinZoom(t){if(t=t??lM,t>=lM&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error(`minZoom must be between ${lM} and the current maxZoom, inclusive`)}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if(t=t??ytt,t>=this.transform.minZoom)return this.transform.maxZoom=t,this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if(t=t??Sm,t<Sm)throw new Error(`minPitch must be greater than or equal to ${Sm}`);if(t>=Sm&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this.getPitch()<t&&this.setPitch(t),this;throw new Error(`minPitch must be between ${Sm} and the current maxPitch, inclusive`)}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if(t=t??_tt,t>GT)throw new Error(`maxPitch must be less than or equal to ${GT}`);if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){this.transform.renderWorldCopies=t}project(t){return this.transform.locationPoint(xa.convert(t))}unproject(t){return this.transform.pointLocation(ca.convert(t))}isMoving(){var t;return this._moving||((t=this.handlers)===null||t===void 0?void 0:t.isMoving())}isZooming(){var t;return this._zooming||((t=this.handlers)===null||t===void 0?void 0:t.isZooming())}isRotating(){var t;return this._rotating||((t=this.handlers)===null||t===void 0?void 0:t.isRotating())}on(t,r){return super.on(t,r)}once(t,r){return super.once(t,r)}off(t,r){return super.off(t,r)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}_containerDimensions(){let t=0,r=0;return this._container&&(t=this._container.clientWidth||400,r=this._container.clientHeight||300),[t,r]}_setupContainer(){const t=this._container;t.classList.add("l7-map");const r=this._canvasContainer=Yn.create("div","l7-canvas-container",t);this._interactive&&r.classList.add("l7-interactive"),this._container.addEventListener("scroll",this._onMapScroll,!1)}_update(){return this.triggerRepaint(),this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_render(t){if(this._renderTaskQueue.run(t),!this._removed)return this.fire(new Wi("render")),this.isMoving()||this.fire(new Wi("idle")),this}remove(){var t;this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.handlers.destroy(),delete this.handlers,(t=this._resizeObserver)===null||t===void 0||t.disconnect(),Yn.remove(this._canvasContainer),this._container.classList.remove("l7-map"),this._removed=!0,this.fire(new Wi("remove"))}triggerRepaint(){this._frameRequest||(this._frameRequest=new AbortController,Vf.frameAsync(this._frameRequest).then(t=>{this._frameRequest=null,this._render(t)}).catch(()=>{}))}getCameraTargetElevation(){return this.transform.elevation}};const W8t=["id","style","rotation","mapInstance","version","mapSize","interactive"];class X8t extends KI{constructor(...t){super(...t),U(this,"version",ctt.DEFAULT),U(this,"viewport",void 0)}lngLatToCoord(t,r={x:0,y:0,z:0}){const{x:n,y:i}=this.lngLatToMercator(t,0);return[n-r.x,i-r.y]}lngLatToMercator(t,r){const{x:n=0,y:i=0,z:a=0}=Hf.fromLngLat(t,r);return{x:n,y:i,z:a}}getModelMatrix(t,r,n,i=[1,1,1],a={x:0,y:0,z:0}){const o=Hf.fromLngLat(t,r),s=o.meterInMercatorCoordinateUnits(),l=A_();return Bh(l,l,su(o.x-a.x,o.y-a.y,o.z||0-a.z)),Nh(l,l,su(s*i[0],-s*i[1],s*i[2])),M_(l,l,n[0]),NS(l,l,n[1]),Fb(l,l,n[2]),l}init(){var t=this;return Oe(function*(){const r=t.config,{id:n="map",style:i="light",rotation:a=0,mapInstance:o,version:s="DEFAULTMAP",mapSize:l=1e4,interactive:u=!0}=r,c=Gh(r,W8t);t.viewport=new VS,t.version=s,t.simpleMapCoord.setSize(l),s==="SIMPLE"&&c.center&&(c.center=t.simpleMapCoord.unproject(c.center)),o?(t.map=o,t.$mapContainer=t.map.getContainer()):(t.$mapContainer=t.creatMapContainer(n),t.map=new G8t(Ce({container:t.$mapContainer,bearing:a,version:s,mapSize:l},c))),t.map.on("load",()=>{t.handleCameraChanged()}),u&&t.map.on("move",t.handleCameraChanged),setTimeout(()=>{t.handleCameraChanged()},100),t.handleCameraChanged()})()}creatMapContainer(t){let r=t;typeof t=="string"&&(r=document.getElementById(t));const n=document.createElement("div");return n.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,r.appendChild(n),n}exportMap(t){return""}setMapStyle(t){}getCanvasOverlays(){return this.getContainer()}}let j8t=class extends HS{getServiceConstructor(){return X8t}};var xtt={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(Nm,function(){var r,n,i;function a(o,s){if(!r)r=s;else if(!n)n=s;else{var l="var sharedChunk = {}; ("+r+")(sharedChunk); ("+n+")(sharedChunk);",u={};r(u),i=s(u),typeof window<"u"&&(i.workerUrl=window.URL.createObjectURL(new Blob([l],{type:"text/javascript"})))}}return a(["exports"],function(o){function s(h,p){return h(p={exports:{}},p.exports),p.exports}var l=u;function u(h,p,m,E){this.cx=3*h,this.bx=3*(m-h)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*p,this.by=3*(E-p)-this.cy,this.ay=1-this.cy-this.by,this.p1x=h,this.p1y=E,this.p2x=m,this.p2y=E}u.prototype.sampleCurveX=function(h){return((this.ax*h+this.bx)*h+this.cx)*h},u.prototype.sampleCurveY=function(h){return((this.ay*h+this.by)*h+this.cy)*h},u.prototype.sampleCurveDerivativeX=function(h){return(3*this.ax*h+2*this.bx)*h+this.cx},u.prototype.solveCurveX=function(h,p){var m,E,A,L,D;for(p===void 0&&(p=1e-6),A=h,D=0;D<8;D++){if(L=this.sampleCurveX(A)-h,Math.abs(L)<p)return A;var N=this.sampleCurveDerivativeX(A);if(Math.abs(N)<1e-6)break;A-=L/N}if((A=h)<(m=0))return m;if(A>(E=1))return E;for(;m<E;){if(L=this.sampleCurveX(A),Math.abs(L-h)<p)return A;h>L?m=A:E=A,A=.5*(E-m)+m}return A},u.prototype.solve=function(h,p){return this.sampleCurveY(this.solveCurveX(h,p))};var c=f;function f(h,p){this.x=h,this.y=p}f.prototype={clone:function(){return new f(this.x,this.y)},add:function(h){return this.clone()._add(h)},sub:function(h){return this.clone()._sub(h)},multByPoint:function(h){return this.clone()._multByPoint(h)},divByPoint:function(h){return this.clone()._divByPoint(h)},mult:function(h){return this.clone()._mult(h)},div:function(h){return this.clone()._div(h)},rotate:function(h){return this.clone()._rotate(h)},rotateAround:function(h,p){return this.clone()._rotateAround(h,p)},matMult:function(h){return this.clone()._matMult(h)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(h){return this.x===h.x&&this.y===h.y},dist:function(h){return Math.sqrt(this.distSqr(h))},distSqr:function(h){var p=h.x-this.x,m=h.y-this.y;return p*p+m*m},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(h){return Math.atan2(this.y-h.y,this.x-h.x)},angleWith:function(h){return this.angleWithSep(h.x,h.y)},angleWithSep:function(h,p){return Math.atan2(this.x*p-this.y*h,this.x*h+this.y*p)},_matMult:function(h){var p=h[2]*this.x+h[3]*this.y;return this.x=h[0]*this.x+h[1]*this.y,this.y=p,this},_add:function(h){return this.x+=h.x,this.y+=h.y,this},_sub:function(h){return this.x-=h.x,this.y-=h.y,this},_mult:function(h){return this.x*=h,this.y*=h,this},_div:function(h){return this.x/=h,this.y/=h,this},_multByPoint:function(h){return this.x*=h.x,this.y*=h.y,this},_divByPoint:function(h){return this.x/=h.x,this.y/=h.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var h=this.y;return this.y=this.x,this.x=-h,this},_rotate:function(h){var p=Math.cos(h),m=Math.sin(h),E=m*this.x+p*this.y;return this.x=p*this.x-m*this.y,this.y=E,this},_rotateAround:function(h,p){var m=Math.cos(h),E=Math.sin(h),A=p.y+E*(this.x-p.x)+m*(this.y-p.y);return this.x=p.x+m*(this.x-p.x)-E*(this.y-p.y),this.y=A,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},f.convert=function(h){return h instanceof f?h:Array.isArray(h)?new f(h[0],h[1]):h};var d=typeof self<"u"?self:{},v=Math.pow(2,53)-1;function g(h,p,m,E){var A=new l(h,p,m,E);return function(L){return A.solve(L)}}var x=g(.25,.1,.25,1);function w(h,p,m){return Math.min(m,Math.max(p,h))}function S(h,p,m){var E=m-p,A=((h-p)%E+E)%E+p;return A===p?m:A}function M(h){for(var p=[],m=arguments.length-1;m-- >0;)p[m]=arguments[m+1];for(var E=0,A=p;E<A.length;E+=1){var L=A[E];for(var D in L)h[D]=L[D]}return h}var R=1;function I(){return R++}function P(){return function h(p){return p?(p^16*Math.random()>>p/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,h)}()}function k(h){return!!h&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(h)}function z(h,p){h.forEach(function(m){p[m]&&(p[m]=p[m].bind(p))})}function G(h,p){return h.indexOf(p,h.length-p.length)!==-1}function J(h,p,m){var E={};for(var A in h)E[A]=p.call(m||this,h[A],A,h);return E}function Z(h,p,m){var E={};for(var A in h)p.call(m||this,h[A],A,h)&&(E[A]=h[A]);return E}function X(h){return Array.isArray(h)?h.map(X):typeof h=="object"&&h?J(h,X):h}var et={};function at(h){et[h]||(typeof console<"u"&&console.warn(h),et[h]=!0)}function wt(h,p,m){return(m.y-h.y)*(p.x-h.x)>(p.y-h.y)*(m.x-h.x)}function Tt(h){for(var p=0,m=0,E=h.length,A=E-1,L=void 0,D=void 0;m<E;A=m++)p+=((D=h[A]).x-(L=h[m]).x)*(L.y+D.y);return p}function vt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function zt(h){var p={};if(h.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(E,A,L,D){var N=L||D;return p[A]=!N||N.toLowerCase(),""}),p["max-age"]){var m=parseInt(p["max-age"],10);isNaN(m)?delete p["max-age"]:p["max-age"]=m}return p}var oe=null;function Qt(h){if(oe==null){var p=h.navigator?h.navigator.userAgent:null;oe=!!h.safari||!(!p||!(/\b(iPad|iPhone|iPod)\b/.test(p)||p.match("Safari")&&!p.match("Chrome")))}return oe}function ne(h){try{var p=d[h];return p.setItem("_mapbox_test_",1),p.removeItem("_mapbox_test_"),!0}catch{return!1}}var de,De,Ze,ke,Be=d.performance&&d.performance.now?d.performance.now.bind(d.performance):Date.now.bind(Date),Zr=d.requestAnimationFrame||d.mozRequestAnimationFrame||d.webkitRequestAnimationFrame||d.msRequestAnimationFrame,Wr=d.cancelAnimationFrame||d.mozCancelAnimationFrame||d.webkitCancelAnimationFrame||d.msCancelAnimationFrame,In={now:Be,frame:function(h){var p=Zr(h);return{cancel:function(){return Wr(p)}}},getImageData:function(h,p){p===void 0&&(p=0);var m=d.document.createElement("canvas"),E=m.getContext("2d");if(!E)throw new Error("failed to create canvas 2d context");return m.width=h.width,m.height=h.height,E.drawImage(h,0,0,h.width,h.height),E.getImageData(-p,-p,h.width+2*p,h.height+2*p)},resolveURL:function(h){return de||(de=d.document.createElement("a")),de.href=h,de.href},hardwareConcurrency:d.navigator&&d.navigator.hardwareConcurrency||4,get devicePixelRatio(){return d.devicePixelRatio},get prefersReducedMotion(){return!!d.matchMedia&&(De==null&&(De=d.matchMedia("(prefers-reduced-motion: reduce)")),De.matches)}},re={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},nr={supported:!1,testSupport:function(h){!zr&&ke&&(Ne?Vr(h):Ze=h)}},zr=!1,Ne=!1;function Vr(h){var p=h.createTexture();h.bindTexture(h.TEXTURE_2D,p);try{if(h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,ke),h.isContextLost())return;nr.supported=!0}catch{}h.deleteTexture(p),zr=!0}d.document&&((ke=d.document.createElement("img")).onload=function(){Ze&&Vr(Ze),Ze=null,Ne=!0},ke.onerror=function(){zr=!0,Ze=null},ke.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var xn="01",Qn=function(h,p){this._transformRequestFn=h,this._customAccessToken=p,this._createSkuToken()};function gn(h){return h.indexOf("mapbox:")===0}Qn.prototype._createSkuToken=function(){var h=function(){for(var p="",m=0;m<10;m++)p+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",xn,p].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=h.token,this._skuTokenExpiresAt=h.tokenExpiresAt},Qn.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Qn.prototype.transformRequest=function(h,p){return this._transformRequestFn&&this._transformRequestFn(h,p)||{url:h}},Qn.prototype.normalizeStyleURL=function(h,p){if(!gn(h))return h;var m=ra(h);return m.path="/styles/v1"+m.path,this._makeAPIURL(m,this._customAccessToken||p)},Qn.prototype.normalizeGlyphsURL=function(h,p){if(!gn(h))return h;var m=ra(h);return m.path="/fonts/v1"+m.path,this._makeAPIURL(m,this._customAccessToken||p)},Qn.prototype.normalizeSourceURL=function(h,p){if(!gn(h))return h;var m=ra(h);return m.path="/v4/"+m.authority+".json",m.params.push("secure"),this._makeAPIURL(m,this._customAccessToken||p)},Qn.prototype.normalizeSpriteURL=function(h,p,m,E){var A=ra(h);return gn(h)?(A.path="/styles/v1"+A.path+"/sprite"+p+m,this._makeAPIURL(A,this._customAccessToken||E)):(A.path+=""+p+m,la(A))},Qn.prototype.normalizeTileURL=function(h,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),h&&!gn(h))return h;var m=ra(h);m.path=m.path.replace(/(\.(png|jpg)\d*)(?=$)/,(In.devicePixelRatio>=2||p===512?"@2x":"")+(nr.supported?".webp":"$1")),m.path=m.path.replace(/^.+\/v4\//,"/"),m.path="/v4"+m.path;var E=this._customAccessToken||function(A){for(var L=0,D=A;L<D.length;L+=1){var N=D[L].match(/^access_token=(.*)$/);if(N)return N[1]}return null}(m.params)||re.ACCESS_TOKEN;return re.REQUIRE_ACCESS_TOKEN&&E&&this._skuToken&&m.params.push("sku="+this._skuToken),this._makeAPIURL(m,E)},Qn.prototype.canonicalizeTileURL=function(h,p){var m=ra(h);if(!m.path.match(/(^\/v4\/)/)||!m.path.match(/\.[\w]+$/))return h;var E="mapbox://tiles/";E+=m.path.replace("/v4/","");var A=m.params;return p&&(A=A.filter(function(L){return!L.match(/^access_token=/)})),A.length&&(E+="?"+A.join("&")),E},Qn.prototype.canonicalizeTileset=function(h,p){for(var m=!!p&&gn(p),E=[],A=0,L=h.tiles||[];A<L.length;A+=1){var D=L[A];ci(D)?E.push(this.canonicalizeTileURL(D,m)):E.push(D)}return E},Qn.prototype._makeAPIURL=function(h,p){var m="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",E=ra(re.API_URL);if(h.protocol=E.protocol,h.authority=E.authority,h.protocol==="http"){var A=h.params.indexOf("secure");A>=0&&h.params.splice(A,1)}if(E.path!=="/"&&(h.path=""+E.path+h.path),!re.REQUIRE_ACCESS_TOKEN)return la(h);if(!(p=p||re.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+m);if(p[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+m);return h.params=h.params.filter(function(L){return L.indexOf("access_token")===-1}),h.params.push("access_token="+p),la(h)};var bn=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function ci(h){return bn.test(h)}var Mo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ra(h){var p=h.match(Mo);if(!p)throw new Error("Unable to parse URL object");return{protocol:p[1],authority:p[2],path:p[3]||"/",params:p[4]?p[4].split("&"):[]}}function la(h){var p=h.params.length?"?"+h.params.join("&"):"";return h.protocol+"://"+h.authority+h.path+p}function os(h){if(!h)return null;var p=h.split(".");if(!p||p.length!==3)return null;try{return JSON.parse(decodeURIComponent(d.atob(p[1]).split("").map(function(m){return"%"+("00"+m.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch{return null}}var Et=function(h){this.type=h,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Et.prototype.getStorageKey=function(h){var p,m=os(re.ACCESS_TOKEN);return p=m&&m.u?d.btoa(encodeURIComponent(m.u).replace(/%([0-9A-F]{2})/g,function(E,A){return String.fromCharCode(+("0x"+A))})):re.ACCESS_TOKEN||"",h?"mapbox.eventData."+h+":"+p:"mapbox.eventData:"+p},Et.prototype.fetchEventData=function(){var h=ne("localStorage"),p=this.getStorageKey(),m=this.getStorageKey("uuid");if(h)try{var E=d.localStorage.getItem(p);E&&(this.eventData=JSON.parse(E));var A=d.localStorage.getItem(m);A&&(this.anonId=A)}catch{at("Unable to read from LocalStorage")}},Et.prototype.saveEventData=function(){var h=ne("localStorage"),p=this.getStorageKey(),m=this.getStorageKey("uuid");if(h)try{d.localStorage.setItem(m,this.anonId),Object.keys(this.eventData).length>=1&&d.localStorage.setItem(p,JSON.stringify(this.eventData))}catch{at("Unable to write to LocalStorage")}},Et.prototype.processRequests=function(h){},Et.prototype.postEvent=function(h,p,m,E){var A=this;if(re.EVENTS_URL){var L=ra(re.EVENTS_URL);L.params.push("access_token="+(E||re.ACCESS_TOKEN||""));var D={event:this.type,created:new Date(h).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:xn,userId:this.anonId},N=p?M(D,p):D,V={url:la(L),headers:{"Content-Type":"text/plain"},body:JSON.stringify([N])};this.pendingRequest=Hi(V,function(W){A.pendingRequest=null,m(W),A.saveEventData(),A.processRequests(E)})}},Et.prototype.queueRequest=function(h,p){this.queue.push(h),this.processRequests(p)};var ss,_u,ls=function(h){function p(){h.call(this,"map.load"),this.success={},this.skuToken=""}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype.postMapLoadEvent=function(m,E,A,L){this.skuToken=A;var D=!(!L&&!re.ACCESS_TOKEN),N=Array.isArray(m)&&m.some(function(V){return gn(V)||ci(V)});re.EVENTS_URL&&D&&N&&this.queueRequest({id:E,timestamp:Date.now()},L)},p.prototype.processRequests=function(m){var E=this;if(!this.pendingRequest&&this.queue.length!==0){var A=this.queue.shift(),L=A.id,D=A.timestamp;L&&this.success[L]||(this.anonId||this.fetchEventData(),k(this.anonId)||(this.anonId=P()),this.postEvent(D,{skuToken:this.skuToken},function(N){N||L&&(E.success[L]=!0)},m))}},p}(Et),Xu=new(function(h){function p(m){h.call(this,"appUserTurnstile"),this._customAccessToken=m}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype.postTurnstileEvent=function(m,E){re.EVENTS_URL&&re.ACCESS_TOKEN&&Array.isArray(m)&&m.some(function(A){return gn(A)||ci(A)})&&this.queueRequest(Date.now(),E)},p.prototype.processRequests=function(m){var E=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var A=os(re.ACCESS_TOKEN),L=A?A.u:re.ACCESS_TOKEN,D=L!==this.eventData.tokenU;k(this.anonId)||(this.anonId=P(),D=!0);var N=this.queue.shift();if(this.eventData.lastSuccess){var V=new Date(this.eventData.lastSuccess),W=new Date(N),q=(N-this.eventData.lastSuccess)/864e5;D=D||q>=1||q<-1||V.getDate()!==W.getDate()}else D=!0;if(!D)return this.processRequests();this.postEvent(N,{"enabled.telemetry":!1},function(Q){Q||(E.eventData.lastSuccess=N,E.eventData.tokenU=L)},m)}},p}(Et)),ma=Xu.postTurnstileEvent.bind(Xu),us=new ls,ol=us.postMapLoadEvent.bind(us),cs=500,vc=50;function vo(){d.caches&&!ss&&(ss=d.caches.open("mapbox-tiles"))}function ju(h){var p=h.indexOf("?");return p<0?h:h.slice(0,p)}var Ml,dh=1/0;function ud(){return Ml==null&&(Ml=d.OffscreenCanvas&&new d.OffscreenCanvas(1,1).getContext("2d")&&typeof d.createImageBitmap=="function"),Ml}var ph={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(ph);var sp=function(h){function p(m,E,A){E===401&&ci(A)&&(m+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),h.call(this,m),this.status=E,this.url=A,this.name=this.constructor.name,this.message=m}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},p}(Error),vh=vt()?function(){return self.worker&&self.worker.referrer}:function(){return(d.location.protocol==="blob:"?d.parent:d).location.href},ql,Kl,gc=function(h,p){if(!(/^file:/.test(m=h.url)||/^file:/.test(vh())&&!/^\w+:/.test(m))){if(d.fetch&&d.Request&&d.AbortController&&d.Request.prototype.hasOwnProperty("signal"))return function(E,A){var L,D=new d.AbortController,N=new d.Request(E.url,{method:E.method||"GET",body:E.body,credentials:E.credentials,headers:E.headers,referrer:vh(),signal:D.signal}),V=!1,W=!1,q=(L=N.url).indexOf("sku=")>0&&ci(L);E.type==="json"&&N.headers.set("Accept","application/json");var Q=function(ut,At,It){if(!W){if(ut&&ut.message!=="SecurityError"&&at(ut),At&&It)return it(At);var Wt=Date.now();d.fetch(N).then(function(kt){if(kt.ok){var ie=q?kt.clone():null;return it(kt,ie,Wt)}return A(new sp(kt.statusText,kt.status,E.url))}).catch(function(kt){kt.code!==20&&A(new Error(kt.message))})}},it=function(ut,At,It){(E.type==="arrayBuffer"?ut.arrayBuffer():E.type==="json"?ut.json():ut.text()).then(function(Wt){W||(At&&It&&function(kt,ie,ue){if(vo(),ss){var be={status:ie.status,statusText:ie.statusText,headers:new d.Headers};ie.headers.forEach(function(He,lr){return be.headers.set(lr,He)});var Se=zt(ie.headers.get("Cache-Control")||"");Se["no-store"]||(Se["max-age"]&&be.headers.set("Expires",new Date(ue+1e3*Se["max-age"]).toUTCString()),new Date(be.headers.get("Expires")).getTime()-ue<42e4||function(He,lr){if(_u===void 0)try{new Response(new ReadableStream),_u=!0}catch{_u=!1}_u?lr(He.body):He.blob().then(lr)}(ie,function(He){var lr=new d.Response(He,be);vo(),ss&&ss.then(function(_r){return _r.put(ju(kt.url),lr)}).catch(function(_r){return at(_r.message)})}))}}(N,At,It),V=!0,A(null,Wt,ut.headers.get("Cache-Control"),ut.headers.get("Expires")))}).catch(function(Wt){W||A(new Error(Wt.message))})};return q?function(ut,At){if(vo(),!ss)return At(null);var It=ju(ut.url);ss.then(function(Wt){Wt.match(It).then(function(kt){var ie=function(ue){if(!ue)return!1;var be=new Date(ue.headers.get("Expires")||0),Se=zt(ue.headers.get("Cache-Control")||"");return be>Date.now()&&!Se["no-cache"]}(kt);Wt.delete(It),ie&&Wt.put(It,kt.clone()),At(null,kt,ie)}).catch(At)}).catch(At)}(N,Q):Q(null,null),{cancel:function(){W=!0,V||D.abort()}}}(h,p);if(vt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",h,p,void 0,!0)}var m;return function(E,A){var L=new d.XMLHttpRequest;for(var D in L.open(E.method||"GET",E.url,!0),E.type==="arrayBuffer"&&(L.responseType="arraybuffer"),E.headers)L.setRequestHeader(D,E.headers[D]);return E.type==="json"&&(L.responseType="text",L.setRequestHeader("Accept","application/json")),L.withCredentials=E.credentials==="include",L.onerror=function(){A(new Error(L.statusText))},L.onload=function(){if((L.status>=200&&L.status<300||L.status===0)&&L.response!==null){var N=L.response;if(E.type==="json")try{N=JSON.parse(L.response)}catch(V){return A(V)}A(null,N,L.getResponseHeader("Cache-Control"),L.getResponseHeader("Expires"))}else A(new sp(L.statusText,L.status,E.url))},L.send(E.body),{cancel:function(){return L.abort()}}}(h,p)},cd=function(h,p){return gc(M(h,{type:"arrayBuffer"}),p)},Hi=function(h,p){return gc(M(h,{method:"POST"}),p)},tt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";ql=[],Kl=0;var nt=function(h,p){if(nr.supported&&(h.headers||(h.headers={}),h.headers.accept="image/webp,*/*"),Kl>=re.MAX_PARALLEL_IMAGE_REQUESTS){var m={requestParameters:h,callback:p,cancelled:!1,cancel:function(){this.cancelled=!0}};return ql.push(m),m}Kl++;var E=!1,A=function(){if(!E)for(E=!0,Kl--;ql.length&&Kl<re.MAX_PARALLEL_IMAGE_REQUESTS;){var D=ql.shift();D.cancelled||(D.cancel=nt(D.requestParameters,D.callback).cancel)}},L=cd(h,function(D,N,V,W){A(),D?p(D):N&&(ud()?function(q,Q){var it=new d.Blob([new Uint8Array(q)],{type:"image/png"});d.createImageBitmap(it).then(function(ut){Q(null,ut)}).catch(function(ut){Q(new Error("Could not load image because of "+ut.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(N,p):function(q,Q,it,ut){var At=new d.Image,It=d.URL;At.onload=function(){Q(null,At),It.revokeObjectURL(At.src),At.onload=null,d.requestAnimationFrame(function(){At.src=tt})},At.onerror=function(){return Q(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Wt=new d.Blob([new Uint8Array(q)],{type:"image/png"});At.cacheControl=it,At.expires=ut,At.src=q.byteLength?It.createObjectURL(Wt):tt}(N,p,V,W))});return{cancel:function(){L.cancel(),A()}}};function ot(h,p,m){m[h]&&m[h].indexOf(p)!==-1||(m[h]=m[h]||[],m[h].push(p))}function yt(h,p,m){if(m&&m[h]){var E=m[h].indexOf(p);E!==-1&&m[h].splice(E,1)}}var Rt=function(h,p){p===void 0&&(p={}),M(this,p),this.type=h},jt=function(h){function p(m,E){E===void 0&&(E={}),h.call(this,"error",M({error:m},E))}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p}(Rt),Jt=function(){};Jt.prototype.on=function(h,p){return this._listeners=this._listeners||{},ot(h,p,this._listeners),this},Jt.prototype.off=function(h,p){return yt(h,p,this._listeners),yt(h,p,this._oneTimeListeners),this},Jt.prototype.once=function(h,p){return this._oneTimeListeners=this._oneTimeListeners||{},ot(h,p,this._oneTimeListeners),this},Jt.prototype.fire=function(h,p){typeof h=="string"&&(h=new Rt(h,p||{}));var m=h.type;if(this.listens(m)){h.target=this;for(var E=0,A=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];E<A.length;E+=1)A[E].call(this,h);for(var L=0,D=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];L<D.length;L+=1){var N=D[L];yt(m,N,this._oneTimeListeners),N.call(this,h)}var V=this._eventedParent;V&&(M(h,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),V.fire(h))}else h instanceof jt&&console.error(h.error);return this},Jt.prototype.listens=function(h){return this._listeners&&this._listeners[h]&&this._listeners[h].length>0||this._oneTimeListeners&&this._oneTimeListeners[h]&&this._oneTimeListeners[h].length>0||this._eventedParent&&this._eventedParent.listens(h)},Jt.prototype.setEventedParent=function(h,p){return this._eventedParent=h,this._eventedParentData=p,this};var ht={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Dt=function(h,p,m,E){this.message=(h?h+": ":"")+m,E&&(this.identifier=E),p!=null&&p.__line__&&(this.line=p.__line__)};function se(h){var p=h.value;return p?[new Dt(h.key,p,"constants have been deprecated as of v8")]:[]}function Pe(h){for(var p=[],m=arguments.length-1;m-- >0;)p[m]=arguments[m+1];for(var E=0,A=p;E<A.length;E+=1){var L=A[E];for(var D in L)h[D]=L[D]}return h}function er(h){return h instanceof Number||h instanceof String||h instanceof Boolean?h.valueOf():h}function Ae(h){if(Array.isArray(h))return h.map(Ae);if(h instanceof Object&&!(h instanceof Number||h instanceof String||h instanceof Boolean)){var p={};for(var m in h)p[m]=Ae(h[m]);return p}return er(h)}var qe=function(h){function p(m,E){h.call(this,E),this.message=E,this.key=m}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p}(Error),Yr=function(h,p){p===void 0&&(p=[]),this.parent=h,this.bindings={};for(var m=0,E=p;m<E.length;m+=1){var A=E[m];this.bindings[A[0]]=A[1]}};Yr.prototype.concat=function(h){return new Yr(this,h)},Yr.prototype.get=function(h){if(this.bindings[h])return this.bindings[h];if(this.parent)return this.parent.get(h);throw new Error(h+" not found in scope.")},Yr.prototype.has=function(h){return!!this.bindings[h]||!!this.parent&&this.parent.has(h)};var Hr={kind:"null"},Ie={kind:"number"},Mr={kind:"string"},pr={kind:"boolean"},mr={kind:"color"},Un={kind:"object"},Cr={kind:"value"},hi={kind:"collator"},na={kind:"formatted"},oi={kind:"resolvedImage"};function Ci(h,p){return{kind:"array",itemType:h,N:p}}function $n(h){if(h.kind==="array"){var p=$n(h.itemType);return typeof h.N=="number"?"array<"+p+", "+h.N+">":h.itemType.kind==="value"?"array":"array<"+p+">"}return h.kind}var go=[Hr,Ie,Mr,pr,mr,na,Un,Ci(Cr),oi];function vi(h,p){if(p.kind==="error")return null;if(h.kind==="array"){if(p.kind==="array"&&(p.N===0&&p.itemType.kind==="value"||!vi(h.itemType,p.itemType))&&(typeof h.N!="number"||h.N===p.N))return null}else{if(h.kind===p.kind)return null;if(h.kind==="value"){for(var m=0,E=go;m<E.length;m+=1)if(!vi(E[m],p))return null}}return"Expected "+$n(h)+" but found "+$n(p)+" instead."}function ia(h,p){return p.some(function(m){return m.kind===h.kind})}function Bi(h,p){return p.some(function(m){return m==="null"?h===null:m==="array"?Array.isArray(h):m==="object"?h&&!Array.isArray(h)&&typeof h=="object":m===typeof h})}var Hn=s(function(h,p){var m={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function E(N){return(N=Math.round(N))<0?0:N>255?255:N}function A(N){return E(N[N.length-1]==="%"?parseFloat(N)/100*255:parseInt(N))}function L(N){return(V=N[N.length-1]==="%"?parseFloat(N)/100:parseFloat(N))<0?0:V>1?1:V;var V}function D(N,V,W){return W<0?W+=1:W>1&&(W-=1),6*W<1?N+(V-N)*W*6:2*W<1?V:3*W<2?N+(V-N)*(2/3-W)*6:N}try{p.parseCSSColor=function(N){var V,W=N.replace(/ /g,"").toLowerCase();if(W in m)return m[W].slice();if(W[0]==="#")return W.length===4?(V=parseInt(W.substr(1),16))>=0&&V<=4095?[(3840&V)>>4|(3840&V)>>8,240&V|(240&V)>>4,15&V|(15&V)<<4,1]:null:W.length===7&&(V=parseInt(W.substr(1),16))>=0&&V<=16777215?[(16711680&V)>>16,(65280&V)>>8,255&V,1]:null;var q=W.indexOf("("),Q=W.indexOf(")");if(q!==-1&&Q+1===W.length){var it=W.substr(0,q),ut=W.substr(q+1,Q-(q+1)).split(","),At=1;switch(it){case"rgba":if(ut.length!==4)return null;At=L(ut.pop());case"rgb":return ut.length!==3?null:[A(ut[0]),A(ut[1]),A(ut[2]),At];case"hsla":if(ut.length!==4)return null;At=L(ut.pop());case"hsl":if(ut.length!==3)return null;var It=(parseFloat(ut[0])%360+360)%360/360,Wt=L(ut[1]),kt=L(ut[2]),ie=kt<=.5?kt*(Wt+1):kt+Wt-kt*Wt,ue=2*kt-ie;return[E(255*D(ue,ie,It+1/3)),E(255*D(ue,ie,It)),E(255*D(ue,ie,It-1/3)),At];default:return null}}return null}}catch{}}).parseCSSColor,si=function(h,p,m,E){E===void 0&&(E=1),this.r=h,this.g=p,this.b=m,this.a=E};si.parse=function(h){if(h){if(h instanceof si)return h;if(typeof h=="string"){var p=Hn(h);if(p)return new si(p[0]/255*p[3],p[1]/255*p[3],p[2]/255*p[3],p[3])}}},si.prototype.toString=function(){var h=this.toArray(),p=h[1],m=h[2],E=h[3];return"rgba("+Math.round(h[0])+","+Math.round(p)+","+Math.round(m)+","+E+")"},si.prototype.toArray=function(){var h=this.a;return h===0?[0,0,0,0]:[255*this.r/h,255*this.g/h,255*this.b/h,h]},si.black=new si(0,0,0,1),si.white=new si(1,1,1,1),si.transparent=new si(0,0,0,0),si.red=new si(1,0,0,1);var ws=function(h,p,m){this.sensitivity=h?p?"variant":"case":p?"accent":"base",this.locale=m,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};ws.prototype.compare=function(h,p){return this.collator.compare(h,p)},ws.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var nf=function(h,p,m,E,A){this.text=h,this.image=p,this.scale=m,this.fontStack=E,this.textColor=A},ao=function(h){this.sections=h};ao.fromString=function(h){return new ao([new nf(h,null,null,null,null)])},ao.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(h){return h.text.length!==0||h.image&&h.image.name.length!==0})},ao.factory=function(h){return h instanceof ao?h:ao.fromString(h)},ao.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(h){return h.text}).join("")},ao.prototype.serialize=function(){for(var h=["format"],p=0,m=this.sections;p<m.length;p+=1){var E=m[p];if(E.image)h.push(["image",E.image.name]);else{h.push(E.text);var A={};E.fontStack&&(A["text-font"]=["literal",E.fontStack.split(",")]),E.scale&&(A["font-scale"]=E.scale),E.textColor&&(A["text-color"]=["rgba"].concat(E.textColor.toArray())),h.push(A)}}return h};var Fa=function(h){this.name=h.name,this.available=h.available};function af(h,p,m,E){return typeof h=="number"&&h>=0&&h<=255&&typeof p=="number"&&p>=0&&p<=255&&typeof m=="number"&&m>=0&&m<=255?E===void 0||typeof E=="number"&&E>=0&&E<=1?null:"Invalid rgba value ["+[h,p,m,E].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof E=="number"?[h,p,m,E]:[h,p,m]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function xu(h){if(h===null||typeof h=="string"||typeof h=="boolean"||typeof h=="number"||h instanceof si||h instanceof ws||h instanceof ao||h instanceof Fa)return!0;if(Array.isArray(h)){for(var p=0,m=h;p<m.length;p+=1)if(!xu(m[p]))return!1;return!0}if(typeof h=="object"){for(var E in h)if(!xu(h[E]))return!1;return!0}return!1}function Ra(h){if(h===null)return Hr;if(typeof h=="string")return Mr;if(typeof h=="boolean")return pr;if(typeof h=="number")return Ie;if(h instanceof si)return mr;if(h instanceof ws)return hi;if(h instanceof ao)return na;if(h instanceof Fa)return oi;if(Array.isArray(h)){for(var p,m=h.length,E=0,A=h;E<A.length;E+=1){var L=Ra(A[E]);if(p){if(p===L)continue;p=Cr;break}p=L}return Ci(p||Cr,m)}return Un}function gh(h){var p=typeof h;return h===null?"":p==="string"||p==="number"||p==="boolean"?String(h):h instanceof si||h instanceof ao||h instanceof Fa?h.toString():JSON.stringify(h)}Fa.prototype.toString=function(){return this.name},Fa.fromString=function(h){return h?new Fa({name:h,available:!1}):null},Fa.prototype.serialize=function(){return["image",this.name]};var Vo=function(h,p){this.type=h,this.value=p};Vo.parse=function(h,p){if(h.length!==2)return p.error("'literal' expression requires exactly one argument, but found "+(h.length-1)+" instead.");if(!xu(h[1]))return p.error("invalid value");var m=h[1],E=Ra(m),A=p.expectedType;return E.kind!=="array"||E.N!==0||!A||A.kind!=="array"||typeof A.N=="number"&&A.N!==0||(E=A),new Vo(E,m)},Vo.prototype.evaluate=function(){return this.value},Vo.prototype.eachChild=function(){},Vo.prototype.outputDefined=function(){return!0},Vo.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof si?["rgba"].concat(this.value.toArray()):this.value instanceof ao?this.value.serialize():this.value};var Ia=function(h){this.name="ExpressionEvaluationError",this.message=h};Ia.prototype.toJSON=function(){return this.message};var oo={string:Mr,number:Ie,boolean:pr,object:Un},ya=function(h,p){this.type=h,this.args=p};ya.parse=function(h,p){if(h.length<2)return p.error("Expected at least one argument.");var m,E=1,A=h[0];if(A==="array"){var L,D;if(h.length>2){var N=h[1];if(typeof N!="string"||!(N in oo)||N==="object")return p.error('The item type argument of "array" must be one of string, number, boolean',1);L=oo[N],E++}else L=Cr;if(h.length>3){if(h[2]!==null&&(typeof h[2]!="number"||h[2]<0||h[2]!==Math.floor(h[2])))return p.error('The length argument to "array" must be a positive integer literal',2);D=h[2],E++}m=Ci(L,D)}else m=oo[A];for(var V=[];E<h.length;E++){var W=p.parse(h[E],E,Cr);if(!W)return null;V.push(W)}return new ya(m,V)},ya.prototype.evaluate=function(h){for(var p=0;p<this.args.length;p++){var m=this.args[p].evaluate(h);if(!vi(this.type,Ra(m)))return m;if(p===this.args.length-1)throw new Ia("Expected value to be of type "+$n(this.type)+", but found "+$n(Ra(m))+" instead.")}return null},ya.prototype.eachChild=function(h){this.args.forEach(h)},ya.prototype.outputDefined=function(){return this.args.every(function(h){return h.outputDefined()})},ya.prototype.serialize=function(){var h=this.type,p=[h.kind];if(h.kind==="array"){var m=h.itemType;if(m.kind==="string"||m.kind==="number"||m.kind==="boolean"){p.push(m.kind);var E=h.N;(typeof E=="number"||this.args.length>1)&&p.push(E)}}return p.concat(this.args.map(function(A){return A.serialize()}))};var js=function(h){this.type=na,this.sections=h};js.parse=function(h,p){if(h.length<2)return p.error("Expected at least one argument.");var m=h[1];if(!Array.isArray(m)&&typeof m=="object")return p.error("First argument must be an image or text section.");for(var E=[],A=!1,L=1;L<=h.length-1;++L){var D=h[L];if(A&&typeof D=="object"&&!Array.isArray(D)){A=!1;var N=null;if(D["font-scale"]&&!(N=p.parse(D["font-scale"],1,Ie)))return null;var V=null;if(D["text-font"]&&!(V=p.parse(D["text-font"],1,Ci(Mr))))return null;var W=null;if(D["text-color"]&&!(W=p.parse(D["text-color"],1,mr)))return null;var q=E[E.length-1];q.scale=N,q.font=V,q.textColor=W}else{var Q=p.parse(h[L],1,Cr);if(!Q)return null;var it=Q.type.kind;if(it!=="string"&&it!=="value"&&it!=="null"&&it!=="resolvedImage")return p.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");A=!0,E.push({content:Q,scale:null,font:null,textColor:null})}}return new js(E)},js.prototype.evaluate=function(h){return new ao(this.sections.map(function(p){var m=p.content.evaluate(h);return Ra(m)===oi?new nf("",m,null,null,null):new nf(gh(m),null,p.scale?p.scale.evaluate(h):null,p.font?p.font.evaluate(h).join(","):null,p.textColor?p.textColor.evaluate(h):null)}))},js.prototype.eachChild=function(h){for(var p=0,m=this.sections;p<m.length;p+=1){var E=m[p];h(E.content),E.scale&&h(E.scale),E.font&&h(E.font),E.textColor&&h(E.textColor)}},js.prototype.outputDefined=function(){return!1},js.prototype.serialize=function(){for(var h=["format"],p=0,m=this.sections;p<m.length;p+=1){var E=m[p];h.push(E.content.serialize());var A={};E.scale&&(A["font-scale"]=E.scale.serialize()),E.font&&(A["text-font"]=E.font.serialize()),E.textColor&&(A["text-color"]=E.textColor.serialize()),h.push(A)}return h};var Ns=function(h){this.type=oi,this.input=h};Ns.parse=function(h,p){if(h.length!==2)return p.error("Expected two arguments.");var m=p.parse(h[1],1,Mr);return m?new Ns(m):p.error("No image name provided.")},Ns.prototype.evaluate=function(h){var p=this.input.evaluate(h),m=Fa.fromString(p);return m&&h.availableImages&&(m.available=h.availableImages.indexOf(p)>-1),m},Ns.prototype.eachChild=function(h){h(this.input)},Ns.prototype.outputDefined=function(){return!1},Ns.prototype.serialize=function(){return["image",this.input.serialize()]};var mv={"to-boolean":pr,"to-color":mr,"to-number":Ie,"to-string":Mr},Rl=function(h,p){this.type=h,this.args=p};Rl.parse=function(h,p){if(h.length<2)return p.error("Expected at least one argument.");var m=h[0];if((m==="to-boolean"||m==="to-string")&&h.length!==2)return p.error("Expected one argument.");for(var E=mv[m],A=[],L=1;L<h.length;L++){var D=p.parse(h[L],L,Cr);if(!D)return null;A.push(D)}return new Rl(E,A)},Rl.prototype.evaluate=function(h){if(this.type.kind==="boolean")return!!this.args[0].evaluate(h);if(this.type.kind==="color"){for(var p,m,E=0,A=this.args;E<A.length;E+=1){if(m=null,(p=A[E].evaluate(h))instanceof si)return p;if(typeof p=="string"){var L=h.parseColor(p);if(L)return L}else if(Array.isArray(p)&&!(m=p.length<3||p.length>4?"Invalid rbga value "+JSON.stringify(p)+": expected an array containing either three or four numeric values.":af(p[0],p[1],p[2],p[3])))return new si(p[0]/255,p[1]/255,p[2]/255,p[3])}throw new Ia(m||"Could not parse color from value '"+(typeof p=="string"?p:String(JSON.stringify(p)))+"'")}if(this.type.kind==="number"){for(var D=null,N=0,V=this.args;N<V.length;N+=1){if((D=V[N].evaluate(h))===null)return 0;var W=Number(D);if(!isNaN(W))return W}throw new Ia("Could not convert "+JSON.stringify(D)+" to number.")}return this.type.kind==="formatted"?ao.fromString(gh(this.args[0].evaluate(h))):this.type.kind==="resolvedImage"?Fa.fromString(gh(this.args[0].evaluate(h))):gh(this.args[0].evaluate(h))},Rl.prototype.eachChild=function(h){this.args.forEach(h)},Rl.prototype.outputDefined=function(){return this.args.every(function(h){return h.outputDefined()})},Rl.prototype.serialize=function(){if(this.type.kind==="formatted")return new js([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ns(this.args[0]).serialize();var h=["to-"+this.type.kind];return this.eachChild(function(p){h.push(p.serialize())}),h};var P0=["Unknown","Point","LineString","Polygon"],st=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};st.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},st.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?P0[this.feature.type]:this.feature.type:null},st.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},st.prototype.canonicalID=function(){return this.canonical},st.prototype.properties=function(){return this.feature&&this.feature.properties||{}},st.prototype.parseColor=function(h){var p=this._parseColorCache[h];return p||(p=this._parseColorCache[h]=si.parse(h)),p};var gt=function(h,p,m,E){this.name=h,this.type=p,this._evaluate=m,this.args=E};gt.prototype.evaluate=function(h){return this._evaluate(h,this.args)},gt.prototype.eachChild=function(h){this.args.forEach(h)},gt.prototype.outputDefined=function(){return!1},gt.prototype.serialize=function(){return[this.name].concat(this.args.map(function(h){return h.serialize()}))},gt.parse=function(h,p){var m,E=h[0],A=gt.definitions[E];if(!A)return p.error('Unknown expression "'+E+'". If you wanted a literal array, use ["literal", [...]].',0);for(var L=Array.isArray(A)?A[0]:A.type,D=Array.isArray(A)?[[A[1],A[2]]]:A.overloads,N=D.filter(function(vn){var $r=vn[0];return!Array.isArray($r)||$r.length===h.length-1}),V=null,W=0,q=N;W<q.length;W+=1){var Q=q[W],it=Q[0],ut=Q[1];V=new mh(p.registry,p.path,null,p.scope);for(var At=[],It=!1,Wt=1;Wt<h.length;Wt++){var kt=h[Wt],ie=Array.isArray(it)?it[Wt-1]:it.type,ue=V.parse(kt,1+At.length,ie);if(!ue){It=!0;break}At.push(ue)}if(!It)if(Array.isArray(it)&&it.length!==At.length)V.error("Expected "+it.length+" arguments, but found "+At.length+" instead.");else{for(var be=0;be<At.length;be++){var Se=Array.isArray(it)?it[be]:it.type,He=At[be];V.concat(be+1).checkSubtype(Se,He.type)}if(V.errors.length===0)return new gt(E,L,ut,At)}}if(N.length===1)(m=p.errors).push.apply(m,V.errors);else{for(var lr=(N.length?N:D).map(function(vn){var $r;return $r=vn[0],Array.isArray($r)?"("+$r.map($n).join(", ")+")":"("+$n($r.type)+"...)"}).join(" | "),_r=[],un=1;un<h.length;un++){var Br=p.parse(h[un],1+_r.length);if(!Br)return null;_r.push($n(Br.type))}p.error("Expected arguments of type "+lr+", but found ("+_r.join(", ")+") instead.")}return null},gt.register=function(h,p){for(var m in gt.definitions=p,p)h[m]=gt};var Gt=function(h,p,m){this.type=hi,this.locale=m,this.caseSensitive=h,this.diacriticSensitive=p};function ye(h,p){h[0]=Math.min(h[0],p[0]),h[1]=Math.min(h[1],p[1]),h[2]=Math.max(h[2],p[0]),h[3]=Math.max(h[3],p[1])}function cr(h,p){return!(h[0]<=p[0]||h[2]>=p[2]||h[1]<=p[1]||h[3]>=p[3])}function an(h,p){var m=(180+h[0])/360,E=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h[1]*Math.PI/360)))/360,A=Math.pow(2,p.z);return[Math.round(m*A*8192),Math.round(E*A*8192)]}function Ii(h,p,m){return p[1]>h[1]!=m[1]>h[1]&&h[0]<(m[0]-p[0])*(h[1]-p[1])/(m[1]-p[1])+p[0]}function bo(h,p){for(var m,E,A,L,D,N,V,W=!1,q=0,Q=p.length;q<Q;q++)for(var it=p[q],ut=0,At=it.length;ut<At-1;ut++){if((L=(m=h)[0]-(E=it[ut])[0])*(V=m[1]-(A=it[ut+1])[1])-(N=m[0]-A[0])*(D=m[1]-E[1])==0&&L*N<=0&&D*V<=0)return!1;Ii(h,it[ut],it[ut+1])&&(W=!W)}return W}function hs(h,p){for(var m=0;m<p.length;m++)if(bo(h,p[m]))return!0;return!1}function Go(h,p,m,E){var A=E[0]-m[0],L=E[1]-m[1],D=(h[0]-m[0])*L-A*(h[1]-m[1]),N=(p[0]-m[0])*L-A*(p[1]-m[1]);return D>0&&N<0||D<0&&N>0}function bu(h,p,m){for(var E=0,A=m;E<A.length;E+=1)for(var L=A[E],D=0;D<L.length-1;++D)if((Q=[(q=L[D+1])[0]-(W=L[D])[0],q[1]-W[1]])[0]*(it=[(V=p)[0]-(N=h)[0],V[1]-N[1]])[1]-Q[1]*it[0]!=0&&Go(N,V,W,q)&&Go(W,q,N,V))return!0;var N,V,W,q,Q,it;return!1}function Y_(h,p){for(var m=0;m<h.length;++m)if(!bo(h[m],p))return!1;for(var E=0;E<h.length-1;++E)if(bu(h[E],h[E+1],p))return!1;return!0}function Z_(h,p){for(var m=0;m<p.length;m++)if(Y_(h,p[m]))return!0;return!1}function lp(h,p,m){for(var E=[],A=0;A<h.length;A++){for(var L=[],D=0;D<h[A].length;D++){var N=an(h[A][D],m);ye(p,N),L.push(N)}E.push(L)}return E}function D0(h,p,m){for(var E=[],A=0;A<h.length;A++){var L=lp(h[A],p,m);E.push(L)}return E}function yv(h,p,m,E){if(h[0]<m[0]||h[0]>m[2]){var A=.5*E,L=h[0]-m[0]>A?-E:m[0]-h[0]>A?E:0;L===0&&(L=h[0]-m[2]>A?-E:m[2]-h[0]>A?E:0),h[0]+=L}ye(p,h)}function q_(h,p,m,E){for(var A=8192*Math.pow(2,E.z),L=[8192*E.x,8192*E.y],D=[],N=0,V=h;N<V.length;N+=1)for(var W=0,q=V[N];W<q.length;W+=1){var Q=q[W],it=[Q.x+L[0],Q.y+L[1]];yv(it,p,m,A),D.push(it)}return D}function Ng(h,p,m,E){for(var A,L=8192*Math.pow(2,E.z),D=[8192*E.x,8192*E.y],N=[],V=0,W=h;V<W.length;V+=1){for(var q=[],Q=0,it=W[V];Q<it.length;Q+=1){var ut=it[Q],At=[ut.x+D[0],ut.y+D[1]];ye(p,At),q.push(At)}N.push(q)}if(p[2]-p[0]<=L/2){(A=p)[0]=A[1]=1/0,A[2]=A[3]=-1/0;for(var It=0,Wt=N;It<Wt.length;It+=1)for(var kt=0,ie=Wt[It];kt<ie.length;kt+=1)yv(ie[kt],p,m,L)}return N}Gt.parse=function(h,p){if(h.length!==2)return p.error("Expected one argument.");var m=h[1];if(typeof m!="object"||Array.isArray(m))return p.error("Collator options argument must be an object.");var E=p.parse(m["case-sensitive"]!==void 0&&m["case-sensitive"],1,pr);if(!E)return null;var A=p.parse(m["diacritic-sensitive"]!==void 0&&m["diacritic-sensitive"],1,pr);if(!A)return null;var L=null;return m.locale&&!(L=p.parse(m.locale,1,Mr))?null:new Gt(E,A,L)},Gt.prototype.evaluate=function(h){return new ws(this.caseSensitive.evaluate(h),this.diacriticSensitive.evaluate(h),this.locale?this.locale.evaluate(h):null)},Gt.prototype.eachChild=function(h){h(this.caseSensitive),h(this.diacriticSensitive),this.locale&&h(this.locale)},Gt.prototype.outputDefined=function(){return!1},Gt.prototype.serialize=function(){var h={};return h["case-sensitive"]=this.caseSensitive.serialize(),h["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(h.locale=this.locale.serialize()),["collator",h]};var Cs=function(h,p){this.type=pr,this.geojson=h,this.geometries=p};function of(h){if(h instanceof gt&&(h.name==="get"&&h.args.length===1||h.name==="feature-state"||h.name==="has"&&h.args.length===1||h.name==="properties"||h.name==="geometry-type"||h.name==="id"||/^filter-/.test(h.name))||h instanceof Cs)return!1;var p=!0;return h.eachChild(function(m){p&&!of(m)&&(p=!1)}),p}function sf(h){if(h instanceof gt&&h.name==="feature-state")return!1;var p=!0;return h.eachChild(function(m){p&&!sf(m)&&(p=!1)}),p}function mc(h,p){if(h instanceof gt&&p.indexOf(h.name)>=0)return!1;var m=!0;return h.eachChild(function(E){m&&!mc(E,p)&&(m=!1)}),m}Cs.parse=function(h,p){if(h.length!==2)return p.error("'within' expression requires exactly one argument, but found "+(h.length-1)+" instead.");if(xu(h[1])){var m=h[1];if(m.type==="FeatureCollection")for(var E=0;E<m.features.length;++E){var A=m.features[E].geometry.type;if(A==="Polygon"||A==="MultiPolygon")return new Cs(m,m.features[E].geometry)}else if(m.type==="Feature"){var L=m.geometry.type;if(L==="Polygon"||L==="MultiPolygon")return new Cs(m,m.geometry)}else if(m.type==="Polygon"||m.type==="MultiPolygon")return new Cs(m,m)}return p.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Cs.prototype.evaluate=function(h){if(h.geometry()!=null&&h.canonicalID()!=null){if(h.geometryType()==="Point")return function(p,m){var E=[1/0,1/0,-1/0,-1/0],A=[1/0,1/0,-1/0,-1/0],L=p.canonicalID();if(m.type==="Polygon"){var D=lp(m.coordinates,A,L),N=q_(p.geometry(),E,A,L);if(!cr(E,A))return!1;for(var V=0,W=N;V<W.length;V+=1)if(!bo(W[V],D))return!1}if(m.type==="MultiPolygon"){var q=D0(m.coordinates,A,L),Q=q_(p.geometry(),E,A,L);if(!cr(E,A))return!1;for(var it=0,ut=Q;it<ut.length;it+=1)if(!hs(ut[it],q))return!1}return!0}(h,this.geometries);if(h.geometryType()==="LineString")return function(p,m){var E=[1/0,1/0,-1/0,-1/0],A=[1/0,1/0,-1/0,-1/0],L=p.canonicalID();if(m.type==="Polygon"){var D=lp(m.coordinates,A,L),N=Ng(p.geometry(),E,A,L);if(!cr(E,A))return!1;for(var V=0,W=N;V<W.length;V+=1)if(!Y_(W[V],D))return!1}if(m.type==="MultiPolygon"){var q=D0(m.coordinates,A,L),Q=Ng(p.geometry(),E,A,L);if(!cr(E,A))return!1;for(var it=0,ut=Q;it<ut.length;it+=1)if(!Z_(ut[it],q))return!1}return!0}(h,this.geometries)}return!1},Cs.prototype.eachChild=function(){},Cs.prototype.outputDefined=function(){return!0},Cs.prototype.serialize=function(){return["within",this.geojson]};var yc=function(h,p){this.type=p.type,this.name=h,this.boundExpression=p};yc.parse=function(h,p){if(h.length!==2||typeof h[1]!="string")return p.error("'var' expression requires exactly one string literal argument.");var m=h[1];return p.scope.has(m)?new yc(m,p.scope.get(m)):p.error('Unknown variable "'+m+'". Make sure "'+m+'" has been bound in an enclosing "let" expression before using it.',1)},yc.prototype.evaluate=function(h){return this.boundExpression.evaluate(h)},yc.prototype.eachChild=function(){},yc.prototype.outputDefined=function(){return!1},yc.prototype.serialize=function(){return["var",this.name]};var mh=function(h,p,m,E,A){p===void 0&&(p=[]),E===void 0&&(E=new Yr),A===void 0&&(A=[]),this.registry=h,this.path=p,this.key=p.map(function(L){return"["+L+"]"}).join(""),this.scope=E,this.errors=A,this.expectedType=m};function _v(h,p){for(var m,E=h.length-1,A=0,L=E,D=0;A<=L;)if((m=h[D=Math.floor((A+L)/2)])<=p){if(D===E||p<h[D+1])return D;A=D+1}else{if(!(m>p))throw new Ia("Input is not a number.");L=D-1}return 0}mh.prototype.parse=function(h,p,m,E,A){return A===void 0&&(A={}),p?this.concat(p,m,E)._parse(h,A):this._parse(h,A)},mh.prototype._parse=function(h,p){function m(W,q,Q){return Q==="assert"?new ya(q,[W]):Q==="coerce"?new Rl(q,[W]):W}if(h!==null&&typeof h!="string"&&typeof h!="boolean"&&typeof h!="number"||(h=["literal",h]),Array.isArray(h)){if(h.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var E=h[0];if(typeof E!="string")return this.error("Expression name must be a string, but found "+typeof E+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var A=this.registry[E];if(A){var L=A.parse(h,this);if(!L)return null;if(this.expectedType){var D=this.expectedType,N=L.type;if(D.kind!=="string"&&D.kind!=="number"&&D.kind!=="boolean"&&D.kind!=="object"&&D.kind!=="array"||N.kind!=="value")if(D.kind!=="color"&&D.kind!=="formatted"&&D.kind!=="resolvedImage"||N.kind!=="value"&&N.kind!=="string"){if(this.checkSubtype(D,N))return null}else L=m(L,D,p.typeAnnotation||"coerce");else L=m(L,D,p.typeAnnotation||"assert")}if(!(L instanceof Vo)&&L.type.kind!=="resolvedImage"&&function W(q){if(q instanceof yc)return W(q.boundExpression);if(q instanceof gt&&q.name==="error"||q instanceof Gt||q instanceof Cs)return!1;var Q=q instanceof Rl||q instanceof ya,it=!0;return q.eachChild(function(ut){it=Q?it&&W(ut):it&&ut instanceof Vo}),!!it&&of(q)&&mc(q,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(L)){var V=new st;try{L=new Vo(L.type,L.evaluate(V))}catch(W){return this.error(W.message),null}}return L}return this.error('Unknown expression "'+E+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(h===void 0?"'undefined' value invalid. Use null instead.":typeof h=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof h+" instead.")},mh.prototype.concat=function(h,p,m){var E=typeof h=="number"?this.path.concat(h):this.path,A=m?this.scope.concat(m):this.scope;return new mh(this.registry,E,p||null,A,this.errors)},mh.prototype.error=function(h){for(var p=[],m=arguments.length-1;m-- >0;)p[m]=arguments[m+1];var E=""+this.key+p.map(function(A){return"["+A+"]"}).join("");this.errors.push(new qe(E,h))},mh.prototype.checkSubtype=function(h,p){var m=vi(h,p);return m&&this.error(m),m};var Il=function(h,p,m){this.type=h,this.input=p,this.labels=[],this.outputs=[];for(var E=0,A=m;E<A.length;E+=1){var L=A[E],D=L[1];this.labels.push(L[0]),this.outputs.push(D)}};function so(h,p,m){return h*(1-m)+p*m}Il.parse=function(h,p){if(h.length-1<4)return p.error("Expected at least 4 arguments, but found only "+(h.length-1)+".");if((h.length-1)%2!=0)return p.error("Expected an even number of arguments.");var m=p.parse(h[1],1,Ie);if(!m)return null;var E=[],A=null;p.expectedType&&p.expectedType.kind!=="value"&&(A=p.expectedType);for(var L=1;L<h.length;L+=2){var D=L===1?-1/0:h[L],N=h[L+1],V=L,W=L+1;if(typeof D!="number")return p.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(E.length&&E[E.length-1][0]>=D)return p.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',V);var q=p.parse(N,W,A);if(!q)return null;A=A||q.type,E.push([D,q])}return new Il(A,m,E)},Il.prototype.evaluate=function(h){var p=this.labels,m=this.outputs;if(p.length===1)return m[0].evaluate(h);var E=this.input.evaluate(h);if(E<=p[0])return m[0].evaluate(h);var A=p.length;return E>=p[A-1]?m[A-1].evaluate(h):m[_v(p,E)].evaluate(h)},Il.prototype.eachChild=function(h){h(this.input);for(var p=0,m=this.outputs;p<m.length;p+=1)h(m[p])},Il.prototype.outputDefined=function(){return this.outputs.every(function(h){return h.outputDefined()})},Il.prototype.serialize=function(){for(var h=["step",this.input.serialize()],p=0;p<this.labels.length;p++)p>0&&h.push(this.labels[p]),h.push(this.outputs[p].serialize());return h};var lf=Object.freeze({__proto__:null,number:so,color:function(h,p,m){return new si(so(h.r,p.r,m),so(h.g,p.g,m),so(h.b,p.b,m),so(h.a,p.a,m))},array:function(h,p,m){return h.map(function(E,A){return so(E,p[A],m)})}}),yh=6/29*3*(6/29),kg=Math.PI/180,K_=180/Math.PI;function zg(h){return h>.008856451679035631?Math.pow(h,1/3):h/yh+4/29}function F0(h){return h>6/29?h*h*h:yh*(h-4/29)}function B0(h){return 255*(h<=.0031308?12.92*h:1.055*Math.pow(h,1/2.4)-.055)}function N0(h){return(h/=255)<=.04045?h/12.92:Math.pow((h+.055)/1.055,2.4)}function Q_(h){var p=N0(h.r),m=N0(h.g),E=N0(h.b),A=zg((.4124564*p+.3575761*m+.1804375*E)/.95047),L=zg((.2126729*p+.7151522*m+.072175*E)/1);return{l:116*L-16,a:500*(A-L),b:200*(L-zg((.0193339*p+.119192*m+.9503041*E)/1.08883)),alpha:h.a}}function J_(h){var p=(h.l+16)/116,m=isNaN(h.a)?p:p+h.a/500,E=isNaN(h.b)?p:p-h.b/200;return p=1*F0(p),m=.95047*F0(m),E=1.08883*F0(E),new si(B0(3.2404542*m-1.5371385*p-.4985314*E),B0(-.969266*m+1.8760108*p+.041556*E),B0(.0556434*m-.2040259*p+1.0572252*E),h.alpha)}function lE(h,p,m){var E=p-h;return h+m*(E>180||E<-180?E-360*Math.round(E/360):E)}var xv={forward:Q_,reverse:J_,interpolate:function(h,p,m){return{l:so(h.l,p.l,m),a:so(h.a,p.a,m),b:so(h.b,p.b,m),alpha:so(h.alpha,p.alpha,m)}}},_c={forward:function(h){var p=Q_(h),m=p.l,E=p.a,A=p.b,L=Math.atan2(A,E)*K_;return{h:L<0?L+360:L,c:Math.sqrt(E*E+A*A),l:m,alpha:h.a}},reverse:function(h){var p=h.h*kg,m=h.c;return J_({l:h.l,a:Math.cos(p)*m,b:Math.sin(p)*m,alpha:h.alpha})},interpolate:function(h,p,m){return{h:lE(h.h,p.h,m),c:so(h.c,p.c,m),l:so(h.l,p.l,m),alpha:so(h.alpha,p.alpha,m)}}},t1=Object.freeze({__proto__:null,lab:xv,hcl:_c}),Ss=function(h,p,m,E,A){this.type=h,this.operator=p,this.interpolation=m,this.input=E,this.labels=[],this.outputs=[];for(var L=0,D=A;L<D.length;L+=1){var N=D[L],V=N[1];this.labels.push(N[0]),this.outputs.push(V)}};function hd(h,p,m,E){var A=E-m,L=h-m;return A===0?0:p===1?L/A:(Math.pow(p,L)-1)/(Math.pow(p,A)-1)}Ss.interpolationFactor=function(h,p,m,E){var A=0;if(h.name==="exponential")A=hd(p,h.base,m,E);else if(h.name==="linear")A=hd(p,1,m,E);else if(h.name==="cubic-bezier"){var L=h.controlPoints;A=new l(L[0],L[1],L[2],L[3]).solve(hd(p,1,m,E))}return A},Ss.parse=function(h,p){var m=h[0],E=h[1],A=h[2],L=h.slice(3);if(!Array.isArray(E)||E.length===0)return p.error("Expected an interpolation type expression.",1);if(E[0]==="linear")E={name:"linear"};else if(E[0]==="exponential"){var D=E[1];if(typeof D!="number")return p.error("Exponential interpolation requires a numeric base.",1,1);E={name:"exponential",base:D}}else{if(E[0]!=="cubic-bezier")return p.error("Unknown interpolation type "+String(E[0]),1,0);var N=E.slice(1);if(N.length!==4||N.some(function(Wt){return typeof Wt!="number"||Wt<0||Wt>1}))return p.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);E={name:"cubic-bezier",controlPoints:N}}if(h.length-1<4)return p.error("Expected at least 4 arguments, but found only "+(h.length-1)+".");if((h.length-1)%2!=0)return p.error("Expected an even number of arguments.");if(!(A=p.parse(A,2,Ie)))return null;var V=[],W=null;m==="interpolate-hcl"||m==="interpolate-lab"?W=mr:p.expectedType&&p.expectedType.kind!=="value"&&(W=p.expectedType);for(var q=0;q<L.length;q+=2){var Q=L[q],it=L[q+1],ut=q+3,At=q+4;if(typeof Q!="number")return p.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ut);if(V.length&&V[V.length-1][0]>=Q)return p.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ut);var It=p.parse(it,At,W);if(!It)return null;W=W||It.type,V.push([Q,It])}return W.kind==="number"||W.kind==="color"||W.kind==="array"&&W.itemType.kind==="number"&&typeof W.N=="number"?new Ss(W,m,E,A,V):p.error("Type "+$n(W)+" is not interpolatable.")},Ss.prototype.evaluate=function(h){var p=this.labels,m=this.outputs;if(p.length===1)return m[0].evaluate(h);var E=this.input.evaluate(h);if(E<=p[0])return m[0].evaluate(h);var A=p.length;if(E>=p[A-1])return m[A-1].evaluate(h);var L=_v(p,E),D=Ss.interpolationFactor(this.interpolation,E,p[L],p[L+1]),N=m[L].evaluate(h),V=m[L+1].evaluate(h);return this.operator==="interpolate"?lf[this.type.kind.toLowerCase()](N,V,D):this.operator==="interpolate-hcl"?_c.reverse(_c.interpolate(_c.forward(N),_c.forward(V),D)):xv.reverse(xv.interpolate(xv.forward(N),xv.forward(V),D))},Ss.prototype.eachChild=function(h){h(this.input);for(var p=0,m=this.outputs;p<m.length;p+=1)h(m[p])},Ss.prototype.outputDefined=function(){return this.outputs.every(function(h){return h.outputDefined()})},Ss.prototype.serialize=function(){var h;h=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var p=[this.operator,h,this.input.serialize()],m=0;m<this.labels.length;m++)p.push(this.labels[m],this.outputs[m].serialize());return p};var uf=function(h,p){this.type=h,this.args=p};uf.parse=function(h,p){if(h.length<2)return p.error("Expectected at least one argument.");var m=null,E=p.expectedType;E&&E.kind!=="value"&&(m=E);for(var A=[],L=0,D=h.slice(1);L<D.length;L+=1){var N=p.parse(D[L],1+A.length,m,void 0,{typeAnnotation:"omit"});if(!N)return null;m=m||N.type,A.push(N)}var V=E&&A.some(function(W){return vi(E,W.type)});return new uf(V?Cr:m,A)},uf.prototype.evaluate=function(h){for(var p,m=null,E=0,A=0,L=this.args;A<L.length&&(E++,(m=L[A].evaluate(h))&&m instanceof Fa&&!m.available&&(p||(p=m.name),m=null,E===this.args.length&&(m=p)),m===null);A+=1);return m},uf.prototype.eachChild=function(h){this.args.forEach(h)},uf.prototype.outputDefined=function(){return this.args.every(function(h){return h.outputDefined()})},uf.prototype.serialize=function(){var h=["coalesce"];return this.eachChild(function(p){h.push(p.serialize())}),h};var Ql=function(h,p){this.type=p.type,this.bindings=[].concat(h),this.result=p};Ql.prototype.evaluate=function(h){return this.result.evaluate(h)},Ql.prototype.eachChild=function(h){for(var p=0,m=this.bindings;p<m.length;p+=1)h(m[p][1]);h(this.result)},Ql.parse=function(h,p){if(h.length<4)return p.error("Expected at least 3 arguments, but found "+(h.length-1)+" instead.");for(var m=[],E=1;E<h.length-1;E+=2){var A=h[E];if(typeof A!="string")return p.error("Expected string, but found "+typeof A+" instead.",E);if(/[^a-zA-Z0-9_]/.test(A))return p.error("Variable names must contain only alphanumeric characters or '_'.",E);var L=p.parse(h[E+1],E+1);if(!L)return null;m.push([A,L])}var D=p.parse(h[h.length-1],h.length-1,p.expectedType,m);return D?new Ql(m,D):null},Ql.prototype.outputDefined=function(){return this.result.outputDefined()},Ql.prototype.serialize=function(){for(var h=["let"],p=0,m=this.bindings;p<m.length;p+=1){var E=m[p];h.push(E[0],E[1].serialize())}return h.push(this.result.serialize()),h};var cf=function(h,p,m){this.type=h,this.index=p,this.input=m};cf.parse=function(h,p){if(h.length!==3)return p.error("Expected 2 arguments, but found "+(h.length-1)+" instead.");var m=p.parse(h[1],1,Ie),E=p.parse(h[2],2,Ci(p.expectedType||Cr));return m&&E?new cf(E.type.itemType,m,E):null},cf.prototype.evaluate=function(h){var p=this.index.evaluate(h),m=this.input.evaluate(h);if(p<0)throw new Ia("Array index out of bounds: "+p+" < 0.");if(p>=m.length)throw new Ia("Array index out of bounds: "+p+" > "+(m.length-1)+".");if(p!==Math.floor(p))throw new Ia("Array index must be an integer, but found "+p+" instead.");return m[p]},cf.prototype.eachChild=function(h){h(this.index),h(this.input)},cf.prototype.outputDefined=function(){return!1},cf.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Eu=function(h,p){this.type=pr,this.needle=h,this.haystack=p};Eu.parse=function(h,p){if(h.length!==3)return p.error("Expected 2 arguments, but found "+(h.length-1)+" instead.");var m=p.parse(h[1],1,Cr),E=p.parse(h[2],2,Cr);return m&&E?ia(m.type,[pr,Mr,Ie,Hr,Cr])?new Eu(m,E):p.error("Expected first argument to be of type boolean, string, number or null, but found "+$n(m.type)+" instead"):null},Eu.prototype.evaluate=function(h){var p=this.needle.evaluate(h),m=this.haystack.evaluate(h);if(!m)return!1;if(!Bi(p,["boolean","string","number","null"]))throw new Ia("Expected first argument to be of type boolean, string, number or null, but found "+$n(Ra(p))+" instead.");if(!Bi(m,["string","array"]))throw new Ia("Expected second argument to be of type array or string, but found "+$n(Ra(m))+" instead.");return m.indexOf(p)>=0},Eu.prototype.eachChild=function(h){h(this.needle),h(this.haystack)},Eu.prototype.outputDefined=function(){return!0},Eu.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var _h=function(h,p,m){this.type=Ie,this.needle=h,this.haystack=p,this.fromIndex=m};_h.parse=function(h,p){if(h.length<=2||h.length>=5)return p.error("Expected 3 or 4 arguments, but found "+(h.length-1)+" instead.");var m=p.parse(h[1],1,Cr),E=p.parse(h[2],2,Cr);if(!m||!E)return null;if(!ia(m.type,[pr,Mr,Ie,Hr,Cr]))return p.error("Expected first argument to be of type boolean, string, number or null, but found "+$n(m.type)+" instead");if(h.length===4){var A=p.parse(h[3],3,Ie);return A?new _h(m,E,A):null}return new _h(m,E)},_h.prototype.evaluate=function(h){var p=this.needle.evaluate(h),m=this.haystack.evaluate(h);if(!Bi(p,["boolean","string","number","null"]))throw new Ia("Expected first argument to be of type boolean, string, number or null, but found "+$n(Ra(p))+" instead.");if(!Bi(m,["string","array"]))throw new Ia("Expected second argument to be of type array or string, but found "+$n(Ra(m))+" instead.");if(this.fromIndex){var E=this.fromIndex.evaluate(h);return m.indexOf(p,E)}return m.indexOf(p)},_h.prototype.eachChild=function(h){h(this.needle),h(this.haystack),this.fromIndex&&h(this.fromIndex)},_h.prototype.outputDefined=function(){return!1},_h.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var h=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),h]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Jl=function(h,p,m,E,A,L){this.inputType=h,this.type=p,this.input=m,this.cases=E,this.outputs=A,this.otherwise=L};Jl.parse=function(h,p){if(h.length<5)return p.error("Expected at least 4 arguments, but found only "+(h.length-1)+".");if(h.length%2!=1)return p.error("Expected an even number of arguments.");var m,E;p.expectedType&&p.expectedType.kind!=="value"&&(E=p.expectedType);for(var A={},L=[],D=2;D<h.length-1;D+=2){var N=h[D],V=h[D+1];Array.isArray(N)||(N=[N]);var W=p.concat(D);if(N.length===0)return W.error("Expected at least one branch label.");for(var q=0,Q=N;q<Q.length;q+=1){var it=Q[q];if(typeof it!="number"&&typeof it!="string")return W.error("Branch labels must be numbers or strings.");if(typeof it=="number"&&Math.abs(it)>Number.MAX_SAFE_INTEGER)return W.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof it=="number"&&Math.floor(it)!==it)return W.error("Numeric branch labels must be integer values.");if(m){if(W.checkSubtype(m,Ra(it)))return null}else m=Ra(it);if(A[String(it)]!==void 0)return W.error("Branch labels must be unique.");A[String(it)]=L.length}var ut=p.parse(V,D,E);if(!ut)return null;E=E||ut.type,L.push(ut)}var At=p.parse(h[1],1,Cr);if(!At)return null;var It=p.parse(h[h.length-1],h.length-1,E);return It?At.type.kind!=="value"&&p.concat(1).checkSubtype(m,At.type)?null:new Jl(m,E,At,A,L,It):null},Jl.prototype.evaluate=function(h){var p=this.input.evaluate(h);return(Ra(p)===this.inputType&&this.outputs[this.cases[p]]||this.otherwise).evaluate(h)},Jl.prototype.eachChild=function(h){h(this.input),this.outputs.forEach(h),h(this.otherwise)},Jl.prototype.outputDefined=function(){return this.outputs.every(function(h){return h.outputDefined()})&&this.otherwise.outputDefined()},Jl.prototype.serialize=function(){for(var h=this,p=["match",this.input.serialize()],m=[],E={},A=0,L=Object.keys(this.cases).sort();A<L.length;A+=1){var D=L[A];(Q=E[this.cases[D]])===void 0?(E[this.cases[D]]=m.length,m.push([this.cases[D],[D]])):m[Q][1].push(D)}for(var N=function(ut){return h.inputType.kind==="number"?Number(ut):ut},V=0,W=m;V<W.length;V+=1){var q=W[V],Q=q[0],it=q[1];p.push(it.length===1?N(it[0]):it.map(N)),p.push(this.outputs[outputIndex$1].serialize())}return p.push(this.otherwise.serialize()),p};var xh=function(h,p,m){this.type=h,this.branches=p,this.otherwise=m};xh.parse=function(h,p){if(h.length<4)return p.error("Expected at least 3 arguments, but found only "+(h.length-1)+".");if(h.length%2!=0)return p.error("Expected an odd number of arguments.");var m;p.expectedType&&p.expectedType.kind!=="value"&&(m=p.expectedType);for(var E=[],A=1;A<h.length-1;A+=2){var L=p.parse(h[A],A,pr);if(!L)return null;var D=p.parse(h[A+1],A+1,m);if(!D)return null;E.push([L,D]),m=m||D.type}var N=p.parse(h[h.length-1],h.length-1,m);return N?new xh(m,E,N):null},xh.prototype.evaluate=function(h){for(var p=0,m=this.branches;p<m.length;p+=1){var E=m[p],A=E[1];if(E[0].evaluate(h))return A.evaluate(h)}return this.otherwise.evaluate(h)},xh.prototype.eachChild=function(h){for(var p=0,m=this.branches;p<m.length;p+=1){var E=m[p],A=E[1];h(E[0]),h(A)}h(this.otherwise)},xh.prototype.outputDefined=function(){return this.branches.every(function(h){return h[1].outputDefined()})&&this.otherwise.outputDefined()},xh.prototype.serialize=function(){var h=["case"];return this.eachChild(function(p){h.push(p.serialize())}),h};var hf=function(h,p,m,E){this.type=h,this.input=p,this.beginIndex=m,this.endIndex=E};function e1(h,p){return h==="=="||h==="!="?p.kind==="boolean"||p.kind==="string"||p.kind==="number"||p.kind==="null"||p.kind==="value":p.kind==="string"||p.kind==="number"||p.kind==="value"}function r1(h,p,m,E){return E.compare(p,m)===0}function ua(h,p,m){var E=h!=="=="&&h!=="!=";return function(){function A(L,D,N){this.type=pr,this.lhs=L,this.rhs=D,this.collator=N,this.hasUntypedArgument=L.type.kind==="value"||D.type.kind==="value"}return A.parse=function(L,D){if(L.length!==3&&L.length!==4)return D.error("Expected two or three arguments.");var N=L[0],V=D.parse(L[1],1,Cr);if(!V)return null;if(!e1(N,V.type))return D.concat(1).error('"'+N+`" comparisons are not supported for type '`+$n(V.type)+"'.");var W=D.parse(L[2],2,Cr);if(!W)return null;if(!e1(N,W.type))return D.concat(2).error('"'+N+`" comparisons are not supported for type '`+$n(W.type)+"'.");if(V.type.kind!==W.type.kind&&V.type.kind!=="value"&&W.type.kind!=="value")return D.error("Cannot compare types '"+$n(V.type)+"' and '"+$n(W.type)+"'.");E&&(V.type.kind==="value"&&W.type.kind!=="value"?V=new ya(W.type,[V]):V.type.kind!=="value"&&W.type.kind==="value"&&(W=new ya(V.type,[W])));var q=null;if(L.length===4){if(V.type.kind!=="string"&&W.type.kind!=="string"&&V.type.kind!=="value"&&W.type.kind!=="value")return D.error("Cannot use collator to compare non-string types.");if(!(q=D.parse(L[3],3,hi)))return null}return new A(V,W,q)},A.prototype.evaluate=function(L){var D=this.lhs.evaluate(L),N=this.rhs.evaluate(L);if(E&&this.hasUntypedArgument){var V=Ra(D),W=Ra(N);if(V.kind!==W.kind||V.kind!=="string"&&V.kind!=="number")throw new Ia('Expected arguments for "'+h+'" to be (string, string) or (number, number), but found ('+V.kind+", "+W.kind+") instead.")}if(this.collator&&!E&&this.hasUntypedArgument){var q=Ra(D),Q=Ra(N);if(q.kind!=="string"||Q.kind!=="string")return p(L,D,N)}return this.collator?m(L,D,N,this.collator.evaluate(L)):p(L,D,N)},A.prototype.eachChild=function(L){L(this.lhs),L(this.rhs),this.collator&&L(this.collator)},A.prototype.outputDefined=function(){return!0},A.prototype.serialize=function(){var L=[h];return this.eachChild(function(D){L.push(D.serialize())}),L},A}()}hf.parse=function(h,p){if(h.length<=2||h.length>=5)return p.error("Expected 3 or 4 arguments, but found "+(h.length-1)+" instead.");var m=p.parse(h[1],1,Cr),E=p.parse(h[2],2,Ie);if(!m||!E)return null;if(!ia(m.type,[Ci(Cr),Mr,Cr]))return p.error("Expected first argument to be of type array or string, but found "+$n(m.type)+" instead");if(h.length===4){var A=p.parse(h[3],3,Ie);return A?new hf(m.type,m,E,A):null}return new hf(m.type,m,E)},hf.prototype.evaluate=function(h){var p=this.input.evaluate(h),m=this.beginIndex.evaluate(h);if(!Bi(p,["string","array"]))throw new Ia("Expected first argument to be of type array or string, but found "+$n(Ra(p))+" instead.");if(this.endIndex){var E=this.endIndex.evaluate(h);return p.slice(m,E)}return p.slice(m)},hf.prototype.eachChild=function(h){h(this.input),h(this.beginIndex),this.endIndex&&h(this.endIndex)},hf.prototype.outputDefined=function(){return!1},hf.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var h=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),h]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var uE=ua("==",function(h,p,m){return p===m},r1),Ug=ua("!=",function(h,p,m){return p!==m},function(h,p,m,E){return!r1(0,p,m,E)}),k0=ua("<",function(h,p,m){return p<m},function(h,p,m,E){return E.compare(p,m)<0}),lo=ua(">",function(h,p,m){return p>m},function(h,p,m,E){return E.compare(p,m)>0}),z0=ua("<=",function(h,p,m){return p<=m},function(h,p,m,E){return E.compare(p,m)<=0}),n1=ua(">=",function(h,p,m){return p>=m},function(h,p,m,E){return E.compare(p,m)>=0}),sl=function(h,p,m,E,A){this.type=Mr,this.number=h,this.locale=p,this.currency=m,this.minFractionDigits=E,this.maxFractionDigits=A};sl.parse=function(h,p){if(h.length!==3)return p.error("Expected two arguments.");var m=p.parse(h[1],1,Ie);if(!m)return null;var E=h[2];if(typeof E!="object"||Array.isArray(E))return p.error("NumberFormat options argument must be an object.");var A=null;if(E.locale&&!(A=p.parse(E.locale,1,Mr)))return null;var L=null;if(E.currency&&!(L=p.parse(E.currency,1,Mr)))return null;var D=null;if(E["min-fraction-digits"]&&!(D=p.parse(E["min-fraction-digits"],1,Ie)))return null;var N=null;return E["max-fraction-digits"]&&!(N=p.parse(E["max-fraction-digits"],1,Ie))?null:new sl(m,A,L,D,N)},sl.prototype.evaluate=function(h){return new Intl.NumberFormat(this.locale?this.locale.evaluate(h):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(h):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(h):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(h):void 0}).format(this.number.evaluate(h))},sl.prototype.eachChild=function(h){h(this.number),this.locale&&h(this.locale),this.currency&&h(this.currency),this.minFractionDigits&&h(this.minFractionDigits),this.maxFractionDigits&&h(this.maxFractionDigits)},sl.prototype.outputDefined=function(){return!1},sl.prototype.serialize=function(){var h={};return this.locale&&(h.locale=this.locale.serialize()),this.currency&&(h.currency=this.currency.serialize()),this.minFractionDigits&&(h["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(h["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),h]};var bh=function(h){this.type=Ie,this.input=h};bh.parse=function(h,p){if(h.length!==2)return p.error("Expected 1 argument, but found "+(h.length-1)+" instead.");var m=p.parse(h[1],1);return m?m.type.kind!=="array"&&m.type.kind!=="string"&&m.type.kind!=="value"?p.error("Expected argument of type string or array, but found "+$n(m.type)+" instead."):new bh(m):null},bh.prototype.evaluate=function(h){var p=this.input.evaluate(h);if(typeof p=="string"||Array.isArray(p))return p.length;throw new Ia("Expected value to be of type string or array, but found "+$n(Ra(p))+" instead.")},bh.prototype.eachChild=function(h){h(this.input)},bh.prototype.outputDefined=function(){return!1},bh.prototype.serialize=function(){var h=["length"];return this.eachChild(function(p){h.push(p.serialize())}),h};var xc={"==":uE,"!=":Ug,">":lo,"<":k0,">=":n1,"<=":z0,array:ya,at:cf,boolean:ya,case:xh,coalesce:uf,collator:Gt,format:js,image:Ns,in:Eu,"index-of":_h,interpolate:Ss,"interpolate-hcl":Ss,"interpolate-lab":Ss,length:bh,let:Ql,literal:Vo,match:Jl,number:ya,"number-format":sl,object:ya,slice:hf,step:Il,string:ya,"to-boolean":Rl,"to-color":Rl,"to-number":Rl,"to-string":Rl,var:yc,within:Cs};function ff(h,p){var m=p[0],E=p[1],A=p[2],L=p[3];m=m.evaluate(h),E=E.evaluate(h),A=A.evaluate(h);var D=L?L.evaluate(h):1,N=af(m,E,A,D);if(N)throw new Ia(N);return new si(m/255*D,E/255*D,A/255*D,D)}function $g(h,p){return h in p}function up(h,p){var m=p[h];return m===void 0?null:m}function Yu(h){return{type:h}}function bv(h){return{result:"success",value:h}}function df(h){return{result:"error",value:h}}function Eh(h){return h["property-type"]==="data-driven"||h["property-type"]==="cross-faded-data-driven"}function U0(h){return!!h.expression&&h.expression.parameters.indexOf("zoom")>-1}function Ev(h){return!!h.expression&&h.expression.interpolated}function wa(h){return h instanceof Number?"number":h instanceof String?"string":h instanceof Boolean?"boolean":Array.isArray(h)?"array":h===null?"null":typeof h}function Hg(h){return typeof h=="object"&&h!==null&&!Array.isArray(h)}function cE(h){return h}function pf(h,p,m){return h!==void 0?h:p!==void 0?p:m!==void 0?m:void 0}function wv(h,p,m,E,A){return pf(typeof m===A?E[m]:void 0,h.default,p.default)}function $0(h,p,m){if(wa(m)!=="number")return pf(h.default,p.default);var E=h.stops.length;if(E===1||m<=h.stops[0][0])return h.stops[0][1];if(m>=h.stops[E-1][0])return h.stops[E-1][1];var A=_v(h.stops.map(function(L){return L[0]}),m);return h.stops[A][1]}function Vg(h,p,m){var E=h.base!==void 0?h.base:1;if(wa(m)!=="number")return pf(h.default,p.default);var A=h.stops.length;if(A===1||m<=h.stops[0][0])return h.stops[0][1];if(m>=h.stops[A-1][0])return h.stops[A-1][1];var L=_v(h.stops.map(function(Q){return Q[0]}),m),D=function(Q,it,ut,At){var It=At-ut,Wt=Q-ut;return It===0?0:it===1?Wt/It:(Math.pow(it,Wt)-1)/(Math.pow(it,It)-1)}(m,E,h.stops[L][0],h.stops[L+1][0]),N=h.stops[L][1],V=h.stops[L+1][1],W=lf[p.type]||cE;if(h.colorSpace&&h.colorSpace!=="rgb"){var q=t1[h.colorSpace];W=function(Q,it){return q.reverse(q.interpolate(q.forward(Q),q.forward(it),D))}}return typeof N.evaluate=="function"?{evaluate:function(){for(var Q=[],it=arguments.length;it--;)Q[it]=arguments[it];var ut=N.evaluate.apply(void 0,Q),At=V.evaluate.apply(void 0,Q);if(ut!==void 0&&At!==void 0)return W(ut,At,D)}}:W(N,V,D)}function wh(h,p,m){return p.type==="color"?m=si.parse(m):p.type==="formatted"?m=ao.fromString(m.toString()):p.type==="resolvedImage"?m=Fa.fromString(m.toString()):wa(m)===p.type||p.type==="enum"&&p.values[m]||(m=void 0),pf(m,h.default,p.default)}gt.register(xc,{error:[{kind:"error"},[Mr],function(h,p){throw new Ia(p[0].evaluate(h))}],typeof:[Mr,[Cr],function(h,p){return $n(Ra(p[0].evaluate(h)))}],"to-rgba":[Ci(Ie,4),[mr],function(h,p){return p[0].evaluate(h).toArray()}],rgb:[mr,[Ie,Ie,Ie],ff],rgba:[mr,[Ie,Ie,Ie,Ie],ff],has:{type:pr,overloads:[[[Mr],function(h,p){return $g(p[0].evaluate(h),h.properties())}],[[Mr,Un],function(h,p){var m=p[1];return $g(p[0].evaluate(h),m.evaluate(h))}]]},get:{type:Cr,overloads:[[[Mr],function(h,p){return up(p[0].evaluate(h),h.properties())}],[[Mr,Un],function(h,p){var m=p[1];return up(p[0].evaluate(h),m.evaluate(h))}]]},"feature-state":[Cr,[Mr],function(h,p){return up(p[0].evaluate(h),h.featureState||{})}],properties:[Un,[],function(h){return h.properties()}],"geometry-type":[Mr,[],function(h){return h.geometryType()}],id:[Cr,[],function(h){return h.id()}],zoom:[Ie,[],function(h){return h.globals.zoom}],"heatmap-density":[Ie,[],function(h){return h.globals.heatmapDensity||0}],"line-progress":[Ie,[],function(h){return h.globals.lineProgress||0}],accumulated:[Cr,[],function(h){return h.globals.accumulated===void 0?null:h.globals.accumulated}],"+":[Ie,Yu(Ie),function(h,p){for(var m=0,E=0,A=p;E<A.length;E+=1)m+=A[E].evaluate(h);return m}],"*":[Ie,Yu(Ie),function(h,p){for(var m=1,E=0,A=p;E<A.length;E+=1)m*=A[E].evaluate(h);return m}],"-":{type:Ie,overloads:[[[Ie,Ie],function(h,p){var m=p[1];return p[0].evaluate(h)-m.evaluate(h)}],[[Ie],function(h,p){return-p[0].evaluate(h)}]]},"/":[Ie,[Ie,Ie],function(h,p){var m=p[1];return p[0].evaluate(h)/m.evaluate(h)}],"%":[Ie,[Ie,Ie],function(h,p){var m=p[1];return p[0].evaluate(h)%m.evaluate(h)}],ln2:[Ie,[],function(){return Math.LN2}],pi:[Ie,[],function(){return Math.PI}],e:[Ie,[],function(){return Math.E}],"^":[Ie,[Ie,Ie],function(h,p){var m=p[1];return Math.pow(p[0].evaluate(h),m.evaluate(h))}],sqrt:[Ie,[Ie],function(h,p){return Math.sqrt(p[0].evaluate(h))}],log10:[Ie,[Ie],function(h,p){return Math.log(p[0].evaluate(h))/Math.LN10}],ln:[Ie,[Ie],function(h,p){return Math.log(p[0].evaluate(h))}],log2:[Ie,[Ie],function(h,p){return Math.log(p[0].evaluate(h))/Math.LN2}],sin:[Ie,[Ie],function(h,p){return Math.sin(p[0].evaluate(h))}],cos:[Ie,[Ie],function(h,p){return Math.cos(p[0].evaluate(h))}],tan:[Ie,[Ie],function(h,p){return Math.tan(p[0].evaluate(h))}],asin:[Ie,[Ie],function(h,p){return Math.asin(p[0].evaluate(h))}],acos:[Ie,[Ie],function(h,p){return Math.acos(p[0].evaluate(h))}],atan:[Ie,[Ie],function(h,p){return Math.atan(p[0].evaluate(h))}],min:[Ie,Yu(Ie),function(h,p){return Math.min.apply(Math,p.map(function(m){return m.evaluate(h)}))}],max:[Ie,Yu(Ie),function(h,p){return Math.max.apply(Math,p.map(function(m){return m.evaluate(h)}))}],abs:[Ie,[Ie],function(h,p){return Math.abs(p[0].evaluate(h))}],round:[Ie,[Ie],function(h,p){var m=p[0].evaluate(h);return m<0?-Math.round(-m):Math.round(m)}],floor:[Ie,[Ie],function(h,p){return Math.floor(p[0].evaluate(h))}],ceil:[Ie,[Ie],function(h,p){return Math.ceil(p[0].evaluate(h))}],"filter-==":[pr,[Mr,Cr],function(h,p){var m=p[0],E=p[1];return h.properties()[m.value]===E.value}],"filter-id-==":[pr,[Cr],function(h,p){var m=p[0];return h.id()===m.value}],"filter-type-==":[pr,[Mr],function(h,p){var m=p[0];return h.geometryType()===m.value}],"filter-<":[pr,[Mr,Cr],function(h,p){var m=p[0],E=p[1],A=h.properties()[m.value],L=E.value;return typeof A==typeof L&&A<L}],"filter-id-<":[pr,[Cr],function(h,p){var m=p[0],E=h.id(),A=m.value;return typeof E==typeof A&&E<A}],"filter->":[pr,[Mr,Cr],function(h,p){var m=p[0],E=p[1],A=h.properties()[m.value],L=E.value;return typeof A==typeof L&&A>L}],"filter-id->":[pr,[Cr],function(h,p){var m=p[0],E=h.id(),A=m.value;return typeof E==typeof A&&E>A}],"filter-<=":[pr,[Mr,Cr],function(h,p){var m=p[0],E=p[1],A=h.properties()[m.value],L=E.value;return typeof A==typeof L&&A<=L}],"filter-id-<=":[pr,[Cr],function(h,p){var m=p[0],E=h.id(),A=m.value;return typeof E==typeof A&&E<=A}],"filter->=":[pr,[Mr,Cr],function(h,p){var m=p[0],E=p[1],A=h.properties()[m.value],L=E.value;return typeof A==typeof L&&A>=L}],"filter-id->=":[pr,[Cr],function(h,p){var m=p[0],E=h.id(),A=m.value;return typeof E==typeof A&&E>=A}],"filter-has":[pr,[Cr],function(h,p){return p[0].value in h.properties()}],"filter-has-id":[pr,[],function(h){return h.id()!==null&&h.id()!==void 0}],"filter-type-in":[pr,[Ci(Mr)],function(h,p){return p[0].value.indexOf(h.geometryType())>=0}],"filter-id-in":[pr,[Ci(Cr)],function(h,p){return p[0].value.indexOf(h.id())>=0}],"filter-in-small":[pr,[Mr,Ci(Cr)],function(h,p){var m=p[0];return p[1].value.indexOf(h.properties()[m.value])>=0}],"filter-in-large":[pr,[Mr,Ci(Cr)],function(h,p){var m=p[0],E=p[1];return function(A,L,D,N){for(;D<=N;){var V=D+N>>1;if(L[V]===A)return!0;L[V]>A?N=V-1:D=V+1}return!1}(h.properties()[m.value],E.value,0,E.value.length-1)}],all:{type:pr,overloads:[[[pr,pr],function(h,p){var m=p[1];return p[0].evaluate(h)&&m.evaluate(h)}],[Yu(pr),function(h,p){for(var m=0,E=p;m<E.length;m+=1)if(!E[m].evaluate(h))return!1;return!0}]]},any:{type:pr,overloads:[[[pr,pr],function(h,p){var m=p[1];return p[0].evaluate(h)||m.evaluate(h)}],[Yu(pr),function(h,p){for(var m=0,E=p;m<E.length;m+=1)if(E[m].evaluate(h))return!0;return!1}]]},"!":[pr,[pr],function(h,p){return!p[0].evaluate(h)}],"is-supported-script":[pr,[Mr],function(h,p){var m=h.globals&&h.globals.isSupportedScript;return!m||m(p[0].evaluate(h))}],upcase:[Mr,[Mr],function(h,p){return p[0].evaluate(h).toUpperCase()}],downcase:[Mr,[Mr],function(h,p){return p[0].evaluate(h).toLowerCase()}],concat:[Mr,Yu(Cr),function(h,p){return p.map(function(m){return gh(m.evaluate(h))}).join("")}],"resolved-locale":[Mr,[hi],function(h,p){return p[0].evaluate(h).resolvedLocale()}]});var vf=function(h,p){this.expression=h,this._warningHistory={},this._evaluator=new st,this._defaultValue=p?function(m){return m.type==="color"&&Hg(m.default)?new si(0,0,0,0):m.type==="color"?si.parse(m.default)||null:m.default===void 0?null:m.default}(p):null,this._enumValues=p&&p.type==="enum"?p.values:null};function fd(h){return Array.isArray(h)&&h.length>0&&typeof h[0]=="string"&&h[0]in xc}function cp(h,p){var m=new mh(xc,[],p?function(A){var L={color:mr,string:Mr,number:Ie,enum:Mr,boolean:pr,formatted:na,resolvedImage:oi};return A.type==="array"?Ci(L[A.value]||Cr,A.length):L[A.type]}(p):void 0),E=m.parse(h,void 0,void 0,void 0,p&&p.type==="string"?{typeAnnotation:"coerce"}:void 0);return E?bv(new vf(E,p)):df(m.errors)}vf.prototype.evaluateWithoutErrorHandling=function(h,p,m,E,A,L){return this._evaluator.globals=h,this._evaluator.feature=p,this._evaluator.featureState=m,this._evaluator.canonical=E,this._evaluator.availableImages=A||null,this._evaluator.formattedSection=L,this.expression.evaluate(this._evaluator)},vf.prototype.evaluate=function(h,p,m,E,A,L){this._evaluator.globals=h,this._evaluator.feature=p||null,this._evaluator.featureState=m||null,this._evaluator.canonical=E,this._evaluator.availableImages=A||null,this._evaluator.formattedSection=L||null;try{var D=this.expression.evaluate(this._evaluator);if(D==null||typeof D=="number"&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new Ia("Expected value to be one of "+Object.keys(this._enumValues).map(function(N){return JSON.stringify(N)}).join(", ")+", but found "+JSON.stringify(D)+" instead.");return D}catch(N){return this._warningHistory[N.message]||(this._warningHistory[N.message]=!0,typeof console<"u"&&console.warn(N.message)),this._defaultValue}};var dd=function(h,p){this.kind=h,this._styleExpression=p,this.isStateDependent=h!=="constant"&&!sf(p.expression)};dd.prototype.evaluateWithoutErrorHandling=function(h,p,m,E,A,L){return this._styleExpression.evaluateWithoutErrorHandling(h,p,m,E,A,L)},dd.prototype.evaluate=function(h,p,m,E,A,L){return this._styleExpression.evaluate(h,p,m,E,A,L)};var pd=function(h,p,m,E){this.kind=h,this.zoomStops=m,this._styleExpression=p,this.isStateDependent=h!=="camera"&&!sf(p.expression),this.interpolationType=E};function H0(h,p){if((h=cp(h,p)).result==="error")return h;var m=h.value.expression,E=of(m);if(!E&&!Eh(p))return df([new qe("","data expressions not supported")]);var A=mc(m,["zoom"]);if(!A&&!U0(p))return df([new qe("","zoom expressions not supported")]);var L=function D(N){var V=null;if(N instanceof Ql)V=D(N.result);else if(N instanceof uf)for(var W=0,q=N.args;W<q.length&&!(V=D(q[W]));W+=1);else(N instanceof Il||N instanceof Ss)&&N.input instanceof gt&&N.input.name==="zoom"&&(V=N);return V instanceof qe||N.eachChild(function(Q){var it=D(Q);it instanceof qe?V=it:!V&&it?V=new qe("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):V&&it&&V!==it&&(V=new qe("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),V}(m);return L||A?L instanceof qe?df([L]):L instanceof Ss&&!Ev(p)?df([new qe("",'"interpolate" expressions cannot be used with this property')]):bv(L?new pd(E?"camera":"composite",h.value,L.labels,L instanceof Ss?L.interpolation:void 0):new dd(E?"constant":"source",h.value)):df([new qe("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}pd.prototype.evaluateWithoutErrorHandling=function(h,p,m,E,A,L){return this._styleExpression.evaluateWithoutErrorHandling(h,p,m,E,A,L)},pd.prototype.evaluate=function(h,p,m,E,A,L){return this._styleExpression.evaluate(h,p,m,E,A,L)},pd.prototype.interpolationFactor=function(h,p,m){return this.interpolationType?Ss.interpolationFactor(this.interpolationType,h,p,m):0};var vd=function(h,p){this._parameters=h,this._specification=p,Pe(this,function m(E,A){var L,D,N,V=A.type==="color",W=E.stops&&typeof E.stops[0][0]=="object",q=W||!(W||E.property!==void 0),Q=E.type||(Ev(A)?"exponential":"interval");if(V&&((E=Pe({},E)).stops&&(E.stops=E.stops.map(function(Br){return[Br[0],si.parse(Br[1])]})),E.default=si.parse(E.default?E.default:A.default)),E.colorSpace&&E.colorSpace!=="rgb"&&!t1[E.colorSpace])throw new Error("Unknown color space: "+E.colorSpace);if(Q==="exponential")L=Vg;else if(Q==="interval")L=$0;else if(Q==="categorical"){L=wv,D=Object.create(null);for(var it=0,ut=E.stops;it<ut.length;it+=1){var At=ut[it];D[At[0]]=At[1]}N=typeof E.stops[0][0]}else{if(Q!=="identity")throw new Error('Unknown function type "'+Q+'"');L=wh}if(W){for(var It={},Wt=[],kt=0;kt<E.stops.length;kt++){var ie=E.stops[kt],ue=ie[0].zoom;It[ue]===void 0&&(It[ue]={zoom:ue,type:E.type,property:E.property,default:E.default,stops:[]},Wt.push(ue)),It[ue].stops.push([ie[0].value,ie[1]])}for(var be=[],Se=0,He=Wt;Se<He.length;Se+=1){var lr=He[Se];be.push([It[lr].zoom,m(It[lr],A)])}var _r={name:"linear"};return{kind:"composite",interpolationType:_r,interpolationFactor:Ss.interpolationFactor.bind(void 0,_r),zoomStops:be.map(function(Br){return Br[0]}),evaluate:function(Br,vn){var $r=Br.zoom;return Vg({stops:be,base:E.base},A,$r).evaluate($r,vn)}}}if(q){var un=Q==="exponential"?{name:"exponential",base:E.base!==void 0?E.base:1}:null;return{kind:"camera",interpolationType:un,interpolationFactor:Ss.interpolationFactor.bind(void 0,un),zoomStops:E.stops.map(function(Br){return Br[0]}),evaluate:function(Br){return L(E,A,Br.zoom,D,N)}}}return{kind:"source",evaluate:function(Br,vn){var $r=vn&&vn.properties?vn.properties[E.property]:void 0;return $r===void 0?pf(E.default,A.default):L(E,A,$r,D,N)}}}(this._parameters,this._specification))};function wu(h){var p=h.key,m=h.value,E=h.valueSpec||{},A=h.objectElementValidators||{},L=h.style,D=h.styleSpec,N=[],V=wa(m);if(V!=="object")return[new Dt(p,m,"object expected, "+V+" found")];for(var W in m){var q=W.split(".")[0],Q=E[q]||E["*"],it=void 0;if(A[q])it=A[q];else if(E[q])it=Si;else if(A["*"])it=A["*"];else{if(!E["*"]){N.push(new Dt(p,m[W],'unknown property "'+W+'"'));continue}it=Si}N=N.concat(it({key:(p&&p+".")+W,value:m[W],valueSpec:Q,style:L,styleSpec:D,object:m,objectKey:W},m))}for(var ut in E)A[ut]||E[ut].required&&E[ut].default===void 0&&m[ut]===void 0&&N.push(new Dt(p,m,'missing required property "'+ut+'"'));return N}function V0(h){var p=h.value,m=h.valueSpec,E=h.style,A=h.styleSpec,L=h.key,D=h.arrayElementValidator||Si;if(wa(p)!=="array")return[new Dt(L,p,"array expected, "+wa(p)+" found")];if(m.length&&p.length!==m.length)return[new Dt(L,p,"array length "+m.length+" expected, length "+p.length+" found")];if(m["min-length"]&&p.length<m["min-length"])return[new Dt(L,p,"array length at least "+m["min-length"]+" expected, length "+p.length+" found")];var N={type:m.value,values:m.values};A.$version<7&&(N.function=m.function),wa(m.value)==="object"&&(N=m.value);for(var V=[],W=0;W<p.length;W++)V=V.concat(D({array:p,arrayIndex:W,value:p[W],valueSpec:N,style:E,styleSpec:A,key:L+"["+W+"]"}));return V}function G0(h){var p=h.key,m=h.value,E=h.valueSpec,A=wa(m);return A==="number"&&m!=m&&(A="NaN"),A!=="number"?[new Dt(p,m,"number expected, "+A+" found")]:"minimum"in E&&m<E.minimum?[new Dt(p,m,m+" is less than the minimum value "+E.minimum)]:"maximum"in E&&m>E.maximum?[new Dt(p,m,m+" is greater than the maximum value "+E.maximum)]:[]}function W0(h){var p,m,E,A=h.valueSpec,L=er(h.value.type),D={},N=L!=="categorical"&&h.value.property===void 0,V=!N,W=wa(h.value.stops)==="array"&&wa(h.value.stops[0])==="array"&&wa(h.value.stops[0][0])==="object",q=wu({key:h.key,value:h.value,valueSpec:h.styleSpec.function,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(ut){if(L==="identity")return[new Dt(ut.key,ut.value,'identity function may not have a "stops" property')];var At=[],It=ut.value;return At=At.concat(V0({key:ut.key,value:It,valueSpec:ut.valueSpec,style:ut.style,styleSpec:ut.styleSpec,arrayElementValidator:Q})),wa(It)==="array"&&It.length===0&&At.push(new Dt(ut.key,It,"array must have at least one stop")),At},default:function(ut){return Si({key:ut.key,value:ut.value,valueSpec:A,style:ut.style,styleSpec:ut.styleSpec})}}});return L==="identity"&&N&&q.push(new Dt(h.key,h.value,'missing required property "property"')),L==="identity"||h.value.stops||q.push(new Dt(h.key,h.value,'missing required property "stops"')),L==="exponential"&&h.valueSpec.expression&&!Ev(h.valueSpec)&&q.push(new Dt(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(V&&!Eh(h.valueSpec)?q.push(new Dt(h.key,h.value,"property functions not supported")):N&&!U0(h.valueSpec)&&q.push(new Dt(h.key,h.value,"zoom functions not supported"))),L!=="categorical"&&!W||h.value.property!==void 0||q.push(new Dt(h.key,h.value,'"property" property is required')),q;function Q(ut){var At=[],It=ut.value,Wt=ut.key;if(wa(It)!=="array")return[new Dt(Wt,It,"array expected, "+wa(It)+" found")];if(It.length!==2)return[new Dt(Wt,It,"array length 2 expected, length "+It.length+" found")];if(W){if(wa(It[0])!=="object")return[new Dt(Wt,It,"object expected, "+wa(It[0])+" found")];if(It[0].zoom===void 0)return[new Dt(Wt,It,"object stop key must have zoom")];if(It[0].value===void 0)return[new Dt(Wt,It,"object stop key must have value")];if(E&&E>er(It[0].zoom))return[new Dt(Wt,It[0].zoom,"stop zoom values must appear in ascending order")];er(It[0].zoom)!==E&&(E=er(It[0].zoom),m=void 0,D={}),At=At.concat(wu({key:Wt+"[0]",value:It[0],valueSpec:{zoom:{}},style:ut.style,styleSpec:ut.styleSpec,objectElementValidators:{zoom:G0,value:it}}))}else At=At.concat(it({key:Wt+"[0]",value:It[0],valueSpec:{},style:ut.style,styleSpec:ut.styleSpec},It));return fd(Ae(It[1]))?At.concat([new Dt(Wt+"[1]",It[1],"expressions are not allowed in function stops.")]):At.concat(Si({key:Wt+"[1]",value:It[1],valueSpec:A,style:ut.style,styleSpec:ut.styleSpec}))}function it(ut,At){var It=wa(ut.value),Wt=er(ut.value),kt=ut.value!==null?ut.value:At;if(p){if(It!==p)return[new Dt(ut.key,kt,It+" stop domain type must match previous stop domain type "+p)]}else p=It;if(It!=="number"&&It!=="string"&&It!=="boolean")return[new Dt(ut.key,kt,"stop domain value must be a number, string, or boolean")];if(It!=="number"&&L!=="categorical"){var ie="number expected, "+It+" found";return Eh(A)&&L===void 0&&(ie+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Dt(ut.key,kt,ie)]}return L!=="categorical"||It!=="number"||isFinite(Wt)&&Math.floor(Wt)===Wt?L!=="categorical"&&It==="number"&&m!==void 0&&Wt<m?[new Dt(ut.key,kt,"stop domain values must appear in ascending order")]:(m=Wt,L==="categorical"&&Wt in D?[new Dt(ut.key,kt,"stop domain values must be unique")]:(D[Wt]=!0,[])):[new Dt(ut.key,kt,"integer expected, found "+Wt)]}}function gf(h){var p=(h.expressionContext==="property"?H0:cp)(Ae(h.value),h.valueSpec);if(p.result==="error")return p.value.map(function(E){return new Dt(""+h.key+E.key,h.value,E.message)});var m=p.value.expression||p.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!m.outputDefined())return[new Dt(h.key,h.value,'Invalid data expression for "'+h.propertyKey+'". Output values must be contained as literals within the expression.')];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!sf(m))return[new Dt(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter"&&!sf(m))return[new Dt(h.key,h.value,'"feature-state" data expressions are not supported with filters.')];if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!mc(m,["zoom","feature-state"]))return[new Dt(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!of(m))return[new Dt(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function bc(h){var p=h.key,m=h.value,E=h.valueSpec,A=[];return Array.isArray(E.values)?E.values.indexOf(er(m))===-1&&A.push(new Dt(p,m,"expected one of ["+E.values.join(", ")+"], "+JSON.stringify(m)+" found")):Object.keys(E.values).indexOf(er(m))===-1&&A.push(new Dt(p,m,"expected one of ["+Object.keys(E.values).join(", ")+"], "+JSON.stringify(m)+" found")),A}function hp(h){if(h===!0||h===!1)return!0;if(!Array.isArray(h)||h.length===0)return!1;switch(h[0]){case"has":return h.length>=2&&h[1]!=="$id"&&h[1]!=="$type";case"in":return h.length>=3&&(typeof h[1]!="string"||Array.isArray(h[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return h.length!==3||Array.isArray(h[1])||Array.isArray(h[2]);case"any":case"all":for(var p=0,m=h.slice(1);p<m.length;p+=1){var E=m[p];if(!hp(E)&&typeof E!="boolean")return!1}return!0;default:return!0}}vd.deserialize=function(h){return new vd(h._parameters,h._specification)},vd.serialize=function(h){return{_parameters:h._parameters,_specification:h._specification}};var Cv={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function mf(h){if(h==null)return{filter:function(){return!0},needGeometry:!1};hp(h)||(h=Gg(h));var p=cp(h,Cv);if(p.result==="error")throw new Error(p.value.map(function(m){return m.key+": "+m.message}).join(", "));return{filter:function(m,E,A){return p.value.evaluate(m,E,{},A)},needGeometry:function m(E){if(!Array.isArray(E))return!1;if(E[0]==="within")return!0;for(var A=1;A<E.length;A++)if(m(E[A]))return!0;return!1}(h)}}function hE(h,p){return h<p?-1:h>p?1:0}function Gg(h){if(!h)return!0;var p,m=h[0];return h.length<=1?m!=="any":m==="=="?X0(h[1],h[2],"=="):m==="!="?Xg(X0(h[1],h[2],"==")):m==="<"||m===">"||m==="<="||m===">="?X0(h[1],h[2],m):m==="any"?(p=h.slice(1),["any"].concat(p.map(Gg))):m==="all"?["all"].concat(h.slice(1).map(Gg)):m==="none"?["all"].concat(h.slice(1).map(Gg).map(Xg)):m==="in"?Wg(h[1],h.slice(2)):m==="!in"?Xg(Wg(h[1],h.slice(2))):m==="has"?i1(h[1]):m==="!has"?Xg(i1(h[1])):m!=="within"||h}function X0(h,p,m){switch(h){case"$type":return["filter-type-"+m,p];case"$id":return["filter-id-"+m,p];default:return["filter-"+m,h,p]}}function Wg(h,p){if(p.length===0)return!1;switch(h){case"$type":return["filter-type-in",["literal",p]];case"$id":return["filter-id-in",["literal",p]];default:return p.length>200&&!p.some(function(m){return typeof m!=typeof p[0]})?["filter-in-large",h,["literal",p.sort(hE)]]:["filter-in-small",h,["literal",p]]}}function i1(h){switch(h){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",h]}}function Xg(h){return["!",h]}function j0(h){return hp(Ae(h.value))?gf(Pe({},h,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function p(m){var E=m.value,A=m.key;if(wa(E)!=="array")return[new Dt(A,E,"array expected, "+wa(E)+" found")];var L,D=m.styleSpec,N=[];if(E.length<1)return[new Dt(A,E,"filter array must have at least 1 element")];switch(N=N.concat(bc({key:A+"[0]",value:E[0],valueSpec:D.filter_operator,style:m.style,styleSpec:m.styleSpec})),er(E[0])){case"<":case"<=":case">":case">=":E.length>=2&&er(E[1])==="$type"&&N.push(new Dt(A,E,'"$type" cannot be use with operator "'+E[0]+'"'));case"==":case"!=":E.length!==3&&N.push(new Dt(A,E,'filter array for operator "'+E[0]+'" must have 3 elements'));case"in":case"!in":E.length>=2&&(L=wa(E[1]))!=="string"&&N.push(new Dt(A+"[1]",E[1],"string expected, "+L+" found"));for(var V=2;V<E.length;V++)L=wa(E[V]),er(E[1])==="$type"?N=N.concat(bc({key:A+"["+V+"]",value:E[V],valueSpec:D.geometry_type,style:m.style,styleSpec:m.styleSpec})):L!=="string"&&L!=="number"&&L!=="boolean"&&N.push(new Dt(A+"["+V+"]",E[V],"string, number, or boolean expected, "+L+" found"));break;case"any":case"all":case"none":for(var W=1;W<E.length;W++)N=N.concat(p({key:A+"["+W+"]",value:E[W],style:m.style,styleSpec:m.styleSpec}));break;case"has":case"!has":L=wa(E[1]),E.length!==2?N.push(new Dt(A,E,'filter array for "'+E[0]+'" operator must have 2 elements')):L!=="string"&&N.push(new Dt(A+"[1]",E[1],"string expected, "+L+" found"));break;case"within":L=wa(E[1]),E.length!==2?N.push(new Dt(A,E,'filter array for "'+E[0]+'" operator must have 2 elements')):L!=="object"&&N.push(new Dt(A+"[1]",E[1],"object expected, "+L+" found"))}return N}(h)}function Sv(h,p){var m=h.key,E=h.style,A=h.styleSpec,L=h.value,D=h.objectKey,N=A[p+"_"+h.layerType];if(!N)return[];var V=D.match(/^(.*)-transition$/);if(p==="paint"&&V&&N[V[1]]&&N[V[1]].transition)return Si({key:m,value:L,valueSpec:A.transition,style:E,styleSpec:A});var W,q=h.valueSpec||N[D];if(!q)return[new Dt(m,L,'unknown property "'+D+'"')];if(wa(L)==="string"&&Eh(q)&&!q.tokens&&(W=/^{([^}]+)}$/.exec(L)))return[new Dt(m,L,'"'+D+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(W[1])+" }`.")];var Q=[];return h.layerType==="symbol"&&(D==="text-field"&&E&&!E.glyphs&&Q.push(new Dt(m,L,'use of "text-field" requires a style "glyphs" property')),D==="text-font"&&Hg(Ae(L))&&er(L.type)==="identity"&&Q.push(new Dt(m,L,'"text-font" does not support identity functions'))),Q.concat(Si({key:h.key,value:L,valueSpec:q,style:E,styleSpec:A,expressionContext:"property",propertyType:p,propertyKey:D}))}function Y0(h){return Sv(h,"paint")}function gd(h){return Sv(h,"layout")}function Z0(h){var p=[],m=h.value,E=h.key,A=h.style,L=h.styleSpec;m.type||m.ref||p.push(new Dt(E,m,'either "type" or "ref" is required'));var D,N=er(m.type),V=er(m.ref);if(m.id)for(var W=er(m.id),q=0;q<h.arrayIndex;q++){var Q=A.layers[q];er(Q.id)===W&&p.push(new Dt(E,m.id,'duplicate layer id "'+m.id+'", previously used at line '+Q.id.__line__))}if("ref"in m)["type","source","source-layer","filter","layout"].forEach(function(At){At in m&&p.push(new Dt(E,m[At],'"'+At+'" is prohibited for ref layers'))}),A.layers.forEach(function(At){er(At.id)===V&&(D=At)}),D?D.ref?p.push(new Dt(E,m.ref,"ref cannot reference another ref layer")):N=er(D.type):p.push(new Dt(E,m.ref,'ref layer "'+V+'" not found'));else if(N!=="background")if(m.source){var it=A.sources&&A.sources[m.source],ut=it&&er(it.type);it?ut==="vector"&&N==="raster"?p.push(new Dt(E,m.source,'layer "'+m.id+'" requires a raster source')):ut==="raster"&&N!=="raster"?p.push(new Dt(E,m.source,'layer "'+m.id+'" requires a vector source')):ut!=="vector"||m["source-layer"]?ut==="raster-dem"&&N!=="hillshade"?p.push(new Dt(E,m.source,"raster-dem source can only be used with layer type 'hillshade'.")):N!=="line"||!m.paint||!m.paint["line-gradient"]||ut==="geojson"&&it.lineMetrics||p.push(new Dt(E,m,'layer "'+m.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):p.push(new Dt(E,m,'layer "'+m.id+'" must specify a "source-layer"')):p.push(new Dt(E,m.source,'source "'+m.source+'" not found'))}else p.push(new Dt(E,m,'missing required property "source"'));return p=p.concat(wu({key:E,value:m,valueSpec:L.layer,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Si({key:E+".type",value:m.type,valueSpec:L.layer.type,style:h.style,styleSpec:h.styleSpec,object:m,objectKey:"type"})},filter:j0,layout:function(At){return wu({layer:m,key:At.key,value:At.value,style:At.style,styleSpec:At.styleSpec,objectElementValidators:{"*":function(It){return gd(Pe({layerType:N},It))}}})},paint:function(At){return wu({layer:m,key:At.key,value:At.value,style:At.style,styleSpec:At.styleSpec,objectElementValidators:{"*":function(It){return Y0(Pe({layerType:N},It))}}})}}}))}function yf(h){var p=h.value,m=h.key,E=wa(p);return E!=="string"?[new Dt(m,p,"string expected, "+E+" found")]:[]}var Ca={promoteId:function(h){var p=h.key,m=h.value;if(wa(m)==="string")return yf({key:p,value:m});var E=[];for(var A in m)E.push.apply(E,yf({key:p+"."+A,value:m[A]}));return E}};function jg(h){var p=h.value,m=h.key,E=h.styleSpec,A=h.style;if(!p.type)return[new Dt(m,p,'"type" is required')];var L,D=er(p.type);switch(D){case"vector":case"raster":case"raster-dem":return wu({key:m,value:p,valueSpec:E["source_"+D.replace("-","_")],style:h.style,styleSpec:E,objectElementValidators:Ca});case"geojson":if(L=wu({key:m,value:p,valueSpec:E.source_geojson,style:A,styleSpec:E,objectElementValidators:Ca}),p.cluster)for(var N in p.clusterProperties){var V=p.clusterProperties[N],W=V[0],q=typeof W=="string"?[W,["accumulated"],["get",N]]:W;L.push.apply(L,gf({key:m+"."+N+".map",value:V[1],expressionContext:"cluster-map"})),L.push.apply(L,gf({key:m+"."+N+".reduce",value:q,expressionContext:"cluster-reduce"}))}return L;case"video":return wu({key:m,value:p,valueSpec:E.source_video,style:A,styleSpec:E});case"image":return wu({key:m,value:p,valueSpec:E.source_image,style:A,styleSpec:E});case"canvas":return[new Dt(m,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return bc({key:m+".type",value:p.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:A,styleSpec:E})}}function Ec(h){var p=h.value,m=h.styleSpec,E=m.light,A=h.style,L=[],D=wa(p);if(p===void 0)return L;if(D!=="object")return L.concat([new Dt("light",p,"object expected, "+D+" found")]);for(var N in p){var V=N.match(/^(.*)-transition$/);L=L.concat(V&&E[V[1]]&&E[V[1]].transition?Si({key:N,value:p[N],valueSpec:m.transition,style:A,styleSpec:m}):E[N]?Si({key:N,value:p[N],valueSpec:E[N],style:A,styleSpec:m}):[new Dt(N,p[N],'unknown property "'+N+'"')])}return L}var _f={"*":function(){return[]},array:V0,boolean:function(h){var p=h.value,m=h.key,E=wa(p);return E!=="boolean"?[new Dt(m,p,"boolean expected, "+E+" found")]:[]},number:G0,color:function(h){var p=h.key,m=h.value,E=wa(m);return E!=="string"?[new Dt(p,m,"color expected, "+E+" found")]:Hn(m)===null?[new Dt(p,m,'color expected, "'+m+'" found')]:[]},constants:se,enum:bc,filter:j0,function:W0,layer:Z0,object:wu,source:jg,light:Ec,string:yf,formatted:function(h){return yf(h).length===0?[]:gf(h)},resolvedImage:function(h){return yf(h).length===0?[]:gf(h)}};function Si(h){var p=h.value,m=h.valueSpec,E=h.styleSpec;return m.expression&&Hg(er(p))?W0(h):m.expression&&fd(Ae(p))?gf(h):m.type&&_f[m.type]?_f[m.type](h):wu(Pe({},h,{valueSpec:m.type?E[m.type]:m}))}function Sa(h){var p=h.value,m=h.key,E=yf(h);return E.length||(p.indexOf("{fontstack}")===-1&&E.push(new Dt(m,p,'"glyphs" url must include a "{fontstack}" token')),p.indexOf("{range}")===-1&&E.push(new Dt(m,p,'"glyphs" url must include a "{range}" token'))),E}function tu(h,p){p===void 0&&(p=ht);var m=[];return m=m.concat(Si({key:"",value:h,valueSpec:p.$root,styleSpec:p,style:h,objectElementValidators:{glyphs:Sa,"*":function(){return[]}}})),h.constants&&(m=m.concat(se({key:"constants",value:h.constants,style:h,styleSpec:p}))),Tv(m)}function Tv(h){return[].concat(h).sort(function(p,m){return p.line-m.line})}function fp(h){return function(){for(var p=[],m=arguments.length;m--;)p[m]=arguments[m];return Tv(h.apply(this,p))}}tu.source=fp(jg),tu.light=fp(Ec),tu.layer=fp(Z0),tu.filter=fp(j0),tu.paintProperty=fp(Y0),tu.layoutProperty=fp(gd);var Av=tu,a1=Av.light,Yg=Av.paintProperty,Mv=Av.layoutProperty;function xf(h,p){var m=!1;if(p&&p.length)for(var E=0,A=p;E<A.length;E+=1)h.fire(new jt(new Error(A[E].message))),m=!0;return m}var Wo=Ga;function Ga(h,p,m){var E=this.cells=[];if(h instanceof ArrayBuffer){this.arrayBuffer=h;var A=new Int32Array(this.arrayBuffer);h=A[0],this.d=(p=A[1])+2*(m=A[2]);for(var L=0;L<this.d*this.d;L++){var D=A[3+L],N=A[3+L+1];E.push(D===N?null:A.subarray(D,N))}var V=A[3+E.length+1];this.keys=A.subarray(A[3+E.length],V),this.bboxes=A.subarray(V),this.insert=this._insertReadonly}else{this.d=p+2*m;for(var W=0;W<this.d*this.d;W++)E.push([]);this.keys=[],this.bboxes=[]}this.n=p,this.extent=h,this.padding=m,this.scale=p/h,this.uid=0;var q=m/p*h;this.min=-q,this.max=h+q}Ga.prototype.insert=function(h,p,m,E,A){this._forEachCell(p,m,E,A,this._insertCell,this.uid++),this.keys.push(h),this.bboxes.push(p),this.bboxes.push(m),this.bboxes.push(E),this.bboxes.push(A)},Ga.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ga.prototype._insertCell=function(h,p,m,E,A,L){this.cells[A].push(L)},Ga.prototype.query=function(h,p,m,E,A){var L=this.min,D=this.max;if(h<=L&&p<=L&&D<=m&&D<=E&&!A)return Array.prototype.slice.call(this.keys);var N=[];return this._forEachCell(h,p,m,E,this._queryCell,N,{},A),N},Ga.prototype._queryCell=function(h,p,m,E,A,L,D,N){var V=this.cells[A];if(V!==null)for(var W=this.keys,q=this.bboxes,Q=0;Q<V.length;Q++){var it=V[Q];if(D[it]===void 0){var ut=4*it;(N?N(q[ut+0],q[ut+1],q[ut+2],q[ut+3]):h<=q[ut+2]&&p<=q[ut+3]&&m>=q[ut+0]&&E>=q[ut+1])?(D[it]=!0,L.push(W[it])):D[it]=!1}}},Ga.prototype._forEachCell=function(h,p,m,E,A,L,D,N){for(var V=this._convertToCellCoord(h),W=this._convertToCellCoord(p),q=this._convertToCellCoord(m),Q=this._convertToCellCoord(E),it=V;it<=q;it++)for(var ut=W;ut<=Q;ut++){var At=this.d*ut+it;if((!N||N(this._convertFromCellCoord(it),this._convertFromCellCoord(ut),this._convertFromCellCoord(it+1),this._convertFromCellCoord(ut+1)))&&A.call(this,h,p,m,E,At,L,D,N))return}},Ga.prototype._convertFromCellCoord=function(h){return(h-this.padding)/this.scale},Ga.prototype._convertToCellCoord=function(h){return Math.max(0,Math.min(this.d-1,Math.floor(h*this.scale)+this.padding))},Ga.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var h=this.cells,p=3+this.cells.length+1+1,m=0,E=0;E<this.cells.length;E++)m+=this.cells[E].length;var A=new Int32Array(p+m+this.keys.length+this.bboxes.length);A[0]=this.extent,A[1]=this.n,A[2]=this.padding;for(var L=p,D=0;D<h.length;D++){var N=h[D];A[3+D]=L,A.set(N,L),L+=N.length}return A[3+h.length]=L,A.set(this.keys,L),A[3+h.length+1]=L+=this.keys.length,A.set(this.bboxes,L),L+=this.bboxes.length,A.buffer};var dp=d.ImageData,q0=d.ImageBitmap,mo={};function Xr(h,p,m){m===void 0&&(m={}),Object.defineProperty(p,"_classRegistryKey",{value:h,writeable:!1}),mo[h]={klass:p,omit:m.omit||[],shallow:m.shallow||[]}}for(var ll in Xr("Object",Object),Wo.serialize=function(h,p){var m=h.toArrayBuffer();return p&&p.push(m),{buffer:m}},Wo.deserialize=function(h){return new Wo(h.buffer)},Xr("Grid",Wo),Xr("Color",si),Xr("Error",Error),Xr("ResolvedImage",Fa),Xr("StylePropertyFunction",vd),Xr("StyleExpression",vf,{omit:["_evaluator"]}),Xr("ZoomDependentExpression",pd),Xr("ZoomConstantExpression",dd),Xr("CompoundExpression",gt,{omit:["_evaluate"]}),xc)xc[ll]._classRegistryKey||Xr("Expression_"+ll,xc[ll]);function Rv(h){return h&&typeof ArrayBuffer<"u"&&(h instanceof ArrayBuffer||h.constructor&&h.constructor.name==="ArrayBuffer")}function pp(h){return q0&&h instanceof q0}function Ys(h,p){if(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp)return h;if(Rv(h)||pp(h))return p&&p.push(h),h;if(ArrayBuffer.isView(h)){var m=h;return p&&p.push(m.buffer),m}if(h instanceof dp)return p&&p.push(h.data.buffer),h;if(Array.isArray(h)){for(var E=[],A=0,L=h;A<L.length;A+=1)E.push(Ys(L[A],p));return E}if(typeof h=="object"){var D=h.constructor,N=D._classRegistryKey;if(!N)throw new Error("can't serialize object of unregistered class");var V=D.serialize?D.serialize(h,p):{};if(!D.serialize){for(var W in h)if(h.hasOwnProperty(W)&&!(mo[N].omit.indexOf(W)>=0)){var q=h[W];V[W]=mo[N].shallow.indexOf(W)>=0?q:Ys(q,p)}h instanceof Error&&(V.message=h.message)}if(V.$name)throw new Error("$name property is reserved for worker serialization logic.");return N!=="Object"&&(V.$name=N),V}throw new Error("can't serialize object of type "+typeof h)}function da(h){if(h==null||typeof h=="boolean"||typeof h=="number"||typeof h=="string"||h instanceof Boolean||h instanceof Number||h instanceof String||h instanceof Date||h instanceof RegExp||Rv(h)||pp(h)||ArrayBuffer.isView(h)||h instanceof dp)return h;if(Array.isArray(h))return h.map(da);if(typeof h=="object"){var p=h.$name||"Object",m=mo[p].klass;if(!m)throw new Error("can't deserialize unregistered class "+p);if(m.deserialize)return m.deserialize(h);for(var E=Object.create(m.prototype),A=0,L=Object.keys(h);A<L.length;A+=1){var D=L[A];if(D!=="$name"){var N=h[D];E[D]=mo[p].shallow.indexOf(D)>=0?N:da(N)}}return E}throw new Error("can't deserialize object of type "+typeof h)}var Zg=function(){this.first=!0};Zg.prototype.update=function(h,p){var m=Math.floor(h);return this.first?(this.first=!1,this.lastIntegerZoom=m,this.lastIntegerZoomTime=0,this.lastZoom=h,this.lastFloorZoom=m,!0):(this.lastFloorZoom>m?(this.lastIntegerZoom=m+1,this.lastIntegerZoomTime=p):this.lastFloorZoom<m&&(this.lastIntegerZoom=m,this.lastIntegerZoomTime=p),h!==this.lastZoom&&(this.lastZoom=h,this.lastFloorZoom=m,!0))};var xr={"Latin-1 Supplement":function(h){return h>=128&&h<=255},Arabic:function(h){return h>=1536&&h<=1791},"Arabic Supplement":function(h){return h>=1872&&h<=1919},"Arabic Extended-A":function(h){return h>=2208&&h<=2303},"Hangul Jamo":function(h){return h>=4352&&h<=4607},"Unified Canadian Aboriginal Syllabics":function(h){return h>=5120&&h<=5759},Khmer:function(h){return h>=6016&&h<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(h){return h>=6320&&h<=6399},"General Punctuation":function(h){return h>=8192&&h<=8303},"Letterlike Symbols":function(h){return h>=8448&&h<=8527},"Number Forms":function(h){return h>=8528&&h<=8591},"Miscellaneous Technical":function(h){return h>=8960&&h<=9215},"Control Pictures":function(h){return h>=9216&&h<=9279},"Optical Character Recognition":function(h){return h>=9280&&h<=9311},"Enclosed Alphanumerics":function(h){return h>=9312&&h<=9471},"Geometric Shapes":function(h){return h>=9632&&h<=9727},"Miscellaneous Symbols":function(h){return h>=9728&&h<=9983},"Miscellaneous Symbols and Arrows":function(h){return h>=11008&&h<=11263},"CJK Radicals Supplement":function(h){return h>=11904&&h<=12031},"Kangxi Radicals":function(h){return h>=12032&&h<=12255},"Ideographic Description Characters":function(h){return h>=12272&&h<=12287},"CJK Symbols and Punctuation":function(h){return h>=12288&&h<=12351},Hiragana:function(h){return h>=12352&&h<=12447},Katakana:function(h){return h>=12448&&h<=12543},Bopomofo:function(h){return h>=12544&&h<=12591},"Hangul Compatibility Jamo":function(h){return h>=12592&&h<=12687},Kanbun:function(h){return h>=12688&&h<=12703},"Bopomofo Extended":function(h){return h>=12704&&h<=12735},"CJK Strokes":function(h){return h>=12736&&h<=12783},"Katakana Phonetic Extensions":function(h){return h>=12784&&h<=12799},"Enclosed CJK Letters and Months":function(h){return h>=12800&&h<=13055},"CJK Compatibility":function(h){return h>=13056&&h<=13311},"CJK Unified Ideographs Extension A":function(h){return h>=13312&&h<=19903},"Yijing Hexagram Symbols":function(h){return h>=19904&&h<=19967},"CJK Unified Ideographs":function(h){return h>=19968&&h<=40959},"Yi Syllables":function(h){return h>=40960&&h<=42127},"Yi Radicals":function(h){return h>=42128&&h<=42191},"Hangul Jamo Extended-A":function(h){return h>=43360&&h<=43391},"Hangul Syllables":function(h){return h>=44032&&h<=55215},"Hangul Jamo Extended-B":function(h){return h>=55216&&h<=55295},"Private Use Area":function(h){return h>=57344&&h<=63743},"CJK Compatibility Ideographs":function(h){return h>=63744&&h<=64255},"Arabic Presentation Forms-A":function(h){return h>=64336&&h<=65023},"Vertical Forms":function(h){return h>=65040&&h<=65055},"CJK Compatibility Forms":function(h){return h>=65072&&h<=65103},"Small Form Variants":function(h){return h>=65104&&h<=65135},"Arabic Presentation Forms-B":function(h){return h>=65136&&h<=65279},"Halfwidth and Fullwidth Forms":function(h){return h>=65280&&h<=65519}};function Ch(h){for(var p=0,m=h;p<m.length;p+=1)if(Iv(m[p].charCodeAt(0)))return!0;return!1}function Iv(h){return!(h!==746&&h!==747&&(h<4352||!(xr["Bopomofo Extended"](h)||xr.Bopomofo(h)||xr["CJK Compatibility Forms"](h)&&!(h>=65097&&h<=65103)||xr["CJK Compatibility Ideographs"](h)||xr["CJK Compatibility"](h)||xr["CJK Radicals Supplement"](h)||xr["CJK Strokes"](h)||!(!xr["CJK Symbols and Punctuation"](h)||h>=12296&&h<=12305||h>=12308&&h<=12319||h===12336)||xr["CJK Unified Ideographs Extension A"](h)||xr["CJK Unified Ideographs"](h)||xr["Enclosed CJK Letters and Months"](h)||xr["Hangul Compatibility Jamo"](h)||xr["Hangul Jamo Extended-A"](h)||xr["Hangul Jamo Extended-B"](h)||xr["Hangul Jamo"](h)||xr["Hangul Syllables"](h)||xr.Hiragana(h)||xr["Ideographic Description Characters"](h)||xr.Kanbun(h)||xr["Kangxi Radicals"](h)||xr["Katakana Phonetic Extensions"](h)||xr.Katakana(h)&&h!==12540||!(!xr["Halfwidth and Fullwidth Forms"](h)||h===65288||h===65289||h===65293||h>=65306&&h<=65310||h===65339||h===65341||h===65343||h>=65371&&h<=65503||h===65507||h>=65512&&h<=65519)||!(!xr["Small Form Variants"](h)||h>=65112&&h<=65118||h>=65123&&h<=65126)||xr["Unified Canadian Aboriginal Syllabics"](h)||xr["Unified Canadian Aboriginal Syllabics Extended"](h)||xr["Vertical Forms"](h)||xr["Yijing Hexagram Symbols"](h)||xr["Yi Syllables"](h)||xr["Yi Radicals"](h))))}function qg(h){return!(Iv(h)||function(p){return!!(xr["Latin-1 Supplement"](p)&&(p===167||p===169||p===174||p===177||p===188||p===189||p===190||p===215||p===247)||xr["General Punctuation"](p)&&(p===8214||p===8224||p===8225||p===8240||p===8241||p===8251||p===8252||p===8258||p===8263||p===8264||p===8265||p===8273)||xr["Letterlike Symbols"](p)||xr["Number Forms"](p)||xr["Miscellaneous Technical"](p)&&(p>=8960&&p<=8967||p>=8972&&p<=8991||p>=8996&&p<=9e3||p===9003||p>=9085&&p<=9114||p>=9150&&p<=9165||p===9167||p>=9169&&p<=9179||p>=9186&&p<=9215)||xr["Control Pictures"](p)&&p!==9251||xr["Optical Character Recognition"](p)||xr["Enclosed Alphanumerics"](p)||xr["Geometric Shapes"](p)||xr["Miscellaneous Symbols"](p)&&!(p>=9754&&p<=9759)||xr["Miscellaneous Symbols and Arrows"](p)&&(p>=11026&&p<=11055||p>=11088&&p<=11097||p>=11192&&p<=11243)||xr["CJK Symbols and Punctuation"](p)||xr.Katakana(p)||xr["Private Use Area"](p)||xr["CJK Compatibility Forms"](p)||xr["Small Form Variants"](p)||xr["Halfwidth and Fullwidth Forms"](p)||p===8734||p===8756||p===8757||p>=9984&&p<=10087||p>=10102&&p<=10131||p===65532||p===65533)}(h))}function Cu(h){return h>=1424&&h<=2303||xr["Arabic Presentation Forms-A"](h)||xr["Arabic Presentation Forms-B"](h)}function Ll(h,p){return!(!p&&Cu(h)||h>=2304&&h<=3583||h>=3840&&h<=4255||xr.Khmer(h))}function Kg(h){for(var p=0,m=h;p<m.length;p+=1)if(Cu(m[p].charCodeAt(0)))return!0;return!1}var Qg=null,Zs="unavailable",wc=null,o1=function(h){h&&typeof h=="string"&&h.indexOf("NetworkError")>-1&&(Zs="error"),Qg&&Qg(h)};function vp(){Jg.fire(new Rt("pluginStateChange",{pluginStatus:Zs,pluginURL:wc}))}var Jg=new Jt,K0=function(){return Zs},Ol=function(){if(Zs!=="deferred"||!wc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Zs="loading",vp(),wc&&cd({url:wc},function(h){h?o1(h):(Zs="loaded",vp())})},eu={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Zs==="loaded"||eu.applyArabicShaping!=null},isLoading:function(){return Zs==="loading"},setState:function(h){Zs=h.pluginStatus,wc=h.pluginURL},isParsed:function(){return eu.applyArabicShaping!=null&&eu.processBidirectionalText!=null&&eu.processStyledBidirectionalText!=null},getPluginURL:function(){return wc}},Wn=function(h,p){this.zoom=h,p?(this.now=p.now,this.fadeDuration=p.fadeDuration,this.zoomHistory=p.zoomHistory,this.transition=p.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Zg,this.transition={})};Wn.prototype.isSupportedScript=function(h){return function(p,m){for(var E=0,A=p;E<A.length;E+=1)if(!Ll(A[E].charCodeAt(0),m))return!1;return!0}(h,eu.isLoaded())},Wn.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Wn.prototype.getCrossfadeParameters=function(){var h=this.zoom,p=h-Math.floor(h),m=this.crossFadingFactor();return h>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:p+(1-p)*m}:{fromScale:.5,toScale:1,t:1-(1-m)*p}};var ru=function(h,p){this.property=h,this.value=p,this.expression=function(m,E){if(Hg(m))return new vd(m,E);if(fd(m)){var A=H0(m,E);if(A.result==="error")throw new Error(A.value.map(function(D){return D.key+": "+D.message}).join(", "));return A.value}var L=m;return typeof m=="string"&&E.type==="color"&&(L=si.parse(m)),{kind:"constant",evaluate:function(){return L}}}(p===void 0?h.specification.default:p,h.specification)};ru.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},ru.prototype.possiblyEvaluate=function(h,p,m){return this.property.possiblyEvaluate(this,h,p,m)};var nu=function(h){this.property=h,this.value=new ru(h,void 0)};nu.prototype.transitioned=function(h,p){return new bf(this.property,this.value,p,M({},h.transition,this.transition),h.now)},nu.prototype.untransitioned=function(){return new bf(this.property,this.value,null,{},0)};var fs=function(h){this._properties=h,this._values=Object.create(h.defaultTransitionablePropertyValues)};fs.prototype.getValue=function(h){return X(this._values[h].value.value)},fs.prototype.setValue=function(h,p){this._values.hasOwnProperty(h)||(this._values[h]=new nu(this._values[h].property)),this._values[h].value=new ru(this._values[h].property,p===null?void 0:X(p))},fs.prototype.getTransition=function(h){return X(this._values[h].transition)},fs.prototype.setTransition=function(h,p){this._values.hasOwnProperty(h)||(this._values[h]=new nu(this._values[h].property)),this._values[h].transition=X(p)||void 0},fs.prototype.serialize=function(){for(var h={},p=0,m=Object.keys(this._values);p<m.length;p+=1){var E=m[p],A=this.getValue(E);A!==void 0&&(h[E]=A);var L=this.getTransition(E);L!==void 0&&(h[E+"-transition"]=L)}return h},fs.prototype.transitioned=function(h,p){for(var m=new Sh(this._properties),E=0,A=Object.keys(this._values);E<A.length;E+=1){var L=A[E];m._values[L]=this._values[L].transitioned(h,p._values[L])}return m},fs.prototype.untransitioned=function(){for(var h=new Sh(this._properties),p=0,m=Object.keys(this._values);p<m.length;p+=1){var E=m[p];h._values[E]=this._values[E].untransitioned()}return h};var bf=function(h,p,m,E,A){this.property=h,this.value=p,this.begin=A+E.delay||0,this.end=this.begin+E.duration||0,h.specification.transition&&(E.delay||E.duration)&&(this.prior=m)};bf.prototype.possiblyEvaluate=function(h,p,m){var E=h.now||0,A=this.value.possiblyEvaluate(h,p,m),L=this.prior;if(L){if(E>this.end)return this.prior=null,A;if(this.value.isDataDriven())return this.prior=null,A;if(E<this.begin)return L.possiblyEvaluate(h,p,m);var D=(E-this.begin)/(this.end-this.begin);return this.property.interpolate(L.possiblyEvaluate(h,p,m),A,function(N){if(N<=0)return 0;if(N>=1)return 1;var V=N*N,W=V*N;return 4*(N<.5?W:3*(N-V)+W-.75)}(D))}return A};var Sh=function(h){this._properties=h,this._values=Object.create(h.defaultTransitioningPropertyValues)};Sh.prototype.possiblyEvaluate=function(h,p,m){for(var E=new gp(this._properties),A=0,L=Object.keys(this._values);A<L.length;A+=1){var D=L[A];E._values[D]=this._values[D].possiblyEvaluate(h,p,m)}return E},Sh.prototype.hasTransition=function(){for(var h=0,p=Object.keys(this._values);h<p.length;h+=1)if(this._values[p[h]].prior)return!0;return!1};var Su=function(h){this._properties=h,this._values=Object.create(h.defaultPropertyValues)};Su.prototype.getValue=function(h){return X(this._values[h].value)},Su.prototype.setValue=function(h,p){this._values[h]=new ru(this._values[h].property,p===null?void 0:X(p))},Su.prototype.serialize=function(){for(var h={},p=0,m=Object.keys(this._values);p<m.length;p+=1){var E=m[p],A=this.getValue(E);A!==void 0&&(h[E]=A)}return h},Su.prototype.possiblyEvaluate=function(h,p,m){for(var E=new gp(this._properties),A=0,L=Object.keys(this._values);A<L.length;A+=1){var D=L[A];E._values[D]=this._values[D].possiblyEvaluate(h,p,m)}return E};var ks=function(h,p,m){this.property=h,this.value=p,this.parameters=m};ks.prototype.isConstant=function(){return this.value.kind==="constant"},ks.prototype.constantOr=function(h){return this.value.kind==="constant"?this.value.value:h},ks.prototype.evaluate=function(h,p,m,E){return this.property.evaluate(this.value,this.parameters,h,p,m,E)};var gp=function(h){this._properties=h,this._values=Object.create(h.defaultPossiblyEvaluatedValues)};gp.prototype.get=function(h){return this._values[h]};var sn=function(h){this.specification=h};sn.prototype.possiblyEvaluate=function(h,p){return h.expression.evaluate(p)},sn.prototype.interpolate=function(h,p,m){var E=lf[this.specification.type];return E?E(h,p,m):h};var qr=function(h,p){this.specification=h,this.overrides=p};qr.prototype.possiblyEvaluate=function(h,p,m,E){return new ks(this,h.expression.kind==="constant"||h.expression.kind==="camera"?{kind:"constant",value:h.expression.evaluate(p,null,{},m,E)}:h.expression,p)},qr.prototype.interpolate=function(h,p,m){if(h.value.kind!=="constant"||p.value.kind!=="constant")return h;if(h.value.value===void 0||p.value.value===void 0)return new ks(this,{kind:"constant",value:void 0},h.parameters);var E=lf[this.specification.type];return E?new ks(this,{kind:"constant",value:E(h.value.value,p.value.value,m)},h.parameters):h},qr.prototype.evaluate=function(h,p,m,E,A,L){return h.kind==="constant"?h.value:h.evaluate(p,m,E,A,L)};var Pl=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype.possiblyEvaluate=function(m,E,A,L){if(m.value===void 0)return new ks(this,{kind:"constant",value:void 0},E);if(m.expression.kind==="constant"){var D=m.expression.evaluate(E,null,{},A,L),N=m.property.specification.type==="resolvedImage"&&typeof D!="string"?D.name:D,V=this._calculate(N,N,N,E);return new ks(this,{kind:"constant",value:V},E)}if(m.expression.kind==="camera"){var W=this._calculate(m.expression.evaluate({zoom:E.zoom-1}),m.expression.evaluate({zoom:E.zoom}),m.expression.evaluate({zoom:E.zoom+1}),E);return new ks(this,{kind:"constant",value:W},E)}return new ks(this,m.expression,E)},p.prototype.evaluate=function(m,E,A,L,D,N){if(m.kind==="source"){var V=m.evaluate(E,A,L,D,N);return this._calculate(V,V,V,E)}return m.kind==="composite"?this._calculate(m.evaluate({zoom:Math.floor(E.zoom)-1},A,L),m.evaluate({zoom:Math.floor(E.zoom)},A,L),m.evaluate({zoom:Math.floor(E.zoom)+1},A,L),E):m.value},p.prototype._calculate=function(m,E,A,L){return L.zoom>L.zoomHistory.lastIntegerZoom?{from:m,to:E}:{from:A,to:E}},p.prototype.interpolate=function(m){return m},p}(qr),zs=function(h){this.specification=h};zs.prototype.possiblyEvaluate=function(h,p,m,E){if(h.value!==void 0){if(h.expression.kind==="constant"){var A=h.expression.evaluate(p,null,{},m,E);return this._calculate(A,A,A,p)}return this._calculate(h.expression.evaluate(new Wn(Math.floor(p.zoom-1),p)),h.expression.evaluate(new Wn(Math.floor(p.zoom),p)),h.expression.evaluate(new Wn(Math.floor(p.zoom+1),p)),p)}},zs.prototype._calculate=function(h,p,m,E){return E.zoom>E.zoomHistory.lastIntegerZoom?{from:h,to:p}:{from:m,to:p}},zs.prototype.interpolate=function(h){return h};var Zu=function(h){this.specification=h};Zu.prototype.possiblyEvaluate=function(h,p,m,E){return!!h.expression.evaluate(p,null,{},m,E)},Zu.prototype.interpolate=function(){return!1};var Wa=function(h){for(var p in this.properties=h,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],h){var m=h[p];m.specification.overridable&&this.overridableProperties.push(p);var E=this.defaultPropertyValues[p]=new ru(m,void 0),A=this.defaultTransitionablePropertyValues[p]=new nu(m);this.defaultTransitioningPropertyValues[p]=A.untransitioned(),this.defaultPossiblyEvaluatedValues[p]=E.possiblyEvaluate({})}};Xr("DataDrivenProperty",qr),Xr("DataConstantProperty",sn),Xr("CrossFadedDataDrivenProperty",Pl),Xr("CrossFadedProperty",zs),Xr("ColorRampProperty",Zu);var Tu=function(h){function p(m,E){if(h.call(this),this.id=m.id,this.type=m.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},m.type!=="custom"&&(this.metadata=(m=m).metadata,this.minzoom=m.minzoom,this.maxzoom=m.maxzoom,m.type!=="background"&&(this.source=m.source,this.sourceLayer=m["source-layer"],this.filter=m.filter),E.layout&&(this._unevaluatedLayout=new Su(E.layout)),E.paint)){for(var A in this._transitionablePaint=new fs(E.paint),m.paint)this.setPaintProperty(A,m.paint[A],{validate:!1});for(var L in m.layout)this.setLayoutProperty(L,m.layout[L],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new gp(E.paint)}}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},p.prototype.getLayoutProperty=function(m){return m==="visibility"?this.visibility:this._unevaluatedLayout.getValue(m)},p.prototype.setLayoutProperty=function(m,E,A){A===void 0&&(A={}),E!=null&&this._validate(Mv,"layers."+this.id+".layout."+m,m,E,A)||(m!=="visibility"?this._unevaluatedLayout.setValue(m,E):this.visibility=E)},p.prototype.getPaintProperty=function(m){return G(m,"-transition")?this._transitionablePaint.getTransition(m.slice(0,-11)):this._transitionablePaint.getValue(m)},p.prototype.setPaintProperty=function(m,E,A){if(A===void 0&&(A={}),E!=null&&this._validate(Yg,"layers."+this.id+".paint."+m,m,E,A))return!1;if(G(m,"-transition"))return this._transitionablePaint.setTransition(m.slice(0,-11),E||void 0),!1;var L=this._transitionablePaint._values[m],D=L.property.specification["property-type"]==="cross-faded-data-driven",N=L.value.isDataDriven(),V=L.value;this._transitionablePaint.setValue(m,E),this._handleSpecialPaintPropertyUpdate(m);var W=this._transitionablePaint._values[m].value;return W.isDataDriven()||N||D||this._handleOverridablePaintPropertyUpdate(m,V,W)},p.prototype._handleSpecialPaintPropertyUpdate=function(m){},p.prototype._handleOverridablePaintPropertyUpdate=function(m,E,A){return!1},p.prototype.isHidden=function(m){return!!(this.minzoom&&m<this.minzoom)||!!(this.maxzoom&&m>=this.maxzoom)||this.visibility==="none"},p.prototype.updateTransitions=function(m){this._transitioningPaint=this._transitionablePaint.transitioned(m,this._transitioningPaint)},p.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},p.prototype.recalculate=function(m,E){m.getCrossfadeParameters&&(this._crossfadeParameters=m.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(m,void 0,E)),this.paint=this._transitioningPaint.possiblyEvaluate(m,void 0,E)},p.prototype.serialize=function(){var m={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(m.layout=m.layout||{},m.layout.visibility=this.visibility),Z(m,function(E,A){return!(E===void 0||A==="layout"&&!Object.keys(E).length||A==="paint"&&!Object.keys(E).length)})},p.prototype._validate=function(m,E,A,L,D){return D===void 0&&(D={}),(!D||D.validate!==!1)&&xf(this,m.call(Av,{key:E,layerType:this.type,objectKey:A,value:L,styleSpec:ht,style:{glyphs:!0,sprite:!0}}))},p.prototype.is3D=function(){return!1},p.prototype.isTileClipped=function(){return!1},p.prototype.hasOffscreenPass=function(){return!1},p.prototype.resize=function(){},p.prototype.isStateDependent=function(){for(var m in this.paint._values){var E=this.paint.get(m);if(E instanceof ks&&Eh(E.property.specification)&&(E.value.kind==="source"||E.value.kind==="composite")&&E.value.isStateDependent)return!0}return!1},p}(Jt),Th={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},md=function(h,p){this._structArray=h,this._pos1=p*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ji=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Xo(h,p){p===void 0&&(p=1);var m=0,E=0;return{members:h.map(function(A){var L=Th[A.type].BYTES_PER_ELEMENT,D=m=Q0(m,Math.max(p,L)),N=A.components||1;return E=Math.max(E,L),m+=L*N,{name:A.name,type:A.type,components:N,offset:D}}),size:Q0(m,Math.max(E,p)),alignment:p}}function Q0(h,p){return Math.ceil(h/p)*p}ji.serialize=function(h,p){return h._trim(),p&&(h.isTransferred=!0,p.push(h.arrayBuffer)),{length:h.length,arrayBuffer:h.arrayBuffer}},ji.deserialize=function(h){var p=Object.create(this.prototype);return p.arrayBuffer=h.arrayBuffer,p.length=h.length,p.capacity=h.arrayBuffer.byteLength/p.bytesPerElement,p._refreshViews(),p},ji.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ji.prototype.clear=function(){this.length=0},ji.prototype.resize=function(h){this.reserve(h),this.length=h},ji.prototype.reserve=function(h){if(h>this.capacity){this.capacity=Math.max(h,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var p=this.uint8;this._refreshViews(),p&&this.uint8.set(p)}},ji.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Ef=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},p.prototype.emplaceBack=function(m,E){var A=this.length;return this.resize(A+1),this.emplace(A,m,E)},p.prototype.emplace=function(m,E,A){var L=2*m;return this.int16[L+0]=E,this.int16[L+1]=A,m},p}(ji);Ef.prototype.bytesPerElement=4,Xr("StructArrayLayout2i4",Ef);var tm=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},p.prototype.emplaceBack=function(m,E,A,L){var D=this.length;return this.resize(D+1),this.emplace(D,m,E,A,L)},p.prototype.emplace=function(m,E,A,L,D){var N=4*m;return this.int16[N+0]=E,this.int16[N+1]=A,this.int16[N+2]=L,this.int16[N+3]=D,m},p}(ji);tm.prototype.bytesPerElement=8,Xr("StructArrayLayout4i8",tm);var Ah=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},p.prototype.emplaceBack=function(m,E,A,L,D,N){var V=this.length;return this.resize(V+1),this.emplace(V,m,E,A,L,D,N)},p.prototype.emplace=function(m,E,A,L,D,N,V){var W=6*m;return this.int16[W+0]=E,this.int16[W+1]=A,this.int16[W+2]=L,this.int16[W+3]=D,this.int16[W+4]=N,this.int16[W+5]=V,m},p}(ji);Ah.prototype.bytesPerElement=12,Xr("StructArrayLayout2i4i12",Ah);var Dl=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},p.prototype.emplaceBack=function(m,E,A,L,D,N){var V=this.length;return this.resize(V+1),this.emplace(V,m,E,A,L,D,N)},p.prototype.emplace=function(m,E,A,L,D,N,V){var W=4*m,q=8*m;return this.int16[W+0]=E,this.int16[W+1]=A,this.uint8[q+4]=L,this.uint8[q+5]=D,this.uint8[q+6]=N,this.uint8[q+7]=V,m},p}(ji);Dl.prototype.bytesPerElement=8,Xr("StructArrayLayout2i4ub8",Dl);var mp=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},p.prototype.emplaceBack=function(m,E){var A=this.length;return this.resize(A+1),this.emplace(A,m,E)},p.prototype.emplace=function(m,E,A){var L=2*m;return this.float32[L+0]=E,this.float32[L+1]=A,m},p}(ji);mp.prototype.bytesPerElement=8,Xr("StructArrayLayout2f8",mp);var Cc=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},p.prototype.emplaceBack=function(m,E,A,L,D,N,V,W,q,Q){var it=this.length;return this.resize(it+1),this.emplace(it,m,E,A,L,D,N,V,W,q,Q)},p.prototype.emplace=function(m,E,A,L,D,N,V,W,q,Q,it){var ut=10*m;return this.uint16[ut+0]=E,this.uint16[ut+1]=A,this.uint16[ut+2]=L,this.uint16[ut+3]=D,this.uint16[ut+4]=N,this.uint16[ut+5]=V,this.uint16[ut+6]=W,this.uint16[ut+7]=q,this.uint16[ut+8]=Q,this.uint16[ut+9]=it,m},p}(ji);Cc.prototype.bytesPerElement=20,Xr("StructArrayLayout10ui20",Cc);var em=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},p.prototype.emplaceBack=function(m,E,A,L,D,N,V,W,q,Q,it,ut){var At=this.length;return this.resize(At+1),this.emplace(At,m,E,A,L,D,N,V,W,q,Q,it,ut)},p.prototype.emplace=function(m,E,A,L,D,N,V,W,q,Q,it,ut,At){var It=12*m;return this.int16[It+0]=E,this.int16[It+1]=A,this.int16[It+2]=L,this.int16[It+3]=D,this.uint16[It+4]=N,this.uint16[It+5]=V,this.uint16[It+6]=W,this.uint16[It+7]=q,this.int16[It+8]=Q,this.int16[It+9]=it,this.int16[It+10]=ut,this.int16[It+11]=At,m},p}(ji);em.prototype.bytesPerElement=24,Xr("StructArrayLayout4i4ui4i24",em);var yp=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},p.prototype.emplaceBack=function(m,E,A){var L=this.length;return this.resize(L+1),this.emplace(L,m,E,A)},p.prototype.emplace=function(m,E,A,L){var D=3*m;return this.float32[D+0]=E,this.float32[D+1]=A,this.float32[D+2]=L,m},p}(ji);yp.prototype.bytesPerElement=12,Xr("StructArrayLayout3f12",yp);var Lv=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},p.prototype.emplaceBack=function(m){var E=this.length;return this.resize(E+1),this.emplace(E,m)},p.prototype.emplace=function(m,E){return this.uint32[1*m+0]=E,m},p}(ji);Lv.prototype.bytesPerElement=4,Xr("StructArrayLayout1ul4",Lv);var rm=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},p.prototype.emplaceBack=function(m,E,A,L,D,N,V,W,q){var Q=this.length;return this.resize(Q+1),this.emplace(Q,m,E,A,L,D,N,V,W,q)},p.prototype.emplace=function(m,E,A,L,D,N,V,W,q,Q){var it=10*m,ut=5*m;return this.int16[it+0]=E,this.int16[it+1]=A,this.int16[it+2]=L,this.int16[it+3]=D,this.int16[it+4]=N,this.int16[it+5]=V,this.uint32[ut+3]=W,this.uint16[it+8]=q,this.uint16[it+9]=Q,m},p}(ji);rm.prototype.bytesPerElement=20,Xr("StructArrayLayout6i1ul2ui20",rm);var yd=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},p.prototype.emplaceBack=function(m,E,A,L,D,N){var V=this.length;return this.resize(V+1),this.emplace(V,m,E,A,L,D,N)},p.prototype.emplace=function(m,E,A,L,D,N,V){var W=6*m;return this.int16[W+0]=E,this.int16[W+1]=A,this.int16[W+2]=L,this.int16[W+3]=D,this.int16[W+4]=N,this.int16[W+5]=V,m},p}(ji);yd.prototype.bytesPerElement=12,Xr("StructArrayLayout2i2i2i12",yd);var _d=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},p.prototype.emplaceBack=function(m,E,A,L,D){var N=this.length;return this.resize(N+1),this.emplace(N,m,E,A,L,D)},p.prototype.emplace=function(m,E,A,L,D,N){var V=4*m,W=8*m;return this.float32[V+0]=E,this.float32[V+1]=A,this.float32[V+2]=L,this.int16[W+6]=D,this.int16[W+7]=N,m},p}(ji);_d.prototype.bytesPerElement=16,Xr("StructArrayLayout2f1f2i16",_d);var J0=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},p.prototype.emplaceBack=function(m,E,A,L){var D=this.length;return this.resize(D+1),this.emplace(D,m,E,A,L)},p.prototype.emplace=function(m,E,A,L,D){var N=12*m,V=3*m;return this.uint8[N+0]=E,this.uint8[N+1]=A,this.float32[V+1]=L,this.float32[V+2]=D,m},p}(ji);J0.prototype.bytesPerElement=12,Xr("StructArrayLayout2ub2f12",J0);var Sc=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},p.prototype.emplaceBack=function(m,E,A){var L=this.length;return this.resize(L+1),this.emplace(L,m,E,A)},p.prototype.emplace=function(m,E,A,L){var D=3*m;return this.uint16[D+0]=E,this.uint16[D+1]=A,this.uint16[D+2]=L,m},p}(ji);Sc.prototype.bytesPerElement=6,Xr("StructArrayLayout3ui6",Sc);var qu=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},p.prototype.emplaceBack=function(m,E,A,L,D,N,V,W,q,Q,it,ut,At,It,Wt,kt,ie){var ue=this.length;return this.resize(ue+1),this.emplace(ue,m,E,A,L,D,N,V,W,q,Q,it,ut,At,It,Wt,kt,ie)},p.prototype.emplace=function(m,E,A,L,D,N,V,W,q,Q,it,ut,At,It,Wt,kt,ie,ue){var be=24*m,Se=12*m,He=48*m;return this.int16[be+0]=E,this.int16[be+1]=A,this.uint16[be+2]=L,this.uint16[be+3]=D,this.uint32[Se+2]=N,this.uint32[Se+3]=V,this.uint32[Se+4]=W,this.uint16[be+10]=q,this.uint16[be+11]=Q,this.uint16[be+12]=it,this.float32[Se+7]=ut,this.float32[Se+8]=At,this.uint8[He+36]=It,this.uint8[He+37]=Wt,this.uint8[He+38]=kt,this.uint32[Se+10]=ie,this.int16[be+22]=ue,m},p}(ji);qu.prototype.bytesPerElement=48,Xr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",qu);var nm=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},p.prototype.emplaceBack=function(m,E,A,L,D,N,V,W,q,Q,it,ut,At,It,Wt,kt,ie,ue,be,Se,He,lr,_r,un,Br,vn,$r,ui){var On=this.length;return this.resize(On+1),this.emplace(On,m,E,A,L,D,N,V,W,q,Q,it,ut,At,It,Wt,kt,ie,ue,be,Se,He,lr,_r,un,Br,vn,$r,ui)},p.prototype.emplace=function(m,E,A,L,D,N,V,W,q,Q,it,ut,At,It,Wt,kt,ie,ue,be,Se,He,lr,_r,un,Br,vn,$r,ui,On){var Qr=34*m,mi=17*m;return this.int16[Qr+0]=E,this.int16[Qr+1]=A,this.int16[Qr+2]=L,this.int16[Qr+3]=D,this.int16[Qr+4]=N,this.int16[Qr+5]=V,this.int16[Qr+6]=W,this.int16[Qr+7]=q,this.uint16[Qr+8]=Q,this.uint16[Qr+9]=it,this.uint16[Qr+10]=ut,this.uint16[Qr+11]=At,this.uint16[Qr+12]=It,this.uint16[Qr+13]=Wt,this.uint16[Qr+14]=kt,this.uint16[Qr+15]=ie,this.uint16[Qr+16]=ue,this.uint16[Qr+17]=be,this.uint16[Qr+18]=Se,this.uint16[Qr+19]=He,this.uint16[Qr+20]=lr,this.uint16[Qr+21]=_r,this.uint16[Qr+22]=un,this.uint32[mi+12]=Br,this.float32[mi+13]=vn,this.float32[mi+14]=$r,this.float32[mi+15]=ui,this.float32[mi+16]=On,m},p}(ji);nm.prototype.bytesPerElement=68,Xr("StructArrayLayout8i15ui1ul4f68",nm);var wf=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},p.prototype.emplaceBack=function(m){var E=this.length;return this.resize(E+1),this.emplace(E,m)},p.prototype.emplace=function(m,E){return this.float32[1*m+0]=E,m},p}(ji);wf.prototype.bytesPerElement=4,Xr("StructArrayLayout1f4",wf);var Au=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},p.prototype.emplaceBack=function(m,E,A){var L=this.length;return this.resize(L+1),this.emplace(L,m,E,A)},p.prototype.emplace=function(m,E,A,L){var D=3*m;return this.int16[D+0]=E,this.int16[D+1]=A,this.int16[D+2]=L,m},p}(ji);Au.prototype.bytesPerElement=6,Xr("StructArrayLayout3i6",Au);var ty=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},p.prototype.emplaceBack=function(m,E,A){var L=this.length;return this.resize(L+1),this.emplace(L,m,E,A)},p.prototype.emplace=function(m,E,A,L){var D=4*m;return this.uint32[2*m+0]=E,this.uint16[D+2]=A,this.uint16[D+3]=L,m},p}(ji);ty.prototype.bytesPerElement=8,Xr("StructArrayLayout1ul2ui8",ty);var Ov=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},p.prototype.emplaceBack=function(m,E){var A=this.length;return this.resize(A+1),this.emplace(A,m,E)},p.prototype.emplace=function(m,E,A){var L=2*m;return this.uint16[L+0]=E,this.uint16[L+1]=A,m},p}(ji);Ov.prototype.bytesPerElement=4,Xr("StructArrayLayout2ui4",Ov);var im=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},p.prototype.emplaceBack=function(m){var E=this.length;return this.resize(E+1),this.emplace(E,m)},p.prototype.emplace=function(m,E){return this.uint16[1*m+0]=E,m},p}(ji);im.prototype.bytesPerElement=2,Xr("StructArrayLayout1ui2",im);var am=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},p.prototype.emplaceBack=function(m,E,A,L){var D=this.length;return this.resize(D+1),this.emplace(D,m,E,A,L)},p.prototype.emplace=function(m,E,A,L,D){var N=4*m;return this.float32[N+0]=E,this.float32[N+1]=A,this.float32[N+2]=L,this.float32[N+3]=D,m},p}(ji);am.prototype.bytesPerElement=16,Xr("StructArrayLayout4f16",am);var y=function(h){function p(){h.apply(this,arguments)}h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p;var m={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return m.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},m.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},m.x1.get=function(){return this._structArray.int16[this._pos2+2]},m.y1.get=function(){return this._structArray.int16[this._pos2+3]},m.x2.get=function(){return this._structArray.int16[this._pos2+4]},m.y2.get=function(){return this._structArray.int16[this._pos2+5]},m.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},m.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},m.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},m.anchorPoint.get=function(){return new c(this.anchorPointX,this.anchorPointY)},Object.defineProperties(p.prototype,m),p}(md);y.prototype.size=20;var b=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype.get=function(m){return new y(this,m)},p}(rm);Xr("CollisionBoxArray",b);var _=function(h){function p(){h.apply(this,arguments)}h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p;var m={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return m.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},m.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},m.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},m.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},m.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},m.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},m.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},m.segment.get=function(){return this._structArray.uint16[this._pos2+10]},m.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},m.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},m.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},m.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},m.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},m.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},m.placedOrientation.set=function(E){this._structArray.uint8[this._pos1+37]=E},m.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},m.hidden.set=function(E){this._structArray.uint8[this._pos1+38]=E},m.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},m.crossTileID.set=function(E){this._structArray.uint32[this._pos4+10]=E},m.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(p.prototype,m),p}(md);_.prototype.size=48;var C=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype.get=function(m){return new _(this,m)},p}(qu);Xr("PlacedSymbolArray",C);var O=function(h){function p(){h.apply(this,arguments)}h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p;var m={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return m.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},m.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},m.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},m.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},m.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},m.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},m.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},m.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},m.key.get=function(){return this._structArray.uint16[this._pos2+8]},m.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},m.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},m.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},m.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},m.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},m.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},m.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},m.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},m.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},m.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},m.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},m.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},m.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},m.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},m.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},m.crossTileID.set=function(E){this._structArray.uint32[this._pos4+12]=E},m.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},m.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},m.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},m.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(p.prototype,m),p}(md);O.prototype.size=68;var F=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype.get=function(m){return new O(this,m)},p}(nm);Xr("SymbolInstanceArray",F);var B=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype.getoffsetX=function(m){return this.float32[1*m+0]},p}(wf);Xr("GlyphOffsetArray",B);var H=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype.getx=function(m){return this.int16[3*m+0]},p.prototype.gety=function(m){return this.int16[3*m+1]},p.prototype.gettileUnitDistanceFromAnchor=function(m){return this.int16[3*m+2]},p}(Au);Xr("SymbolLineVertexArray",H);var Y=function(h){function p(){h.apply(this,arguments)}h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p;var m={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return m.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},m.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},m.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(p.prototype,m),p}(md);Y.prototype.size=8;var rt=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype.get=function(m){return new Y(this,m)},p}(ty);Xr("FeatureIndexArray",rt);var ct=Xo([{name:"a_pos",components:2,type:"Int16"}],4).members,dt=function(h){h===void 0&&(h=[]),this.segments=h};function pt(h,p){return 256*(h=w(Math.floor(h),0,255))+w(Math.floor(p),0,255)}dt.prototype.prepareSegment=function(h,p,m,E){var A=this.segments[this.segments.length-1];return h>dt.MAX_VERTEX_ARRAY_LENGTH&&at("Max vertices per segment is "+dt.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+h),(!A||A.vertexLength+h>dt.MAX_VERTEX_ARRAY_LENGTH||A.sortKey!==E)&&(A={vertexOffset:p.length,primitiveOffset:m.length,vertexLength:0,primitiveLength:0},E!==void 0&&(A.sortKey=E),this.segments.push(A)),A},dt.prototype.get=function(){return this.segments},dt.prototype.destroy=function(){for(var h=0,p=this.segments;h<p.length;h+=1){var m=p[h];for(var E in m.vaos)m.vaos[E].destroy()}},dt.simpleSegment=function(h,p,m,E){return new dt([{vertexOffset:h,primitiveOffset:p,vertexLength:m,primitiveLength:E,vaos:{},sortKey:0}])},dt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Xr("SegmentVector",dt);var Pt=Xo([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Mt=s(function(h){h.exports=function(p,m){var E,A,L,D,N,V,W,q;for(A=p.length-(E=3&p.length),L=m,N=3432918353,V=461845907,q=0;q<A;)W=255&p.charCodeAt(q)|(255&p.charCodeAt(++q))<<8|(255&p.charCodeAt(++q))<<16|(255&p.charCodeAt(++q))<<24,++q,L=27492+(65535&(D=5*(65535&(L=(L^=W=(65535&(W=(W=(65535&W)*N+(((W>>>16)*N&65535)<<16)&4294967295)<<15|W>>>17))*V+(((W>>>16)*V&65535)<<16)&4294967295)<<13|L>>>19))+((5*(L>>>16)&65535)<<16)&4294967295))+((58964+(D>>>16)&65535)<<16);switch(W=0,E){case 3:W^=(255&p.charCodeAt(q+2))<<16;case 2:W^=(255&p.charCodeAt(q+1))<<8;case 1:L^=W=(65535&(W=(W=(65535&(W^=255&p.charCodeAt(q)))*N+(((W>>>16)*N&65535)<<16)&4294967295)<<15|W>>>17))*V+(((W>>>16)*V&65535)<<16)&4294967295}return L^=p.length,L=2246822507*(65535&(L^=L>>>16))+((2246822507*(L>>>16)&65535)<<16)&4294967295,L=3266489909*(65535&(L^=L>>>13))+((3266489909*(L>>>16)&65535)<<16)&4294967295,(L^=L>>>16)>>>0}}),Ht=s(function(h){h.exports=function(p,m){for(var E,A=p.length,L=m^A,D=0;A>=4;)E=1540483477*(65535&(E=255&p.charCodeAt(D)|(255&p.charCodeAt(++D))<<8|(255&p.charCodeAt(++D))<<16|(255&p.charCodeAt(++D))<<24))+((1540483477*(E>>>16)&65535)<<16),L=1540483477*(65535&L)+((1540483477*(L>>>16)&65535)<<16)^(E=1540483477*(65535&(E^=E>>>24))+((1540483477*(E>>>16)&65535)<<16)),A-=4,++D;switch(A){case 3:L^=(255&p.charCodeAt(D+2))<<16;case 2:L^=(255&p.charCodeAt(D+1))<<8;case 1:L=1540483477*(65535&(L^=255&p.charCodeAt(D)))+((1540483477*(L>>>16)&65535)<<16)}return L=1540483477*(65535&(L^=L>>>13))+((1540483477*(L>>>16)&65535)<<16),(L^=L>>>15)>>>0}}),St=Mt,Ut=Ht;St.murmur3=Mt,St.murmur2=Ut;var Kt=function(){this.ids=[],this.positions=[],this.indexed=!1};Kt.prototype.add=function(h,p,m,E){this.ids.push(we(h)),this.positions.push(p,m,E)},Kt.prototype.getPositions=function(h){for(var p=we(h),m=0,E=this.ids.length-1;m<E;){var A=m+E>>1;this.ids[A]>=p?E=A:m=A+1}for(var L=[];this.ids[m]===p;)L.push({index:this.positions[3*m],start:this.positions[3*m+1],end:this.positions[3*m+2]}),m++;return L},Kt.serialize=function(h,p){var m=new Float64Array(h.ids),E=new Uint32Array(h.positions);return function A(L,D,N,V){for(;N<V;){for(var W=L[N+V>>1],q=N-1,Q=V+1;;){do q++;while(L[q]<W);do Q--;while(L[Q]>W);if(q>=Q)break;ve(L,q,Q),ve(D,3*q,3*Q),ve(D,3*q+1,3*Q+1),ve(D,3*q+2,3*Q+2)}Q-N<V-Q?(A(L,D,N,Q),N=Q+1):(A(L,D,Q+1,V),V=Q)}}(m,E,0,m.length-1),p&&p.push(m.buffer,E.buffer),{ids:m,positions:E}},Kt.deserialize=function(h){var p=new Kt;return p.ids=h.ids,p.positions=h.positions,p.indexed=!0,p};var le=Math.pow(2,53)-1;function we(h){var p=+h;return!isNaN(p)&&p<=le?p:St(String(h))}function ve(h,p,m){var E=h[p];h[p]=h[m],h[m]=E}Xr("FeaturePositionMap",Kt);var Me=function(h,p){this.gl=h.gl,this.location=p},Ge=function(h){function p(m,E){h.call(this,m,E),this.current=0}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype.set=function(m){this.current!==m&&(this.current=m,this.gl.uniform1i(this.location,m))},p}(Me),hr=function(h){function p(m,E){h.call(this,m,E),this.current=0}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype.set=function(m){this.current!==m&&(this.current=m,this.gl.uniform1f(this.location,m))},p}(Me),or=function(h){function p(m,E){h.call(this,m,E),this.current=[0,0]}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype.set=function(m){m[0]===this.current[0]&&m[1]===this.current[1]||(this.current=m,this.gl.uniform2f(this.location,m[0],m[1]))},p}(Me),Ir=function(h){function p(m,E){h.call(this,m,E),this.current=[0,0,0]}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype.set=function(m){m[0]===this.current[0]&&m[1]===this.current[1]&&m[2]===this.current[2]||(this.current=m,this.gl.uniform3f(this.location,m[0],m[1],m[2]))},p}(Me),ln=function(h){function p(m,E){h.call(this,m,E),this.current=[0,0,0,0]}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype.set=function(m){m[0]===this.current[0]&&m[1]===this.current[1]&&m[2]===this.current[2]&&m[3]===this.current[3]||(this.current=m,this.gl.uniform4f(this.location,m[0],m[1],m[2],m[3]))},p}(Me),fn=function(h){function p(m,E){h.call(this,m,E),this.current=si.transparent}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype.set=function(m){m.r===this.current.r&&m.g===this.current.g&&m.b===this.current.b&&m.a===this.current.a||(this.current=m,this.gl.uniform4f(this.location,m.r,m.g,m.b,m.a))},p}(Me),hn=new Float32Array(16),Li=function(h){function p(m,E){h.call(this,m,E),this.current=hn}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype.set=function(m){if(m[12]!==this.current[12]||m[0]!==this.current[0])return this.current=m,void this.gl.uniformMatrix4fv(this.location,!1,m);for(var E=1;E<16;E++)if(m[E]!==this.current[E]){this.current=m,this.gl.uniformMatrix4fv(this.location,!1,m);break}},p}(Me);function Ur(h){return[pt(255*h.r,255*h.g),pt(255*h.b,255*h.a)]}var Pn=function(h,p,m){this.value=h,this.uniformNames=p.map(function(E){return"u_"+E}),this.type=m};Pn.prototype.setUniform=function(h,p,m){h.set(m.constantOr(this.value))},Pn.prototype.getBinding=function(h,p,m){return this.type==="color"?new fn(h,p):new hr(h,p)};var jn=function(h,p){this.uniformNames=p.map(function(m){return"u_"+m}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};jn.prototype.setConstantPatternPositions=function(h,p){this.pixelRatioFrom=p.pixelRatio,this.pixelRatioTo=h.pixelRatio,this.patternFrom=p.tlbr,this.patternTo=h.tlbr},jn.prototype.setUniform=function(h,p,m,E){var A=E==="u_pattern_to"?this.patternTo:E==="u_pattern_from"?this.patternFrom:E==="u_pixel_ratio_to"?this.pixelRatioTo:E==="u_pixel_ratio_from"?this.pixelRatioFrom:null;A&&h.set(A)},jn.prototype.getBinding=function(h,p,m){return m.substr(0,9)==="u_pattern"?new ln(h,p):new hr(h,p)};var Ln=function(h,p,m,E){this.expression=h,this.type=m,this.maxValue=0,this.paintVertexAttributes=p.map(function(A){return{name:"a_"+A,type:"Float32",components:m==="color"?2:1,offset:0}}),this.paintVertexArray=new E};Ln.prototype.populatePaintArray=function(h,p,m,E,A){var L=this.paintVertexArray.length,D=this.expression.evaluate(new Wn(0),p,{},E,[],A);this.paintVertexArray.resize(h),this._setPaintValue(L,h,D)},Ln.prototype.updatePaintArray=function(h,p,m,E){var A=this.expression.evaluate({zoom:0},m,E);this._setPaintValue(h,p,A)},Ln.prototype._setPaintValue=function(h,p,m){if(this.type==="color")for(var E=Ur(m),A=h;A<p;A++)this.paintVertexArray.emplace(A,E[0],E[1]);else{for(var L=h;L<p;L++)this.paintVertexArray.emplace(L,m);this.maxValue=Math.max(this.maxValue,Math.abs(m))}},Ln.prototype.upload=function(h){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=h.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Ln.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Sn=function(h,p,m,E,A,L){this.expression=h,this.uniformNames=p.map(function(D){return"u_"+D+"_t"}),this.type=m,this.useIntegerZoom=E,this.zoom=A,this.maxValue=0,this.paintVertexAttributes=p.map(function(D){return{name:"a_"+D,type:"Float32",components:m==="color"?4:2,offset:0}}),this.paintVertexArray=new L};Sn.prototype.populatePaintArray=function(h,p,m,E,A){var L=this.expression.evaluate(new Wn(this.zoom),p,{},E,[],A),D=this.expression.evaluate(new Wn(this.zoom+1),p,{},E,[],A),N=this.paintVertexArray.length;this.paintVertexArray.resize(h),this._setPaintValue(N,h,L,D)},Sn.prototype.updatePaintArray=function(h,p,m,E){var A=this.expression.evaluate({zoom:this.zoom},m,E),L=this.expression.evaluate({zoom:this.zoom+1},m,E);this._setPaintValue(h,p,A,L)},Sn.prototype._setPaintValue=function(h,p,m,E){if(this.type==="color")for(var A=Ur(m),L=Ur(E),D=h;D<p;D++)this.paintVertexArray.emplace(D,A[0],A[1],L[0],L[1]);else{for(var N=h;N<p;N++)this.paintVertexArray.emplace(N,m,E);this.maxValue=Math.max(this.maxValue,Math.abs(m),Math.abs(E))}},Sn.prototype.upload=function(h){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=h.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Sn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Sn.prototype.setUniform=function(h,p){var m=this.useIntegerZoom?Math.floor(p.zoom):p.zoom,E=w(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);h.set(E)},Sn.prototype.getBinding=function(h,p,m){return new hr(h,p)};var Vn=function(h,p,m,E,A,L){this.expression=h,this.type=p,this.useIntegerZoom=m,this.zoom=E,this.layerId=L,this.zoomInPaintVertexArray=new A,this.zoomOutPaintVertexArray=new A};Vn.prototype.populatePaintArray=function(h,p,m){var E=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(h),this.zoomOutPaintVertexArray.resize(h),this._setPaintValues(E,h,p.patterns&&p.patterns[this.layerId],m)},Vn.prototype.updatePaintArray=function(h,p,m,E,A){this._setPaintValues(h,p,m.patterns&&m.patterns[this.layerId],A)},Vn.prototype._setPaintValues=function(h,p,m,E){if(E&&m){var A=E[m.min],L=E[m.mid],D=E[m.max];if(A&&L&&D)for(var N=h;N<p;N++)this.zoomInPaintVertexArray.emplace(N,L.tl[0],L.tl[1],L.br[0],L.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],L.pixelRatio,A.pixelRatio),this.zoomOutPaintVertexArray.emplace(N,L.tl[0],L.tl[1],L.br[0],L.br[1],D.tl[0],D.tl[1],D.br[0],D.br[1],L.pixelRatio,D.pixelRatio)}},Vn.prototype.upload=function(h){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=h.createVertexBuffer(this.zoomInPaintVertexArray,Pt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=h.createVertexBuffer(this.zoomOutPaintVertexArray,Pt.members,this.expression.isStateDependent))},Vn.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Tn=function(h,p,m){this.binders={},this._buffers=[];var E=[];for(var A in h.paint._values)if(m(A)){var L=h.paint.get(A);if(L instanceof ks&&Eh(L.property.specification)){var D=Ro(A,h.type),N=L.value,V=L.property.specification.type,W=L.property.useIntegerZoom,q=L.property.specification["property-type"],Q=q==="cross-faded"||q==="cross-faded-data-driven";if(N.kind==="constant")this.binders[A]=Q?new jn(N.value,D):new Pn(N.value,D,V),E.push("/u_"+A);else if(N.kind==="source"||Q){var it=Za(A,V,"source");this.binders[A]=Q?new Vn(N,V,W,p,it,h.id):new Ln(N,D,V,it),E.push("/a_"+A)}else{var ut=Za(A,V,"composite");this.binders[A]=new Sn(N,D,V,W,p,ut),E.push("/z_"+A)}}}this.cacheKey=E.sort().join("")};Tn.prototype.getMaxValue=function(h){var p=this.binders[h];return p instanceof Ln||p instanceof Sn?p.maxValue:0},Tn.prototype.populatePaintArrays=function(h,p,m,E,A){for(var L in this.binders){var D=this.binders[L];(D instanceof Ln||D instanceof Sn||D instanceof Vn)&&D.populatePaintArray(h,p,m,E,A)}},Tn.prototype.setConstantPatternPositions=function(h,p){for(var m in this.binders){var E=this.binders[m];E instanceof jn&&E.setConstantPatternPositions(h,p)}},Tn.prototype.updatePaintArrays=function(h,p,m,E,A){var L=!1;for(var D in h)for(var N=0,V=p.getPositions(D);N<V.length;N+=1){var W=V[N],q=m.feature(W.index);for(var Q in this.binders){var it=this.binders[Q];if((it instanceof Ln||it instanceof Sn||it instanceof Vn)&&it.expression.isStateDependent===!0){var ut=E.paint.get(Q);it.expression=ut.value,it.updatePaintArray(W.start,W.end,q,h[D],A),L=!0}}}return L},Tn.prototype.defines=function(){var h=[];for(var p in this.binders){var m=this.binders[p];(m instanceof Pn||m instanceof jn)&&h.push.apply(h,m.uniformNames.map(function(E){return"#define HAS_UNIFORM_"+E}))}return h},Tn.prototype.getBinderAttributes=function(){var h=[];for(var p in this.binders){var m=this.binders[p];if(m instanceof Ln||m instanceof Sn)for(var E=0;E<m.paintVertexAttributes.length;E++)h.push(m.paintVertexAttributes[E].name);else if(m instanceof Vn)for(var A=0;A<Pt.members.length;A++)h.push(Pt.members[A].name)}return h},Tn.prototype.getBinderUniforms=function(){var h=[];for(var p in this.binders){var m=this.binders[p];if(m instanceof Pn||m instanceof jn||m instanceof Sn)for(var E=0,A=m.uniformNames;E<A.length;E+=1)h.push(A[E])}return h},Tn.prototype.getPaintVertexBuffers=function(){return this._buffers},Tn.prototype.getUniforms=function(h,p){var m=[];for(var E in this.binders){var A=this.binders[E];if(A instanceof Pn||A instanceof jn||A instanceof Sn)for(var L=0,D=A.uniformNames;L<D.length;L+=1){var N=D[L];if(p[N]){var V=A.getBinding(h,p[N],N);m.push({name:N,property:E,binding:V})}}}return m},Tn.prototype.setUniforms=function(h,p,m,E){for(var A=0,L=p;A<L.length;A+=1){var D=L[A],N=D.name,V=D.property;this.binders[V].setUniform(D.binding,E,m.get(V),N)}},Tn.prototype.updatePaintBuffers=function(h){for(var p in this._buffers=[],this.binders){var m=this.binders[p];if(h&&m instanceof Vn){var E=h.fromScale===2?m.zoomInPaintVertexBuffer:m.zoomOutPaintVertexBuffer;E&&this._buffers.push(E)}else(m instanceof Ln||m instanceof Sn)&&m.paintVertexBuffer&&this._buffers.push(m.paintVertexBuffer)}},Tn.prototype.upload=function(h){for(var p in this.binders){var m=this.binders[p];(m instanceof Ln||m instanceof Sn||m instanceof Vn)&&m.upload(h)}this.updatePaintBuffers()},Tn.prototype.destroy=function(){for(var h in this.binders){var p=this.binders[h];(p instanceof Ln||p instanceof Sn||p instanceof Vn)&&p.destroy()}};var En=function(h,p,m){m===void 0&&(m=function(){return!0}),this.programConfigurations={};for(var E=0,A=h;E<A.length;E+=1){var L=A[E];this.programConfigurations[L.id]=new Tn(L,p,m)}this.needsUpload=!1,this._featureMap=new Kt,this._bufferOffset=0};function Ro(h,p){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[h]||[h.replace(p+"-","").replace(/-/g,"_")]}function Za(h,p,m){var E={color:{source:mp,composite:am},number:{source:wf,composite:mp}},A=function(L){return{"line-pattern":{source:Cc,composite:Cc},"fill-pattern":{source:Cc,composite:Cc},"fill-extrusion-pattern":{source:Cc,composite:Cc}}[L]}(h);return A&&A[m]||E[p][m]}En.prototype.populatePaintArrays=function(h,p,m,E,A,L){for(var D in this.programConfigurations)this.programConfigurations[D].populatePaintArrays(h,p,E,A,L);p.id!==void 0&&this._featureMap.add(p.id,m,this._bufferOffset,h),this._bufferOffset=h,this.needsUpload=!0},En.prototype.updatePaintArrays=function(h,p,m,E){for(var A=0,L=m;A<L.length;A+=1){var D=L[A];this.needsUpload=this.programConfigurations[D.id].updatePaintArrays(h,this._featureMap,p,D,E)||this.needsUpload}},En.prototype.get=function(h){return this.programConfigurations[h]},En.prototype.upload=function(h){if(this.needsUpload){for(var p in this.programConfigurations)this.programConfigurations[p].upload(h);this.needsUpload=!1}},En.prototype.destroy=function(){for(var h in this.programConfigurations)this.programConfigurations[h].destroy()},Xr("ConstantBinder",Pn),Xr("CrossFadedConstantBinder",jn),Xr("SourceExpressionBinder",Ln),Xr("CrossFadedCompositeBinder",Vn),Xr("CompositeExpressionBinder",Sn),Xr("ProgramConfiguration",Tn,{omit:["_buffers"]}),Xr("ProgramConfigurationSet",En);var ds=Math.pow(2,14)-1,jo=-ds-1;function Xa(h){for(var p=8192/h.extent,m=h.loadGeometry(),E=0;E<m.length;E++)for(var A=m[E],L=0;L<A.length;L++){var D=A[L],N=Math.round(D.x*p),V=Math.round(D.y*p);D.x=w(N,jo,ds),D.y=w(V,jo,ds),(N<D.x||N>D.x+1||V<D.y||V>D.y+1)&&at("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return m}function qa(h,p){return{type:h.type,id:h.id,properties:h.properties,geometry:p?Xa(h):[]}}function qs(h,p,m,E,A){h.emplaceBack(2*p+(E+1)/2,2*m+(A+1)/2)}var Us=function(h){this.zoom=h.zoom,this.overscaling=h.overscaling,this.layers=h.layers,this.layerIds=this.layers.map(function(p){return p.id}),this.index=h.index,this.hasPattern=!1,this.layoutVertexArray=new Ef,this.indexArray=new Sc,this.segments=new dt,this.programConfigurations=new En(h.layers,h.zoom),this.stateDependentLayerIds=this.layers.filter(function(p){return p.isStateDependent()}).map(function(p){return p.id})};function Tc(h,p){for(var m=0;m<h.length;m++)if(Ku(p,h[m]))return!0;for(var E=0;E<p.length;E++)if(Ku(h,p[E]))return!0;return!!_p(h,p)}function Ks(h,p,m){return!!Ku(h,p)||!!Ac(p,h,m)}function Mu(h,p){if(h.length===1)return Mh(p,h[0]);for(var m=0;m<p.length;m++)for(var E=p[m],A=0;A<E.length;A++)if(Ku(h,E[A]))return!0;for(var L=0;L<h.length;L++)if(Mh(p,h[L]))return!0;for(var D=0;D<p.length;D++)if(_p(h,p[D]))return!0;return!1}function Fl(h,p,m){if(h.length>1){if(_p(h,p))return!0;for(var E=0;E<p.length;E++)if(Ac(p[E],h,m))return!0}for(var A=0;A<h.length;A++)if(Ac(h[A],p,m))return!0;return!1}function _p(h,p){if(h.length===0||p.length===0)return!1;for(var m=0;m<h.length-1;m++)for(var E=h[m],A=h[m+1],L=0;L<p.length-1;L++)if(xd(E,A,p[L],p[L+1]))return!0;return!1}function xd(h,p,m,E){return wt(h,m,E)!==wt(p,m,E)&&wt(h,p,m)!==wt(h,p,E)}function Ac(h,p,m){var E=m*m;if(p.length===1)return h.distSqr(p[0])<E;for(var A=1;A<p.length;A++)if(Cf(h,p[A-1],p[A])<E)return!0;return!1}function Cf(h,p,m){var E=p.distSqr(m);if(E===0)return h.distSqr(p);var A=((h.x-p.x)*(m.x-p.x)+(h.y-p.y)*(m.y-p.y))/E;return h.distSqr(A<0?p:A>1?m:m.sub(p)._mult(A)._add(p))}function Mh(h,p){for(var m,E,A,L=!1,D=0;D<h.length;D++)for(var N=0,V=(m=h[D]).length-1;N<m.length;V=N++)(E=m[N]).y>p.y!=(A=m[V]).y>p.y&&p.x<(A.x-E.x)*(p.y-E.y)/(A.y-E.y)+E.x&&(L=!L);return L}function Ku(h,p){for(var m=!1,E=0,A=h.length-1;E<h.length;A=E++){var L=h[E],D=h[A];L.y>p.y!=D.y>p.y&&p.x<(D.x-L.x)*(p.y-L.y)/(D.y-L.y)+L.x&&(m=!m)}return m}function Sf(h,p,m){var E=m[0],A=m[2];if(h.x<E.x&&p.x<E.x||h.x>A.x&&p.x>A.x||h.y<E.y&&p.y<E.y||h.y>A.y&&p.y>A.y)return!1;var L=wt(h,p,m[0]);return L!==wt(h,p,m[1])||L!==wt(h,p,m[2])||L!==wt(h,p,m[3])}function Ts(h,p,m){var E=p.paint.get(h).value;return E.kind==="constant"?E.value:m.programConfigurations.get(p.id).getMaxValue(h)}function uo(h){return Math.sqrt(h[0]*h[0]+h[1]*h[1])}function ul(h,p,m,E,A){if(!p[0]&&!p[1])return h;var L=c.convert(p)._mult(A);m==="viewport"&&L._rotate(-E);for(var D=[],N=0;N<h.length;N++)D.push(h[N].sub(L));return D}Us.prototype.populate=function(h,p,m){var E=this.layers[0],A=[],L=null;E.type==="circle"&&(L=E.layout.get("circle-sort-key"));for(var D=0,N=h;D<N.length;D+=1){var V=N[D],W=V.feature,q=V.id,Q=V.index,it=V.sourceLayerIndex,ut=this.layers[0]._featureFilter.needGeometry,At=qa(W,ut);if(this.layers[0]._featureFilter.filter(new Wn(this.zoom),At,m)){var It=L?L.evaluate(At,{},m):void 0,Wt={id:q,properties:W.properties,type:W.type,sourceLayerIndex:it,index:Q,geometry:ut?At.geometry:Xa(W),patterns:{},sortKey:It};A.push(Wt)}}L&&A.sort(function(_r,un){return _r.sortKey-un.sortKey});for(var kt=0,ie=A;kt<ie.length;kt+=1){var ue=ie[kt],be=ue.geometry,Se=ue.index,He=ue.sourceLayerIndex,lr=h[Se].feature;this.addFeature(ue,be,Se,m),p.featureIndex.insert(lr,be,Se,He,this.index)}},Us.prototype.update=function(h,p,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(h,p,this.stateDependentLayers,m)},Us.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Us.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Us.prototype.upload=function(h){this.uploaded||(this.layoutVertexBuffer=h.createVertexBuffer(this.layoutVertexArray,ct),this.indexBuffer=h.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(h),this.uploaded=!0},Us.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Us.prototype.addFeature=function(h,p,m,E){for(var A=0,L=p;A<L.length;A+=1)for(var D=0,N=L[A];D<N.length;D+=1){var V=N[D],W=V.x,q=V.y;if(!(W<0||W>=8192||q<0||q>=8192)){var Q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,h.sortKey),it=Q.vertexLength;qs(this.layoutVertexArray,W,q,-1,-1),qs(this.layoutVertexArray,W,q,1,-1),qs(this.layoutVertexArray,W,q,1,1),qs(this.layoutVertexArray,W,q,-1,1),this.indexArray.emplaceBack(it,it+1,it+2),this.indexArray.emplaceBack(it,it+3,it+2),Q.vertexLength+=4,Q.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,h,m,{},E)},Xr("CircleBucket",Us,{omit:["layers"]});var Ru=new Wa({"circle-sort-key":new qr(ht.layout_circle["circle-sort-key"])}),Qu={paint:new Wa({"circle-radius":new qr(ht.paint_circle["circle-radius"]),"circle-color":new qr(ht.paint_circle["circle-color"]),"circle-blur":new qr(ht.paint_circle["circle-blur"]),"circle-opacity":new qr(ht.paint_circle["circle-opacity"]),"circle-translate":new sn(ht.paint_circle["circle-translate"]),"circle-translate-anchor":new sn(ht.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new sn(ht.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new sn(ht.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new qr(ht.paint_circle["circle-stroke-width"]),"circle-stroke-color":new qr(ht.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new qr(ht.paint_circle["circle-stroke-opacity"])}),layout:Ru},xi=typeof Float32Array<"u"?Float32Array:Array;function ps(h){return h[0]=1,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=1,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=1,h[11]=0,h[12]=0,h[13]=0,h[14]=0,h[15]=1,h}function Io(h,p,m){var E=p[0],A=p[1],L=p[2],D=p[3],N=p[4],V=p[5],W=p[6],q=p[7],Q=p[8],it=p[9],ut=p[10],At=p[11],It=p[12],Wt=p[13],kt=p[14],ie=p[15],ue=m[0],be=m[1],Se=m[2],He=m[3];return h[0]=ue*E+be*N+Se*Q+He*It,h[1]=ue*A+be*V+Se*it+He*Wt,h[2]=ue*L+be*W+Se*ut+He*kt,h[3]=ue*D+be*q+Se*At+He*ie,h[4]=(ue=m[4])*E+(be=m[5])*N+(Se=m[6])*Q+(He=m[7])*It,h[5]=ue*A+be*V+Se*it+He*Wt,h[6]=ue*L+be*W+Se*ut+He*kt,h[7]=ue*D+be*q+Se*At+He*ie,h[8]=(ue=m[8])*E+(be=m[9])*N+(Se=m[10])*Q+(He=m[11])*It,h[9]=ue*A+be*V+Se*it+He*Wt,h[10]=ue*L+be*W+Se*ut+He*kt,h[11]=ue*D+be*q+Se*At+He*ie,h[12]=(ue=m[12])*E+(be=m[13])*N+(Se=m[14])*Q+(He=m[15])*It,h[13]=ue*A+be*V+Se*it+He*Wt,h[14]=ue*L+be*W+Se*ut+He*kt,h[15]=ue*D+be*q+Se*At+He*ie,h}Math.hypot||(Math.hypot=function(){for(var h=arguments,p=0,m=arguments.length;m--;)p+=h[m]*h[m];return Math.sqrt(p)});var Mc,om=Io;function Tf(h,p,m){var E=p[0],A=p[1],L=p[2],D=p[3];return h[0]=m[0]*E+m[4]*A+m[8]*L+m[12]*D,h[1]=m[1]*E+m[5]*A+m[9]*L+m[13]*D,h[2]=m[2]*E+m[6]*A+m[10]*L+m[14]*D,h[3]=m[3]*E+m[7]*A+m[11]*L+m[15]*D,h}Mc=new xi(3),xi!=Float32Array&&(Mc[0]=0,Mc[1]=0,Mc[2]=0),function(){var h=new xi(4);xi!=Float32Array&&(h[0]=0,h[1]=0,h[2]=0,h[3]=0)}();var ey=(function(){var h=new xi(2);xi!=Float32Array&&(h[0]=0,h[1]=0)}(),function(h){function p(m){h.call(this,m,Qu)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype.createBucket=function(m){return new Us(m)},p.prototype.queryRadius=function(m){var E=m;return Ts("circle-radius",this,E)+Ts("circle-stroke-width",this,E)+uo(this.paint.get("circle-translate"))},p.prototype.queryIntersectsFeature=function(m,E,A,L,D,N,V,W){for(var q=ul(m,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),N.angle,V),Q=this.paint.get("circle-radius").evaluate(E,A)+this.paint.get("circle-stroke-width").evaluate(E,A),it=this.paint.get("circle-pitch-alignment")==="map",ut=it?q:function(lr,_r){return lr.map(function(un){return bd(un,_r)})}(q,W),At=it?Q*V:Q,It=0,Wt=L;It<Wt.length;It+=1)for(var kt=0,ie=Wt[It];kt<ie.length;kt+=1){var ue=ie[kt],be=it?ue:bd(ue,W),Se=At,He=Tf([],[ue.x,ue.y,0,1],W);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Se*=He[3]/N.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Se*=N.cameraToCenterDistance/He[3]),Ks(ut,be,Se))return!0}return!1},p}(Tu));function bd(h,p){var m=Tf([],[h.x,h.y,0,1],p);return new c(m[0]/m[3],m[1]/m[3])}var Ed=function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p}(Us);function Ju(h,p,m,E){var A=p.width,L=p.height;if(E){if(E instanceof Uint8ClampedArray)E=new Uint8Array(E.buffer);else if(E.length!==A*L*m)throw new RangeError("mismatched image size")}else E=new Uint8Array(A*L*m);return h.width=A,h.height=L,h.data=E,h}function sm(h,p,m){var E=p.width,A=p.height;if(E!==h.width||A!==h.height){var L=Ju({},{width:E,height:A},m);fE(h,L,{x:0,y:0},{x:0,y:0},{width:Math.min(h.width,E),height:Math.min(h.height,A)},m),h.width=E,h.height=A,h.data=L.data}}function fE(h,p,m,E,A,L){if(A.width===0||A.height===0)return p;if(A.width>h.width||A.height>h.height||m.x>h.width-A.width||m.y>h.height-A.height)throw new RangeError("out of range source coordinates for image copy");if(A.width>p.width||A.height>p.height||E.x>p.width-A.width||E.y>p.height-A.height)throw new RangeError("out of range destination coordinates for image copy");for(var D=h.data,N=p.data,V=0;V<A.height;V++)for(var W=((m.y+V)*h.width+m.x)*L,q=((E.y+V)*p.width+E.x)*L,Q=0;Q<A.width*L;Q++)N[q+Q]=D[W+Q];return p}Xr("HeatmapBucket",Ed,{omit:["layers"]});var xp=function(h,p){Ju(this,h,1,p)};xp.prototype.resize=function(h){sm(this,h,1)},xp.prototype.clone=function(){return new xp({width:this.width,height:this.height},new Uint8Array(this.data))},xp.copy=function(h,p,m,E,A){fE(h,p,m,E,A,1)};var cl=function(h,p){Ju(this,h,4,p)};cl.prototype.resize=function(h){sm(this,h,4)},cl.prototype.replace=function(h,p){p?this.data.set(h):this.data=h instanceof Uint8ClampedArray?new Uint8Array(h.buffer):h},cl.prototype.clone=function(){return new cl({width:this.width,height:this.height},new Uint8Array(this.data))},cl.copy=function(h,p,m,E,A){fE(h,p,m,E,A,4)},Xr("AlphaImage",xp),Xr("RGBAImage",cl);var U2={paint:new Wa({"heatmap-radius":new qr(ht.paint_heatmap["heatmap-radius"]),"heatmap-weight":new qr(ht.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new sn(ht.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Zu(ht.paint_heatmap["heatmap-color"]),"heatmap-opacity":new sn(ht.paint_heatmap["heatmap-opacity"])})};function $2(h){var p={},m=h.resolution||256,E=h.clips?h.clips.length:1,A=h.image||new cl({width:m,height:E}),L=function(At,It,Wt){p[h.evaluationKey]=Wt;var kt=h.expression.evaluate(p);A.data[At+It+0]=Math.floor(255*kt.r/kt.a),A.data[At+It+1]=Math.floor(255*kt.g/kt.a),A.data[At+It+2]=Math.floor(255*kt.b/kt.a),A.data[At+It+3]=Math.floor(255*kt.a)};if(h.clips)for(var D=0,N=0;D<E;++D,N+=4*m)for(var V=0,W=0;V<m;V++,W+=4){var q=V/(m-1),Q=h.clips[D];L(N,W,Q.start*(1-q)+Q.end*q)}else for(var it=0,ut=0;it<m;it++,ut+=4)L(0,ut,it/(m-1));return A}var lm=function(h){function p(m){h.call(this,m,U2),this._updateColorRamp()}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype.createBucket=function(m){return new Ed(m)},p.prototype._handleSpecialPaintPropertyUpdate=function(m){m==="heatmap-color"&&this._updateColorRamp()},p.prototype._updateColorRamp=function(){this.colorRamp=$2({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},p.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},p.prototype.queryRadius=function(){return 0},p.prototype.queryIntersectsFeature=function(){return!1},p.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},p}(Tu),LL={paint:new Wa({"hillshade-illumination-direction":new sn(ht.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new sn(ht.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new sn(ht.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new sn(ht.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new sn(ht.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new sn(ht.paint_hillshade["hillshade-accent-color"])})},OL=function(h){function p(m){h.call(this,m,LL)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},p}(Tu),PL=Xo([{name:"a_pos",components:2,type:"Int16"}],4).members,s1=l1,DL=l1;function l1(h,p,m){m=m||2;var E,A,L,D,N,V,W,q=p&&p.length,Q=q?p[0]*m:h.length,it=H2(h,0,Q,m,!0),ut=[];if(!it||it.next===it.prev)return ut;if(q&&(it=function(It,Wt,kt,ie){var ue,be,Se,He=[];for(ue=0,be=Wt.length;ue<be;ue++)(Se=H2(It,Wt[ue]*ie,ue<be-1?Wt[ue+1]*ie:It.length,ie,!1))===Se.next&&(Se.steiner=!0),He.push(c1(Se));for(He.sort(zL),ue=0;ue<He.length;ue++)dE(He[ue],kt),kt=bp(kt,kt.next);return kt}(h,p,it,m)),h.length>80*m){E=L=h[0],A=D=h[1];for(var At=m;At<Q;At+=m)(N=h[At])<E&&(E=N),(V=h[At+1])<A&&(A=V),N>L&&(L=N),V>D&&(D=V);W=(W=Math.max(L-E,D-A))!==0?1/W:0}return ry(it,ut,m,E,A,W),ut}function H2(h,p,m,E,A){var L,D;if(A===Nv(h,p,m,E)>0)for(L=p;L<m;L+=E)D=hm(L,h[L],h[L+1],D);else for(L=m-E;L>=p;L-=E)D=hm(L,h[L],h[L+1],D);return D&&Pv(D,D.next)&&(wd(D),D=D.next),D}function bp(h,p){if(!h)return h;p||(p=h);var m,E=h;do if(m=!1,E.steiner||!Pv(E,E.next)&&co(E.prev,E,E.next)!==0)E=E.next;else{if(wd(E),(E=p=E.prev)===E.next)break;m=!0}while(m||E!==p);return p}function ry(h,p,m,E,A,L,D){if(h){!D&&L&&function(q,Q,it,ut){var At=q;do At.z===null&&(At.z=um(At.x,At.y,Q,it,ut)),At.prevZ=At.prev,At.nextZ=At.next,At=At.next;while(At!==q);At.prevZ.nextZ=null,At.prevZ=null,function(It){var Wt,kt,ie,ue,be,Se,He,lr,_r=1;do{for(kt=It,It=null,be=null,Se=0;kt;){for(Se++,ie=kt,He=0,Wt=0;Wt<_r&&(He++,ie=ie.nextZ);Wt++);for(lr=_r;He>0||lr>0&&ie;)He!==0&&(lr===0||!ie||kt.z<=ie.z)?(ue=kt,kt=kt.nextZ,He--):(ue=ie,ie=ie.nextZ,lr--),be?be.nextZ=ue:It=ue,ue.prevZ=be,be=ue;kt=ie}be.nextZ=null,_r*=2}while(Se>1)}(At)}(h,E,A,L);for(var N,V,W=h;h.prev!==h.next;)if(N=h.prev,V=h.next,L?BL(h,E,A,L):FL(h))p.push(N.i/m),p.push(h.i/m),p.push(V.i/m),wd(h),h=V.next,W=V.next;else if((h=V)===W){D?D===1?ry(h=NL(bp(h),p,m),p,m,E,A,L,2):D===2&&kL(h,p,m,E,A,L):ry(bp(h),p,m,E,A,L,1);break}}}function FL(h){var p=h.prev,m=h,E=h.next;if(co(p,m,E)>=0)return!1;for(var A=h.next.next;A!==h.prev;){if(Ep(p.x,p.y,m.x,m.y,E.x,E.y,A.x,A.y)&&co(A.prev,A,A.next)>=0)return!1;A=A.next}return!0}function BL(h,p,m,E){var A=h.prev,L=h,D=h.next;if(co(A,L,D)>=0)return!1;for(var N=A.x>L.x?A.x>D.x?A.x:D.x:L.x>D.x?L.x:D.x,V=A.y>L.y?A.y>D.y?A.y:D.y:L.y>D.y?L.y:D.y,W=um(A.x<L.x?A.x<D.x?A.x:D.x:L.x<D.x?L.x:D.x,A.y<L.y?A.y<D.y?A.y:D.y:L.y<D.y?L.y:D.y,p,m,E),q=um(N,V,p,m,E),Q=h.prevZ,it=h.nextZ;Q&&Q.z>=W&&it&&it.z<=q;){if(Q!==h.prev&&Q!==h.next&&Ep(A.x,A.y,L.x,L.y,D.x,D.y,Q.x,Q.y)&&co(Q.prev,Q,Q.next)>=0||(Q=Q.prevZ,it!==h.prev&&it!==h.next&&Ep(A.x,A.y,L.x,L.y,D.x,D.y,it.x,it.y)&&co(it.prev,it,it.next)>=0))return!1;it=it.nextZ}for(;Q&&Q.z>=W;){if(Q!==h.prev&&Q!==h.next&&Ep(A.x,A.y,L.x,L.y,D.x,D.y,Q.x,Q.y)&&co(Q.prev,Q,Q.next)>=0)return!1;Q=Q.prevZ}for(;it&&it.z<=q;){if(it!==h.prev&&it!==h.next&&Ep(A.x,A.y,L.x,L.y,D.x,D.y,it.x,it.y)&&co(it.prev,it,it.next)>=0)return!1;it=it.nextZ}return!0}function NL(h,p,m){var E=h;do{var A=E.prev,L=E.next.next;!Pv(A,L)&&f1(A,E,E.next,L)&&wp(A,L)&&wp(L,A)&&(p.push(A.i/m),p.push(E.i/m),p.push(L.i/m),wd(E),wd(E.next),E=h=L),E=E.next}while(E!==h);return bp(E)}function kL(h,p,m,E,A,L){var D=h;do{for(var N=D.next.next;N!==D.prev;){if(D.i!==N.i&&h1(D,N)){var V=cm(D,N);return D=bp(D,D.next),V=bp(V,V.next),ry(D,p,m,E,A,L),void ry(V,p,m,E,A,L)}N=N.next}D=D.next}while(D!==h)}function zL(h,p){return h.x-p.x}function dE(h,p){if(p=function(E,A){var L,D=A,N=E.x,V=E.y,W=-1/0;do{if(V<=D.y&&V>=D.next.y&&D.next.y!==D.y){var q=D.x+(V-D.y)*(D.next.x-D.x)/(D.next.y-D.y);if(q<=N&&q>W){if(W=q,q===N){if(V===D.y)return D;if(V===D.next.y)return D.next}L=D.x<D.next.x?D:D.next}}D=D.next}while(D!==A);if(!L)return null;if(N===W)return L;var Q,it=L,ut=L.x,At=L.y,It=1/0;D=L;do N>=D.x&&D.x>=ut&&N!==D.x&&Ep(V<At?N:W,V,ut,At,V<At?W:N,V,D.x,D.y)&&(Q=Math.abs(V-D.y)/(N-D.x),wp(D,E)&&(Q<It||Q===It&&(D.x>L.x||D.x===L.x&&u1(L,D)))&&(L=D,It=Q)),D=D.next;while(D!==it);return L}(h,p)){var m=cm(p,h);bp(p,p.next),bp(m,m.next)}}function u1(h,p){return co(h.prev,h,p.prev)<0&&co(p.next,h,h.next)<0}function um(h,p,m,E,A){return(h=1431655765&((h=858993459&((h=252645135&((h=16711935&((h=32767*(h-m)*A)|h<<8))|h<<4))|h<<2))|h<<1))|(p=1431655765&((p=858993459&((p=252645135&((p=16711935&((p=32767*(p-E)*A)|p<<8))|p<<4))|p<<2))|p<<1))<<1}function c1(h){var p=h,m=h;do(p.x<m.x||p.x===m.x&&p.y<m.y)&&(m=p),p=p.next;while(p!==h);return m}function Ep(h,p,m,E,A,L,D,N){return(A-D)*(p-N)-(h-D)*(L-N)>=0&&(h-D)*(E-N)-(m-D)*(p-N)>=0&&(m-D)*(L-N)-(A-D)*(E-N)>=0}function h1(h,p){return h.next.i!==p.i&&h.prev.i!==p.i&&!function(m,E){var A=m;do{if(A.i!==m.i&&A.next.i!==m.i&&A.i!==E.i&&A.next.i!==E.i&&f1(A,A.next,m,E))return!0;A=A.next}while(A!==m);return!1}(h,p)&&(wp(h,p)&&wp(p,h)&&function(m,E){var A=m,L=!1,D=(m.x+E.x)/2,N=(m.y+E.y)/2;do A.y>N!=A.next.y>N&&A.next.y!==A.y&&D<(A.next.x-A.x)*(N-A.y)/(A.next.y-A.y)+A.x&&(L=!L),A=A.next;while(A!==m);return L}(h,p)&&(co(h.prev,h,p.prev)||co(h,p.prev,p))||Pv(h,p)&&co(h.prev,h,h.next)>0&&co(p.prev,p,p.next)>0)}function co(h,p,m){return(p.y-h.y)*(m.x-p.x)-(p.x-h.x)*(m.y-p.y)}function Pv(h,p){return h.x===p.x&&h.y===p.y}function f1(h,p,m,E){var A=Fv(co(h,p,m)),L=Fv(co(h,p,E)),D=Fv(co(m,E,h)),N=Fv(co(m,E,p));return A!==L&&D!==N||!(A!==0||!Dv(h,m,p))||!(L!==0||!Dv(h,E,p))||!(D!==0||!Dv(m,h,E))||!(N!==0||!Dv(m,p,E))}function Dv(h,p,m){return p.x<=Math.max(h.x,m.x)&&p.x>=Math.min(h.x,m.x)&&p.y<=Math.max(h.y,m.y)&&p.y>=Math.min(h.y,m.y)}function Fv(h){return h>0?1:h<0?-1:0}function wp(h,p){return co(h.prev,h,h.next)<0?co(h,p,h.next)>=0&&co(h,h.prev,p)>=0:co(h,p,h.prev)<0||co(h,h.next,p)<0}function cm(h,p){var m=new Bv(h.i,h.x,h.y),E=new Bv(p.i,p.x,p.y),A=h.next,L=p.prev;return h.next=p,p.prev=h,m.next=A,A.prev=m,E.next=m,m.prev=E,L.next=E,E.prev=L,E}function hm(h,p,m,E){var A=new Bv(h,p,m);return E?(A.next=E.next,A.prev=E,E.next.prev=A,E.next=A):(A.prev=A,A.next=A),A}function wd(h){h.next.prev=h.prev,h.prev.next=h.next,h.prevZ&&(h.prevZ.nextZ=h.nextZ),h.nextZ&&(h.nextZ.prevZ=h.prevZ)}function Bv(h,p,m){this.i=h,this.x=p,this.y=m,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Nv(h,p,m,E){for(var A=0,L=p,D=m-E;L<m;L+=E)A+=(h[D]-h[L])*(h[L+1]+h[D+1]),D=L;return A}function V2(h,p,m,E,A){(function L(D,N,V,W,q){for(;W>V;){if(W-V>600){var Q=W-V+1,it=N-V+1,ut=Math.log(Q),At=.5*Math.exp(2*ut/3),It=.5*Math.sqrt(ut*At*(Q-At)/Q)*(it-Q/2<0?-1:1);L(D,N,Math.max(V,Math.floor(N-it*At/Q+It)),Math.min(W,Math.floor(N+(Q-it)*At/Q+It)),q)}var Wt=D[N],kt=V,ie=W;for(Cd(D,V,N),q(D[W],Wt)>0&&Cd(D,V,W);kt<ie;){for(Cd(D,kt,ie),kt++,ie--;q(D[kt],Wt)<0;)kt++;for(;q(D[ie],Wt)>0;)ie--}q(D[V],Wt)===0?Cd(D,V,ie):Cd(D,++ie,W),ie<=N&&(V=ie+1),N<=ie&&(W=ie-1)}})(h,p,m||0,E||h.length-1,A||kv)}function Cd(h,p,m){var E=h[p];h[p]=h[m],h[m]=E}function kv(h,p){return h<p?-1:h>p?1:0}function d1(h,p){var m=h.length;if(m<=1)return[h];for(var E,A,L=[],D=0;D<m;D++){var N=Tt(h[D]);N!==0&&(h[D].area=Math.abs(N),A===void 0&&(A=N<0),A===N<0?(E&&L.push(E),E=[h[D]]):E.push(h[D]))}if(E&&L.push(E),p>1)for(var V=0;V<L.length;V++)L[V].length<=p||(V2(L[V],p,1,L[V].length-1,pE),L[V]=L[V].slice(0,p));return L}function pE(h,p){return p.area-h.area}function vE(h,p,m){for(var E=m.patternDependencies,A=!1,L=0,D=p;L<D.length;L+=1){var N=D[L].paint.get(h+"-pattern");N.isConstant()||(A=!0);var V=N.constantOr(null);V&&(A=!0,E[V.to]=!0,E[V.from]=!0)}return A}function gE(h,p,m,E,A){for(var L=A.patternDependencies,D=0,N=p;D<N.length;D+=1){var V=N[D],W=V.paint.get(h+"-pattern").value;if(W.kind!=="constant"){var q=W.evaluate({zoom:E-1},m,{},A.availableImages),Q=W.evaluate({zoom:E},m,{},A.availableImages),it=W.evaluate({zoom:E+1},m,{},A.availableImages);Q=Q&&Q.name?Q.name:Q,it=it&&it.name?it.name:it,L[q=q&&q.name?q.name:q]=!0,L[Q]=!0,L[it]=!0,m.patterns[V.id]={min:q,mid:Q,max:it}}}return m}l1.deviation=function(h,p,m,E){var A=p&&p.length,L=Math.abs(Nv(h,0,A?p[0]*m:h.length,m));if(A)for(var D=0,N=p.length;D<N;D++)L-=Math.abs(Nv(h,p[D]*m,D<N-1?p[D+1]*m:h.length,m));var V=0;for(D=0;D<E.length;D+=3){var W=E[D]*m,q=E[D+1]*m,Q=E[D+2]*m;V+=Math.abs((h[W]-h[Q])*(h[q+1]-h[W+1])-(h[W]-h[q])*(h[Q+1]-h[W+1]))}return L===0&&V===0?0:Math.abs((V-L)/L)},l1.flatten=function(h){for(var p=h[0][0].length,m={vertices:[],holes:[],dimensions:p},E=0,A=0;A<h.length;A++){for(var L=0;L<h[A].length;L++)for(var D=0;D<p;D++)m.vertices.push(h[A][L][D]);A>0&&m.holes.push(E+=h[A-1].length)}return m},s1.default=DL;var Rh=function(h){this.zoom=h.zoom,this.overscaling=h.overscaling,this.layers=h.layers,this.layerIds=this.layers.map(function(p){return p.id}),this.index=h.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ef,this.indexArray=new Sc,this.indexArray2=new Ov,this.programConfigurations=new En(h.layers,h.zoom),this.segments=new dt,this.segments2=new dt,this.stateDependentLayerIds=this.layers.filter(function(p){return p.isStateDependent()}).map(function(p){return p.id})};Rh.prototype.populate=function(h,p,m){this.hasPattern=vE("fill",this.layers,p);for(var E=this.layers[0].layout.get("fill-sort-key"),A=[],L=0,D=h;L<D.length;L+=1){var N=D[L],V=N.feature,W=N.id,q=N.index,Q=N.sourceLayerIndex,it=this.layers[0]._featureFilter.needGeometry,ut=qa(V,it);if(this.layers[0]._featureFilter.filter(new Wn(this.zoom),ut,m)){var At=E?E.evaluate(ut,{},m,p.availableImages):void 0,It={id:W,properties:V.properties,type:V.type,sourceLayerIndex:Q,index:q,geometry:it?ut.geometry:Xa(V),patterns:{},sortKey:At};A.push(It)}}E&&A.sort(function(lr,_r){return lr.sortKey-_r.sortKey});for(var Wt=0,kt=A;Wt<kt.length;Wt+=1){var ie=kt[Wt],ue=ie.geometry,be=ie.index,Se=ie.sourceLayerIndex;if(this.hasPattern){var He=gE("fill",this.layers,ie,this.zoom,p);this.patternFeatures.push(He)}else this.addFeature(ie,ue,be,m,{});p.featureIndex.insert(h[be].feature,ue,be,Se,this.index)}},Rh.prototype.update=function(h,p,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(h,p,this.stateDependentLayers,m)},Rh.prototype.addFeatures=function(h,p,m){for(var E=0,A=this.patternFeatures;E<A.length;E+=1){var L=A[E];this.addFeature(L,L.geometry,L.index,p,m)}},Rh.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Rh.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Rh.prototype.upload=function(h){this.uploaded||(this.layoutVertexBuffer=h.createVertexBuffer(this.layoutVertexArray,PL),this.indexBuffer=h.createIndexBuffer(this.indexArray),this.indexBuffer2=h.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(h),this.uploaded=!0},Rh.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Rh.prototype.addFeature=function(h,p,m,E,A){for(var L=0,D=d1(p,500);L<D.length;L+=1){for(var N=D[L],V=0,W=0,q=N;W<q.length;W+=1)V+=q[W].length;for(var Q=this.segments.prepareSegment(V,this.layoutVertexArray,this.indexArray),it=Q.vertexLength,ut=[],At=[],It=0,Wt=N;It<Wt.length;It+=1){var kt=Wt[It];if(kt.length!==0){kt!==N[0]&&At.push(ut.length/2);var ie=this.segments2.prepareSegment(kt.length,this.layoutVertexArray,this.indexArray2),ue=ie.vertexLength;this.layoutVertexArray.emplaceBack(kt[0].x,kt[0].y),this.indexArray2.emplaceBack(ue+kt.length-1,ue),ut.push(kt[0].x),ut.push(kt[0].y);for(var be=1;be<kt.length;be++)this.layoutVertexArray.emplaceBack(kt[be].x,kt[be].y),this.indexArray2.emplaceBack(ue+be-1,ue+be),ut.push(kt[be].x),ut.push(kt[be].y);ie.vertexLength+=kt.length,ie.primitiveLength+=kt.length}}for(var Se=s1(ut,At),He=0;He<Se.length;He+=3)this.indexArray.emplaceBack(it+Se[He],it+Se[He+1],it+Se[He+2]);Q.vertexLength+=V,Q.primitiveLength+=Se.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,h,m,A,E)},Xr("FillBucket",Rh,{omit:["layers","patternFeatures"]});var Cp=new Wa({"fill-sort-key":new qr(ht.layout_fill["fill-sort-key"])}),G2={paint:new Wa({"fill-antialias":new sn(ht.paint_fill["fill-antialias"]),"fill-opacity":new qr(ht.paint_fill["fill-opacity"]),"fill-color":new qr(ht.paint_fill["fill-color"]),"fill-outline-color":new qr(ht.paint_fill["fill-outline-color"]),"fill-translate":new sn(ht.paint_fill["fill-translate"]),"fill-translate-anchor":new sn(ht.paint_fill["fill-translate-anchor"]),"fill-pattern":new Pl(ht.paint_fill["fill-pattern"])}),layout:Cp},W2=function(h){function p(m){h.call(this,m,G2)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype.recalculate=function(m,E){h.prototype.recalculate.call(this,m,E);var A=this.paint._values["fill-outline-color"];A.value.kind==="constant"&&A.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},p.prototype.createBucket=function(m){return new Rh(m)},p.prototype.queryRadius=function(){return uo(this.paint.get("fill-translate"))},p.prototype.queryIntersectsFeature=function(m,E,A,L,D,N,V){return Mu(ul(m,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),N.angle,V),L)},p.prototype.isTileClipped=function(){return!0},p}(Tu),X2=Xo([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,j2=zv;function zv(h,p,m,E,A){this.properties={},this.extent=m,this.type=0,this._pbf=h,this._geometry=-1,this._keys=E,this._values=A,h.readFields(UL,this,p)}function UL(h,p,m){h==1?p.id=m.readVarint():h==2?function(E,A){for(var L=E.readVarint()+E.pos;E.pos<L;){var D=A._keys[E.readVarint()],N=A._values[E.readVarint()];A.properties[D]=N}}(m,p):h==3?p.type=m.readVarint():h==4&&(p._geometry=m.pos)}function Af(h){for(var p,m,E=0,A=0,L=h.length,D=L-1;A<L;D=A++)E+=((m=h[D]).x-(p=h[A]).x)*(p.y+m.y);return E}zv.types=["Unknown","Point","LineString","Polygon"],zv.prototype.loadGeometry=function(){var h=this._pbf;h.pos=this._geometry;for(var p,m=h.readVarint()+h.pos,E=1,A=0,L=0,D=0,N=[];h.pos<m;){if(A<=0){var V=h.readVarint();E=7&V,A=V>>3}if(A--,E===1||E===2)L+=h.readSVarint(),D+=h.readSVarint(),E===1&&(p&&N.push(p),p=[]),p.push(new c(L,D));else{if(E!==7)throw new Error("unknown command "+E);p&&p.push(p[0].clone())}}return p&&N.push(p),N},zv.prototype.bbox=function(){var h=this._pbf;h.pos=this._geometry;for(var p=h.readVarint()+h.pos,m=1,E=0,A=0,L=0,D=1/0,N=-1/0,V=1/0,W=-1/0;h.pos<p;){if(E<=0){var q=h.readVarint();m=7&q,E=q>>3}if(E--,m===1||m===2)(A+=h.readSVarint())<D&&(D=A),A>N&&(N=A),(L+=h.readSVarint())<V&&(V=L),L>W&&(W=L);else if(m!==7)throw new Error("unknown command "+m)}return[D,V,N,W]},zv.prototype.toGeoJSON=function(h,p,m){var E,A,L=this.extent*Math.pow(2,m),D=this.extent*h,N=this.extent*p,V=this.loadGeometry(),W=zv.types[this.type];function q(ut){for(var At=0;At<ut.length;At++){var It=ut[At];ut[At]=[360*(It.x+D)/L-180,360/Math.PI*Math.atan(Math.exp((180-360*(It.y+N)/L)*Math.PI/180))-90]}}switch(this.type){case 1:var Q=[];for(E=0;E<V.length;E++)Q[E]=V[E][0];q(V=Q);break;case 2:for(E=0;E<V.length;E++)q(V[E]);break;case 3:for(V=function(ut){var At=ut.length;if(At<=1)return[ut];for(var It,Wt,kt=[],ie=0;ie<At;ie++){var ue=Af(ut[ie]);ue!==0&&(Wt===void 0&&(Wt=ue<0),Wt===ue<0?(It&&kt.push(It),It=[ut[ie]]):It.push(ut[ie]))}return It&&kt.push(It),kt}(V),E=0;E<V.length;E++)for(A=0;A<V[E].length;A++)q(V[E][A])}V.length===1?V=V[0]:W="Multi"+W;var it={type:"Feature",geometry:{type:W,coordinates:V},properties:this.properties};return"id"in this&&(it.id=this.id),it};var mE=Uv;function Uv(h,p){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=h,this._keys=[],this._values=[],this._features=[],h.readFields(Sp,this,p),this.length=this._features.length}function Sp(h,p,m){h===15?p.version=m.readVarint():h===1?p.name=m.readString():h===5?p.extent=m.readVarint():h===2?p._features.push(m.pos):h===3?p._keys.push(m.readString()):h===4&&p._values.push(function(E){for(var A=null,L=E.readVarint()+E.pos;E.pos<L;){var D=E.readVarint()>>3;A=D===1?E.readString():D===2?E.readFloat():D===3?E.readDouble():D===4?E.readVarint64():D===5?E.readVarint():D===6?E.readSVarint():D===7?E.readBoolean():null}return A}(m))}function Y2(h,p,m){if(h===3){var E=new mE(m,m.readVarint()+m.pos);E.length&&(p[E.name]=E)}}Uv.prototype.feature=function(h){if(h<0||h>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[h];var p=this._pbf.readVarint()+this._pbf.pos;return new j2(this._pbf,p,this.extent,this._keys,this._values)};var Tp={VectorTile:function(h,p){this.layers=h.readFields(Y2,{},p)},VectorTileFeature:j2,VectorTileLayer:mE},p1=Tp.VectorTileFeature.types,v1=Math.pow(2,13);function hl(h,p,m,E,A,L,D,N){h.emplaceBack(p,m,2*Math.floor(E*v1)+D,A*v1*2,L*v1*2,Math.round(N))}var Qs=function(h){this.zoom=h.zoom,this.overscaling=h.overscaling,this.layers=h.layers,this.layerIds=this.layers.map(function(p){return p.id}),this.index=h.index,this.hasPattern=!1,this.layoutVertexArray=new Ah,this.indexArray=new Sc,this.programConfigurations=new En(h.layers,h.zoom),this.segments=new dt,this.stateDependentLayerIds=this.layers.filter(function(p){return p.isStateDependent()}).map(function(p){return p.id})};function Yo(h,p){return h.x===p.x&&(h.x<0||h.x>8192)||h.y===p.y&&(h.y<0||h.y>8192)}Qs.prototype.populate=function(h,p,m){this.features=[],this.hasPattern=vE("fill-extrusion",this.layers,p);for(var E=0,A=h;E<A.length;E+=1){var L=A[E],D=L.feature,N=L.id,V=L.index,W=L.sourceLayerIndex,q=this.layers[0]._featureFilter.needGeometry,Q=qa(D,q);if(this.layers[0]._featureFilter.filter(new Wn(this.zoom),Q,m)){var it={id:N,sourceLayerIndex:W,index:V,geometry:q?Q.geometry:Xa(D),properties:D.properties,type:D.type,patterns:{}};this.hasPattern?this.features.push(gE("fill-extrusion",this.layers,it,this.zoom,p)):this.addFeature(it,it.geometry,V,m,{}),p.featureIndex.insert(D,it.geometry,V,W,this.index,!0)}}},Qs.prototype.addFeatures=function(h,p,m){for(var E=0,A=this.features;E<A.length;E+=1){var L=A[E];this.addFeature(L,L.geometry,L.index,p,m)}},Qs.prototype.update=function(h,p,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(h,p,this.stateDependentLayers,m)},Qs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Qs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Qs.prototype.upload=function(h){this.uploaded||(this.layoutVertexBuffer=h.createVertexBuffer(this.layoutVertexArray,X2),this.indexBuffer=h.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(h),this.uploaded=!0},Qs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Qs.prototype.addFeature=function(h,p,m,E,A){for(var L=0,D=d1(p,500);L<D.length;L+=1){for(var N=D[L],V=0,W=0,q=N;W<q.length;W+=1)V+=q[W].length;for(var Q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),it=0,ut=N;it<ut.length;it+=1){var At=ut[it];if(At.length!==0&&!((mi=At).every(function(qn){return qn.x<0})||mi.every(function(qn){return qn.x>8192})||mi.every(function(qn){return qn.y<0})||mi.every(function(qn){return qn.y>8192})))for(var It=0,Wt=0;Wt<At.length;Wt++){var kt=At[Wt];if(Wt>=1){var ie=At[Wt-1];if(!Yo(kt,ie)){Q.vertexLength+4>dt.MAX_VERTEX_ARRAY_LENGTH&&(Q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var ue=kt.sub(ie)._perp()._unit(),be=ie.dist(kt);It+be>32768&&(It=0),hl(this.layoutVertexArray,kt.x,kt.y,ue.x,ue.y,0,0,It),hl(this.layoutVertexArray,kt.x,kt.y,ue.x,ue.y,0,1,It),hl(this.layoutVertexArray,ie.x,ie.y,ue.x,ue.y,0,0,It+=be),hl(this.layoutVertexArray,ie.x,ie.y,ue.x,ue.y,0,1,It);var Se=Q.vertexLength;this.indexArray.emplaceBack(Se,Se+2,Se+1),this.indexArray.emplaceBack(Se+1,Se+2,Se+3),Q.vertexLength+=4,Q.primitiveLength+=2}}}}if(Q.vertexLength+V>dt.MAX_VERTEX_ARRAY_LENGTH&&(Q=this.segments.prepareSegment(V,this.layoutVertexArray,this.indexArray)),p1[h.type]==="Polygon"){for(var He=[],lr=[],_r=Q.vertexLength,un=0,Br=N;un<Br.length;un+=1){var vn=Br[un];if(vn.length!==0){vn!==N[0]&&lr.push(He.length/2);for(var $r=0;$r<vn.length;$r++){var ui=vn[$r];hl(this.layoutVertexArray,ui.x,ui.y,0,0,1,1,0),He.push(ui.x),He.push(ui.y)}}}for(var On=s1(He,lr),Qr=0;Qr<On.length;Qr+=3)this.indexArray.emplaceBack(_r+On[Qr],_r+On[Qr+2],_r+On[Qr+1]);Q.primitiveLength+=On.length/3,Q.vertexLength+=V}}var mi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,h,m,A,E)},Xr("FillExtrusionBucket",Qs,{omit:["layers","features"]});var Iu={paint:new Wa({"fill-extrusion-opacity":new sn(ht["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new qr(ht["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new sn(ht["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new sn(ht["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Pl(ht["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new qr(ht["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new qr(ht["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new sn(ht["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Z2=function(h){function p(m){h.call(this,m,Iu)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype.createBucket=function(m){return new Qs(m)},p.prototype.queryRadius=function(){return uo(this.paint.get("fill-extrusion-translate"))},p.prototype.is3D=function(){return!0},p.prototype.queryIntersectsFeature=function(m,E,A,L,D,N,V,W){var q=ul(m,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),N.angle,V),Q=this.paint.get("fill-extrusion-height").evaluate(E,A),it=this.paint.get("fill-extrusion-base").evaluate(E,A),ut=function(It,Wt,kt,ie){for(var ue=[],be=0,Se=It;be<Se.length;be+=1){var He=Se[be],lr=[He.x,He.y,0,1];Tf(lr,lr,Wt),ue.push(new c(lr[0]/lr[3],lr[1]/lr[3]))}return ue}(q,W),At=function(It,Wt,kt,ie){for(var ue=[],be=[],Se=ie[8]*Wt,He=ie[9]*Wt,lr=ie[10]*Wt,_r=ie[11]*Wt,un=ie[8]*kt,Br=ie[9]*kt,vn=ie[10]*kt,$r=ie[11]*kt,ui=0,On=It;ui<On.length;ui+=1){for(var Qr=[],mi=[],qn=0,ki=On[ui];qn<ki.length;qn+=1){var mn=ki[qn],qi=mn.x,Qa=mn.y,Eo=ie[0]*qi+ie[4]*Qa+ie[12],yo=ie[1]*qi+ie[5]*Qa+ie[13],Ja=ie[2]*qi+ie[6]*Qa+ie[14],wo=ie[3]*qi+ie[7]*Qa+ie[15],Ms=Ja+lr,Rs=wo+_r,Bl=Eo+un,Vs=yo+Br,Nl=Ja+vn,Do=wo+$r,Gs=new c((Eo+Se)/Rs,(yo+He)/Rs);Gs.z=Ms/Rs,Qr.push(Gs);var Ti=new c(Bl/Do,Vs/Do);Ti.z=Nl/Do,mi.push(Ti)}ue.push(Qr),be.push(mi)}return[ue,be]}(L,it,Q,W);return function(It,Wt,kt){var ie=1/0;Mu(kt,Wt)&&(ie=q2(kt,Wt[0]));for(var ue=0;ue<Wt.length;ue++)for(var be=Wt[ue],Se=It[ue],He=0;He<be.length-1;He++){var lr=be[He],_r=[lr,be[He+1],Se[He+1],Se[He],lr];Tc(kt,_r)&&(ie=Math.min(ie,q2(kt,_r)))}return ie!==1/0&&ie}(At[0],At[1],ut)},p}(Tu);function ny(h,p){return h.x*p.x+h.y*p.y}function q2(h,p){if(h.length===1){for(var m,E=0,A=p[E++];!m||A.equals(m);)if(!(m=p[E++]))return 1/0;for(;E<p.length;E++){var L=p[E],D=h[0],N=m.sub(A),V=L.sub(A),W=D.sub(A),q=ny(N,N),Q=ny(N,V),it=ny(V,V),ut=ny(W,N),At=ny(W,V),It=q*it-Q*Q,Wt=(it*ut-Q*At)/It,kt=(q*At-Q*ut)/It,ie=A.z*(1-Wt-kt)+m.z*Wt+L.z*kt;if(isFinite(ie))return ie}return 1/0}for(var ue=1/0,be=0,Se=p;be<Se.length;be+=1)ue=Math.min(ue,Se[be].z);return ue}var $L=Xo([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,HL=Xo([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,K2=Tp.VectorTileFeature.types,VL=Math.cos(Math.PI/180*37.5),Q2=Math.pow(2,14)/.5,fl=function(h){var p=this;this.zoom=h.zoom,this.overscaling=h.overscaling,this.layers=h.layers,this.layerIds=this.layers.map(function(m){return m.id}),this.index=h.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(m){p.gradients[m.id]={}}),this.layoutVertexArray=new Dl,this.layoutVertexArray2=new mp,this.indexArray=new Sc,this.programConfigurations=new En(h.layers,h.zoom),this.segments=new dt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(m){return m.isStateDependent()}).map(function(m){return m.id})};fl.prototype.populate=function(h,p,m){this.hasPattern=vE("line",this.layers,p);for(var E=this.layers[0].layout.get("line-sort-key"),A=[],L=0,D=h;L<D.length;L+=1){var N=D[L],V=N.feature,W=N.id,q=N.index,Q=N.sourceLayerIndex,it=this.layers[0]._featureFilter.needGeometry,ut=qa(V,it);if(this.layers[0]._featureFilter.filter(new Wn(this.zoom),ut,m)){var At=E?E.evaluate(ut,{},m):void 0,It={id:W,properties:V.properties,type:V.type,sourceLayerIndex:Q,index:q,geometry:it?ut.geometry:Xa(V),patterns:{},sortKey:At};A.push(It)}}E&&A.sort(function(lr,_r){return lr.sortKey-_r.sortKey});for(var Wt=0,kt=A;Wt<kt.length;Wt+=1){var ie=kt[Wt],ue=ie.geometry,be=ie.index,Se=ie.sourceLayerIndex;if(this.hasPattern){var He=gE("line",this.layers,ie,this.zoom,p);this.patternFeatures.push(He)}else this.addFeature(ie,ue,be,m,{});p.featureIndex.insert(h[be].feature,ue,be,Se,this.index)}},fl.prototype.update=function(h,p,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(h,p,this.stateDependentLayers,m)},fl.prototype.addFeatures=function(h,p,m){for(var E=0,A=this.patternFeatures;E<A.length;E+=1){var L=A[E];this.addFeature(L,L.geometry,L.index,p,m)}},fl.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},fl.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},fl.prototype.upload=function(h){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=h.createVertexBuffer(this.layoutVertexArray2,HL)),this.layoutVertexBuffer=h.createVertexBuffer(this.layoutVertexArray,$L),this.indexBuffer=h.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(h),this.uploaded=!0},fl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},fl.prototype.lineFeatureClips=function(h){if(h.properties&&h.properties.hasOwnProperty("mapbox_clip_start")&&h.properties.hasOwnProperty("mapbox_clip_end"))return{start:+h.properties.mapbox_clip_start,end:+h.properties.mapbox_clip_end}},fl.prototype.addFeature=function(h,p,m,E,A){var L=this.layers[0].layout,D=L.get("line-join").evaluate(h,{}),N=L.get("line-cap"),V=L.get("line-miter-limit"),W=L.get("line-round-limit");this.lineClips=this.lineFeatureClips(h);for(var q=0,Q=p;q<Q.length;q+=1)this.addLine(Q[q],h,D,N,V,W);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,h,m,A,E)},fl.prototype.addLine=function(h,p,m,E,A,L){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var D=0;D<h.length-1;D++)this.totalDistance+=h[D].dist(h[D+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var N=K2[p.type]==="Polygon",V=h.length;V>=2&&h[V-1].equals(h[V-2]);)V--;for(var W=0;W<V-1&&h[W].equals(h[W+1]);)W++;if(!(V<(N?3:2))){m==="bevel"&&(A=1.05);var q,Q=this.overscaling<=16?122880/(512*this.overscaling):0,it=this.segments.prepareSegment(10*V,this.layoutVertexArray,this.indexArray),ut=void 0,At=void 0,It=void 0,Wt=void 0;this.e1=this.e2=-1,N&&(Wt=h[W].sub(q=h[V-2])._unit()._perp());for(var kt=W;kt<V;kt++)if(!(At=kt===V-1?N?h[W+1]:void 0:h[kt+1])||!h[kt].equals(At)){Wt&&(It=Wt),q&&(ut=q),q=h[kt],Wt=At?At.sub(q)._unit()._perp():It;var ie=(It=It||Wt).add(Wt);ie.x===0&&ie.y===0||ie._unit();var ue=It.x*Wt.x+It.y*Wt.y,be=ie.x*Wt.x+ie.y*Wt.y,Se=be!==0?1/be:1/0,He=2*Math.sqrt(2-2*be),lr=be<VL&&ut&&At,_r=It.x*Wt.y-It.y*Wt.x>0;if(lr&&kt>W){var un=q.dist(ut);if(un>2*Q){var Br=q.sub(q.sub(ut)._mult(Q/un)._round());this.updateDistance(ut,Br),this.addCurrentVertex(Br,It,0,0,it),ut=Br}}var vn=ut&&At,$r=vn?m:N?"butt":E;if(vn&&$r==="round"&&(Se<L?$r="miter":Se<=2&&($r="fakeround")),$r==="miter"&&Se>A&&($r="bevel"),$r==="bevel"&&(Se>2&&($r="flipbevel"),Se<A&&($r="miter")),ut&&this.updateDistance(ut,q),$r==="miter")ie._mult(Se),this.addCurrentVertex(q,ie,0,0,it);else if($r==="flipbevel"){if(Se>100)ie=Wt.mult(-1);else{var ui=Se*It.add(Wt).mag()/It.sub(Wt).mag();ie._perp()._mult(ui*(_r?-1:1))}this.addCurrentVertex(q,ie,0,0,it),this.addCurrentVertex(q,ie.mult(-1),0,0,it)}else if($r==="bevel"||$r==="fakeround"){var On=-Math.sqrt(Se*Se-1),Qr=_r?On:0,mi=_r?0:On;if(ut&&this.addCurrentVertex(q,It,Qr,mi,it),$r==="fakeround")for(var qn=Math.round(180*He/Math.PI/20),ki=1;ki<qn;ki++){var mn=ki/qn;if(mn!==.5){var qi=mn-.5;mn+=mn*qi*(mn-1)*((1.0904+ue*(ue*(3.55645-1.43519*ue)-3.2452))*qi*qi+(.848013+ue*(.215638*ue-1.06021)))}var Qa=Wt.sub(It)._mult(mn)._add(It)._unit()._mult(_r?-1:1);this.addHalfVertex(q,Qa.x,Qa.y,!1,_r,0,it)}At&&this.addCurrentVertex(q,Wt,-Qr,-mi,it)}else if($r==="butt")this.addCurrentVertex(q,ie,0,0,it);else if($r==="square"){var Eo=ut?1:-1;this.addCurrentVertex(q,ie,Eo,Eo,it)}else $r==="round"&&(ut&&(this.addCurrentVertex(q,It,0,0,it),this.addCurrentVertex(q,It,1,1,it,!0)),At&&(this.addCurrentVertex(q,Wt,-1,-1,it,!0),this.addCurrentVertex(q,Wt,0,0,it)));if(lr&&kt<V-1){var yo=q.dist(At);if(yo>2*Q){var Ja=q.add(At.sub(q)._mult(Q/yo)._round());this.updateDistance(q,Ja),this.addCurrentVertex(Ja,Wt,0,0,it),q=Ja}}}}},fl.prototype.addCurrentVertex=function(h,p,m,E,A,L){L===void 0&&(L=!1);var D=p.y*E-p.x,N=-p.y-p.x*E;this.addHalfVertex(h,p.x+p.y*m,p.y-p.x*m,L,!1,m,A),this.addHalfVertex(h,D,N,L,!0,-E,A),this.distance>Q2/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(h,p,m,E,A,L))},fl.prototype.addHalfVertex=function(h,p,m,E,A,L,D){var N=.5*(this.lineClips?this.scaledDistance*(Q2-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((h.x<<1)+(E?1:0),(h.y<<1)+(A?1:0),Math.round(63*p)+128,Math.round(63*m)+128,1+(L===0?0:L<0?-1:1)|(63&N)<<2,N>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var V=D.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,V),D.primitiveLength++),A?this.e2=V:this.e1=V},fl.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},fl.prototype.updateDistance=function(h,p){this.distance+=h.dist(p),this.updateScaledDistance()},Xr("LineBucket",fl,{omit:["layers","patternFeatures"]});var GL=new Wa({"line-cap":new sn(ht.layout_line["line-cap"]),"line-join":new qr(ht.layout_line["line-join"]),"line-miter-limit":new sn(ht.layout_line["line-miter-limit"]),"line-round-limit":new sn(ht.layout_line["line-round-limit"]),"line-sort-key":new qr(ht.layout_line["line-sort-key"])}),J2={paint:new Wa({"line-opacity":new qr(ht.paint_line["line-opacity"]),"line-color":new qr(ht.paint_line["line-color"]),"line-translate":new sn(ht.paint_line["line-translate"]),"line-translate-anchor":new sn(ht.paint_line["line-translate-anchor"]),"line-width":new qr(ht.paint_line["line-width"]),"line-gap-width":new qr(ht.paint_line["line-gap-width"]),"line-offset":new qr(ht.paint_line["line-offset"]),"line-blur":new qr(ht.paint_line["line-blur"]),"line-dasharray":new zs(ht.paint_line["line-dasharray"]),"line-pattern":new Pl(ht.paint_line["line-pattern"]),"line-gradient":new Zu(ht.paint_line["line-gradient"])}),layout:GL},yE=new(function(h){function p(){h.apply(this,arguments)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype.possiblyEvaluate=function(m,E){return E=new Wn(Math.floor(E.zoom),{now:E.now,fadeDuration:E.fadeDuration,zoomHistory:E.zoomHistory,transition:E.transition}),h.prototype.possiblyEvaluate.call(this,m,E)},p.prototype.evaluate=function(m,E,A,L){return E=M({},E,{zoom:Math.floor(E.zoom)}),h.prototype.evaluate.call(this,m,E,A,L)},p}(qr))(J2.paint.properties["line-width"].specification);yE.useIntegerZoom=!0;var tT=function(h){function p(m){h.call(this,m,J2),this.gradientVersion=0}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype._handleSpecialPaintPropertyUpdate=function(m){m==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Il,this.gradientVersion=(this.gradientVersion+1)%v)},p.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},p.prototype.recalculate=function(m,E){h.prototype.recalculate.call(this,m,E),this.paint._values["line-floorwidth"]=yE.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,m)},p.prototype.createBucket=function(m){return new fl(m)},p.prototype.queryRadius=function(m){var E=m,A=_E(Ts("line-width",this,E),Ts("line-gap-width",this,E)),L=Ts("line-offset",this,E);return A/2+Math.abs(L)+uo(this.paint.get("line-translate"))},p.prototype.queryIntersectsFeature=function(m,E,A,L,D,N,V){var W=ul(m,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),N.angle,V),q=V/2*_E(this.paint.get("line-width").evaluate(E,A),this.paint.get("line-gap-width").evaluate(E,A)),Q=this.paint.get("line-offset").evaluate(E,A);return Q&&(L=function(it,ut){for(var At=[],It=new c(0,0),Wt=0;Wt<it.length;Wt++){for(var kt=it[Wt],ie=[],ue=0;ue<kt.length;ue++){var be=kt[ue],Se=kt[ue+1],He=ue===0?It:be.sub(kt[ue-1])._unit()._perp(),lr=ue===kt.length-1?It:Se.sub(be)._unit()._perp(),_r=He._add(lr)._unit();_r._mult(1/(_r.x*lr.x+_r.y*lr.y)),ie.push(_r._mult(ut)._add(be))}At.push(ie)}return At}(L,Q*V)),function(it,ut,At){for(var It=0;It<ut.length;It++){var Wt=ut[It];if(it.length>=3){for(var kt=0;kt<Wt.length;kt++)if(Ku(it,Wt[kt]))return!0}if(Fl(it,Wt,At))return!0}return!1}(W,L,q)},p.prototype.isTileClipped=function(){return!0},p}(Tu);function _E(h,p){return p>0?p+2*h:h}var WL=Xo([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),XL=Xo([{name:"a_projected_pos",components:3,type:"Float32"}],4),eT=(Xo([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Xo([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),rT=(Xo([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Xo([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),j=Xo([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function _t(h,p,m){return h.sections.forEach(function(E){E.text=function(A,L,D){var N=L.layout.get("text-transform").evaluate(D,{});return N==="uppercase"?A=A.toLocaleUpperCase():N==="lowercase"&&(A=A.toLocaleLowerCase()),eu.applyArabicShaping&&(A=eu.applyArabicShaping(A)),A}(E.text,p,m)}),h}Xo([{name:"triangle",components:3,type:"Uint16"}]),Xo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Xo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Xo([{type:"Float32",name:"offsetX"}]),Xo([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Bt={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"},ge=function(h,p,m,E,A){var L,D,N=8*A-E-1,V=(1<<N)-1,W=V>>1,q=-7,Q=m?A-1:0,it=m?-1:1,ut=h[p+Q];for(Q+=it,L=ut&(1<<-q)-1,ut>>=-q,q+=N;q>0;L=256*L+h[p+Q],Q+=it,q-=8);for(D=L&(1<<-q)-1,L>>=-q,q+=E;q>0;D=256*D+h[p+Q],Q+=it,q-=8);if(L===0)L=1-W;else{if(L===V)return D?NaN:1/0*(ut?-1:1);D+=Math.pow(2,E),L-=W}return(ut?-1:1)*D*Math.pow(2,L-E)},Ue=function(h,p,m,E,A,L){var D,N,V,W=8*L-A-1,q=(1<<W)-1,Q=q>>1,it=A===23?Math.pow(2,-24)-Math.pow(2,-77):0,ut=E?0:L-1,At=E?1:-1,It=p<0||p===0&&1/p<0?1:0;for(p=Math.abs(p),isNaN(p)||p===1/0?(N=isNaN(p)?1:0,D=q):(D=Math.floor(Math.log(p)/Math.LN2),p*(V=Math.pow(2,-D))<1&&(D--,V*=2),(p+=D+Q>=1?it/V:it*Math.pow(2,1-Q))*V>=2&&(D++,V/=2),D+Q>=q?(N=0,D=q):D+Q>=1?(N=(p*V-1)*Math.pow(2,A),D+=Q):(N=p*Math.pow(2,Q-1)*Math.pow(2,A),D=0));A>=8;h[m+ut]=255&N,ut+=At,N/=256,A-=8);for(D=D<<A|N,W+=A;W>0;h[m+ut]=255&D,ut+=At,D/=256,W-=8);h[m+ut-At]|=128*It},_e=ce;function ce(h){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(h)?h:new Uint8Array(h||0),this.pos=0,this.type=0,this.length=this.buf.length}ce.Varint=0,ce.Fixed64=1,ce.Bytes=2,ce.Fixed32=5;var ir=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ke(h){return h.type===ce.Bytes?h.readVarint()+h.pos:h.pos+1}function vr(h,p,m){return m?4294967296*p+(h>>>0):4294967296*(p>>>0)+(h>>>0)}function sr(h,p,m){var E=p<=16383?1:p<=2097151?2:p<=268435455?3:Math.floor(Math.log(p)/(7*Math.LN2));m.realloc(E);for(var A=m.pos-1;A>=h;A--)m.buf[A+E]=m.buf[A]}function fr(h,p){for(var m=0;m<h.length;m++)p.writeVarint(h[m])}function yr(h,p){for(var m=0;m<h.length;m++)p.writeSVarint(h[m])}function Qe(h,p){for(var m=0;m<h.length;m++)p.writeFloat(h[m])}function dr(h,p){for(var m=0;m<h.length;m++)p.writeDouble(h[m])}function ae(h,p){for(var m=0;m<h.length;m++)p.writeBoolean(h[m])}function Te(h,p){for(var m=0;m<h.length;m++)p.writeFixed32(h[m])}function ar(h,p){for(var m=0;m<h.length;m++)p.writeSFixed32(h[m])}function Sr(h,p){for(var m=0;m<h.length;m++)p.writeFixed64(h[m])}function Xe(h,p){for(var m=0;m<h.length;m++)p.writeSFixed64(h[m])}function Lr(h,p){return(h[p]|h[p+1]<<8|h[p+2]<<16)+16777216*h[p+3]}function tr(h,p,m){h[m]=p,h[m+1]=p>>>8,h[m+2]=p>>>16,h[m+3]=p>>>24}function Ar(h,p){return(h[p]|h[p+1]<<8|h[p+2]<<16)+(h[p+3]<<24)}function je(h,p,m){h===1&&m.readMessage(Er,p)}function Er(h,p,m){if(h===3){var E=m.readMessage(dn,{}),A=E.width,L=E.height,D=E.left,N=E.top,V=E.advance;p.push({id:E.id,bitmap:new xp({width:A+6,height:L+6},E.bitmap),metrics:{width:A,height:L,left:D,top:N,advance:V}})}}function dn(h,p,m){h===1?p.id=m.readVarint():h===2?p.bitmap=m.readBytes():h===3?p.width=m.readVarint():h===4?p.height=m.readVarint():h===5?p.left=m.readSVarint():h===6?p.top=m.readSVarint():h===7&&(p.advance=m.readVarint())}function kn(h){for(var p=0,m=0,E=0,A=h;E<A.length;E+=1){var L=A[E];p+=L.w*L.h,m=Math.max(m,L.w)}h.sort(function(It,Wt){return Wt.h-It.h});for(var D=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(p/.95)),m),h:1/0}],N=0,V=0,W=0,q=h;W<q.length;W+=1)for(var Q=q[W],it=D.length-1;it>=0;it--){var ut=D[it];if(!(Q.w>ut.w||Q.h>ut.h)){if(Q.x=ut.x,Q.y=ut.y,V=Math.max(V,Q.y+Q.h),N=Math.max(N,Q.x+Q.w),Q.w===ut.w&&Q.h===ut.h){var At=D.pop();it<D.length&&(D[it]=At)}else Q.h===ut.h?(ut.x+=Q.w,ut.w-=Q.w):Q.w===ut.w?(ut.y+=Q.h,ut.h-=Q.h):(D.push({x:ut.x+Q.w,y:ut.y,w:ut.w-Q.w,h:Q.h}),ut.y+=Q.h,ut.h-=Q.h);break}}return{w:N,h:V,fill:p/(N*V)||0}}ce.prototype={destroy:function(){this.buf=null},readFields:function(h,p,m){for(m=m||this.length;this.pos<m;){var E=this.readVarint(),A=E>>3,L=this.pos;this.type=7&E,h(A,p,this),this.pos===L&&this.skip(E)}return p},readMessage:function(h,p){return this.readFields(h,p,this.readVarint()+this.pos)},readFixed32:function(){var h=Lr(this.buf,this.pos);return this.pos+=4,h},readSFixed32:function(){var h=Ar(this.buf,this.pos);return this.pos+=4,h},readFixed64:function(){var h=Lr(this.buf,this.pos)+4294967296*Lr(this.buf,this.pos+4);return this.pos+=8,h},readSFixed64:function(){var h=Lr(this.buf,this.pos)+4294967296*Ar(this.buf,this.pos+4);return this.pos+=8,h},readFloat:function(){var h=ge(this.buf,this.pos,!0,23,4);return this.pos+=4,h},readDouble:function(){var h=ge(this.buf,this.pos,!0,52,8);return this.pos+=8,h},readVarint:function(h){var p,m,E=this.buf;return p=127&(m=E[this.pos++]),m<128?p:(p|=(127&(m=E[this.pos++]))<<7,m<128?p:(p|=(127&(m=E[this.pos++]))<<14,m<128?p:(p|=(127&(m=E[this.pos++]))<<21,m<128?p:function(A,L,D){var N,V,W=D.buf;if(N=(112&(V=W[D.pos++]))>>4,V<128||(N|=(127&(V=W[D.pos++]))<<3,V<128)||(N|=(127&(V=W[D.pos++]))<<10,V<128)||(N|=(127&(V=W[D.pos++]))<<17,V<128)||(N|=(127&(V=W[D.pos++]))<<24,V<128)||(N|=(1&(V=W[D.pos++]))<<31,V<128))return vr(A,N,L);throw new Error("Expected varint not more than 10 bytes")}(p|=(15&(m=E[this.pos]))<<28,h,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var h=this.readVarint();return h%2==1?(h+1)/-2:h/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var h=this.readVarint()+this.pos,p=this.pos;return this.pos=h,h-p>=12&&ir?function(m,E,A){return ir.decode(m.subarray(E,A))}(this.buf,p,h):function(m,E,A){for(var L="",D=E;D<A;){var N,V,W,q=m[D],Q=null,it=q>239?4:q>223?3:q>191?2:1;if(D+it>A)break;it===1?q<128&&(Q=q):it===2?(192&(N=m[D+1]))==128&&(Q=(31&q)<<6|63&N)<=127&&(Q=null):it===3?(V=m[D+2],(192&(N=m[D+1]))==128&&(192&V)==128&&((Q=(15&q)<<12|(63&N)<<6|63&V)<=2047||Q>=55296&&Q<=57343)&&(Q=null)):it===4&&(V=m[D+2],W=m[D+3],(192&(N=m[D+1]))==128&&(192&V)==128&&(192&W)==128&&((Q=(15&q)<<18|(63&N)<<12|(63&V)<<6|63&W)<=65535||Q>=1114112)&&(Q=null)),Q===null?(Q=65533,it=1):Q>65535&&(Q-=65536,L+=String.fromCharCode(Q>>>10&1023|55296),Q=56320|1023&Q),L+=String.fromCharCode(Q),D+=it}return L}(this.buf,p,h)},readBytes:function(){var h=this.readVarint()+this.pos,p=this.buf.subarray(this.pos,h);return this.pos=h,p},readPackedVarint:function(h,p){if(this.type!==ce.Bytes)return h.push(this.readVarint(p));var m=Ke(this);for(h=h||[];this.pos<m;)h.push(this.readVarint(p));return h},readPackedSVarint:function(h){if(this.type!==ce.Bytes)return h.push(this.readSVarint());var p=Ke(this);for(h=h||[];this.pos<p;)h.push(this.readSVarint());return h},readPackedBoolean:function(h){if(this.type!==ce.Bytes)return h.push(this.readBoolean());var p=Ke(this);for(h=h||[];this.pos<p;)h.push(this.readBoolean());return h},readPackedFloat:function(h){if(this.type!==ce.Bytes)return h.push(this.readFloat());var p=Ke(this);for(h=h||[];this.pos<p;)h.push(this.readFloat());return h},readPackedDouble:function(h){if(this.type!==ce.Bytes)return h.push(this.readDouble());var p=Ke(this);for(h=h||[];this.pos<p;)h.push(this.readDouble());return h},readPackedFixed32:function(h){if(this.type!==ce.Bytes)return h.push(this.readFixed32());var p=Ke(this);for(h=h||[];this.pos<p;)h.push(this.readFixed32());return h},readPackedSFixed32:function(h){if(this.type!==ce.Bytes)return h.push(this.readSFixed32());var p=Ke(this);for(h=h||[];this.pos<p;)h.push(this.readSFixed32());return h},readPackedFixed64:function(h){if(this.type!==ce.Bytes)return h.push(this.readFixed64());var p=Ke(this);for(h=h||[];this.pos<p;)h.push(this.readFixed64());return h},readPackedSFixed64:function(h){if(this.type!==ce.Bytes)return h.push(this.readSFixed64());var p=Ke(this);for(h=h||[];this.pos<p;)h.push(this.readSFixed64());return h},skip:function(h){var p=7&h;if(p===ce.Varint)for(;this.buf[this.pos++]>127;);else if(p===ce.Bytes)this.pos=this.readVarint()+this.pos;else if(p===ce.Fixed32)this.pos+=4;else{if(p!==ce.Fixed64)throw new Error("Unimplemented type: "+p);this.pos+=8}},writeTag:function(h,p){this.writeVarint(h<<3|p)},realloc:function(h){for(var p=this.length||16;p<this.pos+h;)p*=2;if(p!==this.length){var m=new Uint8Array(p);m.set(this.buf),this.buf=m,this.length=p}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(h){this.realloc(4),tr(this.buf,h,this.pos),this.pos+=4},writeSFixed32:function(h){this.realloc(4),tr(this.buf,h,this.pos),this.pos+=4},writeFixed64:function(h){this.realloc(8),tr(this.buf,-1&h,this.pos),tr(this.buf,Math.floor(h*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(h){this.realloc(8),tr(this.buf,-1&h,this.pos),tr(this.buf,Math.floor(h*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(h){(h=+h||0)>268435455||h<0?function(p,m){var E,A;if(p>=0?(E=p%4294967296|0,A=p/4294967296|0):(A=~(-p/4294967296),4294967295^(E=~(-p%4294967296))?E=E+1|0:(E=0,A=A+1|0)),p>=18446744073709552e3||p<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");m.realloc(10),function(L,D,N){N.buf[N.pos++]=127&L|128,L>>>=7,N.buf[N.pos++]=127&L|128,L>>>=7,N.buf[N.pos++]=127&L|128,L>>>=7,N.buf[N.pos++]=127&L|128,N.buf[N.pos]=127&(L>>>=7)}(E,0,m),function(L,D){var N=(7&L)<<4;D.buf[D.pos++]|=N|((L>>>=3)?128:0),L&&(D.buf[D.pos++]=127&L|((L>>>=7)?128:0),L&&(D.buf[D.pos++]=127&L|((L>>>=7)?128:0),L&&(D.buf[D.pos++]=127&L|((L>>>=7)?128:0),L&&(D.buf[D.pos++]=127&L|((L>>>=7)?128:0),L&&(D.buf[D.pos++]=127&L)))))}(A,m)}(h,this):(this.realloc(4),this.buf[this.pos++]=127&h|(h>127?128:0),h<=127||(this.buf[this.pos++]=127&(h>>>=7)|(h>127?128:0),h<=127||(this.buf[this.pos++]=127&(h>>>=7)|(h>127?128:0),h<=127||(this.buf[this.pos++]=h>>>7&127))))},writeSVarint:function(h){this.writeVarint(h<0?2*-h-1:2*h)},writeBoolean:function(h){this.writeVarint(!!h)},writeString:function(h){h=String(h),this.realloc(4*h.length),this.pos++;var p=this.pos;this.pos=function(E,A,L){for(var D,N,V=0;V<A.length;V++){if((D=A.charCodeAt(V))>55295&&D<57344){if(!N){D>56319||V+1===A.length?(E[L++]=239,E[L++]=191,E[L++]=189):N=D;continue}if(D<56320){E[L++]=239,E[L++]=191,E[L++]=189,N=D;continue}D=N-55296<<10|D-56320|65536,N=null}else N&&(E[L++]=239,E[L++]=191,E[L++]=189,N=null);D<128?E[L++]=D:(D<2048?E[L++]=D>>6|192:(D<65536?E[L++]=D>>12|224:(E[L++]=D>>18|240,E[L++]=D>>12&63|128),E[L++]=D>>6&63|128),E[L++]=63&D|128)}return L}(this.buf,h,this.pos);var m=this.pos-p;m>=128&&sr(p,m,this),this.pos=p-1,this.writeVarint(m),this.pos+=m},writeFloat:function(h){this.realloc(4),Ue(this.buf,h,this.pos,!0,23,4),this.pos+=4},writeDouble:function(h){this.realloc(8),Ue(this.buf,h,this.pos,!0,52,8),this.pos+=8},writeBytes:function(h){var p=h.length;this.writeVarint(p),this.realloc(p);for(var m=0;m<p;m++)this.buf[this.pos++]=h[m]},writeRawMessage:function(h,p){this.pos++;var m=this.pos;h(p,this);var E=this.pos-m;E>=128&&sr(m,E,this),this.pos=m-1,this.writeVarint(E),this.pos+=E},writeMessage:function(h,p,m){this.writeTag(h,ce.Bytes),this.writeRawMessage(p,m)},writePackedVarint:function(h,p){p.length&&this.writeMessage(h,fr,p)},writePackedSVarint:function(h,p){p.length&&this.writeMessage(h,yr,p)},writePackedBoolean:function(h,p){p.length&&this.writeMessage(h,ae,p)},writePackedFloat:function(h,p){p.length&&this.writeMessage(h,Qe,p)},writePackedDouble:function(h,p){p.length&&this.writeMessage(h,dr,p)},writePackedFixed32:function(h,p){p.length&&this.writeMessage(h,Te,p)},writePackedSFixed32:function(h,p){p.length&&this.writeMessage(h,ar,p)},writePackedFixed64:function(h,p){p.length&&this.writeMessage(h,Sr,p)},writePackedSFixed64:function(h,p){p.length&&this.writeMessage(h,Xe,p)},writeBytesField:function(h,p){this.writeTag(h,ce.Bytes),this.writeBytes(p)},writeFixed32Field:function(h,p){this.writeTag(h,ce.Fixed32),this.writeFixed32(p)},writeSFixed32Field:function(h,p){this.writeTag(h,ce.Fixed32),this.writeSFixed32(p)},writeFixed64Field:function(h,p){this.writeTag(h,ce.Fixed64),this.writeFixed64(p)},writeSFixed64Field:function(h,p){this.writeTag(h,ce.Fixed64),this.writeSFixed64(p)},writeVarintField:function(h,p){this.writeTag(h,ce.Varint),this.writeVarint(p)},writeSVarintField:function(h,p){this.writeTag(h,ce.Varint),this.writeSVarint(p)},writeStringField:function(h,p){this.writeTag(h,ce.Bytes),this.writeString(p)},writeFloatField:function(h,p){this.writeTag(h,ce.Fixed32),this.writeFloat(p)},writeDoubleField:function(h,p){this.writeTag(h,ce.Fixed64),this.writeDouble(p)},writeBooleanField:function(h,p){this.writeVarintField(h,!!p)}};var wr=function(h,p){var m=p.pixelRatio,E=p.version,A=p.stretchX,L=p.stretchY,D=p.content;this.paddedRect=h,this.pixelRatio=m,this.stretchX=A,this.stretchY=L,this.content=D,this.version=E},rr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};rr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},rr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},rr.tlbr.get=function(){return this.tl.concat(this.br)},rr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(wr.prototype,rr);var $e=function(h,p){var m={},E={};this.haveRenderCallbacks=[];var A=[];this.addImages(h,m,A),this.addImages(p,E,A);var L=kn(A),D=new cl({width:L.w||1,height:L.h||1});for(var N in h){var V=h[N],W=m[N].paddedRect;cl.copy(V.data,D,{x:0,y:0},{x:W.x+1,y:W.y+1},V.data)}for(var q in p){var Q=p[q],it=E[q].paddedRect,ut=it.x+1,At=it.y+1,It=Q.data.width,Wt=Q.data.height;cl.copy(Q.data,D,{x:0,y:0},{x:ut,y:At},Q.data),cl.copy(Q.data,D,{x:0,y:Wt-1},{x:ut,y:At-1},{width:It,height:1}),cl.copy(Q.data,D,{x:0,y:0},{x:ut,y:At+Wt},{width:It,height:1}),cl.copy(Q.data,D,{x:It-1,y:0},{x:ut-1,y:At},{width:1,height:Wt}),cl.copy(Q.data,D,{x:0,y:0},{x:ut+It,y:At},{width:1,height:Wt})}this.image=D,this.iconPositions=m,this.patternPositions=E};$e.prototype.addImages=function(h,p,m){for(var E in h){var A=h[E],L={x:0,y:0,w:A.data.width+2,h:A.data.height+2};m.push(L),p[E]=new wr(L,A),A.hasRenderCallback&&this.haveRenderCallbacks.push(E)}},$e.prototype.patchUpdatedImages=function(h,p){for(var m in h.dispatchRenderCallbacks(this.haveRenderCallbacks),h.updatedImages)this.patchUpdatedImage(this.iconPositions[m],h.getImage(m),p),this.patchUpdatedImage(this.patternPositions[m],h.getImage(m),p)},$e.prototype.patchUpdatedImage=function(h,p,m){if(h&&p&&h.version!==p.version){h.version=p.version;var E=h.tl;m.update(p.data,void 0,{x:E[0],y:E[1]})}},Xr("ImagePosition",wr),Xr("ImageAtlas",$e);var pn={horizontal:1,vertical:2,horizontalOnly:3},li=function(){this.scale=1,this.fontStack="",this.imageName=null};li.forText=function(h,p){var m=new li;return m.scale=h||1,m.fontStack=p,m},li.forImage=function(h){var p=new li;return p.imageName=h,p};var Or=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function ei(h,p,m,E,A,L,D,N,V,W,q,Q,it,ut,At,It){var Wt,kt=Or.fromFeature(h,A);Q===pn.vertical&&kt.verticalizePunctuation();var ie=eu.processBidirectionalText,ue=eu.processStyledBidirectionalText;if(ie&&kt.sections.length===1){Wt=[];for(var be=0,Se=ie(kt.toString(),Oo(kt,W,L,p,E,ut,At));be<Se.length;be+=1){var He=Se[be],lr=new Or;lr.text=He,lr.sections=kt.sections;for(var _r=0;_r<He.length;_r++)lr.sectionIndex.push(0);Wt.push(lr)}}else if(ue){Wt=[];for(var un=0,Br=ue(kt.text,kt.sectionIndex,Oo(kt,W,L,p,E,ut,At));un<Br.length;un+=1){var vn=Br[un],$r=new Or;$r.text=vn[0],$r.sectionIndex=vn[1],$r.sections=kt.sections,Wt.push($r)}}else Wt=function(Qr,mi){for(var qn=[],ki=Qr.text,mn=0,qi=0,Qa=mi;qi<Qa.length;qi+=1){var Eo=Qa[qi];qn.push(Qr.substring(mn,Eo)),mn=Eo}return mn<ki.length&&qn.push(Qr.substring(mn,ki.length)),qn}(kt,Oo(kt,W,L,p,E,ut,At));var ui=[],On={positionedLines:ui,text:kt.toString(),top:q[1],bottom:q[1],left:q[0],right:q[0],writingMode:Q,iconsInText:!1,verticalizable:!1};return function(Qr,mi,qn,ki,mn,qi,Qa,Eo,yo,Ja,wo,Ms){for(var Rs=0,Bl=-17,Vs=0,Nl=0,Do=Eo==="right"?1:Eo==="left"?0:.5,Gs=0,Ti=0,Ta=mn;Ti<Ta.length;Ti+=1){var va=Ta[Ti];va.trim();var Gi=va.getMaxScale(),iu=24*(Gi-1),dl={positionedGlyphs:[],lineOffset:0};Qr.positionedLines[Gs]=dl;var ja=dl.positionedGlyphs,Jo=0;if(va.length()){for(var pl=0;pl<va.length();pl++){var Ki=va.getSection(pl),Ap=va.getSectionIndex(pl),Ic=va.getCharCode(pl),Mp=0,Fo=null,Rp=null,Mf=null,y1=24,sy=!(yo===pn.horizontal||!wo&&!Iv(Ic)||wo&&(Bn[Ic]||(Gv=Ic,xr.Arabic(Gv)||xr["Arabic Supplement"](Gv)||xr["Arabic Extended-A"](Gv)||xr["Arabic Presentation Forms-A"](Gv)||xr["Arabic Presentation Forms-B"](Gv))));if(Ki.imageName){var _1=ki[Ki.imageName];if(!_1)continue;Mf=Ki.imageName,Qr.iconsInText=Qr.iconsInText||!0,Rp=_1.paddedRect;var Vv=_1.displaySize;Ki.scale=24*Ki.scale/Ms,Mp=iu+(24-Vv[1]*Ki.scale),y1=(Fo={width:Vv[0],height:Vv[1],left:1,top:-3,advance:sy?Vv[1]:Vv[0]}).advance;var x1=sy?Vv[0]*Ki.scale-24*Gi:Vv[1]*Ki.scale-24*Gi;x1>0&&x1>Jo&&(Jo=x1)}else{var sT=qn[Ki.fontStack],b1=sT&&sT[Ic];if(b1&&b1.rect)Rp=b1.rect,Fo=b1.metrics;else{var wE=mi[Ki.fontStack],lT=wE&&wE[Ic];if(!lT)continue;Fo=lT.metrics}Mp=24*(Gi-Ki.scale)}sy?(Qr.verticalizable=!0,ja.push({glyph:Ic,imageName:Mf,x:Rs,y:Bl+Mp,vertical:sy,scale:Ki.scale,fontStack:Ki.fontStack,sectionIndex:Ap,metrics:Fo,rect:Rp}),Rs+=y1*Ki.scale+Ja):(ja.push({glyph:Ic,imageName:Mf,x:Rs,y:Bl+Mp,vertical:sy,scale:Ki.scale,fontStack:Ki.fontStack,sectionIndex:Ap,metrics:Fo,rect:Rp}),Rs+=Fo.advance*Ki.scale+Ja)}ja.length!==0&&(Vs=Math.max(Rs-Ja,Vs),Zo(ja,0,ja.length-1,Do,Jo)),Rs=0;var uT=qi*Gi+Jo;dl.lineOffset=Math.max(Jo,iu),Bl+=uT,Nl=Math.max(uT,Nl),++Gs}else Bl+=qi,++Gs}var Gv,CE=Bl- -17,E1=La(Qa),dm=E1.horizontalAlign,w1=E1.verticalAlign;(function(cT,hT,SE,TE,fT,AE,ME,RE,dT){var C1,pT=(hT-SE)*fT;C1=AE!==ME?-RE*TE- -17:(-TE*dT+.5)*ME;for(var S1=0,IE=cT;S1<IE.length;S1+=1)for(var ly=0,LE=IE[S1].positionedGlyphs;ly<LE.length;ly+=1){var T1=LE[ly];T1.x+=pT,T1.y+=C1}})(Qr.positionedLines,Do,dm,w1,Vs,Nl,qi,CE,mn.length),Qr.top+=-w1*CE,Qr.bottom=Qr.top+CE,Qr.left+=-dm*Vs,Qr.right=Qr.left+Vs}(On,p,m,E,Wt,D,N,V,Q,W,it,It),!function(Qr){for(var mi=0,qn=Qr;mi<qn.length;mi+=1)if(qn[mi].positionedGlyphs.length!==0)return!1;return!0}(ui)&&On}Or.fromFeature=function(h,p){for(var m=new Or,E=0;E<h.sections.length;E++){var A=h.sections[E];A.image?m.addImageSection(A):m.addTextSection(A,p)}return m},Or.prototype.length=function(){return this.text.length},Or.prototype.getSection=function(h){return this.sections[this.sectionIndex[h]]},Or.prototype.getSectionIndex=function(h){return this.sectionIndex[h]},Or.prototype.getCharCode=function(h){return this.text.charCodeAt(h)},Or.prototype.verticalizePunctuation=function(){this.text=function(h){for(var p="",m=0;m<h.length;m++){var E=h.charCodeAt(m+1)||null,A=h.charCodeAt(m-1)||null;p+=E&&qg(E)&&!Bt[h[m+1]]||A&&qg(A)&&!Bt[h[m-1]]||!Bt[h[m]]?h[m]:Bt[h[m]]}return p}(this.text)},Or.prototype.trim=function(){for(var h=0,p=0;p<this.text.length&&Bn[this.text.charCodeAt(p)];p++)h++;for(var m=this.text.length,E=this.text.length-1;E>=0&&E>=h&&Bn[this.text.charCodeAt(E)];E--)m--;this.text=this.text.substring(h,m),this.sectionIndex=this.sectionIndex.slice(h,m)},Or.prototype.substring=function(h,p){var m=new Or;return m.text=this.text.substring(h,p),m.sectionIndex=this.sectionIndex.slice(h,p),m.sections=this.sections,m},Or.prototype.toString=function(){return this.text},Or.prototype.getMaxScale=function(){var h=this;return this.sectionIndex.reduce(function(p,m){return Math.max(p,h.sections[m].scale)},0)},Or.prototype.addTextSection=function(h,p){this.text+=h.text,this.sections.push(li.forText(h.scale,h.fontStack||p));for(var m=this.sections.length-1,E=0;E<h.text.length;++E)this.sectionIndex.push(m)},Or.prototype.addImageSection=function(h){var p=h.image?h.image.name:"";if(p.length!==0){var m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCharCode(m),this.sections.push(li.forImage(p)),this.sectionIndex.push(this.sections.length-1)):at("Reached maximum number of images 6401")}else at("Can't add FormattedSection with an empty image.")},Or.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Bn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},An={};function Vi(h,p,m,E,A,L){if(p.imageName){var D=E[p.imageName];return D?D.displaySize[0]*p.scale*24/L+A:0}var N=m[p.fontStack],V=N&&N[h];return V?V.metrics.advance*p.scale+A:0}function Lo(h,p,m,E){var A=Math.pow(h-p,2);return E?h<p?A/2:2*A:A+Math.abs(m)*m}function As(h,p,m){var E=0;return h===10&&(E-=1e4),m&&(E+=150),h!==40&&h!==65288||(E+=50),p!==41&&p!==65289||(E+=50),E}function gi(h,p,m,E,A,L){for(var D=null,N=Lo(p,m,A,L),V=0,W=E;V<W.length;V+=1){var q=W[V],Q=Lo(p-q.x,m,A,L)+q.badness;Q<=N&&(D=q,N=Q)}return{index:h,x:p,priorBreak:D,badness:N}}function Oo(h,p,m,E,A,L,D){if(L!=="point")return[];if(!h)return[];for(var N,V=[],W=function(Wt,kt,ie,ue,be,Se){for(var He=0,lr=0;lr<Wt.length();lr++){var _r=Wt.getSection(lr);He+=Vi(Wt.getCharCode(lr),_r,ue,be,kt,Se)}return He/Math.max(1,Math.ceil(He/ie))}(h,p,m,E,A,D),q=h.text.indexOf("​")>=0,Q=0,it=0;it<h.length();it++){var ut=h.getSection(it),At=h.getCharCode(it);if(Bn[At]||(Q+=Vi(At,ut,E,A,p,D)),it<h.length()-1){var It=!((N=At)<11904||!(xr["Bopomofo Extended"](N)||xr.Bopomofo(N)||xr["CJK Compatibility Forms"](N)||xr["CJK Compatibility Ideographs"](N)||xr["CJK Compatibility"](N)||xr["CJK Radicals Supplement"](N)||xr["CJK Strokes"](N)||xr["CJK Symbols and Punctuation"](N)||xr["CJK Unified Ideographs Extension A"](N)||xr["CJK Unified Ideographs"](N)||xr["Enclosed CJK Letters and Months"](N)||xr["Halfwidth and Fullwidth Forms"](N)||xr.Hiragana(N)||xr["Ideographic Description Characters"](N)||xr["Kangxi Radicals"](N)||xr["Katakana Phonetic Extensions"](N)||xr.Katakana(N)||xr["Vertical Forms"](N)||xr["Yi Radicals"](N)||xr["Yi Syllables"](N)));(An[At]||It||ut.imageName)&&V.push(gi(it+1,Q,W,V,As(At,h.getCharCode(it+1),It&&q),!1))}}return function Wt(kt){return kt?Wt(kt.priorBreak).concat(kt.index):[]}(gi(h.length(),Q,W,V,0,!0))}function La(h){var p=.5,m=.5;switch(h){case"right":case"top-right":case"bottom-right":p=1;break;case"left":case"top-left":case"bottom-left":p=0}switch(h){case"bottom":case"bottom-right":case"bottom-left":m=1;break;case"top":case"top-right":case"top-left":m=0}return{horizontalAlign:p,verticalAlign:m}}function Zo(h,p,m,E,A){if(E||A)for(var L=h[m],D=(h[m].x+L.metrics.advance*L.scale)*E,N=p;N<=m;N++)h[N].x-=D,h[N].y+=A}function qo(h,p,m,E,A,L){var D,N=h.image;if(N.content){var V=N.content,W=N.pixelRatio||1;D=[V[0]/W,V[1]/W,N.displaySize[0]-V[2]/W,N.displaySize[1]-V[3]/W]}var q,Q,it,ut,At=p.left*L,It=p.right*L;m==="width"||m==="both"?(ut=A[0]+At-E[3],Q=A[0]+It+E[1]):Q=(ut=A[0]+(At+It-N.displaySize[0])/2)+N.displaySize[0];var Wt=p.top*L,kt=p.bottom*L;return m==="height"||m==="both"?(q=A[1]+Wt-E[0],it=A[1]+kt+E[2]):it=(q=A[1]+(Wt+kt-N.displaySize[1])/2)+N.displaySize[1],{image:N,top:q,right:Q,bottom:it,left:ut,collisionPadding:D}}An[10]=!0,An[32]=!0,An[38]=!0,An[40]=!0,An[41]=!0,An[43]=!0,An[45]=!0,An[47]=!0,An[173]=!0,An[183]=!0,An[8203]=!0,An[8208]=!0,An[8211]=!0,An[8231]=!0;var ho=function(h){function p(m,E,A,L){h.call(this,m,E),this.angle=A,L!==void 0&&(this.segment=L)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype.clone=function(){return new p(this.x,this.y,this.angle,this.segment)},p}(c);function vs(h,p){var m=p.expression;if(m.kind==="constant")return{kind:"constant",layoutSize:m.evaluate(new Wn(h+1))};if(m.kind==="source")return{kind:"source"};for(var E=m.zoomStops,A=m.interpolationType,L=0;L<E.length&&E[L]<=h;)L++;for(var D=L=Math.max(0,L-1);D<E.length&&E[D]<h+1;)D++;D=Math.min(E.length-1,D);var N=E[L],V=E[D];return m.kind==="composite"?{kind:"composite",minZoom:N,maxZoom:V,interpolationType:A}:{kind:"camera",minZoom:N,maxZoom:V,minSize:m.evaluate(new Wn(N)),maxSize:m.evaluate(new Wn(V)),interpolationType:A}}function Js(h,p,m){var E=p.uSize,A=m.lowerSize;return h.kind==="source"?A/128:h.kind==="composite"?so(A/128,m.upperSize/128,p.uSizeT):E}function Ko(h,p){var m=0,E=0;if(h.kind==="constant")E=h.layoutSize;else if(h.kind!=="source"){var A=h.interpolationType,L=A?w(Ss.interpolationFactor(A,p,h.minZoom,h.maxZoom),0,1):0;h.kind==="camera"?E=so(h.minSize,h.maxSize,L):m=L}return{uSizeT:m,uSize:E}}Xr("Anchor",ho);var Jn=Object.freeze({__proto__:null,getSizeData:vs,evaluateSizeForFeature:Js,evaluateSizeForZoom:Ko,SIZE_PACK_FACTOR:128});function $s(h,p,m,E,A){if(p.segment===void 0)return!0;for(var L=p,D=p.segment+1,N=0;N>-m/2;){if(--D<0)return!1;N-=h[D].dist(L),L=h[D]}N+=h[D].dist(h[D+1]),D++;for(var V=[],W=0;N<m/2;){var q=h[D],Q=h[D+1];if(!Q)return!1;var it=h[D-1].angleTo(q)-q.angleTo(Q);for(it=Math.abs((it+3*Math.PI)%(2*Math.PI)-Math.PI),V.push({distance:N,angleDelta:it}),W+=it;N-V[0].distance>E;)W-=V.shift().angleDelta;if(W>A)return!1;D++,N+=q.dist(Q)}return!0}function Yi(h){for(var p=0,m=0;m<h.length-1;m++)p+=h[m].dist(h[m+1]);return p}function wn(h,p,m){return h?.6*p*m:0}function di(h,p){return Math.max(h?h.right-h.left:0,p?p.right-p.left:0)}function Ni(h,p,m,E,A,L){for(var D=wn(m,A,L),N=di(m,E)*L,V=0,W=Yi(h)/2,q=0;q<h.length-1;q++){var Q=h[q],it=h[q+1],ut=Q.dist(it);if(V+ut>W){var At=(W-V)/ut,It=so(Q.x,it.x,At),Wt=so(Q.y,it.y,At),kt=new ho(It,Wt,it.angleTo(Q),q);return kt._round(),!D||$s(h,kt,N,D,p)?kt:void 0}V+=ut}}function Po(h,p,m,E,A,L,D,N,V){var W=wn(E,L,D),q=di(E,A),Q=q*D,it=h[0].x===0||h[0].x===V||h[0].y===0||h[0].y===V;return p-Q<p/4&&(p=Q+p/4),function ut(At,It,Wt,kt,ie,ue,be,Se,He){for(var lr=ue/2,_r=Yi(At),un=0,Br=It-Wt,vn=[],$r=0;$r<At.length-1;$r++){for(var ui=At[$r],On=At[$r+1],Qr=ui.dist(On),mi=On.angleTo(ui);Br+Wt<un+Qr;){var qn=((Br+=Wt)-un)/Qr,ki=so(ui.x,On.x,qn),mn=so(ui.y,On.y,qn);if(ki>=0&&ki<He&&mn>=0&&mn<He&&Br-lr>=0&&Br+lr<=_r){var qi=new ho(ki,mn,mi,$r);qi._round(),kt&&!$s(At,qi,ue,kt,ie)||vn.push(qi)}}un+=Qr}return Se||vn.length||be||(vn=ut(At,un/2,Wt,kt,ie,ue,be,!0,He)),vn}(h,it?p/2*N%p:(q/2+2*L)*D*N%p,p,W,m,Q,it,!1,V)}function Ih(h,p,m,E,A){for(var L=[],D=0;D<h.length;D++)for(var N=h[D],V=void 0,W=0;W<N.length-1;W++){var q=N[W],Q=N[W+1];q.x<p&&Q.x<p||(q.x<p?q=new c(p,q.y+(p-q.x)/(Q.x-q.x)*(Q.y-q.y))._round():Q.x<p&&(Q=new c(p,q.y+(p-q.x)/(Q.x-q.x)*(Q.y-q.y))._round()),q.y<m&&Q.y<m||(q.y<m?q=new c(q.x+(m-q.y)/(Q.y-q.y)*(Q.x-q.x),m)._round():Q.y<m&&(Q=new c(q.x+(m-q.y)/(Q.y-q.y)*(Q.x-q.x),m)._round()),q.x>=E&&Q.x>=E||(q.x>=E?q=new c(E,q.y+(E-q.x)/(Q.x-q.x)*(Q.y-q.y))._round():Q.x>=E&&(Q=new c(E,q.y+(E-q.x)/(Q.x-q.x)*(Q.y-q.y))._round()),q.y>=A&&Q.y>=A||(q.y>=A?q=new c(q.x+(A-q.y)/(Q.y-q.y)*(Q.x-q.x),A)._round():Q.y>=A&&(Q=new c(q.x+(A-q.y)/(Q.y-q.y)*(Q.x-q.x),A)._round()),V&&q.equals(V[V.length-1])||L.push(V=[q]),V.push(Q)))))}return L}function Lt(h,p,m,E){var A=[],L=h.image,D=L.pixelRatio,N=L.paddedRect.w-2,V=L.paddedRect.h-2,W=h.right-h.left,q=h.bottom-h.top,Q=L.stretchX||[[0,N]],it=L.stretchY||[[0,V]],ut=function(ki,mn){return ki+mn[1]-mn[0]},At=Q.reduce(ut,0),It=it.reduce(ut,0),Wt=N-At,kt=V-It,ie=0,ue=At,be=0,Se=It,He=0,lr=Wt,_r=0,un=kt;if(L.content&&E){var Br=L.content;ie=xe(Q,0,Br[0]),be=xe(it,0,Br[1]),ue=xe(Q,Br[0],Br[2]),Se=xe(it,Br[1],Br[3]),He=Br[0]-ie,_r=Br[1]-be,lr=Br[2]-Br[0]-ue,un=Br[3]-Br[1]-Se}var vn=function(ki,mn,qi,Qa){var Eo=Fr(ki.stretch-ie,ue,W,h.left),yo=ri(ki.fixed-He,lr,ki.stretch,At),Ja=Fr(mn.stretch-be,Se,q,h.top),wo=ri(mn.fixed-_r,un,mn.stretch,It),Ms=Fr(qi.stretch-ie,ue,W,h.left),Rs=ri(qi.fixed-He,lr,qi.stretch,At),Bl=Fr(Qa.stretch-be,Se,q,h.top),Vs=ri(Qa.fixed-_r,un,Qa.stretch,It),Nl=new c(Eo,Ja),Do=new c(Ms,Ja),Gs=new c(Ms,Bl),Ti=new c(Eo,Bl),Ta=new c(yo/D,wo/D),va=new c(Rs/D,Vs/D),Gi=p*Math.PI/180;if(Gi){var iu=Math.sin(Gi),dl=Math.cos(Gi),ja=[dl,-iu,iu,dl];Nl._matMult(ja),Do._matMult(ja),Ti._matMult(ja),Gs._matMult(ja)}var Jo=ki.stretch+ki.fixed,pl=mn.stretch+mn.fixed;return{tl:Nl,tr:Do,bl:Ti,br:Gs,tex:{x:L.paddedRect.x+1+Jo,y:L.paddedRect.y+1+pl,w:qi.stretch+qi.fixed-Jo,h:Qa.stretch+Qa.fixed-pl},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ta,pixelOffsetBR:va,minFontScaleX:lr/D/W,minFontScaleY:un/D/q,isSDF:m}};if(E&&(L.stretchX||L.stretchY))for(var $r=fe(Q,Wt,At),ui=fe(it,kt,It),On=0;On<$r.length-1;On++)for(var Qr=$r[On],mi=$r[On+1],qn=0;qn<ui.length-1;qn++)A.push(vn(Qr,ui[qn],mi,ui[qn+1]));else A.push(vn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:N+1},{fixed:0,stretch:V+1}));return A}function xe(h,p,m){for(var E=0,A=0,L=h;A<L.length;A+=1){var D=L[A];E+=Math.max(p,Math.min(m,D[1]))-Math.max(p,Math.min(m,D[0]))}return E}function fe(h,p,m){for(var E=[{fixed:-1,stretch:0}],A=0,L=h;A<L.length;A+=1){var D=L[A],N=D[0],V=D[1],W=E[E.length-1];E.push({fixed:N-W.stretch,stretch:W.stretch}),E.push({fixed:N-W.stretch,stretch:W.stretch+(V-N)})}return E.push({fixed:p+1,stretch:m}),E}function Fr(h,p,m,E){return h/p*m+E}function ri(h,p,m,E){return h-p*m/E}var pa=function(h,p,m,E,A,L,D,N,V,W){if(this.boxStartIndex=h.length,V){var q=L.top,Q=L.bottom,it=L.collisionPadding;it&&(q-=it[1],Q+=it[3]);var ut=Q-q;ut>0&&(ut=Math.max(10,ut),this.circleDiameter=ut)}else{var At=L.top*D-N,It=L.bottom*D+N,Wt=L.left*D-N,kt=L.right*D+N,ie=L.collisionPadding;if(ie&&(Wt-=ie[0]*D,At-=ie[1]*D,kt+=ie[2]*D,It+=ie[3]*D),W){var ue=new c(Wt,At),be=new c(kt,At),Se=new c(Wt,It),He=new c(kt,It),lr=W*Math.PI/180;ue._rotate(lr),be._rotate(lr),Se._rotate(lr),He._rotate(lr),Wt=Math.min(ue.x,be.x,Se.x,He.x),kt=Math.max(ue.x,be.x,Se.x,He.x),At=Math.min(ue.y,be.y,Se.y,He.y),It=Math.max(ue.y,be.y,Se.y,He.y)}h.emplaceBack(p.x,p.y,Wt,At,kt,It,m,E,A)}this.boxEndIndex=h.length},lt=function(h,p){if(h===void 0&&(h=[]),p===void 0&&(p=Ct),this.data=h,this.length=this.data.length,this.compare=p,this.length>0)for(var m=(this.length>>1)-1;m>=0;m--)this._down(m)};function Ct(h,p){return h<p?-1:h>p?1:0}function Nt(h,p,m){p===void 0&&(p=1),m===void 0&&(m=!1);for(var E=1/0,A=1/0,L=-1/0,D=-1/0,N=h[0],V=0;V<N.length;V++){var W=N[V];(!V||W.x<E)&&(E=W.x),(!V||W.y<A)&&(A=W.y),(!V||W.x>L)&&(L=W.x),(!V||W.y>D)&&(D=W.y)}var q=Math.min(L-E,D-A),Q=q/2,it=new lt([],pe);if(q===0)return new c(E,A);for(var ut=E;ut<L;ut+=q)for(var At=A;At<D;At+=q)it.push(new he(ut+Q,At+Q,Q,h));for(var It=function(ie){for(var ue=0,be=0,Se=0,He=ie[0],lr=0,_r=He.length,un=_r-1;lr<_r;un=lr++){var Br=He[lr],vn=He[un],$r=Br.x*vn.y-vn.x*Br.y;be+=(Br.x+vn.x)*$r,Se+=(Br.y+vn.y)*$r,ue+=3*$r}return new he(be/ue,Se/ue,0,ie)}(h),Wt=it.length;it.length;){var kt=it.pop();(kt.d>It.d||!It.d)&&(It=kt,m&&console.log("found best %d after %d probes",Math.round(1e4*kt.d)/1e4,Wt)),kt.max-It.d<=p||(it.push(new he(kt.p.x-(Q=kt.h/2),kt.p.y-Q,Q,h)),it.push(new he(kt.p.x+Q,kt.p.y-Q,Q,h)),it.push(new he(kt.p.x-Q,kt.p.y+Q,Q,h)),it.push(new he(kt.p.x+Q,kt.p.y+Q,Q,h)),Wt+=4)}return m&&(console.log("num probes: "+Wt),console.log("best distance: "+It.d)),It.p}function pe(h,p){return p.max-h.max}function he(h,p,m,E){this.p=new c(h,p),this.h=m,this.d=function(A,L){for(var D=!1,N=1/0,V=0;V<L.length;V++)for(var W=L[V],q=0,Q=W.length,it=Q-1;q<Q;it=q++){var ut=W[q],At=W[it];ut.y>A.y!=At.y>A.y&&A.x<(At.x-ut.x)*(A.y-ut.y)/(At.y-ut.y)+ut.x&&(D=!D),N=Math.min(N,Cf(A,ut,At))}return(D?1:-1)*Math.sqrt(N)}(this.p,E),this.max=this.d+this.h*Math.SQRT2}lt.prototype.push=function(h){this.data.push(h),this.length++,this._up(this.length-1)},lt.prototype.pop=function(){if(this.length!==0){var h=this.data[0],p=this.data.pop();return this.length--,this.length>0&&(this.data[0]=p,this._down(0)),h}},lt.prototype.peek=function(){return this.data[0]},lt.prototype._up=function(h){for(var p=this.data,m=this.compare,E=p[h];h>0;){var A=h-1>>1,L=p[A];if(m(E,L)>=0)break;p[h]=L,h=A}p[h]=E},lt.prototype._down=function(h){for(var p=this.data,m=this.compare,E=this.length>>1,A=p[h];h<E;){var L=1+(h<<1),D=p[L],N=L+1;if(N<this.length&&m(p[N],D)<0&&(L=N,D=p[N]),m(D,A)>=0)break;p[h]=D,h=L}p[h]=A};var Vt=Number.POSITIVE_INFINITY;function Zt(h,p){return p[1]!==Vt?function(m,E,A){var L=0,D=0;switch(E=Math.abs(E),A=Math.abs(A),m){case"top-right":case"top-left":case"top":D=A-7;break;case"bottom-right":case"bottom-left":case"bottom":D=7-A}switch(m){case"top-right":case"bottom-right":case"right":L=-E;break;case"top-left":case"bottom-left":case"left":L=E}return[L,D]}(h,p[0],p[1]):function(m,E){var A=0,L=0;E<0&&(E=0);var D=E/Math.sqrt(2);switch(m){case"top-right":case"top-left":L=D-7;break;case"bottom-right":case"bottom-left":L=7-D;break;case"bottom":L=7-E;break;case"top":L=E-7}switch(m){case"top-right":case"bottom-right":A=-D;break;case"top-left":case"bottom-left":A=D;break;case"left":A=E;break;case"right":A=-E}return[A,L]}(h,p[0])}function te(h){switch(h){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ot(h,p,m,E,A,L,D,N,V,W,q,Q,it,ut,At){var It=function(be,Se,He,lr,_r,un,Br,vn){for(var $r=lr.layout.get("text-rotate").evaluate(un,{})*Math.PI/180,ui=[],On=0,Qr=Se.positionedLines;On<Qr.length;On+=1)for(var mi=Qr[On],qn=0,ki=mi.positionedGlyphs;qn<ki.length;qn+=1){var mn=ki[qn];if(mn.rect){var qi=mn.rect||{},Qa=4,Eo=!0,yo=1,Ja=0,wo=(_r||vn)&&mn.vertical,Ms=mn.metrics.advance*mn.scale/2;if(vn&&Se.verticalizable&&(Ja=mi.lineOffset/2-(mn.imageName?-(24-mn.metrics.width*mn.scale)/2:24*(mn.scale-1))),mn.imageName){var Rs=Br[mn.imageName];Eo=Rs.sdf,Qa=1/(yo=Rs.pixelRatio)}var Bl=_r?[mn.x+Ms,mn.y]:[0,0],Vs=_r?[0,0]:[mn.x+Ms+He[0],mn.y+He[1]-Ja],Nl=[0,0];wo&&(Nl=Vs,Vs=[0,0]);var Do=(mn.metrics.left-Qa)*mn.scale-Ms+Vs[0],Gs=(-mn.metrics.top-Qa)*mn.scale+Vs[1],Ti=Do+qi.w*mn.scale/yo,Ta=Gs+qi.h*mn.scale/yo,va=new c(Do,Gs),Gi=new c(Ti,Gs),iu=new c(Do,Ta),dl=new c(Ti,Ta);if(wo){var ja=new c(-Ms,Ms- -17),Jo=-Math.PI/2,pl=12-Ms,Ki=new c(22-pl,-(mn.imageName?pl:0)),Ap=new(Function.prototype.bind.apply(c,[null].concat(Nl)));va._rotateAround(Jo,ja)._add(Ki)._add(Ap),Gi._rotateAround(Jo,ja)._add(Ki)._add(Ap),iu._rotateAround(Jo,ja)._add(Ki)._add(Ap),dl._rotateAround(Jo,ja)._add(Ki)._add(Ap)}if($r){var Ic=Math.sin($r),Mp=Math.cos($r),Fo=[Mp,-Ic,Ic,Mp];va._matMult(Fo),Gi._matMult(Fo),iu._matMult(Fo),dl._matMult(Fo)}var Rp=new c(0,0),Mf=new c(0,0);ui.push({tl:va,tr:Gi,bl:iu,br:dl,tex:qi,writingMode:Se.writingMode,glyphOffset:Bl,sectionIndex:mn.sectionIndex,isSDF:Eo,pixelOffsetTL:Rp,pixelOffsetBR:Mf,minFontScaleX:0,minFontScaleY:0})}}return ui}(0,m,N,A,L,D,E,h.allowVerticalPlacement),Wt=h.textSizeData,kt=null;Wt.kind==="source"?(kt=[128*A.layout.get("text-size").evaluate(D,{})])[0]>32640&&at(h.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):Wt.kind==="composite"&&((kt=[128*ut.compositeTextSizes[0].evaluate(D,{},At),128*ut.compositeTextSizes[1].evaluate(D,{},At)])[0]>32640||kt[1]>32640)&&at(h.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),h.addSymbols(h.text,It,kt,N,L,D,W,p,V.lineStartIndex,V.lineLength,it,At);for(var ie=0,ue=q;ie<ue.length;ie+=1)Q[ue[ie]]=h.text.placedSymbolArray.length-1;return 4*It.length}function Xt(h){for(var p in h)return h[p];return null}function bt(h,p,m,E){var A=h.compareText;if(p in A){for(var L=A[p],D=L.length-1;D>=0;D--)if(E.dist(L[D])<m)return!0}else A[p]=[];return A[p].push(E),!1}var Yt=Tp.VectorTileFeature.types,Ee=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Le(h,p,m,E,A,L,D,N,V,W,q,Q,it){var ut=N?Math.min(32640,Math.round(N[0])):0,At=N?Math.min(32640,Math.round(N[1])):0;h.emplaceBack(p,m,Math.round(32*E),Math.round(32*A),L,D,(ut<<1)+(V?1:0),At,16*W,16*q,256*Q,256*it)}function Ye(h,p,m){h.emplaceBack(p.x,p.y,m),h.emplaceBack(p.x,p.y,m),h.emplaceBack(p.x,p.y,m),h.emplaceBack(p.x,p.y,m)}function Ve(h){for(var p=0,m=h.sections;p<m.length;p+=1)if(Kg(m[p].text))return!0;return!1}var Je=function(h){this.layoutVertexArray=new em,this.indexArray=new Sc,this.programConfigurations=h,this.segments=new dt,this.dynamicLayoutVertexArray=new yp,this.opacityVertexArray=new Lv,this.placedSymbolArray=new C};Je.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Je.prototype.upload=function(h,p,m,E){this.isEmpty()||(m&&(this.layoutVertexBuffer=h.createVertexBuffer(this.layoutVertexArray,WL.members),this.indexBuffer=h.createIndexBuffer(this.indexArray,p),this.dynamicLayoutVertexBuffer=h.createVertexBuffer(this.dynamicLayoutVertexArray,XL.members,!0),this.opacityVertexBuffer=h.createVertexBuffer(this.opacityVertexArray,Ee,!0),this.opacityVertexBuffer.itemSize=1),(m||E)&&this.programConfigurations.upload(h))},Je.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Xr("SymbolBuffers",Je);var rn=function(h,p,m){this.layoutVertexArray=new h,this.layoutAttributes=p,this.indexArray=new m,this.segments=new dt,this.collisionVertexArray=new J0};rn.prototype.upload=function(h){this.layoutVertexBuffer=h.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=h.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=h.createVertexBuffer(this.collisionVertexArray,eT.members,!0)},rn.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Xr("CollisionBuffers",rn);var jr=function(h){this.collisionBoxArray=h.collisionBoxArray,this.zoom=h.zoom,this.overscaling=h.overscaling,this.layers=h.layers,this.layerIds=this.layers.map(function(L){return L.id}),this.index=h.index,this.pixelRatio=h.pixelRatio,this.sourceLayerIndex=h.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ps([]),this.placementViewportMatrix=ps([]);var p=this.layers[0]._unevaluatedLayout._values;this.textSizeData=vs(this.zoom,p["text-size"]),this.iconSizeData=vs(this.zoom,p["icon-size"]);var m=this.layers[0].layout,E=m.get("symbol-sort-key"),A=m.get("symbol-z-order");this.canOverlap=m.get("text-allow-overlap")||m.get("icon-allow-overlap")||m.get("text-ignore-placement")||m.get("icon-ignore-placement"),this.sortFeaturesByKey=A!=="viewport-y"&&E.constantOr(1)!==void 0,this.sortFeaturesByY=(A==="viewport-y"||A==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,m.get("symbol-placement")==="point"&&(this.writingModes=m.get("text-writing-mode").map(function(L){return pn[L]})),this.stateDependentLayerIds=this.layers.filter(function(L){return L.isStateDependent()}).map(function(L){return L.id}),this.sourceID=h.sourceID};jr.prototype.createArrays=function(){this.text=new Je(new En(this.layers,this.zoom,function(h){return/^text/.test(h)})),this.icon=new Je(new En(this.layers,this.zoom,function(h){return/^icon/.test(h)})),this.glyphOffsetArray=new B,this.lineVertexArray=new H,this.symbolInstances=new F},jr.prototype.calculateGlyphDependencies=function(h,p,m,E,A){for(var L=0;L<h.length;L++)if(p[h.charCodeAt(L)]=!0,(m||E)&&A){var D=Bt[h.charAt(L)];D&&(p[D.charCodeAt(0)]=!0)}},jr.prototype.populate=function(h,p,m){var E=this.layers[0],A=E.layout,L=A.get("text-font"),D=A.get("text-field"),N=A.get("icon-image"),V=(D.value.kind!=="constant"||D.value.value instanceof ao&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&(L.value.kind!=="constant"||L.value.value.length>0),W=N.value.kind!=="constant"||!!N.value.value||Object.keys(N.parameters).length>0,q=A.get("symbol-sort-key");if(this.features=[],V||W){for(var Q=p.iconDependencies,it=p.glyphDependencies,ut=p.availableImages,At=new Wn(this.zoom),It=0,Wt=h;It<Wt.length;It+=1){var kt=Wt[It],ie=kt.feature,ue=kt.id,be=kt.index,Se=kt.sourceLayerIndex,He=E._featureFilter.needGeometry,lr=qa(ie,He);if(E._featureFilter.filter(At,lr,m)){He||(lr.geometry=Xa(ie));var _r=void 0;if(V){var un=E.getValueAndResolveTokens("text-field",lr,m,ut),Br=ao.factory(un);Ve(Br)&&(this.hasRTLText=!0),(!this.hasRTLText||K0()==="unavailable"||this.hasRTLText&&eu.isParsed())&&(_r=_t(Br,E,lr))}var vn=void 0;if(W){var $r=E.getValueAndResolveTokens("icon-image",lr,m,ut);vn=$r instanceof Fa?$r:Fa.fromString($r)}if(_r||vn){var ui=this.sortFeaturesByKey?q.evaluate(lr,{},m):void 0;if(this.features.push({id:ue,text:_r,icon:vn,index:be,sourceLayerIndex:Se,geometry:lr.geometry,properties:ie.properties,type:Yt[ie.type],sortKey:ui}),vn&&(Q[vn.name]=!0),_r){var On=L.evaluate(lr,{},m).join(","),Qr=A.get("text-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(pn.vertical)>=0;for(var mi=0,qn=_r.sections;mi<qn.length;mi+=1){var ki=qn[mi];if(ki.image)Q[ki.image.name]=!0;else{var mn=Ch(_r.toString()),qi=ki.fontStack||On,Qa=it[qi]=it[qi]||{};this.calculateGlyphDependencies(ki.text,Qa,Qr,this.allowVerticalPlacement,mn)}}}}}}A.get("symbol-placement")==="line"&&(this.features=function(Eo){var yo={},Ja={},wo=[],Ms=0;function Rs(ja){wo.push(Eo[ja]),Ms++}function Bl(ja,Jo,pl){var Ki=Ja[ja];return delete Ja[ja],Ja[Jo]=Ki,wo[Ki].geometry[0].pop(),wo[Ki].geometry[0]=wo[Ki].geometry[0].concat(pl[0]),Ki}function Vs(ja,Jo,pl){var Ki=yo[Jo];return delete yo[Jo],yo[ja]=Ki,wo[Ki].geometry[0].shift(),wo[Ki].geometry[0]=pl[0].concat(wo[Ki].geometry[0]),Ki}function Nl(ja,Jo,pl){var Ki=pl?Jo[0][Jo[0].length-1]:Jo[0][0];return ja+":"+Ki.x+":"+Ki.y}for(var Do=0;Do<Eo.length;Do++){var Gs=Eo[Do],Ti=Gs.geometry,Ta=Gs.text?Gs.text.toString():null;if(Ta){var va=Nl(Ta,Ti),Gi=Nl(Ta,Ti,!0);if(va in Ja&&Gi in yo&&Ja[va]!==yo[Gi]){var iu=Vs(va,Gi,Ti),dl=Bl(va,Gi,wo[iu].geometry);delete yo[va],delete Ja[Gi],Ja[Nl(Ta,wo[dl].geometry,!0)]=dl,wo[iu].geometry=null}else va in Ja?Bl(va,Gi,Ti):Gi in yo?Vs(va,Gi,Ti):(Rs(Do),yo[va]=Ms-1,Ja[Gi]=Ms-1)}else Rs(Do)}return wo.filter(function(ja){return ja.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Eo,yo){return Eo.sortKey-yo.sortKey})}},jr.prototype.update=function(h,p,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(h,p,this.layers,m),this.icon.programConfigurations.updatePaintArrays(h,p,this.layers,m))},jr.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},jr.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},jr.prototype.upload=function(h){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(h),this.iconCollisionBox.upload(h)),this.text.upload(h,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(h,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},jr.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},jr.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},jr.prototype.addToLineVertexArray=function(h,p){var m=this.lineVertexArray.length;if(h.segment!==void 0){for(var E=h.dist(p[h.segment+1]),A=h.dist(p[h.segment]),L={},D=h.segment+1;D<p.length;D++)L[D]={x:p[D].x,y:p[D].y,tileUnitDistanceFromAnchor:E},D<p.length-1&&(E+=p[D+1].dist(p[D]));for(var N=h.segment||0;N>=0;N--)L[N]={x:p[N].x,y:p[N].y,tileUnitDistanceFromAnchor:A},N>0&&(A+=p[N-1].dist(p[N]));for(var V=0;V<p.length;V++){var W=L[V];this.lineVertexArray.emplaceBack(W.x,W.y,W.tileUnitDistanceFromAnchor)}}return{lineStartIndex:m,lineLength:this.lineVertexArray.length-m}},jr.prototype.addSymbols=function(h,p,m,E,A,L,D,N,V,W,q,Q){for(var it=h.indexArray,ut=h.layoutVertexArray,At=h.segments.prepareSegment(4*p.length,ut,it,this.canOverlap?L.sortKey:void 0),It=this.glyphOffsetArray.length,Wt=At.vertexLength,kt=this.allowVerticalPlacement&&D===pn.vertical?Math.PI/2:0,ie=L.text&&L.text.sections,ue=0;ue<p.length;ue++){var be=p[ue],Se=be.tl,He=be.tr,lr=be.bl,_r=be.br,un=be.tex,Br=be.pixelOffsetTL,vn=be.pixelOffsetBR,$r=be.minFontScaleX,ui=be.minFontScaleY,On=be.glyphOffset,Qr=be.isSDF,mi=be.sectionIndex,qn=At.vertexLength,ki=On[1];Le(ut,N.x,N.y,Se.x,ki+Se.y,un.x,un.y,m,Qr,Br.x,Br.y,$r,ui),Le(ut,N.x,N.y,He.x,ki+He.y,un.x+un.w,un.y,m,Qr,vn.x,Br.y,$r,ui),Le(ut,N.x,N.y,lr.x,ki+lr.y,un.x,un.y+un.h,m,Qr,Br.x,vn.y,$r,ui),Le(ut,N.x,N.y,_r.x,ki+_r.y,un.x+un.w,un.y+un.h,m,Qr,vn.x,vn.y,$r,ui),Ye(h.dynamicLayoutVertexArray,N,kt),it.emplaceBack(qn,qn+1,qn+2),it.emplaceBack(qn+1,qn+2,qn+3),At.vertexLength+=4,At.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(On[0]),ue!==p.length-1&&mi===p[ue+1].sectionIndex||h.programConfigurations.populatePaintArrays(ut.length,L,L.index,{},Q,ie&&ie[mi])}h.placedSymbolArray.emplaceBack(N.x,N.y,It,this.glyphOffsetArray.length-It,Wt,V,W,N.segment,m?m[0]:0,m?m[1]:0,E[0],E[1],D,0,!1,0,q)},jr.prototype._addCollisionDebugVertex=function(h,p,m,E,A,L){return p.emplaceBack(0,0),h.emplaceBack(m.x,m.y,E,A,Math.round(L.x),Math.round(L.y))},jr.prototype.addCollisionDebugVertices=function(h,p,m,E,A,L,D){var N=A.segments.prepareSegment(4,A.layoutVertexArray,A.indexArray),V=N.vertexLength,W=A.layoutVertexArray,q=A.collisionVertexArray,Q=D.anchorX,it=D.anchorY;this._addCollisionDebugVertex(W,q,L,Q,it,new c(h,p)),this._addCollisionDebugVertex(W,q,L,Q,it,new c(m,p)),this._addCollisionDebugVertex(W,q,L,Q,it,new c(m,E)),this._addCollisionDebugVertex(W,q,L,Q,it,new c(h,E)),N.vertexLength+=4;var ut=A.indexArray;ut.emplaceBack(V,V+1),ut.emplaceBack(V+1,V+2),ut.emplaceBack(V+2,V+3),ut.emplaceBack(V+3,V),N.primitiveLength+=4},jr.prototype.addDebugCollisionBoxes=function(h,p,m,E){for(var A=h;A<p;A++){var L=this.collisionBoxArray.get(A);this.addCollisionDebugVertices(L.x1,L.y1,L.x2,L.y2,E?this.textCollisionBox:this.iconCollisionBox,L.anchorPoint,m)}},jr.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new rn(yd,rT.members,Ov),this.iconCollisionBox=new rn(yd,rT.members,Ov);for(var h=0;h<this.symbolInstances.length;h++){var p=this.symbolInstances.get(h);this.addDebugCollisionBoxes(p.textBoxStartIndex,p.textBoxEndIndex,p,!0),this.addDebugCollisionBoxes(p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p,!0),this.addDebugCollisionBoxes(p.iconBoxStartIndex,p.iconBoxEndIndex,p,!1),this.addDebugCollisionBoxes(p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p,!1)}},jr.prototype._deserializeCollisionBoxesForSymbol=function(h,p,m,E,A,L,D,N,V){for(var W={},q=p;q<m;q++){var Q=h.get(q);W.textBox={x1:Q.x1,y1:Q.y1,x2:Q.x2,y2:Q.y2,anchorPointX:Q.anchorPointX,anchorPointY:Q.anchorPointY},W.textFeatureIndex=Q.featureIndex;break}for(var it=E;it<A;it++){var ut=h.get(it);W.verticalTextBox={x1:ut.x1,y1:ut.y1,x2:ut.x2,y2:ut.y2,anchorPointX:ut.anchorPointX,anchorPointY:ut.anchorPointY},W.verticalTextFeatureIndex=ut.featureIndex;break}for(var At=L;At<D;At++){var It=h.get(At);W.iconBox={x1:It.x1,y1:It.y1,x2:It.x2,y2:It.y2,anchorPointX:It.anchorPointX,anchorPointY:It.anchorPointY},W.iconFeatureIndex=It.featureIndex;break}for(var Wt=N;Wt<V;Wt++){var kt=h.get(Wt);W.verticalIconBox={x1:kt.x1,y1:kt.y1,x2:kt.x2,y2:kt.y2,anchorPointX:kt.anchorPointX,anchorPointY:kt.anchorPointY},W.verticalIconFeatureIndex=kt.featureIndex;break}return W},jr.prototype.deserializeCollisionBoxes=function(h){this.collisionArrays=[];for(var p=0;p<this.symbolInstances.length;p++){var m=this.symbolInstances.get(p);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(h,m.textBoxStartIndex,m.textBoxEndIndex,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m.iconBoxStartIndex,m.iconBoxEndIndex,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex))}},jr.prototype.hasTextData=function(){return this.text.segments.get().length>0},jr.prototype.hasIconData=function(){return this.icon.segments.get().length>0},jr.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},jr.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},jr.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},jr.prototype.addIndicesForPlacedSymbol=function(h,p){for(var m=h.placedSymbolArray.get(p),E=m.vertexStartIndex+4*m.numGlyphs,A=m.vertexStartIndex;A<E;A+=4)h.indexArray.emplaceBack(A,A+1,A+2),h.indexArray.emplaceBack(A+1,A+2,A+3)},jr.prototype.getSortedSymbolIndexes=function(h){if(this.sortedAngle===h&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var p=Math.sin(h),m=Math.cos(h),E=[],A=[],L=[],D=0;D<this.symbolInstances.length;++D){L.push(D);var N=this.symbolInstances.get(D);E.push(0|Math.round(p*N.anchorX+m*N.anchorY)),A.push(N.featureIndex)}return L.sort(function(V,W){return E[V]-E[W]||A[W]-A[V]}),L},jr.prototype.addToSortKeyRanges=function(h,p){var m=this.sortKeyRanges[this.sortKeyRanges.length-1];m&&m.sortKey===p?m.symbolInstanceEnd=h+1:this.sortKeyRanges.push({sortKey:p,symbolInstanceStart:h,symbolInstanceEnd:h+1})},jr.prototype.sortFeatures=function(h){var p=this;if(this.sortFeaturesByY&&this.sortedAngle!==h&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(h),this.sortedAngle=h,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var m=0,E=this.symbolInstanceIndexes;m<E.length;m+=1){var A=this.symbolInstances.get(E[m]);this.featureSortOrder.push(A.featureIndex),[A.rightJustifiedTextSymbolIndex,A.centerJustifiedTextSymbolIndex,A.leftJustifiedTextSymbolIndex].forEach(function(L,D,N){L>=0&&N.indexOf(L)===D&&p.addIndicesForPlacedSymbol(p.text,L)}),A.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,A.verticalPlacedTextSymbolIndex),A.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,A.placedIconSymbolIndex),A.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,A.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Xr("SymbolBucket",jr,{omit:["layers","collisionBoxArray","features","compareText"]}),jr.MAX_GLYPHS=65535,jr.addDynamicAttributes=Ye;var Kr=new Wa({"symbol-placement":new sn(ht.layout_symbol["symbol-placement"]),"symbol-spacing":new sn(ht.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new sn(ht.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new qr(ht.layout_symbol["symbol-sort-key"]),"symbol-z-order":new sn(ht.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new sn(ht.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new sn(ht.layout_symbol["icon-ignore-placement"]),"icon-optional":new sn(ht.layout_symbol["icon-optional"]),"icon-rotation-alignment":new sn(ht.layout_symbol["icon-rotation-alignment"]),"icon-size":new qr(ht.layout_symbol["icon-size"]),"icon-text-fit":new sn(ht.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new sn(ht.layout_symbol["icon-text-fit-padding"]),"icon-image":new qr(ht.layout_symbol["icon-image"]),"icon-rotate":new qr(ht.layout_symbol["icon-rotate"]),"icon-padding":new sn(ht.layout_symbol["icon-padding"]),"icon-keep-upright":new sn(ht.layout_symbol["icon-keep-upright"]),"icon-offset":new qr(ht.layout_symbol["icon-offset"]),"icon-anchor":new qr(ht.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new sn(ht.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new sn(ht.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new sn(ht.layout_symbol["text-rotation-alignment"]),"text-field":new qr(ht.layout_symbol["text-field"]),"text-font":new qr(ht.layout_symbol["text-font"]),"text-size":new qr(ht.layout_symbol["text-size"]),"text-max-width":new qr(ht.layout_symbol["text-max-width"]),"text-line-height":new sn(ht.layout_symbol["text-line-height"]),"text-letter-spacing":new qr(ht.layout_symbol["text-letter-spacing"]),"text-justify":new qr(ht.layout_symbol["text-justify"]),"text-radial-offset":new qr(ht.layout_symbol["text-radial-offset"]),"text-variable-anchor":new sn(ht.layout_symbol["text-variable-anchor"]),"text-anchor":new qr(ht.layout_symbol["text-anchor"]),"text-max-angle":new sn(ht.layout_symbol["text-max-angle"]),"text-writing-mode":new sn(ht.layout_symbol["text-writing-mode"]),"text-rotate":new qr(ht.layout_symbol["text-rotate"]),"text-padding":new sn(ht.layout_symbol["text-padding"]),"text-keep-upright":new sn(ht.layout_symbol["text-keep-upright"]),"text-transform":new qr(ht.layout_symbol["text-transform"]),"text-offset":new qr(ht.layout_symbol["text-offset"]),"text-allow-overlap":new sn(ht.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new sn(ht.layout_symbol["text-ignore-placement"]),"text-optional":new sn(ht.layout_symbol["text-optional"])}),Cn={paint:new Wa({"icon-opacity":new qr(ht.paint_symbol["icon-opacity"]),"icon-color":new qr(ht.paint_symbol["icon-color"]),"icon-halo-color":new qr(ht.paint_symbol["icon-halo-color"]),"icon-halo-width":new qr(ht.paint_symbol["icon-halo-width"]),"icon-halo-blur":new qr(ht.paint_symbol["icon-halo-blur"]),"icon-translate":new sn(ht.paint_symbol["icon-translate"]),"icon-translate-anchor":new sn(ht.paint_symbol["icon-translate-anchor"]),"text-opacity":new qr(ht.paint_symbol["text-opacity"]),"text-color":new qr(ht.paint_symbol["text-color"],{runtimeType:mr,getOverride:function(h){return h.textColor},hasOverride:function(h){return!!h.textColor}}),"text-halo-color":new qr(ht.paint_symbol["text-halo-color"]),"text-halo-width":new qr(ht.paint_symbol["text-halo-width"]),"text-halo-blur":new qr(ht.paint_symbol["text-halo-blur"]),"text-translate":new sn(ht.paint_symbol["text-translate"]),"text-translate-anchor":new sn(ht.paint_symbol["text-translate-anchor"])}),layout:Kr},Fn=function(h){this.type=h.property.overrides?h.property.overrides.runtimeType:Hr,this.defaultValue=h};Fn.prototype.evaluate=function(h){if(h.formattedSection){var p=this.defaultValue.property.overrides;if(p&&p.hasOverride(h.formattedSection))return p.getOverride(h.formattedSection)}return h.feature&&h.featureState?this.defaultValue.evaluate(h.feature,h.featureState):this.defaultValue.property.specification.default},Fn.prototype.eachChild=function(h){this.defaultValue.isConstant()||h(this.defaultValue.value._styleExpression.expression)},Fn.prototype.outputDefined=function(){return!1},Fn.prototype.serialize=function(){return null},Xr("FormatSectionOverride",Fn,{omit:["defaultValue"]});var Zi=function(h){function p(m){h.call(this,m,Cn)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype.recalculate=function(m,E){if(h.prototype.recalculate.call(this,m,E),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var A=this.layout.get("text-writing-mode");if(A){for(var L=[],D=0,N=A;D<N.length;D+=1){var V=N[D];L.indexOf(V)<0&&L.push(V)}this.layout._values["text-writing-mode"]=L}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},p.prototype.getValueAndResolveTokens=function(m,E,A,L){var D=this.layout.get(m).evaluate(E,{},A,L),N=this._unevaluatedLayout._values[m];return N.isDataDriven()||fd(N.value)||!D?D:function(V,W){return W.replace(/{([^{}]+)}/g,function(q,Q){return Q in V?String(V[Q]):""})}(E.properties,D)},p.prototype.createBucket=function(m){return new jr(m)},p.prototype.queryRadius=function(){return 0},p.prototype.queryIntersectsFeature=function(){return!1},p.prototype._setPaintOverrides=function(){for(var m=0,E=Cn.paint.overridableProperties;m<E.length;m+=1){var A=E[m];if(p.hasPaintOverride(this.layout,A)){var L,D=this.paint.get(A),N=new Fn(D),V=new vf(N,D.property.specification);L=D.value.kind==="constant"||D.value.kind==="source"?new dd("source",V):new pd("composite",V,D.value.zoomStops,D.value._interpolationType),this.paint._values[A]=new ks(D.property,L,D.parameters)}}},p.prototype._handleOverridablePaintPropertyUpdate=function(m,E,A){return!(!this.layout||E.isDataDriven()||A.isDataDriven())&&p.hasPaintOverride(this.layout,m)},p.hasPaintOverride=function(m,E){var A=m.get("text-field"),L=Cn.paint.properties[E],D=!1,N=function(q){for(var Q=0,it=q;Q<it.length;Q+=1)if(L.overrides&&L.overrides.hasOverride(it[Q]))return void(D=!0)};if(A.value.kind==="constant"&&A.value.value instanceof ao)N(A.value.value.sections);else if(A.value.kind==="source"){var V=function(q){D||(q instanceof Vo&&Ra(q.value)===na?N(q.value.sections):q instanceof js?N(q.sections):q.eachChild(V))},W=A.value;W._styleExpression&&V(W._styleExpression.expression)}return D},p}(Tu),Qo={paint:new Wa({"background-color":new sn(ht.paint_background["background-color"]),"background-pattern":new zs(ht.paint_background["background-pattern"]),"background-opacity":new sn(ht.paint_background["background-opacity"])})},Lh=function(h){function p(m){h.call(this,m,Qo)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p}(Tu),xE={paint:new Wa({"raster-opacity":new sn(ht.paint_raster["raster-opacity"]),"raster-hue-rotate":new sn(ht.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new sn(ht.paint_raster["raster-brightness-min"]),"raster-brightness-max":new sn(ht.paint_raster["raster-brightness-max"]),"raster-saturation":new sn(ht.paint_raster["raster-saturation"]),"raster-contrast":new sn(ht.paint_raster["raster-contrast"]),"raster-resampling":new sn(ht.paint_raster["raster-resampling"]),"raster-fade-duration":new sn(ht.paint_raster["raster-fade-duration"])})},Rc=function(h){function p(m){h.call(this,m,xE)}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p}(Tu),nT=function(h){function p(m){h.call(this,m,{}),this.implementation=m}return h&&(p.__proto__=h),(p.prototype=Object.create(h&&h.prototype)).constructor=p,p.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},p.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},p.prototype.recalculate=function(){},p.prototype.updateTransitions=function(){},p.prototype.hasTransition=function(){},p.prototype.serialize=function(){},p.prototype.onAdd=function(m){this.implementation.onAdd&&this.implementation.onAdd(m,m.painter.context.gl)},p.prototype.onRemove=function(m){this.implementation.onRemove&&this.implementation.onRemove(m,m.painter.context.gl)},p}(Tu),Sd={circle:ey,heatmap:lm,hillshade:OL,fill:W2,"fill-extrusion":Z2,line:tT,symbol:Zi,background:Lh,raster:Rc},bE=d.HTMLImageElement,j8=d.HTMLCanvasElement,Y8=d.HTMLVideoElement,Z8=d.ImageData,iT=d.ImageBitmap,iy=function(h,p,m,E){this.context=h,this.format=m,this.texture=h.gl.createTexture(),this.update(p,E)};iy.prototype.update=function(h,p,m){var E=h.width,A=h.height,L=!(this.size&&this.size[0]===E&&this.size[1]===A||m),D=this.context,N=D.gl;if(this.useMipmap=!!(p&&p.useMipmap),N.bindTexture(N.TEXTURE_2D,this.texture),D.pixelStoreUnpackFlipY.set(!1),D.pixelStoreUnpack.set(1),D.pixelStoreUnpackPremultiplyAlpha.set(this.format===N.RGBA&&(!p||p.premultiply!==!1)),L)this.size=[E,A],h instanceof bE||h instanceof j8||h instanceof Y8||h instanceof Z8||iT&&h instanceof iT?N.texImage2D(N.TEXTURE_2D,0,this.format,this.format,N.UNSIGNED_BYTE,h):N.texImage2D(N.TEXTURE_2D,0,this.format,E,A,0,this.format,N.UNSIGNED_BYTE,h.data);else{var V=m||{x:0,y:0},W=V.x,q=V.y;h instanceof bE||h instanceof j8||h instanceof Y8||h instanceof Z8||iT&&h instanceof iT?N.texSubImage2D(N.TEXTURE_2D,0,W,q,N.RGBA,N.UNSIGNED_BYTE,h):N.texSubImage2D(N.TEXTURE_2D,0,W,q,E,A,N.RGBA,N.UNSIGNED_BYTE,h.data)}this.useMipmap&&this.isSizePowerOfTwo()&&N.generateMipmap(N.TEXTURE_2D)},iy.prototype.bind=function(h,p,m){var E=this.context.gl;E.bindTexture(E.TEXTURE_2D,this.texture),m!==E.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(m=E.LINEAR),h!==this.filter&&(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,h),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,m||h),this.filter=h),p!==this.wrap&&(E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,p),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,p),this.wrap=p)},iy.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},iy.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var jL=function(h){var p=this;this._callback=h,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){p._triggered=!1,p._callback()})};jL.prototype.trigger=function(){var h=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){h._triggered=!1,h._callback()},0))},jL.prototype.remove=function(){delete this._channel,this._callback=function(){}};var g1=function(h,p,m){this.target=h,this.parent=p,this.mapId=m,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},z(["receive","process"],this),this.invoker=new jL(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=vt()?h:d};function q8(h,p,m){var E=2*Math.PI*6378137/256/Math.pow(2,m);return[h*E-2*Math.PI*6378137/2,p*E-2*Math.PI*6378137/2]}g1.prototype.send=function(h,p,m,E,A){var L=this;A===void 0&&(A=!1);var D=Math.round(1e18*Math.random()).toString(36).substring(0,10);m&&(this.callbacks[D]=m);var N=Qt(this.globalScope)?void 0:[];return this.target.postMessage({id:D,type:h,hasCallback:!!m,targetMapId:E,mustQueue:A,sourceMapId:this.mapId,data:Ys(p,N)},N),{cancel:function(){m&&delete L.callbacks[D],L.target.postMessage({id:D,type:"<cancel>",targetMapId:E,sourceMapId:L.mapId})}}},g1.prototype.receive=function(h){var p=h.data,m=p.id;if(m&&(!p.targetMapId||this.mapId===p.targetMapId))if(p.type==="<cancel>"){delete this.tasks[m];var E=this.cancelCallbacks[m];delete this.cancelCallbacks[m],E&&E()}else vt()||p.mustQueue?(this.tasks[m]=p,this.taskQueue.push(m),this.invoker.trigger()):this.processTask(m,p)},g1.prototype.process=function(){if(this.taskQueue.length){var h=this.taskQueue.shift(),p=this.tasks[h];delete this.tasks[h],this.taskQueue.length&&this.invoker.trigger(),p&&this.processTask(h,p)}},g1.prototype.processTask=function(h,p){var m=this;if(p.type==="<response>"){var E=this.callbacks[h];delete this.callbacks[h],E&&(p.error?E(da(p.error)):E(null,da(p.data)))}else{var A=!1,L=Qt(this.globalScope)?void 0:[],D=p.hasCallback?function(q,Q){A=!0,delete m.cancelCallbacks[h],m.target.postMessage({id:h,type:"<response>",sourceMapId:m.mapId,error:q?Ys(q):null,data:Ys(Q,L)},L)}:function(q){A=!0},N=null,V=da(p.data);if(this.parent[p.type])N=this.parent[p.type](p.sourceMapId,V,D);else if(this.parent.getWorkerSource){var W=p.type.split(".");N=this.parent.getWorkerSource(p.sourceMapId,W[0],V.source)[W[1]](V,D)}else D(new Error("Could not find function "+p.type));!A&&N&&N.cancel&&(this.cancelCallbacks[h]=N.cancel)}},g1.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var gs=function(h,p){h&&(p?this.setSouthWest(h).setNorthEast(p):h.length===4?this.setSouthWest([h[0],h[1]]).setNorthEast([h[2],h[3]]):this.setSouthWest(h[0]).setNorthEast(h[1]))};gs.prototype.setNorthEast=function(h){return this._ne=h instanceof Ka?new Ka(h.lng,h.lat):Ka.convert(h),this},gs.prototype.setSouthWest=function(h){return this._sw=h instanceof Ka?new Ka(h.lng,h.lat):Ka.convert(h),this},gs.prototype.extend=function(h){var p,m,E=this._sw,A=this._ne;if(h instanceof Ka)p=h,m=h;else{if(!(h instanceof gs))return Array.isArray(h)?h.length===4||h.every(Array.isArray)?this.extend(gs.convert(h)):this.extend(Ka.convert(h)):this;if(m=h._ne,!(p=h._sw)||!m)return this}return E||A?(E.lng=Math.min(p.lng,E.lng),E.lat=Math.min(p.lat,E.lat),A.lng=Math.max(m.lng,A.lng),A.lat=Math.max(m.lat,A.lat)):(this._sw=new Ka(p.lng,p.lat),this._ne=new Ka(m.lng,m.lat)),this},gs.prototype.getCenter=function(){return new Ka((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},gs.prototype.getSouthWest=function(){return this._sw},gs.prototype.getNorthEast=function(){return this._ne},gs.prototype.getNorthWest=function(){return new Ka(this.getWest(),this.getNorth())},gs.prototype.getSouthEast=function(){return new Ka(this.getEast(),this.getSouth())},gs.prototype.getWest=function(){return this._sw.lng},gs.prototype.getSouth=function(){return this._sw.lat},gs.prototype.getEast=function(){return this._ne.lng},gs.prototype.getNorth=function(){return this._ne.lat},gs.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},gs.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},gs.prototype.isEmpty=function(){return!(this._sw&&this._ne)},gs.prototype.contains=function(h){var p=Ka.convert(h),m=p.lng,E=p.lat,A=this._sw.lng<=m&&m<=this._ne.lng;return this._sw.lng>this._ne.lng&&(A=this._sw.lng>=m&&m>=this._ne.lng),this._sw.lat<=E&&E<=this._ne.lat&&A},gs.convert=function(h){return!h||h instanceof gs?h:new gs(h)};var Ka=function(h,p){if(isNaN(h)||isNaN(p))throw new Error("Invalid LngLat object: ("+h+", "+p+")");if(this.lng=+h,this.lat=+p,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Ka.prototype.wrap=function(){return new Ka(S(this.lng,-180,180),this.lat)},Ka.prototype.toArray=function(){return[this.lng,this.lat]},Ka.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Ka.prototype.distanceTo=function(h){var p=Math.PI/180,m=this.lat*p,E=h.lat*p,A=Math.sin(m)*Math.sin(E)+Math.cos(m)*Math.cos(E)*Math.cos((h.lng-this.lng)*p);return 63710088e-1*Math.acos(Math.min(A,1))},Ka.prototype.toBounds=function(h){h===void 0&&(h=0);var p=360*h/40075017,m=p/Math.cos(Math.PI/180*this.lat);return new gs(new Ka(this.lng-m,this.lat-p),new Ka(this.lng+m,this.lat+p))},Ka.convert=function(h){if(h instanceof Ka)return h;if(Array.isArray(h)&&(h.length===2||h.length===3))return new Ka(Number(h[0]),Number(h[1]));if(!Array.isArray(h)&&typeof h=="object"&&h!==null)return new Ka(Number("lng"in h?h.lng:h.lon),Number(h.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var K8=2*Math.PI*63710088e-1;function Q8(h){return K8*Math.cos(h*Math.PI/180)}function J8(h){return(180+h)/360}function t7(h){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+h*Math.PI/360)))/360}function e7(h,p){return h/Q8(p)}function YL(h){return 360/Math.PI*Math.atan(Math.exp((180-360*h)*Math.PI/180))-90}var ay=function(h,p,m){m===void 0&&(m=0),this.x=+h,this.y=+p,this.z=+m};ay.fromLngLat=function(h,p){p===void 0&&(p=0);var m=Ka.convert(h);return new ay(J8(m.lng),t7(m.lat),e7(p,m.lat))},ay.prototype.toLngLat=function(){return new Ka(360*this.x-180,YL(this.y))},ay.prototype.toAltitude=function(){return this.z*Q8(YL(this.y))},ay.prototype.meterInMercatorCoordinateUnits=function(){return 1/K8*(h=YL(this.y),1/Math.cos(h*Math.PI/180));var h};var oy=function(h,p,m){this.z=h,this.x=p,this.y=m,this.key=EE(0,h,h,p,m)};oy.prototype.equals=function(h){return this.z===h.z&&this.x===h.x&&this.y===h.y},oy.prototype.url=function(h,p){var m,E,A,L,D,N=(E=this.y,A=this.z,L=q8(256*(m=this.x),256*(E=Math.pow(2,A)-E-1),A),D=q8(256*(m+1),256*(E+1),A),L[0]+","+L[1]+","+D[0]+","+D[1]),V=function(W,q,Q){for(var it,ut="",At=W;At>0;At--)ut+=(q&(it=1<<At-1)?1:0)+(Q&it?2:0);return ut}(this.z,this.x,this.y);return h[(this.x+this.y)%h.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",V).replace("{bbox-epsg-3857}",N)},oy.prototype.getTilePoint=function(h){var p=Math.pow(2,this.z);return new c(8192*(h.x*p-this.x),8192*(h.y*p-this.y))},oy.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var r7=function(h,p){this.wrap=h,this.canonical=p,this.key=EE(h,p.z,p.z,p.x,p.y)},ms=function(h,p,m,E,A){this.overscaledZ=h,this.wrap=p,this.canonical=new oy(m,+E,+A),this.key=EE(p,h,m,E,A)};function EE(h,p,m,E,A){(h*=2)<0&&(h=-1*h-1);var L=1<<m;return(L*L*h+L*A+E).toString(36)+m.toString(36)+p.toString(36)}ms.prototype.equals=function(h){return this.overscaledZ===h.overscaledZ&&this.wrap===h.wrap&&this.canonical.equals(h.canonical)},ms.prototype.scaledTo=function(h){var p=this.canonical.z-h;return h>this.canonical.z?new ms(h,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ms(h,this.wrap,h,this.canonical.x>>p,this.canonical.y>>p)},ms.prototype.calculateScaledKey=function(h,p){var m=this.canonical.z-h;return h>this.canonical.z?EE(this.wrap*+p,h,this.canonical.z,this.canonical.x,this.canonical.y):EE(this.wrap*+p,h,h,this.canonical.x>>m,this.canonical.y>>m)},ms.prototype.isChildOf=function(h){if(h.wrap!==this.wrap)return!1;var p=this.canonical.z-h.canonical.z;return h.overscaledZ===0||h.overscaledZ<this.overscaledZ&&h.canonical.x===this.canonical.x>>p&&h.canonical.y===this.canonical.y>>p},ms.prototype.children=function(h){if(this.overscaledZ>=h)return[new ms(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var p=this.canonical.z+1,m=2*this.canonical.x,E=2*this.canonical.y;return[new ms(p,this.wrap,p,m,E),new ms(p,this.wrap,p,m+1,E),new ms(p,this.wrap,p,m,E+1),new ms(p,this.wrap,p,m+1,E+1)]},ms.prototype.isLessThan=function(h){return this.wrap<h.wrap||!(this.wrap>h.wrap)&&(this.overscaledZ<h.overscaledZ||!(this.overscaledZ>h.overscaledZ)&&(this.canonical.x<h.canonical.x||!(this.canonical.x>h.canonical.x)&&this.canonical.y<h.canonical.y))},ms.prototype.wrapped=function(){return new ms(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},ms.prototype.unwrapTo=function(h){return new ms(this.overscaledZ,h,this.canonical.z,this.canonical.x,this.canonical.y)},ms.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},ms.prototype.toUnwrapped=function(){return new r7(this.wrap,this.canonical)},ms.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},ms.prototype.getTilePoint=function(h){return this.canonical.getTilePoint(new ay(h.x-this.wrap,h.y))},Xr("CanonicalTileID",oy),Xr("OverscaledTileID",ms,{omit:["posMatrix"]});var $v=function(h,p,m){if(this.uid=h,p.height!==p.width)throw new RangeError("DEM tiles must be square");if(m&&m!=="mapbox"&&m!=="terrarium")return at('"'+m+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=p.height;var E=this.dim=p.height-2;this.data=new Uint32Array(p.data.buffer),this.encoding=m||"mapbox";for(var A=0;A<E;A++)this.data[this._idx(-1,A)]=this.data[this._idx(0,A)],this.data[this._idx(E,A)]=this.data[this._idx(E-1,A)],this.data[this._idx(A,-1)]=this.data[this._idx(A,0)],this.data[this._idx(A,E)]=this.data[this._idx(A,E-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(E,-1)]=this.data[this._idx(E-1,0)],this.data[this._idx(-1,E)]=this.data[this._idx(0,E-1)],this.data[this._idx(E,E)]=this.data[this._idx(E-1,E-1)]};$v.prototype.get=function(h,p){var m=new Uint8Array(this.data.buffer),E=4*this._idx(h,p);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(m[E],m[E+1],m[E+2])},$v.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},$v.prototype._idx=function(h,p){if(h<-1||h>=this.dim+1||p<-1||p>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(p+1)*this.stride+(h+1)},$v.prototype._unpackMapbox=function(h,p,m){return(256*h*256+256*p+m)/10-1e4},$v.prototype._unpackTerrarium=function(h,p,m){return 256*h+p+m/256-32768},$v.prototype.getPixels=function(){return new cl({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},$v.prototype.backfillBorder=function(h,p,m){if(this.dim!==h.dim)throw new Error("dem dimension mismatch");var E=p*this.dim,A=p*this.dim+this.dim,L=m*this.dim,D=m*this.dim+this.dim;switch(p){case-1:E=A-1;break;case 1:A=E+1}switch(m){case-1:L=D-1;break;case 1:D=L+1}for(var N=-p*this.dim,V=-m*this.dim,W=L;W<D;W++)for(var q=E;q<A;q++)this.data[this._idx(q,W)]=h.data[this._idx(q+N,W+V)]},Xr("DEMData",$v);var aT=function(h){this._stringToNumber={},this._numberToString=[];for(var p=0;p<h.length;p++){var m=h[p];this._stringToNumber[m]=p,this._numberToString[p]=m}};aT.prototype.encode=function(h){return this._stringToNumber[h]},aT.prototype.decode=function(h){return this._numberToString[h]};var oT=function(h,p,m,E,A){this.type="Feature",this._vectorTileFeature=h,h._z=p,h._x=m,h._y=E,this.properties=h.properties,this.id=A},ZL={geometry:{configurable:!0}};ZL.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},ZL.geometry.set=function(h){this._geometry=h},oT.prototype.toJSON=function(){var h={geometry:this.geometry};for(var p in this)p!=="_geometry"&&p!=="_vectorTileFeature"&&(h[p]=this[p]);return h},Object.defineProperties(oT.prototype,ZL);var m1=function(){this.state={},this.stateChanges={},this.deletedStates={}};m1.prototype.updateState=function(h,p,m){var E=String(p);if(this.stateChanges[h]=this.stateChanges[h]||{},this.stateChanges[h][E]=this.stateChanges[h][E]||{},M(this.stateChanges[h][E],m),this.deletedStates[h]===null)for(var A in this.deletedStates[h]={},this.state[h])A!==E&&(this.deletedStates[h][A]=null);else if(this.deletedStates[h]&&this.deletedStates[h][E]===null)for(var L in this.deletedStates[h][E]={},this.state[h][E])m[L]||(this.deletedStates[h][E][L]=null);else for(var D in m)this.deletedStates[h]&&this.deletedStates[h][E]&&this.deletedStates[h][E][D]===null&&delete this.deletedStates[h][E][D]},m1.prototype.removeFeatureState=function(h,p,m){if(this.deletedStates[h]!==null){var E=String(p);if(this.deletedStates[h]=this.deletedStates[h]||{},m&&p!==void 0)this.deletedStates[h][E]!==null&&(this.deletedStates[h][E]=this.deletedStates[h][E]||{},this.deletedStates[h][E][m]=null);else if(p!==void 0)if(this.stateChanges[h]&&this.stateChanges[h][E])for(m in this.deletedStates[h][E]={},this.stateChanges[h][E])this.deletedStates[h][E][m]=null;else this.deletedStates[h][E]=null;else this.deletedStates[h]=null}},m1.prototype.getState=function(h,p){var m=String(p),E=M({},(this.state[h]||{})[m],(this.stateChanges[h]||{})[m]);if(this.deletedStates[h]===null)return{};if(this.deletedStates[h]){var A=this.deletedStates[h][p];if(A===null)return{};for(var L in A)delete E[L]}return E},m1.prototype.initializeTileState=function(h,p){h.setFeatureState(this.state,p)},m1.prototype.coalesceChanges=function(h,p){var m={};for(var E in this.stateChanges){this.state[E]=this.state[E]||{};var A={};for(var L in this.stateChanges[E])this.state[E][L]||(this.state[E][L]={}),M(this.state[E][L],this.stateChanges[E][L]),A[L]=this.state[E][L];m[E]=A}for(var D in this.deletedStates){this.state[D]=this.state[D]||{};var N={};if(this.deletedStates[D]===null)for(var V in this.state[D])N[V]={},this.state[D][V]={};else for(var W in this.deletedStates[D]){if(this.deletedStates[D][W]===null)this.state[D][W]={};else for(var q=0,Q=Object.keys(this.deletedStates[D][W]);q<Q.length;q+=1)delete this.state[D][W][Q[q]];N[W]=this.state[D][W]}m[D]=m[D]||{},M(m[D],N)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(var it in h)h[it].setFeatureState(m,p)};var Hv=function(h,p){this.tileID=h,this.x=h.canonical.x,this.y=h.canonical.y,this.z=h.canonical.z,this.grid=new Wo(8192,16,0),this.grid3D=new Wo(8192,16,0),this.featureIndexArray=new rt,this.promoteId=p};function n7(h,p,m,E,A){return J(h,function(L,D){var N=p instanceof gp?p.get(D):null;return N&&N.evaluate?N.evaluate(m,E,A):N})}function i7(h){for(var p=1/0,m=1/0,E=-1/0,A=-1/0,L=0,D=h;L<D.length;L+=1){var N=D[L];p=Math.min(p,N.x),m=Math.min(m,N.y),E=Math.max(E,N.x),A=Math.max(A,N.y)}return{minX:p,minY:m,maxX:E,maxY:A}}function Nft(h,p){return p-h}Hv.prototype.insert=function(h,p,m,E,A,L){var D=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(m,E,A);for(var N=L?this.grid3D:this.grid,V=0;V<p.length;V++){for(var W=p[V],q=[1/0,1/0,-1/0,-1/0],Q=0;Q<W.length;Q++){var it=W[Q];q[0]=Math.min(q[0],it.x),q[1]=Math.min(q[1],it.y),q[2]=Math.max(q[2],it.x),q[3]=Math.max(q[3],it.y)}q[0]<8192&&q[1]<8192&&q[2]>=0&&q[3]>=0&&N.insert(D,q[0],q[1],q[2],q[3])}},Hv.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Tp.VectorTile(new _e(this.rawTileData)).layers,this.sourceLayerCoder=new aT(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Hv.prototype.query=function(h,p,m,E){var A=this;this.loadVTLayers();for(var L=h.params||{},D=8192/h.tileSize/h.scale,N=mf(L.filter),V=h.queryGeometry,W=h.queryPadding*D,q=i7(V),Q=this.grid.query(q.minX-W,q.minY-W,q.maxX+W,q.maxY+W),it=i7(h.cameraQueryGeometry),ut=this.grid3D.query(it.minX-W,it.minY-W,it.maxX+W,it.maxY+W,function(be,Se,He,lr){return function(_r,un,Br,vn,$r){for(var ui=0,On=_r;ui<On.length;ui+=1){var Qr=On[ui];if(un<=Qr.x&&Br<=Qr.y&&vn>=Qr.x&&$r>=Qr.y)return!0}var mi=[new c(un,Br),new c(un,$r),new c(vn,$r),new c(vn,Br)];if(_r.length>2){for(var qn=0,ki=mi;qn<ki.length;qn+=1)if(Ku(_r,ki[qn]))return!0}for(var mn=0;mn<_r.length-1;mn++)if(Sf(_r[mn],_r[mn+1],mi))return!0;return!1}(h.cameraQueryGeometry,be-W,Se-W,He+W,lr+W)}),At=0,It=ut;At<It.length;At+=1)Q.push(It[At]);Q.sort(Nft);for(var Wt,kt={},ie=function(be){var Se=Q[be];if(Se!==Wt){Wt=Se;var He=A.featureIndexArray.get(Se),lr=null;A.loadMatchingFeature(kt,He.bucketIndex,He.sourceLayerIndex,He.featureIndex,N,L.layers,L.availableImages,p,m,E,function(_r,un,Br){return lr||(lr=Xa(_r)),un.queryIntersectsFeature(V,_r,Br,lr,A.z,h.transform,D,h.pixelPosMatrix)})}},ue=0;ue<Q.length;ue++)ie(ue);return kt},Hv.prototype.loadMatchingFeature=function(h,p,m,E,A,L,D,N,V,W,q){var Q=this.bucketLayerIDs[p];if(!L||function(_r,un){for(var Br=0;Br<_r.length;Br++)if(un.indexOf(_r[Br])>=0)return!0;return!1}(L,Q)){var it=this.sourceLayerCoder.decode(m),ut=this.vtLayers[it].feature(E);if(A.needGeometry){var At=qa(ut,!0);if(!A.filter(new Wn(this.tileID.overscaledZ),At,this.tileID.canonical))return}else if(!A.filter(new Wn(this.tileID.overscaledZ),ut))return;for(var It=this.getId(ut,it),Wt=0;Wt<Q.length;Wt++){var kt=Q[Wt];if(!(L&&L.indexOf(kt)<0)){var ie=N[kt];if(ie){var ue={};It!==void 0&&W&&(ue=W.getState(ie.sourceLayer||"_geojsonTileLayer",It));var be=M({},V[kt]);be.paint=n7(be.paint,ie.paint,ut,ue,D),be.layout=n7(be.layout,ie.layout,ut,ue,D);var Se=!q||q(ut,ie,ue);if(Se){var He=new oT(ut,this.z,this.x,this.y,It);He.layer=be;var lr=h[kt];lr===void 0&&(lr=h[kt]=[]),lr.push({featureIndex:E,feature:He,intersectionZ:Se})}}}}}},Hv.prototype.lookupSymbolFeatures=function(h,p,m,E,A,L,D,N){var V={};this.loadVTLayers();for(var W=mf(A),q=0,Q=h;q<Q.length;q+=1)this.loadMatchingFeature(V,m,E,Q[q],W,L,D,N,p);return V},Hv.prototype.hasLayer=function(h){for(var p=0,m=this.bucketLayerIDs;p<m.length;p+=1)for(var E=0,A=m[p];E<A.length;E+=1)if(h===A[E])return!0;return!1},Hv.prototype.getId=function(h,p){var m=h.id;return this.promoteId&&typeof(m=h.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[p]])=="boolean"&&(m=Number(m)),m},Xr("FeatureIndex",Hv,{omit:["rawTileData","sourceLayerCoder"]});var Hs=function(h,p){this.tileID=h,this.uid=I(),this.uses=0,this.tileSize=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Hs.prototype.registerFadeDuration=function(h){var p=h+this.timeAdded;p<In.now()||this.fadeEndTime&&p<this.fadeEndTime||(this.fadeEndTime=p)},Hs.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Hs.prototype.loadVectorData=function(h,p,m){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",h){for(var E in h.featureIndex&&(this.latestFeatureIndex=h.featureIndex,h.rawTileData?(this.latestRawTileData=h.rawTileData,this.latestFeatureIndex.rawTileData=h.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=h.collisionBoxArray,this.buckets=function(W,q){var Q={};if(!q)return Q;for(var it=function(){var It=At[ut],Wt=It.layerIds.map(function(ue){return q.getLayer(ue)}).filter(Boolean);if(Wt.length!==0){It.layers=Wt,It.stateDependentLayerIds&&(It.stateDependentLayers=It.stateDependentLayerIds.map(function(ue){return Wt.filter(function(be){return be.id===ue})[0]}));for(var kt=0,ie=Wt;kt<ie.length;kt+=1)Q[ie[kt].id]=It}},ut=0,At=W;ut<At.length;ut+=1)it();return Q}(h.buckets,p.style),this.hasSymbolBuckets=!1,this.buckets){var A=this.buckets[E];if(A instanceof jr){if(this.hasSymbolBuckets=!0,!m)break;A.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var L in this.buckets){var D=this.buckets[L];if(D instanceof jr&&D.hasRTLText){this.hasRTLText=!0,eu.isLoading()||eu.isLoaded()||K0()!=="deferred"||Ol();break}}for(var N in this.queryPadding=0,this.buckets){var V=this.buckets[N];this.queryPadding=Math.max(this.queryPadding,p.style.getLayer(N).queryRadius(V))}h.imageAtlas&&(this.imageAtlas=h.imageAtlas),h.glyphAtlasImage&&(this.glyphAtlasImage=h.glyphAtlasImage)}else this.collisionBoxArray=new b},Hs.prototype.unloadVectorData=function(){for(var h in this.buckets)this.buckets[h].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Hs.prototype.getBucket=function(h){return this.buckets[h.id]},Hs.prototype.upload=function(h){for(var p in this.buckets){var m=this.buckets[p];m.uploadPending()&&m.upload(h)}var E=h.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new iy(h,this.imageAtlas.image,E.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new iy(h,this.glyphAtlasImage,E.ALPHA),this.glyphAtlasImage=null)},Hs.prototype.prepare=function(h){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(h,this.imageAtlasTexture)},Hs.prototype.queryRenderedFeatures=function(h,p,m,E,A,L,D,N,V,W){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:E,cameraQueryGeometry:A,scale:L,tileSize:this.tileSize,pixelPosMatrix:W,transform:N,params:D,queryPadding:this.queryPadding*V},h,p,m):{}},Hs.prototype.querySourceFeatures=function(h,p){var m=this.latestFeatureIndex;if(m&&m.rawTileData){var E=m.loadVTLayers(),A=p?p.sourceLayer:"",L=E._geojsonTileLayer||E[A];if(L)for(var D=mf(p&&p.filter),N=this.tileID.canonical,V=N.z,W=N.x,q=N.y,Q={z:V,x:W,y:q},it=0;it<L.length;it++){var ut=L.feature(it);if(D.needGeometry){var At=qa(ut,!0);if(!D.filter(new Wn(this.tileID.overscaledZ),At,this.tileID.canonical))continue}else if(!D.filter(new Wn(this.tileID.overscaledZ),ut))continue;var It=m.getId(ut,A),Wt=new oT(ut,V,W,q,It);Wt.tile=Q,h.push(Wt)}}},Hs.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Hs.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Hs.prototype.setExpiryData=function(h){var p=this.expirationTime;if(h.cacheControl){var m=zt(h.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else h.expires&&(this.expirationTime=new Date(h.expires).getTime());if(this.expirationTime){var E=Date.now(),A=!1;if(this.expirationTime>E)A=!1;else if(p)if(this.expirationTime<p)A=!0;else{var L=this.expirationTime-p;L?this.expirationTime=E+Math.max(L,3e4):A=!0}else A=!0;A?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Hs.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Hs.prototype.setFeatureState=function(h,p){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(h).length!==0){var m=this.latestFeatureIndex.loadVTLayers();for(var E in this.buckets)if(p.style.hasLayer(E)){var A=this.buckets[E],L=A.layers[0].sourceLayer||"_geojsonTileLayer",D=m[L],N=h[L];if(D&&N&&Object.keys(N).length!==0){A.update(N,D,this.imageAtlas&&this.imageAtlas.patternPositions||{});var V=p&&p.style&&p.style.getLayer(E);V&&(this.queryPadding=Math.max(this.queryPadding,V.queryRadius(A)))}}}},Hs.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Hs.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<In.now()},Hs.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Hs.prototype.setHoldDuration=function(h){this.symbolFadeHoldUntil=In.now()+h},Hs.prototype.setDependencies=function(h,p){for(var m={},E=0,A=p;E<A.length;E+=1)m[A[E]]=!0;this.dependencies[h]=m},Hs.prototype.hasDependency=function(h,p){for(var m=0,E=h;m<E.length;m+=1){var A=this.dependencies[E[m]];if(A){for(var L=0,D=p;L<D.length;L+=1)if(A[D[L]])return!0}}return!1};var fm=d.performance,a7=function(h){this._marks={start:[h.url,"start"].join("#"),end:[h.url,"end"].join("#"),measure:h.url.toString()},fm.mark(this._marks.start)};a7.prototype.finish=function(){fm.mark(this._marks.end);var h=fm.getEntriesByName(this._marks.measure);return h.length===0&&(fm.measure(this._marks.measure,this._marks.start,this._marks.end),h=fm.getEntriesByName(this._marks.measure),fm.clearMarks(this._marks.start),fm.clearMarks(this._marks.end),fm.clearMeasures(this._marks.measure)),h},o.Actor=g1,o.AlphaImage=xp,o.CanonicalTileID=oy,o.CollisionBoxArray=b,o.Color=si,o.DEMData=$v,o.DataConstantProperty=sn,o.DictionaryCoder=aT,o.EXTENT=8192,o.ErrorEvent=jt,o.EvaluationParameters=Wn,o.Event=Rt,o.Evented=Jt,o.FeatureIndex=Hv,o.FillBucket=Rh,o.FillExtrusionBucket=Qs,o.ImageAtlas=$e,o.ImagePosition=wr,o.LineBucket=fl,o.LngLat=Ka,o.LngLatBounds=gs,o.MercatorCoordinate=ay,o.ONE_EM=24,o.OverscaledTileID=ms,o.Point=c,o.Point$1=c,o.Properties=Wa,o.Protobuf=_e,o.RGBAImage=cl,o.RequestManager=Qn,o.RequestPerformance=a7,o.ResourceType=ph,o.SegmentVector=dt,o.SourceFeatureState=m1,o.StructArrayLayout1ui2=im,o.StructArrayLayout2f1f2i16=_d,o.StructArrayLayout2i4=Ef,o.StructArrayLayout3ui6=Sc,o.StructArrayLayout4i8=tm,o.SymbolBucket=jr,o.Texture=iy,o.Tile=Hs,o.Transitionable=fs,o.Uniform1f=hr,o.Uniform1i=Ge,o.Uniform2f=or,o.Uniform3f=Ir,o.Uniform4f=ln,o.UniformColor=fn,o.UniformMatrix4f=Li,o.UnwrappedTileID=r7,o.ValidationError=Dt,o.WritingMode=pn,o.ZoomHistory=Zg,o.add=function(h,p,m){return h[0]=p[0]+m[0],h[1]=p[1]+m[1],h[2]=p[2]+m[2],h},o.addDynamicAttributes=Ye,o.asyncAll=function(h,p,m){if(!h.length)return m(null,[]);var E=h.length,A=new Array(h.length),L=null;h.forEach(function(D,N){p(D,function(V,W){V&&(L=V),A[N]=W,--E==0&&m(L,A)})})},o.bezier=g,o.bindAll=z,o.browser=In,o.cacheEntryPossiblyAdded=function(h){++dh>vc&&(h.getActor().send("enforceCacheSizeLimit",cs),dh=0)},o.clamp=w,o.clearTileCache=function(h){var p=d.caches.delete("mapbox-tiles");h&&p.catch(h).then(function(){return h()})},o.clipLine=Ih,o.clone=function(h){var p=new xi(16);return p[0]=h[0],p[1]=h[1],p[2]=h[2],p[3]=h[3],p[4]=h[4],p[5]=h[5],p[6]=h[6],p[7]=h[7],p[8]=h[8],p[9]=h[9],p[10]=h[10],p[11]=h[11],p[12]=h[12],p[13]=h[13],p[14]=h[14],p[15]=h[15],p},o.clone$1=X,o.clone$2=function(h){var p=new xi(3);return p[0]=h[0],p[1]=h[1],p[2]=h[2],p},o.collisionCircleLayout=j,o.config=re,o.create=function(){var h=new xi(16);return xi!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=0,h[12]=0,h[13]=0,h[14]=0),h[0]=1,h[5]=1,h[10]=1,h[15]=1,h},o.create$1=function(){var h=new xi(9);return xi!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[5]=0,h[6]=0,h[7]=0),h[0]=1,h[4]=1,h[8]=1,h},o.create$2=function(){var h=new xi(4);return xi!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h},o.createCommonjsModule=s,o.createExpression=cp,o.createLayout=Xo,o.createStyleLayer=function(h){return h.type==="custom"?new nT(h):new Sd[h.type](h)},o.cross=function(h,p,m){var E=p[0],A=p[1],L=p[2],D=m[0],N=m[1],V=m[2];return h[0]=A*V-L*N,h[1]=L*D-E*V,h[2]=E*N-A*D,h},o.deepEqual=function h(p,m){if(Array.isArray(p)){if(!Array.isArray(m)||p.length!==m.length)return!1;for(var E=0;E<p.length;E++)if(!h(p[E],m[E]))return!1;return!0}if(typeof p=="object"&&p!==null&&m!==null){if(typeof m!="object"||Object.keys(p).length!==Object.keys(m).length)return!1;for(var A in p)if(!h(p[A],m[A]))return!1;return!0}return p===m},o.dot=function(h,p){return h[0]*p[0]+h[1]*p[1]+h[2]*p[2]},o.dot$1=function(h,p){return h[0]*p[0]+h[1]*p[1]+h[2]*p[2]+h[3]*p[3]},o.ease=x,o.emitValidationErrors=xf,o.endsWith=G,o.enforceCacheSizeLimit=function(h){vo(),ss&&ss.then(function(p){p.keys().then(function(m){for(var E=0;E<m.length-h;E++)p.delete(m[E])})})},o.evaluateSizeForFeature=Js,o.evaluateSizeForZoom=Ko,o.evaluateVariableOffset=Zt,o.evented=Jg,o.extend=M,o.featureFilter=mf,o.filterObject=Z,o.fromRotation=function(h,p){var m=Math.sin(p),E=Math.cos(p);return h[0]=E,h[1]=m,h[2]=0,h[3]=-m,h[4]=E,h[5]=0,h[6]=0,h[7]=0,h[8]=1,h},o.getAnchorAlignment=La,o.getAnchorJustification=te,o.getArrayBuffer=cd,o.getImage=nt,o.getJSON=function(h,p){return gc(M(h,{type:"json"}),p)},o.getRTLTextPluginStatus=K0,o.getReferrer=vh,o.getVideo=function(h,p){var m,E,A=d.document.createElement("video");A.muted=!0,A.onloadstart=function(){p(null,A)};for(var L=0;L<h.length;L++){var D=d.document.createElement("source");m=h[L],E=void 0,(E=d.document.createElement("a")).href=m,(E.protocol!==d.document.location.protocol||E.host!==d.document.location.host)&&(A.crossOrigin="Anonymous"),D.src=h[L],A.appendChild(D)}return{cancel:function(){}}},o.identity=ps,o.invert=function(h,p){var m=p[0],E=p[1],A=p[2],L=p[3],D=p[4],N=p[5],V=p[6],W=p[7],q=p[8],Q=p[9],it=p[10],ut=p[11],At=p[12],It=p[13],Wt=p[14],kt=p[15],ie=m*N-E*D,ue=m*V-A*D,be=m*W-L*D,Se=E*V-A*N,He=E*W-L*N,lr=A*W-L*V,_r=q*It-Q*At,un=q*Wt-it*At,Br=q*kt-ut*At,vn=Q*Wt-it*It,$r=Q*kt-ut*It,ui=it*kt-ut*Wt,On=ie*ui-ue*$r+be*vn+Se*Br-He*un+lr*_r;return On?(h[0]=(N*ui-V*$r+W*vn)*(On=1/On),h[1]=(A*$r-E*ui-L*vn)*On,h[2]=(It*lr-Wt*He+kt*Se)*On,h[3]=(it*He-Q*lr-ut*Se)*On,h[4]=(V*Br-D*ui-W*un)*On,h[5]=(m*ui-A*Br+L*un)*On,h[6]=(Wt*be-At*lr-kt*ue)*On,h[7]=(q*lr-it*be+ut*ue)*On,h[8]=(D*$r-N*Br+W*_r)*On,h[9]=(E*Br-m*$r-L*_r)*On,h[10]=(At*He-It*be+kt*ie)*On,h[11]=(Q*be-q*He-ut*ie)*On,h[12]=(N*un-D*vn-V*_r)*On,h[13]=(m*vn-E*un+A*_r)*On,h[14]=(It*ue-At*Se-Wt*ie)*On,h[15]=(q*Se-Q*ue+it*ie)*On,h):null},o.isChar=xr,o.isMapboxURL=gn,o.keysDifference=function(h,p){var m=[];for(var E in h)E in p||m.push(E);return m},o.makeRequest=gc,o.mapObject=J,o.mercatorXfromLng=J8,o.mercatorYfromLat=t7,o.mercatorZfromAltitude=e7,o.mul=om,o.multiply=Io,o.mvt=Tp,o.nextPowerOfTwo=function(h){return h<=1?1:Math.pow(2,Math.ceil(Math.log(h)/Math.LN2))},o.normalize=function(h,p){var m=p[0],E=p[1],A=p[2],L=m*m+E*E+A*A;return L>0&&(L=1/Math.sqrt(L)),h[0]=p[0]*L,h[1]=p[1]*L,h[2]=p[2]*L,h},o.number=so,o.offscreenCanvasSupported=ud,o.ortho=function(h,p,m,E,A,L,D){var N=1/(p-m),V=1/(E-A),W=1/(L-D);return h[0]=-2*N,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=-2*V,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[10]=2*W,h[11]=0,h[12]=(p+m)*N,h[13]=(A+E)*V,h[14]=(D+L)*W,h[15]=1,h},o.parseGlyphPBF=function(h){return new _e(h).readFields(je,[])},o.pbf=_e,o.performSymbolLayout=function(h,p,m,E,A,L,D){h.createArrays(),h.tilePixelRatio=8192/(512*h.overscaling),h.compareText={},h.iconsNeedLinear=!1;var N=h.layers[0].layout,V=h.layers[0]._unevaluatedLayout._values,W={};if(h.textSizeData.kind==="composite"){var q=h.textSizeData,Q=q.maxZoom;W.compositeTextSizes=[V["text-size"].possiblyEvaluate(new Wn(q.minZoom),D),V["text-size"].possiblyEvaluate(new Wn(Q),D)]}if(h.iconSizeData.kind==="composite"){var it=h.iconSizeData,ut=it.maxZoom;W.compositeIconSizes=[V["icon-size"].possiblyEvaluate(new Wn(it.minZoom),D),V["icon-size"].possiblyEvaluate(new Wn(ut),D)]}W.layoutTextSize=V["text-size"].possiblyEvaluate(new Wn(h.zoom+1),D),W.layoutIconSize=V["icon-size"].possiblyEvaluate(new Wn(h.zoom+1),D),W.textMaxSize=V["text-size"].possiblyEvaluate(new Wn(18));for(var At=24*N.get("text-line-height"),It=N.get("text-rotation-alignment")==="map"&&N.get("symbol-placement")!=="point",Wt=N.get("text-keep-upright"),kt=N.get("text-size"),ie=function(){var Se=be[ue],He=N.get("text-font").evaluate(Se,{},D).join(","),lr=kt.evaluate(Se,{},D),_r=W.layoutTextSize.evaluate(Se,{},D),un=W.layoutIconSize.evaluate(Se,{},D),Br={horizontal:{},vertical:void 0},vn=Se.text,$r=[0,0];if(vn){var ui=vn.toString(),On=24*N.get("text-letter-spacing").evaluate(Se,{},D),Qr=function(Ti){for(var Ta=0,va=Ti;Ta<va.length;Ta+=1)if(Gi=va[Ta].charCodeAt(0),xr.Arabic(Gi)||xr["Arabic Supplement"](Gi)||xr["Arabic Extended-A"](Gi)||xr["Arabic Presentation Forms-A"](Gi)||xr["Arabic Presentation Forms-B"](Gi))return!1;var Gi;return!0}(ui)?On:0,mi=N.get("text-anchor").evaluate(Se,{},D),qn=N.get("text-variable-anchor");if(!qn){var ki=N.get("text-radial-offset").evaluate(Se,{},D);$r=ki?Zt(mi,[24*ki,Vt]):N.get("text-offset").evaluate(Se,{},D).map(function(Ti){return 24*Ti})}var mn=It?"center":N.get("text-justify").evaluate(Se,{},D),qi=N.get("symbol-placement"),Qa=qi==="point"?24*N.get("text-max-width").evaluate(Se,{},D):0,Eo=function(){h.allowVerticalPlacement&&Ch(ui)&&(Br.vertical=ei(vn,p,m,A,He,Qa,At,mi,"left",Qr,$r,pn.vertical,!0,qi,_r,lr))};if(!It&&qn){for(var yo=mn==="auto"?qn.map(function(Ti){return te(Ti)}):[mn],Ja=!1,wo=0;wo<yo.length;wo++){var Ms=yo[wo];if(!Br.horizontal[Ms])if(Ja)Br.horizontal[Ms]=Br.horizontal[0];else{var Rs=ei(vn,p,m,A,He,Qa,At,"center",Ms,Qr,$r,pn.horizontal,!1,qi,_r,lr);Rs&&(Br.horizontal[Ms]=Rs,Ja=Rs.positionedLines.length===1)}}Eo()}else{mn==="auto"&&(mn=te(mi));var Bl=ei(vn,p,m,A,He,Qa,At,mi,mn,Qr,$r,pn.horizontal,!1,qi,_r,lr);Bl&&(Br.horizontal[mn]=Bl),Eo(),Ch(ui)&&It&&Wt&&(Br.vertical=ei(vn,p,m,A,He,Qa,At,mi,mn,Qr,$r,pn.vertical,!1,qi,_r,lr))}}var Vs=void 0,Nl=!1;if(Se.icon&&Se.icon.name){var Do=E[Se.icon.name];Do&&(Vs=function(Ti,Ta,va){var Gi=La(va),iu=Ta[0]-Ti.displaySize[0]*Gi.horizontalAlign,dl=Ta[1]-Ti.displaySize[1]*Gi.verticalAlign;return{image:Ti,top:dl,bottom:dl+Ti.displaySize[1],left:iu,right:iu+Ti.displaySize[0]}}(A[Se.icon.name],N.get("icon-offset").evaluate(Se,{},D),N.get("icon-anchor").evaluate(Se,{},D)),Nl=Do.sdf,h.sdfIcons===void 0?h.sdfIcons=Do.sdf:h.sdfIcons!==Do.sdf&&at("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Do.pixelRatio!==h.pixelRatio||N.get("icon-rotate").constantOr(1)!==0)&&(h.iconsNeedLinear=!0))}var Gs=Xt(Br.horizontal)||Br.vertical;h.iconsInText=!!Gs&&Gs.iconsInText,(Gs||Vs)&&function(Ti,Ta,va,Gi,iu,dl,ja,Jo,pl,Ki,Ap){var Ic=dl.textMaxSize.evaluate(Ta,{});Ic===void 0&&(Ic=ja);var Mp,Fo=Ti.layers[0].layout,Rp=Fo.get("icon-offset").evaluate(Ta,{},Ap),Mf=Xt(va.horizontal),y1=ja/24,sy=Ti.tilePixelRatio*y1,_1=Ti.tilePixelRatio*Ic/24,Vv=Ti.tilePixelRatio*Jo,x1=Ti.tilePixelRatio*Fo.get("symbol-spacing"),sT=Fo.get("text-padding")*Ti.tilePixelRatio,b1=Fo.get("icon-padding")*Ti.tilePixelRatio,wE=Fo.get("text-max-angle")/180*Math.PI,lT=Fo.get("text-rotation-alignment")==="map"&&Fo.get("symbol-placement")!=="point",uT=Fo.get("icon-rotation-alignment")==="map"&&Fo.get("symbol-placement")!=="point",Gv=Fo.get("symbol-placement"),CE=x1/2,E1=Fo.get("icon-text-fit");Gi&&E1!=="none"&&(Ti.allowVerticalPlacement&&va.vertical&&(Mp=qo(Gi,va.vertical,E1,Fo.get("icon-text-fit-padding"),Rp,y1)),Mf&&(Gi=qo(Gi,Mf,E1,Fo.get("icon-text-fit-padding"),Rp,y1)));var dm=function(kft,OE){OE.x<0||OE.x>=8192||OE.y<0||OE.y>=8192||function(Bo,Td,zft,pm,JL,l7,vT,Ip,gT,PE,mT,yT,tO,u7,DE,c7,h7,f7,d7,p7,Lc,_T,v7,Lp,Uft){var g7,uy,A1,M1,R1,I1=Bo.addToLineVertexArray(Td,zft),m7=0,y7=0,_7=0,x7=0,eO=-1,rO=-1,Wv={},b7=St(""),nO=0,iO=0;if(Ip._unevaluatedLayout.getValue("text-radial-offset")===void 0?(nO=(g7=Ip.layout.get("text-offset").evaluate(Lc,{},Lp).map(function(BE){return 24*BE}))[0],iO=g7[1]):(nO=24*Ip.layout.get("text-radial-offset").evaluate(Lc,{},Lp),iO=Vt),Bo.allowVerticalPlacement&&pm.vertical){var E7=Ip.layout.get("text-rotate").evaluate(Lc,{},Lp)+90;M1=new pa(gT,Td,PE,mT,yT,pm.vertical,tO,u7,DE,E7),vT&&(R1=new pa(gT,Td,PE,mT,yT,vT,h7,f7,DE,E7))}if(JL){var aO=Ip.layout.get("icon-rotate").evaluate(Lc,{}),w7=Ip.layout.get("icon-text-fit")!=="none",C7=Lt(JL,aO,v7,w7),oO=vT?Lt(vT,aO,v7,w7):void 0;A1=new pa(gT,Td,PE,mT,yT,JL,h7,f7,!1,aO),m7=4*C7.length;var S7=Bo.iconSizeData,FE=null;S7.kind==="source"?(FE=[128*Ip.layout.get("icon-size").evaluate(Lc,{})])[0]>32640&&at(Bo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):S7.kind==="composite"&&((FE=[128*_T.compositeIconSizes[0].evaluate(Lc,{},Lp),128*_T.compositeIconSizes[1].evaluate(Lc,{},Lp)])[0]>32640||FE[1]>32640)&&at(Bo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Bo.addSymbols(Bo.icon,C7,FE,p7,d7,Lc,!1,Td,I1.lineStartIndex,I1.lineLength,-1,Lp),eO=Bo.icon.placedSymbolArray.length-1,oO&&(y7=4*oO.length,Bo.addSymbols(Bo.icon,oO,FE,p7,d7,Lc,pn.vertical,Td,I1.lineStartIndex,I1.lineLength,-1,Lp),rO=Bo.icon.placedSymbolArray.length-1)}for(var T7 in pm.horizontal){var xT=pm.horizontal[T7];if(!uy){b7=St(xT.text);var $ft=Ip.layout.get("text-rotate").evaluate(Lc,{},Lp);uy=new pa(gT,Td,PE,mT,yT,xT,tO,u7,DE,$ft)}var A7=xT.positionedLines.length===1;if(_7+=Ot(Bo,Td,xT,l7,Ip,DE,Lc,c7,I1,pm.vertical?pn.horizontal:pn.horizontalOnly,A7?Object.keys(pm.horizontal):[T7],Wv,eO,_T,Lp),A7)break}pm.vertical&&(x7+=Ot(Bo,Td,pm.vertical,l7,Ip,DE,Lc,c7,I1,pn.vertical,["vertical"],Wv,rO,_T,Lp));var Hft=uy?uy.boxStartIndex:Bo.collisionBoxArray.length,Vft=uy?uy.boxEndIndex:Bo.collisionBoxArray.length,Gft=M1?M1.boxStartIndex:Bo.collisionBoxArray.length,Wft=M1?M1.boxEndIndex:Bo.collisionBoxArray.length,Xft=A1?A1.boxStartIndex:Bo.collisionBoxArray.length,jft=A1?A1.boxEndIndex:Bo.collisionBoxArray.length,Yft=R1?R1.boxStartIndex:Bo.collisionBoxArray.length,Zft=R1?R1.boxEndIndex:Bo.collisionBoxArray.length,Op=-1,bT=function(BE,R7){return BE&&BE.circleDiameter?Math.max(BE.circleDiameter,R7):R7};Op=bT(uy,Op),Op=bT(M1,Op),Op=bT(A1,Op);var M7=(Op=bT(R1,Op))>-1?1:0;M7&&(Op*=Uft/24),Bo.glyphOffsetArray.length>=jr.MAX_GLYPHS&&at("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Lc.sortKey!==void 0&&Bo.addToSortKeyRanges(Bo.symbolInstances.length,Lc.sortKey),Bo.symbolInstances.emplaceBack(Td.x,Td.y,Wv.right>=0?Wv.right:-1,Wv.center>=0?Wv.center:-1,Wv.left>=0?Wv.left:-1,Wv.vertical||-1,eO,rO,b7,Hft,Vft,Gft,Wft,Xft,jft,Yft,Zft,PE,_7,x7,m7,y7,M7,0,tO,nO,iO,Op)}(Ti,OE,kft,va,Gi,iu,Mp,Ti.layers[0],Ti.collisionBoxArray,Ta.index,Ta.sourceLayerIndex,Ti.index,sy,sT,lT,pl,Vv,b1,uT,Rp,Ta,dl,Ki,Ap,ja)};if(Gv==="line")for(var w1=0,cT=Ih(Ta.geometry,0,0,8192,8192);w1<cT.length;w1+=1)for(var hT=cT[w1],SE=0,TE=Po(hT,x1,wE,va.vertical||Mf,Gi,24,_1,Ti.overscaling,8192);SE<TE.length;SE+=1){var fT=TE[SE];Mf&&bt(Ti,Mf.text,CE,fT)||dm(hT,fT)}else if(Gv==="line-center")for(var AE=0,ME=Ta.geometry;AE<ME.length;AE+=1){var RE=ME[AE];if(RE.length>1){var dT=Ni(RE,wE,va.vertical||Mf,Gi,24,_1);dT&&dm(RE,dT)}}else if(Ta.type==="Polygon")for(var C1=0,pT=d1(Ta.geometry,0);C1<pT.length;C1+=1){var S1=pT[C1],IE=Nt(S1,16);dm(S1[0],new ho(IE.x,IE.y,0))}else if(Ta.type==="LineString")for(var ly=0,LE=Ta.geometry;ly<LE.length;ly+=1){var T1=LE[ly];dm(T1,new ho(T1[0].x,T1[0].y,0))}else if(Ta.type==="Point")for(var qL=0,o7=Ta.geometry;qL<o7.length;qL+=1)for(var KL=0,s7=o7[qL];KL<s7.length;KL+=1){var QL=s7[KL];dm([QL],new ho(QL.x,QL.y,0))}}(h,Se,Br,Vs,E,W,_r,un,$r,Nl,D)},ue=0,be=h.features;ue<be.length;ue+=1)ie();L&&h.generateCollisionDebugBuffers()},o.perspective=function(h,p,m,E,A){var L,D=1/Math.tan(p/2);return h[0]=D/m,h[1]=0,h[2]=0,h[3]=0,h[4]=0,h[5]=D,h[6]=0,h[7]=0,h[8]=0,h[9]=0,h[11]=-1,h[12]=0,h[13]=0,h[15]=0,A!=null&&A!==1/0?(h[10]=(A+E)*(L=1/(E-A)),h[14]=2*A*E*L):(h[10]=-1,h[14]=-2*E),h},o.pick=function(h,p){for(var m={},E=0;E<p.length;E++){var A=p[E];A in h&&(m[A]=h[A])}return m},o.plugin=eu,o.polygonIntersectsPolygon=Tc,o.postMapLoadEvent=ol,o.postTurnstileEvent=ma,o.potpack=kn,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.register=Xr,o.registerForPluginStateChange=function(h){return h({pluginStatus:Zs,pluginURL:wc}),Jg.on("pluginStateChange",h),h},o.renderColorRamp=$2,o.rotate=function(h,p,m){var E=p[0],A=p[1],L=p[2],D=p[3],N=Math.sin(m),V=Math.cos(m);return h[0]=E*V+L*N,h[1]=A*V+D*N,h[2]=E*-N+L*V,h[3]=A*-N+D*V,h},o.rotateX=function(h,p,m){var E=Math.sin(m),A=Math.cos(m),L=p[4],D=p[5],N=p[6],V=p[7],W=p[8],q=p[9],Q=p[10],it=p[11];return p!==h&&(h[0]=p[0],h[1]=p[1],h[2]=p[2],h[3]=p[3],h[12]=p[12],h[13]=p[13],h[14]=p[14],h[15]=p[15]),h[4]=L*A+W*E,h[5]=D*A+q*E,h[6]=N*A+Q*E,h[7]=V*A+it*E,h[8]=W*A-L*E,h[9]=q*A-D*E,h[10]=Q*A-N*E,h[11]=it*A-V*E,h},o.rotateZ=function(h,p,m){var E=Math.sin(m),A=Math.cos(m),L=p[0],D=p[1],N=p[2],V=p[3],W=p[4],q=p[5],Q=p[6],it=p[7];return p!==h&&(h[8]=p[8],h[9]=p[9],h[10]=p[10],h[11]=p[11],h[12]=p[12],h[13]=p[13],h[14]=p[14],h[15]=p[15]),h[0]=L*A+W*E,h[1]=D*A+q*E,h[2]=N*A+Q*E,h[3]=V*A+it*E,h[4]=W*A-L*E,h[5]=q*A-D*E,h[6]=Q*A-N*E,h[7]=it*A-V*E,h},o.scale=function(h,p,m){var E=m[0],A=m[1],L=m[2];return h[0]=p[0]*E,h[1]=p[1]*E,h[2]=p[2]*E,h[3]=p[3]*E,h[4]=p[4]*A,h[5]=p[5]*A,h[6]=p[6]*A,h[7]=p[7]*A,h[8]=p[8]*L,h[9]=p[9]*L,h[10]=p[10]*L,h[11]=p[11]*L,h[12]=p[12],h[13]=p[13],h[14]=p[14],h[15]=p[15],h},o.scale$1=function(h,p,m){return h[0]=p[0]*m,h[1]=p[1]*m,h[2]=p[2]*m,h[3]=p[3]*m,h},o.scale$2=function(h,p,m){return h[0]=p[0]*m,h[1]=p[1]*m,h[2]=p[2]*m,h},o.setCacheLimits=function(h,p){cs=h,vc=p},o.setRTLTextPlugin=function(h,p,m){if(m===void 0&&(m=!1),Zs==="deferred"||Zs==="loading"||Zs==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");wc=In.resolveURL(h),Zs="deferred",Qg=p,vp(),m||Ol()},o.sphericalToCartesian=function(h){var p=h[0],m=h[1],E=h[2];return m+=90,m*=Math.PI/180,E*=Math.PI/180,{x:p*Math.cos(m)*Math.sin(E),y:p*Math.sin(m)*Math.sin(E),z:p*Math.cos(E)}},o.sqrLen=function(h){var p=h[0],m=h[1];return p*p+m*m},o.styleSpec=ht,o.sub=function(h,p,m){return h[0]=p[0]-m[0],h[1]=p[1]-m[1],h[2]=p[2]-m[2],h},o.symbolSize=Jn,o.transformMat3=function(h,p,m){var E=p[0],A=p[1],L=p[2];return h[0]=E*m[0]+A*m[3]+L*m[6],h[1]=E*m[1]+A*m[4]+L*m[7],h[2]=E*m[2]+A*m[5]+L*m[8],h},o.transformMat4=Tf,o.translate=function(h,p,m){var E,A,L,D,N,V,W,q,Q,it,ut,At,It=m[0],Wt=m[1],kt=m[2];return p===h?(h[12]=p[0]*It+p[4]*Wt+p[8]*kt+p[12],h[13]=p[1]*It+p[5]*Wt+p[9]*kt+p[13],h[14]=p[2]*It+p[6]*Wt+p[10]*kt+p[14],h[15]=p[3]*It+p[7]*Wt+p[11]*kt+p[15]):(A=p[1],L=p[2],D=p[3],N=p[4],V=p[5],W=p[6],q=p[7],Q=p[8],it=p[9],ut=p[10],At=p[11],h[0]=E=p[0],h[1]=A,h[2]=L,h[3]=D,h[4]=N,h[5]=V,h[6]=W,h[7]=q,h[8]=Q,h[9]=it,h[10]=ut,h[11]=At,h[12]=E*It+N*Wt+Q*kt+p[12],h[13]=A*It+V*Wt+it*kt+p[13],h[14]=L*It+W*Wt+ut*kt+p[14],h[15]=D*It+q*Wt+At*kt+p[15]),h},o.triggerPluginCompletionEvent=o1,o.uniqueId=I,o.validateCustomStyleLayer=function(h){var p=[],m=h.id;return m===void 0&&p.push({message:"layers."+m+': missing required property "id"'}),h.render===void 0&&p.push({message:"layers."+m+': missing required method "render"'}),h.renderingMode&&h.renderingMode!=="2d"&&h.renderingMode!=="3d"&&p.push({message:"layers."+m+': property "renderingMode" must be either "2d" or "3d"'}),p},o.validateLight=a1,o.validateStyle=Av,o.values=function(h){var p=[];for(var m in h)p.push(h[m]);return p},o.vectorTile=Tp,o.version="1.13.3",o.warnOnce=at,o.webpSupported=nr,o.window=d,o.wrap=S}),a(["./shared"],function(o){function s(tt){var nt=typeof tt;if(nt==="number"||nt==="boolean"||nt==="string"||tt==null)return JSON.stringify(tt);if(Array.isArray(tt)){for(var ot="[",yt=0,Rt=tt;yt<Rt.length;yt+=1)ot+=s(Rt[yt])+",";return ot+"]"}for(var jt=Object.keys(tt).sort(),Jt="{",ht=0;ht<jt.length;ht++)Jt+=JSON.stringify(jt[ht])+":"+s(tt[jt[ht]])+",";return Jt+"}"}function l(tt){for(var nt="",ot=0,yt=o.refProperties;ot<yt.length;ot+=1)nt+="/"+s(tt[yt[ot]]);return nt}var u=function(tt){this.keyCache={},tt&&this.replace(tt)};u.prototype.replace=function(tt){this._layerConfigs={},this._layers={},this.update(tt,[])},u.prototype.update=function(tt,nt){for(var ot=this,yt=0,Rt=tt;yt<Rt.length;yt+=1){var jt=Rt[yt];this._layerConfigs[jt.id]=jt;var Jt=this._layers[jt.id]=o.createStyleLayer(jt);Jt._featureFilter=o.featureFilter(Jt.filter),this.keyCache[jt.id]&&delete this.keyCache[jt.id]}for(var ht=0,Dt=nt;ht<Dt.length;ht+=1){var se=Dt[ht];delete this.keyCache[se],delete this._layerConfigs[se],delete this._layers[se]}this.familiesBySource={};for(var Pe=0,er=function(pr,mr){for(var Un={},Cr=0;Cr<pr.length;Cr++){var hi=mr&&mr[pr[Cr].id]||l(pr[Cr]);mr&&(mr[pr[Cr].id]=hi);var na=Un[hi];na||(na=Un[hi]=[]),na.push(pr[Cr])}var oi=[];for(var Ci in Un)oi.push(Un[Ci]);return oi}(o.values(this._layerConfigs),this.keyCache);Pe<er.length;Pe+=1){var Ae=er[Pe].map(function(pr){return ot._layers[pr.id]}),qe=Ae[0];if(qe.visibility!=="none"){var Yr=qe.source||"",Hr=this.familiesBySource[Yr];Hr||(Hr=this.familiesBySource[Yr]={});var Ie=qe.sourceLayer||"_geojsonTileLayer",Mr=Hr[Ie];Mr||(Mr=Hr[Ie]=[]),Mr.push(Ae)}}};var c=function(tt){var nt={},ot=[];for(var yt in tt){var Rt=tt[yt],jt=nt[yt]={};for(var Jt in Rt){var ht=Rt[+Jt];if(ht&&ht.bitmap.width!==0&&ht.bitmap.height!==0){var Dt={x:0,y:0,w:ht.bitmap.width+2,h:ht.bitmap.height+2};ot.push(Dt),jt[Jt]={rect:Dt,metrics:ht.metrics}}}}var se=o.potpack(ot),Pe=new o.AlphaImage({width:se.w||1,height:se.h||1});for(var er in tt){var Ae=tt[er];for(var qe in Ae){var Yr=Ae[+qe];if(Yr&&Yr.bitmap.width!==0&&Yr.bitmap.height!==0){var Hr=nt[er][qe].rect;o.AlphaImage.copy(Yr.bitmap,Pe,{x:0,y:0},{x:Hr.x+1,y:Hr.y+1},Yr.bitmap)}}}this.image=Pe,this.positions=nt};o.register("GlyphAtlas",c);var f=function(tt){this.tileID=new o.OverscaledTileID(tt.tileID.overscaledZ,tt.tileID.wrap,tt.tileID.canonical.z,tt.tileID.canonical.x,tt.tileID.canonical.y),this.uid=tt.uid,this.zoom=tt.zoom,this.pixelRatio=tt.pixelRatio,this.tileSize=tt.tileSize,this.source=tt.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=tt.showCollisionBoxes,this.collectResourceTiming=!!tt.collectResourceTiming,this.returnDependencies=!!tt.returnDependencies,this.promoteId=tt.promoteId};function d(tt,nt,ot){for(var yt=new o.EvaluationParameters(nt),Rt=0,jt=tt;Rt<jt.length;Rt+=1)jt[Rt].recalculate(yt,ot)}function v(tt,nt){var ot=o.getArrayBuffer(tt.request,function(yt,Rt,jt,Jt){yt?nt(yt):Rt&&nt(null,{vectorTile:new o.vectorTile.VectorTile(new o.pbf(Rt)),rawData:Rt,cacheControl:jt,expires:Jt})});return function(){ot.cancel(),nt()}}f.prototype.parse=function(tt,nt,ot,yt,Rt){var jt=this;this.status="parsing",this.data=tt,this.collisionBoxArray=new o.CollisionBoxArray;var Jt=new o.DictionaryCoder(Object.keys(tt.layers).sort()),ht=new o.FeatureIndex(this.tileID,this.promoteId);ht.bucketLayerIDs=[];var Dt,se,Pe,er,Ae={},qe={featureIndex:ht,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ot},Yr=nt.familiesBySource[this.source];for(var Hr in Yr){var Ie=tt.layers[Hr];if(Ie){Ie.version===1&&o.warnOnce('Vector tile source "'+this.source+'" layer "'+Hr+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Mr=Jt.encode(Hr),pr=[],mr=0;mr<Ie.length;mr++){var Un=Ie.feature(mr),Cr=ht.getId(Un,Hr);pr.push({feature:Un,id:Cr,index:mr,sourceLayerIndex:Mr})}for(var hi=0,na=Yr[Hr];hi<na.length;hi+=1){var oi=na[hi],Ci=oi[0];Ci.minzoom&&this.zoom<Math.floor(Ci.minzoom)||Ci.maxzoom&&this.zoom>=Ci.maxzoom||Ci.visibility!=="none"&&(d(oi,this.zoom,ot),(Ae[Ci.id]=Ci.createBucket({index:ht.bucketLayerIDs.length,layers:oi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Mr,sourceID:this.source})).populate(pr,qe,this.tileID.canonical),ht.bucketLayerIDs.push(oi.map(function(Bi){return Bi.id})))}}}var $n=o.mapObject(qe.glyphDependencies,function(Bi){return Object.keys(Bi).map(Number)});Object.keys($n).length?yt.send("getGlyphs",{uid:this.uid,stacks:$n},function(Bi,Hn){Dt||(Dt=Bi,se=Hn,ia.call(jt))}):se={};var go=Object.keys(qe.iconDependencies);go.length?yt.send("getImages",{icons:go,source:this.source,tileID:this.tileID,type:"icons"},function(Bi,Hn){Dt||(Dt=Bi,Pe=Hn,ia.call(jt))}):Pe={};var vi=Object.keys(qe.patternDependencies);function ia(){if(Dt)return Rt(Dt);if(se&&Pe&&er){var Bi=new c(se),Hn=new o.ImageAtlas(Pe,er);for(var si in Ae){var ws=Ae[si];ws instanceof o.SymbolBucket?(d(ws.layers,this.zoom,ot),o.performSymbolLayout(ws,se,Bi.positions,Pe,Hn.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):ws.hasPattern&&(ws instanceof o.LineBucket||ws instanceof o.FillBucket||ws instanceof o.FillExtrusionBucket)&&(d(ws.layers,this.zoom,ot),ws.addFeatures(qe,this.tileID.canonical,Hn.patternPositions))}this.status="done",Rt(null,{buckets:o.values(Ae).filter(function(nf){return!nf.isEmpty()}),featureIndex:ht,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Bi.image,imageAtlas:Hn,glyphMap:this.returnDependencies?se:null,iconMap:this.returnDependencies?Pe:null,glyphPositions:this.returnDependencies?Bi.positions:null})}}vi.length?yt.send("getImages",{icons:vi,source:this.source,tileID:this.tileID,type:"patterns"},function(Bi,Hn){Dt||(Dt=Bi,er=Hn,ia.call(jt))}):er={},ia.call(this)};var g=function(tt,nt,ot,yt){this.actor=tt,this.layerIndex=nt,this.availableImages=ot,this.loadVectorData=yt||v,this.loading={},this.loaded={}};g.prototype.loadTile=function(tt,nt){var ot=this,yt=tt.uid;this.loading||(this.loading={});var Rt=!!(tt&&tt.request&&tt.request.collectResourceTiming)&&new o.RequestPerformance(tt.request),jt=this.loading[yt]=new f(tt);jt.abort=this.loadVectorData(tt,function(Jt,ht){if(delete ot.loading[yt],Jt||!ht)return jt.status="done",ot.loaded[yt]=jt,nt(Jt);var Dt=ht.rawData,se={};ht.expires&&(se.expires=ht.expires),ht.cacheControl&&(se.cacheControl=ht.cacheControl);var Pe={};if(Rt){var er=Rt.finish();er&&(Pe.resourceTiming=JSON.parse(JSON.stringify(er)))}jt.vectorTile=ht.vectorTile,jt.parse(ht.vectorTile,ot.layerIndex,ot.availableImages,ot.actor,function(Ae,qe){if(Ae||!qe)return nt(Ae);nt(null,o.extend({rawTileData:Dt.slice(0)},qe,se,Pe))}),ot.loaded=ot.loaded||{},ot.loaded[yt]=jt})},g.prototype.reloadTile=function(tt,nt){var ot=this,yt=this.loaded,Rt=tt.uid,jt=this;if(yt&&yt[Rt]){var Jt=yt[Rt];Jt.showCollisionBoxes=tt.showCollisionBoxes;var ht=function(Dt,se){var Pe=Jt.reloadCallback;Pe&&(delete Jt.reloadCallback,Jt.parse(Jt.vectorTile,jt.layerIndex,ot.availableImages,jt.actor,Pe)),nt(Dt,se)};Jt.status==="parsing"?Jt.reloadCallback=ht:Jt.status==="done"&&(Jt.vectorTile?Jt.parse(Jt.vectorTile,this.layerIndex,this.availableImages,this.actor,ht):ht())}},g.prototype.abortTile=function(tt,nt){var ot=this.loading,yt=tt.uid;ot&&ot[yt]&&ot[yt].abort&&(ot[yt].abort(),delete ot[yt]),nt()},g.prototype.removeTile=function(tt,nt){var ot=this.loaded,yt=tt.uid;ot&&ot[yt]&&delete ot[yt],nt()};var x=o.window.ImageBitmap,w=function(){this.loaded={}};function S(tt,nt){if(tt.length!==0){M(tt[0],nt);for(var ot=1;ot<tt.length;ot++)M(tt[ot],!nt)}}function M(tt,nt){for(var ot=0,yt=0,Rt=0,jt=tt.length,Jt=jt-1;Rt<jt;Jt=Rt++){var ht=(tt[Rt][0]-tt[Jt][0])*(tt[Jt][1]+tt[Rt][1]),Dt=ot+ht;yt+=Math.abs(ot)>=Math.abs(ht)?ot-Dt+ht:ht-Dt+ot,ot=Dt}ot+yt>=0!=!!nt&&tt.reverse()}w.prototype.loadTile=function(tt,nt){var ot=tt.uid,yt=tt.encoding,Rt=tt.rawImageData,jt=x&&Rt instanceof x?this.getImageData(Rt):Rt,Jt=new o.DEMData(ot,jt,yt);this.loaded=this.loaded||{},this.loaded[ot]=Jt,nt(null,Jt)},w.prototype.getImageData=function(tt){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(tt.width,tt.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=tt.width,this.offscreenCanvas.height=tt.height,this.offscreenCanvasContext.drawImage(tt,0,0,tt.width,tt.height);var nt=this.offscreenCanvasContext.getImageData(-1,-1,tt.width+2,tt.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new o.RGBAImage({width:nt.width,height:nt.height},nt.data)},w.prototype.removeTile=function(tt){var nt=this.loaded,ot=tt.uid;nt&&nt[ot]&&delete nt[ot]};var R=o.vectorTile.VectorTileFeature.prototype.toGeoJSON,I=function(tt){this._feature=tt,this.extent=o.EXTENT,this.type=tt.type,this.properties=tt.tags,"id"in tt&&!isNaN(tt.id)&&(this.id=parseInt(tt.id,10))};I.prototype.loadGeometry=function(){if(this._feature.type===1){for(var tt=[],nt=0,ot=this._feature.geometry;nt<ot.length;nt+=1){var yt=ot[nt];tt.push([new o.Point$1(yt[0],yt[1])])}return tt}for(var Rt=[],jt=0,Jt=this._feature.geometry;jt<Jt.length;jt+=1){for(var ht=[],Dt=0,se=Jt[jt];Dt<se.length;Dt+=1){var Pe=se[Dt];ht.push(new o.Point$1(Pe[0],Pe[1]))}Rt.push(ht)}return Rt},I.prototype.toGeoJSON=function(tt,nt,ot){return R.call(this,tt,nt,ot)};var P=function(tt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=tt.length,this._features=tt};P.prototype.feature=function(tt){return new I(this._features[tt])};var k=o.vectorTile.VectorTileFeature,z=G;function G(tt,nt){this.options=nt||{},this.features=tt,this.length=tt.length}function J(tt,nt){this.id=typeof tt.id=="number"?tt.id:void 0,this.type=tt.type,this.rawGeometry=tt.type===1?[tt.geometry]:tt.geometry,this.properties=tt.tags,this.extent=nt||4096}G.prototype.feature=function(tt){return new J(this.features[tt],this.options.extent)},J.prototype.loadGeometry=function(){var tt=this.rawGeometry;this.geometry=[];for(var nt=0;nt<tt.length;nt++){for(var ot=tt[nt],yt=[],Rt=0;Rt<ot.length;Rt++)yt.push(new o.Point$1(ot[Rt][0],ot[Rt][1]));this.geometry.push(yt)}return this.geometry},J.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var tt=this.geometry,nt=1/0,ot=-1/0,yt=1/0,Rt=-1/0,jt=0;jt<tt.length;jt++)for(var Jt=tt[jt],ht=0;ht<Jt.length;ht++){var Dt=Jt[ht];nt=Math.min(nt,Dt.x),ot=Math.max(ot,Dt.x),yt=Math.min(yt,Dt.y),Rt=Math.max(Rt,Dt.y)}return[nt,yt,ot,Rt]},J.prototype.toGeoJSON=k.prototype.toGeoJSON;var Z=et,X=z;function et(tt){var nt=new o.pbf;return function(ot,yt){for(var Rt in ot.layers)yt.writeMessage(3,at,ot.layers[Rt])}(tt,nt),nt.finish()}function at(tt,nt){var ot;nt.writeVarintField(15,tt.version||1),nt.writeStringField(1,tt.name||""),nt.writeVarintField(5,tt.extent||4096);var yt={keys:[],values:[],keycache:{},valuecache:{}};for(ot=0;ot<tt.length;ot++)yt.feature=tt.feature(ot),nt.writeMessage(2,wt,yt);var Rt=yt.keys;for(ot=0;ot<Rt.length;ot++)nt.writeStringField(3,Rt[ot]);var jt=yt.values;for(ot=0;ot<jt.length;ot++)nt.writeMessage(4,Qt,jt[ot])}function wt(tt,nt){var ot=tt.feature;ot.id!==void 0&&nt.writeVarintField(1,ot.id),nt.writeMessage(2,Tt,tt),nt.writeVarintField(3,ot.type),nt.writeMessage(4,oe,ot)}function Tt(tt,nt){var ot=tt.feature,yt=tt.keys,Rt=tt.values,jt=tt.keycache,Jt=tt.valuecache;for(var ht in ot.properties){var Dt=jt[ht];Dt===void 0&&(yt.push(ht),jt[ht]=Dt=yt.length-1),nt.writeVarint(Dt);var se=ot.properties[ht],Pe=typeof se;Pe!=="string"&&Pe!=="boolean"&&Pe!=="number"&&(se=JSON.stringify(se));var er=Pe+":"+se,Ae=Jt[er];Ae===void 0&&(Rt.push(se),Jt[er]=Ae=Rt.length-1),nt.writeVarint(Ae)}}function vt(tt,nt){return(nt<<3)+(7&tt)}function zt(tt){return tt<<1^tt>>31}function oe(tt,nt){for(var ot=tt.loadGeometry(),yt=tt.type,Rt=0,jt=0,Jt=ot.length,ht=0;ht<Jt;ht++){var Dt=ot[ht],se=1;yt===1&&(se=Dt.length),nt.writeVarint(vt(1,se));for(var Pe=yt===3?Dt.length-1:Dt.length,er=0;er<Pe;er++){er===1&&yt!==1&&nt.writeVarint(vt(2,Pe-1));var Ae=Dt[er].x-Rt,qe=Dt[er].y-jt;nt.writeVarint(zt(Ae)),nt.writeVarint(zt(qe)),Rt+=Ae,jt+=qe}yt===3&&nt.writeVarint(vt(7,1))}}function Qt(tt,nt){var ot=typeof tt;ot==="string"?nt.writeStringField(1,tt):ot==="boolean"?nt.writeBooleanField(7,tt):ot==="number"&&(tt%1!=0?nt.writeDoubleField(3,tt):tt<0?nt.writeSVarintField(6,tt):nt.writeVarintField(5,tt))}function ne(tt,nt,ot,yt){de(tt,ot,yt),de(nt,2*ot,2*yt),de(nt,2*ot+1,2*yt+1)}function de(tt,nt,ot){var yt=tt[nt];tt[nt]=tt[ot],tt[ot]=yt}function De(tt,nt,ot,yt){var Rt=tt-ot,jt=nt-yt;return Rt*Rt+jt*jt}Z.fromVectorTileJs=et,Z.fromGeojsonVt=function(tt,nt){nt=nt||{};var ot={};for(var yt in tt)ot[yt]=new z(tt[yt].features,nt),ot[yt].name=yt,ot[yt].version=nt.version,ot[yt].extent=nt.extent;return et({layers:ot})},Z.GeoJSONWrapper=X;var Ze=function(tt){return tt[0]},ke=function(tt){return tt[1]},Be=function(tt,nt,ot,yt,Rt){nt===void 0&&(nt=Ze),ot===void 0&&(ot=ke),yt===void 0&&(yt=64),Rt===void 0&&(Rt=Float64Array),this.nodeSize=yt,this.points=tt;for(var jt=tt.length<65536?Uint16Array:Uint32Array,Jt=this.ids=new jt(tt.length),ht=this.coords=new Rt(2*tt.length),Dt=0;Dt<tt.length;Dt++)Jt[Dt]=Dt,ht[2*Dt]=nt(tt[Dt]),ht[2*Dt+1]=ot(tt[Dt]);(function se(Pe,er,Ae,qe,Yr,Hr){if(!(Yr-qe<=Ae)){var Ie=qe+Yr>>1;(function Mr(pr,mr,Un,Cr,hi,na){for(;hi>Cr;){if(hi-Cr>600){var oi=hi-Cr+1,Ci=Un-Cr+1,$n=Math.log(oi),go=.5*Math.exp(2*$n/3),vi=.5*Math.sqrt($n*go*(oi-go)/oi)*(Ci-oi/2<0?-1:1);Mr(pr,mr,Un,Math.max(Cr,Math.floor(Un-Ci*go/oi+vi)),Math.min(hi,Math.floor(Un+(oi-Ci)*go/oi+vi)),na)}var ia=mr[2*Un+na],Bi=Cr,Hn=hi;for(ne(pr,mr,Cr,Un),mr[2*hi+na]>ia&&ne(pr,mr,Cr,hi);Bi<Hn;){for(ne(pr,mr,Bi,Hn),Bi++,Hn--;mr[2*Bi+na]<ia;)Bi++;for(;mr[2*Hn+na]>ia;)Hn--}mr[2*Cr+na]===ia?ne(pr,mr,Cr,Hn):ne(pr,mr,++Hn,hi),Hn<=Un&&(Cr=Hn+1),Un<=Hn&&(hi=Hn-1)}})(Pe,er,Ie,qe,Yr,Hr%2),se(Pe,er,Ae,qe,Ie-1,Hr+1),se(Pe,er,Ae,Ie+1,Yr,Hr+1)}})(Jt,ht,yt,0,Jt.length-1,0)};Be.prototype.range=function(tt,nt,ot,yt){return function(Rt,jt,Jt,ht,Dt,se,Pe){for(var er,Ae,qe=[0,Rt.length-1,0],Yr=[];qe.length;){var Hr=qe.pop(),Ie=qe.pop(),Mr=qe.pop();if(Ie-Mr<=Pe)for(var pr=Mr;pr<=Ie;pr++)Ae=jt[2*pr+1],(er=jt[2*pr])>=Jt&&er<=Dt&&Ae>=ht&&Ae<=se&&Yr.push(Rt[pr]);else{var mr=Math.floor((Mr+Ie)/2);Ae=jt[2*mr+1],(er=jt[2*mr])>=Jt&&er<=Dt&&Ae>=ht&&Ae<=se&&Yr.push(Rt[mr]);var Un=(Hr+1)%2;(Hr===0?Jt<=er:ht<=Ae)&&(qe.push(Mr),qe.push(mr-1),qe.push(Un)),(Hr===0?Dt>=er:se>=Ae)&&(qe.push(mr+1),qe.push(Ie),qe.push(Un))}}return Yr}(this.ids,this.coords,tt,nt,ot,yt,this.nodeSize)},Be.prototype.within=function(tt,nt,ot){return function(yt,Rt,jt,Jt,ht,Dt){for(var se=[0,yt.length-1,0],Pe=[],er=ht*ht;se.length;){var Ae=se.pop(),qe=se.pop(),Yr=se.pop();if(qe-Yr<=Dt)for(var Hr=Yr;Hr<=qe;Hr++)De(Rt[2*Hr],Rt[2*Hr+1],jt,Jt)<=er&&Pe.push(yt[Hr]);else{var Ie=Math.floor((Yr+qe)/2),Mr=Rt[2*Ie],pr=Rt[2*Ie+1];De(Mr,pr,jt,Jt)<=er&&Pe.push(yt[Ie]);var mr=(Ae+1)%2;(Ae===0?jt-ht<=Mr:Jt-ht<=pr)&&(se.push(Yr),se.push(Ie-1),se.push(mr)),(Ae===0?jt+ht>=Mr:Jt+ht>=pr)&&(se.push(Ie+1),se.push(qe),se.push(mr))}}return Pe}(this.ids,this.coords,tt,nt,ot,this.nodeSize)};var Zr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(tt){return tt}},Wr=function(tt){this.options=xn(Object.create(Zr),tt),this.trees=new Array(this.options.maxZoom+1)};function In(tt,nt,ot,yt,Rt){return{x:tt,y:nt,zoom:1/0,id:ot,parentId:-1,numPoints:yt,properties:Rt}}function re(tt,nt){var ot=tt.geometry.coordinates,yt=ot[1];return{x:Ne(ot[0]),y:Vr(yt),zoom:1/0,index:nt,parentId:-1}}function nr(tt){return{type:"Feature",id:tt.id,properties:zr(tt),geometry:{type:"Point",coordinates:[(yt=tt.x,360*(yt-.5)),(nt=tt.y,ot=(180-360*nt)*Math.PI/180,360*Math.atan(Math.exp(ot))/Math.PI-90)]}};var nt,ot,yt}function zr(tt){var nt=tt.numPoints,ot=nt>=1e4?Math.round(nt/1e3)+"k":nt>=1e3?Math.round(nt/100)/10+"k":nt;return xn(xn({},tt.properties),{cluster:!0,cluster_id:tt.id,point_count:nt,point_count_abbreviated:ot})}function Ne(tt){return tt/360+.5}function Vr(tt){var nt=Math.sin(tt*Math.PI/180),ot=.5-.25*Math.log((1+nt)/(1-nt))/Math.PI;return ot<0?0:ot>1?1:ot}function xn(tt,nt){for(var ot in nt)tt[ot]=nt[ot];return tt}function Qn(tt){return tt.x}function gn(tt){return tt.y}function bn(tt,nt,ot,yt,Rt,jt){var Jt=Rt-ot,ht=jt-yt;if(Jt!==0||ht!==0){var Dt=((tt-ot)*Jt+(nt-yt)*ht)/(Jt*Jt+ht*ht);Dt>1?(ot=Rt,yt=jt):Dt>0&&(ot+=Jt*Dt,yt+=ht*Dt)}return(Jt=tt-ot)*Jt+(ht=nt-yt)*ht}function ci(tt,nt,ot,yt){var Rt={id:tt===void 0?null:tt,type:nt,geometry:ot,tags:yt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(jt){var Jt=jt.geometry,ht=jt.type;if(ht==="Point"||ht==="MultiPoint"||ht==="LineString")Mo(jt,Jt);else if(ht==="Polygon"||ht==="MultiLineString")for(var Dt=0;Dt<Jt.length;Dt++)Mo(jt,Jt[Dt]);else if(ht==="MultiPolygon")for(Dt=0;Dt<Jt.length;Dt++)for(var se=0;se<Jt[Dt].length;se++)Mo(jt,Jt[Dt][se])}(Rt),Rt}function Mo(tt,nt){for(var ot=0;ot<nt.length;ot+=3)tt.minX=Math.min(tt.minX,nt[ot]),tt.minY=Math.min(tt.minY,nt[ot+1]),tt.maxX=Math.max(tt.maxX,nt[ot]),tt.maxY=Math.max(tt.maxY,nt[ot+1])}function ra(tt,nt,ot,yt){if(nt.geometry){var Rt=nt.geometry.coordinates,jt=nt.geometry.type,Jt=Math.pow(ot.tolerance/((1<<ot.maxZoom)*ot.extent),2),ht=[],Dt=nt.id;if(ot.promoteId?Dt=nt.properties[ot.promoteId]:ot.generateId&&(Dt=yt||0),jt==="Point")la(Rt,ht);else if(jt==="MultiPoint")for(var se=0;se<Rt.length;se++)la(Rt[se],ht);else if(jt==="LineString")os(Rt,ht,Jt,!1);else if(jt==="MultiLineString"){if(ot.lineMetrics){for(se=0;se<Rt.length;se++)os(Rt[se],ht=[],Jt,!1),tt.push(ci(Dt,"LineString",ht,nt.properties));return}Et(Rt,ht,Jt,!1)}else if(jt==="Polygon")Et(Rt,ht,Jt,!0);else{if(jt!=="MultiPolygon"){if(jt==="GeometryCollection"){for(se=0;se<nt.geometry.geometries.length;se++)ra(tt,{id:Dt,geometry:nt.geometry.geometries[se],properties:nt.properties},ot,yt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(se=0;se<Rt.length;se++){var Pe=[];Et(Rt[se],Pe,Jt,!0),ht.push(Pe)}}tt.push(ci(Dt,jt,ht,nt.properties))}}function la(tt,nt){nt.push(ss(tt[0])),nt.push(_u(tt[1])),nt.push(0)}function os(tt,nt,ot,yt){for(var Rt,jt,Jt=0,ht=0;ht<tt.length;ht++){var Dt=ss(tt[ht][0]),se=_u(tt[ht][1]);nt.push(Dt),nt.push(se),nt.push(0),ht>0&&(Jt+=yt?(Rt*se-Dt*jt)/2:Math.sqrt(Math.pow(Dt-Rt,2)+Math.pow(se-jt,2))),Rt=Dt,jt=se}var Pe=nt.length-3;nt[2]=1,function er(Ae,qe,Yr,Hr){for(var Ie,Mr=Hr,pr=Yr-qe>>1,mr=Yr-qe,Un=Ae[qe],Cr=Ae[qe+1],hi=Ae[Yr],na=Ae[Yr+1],oi=qe+3;oi<Yr;oi+=3){var Ci=bn(Ae[oi],Ae[oi+1],Un,Cr,hi,na);if(Ci>Mr)Ie=oi,Mr=Ci;else if(Ci===Mr){var $n=Math.abs(oi-pr);$n<mr&&(Ie=oi,mr=$n)}}Mr>Hr&&(Ie-qe>3&&er(Ae,qe,Ie,Hr),Ae[Ie+2]=Mr,Yr-Ie>3&&er(Ae,Ie,Yr,Hr))}(nt,0,Pe,ot),nt[Pe+2]=1,nt.size=Math.abs(Jt),nt.start=0,nt.end=nt.size}function Et(tt,nt,ot,yt){for(var Rt=0;Rt<tt.length;Rt++){var jt=[];os(tt[Rt],jt,ot,yt),nt.push(jt)}}function ss(tt){return tt/360+.5}function _u(tt){var nt=Math.sin(tt*Math.PI/180),ot=.5-.25*Math.log((1+nt)/(1-nt))/Math.PI;return ot<0?0:ot>1?1:ot}function ls(tt,nt,ot,yt,Rt,jt,Jt,ht){if(yt/=nt,jt>=(ot/=nt)&&Jt<yt)return tt;if(Jt<ot||jt>=yt)return null;for(var Dt=[],se=0;se<tt.length;se++){var Pe=tt[se],er=Pe.geometry,Ae=Pe.type,qe=Rt===0?Pe.minX:Pe.minY,Yr=Rt===0?Pe.maxX:Pe.maxY;if(qe>=ot&&Yr<yt)Dt.push(Pe);else if(!(Yr<ot||qe>=yt)){var Hr=[];if(Ae==="Point"||Ae==="MultiPoint")Xu(er,Hr,ot,yt,Rt);else if(Ae==="LineString")ma(er,Hr,ot,yt,Rt,!1,ht.lineMetrics);else if(Ae==="MultiLineString")ol(er,Hr,ot,yt,Rt,!1);else if(Ae==="Polygon")ol(er,Hr,ot,yt,Rt,!0);else if(Ae==="MultiPolygon")for(var Ie=0;Ie<er.length;Ie++){var Mr=[];ol(er[Ie],Mr,ot,yt,Rt,!0),Mr.length&&Hr.push(Mr)}if(Hr.length){if(ht.lineMetrics&&Ae==="LineString"){for(Ie=0;Ie<Hr.length;Ie++)Dt.push(ci(Pe.id,Ae,Hr[Ie],Pe.tags));continue}Ae!=="LineString"&&Ae!=="MultiLineString"||(Hr.length===1?(Ae="LineString",Hr=Hr[0]):Ae="MultiLineString"),Ae!=="Point"&&Ae!=="MultiPoint"||(Ae=Hr.length===3?"Point":"MultiPoint"),Dt.push(ci(Pe.id,Ae,Hr,Pe.tags))}}}return Dt.length?Dt:null}function Xu(tt,nt,ot,yt,Rt){for(var jt=0;jt<tt.length;jt+=3){var Jt=tt[jt+Rt];Jt>=ot&&Jt<=yt&&(nt.push(tt[jt]),nt.push(tt[jt+1]),nt.push(tt[jt+2]))}}function ma(tt,nt,ot,yt,Rt,jt,Jt){for(var ht,Dt,se=us(tt),Pe=Rt===0?vc:vo,er=tt.start,Ae=0;Ae<tt.length-3;Ae+=3){var qe=tt[Ae],Yr=tt[Ae+1],Hr=tt[Ae+2],Ie=tt[Ae+3],Mr=tt[Ae+4],pr=Rt===0?qe:Yr,mr=Rt===0?Ie:Mr,Un=!1;Jt&&(ht=Math.sqrt(Math.pow(qe-Ie,2)+Math.pow(Yr-Mr,2))),pr<ot?mr>ot&&(Dt=Pe(se,qe,Yr,Ie,Mr,ot),Jt&&(se.start=er+ht*Dt)):pr>yt?mr<yt&&(Dt=Pe(se,qe,Yr,Ie,Mr,yt),Jt&&(se.start=er+ht*Dt)):cs(se,qe,Yr,Hr),mr<ot&&pr>=ot&&(Dt=Pe(se,qe,Yr,Ie,Mr,ot),Un=!0),mr>yt&&pr<=yt&&(Dt=Pe(se,qe,Yr,Ie,Mr,yt),Un=!0),!jt&&Un&&(Jt&&(se.end=er+ht*Dt),nt.push(se),se=us(tt)),Jt&&(er+=ht)}var Cr=tt.length-3;qe=tt[Cr],Yr=tt[Cr+1],Hr=tt[Cr+2],(pr=Rt===0?qe:Yr)>=ot&&pr<=yt&&cs(se,qe,Yr,Hr),Cr=se.length-3,jt&&Cr>=3&&(se[Cr]!==se[0]||se[Cr+1]!==se[1])&&cs(se,se[0],se[1],se[2]),se.length&&nt.push(se)}function us(tt){var nt=[];return nt.size=tt.size,nt.start=tt.start,nt.end=tt.end,nt}function ol(tt,nt,ot,yt,Rt,jt){for(var Jt=0;Jt<tt.length;Jt++)ma(tt[Jt],nt,ot,yt,Rt,jt,!1)}function cs(tt,nt,ot,yt){tt.push(nt),tt.push(ot),tt.push(yt)}function vc(tt,nt,ot,yt,Rt,jt){var Jt=(jt-nt)/(yt-nt);return tt.push(jt),tt.push(ot+(Rt-ot)*Jt),tt.push(1),Jt}function vo(tt,nt,ot,yt,Rt,jt){var Jt=(jt-ot)/(Rt-ot);return tt.push(nt+(yt-nt)*Jt),tt.push(jt),tt.push(1),Jt}function ju(tt,nt){for(var ot=[],yt=0;yt<tt.length;yt++){var Rt,jt=tt[yt],Jt=jt.type;if(Jt==="Point"||Jt==="MultiPoint"||Jt==="LineString")Rt=Ml(jt.geometry,nt);else if(Jt==="MultiLineString"||Jt==="Polygon"){Rt=[];for(var ht=0;ht<jt.geometry.length;ht++)Rt.push(Ml(jt.geometry[ht],nt))}else if(Jt==="MultiPolygon")for(Rt=[],ht=0;ht<jt.geometry.length;ht++){for(var Dt=[],se=0;se<jt.geometry[ht].length;se++)Dt.push(Ml(jt.geometry[ht][se],nt));Rt.push(Dt)}ot.push(ci(jt.id,Jt,Rt,jt.tags))}return ot}function Ml(tt,nt){var ot=[];ot.size=tt.size,tt.start!==void 0&&(ot.start=tt.start,ot.end=tt.end);for(var yt=0;yt<tt.length;yt+=3)ot.push(tt[yt]+nt,tt[yt+1],tt[yt+2]);return ot}function dh(tt,nt){if(tt.transformed)return tt;var ot,yt,Rt,jt=1<<tt.z,Jt=tt.x,ht=tt.y;for(ot=0;ot<tt.features.length;ot++){var Dt=tt.features[ot],se=Dt.geometry,Pe=Dt.type;if(Dt.geometry=[],Pe===1)for(yt=0;yt<se.length;yt+=2)Dt.geometry.push(ud(se[yt],se[yt+1],nt,jt,Jt,ht));else for(yt=0;yt<se.length;yt++){var er=[];for(Rt=0;Rt<se[yt].length;Rt+=2)er.push(ud(se[yt][Rt],se[yt][Rt+1],nt,jt,Jt,ht));Dt.geometry.push(er)}}return tt.transformed=!0,tt}function ud(tt,nt,ot,yt,Rt,jt){return[Math.round(ot*(tt*yt-Rt)),Math.round(ot*(nt*yt-jt))]}function ph(tt,nt,ot,yt,Rt){for(var jt=nt===Rt.maxZoom?0:Rt.tolerance/((1<<nt)*Rt.extent),Jt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ot,y:yt,z:nt,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ht=0;ht<tt.length;ht++){Jt.numFeatures++,sp(Jt,tt[ht],jt,Rt);var Dt=tt[ht].minX,se=tt[ht].minY,Pe=tt[ht].maxX,er=tt[ht].maxY;Dt<Jt.minX&&(Jt.minX=Dt),se<Jt.minY&&(Jt.minY=se),Pe>Jt.maxX&&(Jt.maxX=Pe),er>Jt.maxY&&(Jt.maxY=er)}return Jt}function sp(tt,nt,ot,yt){var Rt=nt.geometry,jt=nt.type,Jt=[];if(jt==="Point"||jt==="MultiPoint")for(var ht=0;ht<Rt.length;ht+=3)Jt.push(Rt[ht]),Jt.push(Rt[ht+1]),tt.numPoints++,tt.numSimplified++;else if(jt==="LineString")vh(Jt,Rt,tt,ot,!1,!1);else if(jt==="MultiLineString"||jt==="Polygon")for(ht=0;ht<Rt.length;ht++)vh(Jt,Rt[ht],tt,ot,jt==="Polygon",ht===0);else if(jt==="MultiPolygon")for(var Dt=0;Dt<Rt.length;Dt++){var se=Rt[Dt];for(ht=0;ht<se.length;ht++)vh(Jt,se[ht],tt,ot,!0,ht===0)}if(Jt.length){var Pe=nt.tags||null;if(jt==="LineString"&&yt.lineMetrics){for(var er in Pe={},nt.tags)Pe[er]=nt.tags[er];Pe.mapbox_clip_start=Rt.start/Rt.size,Pe.mapbox_clip_end=Rt.end/Rt.size}var Ae={geometry:Jt,type:jt==="Polygon"||jt==="MultiPolygon"?3:jt==="LineString"||jt==="MultiLineString"?2:1,tags:Pe};nt.id!==null&&(Ae.id=nt.id),tt.features.push(Ae)}}function vh(tt,nt,ot,yt,Rt,jt){var Jt=yt*yt;if(yt>0&&nt.size<(Rt?Jt:yt))ot.numPoints+=nt.length/3;else{for(var ht=[],Dt=0;Dt<nt.length;Dt+=3)(yt===0||nt[Dt+2]>Jt)&&(ot.numSimplified++,ht.push(nt[Dt]),ht.push(nt[Dt+1])),ot.numPoints++;Rt&&function(se,Pe){for(var er=0,Ae=0,qe=se.length,Yr=qe-2;Ae<qe;Yr=Ae,Ae+=2)er+=(se[Ae]-se[Yr])*(se[Ae+1]+se[Yr+1]);if(er>0===Pe)for(Ae=0,qe=se.length;Ae<qe/2;Ae+=2){var Hr=se[Ae],Ie=se[Ae+1];se[Ae]=se[qe-2-Ae],se[Ae+1]=se[qe-1-Ae],se[qe-2-Ae]=Hr,se[qe-1-Ae]=Ie}}(ht,jt),tt.push(ht)}}function ql(tt,nt){var ot=(nt=this.options=function(Rt,jt){for(var Jt in jt)Rt[Jt]=jt[Jt];return Rt}(Object.create(this.options),nt)).debug;if(ot&&console.time("preprocess data"),nt.maxZoom<0||nt.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(nt.promoteId&&nt.generateId)throw new Error("promoteId and generateId cannot be used together.");var yt=function(Rt,jt){var Jt=[];if(Rt.type==="FeatureCollection")for(var ht=0;ht<Rt.features.length;ht++)ra(Jt,Rt.features[ht],jt,ht);else ra(Jt,Rt.type==="Feature"?Rt:{geometry:Rt},jt);return Jt}(tt,nt);this.tiles={},this.tileCoords=[],ot&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",nt.indexMaxZoom,nt.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(yt=function(Rt,jt){var Jt=jt.buffer/jt.extent,ht=Rt,Dt=ls(Rt,1,-1-Jt,Jt,0,-1,2,jt),se=ls(Rt,1,1-Jt,2+Jt,0,-1,2,jt);return(Dt||se)&&(ht=ls(Rt,1,-Jt,1+Jt,0,-1,2,jt)||[],Dt&&(ht=ju(Dt,1).concat(ht)),se&&(ht=ht.concat(ju(se,-1)))),ht}(yt,nt)).length&&this.splitTile(yt,0,0,0),ot&&(yt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Kl(tt,nt,ot){return 32*((1<<tt)*ot+nt)+tt}function gc(tt,nt){var ot=tt.tileID.canonical;if(!this._geoJSONIndex)return nt(null,null);var yt=this._geoJSONIndex.getTile(ot.z,ot.x,ot.y);if(!yt)return nt(null,null);var Rt=new P(yt.features),jt=Z(Rt);jt.byteOffset===0&&jt.byteLength===jt.buffer.byteLength||(jt=new Uint8Array(jt)),nt(null,{vectorTile:Rt,rawData:jt.buffer})}Wr.prototype.load=function(tt){var nt=this.options,ot=nt.log,yt=nt.minZoom,Rt=nt.maxZoom,jt=nt.nodeSize;ot&&console.time("total time");var Jt="prepare "+tt.length+" points";ot&&console.time(Jt),this.points=tt;for(var ht=[],Dt=0;Dt<tt.length;Dt++)tt[Dt].geometry&&ht.push(re(tt[Dt],Dt));this.trees[Rt+1]=new Be(ht,Qn,gn,jt,Float32Array),ot&&console.timeEnd(Jt);for(var se=Rt;se>=yt;se--){var Pe=+Date.now();ht=this._cluster(ht,se),this.trees[se]=new Be(ht,Qn,gn,jt,Float32Array),ot&&console.log("z%d: %d clusters in %dms",se,ht.length,+Date.now()-Pe)}return ot&&console.timeEnd("total time"),this},Wr.prototype.getClusters=function(tt,nt){var ot=((tt[0]+180)%360+360)%360-180,yt=Math.max(-90,Math.min(90,tt[1])),Rt=tt[2]===180?180:((tt[2]+180)%360+360)%360-180,jt=Math.max(-90,Math.min(90,tt[3]));if(tt[2]-tt[0]>=360)ot=-180,Rt=180;else if(ot>Rt){var Jt=this.getClusters([ot,yt,180,jt],nt),ht=this.getClusters([-180,yt,Rt,jt],nt);return Jt.concat(ht)}for(var Dt=this.trees[this._limitZoom(nt)],se=[],Pe=0,er=Dt.range(Ne(ot),Vr(jt),Ne(Rt),Vr(yt));Pe<er.length;Pe+=1){var Ae=Dt.points[er[Pe]];se.push(Ae.numPoints?nr(Ae):this.points[Ae.index])}return se},Wr.prototype.getChildren=function(tt){var nt=this._getOriginId(tt),ot=this._getOriginZoom(tt),yt="No cluster with the specified id.",Rt=this.trees[ot];if(!Rt)throw new Error(yt);var jt=Rt.points[nt];if(!jt)throw new Error(yt);for(var Jt=this.options.radius/(this.options.extent*Math.pow(2,ot-1)),ht=[],Dt=0,se=Rt.within(jt.x,jt.y,Jt);Dt<se.length;Dt+=1){var Pe=Rt.points[se[Dt]];Pe.parentId===tt&&ht.push(Pe.numPoints?nr(Pe):this.points[Pe.index])}if(ht.length===0)throw new Error(yt);return ht},Wr.prototype.getLeaves=function(tt,nt,ot){var yt=[];return this._appendLeaves(yt,tt,nt=nt||10,ot=ot||0,0),yt},Wr.prototype.getTile=function(tt,nt,ot){var yt=this.trees[this._limitZoom(tt)],Rt=Math.pow(2,tt),jt=this.options,Jt=jt.radius/jt.extent,ht=(ot-Jt)/Rt,Dt=(ot+1+Jt)/Rt,se={features:[]};return this._addTileFeatures(yt.range((nt-Jt)/Rt,ht,(nt+1+Jt)/Rt,Dt),yt.points,nt,ot,Rt,se),nt===0&&this._addTileFeatures(yt.range(1-Jt/Rt,ht,1,Dt),yt.points,Rt,ot,Rt,se),nt===Rt-1&&this._addTileFeatures(yt.range(0,ht,Jt/Rt,Dt),yt.points,-1,ot,Rt,se),se.features.length?se:null},Wr.prototype.getClusterExpansionZoom=function(tt){for(var nt=this._getOriginZoom(tt)-1;nt<=this.options.maxZoom;){var ot=this.getChildren(tt);if(nt++,ot.length!==1)break;tt=ot[0].properties.cluster_id}return nt},Wr.prototype._appendLeaves=function(tt,nt,ot,yt,Rt){for(var jt=0,Jt=this.getChildren(nt);jt<Jt.length;jt+=1){var ht=Jt[jt],Dt=ht.properties;if(Dt&&Dt.cluster?Rt+Dt.point_count<=yt?Rt+=Dt.point_count:Rt=this._appendLeaves(tt,Dt.cluster_id,ot,yt,Rt):Rt<yt?Rt++:tt.push(ht),tt.length===ot)break}return Rt},Wr.prototype._addTileFeatures=function(tt,nt,ot,yt,Rt,jt){for(var Jt=0,ht=tt;Jt<ht.length;Jt+=1){var Dt=nt[ht[Jt]],se=Dt.numPoints,Pe={type:1,geometry:[[Math.round(this.options.extent*(Dt.x*Rt-ot)),Math.round(this.options.extent*(Dt.y*Rt-yt))]],tags:se?zr(Dt):this.points[Dt.index].properties},er=void 0;se?er=Dt.id:this.options.generateId?er=Dt.index:this.points[Dt.index].id&&(er=this.points[Dt.index].id),er!==void 0&&(Pe.id=er),jt.features.push(Pe)}},Wr.prototype._limitZoom=function(tt){return Math.max(this.options.minZoom,Math.min(+tt,this.options.maxZoom+1))},Wr.prototype._cluster=function(tt,nt){for(var ot=[],yt=this.options,Rt=yt.reduce,jt=yt.minPoints,Jt=yt.radius/(yt.extent*Math.pow(2,nt)),ht=0;ht<tt.length;ht++){var Dt=tt[ht];if(!(Dt.zoom<=nt)){Dt.zoom=nt;for(var se=this.trees[nt+1],Pe=se.within(Dt.x,Dt.y,Jt),er=Dt.numPoints||1,Ae=er,qe=0,Yr=Pe;qe<Yr.length;qe+=1){var Hr=se.points[Yr[qe]];Hr.zoom>nt&&(Ae+=Hr.numPoints||1)}if(Ae>=jt){for(var Ie=Dt.x*er,Mr=Dt.y*er,pr=Rt&&er>1?this._map(Dt,!0):null,mr=(ht<<5)+(nt+1)+this.points.length,Un=0,Cr=Pe;Un<Cr.length;Un+=1){var hi=se.points[Cr[Un]];if(!(hi.zoom<=nt)){hi.zoom=nt;var na=hi.numPoints||1;Ie+=hi.x*na,Mr+=hi.y*na,hi.parentId=mr,Rt&&(pr||(pr=this._map(Dt,!0)),Rt(pr,this._map(hi)))}}Dt.parentId=mr,ot.push(In(Ie/Ae,Mr/Ae,mr,Ae,pr))}else if(ot.push(Dt),Ae>1)for(var oi=0,Ci=Pe;oi<Ci.length;oi+=1){var $n=se.points[Ci[oi]];$n.zoom<=nt||($n.zoom=nt,ot.push($n))}}}return ot},Wr.prototype._getOriginId=function(tt){return tt-this.points.length>>5},Wr.prototype._getOriginZoom=function(tt){return(tt-this.points.length)%32},Wr.prototype._map=function(tt,nt){if(tt.numPoints)return nt?xn({},tt.properties):tt.properties;var ot=this.points[tt.index].properties,yt=this.options.map(ot);return nt&&yt===ot?xn({},yt):yt},ql.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ql.prototype.splitTile=function(tt,nt,ot,yt,Rt,jt,Jt){for(var ht=[tt,nt,ot,yt],Dt=this.options,se=Dt.debug;ht.length;){yt=ht.pop(),ot=ht.pop(),nt=ht.pop(),tt=ht.pop();var Pe=1<<nt,er=Kl(nt,ot,yt),Ae=this.tiles[er];if(!Ae&&(se>1&&console.time("creation"),Ae=this.tiles[er]=ph(tt,nt,ot,yt,Dt),this.tileCoords.push({z:nt,x:ot,y:yt}),se)){se>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",nt,ot,yt,Ae.numFeatures,Ae.numPoints,Ae.numSimplified),console.timeEnd("creation"));var qe="z"+nt;this.stats[qe]=(this.stats[qe]||0)+1,this.total++}if(Ae.source=tt,Rt){if(nt===Dt.maxZoom||nt===Rt)continue;var Yr=1<<Rt-nt;if(ot!==Math.floor(jt/Yr)||yt!==Math.floor(Jt/Yr))continue}else if(nt===Dt.indexMaxZoom||Ae.numPoints<=Dt.indexMaxPoints)continue;if(Ae.source=null,tt.length!==0){se>1&&console.time("clipping");var Hr,Ie,Mr,pr,mr,Un,Cr=.5*Dt.buffer/Dt.extent,hi=.5-Cr,na=.5+Cr,oi=1+Cr;Hr=Ie=Mr=pr=null,mr=ls(tt,Pe,ot-Cr,ot+na,0,Ae.minX,Ae.maxX,Dt),Un=ls(tt,Pe,ot+hi,ot+oi,0,Ae.minX,Ae.maxX,Dt),tt=null,mr&&(Hr=ls(mr,Pe,yt-Cr,yt+na,1,Ae.minY,Ae.maxY,Dt),Ie=ls(mr,Pe,yt+hi,yt+oi,1,Ae.minY,Ae.maxY,Dt),mr=null),Un&&(Mr=ls(Un,Pe,yt-Cr,yt+na,1,Ae.minY,Ae.maxY,Dt),pr=ls(Un,Pe,yt+hi,yt+oi,1,Ae.minY,Ae.maxY,Dt),Un=null),se>1&&console.timeEnd("clipping"),ht.push(Hr||[],nt+1,2*ot,2*yt),ht.push(Ie||[],nt+1,2*ot,2*yt+1),ht.push(Mr||[],nt+1,2*ot+1,2*yt),ht.push(pr||[],nt+1,2*ot+1,2*yt+1)}}},ql.prototype.getTile=function(tt,nt,ot){var yt=this.options,Rt=yt.extent,jt=yt.debug;if(tt<0||tt>24)return null;var Jt=1<<tt,ht=Kl(tt,nt=(nt%Jt+Jt)%Jt,ot);if(this.tiles[ht])return dh(this.tiles[ht],Rt);jt>1&&console.log("drilling down to z%d-%d-%d",tt,nt,ot);for(var Dt,se=tt,Pe=nt,er=ot;!Dt&&se>0;)se--,Pe=Math.floor(Pe/2),er=Math.floor(er/2),Dt=this.tiles[Kl(se,Pe,er)];return Dt&&Dt.source?(jt>1&&console.log("found parent tile z%d-%d-%d",se,Pe,er),jt>1&&console.time("drilling down"),this.splitTile(Dt.source,se,Pe,er,tt,nt,ot),jt>1&&console.timeEnd("drilling down"),this.tiles[ht]?dh(this.tiles[ht],Rt):null):null};var cd=function(tt){function nt(ot,yt,Rt,jt){tt.call(this,ot,yt,Rt,gc),jt&&(this.loadGeoJSON=jt)}return tt&&(nt.__proto__=tt),(nt.prototype=Object.create(tt&&tt.prototype)).constructor=nt,nt.prototype.loadData=function(ot,yt){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=yt,this._pendingLoadDataParams=ot,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},nt.prototype._loadData=function(){var ot=this;if(this._pendingCallback&&this._pendingLoadDataParams){var yt=this._pendingCallback,Rt=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var jt=!!(Rt&&Rt.request&&Rt.request.collectResourceTiming)&&new o.RequestPerformance(Rt.request);this.loadGeoJSON(Rt,function(Jt,ht){if(Jt||!ht)return yt(Jt);if(typeof ht!="object")return yt(new Error("Input data given to '"+Rt.source+"' is not a valid GeoJSON object."));(function Ae(qe,Yr){var Hr,Ie=qe&&qe.type;if(Ie==="FeatureCollection")for(Hr=0;Hr<qe.features.length;Hr++)Ae(qe.features[Hr],Yr);else if(Ie==="GeometryCollection")for(Hr=0;Hr<qe.geometries.length;Hr++)Ae(qe.geometries[Hr],Yr);else if(Ie==="Feature")Ae(qe.geometry,Yr);else if(Ie==="Polygon")S(qe.coordinates,Yr);else if(Ie==="MultiPolygon")for(Hr=0;Hr<qe.coordinates.length;Hr++)S(qe.coordinates[Hr],Yr);return qe})(ht,!0);try{if(Rt.filter){var Dt=o.createExpression(Rt.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Dt.result==="error")throw new Error(Dt.value.map(function(Ae){return Ae.key+": "+Ae.message}).join(", "));var se=ht.features.filter(function(Ae){return Dt.value.evaluate({zoom:0},Ae)});ht={type:"FeatureCollection",features:se}}ot._geoJSONIndex=Rt.cluster?new Wr(function(Ae){var qe=Ae.superclusterOptions,Yr=Ae.clusterProperties;if(!Yr||!qe)return qe;for(var Hr={},Ie={},Mr={accumulated:null,zoom:0},pr={properties:null},mr=Object.keys(Yr),Un=0,Cr=mr;Un<Cr.length;Un+=1){var hi=Cr[Un],na=Yr[hi],oi=na[0],Ci=o.createExpression(na[1]),$n=o.createExpression(typeof oi=="string"?[oi,["accumulated"],["get",hi]]:oi);Hr[hi]=Ci.value,Ie[hi]=$n.value}return qe.map=function(go){pr.properties=go;for(var vi={},ia=0,Bi=mr;ia<Bi.length;ia+=1){var Hn=Bi[ia];vi[Hn]=Hr[Hn].evaluate(Mr,pr)}return vi},qe.reduce=function(go,vi){pr.properties=vi;for(var ia=0,Bi=mr;ia<Bi.length;ia+=1){var Hn=Bi[ia];Mr.accumulated=go[Hn],go[Hn]=Ie[Hn].evaluate(Mr,pr)}},qe}(Rt)).load(ht.features):function(Ae,qe){return new ql(Ae,qe)}(ht,Rt.geojsonVtOptions)}catch(Ae){return yt(Ae)}ot.loaded={};var Pe={};if(jt){var er=jt.finish();er&&(Pe.resourceTiming={},Pe.resourceTiming[Rt.source]=JSON.parse(JSON.stringify(er)))}yt(null,Pe)})}},nt.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},nt.prototype.reloadTile=function(ot,yt){var Rt=this.loaded;return Rt&&Rt[ot.uid]?tt.prototype.reloadTile.call(this,ot,yt):this.loadTile(ot,yt)},nt.prototype.loadGeoJSON=function(ot,yt){if(ot.request)o.getJSON(ot.request,yt);else{if(typeof ot.data!="string")return yt(new Error("Input data given to '"+ot.source+"' is not a valid GeoJSON object."));try{return yt(null,JSON.parse(ot.data))}catch{return yt(new Error("Input data given to '"+ot.source+"' is not a valid GeoJSON object."))}}},nt.prototype.removeSource=function(ot,yt){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),yt()},nt.prototype.getClusterExpansionZoom=function(ot,yt){try{yt(null,this._geoJSONIndex.getClusterExpansionZoom(ot.clusterId))}catch(Rt){yt(Rt)}},nt.prototype.getClusterChildren=function(ot,yt){try{yt(null,this._geoJSONIndex.getChildren(ot.clusterId))}catch(Rt){yt(Rt)}},nt.prototype.getClusterLeaves=function(ot,yt){try{yt(null,this._geoJSONIndex.getLeaves(ot.clusterId,ot.limit,ot.offset))}catch(Rt){yt(Rt)}},nt}(g),Hi=function(tt){var nt=this;this.self=tt,this.actor=new o.Actor(tt,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:g,geojson:cd},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ot,yt){if(nt.workerSourceTypes[ot])throw new Error('Worker source with name "'+ot+'" already registered.');nt.workerSourceTypes[ot]=yt},this.self.registerRTLTextPlugin=function(ot){if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=ot.applyArabicShaping,o.plugin.processBidirectionalText=ot.processBidirectionalText,o.plugin.processStyledBidirectionalText=ot.processStyledBidirectionalText}};return Hi.prototype.setReferrer=function(tt,nt){this.referrer=nt},Hi.prototype.setImages=function(tt,nt,ot){for(var yt in this.availableImages[tt]=nt,this.workerSources[tt]){var Rt=this.workerSources[tt][yt];for(var jt in Rt)Rt[jt].availableImages=nt}ot()},Hi.prototype.setLayers=function(tt,nt,ot){this.getLayerIndex(tt).replace(nt),ot()},Hi.prototype.updateLayers=function(tt,nt,ot){this.getLayerIndex(tt).update(nt.layers,nt.removedIds),ot()},Hi.prototype.loadTile=function(tt,nt,ot){this.getWorkerSource(tt,nt.type,nt.source).loadTile(nt,ot)},Hi.prototype.loadDEMTile=function(tt,nt,ot){this.getDEMWorkerSource(tt,nt.source).loadTile(nt,ot)},Hi.prototype.reloadTile=function(tt,nt,ot){this.getWorkerSource(tt,nt.type,nt.source).reloadTile(nt,ot)},Hi.prototype.abortTile=function(tt,nt,ot){this.getWorkerSource(tt,nt.type,nt.source).abortTile(nt,ot)},Hi.prototype.removeTile=function(tt,nt,ot){this.getWorkerSource(tt,nt.type,nt.source).removeTile(nt,ot)},Hi.prototype.removeDEMTile=function(tt,nt){this.getDEMWorkerSource(tt,nt.source).removeTile(nt)},Hi.prototype.removeSource=function(tt,nt,ot){if(this.workerSources[tt]&&this.workerSources[tt][nt.type]&&this.workerSources[tt][nt.type][nt.source]){var yt=this.workerSources[tt][nt.type][nt.source];delete this.workerSources[tt][nt.type][nt.source],yt.removeSource!==void 0?yt.removeSource(nt,ot):ot()}},Hi.prototype.loadWorkerSource=function(tt,nt,ot){try{this.self.importScripts(nt.url),ot()}catch(yt){ot(yt.toString())}},Hi.prototype.syncRTLPluginState=function(tt,nt,ot){try{o.plugin.setState(nt);var yt=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&yt!=null){this.self.importScripts(yt);var Rt=o.plugin.isParsed();ot(Rt?void 0:new Error("RTL Text Plugin failed to import scripts from "+yt),Rt)}}catch(jt){ot(jt.toString())}},Hi.prototype.getAvailableImages=function(tt){var nt=this.availableImages[tt];return nt||(nt=[]),nt},Hi.prototype.getLayerIndex=function(tt){var nt=this.layerIndexes[tt];return nt||(nt=this.layerIndexes[tt]=new u),nt},Hi.prototype.getWorkerSource=function(tt,nt,ot){var yt=this;return this.workerSources[tt]||(this.workerSources[tt]={}),this.workerSources[tt][nt]||(this.workerSources[tt][nt]={}),this.workerSources[tt][nt][ot]||(this.workerSources[tt][nt][ot]=new this.workerSourceTypes[nt]({send:function(Rt,jt,Jt){yt.actor.send(Rt,jt,Jt,tt)}},this.getLayerIndex(tt),this.getAvailableImages(tt))),this.workerSources[tt][nt][ot]},Hi.prototype.getDEMWorkerSource=function(tt,nt){return this.demWorkerSources[tt]||(this.demWorkerSources[tt]={}),this.demWorkerSources[tt][nt]||(this.demWorkerSources[tt][nt]=new w),this.demWorkerSources[tt][nt]},Hi.prototype.enforceCacheSizeLimit=function(tt,nt){o.enforceCacheSizeLimit(nt)},typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Hi(self)),Hi}),a(["./shared"],function(o){var s=o.createCommonjsModule(function(y){function b(O){return!_(O)}function _(O){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var B,H,Y=new Blob([""],{type:"text/javascript"}),rt=URL.createObjectURL(Y);try{H=new Worker(rt),B=!0}catch{B=!1}return H&&H.terminate(),URL.revokeObjectURL(rt),B}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var B=document.createElement("canvas");B.width=B.height=1;var H=B.getContext("2d");if(!H)return!1;var Y=H.getImageData(0,0,1,1);return Y&&Y.width===B.width}()?(C[F=O&&O.failIfMajorPerformanceCaveat]===void 0&&(C[F]=function(B){var H=function(rt){var ct=document.createElement("canvas"),dt=Object.create(b.webGLContextAttributes);return dt.failIfMajorPerformanceCaveat=rt,ct.probablySupportsContext?ct.probablySupportsContext("webgl",dt)||ct.probablySupportsContext("experimental-webgl",dt):ct.supportsContext?ct.supportsContext("webgl",dt)||ct.supportsContext("experimental-webgl",dt):ct.getContext("webgl",dt)||ct.getContext("experimental-webgl",dt)}(B);if(!H)return!1;var Y=H.createShader(H.VERTEX_SHADER);return!(!Y||H.isContextLost())&&(H.shaderSource(Y,"void main() {}"),H.compileShader(Y),H.getShaderParameter(Y,H.COMPILE_STATUS)===!0)}(F)),C[F]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var F}y.exports?y.exports=b:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=b,window.mapboxgl.notSupportedReason=_);var C={};b.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),l={create:function(y,b,_){var C=o.window.document.createElement(y);return b!==void 0&&(C.className=b),_&&_.appendChild(C),C},createNS:function(y,b){return o.window.document.createElementNS(y,b)}},u=o.window.document&&o.window.document.documentElement.style;function c(y){if(!u)return y[0];for(var b=0;b<y.length;b++)if(y[b]in u)return y[b];return y[0]}var f,d=c(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);l.disableDrag=function(){u&&d&&(f=u[d],u[d]="none")},l.enableDrag=function(){u&&d&&(u[d]=f)};var v=c(["transform","WebkitTransform"]);l.setTransform=function(y,b){y.style[v]=b};var g=!1;try{var x=Object.defineProperty({},"passive",{get:function(){g=!0}});o.window.addEventListener("test",x,x),o.window.removeEventListener("test",x,x)}catch{g=!1}l.addEventListener=function(y,b,_,C){C===void 0&&(C={}),y.addEventListener(b,_,"passive"in C&&g?C:C.capture)},l.removeEventListener=function(y,b,_,C){C===void 0&&(C={}),y.removeEventListener(b,_,"passive"in C&&g?C:C.capture)};var w=function(y){y.preventDefault(),y.stopPropagation(),o.window.removeEventListener("click",w,!0)};function S(y){var b=y.userImage;return!!(b&&b.render&&b.render())&&(y.data.replace(new Uint8Array(b.data.buffer)),!0)}l.suppressClick=function(){o.window.addEventListener("click",w,!0),o.window.setTimeout(function(){o.window.removeEventListener("click",w,!0)},0)},l.mousePos=function(y,b){var _=y.getBoundingClientRect();return new o.Point(b.clientX-_.left-y.clientLeft,b.clientY-_.top-y.clientTop)},l.touchPos=function(y,b){for(var _=y.getBoundingClientRect(),C=[],O=0;O<b.length;O++)C.push(new o.Point(b[O].clientX-_.left-y.clientLeft,b[O].clientY-_.top-y.clientTop));return C},l.mouseButton=function(y){return o.window.InstallTrigger!==void 0&&y.button===2&&y.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:y.button},l.remove=function(y){y.parentNode&&y.parentNode.removeChild(y)};var M=function(y){function b(){y.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.isLoaded=function(){return this.loaded},b.prototype.setLoaded=function(_){if(this.loaded!==_&&(this.loaded=_,_)){for(var C=0,O=this.requestors;C<O.length;C+=1){var F=O[C];this._notify(F.ids,F.callback)}this.requestors=[]}},b.prototype.getImage=function(_){return this.images[_]},b.prototype.addImage=function(_,C){this._validate(_,C)&&(this.images[_]=C)},b.prototype._validate=function(_,C){var O=!0;return this._validateStretch(C.stretchX,C.data&&C.data.width)||(this.fire(new o.ErrorEvent(new Error('Image "'+_+'" has invalid "stretchX" value'))),O=!1),this._validateStretch(C.stretchY,C.data&&C.data.height)||(this.fire(new o.ErrorEvent(new Error('Image "'+_+'" has invalid "stretchY" value'))),O=!1),this._validateContent(C.content,C)||(this.fire(new o.ErrorEvent(new Error('Image "'+_+'" has invalid "content" value'))),O=!1),O},b.prototype._validateStretch=function(_,C){if(!_)return!0;for(var O=0,F=0,B=_;F<B.length;F+=1){var H=B[F];if(H[0]<O||H[1]<H[0]||C<H[1])return!1;O=H[1]}return!0},b.prototype._validateContent=function(_,C){return!(_&&(_.length!==4||_[0]<0||C.data.width<_[0]||_[1]<0||C.data.height<_[1]||_[2]<0||C.data.width<_[2]||_[3]<0||C.data.height<_[3]||_[2]<_[0]||_[3]<_[1]))},b.prototype.updateImage=function(_,C){C.version=this.images[_].version+1,this.images[_]=C,this.updatedImages[_]=!0},b.prototype.removeImage=function(_){var C=this.images[_];delete this.images[_],delete this.patterns[_],C.userImage&&C.userImage.onRemove&&C.userImage.onRemove()},b.prototype.listImages=function(){return Object.keys(this.images)},b.prototype.getImages=function(_,C){var O=!0;if(!this.isLoaded())for(var F=0,B=_;F<B.length;F+=1)this.images[B[F]]||(O=!1);this.isLoaded()||O?this._notify(_,C):this.requestors.push({ids:_,callback:C})},b.prototype._notify=function(_,C){for(var O={},F=0,B=_;F<B.length;F+=1){var H=B[F];this.images[H]||this.fire(new o.Event("styleimagemissing",{id:H}));var Y=this.images[H];Y?O[H]={data:Y.data.clone(),pixelRatio:Y.pixelRatio,sdf:Y.sdf,version:Y.version,stretchX:Y.stretchX,stretchY:Y.stretchY,content:Y.content,hasRenderCallback:!!(Y.userImage&&Y.userImage.render)}:o.warnOnce('Image "'+H+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}C(null,O)},b.prototype.getPixelSize=function(){var _=this.atlasImage;return{width:_.width,height:_.height}},b.prototype.getPattern=function(_){var C=this.patterns[_],O=this.getImage(_);if(!O)return null;if(C&&C.position.version===O.version)return C.position;if(C)C.position.version=O.version;else{var F={w:O.data.width+2,h:O.data.height+2,x:0,y:0},B=new o.ImagePosition(F,O);this.patterns[_]={bin:F,position:B}}return this._updatePatternAtlas(),this.patterns[_].position},b.prototype.bind=function(_){var C=_.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(_,this.atlasImage,C.RGBA),this.atlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE)},b.prototype._updatePatternAtlas=function(){var _=[];for(var C in this.patterns)_.push(this.patterns[C].bin);var O=o.potpack(_),F=O.w,B=O.h,H=this.atlasImage;for(var Y in H.resize({width:F||1,height:B||1}),this.patterns){var rt=this.patterns[Y].bin,ct=rt.x+1,dt=rt.y+1,pt=this.images[Y].data,Pt=pt.width,Mt=pt.height;o.RGBAImage.copy(pt,H,{x:0,y:0},{x:ct,y:dt},{width:Pt,height:Mt}),o.RGBAImage.copy(pt,H,{x:0,y:Mt-1},{x:ct,y:dt-1},{width:Pt,height:1}),o.RGBAImage.copy(pt,H,{x:0,y:0},{x:ct,y:dt+Mt},{width:Pt,height:1}),o.RGBAImage.copy(pt,H,{x:Pt-1,y:0},{x:ct-1,y:dt},{width:1,height:Mt}),o.RGBAImage.copy(pt,H,{x:0,y:0},{x:ct+Pt,y:dt},{width:1,height:Mt})}this.dirty=!0},b.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},b.prototype.dispatchRenderCallbacks=function(_){for(var C=0,O=_;C<O.length;C+=1){var F=O[C];if(!this.callbackDispatchedThisFrame[F]){this.callbackDispatchedThisFrame[F]=!0;var B=this.images[F];S(B)&&this.updateImage(F,B)}}},b}(o.Evented),R=k,I=k,P=1e20;function k(y,b,_,C,O,F){this.fontSize=y||24,this.buffer=b===void 0?3:b,this.cutoff=C||.25,this.fontFamily=O||"sans-serif",this.fontWeight=F||"normal",this.radius=_||8;var B=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=B,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(B*B),this.gridInner=new Float64Array(B*B),this.f=new Float64Array(B),this.d=new Float64Array(B),this.z=new Float64Array(B+1),this.v=new Int16Array(B),this.middle=Math.round(B/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function z(y,b,_,C,O,F,B){for(var H=0;H<b;H++){for(var Y=0;Y<_;Y++)C[Y]=y[Y*b+H];for(G(C,O,F,B,_),Y=0;Y<_;Y++)y[Y*b+H]=O[Y]}for(Y=0;Y<_;Y++){for(H=0;H<b;H++)C[H]=y[Y*b+H];for(G(C,O,F,B,b),H=0;H<b;H++)y[Y*b+H]=Math.sqrt(O[H])}}function G(y,b,_,C,O){_[0]=0,C[0]=-P,C[1]=+P;for(var F=1,B=0;F<O;F++){for(var H=(y[F]+F*F-(y[_[B]]+_[B]*_[B]))/(2*F-2*_[B]);H<=C[B];)B--,H=(y[F]+F*F-(y[_[B]]+_[B]*_[B]))/(2*F-2*_[B]);_[++B]=F,C[B]=H,C[B+1]=+P}for(F=0,B=0;F<O;F++){for(;C[B+1]<F;)B++;b[F]=(F-_[B])*(F-_[B])+y[_[B]]}}k.prototype.draw=function(y){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(y,this.buffer,this.middle);for(var b=this.ctx.getImageData(0,0,this.size,this.size),_=new Uint8ClampedArray(this.size*this.size),C=0;C<this.size*this.size;C++){var O=b.data[4*C+3]/255;this.gridOuter[C]=O===1?0:O===0?P:Math.pow(Math.max(0,.5-O),2),this.gridInner[C]=O===1?P:O===0?0:Math.pow(Math.max(0,O-.5),2)}for(z(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),z(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),C=0;C<this.size*this.size;C++)_[C]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[C]-this.gridInner[C])/this.radius+this.cutoff))));return _},R.default=I;var J=function(y,b){this.requestManager=y,this.localIdeographFontFamily=b,this.entries={}};J.prototype.setURL=function(y){this.url=y},J.prototype.getGlyphs=function(y,b){var _=this,C=[];for(var O in y)for(var F=0,B=y[O];F<B.length;F+=1)C.push({stack:O,id:B[F]});o.asyncAll(C,function(H,Y){var rt=H.stack,ct=H.id,dt=_.entries[rt];dt||(dt=_.entries[rt]={glyphs:{},requests:{},ranges:{}});var pt=dt.glyphs[ct];if(pt===void 0){if(pt=_._tinySDF(dt,rt,ct))return dt.glyphs[ct]=pt,void Y(null,{stack:rt,id:ct,glyph:pt});var Pt=Math.floor(ct/256);if(256*Pt>65535)Y(new Error("glyphs > 65535 not supported"));else if(dt.ranges[Pt])Y(null,{stack:rt,id:ct,glyph:pt});else{var Mt=dt.requests[Pt];Mt||(Mt=dt.requests[Pt]=[],J.loadGlyphRange(rt,Pt,_.url,_.requestManager,function(Ht,St){if(St){for(var Ut in St)_._doesCharSupportLocalGlyph(+Ut)||(dt.glyphs[+Ut]=St[+Ut]);dt.ranges[Pt]=!0}for(var Kt=0,le=Mt;Kt<le.length;Kt+=1)(0,le[Kt])(Ht,St);delete dt.requests[Pt]})),Mt.push(function(Ht,St){Ht?Y(Ht):St&&Y(null,{stack:rt,id:ct,glyph:St[ct]||null})})}}else Y(null,{stack:rt,id:ct,glyph:pt})},function(H,Y){if(H)b(H);else if(Y){for(var rt={},ct=0,dt=Y;ct<dt.length;ct+=1){var pt=dt[ct],Pt=pt.stack,Mt=pt.id,Ht=pt.glyph;(rt[Pt]||(rt[Pt]={}))[Mt]=Ht&&{id:Ht.id,bitmap:Ht.bitmap.clone(),metrics:Ht.metrics}}b(null,rt)}})},J.prototype._doesCharSupportLocalGlyph=function(y){return!!this.localIdeographFontFamily&&(o.isChar["CJK Unified Ideographs"](y)||o.isChar["Hangul Syllables"](y)||o.isChar.Hiragana(y)||o.isChar.Katakana(y))},J.prototype._tinySDF=function(y,b,_){var C=this.localIdeographFontFamily;if(C&&this._doesCharSupportLocalGlyph(_)){var O=y.tinySDF;if(!O){var F="400";/bold/i.test(b)?F="900":/medium/i.test(b)?F="500":/light/i.test(b)&&(F="200"),O=y.tinySDF=new J.TinySDF(24,3,8,.25,C,F)}return{id:_,bitmap:new o.AlphaImage({width:30,height:30},O.draw(String.fromCharCode(_))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},J.loadGlyphRange=function(y,b,_,C,O){var F=256*b,B=F+255,H=C.transformRequest(C.normalizeGlyphsURL(_).replace("{fontstack}",y).replace("{range}",F+"-"+B),o.ResourceType.Glyphs);o.getArrayBuffer(H,function(Y,rt){if(Y)O(Y);else if(rt){for(var ct={},dt=0,pt=o.parseGlyphPBF(rt);dt<pt.length;dt+=1){var Pt=pt[dt];ct[Pt.id]=Pt}O(null,ct)}})},J.TinySDF=R;var Z=function(){this.specification=o.styleSpec.light.position};Z.prototype.possiblyEvaluate=function(y,b){return o.sphericalToCartesian(y.expression.evaluate(b))},Z.prototype.interpolate=function(y,b,_){return{x:o.number(y.x,b.x,_),y:o.number(y.y,b.y,_),z:o.number(y.z,b.z,_)}};var X=new o.Properties({anchor:new o.DataConstantProperty(o.styleSpec.light.anchor),position:new Z,color:new o.DataConstantProperty(o.styleSpec.light.color),intensity:new o.DataConstantProperty(o.styleSpec.light.intensity)}),et=function(y){function b(_){y.call(this),this._transitionable=new o.Transitionable(X),this.setLight(_),this._transitioning=this._transitionable.untransitioned()}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getLight=function(){return this._transitionable.serialize()},b.prototype.setLight=function(_,C){if(C===void 0&&(C={}),!this._validate(o.validateLight,_,C))for(var O in _){var F=_[O];o.endsWith(O,"-transition")?this._transitionable.setTransition(O.slice(0,-11),F):this._transitionable.setValue(O,F)}},b.prototype.updateTransitions=function(_){this._transitioning=this._transitionable.transitioned(_,this._transitioning)},b.prototype.hasTransition=function(){return this._transitioning.hasTransition()},b.prototype.recalculate=function(_){this.properties=this._transitioning.possiblyEvaluate(_)},b.prototype._validate=function(_,C,O){return(!O||O.validate!==!1)&&o.emitValidationErrors(this,_.call(o.validateStyle,o.extend({value:C,style:{glyphs:!0,sprite:!0},styleSpec:o.styleSpec})))},b}(o.Evented),at=function(y,b){this.width=y,this.height=b,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};at.prototype.getDash=function(y,b){var _=y.join(",")+String(b);return this.dashEntry[_]||(this.dashEntry[_]=this.addDash(y,b)),this.dashEntry[_]},at.prototype.getDashRanges=function(y,b,_){var C=[],O=y.length%2==1?-y[y.length-1]*_:0,F=y[0]*_,B=!0;C.push({left:O,right:F,isDash:B,zeroLength:y[0]===0});for(var H=y[0],Y=1;Y<y.length;Y++){var rt=y[Y];C.push({left:O=H*_,right:F=(H+=rt)*_,isDash:B=!B,zeroLength:rt===0})}return C},at.prototype.addRoundDash=function(y,b,_){for(var C=b/2,O=-_;O<=_;O++)for(var F=this.width*(this.nextRow+_+O),B=0,H=y[B],Y=0;Y<this.width;Y++){Y/H.right>1&&(H=y[++B]);var rt=Math.abs(Y-H.left),ct=Math.abs(Y-H.right),dt=Math.min(rt,ct),pt=void 0,Pt=O/_*(C+1);if(H.isDash){var Mt=C-Math.abs(Pt);pt=Math.sqrt(dt*dt+Mt*Mt)}else pt=C-Math.sqrt(dt*dt+Pt*Pt);this.data[F+Y]=Math.max(0,Math.min(255,pt+128))}},at.prototype.addRegularDash=function(y){for(var b=y.length-1;b>=0;--b){var _=y[b],C=y[b+1];_.zeroLength?y.splice(b,1):C&&C.isDash===_.isDash&&(C.left=_.left,y.splice(b,1))}var O=y[0],F=y[y.length-1];O.isDash===F.isDash&&(O.left=F.left-this.width,F.right=O.right+this.width);for(var B=this.width*this.nextRow,H=0,Y=y[H],rt=0;rt<this.width;rt++){rt/Y.right>1&&(Y=y[++H]);var ct=Math.abs(rt-Y.left),dt=Math.abs(rt-Y.right),pt=Math.min(ct,dt);this.data[B+rt]=Math.max(0,Math.min(255,(Y.isDash?pt:-pt)+128))}},at.prototype.addDash=function(y,b){var _=b?7:0,C=2*_+1;if(this.nextRow+C>this.height)return o.warnOnce("LineAtlas out of space"),null;for(var O=0,F=0;F<y.length;F++)O+=y[F];if(O!==0){var B=this.width/O,H=this.getDashRanges(y,this.width,B);b?this.addRoundDash(H,B,_):this.addRegularDash(H)}var Y={y:(this.nextRow+_+.5)/this.height,height:2*_/this.height,width:O};return this.nextRow+=C,this.dirty=!0,Y},at.prototype.bind=function(y){var b=y.gl;this.texture?(b.bindTexture(b.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,b.texSubImage2D(b.TEXTURE_2D,0,0,0,this.width,this.height,b.ALPHA,b.UNSIGNED_BYTE,this.data))):(this.texture=b.createTexture(),b.bindTexture(b.TEXTURE_2D,this.texture),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.REPEAT),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texImage2D(b.TEXTURE_2D,0,b.ALPHA,this.width,this.height,0,b.ALPHA,b.UNSIGNED_BYTE,this.data))};var wt=function y(b,_){this.workerPool=b,this.actors=[],this.currentActor=0,this.id=o.uniqueId();for(var C=this.workerPool.acquire(this.id),O=0;O<C.length;O++){var F=new y.Actor(C[O],_,this.id);F.name="Worker "+O,this.actors.push(F)}};function Tt(y,b,_){var C=function(O,F){if(O)return _(O);if(F){var B=o.pick(o.extend(F,y),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);F.vector_layers&&(B.vectorLayers=F.vector_layers,B.vectorLayerIds=B.vectorLayers.map(function(H){return H.id})),B.tiles=b.canonicalizeTileset(B,y.url),_(null,B)}};return y.url?o.getJSON(b.transformRequest(b.normalizeSourceURL(y.url),o.ResourceType.Source),C):o.browser.frame(function(){return C(null,y)})}wt.prototype.broadcast=function(y,b,_){o.asyncAll(this.actors,function(C,O){C.send(y,b,O)},_=_||function(){})},wt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},wt.prototype.remove=function(){this.actors.forEach(function(y){y.remove()}),this.actors=[],this.workerPool.release(this.id)},wt.Actor=o.Actor;var vt=function(y,b,_){this.bounds=o.LngLatBounds.convert(this.validateBounds(y)),this.minzoom=b||0,this.maxzoom=_||24};vt.prototype.validateBounds=function(y){return Array.isArray(y)&&y.length===4?[Math.max(-180,y[0]),Math.max(-90,y[1]),Math.min(180,y[2]),Math.min(90,y[3])]:[-180,-90,180,90]},vt.prototype.contains=function(y){var b=Math.pow(2,y.z),_=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*b),C=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*b),O=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*b),F=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*b);return y.x>=_&&y.x<O&&y.y>=C&&y.y<F};var zt=function(y){function b(_,C,O,F){if(y.call(this),this.id=_,this.dispatcher=O,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(C,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},C),this._collectResourceTiming=C.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(F)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.load=function(){var _=this;this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Tt(this._options,this.map._requestManager,function(C,O){_._tileJSONRequest=null,_._loaded=!0,C?_.fire(new o.ErrorEvent(C)):O&&(o.extend(_,O),O.bounds&&(_.tileBounds=new vt(O.bounds,_.minzoom,_.maxzoom)),o.postTurnstileEvent(O.tiles,_.map._requestManager._customAccessToken),o.postMapLoadEvent(O.tiles,_.map._getMapId(),_.map._requestManager._skuToken,_.map._requestManager._customAccessToken),_.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),_.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})},b.prototype.loaded=function(){return this._loaded},b.prototype.hasTile=function(_){return!this.tileBounds||this.tileBounds.contains(_.canonical)},b.prototype.onAdd=function(_){this.map=_,this.load()},b.prototype.setSourceProperty=function(_){this._tileJSONRequest&&this._tileJSONRequest.cancel(),_(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},b.prototype.setTiles=function(_){var C=this;return this.setSourceProperty(function(){C._options.tiles=_}),this},b.prototype.setUrl=function(_){var C=this;return this.setSourceProperty(function(){C.url=_,C._options.url=_}),this},b.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},b.prototype.serialize=function(){return o.extend({},this._options)},b.prototype.loadTile=function(_,C){var O=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme)),F={request:this.map._requestManager.transformRequest(O,o.ResourceType.Tile),uid:_.uid,tileID:_.tileID,zoom:_.tileID.overscaledZ,tileSize:this.tileSize*_.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function B(H,Y){return delete _.request,_.aborted?C(null):H&&H.status!==404?C(H):(Y&&Y.resourceTiming&&(_.resourceTiming=Y.resourceTiming),this.map._refreshExpiredTiles&&Y&&_.setExpiryData(Y),_.loadVectorData(Y,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),C(null),void(_.reloadCallback&&(this.loadTile(_,_.reloadCallback),_.reloadCallback=null)))}F.request.collectResourceTiming=this._collectResourceTiming,_.actor&&_.state!=="expired"?_.state==="loading"?_.reloadCallback=C:_.request=_.actor.send("reloadTile",F,B.bind(this)):(_.actor=this.dispatcher.getActor(),_.request=_.actor.send("loadTile",F,B.bind(this)))},b.prototype.abortTile=function(_){_.request&&(_.request.cancel(),delete _.request),_.actor&&_.actor.send("abortTile",{uid:_.uid,type:this.type,source:this.id},void 0)},b.prototype.unloadTile=function(_){_.unloadVectorData(),_.actor&&_.actor.send("removeTile",{uid:_.uid,type:this.type,source:this.id},void 0)},b.prototype.hasTransition=function(){return!1},b}(o.Evented),oe=function(y){function b(_,C,O,F){y.call(this),this.id=_,this.dispatcher=O,this.setEventedParent(F),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},C),o.extend(this,o.pick(C,["url","scheme","tileSize"]))}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.load=function(){var _=this;this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Tt(this._options,this.map._requestManager,function(C,O){_._tileJSONRequest=null,_._loaded=!0,C?_.fire(new o.ErrorEvent(C)):O&&(o.extend(_,O),O.bounds&&(_.tileBounds=new vt(O.bounds,_.minzoom,_.maxzoom)),o.postTurnstileEvent(O.tiles),o.postMapLoadEvent(O.tiles,_.map._getMapId(),_.map._requestManager._skuToken),_.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),_.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})},b.prototype.loaded=function(){return this._loaded},b.prototype.onAdd=function(_){this.map=_,this.load()},b.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},b.prototype.serialize=function(){return o.extend({},this._options)},b.prototype.hasTile=function(_){return!this.tileBounds||this.tileBounds.contains(_.canonical)},b.prototype.loadTile=function(_,C){var O=this,F=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);_.request=o.getImage(this.map._requestManager.transformRequest(F,o.ResourceType.Tile),function(B,H){if(delete _.request,_.aborted)_.state="unloaded",C(null);else if(B)_.state="errored",C(B);else if(H){O.map._refreshExpiredTiles&&_.setExpiryData(H),delete H.cacheControl,delete H.expires;var Y=O.map.painter.context,rt=Y.gl;_.texture=O.map.painter.getTileTexture(H.width),_.texture?_.texture.update(H,{useMipmap:!0}):(_.texture=new o.Texture(Y,H,rt.RGBA,{useMipmap:!0}),_.texture.bind(rt.LINEAR,rt.CLAMP_TO_EDGE,rt.LINEAR_MIPMAP_NEAREST),Y.extTextureFilterAnisotropic&&rt.texParameterf(rt.TEXTURE_2D,Y.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Y.extTextureFilterAnisotropicMax)),_.state="loaded",o.cacheEntryPossiblyAdded(O.dispatcher),C(null)}})},b.prototype.abortTile=function(_,C){_.request&&(_.request.cancel(),delete _.request),C()},b.prototype.unloadTile=function(_,C){_.texture&&this.map.painter.saveTileTexture(_.texture),C()},b.prototype.hasTransition=function(){return!1},b}(o.Evented),Qt=function(y){function b(_,C,O,F){y.call(this,_,C,O,F),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},C),this.encoding=C.encoding||"mapbox"}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},b.prototype.loadTile=function(_,C){var O=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function F(B,H){B&&(_.state="errored",C(B)),H&&(_.dem=H,_.needsHillshadePrepare=!0,_.state="loaded",C(null))}_.request=o.getImage(this.map._requestManager.transformRequest(O,o.ResourceType.Tile),(function(B,H){if(delete _.request,_.aborted)_.state="unloaded",C(null);else if(B)_.state="errored",C(B);else if(H){this.map._refreshExpiredTiles&&_.setExpiryData(H),delete H.cacheControl,delete H.expires;var Y=o.window.ImageBitmap&&H instanceof o.window.ImageBitmap&&o.offscreenCanvasSupported()?H:o.browser.getImageData(H,1),rt={uid:_.uid,coord:_.tileID,source:this.id,rawImageData:Y,encoding:this.encoding};_.actor&&_.state!=="expired"||(_.actor=this.dispatcher.getActor(),_.actor.send("loadDEMTile",rt,F.bind(this)))}}).bind(this)),_.neighboringTiles=this._getNeighboringTiles(_.tileID)},b.prototype._getNeighboringTiles=function(_){var C=_.canonical,O=Math.pow(2,C.z),F=(C.x-1+O)%O,B=C.x===0?_.wrap-1:_.wrap,H=(C.x+1+O)%O,Y=C.x+1===O?_.wrap+1:_.wrap,rt={};return rt[new o.OverscaledTileID(_.overscaledZ,B,C.z,F,C.y).key]={backfilled:!1},rt[new o.OverscaledTileID(_.overscaledZ,Y,C.z,H,C.y).key]={backfilled:!1},C.y>0&&(rt[new o.OverscaledTileID(_.overscaledZ,B,C.z,F,C.y-1).key]={backfilled:!1},rt[new o.OverscaledTileID(_.overscaledZ,_.wrap,C.z,C.x,C.y-1).key]={backfilled:!1},rt[new o.OverscaledTileID(_.overscaledZ,Y,C.z,H,C.y-1).key]={backfilled:!1}),C.y+1<O&&(rt[new o.OverscaledTileID(_.overscaledZ,B,C.z,F,C.y+1).key]={backfilled:!1},rt[new o.OverscaledTileID(_.overscaledZ,_.wrap,C.z,C.x,C.y+1).key]={backfilled:!1},rt[new o.OverscaledTileID(_.overscaledZ,Y,C.z,H,C.y+1).key]={backfilled:!1}),rt},b.prototype.unloadTile=function(_){_.demTexture&&this.map.painter.saveTileTexture(_.demTexture),_.fbo&&(_.fbo.destroy(),delete _.fbo),_.dem&&delete _.dem,delete _.neighboringTiles,_.state="unloaded",_.actor&&_.actor.send("removeDEMTile",{uid:_.uid,source:this.id})},b}(oe),ne=function(y){function b(_,C,O,F){y.call(this),this.id=_,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=O.getActor(),this.setEventedParent(F),this._data=C.data,this._options=o.extend({},C),this._collectResourceTiming=C.collectResourceTiming,this._resourceTiming=[],C.maxzoom!==void 0&&(this.maxzoom=C.maxzoom),C.type&&(this.type=C.type),C.attribution&&(this.attribution=C.attribution),this.promoteId=C.promoteId;var B=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:C.cluster||!1,geojsonVtOptions:{buffer:(C.buffer!==void 0?C.buffer:128)*B,tolerance:(C.tolerance!==void 0?C.tolerance:.375)*B,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:C.lineMetrics||!1,generateId:C.generateId||!1},superclusterOptions:{maxZoom:C.clusterMaxZoom!==void 0?Math.min(C.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,C.clusterMinPoints||2),extent:o.EXTENT,radius:(C.clusterRadius||50)*B,log:!1,generateId:C.generateId||!1},clusterProperties:C.clusterProperties,filter:C.filter},C.workerOptions)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.load=function(){var _=this;this.fire(new o.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(C){if(C)_.fire(new o.ErrorEvent(C));else{var O={dataType:"source",sourceDataType:"metadata"};_._collectResourceTiming&&_._resourceTiming&&_._resourceTiming.length>0&&(O.resourceTiming=_._resourceTiming,_._resourceTiming=[]),_.fire(new o.Event("data",O))}})},b.prototype.onAdd=function(_){this.map=_,this.load()},b.prototype.setData=function(_){var C=this;return this._data=_,this.fire(new o.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(O){if(O)C.fire(new o.ErrorEvent(O));else{var F={dataType:"source",sourceDataType:"content"};C._collectResourceTiming&&C._resourceTiming&&C._resourceTiming.length>0&&(F.resourceTiming=C._resourceTiming,C._resourceTiming=[]),C.fire(new o.Event("data",F))}}),this},b.prototype.getClusterExpansionZoom=function(_,C){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:_,source:this.id},C),this},b.prototype.getClusterChildren=function(_,C){return this.actor.send("geojson.getClusterChildren",{clusterId:_,source:this.id},C),this},b.prototype.getClusterLeaves=function(_,C,O,F){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:_,limit:C,offset:O},F),this},b.prototype._updateWorkerData=function(_){var C=this;this._loaded=!1;var O=o.extend({},this.workerOptions),F=this._data;typeof F=="string"?(O.request=this.map._requestManager.transformRequest(o.browser.resolveURL(F),o.ResourceType.Source),O.request.collectResourceTiming=this._collectResourceTiming):O.data=JSON.stringify(F),this.actor.send(this.type+".loadData",O,function(B,H){C._removed||H&&H.abandoned||(C._loaded=!0,H&&H.resourceTiming&&H.resourceTiming[C.id]&&(C._resourceTiming=H.resourceTiming[C.id].slice(0)),C.actor.send(C.type+".coalesce",{source:O.source},null),_(B))})},b.prototype.loaded=function(){return this._loaded},b.prototype.loadTile=function(_,C){var O=this,F=_.actor?"reloadTile":"loadTile";_.actor=this.actor,_.request=this.actor.send(F,{type:this.type,uid:_.uid,tileID:_.tileID,zoom:_.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(B,H){return delete _.request,_.unloadVectorData(),_.aborted?C(null):B?C(B):(_.loadVectorData(H,O.map.painter,F==="reloadTile"),C(null))})},b.prototype.abortTile=function(_){_.request&&(_.request.cancel(),delete _.request),_.aborted=!0},b.prototype.unloadTile=function(_){_.unloadVectorData(),this.actor.send("removeTile",{uid:_.uid,type:this.type,source:this.id})},b.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},b.prototype.serialize=function(){return o.extend({},this._options,{type:this.type,data:this._data})},b.prototype.hasTransition=function(){return!1},b}(o.Evented),de=o.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),De=function(y){function b(_,C,O,F){y.call(this),this.id=_,this.dispatcher=O,this.coordinates=C.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(F),this.options=C}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.load=function(_,C){var O=this;this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),function(F,B){O._loaded=!0,F?O.fire(new o.ErrorEvent(F)):B&&(O.image=B,_&&(O.coordinates=_),C&&C(),O._finishLoading())})},b.prototype.loaded=function(){return this._loaded},b.prototype.updateImage=function(_){var C=this;return this.image&&_.url?(this.options.url=_.url,this.load(_.coordinates,function(){C.texture=null}),this):this},b.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))},b.prototype.onAdd=function(_){this.map=_,this.load()},b.prototype.setCoordinates=function(_){var C=this;this.coordinates=_;var O=_.map(o.MercatorCoordinate.fromLngLat);this.tileID=function(B){for(var H=1/0,Y=1/0,rt=-1/0,ct=-1/0,dt=0,pt=B;dt<pt.length;dt+=1){var Pt=pt[dt];H=Math.min(H,Pt.x),Y=Math.min(Y,Pt.y),rt=Math.max(rt,Pt.x),ct=Math.max(ct,Pt.y)}var Mt=Math.max(rt-H,ct-Y),Ht=Math.max(0,Math.floor(-Math.log(Mt)/Math.LN2)),St=Math.pow(2,Ht);return new o.CanonicalTileID(Ht,Math.floor((H+rt)/2*St),Math.floor((Y+ct)/2*St))}(O),this.minzoom=this.maxzoom=this.tileID.z;var F=O.map(function(B){return C.tileID.getTilePoint(B)._round()});return this._boundsArray=new o.StructArrayLayout4i8,this._boundsArray.emplaceBack(F[0].x,F[0].y,0,0),this._boundsArray.emplaceBack(F[1].x,F[1].y,o.EXTENT,0),this._boundsArray.emplaceBack(F[3].x,F[3].y,0,o.EXTENT),this._boundsArray.emplaceBack(F[2].x,F[2].y,o.EXTENT,o.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this},b.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var _=this.map.painter.context,C=_.gl;for(var O in this.boundsBuffer||(this.boundsBuffer=_.createVertexBuffer(this._boundsArray,de.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new o.Texture(_,this.image,C.RGBA),this.texture.bind(C.LINEAR,C.CLAMP_TO_EDGE)),this.tiles){var F=this.tiles[O];F.state!=="loaded"&&(F.state="loaded",F.texture=this.texture)}}},b.prototype.loadTile=function(_,C){this.tileID&&this.tileID.equals(_.tileID.canonical)?(this.tiles[String(_.tileID.wrap)]=_,_.buckets={},C(null)):(_.state="errored",C(null))},b.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},b.prototype.hasTransition=function(){return!1},b}(o.Evented),Ze=function(y){function b(_,C,O,F){y.call(this,_,C,O,F),this.roundZoom=!0,this.type="video",this.options=C}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.load=function(){var _=this;this._loaded=!1;var C=this.options;this.urls=[];for(var O=0,F=C.urls;O<F.length;O+=1)this.urls.push(this.map._requestManager.transformRequest(F[O],o.ResourceType.Source).url);o.getVideo(this.urls,function(B,H){_._loaded=!0,B?_.fire(new o.ErrorEvent(B)):H&&(_.video=H,_.video.loop=!0,_.video.setAttribute("playsinline",""),_.video.addEventListener("playing",function(){_.map.triggerRepaint()}),_.map&&_.video.play(),_._finishLoading())})},b.prototype.pause=function(){this.video&&this.video.pause()},b.prototype.play=function(){this.video&&this.video.play()},b.prototype.seek=function(_){if(this.video){var C=this.video.seekable;_<C.start(0)||_>C.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+C.start(0)+" and "+C.end(0)+"-second mark."))):this.video.currentTime=_}},b.prototype.getVideo=function(){return this.video},b.prototype.onAdd=function(_){this.map||(this.map=_,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},b.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var _=this.map.painter.context,C=_.gl;for(var O in this.boundsBuffer||(this.boundsBuffer=_.createVertexBuffer(this._boundsArray,de.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(C.LINEAR,C.CLAMP_TO_EDGE),C.texSubImage2D(C.TEXTURE_2D,0,0,0,C.RGBA,C.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(_,this.video,C.RGBA),this.texture.bind(C.LINEAR,C.CLAMP_TO_EDGE)),this.tiles){var F=this.tiles[O];F.state!=="loaded"&&(F.state="loaded",F.texture=this.texture)}}},b.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},b.prototype.hasTransition=function(){return this.video&&!this.video.paused},b}(De),ke=function(y){function b(_,C,O,F){y.call(this,_,C,O,F),C.coordinates?Array.isArray(C.coordinates)&&C.coordinates.length===4&&!C.coordinates.some(function(B){return!Array.isArray(B)||B.length!==2||B.some(function(H){return typeof H!="number"})})||this.fire(new o.ErrorEvent(new o.ValidationError("sources."+_,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError("sources."+_,null,'missing required property "coordinates"'))),C.animate&&typeof C.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError("sources."+_,null,'optional "animate" property must be a boolean value'))),C.canvas?typeof C.canvas=="string"||C.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError("sources."+_,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError("sources."+_,null,'missing required property "canvas"'))),this.options=C,this.animate=C.animate===void 0||C.animate}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},b.prototype.getCanvas=function(){return this.canvas},b.prototype.onAdd=function(_){this.map=_,this.load(),this.canvas&&this.animate&&this.play()},b.prototype.onRemove=function(){this.pause()},b.prototype.prepare=function(){var _=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,_=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,_=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var C=this.map.painter.context,O=C.gl;for(var F in this.boundsBuffer||(this.boundsBuffer=C.createVertexBuffer(this._boundsArray,de.members)),this.boundsSegments||(this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(_||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(C,this.canvas,O.RGBA,{premultiply:!0}),this.tiles){var B=this.tiles[F];B.state!=="loaded"&&(B.state="loaded",B.texture=this.texture)}}},b.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},b.prototype.hasTransition=function(){return this._playing},b.prototype._hasInvalidDimensions=function(){for(var _=0,C=[this.canvas.width,this.canvas.height];_<C.length;_+=1){var O=C[_];if(isNaN(O)||O<=0)return!0}return!1},b}(De),Be={vector:zt,raster:oe,"raster-dem":Qt,geojson:ne,video:Ze,image:De,canvas:ke};function Zr(y,b){var _=o.identity([]);return o.translate(_,_,[1,1,0]),o.scale(_,_,[.5*y.width,.5*y.height,1]),o.multiply(_,_,y.calculatePosMatrix(b.toUnwrapped()))}function Wr(y,b,_,C,O,F){var B=function(Ht,St,Ut){if(Ht)for(var Kt=0,le=Ht;Kt<le.length;Kt+=1){var we=St[le[Kt]];if(we&&we.source===Ut&&we.type==="fill-extrusion")return!0}else for(var ve in St){var Me=St[ve];if(Me.source===Ut&&Me.type==="fill-extrusion")return!0}return!1}(O&&O.layers,b,y.id),H=F.maxPitchScaleFactor(),Y=y.tilesIn(C,H,B);Y.sort(In);for(var rt=[],ct=0,dt=Y;ct<dt.length;ct+=1){var pt=dt[ct];rt.push({wrappedTileID:pt.tileID.wrapped().key,queryResults:pt.tile.queryRenderedFeatures(b,_,y._state,pt.queryGeometry,pt.cameraQueryGeometry,pt.scale,O,F,H,Zr(y.transform,pt.tileID))})}var Pt=function(Ht){for(var St={},Ut={},Kt=0,le=Ht;Kt<le.length;Kt+=1){var we=le[Kt],ve=we.queryResults,Me=we.wrappedTileID,Ge=Ut[Me]=Ut[Me]||{};for(var hr in ve)for(var or=ve[hr],Ir=Ge[hr]=Ge[hr]||{},ln=St[hr]=St[hr]||[],fn=0,hn=or;fn<hn.length;fn+=1){var Li=hn[fn];Ir[Li.featureIndex]||(Ir[Li.featureIndex]=!0,ln.push(Li))}}return St}(rt);for(var Mt in Pt)Pt[Mt].forEach(function(Ht){var St=Ht.feature,Ut=y.getFeatureState(St.layer["source-layer"],St.id);St.source=St.layer.source,St.layer["source-layer"]&&(St.sourceLayer=St.layer["source-layer"]),St.state=Ut});return Pt}function In(y,b){var _=y.tileID,C=b.tileID;return _.overscaledZ-C.overscaledZ||_.canonical.y-C.canonical.y||_.wrap-C.wrap||_.canonical.x-C.canonical.x}var re=function(y,b){this.max=y,this.onRemove=b,this.reset()};re.prototype.reset=function(){for(var y in this.data)for(var b=0,_=this.data[y];b<_.length;b+=1){var C=_[b];C.timeout&&clearTimeout(C.timeout),this.onRemove(C.value)}return this.data={},this.order=[],this},re.prototype.add=function(y,b,_){var C=this,O=y.wrapped().key;this.data[O]===void 0&&(this.data[O]=[]);var F={value:b,timeout:void 0};if(_!==void 0&&(F.timeout=setTimeout(function(){C.remove(y,F)},_)),this.data[O].push(F),this.order.push(O),this.order.length>this.max){var B=this._getAndRemoveByKey(this.order[0]);B&&this.onRemove(B)}return this},re.prototype.has=function(y){return y.wrapped().key in this.data},re.prototype.getAndRemove=function(y){return this.has(y)?this._getAndRemoveByKey(y.wrapped().key):null},re.prototype._getAndRemoveByKey=function(y){var b=this.data[y].shift();return b.timeout&&clearTimeout(b.timeout),this.data[y].length===0&&delete this.data[y],this.order.splice(this.order.indexOf(y),1),b.value},re.prototype.getByKey=function(y){var b=this.data[y];return b?b[0].value:null},re.prototype.get=function(y){return this.has(y)?this.data[y.wrapped().key][0].value:null},re.prototype.remove=function(y,b){if(!this.has(y))return this;var _=y.wrapped().key,C=b===void 0?0:this.data[_].indexOf(b),O=this.data[_][C];return this.data[_].splice(C,1),O.timeout&&clearTimeout(O.timeout),this.data[_].length===0&&delete this.data[_],this.onRemove(O.value),this.order.splice(this.order.indexOf(_),1),this},re.prototype.setMaxSize=function(y){for(this.max=y;this.order.length>this.max;){var b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this},re.prototype.filter=function(y){var b=[];for(var _ in this.data)for(var C=0,O=this.data[_];C<O.length;C+=1){var F=O[C];y(F.value)||b.push(F)}for(var B=0,H=b;B<H.length;B+=1){var Y=H[B];this.remove(Y.value.tileID,Y)}};var nr=function(y,b,_){this.context=y;var C=y.gl;this.buffer=C.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),y.bindElementBuffer.set(this.buffer),C.bufferData(C.ELEMENT_ARRAY_BUFFER,b.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||delete b.arrayBuffer};nr.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},nr.prototype.updateData=function(y){var b=this.context.gl;this.context.unbindVAO(),this.bind(),b.bufferSubData(b.ELEMENT_ARRAY_BUFFER,0,y.arrayBuffer)},nr.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var zr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Ne=function(y,b,_,C){this.length=b.length,this.attributes=_,this.itemSize=b.bytesPerElement,this.dynamicDraw=C,this.context=y;var O=y.gl;this.buffer=O.createBuffer(),y.bindVertexBuffer.set(this.buffer),O.bufferData(O.ARRAY_BUFFER,b.arrayBuffer,this.dynamicDraw?O.DYNAMIC_DRAW:O.STATIC_DRAW),this.dynamicDraw||delete b.arrayBuffer};Ne.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Ne.prototype.updateData=function(y){var b=this.context.gl;this.bind(),b.bufferSubData(b.ARRAY_BUFFER,0,y.arrayBuffer)},Ne.prototype.enableAttributes=function(y,b){for(var _=0;_<this.attributes.length;_++){var C=b.attributes[this.attributes[_].name];C!==void 0&&y.enableVertexAttribArray(C)}},Ne.prototype.setVertexAttribPointers=function(y,b,_){for(var C=0;C<this.attributes.length;C++){var O=this.attributes[C],F=b.attributes[O.name];F!==void 0&&y.vertexAttribPointer(F,O.components,y[zr[O.type]],!1,this.itemSize,O.offset+this.itemSize*(_||0))}},Ne.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Vr=function(y){this.gl=y.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Vr.prototype.get=function(){return this.current},Vr.prototype.set=function(y){},Vr.prototype.getDefault=function(){return this.default},Vr.prototype.setDefault=function(){this.set(this.default)};var xn=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return o.Color.transparent},b.prototype.set=function(_){var C=this.current;(_.r!==C.r||_.g!==C.g||_.b!==C.b||_.a!==C.a||this.dirty)&&(this.gl.clearColor(_.r,_.g,_.b,_.a),this.current=_,this.dirty=!1)},b}(Vr),Qn=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return 1},b.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.clearDepth(_),this.current=_,this.dirty=!1)},b}(Vr),gn=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return 0},b.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.clearStencil(_),this.current=_,this.dirty=!1)},b}(Vr),bn=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return[!0,!0,!0,!0]},b.prototype.set=function(_){var C=this.current;(_[0]!==C[0]||_[1]!==C[1]||_[2]!==C[2]||_[3]!==C[3]||this.dirty)&&(this.gl.colorMask(_[0],_[1],_[2],_[3]),this.current=_,this.dirty=!1)},b}(Vr),ci=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return!0},b.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.depthMask(_),this.current=_,this.dirty=!1)},b}(Vr),Mo=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return 255},b.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.stencilMask(_),this.current=_,this.dirty=!1)},b}(Vr),ra=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},b.prototype.set=function(_){var C=this.current;(_.func!==C.func||_.ref!==C.ref||_.mask!==C.mask||this.dirty)&&(this.gl.stencilFunc(_.func,_.ref,_.mask),this.current=_,this.dirty=!1)},b}(Vr),la=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){var _=this.gl;return[_.KEEP,_.KEEP,_.KEEP]},b.prototype.set=function(_){var C=this.current;(_[0]!==C[0]||_[1]!==C[1]||_[2]!==C[2]||this.dirty)&&(this.gl.stencilOp(_[0],_[1],_[2]),this.current=_,this.dirty=!1)},b}(Vr),os=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return!1},b.prototype.set=function(_){if(_!==this.current||this.dirty){var C=this.gl;_?C.enable(C.STENCIL_TEST):C.disable(C.STENCIL_TEST),this.current=_,this.dirty=!1}},b}(Vr),Et=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return[0,1]},b.prototype.set=function(_){var C=this.current;(_[0]!==C[0]||_[1]!==C[1]||this.dirty)&&(this.gl.depthRange(_[0],_[1]),this.current=_,this.dirty=!1)},b}(Vr),ss=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return!1},b.prototype.set=function(_){if(_!==this.current||this.dirty){var C=this.gl;_?C.enable(C.DEPTH_TEST):C.disable(C.DEPTH_TEST),this.current=_,this.dirty=!1}},b}(Vr),_u=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return this.gl.LESS},b.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.depthFunc(_),this.current=_,this.dirty=!1)},b}(Vr),ls=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return!1},b.prototype.set=function(_){if(_!==this.current||this.dirty){var C=this.gl;_?C.enable(C.BLEND):C.disable(C.BLEND),this.current=_,this.dirty=!1}},b}(Vr),Xu=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){var _=this.gl;return[_.ONE,_.ZERO]},b.prototype.set=function(_){var C=this.current;(_[0]!==C[0]||_[1]!==C[1]||this.dirty)&&(this.gl.blendFunc(_[0],_[1]),this.current=_,this.dirty=!1)},b}(Vr),ma=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return o.Color.transparent},b.prototype.set=function(_){var C=this.current;(_.r!==C.r||_.g!==C.g||_.b!==C.b||_.a!==C.a||this.dirty)&&(this.gl.blendColor(_.r,_.g,_.b,_.a),this.current=_,this.dirty=!1)},b}(Vr),us=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return this.gl.FUNC_ADD},b.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.blendEquation(_),this.current=_,this.dirty=!1)},b}(Vr),ol=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return!1},b.prototype.set=function(_){if(_!==this.current||this.dirty){var C=this.gl;_?C.enable(C.CULL_FACE):C.disable(C.CULL_FACE),this.current=_,this.dirty=!1}},b}(Vr),cs=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return this.gl.BACK},b.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.cullFace(_),this.current=_,this.dirty=!1)},b}(Vr),vc=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return this.gl.CCW},b.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.frontFace(_),this.current=_,this.dirty=!1)},b}(Vr),vo=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return null},b.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.useProgram(_),this.current=_,this.dirty=!1)},b}(Vr),ju=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return this.gl.TEXTURE0},b.prototype.set=function(_){(_!==this.current||this.dirty)&&(this.gl.activeTexture(_),this.current=_,this.dirty=!1)},b}(Vr),Ml=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){var _=this.gl;return[0,0,_.drawingBufferWidth,_.drawingBufferHeight]},b.prototype.set=function(_){var C=this.current;(_[0]!==C[0]||_[1]!==C[1]||_[2]!==C[2]||_[3]!==C[3]||this.dirty)&&(this.gl.viewport(_[0],_[1],_[2],_[3]),this.current=_,this.dirty=!1)},b}(Vr),dh=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return null},b.prototype.set=function(_){if(_!==this.current||this.dirty){var C=this.gl;C.bindFramebuffer(C.FRAMEBUFFER,_),this.current=_,this.dirty=!1}},b}(Vr),ud=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return null},b.prototype.set=function(_){if(_!==this.current||this.dirty){var C=this.gl;C.bindRenderbuffer(C.RENDERBUFFER,_),this.current=_,this.dirty=!1}},b}(Vr),ph=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return null},b.prototype.set=function(_){if(_!==this.current||this.dirty){var C=this.gl;C.bindTexture(C.TEXTURE_2D,_),this.current=_,this.dirty=!1}},b}(Vr),sp=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return null},b.prototype.set=function(_){if(_!==this.current||this.dirty){var C=this.gl;C.bindBuffer(C.ARRAY_BUFFER,_),this.current=_,this.dirty=!1}},b}(Vr),vh=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return null},b.prototype.set=function(_){var C=this.gl;C.bindBuffer(C.ELEMENT_ARRAY_BUFFER,_),this.current=_,this.dirty=!1},b}(Vr),ql=function(y){function b(_){y.call(this,_),this.vao=_.extVertexArrayObject}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return null},b.prototype.set=function(_){this.vao&&(_!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(_),this.current=_,this.dirty=!1)},b}(Vr),Kl=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return 4},b.prototype.set=function(_){if(_!==this.current||this.dirty){var C=this.gl;C.pixelStorei(C.UNPACK_ALIGNMENT,_),this.current=_,this.dirty=!1}},b}(Vr),gc=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return!1},b.prototype.set=function(_){if(_!==this.current||this.dirty){var C=this.gl;C.pixelStorei(C.UNPACK_PREMULTIPLY_ALPHA_WEBGL,_),this.current=_,this.dirty=!1}},b}(Vr),cd=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return!1},b.prototype.set=function(_){if(_!==this.current||this.dirty){var C=this.gl;C.pixelStorei(C.UNPACK_FLIP_Y_WEBGL,_),this.current=_,this.dirty=!1}},b}(Vr),Hi=function(y){function b(_,C){y.call(this,_),this.context=_,this.parent=C}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getDefault=function(){return null},b}(Vr),tt=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.setDirty=function(){this.dirty=!0},b.prototype.set=function(_){if(_!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var C=this.gl;C.framebufferTexture2D(C.FRAMEBUFFER,C.COLOR_ATTACHMENT0,C.TEXTURE_2D,_,0),this.current=_,this.dirty=!1}},b}(Hi),nt=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.set=function(_){if(_!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var C=this.gl;C.framebufferRenderbuffer(C.FRAMEBUFFER,C.DEPTH_ATTACHMENT,C.RENDERBUFFER,_),this.current=_,this.dirty=!1}},b}(Hi),ot=function(y,b,_,C){this.context=y,this.width=b,this.height=_;var O=this.framebuffer=y.gl.createFramebuffer();this.colorAttachment=new tt(y,O),C&&(this.depthAttachment=new nt(y,O))};ot.prototype.destroy=function(){var y=this.context.gl,b=this.colorAttachment.get();if(b&&y.deleteTexture(b),this.depthAttachment){var _=this.depthAttachment.get();_&&y.deleteRenderbuffer(_)}y.deleteFramebuffer(this.framebuffer)};var yt=function(y,b,_){this.func=y,this.mask=b,this.range=_};yt.ReadOnly=!1,yt.ReadWrite=!0,yt.disabled=new yt(519,yt.ReadOnly,[0,1]);var Rt=function(y,b,_,C,O,F){this.test=y,this.ref=b,this.mask=_,this.fail=C,this.depthFail=O,this.pass=F};Rt.disabled=new Rt({func:519,mask:0},0,0,7680,7680,7680);var jt=function(y,b,_){this.blendFunction=y,this.blendColor=b,this.mask=_};jt.disabled=new jt(jt.Replace=[1,0],o.Color.transparent,[!1,!1,!1,!1]),jt.unblended=new jt(jt.Replace,o.Color.transparent,[!0,!0,!0,!0]),jt.alphaBlended=new jt([1,771],o.Color.transparent,[!0,!0,!0,!0]);var Jt=function(y,b,_){this.enable=y,this.mode=b,this.frontFace=_};Jt.disabled=new Jt(!1,1029,2305),Jt.backCCW=new Jt(!0,1029,2305);var ht=function(y){this.gl=y,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new xn(this),this.clearDepth=new Qn(this),this.clearStencil=new gn(this),this.colorMask=new bn(this),this.depthMask=new ci(this),this.stencilMask=new Mo(this),this.stencilFunc=new ra(this),this.stencilOp=new la(this),this.stencilTest=new os(this),this.depthRange=new Et(this),this.depthTest=new ss(this),this.depthFunc=new _u(this),this.blend=new ls(this),this.blendFunc=new Xu(this),this.blendColor=new ma(this),this.blendEquation=new us(this),this.cullFace=new ol(this),this.cullFaceSide=new cs(this),this.frontFace=new vc(this),this.program=new vo(this),this.activeTexture=new ju(this),this.viewport=new Ml(this),this.bindFramebuffer=new dh(this),this.bindRenderbuffer=new ud(this),this.bindTexture=new ph(this),this.bindVertexBuffer=new sp(this),this.bindElementBuffer=new vh(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ql(this),this.pixelStoreUnpack=new Kl(this),this.pixelStoreUnpackPremultiplyAlpha=new gc(this),this.pixelStoreUnpackFlipY=new cd(this),this.extTextureFilterAnisotropic=y.getExtension("EXT_texture_filter_anisotropic")||y.getExtension("MOZ_EXT_texture_filter_anisotropic")||y.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=y.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=y.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(y.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=y.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=y.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=y.getParameter(y.MAX_TEXTURE_SIZE)};ht.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ht.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ht.prototype.createIndexBuffer=function(y,b){return new nr(this,y,b)},ht.prototype.createVertexBuffer=function(y,b,_){return new Ne(this,y,b,_)},ht.prototype.createRenderbuffer=function(y,b,_){var C=this.gl,O=C.createRenderbuffer();return this.bindRenderbuffer.set(O),C.renderbufferStorage(C.RENDERBUFFER,y,b,_),this.bindRenderbuffer.set(null),O},ht.prototype.createFramebuffer=function(y,b,_){return new ot(this,y,b,_)},ht.prototype.clear=function(y){var b=y.color,_=y.depth,C=this.gl,O=0;b&&(O|=C.COLOR_BUFFER_BIT,this.clearColor.set(b),this.colorMask.set([!0,!0,!0,!0])),_!==void 0&&(O|=C.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(_),this.depthMask.set(!0)),C.clear(O)},ht.prototype.setCullFace=function(y){y.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(y.mode),this.frontFace.set(y.frontFace))},ht.prototype.setDepthMode=function(y){y.func!==this.gl.ALWAYS||y.mask?(this.depthTest.set(!0),this.depthFunc.set(y.func),this.depthMask.set(y.mask),this.depthRange.set(y.range)):this.depthTest.set(!1)},ht.prototype.setStencilMode=function(y){y.test.func!==this.gl.ALWAYS||y.mask?(this.stencilTest.set(!0),this.stencilMask.set(y.mask),this.stencilOp.set([y.fail,y.depthFail,y.pass]),this.stencilFunc.set({func:y.test.func,ref:y.ref,mask:y.test.mask})):this.stencilTest.set(!1)},ht.prototype.setColorMode=function(y){o.deepEqual(y.blendFunction,jt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(y.blendFunction),this.blendColor.set(y.blendColor)),this.colorMask.set(y.mask)},ht.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Dt=function(y){function b(_,C,O){var F=this;y.call(this),this.id=_,this.dispatcher=O,this.on("data",function(B){B.dataType==="source"&&B.sourceDataType==="metadata"&&(F._sourceLoaded=!0),F._sourceLoaded&&!F._paused&&B.dataType==="source"&&B.sourceDataType==="content"&&(F.reload(),F.transform&&F.update(F.transform))}),this.on("error",function(){F._sourceErrored=!0}),this._source=function(B,H,Y,rt){var ct=new Be[H.type](B,H,Y,rt);if(ct.id!==B)throw new Error("Expected Source id to be "+B+" instead of "+ct.id);return o.bindAll(["load","abort","unload","serialize","prepare"],ct),ct}(_,C,O,this),this._tiles={},this._cache=new re(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new o.SourceFeatureState}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.onAdd=function(_){this.map=_,this._maxTileCacheSize=_?_._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(_)},b.prototype.onRemove=function(_){this._source&&this._source.onRemove&&this._source.onRemove(_)},b.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var _ in this._tiles){var C=this._tiles[_];if(C.state!=="loaded"&&C.state!=="errored")return!1}return!0},b.prototype.getSource=function(){return this._source},b.prototype.pause=function(){this._paused=!0},b.prototype.resume=function(){if(this._paused){var _=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,_&&this.reload(),this.transform&&this.update(this.transform)}},b.prototype._loadTile=function(_,C){return this._source.loadTile(_,C)},b.prototype._unloadTile=function(_){if(this._source.unloadTile)return this._source.unloadTile(_,function(){})},b.prototype._abortTile=function(_){if(this._source.abortTile)return this._source.abortTile(_,function(){})},b.prototype.serialize=function(){return this._source.serialize()},b.prototype.prepare=function(_){for(var C in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var O=this._tiles[C];O.upload(_),O.prepare(this.map.style.imageManager)}},b.prototype.getIds=function(){return o.values(this._tiles).map(function(_){return _.tileID}).sort(se).map(function(_){return _.key})},b.prototype.getRenderableIds=function(_){var C=this,O=[];for(var F in this._tiles)this._isIdRenderable(F,_)&&O.push(this._tiles[F]);return _?O.sort(function(B,H){var Y=B.tileID,rt=H.tileID,ct=new o.Point(Y.canonical.x,Y.canonical.y)._rotate(C.transform.angle),dt=new o.Point(rt.canonical.x,rt.canonical.y)._rotate(C.transform.angle);return Y.overscaledZ-rt.overscaledZ||dt.y-ct.y||dt.x-ct.x}).map(function(B){return B.tileID.key}):O.map(function(B){return B.tileID}).sort(se).map(function(B){return B.key})},b.prototype.hasRenderableParent=function(_){var C=this.findLoadedParent(_,0);return!!C&&this._isIdRenderable(C.tileID.key)},b.prototype._isIdRenderable=function(_,C){return this._tiles[_]&&this._tiles[_].hasData()&&!this._coveredTiles[_]&&(C||!this._tiles[_].holdingForFade())},b.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var _ in this._cache.reset(),this._tiles)this._tiles[_].state!=="errored"&&this._reloadTile(_,"reloading")},b.prototype._reloadTile=function(_,C){var O=this._tiles[_];O&&(O.state!=="loading"&&(O.state=C),this._loadTile(O,this._tileLoaded.bind(this,O,_,C)))},b.prototype._tileLoaded=function(_,C,O,F){if(F)return _.state="errored",void(F.status!==404?this._source.fire(new o.ErrorEvent(F,{tile:_})):this.update(this.transform));_.timeAdded=o.browser.now(),O==="expired"&&(_.refreshedUponExpiration=!0),this._setTileReloadTimer(C,_),this.getSource().type==="raster-dem"&&_.dem&&this._backfillDEM(_),this._state.initializeTileState(_,this.map?this.map.painter:null),this._source.fire(new o.Event("data",{dataType:"source",tile:_,coord:_.tileID}))},b.prototype._backfillDEM=function(_){for(var C=this.getRenderableIds(),O=0;O<C.length;O++){var F=C[O];if(_.neighboringTiles&&_.neighboringTiles[F]){var B=this.getTileByID(F);H(_,B),H(B,_)}}function H(Y,rt){Y.needsHillshadePrepare=!0;var ct=rt.tileID.canonical.x-Y.tileID.canonical.x,dt=rt.tileID.canonical.y-Y.tileID.canonical.y,pt=Math.pow(2,Y.tileID.canonical.z),Pt=rt.tileID.key;ct===0&&dt===0||Math.abs(dt)>1||(Math.abs(ct)>1&&(Math.abs(ct+pt)===1?ct+=pt:Math.abs(ct-pt)===1&&(ct-=pt)),rt.dem&&Y.dem&&(Y.dem.backfillBorder(rt.dem,ct,dt),Y.neighboringTiles&&Y.neighboringTiles[Pt]&&(Y.neighboringTiles[Pt].backfilled=!0)))}},b.prototype.getTile=function(_){return this.getTileByID(_.key)},b.prototype.getTileByID=function(_){return this._tiles[_]},b.prototype._retainLoadedChildren=function(_,C,O,F){for(var B in this._tiles){var H=this._tiles[B];if(!(F[B]||!H.hasData()||H.tileID.overscaledZ<=C||H.tileID.overscaledZ>O)){for(var Y=H.tileID;H&&H.tileID.overscaledZ>C+1;){var rt=H.tileID.scaledTo(H.tileID.overscaledZ-1);(H=this._tiles[rt.key])&&H.hasData()&&(Y=rt)}for(var ct=Y;ct.overscaledZ>C;)if(_[(ct=ct.scaledTo(ct.overscaledZ-1)).key]){F[Y.key]=Y;break}}}},b.prototype.findLoadedParent=function(_,C){if(_.key in this._loadedParentTiles){var O=this._loadedParentTiles[_.key];return O&&O.tileID.overscaledZ>=C?O:null}for(var F=_.overscaledZ-1;F>=C;F--){var B=_.scaledTo(F),H=this._getLoadedTile(B);if(H)return H}},b.prototype._getLoadedTile=function(_){var C=this._tiles[_.key];return C&&C.hasData()?C:this._cache.getByKey(_.wrapped().key)},b.prototype.updateCacheSize=function(_){var C=Math.ceil(_.width/this._source.tileSize)+1,O=Math.ceil(_.height/this._source.tileSize)+1,F=Math.floor(C*O*5),B=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,F):F;this._cache.setMaxSize(B)},b.prototype.handleWrapJump=function(_){var C=Math.round((_-(this._prevLng===void 0?_:this._prevLng))/360);if(this._prevLng=_,C){var O={};for(var F in this._tiles){var B=this._tiles[F];B.tileID=B.tileID.unwrapTo(B.tileID.wrap+C),O[B.tileID.key]=B}for(var H in this._tiles=O,this._timers)clearTimeout(this._timers[H]),delete this._timers[H];for(var Y in this._tiles)this._setTileReloadTimer(Y,this._tiles[Y])}},b.prototype.update=function(_){var C=this;if(this.transform=_,this._sourceLoaded&&!this._paused){var O;this.updateCacheSize(_),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?O=_.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Ge){return new o.OverscaledTileID(Ge.canonical.z,Ge.wrap,Ge.canonical.z,Ge.canonical.x,Ge.canonical.y)}):(O=_.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(O=O.filter(function(Ge){return C._source.hasTile(Ge)}))):O=[];var F=_.coveringZoomLevel(this._source),B=Math.max(F-b.maxOverzooming,this._source.minzoom),H=Math.max(F+b.maxUnderzooming,this._source.minzoom),Y=this._updateRetainedTiles(O,F);if(Pe(this._source.type)){for(var rt={},ct={},dt=0,pt=Object.keys(Y);dt<pt.length;dt+=1){var Pt=pt[dt],Mt=Y[Pt],Ht=this._tiles[Pt];if(Ht&&!(Ht.fadeEndTime&&Ht.fadeEndTime<=o.browser.now())){var St=this.findLoadedParent(Mt,B);St&&(this._addTile(St.tileID),rt[St.tileID.key]=St.tileID),ct[Pt]=Mt}}for(var Ut in this._retainLoadedChildren(ct,F,H,Y),rt)Y[Ut]||(this._coveredTiles[Ut]=!0,Y[Ut]=rt[Ut])}for(var Kt in Y)this._tiles[Kt].clearFadeHold();for(var le=0,we=o.keysDifference(this._tiles,Y);le<we.length;le+=1){var ve=we[le],Me=this._tiles[ve];Me.hasSymbolBuckets&&!Me.holdingForFade()?Me.setHoldDuration(this.map._fadeDuration):Me.hasSymbolBuckets&&!Me.symbolFadeFinished()||this._removeTile(ve)}this._updateLoadedParentTileCache()}},b.prototype.releaseSymbolFadeTiles=function(){for(var _ in this._tiles)this._tiles[_].holdingForFade()&&this._removeTile(_)},b.prototype._updateRetainedTiles=function(_,C){for(var O={},F={},B=Math.max(C-b.maxOverzooming,this._source.minzoom),H=Math.max(C+b.maxUnderzooming,this._source.minzoom),Y={},rt=0,ct=_;rt<ct.length;rt+=1){var dt=ct[rt],pt=this._addTile(dt);O[dt.key]=dt,pt.hasData()||C<this._source.maxzoom&&(Y[dt.key]=dt)}this._retainLoadedChildren(Y,C,H,O);for(var Pt=0,Mt=_;Pt<Mt.length;Pt+=1){var Ht=Mt[Pt],St=this._tiles[Ht.key];if(!St.hasData()){if(C+1>this._source.maxzoom){var Ut=Ht.children(this._source.maxzoom)[0],Kt=this.getTile(Ut);if(Kt&&Kt.hasData()){O[Ut.key]=Ut;continue}}else{var le=Ht.children(this._source.maxzoom);if(O[le[0].key]&&O[le[1].key]&&O[le[2].key]&&O[le[3].key])continue}for(var we=St.wasRequested(),ve=Ht.overscaledZ-1;ve>=B;--ve){var Me=Ht.scaledTo(ve);if(F[Me.key]||(F[Me.key]=!0,!(St=this.getTile(Me))&&we&&(St=this._addTile(Me)),St&&(O[Me.key]=Me,we=St.wasRequested(),St.hasData())))break}}}return O},b.prototype._updateLoadedParentTileCache=function(){for(var _ in this._loadedParentTiles={},this._tiles){for(var C=[],O=void 0,F=this._tiles[_].tileID;F.overscaledZ>0;){if(F.key in this._loadedParentTiles){O=this._loadedParentTiles[F.key];break}C.push(F.key);var B=F.scaledTo(F.overscaledZ-1);if(O=this._getLoadedTile(B))break;F=B}for(var H=0,Y=C;H<Y.length;H+=1)this._loadedParentTiles[Y[H]]=O}},b.prototype._addTile=function(_){var C=this._tiles[_.key];if(C)return C;(C=this._cache.getAndRemove(_))&&(this._setTileReloadTimer(_.key,C),C.tileID=_,this._state.initializeTileState(C,this.map?this.map.painter:null),this._cacheTimers[_.key]&&(clearTimeout(this._cacheTimers[_.key]),delete this._cacheTimers[_.key],this._setTileReloadTimer(_.key,C)));var O=!!C;return O||(C=new o.Tile(_,this._source.tileSize*_.overscaleFactor()),this._loadTile(C,this._tileLoaded.bind(this,C,_.key,C.state))),C?(C.uses++,this._tiles[_.key]=C,O||this._source.fire(new o.Event("dataloading",{tile:C,coord:C.tileID,dataType:"source"})),C):null},b.prototype._setTileReloadTimer=function(_,C){var O=this;_ in this._timers&&(clearTimeout(this._timers[_]),delete this._timers[_]);var F=C.getExpiryTimeout();F&&(this._timers[_]=setTimeout(function(){O._reloadTile(_,"expired"),delete O._timers[_]},F))},b.prototype._removeTile=function(_){var C=this._tiles[_];C&&(C.uses--,delete this._tiles[_],this._timers[_]&&(clearTimeout(this._timers[_]),delete this._timers[_]),C.uses>0||(C.hasData()&&C.state!=="reloading"?this._cache.add(C.tileID,C,C.getExpiryTimeout()):(C.aborted=!0,this._abortTile(C),this._unloadTile(C))))},b.prototype.clearTiles=function(){for(var _ in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(_);this._cache.reset()},b.prototype.tilesIn=function(_,C,O){var F=this,B=[],H=this.transform;if(!H)return B;for(var Y=O?H.getCameraQueryGeometry(_):_,rt=_.map(function(ve){return H.pointCoordinate(ve)}),ct=Y.map(function(ve){return H.pointCoordinate(ve)}),dt=this.getIds(),pt=1/0,Pt=1/0,Mt=-1/0,Ht=-1/0,St=0,Ut=ct;St<Ut.length;St+=1){var Kt=Ut[St];pt=Math.min(pt,Kt.x),Pt=Math.min(Pt,Kt.y),Mt=Math.max(Mt,Kt.x),Ht=Math.max(Ht,Kt.y)}for(var le=function(ve){var Me=F._tiles[dt[ve]];if(!Me.holdingForFade()){var Ge=Me.tileID,hr=Math.pow(2,H.zoom-Me.tileID.overscaledZ),or=C*Me.queryPadding*o.EXTENT/Me.tileSize/hr,Ir=[Ge.getTilePoint(new o.MercatorCoordinate(pt,Pt)),Ge.getTilePoint(new o.MercatorCoordinate(Mt,Ht))];if(Ir[0].x-or<o.EXTENT&&Ir[0].y-or<o.EXTENT&&Ir[1].x+or>=0&&Ir[1].y+or>=0){var ln=rt.map(function(hn){return Ge.getTilePoint(hn)}),fn=ct.map(function(hn){return Ge.getTilePoint(hn)});B.push({tile:Me,tileID:Ge,queryGeometry:ln,cameraQueryGeometry:fn,scale:hr})}}},we=0;we<dt.length;we++)le(we);return B},b.prototype.getVisibleCoordinates=function(_){for(var C=this,O=this.getRenderableIds(_).map(function(Y){return C._tiles[Y].tileID}),F=0,B=O;F<B.length;F+=1){var H=B[F];H.posMatrix=this.transform.calculatePosMatrix(H.toUnwrapped())}return O},b.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Pe(this._source.type))for(var _ in this._tiles){var C=this._tiles[_];if(C.fadeEndTime!==void 0&&C.fadeEndTime>=o.browser.now())return!0}return!1},b.prototype.setFeatureState=function(_,C,O){this._state.updateState(_=_||"_geojsonTileLayer",C,O)},b.prototype.removeFeatureState=function(_,C,O){this._state.removeFeatureState(_=_||"_geojsonTileLayer",C,O)},b.prototype.getFeatureState=function(_,C){return this._state.getState(_=_||"_geojsonTileLayer",C)},b.prototype.setDependencies=function(_,C,O){var F=this._tiles[_];F&&F.setDependencies(C,O)},b.prototype.reloadTilesForDependencies=function(_,C){for(var O in this._tiles)this._tiles[O].hasDependency(_,C)&&this._reloadTile(O,"reloading");this._cache.filter(function(F){return!F.hasDependency(_,C)})},b}(o.Evented);function se(y,b){var _=Math.abs(2*y.wrap)-+(y.wrap<0),C=Math.abs(2*b.wrap)-+(b.wrap<0);return y.overscaledZ-b.overscaledZ||C-_||b.canonical.y-y.canonical.y||b.canonical.x-y.canonical.x}function Pe(y){return y==="raster"||y==="image"||y==="video"}function er(){return new o.window.Worker(am.workerUrl)}Dt.maxOverzooming=10,Dt.maxUnderzooming=3;var Ae="mapboxgl_preloaded_worker_pool",qe=function(){this.active={}};qe.prototype.acquire=function(y){if(!this.workers)for(this.workers=[];this.workers.length<qe.workerCount;)this.workers.push(new er);return this.active[y]=!0,this.workers.slice()},qe.prototype.release=function(y){delete this.active[y],this.numActive()===0&&(this.workers.forEach(function(b){b.terminate()}),this.workers=null)},qe.prototype.isPreloaded=function(){return!!this.active[Ae]},qe.prototype.numActive=function(){return Object.keys(this.active).length};var Yr,Hr=Math.floor(o.browser.hardwareConcurrency/2);function Ie(){return Yr||(Yr=new qe),Yr}function Mr(y,b){var _={};for(var C in y)C!=="ref"&&(_[C]=y[C]);return o.refProperties.forEach(function(O){O in b&&(_[O]=b[O])}),_}function pr(y){y=y.slice();for(var b=Object.create(null),_=0;_<y.length;_++)b[y[_].id]=y[_];for(var C=0;C<y.length;C++)"ref"in y[C]&&(y[C]=Mr(y[C],b[y[C].ref]));return y}qe.workerCount=Math.max(Math.min(Hr,6),1);var mr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Un(y,b,_){_.push({command:mr.addSource,args:[y,b[y]]})}function Cr(y,b,_){b.push({command:mr.removeSource,args:[y]}),_[y]=!0}function hi(y,b,_,C){Cr(y,_,C),Un(y,b,_)}function na(y,b,_){var C;for(C in y[_])if(y[_].hasOwnProperty(C)&&C!=="data"&&!o.deepEqual(y[_][C],b[_][C]))return!1;for(C in b[_])if(b[_].hasOwnProperty(C)&&C!=="data"&&!o.deepEqual(y[_][C],b[_][C]))return!1;return!0}function oi(y,b,_,C,O,F){var B;for(B in b=b||{},y=y||{})y.hasOwnProperty(B)&&(o.deepEqual(y[B],b[B])||_.push({command:F,args:[C,B,b[B],O]}));for(B in b)b.hasOwnProperty(B)&&!y.hasOwnProperty(B)&&(o.deepEqual(y[B],b[B])||_.push({command:F,args:[C,B,b[B],O]}))}function Ci(y){return y.id}function $n(y,b){return y[b.id]=b,y}var go=function(y,b){this.reset(y,b)};go.prototype.reset=function(y,b){this.points=y||[],this._distances=[0];for(var _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(b||0,.5*this.length),this.paddedLength=this.length-2*this.padding},go.prototype.lerp=function(y){if(this.points.length===1)return this.points[0];y=o.clamp(y,0,1);for(var b=1,_=this._distances[b],C=y*this.paddedLength+this.padding;_<C&&b<this._distances.length;)_=this._distances[++b];var O=b-1,F=this._distances[O],B=_-F,H=B>0?(C-F)/B:0;return this.points[O].mult(1-H).add(this.points[b].mult(H))};var vi=function(y,b,_){var C=this.boxCells=[],O=this.circleCells=[];this.xCellCount=Math.ceil(y/_),this.yCellCount=Math.ceil(b/_);for(var F=0;F<this.xCellCount*this.yCellCount;F++)C.push([]),O.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=y,this.height=b,this.xScale=this.xCellCount/y,this.yScale=this.yCellCount/b,this.boxUid=0,this.circleUid=0};function ia(y,b,_,C,O){var F=o.create();return b?(o.scale(F,F,[1/O,1/O,1]),_||o.rotateZ(F,F,C.angle)):o.multiply(F,C.labelPlaneMatrix,y),F}function Bi(y,b,_,C,O){if(b){var F=o.clone(y);return o.scale(F,F,[O,O,1]),_||o.rotateZ(F,F,-C.angle),F}return C.glCoordMatrix}function Hn(y,b){var _=[y.x,y.y,0,1];Ia(_,_,b);var C=_[3];return{point:new o.Point(_[0]/C,_[1]/C),signedDistanceFromCamera:C}}function si(y,b){return .5+y/b*.5}function ws(y,b){var _=y[0]/y[3],C=y[1]/y[3];return _>=-b[0]&&_<=b[0]&&C>=-b[1]&&C<=b[1]}function nf(y,b,_,C,O,F,B,H){var Y=C?y.textSizeData:y.iconSizeData,rt=o.evaluateSizeForZoom(Y,_.transform.zoom),ct=[256/_.width*2+1,256/_.height*2+1],dt=C?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;dt.clear();for(var pt=y.lineVertexArray,Pt=C?y.text.placedSymbolArray:y.icon.placedSymbolArray,Mt=_.transform.width/_.transform.height,Ht=!1,St=0;St<Pt.length;St++){var Ut=Pt.get(St);if(Ut.hidden||Ut.writingMode===o.WritingMode.vertical&&!Ht)Vo(Ut.numGlyphs,dt);else{Ht=!1;var Kt=[Ut.anchorX,Ut.anchorY,0,1];if(o.transformMat4(Kt,Kt,b),ws(Kt,ct)){var le=si(_.transform.cameraToCenterDistance,Kt[3]),we=o.evaluateSizeForFeature(Y,rt,Ut),ve=B?we/le:we*le,Me=new o.Point(Ut.anchorX,Ut.anchorY),Ge=Hn(Me,O).point,hr={},or=af(Ut,ve,!1,H,b,O,F,y.glyphOffsetArray,pt,dt,Ge,Me,hr,Mt);Ht=or.useVertical,(or.notEnoughRoom||Ht||or.needsFlipping&&af(Ut,ve,!0,H,b,O,F,y.glyphOffsetArray,pt,dt,Ge,Me,hr,Mt).notEnoughRoom)&&Vo(Ut.numGlyphs,dt)}else Vo(Ut.numGlyphs,dt)}}C?y.text.dynamicLayoutVertexBuffer.updateData(dt):y.icon.dynamicLayoutVertexBuffer.updateData(dt)}function ao(y,b,_,C,O,F,B,H,Y,rt,ct){var dt=H.glyphStartIndex+H.numGlyphs,pt=H.lineStartIndex,Pt=H.lineStartIndex+H.lineLength,Mt=b.getoffsetX(H.glyphStartIndex),Ht=b.getoffsetX(dt-1),St=Ra(y*Mt,_,C,O,F,B,H.segment,pt,Pt,Y,rt,ct);if(!St)return null;var Ut=Ra(y*Ht,_,C,O,F,B,H.segment,pt,Pt,Y,rt,ct);return Ut?{first:St,last:Ut}:null}function Fa(y,b,_,C){return y===o.WritingMode.horizontal&&Math.abs(_.y-b.y)>Math.abs(_.x-b.x)*C?{useVertical:!0}:(y===o.WritingMode.vertical?b.y<_.y:b.x>_.x)?{needsFlipping:!0}:null}function af(y,b,_,C,O,F,B,H,Y,rt,ct,dt,pt,Pt){var Mt,Ht=b/24,St=y.lineOffsetX*Ht,Ut=y.lineOffsetY*Ht;if(y.numGlyphs>1){var Kt=y.glyphStartIndex+y.numGlyphs,le=y.lineStartIndex,we=y.lineStartIndex+y.lineLength,ve=ao(Ht,H,St,Ut,_,ct,dt,y,Y,F,pt);if(!ve)return{notEnoughRoom:!0};var Me=Hn(ve.first.point,B).point,Ge=Hn(ve.last.point,B).point;if(C&&!_){var hr=Fa(y.writingMode,Me,Ge,Pt);if(hr)return hr}Mt=[ve.first];for(var or=y.glyphStartIndex+1;or<Kt-1;or++)Mt.push(Ra(Ht*H.getoffsetX(or),St,Ut,_,ct,dt,y.segment,le,we,Y,F,pt));Mt.push(ve.last)}else{if(C&&!_){var Ir=Hn(dt,O).point,ln=y.lineStartIndex+y.segment+1,fn=new o.Point(Y.getx(ln),Y.gety(ln)),hn=Hn(fn,O),Li=hn.signedDistanceFromCamera>0?hn.point:xu(dt,fn,Ir,1,O),Ur=Fa(y.writingMode,Ir,Li,Pt);if(Ur)return Ur}var Pn=Ra(Ht*H.getoffsetX(y.glyphStartIndex),St,Ut,_,ct,dt,y.segment,y.lineStartIndex,y.lineStartIndex+y.lineLength,Y,F,pt);if(!Pn)return{notEnoughRoom:!0};Mt=[Pn]}for(var jn=0,Ln=Mt;jn<Ln.length;jn+=1){var Sn=Ln[jn];o.addDynamicAttributes(rt,Sn.point,Sn.angle)}return{}}function xu(y,b,_,C,O){var F=Hn(y.add(y.sub(b)._unit()),O).point,B=_.sub(F);return _.add(B._mult(C/B.mag()))}function Ra(y,b,_,C,O,F,B,H,Y,rt,ct,dt){var pt=C?y-b:y+b,Pt=pt>0?1:-1,Mt=0;C&&(Pt*=-1,Mt=Math.PI),Pt<0&&(Mt+=Math.PI);for(var Ht=Pt>0?H+B:H+B+1,St=O,Ut=O,Kt=0,le=0,we=Math.abs(pt),ve=[];Kt+le<=we;){if((Ht+=Pt)<H||Ht>=Y)return null;if(Ut=St,ve.push(St),(St=dt[Ht])===void 0){var Me=new o.Point(rt.getx(Ht),rt.gety(Ht)),Ge=Hn(Me,ct);if(Ge.signedDistanceFromCamera>0)St=dt[Ht]=Ge.point;else{var hr=Ht-Pt;St=xu(Kt===0?F:new o.Point(rt.getx(hr),rt.gety(hr)),Me,Ut,we-Kt+1,ct)}}Kt+=le,le=Ut.dist(St)}var or=(we-Kt)/le,Ir=St.sub(Ut),ln=Ir.mult(or)._add(Ut);ln._add(Ir._unit()._perp()._mult(_*Pt));var fn=Mt+Math.atan2(St.y-Ut.y,St.x-Ut.x);return ve.push(ln),{point:ln,angle:fn,path:ve}}vi.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},vi.prototype.insert=function(y,b,_,C,O){this._forEachCell(b,_,C,O,this._insertBoxCell,this.boxUid++),this.boxKeys.push(y),this.bboxes.push(b),this.bboxes.push(_),this.bboxes.push(C),this.bboxes.push(O)},vi.prototype.insertCircle=function(y,b,_,C){this._forEachCell(b-C,_-C,b+C,_+C,this._insertCircleCell,this.circleUid++),this.circleKeys.push(y),this.circles.push(b),this.circles.push(_),this.circles.push(C)},vi.prototype._insertBoxCell=function(y,b,_,C,O,F){this.boxCells[O].push(F)},vi.prototype._insertCircleCell=function(y,b,_,C,O,F){this.circleCells[O].push(F)},vi.prototype._query=function(y,b,_,C,O,F){if(_<0||y>this.width||C<0||b>this.height)return!O&&[];var B=[];if(y<=0&&b<=0&&this.width<=_&&this.height<=C){if(O)return!0;for(var H=0;H<this.boxKeys.length;H++)B.push({key:this.boxKeys[H],x1:this.bboxes[4*H],y1:this.bboxes[4*H+1],x2:this.bboxes[4*H+2],y2:this.bboxes[4*H+3]});for(var Y=0;Y<this.circleKeys.length;Y++){var rt=this.circles[3*Y],ct=this.circles[3*Y+1],dt=this.circles[3*Y+2];B.push({key:this.circleKeys[Y],x1:rt-dt,y1:ct-dt,x2:rt+dt,y2:ct+dt})}return F?B.filter(F):B}return this._forEachCell(y,b,_,C,this._queryCell,B,{hitTest:O,seenUids:{box:{},circle:{}}},F),O?B.length>0:B},vi.prototype._queryCircle=function(y,b,_,C,O){var F=y-_,B=y+_,H=b-_,Y=b+_;if(B<0||F>this.width||Y<0||H>this.height)return!C&&[];var rt=[];return this._forEachCell(F,H,B,Y,this._queryCellCircle,rt,{hitTest:C,circle:{x:y,y:b,radius:_},seenUids:{box:{},circle:{}}},O),C?rt.length>0:rt},vi.prototype.query=function(y,b,_,C,O){return this._query(y,b,_,C,!1,O)},vi.prototype.hitTest=function(y,b,_,C,O){return this._query(y,b,_,C,!0,O)},vi.prototype.hitTestCircle=function(y,b,_,C){return this._queryCircle(y,b,_,!0,C)},vi.prototype._queryCell=function(y,b,_,C,O,F,B,H){var Y=B.seenUids,rt=this.boxCells[O];if(rt!==null)for(var ct=this.bboxes,dt=0,pt=rt;dt<pt.length;dt+=1){var Pt=pt[dt];if(!Y.box[Pt]){Y.box[Pt]=!0;var Mt=4*Pt;if(y<=ct[Mt+2]&&b<=ct[Mt+3]&&_>=ct[Mt+0]&&C>=ct[Mt+1]&&(!H||H(this.boxKeys[Pt]))){if(B.hitTest)return F.push(!0),!0;F.push({key:this.boxKeys[Pt],x1:ct[Mt],y1:ct[Mt+1],x2:ct[Mt+2],y2:ct[Mt+3]})}}}var Ht=this.circleCells[O];if(Ht!==null)for(var St=this.circles,Ut=0,Kt=Ht;Ut<Kt.length;Ut+=1){var le=Kt[Ut];if(!Y.circle[le]){Y.circle[le]=!0;var we=3*le;if(this._circleAndRectCollide(St[we],St[we+1],St[we+2],y,b,_,C)&&(!H||H(this.circleKeys[le]))){if(B.hitTest)return F.push(!0),!0;var ve=St[we],Me=St[we+1],Ge=St[we+2];F.push({key:this.circleKeys[le],x1:ve-Ge,y1:Me-Ge,x2:ve+Ge,y2:Me+Ge})}}}},vi.prototype._queryCellCircle=function(y,b,_,C,O,F,B,H){var Y=B.circle,rt=B.seenUids,ct=this.boxCells[O];if(ct!==null)for(var dt=this.bboxes,pt=0,Pt=ct;pt<Pt.length;pt+=1){var Mt=Pt[pt];if(!rt.box[Mt]){rt.box[Mt]=!0;var Ht=4*Mt;if(this._circleAndRectCollide(Y.x,Y.y,Y.radius,dt[Ht+0],dt[Ht+1],dt[Ht+2],dt[Ht+3])&&(!H||H(this.boxKeys[Mt])))return F.push(!0),!0}}var St=this.circleCells[O];if(St!==null)for(var Ut=this.circles,Kt=0,le=St;Kt<le.length;Kt+=1){var we=le[Kt];if(!rt.circle[we]){rt.circle[we]=!0;var ve=3*we;if(this._circlesCollide(Ut[ve],Ut[ve+1],Ut[ve+2],Y.x,Y.y,Y.radius)&&(!H||H(this.circleKeys[we])))return F.push(!0),!0}}},vi.prototype._forEachCell=function(y,b,_,C,O,F,B,H){for(var Y=this._convertToXCellCoord(y),rt=this._convertToYCellCoord(b),ct=this._convertToXCellCoord(_),dt=this._convertToYCellCoord(C),pt=Y;pt<=ct;pt++)for(var Pt=rt;Pt<=dt;Pt++)if(O.call(this,y,b,_,C,this.xCellCount*Pt+pt,F,B,H))return},vi.prototype._convertToXCellCoord=function(y){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(y*this.xScale)))},vi.prototype._convertToYCellCoord=function(y){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(y*this.yScale)))},vi.prototype._circlesCollide=function(y,b,_,C,O,F){var B=C-y,H=O-b,Y=_+F;return Y*Y>B*B+H*H},vi.prototype._circleAndRectCollide=function(y,b,_,C,O,F,B){var H=(F-C)/2,Y=Math.abs(y-(C+H));if(Y>H+_)return!1;var rt=(B-O)/2,ct=Math.abs(b-(O+rt));if(ct>rt+_)return!1;if(Y<=H||ct<=rt)return!0;var dt=Y-H,pt=ct-rt;return dt*dt+pt*pt<=_*_};var gh=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Vo(y,b){for(var _=0;_<y;_++){var C=b.length;b.resize(C+4),b.float32.set(gh,3*C)}}function Ia(y,b,_){var C=b[0],O=b[1];return y[0]=_[0]*C+_[4]*O+_[12],y[1]=_[1]*C+_[5]*O+_[13],y[3]=_[3]*C+_[7]*O+_[15],y}var oo=function(y,b,_){b===void 0&&(b=new vi(y.width+200,y.height+200,25)),_===void 0&&(_=new vi(y.width+200,y.height+200,25)),this.transform=y,this.grid=b,this.ignoredGrid=_,this.pitchfactor=Math.cos(y._pitch)*y.cameraToCenterDistance,this.screenRightBoundary=y.width+100,this.screenBottomBoundary=y.height+100,this.gridRightBoundary=y.width+200,this.gridBottomBoundary=y.height+200};function ya(y,b,_){return b*(o.EXTENT/(y.tileSize*Math.pow(2,_-y.tileID.overscaledZ)))}oo.prototype.placeCollisionBox=function(y,b,_,C,O){var F=this.projectAndGetPerspectiveRatio(C,y.anchorPointX,y.anchorPointY),B=_*F.perspectiveRatio,H=y.x1*B+F.point.x,Y=y.y1*B+F.point.y,rt=y.x2*B+F.point.x,ct=y.y2*B+F.point.y;return!this.isInsideGrid(H,Y,rt,ct)||!b&&this.grid.hitTest(H,Y,rt,ct,O)?{box:[],offscreen:!1}:{box:[H,Y,rt,ct],offscreen:this.isOffscreen(H,Y,rt,ct)}},oo.prototype.placeCollisionCircles=function(y,b,_,C,O,F,B,H,Y,rt,ct,dt,pt){var Pt=[],Mt=new o.Point(b.anchorX,b.anchorY),Ht=Hn(Mt,F),St=si(this.transform.cameraToCenterDistance,Ht.signedDistanceFromCamera),Ut=(rt?O/St:O*St)/o.ONE_EM,Kt=Hn(Mt,B).point,le=ao(Ut,C,b.lineOffsetX*Ut,b.lineOffsetY*Ut,!1,Kt,Mt,b,_,B,{}),we=!1,ve=!1,Me=!0;if(le){for(var Ge=.5*dt*St+pt,hr=new o.Point(-100,-100),or=new o.Point(this.screenRightBoundary,this.screenBottomBoundary),Ir=new go,ln=le.first,fn=le.last,hn=[],Li=ln.path.length-1;Li>=1;Li--)hn.push(ln.path[Li]);for(var Ur=1;Ur<fn.path.length;Ur++)hn.push(fn.path[Ur]);var Pn=2.5*Ge;if(H){var jn=hn.map(function(Fl){return Hn(Fl,H)});hn=jn.some(function(Fl){return Fl.signedDistanceFromCamera<=0})?[]:jn.map(function(Fl){return Fl.point})}var Ln=[];if(hn.length>0){for(var Sn=hn[0].clone(),Vn=hn[0].clone(),Tn=1;Tn<hn.length;Tn++)Sn.x=Math.min(Sn.x,hn[Tn].x),Sn.y=Math.min(Sn.y,hn[Tn].y),Vn.x=Math.max(Vn.x,hn[Tn].x),Vn.y=Math.max(Vn.y,hn[Tn].y);Ln=Sn.x>=hr.x&&Vn.x<=or.x&&Sn.y>=hr.y&&Vn.y<=or.y?[hn]:Vn.x<hr.x||Sn.x>or.x||Vn.y<hr.y||Sn.y>or.y?[]:o.clipLine([hn],hr.x,hr.y,or.x,or.y)}for(var En=0,Ro=Ln;En<Ro.length;En+=1){var Za;Ir.reset(Ro[En],.25*Ge),Za=Ir.length<=.5*Ge?1:Math.ceil(Ir.paddedLength/Pn)+1;for(var ds=0;ds<Za;ds++){var jo=ds/Math.max(Za-1,1),Xa=Ir.lerp(jo),qa=Xa.x+100,qs=Xa.y+100;Pt.push(qa,qs,Ge,0);var Us=qa-Ge,Tc=qs-Ge,Ks=qa+Ge,Mu=qs+Ge;if(Me=Me&&this.isOffscreen(Us,Tc,Ks,Mu),ve=ve||this.isInsideGrid(Us,Tc,Ks,Mu),!y&&this.grid.hitTestCircle(qa,qs,Ge,ct)&&(we=!0,!Y))return{circles:[],offscreen:!1,collisionDetected:we}}}}return{circles:!Y&&we||!ve?[]:Pt,offscreen:Me,collisionDetected:we}},oo.prototype.queryRenderedSymbols=function(y){if(y.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var b=[],_=1/0,C=1/0,O=-1/0,F=-1/0,B=0,H=y;B<H.length;B+=1){var Y=H[B],rt=new o.Point(Y.x+100,Y.y+100);_=Math.min(_,rt.x),C=Math.min(C,rt.y),O=Math.max(O,rt.x),F=Math.max(F,rt.y),b.push(rt)}for(var ct={},dt={},pt=0,Pt=this.grid.query(_,C,O,F).concat(this.ignoredGrid.query(_,C,O,F));pt<Pt.length;pt+=1){var Mt=Pt[pt],Ht=Mt.key;if(ct[Ht.bucketInstanceId]===void 0&&(ct[Ht.bucketInstanceId]={}),!ct[Ht.bucketInstanceId][Ht.featureIndex]){var St=[new o.Point(Mt.x1,Mt.y1),new o.Point(Mt.x2,Mt.y1),new o.Point(Mt.x2,Mt.y2),new o.Point(Mt.x1,Mt.y2)];o.polygonIntersectsPolygon(b,St)&&(ct[Ht.bucketInstanceId][Ht.featureIndex]=!0,dt[Ht.bucketInstanceId]===void 0&&(dt[Ht.bucketInstanceId]=[]),dt[Ht.bucketInstanceId].push(Ht.featureIndex))}}return dt},oo.prototype.insertCollisionBox=function(y,b,_,C,O){(b?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:C,collisionGroupID:O},y[0],y[1],y[2],y[3])},oo.prototype.insertCollisionCircles=function(y,b,_,C,O){for(var F=b?this.ignoredGrid:this.grid,B={bucketInstanceId:_,featureIndex:C,collisionGroupID:O},H=0;H<y.length;H+=4)F.insertCircle(B,y[H],y[H+1],y[H+2])},oo.prototype.projectAndGetPerspectiveRatio=function(y,b,_){var C=[b,_,0,1];return Ia(C,C,y),{point:new o.Point((C[0]/C[3]+1)/2*this.transform.width+100,(-C[1]/C[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/C[3]*.5}},oo.prototype.isOffscreen=function(y,b,_,C){return _<100||y>=this.screenRightBoundary||C<100||b>this.screenBottomBoundary},oo.prototype.isInsideGrid=function(y,b,_,C){return _>=0&&y<this.gridRightBoundary&&C>=0&&b<this.gridBottomBoundary},oo.prototype.getViewportMatrix=function(){var y=o.identity([]);return o.translate(y,y,[-100,-100,0]),y};var js=function(y,b,_,C){this.opacity=y?Math.max(0,Math.min(1,y.opacity+(y.placed?b:-b))):C&&_?1:0,this.placed=_};js.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Ns=function(y,b,_,C,O){this.text=new js(y?y.text:null,b,_,O),this.icon=new js(y?y.icon:null,b,C,O)};Ns.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var mv=function(y,b,_){this.text=y,this.icon=b,this.skipFade=_},Rl=function(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]},P0=function(y,b,_,C,O){this.bucketInstanceId=y,this.featureIndex=b,this.sourceLayerIndex=_,this.bucketIndex=C,this.tileID=O},st=function(y){this.crossSourceCollisions=y,this.maxGroupID=0,this.collisionGroups={}};function gt(y,b,_,C,O){var F=o.getAnchorAlignment(y),B=-(F.horizontalAlign-.5)*b,H=-(F.verticalAlign-.5)*_,Y=o.evaluateVariableOffset(y,C);return new o.Point(B+Y[0]*O,H+Y[1]*O)}function Gt(y,b,_,C,O,F){var B=y.x1,H=y.x2,Y=y.y1,rt=y.y2,ct=y.anchorPointX,dt=y.anchorPointY,pt=new o.Point(b,_);return C&&pt._rotate(O?F:-F),{x1:B+pt.x,y1:Y+pt.y,x2:H+pt.x,y2:rt+pt.y,anchorPointX:ct,anchorPointY:dt}}st.prototype.get=function(y){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[y]){var b=++this.maxGroupID;this.collisionGroups[y]={ID:b,predicate:function(_){return _.collisionGroupID===b}}}return this.collisionGroups[y]};var ye=function(y,b,_,C){this.transform=y.clone(),this.collisionIndex=new oo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=b,this.retainedQueryData={},this.collisionGroups=new st(_),this.collisionCircleArrays={},this.prevPlacement=C,C&&(C.prevPlacement=void 0),this.placedOrientations={}};function cr(y,b,_,C,O){y.emplaceBack(b?1:0,_?1:0,C||0,O||0),y.emplaceBack(b?1:0,_?1:0,C||0,O||0),y.emplaceBack(b?1:0,_?1:0,C||0,O||0),y.emplaceBack(b?1:0,_?1:0,C||0,O||0)}ye.prototype.getBucketParts=function(y,b,_,C){var O=_.getBucket(b),F=_.latestFeatureIndex;if(O&&F&&b.id===O.layerIds[0]){var B=_.collisionBoxArray,H=O.layers[0].layout,Y=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),rt=_.tileSize/o.EXTENT,ct=this.transform.calculatePosMatrix(_.tileID.toUnwrapped()),dt=H.get("text-pitch-alignment")==="map",pt=H.get("text-rotation-alignment")==="map",Pt=ya(_,1,this.transform.zoom),Mt=ia(ct,dt,pt,this.transform,Pt),Ht=null;if(dt){var St=Bi(ct,dt,pt,this.transform,Pt);Ht=o.multiply([],this.transform.labelPlaneMatrix,St)}this.retainedQueryData[O.bucketInstanceId]=new P0(O.bucketInstanceId,F,O.sourceLayerIndex,O.index,_.tileID);var Ut={bucket:O,layout:H,posMatrix:ct,textLabelPlaneMatrix:Mt,labelToScreenMatrix:Ht,scale:Y,textPixelRatio:rt,holdingForFade:_.holdingForFade(),collisionBoxArray:B,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(O.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(O.sourceID)};if(C)for(var Kt=0,le=O.sortKeyRanges;Kt<le.length;Kt+=1){var we=le[Kt];y.push({sortKey:we.sortKey,symbolInstanceStart:we.symbolInstanceStart,symbolInstanceEnd:we.symbolInstanceEnd,parameters:Ut})}else y.push({symbolInstanceStart:0,symbolInstanceEnd:O.symbolInstances.length,parameters:Ut})}},ye.prototype.attemptAnchorPlacement=function(y,b,_,C,O,F,B,H,Y,rt,ct,dt,pt,Pt,Mt){var Ht,St=[dt.textOffset0,dt.textOffset1],Ut=gt(y,_,C,St,O),Kt=this.collisionIndex.placeCollisionBox(Gt(b,Ut.x,Ut.y,F,B,this.transform.angle),ct,H,Y,rt.predicate);if(!Mt||this.collisionIndex.placeCollisionBox(Gt(Mt,Ut.x,Ut.y,F,B,this.transform.angle),ct,H,Y,rt.predicate).box.length!==0)return Kt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[dt.crossTileID]&&this.prevPlacement.placements[dt.crossTileID]&&this.prevPlacement.placements[dt.crossTileID].text&&(Ht=this.prevPlacement.variableOffsets[dt.crossTileID].anchor),this.variableOffsets[dt.crossTileID]={textOffset:St,width:_,height:C,anchor:y,textBoxScale:O,prevAnchor:Ht},this.markUsedJustification(pt,y,dt,Pt),pt.allowVerticalPlacement&&(this.markUsedOrientation(pt,Pt,dt),this.placedOrientations[dt.crossTileID]=Pt),{shift:Ut,placedGlyphBoxes:Kt}):void 0},ye.prototype.placeLayerBucketPart=function(y,b,_){var C=this,O=y.parameters,F=O.bucket,B=O.layout,H=O.posMatrix,Y=O.textLabelPlaneMatrix,rt=O.labelToScreenMatrix,ct=O.textPixelRatio,dt=O.holdingForFade,pt=O.collisionBoxArray,Pt=O.partiallyEvaluatedTextSize,Mt=O.collisionGroup,Ht=B.get("text-optional"),St=B.get("icon-optional"),Ut=B.get("text-allow-overlap"),Kt=B.get("icon-allow-overlap"),le=B.get("text-rotation-alignment")==="map",we=B.get("text-pitch-alignment")==="map",ve=B.get("icon-text-fit")!=="none",Me=B.get("symbol-z-order")==="viewport-y",Ge=Ut&&(Kt||!F.hasIconData()||St),hr=Kt&&(Ut||!F.hasTextData()||Ht);!F.collisionArrays&&pt&&F.deserializeCollisionBoxes(pt);var or=function(Ur,Pn){if(!b[Ur.crossTileID])if(dt)C.placements[Ur.crossTileID]=new mv(!1,!1,!1);else{var jn,Ln=!1,Sn=!1,Vn=!0,Tn=null,En={box:null,offscreen:null},Ro={box:null,offscreen:null},Za=null,ds=null,jo=0,Xa=0,qa=0;Pn.textFeatureIndex?jo=Pn.textFeatureIndex:Ur.useRuntimeCollisionCircles&&(jo=Ur.featureIndex),Pn.verticalTextFeatureIndex&&(Xa=Pn.verticalTextFeatureIndex);var qs=Pn.textBox;if(qs){var Us=function(xi){var ps=o.WritingMode.horizontal;if(F.allowVerticalPlacement&&!xi&&C.prevPlacement){var Io=C.prevPlacement.placedOrientations[Ur.crossTileID];Io&&(C.placedOrientations[Ur.crossTileID]=Io,C.markUsedOrientation(F,ps=Io,Ur))}return ps},Tc=function(xi,ps){if(F.allowVerticalPlacement&&Ur.numVerticalGlyphVertices>0&&Pn.verticalTextBox)for(var Io=0,Mc=F.writingModes;Io<Mc.length&&(Mc[Io]===o.WritingMode.vertical?(En=ps(),Ro=En):En=xi(),!(En&&En.box&&En.box.length));Io+=1);else En=xi()};if(B.get("text-variable-anchor")){var Ks=B.get("text-variable-anchor");if(C.prevPlacement&&C.prevPlacement.variableOffsets[Ur.crossTileID]){var Mu=C.prevPlacement.variableOffsets[Ur.crossTileID];Ks.indexOf(Mu.anchor)>0&&(Ks=Ks.filter(function(xi){return xi!==Mu.anchor})).unshift(Mu.anchor)}var Fl=function(xi,ps,Io){for(var Mc=xi.x2-xi.x1,om=xi.y2-xi.y1,Tf=Ur.textBoxScale,ey=ve&&!Kt?ps:null,bd={box:[],offscreen:!1},Ed=Ut?2*Ks.length:Ks.length,Ju=0;Ju<Ed;++Ju){var sm=C.attemptAnchorPlacement(Ks[Ju%Ks.length],xi,Mc,om,Tf,le,we,ct,H,Mt,Ju>=Ks.length,Ur,F,Io,ey);if(sm&&(bd=sm.placedGlyphBoxes)&&bd.box&&bd.box.length){Ln=!0,Tn=sm.shift;break}}return bd};Tc(function(){return Fl(qs,Pn.iconBox,o.WritingMode.horizontal)},function(){var xi=Pn.verticalTextBox;return F.allowVerticalPlacement&&!(En&&En.box&&En.box.length)&&Ur.numVerticalGlyphVertices>0&&xi?Fl(xi,Pn.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null}}),En&&(Ln=En.box,Vn=En.offscreen);var _p=Us(En&&En.box);if(!Ln&&C.prevPlacement){var xd=C.prevPlacement.variableOffsets[Ur.crossTileID];xd&&(C.variableOffsets[Ur.crossTileID]=xd,C.markUsedJustification(F,xd.anchor,Ur,_p))}}else{var Ac=function(xi,ps){var Io=C.collisionIndex.placeCollisionBox(xi,Ut,ct,H,Mt.predicate);return Io&&Io.box&&Io.box.length&&(C.markUsedOrientation(F,ps,Ur),C.placedOrientations[Ur.crossTileID]=ps),Io};Tc(function(){return Ac(qs,o.WritingMode.horizontal)},function(){var xi=Pn.verticalTextBox;return F.allowVerticalPlacement&&Ur.numVerticalGlyphVertices>0&&xi?Ac(xi,o.WritingMode.vertical):{box:null,offscreen:null}}),Us(En&&En.box&&En.box.length)}}if(Ln=(jn=En)&&jn.box&&jn.box.length>0,Vn=jn&&jn.offscreen,Ur.useRuntimeCollisionCircles){var Cf=F.text.placedSymbolArray.get(Ur.centerJustifiedTextSymbolIndex),Mh=o.evaluateSizeForFeature(F.textSizeData,Pt,Cf),Ku=B.get("text-padding");Za=C.collisionIndex.placeCollisionCircles(Ut,Cf,F.lineVertexArray,F.glyphOffsetArray,Mh,H,Y,rt,_,we,Mt.predicate,Ur.collisionCircleDiameter,Ku),Ln=Ut||Za.circles.length>0&&!Za.collisionDetected,Vn=Vn&&Za.offscreen}if(Pn.iconFeatureIndex&&(qa=Pn.iconFeatureIndex),Pn.iconBox){var Sf=function(xi){var ps=ve&&Tn?Gt(xi,Tn.x,Tn.y,le,we,C.transform.angle):xi;return C.collisionIndex.placeCollisionBox(ps,Kt,ct,H,Mt.predicate)};Sn=Ro&&Ro.box&&Ro.box.length&&Pn.verticalIconBox?(ds=Sf(Pn.verticalIconBox)).box.length>0:(ds=Sf(Pn.iconBox)).box.length>0,Vn=Vn&&ds.offscreen}var Ts=Ht||Ur.numHorizontalGlyphVertices===0&&Ur.numVerticalGlyphVertices===0,uo=St||Ur.numIconVertices===0;if(Ts||uo?uo?Ts||(Sn=Sn&&Ln):Ln=Sn&&Ln:Sn=Ln=Sn&&Ln,Ln&&jn&&jn.box&&C.collisionIndex.insertCollisionBox(jn.box,B.get("text-ignore-placement"),F.bucketInstanceId,Ro&&Ro.box&&Xa?Xa:jo,Mt.ID),Sn&&ds&&C.collisionIndex.insertCollisionBox(ds.box,B.get("icon-ignore-placement"),F.bucketInstanceId,qa,Mt.ID),Za&&(Ln&&C.collisionIndex.insertCollisionCircles(Za.circles,B.get("text-ignore-placement"),F.bucketInstanceId,jo,Mt.ID),_)){var ul=F.bucketInstanceId,Ru=C.collisionCircleArrays[ul];Ru===void 0&&(Ru=C.collisionCircleArrays[ul]=new Rl);for(var Qu=0;Qu<Za.circles.length;Qu+=4)Ru.circles.push(Za.circles[Qu+0]),Ru.circles.push(Za.circles[Qu+1]),Ru.circles.push(Za.circles[Qu+2]),Ru.circles.push(Za.collisionDetected?1:0)}C.placements[Ur.crossTileID]=new mv(Ln||Ge,Sn||hr,Vn||F.justReloaded),b[Ur.crossTileID]=!0}};if(Me)for(var Ir=F.getSortedSymbolIndexes(this.transform.angle),ln=Ir.length-1;ln>=0;--ln){var fn=Ir[ln];or(F.symbolInstances.get(fn),F.collisionArrays[fn])}else for(var hn=y.symbolInstanceStart;hn<y.symbolInstanceEnd;hn++)or(F.symbolInstances.get(hn),F.collisionArrays[hn]);if(_&&F.bucketInstanceId in this.collisionCircleArrays){var Li=this.collisionCircleArrays[F.bucketInstanceId];o.invert(Li.invProjMatrix,H),Li.viewportMatrix=this.collisionIndex.getViewportMatrix()}F.justReloaded=!1},ye.prototype.markUsedJustification=function(y,b,_,C){var O;O=C===o.WritingMode.vertical?_.verticalPlacedTextSymbolIndex:{left:_.leftJustifiedTextSymbolIndex,center:_.centerJustifiedTextSymbolIndex,right:_.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(b)];for(var F=0,B=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex,_.verticalPlacedTextSymbolIndex];F<B.length;F+=1){var H=B[F];H>=0&&(y.text.placedSymbolArray.get(H).crossTileID=O>=0&&H!==O?0:_.crossTileID)}},ye.prototype.markUsedOrientation=function(y,b,_){for(var C=b===o.WritingMode.horizontal||b===o.WritingMode.horizontalOnly?b:0,O=b===o.WritingMode.vertical?b:0,F=0,B=[_.leftJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.rightJustifiedTextSymbolIndex];F<B.length;F+=1)y.text.placedSymbolArray.get(B[F]).placedOrientation=C;_.verticalPlacedTextSymbolIndex&&(y.text.placedSymbolArray.get(_.verticalPlacedTextSymbolIndex).placedOrientation=O)},ye.prototype.commit=function(y){this.commitTime=y,this.zoomAtLastRecencyCheck=this.transform.zoom;var b=this.prevPlacement,_=!1;this.prevZoomAdjustment=b?b.zoomAdjustment(this.transform.zoom):0;var C=b?b.symbolFadeChange(y):1,O=b?b.opacities:{},F=b?b.variableOffsets:{},B=b?b.placedOrientations:{};for(var H in this.placements){var Y=this.placements[H],rt=O[H];rt?(this.opacities[H]=new Ns(rt,C,Y.text,Y.icon),_=_||Y.text!==rt.text.placed||Y.icon!==rt.icon.placed):(this.opacities[H]=new Ns(null,C,Y.text,Y.icon,Y.skipFade),_=_||Y.text||Y.icon)}for(var ct in O){var dt=O[ct];if(!this.opacities[ct]){var pt=new Ns(dt,C,!1,!1);pt.isHidden()||(this.opacities[ct]=pt,_=_||dt.text.placed||dt.icon.placed)}}for(var Pt in F)this.variableOffsets[Pt]||!this.opacities[Pt]||this.opacities[Pt].isHidden()||(this.variableOffsets[Pt]=F[Pt]);for(var Mt in B)this.placedOrientations[Mt]||!this.opacities[Mt]||this.opacities[Mt].isHidden()||(this.placedOrientations[Mt]=B[Mt]);_?this.lastPlacementChangeTime=y:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=b?b.lastPlacementChangeTime:y)},ye.prototype.updateLayerOpacities=function(y,b){for(var _={},C=0,O=b;C<O.length;C+=1){var F=O[C],B=F.getBucket(y);B&&F.latestFeatureIndex&&y.id===B.layerIds[0]&&this.updateBucketOpacities(B,_,F.collisionBoxArray)}},ye.prototype.updateBucketOpacities=function(y,b,_){var C=this;y.hasTextData()&&y.text.opacityVertexArray.clear(),y.hasIconData()&&y.icon.opacityVertexArray.clear(),y.hasIconCollisionBoxData()&&y.iconCollisionBox.collisionVertexArray.clear(),y.hasTextCollisionBoxData()&&y.textCollisionBox.collisionVertexArray.clear();var O=y.layers[0].layout,F=new Ns(null,0,!1,!1,!0),B=O.get("text-allow-overlap"),H=O.get("icon-allow-overlap"),Y=O.get("text-variable-anchor"),rt=O.get("text-rotation-alignment")==="map",ct=O.get("text-pitch-alignment")==="map",dt=O.get("icon-text-fit")!=="none",pt=new Ns(null,0,B&&(H||!y.hasIconData()||O.get("icon-optional")),H&&(B||!y.hasTextData()||O.get("text-optional")),!0);!y.collisionArrays&&_&&(y.hasIconCollisionBoxData()||y.hasTextCollisionBoxData())&&y.deserializeCollisionBoxes(_);for(var Pt=function(Ut,Kt,le){for(var we=0;we<Kt/4;we++)Ut.opacityVertexArray.emplaceBack(le)},Mt=function(Ut){var Kt=y.symbolInstances.get(Ut),le=Kt.numHorizontalGlyphVertices,we=Kt.numVerticalGlyphVertices,ve=Kt.crossTileID,Me=C.opacities[ve];b[ve]?Me=F:Me||(C.opacities[ve]=Me=pt),b[ve]=!0;var Ge=Kt.numIconVertices>0,hr=C.placedOrientations[Kt.crossTileID],or=hr===o.WritingMode.vertical,Ir=hr===o.WritingMode.horizontal||hr===o.WritingMode.horizontalOnly;if(le>0||we>0){var ln=Z_(Me.text);Pt(y.text,le,or?lp:ln),Pt(y.text,we,Ir?lp:ln);var fn=Me.text.isHidden();[Kt.rightJustifiedTextSymbolIndex,Kt.centerJustifiedTextSymbolIndex,Kt.leftJustifiedTextSymbolIndex].forEach(function(En){En>=0&&(y.text.placedSymbolArray.get(En).hidden=fn||or?1:0)}),Kt.verticalPlacedTextSymbolIndex>=0&&(y.text.placedSymbolArray.get(Kt.verticalPlacedTextSymbolIndex).hidden=fn||Ir?1:0);var hn=C.variableOffsets[Kt.crossTileID];hn&&C.markUsedJustification(y,hn.anchor,Kt,hr);var Li=C.placedOrientations[Kt.crossTileID];Li&&(C.markUsedJustification(y,"left",Kt,Li),C.markUsedOrientation(y,Li,Kt))}if(Ge){var Ur=Z_(Me.icon),Pn=!(dt&&Kt.verticalPlacedIconSymbolIndex&&or);Kt.placedIconSymbolIndex>=0&&(Pt(y.icon,Kt.numIconVertices,Pn?Ur:lp),y.icon.placedSymbolArray.get(Kt.placedIconSymbolIndex).hidden=Me.icon.isHidden()),Kt.verticalPlacedIconSymbolIndex>=0&&(Pt(y.icon,Kt.numVerticalIconVertices,Pn?lp:Ur),y.icon.placedSymbolArray.get(Kt.verticalPlacedIconSymbolIndex).hidden=Me.icon.isHidden())}if(y.hasIconCollisionBoxData()||y.hasTextCollisionBoxData()){var jn=y.collisionArrays[Ut];if(jn){var Ln=new o.Point(0,0);if(jn.textBox||jn.verticalTextBox){var Sn=!0;if(Y){var Vn=C.variableOffsets[ve];Vn?(Ln=gt(Vn.anchor,Vn.width,Vn.height,Vn.textOffset,Vn.textBoxScale),rt&&Ln._rotate(ct?C.transform.angle:-C.transform.angle)):Sn=!1}jn.textBox&&cr(y.textCollisionBox.collisionVertexArray,Me.text.placed,!Sn||or,Ln.x,Ln.y),jn.verticalTextBox&&cr(y.textCollisionBox.collisionVertexArray,Me.text.placed,!Sn||Ir,Ln.x,Ln.y)}var Tn=!!(!Ir&&jn.verticalIconBox);jn.iconBox&&cr(y.iconCollisionBox.collisionVertexArray,Me.icon.placed,Tn,dt?Ln.x:0,dt?Ln.y:0),jn.verticalIconBox&&cr(y.iconCollisionBox.collisionVertexArray,Me.icon.placed,!Tn,dt?Ln.x:0,dt?Ln.y:0)}}},Ht=0;Ht<y.symbolInstances.length;Ht++)Mt(Ht);if(y.sortFeatures(this.transform.angle),this.retainedQueryData[y.bucketInstanceId]&&(this.retainedQueryData[y.bucketInstanceId].featureSortOrder=y.featureSortOrder),y.hasTextData()&&y.text.opacityVertexBuffer&&y.text.opacityVertexBuffer.updateData(y.text.opacityVertexArray),y.hasIconData()&&y.icon.opacityVertexBuffer&&y.icon.opacityVertexBuffer.updateData(y.icon.opacityVertexArray),y.hasIconCollisionBoxData()&&y.iconCollisionBox.collisionVertexBuffer&&y.iconCollisionBox.collisionVertexBuffer.updateData(y.iconCollisionBox.collisionVertexArray),y.hasTextCollisionBoxData()&&y.textCollisionBox.collisionVertexBuffer&&y.textCollisionBox.collisionVertexBuffer.updateData(y.textCollisionBox.collisionVertexArray),y.bucketInstanceId in this.collisionCircleArrays){var St=this.collisionCircleArrays[y.bucketInstanceId];y.placementInvProjMatrix=St.invProjMatrix,y.placementViewportMatrix=St.viewportMatrix,y.collisionCircleArray=St.circles,delete this.collisionCircleArrays[y.bucketInstanceId]}},ye.prototype.symbolFadeChange=function(y){return this.fadeDuration===0?1:(y-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},ye.prototype.zoomAdjustment=function(y){return Math.max(0,(this.transform.zoom-y)/1.5)},ye.prototype.hasTransitions=function(y){return this.stale||y-this.lastPlacementChangeTime<this.fadeDuration},ye.prototype.stillRecent=function(y,b){var _=this.zoomAtLastRecencyCheck===b?1-this.zoomAdjustment(b):1;return this.zoomAtLastRecencyCheck=b,this.commitTime+this.fadeDuration*_>y},ye.prototype.setStale=function(){this.stale=!0};var an=Math.pow(2,25),Ii=Math.pow(2,24),bo=Math.pow(2,17),hs=Math.pow(2,16),Go=Math.pow(2,9),bu=Math.pow(2,8),Y_=Math.pow(2,1);function Z_(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;var b=y.placed?1:0,_=Math.floor(127*y.opacity);return _*an+b*Ii+_*bo+b*hs+_*Go+b*bu+_*Y_+b}var lp=0,D0=function(y){this._sortAcrossTiles=y.layout.get("symbol-z-order")!=="viewport-y"&&y.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};D0.prototype.continuePlacement=function(y,b,_,C,O){for(var F=this._bucketParts;this._currentTileIndex<y.length;)if(b.getBucketParts(F,C,y[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,O())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,F.sort(function(B,H){return B.sortKey-H.sortKey}));this._currentPartIndex<F.length;)if(b.placeLayerBucketPart(F[this._currentPartIndex],this._seenCrossTileIDs,_),this._currentPartIndex++,O())return!0;return!1};var yv=function(y,b,_,C,O,F,B){this.placement=new ye(y,O,F,B),this._currentPlacementIndex=b.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=C,this._done=!1};yv.prototype.isDone=function(){return this._done},yv.prototype.continuePlacement=function(y,b,_){for(var C=this,O=o.browser.now(),F=function(){var Y=o.browser.now()-O;return!C._forceFullPlacement&&Y>2};this._currentPlacementIndex>=0;){var B=b[y[this._currentPlacementIndex]],H=this.placement.collisionIndex.transform.zoom;if(B.type==="symbol"&&(!B.minzoom||B.minzoom<=H)&&(!B.maxzoom||B.maxzoom>H)){if(this._inProgressLayer||(this._inProgressLayer=new D0(B)),this._inProgressLayer.continuePlacement(_[B.source],this.placement,this._showCollisionBoxes,B,F))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},yv.prototype.commit=function(y){return this.placement.commit(y),this.placement};var q_=512/o.EXTENT/2,Ng=function(y,b,_){this.tileID=y,this.indexedSymbolInstances={},this.bucketInstanceId=_;for(var C=0;C<b.length;C++){var O=b.get(C),F=O.key;this.indexedSymbolInstances[F]||(this.indexedSymbolInstances[F]=[]),this.indexedSymbolInstances[F].push({crossTileID:O.crossTileID,coord:this.getScaledCoordinates(O,y)})}};Ng.prototype.getScaledCoordinates=function(y,b){var _=q_/Math.pow(2,b.canonical.z-this.tileID.canonical.z);return{x:Math.floor((b.canonical.x*o.EXTENT+y.anchorX)*_),y:Math.floor((b.canonical.y*o.EXTENT+y.anchorY)*_)}},Ng.prototype.findMatches=function(y,b,_){for(var C=this.tileID.canonical.z<b.canonical.z?1:Math.pow(2,this.tileID.canonical.z-b.canonical.z),O=0;O<y.length;O++){var F=y.get(O);if(!F.crossTileID){var B=this.indexedSymbolInstances[F.key];if(B)for(var H=this.getScaledCoordinates(F,b),Y=0,rt=B;Y<rt.length;Y+=1){var ct=rt[Y];if(Math.abs(ct.coord.x-H.x)<=C&&Math.abs(ct.coord.y-H.y)<=C&&!_[ct.crossTileID]){_[ct.crossTileID]=!0,F.crossTileID=ct.crossTileID;break}}}}};var Cs=function(){this.maxCrossTileID=0};Cs.prototype.generate=function(){return++this.maxCrossTileID};var of=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};of.prototype.handleWrapJump=function(y){var b=Math.round((y-this.lng)/360);if(b!==0)for(var _ in this.indexes){var C=this.indexes[_],O={};for(var F in C){var B=C[F];B.tileID=B.tileID.unwrapTo(B.tileID.wrap+b),O[B.tileID.key]=B}this.indexes[_]=O}this.lng=y},of.prototype.addBucket=function(y,b,_){if(this.indexes[y.overscaledZ]&&this.indexes[y.overscaledZ][y.key]){if(this.indexes[y.overscaledZ][y.key].bucketInstanceId===b.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(y.overscaledZ,this.indexes[y.overscaledZ][y.key])}for(var C=0;C<b.symbolInstances.length;C++)b.symbolInstances.get(C).crossTileID=0;this.usedCrossTileIDs[y.overscaledZ]||(this.usedCrossTileIDs[y.overscaledZ]={});var O=this.usedCrossTileIDs[y.overscaledZ];for(var F in this.indexes){var B=this.indexes[F];if(Number(F)>y.overscaledZ)for(var H in B){var Y=B[H];Y.tileID.isChildOf(y)&&Y.findMatches(b.symbolInstances,y,O)}else{var rt=B[y.scaledTo(Number(F)).key];rt&&rt.findMatches(b.symbolInstances,y,O)}}for(var ct=0;ct<b.symbolInstances.length;ct++){var dt=b.symbolInstances.get(ct);dt.crossTileID||(dt.crossTileID=_.generate(),O[dt.crossTileID]=!0)}return this.indexes[y.overscaledZ]===void 0&&(this.indexes[y.overscaledZ]={}),this.indexes[y.overscaledZ][y.key]=new Ng(y,b.symbolInstances,b.bucketInstanceId),!0},of.prototype.removeBucketCrossTileIDs=function(y,b){for(var _ in b.indexedSymbolInstances)for(var C=0,O=b.indexedSymbolInstances[_];C<O.length;C+=1)delete this.usedCrossTileIDs[y][O[C].crossTileID]},of.prototype.removeStaleBuckets=function(y){var b=!1;for(var _ in this.indexes){var C=this.indexes[_];for(var O in C)y[C[O].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,C[O]),delete C[O],b=!0)}return b};var sf=function(){this.layerIndexes={},this.crossTileIDs=new Cs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};sf.prototype.addLayer=function(y,b,_){var C=this.layerIndexes[y.id];C===void 0&&(C=this.layerIndexes[y.id]=new of);var O=!1,F={};C.handleWrapJump(_);for(var B=0,H=b;B<H.length;B+=1){var Y=H[B],rt=Y.getBucket(y);rt&&y.id===rt.layerIds[0]&&(rt.bucketInstanceId||(rt.bucketInstanceId=++this.maxBucketInstanceId),C.addBucket(Y.tileID,rt,this.crossTileIDs)&&(O=!0),F[rt.bucketInstanceId]=!0)}return C.removeStaleBuckets(F)&&(O=!0),O},sf.prototype.pruneUnusedLayers=function(y){var b={};for(var _ in y.forEach(function(C){b[C]=!0}),this.layerIndexes)b[_]||delete this.layerIndexes[_]};var mc=function(y,b){return o.emitValidationErrors(y,b&&b.filter(function(_){return _.identifier!=="source.canvas"}))},yc=o.pick(mr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),mh=o.pick(mr,["setCenter","setZoom","setBearing","setPitch"]),_v=function(){var y={},b=o.styleSpec.$version;for(var _ in o.styleSpec.$root){var C,O=o.styleSpec.$root[_];O.required&&(C=_==="version"?b:O.type==="array"?[]:{})!=null&&(y[_]=C)}return y}(),Il=function(y){function b(_,C){var O=this;C===void 0&&(C={}),y.call(this),this.map=_,this.dispatcher=new wt(Ie(),this),this.imageManager=new M,this.imageManager.setEventedParent(this),this.glyphManager=new J(_._requestManager,C.localIdeographFontFamily),this.lineAtlas=new at(256,512),this.crossTileSymbolIndex=new sf,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());var F=this;this._rtlTextPluginCallback=b.registerForPluginStateChange(function(B){F.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:B.pluginStatus,pluginURL:B.pluginURL},function(H,Y){if(o.triggerPluginCompletionEvent(H),Y&&Y.every(function(ct){return ct}))for(var rt in F.sourceCaches)F.sourceCaches[rt].reload()})}),this.on("data",function(B){if(B.dataType==="source"&&B.sourceDataType==="metadata"){var H=O.sourceCaches[B.sourceId];if(H){var Y=H.getSource();if(Y&&Y.vectorLayerIds)for(var rt in O._layers){var ct=O._layers[rt];ct.source===Y.id&&O._validateLayer(ct)}}}})}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.loadURL=function(_,C){var O=this;C===void 0&&(C={}),this.fire(new o.Event("dataloading",{dataType:"style"}));var F=typeof C.validate=="boolean"?C.validate:!o.isMapboxURL(_);_=this.map._requestManager.normalizeStyleURL(_,C.accessToken);var B=this.map._requestManager.transformRequest(_,o.ResourceType.Style);this._request=o.getJSON(B,function(H,Y){O._request=null,H?O.fire(new o.ErrorEvent(H)):Y&&O._load(Y,F)})},b.prototype.loadJSON=function(_,C){var O=this;C===void 0&&(C={}),this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.browser.frame(function(){O._request=null,O._load(_,C.validate!==!1)})},b.prototype.loadEmpty=function(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(_v,!1)},b.prototype._load=function(_,C){if(!C||!mc(this,o.validateStyle(_))){for(var O in this._loaded=!0,this.stylesheet=_,_.sources)this.addSource(O,_.sources[O],{validate:!1});_.sprite?this._loadSprite(_.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(_.glyphs);var F=pr(this.stylesheet.layers);this._order=F.map(function(rt){return rt.id}),this._layers={},this._serializedLayers={};for(var B=0,H=F;B<H.length;B+=1){var Y=H[B];(Y=o.createStyleLayer(Y)).setEventedParent(this,{layer:{id:Y.id}}),this._layers[Y.id]=Y,this._serializedLayers[Y.id]=Y.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new et(this.stylesheet.light),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}},b.prototype._loadSprite=function(_){var C=this;this._spriteRequest=function(O,F,B){var H,Y,rt,ct=o.browser.devicePixelRatio>1?"@2x":"",dt=o.getJSON(F.transformRequest(F.normalizeSpriteURL(O,ct,".json"),o.ResourceType.SpriteJSON),function(Mt,Ht){dt=null,rt||(rt=Mt,H=Ht,Pt())}),pt=o.getImage(F.transformRequest(F.normalizeSpriteURL(O,ct,".png"),o.ResourceType.SpriteImage),function(Mt,Ht){pt=null,rt||(rt=Mt,Y=Ht,Pt())});function Pt(){if(rt)B(rt);else if(H&&Y){var Mt=o.browser.getImageData(Y),Ht={};for(var St in H){var Ut=H[St],Kt=Ut.width,le=Ut.height,we=Ut.x,ve=Ut.y,Me=Ut.sdf,Ge=Ut.pixelRatio,hr=Ut.stretchX,or=Ut.stretchY,Ir=Ut.content,ln=new o.RGBAImage({width:Kt,height:le});o.RGBAImage.copy(Mt,ln,{x:we,y:ve},{x:0,y:0},{width:Kt,height:le}),Ht[St]={data:ln,pixelRatio:Ge,sdf:Me,stretchX:hr,stretchY:or,content:Ir}}B(null,Ht)}}return{cancel:function(){dt&&(dt.cancel(),dt=null),pt&&(pt.cancel(),pt=null)}}}(_,this.map._requestManager,function(O,F){if(C._spriteRequest=null,O)C.fire(new o.ErrorEvent(O));else if(F)for(var B in F)C.imageManager.addImage(B,F[B]);C.imageManager.setLoaded(!0),C._availableImages=C.imageManager.listImages(),C.dispatcher.broadcast("setImages",C._availableImages),C.fire(new o.Event("data",{dataType:"style"}))})},b.prototype._validateLayer=function(_){var C=this.sourceCaches[_.source];if(C){var O=_.sourceLayer;if(O){var F=C.getSource();(F.type==="geojson"||F.vectorLayerIds&&F.vectorLayerIds.indexOf(O)===-1)&&this.fire(new o.ErrorEvent(new Error('Source layer "'+O+'" does not exist on source "'+F.id+'" as specified by style layer "'+_.id+'"')))}}},b.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var _ in this.sourceCaches)if(!this.sourceCaches[_].loaded())return!1;return!!this.imageManager.isLoaded()},b.prototype._serializeLayers=function(_){for(var C=[],O=0,F=_;O<F.length;O+=1){var B=this._layers[F[O]];B.type!=="custom"&&C.push(B.serialize())}return C},b.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var _ in this.sourceCaches)if(this.sourceCaches[_].hasTransition())return!0;for(var C in this._layers)if(this._layers[C].hasTransition())return!0;return!1},b.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},b.prototype.update=function(_){if(this._loaded){var C=this._changed;if(this._changed){var O=Object.keys(this._updatedLayers),F=Object.keys(this._removedLayers);for(var B in(O.length||F.length)&&this._updateWorkerLayers(O,F),this._updatedSources){var H=this._updatedSources[B];H==="reload"?this._reloadSource(B):H==="clear"&&this._clearSource(B)}for(var Y in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[Y].updateTransitions(_);this.light.updateTransitions(_),this._resetUpdates()}var rt={};for(var ct in this.sourceCaches){var dt=this.sourceCaches[ct];rt[ct]=dt.used,dt.used=!1}for(var pt=0,Pt=this._order;pt<Pt.length;pt+=1){var Mt=this._layers[Pt[pt]];Mt.recalculate(_,this._availableImages),!Mt.isHidden(_.zoom)&&Mt.source&&(this.sourceCaches[Mt.source].used=!0)}for(var Ht in rt){var St=this.sourceCaches[Ht];rt[Ht]!==St.used&&St.fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Ht}))}this.light.recalculate(_),this.z=_.zoom,C&&this.fire(new o.Event("data",{dataType:"style"}))}},b.prototype._updateTilesForChangedImages=function(){var _=Object.keys(this._changedImages);if(_.length){for(var C in this.sourceCaches)this.sourceCaches[C].reloadTilesForDependencies(["icons","patterns"],_);this._changedImages={}}},b.prototype._updateWorkerLayers=function(_,C){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(_),removedIds:C})},b.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},b.prototype.setState=function(_){var C=this;if(this._checkLoaded(),mc(this,o.validateStyle(_)))return!1;(_=o.clone$1(_)).layers=pr(_.layers);var O=function(B,H){if(!B)return[{command:mr.setStyle,args:[H]}];var Y=[];try{if(!o.deepEqual(B.version,H.version))return[{command:mr.setStyle,args:[H]}];o.deepEqual(B.center,H.center)||Y.push({command:mr.setCenter,args:[H.center]}),o.deepEqual(B.zoom,H.zoom)||Y.push({command:mr.setZoom,args:[H.zoom]}),o.deepEqual(B.bearing,H.bearing)||Y.push({command:mr.setBearing,args:[H.bearing]}),o.deepEqual(B.pitch,H.pitch)||Y.push({command:mr.setPitch,args:[H.pitch]}),o.deepEqual(B.sprite,H.sprite)||Y.push({command:mr.setSprite,args:[H.sprite]}),o.deepEqual(B.glyphs,H.glyphs)||Y.push({command:mr.setGlyphs,args:[H.glyphs]}),o.deepEqual(B.transition,H.transition)||Y.push({command:mr.setTransition,args:[H.transition]}),o.deepEqual(B.light,H.light)||Y.push({command:mr.setLight,args:[H.light]});var rt={},ct=[];(function(pt,Pt,Mt,Ht){var St;for(St in Pt=Pt||{},pt=pt||{})pt.hasOwnProperty(St)&&(Pt.hasOwnProperty(St)||Cr(St,Mt,Ht));for(St in Pt)Pt.hasOwnProperty(St)&&(pt.hasOwnProperty(St)?o.deepEqual(pt[St],Pt[St])||(pt[St].type==="geojson"&&Pt[St].type==="geojson"&&na(pt,Pt,St)?Mt.push({command:mr.setGeoJSONSourceData,args:[St,Pt[St].data]}):hi(St,Pt,Mt,Ht)):Un(St,Pt,Mt))})(B.sources,H.sources,ct,rt);var dt=[];B.layers&&B.layers.forEach(function(pt){rt[pt.source]?Y.push({command:mr.removeLayer,args:[pt.id]}):dt.push(pt)}),Y=Y.concat(ct),function(pt,Pt,Mt){Pt=Pt||[];var Ht,St,Ut,Kt,le,we,ve,Me=(pt=pt||[]).map(Ci),Ge=Pt.map(Ci),hr=pt.reduce($n,{}),or=Pt.reduce($n,{}),Ir=Me.slice(),ln=Object.create(null);for(Ht=0,St=0;Ht<Me.length;Ht++)or.hasOwnProperty(Ut=Me[Ht])?St++:(Mt.push({command:mr.removeLayer,args:[Ut]}),Ir.splice(Ir.indexOf(Ut,St),1));for(Ht=0,St=0;Ht<Ge.length;Ht++)Ir[Ir.length-1-Ht]!==(Ut=Ge[Ge.length-1-Ht])&&(hr.hasOwnProperty(Ut)?(Mt.push({command:mr.removeLayer,args:[Ut]}),Ir.splice(Ir.lastIndexOf(Ut,Ir.length-St),1)):St++,Mt.push({command:mr.addLayer,args:[or[Ut],we=Ir[Ir.length-Ht]]}),Ir.splice(Ir.length-Ht,0,Ut),ln[Ut]=!0);for(Ht=0;Ht<Ge.length;Ht++)if(Kt=hr[Ut=Ge[Ht]],le=or[Ut],!ln[Ut]&&!o.deepEqual(Kt,le))if(o.deepEqual(Kt.source,le.source)&&o.deepEqual(Kt["source-layer"],le["source-layer"])&&o.deepEqual(Kt.type,le.type)){for(ve in oi(Kt.layout,le.layout,Mt,Ut,null,mr.setLayoutProperty),oi(Kt.paint,le.paint,Mt,Ut,null,mr.setPaintProperty),o.deepEqual(Kt.filter,le.filter)||Mt.push({command:mr.setFilter,args:[Ut,le.filter]}),o.deepEqual(Kt.minzoom,le.minzoom)&&o.deepEqual(Kt.maxzoom,le.maxzoom)||Mt.push({command:mr.setLayerZoomRange,args:[Ut,le.minzoom,le.maxzoom]}),Kt)Kt.hasOwnProperty(ve)&&ve!=="layout"&&ve!=="paint"&&ve!=="filter"&&ve!=="metadata"&&ve!=="minzoom"&&ve!=="maxzoom"&&(ve.indexOf("paint.")===0?oi(Kt[ve],le[ve],Mt,Ut,ve.slice(6),mr.setPaintProperty):o.deepEqual(Kt[ve],le[ve])||Mt.push({command:mr.setLayerProperty,args:[Ut,ve,le[ve]]}));for(ve in le)le.hasOwnProperty(ve)&&!Kt.hasOwnProperty(ve)&&ve!=="layout"&&ve!=="paint"&&ve!=="filter"&&ve!=="metadata"&&ve!=="minzoom"&&ve!=="maxzoom"&&(ve.indexOf("paint.")===0?oi(Kt[ve],le[ve],Mt,Ut,ve.slice(6),mr.setPaintProperty):o.deepEqual(Kt[ve],le[ve])||Mt.push({command:mr.setLayerProperty,args:[Ut,ve,le[ve]]}))}else Mt.push({command:mr.removeLayer,args:[Ut]}),we=Ir[Ir.lastIndexOf(Ut)+1],Mt.push({command:mr.addLayer,args:[le,we]})}(dt,H.layers,Y)}catch(pt){console.warn("Unable to compute style diff:",pt),Y=[{command:mr.setStyle,args:[H]}]}return Y}(this.serialize(),_).filter(function(B){return!(B.command in mh)});if(O.length===0)return!1;var F=O.filter(function(B){return!(B.command in yc)});if(F.length>0)throw new Error("Unimplemented: "+F.map(function(B){return B.command}).join(", ")+".");return O.forEach(function(B){B.command!=="setTransition"&&C[B.command].apply(C,B.args)}),this.stylesheet=_,!0},b.prototype.addImage=function(_,C){if(this.getImage(_))return this.fire(new o.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(_,C),this._afterImageUpdated(_)},b.prototype.updateImage=function(_,C){this.imageManager.updateImage(_,C)},b.prototype.getImage=function(_){return this.imageManager.getImage(_)},b.prototype.removeImage=function(_){if(!this.getImage(_))return this.fire(new o.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(_),this._afterImageUpdated(_)},b.prototype._afterImageUpdated=function(_){this._availableImages=this.imageManager.listImages(),this._changedImages[_]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))},b.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},b.prototype.addSource=function(_,C,O){var F=this;if(O===void 0&&(O={}),this._checkLoaded(),this.sourceCaches[_]!==void 0)throw new Error("There is already a source with this ID");if(!C.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(C).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(C.type)>=0&&this._validate(o.validateStyle.source,"sources."+_,C,null,O))){this.map&&this.map._collectResourceTiming&&(C.collectResourceTiming=!0);var B=this.sourceCaches[_]=new Dt(_,C,this.dispatcher);B.style=this,B.setEventedParent(this,function(){return{isSourceLoaded:F.loaded(),source:B.serialize(),sourceId:_}}),B.onAdd(this.map),this._changed=!0}},b.prototype.removeSource=function(_){if(this._checkLoaded(),this.sourceCaches[_]===void 0)throw new Error("There is no source with this ID");for(var C in this._layers)if(this._layers[C].source===_)return this.fire(new o.ErrorEvent(new Error('Source "'+_+'" cannot be removed while layer "'+C+'" is using it.')));var O=this.sourceCaches[_];delete this.sourceCaches[_],delete this._updatedSources[_],O.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:_})),O.setEventedParent(null),O.clearTiles(),O.onRemove&&O.onRemove(this.map),this._changed=!0},b.prototype.setGeoJSONSourceData=function(_,C){this._checkLoaded(),this.sourceCaches[_].getSource().setData(C),this._changed=!0},b.prototype.getSource=function(_){return this.sourceCaches[_]&&this.sourceCaches[_].getSource()},b.prototype.addLayer=function(_,C,O){O===void 0&&(O={}),this._checkLoaded();var F=_.id;if(this.getLayer(F))this.fire(new o.ErrorEvent(new Error('Layer with id "'+F+'" already exists on this map')));else{var B;if(_.type==="custom"){if(mc(this,o.validateCustomStyleLayer(_)))return;B=o.createStyleLayer(_)}else{if(typeof _.source=="object"&&(this.addSource(F,_.source),_=o.clone$1(_),_=o.extend(_,{source:F})),this._validate(o.validateStyle.layer,"layers."+F,_,{arrayIndex:-1},O))return;B=o.createStyleLayer(_),this._validateLayer(B),B.setEventedParent(this,{layer:{id:F}}),this._serializedLayers[B.id]=B.serialize()}var H=C?this._order.indexOf(C):this._order.length;if(C&&H===-1)this.fire(new o.ErrorEvent(new Error('Layer with id "'+C+'" does not exist on this map.')));else{if(this._order.splice(H,0,F),this._layerOrderChanged=!0,this._layers[F]=B,this._removedLayers[F]&&B.source&&B.type!=="custom"){var Y=this._removedLayers[F];delete this._removedLayers[F],Y.type!==B.type?this._updatedSources[B.source]="clear":(this._updatedSources[B.source]="reload",this.sourceCaches[B.source].pause())}this._updateLayer(B),B.onAdd&&B.onAdd(this.map)}}},b.prototype.moveLayer=function(_,C){if(this._checkLoaded(),this._changed=!0,this._layers[_]){if(_!==C){var O=this._order.indexOf(_);this._order.splice(O,1);var F=C?this._order.indexOf(C):this._order.length;C&&F===-1?this.fire(new o.ErrorEvent(new Error('Layer with id "'+C+'" does not exist on this map.'))):(this._order.splice(F,0,_),this._layerOrderChanged=!0)}}else this.fire(new o.ErrorEvent(new Error("The layer '"+_+"' does not exist in the map's style and cannot be moved.")))},b.prototype.removeLayer=function(_){this._checkLoaded();var C=this._layers[_];if(C){C.setEventedParent(null);var O=this._order.indexOf(_);this._order.splice(O,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[_]=C,delete this._layers[_],delete this._serializedLayers[_],delete this._updatedLayers[_],delete this._updatedPaintProps[_],C.onRemove&&C.onRemove(this.map)}else this.fire(new o.ErrorEvent(new Error("The layer '"+_+"' does not exist in the map's style and cannot be removed.")))},b.prototype.getLayer=function(_){return this._layers[_]},b.prototype.hasLayer=function(_){return _ in this._layers},b.prototype.setLayerZoomRange=function(_,C,O){this._checkLoaded();var F=this.getLayer(_);F?F.minzoom===C&&F.maxzoom===O||(C!=null&&(F.minzoom=C),O!=null&&(F.maxzoom=O),this._updateLayer(F)):this.fire(new o.ErrorEvent(new Error("The layer '"+_+"' does not exist in the map's style and cannot have zoom extent.")))},b.prototype.setFilter=function(_,C,O){O===void 0&&(O={}),this._checkLoaded();var F=this.getLayer(_);if(F){if(!o.deepEqual(F.filter,C))return C==null?(F.filter=void 0,void this._updateLayer(F)):void(this._validate(o.validateStyle.filter,"layers."+F.id+".filter",C,null,O)||(F.filter=o.clone$1(C),this._updateLayer(F)))}else this.fire(new o.ErrorEvent(new Error("The layer '"+_+"' does not exist in the map's style and cannot be filtered.")))},b.prototype.getFilter=function(_){return o.clone$1(this.getLayer(_).filter)},b.prototype.setLayoutProperty=function(_,C,O,F){F===void 0&&(F={}),this._checkLoaded();var B=this.getLayer(_);B?o.deepEqual(B.getLayoutProperty(C),O)||(B.setLayoutProperty(C,O,F),this._updateLayer(B)):this.fire(new o.ErrorEvent(new Error("The layer '"+_+"' does not exist in the map's style and cannot be styled.")))},b.prototype.getLayoutProperty=function(_,C){var O=this.getLayer(_);if(O)return O.getLayoutProperty(C);this.fire(new o.ErrorEvent(new Error("The layer '"+_+"' does not exist in the map's style.")))},b.prototype.setPaintProperty=function(_,C,O,F){F===void 0&&(F={}),this._checkLoaded();var B=this.getLayer(_);B?o.deepEqual(B.getPaintProperty(C),O)||(B.setPaintProperty(C,O,F)&&this._updateLayer(B),this._changed=!0,this._updatedPaintProps[_]=!0):this.fire(new o.ErrorEvent(new Error("The layer '"+_+"' does not exist in the map's style and cannot be styled.")))},b.prototype.getPaintProperty=function(_,C){return this.getLayer(_).getPaintProperty(C)},b.prototype.setFeatureState=function(_,C){this._checkLoaded();var O=_.source,F=_.sourceLayer,B=this.sourceCaches[O];if(B!==void 0){var H=B.getSource().type;H==="geojson"&&F?this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):H!=="vector"||F?(_.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),B.setFeatureState(F,_.id,C)):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error("The source '"+O+"' does not exist in the map's style.")))},b.prototype.removeFeatureState=function(_,C){this._checkLoaded();var O=_.source,F=this.sourceCaches[O];if(F!==void 0){var B=F.getSource().type,H=B==="vector"?_.sourceLayer:void 0;B!=="vector"||H?C&&typeof _.id!="string"&&typeof _.id!="number"?this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):F.removeFeatureState(H,_.id,C):this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error("The source '"+O+"' does not exist in the map's style.")))},b.prototype.getFeatureState=function(_){this._checkLoaded();var C=_.source,O=_.sourceLayer,F=this.sourceCaches[C];if(F!==void 0){if(F.getSource().type!=="vector"||O)return _.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),F.getFeatureState(O,_.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error("The source '"+C+"' does not exist in the map's style.")))},b.prototype.getTransition=function(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},b.prototype.serialize=function(){return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:o.mapObject(this.sourceCaches,function(_){return _.serialize()}),layers:this._serializeLayers(this._order)},function(_){return _!==void 0})},b.prototype._updateLayer=function(_){this._updatedLayers[_.id]=!0,_.source&&!this._updatedSources[_.source]&&this.sourceCaches[_.source].getSource().type!=="raster"&&(this._updatedSources[_.source]="reload",this.sourceCaches[_.source].pause()),this._changed=!0},b.prototype._flattenAndSortRenderedFeatures=function(_){for(var C=this,O=function(hr){return C._layers[hr].type==="fill-extrusion"},F={},B=[],H=this._order.length-1;H>=0;H--){var Y=this._order[H];if(O(Y)){F[Y]=H;for(var rt=0,ct=_;rt<ct.length;rt+=1){var dt=ct[rt][Y];if(dt)for(var pt=0,Pt=dt;pt<Pt.length;pt+=1)B.push(Pt[pt])}}}B.sort(function(hr,or){return or.intersectionZ-hr.intersectionZ});for(var Mt=[],Ht=this._order.length-1;Ht>=0;Ht--){var St=this._order[Ht];if(O(St))for(var Ut=B.length-1;Ut>=0;Ut--){var Kt=B[Ut].feature;if(F[Kt.layer.id]<Ht)break;Mt.push(Kt),B.pop()}else for(var le=0,we=_;le<we.length;le+=1){var ve=we[le][St];if(ve)for(var Me=0,Ge=ve;Me<Ge.length;Me+=1)Mt.push(Ge[Me].feature)}}return Mt},b.prototype.queryRenderedFeatures=function(_,C,O){C&&C.filter&&this._validate(o.validateStyle.filter,"queryRenderedFeatures.filter",C.filter,null,C);var F={};if(C&&C.layers){if(!Array.isArray(C.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var B=0,H=C.layers;B<H.length;B+=1){var Y=H[B],rt=this._layers[Y];if(!rt)return this.fire(new o.ErrorEvent(new Error("The layer '"+Y+"' does not exist in the map's style and cannot be queried for features."))),[];F[rt.source]=!0}}var ct=[];for(var dt in C.availableImages=this._availableImages,this.sourceCaches)C.layers&&!F[dt]||ct.push(Wr(this.sourceCaches[dt],this._layers,this._serializedLayers,_,C,O));return this.placement&&ct.push(function(pt,Pt,Mt,Ht,St,Ut,Kt){for(var le={},we=Ut.queryRenderedSymbols(Ht),ve=[],Me=0,Ge=Object.keys(we).map(Number);Me<Ge.length;Me+=1)ve.push(Kt[Ge[Me]]);ve.sort(In);for(var hr=function(){var hn=Ir[or],Li=hn.featureIndex.lookupSymbolFeatures(we[hn.bucketInstanceId],Pt,hn.bucketIndex,hn.sourceLayerIndex,St.filter,St.layers,St.availableImages,pt);for(var Ur in Li){var Pn=le[Ur]=le[Ur]||[],jn=Li[Ur];jn.sort(function(Vn,Tn){var En=hn.featureSortOrder;if(En){var Ro=En.indexOf(Vn.featureIndex);return En.indexOf(Tn.featureIndex)-Ro}return Tn.featureIndex-Vn.featureIndex});for(var Ln=0,Sn=jn;Ln<Sn.length;Ln+=1)Pn.push(Sn[Ln])}},or=0,Ir=ve;or<Ir.length;or+=1)hr();var ln=function(hn){le[hn].forEach(function(Li){var Ur=Li.feature,Pn=Mt[pt[hn].source].getFeatureState(Ur.layer["source-layer"],Ur.id);Ur.source=Ur.layer.source,Ur.layer["source-layer"]&&(Ur.sourceLayer=Ur.layer["source-layer"]),Ur.state=Pn})};for(var fn in le)ln(fn);return le}(this._layers,this._serializedLayers,this.sourceCaches,_,C,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ct)},b.prototype.querySourceFeatures=function(_,C){C&&C.filter&&this._validate(o.validateStyle.filter,"querySourceFeatures.filter",C.filter,null,C);var O=this.sourceCaches[_];return O?function(F,B){for(var H=F.getRenderableIds().map(function(Pt){return F.getTileByID(Pt)}),Y=[],rt={},ct=0;ct<H.length;ct++){var dt=H[ct],pt=dt.tileID.canonical.key;rt[pt]||(rt[pt]=!0,dt.querySourceFeatures(Y,B))}return Y}(O,C):[]},b.prototype.addSourceType=function(_,C,O){return b.getSourceType(_)?O(new Error('A source type called "'+_+'" already exists.')):(b.setSourceType(_,C),C.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:_,url:C.workerSourceURL},O):O(null,null))},b.prototype.getLight=function(){return this.light.getLight()},b.prototype.setLight=function(_,C){C===void 0&&(C={}),this._checkLoaded();var O=this.light.getLight(),F=!1;for(var B in _)if(!o.deepEqual(_[B],O[B])){F=!0;break}if(F){var H={now:o.browser.now(),transition:o.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(_,C),this.light.updateTransitions(H)}},b.prototype._validate=function(_,C,O,F,B){return B===void 0&&(B={}),(!B||B.validate!==!1)&&mc(this,_.call(o.validateStyle,o.extend({key:C,style:this.serialize(),value:O,styleSpec:o.styleSpec},F)))},b.prototype._remove=function(){for(var _ in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[_].setEventedParent(null);for(var C in this.sourceCaches)this.sourceCaches[C].clearTiles(),this.sourceCaches[C].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},b.prototype._clearSource=function(_){this.sourceCaches[_].clearTiles()},b.prototype._reloadSource=function(_){this.sourceCaches[_].resume(),this.sourceCaches[_].reload()},b.prototype._updateSources=function(_){for(var C in this.sourceCaches)this.sourceCaches[C].update(_)},b.prototype._generateCollisionBoxes=function(){for(var _ in this.sourceCaches)this._reloadSource(_)},b.prototype._updatePlacement=function(_,C,O,F,B){B===void 0&&(B=!1);for(var H=!1,Y=!1,rt={},ct=0,dt=this._order;ct<dt.length;ct+=1){var pt=this._layers[dt[ct]];if(pt.type==="symbol"){if(!rt[pt.source]){var Pt=this.sourceCaches[pt.source];rt[pt.source]=Pt.getRenderableIds(!0).map(function(Kt){return Pt.getTileByID(Kt)}).sort(function(Kt,le){return le.tileID.overscaledZ-Kt.tileID.overscaledZ||(Kt.tileID.isLessThan(le.tileID)?-1:1)})}var Mt=this.crossTileSymbolIndex.addLayer(pt,rt[pt.source],_.center.lng);H=H||Mt}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((B=B||this._layerOrderChanged||O===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.browser.now(),_.zoom))&&(this.pauseablePlacement=new yv(_,this._order,B,C,O,F,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,rt),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.browser.now()),Y=!0),H&&this.pauseablePlacement.placement.setStale()),Y||H)for(var Ht=0,St=this._order;Ht<St.length;Ht+=1){var Ut=this._layers[St[Ht]];Ut.type==="symbol"&&this.placement.updateLayerOpacities(Ut,rt[Ut.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.browser.now())},b.prototype._releaseSymbolFadeTiles=function(){for(var _ in this.sourceCaches)this.sourceCaches[_].releaseSymbolFadeTiles()},b.prototype.getImages=function(_,C,O){this.imageManager.getImages(C.icons,O),this._updateTilesForChangedImages();var F=this.sourceCaches[C.source];F&&F.setDependencies(C.tileID.key,C.type,C.icons)},b.prototype.getGlyphs=function(_,C,O){this.glyphManager.getGlyphs(C.stacks,O)},b.prototype.getResource=function(_,C,O){return o.makeRequest(C,O)},b}(o.Evented);Il.getSourceType=function(y){return Be[y]},Il.setSourceType=function(y,b){Be[y]=b},Il.registerForPluginStateChange=o.registerForPluginStateChange;var so=o.createLayout([{name:"a_pos",type:"Int16",components:2}]),lf=ua(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),yh=ua(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),kg=ua(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),K_=ua(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),zg=ua("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),F0=ua(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),B0=ua(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),N0=ua("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Q_=ua("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),J_=ua("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),lE=ua(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),xv=ua(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),_c=ua(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),t1=ua(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Ss=ua(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),hd=ua(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),uf=ua(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Ql=ua(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),cf=ua(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Eu=ua(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),_h=ua(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Jl=ua(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),xh=ua(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),hf=ua(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),e1=ua(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),r1=ua(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function ua(y,b){var _=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,C=b.match(/attribute ([\w]+) ([\w]+)/g),O=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),F=b.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),B=F?F.concat(O):O,H={};return{fragmentSource:y=y.replace(_,function(Y,rt,ct,dt,pt){return H[pt]=!0,rt==="define"?`
#ifndef HAS_UNIFORM_u_`+pt+`
varying `+ct+" "+dt+" "+pt+`;
#else
uniform `+ct+" "+dt+" u_"+pt+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+pt+`
    `+ct+" "+dt+" "+pt+" = u_"+pt+`;
#endif
`}),vertexSource:b=b.replace(_,function(Y,rt,ct,dt,pt){var Pt=dt==="float"?"vec2":"vec4",Mt=pt.match(/color/)?"color":Pt;return H[pt]?rt==="define"?`
#ifndef HAS_UNIFORM_u_`+pt+`
uniform lowp float u_`+pt+`_t;
attribute `+ct+" "+Pt+" a_"+pt+`;
varying `+ct+" "+dt+" "+pt+`;
#else
uniform `+ct+" "+dt+" u_"+pt+`;
#endif
`:Mt==="vec4"?`
#ifndef HAS_UNIFORM_u_`+pt+`
    `+pt+" = a_"+pt+`;
#else
    `+ct+" "+dt+" "+pt+" = u_"+pt+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+pt+`
    `+pt+" = unpack_mix_"+Mt+"(a_"+pt+", u_"+pt+`_t);
#else
    `+ct+" "+dt+" "+pt+" = u_"+pt+`;
#endif
`:rt==="define"?`
#ifndef HAS_UNIFORM_u_`+pt+`
uniform lowp float u_`+pt+`_t;
attribute `+ct+" "+Pt+" a_"+pt+`;
#else
uniform `+ct+" "+dt+" u_"+pt+`;
#endif
`:Mt==="vec4"?`
#ifndef HAS_UNIFORM_u_`+pt+`
    `+ct+" "+dt+" "+pt+" = a_"+pt+`;
#else
    `+ct+" "+dt+" "+pt+" = u_"+pt+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+pt+`
    `+ct+" "+dt+" "+pt+" = unpack_mix_"+Mt+"(a_"+pt+", u_"+pt+`_t);
#else
    `+ct+" "+dt+" "+pt+" = u_"+pt+`;
#endif
`}),staticAttributes:C,staticUniforms:B}}var uE=Object.freeze({__proto__:null,prelude:lf,background:yh,backgroundPattern:kg,circle:K_,clippingMask:zg,heatmap:F0,heatmapTexture:B0,collisionBox:N0,collisionCircle:Q_,debug:J_,fill:lE,fillOutline:xv,fillOutlinePattern:_c,fillPattern:t1,fillExtrusion:Ss,fillExtrusionPattern:hd,hillshadePrepare:uf,hillshade:Ql,line:cf,lineGradient:Eu,linePattern:_h,lineSDF:Jl,raster:xh,symbolIcon:hf,symbolSDF:e1,symbolTextAndIcon:r1}),Ug=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function k0(y){for(var b=[],_=0;_<y.length;_++)if(y[_]!==null){var C=y[_].split(" ");b.push(C.pop())}return b}Ug.prototype.bind=function(y,b,_,C,O,F,B,H){this.context=y;for(var Y=this.boundPaintVertexBuffers.length!==C.length,rt=0;!Y&&rt<C.length;rt++)this.boundPaintVertexBuffers[rt]!==C[rt]&&(Y=!0);y.extVertexArrayObject&&this.vao&&this.boundProgram===b&&this.boundLayoutVertexBuffer===_&&!Y&&this.boundIndexBuffer===O&&this.boundVertexOffset===F&&this.boundDynamicVertexBuffer===B&&this.boundDynamicVertexBuffer2===H?(y.bindVertexArrayOES.set(this.vao),B&&B.bind(),O&&O.dynamicDraw&&O.bind(),H&&H.bind()):this.freshBind(b,_,C,O,F,B,H)},Ug.prototype.freshBind=function(y,b,_,C,O,F,B){var H,Y=y.numAttributes,rt=this.context,ct=rt.gl;if(rt.extVertexArrayObject)this.vao&&this.destroy(),this.vao=rt.extVertexArrayObject.createVertexArrayOES(),rt.bindVertexArrayOES.set(this.vao),H=0,this.boundProgram=y,this.boundLayoutVertexBuffer=b,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=C,this.boundVertexOffset=O,this.boundDynamicVertexBuffer=F,this.boundDynamicVertexBuffer2=B;else{H=rt.currentNumAttributes||0;for(var dt=Y;dt<H;dt++)ct.disableVertexAttribArray(dt)}b.enableAttributes(ct,y);for(var pt=0,Pt=_;pt<Pt.length;pt+=1)Pt[pt].enableAttributes(ct,y);F&&F.enableAttributes(ct,y),B&&B.enableAttributes(ct,y),b.bind(),b.setVertexAttribPointers(ct,y,O);for(var Mt=0,Ht=_;Mt<Ht.length;Mt+=1){var St=Ht[Mt];St.bind(),St.setVertexAttribPointers(ct,y,O)}F&&(F.bind(),F.setVertexAttribPointers(ct,y,O)),C&&C.bind(),B&&(B.bind(),B.setVertexAttribPointers(ct,y,O)),rt.currentNumAttributes=Y},Ug.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var lo=function(y,b,_,C,O,F){var B=y.gl;this.program=B.createProgram();for(var H=k0(_.staticAttributes),Y=C?C.getBinderAttributes():[],rt=H.concat(Y),ct=_.staticUniforms?k0(_.staticUniforms):[],dt=C?C.getBinderUniforms():[],pt=[],Pt=0,Mt=ct.concat(dt);Pt<Mt.length;Pt+=1){var Ht=Mt[Pt];pt.indexOf(Ht)<0&&pt.push(Ht)}var St=C?C.defines():[];F&&St.push("#define OVERDRAW_INSPECTOR;");var Ut=St.concat(lf.fragmentSource,_.fragmentSource).join(`
`),Kt=St.concat(lf.vertexSource,_.vertexSource).join(`
`),le=B.createShader(B.FRAGMENT_SHADER);if(B.isContextLost())this.failedToCreate=!0;else{B.shaderSource(le,Ut),B.compileShader(le),B.attachShader(this.program,le);var we=B.createShader(B.VERTEX_SHADER);if(B.isContextLost())this.failedToCreate=!0;else{B.shaderSource(we,Kt),B.compileShader(we),B.attachShader(this.program,we),this.attributes={};var ve={};this.numAttributes=rt.length;for(var Me=0;Me<this.numAttributes;Me++)rt[Me]&&(B.bindAttribLocation(this.program,Me,rt[Me]),this.attributes[rt[Me]]=Me);B.linkProgram(this.program),B.deleteShader(we),B.deleteShader(le);for(var Ge=0;Ge<pt.length;Ge++){var hr=pt[Ge];if(hr&&!ve[hr]){var or=B.getUniformLocation(this.program,hr);or&&(ve[hr]=or)}}this.fixedUniforms=O(y,ve),this.binderUniforms=C?C.getUniforms(y,ve):[]}}};function z0(y,b,_){var C=1/ya(_,1,b.transform.tileZoom),O=Math.pow(2,_.tileID.overscaledZ),F=_.tileSize*Math.pow(2,b.transform.tileZoom)/O,B=F*(_.tileID.canonical.x+_.tileID.wrap*O),H=F*_.tileID.canonical.y;return{u_image:0,u_texsize:_.imageAtlasTexture.size,u_scale:[C,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[B>>16,H>>16],u_pixel_coord_lower:[65535&B,65535&H]}}lo.prototype.draw=function(y,b,_,C,O,F,B,H,Y,rt,ct,dt,pt,Pt,Mt,Ht){var St,Ut=y.gl;if(!this.failedToCreate){for(var Kt in y.program.set(this.program),y.setDepthMode(_),y.setStencilMode(C),y.setColorMode(O),y.setCullFace(F),this.fixedUniforms)this.fixedUniforms[Kt].set(B[Kt]);Pt&&Pt.setUniforms(y,this.binderUniforms,dt,{zoom:pt});for(var le=(St={},St[Ut.LINES]=2,St[Ut.TRIANGLES]=3,St[Ut.LINE_STRIP]=1,St)[b],we=0,ve=ct.get();we<ve.length;we+=1){var Me=ve[we],Ge=Me.vaos||(Me.vaos={});(Ge[H]||(Ge[H]=new Ug)).bind(y,this,Y,Pt?Pt.getPaintVertexBuffers():[],rt,Me.vertexOffset,Mt,Ht),Ut.drawElements(b,Me.primitiveLength*le,Ut.UNSIGNED_SHORT,Me.primitiveOffset*le*2)}}};var n1=function(y,b,_,C){var O=b.style.light,F=O.properties.get("position"),B=[F.x,F.y,F.z],H=o.create$1();O.properties.get("anchor")==="viewport"&&o.fromRotation(H,-b.transform.angle),o.transformMat3(B,B,H);var Y=O.properties.get("color");return{u_matrix:y,u_lightpos:B,u_lightintensity:O.properties.get("intensity"),u_lightcolor:[Y.r,Y.g,Y.b],u_vertical_gradient:+_,u_opacity:C}},sl=function(y,b,_,C,O,F,B){return o.extend(n1(y,b,_,C),z0(F,b,B),{u_height_factor:-Math.pow(2,O.overscaledZ)/B.tileSize/8})},bh=function(y){return{u_matrix:y}},xc=function(y,b,_,C){return o.extend(bh(y),z0(_,b,C))},ff=function(y,b){return{u_matrix:y,u_world:b}},$g=function(y,b,_,C,O){return o.extend(xc(y,b,_,C),{u_world:O})},up=function(y,b,_,C){var O,F,B=y.transform;if(C.paint.get("circle-pitch-alignment")==="map"){var H=ya(_,1,B.zoom);O=!0,F=[H,H]}else O=!1,F=B.pixelsToGLUnits;return{u_camera_to_center_distance:B.cameraToCenterDistance,u_scale_with_map:+(C.paint.get("circle-pitch-scale")==="map"),u_matrix:y.translatePosMatrix(b.posMatrix,_,C.paint.get("circle-translate"),C.paint.get("circle-translate-anchor")),u_pitch_with_map:+O,u_device_pixel_ratio:o.browser.devicePixelRatio,u_extrude_scale:F}},Yu=function(y,b,_){var C=ya(_,1,b.zoom),O=Math.pow(2,b.zoom-_.tileID.overscaledZ),F=_.tileID.overscaleFactor();return{u_matrix:y,u_camera_to_center_distance:b.cameraToCenterDistance,u_pixels_to_tile_units:C,u_extrude_scale:[b.pixelsToGLUnits[0]/(C*O),b.pixelsToGLUnits[1]/(C*O)],u_overscale_factor:F}},bv=function(y,b,_){return{u_matrix:y,u_inv_matrix:b,u_camera_to_center_distance:_.cameraToCenterDistance,u_viewport_size:[_.width,_.height]}},df=function(y,b,_){return _===void 0&&(_=1),{u_matrix:y,u_color:b,u_overlay:0,u_overlay_scale:_}},Eh=function(y){return{u_matrix:y}},U0=function(y,b,_,C){return{u_matrix:y,u_extrude_scale:ya(b,1,_),u_intensity:C}},Ev=function(y,b,_){var C=y.transform;return{u_matrix:wv(y,b,_),u_ratio:1/ya(b,1,C.zoom),u_device_pixel_ratio:o.browser.devicePixelRatio,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]]}},wa=function(y,b,_,C){return o.extend(Ev(y,b,_),{u_image:0,u_image_height:C})},Hg=function(y,b,_,C){var O=y.transform,F=pf(b,O);return{u_matrix:wv(y,b,_),u_texsize:b.imageAtlasTexture.size,u_ratio:1/ya(b,1,O.zoom),u_device_pixel_ratio:o.browser.devicePixelRatio,u_image:0,u_scale:[F,C.fromScale,C.toScale],u_fade:C.t,u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]]}},cE=function(y,b,_,C,O){var F=y.lineAtlas,B=pf(b,y.transform),H=_.layout.get("line-cap")==="round",Y=F.getDash(C.from,H),rt=F.getDash(C.to,H),ct=Y.width*O.fromScale,dt=rt.width*O.toScale;return o.extend(Ev(y,b,_),{u_patternscale_a:[B/ct,-Y.height/2],u_patternscale_b:[B/dt,-rt.height/2],u_sdfgamma:F.width/(256*Math.min(ct,dt)*o.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:Y.y,u_tex_y_b:rt.y,u_mix:O.t})};function pf(y,b){return 1/ya(y,1,b.tileZoom)}function wv(y,b,_){return y.translatePosMatrix(b.tileID.posMatrix,b,_.paint.get("line-translate"),_.paint.get("line-translate-anchor"))}var $0=function(y,b,_,C,O){return{u_matrix:y,u_tl_parent:b,u_scale_parent:_,u_buffer_scale:1,u_fade_t:C.mix,u_opacity:C.opacity*O.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:O.paint.get("raster-brightness-min"),u_brightness_high:O.paint.get("raster-brightness-max"),u_saturation_factor:(B=O.paint.get("raster-saturation"),B>0?1-1/(1.001-B):-B),u_contrast_factor:(F=O.paint.get("raster-contrast"),F>0?1/(1-F):1+F),u_spin_weights:Vg(O.paint.get("raster-hue-rotate"))};var F,B};function Vg(y){y*=Math.PI/180;var b=Math.sin(y),_=Math.cos(y);return[(2*_+1)/3,(-Math.sqrt(3)*b-_+1)/3,(Math.sqrt(3)*b-_+1)/3]}var wh,vf=function(y,b,_,C,O,F,B,H,Y,rt){var ct=O.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:b?b.uSizeT:0,u_size:b?b.uSize:0,u_camera_to_center_distance:ct.cameraToCenterDistance,u_pitch:ct.pitch/360*2*Math.PI,u_rotate_symbol:+_,u_aspect_ratio:ct.width/ct.height,u_fade_change:O.options.fadeDuration?O.symbolFadeChange:1,u_matrix:F,u_label_plane_matrix:B,u_coord_matrix:H,u_is_text:+Y,u_pitch_with_map:+C,u_texsize:rt,u_texture:0}},fd=function(y,b,_,C,O,F,B,H,Y,rt,ct){var dt=O.transform;return o.extend(vf(y,b,_,C,O,F,B,H,Y,rt),{u_gamma_scale:C?Math.cos(dt._pitch)*dt.cameraToCenterDistance:1,u_device_pixel_ratio:o.browser.devicePixelRatio,u_is_halo:+ct})},cp=function(y,b,_,C,O,F,B,H,Y,rt){return o.extend(fd(y,b,_,C,O,F,B,H,!0,Y,!0),{u_texsize_icon:rt,u_texture_icon:1})},dd=function(y,b,_){return{u_matrix:y,u_opacity:b,u_color:_}},pd=function(y,b,_,C,O,F){return o.extend(function(B,H,Y,rt){var ct=Y.imageManager.getPattern(B.from.toString()),dt=Y.imageManager.getPattern(B.to.toString()),pt=Y.imageManager.getPixelSize(),Pt=pt.width,Mt=pt.height,Ht=Math.pow(2,rt.tileID.overscaledZ),St=rt.tileSize*Math.pow(2,Y.transform.tileZoom)/Ht,Ut=St*(rt.tileID.canonical.x+rt.tileID.wrap*Ht),Kt=St*rt.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ct.tl,u_pattern_br_a:ct.br,u_pattern_tl_b:dt.tl,u_pattern_br_b:dt.br,u_texsize:[Pt,Mt],u_mix:H.t,u_pattern_size_a:ct.displaySize,u_pattern_size_b:dt.displaySize,u_scale_a:H.fromScale,u_scale_b:H.toScale,u_tile_units_to_pixels:1/ya(rt,1,Y.transform.tileZoom),u_pixel_coord_upper:[Ut>>16,Kt>>16],u_pixel_coord_lower:[65535&Ut,65535&Kt]}}(C,F,_,O),{u_matrix:y,u_opacity:b})},H0={fillExtrusion:function(y,b){return{u_matrix:new o.UniformMatrix4f(y,b.u_matrix),u_lightpos:new o.Uniform3f(y,b.u_lightpos),u_lightintensity:new o.Uniform1f(y,b.u_lightintensity),u_lightcolor:new o.Uniform3f(y,b.u_lightcolor),u_vertical_gradient:new o.Uniform1f(y,b.u_vertical_gradient),u_opacity:new o.Uniform1f(y,b.u_opacity)}},fillExtrusionPattern:function(y,b){return{u_matrix:new o.UniformMatrix4f(y,b.u_matrix),u_lightpos:new o.Uniform3f(y,b.u_lightpos),u_lightintensity:new o.Uniform1f(y,b.u_lightintensity),u_lightcolor:new o.Uniform3f(y,b.u_lightcolor),u_vertical_gradient:new o.Uniform1f(y,b.u_vertical_gradient),u_height_factor:new o.Uniform1f(y,b.u_height_factor),u_image:new o.Uniform1i(y,b.u_image),u_texsize:new o.Uniform2f(y,b.u_texsize),u_pixel_coord_upper:new o.Uniform2f(y,b.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(y,b.u_pixel_coord_lower),u_scale:new o.Uniform3f(y,b.u_scale),u_fade:new o.Uniform1f(y,b.u_fade),u_opacity:new o.Uniform1f(y,b.u_opacity)}},fill:function(y,b){return{u_matrix:new o.UniformMatrix4f(y,b.u_matrix)}},fillPattern:function(y,b){return{u_matrix:new o.UniformMatrix4f(y,b.u_matrix),u_image:new o.Uniform1i(y,b.u_image),u_texsize:new o.Uniform2f(y,b.u_texsize),u_pixel_coord_upper:new o.Uniform2f(y,b.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(y,b.u_pixel_coord_lower),u_scale:new o.Uniform3f(y,b.u_scale),u_fade:new o.Uniform1f(y,b.u_fade)}},fillOutline:function(y,b){return{u_matrix:new o.UniformMatrix4f(y,b.u_matrix),u_world:new o.Uniform2f(y,b.u_world)}},fillOutlinePattern:function(y,b){return{u_matrix:new o.UniformMatrix4f(y,b.u_matrix),u_world:new o.Uniform2f(y,b.u_world),u_image:new o.Uniform1i(y,b.u_image),u_texsize:new o.Uniform2f(y,b.u_texsize),u_pixel_coord_upper:new o.Uniform2f(y,b.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(y,b.u_pixel_coord_lower),u_scale:new o.Uniform3f(y,b.u_scale),u_fade:new o.Uniform1f(y,b.u_fade)}},circle:function(y,b){return{u_camera_to_center_distance:new o.Uniform1f(y,b.u_camera_to_center_distance),u_scale_with_map:new o.Uniform1i(y,b.u_scale_with_map),u_pitch_with_map:new o.Uniform1i(y,b.u_pitch_with_map),u_extrude_scale:new o.Uniform2f(y,b.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(y,b.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(y,b.u_matrix)}},collisionBox:function(y,b){return{u_matrix:new o.UniformMatrix4f(y,b.u_matrix),u_camera_to_center_distance:new o.Uniform1f(y,b.u_camera_to_center_distance),u_pixels_to_tile_units:new o.Uniform1f(y,b.u_pixels_to_tile_units),u_extrude_scale:new o.Uniform2f(y,b.u_extrude_scale),u_overscale_factor:new o.Uniform1f(y,b.u_overscale_factor)}},collisionCircle:function(y,b){return{u_matrix:new o.UniformMatrix4f(y,b.u_matrix),u_inv_matrix:new o.UniformMatrix4f(y,b.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(y,b.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(y,b.u_viewport_size)}},debug:function(y,b){return{u_color:new o.UniformColor(y,b.u_color),u_matrix:new o.UniformMatrix4f(y,b.u_matrix),u_overlay:new o.Uniform1i(y,b.u_overlay),u_overlay_scale:new o.Uniform1f(y,b.u_overlay_scale)}},clippingMask:function(y,b){return{u_matrix:new o.UniformMatrix4f(y,b.u_matrix)}},heatmap:function(y,b){return{u_extrude_scale:new o.Uniform1f(y,b.u_extrude_scale),u_intensity:new o.Uniform1f(y,b.u_intensity),u_matrix:new o.UniformMatrix4f(y,b.u_matrix)}},heatmapTexture:function(y,b){return{u_matrix:new o.UniformMatrix4f(y,b.u_matrix),u_world:new o.Uniform2f(y,b.u_world),u_image:new o.Uniform1i(y,b.u_image),u_color_ramp:new o.Uniform1i(y,b.u_color_ramp),u_opacity:new o.Uniform1f(y,b.u_opacity)}},hillshade:function(y,b){return{u_matrix:new o.UniformMatrix4f(y,b.u_matrix),u_image:new o.Uniform1i(y,b.u_image),u_latrange:new o.Uniform2f(y,b.u_latrange),u_light:new o.Uniform2f(y,b.u_light),u_shadow:new o.UniformColor(y,b.u_shadow),u_highlight:new o.UniformColor(y,b.u_highlight),u_accent:new o.UniformColor(y,b.u_accent)}},hillshadePrepare:function(y,b){return{u_matrix:new o.UniformMatrix4f(y,b.u_matrix),u_image:new o.Uniform1i(y,b.u_image),u_dimension:new o.Uniform2f(y,b.u_dimension),u_zoom:new o.Uniform1f(y,b.u_zoom),u_unpack:new o.Uniform4f(y,b.u_unpack)}},line:function(y,b){return{u_matrix:new o.UniformMatrix4f(y,b.u_matrix),u_ratio:new o.Uniform1f(y,b.u_ratio),u_device_pixel_ratio:new o.Uniform1f(y,b.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(y,b.u_units_to_pixels)}},lineGradient:function(y,b){return{u_matrix:new o.UniformMatrix4f(y,b.u_matrix),u_ratio:new o.Uniform1f(y,b.u_ratio),u_device_pixel_ratio:new o.Uniform1f(y,b.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(y,b.u_units_to_pixels),u_image:new o.Uniform1i(y,b.u_image),u_image_height:new o.Uniform1f(y,b.u_image_height)}},linePattern:function(y,b){return{u_matrix:new o.UniformMatrix4f(y,b.u_matrix),u_texsize:new o.Uniform2f(y,b.u_texsize),u_ratio:new o.Uniform1f(y,b.u_ratio),u_device_pixel_ratio:new o.Uniform1f(y,b.u_device_pixel_ratio),u_image:new o.Uniform1i(y,b.u_image),u_units_to_pixels:new o.Uniform2f(y,b.u_units_to_pixels),u_scale:new o.Uniform3f(y,b.u_scale),u_fade:new o.Uniform1f(y,b.u_fade)}},lineSDF:function(y,b){return{u_matrix:new o.UniformMatrix4f(y,b.u_matrix),u_ratio:new o.Uniform1f(y,b.u_ratio),u_device_pixel_ratio:new o.Uniform1f(y,b.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(y,b.u_units_to_pixels),u_patternscale_a:new o.Uniform2f(y,b.u_patternscale_a),u_patternscale_b:new o.Uniform2f(y,b.u_patternscale_b),u_sdfgamma:new o.Uniform1f(y,b.u_sdfgamma),u_image:new o.Uniform1i(y,b.u_image),u_tex_y_a:new o.Uniform1f(y,b.u_tex_y_a),u_tex_y_b:new o.Uniform1f(y,b.u_tex_y_b),u_mix:new o.Uniform1f(y,b.u_mix)}},raster:function(y,b){return{u_matrix:new o.UniformMatrix4f(y,b.u_matrix),u_tl_parent:new o.Uniform2f(y,b.u_tl_parent),u_scale_parent:new o.Uniform1f(y,b.u_scale_parent),u_buffer_scale:new o.Uniform1f(y,b.u_buffer_scale),u_fade_t:new o.Uniform1f(y,b.u_fade_t),u_opacity:new o.Uniform1f(y,b.u_opacity),u_image0:new o.Uniform1i(y,b.u_image0),u_image1:new o.Uniform1i(y,b.u_image1),u_brightness_low:new o.Uniform1f(y,b.u_brightness_low),u_brightness_high:new o.Uniform1f(y,b.u_brightness_high),u_saturation_factor:new o.Uniform1f(y,b.u_saturation_factor),u_contrast_factor:new o.Uniform1f(y,b.u_contrast_factor),u_spin_weights:new o.Uniform3f(y,b.u_spin_weights)}},symbolIcon:function(y,b){return{u_is_size_zoom_constant:new o.Uniform1i(y,b.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(y,b.u_is_size_feature_constant),u_size_t:new o.Uniform1f(y,b.u_size_t),u_size:new o.Uniform1f(y,b.u_size),u_camera_to_center_distance:new o.Uniform1f(y,b.u_camera_to_center_distance),u_pitch:new o.Uniform1f(y,b.u_pitch),u_rotate_symbol:new o.Uniform1i(y,b.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(y,b.u_aspect_ratio),u_fade_change:new o.Uniform1f(y,b.u_fade_change),u_matrix:new o.UniformMatrix4f(y,b.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(y,b.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(y,b.u_coord_matrix),u_is_text:new o.Uniform1i(y,b.u_is_text),u_pitch_with_map:new o.Uniform1i(y,b.u_pitch_with_map),u_texsize:new o.Uniform2f(y,b.u_texsize),u_texture:new o.Uniform1i(y,b.u_texture)}},symbolSDF:function(y,b){return{u_is_size_zoom_constant:new o.Uniform1i(y,b.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(y,b.u_is_size_feature_constant),u_size_t:new o.Uniform1f(y,b.u_size_t),u_size:new o.Uniform1f(y,b.u_size),u_camera_to_center_distance:new o.Uniform1f(y,b.u_camera_to_center_distance),u_pitch:new o.Uniform1f(y,b.u_pitch),u_rotate_symbol:new o.Uniform1i(y,b.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(y,b.u_aspect_ratio),u_fade_change:new o.Uniform1f(y,b.u_fade_change),u_matrix:new o.UniformMatrix4f(y,b.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(y,b.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(y,b.u_coord_matrix),u_is_text:new o.Uniform1i(y,b.u_is_text),u_pitch_with_map:new o.Uniform1i(y,b.u_pitch_with_map),u_texsize:new o.Uniform2f(y,b.u_texsize),u_texture:new o.Uniform1i(y,b.u_texture),u_gamma_scale:new o.Uniform1f(y,b.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(y,b.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(y,b.u_is_halo)}},symbolTextAndIcon:function(y,b){return{u_is_size_zoom_constant:new o.Uniform1i(y,b.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(y,b.u_is_size_feature_constant),u_size_t:new o.Uniform1f(y,b.u_size_t),u_size:new o.Uniform1f(y,b.u_size),u_camera_to_center_distance:new o.Uniform1f(y,b.u_camera_to_center_distance),u_pitch:new o.Uniform1f(y,b.u_pitch),u_rotate_symbol:new o.Uniform1i(y,b.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(y,b.u_aspect_ratio),u_fade_change:new o.Uniform1f(y,b.u_fade_change),u_matrix:new o.UniformMatrix4f(y,b.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(y,b.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(y,b.u_coord_matrix),u_is_text:new o.Uniform1i(y,b.u_is_text),u_pitch_with_map:new o.Uniform1i(y,b.u_pitch_with_map),u_texsize:new o.Uniform2f(y,b.u_texsize),u_texsize_icon:new o.Uniform2f(y,b.u_texsize_icon),u_texture:new o.Uniform1i(y,b.u_texture),u_texture_icon:new o.Uniform1i(y,b.u_texture_icon),u_gamma_scale:new o.Uniform1f(y,b.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(y,b.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(y,b.u_is_halo)}},background:function(y,b){return{u_matrix:new o.UniformMatrix4f(y,b.u_matrix),u_opacity:new o.Uniform1f(y,b.u_opacity),u_color:new o.UniformColor(y,b.u_color)}},backgroundPattern:function(y,b){return{u_matrix:new o.UniformMatrix4f(y,b.u_matrix),u_opacity:new o.Uniform1f(y,b.u_opacity),u_image:new o.Uniform1i(y,b.u_image),u_pattern_tl_a:new o.Uniform2f(y,b.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(y,b.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(y,b.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(y,b.u_pattern_br_b),u_texsize:new o.Uniform2f(y,b.u_texsize),u_mix:new o.Uniform1f(y,b.u_mix),u_pattern_size_a:new o.Uniform2f(y,b.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(y,b.u_pattern_size_b),u_scale_a:new o.Uniform1f(y,b.u_scale_a),u_scale_b:new o.Uniform1f(y,b.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(y,b.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(y,b.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(y,b.u_tile_units_to_pixels)}}};function vd(y,b,_,C,O,F,B){for(var H=y.context,Y=H.gl,rt=y.useProgram("collisionBox"),ct=[],dt=0,pt=0,Pt=0;Pt<C.length;Pt++){var Mt=C[Pt],Ht=b.getTile(Mt),St=Ht.getBucket(_);if(St){var Ut=Mt.posMatrix;O[0]===0&&O[1]===0||(Ut=y.translatePosMatrix(Mt.posMatrix,Ht,O,F));var Kt=B?St.textCollisionBox:St.iconCollisionBox,le=St.collisionCircleArray;if(le.length>0){var we=o.create(),ve=Ut;o.mul(we,St.placementInvProjMatrix,y.transform.glCoordMatrix),o.mul(we,we,St.placementViewportMatrix),ct.push({circleArray:le,circleOffset:pt,transform:ve,invTransform:we}),pt=dt+=le.length/4}Kt&&rt.draw(H,Y.LINES,yt.disabled,Rt.disabled,y.colorModeForRenderPass(),Jt.disabled,Yu(Ut,y.transform,Ht),_.id,Kt.layoutVertexBuffer,Kt.indexBuffer,Kt.segments,null,y.transform.zoom,null,null,Kt.collisionVertexBuffer)}}if(B&&ct.length){var Me=y.useProgram("collisionCircle"),Ge=new o.StructArrayLayout2f1f2i16;Ge.resize(4*dt),Ge._trim();for(var hr=0,or=0,Ir=ct;or<Ir.length;or+=1)for(var ln=Ir[or],fn=0;fn<ln.circleArray.length/4;fn++){var hn=4*fn,Li=ln.circleArray[hn+0],Ur=ln.circleArray[hn+1],Pn=ln.circleArray[hn+2],jn=ln.circleArray[hn+3];Ge.emplace(hr++,Li,Ur,Pn,jn,0),Ge.emplace(hr++,Li,Ur,Pn,jn,1),Ge.emplace(hr++,Li,Ur,Pn,jn,2),Ge.emplace(hr++,Li,Ur,Pn,jn,3)}(!wh||wh.length<2*dt)&&(wh=function(Za){var ds=2*Za,jo=new o.StructArrayLayout3ui6;jo.resize(ds),jo._trim();for(var Xa=0;Xa<ds;Xa++){var qa=6*Xa;jo.uint16[qa+0]=4*Xa+0,jo.uint16[qa+1]=4*Xa+1,jo.uint16[qa+2]=4*Xa+2,jo.uint16[qa+3]=4*Xa+2,jo.uint16[qa+4]=4*Xa+3,jo.uint16[qa+5]=4*Xa+0}return jo}(dt));for(var Ln=H.createIndexBuffer(wh,!0),Sn=H.createVertexBuffer(Ge,o.collisionCircleLayout.members,!0),Vn=0,Tn=ct;Vn<Tn.length;Vn+=1){var En=Tn[Vn],Ro=bv(En.transform,En.invTransform,y.transform);Me.draw(H,Y.TRIANGLES,yt.disabled,Rt.disabled,y.colorModeForRenderPass(),Jt.disabled,Ro,_.id,Sn,Ln,o.SegmentVector.simpleSegment(0,2*En.circleOffset,En.circleArray.length,En.circleArray.length/2),null,y.transform.zoom,null,null,null)}Sn.destroy(),Ln.destroy()}}var wu=o.identity(new Float32Array(16));function V0(y,b,_,C,O,F){var B=o.getAnchorAlignment(y),H=-(B.horizontalAlign-.5)*b,Y=-(B.verticalAlign-.5)*_,rt=o.evaluateVariableOffset(y,C);return new o.Point((H/O+rt[0])*F,(Y/O+rt[1])*F)}function G0(y,b,_,C,O,F,B,H,Y,rt,ct){var dt=y.text.placedSymbolArray,pt=y.text.dynamicLayoutVertexArray,Pt=y.icon.dynamicLayoutVertexArray,Mt={};pt.clear();for(var Ht=0;Ht<dt.length;Ht++){var St=dt.get(Ht),Ut=St.hidden||!St.crossTileID||y.allowVerticalPlacement&&!St.placedOrientation?null:C[St.crossTileID];if(Ut){var Kt=new o.Point(St.anchorX,St.anchorY),le=Hn(Kt,_?H:B),we=si(F.cameraToCenterDistance,le.signedDistanceFromCamera),ve=O.evaluateSizeForFeature(y.textSizeData,rt,St)*we/o.ONE_EM;_&&(ve*=y.tilePixelRatio/Y);for(var Me=V0(Ut.anchor,Ut.width,Ut.height,Ut.textOffset,Ut.textBoxScale,ve),Ge=_?Hn(Kt.add(Me),B).point:le.point.add(b?Me.rotate(-F.angle):Me),hr=y.allowVerticalPlacement&&St.placedOrientation===o.WritingMode.vertical?Math.PI/2:0,or=0;or<St.numGlyphs;or++)o.addDynamicAttributes(pt,Ge,hr);ct&&St.associatedIconIndex>=0&&(Mt[St.associatedIconIndex]={shiftedAnchor:Ge,angle:hr})}else Vo(St.numGlyphs,pt)}if(ct){Pt.clear();for(var Ir=y.icon.placedSymbolArray,ln=0;ln<Ir.length;ln++){var fn=Ir.get(ln);if(fn.hidden)Vo(fn.numGlyphs,Pt);else{var hn=Mt[ln];if(hn)for(var Li=0;Li<fn.numGlyphs;Li++)o.addDynamicAttributes(Pt,hn.shiftedAnchor,hn.angle);else Vo(fn.numGlyphs,Pt)}}y.icon.dynamicLayoutVertexBuffer.updateData(Pt)}y.text.dynamicLayoutVertexBuffer.updateData(pt)}function W0(y,b,_){return _.iconsInText&&b?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function gf(y,b,_,C,O,F,B,H,Y,rt,ct,dt){for(var pt=y.context,Pt=pt.gl,Mt=y.transform,Ht=H==="map",St=Y==="map",Ut=Ht&&_.layout.get("symbol-placement")!=="point",Kt=Ht&&!St&&!Ut,le=_.layout.get("symbol-sort-key").constantOr(1)!==void 0,we=!1,ve=y.depthModeForSublayer(0,yt.ReadOnly),Me=_.layout.get("text-variable-anchor"),Ge=[],hr=0,or=C;hr<or.length;hr+=1){var Ir=or[hr],ln=b.getTile(Ir),fn=ln.getBucket(_);if(fn){var hn=O?fn.text:fn.icon;if(hn&&hn.segments.get().length){var Li=hn.programConfigurations.get(_.id),Ur=O||fn.sdfIcons,Pn=O?fn.textSizeData:fn.iconSizeData,jn=St||Mt.pitch!==0,Ln=y.useProgram(W0(Ur,O,fn),Li),Sn=o.evaluateSizeForZoom(Pn,Mt.zoom),Vn=void 0,Tn=[0,0],En=void 0,Ro=void 0,Za=null,ds=void 0;if(O)En=ln.glyphAtlasTexture,Ro=Pt.LINEAR,Vn=ln.glyphAtlasTexture.size,fn.iconsInText&&(Tn=ln.imageAtlasTexture.size,Za=ln.imageAtlasTexture,ds=jn||y.options.rotating||y.options.zooming||Pn.kind==="composite"||Pn.kind==="camera"?Pt.LINEAR:Pt.NEAREST);else{var jo=_.layout.get("icon-size").constantOr(0)!==1||fn.iconsNeedLinear;En=ln.imageAtlasTexture,Ro=Ur||y.options.rotating||y.options.zooming||jo||jn?Pt.LINEAR:Pt.NEAREST,Vn=ln.imageAtlasTexture.size}var Xa=ya(ln,1,y.transform.zoom),qa=ia(Ir.posMatrix,St,Ht,y.transform,Xa),qs=Bi(Ir.posMatrix,St,Ht,y.transform,Xa),Us=Me&&fn.hasTextData(),Tc=_.layout.get("icon-text-fit")!=="none"&&Us&&fn.hasIconData();Ut&&nf(fn,Ir.posMatrix,y,O,qa,qs,St,rt);var Ks=y.translatePosMatrix(Ir.posMatrix,ln,F,B),Mu=Ut||O&&Me||Tc?wu:qa,Fl=y.translatePosMatrix(qs,ln,F,B,!0),_p=Ur&&_.paint.get(O?"text-halo-width":"icon-halo-width").constantOr(1)!==0,xd={program:Ln,buffers:hn,uniformValues:Ur?fn.iconsInText?cp(Pn.kind,Sn,Kt,St,y,Ks,Mu,Fl,Vn,Tn):fd(Pn.kind,Sn,Kt,St,y,Ks,Mu,Fl,O,Vn,!0):vf(Pn.kind,Sn,Kt,St,y,Ks,Mu,Fl,O,Vn),atlasTexture:En,atlasTextureIcon:Za,atlasInterpolation:Ro,atlasInterpolationIcon:ds,isSDF:Ur,hasHalo:_p};if(le&&fn.canOverlap){we=!0;for(var Ac=0,Cf=hn.segments.get();Ac<Cf.length;Ac+=1){var Mh=Cf[Ac];Ge.push({segments:new o.SegmentVector([Mh]),sortKey:Mh.sortKey,state:xd})}}else Ge.push({segments:hn.segments,sortKey:0,state:xd})}}}we&&Ge.sort(function(Ru,Qu){return Ru.sortKey-Qu.sortKey});for(var Ku=0,Sf=Ge;Ku<Sf.length;Ku+=1){var Ts=Sf[Ku],uo=Ts.state;if(pt.activeTexture.set(Pt.TEXTURE0),uo.atlasTexture.bind(uo.atlasInterpolation,Pt.CLAMP_TO_EDGE),uo.atlasTextureIcon&&(pt.activeTexture.set(Pt.TEXTURE1),uo.atlasTextureIcon&&uo.atlasTextureIcon.bind(uo.atlasInterpolationIcon,Pt.CLAMP_TO_EDGE)),uo.isSDF){var ul=uo.uniformValues;uo.hasHalo&&(ul.u_is_halo=1,bc(uo.buffers,Ts.segments,_,y,uo.program,ve,ct,dt,ul)),ul.u_is_halo=0}bc(uo.buffers,Ts.segments,_,y,uo.program,ve,ct,dt,uo.uniformValues)}}function bc(y,b,_,C,O,F,B,H,Y){var rt=C.context;O.draw(rt,rt.gl.TRIANGLES,F,B,H,Jt.disabled,Y,_.id,y.layoutVertexBuffer,y.indexBuffer,b,_.paint,C.transform.zoom,y.programConfigurations.get(_.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function hp(y,b,_,C,O,F,B){var H,Y,rt,ct,dt,pt=y.context.gl,Pt=_.paint.get("fill-pattern"),Mt=Pt&&Pt.constantOr(1),Ht=_.getCrossfadeParameters();B?(Y=Mt&&!_.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",H=pt.LINES):(Y=Mt?"fillPattern":"fill",H=pt.TRIANGLES);for(var St=0,Ut=C;St<Ut.length;St+=1){var Kt=Ut[St],le=b.getTile(Kt);if(!Mt||le.patternsLoaded()){var we=le.getBucket(_);if(we){var ve=we.programConfigurations.get(_.id),Me=y.useProgram(Y,ve);Mt&&(y.context.activeTexture.set(pt.TEXTURE0),le.imageAtlasTexture.bind(pt.LINEAR,pt.CLAMP_TO_EDGE),ve.updatePaintBuffers(Ht));var Ge=Pt.constantOr(null);if(Ge&&le.imageAtlas){var hr=le.imageAtlas,or=hr.patternPositions[Ge.to.toString()],Ir=hr.patternPositions[Ge.from.toString()];or&&Ir&&ve.setConstantPatternPositions(or,Ir)}var ln=y.translatePosMatrix(Kt.posMatrix,le,_.paint.get("fill-translate"),_.paint.get("fill-translate-anchor"));if(B){ct=we.indexBuffer2,dt=we.segments2;var fn=[pt.drawingBufferWidth,pt.drawingBufferHeight];rt=Y==="fillOutlinePattern"&&Mt?$g(ln,y,Ht,le,fn):ff(ln,fn)}else ct=we.indexBuffer,dt=we.segments,rt=Mt?xc(ln,y,Ht,le):bh(ln);Me.draw(y.context,H,O,y.stencilModeForClipping(Kt),F,Jt.disabled,rt,_.id,we.layoutVertexBuffer,ct,dt,_.paint,y.transform.zoom,ve)}}}}function Cv(y,b,_,C,O,F,B){for(var H=y.context,Y=H.gl,rt=_.paint.get("fill-extrusion-pattern"),ct=rt.constantOr(1),dt=_.getCrossfadeParameters(),pt=_.paint.get("fill-extrusion-opacity"),Pt=0,Mt=C;Pt<Mt.length;Pt+=1){var Ht=Mt[Pt],St=b.getTile(Ht),Ut=St.getBucket(_);if(Ut){var Kt=Ut.programConfigurations.get(_.id),le=y.useProgram(ct?"fillExtrusionPattern":"fillExtrusion",Kt);ct&&(y.context.activeTexture.set(Y.TEXTURE0),St.imageAtlasTexture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),Kt.updatePaintBuffers(dt));var we=rt.constantOr(null);if(we&&St.imageAtlas){var ve=St.imageAtlas,Me=ve.patternPositions[we.to.toString()],Ge=ve.patternPositions[we.from.toString()];Me&&Ge&&Kt.setConstantPatternPositions(Me,Ge)}var hr=y.translatePosMatrix(Ht.posMatrix,St,_.paint.get("fill-extrusion-translate"),_.paint.get("fill-extrusion-translate-anchor")),or=_.paint.get("fill-extrusion-vertical-gradient"),Ir=ct?sl(hr,y,or,pt,Ht,dt,St):n1(hr,y,or,pt);le.draw(H,H.gl.TRIANGLES,O,F,B,Jt.backCCW,Ir,_.id,Ut.layoutVertexBuffer,Ut.indexBuffer,Ut.segments,_.paint,y.transform.zoom,Kt)}}}function mf(y,b,_,C,O,F){var B=y.context,H=B.gl,Y=b.fbo;if(Y){var rt=y.useProgram("hillshade");B.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,Y.colorAttachment.get());var ct=function(dt,pt,Pt){var Mt=Pt.paint.get("hillshade-shadow-color"),Ht=Pt.paint.get("hillshade-highlight-color"),St=Pt.paint.get("hillshade-accent-color"),Ut=Pt.paint.get("hillshade-illumination-direction")*(Math.PI/180);Pt.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ut-=dt.transform.angle);var Kt,le,we,ve=!dt.options.moving;return{u_matrix:dt.transform.calculatePosMatrix(pt.tileID.toUnwrapped(),ve),u_image:0,u_latrange:(Kt=pt.tileID,le=Math.pow(2,Kt.canonical.z),we=Kt.canonical.y,[new o.MercatorCoordinate(0,we/le).toLngLat().lat,new o.MercatorCoordinate(0,(we+1)/le).toLngLat().lat]),u_light:[Pt.paint.get("hillshade-exaggeration"),Ut],u_shadow:Mt,u_highlight:Ht,u_accent:St}}(y,b,_);rt.draw(B,H.TRIANGLES,C,O,F,Jt.disabled,ct,_.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}}function hE(y,b,_,C,O,F){var B=y.context,H=B.gl,Y=b.dem;if(Y&&Y.data){var rt=Y.dim,ct=Y.stride,dt=Y.getPixels();if(B.activeTexture.set(H.TEXTURE1),B.pixelStoreUnpackPremultiplyAlpha.set(!1),b.demTexture=b.demTexture||y.getTileTexture(ct),b.demTexture){var pt=b.demTexture;pt.update(dt,{premultiply:!1}),pt.bind(H.NEAREST,H.CLAMP_TO_EDGE)}else b.demTexture=new o.Texture(B,dt,H.RGBA,{premultiply:!1}),b.demTexture.bind(H.NEAREST,H.CLAMP_TO_EDGE);B.activeTexture.set(H.TEXTURE0);var Pt=b.fbo;if(!Pt){var Mt=new o.Texture(B,{width:rt,height:rt,data:null},H.RGBA);Mt.bind(H.LINEAR,H.CLAMP_TO_EDGE),(Pt=b.fbo=B.createFramebuffer(rt,rt,!0)).colorAttachment.set(Mt.texture)}B.bindFramebuffer.set(Pt.framebuffer),B.viewport.set([0,0,rt,rt]),y.useProgram("hillshadePrepare").draw(B,H.TRIANGLES,C,O,F,Jt.disabled,function(Ht,St){var Ut=St.stride,Kt=o.create();return o.ortho(Kt,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(Kt,Kt,[0,-o.EXTENT,0]),{u_matrix:Kt,u_image:1,u_dimension:[Ut,Ut],u_zoom:Ht.overscaledZ,u_unpack:St.getUnpackVector()}}(b.tileID,Y),_.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments),b.needsHillshadePrepare=!1}}function Gg(y,b,_,C,O){var F=C.paint.get("raster-fade-duration");if(F>0){var B=o.browser.now(),H=(B-y.timeAdded)/F,Y=b?(B-b.timeAdded)/F:-1,rt=_.getSource(),ct=O.coveringZoomLevel({tileSize:rt.tileSize,roundZoom:rt.roundZoom}),dt=!b||Math.abs(b.tileID.overscaledZ-ct)>Math.abs(y.tileID.overscaledZ-ct),pt=dt&&y.refreshedUponExpiration?1:o.clamp(dt?H:1-Y,0,1);return y.refreshedUponExpiration&&H>=1&&(y.refreshedUponExpiration=!1),b?{opacity:1,mix:1-pt}:{opacity:pt,mix:0}}return{opacity:1,mix:0}}var X0=new o.Color(1,0,0,1),Wg=new o.Color(0,1,0,1),i1=new o.Color(0,0,1,1),Xg=new o.Color(1,0,1,1),j0=new o.Color(0,1,1,1);function Sv(y,b,_,C){gd(y,0,b+_/2,y.transform.width,_,C)}function Y0(y,b,_,C){gd(y,b-_/2,0,_,y.transform.height,C)}function gd(y,b,_,C,O,F){var B=y.context,H=B.gl;H.enable(H.SCISSOR_TEST),H.scissor(b*o.browser.devicePixelRatio,_*o.browser.devicePixelRatio,C*o.browser.devicePixelRatio,O*o.browser.devicePixelRatio),B.clear({color:F}),H.disable(H.SCISSOR_TEST)}function Z0(y,b,_){var C=y.context,O=C.gl,F=_.posMatrix,B=y.useProgram("debug"),H=yt.disabled,Y=Rt.disabled,rt=y.colorModeForRenderPass();C.activeTexture.set(O.TEXTURE0),y.emptyTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),B.draw(C,O.LINE_STRIP,H,Y,rt,Jt.disabled,df(F,o.Color.red),"$debug",y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments);var ct=b.getTileByID(_.key).latestRawTileData,dt=Math.floor((ct&&ct.byteLength||0)/1024),pt=b.getTile(_).tileSize,Pt=512/Math.min(pt,512)*(_.overscaledZ/y.transform.zoom)*.5,Mt=_.canonical.toString();_.overscaledZ!==_.canonical.z&&(Mt+=" => "+_.overscaledZ),function(Ht,St){Ht.initDebugOverlayCanvas();var Ut=Ht.debugOverlayCanvas,Kt=Ht.context.gl,le=Ht.debugOverlayCanvas.getContext("2d");le.clearRect(0,0,Ut.width,Ut.height),le.shadowColor="white",le.shadowBlur=2,le.lineWidth=1.5,le.strokeStyle="white",le.textBaseline="top",le.font="bold 36px Open Sans, sans-serif",le.fillText(St,5,5),le.strokeText(St,5,5),Ht.debugOverlayTexture.update(Ut),Ht.debugOverlayTexture.bind(Kt.LINEAR,Kt.CLAMP_TO_EDGE)}(y,Mt+" "+dt+"kb"),B.draw(C,O.TRIANGLES,H,Y,jt.alphaBlended,Jt.disabled,df(F,o.Color.transparent,Pt),"$debug",y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments)}var yf={symbol:function(y,b,_,C,O){if(y.renderPass==="translucent"){var F=Rt.disabled,B=y.colorModeForRenderPass();_.layout.get("text-variable-anchor")&&function(H,Y,rt,ct,dt,pt,Pt){for(var Mt=Y.transform,Ht=dt==="map",St=pt==="map",Ut=0,Kt=H;Ut<Kt.length;Ut+=1){var le=Kt[Ut],we=ct.getTile(le),ve=we.getBucket(rt);if(ve&&ve.text&&ve.text.segments.get().length){var Me=o.evaluateSizeForZoom(ve.textSizeData,Mt.zoom),Ge=ya(we,1,Y.transform.zoom),hr=ia(le.posMatrix,St,Ht,Y.transform,Ge),or=rt.layout.get("icon-text-fit")!=="none"&&ve.hasIconData();if(Me){var Ir=Math.pow(2,Mt.zoom-we.tileID.overscaledZ);G0(ve,Ht,St,Pt,o.symbolSize,Mt,hr,le.posMatrix,Ir,Me,or)}}}}(C,y,_,b,_.layout.get("text-rotation-alignment"),_.layout.get("text-pitch-alignment"),O),_.paint.get("icon-opacity").constantOr(1)!==0&&gf(y,b,_,C,!1,_.paint.get("icon-translate"),_.paint.get("icon-translate-anchor"),_.layout.get("icon-rotation-alignment"),_.layout.get("icon-pitch-alignment"),_.layout.get("icon-keep-upright"),F,B),_.paint.get("text-opacity").constantOr(1)!==0&&gf(y,b,_,C,!0,_.paint.get("text-translate"),_.paint.get("text-translate-anchor"),_.layout.get("text-rotation-alignment"),_.layout.get("text-pitch-alignment"),_.layout.get("text-keep-upright"),F,B),b.map.showCollisionBoxes&&(vd(y,b,_,C,_.paint.get("text-translate"),_.paint.get("text-translate-anchor"),!0),vd(y,b,_,C,_.paint.get("icon-translate"),_.paint.get("icon-translate-anchor"),!1))}},circle:function(y,b,_,C){if(y.renderPass==="translucent"){var O=_.paint.get("circle-opacity"),F=_.paint.get("circle-stroke-width"),B=_.paint.get("circle-stroke-opacity"),H=_.layout.get("circle-sort-key").constantOr(1)!==void 0;if(O.constantOr(1)!==0||F.constantOr(1)!==0&&B.constantOr(1)!==0){for(var Y=y.context,rt=Y.gl,ct=y.depthModeForSublayer(0,yt.ReadOnly),dt=Rt.disabled,pt=y.colorModeForRenderPass(),Pt=[],Mt=0;Mt<C.length;Mt++){var Ht=C[Mt],St=b.getTile(Ht),Ut=St.getBucket(_);if(Ut){var Kt=Ut.programConfigurations.get(_.id),le={programConfiguration:Kt,program:y.useProgram("circle",Kt),layoutVertexBuffer:Ut.layoutVertexBuffer,indexBuffer:Ut.indexBuffer,uniformValues:up(y,Ht,St,_)};if(H)for(var we=0,ve=Ut.segments.get();we<ve.length;we+=1){var Me=ve[we];Pt.push({segments:new o.SegmentVector([Me]),sortKey:Me.sortKey,state:le})}else Pt.push({segments:Ut.segments,sortKey:0,state:le})}}H&&Pt.sort(function(ln,fn){return ln.sortKey-fn.sortKey});for(var Ge=0,hr=Pt;Ge<hr.length;Ge+=1){var or=hr[Ge],Ir=or.state;Ir.program.draw(Y,rt.TRIANGLES,ct,dt,pt,Jt.disabled,Ir.uniformValues,_.id,Ir.layoutVertexBuffer,Ir.indexBuffer,or.segments,_.paint,y.transform.zoom,Ir.programConfiguration)}}}},heatmap:function(y,b,_,C){if(_.paint.get("heatmap-opacity")!==0)if(y.renderPass==="offscreen"){var O=y.context,F=O.gl,B=Rt.disabled,H=new jt([F.ONE,F.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(Pt,Mt,Ht){var St=Pt.gl;Pt.activeTexture.set(St.TEXTURE1),Pt.viewport.set([0,0,Mt.width/4,Mt.height/4]);var Ut=Ht.heatmapFbo;if(Ut)St.bindTexture(St.TEXTURE_2D,Ut.colorAttachment.get()),Pt.bindFramebuffer.set(Ut.framebuffer);else{var Kt=St.createTexture();St.bindTexture(St.TEXTURE_2D,Kt),St.texParameteri(St.TEXTURE_2D,St.TEXTURE_WRAP_S,St.CLAMP_TO_EDGE),St.texParameteri(St.TEXTURE_2D,St.TEXTURE_WRAP_T,St.CLAMP_TO_EDGE),St.texParameteri(St.TEXTURE_2D,St.TEXTURE_MIN_FILTER,St.LINEAR),St.texParameteri(St.TEXTURE_2D,St.TEXTURE_MAG_FILTER,St.LINEAR),Ut=Ht.heatmapFbo=Pt.createFramebuffer(Mt.width/4,Mt.height/4,!1),function(le,we,ve,Me){var Ge=le.gl;Ge.texImage2D(Ge.TEXTURE_2D,0,Ge.RGBA,we.width/4,we.height/4,0,Ge.RGBA,le.extRenderToTextureHalfFloat?le.extTextureHalfFloat.HALF_FLOAT_OES:Ge.UNSIGNED_BYTE,null),Me.colorAttachment.set(ve)}(Pt,Mt,Kt,Ut)}})(O,y,_),O.clear({color:o.Color.transparent});for(var Y=0;Y<C.length;Y++){var rt=C[Y];if(!b.hasRenderableParent(rt)){var ct=b.getTile(rt),dt=ct.getBucket(_);if(dt){var pt=dt.programConfigurations.get(_.id);y.useProgram("heatmap",pt).draw(O,F.TRIANGLES,yt.disabled,B,H,Jt.disabled,U0(rt.posMatrix,ct,y.transform.zoom,_.paint.get("heatmap-intensity")),_.id,dt.layoutVertexBuffer,dt.indexBuffer,dt.segments,_.paint,y.transform.zoom,pt)}}}O.viewport.set([0,0,y.width,y.height])}else y.renderPass==="translucent"&&(y.context.setColorMode(y.colorModeForRenderPass()),function(Pt,Mt){var Ht=Pt.context,St=Ht.gl,Ut=Mt.heatmapFbo;if(Ut){Ht.activeTexture.set(St.TEXTURE0),St.bindTexture(St.TEXTURE_2D,Ut.colorAttachment.get()),Ht.activeTexture.set(St.TEXTURE1);var Kt=Mt.colorRampTexture;Kt||(Kt=Mt.colorRampTexture=new o.Texture(Ht,Mt.colorRamp,St.RGBA)),Kt.bind(St.LINEAR,St.CLAMP_TO_EDGE),Pt.useProgram("heatmapTexture").draw(Ht,St.TRIANGLES,yt.disabled,Rt.disabled,Pt.colorModeForRenderPass(),Jt.disabled,function(le,we,ve,Me){var Ge=o.create();o.ortho(Ge,0,le.width,le.height,0,0,1);var hr=le.context.gl;return{u_matrix:Ge,u_world:[hr.drawingBufferWidth,hr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:we.paint.get("heatmap-opacity")}}(Pt,Mt),Mt.id,Pt.viewportBuffer,Pt.quadTriangleIndexBuffer,Pt.viewportSegments,Mt.paint,Pt.transform.zoom)}}(y,_))},line:function(y,b,_,C){if(y.renderPass==="translucent"){var O=_.paint.get("line-opacity"),F=_.paint.get("line-width");if(O.constantOr(1)!==0&&F.constantOr(1)!==0)for(var B=y.depthModeForSublayer(0,yt.ReadOnly),H=y.colorModeForRenderPass(),Y=_.paint.get("line-dasharray"),rt=_.paint.get("line-pattern"),ct=rt.constantOr(1),dt=_.paint.get("line-gradient"),pt=_.getCrossfadeParameters(),Pt=ct?"linePattern":Y?"lineSDF":dt?"lineGradient":"line",Mt=y.context,Ht=Mt.gl,St=!0,Ut=0,Kt=C;Ut<Kt.length;Ut+=1){var le=Kt[Ut],we=b.getTile(le);if(!ct||we.patternsLoaded()){var ve=we.getBucket(_);if(ve){var Me=ve.programConfigurations.get(_.id),Ge=y.context.program.get(),hr=y.useProgram(Pt,Me),or=St||hr.program!==Ge,Ir=rt.constantOr(null);if(Ir&&we.imageAtlas){var ln=we.imageAtlas,fn=ln.patternPositions[Ir.to.toString()],hn=ln.patternPositions[Ir.from.toString()];fn&&hn&&Me.setConstantPatternPositions(fn,hn)}var Li=ct?Hg(y,we,_,pt):Y?cE(y,we,_,Y,pt):dt?wa(y,we,_,ve.lineClipsArray.length):Ev(y,we,_);if(ct)Mt.activeTexture.set(Ht.TEXTURE0),we.imageAtlasTexture.bind(Ht.LINEAR,Ht.CLAMP_TO_EDGE),Me.updatePaintBuffers(pt);else if(Y&&(or||y.lineAtlas.dirty))Mt.activeTexture.set(Ht.TEXTURE0),y.lineAtlas.bind(Mt);else if(dt){var Ur=ve.gradients[_.id],Pn=Ur.texture;if(_.gradientVersion!==Ur.version){var jn=256;if(_.stepInterpolant){var Ln=b.getSource().maxzoom,Sn=le.canonical.z===Ln?Math.ceil(1<<y.transform.maxZoom-le.canonical.z):1;jn=o.clamp(o.nextPowerOfTwo(ve.maxLineLength/o.EXTENT*1024*Sn),256,Mt.maxTextureSize)}Ur.gradient=o.renderColorRamp({expression:_.gradientExpression(),evaluationKey:"lineProgress",resolution:jn,image:Ur.gradient||void 0,clips:ve.lineClipsArray}),Ur.texture?Ur.texture.update(Ur.gradient):Ur.texture=new o.Texture(Mt,Ur.gradient,Ht.RGBA),Ur.version=_.gradientVersion,Pn=Ur.texture}Mt.activeTexture.set(Ht.TEXTURE0),Pn.bind(_.stepInterpolant?Ht.NEAREST:Ht.LINEAR,Ht.CLAMP_TO_EDGE)}hr.draw(Mt,Ht.TRIANGLES,B,y.stencilModeForClipping(le),H,Jt.disabled,Li,_.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,_.paint,y.transform.zoom,Me,ve.layoutVertexBuffer2),St=!1}}}}},fill:function(y,b,_,C){var O=_.paint.get("fill-color"),F=_.paint.get("fill-opacity");if(F.constantOr(1)!==0){var B=y.colorModeForRenderPass(),H=_.paint.get("fill-pattern"),Y=y.opaquePassEnabledForLayer()&&!H.constantOr(1)&&O.constantOr(o.Color.transparent).a===1&&F.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===Y){var rt=y.depthModeForSublayer(1,y.renderPass==="opaque"?yt.ReadWrite:yt.ReadOnly);hp(y,b,_,C,rt,B,!1)}if(y.renderPass==="translucent"&&_.paint.get("fill-antialias")){var ct=y.depthModeForSublayer(_.getPaintProperty("fill-outline-color")?2:0,yt.ReadOnly);hp(y,b,_,C,ct,B,!0)}}},"fill-extrusion":function(y,b,_,C){var O=_.paint.get("fill-extrusion-opacity");if(O!==0&&y.renderPass==="translucent"){var F=new yt(y.context.gl.LEQUAL,yt.ReadWrite,y.depthRangeFor3D);if(O!==1||_.paint.get("fill-extrusion-pattern").constantOr(1))Cv(y,b,_,C,F,Rt.disabled,jt.disabled),Cv(y,b,_,C,F,y.stencilModeFor3D(),y.colorModeForRenderPass());else{var B=y.colorModeForRenderPass();Cv(y,b,_,C,F,Rt.disabled,B)}}},hillshade:function(y,b,_,C){if(y.renderPass==="offscreen"||y.renderPass==="translucent"){for(var O=y.context,F=y.depthModeForSublayer(0,yt.ReadOnly),B=y.colorModeForRenderPass(),H=y.renderPass==="translucent"?y.stencilConfigForOverlap(C):[{},C],Y=H[0],rt=0,ct=H[1];rt<ct.length;rt+=1){var dt=ct[rt],pt=b.getTile(dt);pt.needsHillshadePrepare&&y.renderPass==="offscreen"?hE(y,pt,_,F,Rt.disabled,B):y.renderPass==="translucent"&&mf(y,pt,_,F,Y[dt.overscaledZ],B)}O.viewport.set([0,0,y.width,y.height])}},raster:function(y,b,_,C){if(y.renderPass==="translucent"&&_.paint.get("raster-opacity")!==0&&C.length)for(var O=y.context,F=O.gl,B=b.getSource(),H=y.useProgram("raster"),Y=y.colorModeForRenderPass(),rt=B instanceof De?[{},C]:y.stencilConfigForOverlap(C),ct=rt[0],dt=rt[1],pt=dt[dt.length-1].overscaledZ,Pt=!y.options.moving,Mt=0,Ht=dt;Mt<Ht.length;Mt+=1){var St=Ht[Mt],Ut=y.depthModeForSublayer(St.overscaledZ-pt,_.paint.get("raster-opacity")===1?yt.ReadWrite:yt.ReadOnly,F.LESS),Kt=b.getTile(St),le=y.transform.calculatePosMatrix(St.toUnwrapped(),Pt);Kt.registerFadeDuration(_.paint.get("raster-fade-duration"));var we=b.findLoadedParent(St,0),ve=Gg(Kt,we,b,_,y.transform),Me=void 0,Ge=void 0,hr=_.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;O.activeTexture.set(F.TEXTURE0),Kt.texture.bind(hr,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),O.activeTexture.set(F.TEXTURE1),we?(we.texture.bind(hr,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST),Me=Math.pow(2,we.tileID.overscaledZ-Kt.tileID.overscaledZ),Ge=[Kt.tileID.canonical.x*Me%1,Kt.tileID.canonical.y*Me%1]):Kt.texture.bind(hr,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST);var or=$0(le,Ge||[0,0],Me||1,ve,_);B instanceof De?H.draw(O,F.TRIANGLES,Ut,Rt.disabled,Y,Jt.disabled,or,_.id,B.boundsBuffer,y.quadTriangleIndexBuffer,B.boundsSegments):H.draw(O,F.TRIANGLES,Ut,ct[St.overscaledZ],Y,Jt.disabled,or,_.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}},background:function(y,b,_){var C=_.paint.get("background-color"),O=_.paint.get("background-opacity");if(O!==0){var F=y.context,B=F.gl,H=y.transform,Y=H.tileSize,rt=_.paint.get("background-pattern");if(!y.isPatternMissing(rt)){var ct=!rt&&C.a===1&&O===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass===ct){var dt=Rt.disabled,pt=y.depthModeForSublayer(0,ct==="opaque"?yt.ReadWrite:yt.ReadOnly),Pt=y.colorModeForRenderPass(),Mt=y.useProgram(rt?"backgroundPattern":"background"),Ht=H.coveringTiles({tileSize:Y});rt&&(F.activeTexture.set(B.TEXTURE0),y.imageManager.bind(y.context));for(var St=_.getCrossfadeParameters(),Ut=0,Kt=Ht;Ut<Kt.length;Ut+=1){var le=Kt[Ut],we=y.transform.calculatePosMatrix(le.toUnwrapped()),ve=rt?pd(we,O,y,rt,{tileID:le,tileSize:Y},St):dd(we,O,C);Mt.draw(F,B.TRIANGLES,pt,dt,Pt,Jt.disabled,ve,_.id,y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}}}}},debug:function(y,b,_){for(var C=0;C<_.length;C++)Z0(y,b,_[C])},custom:function(y,b,_){var C=y.context,O=_.implementation;if(y.renderPass==="offscreen"){var F=O.prerender;F&&(y.setCustomLayerDefaults(),C.setColorMode(y.colorModeForRenderPass()),F.call(O,C.gl,y.transform.customLayerMatrix()),C.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),C.setColorMode(y.colorModeForRenderPass()),C.setStencilMode(Rt.disabled);var B=O.renderingMode==="3d"?new yt(y.context.gl.LEQUAL,yt.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,yt.ReadOnly);C.setDepthMode(B),O.render(C.gl,y.transform.customLayerMatrix()),C.setDirty(),y.setBaseState(),C.bindFramebuffer.set(null)}}},Ca=function(y,b){this.context=new ht(y),this.transform=b,this._tileTextures={},this.setup(),this.numSublayers=Dt.maxUnderzooming+Dt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new sf,this.gpuTimers={}};Ca.prototype.resize=function(y,b){if(this.width=y*o.browser.devicePixelRatio,this.height=b*o.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var _=0,C=this.style._order;_<C.length;_+=1)this.style._layers[C[_]].resize()},Ca.prototype.setup=function(){var y=this.context,b=new o.StructArrayLayout2i4;b.emplaceBack(0,0),b.emplaceBack(o.EXTENT,0),b.emplaceBack(0,o.EXTENT),b.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=y.createVertexBuffer(b,so.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);var _=new o.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(o.EXTENT,0),_.emplaceBack(0,o.EXTENT),_.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=y.createVertexBuffer(_,so.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);var C=new o.StructArrayLayout4i8;C.emplaceBack(0,0,0,0),C.emplaceBack(o.EXTENT,0,o.EXTENT,0),C.emplaceBack(0,o.EXTENT,0,o.EXTENT),C.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.rasterBoundsBuffer=y.createVertexBuffer(C,de.members),this.rasterBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);var O=new o.StructArrayLayout2i4;O.emplaceBack(0,0),O.emplaceBack(1,0),O.emplaceBack(0,1),O.emplaceBack(1,1),this.viewportBuffer=y.createVertexBuffer(O,so.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);var F=new o.StructArrayLayout1ui2;F.emplaceBack(0),F.emplaceBack(1),F.emplaceBack(3),F.emplaceBack(2),F.emplaceBack(0),this.tileBorderIndexBuffer=y.createIndexBuffer(F);var B=new o.StructArrayLayout3ui6;B.emplaceBack(0,1,2),B.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=y.createIndexBuffer(B),this.emptyTexture=new o.Texture(y,{width:1,height:1,data:new Uint8Array([0,0,0,0])},y.gl.RGBA);var H=this.context.gl;this.stencilClearMode=new Rt({func:H.ALWAYS,mask:0},0,255,H.ZERO,H.ZERO,H.ZERO)},Ca.prototype.clearStencil=function(){var y=this.context,b=y.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var _=o.create();o.ortho(_,0,this.width,this.height,0,0,1),o.scale(_,_,[b.drawingBufferWidth,b.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(y,b.TRIANGLES,yt.disabled,this.stencilClearMode,jt.disabled,Jt.disabled,Eh(_),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ca.prototype._renderTileClippingMasks=function(y,b){if(this.currentStencilSource!==y.source&&y.isTileClipped()&&b&&b.length){this.currentStencilSource=y.source;var _=this.context,C=_.gl;this.nextStencilID+b.length>256&&this.clearStencil(),_.setColorMode(jt.disabled),_.setDepthMode(yt.disabled);var O=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var F=0,B=b;F<B.length;F+=1){var H=B[F],Y=this._tileClippingMaskIDs[H.key]=this.nextStencilID++;O.draw(_,C.TRIANGLES,yt.disabled,new Rt({func:C.ALWAYS,mask:0},Y,255,C.KEEP,C.KEEP,C.REPLACE),jt.disabled,Jt.disabled,Eh(H.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ca.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var y=this.nextStencilID++,b=this.context.gl;return new Rt({func:b.NOTEQUAL,mask:255},y,255,b.KEEP,b.KEEP,b.REPLACE)},Ca.prototype.stencilModeForClipping=function(y){var b=this.context.gl;return new Rt({func:b.EQUAL,mask:255},this._tileClippingMaskIDs[y.key],0,b.KEEP,b.KEEP,b.REPLACE)},Ca.prototype.stencilConfigForOverlap=function(y){var b,_=this.context.gl,C=y.sort(function(Y,rt){return rt.overscaledZ-Y.overscaledZ}),O=C[C.length-1].overscaledZ,F=C[0].overscaledZ-O+1;if(F>1){this.currentStencilSource=void 0,this.nextStencilID+F>256&&this.clearStencil();for(var B={},H=0;H<F;H++)B[H+O]=new Rt({func:_.GEQUAL,mask:255},H+this.nextStencilID,255,_.KEEP,_.KEEP,_.REPLACE);return this.nextStencilID+=F,[B,C]}return[(b={},b[O]=Rt.disabled,b),C]},Ca.prototype.colorModeForRenderPass=function(){var y=this.context.gl;return this._showOverdrawInspector?new jt([y.CONSTANT_COLOR,y.ONE],new o.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?jt.unblended:jt.alphaBlended},Ca.prototype.depthModeForSublayer=function(y,b,_){if(!this.opaquePassEnabledForLayer())return yt.disabled;var C=1-((1+this.currentLayer)*this.numSublayers+y)*this.depthEpsilon;return new yt(_||this.context.gl.LEQUAL,b,[C,C])},Ca.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ca.prototype.render=function(y,b){var _=this;this.style=y,this.options=b,this.lineAtlas=y.lineAtlas,this.imageManager=y.imageManager,this.glyphManager=y.glyphManager,this.symbolFadeChange=y.placement.symbolFadeChange(o.browser.now()),this.imageManager.beginFrame();var C=this.style._order,O=this.style.sourceCaches;for(var F in O){var B=O[F];B.used&&B.prepare(this.context)}var H,Y,rt={},ct={},dt={};for(var pt in O){var Pt=O[pt];rt[pt]=Pt.getVisibleCoordinates(),ct[pt]=rt[pt].slice().reverse(),dt[pt]=Pt.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Mt=0;Mt<C.length;Mt++)if(this.style._layers[C[Mt]].is3D()){this.opaquePassCutoff=Mt;break}this.renderPass="offscreen";for(var Ht=0,St=C;Ht<St.length;Ht+=1){var Ut=this.style._layers[St[Ht]];if(Ut.hasOffscreenPass()&&!Ut.isHidden(this.transform.zoom)){var Kt=ct[Ut.source];(Ut.type==="custom"||Kt.length)&&this.renderLayer(this,O[Ut.source],Ut,Kt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:b.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=b.showOverdrawInspector,this.depthRangeFor3D=[0,1-(y._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=C.length-1;this.currentLayer>=0;this.currentLayer--){var le=this.style._layers[C[this.currentLayer]],we=O[le.source],ve=rt[le.source];this._renderTileClippingMasks(le,ve),this.renderLayer(this,we,le,ve)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<C.length;this.currentLayer++){var Me=this.style._layers[C[this.currentLayer]],Ge=O[Me.source],hr=(Me.type==="symbol"?dt:ct)[Me.source];this._renderTileClippingMasks(Me,rt[Me.source]),this.renderLayer(this,Ge,Me,hr)}this.options.showTileBoundaries&&(o.values(this.style._layers).forEach(function(or){or.source&&!or.isHidden(_.transform.zoom)&&(or.source!==(Y&&Y.id)&&(Y=_.style.sourceCaches[or.source]),(!H||H.getSource().maxzoom<Y.getSource().maxzoom)&&(H=Y))}),H&&yf.debug(this,H,H.getVisibleCoordinates())),this.options.showPadding&&function(or){var Ir=or.transform.padding;Sv(or,or.transform.height-(Ir.top||0),3,X0),Sv(or,Ir.bottom||0,3,Wg),Y0(or,Ir.left||0,3,i1),Y0(or,or.transform.width-(Ir.right||0),3,Xg);var ln=or.transform.centerPoint;(function(fn,hn,Li,Ur){gd(fn,hn-1,Li-10,2,20,Ur),gd(fn,hn-10,Li-1,20,2,Ur)})(or,ln.x,or.transform.height-ln.y,j0)}(this),this.context.setDefault()},Ca.prototype.renderLayer=function(y,b,_,C){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="custom"||C.length)&&(this.id=_.id,this.gpuTimingStart(_),yf[_.type](y,b,_,C,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ca.prototype.gpuTimingStart=function(y){if(this.options.gpuTiming){var b=this.context.extTimerQuery,_=this.gpuTimers[y.id];_||(_=this.gpuTimers[y.id]={calls:0,cpuTime:0,query:b.createQueryEXT()}),_.calls++,b.beginQueryEXT(b.TIME_ELAPSED_EXT,_.query)}},Ca.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var y=this.context.extTimerQuery;y.endQueryEXT(y.TIME_ELAPSED_EXT)}},Ca.prototype.collectGpuTimers=function(){var y=this.gpuTimers;return this.gpuTimers={},y},Ca.prototype.queryGpuTimers=function(y){var b={};for(var _ in y){var C=y[_],O=this.context.extTimerQuery,F=O.getQueryObjectEXT(C.query,O.QUERY_RESULT_EXT)/1e6;O.deleteQueryEXT(C.query),b[_]=F}return b},Ca.prototype.translatePosMatrix=function(y,b,_,C,O){if(!_[0]&&!_[1])return y;var F=O?C==="map"?this.transform.angle:0:C==="viewport"?-this.transform.angle:0;if(F){var B=Math.sin(F),H=Math.cos(F);_=[_[0]*H-_[1]*B,_[0]*B+_[1]*H]}var Y=[O?_[0]:ya(b,_[0],this.transform.zoom),O?_[1]:ya(b,_[1],this.transform.zoom),0],rt=new Float32Array(16);return o.translate(rt,y,Y),rt},Ca.prototype.saveTileTexture=function(y){var b=this._tileTextures[y.size[0]];b?b.push(y):this._tileTextures[y.size[0]]=[y]},Ca.prototype.getTileTexture=function(y){var b=this._tileTextures[y];return b&&b.length>0?b.pop():null},Ca.prototype.isPatternMissing=function(y){if(!y)return!1;if(!y.from||!y.to)return!0;var b=this.imageManager.getPattern(y.from.toString()),_=this.imageManager.getPattern(y.to.toString());return!b||!_},Ca.prototype.useProgram=function(y,b){this.cache=this.cache||{};var _=""+y+(b?b.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[_]||(this.cache[_]=new lo(this.context,y,uE[y],b,H0[y],this._showOverdrawInspector)),this.cache[_]},Ca.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ca.prototype.setBaseState=function(){var y=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(y.FUNC_ADD)},Ca.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Ca.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var jg=function(y,b){this.points=y,this.planes=b};jg.fromInvProjectionMatrix=function(y,b,_){var C=Math.pow(2,_),O=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(B){return o.transformMat4([],B,y)}).map(function(B){return o.scale$1([],B,1/B[3]/b*C)}),F=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(B){var H=o.sub([],O[B[0]],O[B[1]]),Y=o.sub([],O[B[2]],O[B[1]]),rt=o.normalize([],o.cross([],H,Y)),ct=-o.dot(rt,O[B[1]]);return rt.concat(ct)});return new jg(O,F)};var Ec=function(y,b){this.min=y,this.max=b,this.center=o.scale$2([],o.add([],this.min,this.max),.5)};Ec.prototype.quadrant=function(y){for(var b=[y%2==0,y<2],_=o.clone$2(this.min),C=o.clone$2(this.max),O=0;O<b.length;O++)_[O]=b[O]?this.min[O]:this.center[O],C[O]=b[O]?this.center[O]:this.max[O];return C[2]=this.max[2],new Ec(_,C)},Ec.prototype.distanceX=function(y){return Math.max(Math.min(this.max[0],y[0]),this.min[0])-y[0]},Ec.prototype.distanceY=function(y){return Math.max(Math.min(this.max[1],y[1]),this.min[1])-y[1]},Ec.prototype.intersects=function(y){for(var b=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],_=!0,C=0;C<y.planes.length;C++){for(var O=y.planes[C],F=0,B=0;B<b.length;B++)F+=o.dot$1(O,b[B])>=0;if(F===0)return 0;F!==b.length&&(_=!1)}if(_)return 2;for(var H=0;H<3;H++){for(var Y=Number.MAX_VALUE,rt=-Number.MAX_VALUE,ct=0;ct<y.points.length;ct++){var dt=y.points[ct][H]-this.min[H];Y=Math.min(Y,dt),rt=Math.max(rt,dt)}if(rt<0||Y>this.max[H]-this.min[H])return 0}return 1};var _f=function(y,b,_,C){if(y===void 0&&(y=0),b===void 0&&(b=0),_===void 0&&(_=0),C===void 0&&(C=0),isNaN(y)||y<0||isNaN(b)||b<0||isNaN(_)||_<0||isNaN(C)||C<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=y,this.bottom=b,this.left=_,this.right=C};_f.prototype.interpolate=function(y,b,_){return b.top!=null&&y.top!=null&&(this.top=o.number(y.top,b.top,_)),b.bottom!=null&&y.bottom!=null&&(this.bottom=o.number(y.bottom,b.bottom,_)),b.left!=null&&y.left!=null&&(this.left=o.number(y.left,b.left,_)),b.right!=null&&y.right!=null&&(this.right=o.number(y.right,b.right,_)),this},_f.prototype.getCenter=function(y,b){var _=o.clamp((this.left+y-this.right)/2,0,y),C=o.clamp((this.top+b-this.bottom)/2,0,b);return new o.Point(_,C)},_f.prototype.equals=function(y){return this.top===y.top&&this.bottom===y.bottom&&this.left===y.left&&this.right===y.right},_f.prototype.clone=function(){return new _f(this.top,this.bottom,this.left,this.right)},_f.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Si=function(y,b,_,C,O){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=O===void 0||O,this._minZoom=y||0,this._maxZoom=b||22,this._minPitch=_??0,this._maxPitch=C??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new _f,this._posMatrixCache={},this._alignedPosMatrixCache={}},Sa={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Si.prototype.clone=function(){var y=new Si(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return y.tileSize=this.tileSize,y.latRange=this.latRange,y.width=this.width,y.height=this.height,y._center=this._center,y.zoom=this.zoom,y.angle=this.angle,y._fov=this._fov,y._pitch=this._pitch,y._unmodified=this._unmodified,y._edgeInsets=this._edgeInsets.clone(),y._calcMatrices(),y},Sa.minZoom.get=function(){return this._minZoom},Sa.minZoom.set=function(y){this._minZoom!==y&&(this._minZoom=y,this.zoom=Math.max(this.zoom,y))},Sa.maxZoom.get=function(){return this._maxZoom},Sa.maxZoom.set=function(y){this._maxZoom!==y&&(this._maxZoom=y,this.zoom=Math.min(this.zoom,y))},Sa.minPitch.get=function(){return this._minPitch},Sa.minPitch.set=function(y){this._minPitch!==y&&(this._minPitch=y,this.pitch=Math.max(this.pitch,y))},Sa.maxPitch.get=function(){return this._maxPitch},Sa.maxPitch.set=function(y){this._maxPitch!==y&&(this._maxPitch=y,this.pitch=Math.min(this.pitch,y))},Sa.renderWorldCopies.get=function(){return this._renderWorldCopies},Sa.renderWorldCopies.set=function(y){y===void 0?y=!0:y===null&&(y=!1),this._renderWorldCopies=y},Sa.worldSize.get=function(){return this.tileSize*this.scale},Sa.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Sa.size.get=function(){return new o.Point(this.width,this.height)},Sa.bearing.get=function(){return-this.angle/Math.PI*180},Sa.bearing.set=function(y){var b=-o.wrap(y,-180,180)*Math.PI/180;this.angle!==b&&(this._unmodified=!1,this.angle=b,this._calcMatrices(),this.rotationMatrix=o.create$2(),o.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Sa.pitch.get=function(){return this._pitch/Math.PI*180},Sa.pitch.set=function(y){var b=o.clamp(y,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==b&&(this._unmodified=!1,this._pitch=b,this._calcMatrices())},Sa.fov.get=function(){return this._fov/Math.PI*180},Sa.fov.set=function(y){y=Math.max(.01,Math.min(60,y)),this._fov!==y&&(this._unmodified=!1,this._fov=y/180*Math.PI,this._calcMatrices())},Sa.zoom.get=function(){return this._zoom},Sa.zoom.set=function(y){var b=Math.min(Math.max(y,this.minZoom),this.maxZoom);this._zoom!==b&&(this._unmodified=!1,this._zoom=b,this.scale=this.zoomScale(b),this.tileZoom=Math.floor(b),this.zoomFraction=b-this.tileZoom,this._constrain(),this._calcMatrices())},Sa.center.get=function(){return this._center},Sa.center.set=function(y){y.lat===this._center.lat&&y.lng===this._center.lng||(this._unmodified=!1,this._center=y,this._constrain(),this._calcMatrices())},Sa.padding.get=function(){return this._edgeInsets.toJSON()},Sa.padding.set=function(y){this._edgeInsets.equals(y)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,y,1),this._calcMatrices())},Sa.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Si.prototype.isPaddingEqual=function(y){return this._edgeInsets.equals(y)},Si.prototype.interpolatePadding=function(y,b,_){this._unmodified=!1,this._edgeInsets.interpolate(y,b,_),this._constrain(),this._calcMatrices()},Si.prototype.coveringZoomLevel=function(y){var b=(y.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/y.tileSize));return Math.max(0,b)},Si.prototype.getVisibleUnwrappedCoordinates=function(y){var b=[new o.UnwrappedTileID(0,y)];if(this._renderWorldCopies)for(var _=this.pointCoordinate(new o.Point(0,0)),C=this.pointCoordinate(new o.Point(this.width,0)),O=this.pointCoordinate(new o.Point(this.width,this.height)),F=this.pointCoordinate(new o.Point(0,this.height)),B=Math.floor(Math.min(_.x,C.x,O.x,F.x)),H=Math.floor(Math.max(_.x,C.x,O.x,F.x)),Y=B-1;Y<=H+1;Y++)Y!==0&&b.push(new o.UnwrappedTileID(Y,y));return b},Si.prototype.coveringTiles=function(y){var b=this.coveringZoomLevel(y),_=b;if(y.minzoom!==void 0&&b<y.minzoom)return[];y.maxzoom!==void 0&&b>y.maxzoom&&(b=y.maxzoom);var C=o.MercatorCoordinate.fromLngLat(this.center),O=Math.pow(2,b),F=[O*C.x,O*C.y,0],B=jg.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,b),H=y.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(H=b);var Y=function(or){return{aabb:new Ec([or*O,0,0],[(or+1)*O,O,0]),zoom:0,x:0,y:0,wrap:or,fullyVisible:!1}},rt=[],ct=[],dt=b,pt=y.reparseOverscaled?_:b;if(this._renderWorldCopies)for(var Pt=1;Pt<=3;Pt++)rt.push(Y(-Pt)),rt.push(Y(Pt));for(rt.push(Y(0));rt.length>0;){var Mt=rt.pop(),Ht=Mt.x,St=Mt.y,Ut=Mt.fullyVisible;if(!Ut){var Kt=Mt.aabb.intersects(B);if(Kt===0)continue;Ut=Kt===2}var le=Mt.aabb.distanceX(F),we=Mt.aabb.distanceY(F),ve=Math.max(Math.abs(le),Math.abs(we));if(Mt.zoom===dt||ve>3+(1<<dt-Mt.zoom)-2&&Mt.zoom>=H)ct.push({tileID:new o.OverscaledTileID(Mt.zoom===dt?pt:Mt.zoom,Mt.wrap,Mt.zoom,Ht,St),distanceSq:o.sqrLen([F[0]-.5-Ht,F[1]-.5-St])});else for(var Me=0;Me<4;Me++){var Ge=(Ht<<1)+Me%2,hr=(St<<1)+(Me>>1);rt.push({aabb:Mt.aabb.quadrant(Me),zoom:Mt.zoom+1,x:Ge,y:hr,wrap:Mt.wrap,fullyVisible:Ut})}}return ct.sort(function(or,Ir){return or.distanceSq-Ir.distanceSq}).map(function(or){return or.tileID})},Si.prototype.resize=function(y,b){this.width=y,this.height=b,this.pixelsToGLUnits=[2/y,-2/b],this._constrain(),this._calcMatrices()},Sa.unmodified.get=function(){return this._unmodified},Si.prototype.zoomScale=function(y){return Math.pow(2,y)},Si.prototype.scaleZoom=function(y){return Math.log(y)/Math.LN2},Si.prototype.project=function(y){var b=o.clamp(y.lat,-this.maxValidLatitude,this.maxValidLatitude);return new o.Point(o.mercatorXfromLng(y.lng)*this.worldSize,o.mercatorYfromLat(b)*this.worldSize)},Si.prototype.unproject=function(y){return new o.MercatorCoordinate(y.x/this.worldSize,y.y/this.worldSize).toLngLat()},Sa.point.get=function(){return this.project(this.center)},Si.prototype.setLocationAtPoint=function(y,b){var _=this.pointCoordinate(b),C=this.pointCoordinate(this.centerPoint),O=this.locationCoordinate(y),F=new o.MercatorCoordinate(O.x-(_.x-C.x),O.y-(_.y-C.y));this.center=this.coordinateLocation(F),this._renderWorldCopies&&(this.center=this.center.wrap())},Si.prototype.locationPoint=function(y){return this.coordinatePoint(this.locationCoordinate(y))},Si.prototype.pointLocation=function(y){return this.coordinateLocation(this.pointCoordinate(y))},Si.prototype.locationCoordinate=function(y){return o.MercatorCoordinate.fromLngLat(y)},Si.prototype.coordinateLocation=function(y){return y.toLngLat()},Si.prototype.pointCoordinate=function(y){var b=[y.x,y.y,0,1],_=[y.x,y.y,1,1];o.transformMat4(b,b,this.pixelMatrixInverse),o.transformMat4(_,_,this.pixelMatrixInverse);var C=b[3],O=_[3],F=b[1]/C,B=_[1]/O,H=b[2]/C,Y=_[2]/O,rt=H===Y?0:(0-H)/(Y-H);return new o.MercatorCoordinate(o.number(b[0]/C,_[0]/O,rt)/this.worldSize,o.number(F,B,rt)/this.worldSize)},Si.prototype.coordinatePoint=function(y){var b=[y.x*this.worldSize,y.y*this.worldSize,0,1];return o.transformMat4(b,b,this.pixelMatrix),new o.Point(b[0]/b[3],b[1]/b[3])},Si.prototype.getBounds=function(){return new o.LngLatBounds().extend(this.pointLocation(new o.Point(0,0))).extend(this.pointLocation(new o.Point(this.width,0))).extend(this.pointLocation(new o.Point(this.width,this.height))).extend(this.pointLocation(new o.Point(0,this.height)))},Si.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new o.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Si.prototype.setMaxBounds=function(y){y?(this.lngRange=[y.getWest(),y.getEast()],this.latRange=[y.getSouth(),y.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Si.prototype.calculatePosMatrix=function(y,b){b===void 0&&(b=!1);var _=y.key,C=b?this._alignedPosMatrixCache:this._posMatrixCache;if(C[_])return C[_];var O=y.canonical,F=this.worldSize/this.zoomScale(O.z),B=O.x+Math.pow(2,O.z)*y.wrap,H=o.identity(new Float64Array(16));return o.translate(H,H,[B*F,O.y*F,0]),o.scale(H,H,[F/o.EXTENT,F/o.EXTENT,1]),o.multiply(H,b?this.alignedProjMatrix:this.projMatrix,H),C[_]=new Float32Array(H),C[_]},Si.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Si.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var y,b,_,C,O=-90,F=90,B=-180,H=180,Y=this.size,rt=this._unmodified;if(this.latRange){var ct=this.latRange;O=o.mercatorYfromLat(ct[1])*this.worldSize,y=(F=o.mercatorYfromLat(ct[0])*this.worldSize)-O<Y.y?Y.y/(F-O):0}if(this.lngRange){var dt=this.lngRange;B=o.mercatorXfromLng(dt[0])*this.worldSize,b=(H=o.mercatorXfromLng(dt[1])*this.worldSize)-B<Y.x?Y.x/(H-B):0}var pt=this.point,Pt=Math.max(b||0,y||0);if(Pt)return this.center=this.unproject(new o.Point(b?(H+B)/2:pt.x,y?(F+O)/2:pt.y)),this.zoom+=this.scaleZoom(Pt),this._unmodified=rt,void(this._constraining=!1);if(this.latRange){var Mt=pt.y,Ht=Y.y/2;Mt-Ht<O&&(C=O+Ht),Mt+Ht>F&&(C=F-Ht)}if(this.lngRange){var St=pt.x,Ut=Y.x/2;St-Ut<B&&(_=B+Ut),St+Ut>H&&(_=H-Ut)}_===void 0&&C===void 0||(this.center=this.unproject(new o.Point(_!==void 0?_:pt.x,C!==void 0?C:pt.y))),this._unmodified=rt,this._constraining=!1}},Si.prototype._calcMatrices=function(){if(this.height){var y=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var b=Math.PI/2+this._pitch,_=this._fov*(.5+y.y/this.height),C=Math.sin(_)*this.cameraToCenterDistance/Math.sin(o.clamp(Math.PI-b-_,.01,Math.PI-.01)),O=this.point,F=O.x,B=O.y,H=1.01*(Math.cos(Math.PI/2-this._pitch)*C+this.cameraToCenterDistance),Y=this.height/50,rt=new Float64Array(16);o.perspective(rt,this._fov,this.width/this.height,Y,H),rt[8]=2*-y.x/this.width,rt[9]=2*y.y/this.height,o.scale(rt,rt,[1,-1,1]),o.translate(rt,rt,[0,0,-this.cameraToCenterDistance]),o.rotateX(rt,rt,this._pitch),o.rotateZ(rt,rt,this.angle),o.translate(rt,rt,[-F,-B,0]),this.mercatorMatrix=o.scale([],rt,[this.worldSize,this.worldSize,this.worldSize]),o.scale(rt,rt,[1,1,o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=rt,this.invProjMatrix=o.invert([],this.projMatrix);var ct=this.width%2/2,dt=this.height%2/2,pt=Math.cos(this.angle),Pt=Math.sin(this.angle),Mt=F-Math.round(F)+pt*ct+Pt*dt,Ht=B-Math.round(B)+pt*dt+Pt*ct,St=new Float64Array(rt);if(o.translate(St,St,[Mt>.5?Mt-1:Mt,Ht>.5?Ht-1:Ht,0]),this.alignedProjMatrix=St,rt=o.create(),o.scale(rt,rt,[this.width/2,-this.height/2,1]),o.translate(rt,rt,[1,-1,0]),this.labelPlaneMatrix=rt,rt=o.create(),o.scale(rt,rt,[1,-1,1]),o.translate(rt,rt,[-1,-1,0]),o.scale(rt,rt,[2/this.width,2/this.height,1]),this.glCoordMatrix=rt,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(rt=o.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=rt,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Si.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var y=this.pointCoordinate(new o.Point(0,0)),b=[y.x*this.worldSize,y.y*this.worldSize,0,1];return o.transformMat4(b,b,this.pixelMatrix)[3]/this.cameraToCenterDistance},Si.prototype.getCameraPoint=function(){var y=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.Point(0,y))},Si.prototype.getCameraQueryGeometry=function(y){var b=this.getCameraPoint();if(y.length===1)return[y[0],b];for(var _=b.x,C=b.y,O=b.x,F=b.y,B=0,H=y;B<H.length;B+=1){var Y=H[B];_=Math.min(_,Y.x),C=Math.min(C,Y.y),O=Math.max(O,Y.x),F=Math.max(F,Y.y)}return[new o.Point(_,C),new o.Point(O,C),new o.Point(O,F),new o.Point(_,F),new o.Point(_,C)]},Object.defineProperties(Si.prototype,Sa);var tu=function(y){var b,_,C,O;this._hashName=y&&encodeURIComponent(y),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(b=this._updateHashUnthrottled.bind(this),_=!1,C=null,O=function(){C=null,_&&(b(),C=setTimeout(O,300),_=!1)},function(){return _=!0,C||O(),C})};tu.prototype.addTo=function(y){return this._map=y,o.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},tu.prototype.remove=function(){return o.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},tu.prototype.getHashString=function(y){var b=this._map.getCenter(),_=Math.round(100*this._map.getZoom())/100,C=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),O=Math.pow(10,C),F=Math.round(b.lng*O)/O,B=Math.round(b.lat*O)/O,H=this._map.getBearing(),Y=this._map.getPitch(),rt="";if(rt+=y?"/"+F+"/"+B+"/"+_:_+"/"+B+"/"+F,(H||Y)&&(rt+="/"+Math.round(10*H)/10),Y&&(rt+="/"+Math.round(Y)),this._hashName){var ct=this._hashName,dt=!1,pt=o.window.location.hash.slice(1).split("&").map(function(Pt){var Mt=Pt.split("=")[0];return Mt===ct?(dt=!0,Mt+"="+rt):Pt}).filter(function(Pt){return Pt});return dt||pt.push(ct+"="+rt),"#"+pt.join("&")}return"#"+rt},tu.prototype._getCurrentHash=function(){var y,b=this,_=o.window.location.hash.replace("#","");return this._hashName?(_.split("&").map(function(C){return C.split("=")}).forEach(function(C){C[0]===b._hashName&&(y=C)}),(y&&y[1]||"").split("/")):_.split("/")},tu.prototype._onHashChange=function(){var y=this._getCurrentHash();if(y.length>=3&&!y.some(function(_){return isNaN(_)})){var b=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(y[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+y[2],+y[1]],zoom:+y[0],bearing:b,pitch:+(y[4]||0)}),!0}return!1},tu.prototype._updateHashUnthrottled=function(){var y=o.window.location.href.replace(/(#.+)?$/,this.getHashString());try{o.window.history.replaceState(o.window.history.state,null,y)}catch{}};var Tv={linearity:.3,easing:o.bezier(0,0,.3,1)},fp=o.extend({deceleration:2500,maxSpeed:1400},Tv),Av=o.extend({deceleration:20,maxSpeed:1400},Tv),a1=o.extend({deceleration:1e3,maxSpeed:360},Tv),Yg=o.extend({deceleration:1e3,maxSpeed:90},Tv),Mv=function(y){this._map=y,this.clear()};function xf(y,b){(!y.duration||y.duration<b.duration)&&(y.duration=b.duration,y.easing=b.easing)}function Wo(y,b,_){var C=_.maxSpeed,O=_.linearity,F=_.deceleration,B=o.clamp(y*O/(b/1e3),-C,C),H=Math.abs(B)/(F*O);return{easing:_.easing,duration:1e3*H,amount:B*(H/2)}}Mv.prototype.clear=function(){this._inertiaBuffer=[]},Mv.prototype.record=function(y){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.browser.now(),settings:y})},Mv.prototype._drainInertiaBuffer=function(){for(var y=this._inertiaBuffer,b=o.browser.now();y.length>0&&b-y[0].time>160;)y.shift()},Mv.prototype._onMoveEnd=function(y){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var b={zoom:0,bearing:0,pitch:0,pan:new o.Point(0,0),pinchAround:void 0,around:void 0},_=0,C=this._inertiaBuffer;_<C.length;_+=1){var O=C[_].settings;b.zoom+=O.zoomDelta||0,b.bearing+=O.bearingDelta||0,b.pitch+=O.pitchDelta||0,O.panDelta&&b.pan._add(O.panDelta),O.around&&(b.around=O.around),O.pinchAround&&(b.pinchAround=O.pinchAround)}var F=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,B={};if(b.pan.mag()){var H=Wo(b.pan.mag(),F,o.extend({},fp,y||{}));B.offset=b.pan.mult(H.amount/b.pan.mag()),B.center=this._map.transform.center,xf(B,H)}if(b.zoom){var Y=Wo(b.zoom,F,Av);B.zoom=this._map.transform.zoom+Y.amount,xf(B,Y)}if(b.bearing){var rt=Wo(b.bearing,F,a1);B.bearing=this._map.transform.bearing+o.clamp(rt.amount,-179,179),xf(B,rt)}if(b.pitch){var ct=Wo(b.pitch,F,Yg);B.pitch=this._map.transform.pitch+ct.amount,xf(B,ct)}if(B.zoom||B.bearing){var dt=b.pinchAround===void 0?b.around:b.pinchAround;B.around=dt?this._map.unproject(dt):this._map.getCenter()}return this.clear(),o.extend(B,{noMoveStart:!0})}};var Ga=function(y){function b(C,O,F,B){B===void 0&&(B={});var H=l.mousePos(O.getCanvasContainer(),F),Y=O.unproject(H);y.call(this,C,o.extend({point:H,lngLat:Y,originalEvent:F},B)),this._defaultPrevented=!1,this.target=O}y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b;var _={defaultPrevented:{configurable:!0}};return b.prototype.preventDefault=function(){this._defaultPrevented=!0},_.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(b.prototype,_),b}(o.Event),dp=function(y){function b(C,O,F){var B=C==="touchend"?F.changedTouches:F.touches,H=l.touchPos(O.getCanvasContainer(),B),Y=H.map(function(dt){return O.unproject(dt)}),rt=H.reduce(function(dt,pt,Pt,Mt){return dt.add(pt.div(Mt.length))},new o.Point(0,0)),ct=O.unproject(rt);y.call(this,C,{points:H,point:rt,lngLats:Y,lngLat:ct,originalEvent:F}),this._defaultPrevented=!1}y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b;var _={defaultPrevented:{configurable:!0}};return b.prototype.preventDefault=function(){this._defaultPrevented=!0},_.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(b.prototype,_),b}(o.Event),q0=function(y){function b(C,O,F){y.call(this,C,{originalEvent:F}),this._defaultPrevented=!1}y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b;var _={defaultPrevented:{configurable:!0}};return b.prototype.preventDefault=function(){this._defaultPrevented=!0},_.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(b.prototype,_),b}(o.Event),mo=function(y,b){this._map=y,this._clickTolerance=b.clickTolerance};mo.prototype.reset=function(){delete this._mousedownPos},mo.prototype.wheel=function(y){return this._firePreventable(new q0(y.type,this._map,y))},mo.prototype.mousedown=function(y,b){return this._mousedownPos=b,this._firePreventable(new Ga(y.type,this._map,y))},mo.prototype.mouseup=function(y){this._map.fire(new Ga(y.type,this._map,y))},mo.prototype.click=function(y,b){this._mousedownPos&&this._mousedownPos.dist(b)>=this._clickTolerance||this._map.fire(new Ga(y.type,this._map,y))},mo.prototype.dblclick=function(y){return this._firePreventable(new Ga(y.type,this._map,y))},mo.prototype.mouseover=function(y){this._map.fire(new Ga(y.type,this._map,y))},mo.prototype.mouseout=function(y){this._map.fire(new Ga(y.type,this._map,y))},mo.prototype.touchstart=function(y){return this._firePreventable(new dp(y.type,this._map,y))},mo.prototype.touchmove=function(y){this._map.fire(new dp(y.type,this._map,y))},mo.prototype.touchend=function(y){this._map.fire(new dp(y.type,this._map,y))},mo.prototype.touchcancel=function(y){this._map.fire(new dp(y.type,this._map,y))},mo.prototype._firePreventable=function(y){if(this._map.fire(y),y.defaultPrevented)return{}},mo.prototype.isEnabled=function(){return!0},mo.prototype.isActive=function(){return!1},mo.prototype.enable=function(){},mo.prototype.disable=function(){};var Xr=function(y){this._map=y};Xr.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Xr.prototype.mousemove=function(y){this._map.fire(new Ga(y.type,this._map,y))},Xr.prototype.mousedown=function(){this._delayContextMenu=!0},Xr.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ga("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Xr.prototype.contextmenu=function(y){this._delayContextMenu?this._contextMenuEvent=y:this._map.fire(new Ga(y.type,this._map,y)),this._map.listens("contextmenu")&&y.preventDefault()},Xr.prototype.isEnabled=function(){return!0},Xr.prototype.isActive=function(){return!1},Xr.prototype.enable=function(){},Xr.prototype.disable=function(){};var ll=function(y,b){this._map=y,this._el=y.getCanvasContainer(),this._container=y.getContainer(),this._clickTolerance=b.clickTolerance||1};function Rv(y,b){for(var _={},C=0;C<y.length;C++)_[y[C].identifier]=b[C];return _}ll.prototype.isEnabled=function(){return!!this._enabled},ll.prototype.isActive=function(){return!!this._active},ll.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},ll.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ll.prototype.mousedown=function(y,b){this.isEnabled()&&y.shiftKey&&y.button===0&&(l.disableDrag(),this._startPos=this._lastPos=b,this._active=!0)},ll.prototype.mousemoveWindow=function(y,b){if(this._active){var _=b;if(!(this._lastPos.equals(_)||!this._box&&_.dist(this._startPos)<this._clickTolerance)){var C=this._startPos;this._lastPos=_,this._box||(this._box=l.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",y));var O=Math.min(C.x,_.x),F=Math.max(C.x,_.x),B=Math.min(C.y,_.y),H=Math.max(C.y,_.y);l.setTransform(this._box,"translate("+O+"px,"+B+"px)"),this._box.style.width=F-O+"px",this._box.style.height=H-B+"px"}}},ll.prototype.mouseupWindow=function(y,b){var _=this;if(this._active&&y.button===0){var C=this._startPos,O=b;if(this.reset(),l.suppressClick(),C.x!==O.x||C.y!==O.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:y})),{cameraAnimation:function(F){return F.fitScreenCoordinates(C,O,_._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",y)}},ll.prototype.keydown=function(y){this._active&&y.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",y))},ll.prototype.blur=function(){this.reset()},ll.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(l.remove(this._box),this._box=null),l.enableDrag(),delete this._startPos,delete this._lastPos},ll.prototype._fireEvent=function(y,b){return this._map.fire(new o.Event(y,{originalEvent:b}))};var pp=function(y){this.reset(),this.numTouches=y.numTouches};pp.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},pp.prototype.touchstart=function(y,b,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=y.timeStamp),_.length===this.numTouches&&(this.centroid=function(C){for(var O=new o.Point(0,0),F=0,B=C;F<B.length;F+=1)O._add(B[F]);return O.div(C.length)}(b),this.touches=Rv(_,b)))},pp.prototype.touchmove=function(y,b,_){if(!this.aborted&&this.centroid){var C=Rv(_,b);for(var O in this.touches){var F=C[O];(!F||F.dist(this.touches[O])>30)&&(this.aborted=!0)}}},pp.prototype.touchend=function(y,b,_){if((!this.centroid||y.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){var C=!this.aborted&&this.centroid;if(this.reset(),C)return C}};var Ys=function(y){this.singleTap=new pp(y),this.numTaps=y.numTaps,this.reset()};Ys.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Ys.prototype.touchstart=function(y,b,_){this.singleTap.touchstart(y,b,_)},Ys.prototype.touchmove=function(y,b,_){this.singleTap.touchmove(y,b,_)},Ys.prototype.touchend=function(y,b,_){var C=this.singleTap.touchend(y,b,_);if(C){var O=y.timeStamp-this.lastTime<500,F=!this.lastTap||this.lastTap.dist(C)<30;if(O&&F||this.reset(),this.count++,this.lastTime=y.timeStamp,this.lastTap=C,this.count===this.numTaps)return this.reset(),C}};var da=function(){this._zoomIn=new Ys({numTouches:1,numTaps:2}),this._zoomOut=new Ys({numTouches:2,numTaps:1}),this.reset()};da.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},da.prototype.touchstart=function(y,b,_){this._zoomIn.touchstart(y,b,_),this._zoomOut.touchstart(y,b,_)},da.prototype.touchmove=function(y,b,_){this._zoomIn.touchmove(y,b,_),this._zoomOut.touchmove(y,b,_)},da.prototype.touchend=function(y,b,_){var C=this,O=this._zoomIn.touchend(y,b,_),F=this._zoomOut.touchend(y,b,_);return O?(this._active=!0,y.preventDefault(),setTimeout(function(){return C.reset()},0),{cameraAnimation:function(B){return B.easeTo({duration:300,zoom:B.getZoom()+1,around:B.unproject(O)},{originalEvent:y})}}):F?(this._active=!0,y.preventDefault(),setTimeout(function(){return C.reset()},0),{cameraAnimation:function(B){return B.easeTo({duration:300,zoom:B.getZoom()-1,around:B.unproject(F)},{originalEvent:y})}}):void 0},da.prototype.touchcancel=function(){this.reset()},da.prototype.enable=function(){this._enabled=!0},da.prototype.disable=function(){this._enabled=!1,this.reset()},da.prototype.isEnabled=function(){return this._enabled},da.prototype.isActive=function(){return this._active};var Zg={0:1,2:2},xr=function(y){this.reset(),this._clickTolerance=y.clickTolerance||1};xr.prototype.blur=function(){this.reset()},xr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},xr.prototype._correctButton=function(y,b){return!1},xr.prototype._move=function(y,b){return{}},xr.prototype.mousedown=function(y,b){if(!this._lastPoint){var _=l.mouseButton(y);this._correctButton(y,_)&&(this._lastPoint=b,this._eventButton=_)}},xr.prototype.mousemoveWindow=function(y,b){var _=this._lastPoint;if(_){if(y.preventDefault(),function(C,O){var F=Zg[O];return C.buttons===void 0||(C.buttons&F)!==F}(y,this._eventButton))this.reset();else if(this._moved||!(b.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=b,this._move(_,b)}},xr.prototype.mouseupWindow=function(y){this._lastPoint&&l.mouseButton(y)===this._eventButton&&(this._moved&&l.suppressClick(),this.reset())},xr.prototype.enable=function(){this._enabled=!0},xr.prototype.disable=function(){this._enabled=!1,this.reset()},xr.prototype.isEnabled=function(){return this._enabled},xr.prototype.isActive=function(){return this._active};var Ch=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.mousedown=function(_,C){y.prototype.mousedown.call(this,_,C),this._lastPoint&&(this._active=!0)},b.prototype._correctButton=function(_,C){return C===0&&!_.ctrlKey},b.prototype._move=function(_,C){return{around:C,panDelta:C.sub(_)}},b}(xr),Iv=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype._correctButton=function(_,C){return C===0&&_.ctrlKey||C===2},b.prototype._move=function(_,C){var O=.8*(C.x-_.x);if(O)return this._active=!0,{bearingDelta:O}},b.prototype.contextmenu=function(_){_.preventDefault()},b}(xr),qg=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype._correctButton=function(_,C){return C===0&&_.ctrlKey||C===2},b.prototype._move=function(_,C){var O=-.5*(C.y-_.y);if(O)return this._active=!0,{pitchDelta:O}},b.prototype.contextmenu=function(_){_.preventDefault()},b}(xr),Cu=function(y){this._minTouches=1,this._clickTolerance=y.clickTolerance||1,this.reset()};Cu.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new o.Point(0,0)},Cu.prototype.touchstart=function(y,b,_){return this._calculateTransform(y,b,_)},Cu.prototype.touchmove=function(y,b,_){if(this._active&&!(_.length<this._minTouches))return y.preventDefault(),this._calculateTransform(y,b,_)},Cu.prototype.touchend=function(y,b,_){this._calculateTransform(y,b,_),this._active&&_.length<this._minTouches&&this.reset()},Cu.prototype.touchcancel=function(){this.reset()},Cu.prototype._calculateTransform=function(y,b,_){_.length>0&&(this._active=!0);var C=Rv(_,b),O=new o.Point(0,0),F=new o.Point(0,0),B=0;for(var H in C){var Y=C[H],rt=this._touches[H];rt&&(O._add(Y),F._add(Y.sub(rt)),B++,C[H]=Y)}if(this._touches=C,!(B<this._minTouches)&&F.mag()){var ct=F.div(B);if(this._sum._add(ct),!(this._sum.mag()<this._clickTolerance))return{around:O.div(B),panDelta:ct}}},Cu.prototype.enable=function(){this._enabled=!0},Cu.prototype.disable=function(){this._enabled=!1,this.reset()},Cu.prototype.isEnabled=function(){return this._enabled},Cu.prototype.isActive=function(){return this._active};var Ll=function(){this.reset()};function Kg(y,b,_){for(var C=0;C<y.length;C++)if(y[C].identifier===_)return b[C]}function Qg(y,b){return Math.log(y/b)/Math.LN2}Ll.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Ll.prototype._start=function(y){},Ll.prototype._move=function(y,b,_){return{}},Ll.prototype.touchstart=function(y,b,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([b[0],b[1]]))},Ll.prototype.touchmove=function(y,b,_){if(this._firstTwoTouches){y.preventDefault();var C=this._firstTwoTouches,O=C[1],F=Kg(_,b,C[0]),B=Kg(_,b,O);if(F&&B){var H=this._aroundCenter?null:F.add(B).div(2);return this._move([F,B],H,y)}}},Ll.prototype.touchend=function(y,b,_){if(this._firstTwoTouches){var C=this._firstTwoTouches,O=C[1],F=Kg(_,b,C[0]),B=Kg(_,b,O);F&&B||(this._active&&l.suppressClick(),this.reset())}},Ll.prototype.touchcancel=function(){this.reset()},Ll.prototype.enable=function(y){this._enabled=!0,this._aroundCenter=!!y&&y.around==="center"},Ll.prototype.disable=function(){this._enabled=!1,this.reset()},Ll.prototype.isEnabled=function(){return this._enabled},Ll.prototype.isActive=function(){return this._active};var Zs=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.reset=function(){y.prototype.reset.call(this),delete this._distance,delete this._startDistance},b.prototype._start=function(_){this._startDistance=this._distance=_[0].dist(_[1])},b.prototype._move=function(_,C){var O=this._distance;if(this._distance=_[0].dist(_[1]),this._active||!(Math.abs(Qg(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Qg(this._distance,O),pinchAround:C}},b}(Ll);function wc(y,b){return 180*y.angleWith(b)/Math.PI}var o1=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.reset=function(){y.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},b.prototype._start=function(_){this._startVector=this._vector=_[0].sub(_[1]),this._minDiameter=_[0].dist(_[1])},b.prototype._move=function(_,C){var O=this._vector;if(this._vector=_[0].sub(_[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:wc(this._vector,O),pinchAround:C}},b.prototype._isBelowThreshold=function(_){this._minDiameter=Math.min(this._minDiameter,_.mag());var C=25/(Math.PI*this._minDiameter)*360,O=wc(_,this._startVector);return Math.abs(O)<C},b}(Ll);function vp(y){return Math.abs(y.y)>Math.abs(y.x)}var Jg=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.reset=function(){y.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},b.prototype._start=function(_){this._lastPoints=_,vp(_[0].sub(_[1]))&&(this._valid=!1)},b.prototype._move=function(_,C,O){var F=_[0].sub(this._lastPoints[0]),B=_[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(F,B,O.timeStamp),this._valid)return this._lastPoints=_,this._active=!0,{pitchDelta:(F.y+B.y)/2*-.5}},b.prototype.gestureBeginsVertically=function(_,C,O){if(this._valid!==void 0)return this._valid;var F=_.mag()>=2,B=C.mag()>=2;if(F||B){if(!F||!B)return this._firstMove===void 0&&(this._firstMove=O),O-this._firstMove<100&&void 0;var H=_.y>0==C.y>0;return vp(_)&&vp(C)&&H}},b}(Ll),K0={panStep:100,bearingStep:15,pitchStep:10},Ol=function(){var y=K0;this._panStep=y.panStep,this._bearingStep=y.bearingStep,this._pitchStep=y.pitchStep,this._rotationDisabled=!1};function eu(y){return y*(2-y)}Ol.prototype.blur=function(){this.reset()},Ol.prototype.reset=function(){this._active=!1},Ol.prototype.keydown=function(y){var b=this;if(!(y.altKey||y.ctrlKey||y.metaKey)){var _=0,C=0,O=0,F=0,B=0;switch(y.keyCode){case 61:case 107:case 171:case 187:_=1;break;case 189:case 109:case 173:_=-1;break;case 37:y.shiftKey?C=-1:(y.preventDefault(),F=-1);break;case 39:y.shiftKey?C=1:(y.preventDefault(),F=1);break;case 38:y.shiftKey?O=1:(y.preventDefault(),B=-1);break;case 40:y.shiftKey?O=-1:(y.preventDefault(),B=1);break;default:return}return this._rotationDisabled&&(C=0,O=0),{cameraAnimation:function(H){var Y=H.getZoom();H.easeTo({duration:300,easeId:"keyboardHandler",easing:eu,zoom:_?Math.round(Y)+_*(y.shiftKey?2:1):Y,bearing:H.getBearing()+C*b._bearingStep,pitch:H.getPitch()+O*b._pitchStep,offset:[-F*b._panStep,-B*b._panStep],center:H.getCenter()},{originalEvent:y})}}}},Ol.prototype.enable=function(){this._enabled=!0},Ol.prototype.disable=function(){this._enabled=!1,this.reset()},Ol.prototype.isEnabled=function(){return this._enabled},Ol.prototype.isActive=function(){return this._active},Ol.prototype.disableRotation=function(){this._rotationDisabled=!0},Ol.prototype.enableRotation=function(){this._rotationDisabled=!1};var Wn=function(y,b){this._map=y,this._el=y.getCanvasContainer(),this._handler=b,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,o.bindAll(["_onTimeout"],this)};Wn.prototype.setZoomRate=function(y){this._defaultZoomRate=y},Wn.prototype.setWheelZoomRate=function(y){this._wheelZoomRate=y},Wn.prototype.isEnabled=function(){return!!this._enabled},Wn.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Wn.prototype.isZooming=function(){return!!this._zooming},Wn.prototype.enable=function(y){this.isEnabled()||(this._enabled=!0,this._aroundCenter=y&&y.around==="center")},Wn.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Wn.prototype.wheel=function(y){if(this.isEnabled()){var b=y.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*y.deltaY:y.deltaY,_=o.browser.now(),C=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,b!==0&&b%4.000244140625==0?this._type="wheel":b!==0&&Math.abs(b)<4?this._type="trackpad":C>400?(this._type=null,this._lastValue=b,this._timeout=setTimeout(this._onTimeout,40,y)):this._type||(this._type=Math.abs(C*b)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,b+=this._lastValue)),y.shiftKey&&b&&(b/=4),this._type&&(this._lastWheelEvent=y,this._delta-=b,this._active||this._start(y)),y.preventDefault()}},Wn.prototype._onTimeout=function(y){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(y)},Wn.prototype._start=function(y){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var b=l.mousePos(this._el,y);this._around=o.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(b)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Wn.prototype.renderFrame=function(){var y=this;if(this._frameId&&(this._frameId=null,this.isActive())){var b=this._map.transform;if(this._delta!==0){var _=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,C=2/(1+Math.exp(-Math.abs(this._delta*_)));this._delta<0&&C!==0&&(C=1/C);var O=typeof this._targetZoom=="number"?b.zoomScale(this._targetZoom):b.scale;this._targetZoom=Math.min(b.maxZoom,Math.max(b.minZoom,b.scaleZoom(O*C))),this._type==="wheel"&&(this._startZoom=b.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var F,B=typeof this._targetZoom=="number"?this._targetZoom:b.zoom,H=this._startZoom,Y=this._easing,rt=!1;if(this._type==="wheel"&&H&&Y){var ct=Math.min((o.browser.now()-this._lastWheelEventTime)/200,1),dt=Y(ct);F=o.number(H,B,dt),ct<1?this._frameId||(this._frameId=!0):rt=!0}else F=B,rt=!0;return this._active=!0,rt&&(this._active=!1,this._finishTimeout=setTimeout(function(){y._zooming=!1,y._handler._triggerRenderFrame(),delete y._targetZoom,delete y._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!rt,zoomDelta:F-b.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Wn.prototype._smoothOutEasing=function(y){var b=o.ease;if(this._prevEase){var _=this._prevEase,C=(o.browser.now()-_.start)/_.duration,O=_.easing(C+.01)-_.easing(C),F=.27/Math.sqrt(O*O+1e-4)*.01,B=Math.sqrt(.0729-F*F);b=o.bezier(F,B,.25,1)}return this._prevEase={start:o.browser.now(),duration:y,easing:b},b},Wn.prototype.blur=function(){this.reset()},Wn.prototype.reset=function(){this._active=!1};var ru=function(y,b){this._clickZoom=y,this._tapZoom=b};ru.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},ru.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},ru.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},ru.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var nu=function(){this.reset()};nu.prototype.reset=function(){this._active=!1},nu.prototype.blur=function(){this.reset()},nu.prototype.dblclick=function(y,b){return y.preventDefault(),{cameraAnimation:function(_){_.easeTo({duration:300,zoom:_.getZoom()+(y.shiftKey?-1:1),around:_.unproject(b)},{originalEvent:y})}}},nu.prototype.enable=function(){this._enabled=!0},nu.prototype.disable=function(){this._enabled=!1,this.reset()},nu.prototype.isEnabled=function(){return this._enabled},nu.prototype.isActive=function(){return this._active};var fs=function(){this._tap=new Ys({numTouches:1,numTaps:1}),this.reset()};fs.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},fs.prototype.touchstart=function(y,b,_){this._swipePoint||(this._tapTime&&y.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=b[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(y,b,_))},fs.prototype.touchmove=function(y,b,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;var C=b[0],O=C.y-this._swipePoint.y;return this._swipePoint=C,y.preventDefault(),this._active=!0,{zoomDelta:O/128}}}else this._tap.touchmove(y,b,_)},fs.prototype.touchend=function(y,b,_){this._tapTime?this._swipePoint&&_.length===0&&this.reset():this._tap.touchend(y,b,_)&&(this._tapTime=y.timeStamp)},fs.prototype.touchcancel=function(){this.reset()},fs.prototype.enable=function(){this._enabled=!0},fs.prototype.disable=function(){this._enabled=!1,this.reset()},fs.prototype.isEnabled=function(){return this._enabled},fs.prototype.isActive=function(){return this._active};var bf=function(y,b,_){this._el=y,this._mousePan=b,this._touchPan=_};bf.prototype.enable=function(y){this._inertiaOptions=y||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},bf.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},bf.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},bf.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Sh=function(y,b,_){this._pitchWithRotate=y.pitchWithRotate,this._mouseRotate=b,this._mousePitch=_};Sh.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Sh.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Sh.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Sh.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Su=function(y,b,_,C){this._el=y,this._touchZoom=b,this._touchRotate=_,this._tapDragZoom=C,this._rotationDisabled=!1,this._enabled=!0};Su.prototype.enable=function(y){this._touchZoom.enable(y),this._rotationDisabled||this._touchRotate.enable(y),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Su.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Su.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Su.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Su.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Su.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var ks=function(y){return y.zoom||y.drag||y.pitch||y.rotate},gp=function(y){function b(){y.apply(this,arguments)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b}(o.Event);function sn(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}var qr=function(y,b){this._map=y,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Mv(y),this._bearingSnap=b.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(b),o.bindAll(["handleEvent","handleWindowEvent"],this);var _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[o.window,"blur",void 0]];for(var C=0,O=this._listeners;C<O.length;C+=1){var F=O[C],B=F[0];l.addEventListener(B,F[1],B===o.window.document?this.handleWindowEvent:this.handleEvent,F[2])}};qr.prototype.destroy=function(){for(var y=0,b=this._listeners;y<b.length;y+=1){var _=b[y],C=_[0];l.removeEventListener(C,_[1],C===o.window.document?this.handleWindowEvent:this.handleEvent,_[2])}},qr.prototype._addDefaultHandlers=function(y){var b=this._map,_=b.getCanvasContainer();this._add("mapEvent",new mo(b,y));var C=b.boxZoom=new ll(b,y);this._add("boxZoom",C);var O=new da,F=new nu;b.doubleClickZoom=new ru(F,O),this._add("tapZoom",O),this._add("clickZoom",F);var B=new fs;this._add("tapDragZoom",B);var H=b.touchPitch=new Jg;this._add("touchPitch",H);var Y=new Iv(y),rt=new qg(y);b.dragRotate=new Sh(y,Y,rt),this._add("mouseRotate",Y,["mousePitch"]),this._add("mousePitch",rt,["mouseRotate"]);var ct=new Ch(y),dt=new Cu(y);b.dragPan=new bf(_,ct,dt),this._add("mousePan",ct),this._add("touchPan",dt,["touchZoom","touchRotate"]);var pt=new o1,Pt=new Zs;b.touchZoomRotate=new Su(_,Pt,pt,B),this._add("touchRotate",pt,["touchPan","touchZoom"]),this._add("touchZoom",Pt,["touchPan","touchRotate"]);var Mt=b.scrollZoom=new Wn(b,this);this._add("scrollZoom",Mt,["mousePan"]);var Ht=b.keyboard=new Ol;this._add("keyboard",Ht),this._add("blockableMapEvent",new Xr(b));for(var St=0,Ut=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];St<Ut.length;St+=1){var Kt=Ut[St];y.interactive&&y[Kt]&&b[Kt].enable(y[Kt])}},qr.prototype._add=function(y,b,_){this._handlers.push({handlerName:y,handler:b,allowed:_}),this._handlersById[y]=b},qr.prototype.stop=function(y){if(!this._updatingCamera){for(var b=0,_=this._handlers;b<_.length;b+=1)_[b].handler.reset();this._inertia.clear(),this._fireEvents({},{},y),this._changes=[]}},qr.prototype.isActive=function(){for(var y=0,b=this._handlers;y<b.length;y+=1)if(b[y].handler.isActive())return!0;return!1},qr.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},qr.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},qr.prototype.isMoving=function(){return!!ks(this._eventsInProgress)||this.isZooming()},qr.prototype._blockedByActive=function(y,b,_){for(var C in y)if(C!==_&&(!b||b.indexOf(C)<0))return!0;return!1},qr.prototype.handleWindowEvent=function(y){this.handleEvent(y,y.type+"Window")},qr.prototype._getMapTouches=function(y){for(var b=[],_=0,C=y;_<C.length;_+=1){var O=C[_];this._el.contains(O.target)&&b.push(O)}return b},qr.prototype.handleEvent=function(y,b){this._updatingCamera=!0;for(var _=y.type==="renderFrame"?void 0:y,C={needsRenderFrame:!1},O={},F={},B=y.touches?this._getMapTouches(y.touches):void 0,H=B?l.touchPos(this._el,B):l.mousePos(this._el,y),Y=0,rt=this._handlers;Y<rt.length;Y+=1){var ct=rt[Y],dt=ct.handlerName,pt=ct.handler,Pt=ct.allowed;if(pt.isEnabled()){var Mt=void 0;this._blockedByActive(F,Pt,dt)?pt.reset():pt[b||y.type]&&(Mt=pt[b||y.type](y,H,B),this.mergeHandlerResult(C,O,Mt,dt,_),Mt&&Mt.needsRenderFrame&&this._triggerRenderFrame()),(Mt||pt.isActive())&&(F[dt]=pt)}}var Ht={};for(var St in this._previousActiveHandlers)F[St]||(Ht[St]=_);this._previousActiveHandlers=F,(Object.keys(Ht).length||sn(C))&&(this._changes.push([C,O,Ht]),this._triggerRenderFrame()),(Object.keys(F).length||sn(C))&&this._map._stop(!0),this._updatingCamera=!1;var Ut=C.cameraAnimation;Ut&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ut(this._map))},qr.prototype.mergeHandlerResult=function(y,b,_,C,O){if(_){o.extend(y,_);var F={handlerName:C,originalEvent:_.originalEvent||O};_.zoomDelta!==void 0&&(b.zoom=F),_.panDelta!==void 0&&(b.drag=F),_.pitchDelta!==void 0&&(b.pitch=F),_.bearingDelta!==void 0&&(b.rotate=F)}},qr.prototype._applyChanges=function(){for(var y={},b={},_={},C=0,O=this._changes;C<O.length;C+=1){var F=O[C],B=F[0],H=F[1],Y=F[2];B.panDelta&&(y.panDelta=(y.panDelta||new o.Point(0,0))._add(B.panDelta)),B.zoomDelta&&(y.zoomDelta=(y.zoomDelta||0)+B.zoomDelta),B.bearingDelta&&(y.bearingDelta=(y.bearingDelta||0)+B.bearingDelta),B.pitchDelta&&(y.pitchDelta=(y.pitchDelta||0)+B.pitchDelta),B.around!==void 0&&(y.around=B.around),B.pinchAround!==void 0&&(y.pinchAround=B.pinchAround),B.noInertia&&(y.noInertia=B.noInertia),o.extend(b,H),o.extend(_,Y)}this._updateMapTransform(y,b,_),this._changes=[]},qr.prototype._updateMapTransform=function(y,b,_){var C=this._map,O=C.transform;if(!sn(y))return this._fireEvents(b,_,!0);var F=y.panDelta,B=y.zoomDelta,H=y.bearingDelta,Y=y.pitchDelta,rt=y.around,ct=y.pinchAround;ct!==void 0&&(rt=ct),C._stop(!0),rt=rt||C.transform.centerPoint;var dt=O.pointLocation(F?rt.sub(F):rt);H&&(O.bearing+=H),Y&&(O.pitch+=Y),B&&(O.zoom+=B),O.setLocationAtPoint(dt,rt),this._map._update(),y.noInertia||this._inertia.record(y),this._fireEvents(b,_,!0)},qr.prototype._fireEvents=function(y,b,_){var C=this,O=ks(this._eventsInProgress),F=ks(y),B={};for(var H in y)this._eventsInProgress[H]||(B[H+"start"]=y[H].originalEvent),this._eventsInProgress[H]=y[H];for(var Y in!O&&F&&this._fireEvent("movestart",F.originalEvent),B)this._fireEvent(Y,B[Y]);for(var rt in F&&this._fireEvent("move",F.originalEvent),y)this._fireEvent(rt,y[rt].originalEvent);var ct,dt={};for(var pt in this._eventsInProgress){var Pt=this._eventsInProgress[pt],Mt=Pt.handlerName,Ht=Pt.originalEvent;this._handlersById[Mt].isActive()||(delete this._eventsInProgress[pt],dt[pt+"end"]=ct=b[Mt]||Ht)}for(var St in dt)this._fireEvent(St,dt[St]);var Ut=ks(this._eventsInProgress);if(_&&(O||F)&&!Ut){this._updatingCamera=!0;var Kt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),le=function(we){return we!==0&&-C._bearingSnap<we&&we<C._bearingSnap};Kt?(le(Kt.bearing||this._map.getBearing())&&(Kt.bearing=0),this._map.easeTo(Kt,{originalEvent:ct})):(this._map.fire(new o.Event("moveend",{originalEvent:ct})),le(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},qr.prototype._fireEvent=function(y,b){this._map.fire(new o.Event(y,b?{originalEvent:b}:{}))},qr.prototype._requestFrame=function(){var y=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(b){delete y._frameId,y.handleEvent(new gp("renderFrame",{timeStamp:b})),y._applyChanges()})},qr.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Pl=function(y){function b(_,C){y.call(this),this._moving=!1,this._zooming=!1,this.transform=_,this._bearingSnap=C.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.getCenter=function(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)},b.prototype.setCenter=function(_,C){return this.jumpTo({center:_},C)},b.prototype.panBy=function(_,C,O){return _=o.Point.convert(_).mult(-1),this.panTo(this.transform.center,o.extend({offset:_},C),O)},b.prototype.panTo=function(_,C,O){return this.easeTo(o.extend({center:_},C),O)},b.prototype.getZoom=function(){return this.transform.zoom},b.prototype.setZoom=function(_,C){return this.jumpTo({zoom:_},C),this},b.prototype.zoomTo=function(_,C,O){return this.easeTo(o.extend({zoom:_},C),O)},b.prototype.zoomIn=function(_,C){return this.zoomTo(this.getZoom()+1,_,C),this},b.prototype.zoomOut=function(_,C){return this.zoomTo(this.getZoom()-1,_,C),this},b.prototype.getBearing=function(){return this.transform.bearing},b.prototype.setBearing=function(_,C){return this.jumpTo({bearing:_},C),this},b.prototype.getPadding=function(){return this.transform.padding},b.prototype.setPadding=function(_,C){return this.jumpTo({padding:_},C),this},b.prototype.rotateTo=function(_,C,O){return this.easeTo(o.extend({bearing:_},C),O)},b.prototype.resetNorth=function(_,C){return this.rotateTo(0,o.extend({duration:1e3},_),C),this},b.prototype.resetNorthPitch=function(_,C){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},_),C),this},b.prototype.snapToNorth=function(_,C){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(_,C):this},b.prototype.getPitch=function(){return this.transform.pitch},b.prototype.setPitch=function(_,C){return this.jumpTo({pitch:_},C),this},b.prototype.cameraForBounds=function(_,C){_=o.LngLatBounds.convert(_);var O=C&&C.bearing||0;return this._cameraForBoxAndBearing(_.getNorthWest(),_.getSouthEast(),O,C)},b.prototype._cameraForBoxAndBearing=function(_,C,O,F){var B={top:0,bottom:0,right:0,left:0};if(typeof(F=o.extend({padding:B,offset:[0,0],maxZoom:this.transform.maxZoom},F)).padding=="number"){var H=F.padding;F.padding={top:H,bottom:H,right:H,left:H}}F.padding=o.extend(B,F.padding);var Y=this.transform,rt=Y.padding,ct=Y.project(o.LngLat.convert(_)),dt=Y.project(o.LngLat.convert(C)),pt=ct.rotate(-O*Math.PI/180),Pt=dt.rotate(-O*Math.PI/180),Mt=new o.Point(Math.max(pt.x,Pt.x),Math.max(pt.y,Pt.y)),Ht=new o.Point(Math.min(pt.x,Pt.x),Math.min(pt.y,Pt.y)),St=Mt.sub(Ht),Ut=(Y.width-(rt.left+rt.right+F.padding.left+F.padding.right))/St.x,Kt=(Y.height-(rt.top+rt.bottom+F.padding.top+F.padding.bottom))/St.y;if(!(Kt<0||Ut<0)){var le=Math.min(Y.scaleZoom(Y.scale*Math.min(Ut,Kt)),F.maxZoom),we=typeof F.offset.x=="number"?new o.Point(F.offset.x,F.offset.y):o.Point.convert(F.offset),ve=new o.Point((F.padding.left-F.padding.right)/2,(F.padding.top-F.padding.bottom)/2).rotate(O*Math.PI/180),Me=we.add(ve).mult(Y.scale/Y.zoomScale(le));return{center:Y.unproject(ct.add(dt).div(2).sub(Me)),zoom:le,bearing:O}}o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},b.prototype.fitBounds=function(_,C,O){return this._fitInternal(this.cameraForBounds(_,C),C,O)},b.prototype.fitScreenCoordinates=function(_,C,O,F,B){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.Point.convert(_)),this.transform.pointLocation(o.Point.convert(C)),O,F),F,B)},b.prototype._fitInternal=function(_,C,O){return _?(delete(C=o.extend(_,C)).padding,C.linear?this.easeTo(C,O):this.flyTo(C,O)):this},b.prototype.jumpTo=function(_,C){this.stop();var O=this.transform,F=!1,B=!1,H=!1;return"zoom"in _&&O.zoom!==+_.zoom&&(F=!0,O.zoom=+_.zoom),_.center!==void 0&&(O.center=o.LngLat.convert(_.center)),"bearing"in _&&O.bearing!==+_.bearing&&(B=!0,O.bearing=+_.bearing),"pitch"in _&&O.pitch!==+_.pitch&&(H=!0,O.pitch=+_.pitch),_.padding==null||O.isPaddingEqual(_.padding)||(O.padding=_.padding),this.fire(new o.Event("movestart",C)).fire(new o.Event("move",C)),F&&this.fire(new o.Event("zoomstart",C)).fire(new o.Event("zoom",C)).fire(new o.Event("zoomend",C)),B&&this.fire(new o.Event("rotatestart",C)).fire(new o.Event("rotate",C)).fire(new o.Event("rotateend",C)),H&&this.fire(new o.Event("pitchstart",C)).fire(new o.Event("pitch",C)).fire(new o.Event("pitchend",C)),this.fire(new o.Event("moveend",C))},b.prototype.easeTo=function(_,C){var O=this;this._stop(!1,_.easeId),((_=o.extend({offset:[0,0],duration:500,easing:o.ease},_)).animate===!1||!_.essential&&o.browser.prefersReducedMotion)&&(_.duration=0);var F=this.transform,B=this.getZoom(),H=this.getBearing(),Y=this.getPitch(),rt=this.getPadding(),ct="zoom"in _?+_.zoom:B,dt="bearing"in _?this._normalizeBearing(_.bearing,H):H,pt="pitch"in _?+_.pitch:Y,Pt="padding"in _?_.padding:F.padding,Mt=o.Point.convert(_.offset),Ht=F.centerPoint.add(Mt),St=F.pointLocation(Ht),Ut=o.LngLat.convert(_.center||St);this._normalizeCenter(Ut);var Kt,le,we=F.project(St),ve=F.project(Ut).sub(we),Me=F.zoomScale(ct-B);_.around&&(Kt=o.LngLat.convert(_.around),le=F.locationPoint(Kt));var Ge={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ct!==B,this._rotating=this._rotating||H!==dt,this._pitching=this._pitching||pt!==Y,this._padding=!F.isPaddingEqual(Pt),this._easeId=_.easeId,this._prepareEase(C,_.noMoveStart,Ge),this._ease(function(hr){if(O._zooming&&(F.zoom=o.number(B,ct,hr)),O._rotating&&(F.bearing=o.number(H,dt,hr)),O._pitching&&(F.pitch=o.number(Y,pt,hr)),O._padding&&(F.interpolatePadding(rt,Pt,hr),Ht=F.centerPoint.add(Mt)),Kt)F.setLocationAtPoint(Kt,le);else{var or=F.zoomScale(F.zoom-B),Ir=ct>B?Math.min(2,Me):Math.max(.5,Me),ln=Math.pow(Ir,1-hr),fn=F.unproject(we.add(ve.mult(hr*ln)).mult(or));F.setLocationAtPoint(F.renderWorldCopies?fn.wrap():fn,Ht)}O._fireMoveEvents(C)},function(hr){O._afterEase(C,hr)},_),this},b.prototype._prepareEase=function(_,C,O){O===void 0&&(O={}),this._moving=!0,C||O.moving||this.fire(new o.Event("movestart",_)),this._zooming&&!O.zooming&&this.fire(new o.Event("zoomstart",_)),this._rotating&&!O.rotating&&this.fire(new o.Event("rotatestart",_)),this._pitching&&!O.pitching&&this.fire(new o.Event("pitchstart",_))},b.prototype._fireMoveEvents=function(_){this.fire(new o.Event("move",_)),this._zooming&&this.fire(new o.Event("zoom",_)),this._rotating&&this.fire(new o.Event("rotate",_)),this._pitching&&this.fire(new o.Event("pitch",_))},b.prototype._afterEase=function(_,C){if(!this._easeId||!C||this._easeId!==C){delete this._easeId;var O=this._zooming,F=this._rotating,B=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,O&&this.fire(new o.Event("zoomend",_)),F&&this.fire(new o.Event("rotateend",_)),B&&this.fire(new o.Event("pitchend",_)),this.fire(new o.Event("moveend",_))}},b.prototype.flyTo=function(_,C){var O=this;if(!_.essential&&o.browser.prefersReducedMotion){var F=o.pick(_,["center","zoom","bearing","pitch","around"]);return this.jumpTo(F,C)}this.stop(),_=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},_);var B=this.transform,H=this.getZoom(),Y=this.getBearing(),rt=this.getPitch(),ct=this.getPadding(),dt="zoom"in _?o.clamp(+_.zoom,B.minZoom,B.maxZoom):H,pt="bearing"in _?this._normalizeBearing(_.bearing,Y):Y,Pt="pitch"in _?+_.pitch:rt,Mt="padding"in _?_.padding:B.padding,Ht=B.zoomScale(dt-H),St=o.Point.convert(_.offset),Ut=B.centerPoint.add(St),Kt=B.pointLocation(Ut),le=o.LngLat.convert(_.center||Kt);this._normalizeCenter(le);var we=B.project(Kt),ve=B.project(le).sub(we),Me=_.curve,Ge=Math.max(B.width,B.height),hr=Ge/Ht,or=ve.mag();if("minZoom"in _){var Ir=o.clamp(Math.min(_.minZoom,H,dt),B.minZoom,B.maxZoom),ln=Ge/B.zoomScale(Ir-H);Me=Math.sqrt(ln/or*2)}var fn=Me*Me;function hn(Tn){var En=(hr*hr-Ge*Ge+(Tn?-1:1)*fn*fn*or*or)/(2*(Tn?hr:Ge)*fn*or);return Math.log(Math.sqrt(En*En+1)-En)}function Li(Tn){return(Math.exp(Tn)-Math.exp(-Tn))/2}function Ur(Tn){return(Math.exp(Tn)+Math.exp(-Tn))/2}var Pn=hn(0),jn=function(Tn){return Ur(Pn)/Ur(Pn+Me*Tn)},Ln=function(Tn){return Ge*((Ur(Pn)*(Li(En=Pn+Me*Tn)/Ur(En))-Li(Pn))/fn)/or;var En},Sn=(hn(1)-Pn)/Me;if(Math.abs(or)<1e-6||!isFinite(Sn)){if(Math.abs(Ge-hr)<1e-6)return this.easeTo(_,C);var Vn=hr<Ge?-1:1;Sn=Math.abs(Math.log(hr/Ge))/Me,Ln=function(){return 0},jn=function(Tn){return Math.exp(Vn*Me*Tn)}}return _.duration="duration"in _?+_.duration:1e3*Sn/("screenSpeed"in _?+_.screenSpeed/Me:+_.speed),_.maxDuration&&_.duration>_.maxDuration&&(_.duration=0),this._zooming=!0,this._rotating=Y!==pt,this._pitching=Pt!==rt,this._padding=!B.isPaddingEqual(Mt),this._prepareEase(C,!1),this._ease(function(Tn){var En=Tn*Sn,Ro=1/jn(En);B.zoom=Tn===1?dt:H+B.scaleZoom(Ro),O._rotating&&(B.bearing=o.number(Y,pt,Tn)),O._pitching&&(B.pitch=o.number(rt,Pt,Tn)),O._padding&&(B.interpolatePadding(ct,Mt,Tn),Ut=B.centerPoint.add(St));var Za=Tn===1?le:B.unproject(we.add(ve.mult(Ln(En))).mult(Ro));B.setLocationAtPoint(B.renderWorldCopies?Za.wrap():Za,Ut),O._fireMoveEvents(C)},function(){return O._afterEase(C)},_),this},b.prototype.isEasing=function(){return!!this._easeFrameId},b.prototype.stop=function(){return this._stop()},b.prototype._stop=function(_,C){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var O=this._onEaseEnd;delete this._onEaseEnd,O.call(this,C)}if(!_){var F=this.handlers;F&&F.stop(!1)}return this},b.prototype._ease=function(_,C,O){O.animate===!1||O.duration===0?(_(1),C()):(this._easeStart=o.browser.now(),this._easeOptions=O,this._onEaseFrame=_,this._onEaseEnd=C,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},b.prototype._renderFrameCallback=function(){var _=Math.min((o.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(_)),_<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},b.prototype._normalizeBearing=function(_,C){_=o.wrap(_,-180,180);var O=Math.abs(_-C);return Math.abs(_-360-C)<O&&(_-=360),Math.abs(_+360-C)<O&&(_+=360),_},b.prototype._normalizeCenter=function(_){var C=this.transform;if(C.renderWorldCopies&&!C.lngRange){var O=_.lng-C.center.lng;_.lng+=O>180?-360:O<-180?360:0}},b}(o.Evented),zs=function(y){y===void 0&&(y={}),this.options=y,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};zs.prototype.getDefaultPosition=function(){return"bottom-right"},zs.prototype.onAdd=function(y){var b=this.options&&this.options.compact;return this._map=y,this._container=l.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=l.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=l.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),b&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),b===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},zs.prototype.onRemove=function(){l.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},zs.prototype._setElementTitle=function(y,b){var _=this._map._getUIString("AttributionControl."+b);y.title=_,y.setAttribute("aria-label",_)},zs.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},zs.prototype._updateEditLink=function(){var y=this._editLink;y||(y=this._editLink=this._container.querySelector(".mapbox-improve-map"));var b=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(y){var _=b.reduce(function(C,O,F){return O.value&&(C+=O.key+"="+O.value+(F<b.length-1?"&":"")),C},"?");y.href=o.config.FEEDBACK_URL+"/"+_+(this._map._hash?this._map._hash.getHashString(!0):""),y.rel="noopener nofollow",this._setElementTitle(y,"MapFeedback")}},zs.prototype._updateData=function(y){!y||y.sourceDataType!=="metadata"&&y.sourceDataType!=="visibility"&&y.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},zs.prototype._updateAttributions=function(){if(this._map.style){var y=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?y=y.concat(this.options.customAttribution.map(function(H){return typeof H!="string"?"":H})):typeof this.options.customAttribution=="string"&&y.push(this.options.customAttribution)),this._map.style.stylesheet){var b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}var _=this._map.style.sourceCaches;for(var C in _){var O=_[C];if(O.used){var F=O.getSource();F.attribution&&y.indexOf(F.attribution)<0&&y.push(F.attribution)}}y.sort(function(H,Y){return H.length-Y.length});var B=(y=y.filter(function(H,Y){for(var rt=Y+1;rt<y.length;rt++)if(y[rt].indexOf(H)>=0)return!1;return!0})).join(" | ");B!==this._attribHTML&&(this._attribHTML=B,y.length?(this._innerContainer.innerHTML=B,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},zs.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Zu=function(){o.bindAll(["_updateLogo"],this),o.bindAll(["_updateCompact"],this)};Zu.prototype.onAdd=function(y){this._map=y,this._container=l.create("div","mapboxgl-ctrl");var b=l.create("a","mapboxgl-ctrl-logo");return b.target="_blank",b.rel="noopener nofollow",b.href="https://www.mapbox.com/",b.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),b.setAttribute("rel","noopener nofollow"),this._container.appendChild(b),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Zu.prototype.onRemove=function(){l.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Zu.prototype.getDefaultPosition=function(){return"bottom-left"},Zu.prototype._updateLogo=function(y){y&&y.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Zu.prototype._logoRequired=function(){if(this._map.style){var y=this._map.style.sourceCaches;for(var b in y)if(y[b].getSource().mapbox_logo)return!0;return!1}},Zu.prototype._updateCompact=function(){var y=this._container.children;if(y.length){var b=y[0];this._map.getCanvasContainer().offsetWidth<250?b.classList.add("mapboxgl-compact"):b.classList.remove("mapboxgl-compact")}};var Wa=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Wa.prototype.add=function(y){var b=++this._id;return this._queue.push({callback:y,id:b,cancelled:!1}),b},Wa.prototype.remove=function(y){for(var b=this._currentlyRunning,_=0,C=b?this._queue.concat(b):this._queue;_<C.length;_+=1){var O=C[_];if(O.id===y)return void(O.cancelled=!0)}},Wa.prototype.run=function(y){y===void 0&&(y=0);var b=this._currentlyRunning=this._queue;this._queue=[];for(var _=0,C=b;_<C.length;_+=1){var O=C[_];if(!O.cancelled&&(O.callback(y),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Wa.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Tu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Th=o.window.HTMLImageElement,md=o.window.HTMLElement,ji=o.window.ImageBitmap,Xo={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Q0=function(y){function b(C){var O=this;if((C=o.extend({},Xo,C)).minZoom!=null&&C.maxZoom!=null&&C.minZoom>C.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(C.minPitch!=null&&C.maxPitch!=null&&C.minPitch>C.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(C.minPitch!=null&&C.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(C.maxPitch!=null&&C.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var F=new Si(C.minZoom,C.maxZoom,C.minPitch,C.maxPitch,C.renderWorldCopies);if(y.call(this,F,C),this._interactive=C.interactive,this._maxTileCacheSize=C.maxTileCacheSize,this._failIfMajorPerformanceCaveat=C.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=C.preserveDrawingBuffer,this._antialias=C.antialias,this._trackResize=C.trackResize,this._bearingSnap=C.bearingSnap,this._refreshExpiredTiles=C.refreshExpiredTiles,this._fadeDuration=C.fadeDuration,this._crossSourceCollisions=C.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=C.collectResourceTiming,this._renderTaskQueue=new Wa,this._controls=[],this._mapId=o.uniqueId(),this._locale=o.extend({},Tu,C.locale),this._clickTolerance=C.clickTolerance,this._requestManager=new o.RequestManager(C.transformRequest,C.accessToken),typeof C.container=="string"){if(this._container=o.window.document.getElementById(C.container),!this._container)throw new Error("Container '"+C.container+"' not found.")}else{if(!(C.container instanceof md))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=C.container}if(C.maxBounds&&this.setMaxBounds(C.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return O._update(!1)}),this.on("moveend",function(){return O._update(!1)}),this.on("zoom",function(){return O._update(!0)}),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new qr(this,C),this._hash=C.hash&&new tu(typeof C.hash=="string"&&C.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:C.center,zoom:C.zoom,bearing:C.bearing,pitch:C.pitch}),C.bounds&&(this.resize(),this.fitBounds(C.bounds,o.extend({},C.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=C.localIdeographFontFamily,C.style&&this.setStyle(C.style,{localIdeographFontFamily:C.localIdeographFontFamily}),C.attributionControl&&this.addControl(new zs({customAttribution:C.customAttribution})),this.addControl(new Zu,C.logoPosition),this.on("style.load",function(){O.transform.unmodified&&O.jumpTo(O.style.stylesheet)}),this.on("data",function(B){O._update(B.dataType==="style"),O.fire(new o.Event(B.dataType+"data",B))}),this.on("dataloading",function(B){O.fire(new o.Event(B.dataType+"dataloading",B))})}y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b;var _={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return b.prototype._getMapId=function(){return this._mapId},b.prototype.addControl=function(C,O){if(O===void 0&&(O=C.getDefaultPosition?C.getDefaultPosition():"top-right"),!C||!C.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var F=C.onAdd(this);this._controls.push(C);var B=this._controlPositions[O];return O.indexOf("bottom")!==-1?B.insertBefore(F,B.firstChild):B.appendChild(F),this},b.prototype.removeControl=function(C){if(!C||!C.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var O=this._controls.indexOf(C);return O>-1&&this._controls.splice(O,1),C.onRemove(this),this},b.prototype.hasControl=function(C){return this._controls.indexOf(C)>-1},b.prototype.resize=function(C){var O=this._containerDimensions(),F=O[0],B=O[1];if(F===this.transform.width&&B===this.transform.height)return this;this._resizeCanvas(F,B),this.transform.resize(F,B),this.painter.resize(F,B);var H=!this._moving;return H&&this.fire(new o.Event("movestart",C)).fire(new o.Event("move",C)),this.fire(new o.Event("resize",C)),H&&this.fire(new o.Event("moveend",C)),this},b.prototype.getBounds=function(){return this.transform.getBounds()},b.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},b.prototype.setMaxBounds=function(C){return this.transform.setMaxBounds(o.LngLatBounds.convert(C)),this._update()},b.prototype.setMinZoom=function(C){if((C=C??-2)>=-2&&C<=this.transform.maxZoom)return this.transform.minZoom=C,this._update(),this.getZoom()<C&&this.setZoom(C),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},b.prototype.getMinZoom=function(){return this.transform.minZoom},b.prototype.setMaxZoom=function(C){if((C=C??22)>=this.transform.minZoom)return this.transform.maxZoom=C,this._update(),this.getZoom()>C&&this.setZoom(C),this;throw new Error("maxZoom must be greater than the current minZoom")},b.prototype.getMaxZoom=function(){return this.transform.maxZoom},b.prototype.setMinPitch=function(C){if((C=C??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(C>=0&&C<=this.transform.maxPitch)return this.transform.minPitch=C,this._update(),this.getPitch()<C&&this.setPitch(C),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},b.prototype.getMinPitch=function(){return this.transform.minPitch},b.prototype.setMaxPitch=function(C){if((C=C??60)>60)throw new Error("maxPitch must be less than or equal to 60");if(C>=this.transform.minPitch)return this.transform.maxPitch=C,this._update(),this.getPitch()>C&&this.setPitch(C),this;throw new Error("maxPitch must be greater than the current minPitch")},b.prototype.getMaxPitch=function(){return this.transform.maxPitch},b.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},b.prototype.setRenderWorldCopies=function(C){return this.transform.renderWorldCopies=C,this._update()},b.prototype.project=function(C){return this.transform.locationPoint(o.LngLat.convert(C))},b.prototype.unproject=function(C){return this.transform.pointLocation(o.Point.convert(C))},b.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},b.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},b.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},b.prototype._createDelegatedListener=function(C,O,F){var B,H=this;if(C==="mouseenter"||C==="mouseover"){var Y=!1;return{layer:O,listener:F,delegates:{mousemove:function(ct){var dt=H.getLayer(O)?H.queryRenderedFeatures(ct.point,{layers:[O]}):[];dt.length?Y||(Y=!0,F.call(H,new Ga(C,H,ct.originalEvent,{features:dt}))):Y=!1},mouseout:function(){Y=!1}}}}if(C==="mouseleave"||C==="mouseout"){var rt=!1;return{layer:O,listener:F,delegates:{mousemove:function(ct){(H.getLayer(O)?H.queryRenderedFeatures(ct.point,{layers:[O]}):[]).length?rt=!0:rt&&(rt=!1,F.call(H,new Ga(C,H,ct.originalEvent)))},mouseout:function(ct){rt&&(rt=!1,F.call(H,new Ga(C,H,ct.originalEvent)))}}}}return{layer:O,listener:F,delegates:(B={},B[C]=function(ct){var dt=H.getLayer(O)?H.queryRenderedFeatures(ct.point,{layers:[O]}):[];dt.length&&(ct.features=dt,F.call(H,ct),delete ct.features)},B)}},b.prototype.on=function(C,O,F){if(F===void 0)return y.prototype.on.call(this,C,O);var B=this._createDelegatedListener(C,O,F);for(var H in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[C]=this._delegatedListeners[C]||[],this._delegatedListeners[C].push(B),B.delegates)this.on(H,B.delegates[H]);return this},b.prototype.once=function(C,O,F){if(F===void 0)return y.prototype.once.call(this,C,O);var B=this._createDelegatedListener(C,O,F);for(var H in B.delegates)this.once(H,B.delegates[H]);return this},b.prototype.off=function(C,O,F){var B=this;return F===void 0?y.prototype.off.call(this,C,O):(this._delegatedListeners&&this._delegatedListeners[C]&&function(H){for(var Y=H[C],rt=0;rt<Y.length;rt++){var ct=Y[rt];if(ct.layer===O&&ct.listener===F){for(var dt in ct.delegates)B.off(dt,ct.delegates[dt]);return Y.splice(rt,1),B}}}(this._delegatedListeners),this)},b.prototype.queryRenderedFeatures=function(C,O){if(!this.style)return[];var F;if(O!==void 0||C===void 0||C instanceof o.Point||Array.isArray(C)||(O=C,C=void 0),O=O||{},(C=C||[[0,0],[this.transform.width,this.transform.height]])instanceof o.Point||typeof C[0]=="number")F=[o.Point.convert(C)];else{var B=o.Point.convert(C[0]),H=o.Point.convert(C[1]);F=[B,new o.Point(H.x,B.y),H,new o.Point(B.x,H.y),B]}return this.style.queryRenderedFeatures(F,O,this.transform)},b.prototype.querySourceFeatures=function(C,O){return this.style.querySourceFeatures(C,O)},b.prototype.setStyle=function(C,O){return(O=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},O)).diff!==!1&&O.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&C?(this._diffStyle(C,O),this):(this._localIdeographFontFamily=O.localIdeographFontFamily,this._updateStyle(C,O))},b.prototype._getUIString=function(C){var O=this._locale[C];if(O==null)throw new Error("Missing UI string '"+C+"'");return O},b.prototype._updateStyle=function(C,O){return this.style&&(this.style.setEventedParent(null),this.style._remove()),C?(this.style=new Il(this,O||{}),this.style.setEventedParent(this,{style:this.style}),typeof C=="string"?this.style.loadURL(C):this.style.loadJSON(C),this):(delete this.style,this)},b.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Il(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},b.prototype._diffStyle=function(C,O){var F=this;if(typeof C=="string"){var B=this._requestManager.normalizeStyleURL(C),H=this._requestManager.transformRequest(B,o.ResourceType.Style);o.getJSON(H,function(Y,rt){Y?F.fire(new o.ErrorEvent(Y)):rt&&F._updateDiff(rt,O)})}else typeof C=="object"&&this._updateDiff(C,O)},b.prototype._updateDiff=function(C,O){try{this.style.setState(C)&&this._update(!0)}catch(F){o.warnOnce("Unable to perform style diff: "+(F.message||F.error||F)+".  Rebuilding the style from scratch."),this._updateStyle(C,O)}},b.prototype.getStyle=function(){if(this.style)return this.style.serialize()},b.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():o.warnOnce("There is no style added to the map.")},b.prototype.addSource=function(C,O){return this._lazyInitEmptyStyle(),this.style.addSource(C,O),this._update(!0)},b.prototype.isSourceLoaded=function(C){var O=this.style&&this.style.sourceCaches[C];if(O!==void 0)return O.loaded();this.fire(new o.ErrorEvent(new Error("There is no source with ID '"+C+"'")))},b.prototype.areTilesLoaded=function(){var C=this.style&&this.style.sourceCaches;for(var O in C){var F=C[O]._tiles;for(var B in F){var H=F[B];if(H.state!=="loaded"&&H.state!=="errored")return!1}}return!0},b.prototype.addSourceType=function(C,O,F){return this._lazyInitEmptyStyle(),this.style.addSourceType(C,O,F)},b.prototype.removeSource=function(C){return this.style.removeSource(C),this._update(!0)},b.prototype.getSource=function(C){return this.style.getSource(C)},b.prototype.addImage=function(C,O,F){F===void 0&&(F={});var B=F.pixelRatio;B===void 0&&(B=1);var H=F.sdf;H===void 0&&(H=!1);var Y=F.stretchX,rt=F.stretchY,ct=F.content;if(this._lazyInitEmptyStyle(),O instanceof Th||ji&&O instanceof ji){var dt=o.browser.getImageData(O);this.style.addImage(C,{data:new o.RGBAImage({width:dt.width,height:dt.height},dt.data),pixelRatio:B,stretchX:Y,stretchY:rt,content:ct,sdf:H,version:0})}else{if(O.width===void 0||O.height===void 0)return this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var pt=O;this.style.addImage(C,{data:new o.RGBAImage({width:O.width,height:O.height},new Uint8Array(O.data)),pixelRatio:B,stretchX:Y,stretchY:rt,content:ct,sdf:H,version:0,userImage:pt}),pt.onAdd&&pt.onAdd(this,C)}},b.prototype.updateImage=function(C,O){var F=this.style.getImage(C);if(!F)return this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var B=O instanceof Th||ji&&O instanceof ji?o.browser.getImageData(O):O,H=B.width,Y=B.height,rt=B.data;return H===void 0||Y===void 0?this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):H!==F.data.width||Y!==F.data.height?this.fire(new o.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(F.data.replace(rt,!(O instanceof Th||ji&&O instanceof ji)),void this.style.updateImage(C,F))},b.prototype.hasImage=function(C){return C?!!this.style.getImage(C):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)},b.prototype.removeImage=function(C){this.style.removeImage(C)},b.prototype.loadImage=function(C,O){o.getImage(this._requestManager.transformRequest(C,o.ResourceType.Image),O)},b.prototype.listImages=function(){return this.style.listImages()},b.prototype.addLayer=function(C,O){return this._lazyInitEmptyStyle(),this.style.addLayer(C,O),this._update(!0)},b.prototype.moveLayer=function(C,O){return this.style.moveLayer(C,O),this._update(!0)},b.prototype.removeLayer=function(C){return this.style.removeLayer(C),this._update(!0)},b.prototype.getLayer=function(C){return this.style.getLayer(C)},b.prototype.setLayerZoomRange=function(C,O,F){return this.style.setLayerZoomRange(C,O,F),this._update(!0)},b.prototype.setFilter=function(C,O,F){return F===void 0&&(F={}),this.style.setFilter(C,O,F),this._update(!0)},b.prototype.getFilter=function(C){return this.style.getFilter(C)},b.prototype.setPaintProperty=function(C,O,F,B){return B===void 0&&(B={}),this.style.setPaintProperty(C,O,F,B),this._update(!0)},b.prototype.getPaintProperty=function(C,O){return this.style.getPaintProperty(C,O)},b.prototype.setLayoutProperty=function(C,O,F,B){return B===void 0&&(B={}),this.style.setLayoutProperty(C,O,F,B),this._update(!0)},b.prototype.getLayoutProperty=function(C,O){return this.style.getLayoutProperty(C,O)},b.prototype.setLight=function(C,O){return O===void 0&&(O={}),this._lazyInitEmptyStyle(),this.style.setLight(C,O),this._update(!0)},b.prototype.getLight=function(){return this.style.getLight()},b.prototype.setFeatureState=function(C,O){return this.style.setFeatureState(C,O),this._update()},b.prototype.removeFeatureState=function(C,O){return this.style.removeFeatureState(C,O),this._update()},b.prototype.getFeatureState=function(C){return this.style.getFeatureState(C)},b.prototype.getContainer=function(){return this._container},b.prototype.getCanvasContainer=function(){return this._canvasContainer},b.prototype.getCanvas=function(){return this._canvas},b.prototype._containerDimensions=function(){var C=0,O=0;return this._container&&(C=this._container.clientWidth||400,O=this._container.clientHeight||300),[C,O]},b.prototype._detectMissingCSS=function(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},b.prototype._setupContainer=function(){var C=this._container;C.classList.add("mapboxgl-map"),(this._missingCSSCanary=l.create("div","mapboxgl-canary",C)).style.visibility="hidden",this._detectMissingCSS();var O=this._canvasContainer=l.create("div","mapboxgl-canvas-container",C);this._interactive&&O.classList.add("mapboxgl-interactive"),this._canvas=l.create("canvas","mapboxgl-canvas",O),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var F=this._containerDimensions();this._resizeCanvas(F[0],F[1]);var B=this._controlContainer=l.create("div","mapboxgl-control-container",C),H=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(Y){H[Y]=l.create("div","mapboxgl-ctrl-"+Y,B)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},b.prototype._resizeCanvas=function(C,O){var F=o.browser.devicePixelRatio||1;this._canvas.width=F*C,this._canvas.height=F*O,this._canvas.style.width=C+"px",this._canvas.style.height=O+"px"},b.prototype._setupPainter=function(){var C=o.extend({},s.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),O=this._canvas.getContext("webgl",C)||this._canvas.getContext("experimental-webgl",C);O?(this.painter=new Ca(O,this.transform),o.webpSupported.testSupport(O)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))},b.prototype._contextLost=function(C){C.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:C}))},b.prototype._contextRestored=function(C){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:C}))},b.prototype._onMapScroll=function(C){if(C.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},b.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},b.prototype._update=function(C){return this.style?(this._styleDirty=this._styleDirty||C,this._sourcesDirty=!0,this.triggerRepaint(),this):this},b.prototype._requestRenderFrame=function(C){return this._update(),this._renderTaskQueue.add(C)},b.prototype._cancelRenderFrame=function(C){this._renderTaskQueue.remove(C)},b.prototype._render=function(C){var O,F=this,B=0,H=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(O=H.createQueryEXT(),H.beginQueryEXT(H.TIME_ELAPSED_EXT,O),B=o.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(C),!this._removed){var Y=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var rt=this.transform.zoom,ct=o.browser.now();this.style.zoomHistory.update(rt,ct);var dt=new o.EvaluationParameters(rt,{now:ct,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),pt=dt.crossFadingFactor();pt===1&&pt===this._crossFadingFactor||(Y=!0,this._crossFadingFactor=pt),this.style.update(dt)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||Y)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Pt=o.browser.now()-B;H.endQueryEXT(H.TIME_ELAPSED_EXT,O),setTimeout(function(){var St=H.getQueryObjectEXT(O,H.QUERY_RESULT_EXT)/1e6;H.deleteQueryEXT(O),F.fire(new o.Event("gpu-timing-frame",{cpuTime:Pt,gpuTime:St}))},50)}if(this.listens("gpu-timing-layer")){var Mt=this.painter.collectGpuTimers();setTimeout(function(){var St=F.painter.queryGpuTimers(Mt);F.fire(new o.Event("gpu-timing-layer",{layerTimes:St}))},50)}var Ht=this._sourcesDirty||this._styleDirty||this._placementDirty;return Ht||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.Event("idle")),!this._loaded||this._fullyLoaded||Ht||(this._fullyLoaded=!0),this}},b.prototype.remove=function(){this._hash&&this._hash.remove();for(var C=0,O=this._controls;C<O.length;C+=1)O[C].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1));var F=this.painter.context.gl.getExtension("WEBGL_lose_context");F&&F.loseContext(),Ef(this._canvasContainer),Ef(this._controlContainer),Ef(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new o.Event("remove"))},b.prototype.triggerRepaint=function(){var C=this;this.style&&!this._frame&&(this._frame=o.browser.frame(function(O){C._frame=null,C._render(O)}))},b.prototype._onWindowOnline=function(){this._update()},b.prototype._onWindowResize=function(C){this._trackResize&&this.resize({originalEvent:C})._update()},_.showTileBoundaries.get=function(){return!!this._showTileBoundaries},_.showTileBoundaries.set=function(C){this._showTileBoundaries!==C&&(this._showTileBoundaries=C,this._update())},_.showPadding.get=function(){return!!this._showPadding},_.showPadding.set=function(C){this._showPadding!==C&&(this._showPadding=C,this._update())},_.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},_.showCollisionBoxes.set=function(C){this._showCollisionBoxes!==C&&(this._showCollisionBoxes=C,C?this.style._generateCollisionBoxes():this._update())},_.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},_.showOverdrawInspector.set=function(C){this._showOverdrawInspector!==C&&(this._showOverdrawInspector=C,this._update())},_.repaint.get=function(){return!!this._repaint},_.repaint.set=function(C){this._repaint!==C&&(this._repaint=C,this.triggerRepaint())},_.vertices.get=function(){return!!this._vertices},_.vertices.set=function(C){this._vertices=C,this._update()},b.prototype._setCacheLimits=function(C,O){o.setCacheLimits(C,O)},_.version.get=function(){return o.version},Object.defineProperties(b.prototype,_),b}(Pl);function Ef(y){y.parentNode&&y.parentNode.removeChild(y)}var tm={showCompass:!0,showZoom:!0,visualizePitch:!1},Ah=function(y){var b=this;this.options=o.extend({},tm,y),this._container=l.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(_){return _.preventDefault()}),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(_){return b._map.zoomIn({},{originalEvent:_})}),l.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(_){return b._map.zoomOut({},{originalEvent:_})}),l.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(_){b.options.visualizePitch?b._map.resetNorthPitch({},{originalEvent:_}):b._map.resetNorth({},{originalEvent:_})}),this._compassIcon=l.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Ah.prototype._updateZoomButtons=function(){var y=this._map.getZoom(),b=y===this._map.getMaxZoom(),_=y===this._map.getMinZoom();this._zoomInButton.disabled=b,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",b.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())},Ah.prototype._rotateCompassArrow=function(){var y=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=y},Ah.prototype.onAdd=function(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Dl(this._map,this._compass,this.options.visualizePitch)),this._container},Ah.prototype.onRemove=function(){l.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Ah.prototype._createButton=function(y,b){var _=l.create("button",y,this._container);return _.type="button",_.addEventListener("click",b),_},Ah.prototype._setButtonTitle=function(y,b){var _=this._map._getUIString("NavigationControl."+b);y.title=_,y.setAttribute("aria-label",_)};var Dl=function(y,b,_){_===void 0&&(_=!1),this._clickTolerance=10,this.element=b,this.mouseRotate=new Iv({clickTolerance:y.dragRotate._mouseRotate._clickTolerance}),this.map=y,_&&(this.mousePitch=new qg({clickTolerance:y.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener(b,"mousedown",this.mousedown),l.addEventListener(b,"touchstart",this.touchstart,{passive:!1}),l.addEventListener(b,"touchmove",this.touchmove),l.addEventListener(b,"touchend",this.touchend),l.addEventListener(b,"touchcancel",this.reset)};function mp(y,b,_){if(y=new o.LngLat(y.lng,y.lat),b){var C=new o.LngLat(y.lng-360,y.lat),O=new o.LngLat(y.lng+360,y.lat),F=_.locationPoint(y).distSqr(b);_.locationPoint(C).distSqr(b)<F?y=C:_.locationPoint(O).distSqr(b)<F&&(y=O)}for(;Math.abs(y.lng-_.center.lng)>180;){var B=_.locationPoint(y);if(B.x>=0&&B.y>=0&&B.x<=_.width&&B.y<=_.height)break;y.lng>_.center.lng?y.lng-=360:y.lng+=360}return y}Dl.prototype.down=function(y,b){this.mouseRotate.mousedown(y,b),this.mousePitch&&this.mousePitch.mousedown(y,b),l.disableDrag()},Dl.prototype.move=function(y,b){var _=this.map,C=this.mouseRotate.mousemoveWindow(y,b);if(C&&C.bearingDelta&&_.setBearing(_.getBearing()+C.bearingDelta),this.mousePitch){var O=this.mousePitch.mousemoveWindow(y,b);O&&O.pitchDelta&&_.setPitch(_.getPitch()+O.pitchDelta)}},Dl.prototype.off=function(){var y=this.element;l.removeEventListener(y,"mousedown",this.mousedown),l.removeEventListener(y,"touchstart",this.touchstart,{passive:!1}),l.removeEventListener(y,"touchmove",this.touchmove),l.removeEventListener(y,"touchend",this.touchend),l.removeEventListener(y,"touchcancel",this.reset),this.offTemp()},Dl.prototype.offTemp=function(){l.enableDrag(),l.removeEventListener(o.window,"mousemove",this.mousemove),l.removeEventListener(o.window,"mouseup",this.mouseup)},Dl.prototype.mousedown=function(y){this.down(o.extend({},y,{ctrlKey:!0,preventDefault:function(){return y.preventDefault()}}),l.mousePos(this.element,y)),l.addEventListener(o.window,"mousemove",this.mousemove),l.addEventListener(o.window,"mouseup",this.mouseup)},Dl.prototype.mousemove=function(y){this.move(y,l.mousePos(this.element,y))},Dl.prototype.mouseup=function(y){this.mouseRotate.mouseupWindow(y),this.mousePitch&&this.mousePitch.mouseupWindow(y),this.offTemp()},Dl.prototype.touchstart=function(y){y.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=l.touchPos(this.element,y.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return y.preventDefault()}},this._startPos))},Dl.prototype.touchmove=function(y){y.targetTouches.length!==1?this.reset():(this._lastPos=l.touchPos(this.element,y.targetTouches)[0],this.move({preventDefault:function(){return y.preventDefault()}},this._lastPos))},Dl.prototype.touchend=function(y){y.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Dl.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Cc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function em(y,b,_){var C=y.classList;for(var O in Cc)C.remove("mapboxgl-"+_+"-anchor-"+O);C.add("mapboxgl-"+_+"-anchor-"+b)}var yp,Lv=function(y){function b(_,C){if(y.call(this),(_ instanceof o.window.HTMLElement||C)&&(_=o.extend({element:_},C)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=_&&_.anchor||"center",this._color=_&&_.color||"#3FB1CE",this._scale=_&&_.scale||1,this._draggable=_&&_.draggable||!1,this._clickTolerance=_&&_.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=_&&_.rotation||0,this._rotationAlignment=_&&_.rotationAlignment||"auto",this._pitchAlignment=_&&_.pitchAlignment&&_.pitchAlignment!=="auto"?_.pitchAlignment:this._rotationAlignment,_&&_.element)this._element=_.element,this._offset=o.Point.convert(_&&_.offset||[0,0]);else{this._defaultMarker=!0,this._element=l.create("div"),this._element.setAttribute("aria-label","Map marker");var O=l.createNS("http://www.w3.org/2000/svg","svg");O.setAttributeNS(null,"display","block"),O.setAttributeNS(null,"height","41px"),O.setAttributeNS(null,"width","27px"),O.setAttributeNS(null,"viewBox","0 0 27 41");var F=l.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"stroke","none"),F.setAttributeNS(null,"stroke-width","1"),F.setAttributeNS(null,"fill","none"),F.setAttributeNS(null,"fill-rule","evenodd");var B=l.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"fill-rule","nonzero");var H=l.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(3.0, 29.0)"),H.setAttributeNS(null,"fill","#000000");for(var Y=0,rt=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];Y<rt.length;Y+=1){var ct=rt[Y],dt=l.createNS("http://www.w3.org/2000/svg","ellipse");dt.setAttributeNS(null,"opacity","0.04"),dt.setAttributeNS(null,"cx","10.5"),dt.setAttributeNS(null,"cy","5.80029008"),dt.setAttributeNS(null,"rx",ct.rx),dt.setAttributeNS(null,"ry",ct.ry),H.appendChild(dt)}var pt=l.createNS("http://www.w3.org/2000/svg","g");pt.setAttributeNS(null,"fill",this._color);var Pt=l.createNS("http://www.w3.org/2000/svg","path");Pt.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),pt.appendChild(Pt);var Mt=l.createNS("http://www.w3.org/2000/svg","g");Mt.setAttributeNS(null,"opacity","0.25"),Mt.setAttributeNS(null,"fill","#000000");var Ht=l.createNS("http://www.w3.org/2000/svg","path");Ht.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Mt.appendChild(Ht);var St=l.createNS("http://www.w3.org/2000/svg","g");St.setAttributeNS(null,"transform","translate(6.0, 7.0)"),St.setAttributeNS(null,"fill","#FFFFFF");var Ut=l.createNS("http://www.w3.org/2000/svg","g");Ut.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Kt=l.createNS("http://www.w3.org/2000/svg","circle");Kt.setAttributeNS(null,"fill","#000000"),Kt.setAttributeNS(null,"opacity","0.25"),Kt.setAttributeNS(null,"cx","5.5"),Kt.setAttributeNS(null,"cy","5.5"),Kt.setAttributeNS(null,"r","5.4999962");var le=l.createNS("http://www.w3.org/2000/svg","circle");le.setAttributeNS(null,"fill","#FFFFFF"),le.setAttributeNS(null,"cx","5.5"),le.setAttributeNS(null,"cy","5.5"),le.setAttributeNS(null,"r","5.4999962"),Ut.appendChild(Kt),Ut.appendChild(le),B.appendChild(H),B.appendChild(pt),B.appendChild(Mt),B.appendChild(St),B.appendChild(Ut),O.appendChild(B),O.setAttributeNS(null,"height",41*this._scale+"px"),O.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(O),this._offset=o.Point.convert(_&&_.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(we){we.preventDefault()}),this._element.addEventListener("mousedown",function(we){we.preventDefault()}),em(this._element,this._anchor,"marker"),this._popup=null}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.addTo=function(_){return this.remove(),this._map=_,_.getCanvasContainer().appendChild(this._element),_.on("move",this._update),_.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},b.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),l.remove(this._element),this._popup&&this._popup.remove(),this},b.prototype.getLngLat=function(){return this._lngLat},b.prototype.setLngLat=function(_){return this._lngLat=o.LngLat.convert(_),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},b.prototype.getElement=function(){return this._element},b.prototype.setPopup=function(_){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),_){if(!("offset"in _.options)){var C=Math.sqrt(Math.pow(13.5,2)/2);_.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[C,-1*(24.6+C)],"bottom-right":[-C,-1*(24.6+C)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=_,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},b.prototype._onKeyPress=function(_){var C=_.code,O=_.charCode||_.keyCode;C!=="Space"&&C!=="Enter"&&O!==32&&O!==13||this.togglePopup()},b.prototype._onMapClick=function(_){var C=_.originalEvent.target,O=this._element;this._popup&&(C===O||O.contains(C))&&this.togglePopup()},b.prototype.getPopup=function(){return this._popup},b.prototype.togglePopup=function(){var _=this._popup;return _?(_.isOpen()?_.remove():_.addTo(this._map),this):this},b.prototype._update=function(_){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=mp(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var C="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?C="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(C="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var O="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?O="rotateX(0deg)":this._pitchAlignment==="map"&&(O="rotateX("+this._map.getPitch()+"deg)"),_&&_.type!=="moveend"||(this._pos=this._pos.round()),l.setTransform(this._element,Cc[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+O+" "+C)}},b.prototype.getOffset=function(){return this._offset},b.prototype.setOffset=function(_){return this._offset=o.Point.convert(_),this._update(),this},b.prototype._onMove=function(_){if(!this._isDragging){var C=this._clickTolerance||this._map._clickTolerance;this._isDragging=_.point.dist(this._pointerdownPos)>=C}this._isDragging&&(this._pos=_.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))},b.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"},b.prototype._addDragHandler=function(_){this._element.contains(_.originalEvent.target)&&(_.preventDefault(),this._positionDelta=_.point.sub(this._pos).add(this._offset),this._pointerdownPos=_.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},b.prototype.setDraggable=function(_){return this._draggable=!!_,this._map&&(_?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},b.prototype.isDraggable=function(){return this._draggable},b.prototype.setRotation=function(_){return this._rotation=_||0,this._update(),this},b.prototype.getRotation=function(){return this._rotation},b.prototype.setRotationAlignment=function(_){return this._rotationAlignment=_||"auto",this._update(),this},b.prototype.getRotationAlignment=function(){return this._rotationAlignment},b.prototype.setPitchAlignment=function(_){return this._pitchAlignment=_&&_!=="auto"?_:this._rotationAlignment,this._update(),this},b.prototype.getPitchAlignment=function(){return this._pitchAlignment},b}(o.Evented),rm={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},yd=0,_d=!1,J0=function(y){function b(_){y.call(this),this.options=o.extend({},rm,_),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.onAdd=function(_){var C;return this._map=_,this._container=l.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),C=this._setupUI,yp!==void 0?C(yp):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(function(O){C(yp=O.state!=="denied")}):C(yp=!!o.window.navigator.geolocation),this._container},b.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),l.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,yd=0,_d=!1},b.prototype._isOutOfMapMaxBounds=function(_){var C=this._map.getMaxBounds(),O=_.coords;return C&&(O.longitude<C.getWest()||O.longitude>C.getEast()||O.latitude<C.getSouth()||O.latitude>C.getNorth())},b.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},b.prototype._onSuccess=function(_){if(this._map){if(this._isOutOfMapMaxBounds(_))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",_)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=_,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(_),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(_),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",_)),this._finish()}},b.prototype._updateCamera=function(_){var C=new o.LngLat(_.coords.longitude,_.coords.latitude),O=_.coords.accuracy,F=this._map.getBearing(),B=o.extend({bearing:F},this.options.fitBoundsOptions);this._map.fitBounds(C.toBounds(O),B,{geolocateSource:!0})},b.prototype._updateMarker=function(_){if(_){var C=new o.LngLat(_.coords.longitude,_.coords.latitude);this._accuracyCircleMarker.setLngLat(C).addTo(this._map),this._userLocationDotMarker.setLngLat(C).addTo(this._map),this._accuracy=_.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},b.prototype._updateCircleRadius=function(){var _=this._map._container.clientHeight/2,C=this._map.unproject([0,_]),O=this._map.unproject([1,_]),F=C.distanceTo(O),B=Math.ceil(2*this._accuracy/F);this._circleElement.style.width=B+"px",this._circleElement.style.height=B+"px"},b.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},b.prototype._onError=function(_){if(this._map){if(this.options.trackUserLocation)if(_.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var C=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=C,this._geolocateButton.setAttribute("aria-label",C),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(_.code===3&&_d)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",_)),this._finish()}},b.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},b.prototype._setupUI=function(_){var C=this;if(this._container.addEventListener("contextmenu",function(B){return B.preventDefault()}),this._geolocateButton=l.create("button","mapboxgl-ctrl-geolocate",this._container),l.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",_===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var O=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=O,this._geolocateButton.setAttribute("aria-label",O)}else{var F=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=F,this._geolocateButton.setAttribute("aria-label",F)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=l.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Lv(this._dotElement),this._circleElement=l.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Lv({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(B){B.geolocateSource||C._watchState!=="ACTIVE_LOCK"||B.originalEvent&&B.originalEvent.type==="resize"||(C._watchState="BACKGROUND",C._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),C._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),C.fire(new o.Event("trackuserlocationend")))})},b.prototype.trigger=function(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":yd--,_d=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var _;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++yd>1?(_={maximumAge:6e5,timeout:0},_d=!0):(_=this.options.positionOptions,_d=!1),this._geolocationWatchID=o.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,_)}}else o.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},b.prototype._clearWatch=function(){o.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},b}(o.Evented),Sc={maxWidth:100,unit:"metric"},qu=function(y){this.options=o.extend({},Sc,y),o.bindAll(["_onMove","setUnit"],this)};function nm(y,b,_){var C=_&&_.maxWidth||100,O=y._container.clientHeight/2,F=y.unproject([0,O]),B=y.unproject([C,O]),H=F.distanceTo(B);if(_&&_.unit==="imperial"){var Y=3.2808*H;Y>5280?wf(b,C,Y/5280,y._getUIString("ScaleControl.Miles")):wf(b,C,Y,y._getUIString("ScaleControl.Feet"))}else _&&_.unit==="nautical"?wf(b,C,H/1852,y._getUIString("ScaleControl.NauticalMiles")):H>=1e3?wf(b,C,H/1e3,y._getUIString("ScaleControl.Kilometers")):wf(b,C,H,y._getUIString("ScaleControl.Meters"))}function wf(y,b,_,C){var O,F,B,H=(O=_,(F=Math.pow(10,(""+Math.floor(O)).length-1))*(B=(B=O/F)>=10?10:B>=5?5:B>=3?3:B>=2?2:B>=1?1:function(Y){var rt=Math.pow(10,Math.ceil(-Math.log(Y)/Math.LN10));return Math.round(Y*rt)/rt}(B)));y.style.width=b*(H/_)+"px",y.innerHTML=H+"&nbsp;"+C}qu.prototype.getDefaultPosition=function(){return"bottom-left"},qu.prototype._onMove=function(){nm(this._map,this._container,this.options)},qu.prototype.onAdd=function(y){return this._map=y,this._container=l.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},qu.prototype.onRemove=function(){l.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},qu.prototype.setUnit=function(y){this.options.unit=y,nm(this._map,this._container,this.options)};var Au=function(y){this._fullscreen=!1,y&&y.container&&(y.container instanceof o.window.HTMLElement?this._container=y.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in o.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in o.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in o.window.document&&(this._fullscreenchange="MSFullscreenChange")};Au.prototype.onAdd=function(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=l.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Au.prototype.onRemove=function(){l.remove(this._controlContainer),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Au.prototype._checkFullscreenSupport=function(){return!!(o.window.document.fullscreenEnabled||o.window.document.mozFullScreenEnabled||o.window.document.msFullscreenEnabled||o.window.document.webkitFullscreenEnabled)},Au.prototype._setupUI=function(){var y=this._fullscreenButton=l.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);l.create("span","mapboxgl-ctrl-icon",y).setAttribute("aria-hidden",!0),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Au.prototype._updateTitle=function(){var y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y},Au.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Au.prototype._isFullscreen=function(){return this._fullscreen},Au.prototype._changeIcon=function(){(o.window.document.fullscreenElement||o.window.document.mozFullScreenElement||o.window.document.webkitFullscreenElement||o.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Au.prototype._onClickFullscreen=function(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.mozCancelFullScreen?o.window.document.mozCancelFullScreen():o.window.document.msExitFullscreen?o.window.document.msExitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var ty={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ov=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),im=function(y){function b(_){y.call(this),this.options=o.extend(Object.create(ty),_),o.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return y&&(b.__proto__=y),(b.prototype=Object.create(y&&y.prototype)).constructor=b,b.prototype.addTo=function(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new o.Event("open")),this},b.prototype.isOpen=function(){return!!this._map},b.prototype.remove=function(){return this._content&&l.remove(this._content),this._container&&(l.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new o.Event("close")),this},b.prototype.getLngLat=function(){return this._lngLat},b.prototype.setLngLat=function(_){return this._lngLat=o.LngLat.convert(_),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},b.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},b.prototype.getElement=function(){return this._container},b.prototype.setText=function(_){return this.setDOMContent(o.window.document.createTextNode(_))},b.prototype.setHTML=function(_){var C,O=o.window.document.createDocumentFragment(),F=o.window.document.createElement("body");for(F.innerHTML=_;C=F.firstChild;)O.appendChild(C);return this.setDOMContent(O)},b.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},b.prototype.setMaxWidth=function(_){return this.options.maxWidth=_,this._update(),this},b.prototype.setDOMContent=function(_){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=l.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(_),this._createCloseButton(),this._update(),this._focusFirstElement(),this},b.prototype.addClassName=function(_){this._container&&this._container.classList.add(_)},b.prototype.removeClassName=function(_){this._container&&this._container.classList.remove(_)},b.prototype.setOffset=function(_){return this.options.offset=_,this._update(),this},b.prototype.toggleClassName=function(_){if(this._container)return this._container.classList.toggle(_)},b.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=l.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},b.prototype._onMouseUp=function(_){this._update(_.point)},b.prototype._onMouseMove=function(_){this._update(_.point)},b.prototype._onDrag=function(_){this._update(_.point)},b.prototype._update=function(_){var C=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=l.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=l.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(dt){return C._container.classList.add(dt)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=mp(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||_)){var O=this._pos=this._trackPointer&&_?_:this._map.project(this._lngLat),F=this.options.anchor,B=function dt(pt){if(pt){if(typeof pt=="number"){var Pt=Math.round(Math.sqrt(.5*Math.pow(pt,2)));return{center:new o.Point(0,0),top:new o.Point(0,pt),"top-left":new o.Point(Pt,Pt),"top-right":new o.Point(-Pt,Pt),bottom:new o.Point(0,-pt),"bottom-left":new o.Point(Pt,-Pt),"bottom-right":new o.Point(-Pt,-Pt),left:new o.Point(pt,0),right:new o.Point(-pt,0)}}if(pt instanceof o.Point||Array.isArray(pt)){var Mt=o.Point.convert(pt);return{center:Mt,top:Mt,"top-left":Mt,"top-right":Mt,bottom:Mt,"bottom-left":Mt,"bottom-right":Mt,left:Mt,right:Mt}}return{center:o.Point.convert(pt.center||[0,0]),top:o.Point.convert(pt.top||[0,0]),"top-left":o.Point.convert(pt["top-left"]||[0,0]),"top-right":o.Point.convert(pt["top-right"]||[0,0]),bottom:o.Point.convert(pt.bottom||[0,0]),"bottom-left":o.Point.convert(pt["bottom-left"]||[0,0]),"bottom-right":o.Point.convert(pt["bottom-right"]||[0,0]),left:o.Point.convert(pt.left||[0,0]),right:o.Point.convert(pt.right||[0,0])}}return dt(new o.Point(0,0))}(this.options.offset);if(!F){var H,Y=this._container.offsetWidth,rt=this._container.offsetHeight;H=O.y+B.bottom.y<rt?["top"]:O.y>this._map.transform.height-rt?["bottom"]:[],O.x<Y/2?H.push("left"):O.x>this._map.transform.width-Y/2&&H.push("right"),F=H.length===0?"bottom":H.join("-")}var ct=O.add(B[F]).round();l.setTransform(this._container,Cc[F]+" translate("+ct.x+"px,"+ct.y+"px)"),em(this._container,F,"popup")}},b.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var _=this._container.querySelector(Ov);_&&_.focus()}},b.prototype._onClose=function(){this.remove()},b}(o.Evented),am={version:o.version,supported:s,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:Q0,NavigationControl:Ah,GeolocateControl:J0,AttributionControl:zs,ScaleControl:qu,FullscreenControl:Au,Popup:im,Marker:Lv,Style:Il,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.Point,MercatorCoordinate:o.MercatorCoordinate,Evented:o.Evented,config:o.config,prewarm:function(){Ie().acquire(Ae)},clearPrewarmedResources:function(){var y=Yr;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(Ae),Yr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(y){o.config.ACCESS_TOKEN=y},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(y){o.config.API_URL=y},get workerCount(){return qe.workerCount},set workerCount(y){qe.workerCount=y},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(y){o.config.MAX_PARALLEL_IMAGE_REQUESTS=y},clearStorage:function(y){o.clearTileCache(y)},workerUrl:""};return am}),i})})(xtt);var Y8t=xtt.exports;const Lw=sa(Y8t),Z8t=["id","attributionControl","style","token","rotation","mapInstance"];function q8t(e,t){var r=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(r||n)&&(t||(t=document),!!t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var a=t.body||t.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):t.documentElement.appendChild(i)}var o=t.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(t.createTextNode(e)),i.appendChild(o),o}}q8t(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{flex-direction:column-reverse}.mapboxgl-popup-anchor-left{flex-direction:row}.mapboxgl-popup-anchor-right{flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;box-sizing:border-box;box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`);window.mapboxgl=Lw;let K8t=0;const _H="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg";class Q8t extends KI{constructor(...t){super(...t),U(this,"version","MAPBOX"),U(this,"viewport",void 0)}getType(){return"mapbox"}lngLatToCoord(t,r={x:0,y:0,z:0}){const{x:n,y:i}=this.lngLatToMercator(t,0);return[n-r.x,i-r.y]}lngLatToMercator(t,r){const{x:n=0,y:i=0,z:a=0}=window.mapboxgl.MercatorCoordinate.fromLngLat(t,r);return{x:n,y:i,z:a}}getModelMatrix(t,r,n,i=[1,1,1],a={x:0,y:0,z:0}){const o=window.mapboxgl.MercatorCoordinate.fromLngLat(t,r),s=o.meterInMercatorCoordinateUnits(),l=A_();return Bh(l,l,su(o.x-a.x,o.y-a.y,o.z||0-a.z)),Nh(l,l,su(s*i[0],-s*i[1],s*i[2])),M_(l,l,n[0]),NS(l,l,n[1]),Fb(l,l,n[2]),l}init(){var t=this;return Oe(function*(){const r=t.config,{id:n="map",attributionControl:i=!1,style:a="light",token:o=_H,rotation:s=0,mapInstance:l}=r,u=Gh(r,Z8t);t.viewport=new VS,!l&&!window.mapboxgl&&console.error(t.configService.getSceneWarninfo("SDK")),o===_H&&a!=="blank"&&!window.mapboxgl.accessToken&&!l&&console.warn(t.configService.getSceneWarninfo("MapToken")),!l&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=o),l?(t.map=l,t.$mapContainer=t.map.getContainer()):(t.$mapContainer=t.creatMapContainer(n),t.map=new window.mapboxgl.Map(Ce({container:t.$mapContainer,style:t.getMapStyleValue(a),attributionControl:i,bearing:s},u))),t.map.on("load",()=>{t.handleCameraChanged()}),t.map.on("move",t.handleCameraChanged),t.handleCameraChanged()})()}destroy(){var t;(t=this.$mapContainer)===null||t===void 0||(t=t.parentNode)===null||t===void 0||t.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}emit(t,...r){this.eventEmitter.emit(t,...r)}once(t,...r){this.eventEmitter.once(t,...r)}getMapContainer(){return this.$mapContainer}getCanvasOverlays(){var t;return(t=this.getMapContainer())===null||t===void 0?void 0:t.querySelector(".mapboxgl-canvas-container")}meterToCoord(t,r){const n=new Lw.LngLat(t[0],t[1]),i=new Lw.LngLat(r[0],r[1]),a=n.distanceTo(i),o=Lw.MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),s=Lw.MercatorCoordinate.fromLngLat({lng:r[0],lat:r[1]}),{x:l,y:u}=o,{x:c,y:f}=s;return Math.sqrt(Math.pow(l-c,2)+Math.pow(u-f,2))*4194304*2/a}exportMap(t){const r=this.map.getCanvas();return t==="jpg"?r==null?void 0:r.toDataURL("image/jpeg"):r==null?void 0:r.toDataURL("image/png")}creatMapContainer(t){let r=t;typeof t=="string"&&(r=document.getElementById(t));const n=document.createElement("div");return n.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,n.id="l7_mapbox_div"+K8t++,r.appendChild(n),n}}function J8t(e,t){var r=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(r||n)&&(t||(t=document),!!t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var a=t.body||t.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):t.documentElement.appendChild(i)}var o=t.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(t.createTextNode(e)),i.appendChild(o),o}}J8t(`.mapboxgl-ctrl-logo {
  display: none !important;
}
`);class t7t extends HS{getServiceConstructor(){return Q8t}}const e7t=e=>{const{tk:t}=e;return new Promise(r=>{const n=document.createElement("script");n.type="text/javascript",n.src=`https://api.tianditu.gov.cn/api?v=4.0&tk=${t}`,n.onload=function(){console.log("TianDiTu API script loaded."),r(!0)},n.onerror=function(){console.error("Failed to load TianDiTu API script."),r(!1)},document.head.appendChild(n)})};let r7t=0;const k1={zoomchange:["Ge"]};class n7t extends KI{constructor(...t){super(...t),U(this,"viewport",null),U(this,"evtCbProxyMap",new Map),U(this,"sceneContainer",void 0),U(this,"handleCameraChanged",()=>{this.emit("mapchange");const r=this.map,{lng:n,lat:i}=this.map.getCenter(),a={center:[n,i],viewportHeight:r.getContainer().clientHeight,viewportWidth:r.getContainer().clientWidth,bearing:360,pitch:0,zoom:r.getZoom()-1};this.viewport&&(this.viewport.syncWithMapCamera(a),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport))})}addMarkerContainer(){const t=this.map.getContainer(),r=this.markerContainer=document.createElement("div");t.appendChild(r),r.setAttribute("tabindex","-1"),r.id="tdt-L7-marker",r.style.position="absolute",r.style.left="",r.style.top="",r.style.zIndex="600",r.style.width="0px",r.style.height="0px",r.style.overflow="visible"}getMarkerContainer(){return this.markerContainer}onCameraChanged(t){this.cameraChangedCallback=t}resize(t){this.sceneContainer.style.width=t.newSize.x+"px",this.sceneContainer.style.height=t.newSize.y+"px"}update(){const t=this.map.getBounds(),{x:r,y:n}=this.map.lngLatToLayerPoint({lng:t.getSouthWest().lng,lat:t.getNorthEast().lat});this.sceneContainer.style.transition="",this.sceneContainer.style.transformOrigin="center",this.sceneContainer.style.transform=`translate3d(${r}px, ${n}px, 0px) scale(1)`,this.markerContainer.style.transition="",this.markerContainer.style.transformOrigin="center",this.markerContainer.style.transform=`translate3d(${-r}px, ${-n}px, 0px) scale(1)`,this.sceneContainer._tdt_pos=new T.Point(r,n),this.handleCameraChanged()}getZoomScale(t,r){const n=this.map.options.IW;return r=r===void 0?this.map.getZoom():r,n.scale(t)/n.scale(r)}zoomStartUpdate(t){const r=t.center,n=t.zoom,i=this.getZoomScale(n,this.map.getZoom()),a=T._Q.getPosition(this.sceneContainer),o=this.map.getSize().GQ(.5),s=this.map.options.IW.qW(this.map.getCenter(),n),u=this.map.options.IW.qW(r,n).DQ(s),c=new T.Point(o.x,o.y).GQ(-i);c.aQ(a),c.aQ(o),c.DQ(u),this.sceneContainer.style.transform=`translate3d(${c.x}px,${c.y}px,0px) scale(${i})`,this.sceneContainer.style.transformOrigin="0 0",this.sceneContainer.style.transition="transform 0.25s cubic-bezier(0,0,0.25,1)",this.handleCameraChanged()}getOverlayContainer(){var t;const r=(t=this.map.getPanes())===null||t===void 0?void 0:t.overlayPane,n=document.createElement("div");r.parentElement.appendChild(n),n.id="tdt-L7";const i=this.map.getSize();return n.style.zIndex="200",n.style.width=`${i.x}px`,n.style.height=`${i.y}px`,this.sceneContainer=n,n}init(){var t=this;return Oe(function*(){t.viewport=new VS;const{id:r,mapInstance:n,center:i=[121.30654632240122,31.25744185633306],token:a="b15e548080c79819617367d3f6095c69",minZoom:o=1,maxZoom:s=18,zoom:l=3}=t.config;if(window.T||(yield e7t({tk:a})),n){t.map=n,t.map.centerAndZoom(new window.T.LngLat(i[0],i[1]),l),t.$mapContainer=t.map.getContainer();const f=new window.T.LngLat(i[0],i[1]);t.map.centerAndZoom(f,l),t.setMinZoom(o),t.setMaxZoom(s)}else{if(!r)throw Error("No container id specified");t.$mapContainer=t.creatMapContainer(r);const f=new T.Map(t.$mapContainer,{center:window.T.LngLat(i[0],i[1]),minZoom:o,maxZoom:s,zoom:l,projection:"EPSG:900913"});t.map=f;const d=new window.T.Control.Zoom;f.addControl(d)}const c=t.map.getContainer().querySelector(".tdt-pane");c.style.zIndex=1,t.handleCameraChanged(),t.map.on("move",t.update,t),t.map.on("Ge",t.zoomStartUpdate,t),t.map.on("resize",t.resize,t)})()}destroy(){}on(t,r){if(e_.indexOf(t)!==-1)this.eventEmitter.on(t,r);else{const n=i=>{let a=this.evtCbProxyMap.get(i);if(a||this.evtCbProxyMap.set(i,a=new Map),a.get(r))return;const o=(...s)=>{s[0]&&typeof s[0]=="object"&&!s[0].lngLat&&!s[0].lnglat&&(s[0].lngLat=s[0].latlng||s[0].latLng,s[0].map=this.map),r(...s)};a.set(r,o),this.map.on(i,o)};Array.isArray(k1[t])?k1[t].forEach(i=>{n(i||t)}):n(k1[t]||t)}}off(t,r){if(e_.indexOf(t)!==-1){this.eventEmitter.off(t,r);return}const n=i=>{var a,o;const s=(a=this.evtCbProxyMap.get(t))===null||a===void 0?void 0:a.get(r);s&&((o=this.evtCbProxyMap.get(i))===null||o===void 0||o.delete(r),this.map.off(i,s))};Array.isArray(k1[t])?k1[t].forEach(i=>{n(i||t)}):n(k1[t]||t)}once(t,r){throw new Error("Method not implemented.")}getMapContainer(){return this.map.getContainer()}getType(){return"tdtmap"}getMapCanvasContainer(){var t;return(t=this.map.getContainer())===null||t===void 0?void 0:t.getElementsByClassName("tdt-container")[0]}getSize(){const t=this.map.getSize();return[t.x,t.y]}getZoom(){return this.map.getZoom()}setZoom(t){return this.map.setZoom(t)}getCenter(){return this.map.getCenter()}setCenter(t){const r=window.T.LngLat(t[0],t[1]);this.map.centerAndZoom(r,this.map.getZoom())}setZoomAndCenter(t,r){const n=window.T.LngLat(r[0],r[1]);this.map.centerAndZoom(n,t)}getPitch(){return 0}getRotation(){return 0}setRotation(t){this.map.setBearing(t)}zoomIn(t,r){this.map.zoomIn(t,r)}zoomOut(t,r){this.map.zoomOut(t,r)}panTo(t){this.map.panTo(t)}panBy(t=0,r=0){this.map.panBy([t,r])}fitBounds(t){const[r,n]=t;this.map.setViewport([new window.T.LngLat(r[0],r[1]),new window.T.LngLat(n[0],n[1])])}setMaxZoom(t){this.map.setMaxZoom(t)}setMinZoom(t){this.map.setMinZoom(t)}setMapStatus(t){t.doubleClickZoom===!0&&this.map.enableDoubleClickZoom(),t.doubleClickZoom===!1&&this.map.disableDoubleClickZoom(),t.dragEnable===!1&&this.map.disableDrag(),t.dragEnable===!0&&this.map.enableDrag(),t.keyboardEnable===!1&&this.map.disableKeyboard(),t.keyboardEnable===!0&&this.map.enableKeyboard(),t.zoomEnable===!1&&this.map.disableScrollWheelZoom(),t.zoomEnable===!0&&this.map.enableScrollWheelZoom()}getModelMatrix(){throw new Error("Method not implemented.")}pixelToLngLat([t,r]){const n=this.map.layerPointToLngLat({x:t,y:r});return{lng:n.lng,lat:n.lat}}lngLatToPixel([t,r]){const n=this.map.lngLatToLayerPoint({lng:t,lat:r});return{x:n.x,y:n.y}}containerToLngLat([t,r]){const n=this.map.containerPointToLngLat({x:t,y:r});return{lng:n.lng,lat:n.lat}}lngLatToContainer([t,r]){const n=this.map.lngLatToContainerPoint({lat:r,lng:t});return{x:n.x,y:n.y}}lngLatToCoord([t,r]){const n=this.lngLatToPixel([t,r]);return[n.x,n.y]}lngLatToCoords(t){return t.map(r=>Array.isArray(r[0])?this.lngLatToCoords(r):this.lngLatToCoord(r))}getBounds(){const t=this.map.getBounds(),r=t.getSouthWest(),n=t.getNorthEast();return[[r.lng,r.lat],[n.lng,n.lat]]}lngLatToMercator(t,r){const{x:n=0,y:i=0,z:a=0}=Hf.fromLngLat(t,r);return{x:n,y:i,z:a}}getCustomCoordCenter(){throw new Error("Method not implemented.")}creatMapContainer(t){let r=t;typeof t=="string"&&(r=document.getElementById(t));const n=document.createElement("div");return n.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,n.id="l7_tdt_div"+r7t++,r.appendChild(n),n}}class JLe extends HS{getServiceConstructor(){return n7t}}if(!window)throw Error("TMap JSAPI can only be used in Browser.");var Ld=function(e){return e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed",e}(Ld||{});const jv={key:"",version:"1.exp",libraries:[]};let Qv={TMap:Ld.notload};const fF=[],xH=e=>{if(typeof e=="function"){if(Qv.TMap===Ld.loaded){e(window.TMap);return}fF.push(e)}},i7t=e=>new Promise((t,r)=>{if(Qv.TMap===Ld.failed)r("");else if(Qv.TMap===Ld.notload){const{key:n,version:i,libraries:a}=e;if(!n){r("请填写key");return}jv.key=n,jv.version=i||jv.version,jv.libraries=a||jv.libraries,Qv.TMap=Ld.loading,window._onTMapAPILoaded=l=>{if(delete window._onTMapAPILoaded,l)Qv.TMap=Ld.failed,r(l);else for(Qv.TMap=Ld.loaded;fF.length;)fF.splice(0,1)[0](window.TMap)};const o=document.createElement("script");o.type="text/javascript",o.async=!1,o.src="https://map.qq.com/api/gljs?callback=_onTMapAPILoaded&v="+jv.version+"&key="+n+"&plugin="+jv.libraries.join(","),o.onerror=l=>{Qv.TMap=Ld.failed,r(l)},(document.body||document.head).appendChild(o),xH(t)}else if(Qv.TMap===Ld.loaded){if(e.key&&e.key!==jv.key){r("多个不一致的 key");return}if(e.version&&e.version!==jv.version){r("不允许多个版本 JSAPI 混用");return}xH(t)}}),a7t=()=>{delete window.TMap,Qv={TMap:Ld.notload}},o7t={load:i7t,reset:a7t},s7t=["id","mapInstance","center","token","version","libraries","minZoom","maxZoom","rotation","pitch","mapSize","logoVisible"];function l7t(e,t){var r=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(r||n)&&(t||(t=document),!!t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var a=t.body||t.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):t.documentElement.appendChild(i)}var o=t.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(t.createTextNode(e)),i.appendChild(o),o}}l7t(`img[src*='//mapapi.qq.com/web/jsapi/logo/logo_def.png'],.logo-text
{
  display: none !important;
}

.tencent-map > canvas + div {
  z-index: 3 !important;
}
`);const u7t="OB4BZ-D4W3U-B7VVO-4PJWW-6TKDJ-WPB77",c7t="1.exp",z1={mapmove:"center_changed",camerachange:["drag","pan","rotate","pitch","zoom"],zoomchange:"zoom",dragging:"drag"};class h7t extends KI{constructor(...t){super(...t),U(this,"viewport",null),U(this,"evtCbProxyMap",new Map),U(this,"handleCameraChanged",()=>{this.emit("mapchange");const r=this.map,{lng:n,lat:i}=r.getCenter(),a={center:[n,i],viewportHeight:r.getContainer().clientHeight,viewportWidth:r.getContainer().clientWidth,bearing:r.getHeading(),pitch:r.getPitch(),zoom:r.getZoom()-1};this.viewport.syncWithMapCamera(a),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)})}init(){var t=this;return Oe(function*(){var r;t.viewport=new VS;const n=t.config,{id:i,mapInstance:a,center:o=[121.30654632240122,31.25744185633306],token:s=u7t,version:l=c7t,libraries:u=[],minZoom:c=3,maxZoom:f=18,rotation:d=0,pitch:v=0,mapSize:g=1e4,logoVisible:x=!0}=n,w=Gh(n,s7t);if(window.TMap||a||(yield o7t.load({key:s,version:l,libraries:u})),a)t.map=a,t.$mapContainer=t.map.getContainer(),x===!1&&t.hideLogo();else{if(!i)throw Error("No container id specified");const M=kK(i),R=new TMap.Map(M,Ce({maxZoom:f,minZoom:c,rotation:d,pitch:v,showControl:!1,center:new TMap.LatLng(o[1],o[0])},w));t.map=R,t.$mapContainer=R.getContainer(),x===!1&&t.hideLogo()}t.map.canvasContainer.style.position="absolute",t.map.drawContainer.classList.add("tencent-map");const S=(r=t.map.controlManager.controlContainer)===null||r===void 0?void 0:r.parentNode;S&&(S.style.zIndex=2),t.simpleMapCoord.setSize(g),t.map.on("drag",t.handleCameraChanged),t.map.on("pan",t.handleCameraChanged),t.map.on("rotate",t.handleCameraChanged),t.map.on("pitch",t.handleCameraChanged),t.map.on("zoom",t.handleCameraChanged),t.handleCameraChanged()})()}destroy(){this.map.destroy()}onCameraChanged(t){this.cameraChangedCallback=t}addMarkerContainer(){const t=this.map.getContainer();this.markerContainer=Ua("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1"),this.markerContainer.style.zIndex="2"}getMarkerContainer(){return this.markerContainer}on(t,r){if(e_.indexOf(t)!==-1)this.eventEmitter.on(t,r);else{const n=i=>{let a=this.evtCbProxyMap.get(i);if(a||this.evtCbProxyMap.set(i,a=new Map),a.get(r))return;const o=(...s)=>{s[0]&&typeof s[0]=="object"&&!s[0].lngLat&&!s[0].lnglat&&(s[0].lngLat=s[0].latlng||s[0].latLng),r(...s)};a.set(r,o),this.map.on(i,o)};Array.isArray(z1[t])?z1[t].forEach(i=>{n(i||t)}):n(z1[t]||t)}}off(t,r){if(e_.indexOf(t)!==-1){this.eventEmitter.off(t,r);return}const n=i=>{var a,o;const s=(a=this.evtCbProxyMap.get(t))===null||a===void 0?void 0:a.get(r);s&&((o=this.evtCbProxyMap.get(i))===null||o===void 0||o.delete(r),this.map.off(i,s))};Array.isArray(z1[t])?z1[t].forEach(i=>{n(i||t)}):n(z1[t]||t)}once(){throw new Error("Method not implemented.")}getContainer(){return this.map.getContainer()}getSize(){return[this.map.width,this.map.height]}getMinZoom(){return this.map.transform._minZoom}getMaxZoom(){return this.map.transform._maxZoom}getType(){return"tmap"}getZoom(){return this.map.getZoom()}getCenter(){const{lng:t,lat:r}=this.map.getCenter();return{lng:t,lat:r}}getPitch(){return this.map.getPitch()}getRotation(){return this.map.getRotation()}getBounds(){const t=this.map.getBounds().getNorthEast(),r=this.map.getBounds().getSouthWest();return[[r.lng,r.lat],[t.lng,t.lat]]}getMapContainer(){return this.map.getContainer()}getMapCanvasContainer(){var t;return(t=this.map.getContainer())===null||t===void 0?void 0:t.getElementsByTagName("canvas")[0]}getCanvasOverlays(){var t;return(t=this.getMapCanvasContainer())===null||t===void 0||(t=t.nextSibling)===null||t===void 0?void 0:t.firstChild}getMapStyleConfig(){throw new Error("Method not implemented.")}setBgColor(t){this.bgColor=t}setMapStyle(t){this.map.setMapStyleId(t)}setRotation(t){this.map.setRotation(t)}zoomIn(){this.map.setZoom(this.getZoom()+1)}zoomOut(){this.map.setZoom(this.getZoom()-1)}panTo([t,r]){this.map.panTo(new TMap.LatLng(r,t))}panBy(t,r){this.map.panBy([t,r])}fitBounds(t,r){const[n,i]=t,a=new TMap.LatLng(n[1],n[0]),o=new TMap.LatLng(i[1],i[0]),s=new TMap.LatLngBounds(a,o);this.map.fitBounds(s,r)}setZoomAndCenter(t,[r,n]){this.map.setCenter(new TMap.LatLng(n,r)),this.map.setZoom(t)}setCenter([t,r]){this.map.setCenter(new TMap.LatLng(r,t))}setPitch(t){this.map.setPitch(t)}setZoom(t){this.map.setZoom(t)}setMapStatus(t){Object.keys(t).map(r=>{switch(r){case"doubleClickZoom":this.map.setDoubleClickZoom(!!t.doubleClickZoom);break;case"dragEnable":this.map.setDraggable(!!t.dragEnable);break;case"rotateEnable":this.map.setRotatable(!!t.rotateEnable);break;case"zoomEnable":this.map.setDoubleClickZoom(!!t.zoomEnable),this.map.setScrollable(!!t.zoomEnable);break;case"keyboardEnable":case"resizeEnable":case"showIndoorMap":throw Error("Options may bot be supported")}})}meterToCoord([t,r],[n,i]){const a=TMap.geometry.computeDistance([new TMap.LatLng(r,t),new TMap.LatLng(i,n)]),[o,s]=this.lngLatToCoord([t,r]),[l,u]=this.lngLatToCoord([n,i]);return Math.sqrt(Math.pow(o-l,2)+Math.pow(s-u,2))/a}pixelToLngLat([t,r]){const{lng:n,lat:i}=this.map.getCenter(),{x:a,y:o}=this.lngLatToPixel([n,i]),{x:s,y:l}=this.lngLatToContainer([n,i]),{lng:u,lat:c}=this.map.unprojectFromContainer(new TMap.Point(s+(t-a),l+(r-o)));return this.containerToLngLat([u,c])}lngLatToPixel([t,r]){const{x:n,y:i}=this.map.projectToWorldPlane(new TMap.LatLng(r,t));return{x:n,y:i}}containerToLngLat([t,r]){const{lng:n,lat:i}=this.map.unprojectFromContainer(new TMap.Point(t,r));return{lng:n,lat:i}}lngLatToContainer([t,r]){const{x:n,y:i}=this.map.projectToContainer(new TMap.LatLng(r,t));return{x:n,y:i}}lngLatToCoord([t,r]){const{x:n,y:i}=this.lngLatToPixel([t,r]);return[n,-i]}lngLatToCoords(t){return t.map(r=>Array.isArray(r[0])?this.lngLatToCoords(r):this.lngLatToCoord(r))}lngLatToMercator(t,r){const{x:n=0,y:i=0,z:a=0}=Hf.fromLngLat(t,r);return{x:n,y:i,z:a}}getModelMatrix(t,r,n,i=[1,1,1]){const a=this.viewport.projectFlat(t),o=A_();return Bh(o,o,su(a[0],a[1],r)),Nh(o,o,su(i[0],i[1],i[2])),M_(o,o,n[0]),NS(o,o,n[1]),Fb(o,o,n[2]),o}getCustomCoordCenter(){throw new Error("Method not implemented.")}exportMap(t){const r=this.getMapCanvasContainer();return t==="jpg"?r==null?void 0:r.toDataURL("image/jpeg"):r==null?void 0:r.toDataURL("image/png")}rotateY(){throw new Error("Method not implemented.")}hideLogo(){const t=this.map.getContainer();t&&Yp(t,"tmap-contianer--hide-logo")}}class tOe extends HS{getServiceConstructor(){return h7t}}const f7t=D4,d7t=D4,p7t=D4;function Gf(e){return e==null}var v7t=function(e,t,r){return e<t?t:e>r?r:e};const g7t=v7t;function ox(e){return typeof e=="number"}var btt={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function i(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function a(l,u,c,f,d){if(typeof c!="function")throw new TypeError("The listener must be a function");var v=new i(c,f||l,d),g=r?r+u:u;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],v]:l._events[g].push(v):(l._events[g]=v,l._eventsCount++),l}function o(l,u){--l._eventsCount===0?l._events=new n:delete l._events[u]}function s(){this._events=new n,this._eventsCount=0}s.prototype.eventNames=function(){var u=[],c,f;if(this._eventsCount===0)return u;for(f in c=this._events)t.call(c,f)&&u.push(r?f.slice(1):f);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},s.prototype.listeners=function(u){var c=r?r+u:u,f=this._events[c];if(!f)return[];if(f.fn)return[f.fn];for(var d=0,v=f.length,g=new Array(v);d<v;d++)g[d]=f[d].fn;return g},s.prototype.listenerCount=function(u){var c=r?r+u:u,f=this._events[c];return f?f.fn?1:f.length:0},s.prototype.emit=function(u,c,f,d,v,g){var x=r?r+u:u;if(!this._events[x])return!1;var w=this._events[x],S=arguments.length,M,R;if(w.fn){switch(w.once&&this.removeListener(u,w.fn,void 0,!0),S){case 1:return w.fn.call(w.context),!0;case 2:return w.fn.call(w.context,c),!0;case 3:return w.fn.call(w.context,c,f),!0;case 4:return w.fn.call(w.context,c,f,d),!0;case 5:return w.fn.call(w.context,c,f,d,v),!0;case 6:return w.fn.call(w.context,c,f,d,v,g),!0}for(R=1,M=new Array(S-1);R<S;R++)M[R-1]=arguments[R];w.fn.apply(w.context,M)}else{var I=w.length,P;for(R=0;R<I;R++)switch(w[R].once&&this.removeListener(u,w[R].fn,void 0,!0),S){case 1:w[R].fn.call(w[R].context);break;case 2:w[R].fn.call(w[R].context,c);break;case 3:w[R].fn.call(w[R].context,c,f);break;case 4:w[R].fn.call(w[R].context,c,f,d);break;default:if(!M)for(P=1,M=new Array(S-1);P<S;P++)M[P-1]=arguments[P];w[R].fn.apply(w[R].context,M)}}return!0},s.prototype.on=function(u,c,f){return a(this,u,c,f,!1)},s.prototype.once=function(u,c,f){return a(this,u,c,f,!0)},s.prototype.removeListener=function(u,c,f,d){var v=r?r+u:u;if(!this._events[v])return this;if(!c)return o(this,v),this;var g=this._events[v];if(g.fn)g.fn===c&&(!d||g.once)&&(!f||g.context===f)&&o(this,v);else{for(var x=0,w=[],S=g.length;x<S;x++)(g[x].fn!==c||d&&!g[x].once||f&&g[x].context!==f)&&w.push(g[x]);w.length?this._events[v]=w.length===1?w[0]:w:o(this,v)}return this},s.prototype.removeAllListeners=function(u){var c;return u?(c=r?r+u:u,this._events[c]&&o(this,c)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s})(btt);var m7t=btt.exports;const Ett=sa(m7t);var Ft;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.ALWAYS=519]="ALWAYS",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.GEQUAL=518]="GEQUAL",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",e[e.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",e[e.RGBA32F_EXT=34836]="RGBA32F_EXT",e[e.RGB32F_EXT=34837]="RGB32F_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",e[e.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.SRGB_EXT=35904]="SRGB_EXT",e[e.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",e[e.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",e[e.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",e[e.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",e[e.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",e[e.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",e[e.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",e[e.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",e[e.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",e[e.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",e[e.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",e[e.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",e[e.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",e[e.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",e[e.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",e[e.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",e[e.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",e[e.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",e[e.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",e[e.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",e[e.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",e[e.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",e[e.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",e[e.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",e[e.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",e[e.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",e[e.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",e[e.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",e[e.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",e[e.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",e[e.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",e[e.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",e[e.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",e[e.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",e[e.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",e[e.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",e[e.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT"})(Ft||(Ft={}));var ta;(function(e){e[e.Buffer=0]="Buffer",e[e.Texture=1]="Texture",e[e.RenderTarget=2]="RenderTarget",e[e.Sampler=3]="Sampler",e[e.Program=4]="Program",e[e.Bindings=5]="Bindings",e[e.InputLayout=6]="InputLayout",e[e.RenderPipeline=7]="RenderPipeline",e[e.ComputePipeline=8]="ComputePipeline",e[e.Readback=9]="Readback",e[e.QueryPool=10]="QueryPool",e[e.RenderBundle=11]="RenderBundle"})(ta||(ta={}));var ga;(function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"})(ga||(ga={}));var BC;(function(e){e[e.CCW=2305]="CCW",e[e.CW=2304]="CW"})(BC||(BC={}));var Wc;(function(e){e[e.NONE=0]="NONE",e[e.FRONT=1]="FRONT",e[e.BACK=2]="BACK",e[e.FRONT_AND_BACK=3]="FRONT_AND_BACK"})(Wc||(Wc={}));var Oi;(function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC=768]="SRC",e[e.ONE_MINUS_SRC=769]="ONE_MINUS_SRC",e[e.DST=774]="DST",e[e.ONE_MINUS_DST=775]="ONE_MINUS_DST",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.CONST=32769]="CONST",e[e.ONE_MINUS_CONSTANT=32770]="ONE_MINUS_CONSTANT",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"})(Oi||(Oi={}));var _l;(function(e){e[e.ADD=32774]="ADD",e[e.SUBSTRACT=32778]="SUBSTRACT",e[e.REVERSE_SUBSTRACT=32779]="REVERSE_SUBSTRACT",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX"})(_l||(_l={}));var sc;(function(e){e[e.CLAMP_TO_EDGE=0]="CLAMP_TO_EDGE",e[e.REPEAT=1]="REPEAT",e[e.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"})(sc||(sc={}));var es;(function(e){e[e.POINT=0]="POINT",e[e.BILINEAR=1]="BILINEAR"})(es||(es={}));var rl;(function(e){e[e.NO_MIP=0]="NO_MIP",e[e.NEAREST=1]="NEAREST",e[e.LINEAR=2]="LINEAR"})(rl||(rl={}));var Ls;(function(e){e[e.POINTS=0]="POINTS",e[e.TRIANGLES=1]="TRIANGLES",e[e.TRIANGLE_STRIP=2]="TRIANGLE_STRIP",e[e.LINES=3]="LINES",e[e.LINE_STRIP=4]="LINE_STRIP"})(Ls||(Ls={}));var ka;(function(e){e[e.MAP_READ=1]="MAP_READ",e[e.MAP_WRITE=2]="MAP_WRITE",e[e.COPY_SRC=4]="COPY_SRC",e[e.COPY_DST=8]="COPY_DST",e[e.INDEX=16]="INDEX",e[e.VERTEX=32]="VERTEX",e[e.UNIFORM=64]="UNIFORM",e[e.STORAGE=128]="STORAGE",e[e.INDIRECT=256]="INDIRECT",e[e.QUERY_RESOLVE=512]="QUERY_RESOLVE"})(ka||(ka={}));var $d;(function(e){e[e.STATIC=1]="STATIC",e[e.DYNAMIC=2]="DYNAMIC"})($d||($d={}));var s_;(function(e){e[e.VERTEX=1]="VERTEX",e[e.INSTANCE=2]="INSTANCE"})(s_||(s_={}));var bH;(function(e){e.LOADED="loaded"})(bH||(bH={}));var Pi;(function(e){e[e.TEXTURE_2D=0]="TEXTURE_2D",e[e.TEXTURE_2D_ARRAY=1]="TEXTURE_2D_ARRAY",e[e.TEXTURE_3D=2]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP=3]="TEXTURE_CUBE_MAP"})(Pi||(Pi={}));var ku;(function(e){e[e.SAMPLED=1]="SAMPLED",e[e.RENDER_TARGET=2]="RENDER_TARGET",e[e.STORAGE=4]="STORAGE"})(ku||(ku={}));var vl;(function(e){e[e.NONE=0]="NONE",e[e.RED=1]="RED",e[e.GREEN=2]="GREEN",e[e.BLUE=4]="BLUE",e[e.ALPHA=8]="ALPHA",e[e.RGB=7]="RGB",e[e.ALL=15]="ALL"})(vl||(vl={}));var Ho;(function(e){e[e.KEEP=7680]="KEEP",e[e.ZERO=0]="ZERO",e[e.REPLACE=7681]="REPLACE",e[e.INVERT=5386]="INVERT",e[e.INCREMENT_CLAMP=7682]="INCREMENT_CLAMP",e[e.DECREMENT_CLAMP=7683]="DECREMENT_CLAMP",e[e.INCREMENT_WRAP=34055]="INCREMENT_WRAP",e[e.DECREMENT_WRAP=34056]="DECREMENT_WRAP"})(Ho||(Ho={}));var $o;(function(e){e[e.Float=0]="Float",e[e.UnfilterableFloat=1]="UnfilterableFloat",e[e.Uint=2]="Uint",e[e.Sint=3]="Sint",e[e.Depth=4]="Depth"})($o||($o={}));var kd;(function(e){e[e.LOWER_LEFT=0]="LOWER_LEFT",e[e.UPPER_LEFT=1]="UPPER_LEFT"})(kd||(kd={}));var Qx;(function(e){e[e.NEGATIVE_ONE=0]="NEGATIVE_ONE",e[e.ZERO=1]="ZERO"})(Qx||(Qx={}));var dR;(function(e){e[e.OcclusionConservative=0]="OcclusionConservative"})(dR||(dR={}));var We;(function(e){e[e.U8=1]="U8",e[e.U16=2]="U16",e[e.U32=3]="U32",e[e.S8=4]="S8",e[e.S16=5]="S16",e[e.S32=6]="S32",e[e.F16=7]="F16",e[e.F32=8]="F32",e[e.BC1=65]="BC1",e[e.BC2=66]="BC2",e[e.BC3=67]="BC3",e[e.BC4_UNORM=68]="BC4_UNORM",e[e.BC4_SNORM=69]="BC4_SNORM",e[e.BC5_UNORM=70]="BC5_UNORM",e[e.BC5_SNORM=71]="BC5_SNORM",e[e.U16_PACKED_5551=97]="U16_PACKED_5551",e[e.U16_PACKED_565=98]="U16_PACKED_565",e[e.D24=129]="D24",e[e.D32F=130]="D32F",e[e.D24S8=131]="D24S8",e[e.D32FS8=132]="D32FS8"})(We||(We={}));var tn;(function(e){e[e.R=1]="R",e[e.RG=2]="RG",e[e.RGB=3]="RGB",e[e.RGBA=4]="RGBA",e[e.A=5]="A"})(tn||(tn={}));var Nr;(function(e){e[e.None=0]="None",e[e.Normalized=1]="Normalized",e[e.sRGB=2]="sRGB",e[e.Depth=4]="Depth",e[e.Stencil=8]="Stencil",e[e.RenderTarget=16]="RenderTarget",e[e.Luminance=32]="Luminance"})(Nr||(Nr={}));function _n(e,t,r){return e<<16|t<<8|r}var ee;(function(e){e[e.ALPHA=_n(We.U8,tn.A,Nr.None)]="ALPHA",e[e.U8_LUMINANCE=_n(We.U8,tn.A,Nr.Luminance)]="U8_LUMINANCE",e[e.F16_LUMINANCE=_n(We.F16,tn.A,Nr.Luminance)]="F16_LUMINANCE",e[e.F32_LUMINANCE=_n(We.F32,tn.A,Nr.Luminance)]="F32_LUMINANCE",e[e.F16_R=_n(We.F16,tn.R,Nr.None)]="F16_R",e[e.F16_RG=_n(We.F16,tn.RG,Nr.None)]="F16_RG",e[e.F16_RGB=_n(We.F16,tn.RGB,Nr.None)]="F16_RGB",e[e.F16_RGBA=_n(We.F16,tn.RGBA,Nr.None)]="F16_RGBA",e[e.F32_R=_n(We.F32,tn.R,Nr.None)]="F32_R",e[e.F32_RG=_n(We.F32,tn.RG,Nr.None)]="F32_RG",e[e.F32_RGB=_n(We.F32,tn.RGB,Nr.None)]="F32_RGB",e[e.F32_RGBA=_n(We.F32,tn.RGBA,Nr.None)]="F32_RGBA",e[e.U8_R=_n(We.U8,tn.R,Nr.None)]="U8_R",e[e.U8_R_NORM=_n(We.U8,tn.R,Nr.Normalized)]="U8_R_NORM",e[e.U8_RG=_n(We.U8,tn.RG,Nr.None)]="U8_RG",e[e.U8_RG_NORM=_n(We.U8,tn.RG,Nr.Normalized)]="U8_RG_NORM",e[e.U8_RGB=_n(We.U8,tn.RGB,Nr.None)]="U8_RGB",e[e.U8_RGB_NORM=_n(We.U8,tn.RGB,Nr.Normalized)]="U8_RGB_NORM",e[e.U8_RGB_SRGB=_n(We.U8,tn.RGB,Nr.sRGB|Nr.Normalized)]="U8_RGB_SRGB",e[e.U8_RGBA=_n(We.U8,tn.RGBA,Nr.None)]="U8_RGBA",e[e.U8_RGBA_NORM=_n(We.U8,tn.RGBA,Nr.Normalized)]="U8_RGBA_NORM",e[e.U8_RGBA_SRGB=_n(We.U8,tn.RGBA,Nr.sRGB|Nr.Normalized)]="U8_RGBA_SRGB",e[e.U16_R=_n(We.U16,tn.R,Nr.None)]="U16_R",e[e.U16_R_NORM=_n(We.U16,tn.R,Nr.Normalized)]="U16_R_NORM",e[e.U16_RG_NORM=_n(We.U16,tn.RG,Nr.Normalized)]="U16_RG_NORM",e[e.U16_RGBA_NORM=_n(We.U16,tn.RGBA,Nr.Normalized)]="U16_RGBA_NORM",e[e.U16_RGBA=_n(We.U16,tn.RGBA,Nr.None)]="U16_RGBA",e[e.U16_RGB=_n(We.U16,tn.RGB,Nr.None)]="U16_RGB",e[e.U16_RG=_n(We.U16,tn.RG,Nr.None)]="U16_RG",e[e.U32_R=_n(We.U32,tn.R,Nr.None)]="U32_R",e[e.U32_RG=_n(We.U32,tn.RG,Nr.None)]="U32_RG",e[e.U32_RGB=_n(We.U32,tn.RGB,Nr.None)]="U32_RGB",e[e.U32_RGBA=_n(We.U32,tn.RGBA,Nr.None)]="U32_RGBA",e[e.S8_R=_n(We.S8,tn.R,Nr.None)]="S8_R",e[e.S8_R_NORM=_n(We.S8,tn.R,Nr.Normalized)]="S8_R_NORM",e[e.S8_RG_NORM=_n(We.S8,tn.RG,Nr.Normalized)]="S8_RG_NORM",e[e.S8_RGB_NORM=_n(We.S8,tn.RGB,Nr.Normalized)]="S8_RGB_NORM",e[e.S8_RGBA_NORM=_n(We.S8,tn.RGBA,Nr.Normalized)]="S8_RGBA_NORM",e[e.S16_R=_n(We.S16,tn.R,Nr.None)]="S16_R",e[e.S16_RG=_n(We.S16,tn.RG,Nr.None)]="S16_RG",e[e.S16_RG_NORM=_n(We.S16,tn.RG,Nr.Normalized)]="S16_RG_NORM",e[e.S16_RGB_NORM=_n(We.S16,tn.RGB,Nr.Normalized)]="S16_RGB_NORM",e[e.S16_RGBA=_n(We.S16,tn.RGBA,Nr.None)]="S16_RGBA",e[e.S16_RGBA_NORM=_n(We.S16,tn.RGBA,Nr.Normalized)]="S16_RGBA_NORM",e[e.S32_R=_n(We.S32,tn.R,Nr.None)]="S32_R",e[e.S32_RG=_n(We.S32,tn.RG,Nr.None)]="S32_RG",e[e.S32_RGB=_n(We.S32,tn.RGB,Nr.None)]="S32_RGB",e[e.S32_RGBA=_n(We.S32,tn.RGBA,Nr.None)]="S32_RGBA",e[e.U16_RGBA_5551=_n(We.U16_PACKED_5551,tn.RGBA,Nr.Normalized)]="U16_RGBA_5551",e[e.U16_RGB_565=_n(We.U16_PACKED_565,tn.RGB,Nr.Normalized)]="U16_RGB_565",e[e.BC1=_n(We.BC1,tn.RGBA,Nr.Normalized)]="BC1",e[e.BC1_SRGB=_n(We.BC1,tn.RGBA,Nr.Normalized|Nr.sRGB)]="BC1_SRGB",e[e.BC2=_n(We.BC2,tn.RGBA,Nr.Normalized)]="BC2",e[e.BC2_SRGB=_n(We.BC2,tn.RGBA,Nr.Normalized|Nr.sRGB)]="BC2_SRGB",e[e.BC3=_n(We.BC3,tn.RGBA,Nr.Normalized)]="BC3",e[e.BC3_SRGB=_n(We.BC3,tn.RGBA,Nr.Normalized|Nr.sRGB)]="BC3_SRGB",e[e.BC4_UNORM=_n(We.BC4_UNORM,tn.R,Nr.Normalized)]="BC4_UNORM",e[e.BC4_SNORM=_n(We.BC4_SNORM,tn.R,Nr.Normalized)]="BC4_SNORM",e[e.BC5_UNORM=_n(We.BC5_UNORM,tn.RG,Nr.Normalized)]="BC5_UNORM",e[e.BC5_SNORM=_n(We.BC5_SNORM,tn.RG,Nr.Normalized)]="BC5_SNORM",e[e.D24=_n(We.D24,tn.R,Nr.Depth)]="D24",e[e.D24_S8=_n(We.D24S8,tn.RG,Nr.Depth|Nr.Stencil)]="D24_S8",e[e.D32F=_n(We.D32F,tn.R,Nr.Depth)]="D32F",e[e.D32F_S8=_n(We.D32FS8,tn.RG,Nr.Depth|Nr.Stencil)]="D32F_S8",e[e.U8_RGB_RT=_n(We.U8,tn.RGB,Nr.RenderTarget|Nr.Normalized)]="U8_RGB_RT",e[e.U8_RGBA_RT=_n(We.U8,tn.RGBA,Nr.RenderTarget|Nr.Normalized)]="U8_RGBA_RT",e[e.U8_RGBA_RT_SRGB=_n(We.U8,tn.RGBA,Nr.RenderTarget|Nr.Normalized|Nr.sRGB)]="U8_RGBA_RT_SRGB"})(ee||(ee={}));function W4(e){return e>>>8&255}function lv(e){return e>>>16&255}function Jx(e){return e&255}function wtt(e){switch(e){case We.F32:case We.U32:case We.S32:return 4;case We.U16:case We.S16:case We.F16:return 2;case We.U8:case We.S8:return 1;default:throw new Error("whoops")}}function Ctt(e){return wtt(lv(e))}function y7t(e){var t=wtt(lv(e)),r=W4(e);return t*r}function Stt(e){var t=Jx(e);if(t&Nr.Depth)return $o.Depth;if(t&Nr.Normalized)return $o.Float;var r=lv(e);if(r===We.F16||r===We.F32)return $o.Float;if(r===We.U8||r===We.U16||r===We.U32)return $o.Uint;if(r===We.S8||r===We.S16||r===We.S32)return $o.Sint;throw new Error("whoops")}function ni(e,t){if(t===void 0&&(t=""),!e)throw new Error("Assert fail: ".concat(t))}function Iy(e){if(e!=null)return e;throw new Error("Missing object")}function Ttt(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a}function Att(e,t){e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a}function Mtt(e){var t=e.r,r=e.g,n=e.b,i=e.a;return{r:t,g:r,b:n,a:i}}function WS(e,t,r,n){return n===void 0&&(n=1),{r:e,g:t,b:r,a:n}}var JI=WS(0,0,0,0);WS(0,0,0,1);var _7t=WS(1,1,1,0);WS(1,1,1,1);function pR(e){return!!(e&&!(e&e-1))}function mm(e,t){return e??t}function x7t(e){return e===void 0?null:e}function vR(e,t){var r=t-1;return e+r&~r}function b7t(e,t){for(var r=new Array(e),n=0;n<e;n++)r[n]=t();return r}function E7t(e,t){t===void 0&&(t=1);var r=e.split(`
`);return r.map(function(n,i){return"".concat(w7t(""+(t+i),4," "),"  ").concat(n)}).join(`
`)}function w7t(e,t,r){for(r===void 0&&(r="0");e.length<t;)e="".concat(r).concat(e);return e}function EH(e,t){e.blendDstFactor=t.blendDstFactor,e.blendSrcFactor=t.blendSrcFactor,e.blendMode=t.blendMode}function gR(e,t){return e===void 0&&(e={}),e.compare=t.compare,e.depthFailOp=t.depthFailOp,e.passOp=t.passOp,e.failOp=t.failOp,e.mask=t.mask,e}function Rtt(e,t){return e===void 0&&(e={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),EH(e.rgbBlendState,t.rgbBlendState),EH(e.alphaBlendState,t.alphaBlendState),e.channelWriteMask=t.channelWriteMask,e}function Itt(e,t){e.length!==t.length&&(e.length=t.length);for(var r=0;r<t.length;r++)e[r]=Rtt(e[r],t[r])}function C7t(e,t){t.attachmentsState!==void 0&&Itt(e.attachmentsState,t.attachmentsState),e.blendConstant&&t.blendConstant&&Att(e.blendConstant,t.blendConstant),e.depthCompare=mm(t.depthCompare,e.depthCompare),e.depthWrite=mm(t.depthWrite,e.depthWrite),e.stencilWrite=mm(t.stencilWrite,e.stencilWrite),e.stencilFront&&t.stencilFront&&gR(e.stencilFront,t.stencilFront),e.stencilBack&&t.stencilBack&&gR(e.stencilBack,t.stencilBack),e.cullMode=mm(t.cullMode,e.cullMode),e.frontFace=mm(t.frontFace,e.frontFace),e.polygonOffset=mm(t.polygonOffset,e.polygonOffset),e.polygonOffsetFactor=mm(t.polygonOffsetFactor,e.polygonOffsetFactor),e.polygonOffsetUnits=mm(t.polygonOffsetUnits,e.polygonOffsetUnits)}function tb(e){var t=Object.assign({},e);return t.attachmentsState=[],Itt(t.attachmentsState,e.attachmentsState),t.blendConstant=t.blendConstant&&Mtt(t.blendConstant),t.stencilFront=gR(void 0,e.stencilFront),t.stencilBack=gR(void 0,e.stencilBack),t}var wH={blendMode:_l.ADD,blendSrcFactor:Oi.ONE,blendDstFactor:Oi.ZERO},eb={attachmentsState:[{channelWriteMask:vl.ALL,rgbBlendState:wH,alphaBlendState:wH}],blendConstant:Mtt(JI),depthWrite:!0,depthCompare:ga.LEQUAL,stencilWrite:!1,stencilFront:{compare:ga.ALWAYS,passOp:Ho.KEEP,depthFailOp:Ho.KEEP,failOp:Ho.KEEP},stencilBack:{compare:ga.ALWAYS,passOp:Ho.KEEP,depthFailOp:Ho.KEEP,failOp:Ho.KEEP},cullMode:Wc.NONE,frontFace:BC.CCW,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0};function S7t(e,t){e===void 0&&(e=null),t===void 0&&(t=eb);var r=tb(t);return e!==null&&C7t(r,e),r}S7t({depthCompare:ga.ALWAYS,depthWrite:!1},eb);var Ltt={texture:null,sampler:null,formatKind:$o.Float,dimension:Pi.TEXTURE_2D};function Um(e,t,r){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!r(e[n],t[n]))return!1;return!0}function sx(e,t){for(var r=Array(e.length),n=0;n<e.length;n++)r[n]=t(e[n]);return r}function T7t(e,t){return e.texture===t.texture&&e.binding===t.binding}function CH(e,t){return e.buffer===t.buffer&&e.size===t.size&&e.binding===t.binding&&e.offset===t.offset}function A7t(e,t){return e===null?t===null:t===null?!1:e.sampler===t.sampler&&e.texture===t.texture&&e.dimension===t.dimension&&e.formatKind===t.formatKind&&e.comparison===t.comparison}function M7t(e,t){return e.samplerBindings=e.samplerBindings||[],e.uniformBufferBindings=e.uniformBufferBindings||[],e.storageBufferBindings=e.storageBufferBindings||[],e.storageTextureBindings=e.storageTextureBindings||[],t.samplerBindings=t.samplerBindings||[],t.uniformBufferBindings=t.uniformBufferBindings||[],t.storageBufferBindings=t.storageBufferBindings||[],t.storageTextureBindings=t.storageTextureBindings||[],!(e.samplerBindings.length!==t.samplerBindings.length||!Um(e.samplerBindings,t.samplerBindings,A7t)||!Um(e.uniformBufferBindings,t.uniformBufferBindings,CH)||!Um(e.storageBufferBindings,t.storageBufferBindings,CH)||!Um(e.storageTextureBindings,t.storageTextureBindings,T7t))}function SH(e,t){return e.blendMode==t.blendMode&&e.blendSrcFactor===t.blendSrcFactor&&e.blendDstFactor===t.blendDstFactor}function R7t(e,t){return!(!SH(e.rgbBlendState,t.rgbBlendState)||!SH(e.alphaBlendState,t.alphaBlendState)||e.channelWriteMask!==t.channelWriteMask)}function mR(e,t){return e.compare==t.compare&&e.depthFailOp===t.depthFailOp&&e.failOp===t.failOp&&e.passOp===t.passOp&&e.mask===t.mask}function I7t(e,t){return!Um(e.attachmentsState,t.attachmentsState,R7t)||e.blendConstant&&t.blendConstant&&!Ttt(e.blendConstant,t.blendConstant)||e.stencilFront&&t.stencilFront&&!mR(e.stencilFront,t.stencilFront)||e.stencilBack&&t.stencilBack&&!mR(e.stencilBack,t.stencilBack)?!1:e.depthCompare===t.depthCompare&&e.depthWrite===t.depthWrite&&e.stencilWrite===t.stencilWrite&&e.cullMode===t.cullMode&&e.frontFace===t.frontFace&&e.polygonOffset===t.polygonOffset&&e.polygonOffsetFactor===t.polygonOffsetFactor&&e.polygonOffsetUnits===t.polygonOffsetUnits}function Ott(e,t){return e.id===t.id}function L7t(e,t){return e===t}function O7t(e,t){return!(e.topology!==t.topology||e.inputLayout!==t.inputLayout||e.sampleCount!==t.sampleCount||e.megaStateDescriptor&&t.megaStateDescriptor&&!I7t(e.megaStateDescriptor,t.megaStateDescriptor)||!Ott(e.program,t.program)||!Um(e.colorAttachmentFormats,t.colorAttachmentFormats,L7t)||e.depthStencilAttachmentFormat!==t.depthStencilAttachmentFormat)}function P7t(e,t){return e.offset===t.offset&&e.shaderLocation===t.shaderLocation&&e.format===t.format&&e.divisor===t.divisor}function D7t(e,t){return Gf(e)?Gf(t):Gf(t)?!1:e.arrayStride===t.arrayStride&&e.stepMode===t.stepMode&&Um(e.attributes,t.attributes,P7t)}function F7t(e,t){return!(e.indexBufferFormat!==t.indexBufferFormat||!Um(e.vertexBufferDescriptors,t.vertexBufferDescriptors,D7t)||!Ott(e.program,t.program))}function B7t(e){var t=e.sampler,r=e.texture,n=e.dimension,i=e.formatKind,a=e.comparison;return{sampler:t,texture:r,dimension:n,formatKind:i,comparison:a}}function TH(e){var t=e.buffer,r=e.size,n=e.binding,i=e.offset;return{binding:n,buffer:t,offset:i,size:r}}function N7t(e){var t=e.binding,r=e.texture;return{binding:t,texture:r}}function k7t(e){var t=e.samplerBindings&&sx(e.samplerBindings,B7t),r=e.uniformBufferBindings&&sx(e.uniformBufferBindings,TH),n=e.storageBufferBindings&&sx(e.storageBufferBindings,TH),i=e.storageTextureBindings&&sx(e.storageTextureBindings,N7t);return{samplerBindings:t,uniformBufferBindings:r,storageBufferBindings:n,storageTextureBindings:i,pipeline:e.pipeline}}function z7t(e){var t=e.inputLayout,r=e.program,n=e.topology,i=e.megaStateDescriptor&&tb(e.megaStateDescriptor),a=e.colorAttachmentFormats.slice(),o=e.depthStencilAttachmentFormat,s=e.sampleCount;return{inputLayout:t,megaStateDescriptor:i,program:r,topology:n,colorAttachmentFormats:a,depthStencilAttachmentFormat:o,sampleCount:s}}function U7t(e){var t=e.shaderLocation,r=e.format,n=e.offset,i=e.divisor;return{shaderLocation:t,format:r,offset:n,divisor:i}}function $7t(e){if(Gf(e))return e;var t=e.arrayStride,r=e.stepMode,n=sx(e.attributes,U7t);return{arrayStride:t,stepMode:r,attributes:n}}function H7t(e){var t=sx(e.vertexBufferDescriptors,$7t),r=e.indexBufferFormat,n=e.program;return{vertexBufferDescriptors:t,indexBufferFormat:r,program:n}}var zi,V7t=/([^[]*)(\[[0-9]+\])?/;function G7t(e){if(e[e.length-1]!=="]")return{name:e,length:1,isArray:!1};var t=e.match(V7t);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(e));return{name:t[1],length:Number(t[2])||1,isArray:!!t[2]}}function ec(){var e=null;return function(t,r,n){var i=e!==n;return i&&(t.uniform1i(r,n),e=n),i}}function No(e,t,r,n){var i=null,a=null;return function(o,s,l){var u=t(l,r),c=u.length,f=!1;if(i===null)i=new Float32Array(c),a=c,f=!0;else{ni(a===c,"Uniform length cannot change.");for(var d=0;d<c;++d)if(u[d]!==i[d]){f=!0;break}}return f&&(n(o,e,s,u),i.set(u)),f}}function Pu(e,t,r,n){e[t](r,n)}function Yv(e,t,r,n){e[t](r,!1,n)}var W7t={},X7t={},j7t={},AH=[0];function X4(e,t,r,n){t===1&&typeof e=="boolean"&&(e=e?1:0),Number.isFinite(e)&&(AH[0]=e,e=AH);var i=e.length;if(e instanceof r)return e;var a=n[i];a||(a=new r(i),n[i]=a);for(var o=0;o<i;o++)a[o]=e[o];return a}function Oh(e,t){return X4(e,t,Float32Array,W7t)}function ym(e,t){return X4(e,t,Int32Array,X7t)}function WT(e,t){return X4(e,t,Uint32Array,j7t)}var Y7t=(zi={},zi[Ft.FLOAT]=No.bind(null,"uniform1fv",Oh,1,Pu),zi[Ft.FLOAT_VEC2]=No.bind(null,"uniform2fv",Oh,2,Pu),zi[Ft.FLOAT_VEC3]=No.bind(null,"uniform3fv",Oh,3,Pu),zi[Ft.FLOAT_VEC4]=No.bind(null,"uniform4fv",Oh,4,Pu),zi[Ft.INT]=No.bind(null,"uniform1iv",ym,1,Pu),zi[Ft.INT_VEC2]=No.bind(null,"uniform2iv",ym,2,Pu),zi[Ft.INT_VEC3]=No.bind(null,"uniform3iv",ym,3,Pu),zi[Ft.INT_VEC4]=No.bind(null,"uniform4iv",ym,4,Pu),zi[Ft.BOOL]=No.bind(null,"uniform1iv",ym,1,Pu),zi[Ft.BOOL_VEC2]=No.bind(null,"uniform2iv",ym,2,Pu),zi[Ft.BOOL_VEC3]=No.bind(null,"uniform3iv",ym,3,Pu),zi[Ft.BOOL_VEC4]=No.bind(null,"uniform4iv",ym,4,Pu),zi[Ft.FLOAT_MAT2]=No.bind(null,"uniformMatrix2fv",Oh,4,Yv),zi[Ft.FLOAT_MAT3]=No.bind(null,"uniformMatrix3fv",Oh,9,Yv),zi[Ft.FLOAT_MAT4]=No.bind(null,"uniformMatrix4fv",Oh,16,Yv),zi[Ft.UNSIGNED_INT]=No.bind(null,"uniform1uiv",WT,1,Pu),zi[Ft.UNSIGNED_INT_VEC2]=No.bind(null,"uniform2uiv",WT,2,Pu),zi[Ft.UNSIGNED_INT_VEC3]=No.bind(null,"uniform3uiv",WT,3,Pu),zi[Ft.UNSIGNED_INT_VEC4]=No.bind(null,"uniform4uiv",WT,4,Pu),zi[Ft.FLOAT_MAT2x3]=No.bind(null,"uniformMatrix2x3fv",Oh,6,Yv),zi[Ft.FLOAT_MAT2x4]=No.bind(null,"uniformMatrix2x4fv",Oh,8,Yv),zi[Ft.FLOAT_MAT3x2]=No.bind(null,"uniformMatrix3x2fv",Oh,6,Yv),zi[Ft.FLOAT_MAT3x4]=No.bind(null,"uniformMatrix3x4fv",Oh,12,Yv),zi[Ft.FLOAT_MAT4x2]=No.bind(null,"uniformMatrix4x2fv",Oh,8,Yv),zi[Ft.FLOAT_MAT4x3]=No.bind(null,"uniformMatrix4x3fv",Oh,12,Yv),zi[Ft.SAMPLER_2D]=ec,zi[Ft.SAMPLER_CUBE]=ec,zi[Ft.SAMPLER_3D]=ec,zi[Ft.SAMPLER_2D_SHADOW]=ec,zi[Ft.SAMPLER_2D_ARRAY]=ec,zi[Ft.SAMPLER_2D_ARRAY_SHADOW]=ec,zi[Ft.SAMPLER_CUBE_SHADOW]=ec,zi[Ft.INT_SAMPLER_2D]=ec,zi[Ft.INT_SAMPLER_3D]=ec,zi[Ft.INT_SAMPLER_CUBE]=ec,zi[Ft.INT_SAMPLER_2D_ARRAY]=ec,zi[Ft.UNSIGNED_INT_SAMPLER_2D]=ec,zi[Ft.UNSIGNED_INT_SAMPLER_3D]=ec,zi[Ft.UNSIGNED_INT_SAMPLER_CUBE]=ec,zi[Ft.UNSIGNED_INT_SAMPLER_2D_ARRAY]=ec,zi);function MH(e,t,r){var n=Y7t[r.type];if(!n)throw new Error("Unknown GLSL uniform type ".concat(r.type));return n().bind(null,e,t)}var Z7t={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function q7t(e){return Object.prototype.toString.call(e)in Z7t}function rw(e,t){return"#define ".concat(e," ").concat(t)}function K7t(e){var t={};return e.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,function(r,n,i){var a=Number(i);return t[n]=isNaN(a)?i:a,""}),t}function Q7t(e,t){var r=[];return e.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,function(n,i,a){var o=Number(i);return r.push({location:isNaN(o)?t[i]:o,name:a}),""}),r}function RH(e){if(e===void 0)return null;var t=/binding\s*=\s*(\d+)/.exec(e);if(t!==null){var r=parseInt(t[1],10);if(!Number.isNaN(r))return r}return null}function IH(e){var t="",r=e;return[r,t]}function rb(e,t,r,n,i){var a;n===void 0&&(n=null),i===void 0&&(i=!0);var o=e.glslVersion==="#version 100",s=t==="frag"&&((a=r.match(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm))===null||a===void 0?void 0:a.length)>1,l=r.replace(`\r
`,`
`).split(`
`).map(function(k){return k.replace(/[/][/].*$/,"")}).filter(function(k){var z=!k||/^\s+$/.test(k);return!z}),u="";n!==null&&(u=Object.keys(n).map(function(k){return rw(k,n[k])}).join(`
`));var c=l.find(function(k){return k.startsWith("precision")})||"precision mediump float;",f=i?l.filter(function(k){return!k.startsWith("precision")}).join(`
`):l.join(`
`),d="";if(e.viewportOrigin===kd.UPPER_LEFT&&(d+="".concat(rw("VIEWPORT_ORIGIN_TL","1"),`
`)),e.clipSpaceNearZ===Qx.ZERO&&(d+="".concat(rw("CLIPSPACE_NEAR_ZERO","1"),`
`)),e.explicitBindingLocations){var v=0,g=0,x=0;f=f.replace(/^\s*(layout\((.*)\))?\s*uniform(.+{)$/gm,function(k,z,G,J){var Z=G?"".concat(G,", "):"";return"layout(".concat(Z,"set = ").concat(v,", binding = ").concat(g++,") uniform ").concat(J)}),v++,g=0,ni(e.separateSamplerTextures),f=f.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(k,z,G,J,Z){var X=RH(G);X===null&&(X=g++);var et=Pr(IH(J),2),at=et[0],wt=et[1];return t==="frag"?`
layout(set = `.concat(v,", binding = ").concat(X*2+0,") uniform texture").concat(at," T_").concat(Z,`;
layout(set = `).concat(v,", binding = ").concat(X*2+1,") uniform sampler").concat(wt," S_").concat(Z,";").trim():""}),f=f.replace(t==="frag"?/^\s*\b(varying|in)\b/gm:/^\s*\b(varying|out)\b/gm,function(k,z){return"layout(location = ".concat(x++,") ").concat(z)}),d+="".concat(rw("gl_VertexID","gl_VertexIndex"),`
`),d+="".concat(rw("gl_InstanceID","gl_InstanceIndex"),`
`),c=c.replace(/^precision (.*) sampler(.*);$/gm,"")}else{var w=0;f=f.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(k,z,G,J,Z){var X=RH(G);return X===null&&(X=w++),"uniform sampler".concat(J," ").concat(Z,"; // BINDING=").concat(X)})}if(f=f.replace(/\bPU_SAMPLER_(\w+)\((.*?)\)/g,function(k,z,G){return"SAMPLER_".concat(z,"(P_").concat(G,")")}),f=f.replace(/\bPF_SAMPLER_(\w+)\((.*?)\)/g,function(k,z,G){return"PP_SAMPLER_".concat(z,"(P_").concat(G,")")}),f=f.replace(/\bPU_TEXTURE\((.*?)\)/g,function(k,z){return"TEXTURE(P_".concat(z,")")}),e.separateSamplerTextures)f=f.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,function(k,z,G){var J=Pr(IH(z),2),Z=J[0],X=J[1];return"texture".concat(Z," T_P_").concat(G,", sampler").concat(X," S_P_").concat(G)}),f=f.replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,function(k,z,G){return"T_".concat(G,", S_").concat(G)}),f=f.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(k,z,G){return"sampler".concat(z,"(T_").concat(G,", S_").concat(G,")")}),f=f.replace(/\bTEXTURE\((.*?)\)/g,function(k,z){return"T_".concat(z)});else{var S=[];f=f.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,function(k,z,G){return"sampler".concat(z," P_").concat(G)}),f=f.replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,function(k,z,G){return G}),f=f.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(k,z,G){return S.push([G,z]),G}),o&&S.forEach(function(k){var z=Pr(k,2),G=z[0],J=z[1];f=f.replace(new RegExp("texture\\(".concat(G),"g"),function(){return"texture".concat(J,"(").concat(G)})}),f=f.replace(/\bTEXTURE\((.*?)\)/g,function(k,z){return z})}var M="".concat(o?"":e.glslVersion,`
`).concat(o&&s?`#extension GL_EXT_draw_buffers : require
`:"",`
`).concat(o&&t==="frag"?`#extension GL_OES_standard_derivatives : enable
`:"").concat(i?c:"",`
`).concat(d||"").concat(u?u+`
`:"",`
`).concat(f,`
`).trim();if(e.explicitBindingLocations&&t==="frag"&&(M=M.replace(/^\b(out)\b/g,function(k,z){return"layout(location = 0) ".concat(z)})),o){if(t==="frag"&&(M=M.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,function(k,z,G){return"varying ".concat(z," ").concat(G,`;
`)})),t==="vert"&&(M=M.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(k,z,G){return"varying ".concat(z," ").concat(G,`;
`)}),M=M.replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,function(k,z,G){return"attribute ".concat(z," ").concat(G,`;
`)})),M=M.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,function(k,z){return z.trim().replace(/^.*$/gm,function(G){var J=G.trim();return J.startsWith("#")?J:G?"uniform ".concat(J):""})}),t==="frag")if(s){var R=[];M=M.replace(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm,function(k,z){return R.push(z),"vec4 ".concat(z,`;
`)});var I=M.lastIndexOf("}");M=M.substring(0,I)+`
    `.concat(R.map(function(k,z){return"gl_FragData[".concat(z,"] = ").concat(k,`;
    `)}).join(`
`))+M.substring(I)}else{var P;if(M=M.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(k,z,G){return P=G,"".concat(z," ").concat(G,`;
`)}),P){var I=M.lastIndexOf("}");M=M.substring(0,I)+`
  gl_FragColor = vec4(`.concat(P,`);
`)+M.substring(I)}}M=M.replace(/^\s*layout\((.*)\)/gm,"")}return M}var id=function(e){$t(t,e);function t(r){var n=r.id,i=r.device,a=e.call(this)||this;return a.id=n,a.device=i,a.device.resourceCreationTracker!==null&&a.device.resourceCreationTracker.trackResourceCreated(a),a}return t.prototype.destroy=function(){this.device.resourceCreationTracker!==null&&this.device.resourceCreationTracker.trackResourceDestroyed(this)},t}(Ett),J7t=function(e){$t(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,o=e.call(this,{id:n,device:i})||this;o.type=ta.Bindings;var s=a.uniformBufferBindings,l=a.samplerBindings;return o.uniformBufferBindings=s||[],o.samplerBindings=l||[],o.bindingLayouts=o.createBindingLayouts(),o}return t.prototype.createBindingLayouts=function(){var r=0,n=0,i=[],a=this.uniformBufferBindings.length,o=this.samplerBindings.length;return i.push({firstUniformBuffer:r,numUniformBuffers:a,firstSampler:n,numSamplers:o}),r+=a,n+=o,{numUniformBuffers:r,numSamplers:n,bindingLayoutTables:i}},t}(id),nw;function cn(e){return nw!==void 0?nw:typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?(nw=!0,!0):(nw=!!(e&&e._version===2),nw)}function Ptt(e){var t=lv(e);switch(t){case We.BC1:case We.BC2:case We.BC3:case We.BC4_UNORM:case We.BC4_SNORM:case We.BC5_UNORM:case We.BC5_SNORM:return!0;default:return!1}}function Dtt(e){var t=Jx(e);if(t&Nr.Normalized)return!1;var r=lv(e);return r===We.S8||r===We.S16||r===We.S32||r===We.U8||r===We.U16||r===We.U32}function tzt(e){switch(e){case $d.STATIC:return Ft.STATIC_DRAW;case $d.DYNAMIC:return Ft.DYNAMIC_DRAW}}function LH(e){if(e&ka.INDEX)return Ft.ELEMENT_ARRAY_BUFFER;if(e&ka.VERTEX)return Ft.ARRAY_BUFFER;if(e&ka.UNIFORM)return Ft.UNIFORM_BUFFER}function ezt(e){switch(e){case Ls.TRIANGLES:return Ft.TRIANGLES;case Ls.POINTS:return Ft.POINTS;case Ls.TRIANGLE_STRIP:return Ft.TRIANGLE_STRIP;case Ls.LINES:return Ft.LINES;case Ls.LINE_STRIP:return Ft.LINE_STRIP;default:throw new Error("Unknown primitive topology mode")}}function rzt(e){switch(e){case We.U8:return Ft.UNSIGNED_BYTE;case We.U16:return Ft.UNSIGNED_SHORT;case We.U32:return Ft.UNSIGNED_INT;case We.S8:return Ft.BYTE;case We.S16:return Ft.SHORT;case We.S32:return Ft.INT;case We.F16:return Ft.HALF_FLOAT;case We.F32:return Ft.FLOAT;default:throw new Error("whoops")}}function nzt(e){switch(e){case tn.R:return 1;case tn.RG:return 2;case tn.RGB:return 3;case tn.RGBA:return 4;default:return 1}}function izt(e){var t=lv(e),r=W4(e),n=Jx(e),i=rzt(t),a=nzt(r),o=!!(n&Nr.Normalized);return{size:a,type:i,normalized:o}}function azt(e){switch(e){case ee.U8_R:return Ft.UNSIGNED_BYTE;case ee.U16_R:return Ft.UNSIGNED_SHORT;case ee.U32_R:return Ft.UNSIGNED_INT;default:throw new Error("whoops")}}function iw(e){switch(e){case sc.CLAMP_TO_EDGE:return Ft.CLAMP_TO_EDGE;case sc.REPEAT:return Ft.REPEAT;case sc.MIRRORED_REPEAT:return Ft.MIRRORED_REPEAT;default:throw new Error("whoops")}}function XT(e,t){if(t===rl.LINEAR&&e===es.BILINEAR)return Ft.LINEAR_MIPMAP_LINEAR;if(t===rl.LINEAR&&e===es.POINT)return Ft.NEAREST_MIPMAP_LINEAR;if(t===rl.NEAREST&&e===es.BILINEAR)return Ft.LINEAR_MIPMAP_NEAREST;if(t===rl.NEAREST&&e===es.POINT)return Ft.NEAREST_MIPMAP_NEAREST;if(t===rl.NO_MIP&&e===es.BILINEAR)return Ft.LINEAR;if(t===rl.NO_MIP&&e===es.POINT)return Ft.NEAREST;throw new Error("Unknown texture filter mode")}function Sx(e,t){t===void 0&&(t=0);var r=e;return r.gl_buffer_pages[t/r.pageByteSize|0]}function K1(e){var t=e;return t.gl_texture}function dF(e){var t=e;return t.gl_sampler}function aw(e,t){e.name=t,e.__SPECTOR_Metadata={name:t}}function OH(e,t){for(var r=[];;){var n=t.exec(e);if(!n)break;r.push(n)}return r}function _m(e){return e.blendMode==_l.ADD&&e.blendSrcFactor==Oi.ONE&&e.blendDstFactor===Oi.ZERO}function ozt(e){switch(e){case dR.OcclusionConservative:return Ft.ANY_SAMPLES_PASSED_CONSERVATIVE;default:throw new Error("whoops")}}function szt(e){if(e===Pi.TEXTURE_2D)return Ft.TEXTURE_2D;if(e===Pi.TEXTURE_2D_ARRAY)return Ft.TEXTURE_2D_ARRAY;if(e===Pi.TEXTURE_CUBE_MAP)return Ft.TEXTURE_CUBE_MAP;if(e===Pi.TEXTURE_3D)return Ft.TEXTURE_3D;throw new Error("whoops")}function jO(e,t,r,n){return!(e%r!==0||t%n!==0)}var lzt=function(e){$t(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,o=e.call(this,{id:n,device:i})||this;o.type=ta.Buffer;var s=a.viewOrSize,l=a.usage,u=a.hint,c=u===void 0?$d.STATIC:u,f=i.uniformBufferMaxPageByteSize,d=i.gl,v=l&ka.UNIFORM;v||(cn(d)?d.bindVertexArray(null):i.OES_vertex_array_object.bindVertexArrayOES(null));var g=ox(s)?vR(s,4):vR(s.byteLength,4);o.gl_buffer_pages=[];var x;if(v){for(var w=g;w>0;)o.gl_buffer_pages.push(o.createBufferPage(Math.min(w,f),l,c)),w-=f;x=f}else o.gl_buffer_pages.push(o.createBufferPage(g,l,c)),x=g;return o.pageByteSize=x,o.byteSize=g,o.usage=l,o.gl_target=LH(l),ox(s)||o.setSubData(0,new Uint8Array(s.buffer)),v||(cn(d)?d.bindVertexArray(o.device.currentBoundVAO):i.OES_vertex_array_object.bindVertexArrayOES(o.device.currentBoundVAO)),o}return t.prototype.setSubData=function(r,n,i,a){i===void 0&&(i=0),a===void 0&&(a=n.byteLength-i);for(var o=this.device.gl,s=this.pageByteSize,l=r+a,u=r,c=r%s;u<l;){var f=cn(o)?o.COPY_WRITE_BUFFER:this.gl_target,d=Sx(this,u);if(d.ubo)return;o.bindBuffer(f,d),cn(o)?o.bufferSubData(f,c,n,i,Math.min(l-u,s)):o.bufferSubData(f,c,n),u+=s,c=0,i+=s,this.device.debugGroupStatisticsBufferUpload()}},t.prototype.destroy=function(){e.prototype.destroy.call(this);for(var r=0;r<this.gl_buffer_pages.length;r++)this.gl_buffer_pages[r].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[r]);this.gl_buffer_pages=[]},t.prototype.createBufferPage=function(r,n,i){var a=this.device.gl,o=n&ka.UNIFORM;if(!cn(a)&&o)return{ubo:!0};var s=this.device.ensureResourceExists(a.createBuffer()),l=LH(n),u=tzt(i);return a.bindBuffer(l,s),a.bufferData(l,r,u),s},t}(id),uzt=function(e){$t(t,e);function t(r){var n,i,a,o,s=r.id,l=r.device,u=r.descriptor,c,f=e.call(this,{id:s,device:l})||this;f.type=ta.InputLayout;var d=u.vertexBufferDescriptors,v=u.indexBufferFormat,g=u.program;ni(v===ee.U16_R||v===ee.U32_R||v===null);var x=v!==null?azt(v):null,w=v!==null?Ctt(v):null,S=f.device.gl,M=f.device.ensureResourceExists(cn(S)?S.createVertexArray():l.OES_vertex_array_object.createVertexArrayOES());cn(S)?S.bindVertexArray(M):l.OES_vertex_array_object.bindVertexArrayOES(M),S.bindBuffer(S.ARRAY_BUFFER,Sx(f.device.fallbackVertexBuffer));try{for(var R=yi(u.vertexBufferDescriptors),I=R.next();!I.done;I=R.next()){var P=I.value,k=P.stepMode,z=P.attributes;try{for(var G=(a=void 0,yi(z)),J=G.next();!J.done;J=G.next()){var Z=J.value,X=Z.shaderLocation,et=Z.format,at=Z.divisor,wt=at===void 0?1:at,Tt=cn(S)?X:(c=g.attributes[X])===null||c===void 0?void 0:c.location,vt=izt(et);if(Z.vertexFormat=vt,!Gf(Tt)){Dtt(et);var zt=vt.size,oe=vt.type,Qt=vt.normalized;S.vertexAttribPointer(Tt,zt,oe,Qt,0,0),k===s_.INSTANCE&&(cn(S)?S.vertexAttribDivisor(Tt,wt):l.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(Tt,wt)),S.enableVertexAttribArray(Tt)}}}catch(ne){a={error:ne}}finally{try{J&&!J.done&&(o=G.return)&&o.call(G)}finally{if(a)throw a.error}}}}catch(ne){n={error:ne}}finally{try{I&&!I.done&&(i=R.return)&&i.call(R)}finally{if(n)throw n.error}}return cn(S)?S.bindVertexArray(null):l.OES_vertex_array_object.bindVertexArrayOES(null),f.vertexBufferDescriptors=d,f.vao=M,f.indexBufferFormat=v,f.indexBufferType=x,f.indexBufferCompByteSize=w,f.program=g,f}return t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.currentBoundVAO===this.vao&&(cn(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)},t}(id),pF=function(e){$t(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,o=r.fake,s=e.call(this,{id:n,device:i})||this;s.type=ta.Texture,a=$({dimension:Pi.TEXTURE_2D,depthOrArrayLayers:1,mipLevelCount:1},a);var l=s.device.gl,u,c,f=s.clampmipLevelCount(a);if(s.immutable=a.usage===ku.RENDER_TARGET,s.pixelStore=a.pixelStore,s.format=a.format,s.dimension=a.dimension,s.formatKind=Stt(a.format),s.width=a.width,s.height=a.height,s.depthOrArrayLayers=a.depthOrArrayLayers,s.mipmaps=f>=1,!o){c=s.device.ensureResourceExists(l.createTexture());var d=s.device.translateTextureType(a.format),v=s.device.translateTextureInternalFormat(a.format);if(s.device.setActiveTexture(l.TEXTURE0),s.device.currentTextures[0]=null,s.preprocessImage(),a.dimension===Pi.TEXTURE_2D){if(u=Ft.TEXTURE_2D,l.bindTexture(u,c),s.immutable)if(cn(l))l.texStorage2D(u,f,v,a.width,a.height);else{var g=(v===Ft.DEPTH_COMPONENT||s.isNPOT(),0);(s.format===ee.D32F||s.format===ee.D24_S8)&&!cn(l)&&!i.WEBGL_depth_texture||(l.texImage2D(u,g,v,a.width,a.height,0,v,d,null),s.mipmaps&&(s.mipmaps=!1,l.texParameteri(Ft.TEXTURE_2D,Ft.TEXTURE_MIN_FILTER,Ft.LINEAR),l.texParameteri(Ft.TEXTURE_2D,Ft.TEXTURE_WRAP_S,Ft.CLAMP_TO_EDGE),l.texParameteri(Ft.TEXTURE_2D,Ft.TEXTURE_WRAP_T,Ft.CLAMP_TO_EDGE)))}ni(a.depthOrArrayLayers===1)}else if(a.dimension===Pi.TEXTURE_2D_ARRAY)u=Ft.TEXTURE_2D_ARRAY,l.bindTexture(u,c),s.immutable&&cn(l)&&l.texStorage3D(u,f,v,a.width,a.height,a.depthOrArrayLayers);else if(a.dimension===Pi.TEXTURE_3D)u=Ft.TEXTURE_3D,l.bindTexture(u,c),s.immutable&&cn(l)&&l.texStorage3D(u,f,v,a.width,a.height,a.depthOrArrayLayers);else if(a.dimension===Pi.TEXTURE_CUBE_MAP)u=Ft.TEXTURE_CUBE_MAP,l.bindTexture(u,c),s.immutable&&cn(l)&&l.texStorage2D(u,f,v,a.width,a.height),ni(a.depthOrArrayLayers===6);else throw new Error("whoops")}return s.gl_texture=c,s.gl_target=u,s.mipLevelCount=f,s}return t.prototype.setImageData=function(r,n){n===void 0&&(n=0);var i=this.device.gl;Ptt(this.format);var a=this.gl_target===Ft.TEXTURE_3D||this.gl_target===Ft.TEXTURE_2D_ARRAY,o=this.gl_target===Ft.TEXTURE_CUBE_MAP,s=q7t(r[0]);this.device.setActiveTexture(i.TEXTURE0),this.device.currentTextures[0]=null;var l=r[0],u,c;s?(u=this.width,c=this.height):(u=l.width,c=l.height,this.width=u,this.height=c),i.bindTexture(this.gl_target,this.gl_texture);var f=this.device.translateTextureFormat(this.format),d=cn(i)?this.device.translateInternalTextureFormat(this.format):f,v=this.device.translateTextureType(this.format);this.preprocessImage();for(var g=0;g<this.depthOrArrayLayers;g++){var x=r[g],w=this.gl_target;o&&(w=Ft.TEXTURE_CUBE_MAP_POSITIVE_X+g%6),this.immutable?i.texSubImage2D(w,n,0,0,u,c,f,v,x):cn(i)?a?i.texImage3D(w,n,d,u,c,this.depthOrArrayLayers,0,f,v,x):i.texImage2D(w,n,d,u,c,0,f,v,x):s?i.texImage2D(w,n,f,u,c,0,f,v,x):i.texImage2D(w,n,f,f,v,x)}this.mipmaps&&this.generateMipmap(a)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteTexture(K1(this))},t.prototype.clampmipLevelCount=function(r){if(r.dimension===Pi.TEXTURE_2D_ARRAY&&r.depthOrArrayLayers>1){var n=lv(r.format);if(n===We.BC1)for(var i=r.width,a=r.height,o=0;o<r.mipLevelCount;o++){if(i<=2||a<=2)return o-1;i=Math.max(i/2|0,1),a=Math.max(a/2|0,1)}}return r.mipLevelCount},t.prototype.preprocessImage=function(){var r=this.device.gl;this.pixelStore&&(this.pixelStore.unpackFlipY&&r.pixelStorei(Ft.UNPACK_FLIP_Y_WEBGL,!0),this.pixelStore.packAlignment&&r.pixelStorei(Ft.PACK_ALIGNMENT,this.pixelStore.packAlignment),this.pixelStore.unpackAlignment&&r.pixelStorei(Ft.UNPACK_ALIGNMENT,this.pixelStore.unpackAlignment))},t.prototype.generateMipmap=function(r){r===void 0&&(r=!1);var n=this.device.gl;return!cn(n)&&this.isNPOT()?this:(this.gl_texture&&this.gl_target&&(n.bindTexture(this.gl_target,this.gl_texture),r?(n.texParameteri(this.gl_target,Ft.TEXTURE_BASE_LEVEL,0),n.texParameteri(this.gl_target,Ft.TEXTURE_MAX_LEVEL,Math.log2(this.width)),n.texParameteri(this.gl_target,Ft.TEXTURE_MIN_FILTER,Ft.LINEAR_MIPMAP_LINEAR),n.texParameteri(this.gl_target,Ft.TEXTURE_MAG_FILTER,Ft.LINEAR)):n.texParameteri(Ft.TEXTURE_2D,Ft.TEXTURE_MIN_FILTER,Ft.NEAREST_MIPMAP_LINEAR),n.generateMipmap(this.gl_target),n.bindTexture(this.gl_target,null)),this)},t.prototype.isNPOT=function(){var r=this.device.gl;return cn(r)?!1:!pR(this.width)||!pR(this.height)},t}(id),czt=function(e){$t(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,o=e.call(this,{id:n,device:i})||this;o.type=ta.RenderTarget,o.gl_renderbuffer=null,o.texture=null;var s=o.device.gl,l=a.format,u=a.width,c=a.height,f=a.sampleCount,d=f===void 0?1:f,v=a.texture,g=!1;if((l===ee.D32F||l===ee.D24_S8)&&v&&!cn(s)&&!i.WEBGL_depth_texture&&(v.destroy(),o.texture=null,g=!0),!g&&v)o.texture=v;else{o.gl_renderbuffer=o.device.ensureResourceExists(s.createRenderbuffer()),s.bindRenderbuffer(s.RENDERBUFFER,o.gl_renderbuffer);var x=o.device.translateTextureInternalFormat(l,!0);cn(s)&&d>1?s.renderbufferStorageMultisample(Ft.RENDERBUFFER,d,x,u,c):s.renderbufferStorage(Ft.RENDERBUFFER,x,u,c)}return o.format=l,o.width=u,o.height=c,o.sampleCount=d,o}return t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gl_renderbuffer!==null&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer),this.texture&&this.texture.destroy()},t}(id),zc;(function(e){e[e.NeedsCompile=0]="NeedsCompile",e[e.Compiling=1]="Compiling",e[e.NeedsBind=2]="NeedsBind",e[e.ReadyToUse=3]="ReadyToUse"})(zc||(zc={}));var hzt=function(e){$t(t,e);function t(r,n){var i=r.id,a=r.device,o=r.descriptor,s=e.call(this,{id:i,device:a})||this;s.rawVertexGLSL=n,s.type=ta.Program,s.uniformSetters={},s.attributes=[];var l=s.device.gl;return s.descriptor=o,s.gl_program=s.device.ensureResourceExists(l.createProgram()),s.gl_shader_vert=null,s.gl_shader_frag=null,s.compileState=zc.NeedsCompile,s.tryCompileProgram(),s}return t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)},t.prototype.tryCompileProgram=function(){ni(this.compileState===zc.NeedsCompile);var r=this.descriptor,n=r.vertex,i=r.fragment,a=this.device.gl;n!=null&&n.glsl&&(i!=null&&i.glsl)&&(this.gl_shader_vert=this.compileShader(n.postprocess?n.postprocess(n.glsl):n.glsl,a.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(i.postprocess?i.postprocess(i.glsl):i.glsl,a.FRAGMENT_SHADER),a.attachShader(this.gl_program,this.gl_shader_vert),a.attachShader(this.gl_program,this.gl_shader_frag),a.linkProgram(this.gl_program),this.compileState=zc.Compiling,cn(a)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromLinkedProgram()))},t.prototype.readAttributesFromLinkedProgram=function(){for(var r,n=this.device.gl,i=n.getProgramParameter(this.gl_program,n.ACTIVE_ATTRIBUTES),a=K7t(this.descriptor.vertex.glsl),o=Q7t(this.rawVertexGLSL,a),s=function(c){var f=n.getActiveAttrib(l.gl_program,c),d=f.name,v=f.type,g=f.size,x=n.getAttribLocation(l.gl_program,d),w=(r=o.find(function(S){return S.name===d}))===null||r===void 0?void 0:r.location;x>=0&&!Gf(w)&&(l.attributes[w]={name:d,location:x,type:v,size:g})},l=this,u=0;u<i;u++)s(u)},t.prototype.readUniformLocationsFromLinkedProgram=function(){for(var r=this.device.gl,n=r.getProgramParameter(this.gl_program,r.ACTIVE_UNIFORMS),i=0;i<n;i++){var a=r.getActiveUniform(this.gl_program,i),o=G7t(a.name).name,s=r.getUniformLocation(this.gl_program,o);if(this.uniformSetters[o]=MH(r,s,a),a&&a.size>1)for(var l=0;l<a.size;l++)s=r.getUniformLocation(this.gl_program,"".concat(o,"[").concat(l,"]")),this.uniformSetters["".concat(o,"[").concat(l,"]")]=MH(r,s,a)}},t.prototype.compileShader=function(r,n){var i=this.device.gl,a=this.device.ensureResourceExists(i.createShader(n));return i.shaderSource(a,r),i.compileShader(a),a},t.prototype.setUniformsLegacy=function(r){r===void 0&&(r={});var n=this.device.gl;if(!cn(n)){var i=!1;for(var a in r){i||(n.useProgram(this.gl_program),i=!0);var o=r[a],s=this.uniformSetters[a];if(s){var l=o;l instanceof pF&&(l=l.textureIndex),s(l)}}}return this},t}(id),fzt=function(e){$t(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,o=e.call(this,{id:n,device:i})||this;o.type=ta.QueryPool;var s=o.device.gl;if(cn(s)){var l=a.elemCount,u=a.type;o.gl_query=b7t(l,function(){return o.device.ensureResourceExists(s.createQuery())}),o.gl_query_type=ozt(u)}return o}return t.prototype.queryResultOcclusion=function(r){var n=this.device.gl;if(cn(n)){var i=this.gl_query[r];return n.getQueryParameter(i,n.QUERY_RESULT_AVAILABLE)?!!n.getQueryParameter(i,n.QUERY_RESULT):null}return null},t.prototype.destroy=function(){e.prototype.destroy.call(this);var r=this.device.gl;if(cn(r))for(var n=0;n<this.gl_query.length;n++)r.deleteQuery(this.gl_query[n])},t}(id),dzt=function(e){$t(t,e);function t(r){var n=r.id,i=r.device,a=e.call(this,{id:n,device:i})||this;return a.type=ta.Readback,a.gl_pbo=null,a.gl_sync=null,a}return t.prototype.clientWaitAsync=function(r,n,i){n===void 0&&(n=0),i===void 0&&(i=10);var a=this.device.gl;return new Promise(function(o,s){function l(){var u=a.clientWaitSync(r,n,0);if(u==a.WAIT_FAILED){s();return}if(u==a.TIMEOUT_EXPIRED){setTimeout(l,g7t(i,0,a.MAX_CLIENT_WAIT_TIMEOUT_WEBGL));return}o()}l()})},t.prototype.getBufferSubDataAsync=function(r,n,i,a,o,s){return lu(this,void 0,void 0,function(){var l;return $h(this,function(u){switch(u.label){case 0:return l=this.device.gl,cn(l)?(this.gl_sync=l.fenceSync(l.SYNC_GPU_COMMANDS_COMPLETE,0),l.flush(),[4,this.clientWaitAsync(this.gl_sync,0,10)]):[3,2];case 1:return u.sent(),l.bindBuffer(r,n),l.getBufferSubData(r,i,a,o,s),l.bindBuffer(r,null),[2,a];case 2:return[2]}})})},t.prototype.readTexture=function(r,n,i,a,o,s,l,u){return l===void 0&&(l=0),u===void 0&&(u=s.byteLength||0),lu(this,void 0,void 0,function(){var c,f,d,v,g;return $h(this,function(x){return c=this.device.gl,f=r,d=this.device.translateTextureFormat(f.format),v=this.device.translateTextureType(f.format),g=y7t(f.format),cn(c)?(this.gl_pbo=this.device.ensureResourceExists(c.createBuffer()),c.bindBuffer(c.PIXEL_PACK_BUFFER,this.gl_pbo),c.bufferData(c.PIXEL_PACK_BUFFER,u,c.STREAM_READ),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),c.bindFramebuffer(Ft.READ_FRAMEBUFFER,this.device.readbackFramebuffer),c.framebufferTexture2D(Ft.READ_FRAMEBUFFER,Ft.COLOR_ATTACHMENT0,Ft.TEXTURE_2D,f.gl_texture,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,this.gl_pbo),c.readPixels(n,i,a,o,d,v,l*g),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),[2,this.getBufferSubDataAsync(c.PIXEL_PACK_BUFFER,this.gl_pbo,0,s,l,0)]):[2,this.readTextureSync(r,n,i,a,o,s,l,u)]})})},t.prototype.readTextureSync=function(r,n,i,a,o,s,l,u){u===void 0&&(u=s.byteLength||0);var c=this.device.gl,f=r,d=this.device.translateTextureType(f.format);return c.bindFramebuffer(Ft.FRAMEBUFFER,this.device.readbackFramebuffer),c.framebufferTexture2D(Ft.FRAMEBUFFER,Ft.COLOR_ATTACHMENT0,Ft.TEXTURE_2D,f.gl_texture,0),c.pixelStorei(c.PACK_ALIGNMENT,4),c.readPixels(n,i,a,o,c.RGBA,d,s),s},t.prototype.readBuffer=function(r,n,i,a,o){return lu(this,void 0,void 0,function(){var s;return $h(this,function(l){return s=this.device.gl,cn(s)?[2,this.getBufferSubDataAsync(s.ARRAY_BUFFER,Sx(r,n),n,i,a,o)]:[2,Promise.reject()]})})},t.prototype.destroy=function(){e.prototype.destroy.call(this),cn(this.device.gl)&&(this.gl_sync!==null&&this.device.gl.deleteSync(this.gl_sync),this.gl_pbo!==null&&this.device.gl.deleteBuffer(this.gl_pbo))},t}(id),pzt=function(e){$t(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,o,s,l=e.call(this,{id:n,device:i})||this;return l.type=ta.RenderPipeline,l.drawMode=ezt((o=a.topology)!==null&&o!==void 0?o:Ls.TRIANGLES),l.program=a.program,l.inputLayout=a.inputLayout,l.megaState=$($({},tb(eb)),a.megaStateDescriptor),l.colorAttachmentFormats=a.colorAttachmentFormats.slice(),l.depthStencilAttachmentFormat=a.depthStencilAttachmentFormat,l.sampleCount=(s=a.sampleCount)!==null&&s!==void 0?s:1,l}return t}(id),vzt=function(e){$t(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,o=e.call(this,{id:n,device:i})||this;return o.type=ta.ComputePipeline,o.descriptor=a,o}return t}(id),gzt=function(){function e(){this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}return e.prototype.trackResourceCreated=function(t){this.creationStacks.set(t,new Error().stack),this.liveObjects.add(t)},e.prototype.trackResourceDestroyed=function(t){this.deletionStacks.has(t)&&console.warn("Object double freed:",t,`

Creation stack: `,this.creationStacks.get(t),`

Deletion stack: `,this.deletionStacks.get(t),`

This stack: `,new Error().stack),this.deletionStacks.set(t,new Error().stack),this.liveObjects.delete(t)},e.prototype.checkForLeaks=function(){var t,r;try{for(var n=yi(this.liveObjects.values()),i=n.next();!i.done;i=n.next()){var a=i.value;console.warn("Object leaked:",a,"Creation stack:",this.creationStacks.get(a))}}catch(o){t={error:o}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},e.prototype.setResourceLeakCheck=function(t,r){r?this.liveObjects.add(t):this.liveObjects.delete(t)},e}(),mzt=function(e){$t(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,o,s,l=e.call(this,{id:n,device:i})||this;l.type=ta.Sampler;var u=l.device.gl;if(cn(u)){var c=l.device.ensureResourceExists(u.createSampler());u.samplerParameteri(c,Ft.TEXTURE_WRAP_S,iw(a.addressModeU)),u.samplerParameteri(c,Ft.TEXTURE_WRAP_T,iw(a.addressModeV)),u.samplerParameteri(c,Ft.TEXTURE_WRAP_R,iw((o=a.addressModeW)!==null&&o!==void 0?o:a.addressModeU)),u.samplerParameteri(c,Ft.TEXTURE_MIN_FILTER,XT(a.minFilter,a.mipmapFilter)),u.samplerParameteri(c,Ft.TEXTURE_MAG_FILTER,XT(a.magFilter,rl.NO_MIP)),a.lodMinClamp!==void 0&&u.samplerParameterf(c,Ft.TEXTURE_MIN_LOD,a.lodMinClamp),a.lodMaxClamp!==void 0&&u.samplerParameterf(c,Ft.TEXTURE_MAX_LOD,a.lodMaxClamp),a.compareFunction!==void 0&&(u.samplerParameteri(c,u.TEXTURE_COMPARE_MODE,u.COMPARE_REF_TO_TEXTURE),u.samplerParameteri(c,u.TEXTURE_COMPARE_FUNC,a.compareFunction));var f=(s=a.maxAnisotropy)!==null&&s!==void 0?s:1;f>1&&l.device.EXT_texture_filter_anisotropic!==null&&(ni(a.minFilter===es.BILINEAR&&a.magFilter===es.BILINEAR&&a.mipmapFilter===rl.LINEAR),u.samplerParameterf(c,l.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,f)),l.gl_sampler=c}else l.descriptor=a;return l}return t.prototype.setTextureParameters=function(r,n,i){var a,o=this.device.gl,s=this.descriptor;this.isNPOT(n,i)?o.texParameteri(Ft.TEXTURE_2D,Ft.TEXTURE_MIN_FILTER,Ft.LINEAR):o.texParameteri(r,Ft.TEXTURE_MIN_FILTER,XT(s.minFilter,s.mipmapFilter)),o.texParameteri(Ft.TEXTURE_2D,Ft.TEXTURE_WRAP_S,iw(s.addressModeU)),o.texParameteri(Ft.TEXTURE_2D,Ft.TEXTURE_WRAP_T,iw(s.addressModeV)),o.texParameteri(r,Ft.TEXTURE_MAG_FILTER,XT(s.magFilter,rl.NO_MIP));var l=(a=s.maxAnisotropy)!==null&&a!==void 0?a:1;l>1&&this.device.EXT_texture_filter_anisotropic!==null&&(ni(s.minFilter===es.BILINEAR&&s.magFilter===es.BILINEAR&&s.mipmapFilter===rl.LINEAR),o.texParameteri(r,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l))},t.prototype.destroy=function(){e.prototype.destroy.call(this),cn(this.device.gl)&&this.device.gl.deleteSampler(dF(this))},t.prototype.isNPOT=function(r,n){return!pR(r)||!pR(n)},t}(id),yzt=function(){function e(){}return e.prototype.dispatchWorkgroups=function(t,r,n){},e.prototype.dispatchWorkgroupsIndirect=function(t,r){},e.prototype.setPipeline=function(t){},e.prototype.setBindings=function(t){},e.prototype.pushDebugGroup=function(t){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(t){},e}(),_zt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type=ta.RenderBundle,r.commands=[],r}return t.prototype.push=function(r){this.commands.push(r)},t.prototype.replay=function(){this.commands.forEach(function(r){return r()})},t}(id),PH=65536,xzt=/uniform(?:\s+)(\w+)(?:\s?){([^]*?)}/g,bzt=function(){function e(t,r){r===void 0&&(r={}),this.shaderDebug=!1,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_draw_buffers=null,this.WEBGL_depth_texture=null,this.WEBGL_color_buffer_float=null,this.EXT_color_buffer_half_float=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.EXT_color_buffer_float=null,this.OES_texture_float_linear=null,this.OES_texture_half_float_linear=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorAttachmentLevels=[],this.currentColorResolveTos=[],this.currentColorResolveToLevels=[],this.currentSampleCount=-1,this.currentIndexBufferByteOffset=null,this.currentMegaState=tb(eb),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.currentRenderPassDescriptorStack=[],this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveDepthStencilAttachmentsChanged=!1,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=kd.LOWER_LEFT,this.clipSpaceNearZ=Qx.NEGATIVE_ONE,this.supportMRT=!1,this.inBlitRenderPass=!1,this.supportedSampleCounts=[],this.occlusionQueriesRecommended=!1,this.computeShadersSupported=!1,this.gl=t,this.contextAttributes=Iy(t.getContextAttributes()),cn(t)?(this.EXT_texture_norm16=t.getExtension("EXT_texture_norm16"),this.EXT_color_buffer_float=t.getExtension("EXT_color_buffer_float")):(this.OES_vertex_array_object=t.getExtension("OES_vertex_array_object"),this.ANGLE_instanced_arrays=t.getExtension("ANGLE_instanced_arrays"),this.OES_texture_float=t.getExtension("OES_texture_float"),this.WEBGL_draw_buffers=t.getExtension("WEBGL_draw_buffers"),this.WEBGL_depth_texture=t.getExtension("WEBGL_depth_texture"),this.WEBGL_color_buffer_float=t.getExtension("WEBGL_color_buffer_float"),this.EXT_color_buffer_half_float=t.getExtension("EXT_color_buffer_half_float"),t.getExtension("EXT_frag_depth"),t.getExtension("OES_element_index_uint"),t.getExtension("OES_standard_derivatives")),this.WEBGL_compressed_texture_s3tc=t.getExtension("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb=t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.EXT_texture_compression_rgtc=t.getExtension("EXT_texture_compression_rgtc"),this.EXT_texture_filter_anisotropic=t.getExtension("EXT_texture_filter_anisotropic"),this.EXT_texture_norm16=t.getExtension("EXT_texture_norm16"),this.OES_texture_float_linear=t.getExtension("OES_texture_float_linear"),this.OES_texture_half_float_linear=t.getExtension("OES_texture_half_float_linear"),this.KHR_parallel_shader_compile=t.getExtension("KHR_parallel_shader_compile"),cn(t)?(this.platformString="WebGL2",this.glslVersion="#version 300 es"):(this.platformString="WebGL1",this.glslVersion="#version 100"),this.scTexture=new pF({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depthOrArrayLayers:1,dimension:Pi.TEXTURE_2D,mipLevelCount:1,usage:ku.RENDER_TARGET,format:this.contextAttributes.alpha===!1?ee.U8_RGB_RT:ee.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=$o.Float,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(Pi.TEXTURE_2D,$o.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(Pi.TEXTURE_2D,$o.Depth),this.fallbackVertexBuffer=this.createBuffer({viewOrSize:1,usage:ka.VERTEX,hint:$d.STATIC}),cn(t)&&(this.fallbackTexture2DArray=this.createFallbackTexture(Pi.TEXTURE_2D_ARRAY,$o.Float),this.fallbackTexture3D=this.createFallbackTexture(Pi.TEXTURE_3D,$o.Float),this.fallbackTextureCube=this.createFallbackTexture(Pi.TEXTURE_CUBE_MAP,$o.Float)),this.currentMegaState.depthCompare=ga.LESS,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=vl.ALL,t.enable(t.DEPTH_TEST),t.enable(t.STENCIL_TEST),this.checkLimits(),r.shaderDebug&&(this.shaderDebug=!0),r.trackResources&&(this.resourceCreationTracker=new gzt)}return e.prototype.destroy=function(){this.blitBindings&&this.blitBindings.destroy(),this.blitInputLayout&&this.blitInputLayout.destroy(),this.blitRenderPipeline&&this.blitRenderPipeline.destroy(),this.blitVertexBuffer&&this.blitVertexBuffer.destroy(),this.blitProgram&&this.blitProgram.destroy()},e.prototype.createFallbackTexture=function(t,r){var n=t===Pi.TEXTURE_CUBE_MAP?6:1,i=r===$o.Depth?ee.D32F:ee.U8_RGBA_NORM,a=this.createTexture({dimension:t,format:i,usage:ku.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1});return r===$o.Float&&a.setImageData([new Uint8Array(4*n)]),K1(a)},e.prototype.getNextUniqueId=function(){return++this.resourceUniqueId},e.prototype.checkLimits=function(){var t=this.gl;if(this.maxVertexAttribs=t.getParameter(Ft.MAX_VERTEX_ATTRIBS),cn(t)){this.uniformBufferMaxPageByteSize=Math.min(t.getParameter(Ft.MAX_UNIFORM_BLOCK_SIZE),PH),this.uniformBufferWordAlignment=t.getParameter(t.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var r=t.getInternalformatParameter(t.RENDERBUFFER,t.DEPTH32F_STENCIL8,t.SAMPLES);this.supportedSampleCounts=r?on([],Pr(r),!1):[],this.occlusionQueriesRecommended=!0}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=PH;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort(function(n,i){return n-i})},e.prototype.configureSwapChain=function(t,r,n){var i=this.scTexture;i.width=t,i.height=r,this.scPlatformFramebuffer=x7t(n)},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.gl.canvas},e.prototype.getOnscreenTexture=function(){return this.scTexture},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){},e.prototype.translateTextureInternalFormat=function(t,r){switch(r===void 0&&(r=!1),t){case ee.ALPHA:return Ft.ALPHA;case ee.U8_LUMINANCE:case ee.F16_LUMINANCE:case ee.F32_LUMINANCE:return Ft.LUMINANCE;case ee.F16_R:return Ft.R16F;case ee.F16_RG:return Ft.RG16F;case ee.F16_RGB:return Ft.RGB16F;case ee.F16_RGBA:return Ft.RGBA16F;case ee.F32_R:return Ft.R32F;case ee.F32_RG:return Ft.RG32F;case ee.F32_RGB:return Ft.RGB32F;case ee.F32_RGBA:return cn(this.gl)?Ft.RGBA32F:r?this.WEBGL_color_buffer_float.RGBA32F_EXT:Ft.RGBA;case ee.U8_R_NORM:return Ft.R8;case ee.U8_RG_NORM:return Ft.RG8;case ee.U8_RGB_NORM:case ee.U8_RGB_RT:return Ft.RGB8;case ee.U8_RGB_SRGB:return Ft.SRGB8;case ee.U8_RGBA_NORM:case ee.U8_RGBA_RT:return cn(this.gl)?Ft.RGBA8:r?Ft.RGBA4:Ft.RGBA;case ee.U8_RGBA:return Ft.RGBA;case ee.U8_RGBA_SRGB:case ee.U8_RGBA_RT_SRGB:return Ft.SRGB8_ALPHA8;case ee.U16_R:return Ft.R16UI;case ee.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case ee.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case ee.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case ee.U16_RGBA_5551:return Ft.RGB5_A1;case ee.U16_RGB_565:return Ft.RGB565;case ee.U32_R:return Ft.R32UI;case ee.S8_RGBA_NORM:return Ft.RGBA8_SNORM;case ee.S8_RG_NORM:return Ft.RG8_SNORM;case ee.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case ee.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case ee.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case ee.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case ee.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case ee.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case ee.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case ee.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case ee.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case ee.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case ee.D32F_S8:return cn(this.gl)?Ft.DEPTH32F_STENCIL8:this.WEBGL_depth_texture?Ft.DEPTH_STENCIL:Ft.DEPTH_COMPONENT16;case ee.D24_S8:return cn(this.gl)?Ft.DEPTH24_STENCIL8:this.WEBGL_depth_texture?Ft.DEPTH_STENCIL:Ft.DEPTH_COMPONENT16;case ee.D32F:return cn(this.gl)?Ft.DEPTH_COMPONENT32F:this.WEBGL_depth_texture?Ft.DEPTH_COMPONENT:Ft.DEPTH_COMPONENT16;case ee.D24:return cn(this.gl)?Ft.DEPTH_COMPONENT24:this.WEBGL_depth_texture?Ft.DEPTH_COMPONENT:Ft.DEPTH_COMPONENT16;default:throw new Error("whoops")}},e.prototype.translateTextureType=function(t){var r=lv(t);switch(r){case We.U8:return Ft.UNSIGNED_BYTE;case We.U16:return Ft.UNSIGNED_SHORT;case We.U32:return Ft.UNSIGNED_INT;case We.S8:return Ft.BYTE;case We.F16:return Ft.HALF_FLOAT;case We.F32:return Ft.FLOAT;case We.U16_PACKED_5551:return Ft.UNSIGNED_SHORT_5_5_5_1;case We.D32F:return cn(this.gl)?Ft.FLOAT:this.WEBGL_depth_texture?Ft.UNSIGNED_INT:Ft.UNSIGNED_BYTE;case We.D24:return cn(this.gl)?Ft.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?Ft.UNSIGNED_SHORT:Ft.UNSIGNED_BYTE;case We.D24S8:return cn(this.gl)?Ft.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?Ft.UNSIGNED_INT_24_8_WEBGL:Ft.UNSIGNED_BYTE;case We.D32FS8:return Ft.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw new Error("whoops")}},e.prototype.translateInternalTextureFormat=function(t){switch(t){case ee.F32_R:return Ft.R32F;case ee.F32_RG:return Ft.RG32F;case ee.F32_RGB:return Ft.RGB32F;case ee.F32_RGBA:return Ft.RGBA32F;case ee.F16_R:return Ft.R16F;case ee.F16_RG:return Ft.RG16F;case ee.F16_RGB:return Ft.RGB16F;case ee.F16_RGBA:return Ft.RGBA16F}return this.translateTextureFormat(t)},e.prototype.translateTextureFormat=function(t){if(Ptt(t)||t===ee.F32_LUMINANCE||t===ee.U8_LUMINANCE)return this.translateTextureInternalFormat(t);var r=cn(this.gl)||!cn(this.gl)&&!!this.WEBGL_depth_texture;switch(t){case ee.D24_S8:case ee.D32F_S8:return r?Ft.DEPTH_STENCIL:Ft.RGBA;case ee.D24:case ee.D32F:return r?Ft.DEPTH_COMPONENT:Ft.RGBA}var n=Dtt(t),i=W4(t);switch(i){case tn.A:return Ft.ALPHA;case tn.R:return n?Ft.RED_INTEGER:Ft.RED;case tn.RG:return n?Ft.RG_INTEGER:Ft.RG;case tn.RGB:return n?Ft.RGB_INTEGER:Ft.RGB;case tn.RGBA:return Ft.RGBA}},e.prototype.setActiveTexture=function(t){this.currentActiveTexture!==t&&(this.gl.activeTexture(t),this.currentActiveTexture=t)},e.prototype.bindVAO=function(t){this.currentBoundVAO!==t&&(cn(this.gl)?this.gl.bindVertexArray(t):this.OES_vertex_array_object.bindVertexArrayOES(t),this.currentBoundVAO=t)},e.prototype.programCompiled=function(t){ni(t.compileState!==zc.NeedsCompile),t.compileState===zc.Compiling&&(t.compileState=zc.NeedsBind,this.shaderDebug&&this.checkProgramCompilationForErrors(t))},e.prototype.useProgram=function(t){this.currentProgram!==t&&(this.programCompiled(t),this.gl.useProgram(t.gl_program),this.currentProgram=t)},e.prototype.ensureResourceExists=function(t){if(t===null){var r=this.gl.getError();throw new Error("Created resource is null; GL error encountered: ".concat(r))}else return t},e.prototype.createBuffer=function(t){return new lzt({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createTexture=function(t){return new pF({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createSampler=function(t){return new mzt({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderTarget=function(t){return new czt({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderTargetFromTexture=function(t){var r=t,n=r.format,i=r.width,a=r.height,o=r.mipLevelCount;return ni(o===1),this.createRenderTarget({format:n,width:i,height:a,sampleCount:1,texture:t})},e.prototype.createProgram=function(t){var r,n,i,a=(r=t.vertex)===null||r===void 0?void 0:r.glsl;return!((n=t.vertex)===null||n===void 0)&&n.glsl&&(t.vertex.glsl=rb(this.queryVendorInfo(),"vert",t.vertex.glsl)),!((i=t.fragment)===null||i===void 0)&&i.glsl&&(t.fragment.glsl=rb(this.queryVendorInfo(),"frag",t.fragment.glsl)),this.createProgramSimple(t,a)},e.prototype.createProgramSimple=function(t,r){var n=new hzt({id:this.getNextUniqueId(),device:this,descriptor:t},r);return n},e.prototype.createBindings=function(t){return new J7t({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createInputLayout=function(t){return new uzt({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderPipeline=function(t){return new pzt({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createComputePass=function(){return new yzt},e.prototype.createComputePipeline=function(t){return new vzt({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createReadback=function(){return new dzt({id:this.getNextUniqueId(),device:this})},e.prototype.createQueryPool=function(t,r){return new fzt({id:this.getNextUniqueId(),device:this,descriptor:{type:t,elemCount:r}})},e.prototype.formatRenderPassDescriptor=function(t){var r,n,i,a,o,s,l=t.colorAttachment;t.depthClearValue=(r=t.depthClearValue)!==null&&r!==void 0?r:"load",t.stencilClearValue=(n=t.stencilClearValue)!==null&&n!==void 0?n:"load";for(var u=0;u<l.length;u++)t.colorAttachmentLevel||(t.colorAttachmentLevel=[]),t.colorAttachmentLevel[u]=(i=t.colorAttachmentLevel[u])!==null&&i!==void 0?i:0,t.colorResolveToLevel||(t.colorResolveToLevel=[]),t.colorResolveToLevel[u]=(a=t.colorResolveToLevel[u])!==null&&a!==void 0?a:0,t.colorClearColor||(t.colorClearColor=[]),t.colorClearColor[u]=(o=t.colorClearColor[u])!==null&&o!==void 0?o:"load",t.colorStore||(t.colorStore=[]),t.colorStore[u]=(s=t.colorStore[u])!==null&&s!==void 0?s:!1},e.prototype.createRenderBundle=function(){return new _zt({id:this.getNextUniqueId(),device:this})},e.prototype.beginBundle=function(t){this.renderBundle=t},e.prototype.endBundle=function(){this.renderBundle=void 0},e.prototype.executeBundles=function(t){t.forEach(function(r){r.replay()})},e.prototype.createRenderPass=function(t){this.currentRenderPassDescriptor!==null&&this.currentRenderPassDescriptorStack.push(this.currentRenderPassDescriptor),this.currentRenderPassDescriptor=t,this.formatRenderPassDescriptor(t);var r=t.colorAttachment,n=t.colorAttachmentLevel,i=t.colorClearColor,a=t.colorResolveTo,o=t.colorResolveToLevel,s=t.depthStencilAttachment,l=t.depthClearValue,u=t.stencilClearValue,c=t.depthStencilResolveTo,f=a&&a.length===1&&a[0]===this.scTexture;this.setRenderPassParametersBegin(r.length,f);for(var d=0;d<r.length;d++)this.setRenderPassParametersColor(d,r[d],n[d],a[d],o[d],f);this.setRenderPassParametersDepthStencil(s,c,f),this.validateCurrentAttachments();for(var d=0;d<r.length;d++){var v=i[d];v!=="load"&&this.setRenderPassParametersClearColor(d,v.r,v.g,v.b,v.a)}return this.setRenderPassParametersClearDepthStencil(l,u),this},e.prototype.submitPass=function(t){ni(this.currentRenderPassDescriptor!==null),this.endPass(),this.currentRenderPassDescriptorStack.length?this.currentRenderPassDescriptor=this.currentRenderPassDescriptorStack.pop():this.currentRenderPassDescriptor=null},e.prototype.copySubTexture2D=function(t,r,n,i,a,o){var s=this.gl,l=t,u=i;if(ni(u.mipLevelCount===1),ni(l.mipLevelCount===1),cn(s))l===this.scTexture?s.bindFramebuffer(s.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(s.bindFramebuffer(s.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0,l,0)),s.bindFramebuffer(s.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(s.READ_FRAMEBUFFER,s.COLOR_ATTACHMENT0,u,0),s.blitFramebuffer(a,o,a+u.width,o+u.height,r,n,r+u.width,n+u.height,s.COLOR_BUFFER_BIT,s.LINEAR),s.bindFramebuffer(s.READ_FRAMEBUFFER,null),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,null);else if(l===this.scTexture){var c=this.createRenderTargetFromTexture(i);this.submitBlitRenderPass(c,l)}},e.prototype.queryLimits=function(){return this},e.prototype.queryTextureFormatSupported=function(t,r,n){switch(t){case ee.BC1_SRGB:case ee.BC2_SRGB:case ee.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb!==null?jO(r,n,4,4):!1;case ee.BC1:case ee.BC2:case ee.BC3:return this.WEBGL_compressed_texture_s3tc!==null?jO(r,n,4,4):!1;case ee.BC4_UNORM:case ee.BC4_SNORM:case ee.BC5_UNORM:case ee.BC5_SNORM:return this.EXT_texture_compression_rgtc!==null?jO(r,n,4,4):!1;case ee.U16_R_NORM:case ee.U16_RG_NORM:case ee.U16_RGBA_NORM:return this.EXT_texture_norm16!==null;case ee.F32_R:case ee.F32_RG:case ee.F32_RGB:case ee.F32_RGBA:return this.OES_texture_float_linear!==null;case ee.F16_R:case ee.F16_RG:case ee.F16_RGB:case ee.F16_RGBA:return this.OES_texture_half_float_linear!==null;default:return!0}},e.prototype.queryProgramReady=function(t){var r=this.gl;if(t.compileState===zc.NeedsCompile)throw new Error("whoops");if(t.compileState===zc.Compiling){var n=void 0;return this.KHR_parallel_shader_compile!==null?n=r.getProgramParameter(t.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR):n=!0,n&&this.programCompiled(t),n}return t.compileState===zc.NeedsBind||t.compileState===zc.ReadyToUse},e.prototype.queryPlatformAvailable=function(){return this.gl.isContextLost()},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(t){return this.currentRenderPassDescriptor},e.prototype.queryRenderTarget=function(t){var r=t;return r},e.prototype.setResourceName=function(t,r){if(t.name=r,t.type===ta.Buffer)for(var n=t.gl_buffer_pages,i=0;i<n.length;i++)aw(n[i],"".concat(r," Page ").concat(i));else if(t.type===ta.Texture)aw(K1(t),r);else if(t.type===ta.Sampler)aw(dF(t),r);else if(t.type===ta.RenderTarget){var a=t.gl_renderbuffer;a!==null&&aw(a,r)}else t.type===ta.InputLayout&&aw(t.vao,r)},e.prototype.setResourceLeakCheck=function(t,r){this.resourceCreationTracker!==null&&this.resourceCreationTracker.setResourceLeakCheck(t,r)},e.prototype.checkForLeaks=function(){this.resourceCreationTracker!==null&&this.resourceCreationTracker.checkForLeaks()},e.prototype.pushDebugGroup=function(t){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(t){},e.prototype.programPatched=function(t,r){ni(this.shaderDebug)},e.prototype.getBufferData=function(t,r,n){n===void 0&&(n=0);var i=this.gl;cn(i)&&(i.bindBuffer(i.COPY_READ_BUFFER,Sx(t,n*4)),i.getBufferSubData(i.COPY_READ_BUFFER,n*4,r))},e.prototype.debugGroupStatisticsDrawCall=function(t){t===void 0&&(t=1);for(var r=this.debugGroupStack.length-1;r>=0;r--)this.debugGroupStack[r].drawCallCount+=t},e.prototype.debugGroupStatisticsBufferUpload=function(t){t===void 0&&(t=1);for(var r=this.debugGroupStack.length-1;r>=0;r--)this.debugGroupStack[r].bufferUploadCount+=t},e.prototype.debugGroupStatisticsTextureBind=function(t){t===void 0&&(t=1);for(var r=this.debugGroupStack.length-1;r>=0;r--)this.debugGroupStack[r].textureBindCount+=t},e.prototype.debugGroupStatisticsTriangles=function(t){for(var r=this.debugGroupStack.length-1;r>=0;r--)this.debugGroupStack[r].triangleCount+=t},e.prototype.reportShaderError=function(t,r){var n=this.gl,i=n.getShaderParameter(t,n.COMPILE_STATUS);if(!i){console.error(E7t(r));var a=n.getExtension("WEBGL_debug_shaders");a&&console.error(a.getTranslatedShaderSource(t)),console.error(n.getShaderInfoLog(t))}return i},e.prototype.checkProgramCompilationForErrors=function(t){var r=this.gl,n=t.gl_program;if(!r.getProgramParameter(n,r.LINK_STATUS)){var i=t.descriptor;if(!this.reportShaderError(t.gl_shader_vert,i.vertex.glsl)||!this.reportShaderError(t.gl_shader_frag,i.fragment.glsl))return;console.error(r.getProgramInfoLog(t.gl_program))}},e.prototype.bindFramebufferAttachment=function(t,r,n,i){var a=this.gl;if(Gf(n))a.framebufferRenderbuffer(t,r,a.RENDERBUFFER,null);else if(n.type===ta.RenderTarget)n.gl_renderbuffer!==null?a.framebufferRenderbuffer(t,r,a.RENDERBUFFER,n.gl_renderbuffer):n.texture!==null&&a.framebufferTexture2D(t,r,Ft.TEXTURE_2D,K1(n.texture),i);else if(n.type===ta.Texture){var o=K1(n);n.dimension===Pi.TEXTURE_2D?a.framebufferTexture2D(t,r,Ft.TEXTURE_2D,o,i):cn(a)&&(n.dimension,Pi.TEXTURE_2D_ARRAY)}},e.prototype.bindFramebufferDepthStencilAttachment=function(t,r){var n=this.gl,i=Gf(r)?Nr.Depth|Nr.Stencil:Jx(r.format),a=!!(i&Nr.Depth),o=!!(i&Nr.Stencil);if(a&&o){var s=cn(this.gl)||!cn(this.gl)&&!!this.WEBGL_depth_texture;s?this.bindFramebufferAttachment(t,n.DEPTH_STENCIL_ATTACHMENT,r,0):this.bindFramebufferAttachment(t,n.DEPTH_ATTACHMENT,r,0)}else a?(this.bindFramebufferAttachment(t,n.DEPTH_ATTACHMENT,r,0),this.bindFramebufferAttachment(t,n.STENCIL_ATTACHMENT,null,0)):o&&(this.bindFramebufferAttachment(t,n.STENCIL_ATTACHMENT,r,0),this.bindFramebufferAttachment(t,n.DEPTH_ATTACHMENT,null,0))},e.prototype.validateCurrentAttachments=function(){for(var t=-1,r=-1,n=-1,i=0;i<this.currentColorAttachments.length;i++){var a=this.currentColorAttachments[i];a!==null&&(t===-1?(t=a.sampleCount,r=a.width,n=a.height):(ni(t===a.sampleCount),ni(r===a.width),ni(n===a.height)))}this.currentDepthStencilAttachment&&(t===-1?t=this.currentDepthStencilAttachment.sampleCount:(ni(t===this.currentDepthStencilAttachment.sampleCount),ni(r===this.currentDepthStencilAttachment.width),ni(n===this.currentDepthStencilAttachment.height))),this.currentSampleCount=t},e.prototype.setRenderPassParametersBegin=function(t,r){r===void 0&&(r=!1);var n=this.gl;if(r)n.bindFramebuffer(Ft.FRAMEBUFFER,null);else if(cn(n)?n.bindFramebuffer(Ft.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):this.inBlitRenderPass||n.bindFramebuffer(Ft.FRAMEBUFFER,this.renderPassDrawFramebuffer),cn(n)?n.drawBuffers([Ft.COLOR_ATTACHMENT0,Ft.COLOR_ATTACHMENT1,Ft.COLOR_ATTACHMENT2,Ft.COLOR_ATTACHMENT3]):!this.inBlitRenderPass&&this.WEBGL_draw_buffers&&this.WEBGL_draw_buffers.drawBuffersWEBGL([Ft.COLOR_ATTACHMENT0_WEBGL,Ft.COLOR_ATTACHMENT1_WEBGL,Ft.COLOR_ATTACHMENT2_WEBGL,Ft.COLOR_ATTACHMENT3_WEBGL]),!this.inBlitRenderPass)for(var i=t;i<this.currentColorAttachments.length;i++){var a=cn(n)?Ft.DRAW_FRAMEBUFFER:Ft.FRAMEBUFFER,o=cn(n)?Ft.COLOR_ATTACHMENT0:Ft.COLOR_ATTACHMENT0_WEBGL;n.framebufferRenderbuffer(a,o+i,Ft.RENDERBUFFER,null),n.framebufferTexture2D(a,o+i,Ft.TEXTURE_2D,null,0)}this.currentColorAttachments.length=t},e.prototype.setRenderPassParametersColor=function(t,r,n,i,a,o){o===void 0&&(o=!1);var s=this.gl,l=cn(s);(this.currentColorAttachments[t]!==r||this.currentColorAttachmentLevels[t]!==n)&&(this.currentColorAttachments[t]=r,this.currentColorAttachmentLevels[t]=n,!o&&(l||!l&&this.WEBGL_draw_buffers)&&this.bindFramebufferAttachment(l?Ft.DRAW_FRAMEBUFFER:Ft.FRAMEBUFFER,(l?Ft.COLOR_ATTACHMENT0:Ft.COLOR_ATTACHMENT0_WEBGL)+t,r,n),this.resolveColorAttachmentsChanged=!0),(this.currentColorResolveTos[t]!==i||this.currentColorResolveToLevels[t]!==a)&&(this.currentColorResolveTos[t]=i,this.currentColorResolveToLevels[t]=a,i!==null&&(this.resolveColorAttachmentsChanged=!0))},e.prototype.setRenderPassParametersDepthStencil=function(t,r,n){n===void 0&&(n=!1);var i=this.gl;this.currentDepthStencilAttachment!==t&&(this.currentDepthStencilAttachment=t,!n&&!this.inBlitRenderPass&&this.bindFramebufferDepthStencilAttachment(cn(i)?Ft.DRAW_FRAMEBUFFER:Ft.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==r&&(this.currentDepthStencilResolveTo=r,r&&(this.resolveDepthStencilAttachmentsChanged=!0))},e.prototype.setRenderPassParametersClearColor=function(t,r,n,i,a){var o=this.gl;if(this.OES_draw_buffers_indexed!==null){var s=this.currentMegaState.attachmentsState[t];s&&s.channelWriteMask!==vl.ALL&&(this.OES_draw_buffers_indexed.colorMaskiOES(t,!0,!0,!0,!0),s.channelWriteMask=vl.ALL)}else{var s=this.currentMegaState.attachmentsState[0];s&&s.channelWriteMask!==vl.ALL&&(o.colorMask(!0,!0,!0,!0),s.channelWriteMask=vl.ALL)}this.setScissorRectEnabled(!1),cn(o)?o.clearBufferfv(o.COLOR,t,[r,n,i,a]):(o.clearColor(r,n,i,a),o.clear(o.COLOR_BUFFER_BIT))},e.prototype.setRenderPassParametersClearDepthStencil=function(t,r){t===void 0&&(t="load"),r===void 0&&(r="load");var n=this.gl;t!=="load"&&(ni(!!this.currentDepthStencilAttachment),this.currentMegaState.depthWrite||(n.depthMask(!0),this.currentMegaState.depthWrite=!0),cn(n)?n.clearBufferfv(n.DEPTH,0,[t]):(n.clearDepth(t),n.clear(n.DEPTH_BUFFER_BIT))),r!=="load"&&(ni(!!this.currentDepthStencilAttachment),this.currentMegaState.stencilWrite||(n.enable(n.STENCIL_TEST),n.stencilMask(255),this.currentMegaState.stencilWrite=!0),cn(n)?n.clearBufferiv(n.STENCIL,0,[r]):(n.clearStencil(r),n.clear(n.STENCIL_BUFFER_BIT)))},e.prototype.setBindings=function(t){var r=this,n;if(this.renderBundle){this.renderBundle.push(function(){return r.setBindings(t)});return}var i=this.gl,a=t,o=a.uniformBufferBindings,s=a.samplerBindings,l=a.bindingLayouts;ni(0<l.bindingLayoutTables.length);var u=l.bindingLayoutTables[0];ni(o.length>=u.numUniformBuffers),ni(s.length>=u.numSamplers);for(var c=0;c<o.length;c++){var f=o[c];if(f.size!==0){var d=u.firstUniformBuffer+c,v=f.buffer,g=f.offset||0,x=f.size||v.byteSize;if(v!==this.currentUniformBuffers[d]||g!==this.currentUniformBufferByteOffsets[d]||x!==this.currentUniformBufferByteSizes[d]){var w=g%v.pageByteSize,S=v.gl_buffer_pages[g/v.pageByteSize|0];ni(w+x<=v.pageByteSize),cn(i)&&i.bindBufferRange(i.UNIFORM_BUFFER,d,S,w,x),this.currentUniformBuffers[d]=v,this.currentUniformBufferByteOffsets[d]=g,this.currentUniformBufferByteSizes[d]=x}}}for(var c=0;c<u.numSamplers;c++){var f=s[c],M=u.firstSampler+c,R=f!==null&&f.sampler!==null?dF(f.sampler):null,I=f!==null&&f.texture!==null?K1(f.texture):null;if(this.currentSamplers[M]!==R&&(cn(i)&&i.bindSampler(M,R),this.currentSamplers[M]=R),this.currentTextures[M]!==I){if(this.setActiveTexture(i.TEXTURE0+M),I!==null){var P=Iy(f).texture,k=P.gl_target,z=P.width,G=P.height;f.texture.textureIndex=M,i.bindTexture(k,I),cn(i)||(n=f.sampler)===null||n===void 0||n.setTextureParameters(k,z,G),this.debugGroupStatisticsTextureBind()}else{var J=$($({},f),Ltt),Z=J.dimension,X=J.formatKind,k=szt(Z);i.bindTexture(k,this.getFallbackTexture($({gl_target:k,formatKind:X},J)))}this.currentTextures[M]=I}}},e.prototype.setViewport=function(t,r,n,i){var a=this.gl;a.viewport(t,r,n,i)},e.prototype.setScissorRect=function(t,r,n,i){var a=this.gl;this.setScissorRectEnabled(!0),a.scissor(t,r,n,i)},e.prototype.applyAttachmentStateIndexed=function(t,r,n){var i=this.gl,a=this.OES_draw_buffers_indexed;r.channelWriteMask!==n.channelWriteMask&&(a.colorMaskiOES(t,!!(n.channelWriteMask&vl.RED),!!(n.channelWriteMask&vl.GREEN),!!(n.channelWriteMask&vl.BLUE),!!(n.channelWriteMask&vl.ALPHA)),r.channelWriteMask=n.channelWriteMask);var o=r.rgbBlendState.blendMode!==n.rgbBlendState.blendMode||r.alphaBlendState.blendMode!==n.alphaBlendState.blendMode,s=r.rgbBlendState.blendSrcFactor!==n.rgbBlendState.blendSrcFactor||r.alphaBlendState.blendSrcFactor!==n.alphaBlendState.blendSrcFactor||r.rgbBlendState.blendDstFactor!==n.rgbBlendState.blendDstFactor||r.alphaBlendState.blendDstFactor!==n.alphaBlendState.blendDstFactor;(s||o)&&(_m(r.rgbBlendState)&&_m(r.alphaBlendState)?a.enableiOES(t,i.BLEND):_m(n.rgbBlendState)&&_m(n.alphaBlendState)&&a.disableiOES(t,i.BLEND)),o&&(a.blendEquationSeparateiOES(t,n.rgbBlendState.blendMode,n.alphaBlendState.blendMode),r.rgbBlendState.blendMode=n.rgbBlendState.blendMode,r.alphaBlendState.blendMode=n.alphaBlendState.blendMode),s&&(a.blendFuncSeparateiOES(t,n.rgbBlendState.blendSrcFactor,n.rgbBlendState.blendDstFactor,n.alphaBlendState.blendSrcFactor,n.alphaBlendState.blendDstFactor),r.rgbBlendState.blendSrcFactor=n.rgbBlendState.blendSrcFactor,r.alphaBlendState.blendSrcFactor=n.alphaBlendState.blendSrcFactor,r.rgbBlendState.blendDstFactor=n.rgbBlendState.blendDstFactor,r.alphaBlendState.blendDstFactor=n.alphaBlendState.blendDstFactor)},e.prototype.applyAttachmentState=function(t,r){var n=this.gl;t.channelWriteMask!==r.channelWriteMask&&(n.colorMask(!!(r.channelWriteMask&vl.RED),!!(r.channelWriteMask&vl.GREEN),!!(r.channelWriteMask&vl.BLUE),!!(r.channelWriteMask&vl.ALPHA)),t.channelWriteMask=r.channelWriteMask);var i=t.rgbBlendState.blendMode!==r.rgbBlendState.blendMode||t.alphaBlendState.blendMode!==r.alphaBlendState.blendMode,a=t.rgbBlendState.blendSrcFactor!==r.rgbBlendState.blendSrcFactor||t.alphaBlendState.blendSrcFactor!==r.alphaBlendState.blendSrcFactor||t.rgbBlendState.blendDstFactor!==r.rgbBlendState.blendDstFactor||t.alphaBlendState.blendDstFactor!==r.alphaBlendState.blendDstFactor;(a||i)&&(_m(t.rgbBlendState)&&_m(t.alphaBlendState)?n.enable(n.BLEND):_m(r.rgbBlendState)&&_m(r.alphaBlendState)&&n.disable(n.BLEND)),i&&(n.blendEquationSeparate(r.rgbBlendState.blendMode,r.alphaBlendState.blendMode),t.rgbBlendState.blendMode=r.rgbBlendState.blendMode,t.alphaBlendState.blendMode=r.alphaBlendState.blendMode),a&&(n.blendFuncSeparate(r.rgbBlendState.blendSrcFactor,r.rgbBlendState.blendDstFactor,r.alphaBlendState.blendSrcFactor,r.alphaBlendState.blendDstFactor),t.rgbBlendState.blendSrcFactor=r.rgbBlendState.blendSrcFactor,t.alphaBlendState.blendSrcFactor=r.alphaBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor=r.rgbBlendState.blendDstFactor,t.alphaBlendState.blendDstFactor=r.alphaBlendState.blendDstFactor)},e.prototype.setMegaState=function(t){var r=this.gl,n=this.currentMegaState;if(this.OES_draw_buffers_indexed!==null)for(var i=0;i<t.attachmentsState.length;i++)this.applyAttachmentStateIndexed(i,n.attachmentsState[0],t.attachmentsState[0]);else ni(t.attachmentsState.length===1),this.applyAttachmentState(n.attachmentsState[0],t.attachmentsState[0]);Ttt(n.blendConstant,t.blendConstant)||(r.blendColor(t.blendConstant.r,t.blendConstant.g,t.blendConstant.b,t.blendConstant.a),Att(n.blendConstant,t.blendConstant)),n.depthCompare!==t.depthCompare&&(r.depthFunc(t.depthCompare),n.depthCompare=t.depthCompare),!!n.depthWrite!=!!t.depthWrite&&(r.depthMask(t.depthWrite),n.depthWrite=t.depthWrite),!!n.stencilWrite!=!!t.stencilWrite&&(r.stencilMask(t.stencilWrite?255:0),n.stencilWrite=t.stencilWrite);var a=!1;if(!mR(n.stencilFront,t.stencilFront)){a=!0;var o=t.stencilFront,s=o.passOp,l=o.failOp,u=o.depthFailOp,c=o.compare;(n.stencilFront.passOp!==s||n.stencilFront.failOp!==l||n.stencilFront.depthFailOp!==u)&&(r.stencilOpSeparate(r.FRONT,l,u,s),n.stencilFront.passOp=s,n.stencilFront.failOp=l,n.stencilFront.depthFailOp=u),n.stencilFront.compare!==c&&(this.setStencilReference(0),n.stencilFront.compare=c)}if(!mR(n.stencilBack,t.stencilBack)){a=!0;var f=t.stencilBack,s=f.passOp,l=f.failOp,u=f.depthFailOp,c=f.compare;(n.stencilBack.passOp!==s||n.stencilBack.failOp!==l||n.stencilBack.depthFailOp!==u)&&(r.stencilOpSeparate(r.BACK,l,u,s),n.stencilBack.passOp=s,n.stencilBack.failOp=l,n.stencilBack.depthFailOp=u),n.stencilBack.compare!==c&&(this.setStencilReference(0),n.stencilBack.compare=c)}(n.stencilFront.mask!==t.stencilFront.mask||n.stencilBack.mask!==t.stencilBack.mask)&&(a=!0,n.stencilFront.mask=t.stencilFront.mask,n.stencilBack.mask=t.stencilBack.mask),a&&this.applyStencil(),n.cullMode!==t.cullMode&&(n.cullMode===Wc.NONE?r.enable(r.CULL_FACE):t.cullMode===Wc.NONE&&r.disable(r.CULL_FACE),t.cullMode===Wc.BACK?r.cullFace(r.BACK):t.cullMode===Wc.FRONT?r.cullFace(r.FRONT):t.cullMode===Wc.FRONT_AND_BACK&&r.cullFace(r.FRONT_AND_BACK),n.cullMode=t.cullMode),n.frontFace!==t.frontFace&&(r.frontFace(t.frontFace),n.frontFace=t.frontFace),n.polygonOffset!==t.polygonOffset&&(t.polygonOffset?r.enable(r.POLYGON_OFFSET_FILL):r.disable(r.POLYGON_OFFSET_FILL),n.polygonOffset=t.polygonOffset),(n.polygonOffsetFactor!==t.polygonOffsetFactor||n.polygonOffsetUnits!==t.polygonOffsetUnits)&&(r.polygonOffset(t.polygonOffsetFactor,t.polygonOffsetUnits),n.polygonOffsetFactor=t.polygonOffsetFactor,n.polygonOffsetUnits=t.polygonOffsetUnits)},e.prototype.validatePipelineFormats=function(t){for(var r=0;r<this.currentColorAttachments.length;r++)var n=this.currentColorAttachments[r];this.currentDepthStencilAttachment&&ni(this.currentDepthStencilAttachment.format===t.depthStencilAttachmentFormat),this.currentSampleCount!==-1&&ni(this.currentSampleCount===t.sampleCount)},e.prototype.setPipeline=function(t){var r=this;if(this.renderBundle){this.renderBundle.push(function(){return r.setPipeline(t)});return}this.currentPipeline=t,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var n=this.currentPipeline.program;if(this.useProgram(n),n.compileState===zc.NeedsBind){var i=this.gl,a=n.gl_program,o=n.descriptor,s=OH(o.vertex.glsl,xzt);if(cn(i))for(var l=0;l<s.length;l++){var u=Pr(s[l],2),c=u[1],f=i.getUniformBlockIndex(a,c);f!==-1&&f!==4294967295&&i.uniformBlockBinding(a,f,l)}for(var d=OH(o.fragment.glsl,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm),l=0;l<d.length;l++){var v=Pr(d[l],3),g=v[1],x=v[2],w=i.getUniformLocation(a,g);i.uniform1i(w,parseInt(x))}n.compileState=zc.ReadyToUse}},e.prototype.setVertexInput=function(t,r,n){var i,a,o=this,s;if(this.renderBundle){this.renderBundle.push(function(){return o.setVertexInput(t,r,n)});return}if(t!==null){ni(this.currentPipeline.inputLayout===t);var l=t;this.bindVAO(l.vao);for(var u=this.gl,c=0;c<l.vertexBufferDescriptors.length;c++){var f=l.vertexBufferDescriptors[c],d=f.arrayStride,v=f.attributes;try{for(var g=(i=void 0,yi(v)),x=g.next();!x.done;x=g.next()){var w=x.value,S=w.shaderLocation,M=w.offset,R=cn(u)?S:(s=l.program.attributes[S])===null||s===void 0?void 0:s.location;if(!Gf(R)){var I=r[c];if(I===null)continue;var P=w.vertexFormat;u.bindBuffer(u.ARRAY_BUFFER,Sx(I.buffer));var k=(I.offset||0)+M;u.vertexAttribPointer(R,P.size,P.type,P.normalized,d,k)}}}catch(G){i={error:G}}finally{try{x&&!x.done&&(a=g.return)&&a.call(g)}finally{if(i)throw i.error}}}if(ni(n!==null==(l.indexBufferFormat!==null)),n!==null){var z=n.buffer;ni(z.usage===ka.INDEX),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,Sx(z)),this.currentIndexBufferByteOffset=n.offset||0}else this.currentIndexBufferByteOffset=null}else ni(this.currentPipeline.inputLayout===null),ni(n===null),this.bindVAO(null),this.currentIndexBufferByteOffset=0},e.prototype.setStencilReference=function(t){this.currentStencilRef!==t&&(this.currentStencilRef=t,this.applyStencil())},e.prototype.draw=function(t,r,n,i){var a,o=this;if(this.renderBundle){this.renderBundle.push(function(){return o.draw(t,r,n,i)});return}var s=this.gl,l=this.currentPipeline;if(r){var u=[l.drawMode,n||0,t,r];cn(s)?s.drawArraysInstanced.apply(s,on([],Pr(u),!1)):(a=this.ANGLE_instanced_arrays).drawArraysInstancedANGLE.apply(a,on([],Pr(u),!1))}else s.drawArrays(l.drawMode,n,t);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(t/3*Math.max(r,1))},e.prototype.drawIndexed=function(t,r,n,i,a){var o,s=this;if(this.renderBundle){this.renderBundle.push(function(){return s.drawIndexed(t,r,n,i,a)});return}var l=this.gl,u=this.currentPipeline,c=Iy(u.inputLayout),f=Iy(this.currentIndexBufferByteOffset)+n*c.indexBufferCompByteSize;if(r){var d=[u.drawMode,t,c.indexBufferType,f,r];cn(l)?l.drawElementsInstanced.apply(l,on([],Pr(d),!1)):(o=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(o,on([],Pr(d),!1))}else l.drawElements(u.drawMode,t,c.indexBufferType,f);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(t/3*Math.max(r,1))},e.prototype.drawIndirect=function(t,r){},e.prototype.drawIndexedIndirect=function(t,r){},e.prototype.beginOcclusionQuery=function(t){var r=this.gl;if(cn(r)){var n=this.currentRenderPassDescriptor.occlusionQueryPool;r.beginQuery(n.gl_query_type,n.gl_query[t])}},e.prototype.endOcclusionQuery=function(){var t=this.gl;if(cn(t)){var r=this.currentRenderPassDescriptor.occlusionQueryPool;t.endQuery(r.gl_query_type)}},e.prototype.pipelineQueryReady=function(t){var r=t;return this.queryProgramReady(r.program)},e.prototype.pipelineForceReady=function(t){},e.prototype.endPass=function(){for(var t=this.gl,r=cn(t),n=this.currentColorResolveTos.length===1&&this.currentColorResolveTos[0]===this.scTexture,i=!1,a=0;a<this.currentColorAttachments.length;a++){var o=this.currentColorAttachments[a];if(o!==null){var s=this.currentColorResolveTos[a],l=!1;s!==null&&(ni(o.width===s.width&&o.height===s.height),this.setScissorRectEnabled(!1),n||(r&&t.bindFramebuffer(t.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&r&&this.bindFramebufferAttachment(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,o,this.currentColorAttachmentLevels[a])),l=!0,n||(s===this.scTexture?t.bindFramebuffer(r?Ft.DRAW_FRAMEBUFFER:Ft.FRAMEBUFFER,this.scPlatformFramebuffer):(t.bindFramebuffer(r?Ft.DRAW_FRAMEBUFFER:Ft.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&t.framebufferTexture2D(r?Ft.DRAW_FRAMEBUFFER:Ft.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s.gl_texture,this.currentColorResolveToLevels[a]))),n||(r?(t.blitFramebuffer(0,0,o.width,o.height,0,0,s.width,s.height,t.COLOR_BUFFER_BIT,t.LINEAR),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null)):this.submitBlitRenderPass(o,s)),i=!0),this.currentRenderPassDescriptor.colorStore[a]||!n&&!l&&(t.bindFramebuffer(r?Ft.READ_FRAMEBUFFER:Ft.FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&this.bindFramebufferAttachment(r?Ft.READ_FRAMEBUFFER:Ft.FRAMEBUFFER,t.COLOR_ATTACHMENT0,o,this.currentColorAttachmentLevels[a])),n||t.bindFramebuffer(r?Ft.READ_FRAMEBUFFER:Ft.FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var u=this.currentDepthStencilAttachment;if(u){var c=this.currentDepthStencilResolveTo,l=!1;c&&(ni(u.width===c.width&&u.height===c.height),this.setScissorRectEnabled(!1),n||(t.bindFramebuffer(r?Ft.READ_FRAMEBUFFER:Ft.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),t.bindFramebuffer(r?Ft.DRAW_FRAMEBUFFER:Ft.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(r?Ft.READ_FRAMEBUFFER:Ft.FRAMEBUFFER,u),this.bindFramebufferDepthStencilAttachment(r?Ft.DRAW_FRAMEBUFFER:Ft.FRAMEBUFFER,c))),l=!0,n||(r&&t.blitFramebuffer(0,0,u.width,u.height,0,0,c.width,c.height,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(r?Ft.DRAW_FRAMEBUFFER:Ft.FRAMEBUFFER,null)),i=!0),!n&&!this.currentRenderPassDescriptor.depthStencilStore&&(l||(t.bindFramebuffer(r?Ft.READ_FRAMEBUFFER:Ft.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),this.resolveDepthStencilAttachmentsChanged&&this.bindFramebufferDepthStencilAttachment(r?Ft.READ_FRAMEBUFFER:Ft.FRAMEBUFFER,u),l=!0),r&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[t.DEPTH_STENCIL_ATTACHMENT])),!n&&l&&t.bindFramebuffer(r?Ft.READ_FRAMEBUFFER:Ft.FRAMEBUFFER,null),this.resolveDepthStencilAttachmentsChanged=!1}!n&&!i&&t.bindFramebuffer(r?Ft.DRAW_FRAMEBUFFER:Ft.FRAMEBUFFER,null)},e.prototype.setScissorRectEnabled=function(t){if(this.currentScissorEnabled!==t){var r=this.gl;t?r.enable(r.SCISSOR_TEST):r.disable(r.SCISSOR_TEST),this.currentScissorEnabled=t}},e.prototype.applyStencil=function(){Gf(this.currentStencilRef)||(this.gl.stencilFuncSeparate(Ft.FRONT,this.currentMegaState.stencilFront.compare,this.currentStencilRef,this.currentMegaState.stencilFront.mask||255),this.gl.stencilFuncSeparate(Ft.BACK,this.currentMegaState.stencilBack.compare,this.currentStencilRef,this.currentMegaState.stencilBack.mask||255))},e.prototype.getFallbackTexture=function(t){var r=t.gl_target,n=t.formatKind;if(r===Ft.TEXTURE_2D)return n===$o.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(r===Ft.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(r===Ft.TEXTURE_3D)return this.fallbackTexture3D;if(r===Ft.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.submitBlitRenderPass=function(t,r){this.blitRenderPipeline||(this.blitProgram=this.createProgram({vertex:{glsl:`layout(location = 0) in vec2 a_Position;
out vec2 v_TexCoord;
void main() {
  v_TexCoord = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);

  #ifdef VIEWPORT_ORIGIN_TL
    v_TexCoord.y = 1.0 - v_TexCoord.y;
  #endif
}`},fragment:{glsl:`uniform sampler2D u_Texture;
in vec2 v_TexCoord;
out vec4 outputColor;
void main() {
  outputColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);
}`}}),this.blitVertexBuffer=this.createBuffer({usage:ka.VERTEX|ka.COPY_DST,viewOrSize:new Float32Array([-4,-4,4,-4,0,4])}),this.blitInputLayout=this.createInputLayout({vertexBufferDescriptors:[{arrayStride:4*2,stepMode:s_.VERTEX,attributes:[{format:ee.F32_RG,offset:4*0,shaderLocation:0}]}],indexBufferFormat:null,program:this.blitProgram}),this.blitRenderPipeline=this.createRenderPipeline({topology:Ls.TRIANGLES,sampleCount:1,program:this.blitProgram,colorAttachmentFormats:[ee.U8_RGBA_RT],depthStencilAttachmentFormat:null,inputLayout:this.blitInputLayout,megaStateDescriptor:tb(eb)}),this.blitBindings=this.createBindings({samplerBindings:[{sampler:null,texture:t.texture}],uniformBufferBindings:[]}),this.blitProgram.setUniformsLegacy({u_Texture:t}));var n=this.currentRenderPassDescriptor;this.currentRenderPassDescriptor=null,this.inBlitRenderPass=!0;var i=this.createRenderPass({colorAttachment:[t],colorResolveTo:[r],colorClearColor:[_7t]}),a=this.getCanvas(),o=a.width,s=a.height;i.setPipeline(this.blitRenderPipeline),i.setBindings(this.blitBindings),i.setVertexInput(this.blitInputLayout,[{buffer:this.blitVertexBuffer}],null),i.setViewport(0,0,o,s),this.gl.disable(this.gl.BLEND),i.draw(3,0),this.gl.enable(this.gl.BLEND),this.currentRenderPassDescriptor=n,this.inBlitRenderPass=!1},e}(),Ezt=function(){function e(t){this.pluginOptions=t}return e.prototype.createSwapChain=function(t){return lu(this,void 0,void 0,function(){var r,n,i,a,o,s,l,u,c,f,d,v,g;return $h(this,function(x){return r=this.pluginOptions,n=r.targets,i=r.xrCompatible,a=r.antialias,o=a===void 0?!1:a,s=r.preserveDrawingBuffer,l=s===void 0?!1:s,u=r.premultipliedAlpha,c=u===void 0?!0:u,f=r.shaderDebug,d=r.trackResources,v={antialias:o,preserveDrawingBuffer:l,stencil:!0,premultipliedAlpha:c,xrCompatible:i},this.handleContextEvents(t),n.includes("webgl2")&&(g=t.getContext("webgl2",v)||t.getContext("experimental-webgl2",v)),!g&&n.includes("webgl1")&&(g=t.getContext("webgl",v)||t.getContext("experimental-webgl",v)),[2,new bzt(g,{shaderDebug:f,trackResources:d})]})})},e.prototype.handleContextEvents=function(t){var r=this.pluginOptions,n=r.onContextLost,i=r.onContextRestored,a=r.onContextCreationError;a&&t.addEventListener("webglcontextcreationerror",a,!1),n&&t.addEventListener("webglcontextlost",n,!1),i&&t.addEventListener("webglcontextrestored",i,!1)},e}();let Uo;const Ftt=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Ftt.decode();let Ow=null;function uM(){return(Ow===null||Ow.byteLength===0)&&(Ow=new Uint8Array(Uo.memory.buffer)),Ow}function yR(e,t){return e=e>>>0,Ftt.decode(uM().subarray(e,e+t))}const rg=new Array(128).fill(void 0);rg.push(void 0,null,!0,!1);let Kw=rg.length;function wzt(e){Kw===rg.length&&rg.push(rg.length+1);const t=Kw;return Kw=rg[t],rg[t]=e,t}function cM(e){return rg[e]}function Czt(e){e<132||(rg[e]=Kw,Kw=e)}function Szt(e){const t=cM(e);return Czt(e),t}let nb=0;const hM=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Tzt=typeof hM.encodeInto=="function"?function(e,t){return hM.encodeInto(e,t)}:function(e,t){const r=hM.encode(e);return t.set(r),{read:e.length,written:r.length}};function _R(e,t,r){if(r===void 0){const s=hM.encode(e),l=t(s.length,1)>>>0;return uM().subarray(l,l+s.length).set(s),nb=s.length,l}let n=e.length,i=t(n,1)>>>0;const a=uM();let o=0;for(;o<n;o++){const s=e.charCodeAt(o);if(s>127)break;a[i+o]=s}if(o!==n){o!==0&&(e=e.slice(o)),i=r(i,n,n=o+e.length*3,1)>>>0;const s=uM().subarray(i+o,i+n),l=Tzt(e,s);o+=l.written}return nb=o,i}let Pw=null;function xR(){return(Pw===null||Pw.byteLength===0)&&(Pw=new Int32Array(Uo.memory.buffer)),Pw}function Azt(e,t,r){let n,i;try{const s=Uo.__wbindgen_add_to_stack_pointer(-16),l=_R(e,Uo.__wbindgen_malloc,Uo.__wbindgen_realloc),u=nb,c=_R(t,Uo.__wbindgen_malloc,Uo.__wbindgen_realloc),f=nb;Uo.glsl_compile(s,l,u,c,f,r);var a=xR()[s/4+0],o=xR()[s/4+1];return n=a,i=o,yR(a,o)}finally{Uo.__wbindgen_add_to_stack_pointer(16),Uo.__wbindgen_free(n,i,1)}}class NC{static __wrap(t){t=t>>>0;const r=Object.create(NC.prototype);return r.__wbg_ptr=t,r}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();Uo.__wbg_wgslcomposer_free(t)}constructor(){const t=Uo.wgslcomposer_new();return NC.__wrap(t)}load_composable(t){const r=_R(t,Uo.__wbindgen_malloc,Uo.__wbindgen_realloc),n=nb;Uo.wgslcomposer_load_composable(this.__wbg_ptr,r,n)}wgsl_compile(t){let r,n;try{const o=Uo.__wbindgen_add_to_stack_pointer(-16),s=_R(t,Uo.__wbindgen_malloc,Uo.__wbindgen_realloc),l=nb;Uo.wgslcomposer_wgsl_compile(o,this.__wbg_ptr,s,l);var i=xR()[o/4+0],a=xR()[o/4+1];return r=i,n=a,yR(i,a)}finally{Uo.__wbindgen_add_to_stack_pointer(16),Uo.__wbindgen_free(r,n,1)}}}async function Mzt(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(n){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const r=await e.arrayBuffer();return await WebAssembly.instantiate(r,t)}else{const r=await WebAssembly.instantiate(e,t);return r instanceof WebAssembly.Instance?{instance:r,module:e}:r}}function Rzt(){const e={};return e.wbg={},e.wbg.__wbindgen_string_new=function(t,r){const n=yR(t,r);return wzt(n)},e.wbg.__wbindgen_object_drop_ref=function(t){Szt(t)},e.wbg.__wbg_log_1d3ae0273d8f4f8a=function(t){console.log(cM(t))},e.wbg.__wbg_log_576ca876af0d4a77=function(t,r){console.log(cM(t),cM(r))},e.wbg.__wbindgen_throw=function(t,r){throw new Error(yR(t,r))},e}function Izt(e,t){return Uo=e.exports,Btt.__wbindgen_wasm_module=t,Pw=null,Ow=null,Uo}async function Btt(e){if(Uo!==void 0)return Uo;const t=Rzt();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:r,module:n}=await Mzt(await e,t);return Izt(r,n)}var tl;(function(e){e[e.COPY_SRC=1]="COPY_SRC",e[e.COPY_DST=2]="COPY_DST",e[e.TEXTURE_BINDING=4]="TEXTURE_BINDING",e[e.STORAGE_BINDING=8]="STORAGE_BINDING",e[e.STORAGE=8]="STORAGE",e[e.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"})(tl||(tl={}));var vF;(function(e){e[e.READ=1]="READ",e[e.WRITE=2]="WRITE"})(vF||(vF={}));function Lzt(e){var t=0;return e&ku.SAMPLED&&(t|=tl.TEXTURE_BINDING|tl.COPY_DST|tl.COPY_SRC),e&ku.STORAGE&&(t|=tl.TEXTURE_BINDING|tl.STORAGE_BINDING|tl.COPY_SRC|tl.COPY_DST),e&ku.RENDER_TARGET&&(t|=tl.RENDER_ATTACHMENT|tl.TEXTURE_BINDING|tl.COPY_SRC|tl.COPY_DST),t}function j4(e){if(e===ee.U8_R_NORM)return"r8unorm";if(e===ee.S8_R_NORM)return"r8snorm";if(e===ee.U8_RG_NORM)return"rg8unorm";if(e===ee.S8_RG_NORM)return"rg8snorm";if(e===ee.U32_R)return"r32uint";if(e===ee.S32_R)return"r32sint";if(e===ee.F32_R)return"r32float";if(e===ee.U16_RG)return"rg16uint";if(e===ee.S16_RG)return"rg16sint";if(e===ee.F16_RG)return"rg16float";if(e===ee.U8_RGBA_RT)return"bgra8unorm";if(e===ee.U8_RGBA_RT_SRGB)return"bgra8unorm-srgb";if(e===ee.U8_RGBA_NORM)return"rgba8unorm";if(e===ee.U8_RGBA_SRGB)return"rgba8unorm-srgb";if(e===ee.S8_RGBA_NORM)return"rgba8snorm";if(e===ee.U32_RG)return"rg32uint";if(e===ee.S32_RG)return"rg32sint";if(e===ee.F32_RG)return"rg32float";if(e===ee.U16_RGBA)return"rgba16uint";if(e===ee.S16_RGBA)return"rgba16sint";if(e===ee.F16_RGBA)return"rgba16float";if(e===ee.F32_RGBA)return"rgba32float";if(e===ee.U32_RGBA)return"rgba32uint";if(e===ee.S32_RGBA)return"rgba32sint";if(e===ee.D24)return"depth24plus";if(e===ee.D24_S8)return"depth24plus-stencil8";if(e===ee.D32F)return"depth32float";if(e===ee.D32F_S8)return"depth32float-stencil8";if(e===ee.BC1)return"bc1-rgba-unorm";if(e===ee.BC1_SRGB)return"bc1-rgba-unorm-srgb";if(e===ee.BC2)return"bc2-rgba-unorm";if(e===ee.BC2_SRGB)return"bc2-rgba-unorm-srgb";if(e===ee.BC3)return"bc3-rgba-unorm";if(e===ee.BC3_SRGB)return"bc3-rgba-unorm-srgb";if(e===ee.BC4_SNORM)return"bc4-r-snorm";if(e===ee.BC4_UNORM)return"bc4-r-unorm";if(e===ee.BC5_SNORM)return"bc5-rg-snorm";if(e===ee.BC5_UNORM)return"bc5-rg-unorm";throw"whoops"}function Ozt(e){if(e===Pi.TEXTURE_2D)return"2d";if(e===Pi.TEXTURE_CUBE_MAP)return"2d";if(e===Pi.TEXTURE_2D_ARRAY)return"2d";if(e===Pi.TEXTURE_3D)return"3d";throw new Error("whoops")}function Pzt(e){if(e===Pi.TEXTURE_2D)return"2d";if(e===Pi.TEXTURE_CUBE_MAP)return"cube";if(e===Pi.TEXTURE_2D_ARRAY)return"2d-array";if(e===Pi.TEXTURE_3D)return"3d";throw new Error("whoops")}function Dzt(e){var t=0;return e&ka.INDEX&&(t|=GPUBufferUsage.INDEX),e&ka.VERTEX&&(t|=GPUBufferUsage.VERTEX),e&ka.UNIFORM&&(t|=GPUBufferUsage.UNIFORM),e&ka.STORAGE&&(t|=GPUBufferUsage.STORAGE),e&ka.COPY_SRC&&(t|=GPUBufferUsage.COPY_SRC),e&ka.INDIRECT&&(t|=GPUBufferUsage.INDIRECT),t|=GPUBufferUsage.COPY_DST,t}function YO(e){if(e===sc.CLAMP_TO_EDGE)return"clamp-to-edge";if(e===sc.REPEAT)return"repeat";if(e===sc.MIRRORED_REPEAT)return"mirror-repeat";throw new Error("whoops")}function DH(e){if(e===es.BILINEAR)return"linear";if(e===es.POINT)return"nearest";throw new Error("whoops")}function Fzt(e){if(e===rl.LINEAR)return"linear";if(e===rl.NEAREST)return"nearest";if(e===rl.NO_MIP)return"nearest";throw new Error("whoops")}function lx(e){var t=e;return t.gpuBuffer}function Bzt(e){var t=e;return t.gpuSampler}function Nzt(e){var t=e;return t.querySet}function kzt(e){if(e===dR.OcclusionConservative)return"occlusion";throw new Error("whoops")}function zzt(e){switch(e){case Ls.TRIANGLES:return"triangle-list";case Ls.POINTS:return"point-list";case Ls.TRIANGLE_STRIP:return"triangle-strip";case Ls.LINES:return"line-list";case Ls.LINE_STRIP:return"line-strip";default:throw new Error("Unknown primitive topology mode")}}function Uzt(e){if(e===Wc.NONE)return"none";if(e===Wc.FRONT)return"front";if(e===Wc.BACK)return"back";throw new Error("whoops")}function $zt(e){if(e===BC.CCW)return"ccw";if(e===BC.CW)return"cw";throw new Error("whoops")}function Hzt(e,t){return{topology:zzt(e),cullMode:Uzt(t.cullMode),frontFace:$zt(t.frontFace)}}function FH(e){if(e===Oi.ZERO)return"zero";if(e===Oi.ONE)return"one";if(e===Oi.SRC)return"src";if(e===Oi.ONE_MINUS_SRC)return"one-minus-src";if(e===Oi.DST)return"dst";if(e===Oi.ONE_MINUS_DST)return"one-minus-dst";if(e===Oi.SRC_ALPHA)return"src-alpha";if(e===Oi.ONE_MINUS_SRC_ALPHA)return"one-minus-src-alpha";if(e===Oi.DST_ALPHA)return"dst-alpha";if(e===Oi.ONE_MINUS_DST_ALPHA)return"one-minus-dst-alpha";if(e===Oi.CONST)return"constant";if(e===Oi.ONE_MINUS_CONSTANT)return"one-minus-constant";if(e===Oi.SRC_ALPHA_SATURATE)return"src-alpha-saturated";throw new Error("whoops")}function Vzt(e){if(e===_l.ADD)return"add";if(e===_l.SUBSTRACT)return"subtract";if(e===_l.REVERSE_SUBSTRACT)return"reverse-subtract";if(e===_l.MIN)return"min";if(e===_l.MAX)return"max";throw new Error("whoops")}function BH(e){return{operation:Vzt(e.blendMode),srcFactor:FH(e.blendSrcFactor),dstFactor:FH(e.blendDstFactor)}}function NH(e){return e.blendMode===_l.ADD&&e.blendSrcFactor===Oi.ONE&&e.blendDstFactor===Oi.ZERO}function Gzt(e){if(!(NH(e.rgbBlendState)&&NH(e.alphaBlendState)))return{color:BH(e.rgbBlendState),alpha:BH(e.alphaBlendState)}}function Wzt(e,t){return{format:j4(t),blend:Gzt(e),writeMask:e.channelWriteMask}}function Xzt(e,t){return t.attachmentsState.map(function(r,n){return Wzt(r,e[n])})}function fM(e){if(e===ga.NEVER)return"never";if(e===ga.LESS)return"less";if(e===ga.EQUAL)return"equal";if(e===ga.LEQUAL)return"less-equal";if(e===ga.GREATER)return"greater";if(e===ga.NOTEQUAL)return"not-equal";if(e===ga.GEQUAL)return"greater-equal";if(e===ga.ALWAYS)return"always";throw new Error("whoops")}function U1(e){if(e===Ho.KEEP)return"keep";if(e===Ho.REPLACE)return"replace";if(e===Ho.ZERO)return"zero";if(e===Ho.DECREMENT_CLAMP)return"decrement-clamp";if(e===Ho.DECREMENT_WRAP)return"decrement-wrap";if(e===Ho.INCREMENT_CLAMP)return"increment-clamp";if(e===Ho.INCREMENT_WRAP)return"increment-wrap";if(e===Ho.INVERT)return"invert";throw new Error("whoops")}function jzt(e,t){if(!Gf(e))return{format:j4(e),depthWriteEnabled:!!t.depthWrite,depthCompare:fM(t.depthCompare),depthBias:t.polygonOffset?t.polygonOffsetUnits:0,depthBiasSlopeScale:t.polygonOffset?t.polygonOffsetFactor:0,stencilFront:{compare:fM(t.stencilFront.compare),passOp:U1(t.stencilFront.passOp),failOp:U1(t.stencilFront.failOp),depthFailOp:U1(t.stencilFront.depthFailOp)},stencilBack:{compare:fM(t.stencilBack.compare),passOp:U1(t.stencilBack.passOp),failOp:U1(t.stencilBack.failOp),depthFailOp:U1(t.stencilBack.depthFailOp)},stencilReadMask:4294967295,stencilWriteMask:4294967295}}function Yzt(e){if(e!==null){if(e===ee.U16_R)return"uint16";if(e===ee.U32_R)return"uint32";throw new Error("whoops")}}function Zzt(e){if(e===s_.VERTEX)return"vertex";if(e===s_.INSTANCE)return"instance";throw new Error("whoops")}function qzt(e){if(e===ee.U8_R)return"uint8x2";if(e===ee.U8_RG)return"uint8x2";if(e===ee.U8_RGB)return"uint8x4";if(e===ee.U8_RGBA)return"uint8x4";if(e===ee.U8_RG_NORM)return"unorm8x2";if(e===ee.U8_RGBA_NORM)return"unorm8x4";if(e===ee.S8_RGB_NORM)return"snorm8x4";if(e===ee.S8_RGBA_NORM)return"snorm8x4";if(e===ee.U16_RG_NORM)return"unorm16x2";if(e===ee.U16_RGBA_NORM)return"unorm16x4";if(e===ee.S16_RG_NORM)return"snorm16x2";if(e===ee.S16_RGBA_NORM)return"snorm16x4";if(e===ee.S16_RG)return"uint16x2";if(e===ee.F16_RG)return"float16x2";if(e===ee.F16_RGBA)return"float16x4";if(e===ee.F32_R)return"float32";if(e===ee.F32_RG)return"float32x2";if(e===ee.F32_RGB)return"float32x3";if(e===ee.F32_RGBA)return"float32x4";throw"whoops"}function Kzt(e){var t=lv(e);switch(t){case We.BC1:case We.BC2:case We.BC3:case We.BC4_SNORM:case We.BC4_UNORM:case We.BC5_SNORM:case We.BC5_UNORM:return!0;default:return!1}}function Qzt(e){var t=lv(e);switch(t){case We.BC1:case We.BC2:case We.BC3:case We.BC4_SNORM:case We.BC4_UNORM:case We.BC5_SNORM:case We.BC5_UNORM:return 4;default:return 1}}function kH(e,t,r,n){switch(r===void 0&&(r=!1),e){case ee.S8_R:case ee.S8_R_NORM:case ee.S8_RG_NORM:case ee.S8_RGB_NORM:case ee.S8_RGBA_NORM:{var i=t instanceof ArrayBuffer?new Int8Array(t):new Int8Array(t);return n&&i.set(new Int8Array(n)),i}case ee.U8_R:case ee.U8_R_NORM:case ee.U8_RG:case ee.U8_RG_NORM:case ee.U8_RGB:case ee.U8_RGB_NORM:case ee.U8_RGB_SRGB:case ee.U8_RGBA:case ee.U8_RGBA_NORM:case ee.U8_RGBA_SRGB:{var a=t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t);return n&&a.set(new Uint8Array(n)),a}case ee.S16_R:case ee.S16_RG:case ee.S16_RG_NORM:case ee.S16_RGB_NORM:case ee.S16_RGBA:case ee.S16_RGBA_NORM:{var o=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(r?t/2:t);return n&&o.set(new Int16Array(n)),o}case ee.U16_R:case ee.U16_RGB:case ee.U16_RGBA_5551:case ee.U16_RGBA_NORM:case ee.U16_RG_NORM:case ee.U16_R_NORM:{var s=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(r?t/2:t);return n&&s.set(new Uint16Array(n)),s}case ee.S32_R:{var l=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(r?t/4:t);return n&&l.set(new Int32Array(n)),l}case ee.U32_R:case ee.U32_RG:{var u=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(r?t/4:t);return n&&u.set(new Uint32Array(n)),u}case ee.F32_R:case ee.F32_RG:case ee.F32_RGB:case ee.F32_RGBA:{var c=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(r?t/4:t);return n&&c.set(new Float32Array(n)),c}}var f=t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t);return n&&f.set(new Uint8Array(n)),f}function Jzt(e){var t=(e&32768)>>15,r=(e&31744)>>10,n=e&1023;return r===0?(t?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):r==31?n?NaN:(t?-1:1)*(1/0):(t?-1:1)*Math.pow(2,r-15)*(1+n/Math.pow(2,10))}function Ntt(e){switch(e){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2unorm":case"rg11b10ufloat":return{width:1,height:1,length:4};case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw new Error("No fixed size for Stencil8 format!");case"depth16unorm":return{width:1,height:1,length:2};case"depth24plus":throw new Error("No fixed size for Depth24Plus format!");case"depth24plus-stencil8":throw new Error("No fixed size for Depth24PlusStencil8 format!");case"depth32float":return{width:1,height:1,length:4};case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc5-rg-unorm":case"bc5-rg-snorm":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":return{width:4,height:4,length:8};default:return{width:1,height:1,length:4}}}var tp=function(e){$t(t,e);function t(r){var n=r.id,i=r.device,a=e.call(this)||this;return a.id=n,a.device=i,a}return t.prototype.destroy=function(){},t}(Ett),tUt=function(e){$t(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,o,s,l=e.call(this,{id:n,device:i})||this;l.type=ta.Bindings;var u=a.pipeline;ni(!!u);var c=a.uniformBufferBindings,f=a.storageBufferBindings,d=a.samplerBindings,v=a.storageTextureBindings;l.numUniformBuffers=(c==null?void 0:c.length)||0;var g=[[],[],[],[]],x=0;if(c&&c.length)for(var w=0;w<c.length;w++){var S=a.uniformBufferBindings[w],M=S.binding,R=S.size,I=S.offset,P=S.buffer,k={buffer:lx(P),offset:I??0,size:R};g[0].push({binding:M??x++,resource:k})}if(d&&d.length){x=0;for(var w=0;w<d.length;w++){var z=$($({},d[w]),Ltt),M=a.samplerBindings[w],G=M.texture!==null?M.texture:l.device.getFallbackTexture(z);z.dimension=G.dimension,z.formatKind=Stt(G.format);var J=G.gpuTextureView;if(g[1].push({binding:(o=M.textureBinding)!==null&&o!==void 0?o:x++,resource:J}),M.samplerBinding!==-1){var Z=M.sampler!==null?M.sampler:l.device.getFallbackSampler(z),X=Bzt(Z);g[1].push({binding:(s=M.samplerBinding)!==null&&s!==void 0?s:x++,resource:X})}}}if(f&&f.length){x=0;for(var w=0;w<f.length;w++){var et=a.storageBufferBindings[w],M=et.binding,R=et.size,I=et.offset,P=et.buffer,k={buffer:lx(P),offset:I??0,size:R};g[2].push({binding:M??x++,resource:k})}}if(v&&v.length){x=0;for(var w=0;w<v.length;w++){var at=a.storageTextureBindings[w],M=at.binding,G=at.texture,J=G.gpuTextureView;g[3].push({binding:M??x++,resource:J})}}var wt=g.findLastIndex(function(Tt){return!!Tt.length});return l.gpuBindGroup=g.map(function(Tt,vt){return vt<=wt&&l.device.device.createBindGroup({layout:u.getBindGroupLayout(vt),entries:Tt})}),l}return t}(tp),eUt=function(e){$t(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,o=e.call(this,{id:n,device:i})||this;o.type=ta.Buffer;var s=a.usage,l=a.viewOrSize,u=!!(s&ka.MAP_READ);o.usage=Dzt(s),u&&(o.usage=ka.MAP_READ|ka.COPY_DST);var c=!ox(l);if(o.view=ox(l)?null:l,o.size=ox(l)?vR(l,4):vR(l.byteLength,4),ox(l))o.gpuBuffer=o.device.device.createBuffer({usage:o.usage,size:o.size,mappedAtCreation:u?c:!1});else{o.gpuBuffer=o.device.device.createBuffer({usage:o.usage,size:o.size,mappedAtCreation:!0});var f=l&&l.constructor||Float32Array;new f(o.gpuBuffer.getMappedRange()).set(l),o.gpuBuffer.unmap()}return o}return t.prototype.setSubData=function(r,n,i,a){i===void 0&&(i=0),a===void 0&&(a=0);var o=this.gpuBuffer;a=a||n.byteLength,a=Math.min(a,this.size-r);var s=n.byteOffset+i,l=s+a,u=a+3&-4;if(u!==a){var c=new Uint8Array(n.buffer.slice(s,l));n=new Uint8Array(u),n.set(c),i=0,s=0,l=u,a=u}for(var f=1024*1024*15,d=0;l-(s+d)>f;)this.device.device.queue.writeBuffer(o,r+d,n.buffer,s+d,f),d+=f;this.device.device.queue.writeBuffer(o,r+d,n.buffer,s+d,a-d)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuBuffer.destroy()},t}(tp),zH=function(){function e(){this.gpuComputePassEncoder=null}return e.prototype.dispatchWorkgroups=function(t,r,n){this.gpuComputePassEncoder.dispatchWorkgroups(t,r,n)},e.prototype.dispatchWorkgroupsIndirect=function(t,r){this.gpuComputePassEncoder.dispatchWorkgroupsIndirect(t.gpuBuffer,r)},e.prototype.finish=function(){this.gpuComputePassEncoder.end(),this.gpuComputePassEncoder=null,this.frameCommandEncoder=null},e.prototype.beginComputePass=function(t){ni(this.gpuComputePassEncoder===null),this.frameCommandEncoder=t,this.gpuComputePassEncoder=this.frameCommandEncoder.beginComputePass(this.gpuComputePassDescriptor)},e.prototype.setPipeline=function(t){var r=t,n=Iy(r.gpuComputePipeline);this.gpuComputePassEncoder.setPipeline(n)},e.prototype.setBindings=function(t){var r=this,n=t;n.gpuBindGroup.forEach(function(i,a){i&&r.gpuComputePassEncoder.setBindGroup(a,n.gpuBindGroup[a])})},e.prototype.pushDebugGroup=function(t){this.gpuComputePassEncoder.pushDebugGroup(t)},e.prototype.popDebugGroup=function(){this.gpuComputePassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(t){this.gpuComputePassEncoder.insertDebugMarker(t)},e}(),rUt=function(e){$t(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,o=e.call(this,{id:n,device:i})||this;o.type=ta.ComputePipeline,o.gpuComputePipeline=null,o.descriptor=a;var s=a.program,l=s.computeStage;if(l===null)return o;var u={layout:"auto",compute:$({},l)};return o.gpuComputePipeline=o.device.device.createComputePipeline(u),o.name!==void 0&&(o.gpuComputePipeline.label=o.name),o}return t.prototype.getBindGroupLayout=function(r){return this.gpuComputePipeline.getBindGroupLayout(r)},t}(tp),nUt=function(e){$t(t,e);function t(r){var n,i,a,o,s=r.id,l=r.device,u=r.descriptor,c=e.call(this,{id:s,device:l})||this;c.type=ta.InputLayout;var f=[];try{for(var d=yi(u.vertexBufferDescriptors),v=d.next();!v.done;v=d.next()){var g=v.value,x=g.arrayStride,w=g.stepMode,S=g.attributes;f.push({arrayStride:x,stepMode:Zzt(w),attributes:[]});try{for(var M=(a=void 0,yi(S)),R=M.next();!R.done;R=M.next()){var I=R.value,P=I.shaderLocation,k=I.format,z=I.offset;f[f.length-1].attributes.push({shaderLocation:P,format:qzt(k),offset:z})}}catch(G){a={error:G}}finally{try{R&&!R.done&&(o=M.return)&&o.call(M)}finally{if(a)throw a.error}}}}catch(G){n={error:G}}finally{try{v&&!v.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}return c.indexFormat=Yzt(u.indexBufferFormat),c.buffers=f,c}return t}(tp),UH=function(e){$t(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,o=e.call(this,{id:n,device:i})||this;return o.type=ta.Program,o.vertexStage=null,o.fragmentStage=null,o.computeStage=null,o.descriptor=a,a.vertex&&(o.vertexStage=o.createShaderStage(a.vertex,"vertex")),a.fragment&&(o.fragmentStage=o.createShaderStage(a.fragment,"fragment")),a.compute&&(o.computeStage=o.createShaderStage(a.compute,"compute")),o}return t.prototype.setUniformsLegacy=function(r){},t.prototype.createShaderStage=function(r,n){var i,a,o=r.glsl,s=r.wgsl,l=r.entryPoint,u=r.postprocess,c=!1,f=s;if(!f)try{f=this.device.glsl_compile(o,n,c)}catch(S){throw console.error(S,o),new Error("whoops")}var d=function(S){if(!f.includes(S))return"continue";f=f.replace("var T_".concat(S,": texture_2d<f32>;"),"var T_".concat(S,": texture_depth_2d;")),f=f.replace(new RegExp("textureSample\\(T_".concat(S,"(.*)\\);$"),"gm"),function(M,R){return"vec4<f32>(textureSample(T_".concat(S).concat(R,"), 0.0, 0.0, 0.0);")})};try{for(var v=yi(["u_TextureFramebufferDepth"]),g=v.next();!g.done;g=v.next()){var x=g.value;d(x)}}catch(S){i={error:S}}finally{try{g&&!g.done&&(a=v.return)&&a.call(v)}finally{if(i)throw i.error}}u&&(f=u(f));var w=this.device.device.createShaderModule({code:f});return{module:w,entryPoint:l||"main"}},t}(tp),iUt=function(e){$t(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,o=e.call(this,{id:n,device:i})||this;o.type=ta.QueryPool;var s=a.elemCount,l=a.type;return o.querySet=o.device.device.createQuerySet({type:kzt(l),count:s}),o.resolveBuffer=o.device.device.createBuffer({size:s*8,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),o.cpuBuffer=o.device.device.createBuffer({size:s*8,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),o.results=null,o}return t.prototype.queryResultOcclusion=function(r){return this.results===null?null:this.results[r]!==BigInt(0)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.querySet.destroy(),this.resolveBuffer.destroy(),this.cpuBuffer.destroy()},t}(tp),aUt=function(e){$t(t,e);function t(r){var n=r.id,i=r.device,a=e.call(this,{id:n,device:i})||this;return a.type=ta.Readback,a}return t.prototype.readTexture=function(r,n,i,a,o,s,l,u){return l===void 0&&(l=0),lu(this,void 0,void 0,function(){var c,f,d,v,g,x,w,S;return $h(this,function(M){return c=r,f=0,d=Ntt(c.gpuTextureformat),v=Math.ceil(a/d.width)*d.length,g=Math.ceil(v/256)*256,x=g*o,w=this.device.createBuffer({usage:ka.STORAGE|ka.MAP_READ|ka.COPY_DST,hint:$d.STATIC,viewOrSize:x}),S=this.device.device.createCommandEncoder(),S.copyTextureToBuffer({texture:c.gpuTexture,mipLevel:0,origin:{x:n,y:i,z:Math.max(f,0)}},{buffer:w.gpuBuffer,offset:0,bytesPerRow:g},{width:a,height:o,depthOrArrayLayers:1}),this.device.device.queue.submit([S.finish()]),[2,this.readBuffer(w,0,s.byteLength===x?s:null,l,x,c.format,!0,!1,v,g,o)]})})},t.prototype.readTextureSync=function(r,n,i,a,o,s,l,u){throw new Error("ERROR_MSG_METHOD_NOT_IMPLEMENTED")},t.prototype.readBuffer=function(r,n,i,a,o,s,l,u,c,f,d){var v=this;n===void 0&&(n=0),i===void 0&&(i=null),o===void 0&&(o=0),s===void 0&&(s=ee.U8_RGB),l===void 0&&(l=!1),c===void 0&&(c=0),f===void 0&&(f=0),d===void 0&&(d=0);var g=r,x=o||g.size,w=i||g.view,S=w&&w.constructor&&w.constructor.BYTES_PER_ELEMENT||Ctt(s),M=g;if(!(g.usage&ka.MAP_READ&&g.usage&ka.COPY_DST)){var R=this.device.device.createCommandEncoder();M=this.device.createBuffer({usage:ka.STORAGE|ka.MAP_READ|ka.COPY_DST,hint:$d.STATIC,viewOrSize:x}),R.copyBufferToBuffer(g.gpuBuffer,n,M.gpuBuffer,0,x),this.device.device.queue.submit([R.finish()])}return new Promise(function(I,P){M.gpuBuffer.mapAsync(vF.READ,n,x).then(function(){var k=M.gpuBuffer.getMappedRange(n,x),z=w;if(l)z===null?z=kH(s,x,!0,k):z=kH(s,z.buffer,void 0,k);else if(z===null)switch(S){case 1:z=new Uint8Array(x),z.set(new Uint8Array(k));break;case 2:z=v.getHalfFloatAsFloatRGBAArrayBuffer(x/2,k);break;case 4:z=new Float32Array(x/4),z.set(new Float32Array(k));break}else switch(S){case 1:z=new Uint8Array(z.buffer),z.set(new Uint8Array(k));break;case 2:z=v.getHalfFloatAsFloatRGBAArrayBuffer(x/2,k,w);break;case 4:var G=w&&w.constructor||Float32Array;z=new G(z.buffer),z.set(new G(k));break}if(c!==f){S===1&&!l&&(c*=2,f*=2);for(var J=new Uint8Array(z.buffer),Z=c,X=0,et=1;et<d;++et){X=et*f;for(var at=0;at<c;++at)J[Z++]=J[X++]}S!==0&&!l?z=new Float32Array(J.buffer,0,Z/4):z=new Uint8Array(J.buffer,0,Z)}M.gpuBuffer.unmap(),I(z)},function(k){return P(k)})})},t.prototype.getHalfFloatAsFloatRGBAArrayBuffer=function(r,n,i){i||(i=new Float32Array(r));for(var a=new Uint16Array(n);r--;)i[r]=Jzt(a[r]);return i},t}(tp),$H=function(){function e(t){this.device=t,this.gpuRenderPassEncoder=null,this.gfxColorAttachment=[],this.gfxColorAttachmentLevel=[],this.gfxColorResolveTo=[],this.gfxColorResolveToLevel=[],this.gfxDepthStencilAttachment=null,this.gfxDepthStencilResolveTo=null,this.gpuColorAttachments=[],this.gpuDepthStencilAttachment={view:null,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"},this.gpuRenderPassDescriptor={colorAttachments:this.gpuColorAttachments,depthStencilAttachment:this.gpuDepthStencilAttachment}}return e.prototype.getEncoder=function(){var t;return((t=this.renderBundle)===null||t===void 0?void 0:t.renderBundleEncoder)||this.gpuRenderPassEncoder},e.prototype.getTextureView=function(t,r){return ni(r<t.mipLevelCount),t.mipLevelCount===1?t.gpuTextureView:t.gpuTexture.createView({baseMipLevel:r,mipLevelCount:1})},e.prototype.setRenderPassDescriptor=function(t){var r,n,i,a,o,s;this.descriptor=t,this.gpuRenderPassDescriptor.colorAttachments=this.gpuColorAttachments;var l=t.colorAttachment.length;this.gfxColorAttachment.length=l,this.gfxColorResolveTo.length=l;for(var u=0;u<t.colorAttachment.length;u++){var c=t.colorAttachment[u],f=t.colorResolveTo[u];if(c===null&&f!==null&&(c=f,f=null),this.gfxColorAttachment[u]=c,this.gfxColorResolveTo[u]=f,this.gfxColorAttachmentLevel[u]=((r=t.colorAttachmentLevel)===null||r===void 0?void 0:r[u])||0,this.gfxColorResolveToLevel[u]=((n=t.colorResolveToLevel)===null||n===void 0?void 0:n[u])||0,c!==null){this.gpuColorAttachments[u]===void 0&&(this.gpuColorAttachments[u]={});var d=this.gpuColorAttachments[u];d.view=this.getTextureView(c,((i=this.gfxColorAttachmentLevel)===null||i===void 0?void 0:i[u])||0);var v=(o=(a=t.colorClearColor)===null||a===void 0?void 0:a[u])!==null&&o!==void 0?o:"load";v==="load"?d.loadOp="load":(d.loadOp="clear",d.clearValue=v),d.storeOp=!((s=t.colorStore)===null||s===void 0)&&s[u]?"store":"discard",d.resolveTarget=void 0,f!==null&&(c.sampleCount>1?d.resolveTarget=this.getTextureView(f,this.gfxColorResolveToLevel[u]):d.storeOp="store")}else{this.gpuColorAttachments.length=u,this.gfxColorAttachment.length=u,this.gfxColorResolveTo.length=u;break}}if(this.gfxDepthStencilAttachment=t.depthStencilAttachment,this.gfxDepthStencilResolveTo=t.depthStencilResolveTo,t.depthStencilAttachment){var g=t.depthStencilAttachment,d=this.gpuDepthStencilAttachment;d.view=g.gpuTextureView;var x=!!(Jx(g.format)&Nr.Depth);x?(t.depthClearValue==="load"?d.depthLoadOp="load":(d.depthLoadOp="clear",d.depthClearValue=t.depthClearValue),t.depthStencilStore||this.gfxDepthStencilResolveTo!==null?d.depthStoreOp="store":d.depthStoreOp="discard"):(d.depthLoadOp=void 0,d.depthStoreOp=void 0);var w=!!(Jx(g.format)&Nr.Stencil);w?(t.stencilClearValue==="load"?d.stencilLoadOp="load":(d.stencilLoadOp="clear",d.stencilClearValue=t.stencilClearValue),t.depthStencilStore||this.gfxDepthStencilResolveTo!==null?d.stencilStoreOp="store":d.stencilStoreOp="discard"):(d.stencilLoadOp=void 0,d.stencilStoreOp=void 0),this.gpuRenderPassDescriptor.depthStencilAttachment=this.gpuDepthStencilAttachment}else this.gpuRenderPassDescriptor.depthStencilAttachment=void 0;this.gpuRenderPassDescriptor.occlusionQuerySet=Gf(t.occlusionQueryPool)?void 0:Nzt(t.occlusionQueryPool)},e.prototype.beginRenderPass=function(t,r){ni(this.gpuRenderPassEncoder===null),this.setRenderPassDescriptor(r),this.frameCommandEncoder=t,this.gpuRenderPassEncoder=this.frameCommandEncoder.beginRenderPass(this.gpuRenderPassDescriptor)},e.prototype.flipY=function(t,r){var n=this.device.swapChainHeight;return n-t-r},e.prototype.setViewport=function(t,r,n,i,a,o){a===void 0&&(a=0),o===void 0&&(o=1),this.gpuRenderPassEncoder.setViewport(t,this.flipY(r,i),n,i,a,o)},e.prototype.setScissorRect=function(t,r,n,i){this.gpuRenderPassEncoder.setScissorRect(t,this.flipY(r,i),n,i)},e.prototype.setPipeline=function(t){var r=t,n=Iy(r.gpuRenderPipeline);this.getEncoder().setPipeline(n)},e.prototype.setVertexInput=function(t,r,n){if(t!==null){var i=this.getEncoder(),a=t;n!==null&&i.setIndexBuffer(lx(n.buffer),Iy(a.indexFormat),n.offset);for(var o=0;o<r.length;o++){var s=r[o];s!==null&&i.setVertexBuffer(o,lx(s.buffer),s.offset)}}},e.prototype.setBindings=function(t){var r=t,n=this.getEncoder();r.gpuBindGroup.forEach(function(i,a){i&&n.setBindGroup(a,r.gpuBindGroup[a])})},e.prototype.setStencilReference=function(t){this.gpuRenderPassEncoder.setStencilReference(t)},e.prototype.draw=function(t,r,n,i){this.getEncoder().draw(t,r,n,i)},e.prototype.drawIndexed=function(t,r,n,i,a){this.getEncoder().drawIndexed(t,r,n,i,a)},e.prototype.drawIndirect=function(t,r){this.getEncoder().drawIndirect(lx(t),r)},e.prototype.drawIndexedIndirect=function(t,r){this.getEncoder().drawIndexedIndirect(lx(t),r)},e.prototype.beginOcclusionQuery=function(t){this.gpuRenderPassEncoder.beginOcclusionQuery(t)},e.prototype.endOcclusionQuery=function(){this.gpuRenderPassEncoder.endOcclusionQuery()},e.prototype.pushDebugGroup=function(t){this.gpuRenderPassEncoder.pushDebugGroup(t)},e.prototype.popDebugGroup=function(){this.gpuRenderPassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(t){this.gpuRenderPassEncoder.insertDebugMarker(t)},e.prototype.beginBundle=function(t){this.renderBundle=t},e.prototype.endBundle=function(){this.renderBundle.finish()},e.prototype.executeBundles=function(t){this.gpuRenderPassEncoder.executeBundles(t.map(function(r){return r.renderBundle}))},e.prototype.finish=function(){var t;(t=this.gpuRenderPassEncoder)===null||t===void 0||t.end(),this.gpuRenderPassEncoder=null;for(var r=0;r<this.gfxColorAttachment.length;r++){var n=this.gfxColorAttachment[r],i=this.gfxColorResolveTo[r];n!==null&&i!==null&&n.sampleCount===1&&this.copyAttachment(i,this.gfxColorAttachmentLevel[r],n,this.gfxColorResolveToLevel[r])}this.gfxDepthStencilAttachment&&this.gfxDepthStencilResolveTo&&(this.gfxDepthStencilAttachment.sampleCount>1||this.copyAttachment(this.gfxDepthStencilResolveTo,0,this.gfxDepthStencilAttachment,0)),this.frameCommandEncoder=null},e.prototype.copyAttachment=function(t,r,n,i){ni(n.sampleCount===1);var a={texture:n.gpuTexture,mipLevel:i},o={texture:t.gpuTexture,mipLevel:r};ni(n.width>>>i===t.width>>>r),ni(n.height>>>i===t.height>>>r),ni(!!(n.usage&tl.COPY_SRC)),ni(!!(t.usage&tl.COPY_DST)),this.frameCommandEncoder.copyTextureToTexture(a,o,[t.width,t.height,1])},e}(),oUt=function(e){$t(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,o=e.call(this,{id:n,device:i})||this;return o.type=ta.RenderPipeline,o.isCreatingAsync=!1,o.gpuRenderPipeline=null,o.descriptor=a,o.device.createRenderPipelineInternal(o,!1),o}return t.prototype.getBindGroupLayout=function(r){return this.gpuRenderPipeline.getBindGroupLayout(r)},t}(tp),sUt=function(e){$t(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,o,s,l=e.call(this,{id:n,device:i})||this;l.type=ta.Sampler;var u=a.lodMinClamp,c=a.mipmapFilter===rl.NO_MIP?a.lodMinClamp:a.lodMaxClamp,f=(o=a.maxAnisotropy)!==null&&o!==void 0?o:1;return f>1&&ni(a.minFilter===es.BILINEAR&&a.magFilter===es.BILINEAR&&a.mipmapFilter===rl.LINEAR),l.gpuSampler=l.device.device.createSampler({addressModeU:YO(a.addressModeU),addressModeV:YO(a.addressModeV),addressModeW:YO((s=a.addressModeW)!==null&&s!==void 0?s:a.addressModeU),lodMinClamp:u,lodMaxClamp:c,minFilter:DH(a.minFilter),magFilter:DH(a.magFilter),mipmapFilter:Fzt(a.mipmapFilter),compare:a.compareFunction!==void 0?fM(a.compareFunction):void 0,maxAnisotropy:f}),l}return t}(tp),jT=function(e){$t(t,e);function t(r){var n=r.id,i=r.device,a=r.descriptor,o=r.skipCreate,s=r.sampleCount,l=e.call(this,{id:n,device:i})||this;l.type=ta.Texture,l.flipY=!1;var u=a.format,c=a.dimension,f=a.width,d=a.height,v=a.depthOrArrayLayers,g=a.mipLevelCount,x=a.usage,w=a.pixelStore;return l.flipY=!!(w!=null&&w.unpackFlipY),l.device.createTextureShared({format:u,dimension:c??Pi.TEXTURE_2D,width:f,height:d,depthOrArrayLayers:v??1,mipLevelCount:g??1,usage:x,sampleCount:s??1},l,o),l}return t.prototype.textureFromImageBitmapOrCanvas=function(r,n,i){for(var a=n[0].width,o=n[0].height,s={size:{width:a,height:o,depthOrArrayLayers:i},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT},l=r.createTexture(s),u=0;u<n.length;u++)r.queue.copyExternalImageToTexture({source:n[u],flipY:this.flipY},{texture:l,origin:[0,0,u]},[a,o]);return[l,a,o]},t.prototype.isImageBitmapOrCanvases=function(r){var n=r[0];return n instanceof ImageBitmap||n instanceof HTMLCanvasElement||n instanceof OffscreenCanvas},t.prototype.isVideo=function(r){var n=r[0];return n instanceof HTMLVideoElement},t.prototype.setImageData=function(r,n){var i,a=this,o=this.device.device,s,l,u;if(this.isImageBitmapOrCanvases(r))i=Pr(this.textureFromImageBitmapOrCanvas(o,r,this.depthOrArrayLayers),3),s=i[0],l=i[1],u=i[2];else if(this.isVideo(r))s=o.importExternalTexture({source:r[0]});else{var c=Ntt(this.gpuTextureformat),f=Math.ceil(this.width/c.width)*c.length;r.forEach(function(d){o.queue.writeTexture({texture:a.gpuTexture},d,{bytesPerRow:f},{width:a.width,height:a.height})})}this.width=l,this.height=u,s&&(this.gpuTexture=s),this.gpuTextureView=this.gpuTexture.createView({dimension:Pzt(this.dimension)})},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuTexture.destroy()},t}(tp),lUt=function(e){$t(t,e);function t(r){var n=r.id,i=r.device,a=e.call(this,{id:n,device:i})||this;return a.type=ta.RenderBundle,a.renderBundleEncoder=a.device.device.createRenderBundleEncoder({colorFormats:[a.device.swapChainFormat]}),a}return t.prototype.finish=function(){this.renderBundle=this.renderBundleEncoder.finish()},t}(tp),uUt=function(){function e(t,r,n,i,a,o){this.swapChainWidth=0,this.swapChainHeight=0,this.swapChainTextureUsage=tl.RENDER_ATTACHMENT|tl.COPY_DST,this._resourceUniqueId=0,this.renderPassPool=[],this.computePassPool=[],this.frameCommandEncoderPool=[],this.featureTextureCompressionBC=!1,this.platformString="WebGPU",this.glslVersion="#version 440",this.explicitBindingLocations=!0,this.separateSamplerTextures=!0,this.viewportOrigin=kd.UPPER_LEFT,this.clipSpaceNearZ=Qx.ZERO,this.supportsSyncPipelineCompilation=!1,this.supportMRT=!0,this.device=r,this.canvas=n,this.canvasContext=i,this.glsl_compile=a,this.WGSLComposer=o,this.fallbackTexture2D=this.createFallbackTexture(Pi.TEXTURE_2D,$o.Float),this.setResourceName(this.fallbackTexture2D,"Fallback Texture2D"),this.fallbackTexture2DDepth=this.createFallbackTexture(Pi.TEXTURE_2D,$o.Depth),this.setResourceName(this.fallbackTexture2DDepth,"Fallback Depth Texture2D"),this.fallbackTexture2DArray=this.createFallbackTexture(Pi.TEXTURE_2D_ARRAY,$o.Float),this.setResourceName(this.fallbackTexture2DArray,"Fallback Texture2DArray"),this.fallbackTexture3D=this.createFallbackTexture(Pi.TEXTURE_3D,$o.Float),this.setResourceName(this.fallbackTexture3D,"Fallback Texture3D"),this.fallbackTextureCube=this.createFallbackTexture(Pi.TEXTURE_CUBE_MAP,$o.Float),this.setResourceName(this.fallbackTextureCube,"Fallback TextureCube"),this.fallbackSamplerFiltering=this.createSampler({addressModeU:sc.REPEAT,addressModeV:sc.REPEAT,minFilter:es.POINT,magFilter:es.POINT,mipmapFilter:rl.NEAREST}),this.setResourceName(this.fallbackSamplerFiltering,"Fallback Sampler Filtering"),this.fallbackSamplerComparison=this.createSampler({addressModeU:sc.REPEAT,addressModeV:sc.REPEAT,minFilter:es.POINT,magFilter:es.POINT,mipmapFilter:rl.NEAREST,compareFunction:ga.ALWAYS}),this.setResourceName(this.fallbackSamplerComparison,"Fallback Sampler Comparison Filtering"),this.device.features&&(this.featureTextureCompressionBC=this.device.features.has("texture-compression-bc")),this.device.onuncapturederror=function(s){console.error(s.error)},this.swapChainFormat=navigator.gpu.getPreferredCanvasFormat(),this.canvasContext.configure({device:this.device,format:this.swapChainFormat,usage:this.swapChainTextureUsage,alphaMode:"premultiplied"})}return e.prototype.destroy=function(){},e.prototype.configureSwapChain=function(t,r){this.swapChainWidth===t&&this.swapChainHeight===r||(this.swapChainWidth=t,this.swapChainHeight=r)},e.prototype.getOnscreenTexture=function(){var t=this.canvasContext.getCurrentTexture(),r=t.createView(),n=new jT({id:0,device:this,descriptor:{format:ee.U8_RGBA_RT,width:this.swapChainWidth,height:this.swapChainHeight,depthOrArrayLayers:0,dimension:Pi.TEXTURE_2D,mipLevelCount:1,usage:this.swapChainTextureUsage},skipCreate:!0});return n.depthOrArrayLayers=1,n.sampleCount=1,n.gpuTexture=t,n.gpuTextureView=r,n.name="Onscreen",this.setResourceName(n,"Onscreen Texture"),n},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.canvas},e.prototype.beginFrame=function(){ni(this.frameCommandEncoderPool.length===0)},e.prototype.endFrame=function(){ni(this.frameCommandEncoderPool.every(function(t){return t!==null})),this.device.queue.submit(this.frameCommandEncoderPool.map(function(t){return t.finish()})),this.frameCommandEncoderPool=[]},e.prototype.getNextUniqueId=function(){return++this._resourceUniqueId},e.prototype.createBuffer=function(t){return new eUt({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createTexture=function(t){return new jT({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createSampler=function(t){return new sUt({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderTarget=function(t){var r=new jT({id:this.getNextUniqueId(),device:this,descriptor:$($({},t),{dimension:Pi.TEXTURE_2D,mipLevelCount:1,depthOrArrayLayers:1,usage:ku.RENDER_TARGET}),sampleCount:t.sampleCount});return r.depthOrArrayLayers=1,r.type=ta.RenderTarget,r},e.prototype.createRenderTargetFromTexture=function(t){var r=t,n=r.format,i=r.width,a=r.height,o=r.depthOrArrayLayers,s=r.sampleCount,l=r.mipLevelCount,u=r.gpuTexture,c=r.gpuTextureView,f=r.usage;ni(!!(f&tl.RENDER_ATTACHMENT));var d=new jT({id:this.getNextUniqueId(),device:this,descriptor:{format:n,width:i,height:a,depthOrArrayLayers:o,dimension:Pi.TEXTURE_2D,mipLevelCount:l,usage:f},skipCreate:!0});return d.depthOrArrayLayers=o,d.sampleCount=s,d.gpuTexture=u,d.gpuTextureView=c,d},e.prototype.createProgram=function(t){var r,n;return!((r=t.vertex)===null||r===void 0)&&r.glsl&&(t.vertex.glsl=rb(this.queryVendorInfo(),"vert",t.vertex.glsl)),!((n=t.fragment)===null||n===void 0)&&n.glsl&&(t.fragment.glsl=rb(this.queryVendorInfo(),"frag",t.fragment.glsl)),new UH({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createProgramSimple=function(t){return new UH({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createTextureShared=function(t,r,n){var i={width:t.width,height:t.height,depthOrArrayLayers:t.depthOrArrayLayers},a=t.mipLevelCount,o=j4(t.format),s=Ozt(t.dimension),l=Lzt(t.usage);if(r.gpuTextureformat=o,r.dimension=t.dimension,r.format=t.format,r.width=t.width,r.height=t.height,r.depthOrArrayLayers=t.depthOrArrayLayers,r.mipLevelCount=a,r.usage=l,r.sampleCount=t.sampleCount,!n){var u=this.device.createTexture({size:i,mipLevelCount:a,format:o,dimension:s,sampleCount:t.sampleCount,usage:l}),c=u.createView();r.gpuTexture=u,r.gpuTextureView=c}},e.prototype.getFallbackSampler=function(t){var r=t.formatKind;return r===$o.Depth&&t.comparison?this.fallbackSamplerComparison:this.fallbackSamplerFiltering},e.prototype.getFallbackTexture=function(t){var r=t.dimension,n=t.formatKind;if(r===Pi.TEXTURE_2D)return n===$o.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(r===Pi.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(r===Pi.TEXTURE_3D)return this.fallbackTexture3D;if(r===Pi.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.createFallbackTexture=function(t,r){var n=t===Pi.TEXTURE_CUBE_MAP?6:1,i=r===$o.Float?ee.U8_RGBA_NORM:ee.D24;return this.createTexture({dimension:t,format:i,usage:ku.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1})},e.prototype.createBindings=function(t){return new tUt({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createInputLayout=function(t){return new nUt({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createComputePipeline=function(t){return new rUt({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderPipeline=function(t){return new oUt({id:this.getNextUniqueId(),device:this,descriptor:$({},t)})},e.prototype.createQueryPool=function(t,r){return new iUt({id:this.getNextUniqueId(),device:this,descriptor:{type:t,elemCount:r}})},e.prototype.createRenderPipelineInternal=function(t,r){var n;if(t.gpuRenderPipeline===null){var i=t.descriptor,a=i.program,o=a.vertexStage,s=a.fragmentStage;if(!(o===null||s===null)){var l=i.megaStateDescriptor||{},u=l.stencilBack,c=l.stencilFront,f=fi(l,["stencilBack","stencilFront"]),d=tb(eb);i.megaStateDescriptor=$($($({},d),{stencilBack:$($({},d.stencilBack),u),stencilFront:$($({},d.stencilFront),c)}),f);var v=i.megaStateDescriptor.attachmentsState[0];i.colorAttachmentFormats.forEach(function(I,P){i.megaStateDescriptor.attachmentsState[P]||(i.megaStateDescriptor.attachmentsState[P]=Rtt(void 0,v))});var g=Hzt((n=i.topology)!==null&&n!==void 0?n:Ls.TRIANGLES,i.megaStateDescriptor),x=Xzt(i.colorAttachmentFormats,i.megaStateDescriptor),w=jzt(i.depthStencilAttachmentFormat,i.megaStateDescriptor),S=void 0;i.inputLayout!==null&&(S=i.inputLayout.buffers);var M=i.sampleCount,R={layout:"auto",vertex:$($({},o),{buffers:S}),primitive:g,depthStencil:w,multisample:{count:M},fragment:$($({},s),{targets:x})};t.gpuRenderPipeline=this.device.createRenderPipeline(R)}}},e.prototype.createReadback=function(){return new aUt({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderBundle=function(){return new lUt({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderPass=function(t){var r=this.renderPassPool.pop();r===void 0&&(r=new $H(this));var n=this.frameCommandEncoderPool.pop();return n===void 0&&(n=this.device.createCommandEncoder()),r.beginRenderPass(n,t),r},e.prototype.createComputePass=function(){var t=this.computePassPool.pop();t===void 0&&(t=new zH);var r=this.frameCommandEncoderPool.pop();return r===void 0&&(r=this.device.createCommandEncoder()),t.beginComputePass(r),t},e.prototype.submitPass=function(t){var r=t;r instanceof $H?(this.frameCommandEncoderPool.push(r.frameCommandEncoder),r.finish(),this.renderPassPool.push(r)):r instanceof zH&&(this.frameCommandEncoderPool.push(r.frameCommandEncoder),r.finish(),this.computePassPool.push(r))},e.prototype.copySubTexture2D=function(t,r,n,i,a,o,s){var l=this.device.createCommandEncoder(),u=t,c=i,f={texture:c.gpuTexture,origin:[a,o,0],mipLevel:0,aspect:"all"},d={texture:u.gpuTexture,origin:[r,n,0],mipLevel:0,aspect:"all"};ni(!!(c.usage&tl.COPY_SRC)),ni(!!(u.usage&tl.COPY_DST)),l.copyTextureToTexture(f,d,[c.width,c.height,s||1]),this.device.queue.submit([l.finish()])},e.prototype.queryLimits=function(){return{uniformBufferMaxPageWordSize:this.device.limits.maxUniformBufferBindingSize>>>2,uniformBufferWordAlignment:this.device.limits.minUniformBufferOffsetAlignment>>>2,supportedSampleCounts:[1],occlusionQueriesRecommended:!0,computeShadersSupported:!0}},e.prototype.queryTextureFormatSupported=function(t,r,n){if(Kzt(t)){if(!this.featureTextureCompressionBC)return!1;var i=Qzt(t);return r%i!==0||n%i!==0?!1:this.featureTextureCompressionBC}switch(t){case ee.U16_RGBA_NORM:return!1;case ee.F32_RGBA:return!1}return!0},e.prototype.queryPlatformAvailable=function(){return!0},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(t){var r=t;return r.descriptor},e.prototype.queryRenderTarget=function(t){var r=t;return r},e.prototype.setResourceName=function(t,r){if(t.name=r,t.type===ta.Buffer){var n=t;n.gpuBuffer.label=r}else if(t.type===ta.Texture){var n=t;n.gpuTexture.label=r,n.gpuTextureView.label=r}else if(t.type===ta.RenderTarget){var n=t;n.gpuTexture.label=r,n.gpuTextureView.label=r}else if(t.type===ta.Sampler){var n=t;n.gpuSampler.label=r}else if(t.type===ta.RenderPipeline){var n=t;n.gpuRenderPipeline!==null&&(n.gpuRenderPipeline.label=r)}},e.prototype.setResourceLeakCheck=function(t,r){},e.prototype.checkForLeaks=function(){},e.prototype.programPatched=function(t){},e.prototype.pipelineQueryReady=function(t){var r=t;return r.gpuRenderPipeline!==null},e.prototype.pipelineForceReady=function(t){var r=t;this.createRenderPipelineInternal(r,!1)},e}(),cUt=function(){function e(t){this.pluginOptions=t}return e.prototype.createSwapChain=function(t){return lu(this,void 0,void 0,function(){var r,n,i,a,o,s,l,u;return $h(this,function(c){switch(c.label){case 0:if(globalThis.navigator.gpu===void 0)return[2,null];r=null,c.label=1;case 1:return c.trys.push([1,3,,4]),n=this.pluginOptions.xrCompatible,[4,globalThis.navigator.gpu.requestAdapter({xrCompatible:n})];case 2:return r=c.sent(),[3,4];case 3:return i=c.sent(),console.log(i),[3,4];case 4:return r===null?[2,null]:(a=["depth32float-stencil8","texture-compression-bc","float32-filterable"],o=a.filter(function(f){return r.features.has(f)}),[4,r.requestDevice({requiredFeatures:o})]);case 5:if(s=c.sent(),s&&(l=this.pluginOptions.onContextLost,s.lost.then(function(){l&&l()})),s===null)return[2,null];if(u=t.getContext("webgpu"),!u)return[2,null];c.label=6;case 6:return c.trys.push([6,8,,9]),[4,Btt(this.pluginOptions.shaderCompilerPath)];case 7:return c.sent(),[3,9];case 8:return c.sent(),[3,9];case 9:return[2,new uUt(r,s,t,u,Azt,NC&&new NC)]}})})},e}(),hUt=class{constructor(e,t){const{buffer:r,offset:n,stride:i,normalized:a,size:o,divisor:s,shaderLocation:l}=t;this.buffer=r,this.attribute={shaderLocation:l,buffer:r.get(),offset:n||0,stride:i||0,normalized:a||!1,divisor:s||0},o&&(this.attribute.size=o)}get(){return this.buffer}updateBuffer(e){this.buffer.subData(e)}destroy(){this.buffer.destroy()}},bR={[K.FLOAT]:Float32Array,[K.UNSIGNED_BYTE]:Uint8Array,[K.SHORT]:Int16Array,[K.UNSIGNED_SHORT]:Uint16Array,[K.INT]:Int32Array,[K.UNSIGNED_INT]:Uint32Array},fUt={[K.POINTS]:Ls.POINTS,[K.LINES]:Ls.LINES,[K.LINE_LOOP]:Ls.LINES,[K.LINE_STRIP]:Ls.LINE_STRIP,[K.TRIANGLES]:Ls.TRIANGLES,[K.TRIANGLE_FAN]:Ls.TRIANGLES,[K.TRIANGLE_STRIP]:Ls.TRIANGLE_STRIP},dUt={1:ee.F32_R,2:ee.F32_RG,3:ee.F32_RGB,4:ee.F32_RGBA},pUt={[K.STATIC_DRAW]:$d.STATIC,[K.DYNAMIC_DRAW]:$d.DYNAMIC,[K.STREAM_DRAW]:$d.DYNAMIC},HH={[K.REPEAT]:sc.REPEAT,[K.CLAMP_TO_EDGE]:sc.CLAMP_TO_EDGE,[K.MIRRORED_REPEAT]:sc.MIRRORED_REPEAT},vUt={[K.NEVER]:ga.NEVER,[K.ALWAYS]:ga.ALWAYS,[K.LESS]:ga.LESS,[K.LEQUAL]:ga.LEQUAL,[K.GREATER]:ga.GREATER,[K.GEQUAL]:ga.GEQUAL,[K.EQUAL]:ga.EQUAL,[K.NOTEQUAL]:ga.NOTEQUAL},gUt={[K.FRONT]:Wc.FRONT,[K.BACK]:Wc.BACK},VH={[K.FUNC_ADD]:_l.ADD,[K.MIN_EXT]:_l.MIN,[K.MAX_EXT]:_l.MAX,[K.FUNC_SUBTRACT]:_l.SUBSTRACT,[K.FUNC_REVERSE_SUBTRACT]:_l.REVERSE_SUBSTRACT},YT={[K.ZERO]:Oi.ZERO,[K.ONE]:Oi.ONE,[K.SRC_COLOR]:Oi.SRC,[K.ONE_MINUS_SRC_COLOR]:Oi.ONE_MINUS_SRC,[K.SRC_ALPHA]:Oi.SRC_ALPHA,[K.ONE_MINUS_SRC_ALPHA]:Oi.ONE_MINUS_SRC_ALPHA,[K.DST_COLOR]:Oi.DST,[K.ONE_MINUS_DST_COLOR]:Oi.ONE_MINUS_DST,[K.DST_ALPHA]:Oi.DST_ALPHA,[K.ONE_MINUS_DST_ALPHA]:Oi.ONE_MINUS_DST_ALPHA,[K.CONSTANT_COLOR]:Oi.CONST,[K.ONE_MINUS_CONSTANT_COLOR]:Oi.ONE_MINUS_CONSTANT,[K.CONSTANT_ALPHA]:Oi.CONST,[K.ONE_MINUS_CONSTANT_ALPHA]:Oi.ONE_MINUS_CONSTANT,[K.SRC_ALPHA_SATURATE]:Oi.SRC_ALPHA_SATURATE},$1={[K.REPLACE]:Ho.REPLACE,[K.KEEP]:Ho.KEEP,[K.ZERO]:Ho.ZERO,[K.INVERT]:Ho.INVERT,[K.INCR]:Ho.INCREMENT_CLAMP,[K.DECR]:Ho.DECREMENT_CLAMP,[K.INCR_WRAP]:Ho.INCREMENT_WRAP,[K.DECR_WRAP]:Ho.DECREMENT_WRAP},mUt={[K.ALWAYS]:ga.ALWAYS,[K.EQUAL]:ga.EQUAL,[K.GEQUAL]:ga.GEQUAL,[K.GREATER]:ga.GREATER,[K.LEQUAL]:ga.LEQUAL,[K.LESS]:ga.LESS,[K.NEVER]:ga.NEVER,[K.NOTEQUAL]:ga.NOTEQUAL},yUt={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function ER(e){return Object.prototype.toString.call(e)in yUt}function _Ut(e,t){const r=e.length,n=Math.ceil(r/3),i=r+n,a=new Float32Array(i);for(let o=0;o<i;o+=4)a[o]=e[o/4*3],a[o+1]=e[o/4*3+1],a[o+2]=e[o/4*3+2],a[o+3]=t;return a}var xUt=class{constructor(e,t){this.isDestroyed=!1;const{data:r,usage:n,type:i,isUBO:a,label:o}=t;let s;ER(r)?s=r:s=new bR[this.type||K.FLOAT](r),this.type=i,this.size=s.byteLength,this.buffer=e.createBuffer({viewOrSize:s,usage:a?ka.UNIFORM:ka.VERTEX,hint:pUt[n||K.STATIC_DRAW]}),o&&e.setResourceName(this.buffer,o)}get(){return this.buffer}destroy(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}subData({data:e,offset:t}){let r;ER(e)?r=e:r=new bR[this.type||K.FLOAT](e),this.buffer.setSubData(t,new Uint8Array(r.buffer))}};function ba(e,t=0){return e+=t,e+=e<<10,e+=e>>>6,e>>>0}function ktt(e){return e+=e<<3,e^=e>>>11,e+=e<<15,e>>>0}function GH(){return 0}var bUt=class{constructor(){this.keys=[],this.values=[]}},ZT=class{constructor(e,t){this.keyEqualFunc=e,this.keyHashFunc=t,this.buckets=new Map}findBucketIndex(e,t){for(let r=0;r<e.keys.length;r++)if(this.keyEqualFunc(t,e.keys[r]))return r;return-1}findBucket(e){const t=this.keyHashFunc(e);return this.buckets.get(t)}get(e){const t=this.findBucket(e);if(t===void 0)return null;const r=this.findBucketIndex(t,e);return r<0?null:t.values[r]}add(e,t){const r=this.keyHashFunc(e);this.buckets.get(r)===void 0&&this.buckets.set(r,new bUt);const n=this.buckets.get(r);n.keys.push(e),n.values.push(t)}delete(e){const t=this.findBucket(e);if(t===void 0)return;const r=this.findBucketIndex(t,e);r!==-1&&(t.keys.splice(r,1),t.values.splice(r,1))}clear(){this.buckets.clear()}size(){let e=0;for(const t of this.buckets.values())e+=t.values.length;return e}*values(){for(const e of this.buckets.values())for(let t=e.values.length-1;t>=0;t--)yield e.values[t]}};function WH(e,t){return e=ba(e,t.blendMode),e=ba(e,t.blendSrcFactor),e=ba(e,t.blendDstFactor),e}function EUt(e,t){return e=WH(e,t.rgbBlendState),e=WH(e,t.alphaBlendState),e=ba(e,t.channelWriteMask),e}function wUt(e,t){return e=ba(e,t.r<<24|t.g<<16|t.b<<8|t.a),e}function CUt(e,t){var r,n,i,a,o,s,l,u;for(let c=0;c<t.attachmentsState.length;c++)e=EUt(e,t.attachmentsState[c]);return e=wUt(e,t.blendConstant||JI),e=ba(e,t.depthCompare),e=ba(e,t.depthWrite?1:0),e=ba(e,(r=t.stencilFront)==null?void 0:r.compare),e=ba(e,(n=t.stencilFront)==null?void 0:n.passOp),e=ba(e,(i=t.stencilFront)==null?void 0:i.failOp),e=ba(e,(a=t.stencilFront)==null?void 0:a.depthFailOp),e=ba(e,(o=t.stencilBack)==null?void 0:o.compare),e=ba(e,(s=t.stencilBack)==null?void 0:s.passOp),e=ba(e,(l=t.stencilBack)==null?void 0:l.failOp),e=ba(e,(u=t.stencilBack)==null?void 0:u.depthFailOp),e=ba(e,t.stencilWrite?1:0),e=ba(e,t.cullMode),e=ba(e,t.frontFace?1:0),e=ba(e,t.polygonOffset?1:0),e}function SUt(e){let t=0;t=ba(t,e.program.id),e.inputLayout!==null&&(t=ba(t,e.inputLayout.id)),t=CUt(t,e.megaStateDescriptor);for(let r=0;r<e.colorAttachmentFormats.length;r++)t=ba(t,e.colorAttachmentFormats[r]||0);return t=ba(t,e.depthStencilAttachmentFormat||0),ktt(t)}function TUt(e){let t=0;if(e.samplerBindings)for(let r=0;r<e.samplerBindings.length;r++){const n=e.samplerBindings[r];n!==null&&n.texture!==null&&(t=ba(t,n.texture.id))}if(e.uniformBufferBindings)for(let r=0;r<e.uniformBufferBindings.length;r++){const n=e.uniformBufferBindings[r];n!==null&&n.buffer!==null&&(t=ba(t,n.buffer.id),t=ba(t,n.binding),t=ba(t,n.offset),t=ba(t,n.size))}if(e.storageBufferBindings)for(let r=0;r<e.storageBufferBindings.length;r++){const n=e.storageBufferBindings[r];n!==null&&n.buffer!==null&&(t=ba(t,n.buffer.id),t=ba(t,n.binding),t=ba(t,n.offset),t=ba(t,n.size))}if(e.storageTextureBindings)for(let r=0;r<e.storageTextureBindings.length;r++){const n=e.storageTextureBindings[r];n!==null&&n.texture!==null&&(t=ba(t,n.texture.id),t=ba(t,n.binding))}return ktt(t)}function AUt(e,t){var r,n,i,a;return((r=e.vertex)==null?void 0:r.glsl)===((n=t.vertex)==null?void 0:n.glsl)&&((i=e.fragment)==null?void 0:i.glsl)===((a=t.fragment)==null?void 0:a.glsl)}function MUt(e){var t,r;return{vertex:{glsl:(t=e.vertex)==null?void 0:t.glsl},fragment:{glsl:(r=e.fragment)==null?void 0:r.glsl}}}var RUt=class{constructor(e){this.device=e,this.bindingsCache=new ZT(M7t,TUt),this.renderPipelinesCache=new ZT(O7t,SUt),this.inputLayoutsCache=new ZT(F7t,GH),this.programCache=new ZT(AUt,GH)}createBindings(e){var t;let r=this.bindingsCache.get(e);if(r===null){const n=k7t(e);n.uniformBufferBindings=(t=n.uniformBufferBindings)==null?void 0:t.filter(({size:i})=>i&&i>0),r=this.device.createBindings(n),this.bindingsCache.add(n,r)}return r}createRenderPipeline(e){let t=this.renderPipelinesCache.get(e);if(t===null){const r=z7t(e);r.colorAttachmentFormats=r.colorAttachmentFormats.filter(n=>n),t=this.device.createRenderPipeline(r),this.renderPipelinesCache.add(r,t)}return t}createInputLayout(e){e.vertexBufferDescriptors=e.vertexBufferDescriptors.filter(r=>!!r);let t=this.inputLayoutsCache.get(e);if(t===null){const r=H7t(e);t=this.device.createInputLayout(r),this.inputLayoutsCache.add(r,t)}return t}createProgram(e){let t=this.programCache.get(e);if(t===null){const r=MUt(e);t=this.device.createProgram(e),this.programCache.add(r,t)}return t}destroy(){for(const e of this.bindingsCache.values())e.destroy();for(const e of this.renderPipelinesCache.values())e.destroy();for(const e of this.inputLayoutsCache.values())e.destroy();for(const e of this.programCache.values())e.destroy();this.bindingsCache.clear(),this.renderPipelinesCache.clear(),this.inputLayoutsCache.clear(),this.programCache.clear()}},IUt=class{constructor(e,t){const{data:r,type:n,count:i=0}=t;let a;ER(r)?a=r:a=new bR[this.type||K.UNSIGNED_INT](r),this.type=n,this.count=i,this.indexBuffer=e.createBuffer({viewOrSize:a,usage:ka.INDEX})}get(){return this.indexBuffer}subData({data:e}){let t;ER(e)?t=e:t=new bR[this.type||K.UNSIGNED_INT](e),this.indexBuffer.setSubData(0,new Uint8Array(t.buffer))}destroy(){this.indexBuffer.destroy()}};function XH(e){return!!(e&&e.texture)}var ztt=class{constructor(e,t){this.device=e,this.options=t,this.isDestroy=!1;const{wrapS:r=K.CLAMP_TO_EDGE,wrapT:n=K.CLAMP_TO_EDGE,aniso:i,mag:a=K.NEAREST,min:o=K.NEAREST}=t;this.createTexture(t),this.sampler=e.createSampler({addressModeU:HH[r],addressModeV:HH[n],minFilter:o===K.NEAREST?es.POINT:es.BILINEAR,magFilter:a===K.NEAREST?es.POINT:es.BILINEAR,mipmapFilter:rl.NO_MIP,maxAnisotropy:i})}createTexture(e){const{type:t=K.UNSIGNED_BYTE,width:r,height:n,flipY:i=!1,format:a=K.RGBA,alignment:o=1,usage:s=r_.SAMPLED,unorm:l=!1,label:u}=e;let{data:c}=e;this.width=r,this.height=n;let f=ee.U8_RGBA_RT;if(t===K.UNSIGNED_BYTE&&a===K.RGBA)f=l?ee.U8_RGBA_NORM:ee.U8_RGBA_RT;else if(t===K.UNSIGNED_BYTE&&a===K.LUMINANCE)f=ee.U8_LUMINANCE;else if(t===K.FLOAT&&a===K.LUMINANCE)f=ee.F32_LUMINANCE;else if(t===K.FLOAT&&a===K.RGB)this.device.queryVendorInfo().platformString==="WebGPU"?(c&&(c=_Ut(c,0)),f=ee.F32_RGBA):f=ee.F32_RGB;else if(t===K.FLOAT&&a===K.RGBA)f=ee.F32_RGBA;else if(t===K.FLOAT&&a===K.RED)f=ee.F32_R;else throw new Error(`create texture error, type: ${t}, format: ${a}`);this.texture=this.device.createTexture({format:f,width:r,height:n,usage:s===r_.SAMPLED?ku.SAMPLED:ku.RENDER_TARGET,pixelStore:{unpackFlipY:i,packAlignment:o},mipLevelCount:1}),u&&this.device.setResourceName(this.texture,u),c&&this.texture.setImageData([c])}get(){return this.texture}update(e){const{data:t}=e;this.texture.setImageData([t])}bind(){}resize({width:e,height:t}){(this.width!==e||this.height!==t)&&this.destroy(),this.options.width=e,this.options.height=t,this.createTexture(this.options),this.isDestroy=!1}getSize(){return[this.width,this.height]}destroy(){var e;!this.isDestroy&&!this.texture.destroyed&&((e=this.texture)==null||e.destroy()),this.isDestroy=!0}},Utt=class{constructor(e,t){this.device=e,this.options=t,this.createColorRenderTarget(),this.createDepthRenderTarget()}createColorRenderTarget(e=!1){const{width:t,height:r,color:n}=this.options;n&&(XH(n)?(e&&n.resize({width:t,height:r}),this.colorTexture=n.get(),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=n.width,this.height=n.height):t&&r&&(this.colorTexture=this.device.createTexture({format:ee.U8_RGBA_RT,usage:ku.RENDER_TARGET,width:t,height:r}),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=t,this.height=r))}createDepthRenderTarget(e=!1){const{width:t,height:r,depth:n}=this.options;n&&(XH(n)?(e&&n.resize({width:t,height:r}),this.depthTexture=n.get(),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=n.width,this.height=n.height):t&&r&&(this.depthTexture=this.device.createTexture({format:ee.D24_S8,usage:ku.RENDER_TARGET,width:t,height:r}),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=t,this.height=r))}get(){return this.colorRenderTarget}destroy(){var e,t;(e=this.colorRenderTarget)==null||e.destroy(),(t=this.depthRenderTarget)==null||t.destroy()}resize({width:e,height:t}){(this.width!==e||this.height!==t)&&(this.destroy(),this.colorTexture.destroyed=!0,this.depthTexture.destroyed=!0,this.options.width=e,this.options.height=t,this.createColorRenderTarget(!0),this.createDepthRenderTarget(!0))}},LUt=Object.defineProperty,OUt=Object.defineProperties,PUt=Object.getOwnPropertyDescriptors,jH=Object.getOwnPropertySymbols,DUt=Object.prototype.hasOwnProperty,FUt=Object.prototype.propertyIsEnumerable,YH=(e,t,r)=>t in e?LUt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,dy=(e,t)=>{for(var r in t||(t={}))DUt.call(t,r)&&YH(e,r,t[r]);if(jH)for(var r of jH(t))FUt.call(t,r)&&YH(e,r,t[r]);return e},BUt=(e,t)=>OUt(e,PUt(t)),{isPlainObject:NUt,isTypedArray:kUt,isNil:ZH}=as,zUt=class{constructor(e,t,r){this.device=e,this.options=t,this.service=r,this.destroyed=!1,this.uniforms={},this.vertexBuffers=[];const{vs:n,fs:i,attributes:a,uniforms:o,count:s,elements:l,diagnosticDerivativeUniformityEnabled:u}=t;this.options=t;const c=u?"":this.service.viewportOrigin===kd.UPPER_LEFT?"diagnostic(off,derivative_uniformity);":"";this.program=r.renderCache.createProgram({vertex:{glsl:n},fragment:{glsl:i,postprocess:g=>c+g}}),o&&(this.uniforms=this.extractUniforms(o));const f=[];let d=0;Object.keys(a).forEach(g=>{const x=a[g],w=x.get();this.vertexBuffers.push(w.get());const{offset:S=0,stride:M=0,size:R=1,divisor:I=0,shaderLocation:P=0}=x.attribute;f.push({arrayStride:M||R*4,stepMode:s_.VERTEX,attributes:[{format:dUt[R],shaderLocation:P,offset:S,divisor:I}]}),d=w.size/R}),s||(this.options.count=d),l&&(this.indexBuffer=l.get());const v=r.renderCache.createInputLayout({vertexBufferDescriptors:f,indexBufferFormat:l?ee.U32_R:null,program:this.program});this.inputLayout=v,this.pipeline=this.createPipeline(t)}createPipeline(e,t){var r;const{primitive:n=K.TRIANGLES,depth:i,cull:a,blend:o,stencil:s}=e,l=this.initDepthDrawParams({depth:i}),u=!!(l&&l.enable),c=this.initCullDrawParams({cull:a}),f=!!(c&&c.enable),d=this.getBlendDrawParams({blend:o}),v=!!(d&&d.enable),g=this.getStencilDrawParams({stencil:s}),x=!!(g&&g.enable),w=this.device.createRenderPipeline({inputLayout:this.inputLayout,program:this.program,topology:fUt[n],colorAttachmentFormats:[ee.U8_RGBA_RT],depthStencilAttachmentFormat:ee.D24_S8,megaStateDescriptor:{attachmentsState:[t?{channelWriteMask:vl.ALL,rgbBlendState:{blendMode:_l.ADD,blendSrcFactor:Oi.ONE,blendDstFactor:Oi.ZERO},alphaBlendState:{blendMode:_l.ADD,blendSrcFactor:Oi.ONE,blendDstFactor:Oi.ZERO}}:{channelWriteMask:x&&g.opFront.zpass===Ho.REPLACE?vl.NONE:vl.ALL,rgbBlendState:{blendMode:v&&d.equation.rgb||_l.ADD,blendSrcFactor:v&&d.func.srcRGB||Oi.SRC_ALPHA,blendDstFactor:v&&d.func.dstRGB||Oi.ONE_MINUS_SRC_ALPHA},alphaBlendState:{blendMode:v&&d.equation.alpha||_l.ADD,blendSrcFactor:v&&d.func.srcAlpha||Oi.ONE,blendDstFactor:v&&d.func.dstAlpha||Oi.ONE}}],blendConstant:v?JI:void 0,depthWrite:u,depthCompare:u&&l.func||ga.LESS,cullMode:f&&c.face||Wc.NONE,stencilWrite:x,stencilFront:{compare:x?g.func.cmp:ga.ALWAYS,passOp:g.opFront.zpass,failOp:g.opFront.fail,depthFailOp:g.opFront.zfail,mask:g.opFront.mask},stencilBack:{compare:x?g.func.cmp:ga.ALWAYS,passOp:g.opBack.zpass,failOp:g.opBack.fail,depthFailOp:g.opBack.zfail,mask:g.opBack.mask}}});return x&&!ZH((r=s==null?void 0:s.func)==null?void 0:r.ref)&&(w.stencilFuncReference=s.func.ref),w}updateAttributesAndElements(){}updateAttributes(){}addUniforms(e){this.uniforms=dy(dy({},this.uniforms),this.extractUniforms(e))}draw(e,t){const r=dy(dy({},this.options),e),{count:n=0,instances:i,elements:a,uniforms:o={},uniformBuffers:s,textures:l}=r;this.uniforms=dy(dy({},this.uniforms),this.extractUniforms(o));const{renderPass:u,currentFramebuffer:c,width:f,height:d}=this.service;this.pipeline=this.createPipeline(r,t);const v=this.service.device,g=v.swapChainHeight;if(v.swapChainHeight=(c==null?void 0:c.height)||d,u.setViewport(0,0,(c==null?void 0:c.width)||f,(c==null?void 0:c.height)||d),v.swapChainHeight=g,u.setPipeline(this.pipeline),ZH(this.pipeline.stencilFuncReference)||u.setStencilReference(this.pipeline.stencilFuncReference),u.setVertexInput(this.inputLayout,this.vertexBuffers.map(x=>({buffer:x})),a?{buffer:this.indexBuffer,offset:0}:null),s&&(this.bindings=v.createBindings({pipeline:this.pipeline,uniformBufferBindings:s.map((x,w)=>{const S=x;return{binding:w,buffer:S.get(),size:S.size}}),samplerBindings:l==null?void 0:l.map(x=>({texture:x.texture,sampler:x.sampler}))})),this.bindings&&(u.setBindings(this.bindings),Object.keys(this.uniforms).forEach(x=>{const w=this.uniforms[x];w instanceof ztt?this.uniforms[x]=w.get():w instanceof Utt&&(this.uniforms[x]=w.get().texture)}),this.program.setUniformsLegacy(this.uniforms)),a){const x=a.count;x===0?u.draw(n,i):u.drawIndexed(x,i)}else u.draw(n,i)}destroy(){var e,t,r;(e=this.vertexBuffers)==null||e.forEach(n=>n.destroy()),(t=this.indexBuffer)==null||t.destroy(),(r=this.bindings)==null||r.destroy(),this.pipeline.destroy(),this.destroyed=!0}initDepthDrawParams({depth:e}){if(e)return{enable:e.enable===void 0?!0:!!e.enable,mask:e.mask===void 0?!0:!!e.mask,func:vUt[e.func||K.LESS],range:e.range||[0,1]}}getBlendDrawParams({blend:e}){const{enable:t,func:r,equation:n,color:i=[0,0,0,0]}=e||{};return{enable:!!t,func:{srcRGB:YT[r&&r.srcRGB||K.SRC_ALPHA],srcAlpha:YT[r&&r.srcAlpha||K.SRC_ALPHA],dstRGB:YT[r&&r.dstRGB||K.ONE_MINUS_SRC_ALPHA],dstAlpha:YT[r&&r.dstAlpha||K.ONE_MINUS_SRC_ALPHA]},equation:{rgb:VH[n&&n.rgb||K.FUNC_ADD],alpha:VH[n&&n.alpha||K.FUNC_ADD]},color:i}}getStencilDrawParams({stencil:e}){const{enable:t,mask:r=4294967295,func:n={cmp:K.ALWAYS,ref:0,mask:4294967295},opFront:i={fail:K.KEEP,zfail:K.KEEP,zpass:K.KEEP},opBack:a={fail:K.KEEP,zfail:K.KEEP,zpass:K.KEEP}}=e||{};return{enable:!!t,mask:r,func:BUt(dy({},n),{cmp:mUt[n.cmp]}),opFront:{fail:$1[i.fail],zfail:$1[i.zfail],zpass:$1[i.zpass],mask:n.mask},opBack:{fail:$1[a.fail],zfail:$1[a.zfail],zpass:$1[a.zpass],mask:n.mask}}}initCullDrawParams({cull:e}){if(e){const{enable:t,face:r=K.BACK}=e;return{enable:!!t,face:gUt[r]}}}extractUniforms(e){const t={};return Object.keys(e).forEach(r=>{this.extractUniformsRecursively(r,e[r],t,"")}),t}extractUniformsRecursively(e,t,r,n){if(t===null||typeof t=="number"||typeof t=="boolean"||Array.isArray(t)&&typeof t[0]=="number"||kUt(t)||t===""||"resize"in t){r[`${n&&n+"."}${e}`]=t;return}NUt(t)&&Object.keys(t).forEach(i=>{this.extractUniformsRecursively(i,t[i],r,`${n&&n+"."}${e}`)}),Array.isArray(t)&&t.forEach((i,a)=>{Object.keys(i).forEach(o=>{this.extractUniformsRecursively(o,i[o],r,`${n&&n+"."}${e}[${a}]`)})})}};function UUt(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:!!(e&&e._version===2)}var ZO=(e,t,r)=>new Promise((n,i)=>{var a=l=>{try{s(r.next(l))}catch(u){i(u)}},o=l=>{try{s(r.throw(l))}catch(u){i(u)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(a,o);s((r=r.apply(e,t)).next())}),{isUndefined:qT}=as,$Ut=class{constructor(){this.uniformBuffers=[],this.queryVerdorInfo=()=>this.device.queryVendorInfo().platformString,this.createModel=e=>new zUt(this.device,e,this),this.createAttribute=e=>new hUt(this.device,e),this.createBuffer=e=>new xUt(this.device,e),this.createElements=e=>new IUt(this.device,e),this.createTexture2D=e=>new ztt(this.device,e),this.createFramebuffer=e=>new Utt(this.device,e),this.useFramebuffer=(e,t)=>{this.currentFramebuffer=e,this.beginFrame(),t(),this.endFrame(),this.currentFramebuffer=null},this.useFramebufferAsync=(e,t)=>ZO(this,null,function*(){this.currentFramebuffer=e,this.preRenderPass=this.renderPass,this.beginFrame(),yield t(),this.endFrame(),this.currentFramebuffer=null,this.renderPass=this.preRenderPass}),this.clear=e=>{const{color:t,depth:r,stencil:n,framebuffer:i=null}=e;if(i)i.clearOptions={color:t,depth:r,stencil:n};else{const a=this.queryVerdorInfo();if(a==="WebGL1"){const o=this.getGLContext();qT(n)?qT(r)||(o.clearDepth(r),o.clear(o.DEPTH_BUFFER_BIT)):(o.clearStencil(n),o.clear(o.STENCIL_BUFFER_BIT))}else if(a==="WebGL2"){const o=this.getGLContext();qT(n)?qT(r)||o.clearBufferfv(o.DEPTH,0,[r]):o.clearBufferiv(o.STENCIL,0,[n])}}},this.viewport=({width:e,height:t})=>{this.swapChain.configureSwapChain(e,t),this.createMainColorDepthRT(e,t),this.width=e,this.height=t},this.readPixels=e=>{const{framebuffer:t,x:r,y:n,width:i,height:a}=e,o=this.device.createReadback(),s=t.colorTexture,l=o.readTextureSync(s,r,this.viewportOrigin===kd.LOWER_LEFT?n:this.height-n,i,a,new Uint8Array(i*a*4));if(this.viewportOrigin!==kd.LOWER_LEFT)for(let u=0;u<l.length;u+=4){const c=l[u];l[u]=l[u+2],l[u+2]=c}return o.destroy(),l},this.readPixelsAsync=e=>ZO(this,null,function*(){const{framebuffer:t,x:r,y:n,width:i,height:a}=e,o=this.device.createReadback(),s=t.colorTexture,l=yield o.readTexture(s,r,this.viewportOrigin===kd.LOWER_LEFT?n:this.height-n,i,a,new Uint8Array(i*a*4));if(this.viewportOrigin!==kd.LOWER_LEFT)for(let u=0;u<l.length;u+=4){const c=l[u];l[u]=l[u+2],l[u+2]=c}return o.destroy(),l}),this.getViewportSize=()=>({width:this.width,height:this.height}),this.getContainer=()=>{var e;return(e=this.canvas)==null?void 0:e.parentElement},this.getCanvas=()=>this.canvas,this.getGLContext=()=>this.device.gl,this.destroy=()=>{var e;this.canvas=null,(e=this.uniformBuffers)==null||e.forEach(t=>{t.destroy()}),this.device.destroy(),this.renderCache.destroy()}}init(e,t){return ZO(this,null,function*(){const{enableWebGPU:r,shaderCompilerPath:n,antialias:i}=t;this.canvas=e;const o=yield(r?new cUt({shaderCompilerPath:n}):new Ezt({targets:["webgl2","webgl1"],antialias:i,onContextLost(l){console.warn("context lost",l)},onContextCreationError(l){console.warn("context creation error",l)},onContextRestored(l){console.warn("context restored",l)}})).createSwapChain(e);o.configureSwapChain(e.width,e.height),this.device=o.getDevice(),this.swapChain=o,this.renderCache=new RUt(this.device),this.currentFramebuffer=null,this.viewportOrigin=this.device.queryVendorInfo().viewportOrigin;const s=this.device.gl;this.extensionObject={OES_texture_float:!UUt(s)&&this.device.OES_texture_float},this.createMainColorDepthRT(e.width,e.height)})}createMainColorDepthRT(e,t){this.mainColorRT&&this.mainColorRT.destroy(),this.mainDepthRT&&this.mainDepthRT.destroy(),this.mainColorRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:ee.U8_RGBA_RT,width:e,height:t,usage:ku.RENDER_TARGET})),this.mainDepthRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:ee.D24_S8,width:e,height:t,usage:ku.RENDER_TARGET}))}beginFrame(){this.device.beginFrame();const{currentFramebuffer:e,swapChain:t,mainColorRT:r,mainDepthRT:n}=this,i=e?e.colorRenderTarget:r,a=e?null:t.getOnscreenTexture(),o=e?e.depthRenderTarget:n,{color:s=[0,0,0,0],depth:l=1,stencil:u=0}=(e==null?void 0:e.clearOptions)||{},c=i?WS(s[0]*255,s[1]*255,s[2]*255,s[3]):JI,f=o?l:void 0,d=o?u:void 0,v=this.device.createRenderPass({colorAttachment:[i],colorResolveTo:[a],colorClearColor:[c],colorStore:[!0],depthStencilAttachment:o,depthClearValue:f,stencilClearValue:d});this.renderPass=v}endFrame(){this.device.submitPass(this.renderPass),this.device.endFrame()}getPointSizeRange(){const e=this.device.gl;return e.getParameter(e.ALIASED_POINT_SIZE_RANGE)}testExtension(e){return!!this.getGLContext().getExtension(e)}setState(){}setBaseState(){}setCustomLayerDefaults(){}setDirty(e){this.isDirty=e}getDirty(){return this.isDirty}},$tt={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(Nm,function(){var r=function(j){return j instanceof Uint8Array||j instanceof Uint16Array||j instanceof Uint32Array||j instanceof Int8Array||j instanceof Int16Array||j instanceof Int32Array||j instanceof Float32Array||j instanceof Float64Array||j instanceof Uint8ClampedArray},n=function(j,_t){for(var Bt=Object.keys(_t),ge=0;ge<Bt.length;++ge)j[Bt[ge]]=_t[Bt[ge]];return j},i=`
`;function a(j){return typeof atob<"u"?atob(j):"base64:"+j}function o(j){var _t=new Error("(regl) "+j);throw console.error(_t),_t}function s(j,_t){j||o(_t)}function l(j){return j?": "+j:""}function u(j,_t,Bt){j in _t||o("unknown parameter ("+j+")"+l(Bt)+". possible values: "+Object.keys(_t).join())}function c(j,_t){r(j)||o("invalid parameter type"+l(_t)+". must be a typed array")}function f(j,_t){switch(_t){case"number":return typeof j=="number";case"object":return typeof j=="object";case"string":return typeof j=="string";case"boolean":return typeof j=="boolean";case"function":return typeof j=="function";case"undefined":return typeof j>"u";case"symbol":return typeof j=="symbol"}}function d(j,_t,Bt){f(j,_t)||o("invalid parameter type"+l(Bt)+". expected "+_t+", got "+typeof j)}function v(j,_t){j>=0&&(j|0)===j||o("invalid parameter type, ("+j+")"+l(_t)+". must be a nonnegative integer")}function g(j,_t,Bt){_t.indexOf(j)<0&&o("invalid value"+l(Bt)+". must be one of: "+_t)}var x=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function w(j){Object.keys(j).forEach(function(_t){x.indexOf(_t)<0&&o('invalid regl constructor argument "'+_t+'". must be one of '+x)})}function S(j,_t){for(j=j+"";j.length<_t;)j=" "+j;return j}function M(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function R(j,_t){this.number=j,this.line=_t,this.errors=[]}function I(j,_t,Bt){this.file=j,this.line=_t,this.message=Bt}function P(){var j=new Error,_t=(j.stack||j).toString(),Bt=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(_t);if(Bt)return Bt[1];var ge=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(_t);return ge?ge[1]:"unknown"}function k(){var j=new Error,_t=(j.stack||j).toString(),Bt=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(_t);if(Bt)return Bt[1];var ge=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(_t);return ge?ge[1]:"unknown"}function z(j,_t){var Bt=j.split(`
`),ge=1,Ue=0,_e={unknown:new M,0:new M};_e.unknown.name=_e[0].name=_t||P(),_e.unknown.lines.push(new R(0,""));for(var ce=0;ce<Bt.length;++ce){var ir=Bt[ce],Ke=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(ir);if(Ke)switch(Ke[1]){case"line":var vr=/(\d+)(\s+\d+)?/.exec(Ke[2]);vr&&(ge=vr[1]|0,vr[2]&&(Ue=vr[2]|0,Ue in _e||(_e[Ue]=new M)));break;case"define":var sr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Ke[2]);sr&&(_e[Ue].name=sr[1]?a(sr[2]):sr[2]);break}_e[Ue].lines.push(new R(ge++,ir))}return Object.keys(_e).forEach(function(fr){var yr=_e[fr];yr.lines.forEach(function(Qe){yr.index[Qe.number]=Qe})}),_e}function G(j){var _t=[];return j.split(`
`).forEach(function(Bt){if(!(Bt.length<5)){var ge=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Bt);ge?_t.push(new I(ge[1]|0,ge[2]|0,ge[3].trim())):Bt.length>0&&_t.push(new I("unknown",0,Bt))}}),_t}function J(j,_t){_t.forEach(function(Bt){var ge=j[Bt.file];if(ge){var Ue=ge.index[Bt.line];if(Ue){Ue.errors.push(Bt),ge.hasErrors=!0;return}}j.unknown.hasErrors=!0,j.unknown.lines[0].errors.push(Bt)})}function Z(j,_t,Bt,ge,Ue){if(!j.getShaderParameter(_t,j.COMPILE_STATUS)){var _e=j.getShaderInfoLog(_t),ce=ge===j.FRAGMENT_SHADER?"fragment":"vertex";zt(Bt,"string",ce+" shader source must be a string",Ue);var ir=z(Bt,Ue),Ke=G(_e);J(ir,Ke),Object.keys(ir).forEach(function(vr){var sr=ir[vr];if(!sr.hasErrors)return;var fr=[""],yr=[""];function Qe(dr,ae){fr.push(dr),yr.push(ae||"")}Qe("file number "+vr+": "+sr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),sr.lines.forEach(function(dr){if(dr.errors.length>0){Qe(S(dr.number,4)+"|  ","background-color:yellow; font-weight:bold"),Qe(dr.line+i,"color:red; background-color:yellow; font-weight:bold");var ae=0;dr.errors.forEach(function(Te){var ar=Te.message,Sr=/^\s*'(.*)'\s*:\s*(.*)$/.exec(ar);if(Sr){var Xe=Sr[1];switch(ar=Sr[2],Xe){case"assign":Xe="=";break}ae=Math.max(dr.line.indexOf(Xe,ae),0)}else ae=0;Qe(S("| ",6)),Qe(S("^^^",ae+3)+i,"font-weight:bold"),Qe(S("| ",6)),Qe(ar+i,"font-weight:bold")}),Qe(S("| ",6)+i)}else Qe(S(dr.number,4)+"|  "),Qe(dr.line+i,"color:red")}),typeof document<"u"&&!window.chrome?(yr[0]=fr.join("%c"),console.log.apply(console,yr)):console.log(fr.join(""))}),s.raise("Error compiling "+ce+" shader, "+ir[0].name)}}function X(j,_t,Bt,ge,Ue){if(!j.getProgramParameter(_t,j.LINK_STATUS)){var _e=j.getProgramInfoLog(_t),ce=z(Bt,Ue),ir=z(ge,Ue),Ke='Error linking program with vertex shader, "'+ir[0].name+'", and fragment shader "'+ce[0].name+'"';typeof document<"u"?console.log("%c"+Ke+i+"%c"+_e,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Ke+i+_e),s.raise(Ke)}}function et(j){j._commandRef=P()}function at(j,_t,Bt,ge){et(j);function Ue(Ke){return Ke?ge.id(Ke):0}j._fragId=Ue(j.static.frag),j._vertId=Ue(j.static.vert);function _e(Ke,vr){Object.keys(vr).forEach(function(sr){Ke[ge.id(sr)]=!0})}var ce=j._uniformSet={};_e(ce,_t.static),_e(ce,_t.dynamic);var ir=j._attributeSet={};_e(ir,Bt.static),_e(ir,Bt.dynamic),j._hasCount="count"in j.static||"count"in j.dynamic||"elements"in j.static||"elements"in j.dynamic}function wt(j,_t){var Bt=k();o(j+" in command "+(_t||P())+(Bt==="unknown"?"":" called from "+Bt))}function Tt(j,_t,Bt){j||wt(_t,Bt||P())}function vt(j,_t,Bt,ge){j in _t||wt("unknown parameter ("+j+")"+l(Bt)+". possible values: "+Object.keys(_t).join(),ge||P())}function zt(j,_t,Bt,ge){f(j,_t)||wt("invalid parameter type"+l(Bt)+". expected "+_t+", got "+typeof j,ge||P())}function oe(j){j()}function Qt(j,_t,Bt){j.texture?g(j.texture._texture.internalformat,_t,"unsupported texture format for attachment"):g(j.renderbuffer._renderbuffer.format,Bt,"unsupported renderbuffer format for attachment")}var ne=33071,de=9728,De=9984,Ze=9985,ke=9986,Be=9987,Zr=5120,Wr=5121,In=5122,re=5123,nr=5124,zr=5125,Ne=5126,Vr=32819,xn=32820,Qn=33635,gn=34042,bn=36193,ci={};ci[Zr]=ci[Wr]=1,ci[In]=ci[re]=ci[bn]=ci[Qn]=ci[Vr]=ci[xn]=2,ci[nr]=ci[zr]=ci[Ne]=ci[gn]=4;function Mo(j,_t){return j===xn||j===Vr||j===Qn?2:j===gn?4:ci[j]*_t}function ra(j){return!(j&j-1)&&!!j}function la(j,_t,Bt){var ge,Ue=_t.width,_e=_t.height,ce=_t.channels;s(Ue>0&&Ue<=Bt.maxTextureSize&&_e>0&&_e<=Bt.maxTextureSize,"invalid texture shape"),(j.wrapS!==ne||j.wrapT!==ne)&&s(ra(Ue)&&ra(_e),"incompatible wrap mode for texture, both width and height must be power of 2"),_t.mipmask===1?Ue!==1&&_e!==1&&s(j.minFilter!==De&&j.minFilter!==ke&&j.minFilter!==Ze&&j.minFilter!==Be,"min filter requires mipmap"):(s(ra(Ue)&&ra(_e),"texture must be a square power of 2 to support mipmapping"),s(_t.mipmask===(Ue<<1)-1,"missing or incomplete mipmap data")),_t.type===Ne&&(Bt.extensions.indexOf("oes_texture_float_linear")<0&&s(j.minFilter===de&&j.magFilter===de,"filter not supported, must enable oes_texture_float_linear"),s(!j.genMipmaps,"mipmap generation not supported with float textures"));var ir=_t.images;for(ge=0;ge<16;++ge)if(ir[ge]){var Ke=Ue>>ge,vr=_e>>ge;s(_t.mipmask&1<<ge,"missing mipmap data");var sr=ir[ge];if(s(sr.width===Ke&&sr.height===vr,"invalid shape for mip images"),s(sr.format===_t.format&&sr.internalformat===_t.internalformat&&sr.type===_t.type,"incompatible type for mip image"),!sr.compressed)if(sr.data){var fr=Math.ceil(Mo(sr.type,ce)*Ke/sr.unpackAlignment)*sr.unpackAlignment;s(sr.data.byteLength===fr*vr,"invalid data for image, buffer size is inconsistent with image format")}else sr.element||sr.copy}else j.genMipmaps||s((_t.mipmask&1<<ge)===0,"extra mipmap data");_t.compressed&&s(!j.genMipmaps,"mipmap generation for compressed images not supported")}function os(j,_t,Bt,ge){var Ue=j.width,_e=j.height,ce=j.channels;s(Ue>0&&Ue<=ge.maxTextureSize&&_e>0&&_e<=ge.maxTextureSize,"invalid texture shape"),s(Ue===_e,"cube map must be square"),s(_t.wrapS===ne&&_t.wrapT===ne,"wrap mode not supported by cube map");for(var ir=0;ir<Bt.length;++ir){var Ke=Bt[ir];s(Ke.width===Ue&&Ke.height===_e,"inconsistent cube map face shape"),_t.genMipmaps&&(s(!Ke.compressed,"can not generate mipmap for compressed textures"),s(Ke.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var vr=Ke.images,sr=0;sr<16;++sr){var fr=vr[sr];if(fr){var yr=Ue>>sr,Qe=_e>>sr;s(Ke.mipmask&1<<sr,"missing mipmap data"),s(fr.width===yr&&fr.height===Qe,"invalid shape for mip images"),s(fr.format===j.format&&fr.internalformat===j.internalformat&&fr.type===j.type,"incompatible type for mip image"),fr.compressed||(fr.data?s(fr.data.byteLength===yr*Qe*Math.max(Mo(fr.type,ce),fr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):fr.element||fr.copy)}}}}var Et=n(s,{optional:oe,raise:o,commandRaise:wt,command:Tt,parameter:u,commandParameter:vt,constructor:w,type:d,commandType:zt,isTypedArray:c,nni:v,oneOf:g,shaderError:Z,linkError:X,callSite:k,saveCommandRef:et,saveDrawInfo:at,framebufferFormat:Qt,guessCommand:P,texture2D:la,textureCube:os}),ss=0,_u=0;function ls(j,_t){this.id=ss++,this.type=j,this.data=_t}function Xu(j){return j.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function ma(j){if(j.length===0)return[];var _t=j.charAt(0),Bt=j.charAt(j.length-1);if(j.length>1&&_t===Bt&&(_t==='"'||_t==="'"))return['"'+Xu(j.substr(1,j.length-2))+'"'];var ge=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(j);if(ge)return ma(j.substr(0,ge.index)).concat(ma(ge[1])).concat(ma(j.substr(ge.index+ge[0].length)));var Ue=j.split(".");if(Ue.length===1)return['"'+Xu(j)+'"'];for(var _e=[],ce=0;ce<Ue.length;++ce)_e=_e.concat(ma(Ue[ce]));return _e}function us(j){return"["+ma(j).join("][")+"]"}function ol(j,_t){return new ls(j,us(_t+""))}function cs(j){return typeof j=="function"&&!j._reglType||j instanceof ls}function vc(j,_t){return typeof j=="function"?new ls(_u,j):j}var vo={DynamicVariable:ls,define:ol,isDynamic:cs,unbox:vc,accessor:us},ju={next:typeof requestAnimationFrame=="function"?function(j){return requestAnimationFrame(j)}:function(j){return setTimeout(j,16)},cancel:typeof cancelAnimationFrame=="function"?function(j){return cancelAnimationFrame(j)}:clearTimeout},Ml=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function dh(){var j={"":0},_t=[""];return{id:function(Bt){var ge=j[Bt];return ge||(ge=j[Bt]=_t.length,_t.push(Bt),ge)},str:function(Bt){return _t[Bt]}}}function ud(j,_t,Bt){var ge=document.createElement("canvas");n(ge.style,{border:0,margin:0,padding:0,top:0,left:0}),j.appendChild(ge),j===document.body&&(ge.style.position="absolute",n(j.style,{margin:0,padding:0}));function Ue(){var ir=window.innerWidth,Ke=window.innerHeight;if(j!==document.body){var vr=j.getBoundingClientRect();ir=vr.right-vr.left,Ke=vr.bottom-vr.top}ge.width=Bt*ir,ge.height=Bt*Ke,n(ge.style,{width:ir+"px",height:Ke+"px"})}var _e;j!==document.body&&typeof ResizeObserver=="function"?(_e=new ResizeObserver(function(){setTimeout(Ue)}),_e.observe(j)):window.addEventListener("resize",Ue,!1);function ce(){_e?_e.disconnect():window.removeEventListener("resize",Ue),j.removeChild(ge)}return Ue(),{canvas:ge,onDestroy:ce}}function ph(j,_t){function Bt(ge){try{return j.getContext(ge,_t)}catch{return null}}return Bt("webgl")||Bt("experimental-webgl")||Bt("webgl-experimental")}function sp(j){return typeof j.nodeName=="string"&&typeof j.appendChild=="function"&&typeof j.getBoundingClientRect=="function"}function vh(j){return typeof j.drawArrays=="function"||typeof j.drawElements=="function"}function ql(j){return typeof j=="string"?j.split():(Et(Array.isArray(j),"invalid extension array"),j)}function Kl(j){return typeof j=="string"?(Et(typeof document<"u","not supported outside of DOM"),document.querySelector(j)):j}function gc(j){var _t=j||{},Bt,ge,Ue,_e,ce={},ir=[],Ke=[],vr=typeof window>"u"?1:window.devicePixelRatio,sr=!1,fr=function(dr){dr&&Et.raise(dr)},yr=function(){};if(typeof _t=="string"?(Et(typeof document<"u","selector queries only supported in DOM enviroments"),Bt=document.querySelector(_t),Et(Bt,"invalid query string for element")):typeof _t=="object"?sp(_t)?Bt=_t:vh(_t)?(_e=_t,Ue=_e.canvas):(Et.constructor(_t),"gl"in _t?_e=_t.gl:"canvas"in _t?Ue=Kl(_t.canvas):"container"in _t&&(ge=Kl(_t.container)),"attributes"in _t&&(ce=_t.attributes,Et.type(ce,"object","invalid context attributes")),"extensions"in _t&&(ir=ql(_t.extensions)),"optionalExtensions"in _t&&(Ke=ql(_t.optionalExtensions)),"onDone"in _t&&(Et.type(_t.onDone,"function","invalid or missing onDone callback"),fr=_t.onDone),"profile"in _t&&(sr=!!_t.profile),"pixelRatio"in _t&&(vr=+_t.pixelRatio,Et(vr>0,"invalid pixel ratio"))):Et.raise("invalid arguments to regl"),Bt&&(Bt.nodeName.toLowerCase()==="canvas"?Ue=Bt:ge=Bt),!_e){if(!Ue){Et(typeof document<"u","must manually specify webgl context outside of DOM environments");var Qe=ud(ge||document.body,fr,vr);if(!Qe)return null;Ue=Qe.canvas,yr=Qe.onDestroy}ce.premultipliedAlpha===void 0&&(ce.premultipliedAlpha=!0),_e=ph(Ue,ce)}return _e?{gl:_e,canvas:Ue,container:ge,extensions:ir,optionalExtensions:Ke,pixelRatio:vr,profile:sr,onDone:fr,onDestroy:yr}:(yr(),fr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function cd(j,_t){var Bt={};function ge(ce){Et.type(ce,"string","extension name must be string");var ir=ce.toLowerCase(),Ke;try{Ke=Bt[ir]=j.getExtension(ir)}catch{}return!!Ke}for(var Ue=0;Ue<_t.extensions.length;++Ue){var _e=_t.extensions[Ue];if(!ge(_e))return _t.onDestroy(),_t.onDone('"'+_e+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return _t.optionalExtensions.forEach(ge),{extensions:Bt,restore:function(){Object.keys(Bt).forEach(function(ce){if(Bt[ce]&&!ge(ce))throw new Error("(regl): error restoring extension "+ce)})}}}function Hi(j,_t){for(var Bt=Array(j),ge=0;ge<j;++ge)Bt[ge]=_t(ge);return Bt}var tt=5120,nt=5121,ot=5122,yt=5123,Rt=5124,jt=5125,Jt=5126;function ht(j){for(var _t=16;_t<=1<<28;_t*=16)if(j<=_t)return _t;return 0}function Dt(j){var _t,Bt;return _t=(j>65535)<<4,j>>>=_t,Bt=(j>255)<<3,j>>>=Bt,_t|=Bt,Bt=(j>15)<<2,j>>>=Bt,_t|=Bt,Bt=(j>3)<<1,j>>>=Bt,_t|=Bt,_t|j>>1}function se(){var j=Hi(8,function(){return[]});function _t(_e){var ce=ht(_e),ir=j[Dt(ce)>>2];return ir.length>0?ir.pop():new ArrayBuffer(ce)}function Bt(_e){j[Dt(_e.byteLength)>>2].push(_e)}function ge(_e,ce){var ir=null;switch(_e){case tt:ir=new Int8Array(_t(ce),0,ce);break;case nt:ir=new Uint8Array(_t(ce),0,ce);break;case ot:ir=new Int16Array(_t(2*ce),0,ce);break;case yt:ir=new Uint16Array(_t(2*ce),0,ce);break;case Rt:ir=new Int32Array(_t(4*ce),0,ce);break;case jt:ir=new Uint32Array(_t(4*ce),0,ce);break;case Jt:ir=new Float32Array(_t(4*ce),0,ce);break;default:return null}return ir.length!==ce?ir.subarray(0,ce):ir}function Ue(_e){Bt(_e.buffer)}return{alloc:_t,free:Bt,allocType:ge,freeType:Ue}}var Pe=se();Pe.zero=se();var er=3408,Ae=3410,qe=3411,Yr=3412,Hr=3413,Ie=3414,Mr=3415,pr=33901,mr=33902,Un=3379,Cr=3386,hi=34921,na=36347,oi=36348,Ci=35661,$n=35660,go=34930,vi=36349,ia=34076,Bi=34024,Hn=7936,si=7937,ws=7938,nf=35724,ao=34047,Fa=36063,af=34852,xu=3553,Ra=34067,gh=34069,Vo=33984,Ia=6408,oo=5126,ya=5121,js=36160,Ns=36053,mv=36064,Rl=16384,P0=function(j,_t){var Bt=1;_t.ext_texture_filter_anisotropic&&(Bt=j.getParameter(ao));var ge=1,Ue=1;_t.webgl_draw_buffers&&(ge=j.getParameter(af),Ue=j.getParameter(Fa));var _e=!!_t.oes_texture_float;if(_e){var ce=j.createTexture();j.bindTexture(xu,ce),j.texImage2D(xu,0,Ia,1,1,0,Ia,oo,null);var ir=j.createFramebuffer();if(j.bindFramebuffer(js,ir),j.framebufferTexture2D(js,mv,xu,ce,0),j.bindTexture(xu,null),j.checkFramebufferStatus(js)!==Ns)_e=!1;else{j.viewport(0,0,1,1),j.clearColor(1,0,0,1),j.clear(Rl);var Ke=Pe.allocType(oo,4);j.readPixels(0,0,1,1,Ia,oo,Ke),j.getError()?_e=!1:(j.deleteFramebuffer(ir),j.deleteTexture(ce),_e=Ke[0]===1),Pe.freeType(Ke)}}var vr=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),sr=!0;if(!vr){var fr=j.createTexture(),yr=Pe.allocType(ya,36);j.activeTexture(Vo),j.bindTexture(Ra,fr),j.texImage2D(gh,0,Ia,3,3,0,Ia,ya,yr),Pe.freeType(yr),j.bindTexture(Ra,null),j.deleteTexture(fr),sr=!j.getError()}return{colorBits:[j.getParameter(Ae),j.getParameter(qe),j.getParameter(Yr),j.getParameter(Hr)],depthBits:j.getParameter(Ie),stencilBits:j.getParameter(Mr),subpixelBits:j.getParameter(er),extensions:Object.keys(_t).filter(function(Qe){return!!_t[Qe]}),maxAnisotropic:Bt,maxDrawbuffers:ge,maxColorAttachments:Ue,pointSizeDims:j.getParameter(pr),lineWidthDims:j.getParameter(mr),maxViewportDims:j.getParameter(Cr),maxCombinedTextureUnits:j.getParameter(Ci),maxCubeMapSize:j.getParameter(ia),maxRenderbufferSize:j.getParameter(Bi),maxTextureUnits:j.getParameter(go),maxTextureSize:j.getParameter(Un),maxAttributes:j.getParameter(hi),maxVertexUniforms:j.getParameter(na),maxVertexTextureUnits:j.getParameter($n),maxVaryingVectors:j.getParameter(oi),maxFragmentUniforms:j.getParameter(vi),glsl:j.getParameter(nf),renderer:j.getParameter(si),vendor:j.getParameter(Hn),version:j.getParameter(ws),readFloat:_e,npotTextureCube:sr}};function st(j){return!!j&&typeof j=="object"&&Array.isArray(j.shape)&&Array.isArray(j.stride)&&typeof j.offset=="number"&&j.shape.length===j.stride.length&&(Array.isArray(j.data)||r(j.data))}var gt=function(j){return Object.keys(j).map(function(_t){return j[_t]})},Gt={shape:hs,flatten:bo};function ye(j,_t,Bt){for(var ge=0;ge<_t;++ge)Bt[ge]=j[ge]}function cr(j,_t,Bt,ge){for(var Ue=0,_e=0;_e<_t;++_e)for(var ce=j[_e],ir=0;ir<Bt;++ir)ge[Ue++]=ce[ir]}function an(j,_t,Bt,ge,Ue,_e){for(var ce=_e,ir=0;ir<_t;++ir)for(var Ke=j[ir],vr=0;vr<Bt;++vr)for(var sr=Ke[vr],fr=0;fr<ge;++fr)Ue[ce++]=sr[fr]}function Ii(j,_t,Bt,ge,Ue){for(var _e=1,ce=Bt+1;ce<_t.length;++ce)_e*=_t[ce];var ir=_t[Bt];if(_t.length-Bt===4){var Ke=_t[Bt+1],vr=_t[Bt+2],sr=_t[Bt+3];for(ce=0;ce<ir;++ce)an(j[ce],Ke,vr,sr,ge,Ue),Ue+=_e}else for(ce=0;ce<ir;++ce)Ii(j[ce],_t,Bt+1,ge,Ue),Ue+=_e}function bo(j,_t,Bt,ge){var Ue=1;if(_t.length)for(var _e=0;_e<_t.length;++_e)Ue*=_t[_e];else Ue=0;var ce=ge||Pe.allocType(Bt,Ue);switch(_t.length){case 0:break;case 1:ye(j,_t[0],ce);break;case 2:cr(j,_t[0],_t[1],ce);break;case 3:an(j,_t[0],_t[1],_t[2],ce,0);break;default:Ii(j,_t,0,ce,0)}return ce}function hs(j){for(var _t=[],Bt=j;Bt.length;Bt=Bt[0])_t.push(Bt.length);return _t}var Go={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},bu=5120,Y_=5122,Z_=5124,lp=5121,D0=5123,yv=5125,q_=5126,Ng=5126,Cs={int8:bu,int16:Y_,int32:Z_,uint8:lp,uint16:D0,uint32:yv,float:q_,float32:Ng},of=35048,sf=35040,mc={dynamic:of,stream:sf,static:35044},yc=Gt.flatten,mh=Gt.shape,_v=35044,Il=35040,so=5121,lf=5126,yh=[];yh[5120]=1,yh[5122]=2,yh[5124]=4,yh[5121]=1,yh[5123]=2,yh[5125]=4,yh[5126]=4;function kg(j){return Go[Object.prototype.toString.call(j)]|0}function K_(j,_t){for(var Bt=0;Bt<_t.length;++Bt)j[Bt]=_t[Bt]}function zg(j,_t,Bt,ge,Ue,_e,ce){for(var ir=0,Ke=0;Ke<Bt;++Ke)for(var vr=0;vr<ge;++vr)j[ir++]=_t[Ue*Ke+_e*vr+ce]}function F0(j,_t,Bt,ge){var Ue=0,_e={};function ce(ae){this.id=Ue++,this.buffer=j.createBuffer(),this.type=ae,this.usage=_v,this.byteLength=0,this.dimension=1,this.dtype=so,this.persistentData=null,Bt.profile&&(this.stats={size:0})}ce.prototype.bind=function(){j.bindBuffer(this.type,this.buffer)},ce.prototype.destroy=function(){yr(this)};var ir=[];function Ke(ae,Te){var ar=ir.pop();return ar||(ar=new ce(ae)),ar.bind(),fr(ar,Te,Il,0,1,!1),ar}function vr(ae){ir.push(ae)}function sr(ae,Te,ar){ae.byteLength=Te.byteLength,j.bufferData(ae.type,Te,ar)}function fr(ae,Te,ar,Sr,Xe,Lr){var tr;if(ae.usage=ar,Array.isArray(Te)){if(ae.dtype=Sr||lf,Te.length>0){var Ar;if(Array.isArray(Te[0])){tr=mh(Te);for(var je=1,Er=1;Er<tr.length;++Er)je*=tr[Er];ae.dimension=je,Ar=yc(Te,tr,ae.dtype),sr(ae,Ar,ar),Lr?ae.persistentData=Ar:Pe.freeType(Ar)}else if(typeof Te[0]=="number"){ae.dimension=Xe;var dn=Pe.allocType(ae.dtype,Te.length);K_(dn,Te),sr(ae,dn,ar),Lr?ae.persistentData=dn:Pe.freeType(dn)}else r(Te[0])?(ae.dimension=Te[0].length,ae.dtype=Sr||kg(Te[0])||lf,Ar=yc(Te,[Te.length,Te[0].length],ae.dtype),sr(ae,Ar,ar),Lr?ae.persistentData=Ar:Pe.freeType(Ar)):Et.raise("invalid buffer data")}}else if(r(Te))ae.dtype=Sr||kg(Te),ae.dimension=Xe,sr(ae,Te,ar),Lr&&(ae.persistentData=new Uint8Array(new Uint8Array(Te.buffer)));else if(st(Te)){tr=Te.shape;var kn=Te.stride,wr=Te.offset,rr=0,$e=0,pn=0,li=0;tr.length===1?(rr=tr[0],$e=1,pn=kn[0],li=0):tr.length===2?(rr=tr[0],$e=tr[1],pn=kn[0],li=kn[1]):Et.raise("invalid shape"),ae.dtype=Sr||kg(Te.data)||lf,ae.dimension=$e;var Or=Pe.allocType(ae.dtype,rr*$e);zg(Or,Te.data,rr,$e,pn,li,wr),sr(ae,Or,ar),Lr?ae.persistentData=Or:Pe.freeType(Or)}else Te instanceof ArrayBuffer?(ae.dtype=so,ae.dimension=Xe,sr(ae,Te,ar),Lr&&(ae.persistentData=new Uint8Array(new Uint8Array(Te)))):Et.raise("invalid buffer data")}function yr(ae){_t.bufferCount--,ge(ae);var Te=ae.buffer;Et(Te,"buffer must not be deleted already"),j.deleteBuffer(Te),ae.buffer=null,delete _e[ae.id]}function Qe(ae,Te,ar,Sr){_t.bufferCount++;var Xe=new ce(Te);_e[Xe.id]=Xe;function Lr(je){var Er=_v,dn=null,kn=0,wr=0,rr=1;return Array.isArray(je)||r(je)||st(je)||je instanceof ArrayBuffer?dn=je:typeof je=="number"?kn=je|0:je&&(Et.type(je,"object","buffer arguments must be an object, a number or an array"),"data"in je&&(Et(dn===null||Array.isArray(dn)||r(dn)||st(dn),"invalid data for buffer"),dn=je.data),"usage"in je&&(Et.parameter(je.usage,mc,"invalid buffer usage"),Er=mc[je.usage]),"type"in je&&(Et.parameter(je.type,Cs,"invalid buffer type"),wr=Cs[je.type]),"dimension"in je&&(Et.type(je.dimension,"number","invalid dimension"),rr=je.dimension|0),"length"in je&&(Et.nni(kn,"buffer length must be a nonnegative integer"),kn=je.length|0)),Xe.bind(),dn?fr(Xe,dn,Er,wr,rr,Sr):(kn&&j.bufferData(Xe.type,kn,Er),Xe.dtype=wr||so,Xe.usage=Er,Xe.dimension=rr,Xe.byteLength=kn),Bt.profile&&(Xe.stats.size=Xe.byteLength*yh[Xe.dtype]),Lr}function tr(je,Er){Et(Er+je.byteLength<=Xe.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+je.byteLength+" starting from offset "+Er+" to a buffer of size "+Xe.byteLength),j.bufferSubData(Xe.type,Er,je)}function Ar(je,Er){var dn=(Er||0)|0,kn;if(Xe.bind(),r(je)||je instanceof ArrayBuffer)tr(je,dn);else if(Array.isArray(je)){if(je.length>0)if(typeof je[0]=="number"){var wr=Pe.allocType(Xe.dtype,je.length);K_(wr,je),tr(wr,dn),Pe.freeType(wr)}else if(Array.isArray(je[0])||r(je[0])){kn=mh(je);var rr=yc(je,kn,Xe.dtype);tr(rr,dn),Pe.freeType(rr)}else Et.raise("invalid buffer data")}else if(st(je)){kn=je.shape;var $e=je.stride,pn=0,li=0,Or=0,ei=0;kn.length===1?(pn=kn[0],li=1,Or=$e[0],ei=0):kn.length===2?(pn=kn[0],li=kn[1],Or=$e[0],ei=$e[1]):Et.raise("invalid shape");var Bn=Array.isArray(je.data)?Xe.dtype:kg(je.data),An=Pe.allocType(Bn,pn*li);zg(An,je.data,pn,li,Or,ei,je.offset),tr(An,dn),Pe.freeType(An)}else Et.raise("invalid data for buffer subdata");return Lr}return ar||Lr(ae),Lr._reglType="buffer",Lr._buffer=Xe,Lr.subdata=Ar,Bt.profile&&(Lr.stats=Xe.stats),Lr.destroy=function(){yr(Xe)},Lr}function dr(){gt(_e).forEach(function(ae){ae.buffer=j.createBuffer(),j.bindBuffer(ae.type,ae.buffer),j.bufferData(ae.type,ae.persistentData||ae.byteLength,ae.usage)})}return Bt.profile&&(_t.getTotalBufferSize=function(){var ae=0;return Object.keys(_e).forEach(function(Te){ae+=_e[Te].stats.size}),ae}),{create:Qe,createStream:Ke,destroyStream:vr,clear:function(){gt(_e).forEach(yr),ir.forEach(yr)},getBuffer:function(ae){return ae&&ae._buffer instanceof ce?ae._buffer:null},restore:dr,_initBuffer:fr}}var B0=0,N0=0,Q_=1,J_=1,lE=4,xv=4,_c={points:B0,point:N0,lines:Q_,line:J_,triangles:lE,triangle:xv,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},t1=0,Ss=1,hd=4,uf=5120,Ql=5121,cf=5122,Eu=5123,_h=5124,Jl=5125,xh=34963,hf=35040,e1=35044;function r1(j,_t,Bt,ge){var Ue={},_e=0,ce={uint8:Ql,uint16:Eu};_t.oes_element_index_uint&&(ce.uint32=Jl);function ir(dr){this.id=_e++,Ue[this.id]=this,this.buffer=dr,this.primType=hd,this.vertCount=0,this.type=0}ir.prototype.bind=function(){this.buffer.bind()};var Ke=[];function vr(dr){var ae=Ke.pop();return ae||(ae=new ir(Bt.create(null,xh,!0,!1)._buffer)),fr(ae,dr,hf,-1,-1,0,0),ae}function sr(dr){Ke.push(dr)}function fr(dr,ae,Te,ar,Sr,Xe,Lr){dr.buffer.bind();var tr;if(ae){var Ar=Lr;!Lr&&(!r(ae)||st(ae)&&!r(ae.data))&&(Ar=_t.oes_element_index_uint?Jl:Eu),Bt._initBuffer(dr.buffer,ae,Te,Ar,3)}else j.bufferData(xh,Xe,Te),dr.buffer.dtype=tr||Ql,dr.buffer.usage=Te,dr.buffer.dimension=3,dr.buffer.byteLength=Xe;if(tr=Lr,!Lr){switch(dr.buffer.dtype){case Ql:case uf:tr=Ql;break;case Eu:case cf:tr=Eu;break;case Jl:case _h:tr=Jl;break;default:Et.raise("unsupported type for element array")}dr.buffer.dtype=tr}dr.type=tr,Et(tr!==Jl||!!_t.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var je=Sr;je<0&&(je=dr.buffer.byteLength,tr===Eu?je>>=1:tr===Jl&&(je>>=2)),dr.vertCount=je;var Er=ar;if(ar<0){Er=hd;var dn=dr.buffer.dimension;dn===1&&(Er=t1),dn===2&&(Er=Ss),dn===3&&(Er=hd)}dr.primType=Er}function yr(dr){ge.elementsCount--,Et(dr.buffer!==null,"must not double destroy elements"),delete Ue[dr.id],dr.buffer.destroy(),dr.buffer=null}function Qe(dr,ae){var Te=Bt.create(null,xh,!0),ar=new ir(Te._buffer);ge.elementsCount++;function Sr(Xe){if(!Xe)Te(),ar.primType=hd,ar.vertCount=0,ar.type=Ql;else if(typeof Xe=="number")Te(Xe),ar.primType=hd,ar.vertCount=Xe|0,ar.type=Ql;else{var Lr=null,tr=e1,Ar=-1,je=-1,Er=0,dn=0;Array.isArray(Xe)||r(Xe)||st(Xe)?Lr=Xe:(Et.type(Xe,"object","invalid arguments for elements"),"data"in Xe&&(Lr=Xe.data,Et(Array.isArray(Lr)||r(Lr)||st(Lr),"invalid data for element buffer")),"usage"in Xe&&(Et.parameter(Xe.usage,mc,"invalid element buffer usage"),tr=mc[Xe.usage]),"primitive"in Xe&&(Et.parameter(Xe.primitive,_c,"invalid element buffer primitive"),Ar=_c[Xe.primitive]),"count"in Xe&&(Et(typeof Xe.count=="number"&&Xe.count>=0,"invalid vertex count for elements"),je=Xe.count|0),"type"in Xe&&(Et.parameter(Xe.type,ce,"invalid buffer type"),dn=ce[Xe.type]),"length"in Xe?Er=Xe.length|0:(Er=je,dn===Eu||dn===cf?Er*=2:(dn===Jl||dn===_h)&&(Er*=4))),fr(ar,Lr,tr,Ar,je,Er,dn)}return Sr}return Sr(dr),Sr._reglType="elements",Sr._elements=ar,Sr.subdata=function(Xe,Lr){return Te.subdata(Xe,Lr),Sr},Sr.destroy=function(){yr(ar)},Sr}return{create:Qe,createStream:vr,destroyStream:sr,getElements:function(dr){return typeof dr=="function"&&dr._elements instanceof ir?dr._elements:null},clear:function(){gt(Ue).forEach(yr)}}}var ua=new Float32Array(1),uE=new Uint32Array(ua.buffer),Ug=5123;function k0(j){for(var _t=Pe.allocType(Ug,j.length),Bt=0;Bt<j.length;++Bt)if(isNaN(j[Bt]))_t[Bt]=65535;else if(j[Bt]===1/0)_t[Bt]=31744;else if(j[Bt]===-1/0)_t[Bt]=64512;else{ua[0]=j[Bt];var ge=uE[0],Ue=ge>>>31<<15,_e=(ge<<1>>>24)-127,ce=ge>>13&1024-1;if(_e<-24)_t[Bt]=Ue;else if(_e<-14){var ir=-14-_e;_t[Bt]=Ue+(ce+1024>>ir)}else _e>15?_t[Bt]=Ue+31744:_t[Bt]=Ue+(_e+15<<10)+ce}return _t}function lo(j){return Array.isArray(j)||r(j)}var z0=function(j){return!(j&j-1)&&!!j},n1=34467,sl=3553,bh=34067,xc=34069,ff=6408,$g=6406,up=6407,Yu=6409,bv=6410,df=32854,Eh=32855,U0=36194,Ev=32819,wa=32820,Hg=33635,cE=34042,pf=6402,wv=34041,$0=35904,Vg=35906,wh=36193,vf=33776,fd=33777,cp=33778,dd=33779,pd=35986,H0=35987,vd=34798,wu=35840,V0=35841,G0=35842,W0=35843,gf=36196,bc=5121,hp=5123,Cv=5125,mf=5126,hE=10242,Gg=10243,X0=10497,Wg=33071,i1=33648,Xg=10240,j0=10241,Sv=9728,Y0=9729,gd=9984,Z0=9985,yf=9986,Ca=9987,jg=33170,Ec=4352,_f=4353,Si=4354,Sa=34046,tu=3317,Tv=37440,fp=37441,Av=37443,a1=37444,Yg=33984,Mv=[gd,yf,Z0,Ca],xf=[0,Yu,bv,up,ff],Wo={};Wo[Yu]=Wo[$g]=Wo[pf]=1,Wo[wv]=Wo[bv]=2,Wo[up]=Wo[$0]=3,Wo[ff]=Wo[Vg]=4;function Ga(j){return"[object "+j+"]"}var dp=Ga("HTMLCanvasElement"),q0=Ga("OffscreenCanvas"),mo=Ga("CanvasRenderingContext2D"),Xr=Ga("ImageBitmap"),ll=Ga("HTMLImageElement"),Rv=Ga("HTMLVideoElement"),pp=Object.keys(Go).concat([dp,q0,mo,Xr,ll,Rv]),Ys=[];Ys[bc]=1,Ys[mf]=4,Ys[wh]=2,Ys[hp]=2,Ys[Cv]=4;var da=[];da[df]=2,da[Eh]=2,da[U0]=2,da[wv]=4,da[vf]=.5,da[fd]=.5,da[cp]=1,da[dd]=1,da[pd]=.5,da[H0]=1,da[vd]=1,da[wu]=.5,da[V0]=.25,da[G0]=.5,da[W0]=.25,da[gf]=.5;function Zg(j){return Array.isArray(j)&&(j.length===0||typeof j[0]=="number")}function xr(j){if(!Array.isArray(j))return!1;var _t=j.length;return!(_t===0||!lo(j[0]))}function Ch(j){return Object.prototype.toString.call(j)}function Iv(j){return Ch(j)===dp}function qg(j){return Ch(j)===q0}function Cu(j){return Ch(j)===mo}function Ll(j){return Ch(j)===Xr}function Kg(j){return Ch(j)===ll}function Qg(j){return Ch(j)===Rv}function Zs(j){if(!j)return!1;var _t=Ch(j);return pp.indexOf(_t)>=0?!0:Zg(j)||xr(j)||st(j)}function wc(j){return Go[Object.prototype.toString.call(j)]|0}function o1(j,_t){var Bt=_t.length;switch(j.type){case bc:case hp:case Cv:case mf:var ge=Pe.allocType(j.type,Bt);ge.set(_t),j.data=ge;break;case wh:j.data=k0(_t);break;default:Et.raise("unsupported texture type, must specify a typed array")}}function vp(j,_t){return Pe.allocType(j.type===wh?mf:j.type,_t)}function Jg(j,_t){j.type===wh?(j.data=k0(_t),Pe.freeType(_t)):j.data=_t}function K0(j,_t,Bt,ge,Ue,_e){for(var ce=j.width,ir=j.height,Ke=j.channels,vr=ce*ir*Ke,sr=vp(j,vr),fr=0,yr=0;yr<ir;++yr)for(var Qe=0;Qe<ce;++Qe)for(var dr=0;dr<Ke;++dr)sr[fr++]=_t[Bt*Qe+ge*yr+Ue*dr+_e];Jg(j,sr)}function Ol(j,_t,Bt,ge,Ue,_e){var ce;if(typeof da[j]<"u"?ce=da[j]:ce=Wo[j]*Ys[_t],_e&&(ce*=6),Ue){for(var ir=0,Ke=Bt;Ke>=1;)ir+=ce*Ke*Ke,Ke/=2;return ir}else return ce*Bt*ge}function eu(j,_t,Bt,ge,Ue,_e,ce){var ir={"don't care":Ec,"dont care":Ec,nice:Si,fast:_f},Ke={repeat:X0,clamp:Wg,mirror:i1},vr={nearest:Sv,linear:Y0},sr=n({mipmap:Ca,"nearest mipmap nearest":gd,"linear mipmap nearest":Z0,"nearest mipmap linear":yf,"linear mipmap linear":Ca},vr),fr={none:0,browser:a1},yr={uint8:bc,rgba4:Ev,rgb565:Hg,"rgb5 a1":wa},Qe={alpha:$g,luminance:Yu,"luminance alpha":bv,rgb:up,rgba:ff,rgba4:df,"rgb5 a1":Eh,rgb565:U0},dr={};_t.ext_srgb&&(Qe.srgb=$0,Qe.srgba=Vg),_t.oes_texture_float&&(yr.float32=yr.float=mf),_t.oes_texture_half_float&&(yr.float16=yr["half float"]=wh),_t.webgl_depth_texture&&(n(Qe,{depth:pf,"depth stencil":wv}),n(yr,{uint16:hp,uint32:Cv,"depth stencil":cE})),_t.webgl_compressed_texture_s3tc&&n(dr,{"rgb s3tc dxt1":vf,"rgba s3tc dxt1":fd,"rgba s3tc dxt3":cp,"rgba s3tc dxt5":dd}),_t.webgl_compressed_texture_atc&&n(dr,{"rgb atc":pd,"rgba atc explicit alpha":H0,"rgba atc interpolated alpha":vd}),_t.webgl_compressed_texture_pvrtc&&n(dr,{"rgb pvrtc 4bppv1":wu,"rgb pvrtc 2bppv1":V0,"rgba pvrtc 4bppv1":G0,"rgba pvrtc 2bppv1":W0}),_t.webgl_compressed_texture_etc1&&(dr["rgb etc1"]=gf);var ae=Array.prototype.slice.call(j.getParameter(n1));Object.keys(dr).forEach(function(Lt){var xe=dr[Lt];ae.indexOf(xe)>=0&&(Qe[Lt]=xe)});var Te=Object.keys(Qe);Bt.textureFormats=Te;var ar=[];Object.keys(Qe).forEach(function(Lt){var xe=Qe[Lt];ar[xe]=Lt});var Sr=[];Object.keys(yr).forEach(function(Lt){var xe=yr[Lt];Sr[xe]=Lt});var Xe=[];Object.keys(vr).forEach(function(Lt){var xe=vr[Lt];Xe[xe]=Lt});var Lr=[];Object.keys(sr).forEach(function(Lt){var xe=sr[Lt];Lr[xe]=Lt});var tr=[];Object.keys(Ke).forEach(function(Lt){var xe=Ke[Lt];tr[xe]=Lt});var Ar=Te.reduce(function(Lt,xe){var fe=Qe[xe];return fe===Yu||fe===$g||fe===Yu||fe===bv||fe===pf||fe===wv||_t.ext_srgb&&(fe===$0||fe===Vg)?Lt[fe]=fe:fe===Eh||xe.indexOf("rgba")>=0?Lt[fe]=ff:Lt[fe]=up,Lt},{});function je(){this.internalformat=ff,this.format=ff,this.type=bc,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=a1,this.width=0,this.height=0,this.channels=0}function Er(Lt,xe){Lt.internalformat=xe.internalformat,Lt.format=xe.format,Lt.type=xe.type,Lt.compressed=xe.compressed,Lt.premultiplyAlpha=xe.premultiplyAlpha,Lt.flipY=xe.flipY,Lt.unpackAlignment=xe.unpackAlignment,Lt.colorSpace=xe.colorSpace,Lt.width=xe.width,Lt.height=xe.height,Lt.channels=xe.channels}function dn(Lt,xe){if(!(typeof xe!="object"||!xe)){if("premultiplyAlpha"in xe&&(Et.type(xe.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Lt.premultiplyAlpha=xe.premultiplyAlpha),"flipY"in xe&&(Et.type(xe.flipY,"boolean","invalid texture flip"),Lt.flipY=xe.flipY),"alignment"in xe&&(Et.oneOf(xe.alignment,[1,2,4,8],"invalid texture unpack alignment"),Lt.unpackAlignment=xe.alignment),"colorSpace"in xe&&(Et.parameter(xe.colorSpace,fr,"invalid colorSpace"),Lt.colorSpace=fr[xe.colorSpace]),"type"in xe){var fe=xe.type;Et(_t.oes_texture_float||!(fe==="float"||fe==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),Et(_t.oes_texture_half_float||!(fe==="half float"||fe==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),Et(_t.webgl_depth_texture||!(fe==="uint16"||fe==="uint32"||fe==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),Et.parameter(fe,yr,"invalid texture type"),Lt.type=yr[fe]}var Fr=Lt.width,ri=Lt.height,pa=Lt.channels,lt=!1;"shape"in xe?(Et(Array.isArray(xe.shape)&&xe.shape.length>=2,"shape must be an array"),Fr=xe.shape[0],ri=xe.shape[1],xe.shape.length===3&&(pa=xe.shape[2],Et(pa>0&&pa<=4,"invalid number of channels"),lt=!0),Et(Fr>=0&&Fr<=Bt.maxTextureSize,"invalid width"),Et(ri>=0&&ri<=Bt.maxTextureSize,"invalid height")):("radius"in xe&&(Fr=ri=xe.radius,Et(Fr>=0&&Fr<=Bt.maxTextureSize,"invalid radius")),"width"in xe&&(Fr=xe.width,Et(Fr>=0&&Fr<=Bt.maxTextureSize,"invalid width")),"height"in xe&&(ri=xe.height,Et(ri>=0&&ri<=Bt.maxTextureSize,"invalid height")),"channels"in xe&&(pa=xe.channels,Et(pa>0&&pa<=4,"invalid number of channels"),lt=!0)),Lt.width=Fr|0,Lt.height=ri|0,Lt.channels=pa|0;var Ct=!1;if("format"in xe){var Nt=xe.format;Et(_t.webgl_depth_texture||!(Nt==="depth"||Nt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),Et.parameter(Nt,Qe,"invalid texture format");var pe=Lt.internalformat=Qe[Nt];Lt.format=Ar[pe],Nt in yr&&("type"in xe||(Lt.type=yr[Nt])),Nt in dr&&(Lt.compressed=!0),Ct=!0}!lt&&Ct?Lt.channels=Wo[Lt.format]:lt&&!Ct?Lt.channels!==xf[Lt.format]&&(Lt.format=Lt.internalformat=xf[Lt.channels]):Ct&&lt&&Et(Lt.channels===Wo[Lt.format],"number of channels inconsistent with specified format")}}function kn(Lt){j.pixelStorei(Tv,Lt.flipY),j.pixelStorei(fp,Lt.premultiplyAlpha),j.pixelStorei(Av,Lt.colorSpace),j.pixelStorei(tu,Lt.unpackAlignment)}function wr(){je.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function rr(Lt,xe){var fe=null;if(Zs(xe)?fe=xe:xe&&(Et.type(xe,"object","invalid pixel data type"),dn(Lt,xe),"x"in xe&&(Lt.xOffset=xe.x|0),"y"in xe&&(Lt.yOffset=xe.y|0),Zs(xe.data)&&(fe=xe.data)),Et(!Lt.compressed||fe instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),xe.copy){Et(!fe,"can not specify copy and data field for the same texture");var Fr=Ue.viewportWidth,ri=Ue.viewportHeight;Lt.width=Lt.width||Fr-Lt.xOffset,Lt.height=Lt.height||ri-Lt.yOffset,Lt.needsCopy=!0,Et(Lt.xOffset>=0&&Lt.xOffset<Fr&&Lt.yOffset>=0&&Lt.yOffset<ri&&Lt.width>0&&Lt.width<=Fr&&Lt.height>0&&Lt.height<=ri,"copy texture read out of bounds")}else if(!fe)Lt.width=Lt.width||1,Lt.height=Lt.height||1,Lt.channels=Lt.channels||4;else if(r(fe))Lt.channels=Lt.channels||4,Lt.data=fe,!("type"in xe)&&Lt.type===bc&&(Lt.type=wc(fe));else if(Zg(fe))Lt.channels=Lt.channels||4,o1(Lt,fe),Lt.alignment=1,Lt.needsFree=!0;else if(st(fe)){var pa=fe.data;!Array.isArray(pa)&&Lt.type===bc&&(Lt.type=wc(pa));var lt=fe.shape,Ct=fe.stride,Nt,pe,he,Vt,Zt,te;lt.length===3?(he=lt[2],te=Ct[2]):(Et(lt.length===2,"invalid ndarray pixel data, must be 2 or 3D"),he=1,te=1),Nt=lt[0],pe=lt[1],Vt=Ct[0],Zt=Ct[1],Lt.alignment=1,Lt.width=Nt,Lt.height=pe,Lt.channels=he,Lt.format=Lt.internalformat=xf[he],Lt.needsFree=!0,K0(Lt,pa,Vt,Zt,te,fe.offset)}else if(Iv(fe)||qg(fe)||Cu(fe))Iv(fe)||qg(fe)?Lt.element=fe:Lt.element=fe.canvas,Lt.width=Lt.element.width,Lt.height=Lt.element.height,Lt.channels=4;else if(Ll(fe))Lt.element=fe,Lt.width=fe.width,Lt.height=fe.height,Lt.channels=4;else if(Kg(fe))Lt.element=fe,Lt.width=fe.naturalWidth,Lt.height=fe.naturalHeight,Lt.channels=4;else if(Qg(fe))Lt.element=fe,Lt.width=fe.videoWidth,Lt.height=fe.videoHeight,Lt.channels=4;else if(xr(fe)){var Ot=Lt.width||fe[0].length,Xt=Lt.height||fe.length,bt=Lt.channels;lo(fe[0][0])?bt=bt||fe[0][0].length:bt=bt||1;for(var Yt=Gt.shape(fe),Ee=1,Le=0;Le<Yt.length;++Le)Ee*=Yt[Le];var Ye=vp(Lt,Ee);Gt.flatten(fe,Yt,"",Ye),Jg(Lt,Ye),Lt.alignment=1,Lt.width=Ot,Lt.height=Xt,Lt.channels=bt,Lt.format=Lt.internalformat=xf[bt],Lt.needsFree=!0}Lt.type===mf?Et(Bt.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Lt.type===wh&&Et(Bt.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function $e(Lt,xe,fe){var Fr=Lt.element,ri=Lt.data,pa=Lt.internalformat,lt=Lt.format,Ct=Lt.type,Nt=Lt.width,pe=Lt.height;kn(Lt),Fr?j.texImage2D(xe,fe,lt,lt,Ct,Fr):Lt.compressed?j.compressedTexImage2D(xe,fe,pa,Nt,pe,0,ri):Lt.needsCopy?(ge(),j.copyTexImage2D(xe,fe,lt,Lt.xOffset,Lt.yOffset,Nt,pe,0)):j.texImage2D(xe,fe,lt,Nt,pe,0,lt,Ct,ri||null)}function pn(Lt,xe,fe,Fr,ri){var pa=Lt.element,lt=Lt.data,Ct=Lt.internalformat,Nt=Lt.format,pe=Lt.type,he=Lt.width,Vt=Lt.height;kn(Lt),pa?j.texSubImage2D(xe,ri,fe,Fr,Nt,pe,pa):Lt.compressed?j.compressedTexSubImage2D(xe,ri,fe,Fr,Ct,he,Vt,lt):Lt.needsCopy?(ge(),j.copyTexSubImage2D(xe,ri,fe,Fr,Lt.xOffset,Lt.yOffset,he,Vt)):j.texSubImage2D(xe,ri,fe,Fr,he,Vt,Nt,pe,lt)}var li=[];function Or(){return li.pop()||new wr}function ei(Lt){Lt.needsFree&&Pe.freeType(Lt.data),wr.call(Lt),li.push(Lt)}function Bn(){je.call(this),this.genMipmaps=!1,this.mipmapHint=Ec,this.mipmask=0,this.images=Array(16)}function An(Lt,xe,fe){var Fr=Lt.images[0]=Or();Lt.mipmask=1,Fr.width=Lt.width=xe,Fr.height=Lt.height=fe,Fr.channels=Lt.channels=4}function Vi(Lt,xe){var fe=null;if(Zs(xe))fe=Lt.images[0]=Or(),Er(fe,Lt),rr(fe,xe),Lt.mipmask=1;else if(dn(Lt,xe),Array.isArray(xe.mipmap))for(var Fr=xe.mipmap,ri=0;ri<Fr.length;++ri)fe=Lt.images[ri]=Or(),Er(fe,Lt),fe.width>>=ri,fe.height>>=ri,rr(fe,Fr[ri]),Lt.mipmask|=1<<ri;else fe=Lt.images[0]=Or(),Er(fe,Lt),rr(fe,xe),Lt.mipmask=1;Er(Lt,Lt.images[0]),Lt.compressed&&(Lt.internalformat===vf||Lt.internalformat===fd||Lt.internalformat===cp||Lt.internalformat===dd)&&Et(Lt.width%4===0&&Lt.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Lo(Lt,xe){for(var fe=Lt.images,Fr=0;Fr<fe.length;++Fr){if(!fe[Fr])return;$e(fe[Fr],xe,Fr)}}var As=[];function gi(){var Lt=As.pop()||new Bn;je.call(Lt),Lt.mipmask=0;for(var xe=0;xe<16;++xe)Lt.images[xe]=null;return Lt}function Oo(Lt){for(var xe=Lt.images,fe=0;fe<xe.length;++fe)xe[fe]&&ei(xe[fe]),xe[fe]=null;As.push(Lt)}function La(){this.minFilter=Sv,this.magFilter=Sv,this.wrapS=Wg,this.wrapT=Wg,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Ec}function Zo(Lt,xe){if("min"in xe){var fe=xe.min;Et.parameter(fe,sr),Lt.minFilter=sr[fe],Mv.indexOf(Lt.minFilter)>=0&&!("faces"in xe)&&(Lt.genMipmaps=!0)}if("mag"in xe){var Fr=xe.mag;Et.parameter(Fr,vr),Lt.magFilter=vr[Fr]}var ri=Lt.wrapS,pa=Lt.wrapT;if("wrap"in xe){var lt=xe.wrap;typeof lt=="string"?(Et.parameter(lt,Ke),ri=pa=Ke[lt]):Array.isArray(lt)&&(Et.parameter(lt[0],Ke),Et.parameter(lt[1],Ke),ri=Ke[lt[0]],pa=Ke[lt[1]])}else{if("wrapS"in xe){var Ct=xe.wrapS;Et.parameter(Ct,Ke),ri=Ke[Ct]}if("wrapT"in xe){var Nt=xe.wrapT;Et.parameter(Nt,Ke),pa=Ke[Nt]}}if(Lt.wrapS=ri,Lt.wrapT=pa,"anisotropic"in xe){var pe=xe.anisotropic;Et(typeof pe=="number"&&pe>=1&&pe<=Bt.maxAnisotropic,"aniso samples must be between 1 and "),Lt.anisotropic=xe.anisotropic}if("mipmap"in xe){var he=!1;switch(typeof xe.mipmap){case"string":Et.parameter(xe.mipmap,ir,"invalid mipmap hint"),Lt.mipmapHint=ir[xe.mipmap],Lt.genMipmaps=!0,he=!0;break;case"boolean":he=Lt.genMipmaps=xe.mipmap;break;case"object":Et(Array.isArray(xe.mipmap),"invalid mipmap type"),Lt.genMipmaps=!1,he=!0;break;default:Et.raise("invalid mipmap type")}he&&!("min"in xe)&&(Lt.minFilter=gd)}}function qo(Lt,xe){j.texParameteri(xe,j0,Lt.minFilter),j.texParameteri(xe,Xg,Lt.magFilter),j.texParameteri(xe,hE,Lt.wrapS),j.texParameteri(xe,Gg,Lt.wrapT),_t.ext_texture_filter_anisotropic&&j.texParameteri(xe,Sa,Lt.anisotropic),Lt.genMipmaps&&(j.hint(jg,Lt.mipmapHint),j.generateMipmap(xe))}var ho=0,vs={},Js=Bt.maxTextureUnits,Ko=Array(Js).map(function(){return null});function Jn(Lt){je.call(this),this.mipmask=0,this.internalformat=ff,this.id=ho++,this.refCount=1,this.target=Lt,this.texture=j.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new La,ce.profile&&(this.stats={size:0})}function $s(Lt){j.activeTexture(Yg),j.bindTexture(Lt.target,Lt.texture)}function Yi(){var Lt=Ko[0];Lt?j.bindTexture(Lt.target,Lt.texture):j.bindTexture(sl,null)}function wn(Lt){var xe=Lt.texture;Et(xe,"must not double destroy texture");var fe=Lt.unit,Fr=Lt.target;fe>=0&&(j.activeTexture(Yg+fe),j.bindTexture(Fr,null),Ko[fe]=null),j.deleteTexture(xe),Lt.texture=null,Lt.params=null,Lt.pixels=null,Lt.refCount=0,delete vs[Lt.id],_e.textureCount--}n(Jn.prototype,{bind:function(){var Lt=this;Lt.bindCount+=1;var xe=Lt.unit;if(xe<0){for(var fe=0;fe<Js;++fe){var Fr=Ko[fe];if(Fr){if(Fr.bindCount>0)continue;Fr.unit=-1}Ko[fe]=Lt,xe=fe;break}xe>=Js&&Et.raise("insufficient number of texture units"),ce.profile&&_e.maxTextureUnits<xe+1&&(_e.maxTextureUnits=xe+1),Lt.unit=xe,j.activeTexture(Yg+xe),j.bindTexture(Lt.target,Lt.texture)}return xe},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&wn(this)}});function di(Lt,xe){var fe=new Jn(sl);vs[fe.id]=fe,_e.textureCount++;function Fr(lt,Ct){var Nt=fe.texInfo;La.call(Nt);var pe=gi();return typeof lt=="number"?typeof Ct=="number"?An(pe,lt|0,Ct|0):An(pe,lt|0,lt|0):lt?(Et.type(lt,"object","invalid arguments to regl.texture"),Zo(Nt,lt),Vi(pe,lt)):An(pe,1,1),Nt.genMipmaps&&(pe.mipmask=(pe.width<<1)-1),fe.mipmask=pe.mipmask,Er(fe,pe),Et.texture2D(Nt,pe,Bt),fe.internalformat=pe.internalformat,Fr.width=pe.width,Fr.height=pe.height,$s(fe),Lo(pe,sl),qo(Nt,sl),Yi(),Oo(pe),ce.profile&&(fe.stats.size=Ol(fe.internalformat,fe.type,pe.width,pe.height,Nt.genMipmaps,!1)),Fr.format=ar[fe.internalformat],Fr.type=Sr[fe.type],Fr.mag=Xe[Nt.magFilter],Fr.min=Lr[Nt.minFilter],Fr.wrapS=tr[Nt.wrapS],Fr.wrapT=tr[Nt.wrapT],Fr}function ri(lt,Ct,Nt,pe){Et(!!lt,"must specify image data");var he=Ct|0,Vt=Nt|0,Zt=pe|0,te=Or();return Er(te,fe),te.width=0,te.height=0,rr(te,lt),te.width=te.width||(fe.width>>Zt)-he,te.height=te.height||(fe.height>>Zt)-Vt,Et(fe.type===te.type&&fe.format===te.format&&fe.internalformat===te.internalformat,"incompatible format for texture.subimage"),Et(he>=0&&Vt>=0&&he+te.width<=fe.width&&Vt+te.height<=fe.height,"texture.subimage write out of bounds"),Et(fe.mipmask&1<<Zt,"missing mipmap data"),Et(te.data||te.element||te.needsCopy,"missing image data"),$s(fe),pn(te,sl,he,Vt,Zt),Yi(),ei(te),Fr}function pa(lt,Ct){var Nt=lt|0,pe=Ct|0||Nt;if(Nt===fe.width&&pe===fe.height)return Fr;Fr.width=fe.width=Nt,Fr.height=fe.height=pe,$s(fe);for(var he=0;fe.mipmask>>he;++he){var Vt=Nt>>he,Zt=pe>>he;if(!Vt||!Zt)break;j.texImage2D(sl,he,fe.format,Vt,Zt,0,fe.format,fe.type,null)}return Yi(),ce.profile&&(fe.stats.size=Ol(fe.internalformat,fe.type,Nt,pe,!1,!1)),Fr}return Fr(Lt,xe),Fr.subimage=ri,Fr.resize=pa,Fr._reglType="texture2d",Fr._texture=fe,ce.profile&&(Fr.stats=fe.stats),Fr.destroy=function(){fe.decRef()},Fr}function Ni(Lt,xe,fe,Fr,ri,pa){var lt=new Jn(bh);vs[lt.id]=lt,_e.cubeCount++;var Ct=new Array(6);function Nt(Vt,Zt,te,Ot,Xt,bt){var Yt,Ee=lt.texInfo;for(La.call(Ee),Yt=0;Yt<6;++Yt)Ct[Yt]=gi();if(typeof Vt=="number"||!Vt){var Le=Vt|0||1;for(Yt=0;Yt<6;++Yt)An(Ct[Yt],Le,Le)}else if(typeof Vt=="object")if(Zt)Vi(Ct[0],Vt),Vi(Ct[1],Zt),Vi(Ct[2],te),Vi(Ct[3],Ot),Vi(Ct[4],Xt),Vi(Ct[5],bt);else if(Zo(Ee,Vt),dn(lt,Vt),"faces"in Vt){var Ye=Vt.faces;for(Et(Array.isArray(Ye)&&Ye.length===6,"cube faces must be a length 6 array"),Yt=0;Yt<6;++Yt)Et(typeof Ye[Yt]=="object"&&!!Ye[Yt],"invalid input for cube map face"),Er(Ct[Yt],lt),Vi(Ct[Yt],Ye[Yt])}else for(Yt=0;Yt<6;++Yt)Vi(Ct[Yt],Vt);else Et.raise("invalid arguments to cube map");for(Er(lt,Ct[0]),Bt.npotTextureCube||Et(z0(lt.width)&&z0(lt.height),"your browser does not support non power or two texture dimensions"),Ee.genMipmaps?lt.mipmask=(Ct[0].width<<1)-1:lt.mipmask=Ct[0].mipmask,Et.textureCube(lt,Ee,Ct,Bt),lt.internalformat=Ct[0].internalformat,Nt.width=Ct[0].width,Nt.height=Ct[0].height,$s(lt),Yt=0;Yt<6;++Yt)Lo(Ct[Yt],xc+Yt);for(qo(Ee,bh),Yi(),ce.profile&&(lt.stats.size=Ol(lt.internalformat,lt.type,Nt.width,Nt.height,Ee.genMipmaps,!0)),Nt.format=ar[lt.internalformat],Nt.type=Sr[lt.type],Nt.mag=Xe[Ee.magFilter],Nt.min=Lr[Ee.minFilter],Nt.wrapS=tr[Ee.wrapS],Nt.wrapT=tr[Ee.wrapT],Yt=0;Yt<6;++Yt)Oo(Ct[Yt]);return Nt}function pe(Vt,Zt,te,Ot,Xt){Et(!!Zt,"must specify image data"),Et(typeof Vt=="number"&&Vt===(Vt|0)&&Vt>=0&&Vt<6,"invalid face");var bt=te|0,Yt=Ot|0,Ee=Xt|0,Le=Or();return Er(Le,lt),Le.width=0,Le.height=0,rr(Le,Zt),Le.width=Le.width||(lt.width>>Ee)-bt,Le.height=Le.height||(lt.height>>Ee)-Yt,Et(lt.type===Le.type&&lt.format===Le.format&&lt.internalformat===Le.internalformat,"incompatible format for texture.subimage"),Et(bt>=0&&Yt>=0&&bt+Le.width<=lt.width&&Yt+Le.height<=lt.height,"texture.subimage write out of bounds"),Et(lt.mipmask&1<<Ee,"missing mipmap data"),Et(Le.data||Le.element||Le.needsCopy,"missing image data"),$s(lt),pn(Le,xc+Vt,bt,Yt,Ee),Yi(),ei(Le),Nt}function he(Vt){var Zt=Vt|0;if(Zt!==lt.width){Nt.width=lt.width=Zt,Nt.height=lt.height=Zt,$s(lt);for(var te=0;te<6;++te)for(var Ot=0;lt.mipmask>>Ot;++Ot)j.texImage2D(xc+te,Ot,lt.format,Zt>>Ot,Zt>>Ot,0,lt.format,lt.type,null);return Yi(),ce.profile&&(lt.stats.size=Ol(lt.internalformat,lt.type,Nt.width,Nt.height,!1,!0)),Nt}}return Nt(Lt,xe,fe,Fr,ri,pa),Nt.subimage=pe,Nt.resize=he,Nt._reglType="textureCube",Nt._texture=lt,ce.profile&&(Nt.stats=lt.stats),Nt.destroy=function(){lt.decRef()},Nt}function Po(){for(var Lt=0;Lt<Js;++Lt)j.activeTexture(Yg+Lt),j.bindTexture(sl,null),Ko[Lt]=null;gt(vs).forEach(wn),_e.cubeCount=0,_e.textureCount=0}ce.profile&&(_e.getTotalTextureSize=function(){var Lt=0;return Object.keys(vs).forEach(function(xe){Lt+=vs[xe].stats.size}),Lt});function Ih(){for(var Lt=0;Lt<Js;++Lt){var xe=Ko[Lt];xe&&(xe.bindCount=0,xe.unit=-1,Ko[Lt]=null)}gt(vs).forEach(function(fe){fe.texture=j.createTexture(),j.bindTexture(fe.target,fe.texture);for(var Fr=0;Fr<32;++Fr)if(fe.mipmask&1<<Fr)if(fe.target===sl)j.texImage2D(sl,Fr,fe.internalformat,fe.width>>Fr,fe.height>>Fr,0,fe.internalformat,fe.type,null);else for(var ri=0;ri<6;++ri)j.texImage2D(xc+ri,Fr,fe.internalformat,fe.width>>Fr,fe.height>>Fr,0,fe.internalformat,fe.type,null);qo(fe.texInfo,fe.target)})}return{create2D:di,createCube:Ni,clear:Po,getTexture:function(Lt){return null},restore:Ih}}var Wn=36161,ru=32854,nu=32855,fs=36194,bf=33189,Sh=36168,Su=34041,ks=35907,gp=34836,sn=34842,qr=34843,Pl=[];Pl[ru]=2,Pl[nu]=2,Pl[fs]=2,Pl[bf]=2,Pl[Sh]=1,Pl[Su]=4,Pl[ks]=4,Pl[gp]=16,Pl[sn]=8,Pl[qr]=6;function zs(j,_t,Bt){return Pl[j]*_t*Bt}var Zu=function(j,_t,Bt,ge,Ue){var _e={rgba4:ru,rgb565:fs,"rgb5 a1":nu,depth:bf,stencil:Sh,"depth stencil":Su};_t.ext_srgb&&(_e.srgba=ks),_t.ext_color_buffer_half_float&&(_e.rgba16f=sn,_e.rgb16f=qr),_t.webgl_color_buffer_float&&(_e.rgba32f=gp);var ce=[];Object.keys(_e).forEach(function(Qe){var dr=_e[Qe];ce[dr]=Qe});var ir=0,Ke={};function vr(Qe){this.id=ir++,this.refCount=1,this.renderbuffer=Qe,this.format=ru,this.width=0,this.height=0,Ue.profile&&(this.stats={size:0})}vr.prototype.decRef=function(){--this.refCount<=0&&sr(this)};function sr(Qe){var dr=Qe.renderbuffer;Et(dr,"must not double destroy renderbuffer"),j.bindRenderbuffer(Wn,null),j.deleteRenderbuffer(dr),Qe.renderbuffer=null,Qe.refCount=0,delete Ke[Qe.id],ge.renderbufferCount--}function fr(Qe,dr){var ae=new vr(j.createRenderbuffer());Ke[ae.id]=ae,ge.renderbufferCount++;function Te(Sr,Xe){var Lr=0,tr=0,Ar=ru;if(typeof Sr=="object"&&Sr){var je=Sr;if("shape"in je){var Er=je.shape;Et(Array.isArray(Er)&&Er.length>=2,"invalid renderbuffer shape"),Lr=Er[0]|0,tr=Er[1]|0}else"radius"in je&&(Lr=tr=je.radius|0),"width"in je&&(Lr=je.width|0),"height"in je&&(tr=je.height|0);"format"in je&&(Et.parameter(je.format,_e,"invalid renderbuffer format"),Ar=_e[je.format])}else typeof Sr=="number"?(Lr=Sr|0,typeof Xe=="number"?tr=Xe|0:tr=Lr):Sr?Et.raise("invalid arguments to renderbuffer constructor"):Lr=tr=1;if(Et(Lr>0&&tr>0&&Lr<=Bt.maxRenderbufferSize&&tr<=Bt.maxRenderbufferSize,"invalid renderbuffer size"),!(Lr===ae.width&&tr===ae.height&&Ar===ae.format))return Te.width=ae.width=Lr,Te.height=ae.height=tr,ae.format=Ar,j.bindRenderbuffer(Wn,ae.renderbuffer),j.renderbufferStorage(Wn,Ar,Lr,tr),Et(j.getError()===0,"invalid render buffer format"),Ue.profile&&(ae.stats.size=zs(ae.format,ae.width,ae.height)),Te.format=ce[ae.format],Te}function ar(Sr,Xe){var Lr=Sr|0,tr=Xe|0||Lr;return Lr===ae.width&&tr===ae.height||(Et(Lr>0&&tr>0&&Lr<=Bt.maxRenderbufferSize&&tr<=Bt.maxRenderbufferSize,"invalid renderbuffer size"),Te.width=ae.width=Lr,Te.height=ae.height=tr,j.bindRenderbuffer(Wn,ae.renderbuffer),j.renderbufferStorage(Wn,ae.format,Lr,tr),Et(j.getError()===0,"invalid render buffer format"),Ue.profile&&(ae.stats.size=zs(ae.format,ae.width,ae.height))),Te}return Te(Qe,dr),Te.resize=ar,Te._reglType="renderbuffer",Te._renderbuffer=ae,Ue.profile&&(Te.stats=ae.stats),Te.destroy=function(){ae.decRef()},Te}Ue.profile&&(ge.getTotalRenderbufferSize=function(){var Qe=0;return Object.keys(Ke).forEach(function(dr){Qe+=Ke[dr].stats.size}),Qe});function yr(){gt(Ke).forEach(function(Qe){Qe.renderbuffer=j.createRenderbuffer(),j.bindRenderbuffer(Wn,Qe.renderbuffer),j.renderbufferStorage(Wn,Qe.format,Qe.width,Qe.height)}),j.bindRenderbuffer(Wn,null)}return{create:fr,clear:function(){gt(Ke).forEach(sr)},restore:yr}},Wa=36160,Tu=36161,Th=3553,md=34069,ji=36064,Xo=36096,Q0=36128,Ef=33306,tm=36053,Ah=36054,Dl=36055,mp=36057,Cc=36061,em=36193,yp=5121,Lv=5126,rm=6407,yd=6408,_d=6402,J0=[rm,yd],Sc=[];Sc[yd]=4,Sc[rm]=3;var qu=[];qu[yp]=1,qu[Lv]=4,qu[em]=2;var nm=32854,wf=32855,Au=36194,ty=33189,Ov=36168,im=34041,am=35907,y=34836,b=34842,_=34843,C=[nm,wf,Au,am,b,_,y],O={};O[tm]="complete",O[Ah]="incomplete attachment",O[mp]="incomplete dimensions",O[Dl]="incomplete, missing attachment",O[Cc]="unsupported";function F(j,_t,Bt,ge,Ue,_e){var ce={cur:null,next:null,dirty:!1,setFBO:null},ir=["rgba"],Ke=["rgba4","rgb565","rgb5 a1"];_t.ext_srgb&&Ke.push("srgba"),_t.ext_color_buffer_half_float&&Ke.push("rgba16f","rgb16f"),_t.webgl_color_buffer_float&&Ke.push("rgba32f");var vr=["uint8"];_t.oes_texture_half_float&&vr.push("half float","float16"),_t.oes_texture_float&&vr.push("float","float32");function sr(wr,rr,$e){this.target=wr,this.texture=rr,this.renderbuffer=$e;var pn=0,li=0;rr?(pn=rr.width,li=rr.height):$e&&(pn=$e.width,li=$e.height),this.width=pn,this.height=li}function fr(wr){wr&&(wr.texture&&wr.texture._texture.decRef(),wr.renderbuffer&&wr.renderbuffer._renderbuffer.decRef())}function yr(wr,rr,$e){if(wr)if(wr.texture){var pn=wr.texture._texture,li=Math.max(1,pn.width),Or=Math.max(1,pn.height);Et(li===rr&&Or===$e,"inconsistent width/height for supplied texture"),pn.refCount+=1}else{var ei=wr.renderbuffer._renderbuffer;Et(ei.width===rr&&ei.height===$e,"inconsistent width/height for renderbuffer"),ei.refCount+=1}}function Qe(wr,rr){rr&&(rr.texture?j.framebufferTexture2D(Wa,wr,rr.target,rr.texture._texture.texture,0):j.framebufferRenderbuffer(Wa,wr,Tu,rr.renderbuffer._renderbuffer.renderbuffer))}function dr(wr){var rr=Th,$e=null,pn=null,li=wr;typeof wr=="object"&&(li=wr.data,"target"in wr&&(rr=wr.target|0)),Et.type(li,"function","invalid attachment data");var Or=li._reglType;return Or==="texture2d"?($e=li,Et(rr===Th)):Or==="textureCube"?($e=li,Et(rr>=md&&rr<md+6,"invalid cube map target")):Or==="renderbuffer"?(pn=li,rr=Tu):Et.raise("invalid regl object for attachment"),new sr(rr,$e,pn)}function ae(wr,rr,$e,pn,li){if($e){var Or=ge.create2D({width:wr,height:rr,format:pn,type:li});return Or._texture.refCount=0,new sr(Th,Or,null)}else{var ei=Ue.create({width:wr,height:rr,format:pn});return ei._renderbuffer.refCount=0,new sr(Tu,null,ei)}}function Te(wr){return wr&&(wr.texture||wr.renderbuffer)}function ar(wr,rr,$e){wr&&(wr.texture?wr.texture.resize(rr,$e):wr.renderbuffer&&wr.renderbuffer.resize(rr,$e),wr.width=rr,wr.height=$e)}var Sr=0,Xe={};function Lr(){this.id=Sr++,Xe[this.id]=this,this.framebuffer=j.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function tr(wr){wr.colorAttachments.forEach(fr),fr(wr.depthAttachment),fr(wr.stencilAttachment),fr(wr.depthStencilAttachment)}function Ar(wr){var rr=wr.framebuffer;Et(rr,"must not double destroy framebuffer"),j.deleteFramebuffer(rr),wr.framebuffer=null,_e.framebufferCount--,delete Xe[wr.id]}function je(wr){var rr;j.bindFramebuffer(Wa,wr.framebuffer);var $e=wr.colorAttachments;for(rr=0;rr<$e.length;++rr)Qe(ji+rr,$e[rr]);for(rr=$e.length;rr<Bt.maxColorAttachments;++rr)j.framebufferTexture2D(Wa,ji+rr,Th,null,0);j.framebufferTexture2D(Wa,Ef,Th,null,0),j.framebufferTexture2D(Wa,Xo,Th,null,0),j.framebufferTexture2D(Wa,Q0,Th,null,0),Qe(Xo,wr.depthAttachment),Qe(Q0,wr.stencilAttachment),Qe(Ef,wr.depthStencilAttachment);var pn=j.checkFramebufferStatus(Wa);!j.isContextLost()&&pn!==tm&&Et.raise("framebuffer configuration not supported, status = "+O[pn]),j.bindFramebuffer(Wa,ce.next?ce.next.framebuffer:null),ce.cur=ce.next,j.getError()}function Er(wr,rr){var $e=new Lr;_e.framebufferCount++;function pn(Or,ei){var Bn;Et(ce.next!==$e,"can not update framebuffer which is currently in use");var An=0,Vi=0,Lo=!0,As=!0,gi=null,Oo=!0,La="rgba",Zo="uint8",qo=1,ho=null,vs=null,Js=null,Ko=!1;if(typeof Or=="number")An=Or|0,Vi=ei|0||An;else if(!Or)An=Vi=1;else{Et.type(Or,"object","invalid arguments for framebuffer");var Jn=Or;if("shape"in Jn){var $s=Jn.shape;Et(Array.isArray($s)&&$s.length>=2,"invalid shape for framebuffer"),An=$s[0],Vi=$s[1]}else"radius"in Jn&&(An=Vi=Jn.radius),"width"in Jn&&(An=Jn.width),"height"in Jn&&(Vi=Jn.height);("color"in Jn||"colors"in Jn)&&(gi=Jn.color||Jn.colors,Array.isArray(gi)&&Et(gi.length===1||_t.webgl_draw_buffers,"multiple render targets not supported")),gi||("colorCount"in Jn&&(qo=Jn.colorCount|0,Et(qo>0,"invalid color buffer count")),"colorTexture"in Jn&&(Oo=!!Jn.colorTexture,La="rgba4"),"colorType"in Jn&&(Zo=Jn.colorType,Oo?(Et(_t.oes_texture_float||!(Zo==="float"||Zo==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),Et(_t.oes_texture_half_float||!(Zo==="half float"||Zo==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Zo==="half float"||Zo==="float16"?(Et(_t.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),La="rgba16f"):(Zo==="float"||Zo==="float32")&&(Et(_t.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),La="rgba32f"),Et.oneOf(Zo,vr,"invalid color type")),"colorFormat"in Jn&&(La=Jn.colorFormat,ir.indexOf(La)>=0?Oo=!0:Ke.indexOf(La)>=0?Oo=!1:Oo?Et.oneOf(Jn.colorFormat,ir,"invalid color format for texture"):Et.oneOf(Jn.colorFormat,Ke,"invalid color format for renderbuffer"))),("depthTexture"in Jn||"depthStencilTexture"in Jn)&&(Ko=!!(Jn.depthTexture||Jn.depthStencilTexture),Et(!Ko||_t.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Jn&&(typeof Jn.depth=="boolean"?Lo=Jn.depth:(ho=Jn.depth,As=!1)),"stencil"in Jn&&(typeof Jn.stencil=="boolean"?As=Jn.stencil:(vs=Jn.stencil,Lo=!1)),"depthStencil"in Jn&&(typeof Jn.depthStencil=="boolean"?Lo=As=Jn.depthStencil:(Js=Jn.depthStencil,Lo=!1,As=!1))}var Yi=null,wn=null,di=null,Ni=null;if(Array.isArray(gi))Yi=gi.map(dr);else if(gi)Yi=[dr(gi)];else for(Yi=new Array(qo),Bn=0;Bn<qo;++Bn)Yi[Bn]=ae(An,Vi,Oo,La,Zo);Et(_t.webgl_draw_buffers||Yi.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),Et(Yi.length<=Bt.maxColorAttachments,"too many color attachments, not supported"),An=An||Yi[0].width,Vi=Vi||Yi[0].height,ho?wn=dr(ho):Lo&&!As&&(wn=ae(An,Vi,Ko,"depth","uint32")),vs?di=dr(vs):As&&!Lo&&(di=ae(An,Vi,!1,"stencil","uint8")),Js?Ni=dr(Js):!ho&&!vs&&As&&Lo&&(Ni=ae(An,Vi,Ko,"depth stencil","depth stencil")),Et(!!ho+!!vs+!!Js<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Po=null;for(Bn=0;Bn<Yi.length;++Bn)if(yr(Yi[Bn],An,Vi),Et(!Yi[Bn]||Yi[Bn].texture&&J0.indexOf(Yi[Bn].texture._texture.format)>=0||Yi[Bn].renderbuffer&&C.indexOf(Yi[Bn].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Bn+" is invalid"),Yi[Bn]&&Yi[Bn].texture){var Ih=Sc[Yi[Bn].texture._texture.format]*qu[Yi[Bn].texture._texture.type];Po===null?Po=Ih:Et(Po===Ih,"all color attachments much have the same number of bits per pixel.")}return yr(wn,An,Vi),Et(!wn||wn.texture&&wn.texture._texture.format===_d||wn.renderbuffer&&wn.renderbuffer._renderbuffer.format===ty,"invalid depth attachment for framebuffer object"),yr(di,An,Vi),Et(!di||di.renderbuffer&&di.renderbuffer._renderbuffer.format===Ov,"invalid stencil attachment for framebuffer object"),yr(Ni,An,Vi),Et(!Ni||Ni.texture&&Ni.texture._texture.format===im||Ni.renderbuffer&&Ni.renderbuffer._renderbuffer.format===im,"invalid depth-stencil attachment for framebuffer object"),tr($e),$e.width=An,$e.height=Vi,$e.colorAttachments=Yi,$e.depthAttachment=wn,$e.stencilAttachment=di,$e.depthStencilAttachment=Ni,pn.color=Yi.map(Te),pn.depth=Te(wn),pn.stencil=Te(di),pn.depthStencil=Te(Ni),pn.width=$e.width,pn.height=$e.height,je($e),pn}function li(Or,ei){Et(ce.next!==$e,"can not resize a framebuffer which is currently in use");var Bn=Math.max(Or|0,1),An=Math.max(ei|0||Bn,1);if(Bn===$e.width&&An===$e.height)return pn;for(var Vi=$e.colorAttachments,Lo=0;Lo<Vi.length;++Lo)ar(Vi[Lo],Bn,An);return ar($e.depthAttachment,Bn,An),ar($e.stencilAttachment,Bn,An),ar($e.depthStencilAttachment,Bn,An),$e.width=pn.width=Bn,$e.height=pn.height=An,je($e),pn}return pn(wr,rr),n(pn,{resize:li,_reglType:"framebuffer",_framebuffer:$e,destroy:function(){Ar($e),tr($e)},use:function(Or){ce.setFBO({framebuffer:pn},Or)}})}function dn(wr){var rr=Array(6);function $e(li){var Or;Et(rr.indexOf(ce.next)<0,"can not update framebuffer which is currently in use");var ei={color:null},Bn=0,An=null,Vi="rgba",Lo="uint8",As=1;if(typeof li=="number")Bn=li|0;else if(!li)Bn=1;else{Et.type(li,"object","invalid arguments for framebuffer");var gi=li;if("shape"in gi){var Oo=gi.shape;Et(Array.isArray(Oo)&&Oo.length>=2,"invalid shape for framebuffer"),Et(Oo[0]===Oo[1],"cube framebuffer must be square"),Bn=Oo[0]}else"radius"in gi&&(Bn=gi.radius|0),"width"in gi?(Bn=gi.width|0,"height"in gi&&Et(gi.height===Bn,"must be square")):"height"in gi&&(Bn=gi.height|0);("color"in gi||"colors"in gi)&&(An=gi.color||gi.colors,Array.isArray(An)&&Et(An.length===1||_t.webgl_draw_buffers,"multiple render targets not supported")),An||("colorCount"in gi&&(As=gi.colorCount|0,Et(As>0,"invalid color buffer count")),"colorType"in gi&&(Et.oneOf(gi.colorType,vr,"invalid color type"),Lo=gi.colorType),"colorFormat"in gi&&(Vi=gi.colorFormat,Et.oneOf(gi.colorFormat,ir,"invalid color format for texture"))),"depth"in gi&&(ei.depth=gi.depth),"stencil"in gi&&(ei.stencil=gi.stencil),"depthStencil"in gi&&(ei.depthStencil=gi.depthStencil)}var La;if(An)if(Array.isArray(An))for(La=[],Or=0;Or<An.length;++Or)La[Or]=An[Or];else La=[An];else{La=Array(As);var Zo={radius:Bn,format:Vi,type:Lo};for(Or=0;Or<As;++Or)La[Or]=ge.createCube(Zo)}for(ei.color=Array(La.length),Or=0;Or<La.length;++Or){var qo=La[Or];Et(typeof qo=="function"&&qo._reglType==="textureCube","invalid cube map"),Bn=Bn||qo.width,Et(qo.width===Bn&&qo.height===Bn,"invalid cube map shape"),ei.color[Or]={target:md,data:La[Or]}}for(Or=0;Or<6;++Or){for(var ho=0;ho<La.length;++ho)ei.color[ho].target=md+Or;Or>0&&(ei.depth=rr[0].depth,ei.stencil=rr[0].stencil,ei.depthStencil=rr[0].depthStencil),rr[Or]?rr[Or](ei):rr[Or]=Er(ei)}return n($e,{width:Bn,height:Bn,color:La})}function pn(li){var Or,ei=li|0;if(Et(ei>0&&ei<=Bt.maxCubeMapSize,"invalid radius for cube fbo"),ei===$e.width)return $e;var Bn=$e.color;for(Or=0;Or<Bn.length;++Or)Bn[Or].resize(ei);for(Or=0;Or<6;++Or)rr[Or].resize(ei);return $e.width=$e.height=ei,$e}return $e(wr),n($e,{faces:rr,resize:pn,_reglType:"framebufferCube",destroy:function(){rr.forEach(function(li){li.destroy()})}})}function kn(){ce.cur=null,ce.next=null,ce.dirty=!0,gt(Xe).forEach(function(wr){wr.framebuffer=j.createFramebuffer(),je(wr)})}return n(ce,{getFramebuffer:function(wr){if(typeof wr=="function"&&wr._reglType==="framebuffer"){var rr=wr._framebuffer;if(rr instanceof Lr)return rr}return null},create:Er,createCube:dn,clear:function(){gt(Xe).forEach(Ar)},restore:kn})}var B=5126,H=34962;function Y(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=B,this.offset=0,this.stride=0,this.divisor=0}function rt(j,_t,Bt,ge,Ue){for(var _e=Bt.maxAttributes,ce=new Array(_e),ir=0;ir<_e;++ir)ce[ir]=new Y;var Ke=0,vr={},sr={Record:Y,scope:{},state:ce,currentVAO:null,targetVAO:null,restore:yr()?Xe:function(){},createVAO:Lr,getVAO:dr,destroyBuffer:fr,setVAO:yr()?ae:Te,clear:yr()?ar:function(){}};function fr(tr){for(var Ar=0;Ar<ce.length;++Ar){var je=ce[Ar];je.buffer===tr&&(j.disableVertexAttribArray(Ar),je.buffer=null)}}function yr(){return _t.oes_vertex_array_object}function Qe(){return _t.angle_instanced_arrays}function dr(tr){return typeof tr=="function"&&tr._vao?tr._vao:null}function ae(tr){if(tr!==sr.currentVAO){var Ar=yr();tr?Ar.bindVertexArrayOES(tr.vao):Ar.bindVertexArrayOES(null),sr.currentVAO=tr}}function Te(tr){if(tr!==sr.currentVAO){if(tr)tr.bindAttrs();else for(var Ar=Qe(),je=0;je<ce.length;++je){var Er=ce[je];Er.buffer?(j.enableVertexAttribArray(je),j.vertexAttribPointer(je,Er.size,Er.type,Er.normalized,Er.stride,Er.offfset),Ar&&Ar.vertexAttribDivisorANGLE(je,Er.divisor)):(j.disableVertexAttribArray(je),j.vertexAttrib4f(je,Er.x,Er.y,Er.z,Er.w))}sr.currentVAO=tr}}function ar(){gt(vr).forEach(function(tr){tr.destroy()})}function Sr(){this.id=++Ke,this.attributes=[];var tr=yr();tr?this.vao=tr.createVertexArrayOES():this.vao=null,vr[this.id]=this,this.buffers=[]}Sr.prototype.bindAttrs=function(){for(var tr=Qe(),Ar=this.attributes,je=0;je<Ar.length;++je){var Er=Ar[je];Er.buffer?(j.enableVertexAttribArray(je),j.bindBuffer(H,Er.buffer.buffer),j.vertexAttribPointer(je,Er.size,Er.type,Er.normalized,Er.stride,Er.offset),tr&&tr.vertexAttribDivisorANGLE(je,Er.divisor)):(j.disableVertexAttribArray(je),j.vertexAttrib4f(je,Er.x,Er.y,Er.z,Er.w))}for(var dn=Ar.length;dn<_e;++dn)j.disableVertexAttribArray(dn)},Sr.prototype.refresh=function(){var tr=yr();tr&&(tr.bindVertexArrayOES(this.vao),this.bindAttrs(),sr.currentVAO=this)},Sr.prototype.destroy=function(){if(this.vao){var tr=yr();this===sr.currentVAO&&(sr.currentVAO=null,tr.bindVertexArrayOES(null)),tr.deleteVertexArrayOES(this.vao),this.vao=null}vr[this.id]&&(delete vr[this.id],ge.vaoCount-=1)};function Xe(){var tr=yr();tr&&gt(vr).forEach(function(Ar){Ar.refresh()})}function Lr(tr){var Ar=new Sr;ge.vaoCount+=1;function je(Er){Et(Array.isArray(Er),"arguments to vertex array constructor must be an array"),Et(Er.length<_e,"too many attributes"),Et(Er.length>0,"must specify at least one attribute");for(var dn=0;dn<Ar.buffers.length;++dn)Ar.buffers[dn].destroy();Ar.buffers.length=0;var kn=Ar.attributes;kn.length=Er.length;for(var wr=0;wr<Er.length;++wr){var rr=Er[wr],$e=kn[wr]=new Y;if(Array.isArray(rr)||r(rr)||st(rr)){var pn=Ue.create(rr,H,!1,!0);$e.buffer=Ue.getBuffer(pn),$e.size=$e.buffer.dimension|0,$e.normalized=!1,$e.type=$e.buffer.dtype,$e.offset=0,$e.stride=0,$e.divisor=0,$e.state=1,Ar.buffers.push(pn)}else Ue.getBuffer(rr)?($e.buffer=Ue.getBuffer(rr),$e.size=$e.buffer.dimension|0,$e.normalized=!1,$e.type=$e.buffer.dtype,$e.offset=0,$e.stride=0,$e.divisor=0,$e.state=1):Ue.getBuffer(rr.buffer)?($e.buffer=Ue.getBuffer(rr.buffer),$e.size=(+rr.size||$e.buffer.dimension)|0,$e.normalized=!!rr.normalized||!1,"type"in rr?(Et.parameter(rr.type,Cs,"invalid buffer type"),$e.type=Cs[rr.type]):$e.type=$e.buffer.dtype,$e.offset=(rr.offset||0)|0,$e.stride=(rr.stride||0)|0,$e.divisor=(rr.divisor||0)|0,$e.state=1,Et($e.size>=1&&$e.size<=4,"size must be between 1 and 4"),Et($e.offset>=0,"invalid offset"),Et($e.stride>=0&&$e.stride<=255,"stride must be between 0 and 255"),Et($e.divisor>=0,"divisor must be positive"),Et(!$e.divisor||!!_t.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in rr?(Et(wr>0,"first attribute must not be a constant"),$e.x=+rr.x||0,$e.y=+rr.y||0,$e.z=+rr.z||0,$e.w=+rr.w||0,$e.state=2):Et(!1,"invalid attribute spec for location "+wr)}return Ar.refresh(),je}return je.destroy=function(){Ar.destroy()},je._vao=Ar,je._reglType="vao",je(tr)}return sr}var ct=35632,dt=35633,pt=35718,Pt=35721;function Mt(j,_t,Bt,ge){var Ue={},_e={};function ce(ae,Te,ar,Sr){this.name=ae,this.id=Te,this.location=ar,this.info=Sr}function ir(ae,Te){for(var ar=0;ar<ae.length;++ar)if(ae[ar].id===Te.id){ae[ar].location=Te.location;return}ae.push(Te)}function Ke(ae,Te,ar){var Sr=ae===ct?Ue:_e,Xe=Sr[Te];if(!Xe){var Lr=_t.str(Te);Xe=j.createShader(ae),j.shaderSource(Xe,Lr),j.compileShader(Xe),Et.shaderError(j,Xe,Lr,ae,ar),Sr[Te]=Xe}return Xe}var vr={},sr=[],fr=0;function yr(ae,Te){this.id=fr++,this.fragId=ae,this.vertId=Te,this.program=null,this.uniforms=[],this.attributes=[],ge.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Qe(ae,Te,ar){var Sr,Xe,Lr=Ke(ct,ae.fragId),tr=Ke(dt,ae.vertId),Ar=ae.program=j.createProgram();if(j.attachShader(Ar,Lr),j.attachShader(Ar,tr),ar)for(Sr=0;Sr<ar.length;++Sr){var je=ar[Sr];j.bindAttribLocation(Ar,je[0],je[1])}j.linkProgram(Ar),Et.linkError(j,Ar,_t.str(ae.fragId),_t.str(ae.vertId),Te);var Er=j.getProgramParameter(Ar,pt);ge.profile&&(ae.stats.uniformsCount=Er);var dn=ae.uniforms;for(Sr=0;Sr<Er;++Sr)if(Xe=j.getActiveUniform(Ar,Sr),Xe)if(Xe.size>1)for(var kn=0;kn<Xe.size;++kn){var wr=Xe.name.replace("[0]","["+kn+"]");ir(dn,new ce(wr,_t.id(wr),j.getUniformLocation(Ar,wr),Xe))}else ir(dn,new ce(Xe.name,_t.id(Xe.name),j.getUniformLocation(Ar,Xe.name),Xe));var rr=j.getProgramParameter(Ar,Pt);ge.profile&&(ae.stats.attributesCount=rr);var $e=ae.attributes;for(Sr=0;Sr<rr;++Sr)Xe=j.getActiveAttrib(Ar,Sr),Xe&&ir($e,new ce(Xe.name,_t.id(Xe.name),j.getAttribLocation(Ar,Xe.name),Xe))}ge.profile&&(Bt.getMaxUniformsCount=function(){var ae=0;return sr.forEach(function(Te){Te.stats.uniformsCount>ae&&(ae=Te.stats.uniformsCount)}),ae},Bt.getMaxAttributesCount=function(){var ae=0;return sr.forEach(function(Te){Te.stats.attributesCount>ae&&(ae=Te.stats.attributesCount)}),ae});function dr(){Ue={},_e={};for(var ae=0;ae<sr.length;++ae)Qe(sr[ae],null,sr[ae].attributes.map(function(Te){return[Te.location,Te.name]}))}return{clear:function(){var ae=j.deleteShader.bind(j);gt(Ue).forEach(ae),Ue={},gt(_e).forEach(ae),_e={},sr.forEach(function(Te){j.deleteProgram(Te.program)}),sr.length=0,vr={},Bt.shaderCount=0},program:function(ae,Te,ar,Sr){Et.command(ae>=0,"missing vertex shader",ar),Et.command(Te>=0,"missing fragment shader",ar);var Xe=vr[Te];Xe||(Xe=vr[Te]={});var Lr=Xe[ae];if(Lr&&!Sr)return Lr;var tr=new yr(Te,ae);return Bt.shaderCount++,Qe(tr,ar,Sr),Lr||(Xe[ae]=tr),sr.push(tr),tr},restore:dr,shader:Ke,frag:-1,vert:-1}}var Ht=6408,St=5121,Ut=3333,Kt=5126;function le(j,_t,Bt,ge,Ue,_e,ce){function ir(sr){var fr;_t.next===null?(Et(Ue.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),fr=St):(Et(_t.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),fr=_t.next.colorAttachments[0].texture._texture.type,_e.oes_texture_float?(Et(fr===St||fr===Kt,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),fr===Kt&&Et(ce.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):Et(fr===St,"Reading from a framebuffer is only allowed for the type 'uint8'"));var yr=0,Qe=0,dr=ge.framebufferWidth,ae=ge.framebufferHeight,Te=null;r(sr)?Te=sr:sr&&(Et.type(sr,"object","invalid arguments to regl.read()"),yr=sr.x|0,Qe=sr.y|0,Et(yr>=0&&yr<ge.framebufferWidth,"invalid x offset for regl.read"),Et(Qe>=0&&Qe<ge.framebufferHeight,"invalid y offset for regl.read"),dr=(sr.width||ge.framebufferWidth-yr)|0,ae=(sr.height||ge.framebufferHeight-Qe)|0,Te=sr.data||null),Te&&(fr===St?Et(Te instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):fr===Kt&&Et(Te instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),Et(dr>0&&dr+yr<=ge.framebufferWidth,"invalid width for read pixels"),Et(ae>0&&ae+Qe<=ge.framebufferHeight,"invalid height for read pixels"),Bt();var ar=dr*ae*4;return Te||(fr===St?Te=new Uint8Array(ar):fr===Kt&&(Te=Te||new Float32Array(ar))),Et.isTypedArray(Te,"data buffer for regl.read() must be a typedarray"),Et(Te.byteLength>=ar,"data buffer for regl.read() too small"),j.pixelStorei(Ut,4),j.readPixels(yr,Qe,dr,ae,Ht,fr,Te),Te}function Ke(sr){var fr;return _t.setFBO({framebuffer:sr.framebuffer},function(){fr=ir(sr)}),fr}function vr(sr){return!sr||!("framebuffer"in sr)?ir(sr):Ke(sr)}return vr}function we(j){return Array.prototype.slice.call(j)}function ve(j){return we(j).join("")}function Me(){var j=0,_t=[],Bt=[];function ge(fr){for(var yr=0;yr<Bt.length;++yr)if(Bt[yr]===fr)return _t[yr];var Qe="g"+j++;return _t.push(Qe),Bt.push(fr),Qe}function Ue(){var fr=[];function yr(){fr.push.apply(fr,we(arguments))}var Qe=[];function dr(){var ae="v"+j++;return Qe.push(ae),arguments.length>0&&(fr.push(ae,"="),fr.push.apply(fr,we(arguments)),fr.push(";")),ae}return n(yr,{def:dr,toString:function(){return ve([Qe.length>0?"var "+Qe.join(",")+";":"",ve(fr)])}})}function _e(){var fr=Ue(),yr=Ue(),Qe=fr.toString,dr=yr.toString;function ae(Te,ar){yr(Te,ar,"=",fr.def(Te,ar),";")}return n(function(){fr.apply(fr,we(arguments))},{def:fr.def,entry:fr,exit:yr,save:ae,set:function(Te,ar,Sr){ae(Te,ar),fr(Te,ar,"=",Sr,";")},toString:function(){return Qe()+dr()}})}function ce(){var fr=ve(arguments),yr=_e(),Qe=_e(),dr=yr.toString,ae=Qe.toString;return n(yr,{then:function(){return yr.apply(yr,we(arguments)),this},else:function(){return Qe.apply(Qe,we(arguments)),this},toString:function(){var Te=ae();return Te&&(Te="else{"+Te+"}"),ve(["if(",fr,"){",dr(),"}",Te])}})}var ir=Ue(),Ke={};function vr(fr,yr){var Qe=[];function dr(){var Xe="a"+Qe.length;return Qe.push(Xe),Xe}yr=yr||0;for(var ae=0;ae<yr;++ae)dr();var Te=_e(),ar=Te.toString,Sr=Ke[fr]=n(Te,{arg:dr,toString:function(){return ve(["function(",Qe.join(),"){",ar(),"}"])}});return Sr}function sr(){var fr=['"use strict";',ir,"return {"];Object.keys(Ke).forEach(function(dr){fr.push('"',dr,'":',Ke[dr].toString(),",")}),fr.push("}");var yr=ve(fr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Qe=Function.apply(null,_t.concat(yr));return Qe.apply(null,Bt)}return{global:ir,link:ge,block:Ue,proc:vr,scope:_e,cond:ce,compile:sr}}var Ge="xyzw".split(""),hr=5121,or=1,Ir=2,ln=0,fn=1,hn=2,Li=3,Ur=4,Pn="dither",jn="blend.enable",Ln="blend.color",Sn="blend.equation",Vn="blend.func",Tn="depth.enable",En="depth.func",Ro="depth.range",Za="depth.mask",ds="colorMask",jo="cull.enable",Xa="cull.face",qa="frontFace",qs="lineWidth",Us="polygonOffset.enable",Tc="polygonOffset.offset",Ks="sample.alpha",Mu="sample.enable",Fl="sample.coverage",_p="stencil.enable",xd="stencil.mask",Ac="stencil.func",Cf="stencil.opFront",Mh="stencil.opBack",Ku="scissor.enable",Sf="scissor.box",Ts="viewport",uo="profile",ul="framebuffer",Ru="vert",Qu="frag",xi="elements",ps="primitive",Io="count",Mc="offset",om="instances",Tf="vao",ey="Width",bd="Height",Ed=ul+ey,Ju=ul+bd,sm=Ts+ey,fE=Ts+bd,xp="drawingBuffer",cl=xp+ey,U2=xp+bd,$2=[Vn,Sn,Ac,Cf,Mh,Fl,Ts,Sf,Tc],lm=34962,LL=34963,OL=35632,PL=35633,s1=3553,DL=34067,l1=2884,H2=3042,bp=3024,ry=2960,FL=2929,BL=3089,NL=32823,kL=32926,zL=32928,dE=5126,u1=35664,um=35665,c1=35666,Ep=5124,h1=35667,co=35668,Pv=35669,f1=35670,Dv=35671,Fv=35672,wp=35673,cm=35674,hm=35675,wd=35676,Bv=35678,Nv=35680,V2=4,Cd=1028,kv=1029,d1=2304,pE=2305,vE=32775,gE=32776,Rh=519,Cp=7680,G2=0,W2=1,X2=32774,j2=513,zv=36160,UL=36064,Af={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},mE=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Uv={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Sp={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Y2={frag:OL,vert:PL},Tp={cw:d1,ccw:pE};function p1(j){return Array.isArray(j)||r(j)||st(j)}function v1(j){return j.sort(function(_t,Bt){return _t===Ts?-1:Bt===Ts?1:_t<Bt?-1:1})}function hl(j,_t,Bt,ge){this.thisDep=j,this.contextDep=_t,this.propDep=Bt,this.append=ge}function Qs(j){return j&&!(j.thisDep||j.contextDep||j.propDep)}function Yo(j){return new hl(!1,!1,!1,j)}function Iu(j,_t){var Bt=j.type;if(Bt===ln){var ge=j.data.length;return new hl(!0,ge>=1,ge>=2,_t)}else if(Bt===Ur){var Ue=j.data;return new hl(Ue.thisDep,Ue.contextDep,Ue.propDep,_t)}else return new hl(Bt===Li,Bt===hn,Bt===fn,_t)}var Z2=new hl(!1,!1,!1,function(){});function ny(j,_t,Bt,ge,Ue,_e,ce,ir,Ke,vr,sr,fr,yr,Qe,dr){var ae=vr.Record,Te={add:32774,subtract:32778,"reverse subtract":32779};Bt.ext_blend_minmax&&(Te.min=vE,Te.max=gE);var ar=Bt.angle_instanced_arrays,Sr=Bt.webgl_draw_buffers,Xe={dirty:!0,profile:dr.profile},Lr={},tr=[],Ar={},je={};function Er(lt){return lt.replace(".","_")}function dn(lt,Ct,Nt){var pe=Er(lt);tr.push(lt),Lr[pe]=Xe[pe]=!!Nt,Ar[pe]=Ct}function kn(lt,Ct,Nt){var pe=Er(lt);tr.push(lt),Array.isArray(Nt)?(Xe[pe]=Nt.slice(),Lr[pe]=Nt.slice()):Xe[pe]=Lr[pe]=Nt,je[pe]=Ct}dn(Pn,bp),dn(jn,H2),kn(Ln,"blendColor",[0,0,0,0]),kn(Sn,"blendEquationSeparate",[X2,X2]),kn(Vn,"blendFuncSeparate",[W2,G2,W2,G2]),dn(Tn,FL,!0),kn(En,"depthFunc",j2),kn(Ro,"depthRange",[0,1]),kn(Za,"depthMask",!0),kn(ds,ds,[!0,!0,!0,!0]),dn(jo,l1),kn(Xa,"cullFace",kv),kn(qa,qa,pE),kn(qs,qs,1),dn(Us,NL),kn(Tc,"polygonOffset",[0,0]),dn(Ks,kL),dn(Mu,zL),kn(Fl,"sampleCoverage",[1,!1]),dn(_p,ry),kn(xd,"stencilMask",-1),kn(Ac,"stencilFunc",[Rh,0,-1]),kn(Cf,"stencilOpSeparate",[Cd,Cp,Cp,Cp]),kn(Mh,"stencilOpSeparate",[kv,Cp,Cp,Cp]),dn(Ku,BL),kn(Sf,"scissor",[0,0,j.drawingBufferWidth,j.drawingBufferHeight]),kn(Ts,Ts,[0,0,j.drawingBufferWidth,j.drawingBufferHeight]);var wr={gl:j,context:yr,strings:_t,next:Lr,current:Xe,draw:fr,elements:_e,buffer:Ue,shader:sr,attributes:vr.state,vao:vr,uniforms:Ke,framebuffer:ir,extensions:Bt,timer:Qe,isBufferArgs:p1},rr={primTypes:_c,compareFuncs:Uv,blendFuncs:Af,blendEquations:Te,stencilOps:Sp,glTypes:Cs,orientationType:Tp};Et.optional(function(){wr.isArrayLike=lo}),Sr&&(rr.backBuffer=[kv],rr.drawBuffer=Hi(ge.maxDrawbuffers,function(lt){return lt===0?[0]:Hi(lt,function(Ct){return UL+Ct})}));var $e=0;function pn(){var lt=Me(),Ct=lt.link,Nt=lt.global;lt.id=$e++,lt.batchId="0";var pe=Ct(wr),he=lt.shared={props:"a0"};Object.keys(wr).forEach(function(Xt){he[Xt]=Nt.def(pe,".",Xt)}),Et.optional(function(){lt.CHECK=Ct(Et),lt.commandStr=Et.guessCommand(),lt.command=Ct(lt.commandStr),lt.assert=function(Xt,bt,Yt){Xt("if(!(",bt,"))",this.CHECK,".commandRaise(",Ct(Yt),",",this.command,");")},rr.invalidBlendCombinations=mE});var Vt=lt.next={},Zt=lt.current={};Object.keys(je).forEach(function(Xt){Array.isArray(Xe[Xt])&&(Vt[Xt]=Nt.def(he.next,".",Xt),Zt[Xt]=Nt.def(he.current,".",Xt))});var te=lt.constants={};Object.keys(rr).forEach(function(Xt){te[Xt]=Nt.def(JSON.stringify(rr[Xt]))}),lt.invoke=function(Xt,bt){switch(bt.type){case ln:var Yt=["this",he.context,he.props,lt.batchId];return Xt.def(Ct(bt.data),".call(",Yt.slice(0,Math.max(bt.data.length+1,4)),")");case fn:return Xt.def(he.props,bt.data);case hn:return Xt.def(he.context,bt.data);case Li:return Xt.def("this",bt.data);case Ur:return bt.data.append(lt,Xt),bt.data.ref}},lt.attribCache={};var Ot={};return lt.scopeAttrib=function(Xt){var bt=_t.id(Xt);if(bt in Ot)return Ot[bt];var Yt=vr.scope[bt];Yt||(Yt=vr.scope[bt]=new ae);var Ee=Ot[bt]=Ct(Yt);return Ee},lt}function li(lt){var Ct=lt.static,Nt=lt.dynamic,pe;if(uo in Ct){var he=!!Ct[uo];pe=Yo(function(Zt,te){return he}),pe.enable=he}else if(uo in Nt){var Vt=Nt[uo];pe=Iu(Vt,function(Zt,te){return Zt.invoke(te,Vt)})}return pe}function Or(lt,Ct){var Nt=lt.static,pe=lt.dynamic;if(ul in Nt){var he=Nt[ul];return he?(he=ir.getFramebuffer(he),Et.command(he,"invalid framebuffer object"),Yo(function(Zt,te){var Ot=Zt.link(he),Xt=Zt.shared;te.set(Xt.framebuffer,".next",Ot);var bt=Xt.context;return te.set(bt,"."+Ed,Ot+".width"),te.set(bt,"."+Ju,Ot+".height"),Ot})):Yo(function(Zt,te){var Ot=Zt.shared;te.set(Ot.framebuffer,".next","null");var Xt=Ot.context;return te.set(Xt,"."+Ed,Xt+"."+cl),te.set(Xt,"."+Ju,Xt+"."+U2),"null"})}else if(ul in pe){var Vt=pe[ul];return Iu(Vt,function(Zt,te){var Ot=Zt.invoke(te,Vt),Xt=Zt.shared,bt=Xt.framebuffer,Yt=te.def(bt,".getFramebuffer(",Ot,")");Et.optional(function(){Zt.assert(te,"!"+Ot+"||"+Yt,"invalid framebuffer object")}),te.set(bt,".next",Yt);var Ee=Xt.context;return te.set(Ee,"."+Ed,Yt+"?"+Yt+".width:"+Ee+"."+cl),te.set(Ee,"."+Ju,Yt+"?"+Yt+".height:"+Ee+"."+U2),Yt})}else return null}function ei(lt,Ct,Nt){var pe=lt.static,he=lt.dynamic;function Vt(Ot){if(Ot in pe){var Xt=pe[Ot];Et.commandType(Xt,"object","invalid "+Ot,Nt.commandStr);var bt=!0,Yt=Xt.x|0,Ee=Xt.y|0,Le,Ye;return"width"in Xt?(Le=Xt.width|0,Et.command(Le>=0,"invalid "+Ot,Nt.commandStr)):bt=!1,"height"in Xt?(Ye=Xt.height|0,Et.command(Ye>=0,"invalid "+Ot,Nt.commandStr)):bt=!1,new hl(!bt&&Ct&&Ct.thisDep,!bt&&Ct&&Ct.contextDep,!bt&&Ct&&Ct.propDep,function(rn,jr){var Kr=rn.shared.context,Cn=Le;"width"in Xt||(Cn=jr.def(Kr,".",Ed,"-",Yt));var Fn=Ye;return"height"in Xt||(Fn=jr.def(Kr,".",Ju,"-",Ee)),[Yt,Ee,Cn,Fn]})}else if(Ot in he){var Ve=he[Ot],Je=Iu(Ve,function(rn,jr){var Kr=rn.invoke(jr,Ve);Et.optional(function(){rn.assert(jr,Kr+"&&typeof "+Kr+'==="object"',"invalid "+Ot)});var Cn=rn.shared.context,Fn=jr.def(Kr,".x|0"),Zi=jr.def(Kr,".y|0"),Qo=jr.def('"width" in ',Kr,"?",Kr,".width|0:","(",Cn,".",Ed,"-",Fn,")"),Lh=jr.def('"height" in ',Kr,"?",Kr,".height|0:","(",Cn,".",Ju,"-",Zi,")");return Et.optional(function(){rn.assert(jr,Qo+">=0&&"+Lh+">=0","invalid "+Ot)}),[Fn,Zi,Qo,Lh]});return Ct&&(Je.thisDep=Je.thisDep||Ct.thisDep,Je.contextDep=Je.contextDep||Ct.contextDep,Je.propDep=Je.propDep||Ct.propDep),Je}else return Ct?new hl(Ct.thisDep,Ct.contextDep,Ct.propDep,function(rn,jr){var Kr=rn.shared.context;return[0,0,jr.def(Kr,".",Ed),jr.def(Kr,".",Ju)]}):null}var Zt=Vt(Ts);if(Zt){var te=Zt;Zt=new hl(Zt.thisDep,Zt.contextDep,Zt.propDep,function(Ot,Xt){var bt=te.append(Ot,Xt),Yt=Ot.shared.context;return Xt.set(Yt,"."+sm,bt[2]),Xt.set(Yt,"."+fE,bt[3]),bt})}return{viewport:Zt,scissor_box:Vt(Sf)}}function Bn(lt,Ct){var Nt=lt.static,pe=typeof Nt[Qu]=="string"&&typeof Nt[Ru]=="string";if(pe){if(Object.keys(Ct.dynamic).length>0)return null;var he=Ct.static,Vt=Object.keys(he);if(Vt.length>0&&typeof he[Vt[0]]=="number"){for(var Zt=[],te=0;te<Vt.length;++te)Et(typeof he[Vt[te]]=="number","must specify all vertex attribute locations when using vaos"),Zt.push([he[Vt[te]]|0,Vt[te]]);return Zt}}return null}function An(lt,Ct,Nt){var pe=lt.static,he=lt.dynamic;function Vt(bt){if(bt in pe){var Yt=_t.id(pe[bt]);Et.optional(function(){sr.shader(Y2[bt],Yt,Et.guessCommand())});var Ee=Yo(function(){return Yt});return Ee.id=Yt,Ee}else if(bt in he){var Le=he[bt];return Iu(Le,function(Ye,Ve){var Je=Ye.invoke(Ve,Le),rn=Ve.def(Ye.shared.strings,".id(",Je,")");return Et.optional(function(){Ve(Ye.shared.shader,".shader(",Y2[bt],",",rn,",",Ye.command,");")}),rn})}return null}var Zt=Vt(Qu),te=Vt(Ru),Ot=null,Xt;return Qs(Zt)&&Qs(te)?(Ot=sr.program(te.id,Zt.id,null,Nt),Xt=Yo(function(bt,Yt){return bt.link(Ot)})):Xt=new hl(Zt&&Zt.thisDep||te&&te.thisDep,Zt&&Zt.contextDep||te&&te.contextDep,Zt&&Zt.propDep||te&&te.propDep,function(bt,Yt){var Ee=bt.shared.shader,Le;Zt?Le=Zt.append(bt,Yt):Le=Yt.def(Ee,".",Qu);var Ye;te?Ye=te.append(bt,Yt):Ye=Yt.def(Ee,".",Ru);var Ve=Ee+".program("+Ye+","+Le;return Et.optional(function(){Ve+=","+bt.command}),Yt.def(Ve+")")}),{frag:Zt,vert:te,progVar:Xt,program:Ot}}function Vi(lt,Ct){var Nt=lt.static,pe=lt.dynamic;function he(){if(xi in Nt){var bt=Nt[xi];p1(bt)?bt=_e.getElements(_e.create(bt,!0)):bt&&(bt=_e.getElements(bt),Et.command(bt,"invalid elements",Ct.commandStr));var Yt=Yo(function(Le,Ye){if(bt){var Ve=Le.link(bt);return Le.ELEMENTS=Ve,Ve}return Le.ELEMENTS=null,null});return Yt.value=bt,Yt}else if(xi in pe){var Ee=pe[xi];return Iu(Ee,function(Le,Ye){var Ve=Le.shared,Je=Ve.isBufferArgs,rn=Ve.elements,jr=Le.invoke(Ye,Ee),Kr=Ye.def("null"),Cn=Ye.def(Je,"(",jr,")"),Fn=Le.cond(Cn).then(Kr,"=",rn,".createStream(",jr,");").else(Kr,"=",rn,".getElements(",jr,");");return Et.optional(function(){Le.assert(Fn.else,"!"+jr+"||"+Kr,"invalid elements")}),Ye.entry(Fn),Ye.exit(Le.cond(Cn).then(rn,".destroyStream(",Kr,");")),Le.ELEMENTS=Kr,Kr})}return null}var Vt=he();function Zt(){if(ps in Nt){var bt=Nt[ps];return Et.commandParameter(bt,_c,"invalid primitve",Ct.commandStr),Yo(function(Ee,Le){return _c[bt]})}else if(ps in pe){var Yt=pe[ps];return Iu(Yt,function(Ee,Le){var Ye=Ee.constants.primTypes,Ve=Ee.invoke(Le,Yt);return Et.optional(function(){Ee.assert(Le,Ve+" in "+Ye,"invalid primitive, must be one of "+Object.keys(_c))}),Le.def(Ye,"[",Ve,"]")})}else if(Vt)return Qs(Vt)?Vt.value?Yo(function(Ee,Le){return Le.def(Ee.ELEMENTS,".primType")}):Yo(function(){return V2}):new hl(Vt.thisDep,Vt.contextDep,Vt.propDep,function(Ee,Le){var Ye=Ee.ELEMENTS;return Le.def(Ye,"?",Ye,".primType:",V2)});return null}function te(bt,Yt){if(bt in Nt){var Ee=Nt[bt]|0;return Et.command(!Yt||Ee>=0,"invalid "+bt,Ct.commandStr),Yo(function(Ye,Ve){return Yt&&(Ye.OFFSET=Ee),Ee})}else if(bt in pe){var Le=pe[bt];return Iu(Le,function(Ye,Ve){var Je=Ye.invoke(Ve,Le);return Yt&&(Ye.OFFSET=Je,Et.optional(function(){Ye.assert(Ve,Je+">=0","invalid "+bt)})),Je})}else if(Yt&&Vt)return Yo(function(Ye,Ve){return Ye.OFFSET="0",0});return null}var Ot=te(Mc,!0);function Xt(){if(Io in Nt){var bt=Nt[Io]|0;return Et.command(typeof bt=="number"&&bt>=0,"invalid vertex count",Ct.commandStr),Yo(function(){return bt})}else if(Io in pe){var Yt=pe[Io];return Iu(Yt,function(Ye,Ve){var Je=Ye.invoke(Ve,Yt);return Et.optional(function(){Ye.assert(Ve,"typeof "+Je+'==="number"&&'+Je+">=0&&"+Je+"===("+Je+"|0)","invalid vertex count")}),Je})}else if(Vt)if(Qs(Vt)){if(Vt)return Ot?new hl(Ot.thisDep,Ot.contextDep,Ot.propDep,function(Ye,Ve){var Je=Ve.def(Ye.ELEMENTS,".vertCount-",Ye.OFFSET);return Et.optional(function(){Ye.assert(Ve,Je+">=0","invalid vertex offset/element buffer too small")}),Je}):Yo(function(Ye,Ve){return Ve.def(Ye.ELEMENTS,".vertCount")});var Ee=Yo(function(){return-1});return Et.optional(function(){Ee.MISSING=!0}),Ee}else{var Le=new hl(Vt.thisDep||Ot.thisDep,Vt.contextDep||Ot.contextDep,Vt.propDep||Ot.propDep,function(Ye,Ve){var Je=Ye.ELEMENTS;return Ye.OFFSET?Ve.def(Je,"?",Je,".vertCount-",Ye.OFFSET,":-1"):Ve.def(Je,"?",Je,".vertCount:-1")});return Et.optional(function(){Le.DYNAMIC=!0}),Le}return null}return{elements:Vt,primitive:Zt(),count:Xt(),instances:te(om,!1),offset:Ot}}function Lo(lt,Ct){var Nt=lt.static,pe=lt.dynamic,he={};return tr.forEach(function(Vt){var Zt=Er(Vt);function te(Ot,Xt){if(Vt in Nt){var bt=Ot(Nt[Vt]);he[Zt]=Yo(function(){return bt})}else if(Vt in pe){var Yt=pe[Vt];he[Zt]=Iu(Yt,function(Ee,Le){return Xt(Ee,Le,Ee.invoke(Le,Yt))})}}switch(Vt){case jo:case jn:case Pn:case _p:case Tn:case Ku:case Us:case Ks:case Mu:case Za:return te(function(Ot){return Et.commandType(Ot,"boolean",Vt,Ct.commandStr),Ot},function(Ot,Xt,bt){return Et.optional(function(){Ot.assert(Xt,"typeof "+bt+'==="boolean"',"invalid flag "+Vt,Ot.commandStr)}),bt});case En:return te(function(Ot){return Et.commandParameter(Ot,Uv,"invalid "+Vt,Ct.commandStr),Uv[Ot]},function(Ot,Xt,bt){var Yt=Ot.constants.compareFuncs;return Et.optional(function(){Ot.assert(Xt,bt+" in "+Yt,"invalid "+Vt+", must be one of "+Object.keys(Uv))}),Xt.def(Yt,"[",bt,"]")});case Ro:return te(function(Ot){return Et.command(lo(Ot)&&Ot.length===2&&typeof Ot[0]=="number"&&typeof Ot[1]=="number"&&Ot[0]<=Ot[1],"depth range is 2d array",Ct.commandStr),Ot},function(Ot,Xt,bt){Et.optional(function(){Ot.assert(Xt,Ot.shared.isArrayLike+"("+bt+")&&"+bt+".length===2&&typeof "+bt+'[0]==="number"&&typeof '+bt+'[1]==="number"&&'+bt+"[0]<="+bt+"[1]","depth range must be a 2d array")});var Yt=Xt.def("+",bt,"[0]"),Ee=Xt.def("+",bt,"[1]");return[Yt,Ee]});case Vn:return te(function(Ot){Et.commandType(Ot,"object","blend.func",Ct.commandStr);var Xt="srcRGB"in Ot?Ot.srcRGB:Ot.src,bt="srcAlpha"in Ot?Ot.srcAlpha:Ot.src,Yt="dstRGB"in Ot?Ot.dstRGB:Ot.dst,Ee="dstAlpha"in Ot?Ot.dstAlpha:Ot.dst;return Et.commandParameter(Xt,Af,Zt+".srcRGB",Ct.commandStr),Et.commandParameter(bt,Af,Zt+".srcAlpha",Ct.commandStr),Et.commandParameter(Yt,Af,Zt+".dstRGB",Ct.commandStr),Et.commandParameter(Ee,Af,Zt+".dstAlpha",Ct.commandStr),Et.command(mE.indexOf(Xt+", "+Yt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Xt+", "+Yt+")",Ct.commandStr),[Af[Xt],Af[Yt],Af[bt],Af[Ee]]},function(Ot,Xt,bt){var Yt=Ot.constants.blendFuncs;Et.optional(function(){Ot.assert(Xt,bt+"&&typeof "+bt+'==="object"',"invalid blend func, must be an object")});function Ee(Kr,Cn){var Fn=Xt.def('"',Kr,Cn,'" in ',bt,"?",bt,".",Kr,Cn,":",bt,".",Kr);return Et.optional(function(){Ot.assert(Xt,Fn+" in "+Yt,"invalid "+Vt+"."+Kr+Cn+", must be one of "+Object.keys(Af))}),Fn}var Le=Ee("src","RGB"),Ye=Ee("dst","RGB");Et.optional(function(){var Kr=Ot.constants.invalidBlendCombinations;Ot.assert(Xt,Kr+".indexOf("+Le+'+", "+'+Ye+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Ve=Xt.def(Yt,"[",Le,"]"),Je=Xt.def(Yt,"[",Ee("src","Alpha"),"]"),rn=Xt.def(Yt,"[",Ye,"]"),jr=Xt.def(Yt,"[",Ee("dst","Alpha"),"]");return[Ve,rn,Je,jr]});case Sn:return te(function(Ot){if(typeof Ot=="string")return Et.commandParameter(Ot,Te,"invalid "+Vt,Ct.commandStr),[Te[Ot],Te[Ot]];if(typeof Ot=="object")return Et.commandParameter(Ot.rgb,Te,Vt+".rgb",Ct.commandStr),Et.commandParameter(Ot.alpha,Te,Vt+".alpha",Ct.commandStr),[Te[Ot.rgb],Te[Ot.alpha]];Et.commandRaise("invalid blend.equation",Ct.commandStr)},function(Ot,Xt,bt){var Yt=Ot.constants.blendEquations,Ee=Xt.def(),Le=Xt.def(),Ye=Ot.cond("typeof ",bt,'==="string"');return Et.optional(function(){function Ve(Je,rn,jr){Ot.assert(Je,jr+" in "+Yt,"invalid "+rn+", must be one of "+Object.keys(Te))}Ve(Ye.then,Vt,bt),Ot.assert(Ye.else,bt+"&&typeof "+bt+'==="object"',"invalid "+Vt),Ve(Ye.else,Vt+".rgb",bt+".rgb"),Ve(Ye.else,Vt+".alpha",bt+".alpha")}),Ye.then(Ee,"=",Le,"=",Yt,"[",bt,"];"),Ye.else(Ee,"=",Yt,"[",bt,".rgb];",Le,"=",Yt,"[",bt,".alpha];"),Xt(Ye),[Ee,Le]});case Ln:return te(function(Ot){return Et.command(lo(Ot)&&Ot.length===4,"blend.color must be a 4d array",Ct.commandStr),Hi(4,function(Xt){return+Ot[Xt]})},function(Ot,Xt,bt){return Et.optional(function(){Ot.assert(Xt,Ot.shared.isArrayLike+"("+bt+")&&"+bt+".length===4","blend.color must be a 4d array")}),Hi(4,function(Yt){return Xt.def("+",bt,"[",Yt,"]")})});case xd:return te(function(Ot){return Et.commandType(Ot,"number",Zt,Ct.commandStr),Ot|0},function(Ot,Xt,bt){return Et.optional(function(){Ot.assert(Xt,"typeof "+bt+'==="number"',"invalid stencil.mask")}),Xt.def(bt,"|0")});case Ac:return te(function(Ot){Et.commandType(Ot,"object",Zt,Ct.commandStr);var Xt=Ot.cmp||"keep",bt=Ot.ref||0,Yt="mask"in Ot?Ot.mask:-1;return Et.commandParameter(Xt,Uv,Vt+".cmp",Ct.commandStr),Et.commandType(bt,"number",Vt+".ref",Ct.commandStr),Et.commandType(Yt,"number",Vt+".mask",Ct.commandStr),[Uv[Xt],bt,Yt]},function(Ot,Xt,bt){var Yt=Ot.constants.compareFuncs;Et.optional(function(){function Ve(){Ot.assert(Xt,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Ve(bt+"&&typeof ",bt,'==="object"'),Ve('!("cmp" in ',bt,")||(",bt,".cmp in ",Yt,")")});var Ee=Xt.def('"cmp" in ',bt,"?",Yt,"[",bt,".cmp]",":",Cp),Le=Xt.def(bt,".ref|0"),Ye=Xt.def('"mask" in ',bt,"?",bt,".mask|0:-1");return[Ee,Le,Ye]});case Cf:case Mh:return te(function(Ot){Et.commandType(Ot,"object",Zt,Ct.commandStr);var Xt=Ot.fail||"keep",bt=Ot.zfail||"keep",Yt=Ot.zpass||"keep";return Et.commandParameter(Xt,Sp,Vt+".fail",Ct.commandStr),Et.commandParameter(bt,Sp,Vt+".zfail",Ct.commandStr),Et.commandParameter(Yt,Sp,Vt+".zpass",Ct.commandStr),[Vt===Mh?kv:Cd,Sp[Xt],Sp[bt],Sp[Yt]]},function(Ot,Xt,bt){var Yt=Ot.constants.stencilOps;Et.optional(function(){Ot.assert(Xt,bt+"&&typeof "+bt+'==="object"',"invalid "+Vt)});function Ee(Le){return Et.optional(function(){Ot.assert(Xt,'!("'+Le+'" in '+bt+")||("+bt+"."+Le+" in "+Yt+")","invalid "+Vt+"."+Le+", must be one of "+Object.keys(Sp))}),Xt.def('"',Le,'" in ',bt,"?",Yt,"[",bt,".",Le,"]:",Cp)}return[Vt===Mh?kv:Cd,Ee("fail"),Ee("zfail"),Ee("zpass")]});case Tc:return te(function(Ot){Et.commandType(Ot,"object",Zt,Ct.commandStr);var Xt=Ot.factor|0,bt=Ot.units|0;return Et.commandType(Xt,"number",Zt+".factor",Ct.commandStr),Et.commandType(bt,"number",Zt+".units",Ct.commandStr),[Xt,bt]},function(Ot,Xt,bt){Et.optional(function(){Ot.assert(Xt,bt+"&&typeof "+bt+'==="object"',"invalid "+Vt)});var Yt=Xt.def(bt,".factor|0"),Ee=Xt.def(bt,".units|0");return[Yt,Ee]});case Xa:return te(function(Ot){var Xt=0;return Ot==="front"?Xt=Cd:Ot==="back"&&(Xt=kv),Et.command(!!Xt,Zt,Ct.commandStr),Xt},function(Ot,Xt,bt){return Et.optional(function(){Ot.assert(Xt,bt+'==="front"||'+bt+'==="back"',"invalid cull.face")}),Xt.def(bt,'==="front"?',Cd,":",kv)});case qs:return te(function(Ot){return Et.command(typeof Ot=="number"&&Ot>=ge.lineWidthDims[0]&&Ot<=ge.lineWidthDims[1],"invalid line width, must be a positive number between "+ge.lineWidthDims[0]+" and "+ge.lineWidthDims[1],Ct.commandStr),Ot},function(Ot,Xt,bt){return Et.optional(function(){Ot.assert(Xt,"typeof "+bt+'==="number"&&'+bt+">="+ge.lineWidthDims[0]+"&&"+bt+"<="+ge.lineWidthDims[1],"invalid line width")}),bt});case qa:return te(function(Ot){return Et.commandParameter(Ot,Tp,Zt,Ct.commandStr),Tp[Ot]},function(Ot,Xt,bt){return Et.optional(function(){Ot.assert(Xt,bt+'==="cw"||'+bt+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Xt.def(bt+'==="cw"?'+d1+":"+pE)});case ds:return te(function(Ot){return Et.command(lo(Ot)&&Ot.length===4,"color.mask must be length 4 array",Ct.commandStr),Ot.map(function(Xt){return!!Xt})},function(Ot,Xt,bt){return Et.optional(function(){Ot.assert(Xt,Ot.shared.isArrayLike+"("+bt+")&&"+bt+".length===4","invalid color.mask")}),Hi(4,function(Yt){return"!!"+bt+"["+Yt+"]"})});case Fl:return te(function(Ot){Et.command(typeof Ot=="object"&&Ot,Zt,Ct.commandStr);var Xt="value"in Ot?Ot.value:1,bt=!!Ot.invert;return Et.command(typeof Xt=="number"&&Xt>=0&&Xt<=1,"sample.coverage.value must be a number between 0 and 1",Ct.commandStr),[Xt,bt]},function(Ot,Xt,bt){Et.optional(function(){Ot.assert(Xt,bt+"&&typeof "+bt+'==="object"',"invalid sample.coverage")});var Yt=Xt.def('"value" in ',bt,"?+",bt,".value:1"),Ee=Xt.def("!!",bt,".invert");return[Yt,Ee]})}}),he}function As(lt,Ct){var Nt=lt.static,pe=lt.dynamic,he={};return Object.keys(Nt).forEach(function(Vt){var Zt=Nt[Vt],te;if(typeof Zt=="number"||typeof Zt=="boolean")te=Yo(function(){return Zt});else if(typeof Zt=="function"){var Ot=Zt._reglType;Ot==="texture2d"||Ot==="textureCube"?te=Yo(function(Xt){return Xt.link(Zt)}):Ot==="framebuffer"||Ot==="framebufferCube"?(Et.command(Zt.color.length>0,'missing color attachment for framebuffer sent to uniform "'+Vt+'"',Ct.commandStr),te=Yo(function(Xt){return Xt.link(Zt.color[0])})):Et.commandRaise('invalid data for uniform "'+Vt+'"',Ct.commandStr)}else lo(Zt)?te=Yo(function(Xt){var bt=Xt.global.def("[",Hi(Zt.length,function(Yt){return Et.command(typeof Zt[Yt]=="number"||typeof Zt[Yt]=="boolean","invalid uniform "+Vt,Xt.commandStr),Zt[Yt]}),"]");return bt}):Et.commandRaise('invalid or missing data for uniform "'+Vt+'"',Ct.commandStr);te.value=Zt,he[Vt]=te}),Object.keys(pe).forEach(function(Vt){var Zt=pe[Vt];he[Vt]=Iu(Zt,function(te,Ot){return te.invoke(Ot,Zt)})}),he}function gi(lt,Ct){var Nt=lt.static,pe=lt.dynamic,he={};return Object.keys(Nt).forEach(function(Vt){var Zt=Nt[Vt],te=_t.id(Vt),Ot=new ae;if(p1(Zt))Ot.state=or,Ot.buffer=Ue.getBuffer(Ue.create(Zt,lm,!1,!0)),Ot.type=0;else{var Xt=Ue.getBuffer(Zt);if(Xt)Ot.state=or,Ot.buffer=Xt,Ot.type=0;else if(Et.command(typeof Zt=="object"&&Zt,"invalid data for attribute "+Vt,Ct.commandStr),"constant"in Zt){var bt=Zt.constant;Ot.buffer="null",Ot.state=Ir,typeof bt=="number"?Ot.x=bt:(Et.command(lo(bt)&&bt.length>0&&bt.length<=4,"invalid constant for attribute "+Vt,Ct.commandStr),Ge.forEach(function(rn,jr){jr<bt.length&&(Ot[rn]=bt[jr])}))}else{p1(Zt.buffer)?Xt=Ue.getBuffer(Ue.create(Zt.buffer,lm,!1,!0)):Xt=Ue.getBuffer(Zt.buffer),Et.command(!!Xt,'missing buffer for attribute "'+Vt+'"',Ct.commandStr);var Yt=Zt.offset|0;Et.command(Yt>=0,'invalid offset for attribute "'+Vt+'"',Ct.commandStr);var Ee=Zt.stride|0;Et.command(Ee>=0&&Ee<256,'invalid stride for attribute "'+Vt+'", must be integer betweeen [0, 255]',Ct.commandStr);var Le=Zt.size|0;Et.command(!("size"in Zt)||Le>0&&Le<=4,'invalid size for attribute "'+Vt+'", must be 1,2,3,4',Ct.commandStr);var Ye=!!Zt.normalized,Ve=0;"type"in Zt&&(Et.commandParameter(Zt.type,Cs,"invalid type for attribute "+Vt,Ct.commandStr),Ve=Cs[Zt.type]);var Je=Zt.divisor|0;"divisor"in Zt&&(Et.command(Je===0||ar,'cannot specify divisor for attribute "'+Vt+'", instancing not supported',Ct.commandStr),Et.command(Je>=0,'invalid divisor for attribute "'+Vt+'"',Ct.commandStr)),Et.optional(function(){var rn=Ct.commandStr,jr=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Zt).forEach(function(Kr){Et.command(jr.indexOf(Kr)>=0,'unknown parameter "'+Kr+'" for attribute pointer "'+Vt+'" (valid parameters are '+jr+")",rn)})}),Ot.buffer=Xt,Ot.state=or,Ot.size=Le,Ot.normalized=Ye,Ot.type=Ve||Xt.dtype,Ot.offset=Yt,Ot.stride=Ee,Ot.divisor=Je}}he[Vt]=Yo(function(rn,jr){var Kr=rn.attribCache;if(te in Kr)return Kr[te];var Cn={isStream:!1};return Object.keys(Ot).forEach(function(Fn){Cn[Fn]=Ot[Fn]}),Ot.buffer&&(Cn.buffer=rn.link(Ot.buffer),Cn.type=Cn.type||Cn.buffer+".dtype"),Kr[te]=Cn,Cn})}),Object.keys(pe).forEach(function(Vt){var Zt=pe[Vt];function te(Ot,Xt){var bt=Ot.invoke(Xt,Zt),Yt=Ot.shared,Ee=Ot.constants,Le=Yt.isBufferArgs,Ye=Yt.buffer;Et.optional(function(){Ot.assert(Xt,bt+"&&(typeof "+bt+'==="object"||typeof '+bt+'==="function")&&('+Le+"("+bt+")||"+Ye+".getBuffer("+bt+")||"+Ye+".getBuffer("+bt+".buffer)||"+Le+"("+bt+'.buffer)||("constant" in '+bt+"&&(typeof "+bt+'.constant==="number"||'+Yt.isArrayLike+"("+bt+".constant))))",'invalid dynamic attribute "'+Vt+'"')});var Ve={isStream:Xt.def(!1)},Je=new ae;Je.state=or,Object.keys(Je).forEach(function(Cn){Ve[Cn]=Xt.def(""+Je[Cn])});var rn=Ve.buffer,jr=Ve.type;Xt("if(",Le,"(",bt,")){",Ve.isStream,"=true;",rn,"=",Ye,".createStream(",lm,",",bt,");",jr,"=",rn,".dtype;","}else{",rn,"=",Ye,".getBuffer(",bt,");","if(",rn,"){",jr,"=",rn,".dtype;",'}else if("constant" in ',bt,"){",Ve.state,"=",Ir,";","if(typeof "+bt+'.constant === "number"){',Ve[Ge[0]],"=",bt,".constant;",Ge.slice(1).map(function(Cn){return Ve[Cn]}).join("="),"=0;","}else{",Ge.map(function(Cn,Fn){return Ve[Cn]+"="+bt+".constant.length>"+Fn+"?"+bt+".constant["+Fn+"]:0;"}).join(""),"}}else{","if(",Le,"(",bt,".buffer)){",rn,"=",Ye,".createStream(",lm,",",bt,".buffer);","}else{",rn,"=",Ye,".getBuffer(",bt,".buffer);","}",jr,'="type" in ',bt,"?",Ee.glTypes,"[",bt,".type]:",rn,".dtype;",Ve.normalized,"=!!",bt,".normalized;");function Kr(Cn){Xt(Ve[Cn],"=",bt,".",Cn,"|0;")}return Kr("size"),Kr("offset"),Kr("stride"),Kr("divisor"),Xt("}}"),Xt.exit("if(",Ve.isStream,"){",Ye,".destroyStream(",rn,");","}"),Ve}he[Vt]=Iu(Zt,te)}),he}function Oo(lt,Ct){var Nt=lt.static,pe=lt.dynamic;if(Tf in Nt){var he=Nt[Tf];return he!==null&&vr.getVAO(he)===null&&(he=vr.createVAO(he)),Yo(function(Zt){return Zt.link(vr.getVAO(he))})}else if(Tf in pe){var Vt=pe[Tf];return Iu(Vt,function(Zt,te){var Ot=Zt.invoke(te,Vt);return te.def(Zt.shared.vao+".getVAO("+Ot+")")})}return null}function La(lt){var Ct=lt.static,Nt=lt.dynamic,pe={};return Object.keys(Ct).forEach(function(he){var Vt=Ct[he];pe[he]=Yo(function(Zt,te){return typeof Vt=="number"||typeof Vt=="boolean"?""+Vt:Zt.link(Vt)})}),Object.keys(Nt).forEach(function(he){var Vt=Nt[he];pe[he]=Iu(Vt,function(Zt,te){return Zt.invoke(te,Vt)})}),pe}function Zo(lt,Ct,Nt,pe,he){var Vt=lt.static,Zt=lt.dynamic;Et.optional(function(){var Kr=[ul,Ru,Qu,xi,ps,Mc,Io,om,uo,Tf].concat(tr);function Cn(Fn){Object.keys(Fn).forEach(function(Zi){Et.command(Kr.indexOf(Zi)>=0,'unknown parameter "'+Zi+'"',he.commandStr)})}Cn(Vt),Cn(Zt)});var te=Bn(lt,Ct),Ot=Or(lt),Xt=ei(lt,Ot,he),bt=Vi(lt,he),Yt=Lo(lt,he),Ee=An(lt,he,te);function Le(Kr){var Cn=Xt[Kr];Cn&&(Yt[Kr]=Cn)}Le(Ts),Le(Er(Sf));var Ye=Object.keys(Yt).length>0,Ve={framebuffer:Ot,draw:bt,shader:Ee,state:Yt,dirty:Ye,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Ve.profile=li(lt),Ve.uniforms=As(Nt,he),Ve.drawVAO=Ve.scopeVAO=Oo(lt),!Ve.drawVAO&&Ee.program&&!te&&Bt.angle_instanced_arrays){var Je=!0,rn=Ee.program.attributes.map(function(Kr){var Cn=Ct.static[Kr];return Je=Je&&!!Cn,Cn});if(Je&&rn.length>0){var jr=vr.getVAO(vr.createVAO(rn));Ve.drawVAO=new hl(null,null,null,function(Kr,Cn){return Kr.link(jr)}),Ve.useVAO=!0}}return te?Ve.useVAO=!0:Ve.attributes=gi(Ct,he),Ve.context=La(pe),Ve}function qo(lt,Ct,Nt){var pe=lt.shared,he=pe.context,Vt=lt.scope();Object.keys(Nt).forEach(function(Zt){Ct.save(he,"."+Zt);var te=Nt[Zt];Vt(he,".",Zt,"=",te.append(lt,Ct),";")}),Ct(Vt)}function ho(lt,Ct,Nt,pe){var he=lt.shared,Vt=he.gl,Zt=he.framebuffer,te;Sr&&(te=Ct.def(he.extensions,".webgl_draw_buffers"));var Ot=lt.constants,Xt=Ot.drawBuffer,bt=Ot.backBuffer,Yt;Nt?Yt=Nt.append(lt,Ct):Yt=Ct.def(Zt,".next"),pe||Ct("if(",Yt,"!==",Zt,".cur){"),Ct("if(",Yt,"){",Vt,".bindFramebuffer(",zv,",",Yt,".framebuffer);"),Sr&&Ct(te,".drawBuffersWEBGL(",Xt,"[",Yt,".colorAttachments.length]);"),Ct("}else{",Vt,".bindFramebuffer(",zv,",null);"),Sr&&Ct(te,".drawBuffersWEBGL(",bt,");"),Ct("}",Zt,".cur=",Yt,";"),pe||Ct("}")}function vs(lt,Ct,Nt){var pe=lt.shared,he=pe.gl,Vt=lt.current,Zt=lt.next,te=pe.current,Ot=pe.next,Xt=lt.cond(te,".dirty");tr.forEach(function(bt){var Yt=Er(bt);if(!(Yt in Nt.state)){var Ee,Le;if(Yt in Zt){Ee=Zt[Yt],Le=Vt[Yt];var Ye=Hi(Xe[Yt].length,function(Je){return Xt.def(Ee,"[",Je,"]")});Xt(lt.cond(Ye.map(function(Je,rn){return Je+"!=="+Le+"["+rn+"]"}).join("||")).then(he,".",je[Yt],"(",Ye,");",Ye.map(function(Je,rn){return Le+"["+rn+"]="+Je}).join(";"),";"))}else{Ee=Xt.def(Ot,".",Yt);var Ve=lt.cond(Ee,"!==",te,".",Yt);Xt(Ve),Yt in Ar?Ve(lt.cond(Ee).then(he,".enable(",Ar[Yt],");").else(he,".disable(",Ar[Yt],");"),te,".",Yt,"=",Ee,";"):Ve(he,".",je[Yt],"(",Ee,");",te,".",Yt,"=",Ee,";")}}}),Object.keys(Nt.state).length===0&&Xt(te,".dirty=false;"),Ct(Xt)}function Js(lt,Ct,Nt,pe){var he=lt.shared,Vt=lt.current,Zt=he.current,te=he.gl;v1(Object.keys(Nt)).forEach(function(Ot){var Xt=Nt[Ot];if(!(pe&&!pe(Xt))){var bt=Xt.append(lt,Ct);if(Ar[Ot]){var Yt=Ar[Ot];Qs(Xt)?bt?Ct(te,".enable(",Yt,");"):Ct(te,".disable(",Yt,");"):Ct(lt.cond(bt).then(te,".enable(",Yt,");").else(te,".disable(",Yt,");")),Ct(Zt,".",Ot,"=",bt,";")}else if(lo(bt)){var Ee=Vt[Ot];Ct(te,".",je[Ot],"(",bt,");",bt.map(function(Le,Ye){return Ee+"["+Ye+"]="+Le}).join(";"),";")}else Ct(te,".",je[Ot],"(",bt,");",Zt,".",Ot,"=",bt,";")}})}function Ko(lt,Ct){ar&&(lt.instancing=Ct.def(lt.shared.extensions,".angle_instanced_arrays"))}function Jn(lt,Ct,Nt,pe,he){var Vt=lt.shared,Zt=lt.stats,te=Vt.current,Ot=Vt.timer,Xt=Nt.profile;function bt(){return typeof performance>"u"?"Date.now()":"performance.now()"}var Yt,Ee;function Le(Kr){Yt=Ct.def(),Kr(Yt,"=",bt(),";"),typeof he=="string"?Kr(Zt,".count+=",he,";"):Kr(Zt,".count++;"),Qe&&(pe?(Ee=Ct.def(),Kr(Ee,"=",Ot,".getNumPendingQueries();")):Kr(Ot,".beginQuery(",Zt,");"))}function Ye(Kr){Kr(Zt,".cpuTime+=",bt(),"-",Yt,";"),Qe&&(pe?Kr(Ot,".pushScopeStats(",Ee,",",Ot,".getNumPendingQueries(),",Zt,");"):Kr(Ot,".endQuery();"))}function Ve(Kr){var Cn=Ct.def(te,".profile");Ct(te,".profile=",Kr,";"),Ct.exit(te,".profile=",Cn,";")}var Je;if(Xt){if(Qs(Xt)){Xt.enable?(Le(Ct),Ye(Ct.exit),Ve("true")):Ve("false");return}Je=Xt.append(lt,Ct),Ve(Je)}else Je=Ct.def(te,".profile");var rn=lt.block();Le(rn),Ct("if(",Je,"){",rn,"}");var jr=lt.block();Ye(jr),Ct.exit("if(",Je,"){",jr,"}")}function $s(lt,Ct,Nt,pe,he){var Vt=lt.shared;function Zt(Ot){switch(Ot){case u1:case h1:case Dv:return 2;case um:case co:case Fv:return 3;case c1:case Pv:case wp:return 4;default:return 1}}function te(Ot,Xt,bt){var Yt=Vt.gl,Ee=Ct.def(Ot,".location"),Le=Ct.def(Vt.attributes,"[",Ee,"]"),Ye=bt.state,Ve=bt.buffer,Je=[bt.x,bt.y,bt.z,bt.w],rn=["buffer","normalized","offset","stride"];function jr(){Ct("if(!",Le,".buffer){",Yt,".enableVertexAttribArray(",Ee,");}");var Cn=bt.type,Fn;if(bt.size?Fn=Ct.def(bt.size,"||",Xt):Fn=Xt,Ct("if(",Le,".type!==",Cn,"||",Le,".size!==",Fn,"||",rn.map(function(Qo){return Le+"."+Qo+"!=="+bt[Qo]}).join("||"),"){",Yt,".bindBuffer(",lm,",",Ve,".buffer);",Yt,".vertexAttribPointer(",[Ee,Fn,Cn,bt.normalized,bt.stride,bt.offset],");",Le,".type=",Cn,";",Le,".size=",Fn,";",rn.map(function(Qo){return Le+"."+Qo+"="+bt[Qo]+";"}).join(""),"}"),ar){var Zi=bt.divisor;Ct("if(",Le,".divisor!==",Zi,"){",lt.instancing,".vertexAttribDivisorANGLE(",[Ee,Zi],");",Le,".divisor=",Zi,";}")}}function Kr(){Ct("if(",Le,".buffer){",Yt,".disableVertexAttribArray(",Ee,");",Le,".buffer=null;","}if(",Ge.map(function(Cn,Fn){return Le+"."+Cn+"!=="+Je[Fn]}).join("||"),"){",Yt,".vertexAttrib4f(",Ee,",",Je,");",Ge.map(function(Cn,Fn){return Le+"."+Cn+"="+Je[Fn]+";"}).join(""),"}")}Ye===or?jr():Ye===Ir?Kr():(Ct("if(",Ye,"===",or,"){"),jr(),Ct("}else{"),Kr(),Ct("}"))}pe.forEach(function(Ot){var Xt=Ot.name,bt=Nt.attributes[Xt],Yt;if(bt){if(!he(bt))return;Yt=bt.append(lt,Ct)}else{if(!he(Z2))return;var Ee=lt.scopeAttrib(Xt);Et.optional(function(){lt.assert(Ct,Ee+".state","missing attribute "+Xt)}),Yt={},Object.keys(new ae).forEach(function(Le){Yt[Le]=Ct.def(Ee,".",Le)})}te(lt.link(Ot),Zt(Ot.info.type),Yt)})}function Yi(lt,Ct,Nt,pe,he){for(var Vt=lt.shared,Zt=Vt.gl,te,Ot=0;Ot<pe.length;++Ot){var Xt=pe[Ot],bt=Xt.name,Yt=Xt.info.type,Ee=Nt.uniforms[bt],Le=lt.link(Xt),Ye=Le+".location",Ve;if(Ee){if(!he(Ee))continue;if(Qs(Ee)){var Je=Ee.value;if(Et.command(Je!==null&&typeof Je<"u",'missing uniform "'+bt+'"',lt.commandStr),Yt===Bv||Yt===Nv){Et.command(typeof Je=="function"&&(Yt===Bv&&(Je._reglType==="texture2d"||Je._reglType==="framebuffer")||Yt===Nv&&(Je._reglType==="textureCube"||Je._reglType==="framebufferCube")),"invalid texture for uniform "+bt,lt.commandStr);var rn=lt.link(Je._texture||Je.color[0]._texture);Ct(Zt,".uniform1i(",Ye,",",rn+".bind());"),Ct.exit(rn,".unbind();")}else if(Yt===cm||Yt===hm||Yt===wd){Et.optional(function(){Et.command(lo(Je),"invalid matrix for uniform "+bt,lt.commandStr),Et.command(Yt===cm&&Je.length===4||Yt===hm&&Je.length===9||Yt===wd&&Je.length===16,"invalid length for matrix uniform "+bt,lt.commandStr)});var jr=lt.global.def("new Float32Array(["+Array.prototype.slice.call(Je)+"])"),Kr=2;Yt===hm?Kr=3:Yt===wd&&(Kr=4),Ct(Zt,".uniformMatrix",Kr,"fv(",Ye,",false,",jr,");")}else{switch(Yt){case dE:Et.commandType(Je,"number","uniform "+bt,lt.commandStr),te="1f";break;case u1:Et.command(lo(Je)&&Je.length===2,"uniform "+bt,lt.commandStr),te="2f";break;case um:Et.command(lo(Je)&&Je.length===3,"uniform "+bt,lt.commandStr),te="3f";break;case c1:Et.command(lo(Je)&&Je.length===4,"uniform "+bt,lt.commandStr),te="4f";break;case f1:Et.commandType(Je,"boolean","uniform "+bt,lt.commandStr),te="1i";break;case Ep:Et.commandType(Je,"number","uniform "+bt,lt.commandStr),te="1i";break;case Dv:Et.command(lo(Je)&&Je.length===2,"uniform "+bt,lt.commandStr),te="2i";break;case h1:Et.command(lo(Je)&&Je.length===2,"uniform "+bt,lt.commandStr),te="2i";break;case Fv:Et.command(lo(Je)&&Je.length===3,"uniform "+bt,lt.commandStr),te="3i";break;case co:Et.command(lo(Je)&&Je.length===3,"uniform "+bt,lt.commandStr),te="3i";break;case wp:Et.command(lo(Je)&&Je.length===4,"uniform "+bt,lt.commandStr),te="4i";break;case Pv:Et.command(lo(Je)&&Je.length===4,"uniform "+bt,lt.commandStr),te="4i";break}Ct(Zt,".uniform",te,"(",Ye,",",lo(Je)?Array.prototype.slice.call(Je):Je,");")}continue}else Ve=Ee.append(lt,Ct)}else{if(!he(Z2))continue;Ve=Ct.def(Vt.uniforms,"[",_t.id(bt),"]")}Yt===Bv?Ct("if(",Ve,"&&",Ve,'._reglType==="framebuffer"){',Ve,"=",Ve,".color[0];","}"):Yt===Nv&&Ct("if(",Ve,"&&",Ve,'._reglType==="framebufferCube"){',Ve,"=",Ve,".color[0];","}"),Et.optional(function(){function Lh(Sd,bE){lt.assert(Ct,Sd,'bad data or missing for uniform "'+bt+'".  '+bE)}function xE(Sd){Lh("typeof "+Ve+'==="'+Sd+'"',"invalid type, expected "+Sd)}function Rc(Sd,bE){Lh(Vt.isArrayLike+"("+Ve+")&&"+Ve+".length==="+Sd,"invalid vector, should have length "+Sd,lt.commandStr)}function nT(Sd){Lh("typeof "+Ve+'==="function"&&'+Ve+'._reglType==="texture'+(Sd===s1?"2d":"Cube")+'"',"invalid texture type",lt.commandStr)}switch(Yt){case Ep:xE("number");break;case h1:Rc(2);break;case co:Rc(3);break;case Pv:Rc(4);break;case dE:xE("number");break;case u1:Rc(2);break;case um:Rc(3);break;case c1:Rc(4);break;case f1:xE("boolean");break;case Dv:Rc(2);break;case Fv:Rc(3);break;case wp:Rc(4);break;case cm:Rc(4);break;case hm:Rc(9);break;case wd:Rc(16);break;case Bv:nT(s1);break;case Nv:nT(DL);break}});var Cn=1;switch(Yt){case Bv:case Nv:var Fn=Ct.def(Ve,"._texture");Ct(Zt,".uniform1i(",Ye,",",Fn,".bind());"),Ct.exit(Fn,".unbind();");continue;case Ep:case f1:te="1i";break;case h1:case Dv:te="2i",Cn=2;break;case co:case Fv:te="3i",Cn=3;break;case Pv:case wp:te="4i",Cn=4;break;case dE:te="1f";break;case u1:te="2f",Cn=2;break;case um:te="3f",Cn=3;break;case c1:te="4f",Cn=4;break;case cm:te="Matrix2fv";break;case hm:te="Matrix3fv";break;case wd:te="Matrix4fv";break}if(Ct(Zt,".uniform",te,"(",Ye,","),te.charAt(0)==="M"){var Zi=Math.pow(Yt-cm+2,2),Qo=lt.global.def("new Float32Array(",Zi,")");Ct("false,(Array.isArray(",Ve,")||",Ve," instanceof Float32Array)?",Ve,":(",Hi(Zi,function(Lh){return Qo+"["+Lh+"]="+Ve+"["+Lh+"]"}),",",Qo,")")}else Cn>1?Ct(Hi(Cn,function(Lh){return Ve+"["+Lh+"]"})):Ct(Ve);Ct(");")}}function wn(lt,Ct,Nt,pe){var he=lt.shared,Vt=he.gl,Zt=he.draw,te=pe.draw;function Ot(){var Fn=te.elements,Zi,Qo=Ct;return Fn?((Fn.contextDep&&pe.contextDynamic||Fn.propDep)&&(Qo=Nt),Zi=Fn.append(lt,Qo)):Zi=Qo.def(Zt,".",xi),Zi&&Qo("if("+Zi+")"+Vt+".bindBuffer("+LL+","+Zi+".buffer.buffer);"),Zi}function Xt(){var Fn=te.count,Zi,Qo=Ct;return Fn?((Fn.contextDep&&pe.contextDynamic||Fn.propDep)&&(Qo=Nt),Zi=Fn.append(lt,Qo),Et.optional(function(){Fn.MISSING&&lt.assert(Ct,"false","missing vertex count"),Fn.DYNAMIC&&lt.assert(Qo,Zi+">=0","missing vertex count")})):(Zi=Qo.def(Zt,".",Io),Et.optional(function(){lt.assert(Qo,Zi+">=0","missing vertex count")})),Zi}var bt=Ot();function Yt(Fn){var Zi=te[Fn];return Zi?Zi.contextDep&&pe.contextDynamic||Zi.propDep?Zi.append(lt,Nt):Zi.append(lt,Ct):Ct.def(Zt,".",Fn)}var Ee=Yt(ps),Le=Yt(Mc),Ye=Xt();if(typeof Ye=="number"){if(Ye===0)return}else Nt("if(",Ye,"){"),Nt.exit("}");var Ve,Je;ar&&(Ve=Yt(om),Je=lt.instancing);var rn=bt+".type",jr=te.elements&&Qs(te.elements);function Kr(){function Fn(){Nt(Je,".drawElementsInstancedANGLE(",[Ee,Ye,rn,Le+"<<(("+rn+"-"+hr+")>>1)",Ve],");")}function Zi(){Nt(Je,".drawArraysInstancedANGLE(",[Ee,Le,Ye,Ve],");")}bt?jr?Fn():(Nt("if(",bt,"){"),Fn(),Nt("}else{"),Zi(),Nt("}")):Zi()}function Cn(){function Fn(){Nt(Vt+".drawElements("+[Ee,Ye,rn,Le+"<<(("+rn+"-"+hr+")>>1)"]+");")}function Zi(){Nt(Vt+".drawArrays("+[Ee,Le,Ye]+");")}bt?jr?Fn():(Nt("if(",bt,"){"),Fn(),Nt("}else{"),Zi(),Nt("}")):Zi()}ar&&(typeof Ve!="number"||Ve>=0)?typeof Ve=="string"?(Nt("if(",Ve,">0){"),Kr(),Nt("}else if(",Ve,"<0){"),Cn(),Nt("}")):Kr():Cn()}function di(lt,Ct,Nt,pe,he){var Vt=pn(),Zt=Vt.proc("body",he);return Et.optional(function(){Vt.commandStr=Ct.commandStr,Vt.command=Vt.link(Ct.commandStr)}),ar&&(Vt.instancing=Zt.def(Vt.shared.extensions,".angle_instanced_arrays")),lt(Vt,Zt,Nt,pe),Vt.compile().body}function Ni(lt,Ct,Nt,pe){Ko(lt,Ct),Nt.useVAO?Nt.drawVAO?Ct(lt.shared.vao,".setVAO(",Nt.drawVAO.append(lt,Ct),");"):Ct(lt.shared.vao,".setVAO(",lt.shared.vao,".targetVAO);"):(Ct(lt.shared.vao,".setVAO(null);"),$s(lt,Ct,Nt,pe.attributes,function(){return!0})),Yi(lt,Ct,Nt,pe.uniforms,function(){return!0}),wn(lt,Ct,Ct,Nt)}function Po(lt,Ct){var Nt=lt.proc("draw",1);Ko(lt,Nt),qo(lt,Nt,Ct.context),ho(lt,Nt,Ct.framebuffer),vs(lt,Nt,Ct),Js(lt,Nt,Ct.state),Jn(lt,Nt,Ct,!1,!0);var pe=Ct.shader.progVar.append(lt,Nt);if(Nt(lt.shared.gl,".useProgram(",pe,".program);"),Ct.shader.program)Ni(lt,Nt,Ct,Ct.shader.program);else{Nt(lt.shared.vao,".setVAO(null);");var he=lt.global.def("{}"),Vt=Nt.def(pe,".id"),Zt=Nt.def(he,"[",Vt,"]");Nt(lt.cond(Zt).then(Zt,".call(this,a0);").else(Zt,"=",he,"[",Vt,"]=",lt.link(function(te){return di(Ni,lt,Ct,te,1)}),"(",pe,");",Zt,".call(this,a0);"))}Object.keys(Ct.state).length>0&&Nt(lt.shared.current,".dirty=true;")}function Ih(lt,Ct,Nt,pe){lt.batchId="a1",Ko(lt,Ct);function he(){return!0}$s(lt,Ct,Nt,pe.attributes,he),Yi(lt,Ct,Nt,pe.uniforms,he),wn(lt,Ct,Ct,Nt)}function Lt(lt,Ct,Nt,pe){Ko(lt,Ct);var he=Nt.contextDep,Vt=Ct.def(),Zt="a0",te="a1",Ot=Ct.def();lt.shared.props=Ot,lt.batchId=Vt;var Xt=lt.scope(),bt=lt.scope();Ct(Xt.entry,"for(",Vt,"=0;",Vt,"<",te,";++",Vt,"){",Ot,"=",Zt,"[",Vt,"];",bt,"}",Xt.exit);function Yt(rn){return rn.contextDep&&he||rn.propDep}function Ee(rn){return!Yt(rn)}if(Nt.needsContext&&qo(lt,bt,Nt.context),Nt.needsFramebuffer&&ho(lt,bt,Nt.framebuffer),Js(lt,bt,Nt.state,Yt),Nt.profile&&Yt(Nt.profile)&&Jn(lt,bt,Nt,!1,!0),pe)Nt.useVAO?Nt.drawVAO?Yt(Nt.drawVAO)?bt(lt.shared.vao,".setVAO(",Nt.drawVAO.append(lt,bt),");"):Xt(lt.shared.vao,".setVAO(",Nt.drawVAO.append(lt,Xt),");"):Xt(lt.shared.vao,".setVAO(",lt.shared.vao,".targetVAO);"):(Xt(lt.shared.vao,".setVAO(null);"),$s(lt,Xt,Nt,pe.attributes,Ee),$s(lt,bt,Nt,pe.attributes,Yt)),Yi(lt,Xt,Nt,pe.uniforms,Ee),Yi(lt,bt,Nt,pe.uniforms,Yt),wn(lt,Xt,bt,Nt);else{var Le=lt.global.def("{}"),Ye=Nt.shader.progVar.append(lt,bt),Ve=bt.def(Ye,".id"),Je=bt.def(Le,"[",Ve,"]");bt(lt.shared.gl,".useProgram(",Ye,".program);","if(!",Je,"){",Je,"=",Le,"[",Ve,"]=",lt.link(function(rn){return di(Ih,lt,Nt,rn,2)}),"(",Ye,");}",Je,".call(this,a0[",Vt,"],",Vt,");")}}function xe(lt,Ct){var Nt=lt.proc("batch",2);lt.batchId="0",Ko(lt,Nt);var pe=!1,he=!0;Object.keys(Ct.context).forEach(function(Le){pe=pe||Ct.context[Le].propDep}),pe||(qo(lt,Nt,Ct.context),he=!1);var Vt=Ct.framebuffer,Zt=!1;Vt?(Vt.propDep?pe=Zt=!0:Vt.contextDep&&pe&&(Zt=!0),Zt||ho(lt,Nt,Vt)):ho(lt,Nt,null),Ct.state.viewport&&Ct.state.viewport.propDep&&(pe=!0);function te(Le){return Le.contextDep&&pe||Le.propDep}vs(lt,Nt,Ct),Js(lt,Nt,Ct.state,function(Le){return!te(Le)}),(!Ct.profile||!te(Ct.profile))&&Jn(lt,Nt,Ct,!1,"a1"),Ct.contextDep=pe,Ct.needsContext=he,Ct.needsFramebuffer=Zt;var Ot=Ct.shader.progVar;if(Ot.contextDep&&pe||Ot.propDep)Lt(lt,Nt,Ct,null);else{var Xt=Ot.append(lt,Nt);if(Nt(lt.shared.gl,".useProgram(",Xt,".program);"),Ct.shader.program)Lt(lt,Nt,Ct,Ct.shader.program);else{Nt(lt.shared.vao,".setVAO(null);");var bt=lt.global.def("{}"),Yt=Nt.def(Xt,".id"),Ee=Nt.def(bt,"[",Yt,"]");Nt(lt.cond(Ee).then(Ee,".call(this,a0,a1);").else(Ee,"=",bt,"[",Yt,"]=",lt.link(function(Le){return di(Lt,lt,Ct,Le,2)}),"(",Xt,");",Ee,".call(this,a0,a1);"))}}Object.keys(Ct.state).length>0&&Nt(lt.shared.current,".dirty=true;")}function fe(lt,Ct){var Nt=lt.proc("scope",3);lt.batchId="a2";var pe=lt.shared,he=pe.current;qo(lt,Nt,Ct.context),Ct.framebuffer&&Ct.framebuffer.append(lt,Nt),v1(Object.keys(Ct.state)).forEach(function(Zt){var te=Ct.state[Zt],Ot=te.append(lt,Nt);lo(Ot)?Ot.forEach(function(Xt,bt){Nt.set(lt.next[Zt],"["+bt+"]",Xt)}):Nt.set(pe.next,"."+Zt,Ot)}),Jn(lt,Nt,Ct,!0,!0),[xi,Mc,Io,om,ps].forEach(function(Zt){var te=Ct.draw[Zt];te&&Nt.set(pe.draw,"."+Zt,""+te.append(lt,Nt))}),Object.keys(Ct.uniforms).forEach(function(Zt){Nt.set(pe.uniforms,"["+_t.id(Zt)+"]",Ct.uniforms[Zt].append(lt,Nt))}),Object.keys(Ct.attributes).forEach(function(Zt){var te=Ct.attributes[Zt].append(lt,Nt),Ot=lt.scopeAttrib(Zt);Object.keys(new ae).forEach(function(Xt){Nt.set(Ot,"."+Xt,te[Xt])})}),Ct.scopeVAO&&Nt.set(pe.vao,".targetVAO",Ct.scopeVAO.append(lt,Nt));function Vt(Zt){var te=Ct.shader[Zt];te&&Nt.set(pe.shader,"."+Zt,te.append(lt,Nt))}Vt(Ru),Vt(Qu),Object.keys(Ct.state).length>0&&(Nt(he,".dirty=true;"),Nt.exit(he,".dirty=true;")),Nt("a1(",lt.shared.context,",a0,",lt.batchId,");")}function Fr(lt){if(!(typeof lt!="object"||lo(lt))){for(var Ct=Object.keys(lt),Nt=0;Nt<Ct.length;++Nt)if(vo.isDynamic(lt[Ct[Nt]]))return!0;return!1}}function ri(lt,Ct,Nt){var pe=Ct.static[Nt];if(!pe||!Fr(pe))return;var he=lt.global,Vt=Object.keys(pe),Zt=!1,te=!1,Ot=!1,Xt=lt.global.def("{}");Vt.forEach(function(Yt){var Ee=pe[Yt];if(vo.isDynamic(Ee)){typeof Ee=="function"&&(Ee=pe[Yt]=vo.unbox(Ee));var Le=Iu(Ee,null);Zt=Zt||Le.thisDep,Ot=Ot||Le.propDep,te=te||Le.contextDep}else{switch(he(Xt,".",Yt,"="),typeof Ee){case"number":he(Ee);break;case"string":he('"',Ee,'"');break;case"object":Array.isArray(Ee)&&he("[",Ee.join(),"]");break;default:he(lt.link(Ee));break}he(";")}});function bt(Yt,Ee){Vt.forEach(function(Le){var Ye=pe[Le];if(vo.isDynamic(Ye)){var Ve=Yt.invoke(Ee,Ye);Ee(Xt,".",Le,"=",Ve,";")}})}Ct.dynamic[Nt]=new vo.DynamicVariable(Ur,{thisDep:Zt,contextDep:te,propDep:Ot,ref:Xt,append:bt}),delete Ct.static[Nt]}function pa(lt,Ct,Nt,pe,he){var Vt=pn();Vt.stats=Vt.link(he),Object.keys(Ct.static).forEach(function(te){ri(Vt,Ct,te)}),$2.forEach(function(te){ri(Vt,lt,te)});var Zt=Zo(lt,Ct,Nt,pe,Vt);return Po(Vt,Zt),fe(Vt,Zt),xe(Vt,Zt),Vt.compile()}return{next:Lr,current:Xe,procs:function(){var lt=pn(),Ct=lt.proc("poll"),Nt=lt.proc("refresh"),pe=lt.block();Ct(pe),Nt(pe);var he=lt.shared,Vt=he.gl,Zt=he.next,te=he.current;pe(te,".dirty=false;"),ho(lt,Ct),ho(lt,Nt,null,!0);var Ot;ar&&(Ot=lt.link(ar)),Bt.oes_vertex_array_object&&Nt(lt.link(Bt.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Xt=0;Xt<ge.maxAttributes;++Xt){var bt=Nt.def(he.attributes,"[",Xt,"]"),Yt=lt.cond(bt,".buffer");Yt.then(Vt,".enableVertexAttribArray(",Xt,");",Vt,".bindBuffer(",lm,",",bt,".buffer.buffer);",Vt,".vertexAttribPointer(",Xt,",",bt,".size,",bt,".type,",bt,".normalized,",bt,".stride,",bt,".offset);").else(Vt,".disableVertexAttribArray(",Xt,");",Vt,".vertexAttrib4f(",Xt,",",bt,".x,",bt,".y,",bt,".z,",bt,".w);",bt,".buffer=null;"),Nt(Yt),ar&&Nt(Ot,".vertexAttribDivisorANGLE(",Xt,",",bt,".divisor);")}return Nt(lt.shared.vao,".currentVAO=null;",lt.shared.vao,".setVAO(",lt.shared.vao,".targetVAO);"),Object.keys(Ar).forEach(function(Ee){var Le=Ar[Ee],Ye=pe.def(Zt,".",Ee),Ve=lt.block();Ve("if(",Ye,"){",Vt,".enable(",Le,")}else{",Vt,".disable(",Le,")}",te,".",Ee,"=",Ye,";"),Nt(Ve),Ct("if(",Ye,"!==",te,".",Ee,"){",Ve,"}")}),Object.keys(je).forEach(function(Ee){var Le=je[Ee],Ye=Xe[Ee],Ve,Je,rn=lt.block();if(rn(Vt,".",Le,"("),lo(Ye)){var jr=Ye.length;Ve=lt.global.def(Zt,".",Ee),Je=lt.global.def(te,".",Ee),rn(Hi(jr,function(Kr){return Ve+"["+Kr+"]"}),");",Hi(jr,function(Kr){return Je+"["+Kr+"]="+Ve+"["+Kr+"];"}).join("")),Ct("if(",Hi(jr,function(Kr){return Ve+"["+Kr+"]!=="+Je+"["+Kr+"]"}).join("||"),"){",rn,"}")}else Ve=pe.def(Zt,".",Ee),Je=pe.def(te,".",Ee),rn(Ve,");",te,".",Ee,"=",Ve,";"),Ct("if(",Ve,"!==",Je,"){",rn,"}");Nt(rn)}),lt.compile()}(),compile:pa}}function q2(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var $L=34918,HL=34919,K2=35007,VL=function(j,_t){if(!_t.ext_disjoint_timer_query)return null;var Bt=[];function ge(){return Bt.pop()||_t.ext_disjoint_timer_query.createQueryEXT()}function Ue(ar){Bt.push(ar)}var _e=[];function ce(ar){var Sr=ge();_t.ext_disjoint_timer_query.beginQueryEXT(K2,Sr),_e.push(Sr),Qe(_e.length-1,_e.length,ar)}function ir(){_t.ext_disjoint_timer_query.endQueryEXT(K2)}function Ke(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var vr=[];function sr(){return vr.pop()||new Ke}function fr(ar){vr.push(ar)}var yr=[];function Qe(ar,Sr,Xe){var Lr=sr();Lr.startQueryIndex=ar,Lr.endQueryIndex=Sr,Lr.sum=0,Lr.stats=Xe,yr.push(Lr)}var dr=[],ae=[];function Te(){var ar,Sr,Xe=_e.length;if(Xe!==0){ae.length=Math.max(ae.length,Xe+1),dr.length=Math.max(dr.length,Xe+1),dr[0]=0,ae[0]=0;var Lr=0;for(ar=0,Sr=0;Sr<_e.length;++Sr){var tr=_e[Sr];_t.ext_disjoint_timer_query.getQueryObjectEXT(tr,HL)?(Lr+=_t.ext_disjoint_timer_query.getQueryObjectEXT(tr,$L),Ue(tr)):_e[ar++]=tr,dr[Sr+1]=Lr,ae[Sr+1]=ar}for(_e.length=ar,ar=0,Sr=0;Sr<yr.length;++Sr){var Ar=yr[Sr],je=Ar.startQueryIndex,Er=Ar.endQueryIndex;Ar.sum+=dr[Er]-dr[je];var dn=ae[je],kn=ae[Er];kn===dn?(Ar.stats.gpuTime+=Ar.sum/1e6,fr(Ar)):(Ar.startQueryIndex=dn,Ar.endQueryIndex=kn,yr[ar++]=Ar)}yr.length=ar}}return{beginQuery:ce,endQuery:ir,pushScopeStats:Qe,update:Te,getNumPendingQueries:function(){return _e.length},clear:function(){Bt.push.apply(Bt,_e);for(var ar=0;ar<Bt.length;ar++)_t.ext_disjoint_timer_query.deleteQueryEXT(Bt[ar]);_e.length=0,Bt.length=0},restore:function(){_e.length=0,Bt.length=0}}},Q2=16384,fl=256,GL=1024,J2=34962,yE="webglcontextlost",tT="webglcontextrestored",_E=1,WL=2,XL=3;function eT(j,_t){for(var Bt=0;Bt<j.length;++Bt)if(j[Bt]===_t)return Bt;return-1}function rT(j){var _t=gc(j);if(!_t)return null;var Bt=_t.gl,ge=Bt.getContextAttributes(),Ue=Bt.isContextLost(),_e=cd(Bt,_t);if(!_e)return null;var ce=dh(),ir=q2(),Ke=_e.extensions,vr=VL(Bt,Ke),sr=Ml(),fr=Bt.drawingBufferWidth,yr=Bt.drawingBufferHeight,Qe={tick:0,time:0,viewportWidth:fr,viewportHeight:yr,framebufferWidth:fr,framebufferHeight:yr,drawingBufferWidth:fr,drawingBufferHeight:yr,pixelRatio:_t.pixelRatio},dr={},ae={elements:null,primitive:4,count:-1,offset:0,instances:-1},Te=P0(Bt,Ke),ar=F0(Bt,ir,_t,Xe),Sr=rt(Bt,Ke,Te,ir,ar);function Xe(wn){return Sr.destroyBuffer(wn)}var Lr=r1(Bt,Ke,ar,ir),tr=Mt(Bt,ce,ir,_t),Ar=eu(Bt,Ke,Te,function(){dn.procs.poll()},Qe,ir,_t),je=Zu(Bt,Ke,Te,ir,_t),Er=F(Bt,Ke,Te,Ar,je,ir),dn=ny(Bt,ce,Ke,Te,ar,Lr,Ar,Er,dr,Sr,tr,ae,Qe,vr,_t),kn=le(Bt,Er,dn.procs.poll,Qe,ge,Ke,Te),wr=dn.next,rr=Bt.canvas,$e=[],pn=[],li=[],Or=[_t.onDestroy],ei=null;function Bn(){if($e.length===0){vr&&vr.update(),ei=null;return}ei=ju.next(Bn),Js();for(var wn=$e.length-1;wn>=0;--wn){var di=$e[wn];di&&di(Qe,null,0)}Bt.flush(),vr&&vr.update()}function An(){!ei&&$e.length>0&&(ei=ju.next(Bn))}function Vi(){ei&&(ju.cancel(Bn),ei=null)}function Lo(wn){wn.preventDefault(),Ue=!0,Vi(),pn.forEach(function(di){di()})}function As(wn){Bt.getError(),Ue=!1,_e.restore(),tr.restore(),ar.restore(),Ar.restore(),je.restore(),Er.restore(),Sr.restore(),vr&&vr.restore(),dn.procs.refresh(),An(),li.forEach(function(di){di()})}rr&&(rr.addEventListener(yE,Lo,!1),rr.addEventListener(tT,As,!1));function gi(){$e.length=0,Vi(),rr&&(rr.removeEventListener(yE,Lo),rr.removeEventListener(tT,As)),tr.clear(),Er.clear(),je.clear(),Ar.clear(),Lr.clear(),ar.clear(),Sr.clear(),vr&&vr.clear(),Or.forEach(function(wn){wn()})}function Oo(wn){Et(!!wn,"invalid args to regl({...})"),Et.type(wn,"object","invalid args to regl({...})");function di(he){var Vt=n({},he);delete Vt.uniforms,delete Vt.attributes,delete Vt.context,delete Vt.vao,"stencil"in Vt&&Vt.stencil.op&&(Vt.stencil.opBack=Vt.stencil.opFront=Vt.stencil.op,delete Vt.stencil.op);function Zt(te){if(te in Vt){var Ot=Vt[te];delete Vt[te],Object.keys(Ot).forEach(function(Xt){Vt[te+"."+Xt]=Ot[Xt]})}}return Zt("blend"),Zt("depth"),Zt("cull"),Zt("stencil"),Zt("polygonOffset"),Zt("scissor"),Zt("sample"),"vao"in he&&(Vt.vao=he.vao),Vt}function Ni(he){var Vt={},Zt={};return Object.keys(he).forEach(function(te){var Ot=he[te];vo.isDynamic(Ot)?Zt[te]=vo.unbox(Ot,te):Vt[te]=Ot}),{dynamic:Zt,static:Vt}}var Po=Ni(wn.context||{}),Ih=Ni(wn.uniforms||{}),Lt=Ni(wn.attributes||{}),xe=Ni(di(wn)),fe={gpuTime:0,cpuTime:0,count:0},Fr=dn.compile(xe,Lt,Ih,Po,fe),ri=Fr.draw,pa=Fr.batch,lt=Fr.scope,Ct=[];function Nt(he){for(;Ct.length<he;)Ct.push(null);return Ct}function pe(he,Vt){var Zt;if(Ue&&Et.raise("context lost"),typeof he=="function")return lt.call(this,null,he,0);if(typeof Vt=="function")if(typeof he=="number")for(Zt=0;Zt<he;++Zt)lt.call(this,null,Vt,Zt);else if(Array.isArray(he))for(Zt=0;Zt<he.length;++Zt)lt.call(this,he[Zt],Vt,Zt);else return lt.call(this,he,Vt,0);else if(typeof he=="number"){if(he>0)return pa.call(this,Nt(he|0),he|0)}else if(Array.isArray(he)){if(he.length)return pa.call(this,he,he.length)}else return ri.call(this,he)}return n(pe,{stats:fe})}var La=Er.setFBO=Oo({framebuffer:vo.define.call(null,_E,"framebuffer")});function Zo(wn,di){var Ni=0;dn.procs.poll();var Po=di.color;Po&&(Bt.clearColor(+Po[0]||0,+Po[1]||0,+Po[2]||0,+Po[3]||0),Ni|=Q2),"depth"in di&&(Bt.clearDepth(+di.depth),Ni|=fl),"stencil"in di&&(Bt.clearStencil(di.stencil|0),Ni|=GL),Et(!!Ni,"called regl.clear with no buffer specified"),Bt.clear(Ni)}function qo(wn){if(Et(typeof wn=="object"&&wn,"regl.clear() takes an object as input"),"framebuffer"in wn)if(wn.framebuffer&&wn.framebuffer_reglType==="framebufferCube")for(var di=0;di<6;++di)La(n({framebuffer:wn.framebuffer.faces[di]},wn),Zo);else La(wn,Zo);else Zo(null,wn)}function ho(wn){Et.type(wn,"function","regl.frame() callback must be a function"),$e.push(wn);function di(){var Ni=eT($e,wn);Et(Ni>=0,"cannot cancel a frame twice");function Po(){var Ih=eT($e,Po);$e[Ih]=$e[$e.length-1],$e.length-=1,$e.length<=0&&Vi()}$e[Ni]=Po}return An(),{cancel:di}}function vs(){var wn=wr.viewport,di=wr.scissor_box;wn[0]=wn[1]=di[0]=di[1]=0,Qe.viewportWidth=Qe.framebufferWidth=Qe.drawingBufferWidth=wn[2]=di[2]=Bt.drawingBufferWidth,Qe.viewportHeight=Qe.framebufferHeight=Qe.drawingBufferHeight=wn[3]=di[3]=Bt.drawingBufferHeight}function Js(){Qe.tick+=1,Qe.time=Jn(),vs(),dn.procs.poll()}function Ko(){vs(),dn.procs.refresh(),vr&&vr.update()}function Jn(){return(Ml()-sr)/1e3}Ko();function $s(wn,di){Et.type(di,"function","listener callback must be a function");var Ni;switch(wn){case"frame":return ho(di);case"lost":Ni=pn;break;case"restore":Ni=li;break;case"destroy":Ni=Or;break;default:Et.raise("invalid event, must be one of frame,lost,restore,destroy")}return Ni.push(di),{cancel:function(){for(var Po=0;Po<Ni.length;++Po)if(Ni[Po]===di){Ni[Po]=Ni[Ni.length-1],Ni.pop();return}}}}var Yi=n(Oo,{clear:qo,prop:vo.define.bind(null,_E),context:vo.define.bind(null,WL),this:vo.define.bind(null,XL),draw:Oo({}),buffer:function(wn){return ar.create(wn,J2,!1,!1)},elements:function(wn){return Lr.create(wn,!1)},texture:Ar.create2D,cube:Ar.createCube,renderbuffer:je.create,framebuffer:Er.create,framebufferCube:Er.createCube,vao:Sr.createVAO,attributes:ge,frame:ho,on:$s,limits:Te,hasExtension:function(wn){return Te.extensions.indexOf(wn.toLowerCase())>=0},read:kn,destroy:gi,_gl:Bt,_refresh:Ko,poll:function(){Js(),vr&&vr.update()},now:Jn,stats:ir});return _t.onDone(null,Yi),Yi}return rT})})($tt);var HUt=$tt.exports;const VUt=sa(HUt);var GUt=class{constructor(e,t){const{buffer:r,offset:n,stride:i,normalized:a,size:o,divisor:s}=t;this.buffer=r,this.attribute={buffer:r.get(),offset:n||0,stride:i||0,normalized:a||!1,divisor:s||0},o&&(this.attribute.size=o)}get(){return this.attribute}updateBuffer(e){this.buffer.subData(e)}destroy(){this.buffer.destroy()}},WUt={[K.POINTS]:"points",[K.LINES]:"lines",[K.LINE_LOOP]:"line loop",[K.LINE_STRIP]:"line strip",[K.TRIANGLES]:"triangles",[K.TRIANGLE_FAN]:"triangle fan",[K.TRIANGLE_STRIP]:"triangle strip"},Htt={[K.STATIC_DRAW]:"static",[K.DYNAMIC_DRAW]:"dynamic",[K.STREAM_DRAW]:"stream"},Y4={[K.BYTE]:"int8",[K.INT]:"int32",[K.UNSIGNED_BYTE]:"uint8",[K.UNSIGNED_SHORT]:"uint16",[K.UNSIGNED_INT]:"uint32",[K.FLOAT]:"float"},XUt={[K.ALPHA]:"alpha",[K.LUMINANCE]:"luminance",[K.LUMINANCE_ALPHA]:"luminance alpha",[K.RGB]:"rgb",[K.RGBA]:"rgba",[K.RGBA4]:"rgba4",[K.RGB5_A1]:"rgb5 a1",[K.RGB565]:"rgb565",[K.DEPTH_COMPONENT]:"depth",[K.DEPTH_STENCIL]:"depth stencil"},jUt={[K.DONT_CARE]:"dont care",[K.NICEST]:"nice",[K.FASTEST]:"fast"},qH={[K.NEAREST]:"nearest",[K.LINEAR]:"linear",[K.LINEAR_MIPMAP_LINEAR]:"mipmap",[K.NEAREST_MIPMAP_LINEAR]:"nearest mipmap linear",[K.LINEAR_MIPMAP_NEAREST]:"linear mipmap nearest",[K.NEAREST_MIPMAP_NEAREST]:"nearest mipmap nearest"},KH={[K.REPEAT]:"repeat",[K.CLAMP_TO_EDGE]:"clamp",[K.MIRRORED_REPEAT]:"mirror"},YUt={[K.NONE]:"none",[K.BROWSER_DEFAULT_WEBGL]:"browser"},ZUt={[K.NEVER]:"never",[K.ALWAYS]:"always",[K.LESS]:"less",[K.LEQUAL]:"lequal",[K.GREATER]:"greater",[K.GEQUAL]:"gequal",[K.EQUAL]:"equal",[K.NOTEQUAL]:"notequal"},QH={[K.FUNC_ADD]:"add",[K.MIN_EXT]:"min",[K.MAX_EXT]:"max",[K.FUNC_SUBTRACT]:"subtract",[K.FUNC_REVERSE_SUBTRACT]:"reverse subtract"},KT={[K.ZERO]:"zero",[K.ONE]:"one",[K.SRC_COLOR]:"src color",[K.ONE_MINUS_SRC_COLOR]:"one minus src color",[K.SRC_ALPHA]:"src alpha",[K.ONE_MINUS_SRC_ALPHA]:"one minus src alpha",[K.DST_COLOR]:"dst color",[K.ONE_MINUS_DST_COLOR]:"one minus dst color",[K.DST_ALPHA]:"dst alpha",[K.ONE_MINUS_DST_ALPHA]:"one minus dst alpha",[K.CONSTANT_COLOR]:"constant color",[K.ONE_MINUS_CONSTANT_COLOR]:"one minus constant color",[K.CONSTANT_ALPHA]:"constant alpha",[K.ONE_MINUS_CONSTANT_ALPHA]:"one minus constant alpha",[K.SRC_ALPHA_SATURATE]:"src alpha saturate"},qUt={[K.NEVER]:"never",[K.ALWAYS]:"always",[K.LESS]:"less",[K.LEQUAL]:"lequal",[K.GREATER]:"greater",[K.GEQUAL]:"gequal",[K.EQUAL]:"equal",[K.NOTEQUAL]:"notequal"},H1={[K.ZERO]:"zero",[K.KEEP]:"keep",[K.REPLACE]:"replace",[K.INVERT]:"invert",[K.INCR]:"increment",[K.DECR]:"decrement",[K.INCR_WRAP]:"increment wrap",[K.DECR_WRAP]:"decrement wrap"},KUt={[K.FRONT]:"front",[K.BACK]:"back"},QUt=class{constructor(e,t){this.isDestroyed=!1;const{data:r,usage:n,type:i}=t;this.buffer=e.buffer({data:r,usage:Htt[n||K.STATIC_DRAW],type:Y4[i||K.UNSIGNED_BYTE]})}get(){return this.buffer}destroy(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}subData({data:e,offset:t}){this.buffer.subdata(e,t)}},JUt=class{constructor(e,t){const{data:r,usage:n,type:i,count:a}=t;this.elements=e.elements({data:r,usage:Htt[n||K.STATIC_DRAW],type:Y4[i||K.UNSIGNED_BYTE],count:a})}get(){return this.elements}subData({data:e}){this.elements.subdata(e)}destroy(){}},t9t=class{constructor(e,t){const{width:r,height:n,color:i,colors:a}=t,o={width:r,height:n};Array.isArray(a)&&(o.colors=a.map(s=>s.get())),i&&typeof i!="boolean"&&(o.color=i.get()),this.framebuffer=e.framebuffer(o)}get(){return this.framebuffer}destroy(){this.framebuffer.destroy()}resize({width:e,height:t}){this.framebuffer.resize(e,t)}},e9t=Object.defineProperty,r9t=Object.defineProperties,n9t=Object.getOwnPropertyDescriptors,JH=Object.getOwnPropertySymbols,i9t=Object.prototype.hasOwnProperty,a9t=Object.prototype.propertyIsEnumerable,tV=(e,t,r)=>t in e?e9t(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ow=(e,t)=>{for(var r in t||(t={}))i9t.call(t,r)&&tV(e,r,t[r]);if(JH)for(var r of JH(t))a9t.call(t,r)&&tV(e,r,t[r]);return e},o9t=(e,t)=>r9t(e,n9t(t)),{isPlainObject:s9t,isTypedArray:l9t}=as,u9t=class{constructor(e,t){this.destroyed=!1,this.uniforms={},this.reGl=e;const{vs:r,fs:n,attributes:i,uniforms:a,primitive:o,count:s,elements:l,depth:u,cull:c,instances:f}=t,d={platformString:"WebGL1",glslVersion:"#version 100",explicitBindingLocations:!1,separateSamplerTextures:!1,viewportOrigin:kd.LOWER_LEFT,clipSpaceNearZ:Qx.NEGATIVE_ONE,supportMRT:!1},v={};this.options=t,a&&(this.uniforms=this.extractUniforms(a),Object.keys(a).forEach(M=>{v[M]=e.prop(M)}));const g={};Object.keys(i).forEach(M=>{g[M]=i[M].get()});const x=OU(rb(d,"frag",n,null,!1)),w=OU(rb(d,"vert",r,null,!1)),S={attributes:g,frag:x,uniforms:v,vert:w,colorMask:e.prop("colorMask"),lineWidth:1,blend:{enable:e.prop("blend.enable"),func:e.prop("blend.func"),equation:e.prop("blend.equation"),color:e.prop("blend.color")},stencil:{enable:e.prop("stencil.enable"),mask:e.prop("stencil.mask"),func:e.prop("stencil.func"),opFront:e.prop("stencil.opFront"),opBack:e.prop("stencil.opBack")},primitive:WUt[o===void 0?K.TRIANGLES:o]};f&&(S.instances=f),s?S.count=s:l&&(S.elements=l.get()),this.initDepthDrawParams({depth:u},S),this.initCullDrawParams({cull:c},S),this.drawCommand=e(S),this.drawParams=S}updateAttributesAndElements(e,t){const r={};Object.keys(e).forEach(n=>{r[n]=e[n].get()}),this.drawParams.attributes=r,this.drawParams.elements=t.get(),this.drawCommand=this.reGl(this.drawParams)}updateAttributes(e){const t={};Object.keys(e).forEach(r=>{t[r]=e[r].get()}),this.drawParams.attributes=t,this.drawCommand=this.reGl(this.drawParams)}addUniforms(e){this.uniforms=ow(ow({},this.uniforms),this.extractUniforms(e))}draw(e,t){if(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)return;const r=ow(ow({},this.uniforms),this.extractUniforms(e.uniforms||{})),n={};Object.keys(r).forEach(i=>{const a=typeof r[i];a==="boolean"||a==="number"||Array.isArray(r[i])||r[i].BYTES_PER_ELEMENT?n[i]=r[i]:n[i]=r[i].get()}),n.blend=t?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(e),n.stencil=this.getStencilDrawParams(e),n.colorMask=this.getColorMaskDrawParams(e,t),this.drawCommand(n)}destroy(){var e,t;(t=(e=this.drawParams)==null?void 0:e.elements)==null||t.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(r=>{r==null||r.destroy()}),this.destroyed=!0}initDepthDrawParams({depth:e},t){e&&(t.depth={enable:e.enable===void 0?!0:!!e.enable,mask:e.mask===void 0?!0:!!e.mask,func:ZUt[e.func||K.LESS],range:e.range||[0,1]})}getBlendDrawParams({blend:e}){const{enable:t,func:r,equation:n,color:i=[0,0,0,0]}=e||{};return{enable:!!t,func:{srcRGB:KT[r&&r.srcRGB||K.SRC_ALPHA],srcAlpha:KT[r&&r.srcAlpha||K.SRC_ALPHA],dstRGB:KT[r&&r.dstRGB||K.ONE_MINUS_SRC_ALPHA],dstAlpha:KT[r&&r.dstAlpha||K.ONE_MINUS_SRC_ALPHA]},equation:{rgb:QH[n&&n.rgb||K.FUNC_ADD],alpha:QH[n&&n.alpha||K.FUNC_ADD]},color:i}}getStencilDrawParams({stencil:e}){const{enable:t,mask:r=-1,func:n={cmp:K.ALWAYS,ref:0,mask:-1},opFront:i={fail:K.KEEP,zfail:K.KEEP,zpass:K.KEEP},opBack:a={fail:K.KEEP,zfail:K.KEEP,zpass:K.KEEP}}=e||{};return{enable:!!t,mask:r,func:o9t(ow({},n),{cmp:qUt[n.cmp]}),opFront:{fail:H1[i.fail],zfail:H1[i.zfail],zpass:H1[i.zpass]},opBack:{fail:H1[a.fail],zfail:H1[a.zfail],zpass:H1[a.zpass]}}}getColorMaskDrawParams({stencil:e},t){return e!=null&&e.enable&&e.opFront&&!t?[!1,!1,!1,!1]:[!0,!0,!0,!0]}initCullDrawParams({cull:e},t){if(e){const{enable:r,face:n=K.BACK}=e;t.cull={enable:!!r,face:KUt[n]}}}extractUniforms(e){const t={};return Object.keys(e).forEach(r=>{this.extractUniformsRecursively(r,e[r],t,"")}),t}extractUniformsRecursively(e,t,r,n){if(t===null||typeof t=="number"||typeof t=="boolean"||Array.isArray(t)&&typeof t[0]=="number"||l9t(t)||t===""||"resize"in t){r[`${n&&n+"."}${e}`]=t;return}s9t(t)&&Object.keys(t).forEach(i=>{this.extractUniformsRecursively(i,t[i],r,`${n&&n+"."}${e}`)}),Array.isArray(t)&&t.forEach((i,a)=>{Object.keys(i).forEach(o=>{this.extractUniformsRecursively(o,i[o],r,`${n&&n+"."}${e}[${a}]`)})})}},c9t=class{constructor(e,t){this.isDestroy=!1;const{data:r,type:n=K.UNSIGNED_BYTE,width:i,height:a,flipY:o=!1,format:s=K.RGBA,mipmap:l=!1,wrapS:u=K.CLAMP_TO_EDGE,wrapT:c=K.CLAMP_TO_EDGE,aniso:f=0,alignment:d=1,premultiplyAlpha:v=!1,mag:g=K.NEAREST,min:x=K.NEAREST,colorSpace:w=K.BROWSER_DEFAULT_WEBGL,x:S=0,y:M=0,copy:R=!1}=t;this.width=i,this.height=a;const I={width:i,height:a,type:Y4[n],format:XUt[s],wrapS:KH[u],wrapT:KH[c],mag:qH[g],min:qH[x],alignment:d,flipY:o,colorSpace:YUt[w],premultiplyAlpha:v,aniso:f,x:S,y:M,copy:R};r&&(I.data=r),typeof l=="number"?I.mipmap=jUt[l]:typeof l=="boolean"&&(I.mipmap=l),this.texture=e.texture(I)}get(){return this.texture}update(e={}){this.texture(e)}bind(){this.texture._texture.bind()}resize({width:e,height:t}){this.texture.resize(e,t),this.width=e,this.height=t}getSize(){return[this.width,this.height]}destroy(){var e;this.isDestroy||(e=this.texture)==null||e.destroy(),this.isDestroy=!0}},qO=(e,t,r)=>new Promise((n,i)=>{var a=l=>{try{s(r.next(l))}catch(u){i(u)}},o=l=>{try{s(r.throw(l))}catch(u){i(u)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(a,o);s((r=r.apply(e,t)).next())}),h9t=class{constructor(){this.uniformBuffers=[],this.queryVerdorInfo=()=>"WebGL1",this.createModel=e=>new u9t(this.gl,e),this.createAttribute=e=>new GUt(this.gl,e),this.createBuffer=e=>new QUt(this.gl,e),this.createElements=e=>new JUt(this.gl,e),this.createTexture2D=e=>new c9t(this.gl,e),this.createFramebuffer=e=>new t9t(this.gl,e),this.useFramebuffer=(e,t)=>{this.gl({framebuffer:e?e.get():null})(t)},this.useFramebufferAsync=(e,t)=>qO(this,null,function*(){this.gl({framebuffer:e?e.get():null})(t)}),this.clear=e=>{var t;const{color:r,depth:n,stencil:i,framebuffer:a=null}=e,o={color:r,depth:n,stencil:i};o.framebuffer=a===null?a:a.get(),(t=this.gl)==null||t.clear(o)},this.viewport=({x:e,y:t,width:r,height:n})=>{this.gl._gl.viewport(e,t,r,n),this.width=r,this.height=n,this.gl._refresh()},this.readPixels=e=>{const{framebuffer:t,x:r,y:n,width:i,height:a}=e,o={x:r,y:n,width:i,height:a};return t&&(o.framebuffer=t.get()),this.gl.read(o)},this.readPixelsAsync=e=>qO(this,null,function*(){return this.readPixels(e)}),this.getViewportSize=()=>({width:this.gl._gl.drawingBufferWidth,height:this.gl._gl.drawingBufferHeight}),this.getContainer=()=>{var e;return(e=this.canvas)==null?void 0:e.parentElement},this.getCanvas=()=>this.canvas,this.getGLContext=()=>this.gl._gl,this.destroy=()=>{var e,t,r;this.canvas=null,(r=(t=(e=this.gl)==null?void 0:e._gl)==null?void 0:t.getExtension("WEBGL_lose_context"))==null||r.loseContext(),this.gl.destroy(),this.gl=null}}init(e,t,r){return qO(this,null,function*(){this.canvas=e,r?this.gl=r:this.gl=yield new Promise((n,i)=>{VUt({canvas:this.canvas,attributes:{alpha:!0,antialias:t.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,stencil:t.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:(a,o)=>{(a||!o)&&i(a),n(o)}})}),this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")}})}getPointSizeRange(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}testExtension(e){return!!this.getGLContext().getExtension(e)}setState(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}setBaseState(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}setCustomLayerDefaults(){const e=this.getGLContext();e.disable(e.CULL_FACE)}setDirty(e){this.isDirty=e}getDirty(){return this.isDirty}beginFrame(){}endFrame(){}},KO=["selectstart","selecting","selectend"],f9t=class extends Gu.EventEmitter{constructor(e,t={}){super(),this.isEnable=!1,this.onDragStart=r=>{this.box.style.display="block",this.startEvent=this.endEvent=r,this.syncBoxBound(),this.emit("selectstart",this.getLngLatBox(),this.startEvent,this.endEvent)},this.onDragging=r=>{this.endEvent=r,this.syncBoxBound(),this.emit("selecting",this.getLngLatBox(),this.startEvent,this.endEvent)},this.onDragEnd=r=>{this.endEvent=r,this.box.style.display="none",this.emit("selectend",this.getLngLatBox(),this.startEvent,this.endEvent)},this.scene=e,this.options=t}get container(){return this.scene.getMapService().getMarkerContainer()}enable(){if(this.isEnable)return;const{className:e}=this.options;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){const t=Ua("div",void 0,this.container);t.classList.add("l7-select-box"),e&&t.classList.add(e),t.style.display="none",this.box=t}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}disable(){this.isEnable&&(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}syncBoxBound(){const{x:e,y:t}=this.startEvent,{x:r,y:n}=this.endEvent,i=Math.min(e,r),a=Math.min(t,n),o=Math.abs(e-r),s=Math.abs(t-n);this.box.style.top=`${a}px`,this.box.style.left=`${i}px`,this.box.style.width=`${o}px`,this.box.style.height=`${s}px`}getLngLatBox(){const{lngLat:{lng:e,lat:t}}=this.startEvent,{lngLat:{lng:r,lat:n}}=this.endEvent;return CAt([[e,t],[r,n]])}},d9t=Object.defineProperty,p9t=Object.defineProperties,v9t=Object.getOwnPropertyDescriptors,eV=Object.getOwnPropertySymbols,g9t=Object.prototype.hasOwnProperty,m9t=Object.prototype.propertyIsEnumerable,rV=(e,t,r)=>t in e?d9t(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,y9t=(e,t)=>{for(var r in t||(t={}))g9t.call(t,r)&&rV(e,r,t[r]);if(eV)for(var r of eV(t))m9t.call(t,r)&&rV(e,r,t[r]);return e},_9t=(e,t)=>p9t(e,v9t(t)),sw=(e,t,r)=>new Promise((n,i)=>{var a=l=>{try{s(r.next(l))}catch(u){i(u)}},o=l=>{try{s(r.throw(l))}catch(u){i(u)}},s=l=>l.done?n(l.value):Promise.resolve(l.value).then(a,o);s((r=r.apply(e,t)).next())}),x9t=class{constructor(e){const{id:t,map:r,renderer:n="device"}=e,i=pOt();this.container=i,r.setContainer(i,t),n==="regl"?i.rendererService=new h9t:i.rendererService=new $Ut,this.sceneService=i.sceneService,this.mapService=i.mapService,this.iconService=i.iconService,this.fontService=i.fontService,this.controlService=i.controlService,this.layerService=i.layerService,this.debugService=i.debugService,this.debugService.setEnable(e.debug),this.markerService=i.markerService,this.interactionService=i.interactionService,this.popupService=i.popupService,this.boxSelect=new f9t(this,{}),this.initComponent(t),this.sceneService.init(e),this.initControl()}get map(){return this.mapService.map}get loaded(){return this.sceneService.loaded}getServiceContainer(){return this.container}getSize(){return this.mapService.getSize()}getMinZoom(){return this.mapService.getMinZoom()}getMaxZoom(){return this.mapService.getMaxZoom()}getType(){return this.mapService.getType()}getMapContainer(){return this.mapService.getMapContainer()}getMapCanvasContainer(){return this.mapService.getMapCanvasContainer()}getMapService(){return this.mapService}getDebugService(){return this.debugService}exportPng(e){return sw(this,null,function*(){return this.sceneService.exportPng(e)})}exportMap(e){return sw(this,null,function*(){return this.sceneService.exportPng(e)})}registerRenderService(e){this.sceneService.loaded?new e(this).init():this.on("loaded",()=>{new e(this).init()})}setBgColor(e){this.mapService.setBgColor(e)}addLayer(e){this.loaded?this.preAddLayer(e):this.once("loaded",()=>{this.preAddLayer(e)})}preAddLayer(e){const t=Zw(this.container);if(e.setContainer(t),this.sceneService.addLayer(e),e.inited){this.initTileLayer(e);const r=this.initMask(e);this.addMask(r,e.id)}else e.on("inited",()=>{this.initTileLayer(e);const r=this.initMask(e);this.addMask(r,e.id)})}initMask(e){const{mask:t,maskfence:r,maskColor:n="#000",maskOpacity:i=0}=e.getLayerConfig();return!t||!r?void 0:new rtt().source(r).shape("fill").style({color:n,opacity:i})}addMask(e,t){if(!e)return;const r=this.getLayer(t);if(r){const n=Zw(this.container);e.setContainer(n),r.addMaskLayer(e),this.sceneService.addMask(e)}else console.warn("parent layer not find!")}getPickedLayer(){return this.layerService.pickedLayerId}getLayers(){return this.layerService.getLayers()}getLayer(e){return this.layerService.getLayer(e)}getLayerByName(e){return this.layerService.getLayerByName(e)}removeLayer(e,t){return sw(this,null,function*(){yield this.layerService.remove(e,t)})}removeAllLayer(){return sw(this,null,function*(){yield this.layerService.removeAllLayers()})}render(){this.sceneService.render()}setEnableRender(e){this.layerService.setEnableRender(e)}addIconFont(e,t){this.fontService.addIconFont(e,t)}addIconFonts(e){e.forEach(([t,r])=>{this.fontService.addIconFont(t,r)})}addFontFace(e,t){this.fontService.once("fontloaded",r=>{this.emit("fontloaded",r)}),this.fontService.addFontFace(e,t)}addImage(e,t){return sw(this,null,function*(){yield this.iconService.addImage(e,t)})}hasImage(e){return this.iconService.hasImage(e)}removeImage(e){this.iconService.removeImage(e)}addIconFontGlyphs(e,t){this.fontService.addIconGlyphs(t)}addControl(e){this.controlService.addControl(e,this.container)}removeControl(e){this.controlService.removeControl(e)}getControlByName(e){return this.controlService.getControlByName(e)}addMarker(e){this.markerService.addMarker(e)}addMarkerLayer(e){this.markerService.addMarkerLayer(e)}removeMarkerLayer(e){this.markerService.removeMarkerLayer(e)}removeAllMarkers(){this.markerService.removeAllMarkers()}removeAllMakers(){console.warn("removeAllMakers 已废弃，请使用 removeAllMarkers"),this.markerService.removeAllMarkers()}addPopup(e){this.popupService.addPopup(e)}removePopup(e){this.popupService.removePopup(e)}on(e,t){var r;KO.includes(e)?(r=this.boxSelect)==null||r.on(e,t):MT.includes(e)?this.sceneService.on(e,t):this.mapService.on(e,t)}once(e,t){var r;KO.includes(e)?(r=this.boxSelect)==null||r.once(e,t):MT.includes(e)?this.sceneService.once(e,t):this.mapService.once(e,t)}emit(e,t){MT.indexOf(e)===-1?this.mapService.on(e,t):this.sceneService.emit(e,t)}off(e,t){var r;KO.includes(e)?(r=this.boxSelect)==null||r.off(e,t):MT.includes(e)?this.sceneService.off(e,t):this.mapService.off(e,t)}getZoom(){return this.mapService.getZoom()}getCenter(e){return this.mapService.getCenter(e)}setCenter(e,t){return this.mapService.setCenter(e,t)}getPitch(){return this.mapService.getPitch()}setPitch(e){return this.mapService.setPitch(e)}getRotation(){return this.mapService.getRotation()}getBounds(){return this.mapService.getBounds()}setRotation(e){this.mapService.setRotation(e)}zoomIn(){this.mapService.zoomIn()}zoomOut(){this.mapService.zoomOut()}panTo(e){this.mapService.panTo(e)}panBy(e,t){this.mapService.panBy(e,t)}getContainer(){return this.mapService.getContainer()}setZoom(e){this.mapService.setZoom(e)}fitBounds(e,t){const{fitBoundsOptions:r,animate:n}=this.sceneService.getSceneConfig();this.mapService.fitBounds(e,t||_9t(y9t({},r),{animate:n}))}setZoomAndCenter(e,t){this.mapService.setZoomAndCenter(e,t)}setMapStyle(e){this.mapService.setMapStyle(e)}setMapStatus(e){this.mapService.setMapStatus(e)}pixelToLngLat(e){return this.mapService.pixelToLngLat(e)}lngLatToPixel(e){return this.mapService.lngLatToPixel(e)}containerToLngLat(e){return this.mapService.containerToLngLat(e)}lngLatToContainer(e){return this.mapService.lngLatToContainer(e)}destroy(){this.sceneService.destroy()}registerPostProcessingPass(e){this.container.postProcessingPass.name=new e}enableShaderPick(){this.layerService.enableShaderPick()}diasbleShaderPick(){this.layerService.disableShaderPick()}enableBoxSelect(e=!0){this.boxSelect.enable(),e&&this.boxSelect.once("selectend",()=>{this.disableBoxSelect()})}disableBoxSelect(){this.boxSelect.disable()}static addProtocol(e,t){KA.REGISTERED_PROTOCOLS[e]=t}static removeProtocol(e){delete KA.REGISTERED_PROTOCOLS[e]}getProtocol(e){return KA.REGISTERED_PROTOCOLS[e]}startAnimate(){this.layerService.startAnimate()}stopAnimate(){this.layerService.stopAnimate()}getPointSizeRange(){return this.sceneService.getPointSizeRange()}initComponent(e){this.controlService.init({container:kK(e)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}initControl(){const{logoVisible:e,logoPosition:t}=this.sceneService.getSceneConfig();e&&this.addControl(new yDt({position:t}))}initTileLayer(e){e.getSource().isTile&&(e.tileLayer=new u6t(e))}},eh=function(e){return e!==null&&typeof e!="function"&&isFinite(e.length)},Up=function(e,t){return eh(e)?e.indexOf(t)>-1:!1},Al=function(e,t){if(!eh(e))return e;for(var r=[],n=0;n<e.length;n++){var i=e[n];t(i,n)&&r.push(i)}return r},Vtt=function(e,t){return t===void 0&&(t=[]),Al(e,function(r){return!Up(t,r)})},b9t={}.toString,ad=function(e,t){return b9t.call(e)==="[object "+t+"]"};const Rr=function(e){return ad(e,"Function")};var ze=function(e){return e==null};const Fe=function(e){return Array.isArray?Array.isArray(e):ad(e,"Array")},Xi=function(e){var t=typeof e;return e!==null&&t==="object"||t==="function"};function ft(e,t){if(e){var r;if(Fe(e))for(var n=0,i=e.length;n<i&&(r=t(e[n],n),r!==!1);n++);else if(Xi(e)){for(var a in e)if(e.hasOwnProperty(a)&&(r=t(e[a],a),r===!1))break}}}var P_=Object.keys?function(e){return Object.keys(e)}:function(e){var t=[];return ft(e,function(r,n){Rr(e)&&n==="prototype"||t.push(n)}),t};function Z4(e,t){var r=P_(t),n=r.length;if(ze(e))return!n;for(var i=0;i<n;i+=1){var a=r[i];if(t[a]!==e[a]||!(a in e))return!1}return!0}var wR=function(e){return typeof e=="object"&&e!==null},Hd=function(e){if(!wR(e)||!ad(e,"Object"))return!1;if(Object.getPrototypeOf(e)===null)return!0;for(var t=e;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t};function Xf(e,t){if(!Fe(e))return null;var r;if(Rr(t)&&(r=t),Hd(t)&&(r=function(i){return Z4(i,t)}),r){for(var n=0;n<e.length;n+=1)if(r(e[n]))return e[n]}return null}function q4(e,t,r){r===void 0&&(r=0);for(var n=r;n<e.length;n++)if(t(e[n],n))return n;return-1}var Gtt=function(e,t){for(var r=null,n=0;n<e.length;n++){var i=e[n],a=i[t];if(!ze(a)){Fe(a)?r=a[0]:r=a;break}}return r},rh=function(e){if(!Fe(e))return[];for(var t=[],r=0;r<e.length;r++)t=t.concat(e[r]);return t},Wtt=function(e,t){if(t===void 0&&(t=[]),!Fe(e))t.push(e);else for(var r=0;r<e.length;r+=1)Wtt(e[r],t);return t};const nh=function(e){if(Fe(e))return e.reduce(function(t,r){return Math.max(t,r)},e[0])},Wh=function(e){if(Fe(e))return e.reduce(function(t,r){return Math.min(t,r)},e[0])};var K4=function(e){var t=e.filter(function(o){return!isNaN(o)});if(!t.length)return{min:0,max:0};if(Fe(e[0])){for(var r=[],n=0;n<e.length;n++)r=r.concat(e[n]);t=r}var i=nh(t),a=Wh(t);return{min:a,max:i}},Xtt=Array.prototype,E9t=Xtt.splice,w9t=Xtt.indexOf,C9t=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n=0;n<t.length;n++)for(var i=t[n],a=-1;(a=w9t.call(e,i))>-1;)E9t.call(e,a,1);return e},S9t=Array.prototype.splice,jtt=function(t,r){if(!eh(t))return[];for(var n=t?r.length:0,i=n-1;n--;){var a=void 0,o=r[n];(n===i||o!==a)&&(a=o,S9t.call(t,o,1))}return t},du=function(e,t,r){if(!Fe(e)&&!Hd(e))return e;var n=r;return ft(e,function(i,a){n=t(n,i,a)}),n},Ytt=function(e,t){var r=[];if(!eh(e))return r;for(var n=-1,i=[],a=e.length;++n<a;){var o=e[n];t(o,n,e)&&(r.push(o),i.push(n))}return jtt(e,i),r};const en=function(e){return ad(e,"String")};function Ztt(e,t){var r;if(Rr(t))r=function(i,a){return t(i)-t(a)};else{var n=[];en(t)?n.push(t):Fe(t)&&(n=t),r=function(i,a){for(var o=0;o<n.length;o+=1){var s=n[o];if(i[s]>a[s])return 1;if(i[s]<a[s])return-1}return 0}}return e.sort(r),e}function xg(e,t){t===void 0&&(t=new Map);var r=[];if(Array.isArray(e))for(var n=0,i=e.length;n<i;n++){var a=e[n];t.has(a)||(r.push(a),t.set(a,!0))}return r}var T9t=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return xg([].concat.apply([],e))};const Zf=function(e,t){for(var r=[],n={},i=0;i<e.length;i++){var a=e[i],o=a[t];if(!ze(o)){Fe(o)||(o=[o]);for(var s=0;s<o.length;s++){var l=o[s];n[l]||(r.push(l),n[l]=!0)}}}return r};function Kc(e){if(eh(e))return e[0]}function Ds(e){if(eh(e)){var t=e;return t[t.length-1]}}function A9t(e,t){return Fe(e)||en(e)?e[0]===t:!1}function M9t(e,t){return Fe(e)||en(e)?e[e.length-1]===t:!1}var t3=function(e,t){for(var r=0;r<e.length;r++)if(!t(e[r],r))return!1;return!0},XS=function(e,t){for(var r=0;r<e.length;r++)if(t(e[r],r))return!0;return!1},R9t=Object.prototype.hasOwnProperty;function Qc(e,t){if(!t||!Fe(e))return{};for(var r={},n=Rr(t)?t:function(s){return s[t]},i,a=0;a<e.length;a++){var o=e[a];i=n(o),R9t.call(r,i)?r[i].push(o):r[i]=[o]}return r}function Q4(e,t){if(!t)return{0:e};if(!Rr(t)){var r=Fe(t)?t:t.replace(/\s+/g,"").split("*");t=function(n){for(var i="_",a=0,o=r.length;a<o;a++)i+=n[r[a]]&&n[r[a]].toString();return i}}return Qc(e,t)}const qtt=function(e,t){if(!t)return[e];var r=Q4(e,t),n=[];for(var i in r)n.push(r[i]);return n};function I9t(e,t){return e["_wrap_"+t]}function L9t(e,t){if(e["_wrap_"+t])return e["_wrap_"+t];var r=function(n){e[t](n)};return e["_wrap_"+t]=r,r}var nV={};function O9t(e){var t=nV[e];if(!t){for(var r=e.toString(16),n=r.length;n<6;n++)r="0"+r;t="#"+r,nV[e]=t}return t}function P9t(e){var t=0,r=0,n=0,i=0;return Fe(e)?e.length===1?t=r=n=i=e[0]:e.length===2?(t=n=e[0],r=i=e[1]):e.length===3?(t=e[0],r=i=e[1],n=e[2]):(t=e[0],r=e[1],n=e[2],i=e[3]):t=r=n=i=e,{r1:t,r2:r,r3:n,r4:i}}var to=function(e,t,r){return e<t?t:e>r?r:e},dM=function(e,t){var r=t.toString(),n=r.indexOf(".");if(n===-1)return Math.round(e);var i=r.substr(n+1).length;return i>20&&(i=20),parseFloat(e.toFixed(i))},Rn=function(e){return ad(e,"Number")},D9t=function(e){return Rn(e)&&e%1!==0},F9t=function(e){return Rn(e)&&e%2===0},B9t=Number.isInteger?Number.isInteger:function(e){return Rn(e)&&e%1===0},N9t=function(e){return Rn(e)&&e<0},k9t=1e-5;function xl(e,t,r){return r===void 0&&(r=k9t),Math.abs(e-t)<r}var z9t=function(e){return Rn(e)&&e%2!==0},U9t=function(e){return Rn(e)&&e>0};const J4=function(e,t){if(Fe(e)){for(var r,n=-1/0,i=0;i<e.length;i++){var a=e[i],o=Rr(t)?t(a):a[t];o>n&&(r=a,n=o)}return r}},Ktt=function(e,t){if(Fe(e)){for(var r,n=1/0,i=0;i<e.length;i++){var a=e[i],o=Rr(t)?t(a):a[t];o<n&&(r=a,n=o)}return r}};var jS=function(e,t){return(e%t+t)%t},$9t=180/Math.PI,H9t=function(e){return $9t*e};const V9t=parseInt;var G9t=Math.PI/180,YS=function(e){return G9t*e};const ev=function(e,t){return e.hasOwnProperty(t)};var Bb=Object.values?function(e){return Object.values(e)}:function(e){var t=[];return ft(e,function(r,n){Rr(e)&&n==="prototype"||t.push(r)}),t};const W9t=function(e,t){return Up(Bb(e),t)},x0=function(e){return ze(e)?"":e.toString()};var b0=function(e){return x0(e).toLowerCase()},X9t=function(e){var t=x0(e);return t.charAt(0).toLowerCase()+t.substring(1)},j9t=function(e){return x0(e).toUpperCase()},E0=function(e){var t=x0(e);return t.charAt(0).toUpperCase()+t.substring(1)},Y9t={}.toString,Qtt=function(e){return Y9t.call(e).replace(/^\[object /,"").replace(/]$/,"")},Z9t=function(e){return ad(e,"Arguments")},bg=function(e){return ad(e,"Boolean")},tN=function(e){return ad(e,"Date")},q9t=function(e){return ad(e,"Error")};function K9t(e){return Rn(e)&&isFinite(e)}var Jtt=function(e){return e===null},Q9t=Object.prototype,tet=function(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||Q9t;return e===r},J9t=function(e){return ad(e,"RegExp")},Gl=function(e){return e===void 0},eN=function(e){return e instanceof Element||e instanceof HTMLDocument};function eet(e){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(r){return setTimeout(r,16)};return t(e)}function ret(e){var t=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||clearTimeout;t(e)}function QO(e,t){for(var r in t)t.hasOwnProperty(r)&&r!=="constructor"&&t[r]!==void 0&&(e[r]=t[r])}function Qi(e,t,r,n){return t&&QO(e,t),r&&QO(e,r),n&&QO(e,n),e}var t$t=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=e[0],n=1;n<e.length;n++){var i=e[n];Rr(i)&&(i=i.prototype),Qi(r.prototype,i)}},bl=function(e){if(typeof e!="object"||e===null)return e;var t;if(Fe(e)){t=[];for(var r=0,n=e.length;r<n;r++)typeof e[r]=="object"&&e[r]!=null?t[r]=bl(e[r]):t[r]=e[r]}else{t={};for(var i in e)typeof e[i]=="object"&&e[i]!=null?t[i]=bl(e[i]):t[i]=e[i]}return t};function rN(e,t,r){var n;return function(){var i=this,a=arguments,o=function(){n=null,r||e.apply(i,a)},s=r&&!n;clearTimeout(n),n=setTimeout(o,t),s&&e.apply(i,a)}}const D_=function(e,t){if(!Rr(e))throw new TypeError("Expected a function");var r=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var a=t?t.apply(this,n):n[0],o=r.cache;if(o.has(a))return o.get(a);var s=e.apply(this,n);return o.set(a,s),s};return r.cache=new Map,r};var e$t=5;function net(e,t,r,n){r=r||0,n=n||e$t;for(var i in t)if(t.hasOwnProperty(i)){var a=t[i];a!==null&&Hd(a)?(Hd(e[i])||(e[i]={}),r<n?net(e[i],a,r+1,n):e[i]=t[i]):Fe(a)?(e[i]=[],e[i]=e[i].concat(a)):a!==void 0&&(e[i]=a)}}var Tr=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n=0;n<t.length;n+=1)net(e,t[n]);return e},r$t=function(e,t,r,n){Rr(t)||(r=t,t=e,e=function(){});var i=Object.create?function(o,s){return Object.create(o,{constructor:{value:s}})}:function(o,s){function l(){}l.prototype=o;var u=new l;return u.constructor=s,u},a=i(t.prototype,e);return e.prototype=Qi(a,e.prototype),e.superclass=i(t.prototype,t),Qi(a,r),Qi(e,n),e},nN=function(e,t){if(!eh(e))return-1;var r=Array.prototype.indexOf;if(r)return r.call(e,t);for(var n=-1,i=0;i<e.length;i++)if(e[i]===t){n=i;break}return n},n$t=Object.prototype.hasOwnProperty;function cc(e){if(ze(e))return!0;if(eh(e))return!e.length;var t=Qtt(e);if(t==="Map"||t==="Set")return!e.size;if(tet(e))return!Object.keys(e).length;for(var r in e)if(n$t.call(e,r))return!1;return!0}var Di=function(e,t){if(e===t)return!0;if(!e||!t||en(e)||en(t))return!1;if(eh(e)||eh(t)){if(e.length!==t.length)return!1;for(var r=!0,n=0;n<e.length&&(r=Di(e[n],t[n]),!!r);n++);return r}if(wR(e)||wR(t)){var i=Object.keys(e),a=Object.keys(t);if(i.length!==a.length)return!1;for(var r=!0,n=0;n<i.length&&(r=Di(e[i[n]],t[i[n]]),!!r);n++);return r}return!1};const i$t=function(e,t,r){return Rr(r)?!!r(e,t):Di(e,t)};var fo=function(e,t){if(!eh(e))return e;for(var r=[],n=0;n<e.length;n++){var i=e[n];r.push(t(i,n))}return r},a$t=function(e){return e};const iet=function(e,t){t===void 0&&(t=a$t);var r={};return Xi(e)&&!ze(e)&&Object.keys(e).forEach(function(n){r[n]=t(e[n],n)}),r},xt=function(e,t,r){for(var n=0,i=en(t)?t.split("."):t;e&&n<i.length;)e=e[i[n++]];return e===void 0||n<i.length?r:e},Is=function(e,t,r){var n=e,i=en(t)?t.split("."):t;return i.forEach(function(a,o){o<i.length-1?(Xi(n[a])||(n[a]=Rn(i[o+1])?[]:{}),n=n[a]):n[a]=r}),e};var o$t=Object.prototype.hasOwnProperty;const Vd=function(e,t){if(e===null||!Hd(e))return{};var r={};return ft(t,function(n){o$t.call(e,n)&&(r[n]=e[n])}),r},ZS=function(e,t){return du(e,function(r,n,i){return t.includes(i)||(r[i]=n),r},{})},e3=function(e,t,r){var n,i,a,o,s=0;r||(r={});var l=function(){s=r.leading===!1?0:Date.now(),n=null,o=e.apply(i,a),n||(i=a=null)},u=function(){var c=Date.now();!s&&r.leading===!1&&(s=c);var f=t-(c-s);return i=this,a=arguments,f<=0||f>t?(n&&(clearTimeout(n),n=null),s=c,o=e.apply(i,a),n||(i=a=null)):!n&&r.trailing!==!1&&(n=setTimeout(l,f)),o};return u.cancel=function(){clearTimeout(n),s=0,n=i=a=null},u},aet=function(e){return eh(e)?Array.prototype.slice.call(e):[]};var QT={};const lh=function(e){return e=e||"g",QT[e]?QT[e]+=1:QT[e]=1,e+QT[e]},ag=function(){},s$t=function(e){return e};function il(e){return ze(e)?0:eh(e)?e.length:Object.keys(e).length}var JT;const Dw=D_(function(e,t){t===void 0&&(t={});var r=t.fontSize,n=t.fontFamily,i=t.fontWeight,a=t.fontStyle,o=t.fontVariant;return JT||(JT=document.createElement("canvas").getContext("2d")),JT.font=[a,o,i,r+"px",n].join(" "),JT.measureText(en(e)?e:"").width},function(e,t){return t===void 0&&(t={}),Jy([e],Bb(t)).join("")}),oet=function(e,t,r,n){n===void 0&&(n="...");var i=16,a=Dw(n,r),o=en(e)?e:x0(e),s=t,l=[],u,c;if(Dw(e,r)<=t)return e;for(;u=o.substr(0,i),c=Dw(u,r),!(c+a>s&&c>s);)if(l.push(u),s-=c,o=o.substr(i),!o)return l.join("");for(;u=o.substr(0,1),c=Dw(u,r),!(c+a>s);)if(l.push(u),s-=c,o=o.substr(1),!o)return l.join("");return""+l.join("")+n};var set=function(){function e(){this.map={}}return e.prototype.has=function(t){return this.map[t]!==void 0},e.prototype.get=function(t,r){var n=this.map[t];return n===void 0?r:n},e.prototype.set=function(t,r){this.map[t]=r},e.prototype.clear=function(){this.map={}},e.prototype.delete=function(t){delete this.map[t]},e.prototype.size=function(){return Object.keys(this.map).length},e}();const eOe=Object.freeze(Object.defineProperty({__proto__:null,Cache:set,assign:Qi,augment:t$t,clamp:to,clearAnimationFrame:ret,clone:bl,contains:Up,debounce:rN,deepMix:Tr,difference:Vtt,each:ft,endsWith:M9t,every:t3,extend:r$t,filter:Al,find:Xf,findIndex:q4,firstValue:Gtt,fixedBase:dM,flatten:rh,flattenDeep:Wtt,forIn:ft,get:xt,getEllipsisText:oet,getRange:K4,getType:Qtt,getWrapBehavior:I9t,group:qtt,groupBy:Qc,groupToMap:Q4,has:ev,hasKey:ev,hasValue:W9t,head:Kc,identity:s$t,includes:Up,indexOf:nN,isArguments:Z9t,isArray:Fe,isArrayLike:eh,isBoolean:bg,isDate:tN,isDecimal:D9t,isElement:eN,isEmpty:cc,isEqual:Di,isEqualWith:i$t,isError:q9t,isEven:F9t,isFinite:K9t,isFunction:Rr,isInteger:B9t,isMatch:Z4,isNegative:N9t,isNil:ze,isNull:Jtt,isNumber:Rn,isNumberEqual:xl,isObject:Xi,isObjectLike:wR,isOdd:z9t,isPlainObject:Hd,isPositive:U9t,isPrototype:tet,isRegExp:J9t,isString:en,isType:ad,isUndefined:Gl,keys:P_,last:Ds,lowerCase:b0,lowerFirst:X9t,map:fo,mapValues:iet,max:nh,maxBy:J4,measureTextWidth:Dw,memoize:D_,min:Wh,minBy:Ktt,mix:Qi,mod:jS,noop:ag,number2color:O9t,omit:ZS,parseRadius:P9t,pick:Vd,pull:C9t,pullAt:jtt,reduce:du,remove:Ytt,requestAnimationFrame:eet,set:Is,size:il,some:XS,sortBy:Ztt,startsWith:A9t,substitute:Tb,throttle:e3,toArray:aet,toDegree:H9t,toInteger:V9t,toRadian:YS,toString:x0,union:T9t,uniq:xg,uniqueId:lh,upperCase:j9t,upperFirst:E0,values:Bb,valuesOfKey:Zf,wrapBehavior:L9t},Symbol.toStringTag,{value:"Module"}));var _s;(function(e){e.FORE="fore",e.MID="mid",e.BG="bg"})(_s||(_s={}));var br;(function(e){e.TOP="top",e.TOP_LEFT="top-left",e.TOP_RIGHT="top-right",e.RIGHT="right",e.RIGHT_TOP="right-top",e.RIGHT_BOTTOM="right-bottom",e.LEFT="left",e.LEFT_TOP="left-top",e.LEFT_BOTTOM="left-bottom",e.BOTTOM="bottom",e.BOTTOM_LEFT="bottom-left",e.BOTTOM_RIGHT="bottom-right",e.RADIUS="radius",e.CIRCLE="circle",e.NONE="none"})(br||(br={}));var ml;(function(e){e.AXIS="axis",e.GRID="grid",e.LEGEND="legend",e.TOOLTIP="tooltip",e.ANNOTATION="annotation",e.SLIDER="slider",e.SCROLLBAR="scrollbar",e.OTHER="other"})(ml||(ml={}));var Tx={FORE:3,MID:2,BG:1},pi;(function(e){e.BEFORE_RENDER="beforerender",e.AFTER_RENDER="afterrender",e.BEFORE_PAINT="beforepaint",e.AFTER_PAINT="afterpaint",e.BEFORE_CHANGE_DATA="beforechangedata",e.AFTER_CHANGE_DATA="afterchangedata",e.BEFORE_CLEAR="beforeclear",e.AFTER_CLEAR="afterclear",e.BEFORE_DESTROY="beforedestroy",e.BEFORE_CHANGE_SIZE="beforechangesize",e.AFTER_CHANGE_SIZE="afterchangesize"})(pi||(pi={}));var Ym;(function(e){e.BEFORE_DRAW_ANIMATE="beforeanimate",e.AFTER_DRAW_ANIMATE="afteranimate",e.BEFORE_RENDER_LABEL="beforerenderlabel",e.AFTER_RENDER_LABEL="afterrenderlabel"})(Ym||(Ym={}));var Dc;(function(e){e.MOUSE_ENTER="plot:mouseenter",e.MOUSE_DOWN="plot:mousedown",e.MOUSE_MOVE="plot:mousemove",e.MOUSE_UP="plot:mouseup",e.MOUSE_LEAVE="plot:mouseleave",e.TOUCH_START="plot:touchstart",e.TOUCH_MOVE="plot:touchmove",e.TOUCH_END="plot:touchend",e.TOUCH_CANCEL="plot:touchcancel",e.CLICK="plot:click",e.DBLCLICK="plot:dblclick",e.CONTEXTMENU="plot:contextmenu",e.LEAVE="plot:leave",e.ENTER="plot:enter"})(Dc||(Dc={}));var CR;(function(e){e.ACTIVE="active",e.INACTIVE="inactive",e.SELECTED="selected",e.DEFAULT="default"})(CR||(CR={}));var ux=["color","shape","size"],Pa="_origin",iV=1,aV=1,oV=.25,uet={};function l$t(e){var t=uet[e];if(!t)throw new Error("G engine '".concat(e,"' is not exist, please register it at first."));return t}function cet(e,t){uet[e]=t}function V1(e,t,r){if(e){if(typeof e.addEventListener=="function")return e.addEventListener(t,r,!1),{remove:function(){e.removeEventListener(t,r,!1)}};if(typeof e.attachEvent=="function")return e.attachEvent("on"+t,r),{remove:function(){e.detachEvent("on"+t,r)}}}}function Gc(e,t,r){var n;try{n=window.getComputedStyle?window.getComputedStyle(e,null)[t]:e.style[t]}catch{}finally{n=n===void 0?r:n}return n}function u$t(e,t){var r=Gc(e,"height",t);return r==="auto"&&(r=e.offsetHeight),parseFloat(r)}function c$t(e,t){var r=u$t(e,t),n=parseFloat(Gc(e,"borderTopWidth"))||0,i=parseFloat(Gc(e,"paddingTop"))||0,a=parseFloat(Gc(e,"paddingBottom"))||0,o=parseFloat(Gc(e,"borderBottomWidth"))||0,s=parseFloat(Gc(e,"marginTop"))||0,l=parseFloat(Gc(e,"marginBottom"))||0;return r+n+o+i+a+s+l}function h$t(e,t){var r=Gc(e,"width",t);return r==="auto"&&(r=e.offsetWidth),parseFloat(r)}function f$t(e,t){var r=h$t(e,t),n=parseFloat(Gc(e,"borderLeftWidth"))||0,i=parseFloat(Gc(e,"paddingLeft"))||0,a=parseFloat(Gc(e,"paddingRight"))||0,o=parseFloat(Gc(e,"borderRightWidth"))||0,s=parseFloat(Gc(e,"marginRight"))||0,l=parseFloat(Gc(e,"marginLeft"))||0;return r+n+o+i+a+l+s}function za(e,t){if(e)for(var r in t)t.hasOwnProperty(r)&&(e.style[r]=t[r]);return e}function d$t(e){var t=getComputedStyle(e);return{width:(e.clientWidth||parseInt(t.width,10))-parseInt(t.paddingLeft,10)-parseInt(t.paddingRight,10),height:(e.clientHeight||parseInt(t.height,10))-parseInt(t.paddingTop,10)-parseInt(t.paddingBottom,10)}}function sV(e){return typeof e=="number"&&!isNaN(e)}function lV(e,t,r,n){var i=r,a=n;if(t){var o=d$t(e);i=o.width?o.width:i,a=o.height?o.height:a}return{width:Math.max(sV(i)?i:iV,iV),height:Math.max(sV(a)?a:aV,aV)}}function p$t(e){var t=e.parentNode;t&&t.removeChild(e)}var v$t="*",F_=function(){function e(){this._events={}}return e.prototype.on=function(t,r,n){return this._events[t]||(this._events[t]=[]),this._events[t].push({callback:r,once:!!n}),this},e.prototype.once=function(t,r){return this.on(t,r,!0)},e.prototype.emit=function(t){for(var r=this,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var a=this._events[t]||[],o=this._events[v$t]||[],s=function(l){for(var u=l.length,c=0;c<u;c++)if(l[c]){var f=l[c],d=f.callback,v=f.once;v&&(l.splice(c,1),l.length===0&&delete r._events[t],u--,c--),d.apply(r,n)}};s(a),s(o)},e.prototype.off=function(t,r){if(!t)this._events={};else if(!r)delete this._events[t];else{for(var n=this._events[t]||[],i=n.length,a=0;a<i;a++)n[a].callback===r&&(n.splice(a,1),i--,a--);n.length===0&&delete this._events[t]}return this},e.prototype.getEvents=function(){return this._events},e}(),iN=function(e){$t(t,e);function t(r){var n=e.call(this)||this;n.destroyed=!1;var i=r.visible,a=i===void 0?!0:i;return n.visible=a,n}return t.prototype.show=function(){var r=this.visible;r||this.changeVisible(!0)},t.prototype.hide=function(){var r=this.visible;r&&this.changeVisible(!1)},t.prototype.destroy=function(){this.off(),this.destroyed=!0},t.prototype.changeVisible=function(r){this.visible!==r&&(this.visible=r)},t}(F_),Qw=`	
\v\f\r   ᠎             　\u2028\u2029`,g$t=new RegExp("([a-z])["+Qw+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+Qw+"]*,?["+Qw+"]*)+)","ig"),m$t=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+Qw+"]*,?["+Qw+"]*","ig"),cx=function(e){if(!e)return null;if(Fe(e))return e;var t={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},r=[];return String(e).replace(g$t,function(n,i,a){var o=[],s=i.toLowerCase();if(a.replace(m$t,function(l,u){u&&o.push(+u)}),s==="m"&&o.length>2&&(r.push([i].concat(o.splice(0,2))),s="l",i=i==="m"?"l":"L"),s==="o"&&o.length===1&&r.push([i,o[0]]),s==="r")r.push([i].concat(o));else for(;o.length>=t[s]&&(r.push([i].concat(o.splice(0,t[s]))),!!t[s]););return e}),r},gF=function(e,t){for(var r=[],n=0,i=e.length;i-2*!t>n;n+=2){var a=[{x:+e[n-2],y:+e[n-1]},{x:+e[n],y:+e[n+1]},{x:+e[n+2],y:+e[n+3]},{x:+e[n+4],y:+e[n+5]}];t?n?i-4===n?a[3]={x:+e[0],y:+e[1]}:i-2===n&&(a[2]={x:+e[0],y:+e[1]},a[3]={x:+e[2],y:+e[3]}):a[0]={x:+e[i-2],y:+e[i-1]}:i-4===n?a[3]=a[2]:n||(a[0]={x:+e[n],y:+e[n+1]}),r.push(["C",(-a[0].x+6*a[1].x+a[2].x)/6,(-a[0].y+6*a[1].y+a[2].y)/6,(a[1].x+6*a[2].x-a[3].x)/6,(a[1].y+6*a[2].y-a[3].y)/6,a[2].x,a[2].y])}return r},tA=function(e,t,r,n,i){var a=[];if(i===null&&n===null&&(n=r),e=+e,t=+t,r=+r,n=+n,i!==null){var o=Math.PI/180,s=e+r*Math.cos(-n*o),l=e+r*Math.cos(-i*o),u=t+r*Math.sin(-n*o),c=t+r*Math.sin(-i*o);a=[["M",s,u],["A",r,r,0,+(i-n>180),0,l,c]]}else a=[["M",e,t],["m",0,-n],["a",r,n,0,1,1,0,2*n],["a",r,n,0,1,1,0,-2*n],["z"]];return a},mF=function(e){if(e=cx(e),!e||!e.length)return[["M",0,0]];var t=[],r=0,n=0,i=0,a=0,o=0,s,l;e[0][0]==="M"&&(r=+e[0][1],n=+e[0][2],i=r,a=n,o++,t[0]=["M",r,n]);for(var u=e.length===3&&e[0][0]==="M"&&e[1][0].toUpperCase()==="R"&&e[2][0].toUpperCase()==="Z",c=void 0,f=void 0,d=o,v=e.length;d<v;d++){if(t.push(c=[]),f=e[d],s=f[0],s!==s.toUpperCase())switch(c[0]=s.toUpperCase(),c[0]){case"A":c[1]=f[1],c[2]=f[2],c[3]=f[3],c[4]=f[4],c[5]=f[5],c[6]=+f[6]+r,c[7]=+f[7]+n;break;case"V":c[1]=+f[1]+n;break;case"H":c[1]=+f[1]+r;break;case"R":l=[r,n].concat(f.slice(1));for(var g=2,x=l.length;g<x;g++)l[g]=+l[g]+r,l[++g]=+l[g]+n;t.pop(),t=t.concat(gF(l,u));break;case"O":t.pop(),l=tA(r,n,f[1],f[2]),l.push(l[0]),t=t.concat(l);break;case"U":t.pop(),t=t.concat(tA(r,n,f[1],f[2],f[3])),c=["U"].concat(t[t.length-1].slice(-2));break;case"M":i=+f[1]+r,a=+f[2]+n;break;default:for(var g=1,x=f.length;g<x;g++)c[g]=+f[g]+(g%2?r:n)}else if(s==="R")l=[r,n].concat(f.slice(1)),t.pop(),t=t.concat(gF(l,u)),c=["R"].concat(f.slice(-2));else if(s==="O")t.pop(),l=tA(r,n,f[1],f[2]),l.push(l[0]),t=t.concat(l);else if(s==="U")t.pop(),t=t.concat(tA(r,n,f[1],f[2],f[3])),c=["U"].concat(t[t.length-1].slice(-2));else for(var w=0,S=f.length;w<S;w++)c[w]=f[w];if(s=s.toUpperCase(),s!=="O")switch(c[0]){case"Z":r=+i,n=+a;break;case"H":r=c[1];break;case"V":n=c[1];break;case"M":i=c[c.length-2],a=c[c.length-1];break;default:r=c[c.length-2],n=c[c.length-1]}}return t},eA=function(e,t,r,n){return[e,t,r,n,r,n]},uV=function(e,t,r,n,i,a){var o=.3333333333333333,s=2/3;return[o*e+s*r,o*t+s*n,o*i+s*r,o*a+s*n,i,a]},het=function(e,t,r,n,i,a,o,s,l,u){r===n&&(r+=1);var c=Math.PI*120/180,f=Math.PI/180*(+i||0),d=[],v,g,x,w,S,M=function(Wr,In,re){var nr=Wr*Math.cos(re)-In*Math.sin(re),zr=Wr*Math.sin(re)+In*Math.cos(re);return{x:nr,y:zr}};if(u)g=u[0],x=u[1],w=u[2],S=u[3];else{v=M(e,t,-f),e=v.x,t=v.y,v=M(s,l,-f),s=v.x,l=v.y,e===s&&t===l&&(s+=1,l+=1);var R=(e-s)/2,I=(t-l)/2,P=R*R/(r*r)+I*I/(n*n);P>1&&(P=Math.sqrt(P),r=P*r,n=P*n);var k=r*r,z=n*n,G=(a===o?-1:1)*Math.sqrt(Math.abs((k*z-k*I*I-z*R*R)/(k*I*I+z*R*R)));w=G*r*I/n+(e+s)/2,S=G*-n*R/r+(t+l)/2,g=Math.asin(((t-S)/n).toFixed(9)),x=Math.asin(((l-S)/n).toFixed(9)),g=e<w?Math.PI-g:g,x=s<w?Math.PI-x:x,g<0&&(g=Math.PI*2+g),x<0&&(x=Math.PI*2+x),o&&g>x&&(g=g-Math.PI*2),!o&&x>g&&(x=x-Math.PI*2)}var J=x-g;if(Math.abs(J)>c){var Z=x,X=s,et=l;x=g+c*(o&&x>g?1:-1),s=w+r*Math.cos(x),l=S+n*Math.sin(x),d=het(s,l,r,n,i,0,o,X,et,[x,Z,w,S])}J=x-g;var at=Math.cos(g),wt=Math.sin(g),Tt=Math.cos(x),vt=Math.sin(x),zt=Math.tan(J/4),oe=4/3*r*zt,Qt=4/3*n*zt,ne=[e,t],de=[e+oe*wt,t-Qt*at],De=[s+oe*vt,l-Qt*Tt],Ze=[s,l];if(de[0]=2*ne[0]-de[0],de[1]=2*ne[1]-de[1],u)return[de,De,Ze].concat(d);d=[de,De,Ze].concat(d).join().split(",");for(var ke=[],Be=0,Zr=d.length;Be<Zr;Be++)ke[Be]=Be%2?M(d[Be-1],d[Be],f).y:M(d[Be],d[Be+1],f).x;return ke},yF=function(e,t){var r=mF(e),n=t&&mF(t),i={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},a={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},o=[],s=[],l="",u="",c,f=function(R,I,P){var k,z;if(!R)return["C",I.x,I.y,I.x,I.y,I.x,I.y];switch(!(R[0]in{T:1,Q:1})&&(I.qx=I.qy=null),R[0]){case"M":I.X=R[1],I.Y=R[2];break;case"A":R=["C"].concat(het.apply(0,[I.x,I.y].concat(R.slice(1))));break;case"S":P==="C"||P==="S"?(k=I.x*2-I.bx,z=I.y*2-I.by):(k=I.x,z=I.y),R=["C",k,z].concat(R.slice(1));break;case"T":P==="Q"||P==="T"?(I.qx=I.x*2-I.qx,I.qy=I.y*2-I.qy):(I.qx=I.x,I.qy=I.y),R=["C"].concat(uV(I.x,I.y,I.qx,I.qy,R[1],R[2]));break;case"Q":I.qx=R[1],I.qy=R[2],R=["C"].concat(uV(I.x,I.y,R[1],R[2],R[3],R[4]));break;case"L":R=["C"].concat(eA(I.x,I.y,R[1],R[2]));break;case"H":R=["C"].concat(eA(I.x,I.y,R[1],I.y));break;case"V":R=["C"].concat(eA(I.x,I.y,I.x,R[1]));break;case"Z":R=["C"].concat(eA(I.x,I.y,I.X,I.Y));break}return R},d=function(R,I){if(R[I].length>7){R[I].shift();for(var P=R[I];P.length;)o[I]="A",n&&(s[I]="A"),R.splice(I++,0,["C"].concat(P.splice(0,6)));R.splice(I,1),c=Math.max(r.length,n&&n.length||0)}},v=function(R,I,P,k,z){R&&I&&R[z][0]==="M"&&I[z][0]!=="M"&&(I.splice(z,0,["M",k.x,k.y]),P.bx=0,P.by=0,P.x=R[z][1],P.y=R[z][2],c=Math.max(r.length,n&&n.length||0))};c=Math.max(r.length,n&&n.length||0);for(var g=0;g<c;g++){r[g]&&(l=r[g][0]),l!=="C"&&(o[g]=l,g&&(u=o[g-1])),r[g]=f(r[g],i,u),o[g]!=="A"&&l==="C"&&(o[g]="C"),d(r,g),n&&(n[g]&&(l=n[g][0]),l!=="C"&&(s[g]=l,g&&(u=s[g-1])),n[g]=f(n[g],a,u),s[g]!=="A"&&l==="C"&&(s[g]="C"),d(n,g)),v(r,n,i,a,g),v(n,r,a,i,g);var x=r[g],w=n&&n[g],S=x.length,M=n&&w.length;i.x=x[S-2],i.y=x[S-1],i.bx=parseFloat(x[S-4])||i.x,i.by=parseFloat(x[S-3])||i.y,a.bx=n&&(parseFloat(w[M-4])||a.x),a.by=n&&(parseFloat(w[M-3])||a.y),a.x=n&&w[M-2],a.y=n&&w[M-1]}return n?[r,n]:r},y$t=/,?([a-z]),?/gi,fet=function(e){return e.join(",").replace(y$t,"$1")},cV=function(e,t,r,n,i){var a=-3*t+9*r-9*n+3*i,o=e*a+6*t-12*r+6*n;return e*o-3*t+3*r},hV=function(e,t,r,n,i,a,o,s,l){l===null&&(l=1),l=l>1?1:l<0?0:l;for(var u=l/2,c=12,f=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],d=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],v=0,g=0;g<c;g++){var x=u*f[g]+u,w=cV(x,e,r,i,o),S=cV(x,t,n,a,s),M=w*w+S*S;v+=d[g]*Math.sqrt(M)}return u*v},_$t=function(e,t,r,n,i,a,o,s){for(var l=[],u=[[],[]],c,f,d,v,g=0;g<2;++g){if(g===0?(f=6*e-12*r+6*i,c=-3*e+9*r-9*i+3*o,d=3*r-3*e):(f=6*t-12*n+6*a,c=-3*t+9*n-9*a+3*s,d=3*n-3*t),Math.abs(c)<1e-12){if(Math.abs(f)<1e-12)continue;v=-d/f,v>0&&v<1&&l.push(v);continue}var x=f*f-4*d*c,w=Math.sqrt(x);if(!(x<0)){var S=(-f+w)/(2*c);S>0&&S<1&&l.push(S);var M=(-f-w)/(2*c);M>0&&M<1&&l.push(M)}}for(var R=l.length,I=R,P;R--;)v=l[R],P=1-v,u[0][R]=P*P*P*e+3*P*P*v*r+3*P*v*v*i+v*v*v*o,u[1][R]=P*P*P*t+3*P*P*v*n+3*P*v*v*a+v*v*v*s;return u[0][I]=e,u[1][I]=t,u[0][I+1]=o,u[1][I+1]=s,u[0].length=u[1].length=I+2,{min:{x:Math.min.apply(0,u[0]),y:Math.min.apply(0,u[1])},max:{x:Math.max.apply(0,u[0]),y:Math.max.apply(0,u[1])}}},x$t=function(e,t,r,n,i,a,o,s){if(!(Math.max(e,r)<Math.min(i,o)||Math.min(e,r)>Math.max(i,o)||Math.max(t,n)<Math.min(a,s)||Math.min(t,n)>Math.max(a,s))){var l=(e*n-t*r)*(i-o)-(e-r)*(i*s-a*o),u=(e*n-t*r)*(a-s)-(t-n)*(i*s-a*o),c=(e-r)*(a-s)-(t-n)*(i-o);if(c){var f=l/c,d=u/c,v=+f.toFixed(2),g=+d.toFixed(2);if(!(v<+Math.min(e,r).toFixed(2)||v>+Math.max(e,r).toFixed(2)||v<+Math.min(i,o).toFixed(2)||v>+Math.max(i,o).toFixed(2)||g<+Math.min(t,n).toFixed(2)||g>+Math.max(t,n).toFixed(2)||g<+Math.min(a,s).toFixed(2)||g>+Math.max(a,s).toFixed(2)))return{x:f,y:d}}}},xm=function(e,t,r){return t>=e.x&&t<=e.x+e.width&&r>=e.y&&r<=e.y+e.height},det=function(e,t,r,n,i){if(i)return[["M",+e+ +i,t],["l",r-i*2,0],["a",i,i,0,0,1,i,i],["l",0,n-i*2],["a",i,i,0,0,1,-i,i],["l",i*2-r,0],["a",i,i,0,0,1,-i,-i],["l",0,i*2-n],["a",i,i,0,0,1,i,-i],["z"]];var a=[["M",e,t],["l",r,0],["l",0,n],["l",-r,0],["z"]];return a.parsePathArray=fet,a},_F=function(e,t,r,n){return e===null&&(e=t=r=n=0),t===null&&(t=e.y,r=e.width,n=e.height,e=e.x),{x:e,y:t,width:r,w:r,height:n,h:n,x2:e+r,y2:t+n,cx:e+r/2,cy:t+n/2,r1:Math.min(r,n)/2,r2:Math.max(r,n)/2,r0:Math.sqrt(r*r+n*n)/2,path:det(e,t,r,n),vb:[e,t,r,n].join(" ")}},b$t=function(e,t){return e=_F(e),t=_F(t),xm(t,e.x,e.y)||xm(t,e.x2,e.y)||xm(t,e.x,e.y2)||xm(t,e.x2,e.y2)||xm(e,t.x,t.y)||xm(e,t.x2,t.y)||xm(e,t.x,t.y2)||xm(e,t.x2,t.y2)||(e.x<t.x2&&e.x>t.x||t.x<e.x2&&t.x>e.x)&&(e.y<t.y2&&e.y>t.y||t.y<e.y2&&t.y>e.y)},fV=function(e,t,r,n,i,a,o,s){Fe(e)||(e=[e,t,r,n,i,a,o,s]);var l=_$t.apply(null,e);return _F(l.min.x,l.min.y,l.max.x-l.min.x,l.max.y-l.min.y)},dV=function(e,t,r,n,i,a,o,s,l){var u=1-l,c=Math.pow(u,3),f=Math.pow(u,2),d=l*l,v=d*l,g=c*e+f*3*l*r+u*3*l*l*i+v*o,x=c*t+f*3*l*n+u*3*l*l*a+v*s,w=e+2*l*(r-e)+d*(i-2*r+e),S=t+2*l*(n-t)+d*(a-2*n+t),M=r+2*l*(i-r)+d*(o-2*i+r),R=n+2*l*(a-n)+d*(s-2*a+n),I=u*e+l*r,P=u*t+l*n,k=u*i+l*o,z=u*a+l*s,G=90-Math.atan2(w-M,S-R)*180/Math.PI;return{x:g,y:x,m:{x:w,y:S},n:{x:M,y:R},start:{x:I,y:P},end:{x:k,y:z},alpha:G}},E$t=function(e,t,r){var n=fV(e),i=fV(t);if(!b$t(n,i))return r?0:[];for(var a=hV.apply(0,e),o=hV.apply(0,t),s=~~(a/8),l=~~(o/8),u=[],c=[],f={},d=r?0:[],v=0;v<s+1;v++){var g=dV.apply(0,e.concat(v/s));u.push({x:g.x,y:g.y,t:v/s})}for(var v=0;v<l+1;v++){var g=dV.apply(0,t.concat(v/l));c.push({x:g.x,y:g.y,t:v/l})}for(var v=0;v<s;v++)for(var x=0;x<l;x++){var w=u[v],S=u[v+1],M=c[x],R=c[x+1],I=Math.abs(S.x-w.x)<.001?"y":"x",P=Math.abs(R.x-M.x)<.001?"y":"x",k=x$t(w.x,w.y,S.x,S.y,M.x,M.y,R.x,R.y);if(k){if(f[k.x.toFixed(4)]===k.y.toFixed(4))continue;f[k.x.toFixed(4)]=k.y.toFixed(4);var z=w.t+Math.abs((k[I]-w[I])/(S[I]-w[I]))*(S.t-w.t),G=M.t+Math.abs((k[P]-M[P])/(R[P]-M[P]))*(R.t-M.t);z>=0&&z<=1&&G>=0&&G<=1&&(r?d+=1:d.push({x:k.x,y:k.y,t1:z,t2:G}))}}return d},w$t=function(e,t,r){e=yF(e),t=yF(t);for(var n,i,a,o,s,l,u,c,f,d,v=r?0:[],g=0,x=e.length;g<x;g++){var w=e[g];if(w[0]==="M")n=s=w[1],i=l=w[2];else{w[0]==="C"?(f=[n,i].concat(w.slice(1)),n=f[6],i=f[7]):(f=[n,i,n,i,s,l,s,l],n=s,i=l);for(var S=0,M=t.length;S<M;S++){var R=t[S];if(R[0]==="M")a=u=R[1],o=c=R[2];else{R[0]==="C"?(d=[a,o].concat(R.slice(1)),a=d[6],o=d[7]):(d=[a,o,a,o,u,c,u,c],a=u,o=c);var I=E$t(f,d,r);if(r)v+=I;else{for(var P=0,k=I.length;P<k;P++)I[P].segment1=g,I[P].segment2=S,I[P].bez1=f,I[P].bez2=d;v=v.concat(I)}}}}}return v},C$t=function(e,t){return w$t(e,t)};function S$t(e,t){var r=[],n=[];function i(a,o){if(a.length===1)r.push(a[0]),n.push(a[0]);else{for(var s=[],l=0;l<a.length-1;l++)l===0&&r.push(a[0]),l===a.length-2&&n.push(a[l+1]),s[l]=[(1-o)*a[l][0]+o*a[l+1][0],(1-o)*a[l][1]+o*a[l+1][1]];i(s,o)}}return e.length&&i(e,t),{left:r,right:n.reverse()}}function T$t(e,t,r){var n=[[e[1],e[2]]];r=r||2;var i=[];t[0]==="A"?(n.push(t[6]),n.push(t[7])):t[0]==="C"?(n.push([t[1],t[2]]),n.push([t[3],t[4]]),n.push([t[5],t[6]])):t[0]==="S"||t[0]==="Q"?(n.push([t[1],t[2]]),n.push([t[3],t[4]])):n.push([t[1],t[2]]);for(var a=n,o=1/r,s=0;s<r-1;s++){var l=o/(1-o*s),u=S$t(a,l);i.push(u.left),a=u.right}i.push(a);var c=i.map(function(f){var d=[];return f.length===4&&(d.push("C"),d=d.concat(f[2])),f.length>=3&&(f.length===3&&d.push("Q"),d=d.concat(f[1])),f.length===2&&d.push("L"),d=d.concat(f[f.length-1]),d});return c}var A$t=function(e,t,r){if(r===1)return[[].concat(e)];var n=[];if(t[0]==="L"||t[0]==="C"||t[0]==="Q")n=n.concat(T$t(e,t,r));else{var i=[].concat(e);i[0]==="M"&&(i[0]="L");for(var a=0;a<=r-1;a++)n.push(i)}return n},M$t=function(e,t){if(e.length===1)return e;var r=e.length-1,n=t.length-1,i=r/n,a=[];if(e.length===1&&e[0][0]==="M"){for(var o=0;o<n-r;o++)e.push(e[0]);return e}for(var o=0;o<n;o++){var s=Math.floor(i*o);a[s]=(a[s]||0)+1}var l=a.reduce(function(u,c,f){return f===r?u.concat(e[r]):u.concat(A$t(e[f],e[f+1],c))},[]);return l.unshift(e[0]),(t[n]==="Z"||t[n]==="z")&&l.push("Z"),l},R$t=function(e,t){if(e.length!==t.length)return!1;var r=!0;return ft(e,function(n,i){if(n!==t[i])return r=!1,!1}),r};function I$t(e,t,r){var n=null,i=r;return t<i&&(i=t,n="add"),e<i&&(i=e,n="del"),{type:n,min:i}}var L$t=function(e,t){var r=e.length,n=t.length,i,a,o=0;if(r===0||n===0)return null;for(var s=[],l=0;l<=r;l++)s[l]=[],s[l][0]={min:l};for(var u=0;u<=n;u++)s[0][u]={min:u};for(var l=1;l<=r;l++){i=e[l-1];for(var u=1;u<=n;u++){a=t[u-1],R$t(i,a)?o=0:o=1;var c=s[l-1][u].min+1,f=s[l][u-1].min+1,d=s[l-1][u-1].min+o;s[l][u]=I$t(c,f,d)}}return s},pet=function(e,t){var r=L$t(e,t),n=e.length,i=t.length,a=[],o=1,s=1;if(r[n][i].min!==n){for(var l=1;l<=n;l++){var u=r[l][l].min;s=l;for(var c=o;c<=i;c++)r[l][c].min<u&&(u=r[l][c].min,s=c);o=s,r[l][o].type&&a.push({index:l-1,type:r[l][o].type})}for(var l=a.length-1;l>=0;l--)o=a[l].index,a[l].type==="add"?e.splice(o,0,[].concat(e[o])):e.splice(o,1)}n=e.length;var f=i-n;if(n<i)for(var l=0;l<f;l++)e[n-1][0]==="z"||e[n-1][0]==="Z"?e.splice(n-2,0,e[n-2]):e.push(e[n-1]),n+=1;return e};function JO(e,t,r){for(var n=[].concat(e),i,a=1/(r+1),o=vet(t)[0],s=1;s<=r;s++)a*=s,i=Math.floor(e.length*a),i===0?n.unshift([o[0]*a+e[i][0]*(1-a),o[1]*a+e[i][1]*(1-a)]):n.splice(i,0,[o[0]*a+e[i][0]*(1-a),o[1]*a+e[i][1]*(1-a)]);return n}function vet(e){var t=[];switch(e[0]){case"M":t.push([e[1],e[2]]);break;case"L":t.push([e[1],e[2]]);break;case"A":t.push([e[6],e[7]]);break;case"Q":t.push([e[3],e[4]]),t.push([e[1],e[2]]);break;case"T":t.push([e[1],e[2]]);break;case"C":t.push([e[5],e[6]]),t.push([e[1],e[2]]),t.push([e[3],e[4]]);break;case"S":t.push([e[3],e[4]]),t.push([e[1],e[2]]);break;case"H":t.push([e[1],e[1]]);break;case"V":t.push([e[1],e[1]]);break}return t}var xF=function(e,t){if(e.length<=1)return e;for(var r,n=0;n<t.length;n++)if(e[n][0]!==t[n][0])switch(r=vet(e[n]),t[n][0]){case"M":e[n]=["M"].concat(r[0]);break;case"L":e[n]=["L"].concat(r[0]);break;case"A":e[n]=[].concat(t[n]),e[n][6]=r[0][0],e[n][7]=r[0][1];break;case"Q":if(r.length<2)if(n>0)r=JO(r,e[n-1],1);else{e[n]=t[n];break}e[n]=["Q"].concat(r.reduce(function(i,a){return i.concat(a)},[]));break;case"T":e[n]=["T"].concat(r[0]);break;case"C":if(r.length<3)if(n>0)r=JO(r,e[n-1],2);else{e[n]=t[n];break}e[n]=["C"].concat(r.reduce(function(i,a){return i.concat(a)},[]));break;case"S":if(r.length<2)if(n>0)r=JO(r,e[n-1],1);else{e[n]=t[n];break}e[n]=["S"].concat(r.reduce(function(i,a){return i.concat(a)},[]));break;default:e[n]=t[n]}return e};const r3=Object.freeze(Object.defineProperty({__proto__:null,catmullRomToBezier:gF,fillPath:M$t,fillPathByDiff:pet,formatPath:xF,intersection:C$t,parsePathArray:fet,parsePathString:cx,pathToAbsolute:mF,pathToCurve:yF,rectPath:det},Symbol.toStringTag,{value:"Module"}));var Nb=function(){function e(t,r){this.bubbles=!0,this.target=null,this.currentTarget=null,this.delegateTarget=null,this.delegateObject=null,this.defaultPrevented=!1,this.propagationStopped=!1,this.shape=null,this.fromShape=null,this.toShape=null,this.propagationPath=[],this.type=t,this.name=t,this.originalEvent=r,this.timeStamp=r.timeStamp}return e.prototype.preventDefault=function(){this.defaultPrevented=!0,this.originalEvent.preventDefault&&this.originalEvent.preventDefault()},e.prototype.stopPropagation=function(){this.propagationStopped=!0},e.prototype.toString=function(){var t=this.type;return"[Event (type="+t+")]"},e.prototype.save=function(){},e.prototype.restore=function(){},e}();function get(e,t){var r=e.indexOf(t);r!==-1&&e.splice(r,1)}var pV=typeof window<"u"&&typeof window.document<"u";function met(e,t){if(e.isCanvas())return!0;for(var r=t.getParent(),n=!1;r;){if(r===e){n=!0;break}r=r.getParent()}return n}function ib(e){return e.cfg.visible&&e.cfg.capture}var qS=function(e){$t(t,e);function t(r){var n=e.call(this)||this;n.destroyed=!1;var i=n.getDefaultCfg();return n.cfg=Qi(i,r),n}return t.prototype.getDefaultCfg=function(){return{}},t.prototype.get=function(r){return this.cfg[r]},t.prototype.set=function(r,n){this.cfg[r]=n},t.prototype.destroy=function(){this.cfg={destroyed:!0},this.off(),this.destroyed=!0},t}(F_),vV=globalThis&&globalThis.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,a;n<i;n++)(a||!(n in t))&&(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))},O$t=function(){function e(t,r,n){this.name=t,this.version=r,this.os=n,this.type="browser"}return e}(),P$t=function(){function e(t){this.version=t,this.type="node",this.name="node",this.os=process.platform}return e}(),D$t=function(){function e(t,r,n,i){this.name=t,this.version=r,this.os=n,this.bot=i,this.type="bot-device"}return e}(),F$t=function(){function e(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return e}(),B$t=function(){function e(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return e}(),N$t=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,k$t=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,gV=3,z$t=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",N$t]],mV=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function yet(e){return e?yV(e):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new B$t:typeof navigator<"u"?yV(navigator.userAgent):H$t()}function U$t(e){return e!==""&&z$t.reduce(function(t,r){var n=r[0],i=r[1];if(t)return t;var a=i.exec(e);return!!a&&[n,a]},!1)}function yV(e){var t=U$t(e);if(!t)return null;var r=t[0],n=t[1];if(r==="searchbot")return new F$t;var i=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);i?i.length<gV&&(i=vV(vV([],i,!0),V$t(gV-i.length),!0)):i=[];var a=i.join("."),o=$$t(e),s=k$t.exec(e);return s&&s[1]?new D$t(r,a,o,s[1]):new O$t(r,a,o)}function $$t(e){for(var t=0,r=mV.length;t<r;t++){var n=mV[t],i=n[0],a=n[1],o=a.exec(e);if(o)return i}return null}function H$t(){var e=typeof process<"u"&&process.version;return e?new P$t(process.version.slice(1)):null}function V$t(e){for(var t=[],r=0;r<e;r++)t.push("0");return t}function Q1(e,t,r){var n=[0,0,0,0,0,0,0,0,0];return HIt(n,r),VI(e,n,t)}function aN(e,t,r){var n=[0,0,0,0,0,0,0,0,0];return VIt(n,r),VI(e,n,t)}function _et(e,t,r){var n=[0,0,0,0,0,0,0,0,0];return GIt(n,r),VI(e,n,t)}function G$t(e,t,r){return VI(e,r,t)}function Ws(e,t){for(var r=e?[].concat(e):[1,0,0,0,1,0,0,0,1],n=0,i=t.length;n<i;n++){var a=t[n];switch(a[0]){case"t":Q1(r,r,[a[1],a[2]]);break;case"s":_et(r,r,[a[1],a[2]]);break;case"r":aN(r,r,a[1]);break;case"m":G$t(r,r,a[1]);break}}return r}function W$t(e,t){return e[0]*t[1]-t[0]*e[1]}function oN(e,t,r){var n=LD(e,t),i=W$t(e,t)>=0;return r?i?Math.PI*2-n:n:i?n:Math.PI*2-n}function _V(e,t){var r=[],n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],l=e[5],u=e[6],c=e[7],f=e[8],d=t[0],v=t[1],g=t[2],x=t[3],w=t[4],S=t[5],M=t[6],R=t[7],I=t[8];return r[0]=d*n+v*o+g*u,r[1]=d*i+v*s+g*c,r[2]=d*a+v*l+g*f,r[3]=x*n+w*o+S*u,r[4]=x*i+w*s+S*c,r[5]=x*a+w*l+S*f,r[6]=M*n+R*o+I*u,r[7]=M*i+R*s+I*c,r[8]=M*a+R*l+I*f,r}function Hp(e,t){var r=[],n=t[0],i=t[1];return r[0]=e[0]*n+e[3]*i+e[6],r[1]=e[1]*n+e[4]*i+e[7],r}function KS(e){var t=[],r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],l=e[6],u=e[7],c=e[8],f=c*o-s*u,d=-c*a+s*l,v=u*a-o*l,g=r*f+n*d+i*v;return g?(g=1/g,t[0]=f*g,t[1]=(-c*n+i*u)*g,t[2]=(s*n-i*o)*g,t[3]=d*g,t[4]=(c*r-i*l)*g,t[5]=(-s*r+i*a)*g,t[6]=v*g,t[7]=(-u*r+n*l)*g,t[8]=(o*r-n*a)*g,t):null}var lw=Ws,tP="matrix",X$t=["zIndex","capture","visible","type"],j$t=["repeat"],Y$t=":",Z$t="*";function q$t(e){for(var t=[],r=0;r<e.length;r++)Fe(e[r])?t.push([].concat(e[r])):t.push(e[r]);return t}function K$t(e,t){var r={},n=t.attrs;for(var i in e)r[i]=n[i];return r}function Q$t(e,t){var r={},n=t.attr();return ft(e,function(i,a){j$t.indexOf(a)===-1&&!Di(n[a],i)&&(r[a]=i)}),r}function J$t(e,t){if(t.onFrame)return e;var r=t.startTime,n=t.delay,i=t.duration,a=Object.prototype.hasOwnProperty;return ft(e,function(o){r+n<o.startTime+o.delay+o.duration&&i>o.delay&&ft(t.toAttrs,function(s,l){a.call(o.toAttrs,l)&&(delete o.toAttrs[l],delete o.fromAttrs[l])})}),e}var xet=function(e){$t(t,e);function t(r){var n=e.call(this,r)||this;n.attrs={};var i=n.getDefaultAttrs();return Qi(i,r.attrs),n.attrs=i,n.initAttrs(i),n.initAnimate(),n}return t.prototype.getDefaultCfg=function(){return{visible:!0,capture:!0,zIndex:0}},t.prototype.getDefaultAttrs=function(){return{matrix:this.getDefaultMatrix(),opacity:1}},t.prototype.onCanvasChange=function(r){},t.prototype.initAttrs=function(r){},t.prototype.initAnimate=function(){this.set("animable",!0),this.set("animating",!1)},t.prototype.isGroup=function(){return!1},t.prototype.getParent=function(){return this.get("parent")},t.prototype.getCanvas=function(){return this.get("canvas")},t.prototype.attr=function(){for(var r,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var a=n[0],o=n[1];if(!a)return this.attrs;if(Xi(a)){for(var s in a)this.setAttr(s,a[s]);return this.afterAttrsChange(a),this}return n.length===2?(this.setAttr(a,o),this.afterAttrsChange((r={},r[a]=o,r)),this):this.attrs[a]},t.prototype.isClipped=function(r,n){var i=this.getClip();return i&&!i.isHit(r,n)},t.prototype.setAttr=function(r,n){var i=this.attrs[r];i!==n&&(this.attrs[r]=n,this.onAttrChange(r,n,i))},t.prototype.onAttrChange=function(r,n,i){r==="matrix"&&this.set("totalMatrix",null)},t.prototype.afterAttrsChange=function(r){if(this.cfg.isClipShape){var n=this.cfg.applyTo;n&&n.onCanvasChange("clip")}else this.onCanvasChange("attr")},t.prototype.show=function(){return this.set("visible",!0),this.onCanvasChange("show"),this},t.prototype.hide=function(){return this.set("visible",!1),this.onCanvasChange("hide"),this},t.prototype.setZIndex=function(r){this.set("zIndex",r);var n=this.getParent();return n&&n.sort(),this},t.prototype.toFront=function(){var r=this.getParent();if(r){var n=r.getChildren();this.get("el");var i=n.indexOf(this);n.splice(i,1),n.push(this),this.onCanvasChange("zIndex")}},t.prototype.toBack=function(){var r=this.getParent();if(r){var n=r.getChildren();this.get("el");var i=n.indexOf(this);n.splice(i,1),n.unshift(this),this.onCanvasChange("zIndex")}},t.prototype.remove=function(r){r===void 0&&(r=!0);var n=this.getParent();n?(get(n.getChildren(),this),n.get("clearing")||this.onCanvasChange("remove")):this.onCanvasChange("remove"),r&&this.destroy()},t.prototype.resetMatrix=function(){this.attr(tP,this.getDefaultMatrix()),this.onCanvasChange("matrix")},t.prototype.getMatrix=function(){return this.attr(tP)},t.prototype.setMatrix=function(r){this.attr(tP,r),this.onCanvasChange("matrix")},t.prototype.getTotalMatrix=function(){var r=this.cfg.totalMatrix;if(!r){var n=this.attr("matrix"),i=this.cfg.parentMatrix;i&&n?r=_V(i,n):r=n||i,this.set("totalMatrix",r)}return r},t.prototype.applyMatrix=function(r){var n=this.attr("matrix"),i=null;r&&n?i=_V(r,n):i=n||r,this.set("totalMatrix",i),this.set("parentMatrix",r)},t.prototype.getDefaultMatrix=function(){return null},t.prototype.applyToMatrix=function(r){var n=this.attr("matrix");return n?Hp(n,r):r},t.prototype.invertFromMatrix=function(r){var n=this.attr("matrix");if(n){var i=KS(n);if(i)return Hp(i,r)}return r},t.prototype.setClip=function(r){var n=this.getCanvas(),i=null;if(r){var a=this.getShapeBase(),o=E0(r.type),s=a[o];s&&(i=new s({type:r.type,isClipShape:!0,applyTo:this,attrs:r.attrs,canvas:n}))}return this.set("clipShape",i),this.onCanvasChange("clip"),i},t.prototype.getClip=function(){var r=this.cfg.clipShape;return r||null},t.prototype.clone=function(){var r=this,n=this.attrs,i={};ft(n,function(s,l){Fe(n[l])?i[l]=q$t(n[l]):i[l]=n[l]});var a=this.constructor,o=new a({attrs:i});return ft(X$t,function(s){o.set(s,r.get(s))}),o},t.prototype.destroy=function(){var r=this.destroyed;r||(this.attrs={},e.prototype.destroy.call(this))},t.prototype.isAnimatePaused=function(){return this.get("_pause").isPaused},t.prototype.animate=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(!(!this.get("timeline")&&!this.get("canvas"))){this.set("animating",!0);var i=this.get("timeline");i||(i=this.get("canvas").get("timeline"),this.set("timeline",i));var a=this.get("animations")||[];i.timer||i.initTimer();var o=r[0],s=r[1],l=r[2],u=l===void 0?"easeLinear":l,c=r[3],f=c===void 0?ag:c,d=r[4],v=d===void 0?0:d,g,x,w,S,M;Rr(o)?(g=o,o={}):Xi(o)&&o.onFrame&&(g=o.onFrame,x=o.repeat),Xi(s)?(M=s,s=M.duration,u=M.easing||"easeLinear",v=M.delay||0,x=M.repeat||x||!1,f=M.callback||ag,w=M.pauseCallback||ag,S=M.resumeCallback||ag):(Rn(f)&&(v=f,f=null),Rr(u)?(f=u,u="easeLinear"):u=u||"easeLinear");var R=Q$t(o,this),I={fromAttrs:K$t(R,this),toAttrs:R,duration:s,easing:u,repeat:x,callback:f,pauseCallback:w,resumeCallback:S,delay:v,startTime:i.getTime(),id:lh(),onFrame:g,pathFormatted:!1};a.length>0?a=J$t(a,I):i.addAnimator(this),a.push(I),this.set("animations",a),this.set("_pause",{isPaused:!1})}},t.prototype.stopAnimate=function(r){var n=this;r===void 0&&(r=!0);var i=this.get("animations");ft(i,function(a){r&&(a.onFrame?n.attr(a.onFrame(1)):n.attr(a.toAttrs)),a.callback&&a.callback()}),this.set("animating",!1),this.set("animations",[])},t.prototype.pauseAnimate=function(){var r=this.get("timeline"),n=this.get("animations"),i=r.getTime();return ft(n,function(a){a._paused=!0,a._pauseTime=i,a.pauseCallback&&a.pauseCallback()}),this.set("_pause",{isPaused:!0,pauseTime:i}),this},t.prototype.resumeAnimate=function(){var r=this.get("timeline"),n=r.getTime(),i=this.get("animations"),a=this.get("_pause").pauseTime;return ft(i,function(o){o.startTime=o.startTime+(n-a),o._paused=!1,o._pauseTime=null,o.resumeCallback&&o.resumeCallback()}),this.set("_pause",{isPaused:!1}),this.set("animations",i),this},t.prototype.emitDelegation=function(r,n){var i=this,a=n.propagationPath;this.getEvents();var o;r==="mouseenter"?o=n.fromShape:r==="mouseleave"&&(o=n.toShape);for(var s=function(f){var d=a[f],v=d.get("name");if(v){if((d.isGroup()||d.isCanvas&&d.isCanvas())&&o&&met(d,o))return"break";Fe(v)?ft(v,function(g){i.emitDelegateEvent(d,g,n)}):l.emitDelegateEvent(d,v,n)}},l=this,u=0;u<a.length;u++){var c=s(u);if(c==="break")break}},t.prototype.emitDelegateEvent=function(r,n,i){var a=this.getEvents(),o=n+Y$t+i.type;(a[o]||a[Z$t])&&(i.name=o,i.currentTarget=r,i.delegateTarget=this,i.delegateObject=r.get("delegateObject"),this.emit(o,i))},t.prototype.translate=function(r,n){r===void 0&&(r=0),n===void 0&&(n=0);var i=this.getMatrix(),a=lw(i,[["t",r,n]]);return this.setMatrix(a),this},t.prototype.move=function(r,n){var i=this.attr("x")||0,a=this.attr("y")||0;return this.translate(r-i,n-a),this},t.prototype.moveTo=function(r,n){return this.move(r,n)},t.prototype.scale=function(r,n){var i=this.getMatrix(),a=lw(i,[["s",r,n||r]]);return this.setMatrix(a),this},t.prototype.rotate=function(r){var n=this.getMatrix(),i=lw(n,[["r",r]]);return this.setMatrix(i),this},t.prototype.rotateAtStart=function(r){var n=this.attr(),i=n.x,a=n.y,o=this.getMatrix(),s=lw(o,[["t",-i,-a],["r",r],["t",i,a]]);return this.setMatrix(s),this},t.prototype.rotateAtPoint=function(r,n,i){var a=this.getMatrix(),o=lw(a,[["t",-r,-n],["r",i],["t",r,n]]);return this.setMatrix(o),this},t}(qS),xV={},bF="_INDEX";function bet(e,t){if(e.set("canvas",t),e.isGroup()){var r=e.get("children");r.length&&r.forEach(function(n){bet(n,t)})}}function Eet(e,t){if(e.set("timeline",t),e.isGroup()){var r=e.get("children");r.length&&r.forEach(function(n){Eet(n,t)})}}function tHt(e,t,r){r===void 0&&(r=!0),r?t.destroy():(t.set("parent",null),t.set("canvas",null)),get(e.getChildren(),t)}function eHt(e){return function(t,r){var n=e(t,r);return n===0?t[bF]-r[bF]:n}}var wet=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.isCanvas=function(){return!1},t.prototype.getBBox=function(){var r=1/0,n=-1/0,i=1/0,a=-1/0,o=this.getChildren().filter(function(l){return l.get("visible")&&(!l.isGroup()||l.isGroup()&&l.getChildren().length>0)});o.length>0?ft(o,function(l){var u=l.getBBox(),c=u.minX,f=u.maxX,d=u.minY,v=u.maxY;c<r&&(r=c),f>n&&(n=f),d<i&&(i=d),v>a&&(a=v)}):(r=0,n=0,i=0,a=0);var s={x:r,y:i,minX:r,minY:i,maxX:n,maxY:a,width:n-r,height:a-i};return s},t.prototype.getCanvasBBox=function(){var r=1/0,n=-1/0,i=1/0,a=-1/0,o=this.getChildren().filter(function(l){return l.get("visible")&&(!l.isGroup()||l.isGroup()&&l.getChildren().length>0)});o.length>0?ft(o,function(l){var u=l.getCanvasBBox(),c=u.minX,f=u.maxX,d=u.minY,v=u.maxY;c<r&&(r=c),f>n&&(n=f),d<i&&(i=d),v>a&&(a=v)}):(r=0,n=0,i=0,a=0);var s={x:r,y:i,minX:r,minY:i,maxX:n,maxY:a,width:n-r,height:a-i};return s},t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return r.children=[],r},t.prototype.onAttrChange=function(r,n,i){if(e.prototype.onAttrChange.call(this,r,n,i),r==="matrix"){var a=this.getTotalMatrix();this._applyChildrenMarix(a)}},t.prototype.applyMatrix=function(r){var n=this.getTotalMatrix();e.prototype.applyMatrix.call(this,r);var i=this.getTotalMatrix();i!==n&&this._applyChildrenMarix(i)},t.prototype._applyChildrenMarix=function(r){var n=this.getChildren();ft(n,function(i){i.applyMatrix(r)})},t.prototype.addShape=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=r[0],a=r[1];Xi(i)?a=i:a.type=i;var o=xV[a.type];o||(o=E0(a.type),xV[a.type]=o);var s=this.getShapeBase(),l=new s[o](a);return this.add(l),l},t.prototype.addGroup=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=r[0],a=r[1],o;if(Rr(i))a?o=new i(a):o=new i({parent:this});else{var s=i||{},l=this.getGroupBase();o=new l(s)}return this.add(o),o},t.prototype.getCanvas=function(){var r;return this.isCanvas()?r=this:r=this.get("canvas"),r},t.prototype.getShape=function(r,n,i){if(!ib(this))return null;var a=this.getChildren(),o;if(this.isCanvas())o=this._findShape(a,r,n,i);else{var s=[r,n,1];s=this.invertFromMatrix(s),this.isClipped(s[0],s[1])||(o=this._findShape(a,s[0],s[1],i))}return o},t.prototype._findShape=function(r,n,i,a){for(var o=null,s=r.length-1;s>=0;s--){var l=r[s];if(ib(l)&&(l.isGroup()?o=l.getShape(n,i,a):l.isHit(n,i)&&(o=l)),o)break}return o},t.prototype.add=function(r){var n=this.getCanvas(),i=this.getChildren(),a=this.get("timeline"),o=r.getParent();o&&tHt(o,r,!1),r.set("parent",this),n&&bet(r,n),a&&Eet(r,a),i.push(r),r.onCanvasChange("add"),this._applyElementMatrix(r)},t.prototype._applyElementMatrix=function(r){var n=this.getTotalMatrix();n&&r.applyMatrix(n)},t.prototype.getChildren=function(){return this.get("children")||[]},t.prototype.sort=function(){var r=this.getChildren();ft(r,function(n,i){return n[bF]=i,n}),r.sort(eHt(function(n,i){return n.get("zIndex")-i.get("zIndex")})),this.onCanvasChange("sort")},t.prototype.clear=function(){if(this.set("clearing",!0),!this.destroyed){for(var r=this.getChildren(),n=r.length-1;n>=0;n--)r[n].destroy();this.set("children",[]),this.onCanvasChange("clear"),this.set("clearing",!1)}},t.prototype.destroy=function(){this.get("destroyed")||(this.clear(),e.prototype.destroy.call(this))},t.prototype.getFirst=function(){return this.getChildByIndex(0)},t.prototype.getLast=function(){var r=this.getChildren();return this.getChildByIndex(r.length-1)},t.prototype.getChildByIndex=function(r){var n=this.getChildren();return n[r]},t.prototype.getCount=function(){var r=this.getChildren();return r.length},t.prototype.contain=function(r){var n=this.getChildren();return n.indexOf(r)>-1},t.prototype.removeChild=function(r,n){n===void 0&&(n=!0),this.contain(r)&&r.remove(n)},t.prototype.findAll=function(r){var n=[],i=this.getChildren();return ft(i,function(a){r(a)&&n.push(a),a.isGroup()&&(n=n.concat(a.findAll(r)))}),n},t.prototype.find=function(r){var n=null,i=this.getChildren();return ft(i,function(a){if(r(a)?n=a:a.isGroup()&&(n=a.find(r)),n)return!1}),n},t.prototype.findById=function(r){return this.find(function(n){return n.get("id")===r})},t.prototype.findByClassName=function(r){return this.find(function(n){return n.get("className")===r})},t.prototype.findAllByName=function(r){return this.findAll(function(n){return n.get("name")===r})},t}(xet),ab=0,Fw=0,uw=0,Cet=1e3,SR,Bw,TR=0,l_=0,n3=0,kC=typeof performance=="object"&&performance.now?performance:Date,Tet=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Aet(){return l_||(Tet(rHt),l_=kC.now()+n3)}function rHt(){l_=0}function EF(){this._call=this._time=this._next=null}EF.prototype=Met.prototype={constructor:EF,restart:function(e,t,r){if(typeof e!="function")throw new TypeError("callback is not a function");r=(r==null?Aet():+r)+(t==null?0:+t),!this._next&&Bw!==this&&(Bw?Bw._next=this:SR=this,Bw=this),this._call=e,this._time=r,wF()},stop:function(){this._call&&(this._call=null,this._time=1/0,wF())}};function Met(e,t,r){var n=new EF;return n.restart(e,t,r),n}function nHt(){Aet(),++ab;for(var e=SR,t;e;)(t=l_-e._time)>=0&&e._call.call(null,t),e=e._next;--ab}function bV(){l_=(TR=kC.now())+n3,ab=Fw=0;try{nHt()}finally{ab=0,aHt(),l_=0}}function iHt(){var e=kC.now(),t=e-TR;t>Cet&&(n3-=t,TR=e)}function aHt(){for(var e,t=SR,r,n=1/0;t;)t._call?(n>t._time&&(n=t._time),e=t,t=t._next):(r=t._next,t._next=null,t=e?e._next=r:SR=r);Bw=e,wF(n)}function wF(e){if(!ab){Fw&&(Fw=clearTimeout(Fw));var t=e-l_;t>24?(e<1/0&&(Fw=setTimeout(bV,e-kC.now()-n3)),uw&&(uw=clearInterval(uw))):(uw||(TR=kC.now(),uw=setInterval(iHt,Cet)),ab=1,Tet(bV))}}const sN=e=>()=>e;function oHt(e,t){return function(r){return e+r*t}}function sHt(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function lHt(e){return(e=+e)==1?Ret:function(t,r){return r-t?sHt(t,r,e):sN(isNaN(t)?r:t)}}function Ret(e,t){var r=t-e;return r?oHt(e,r):sN(isNaN(e)?t:e)}const EV=function e(t){var r=lHt(t);function n(i,a){var o=r((i=e0(i)).r,(a=e0(a)).r),s=r(i.g,a.g),l=r(i.b,a.b),u=Ret(i.opacity,a.opacity);return function(c){return i.r=o(c),i.g=s(c),i.b=l(c),i.opacity=u(c),i+""}}return n.gamma=e,n}(1);function Iet(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),i;return function(a){for(i=0;i<r;++i)n[i]=e[i]*(1-a)+t[i]*a;return n}}function Let(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function uHt(e,t){return(Let(t)?Iet:Oet)(e,t)}function Oet(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,i=new Array(n),a=new Array(r),o;for(o=0;o<n;++o)i[o]=AR(e[o],t[o]);for(;o<r;++o)a[o]=t[o];return function(s){for(o=0;o<n;++o)a[o]=i[o](s);return a}}function cHt(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function CF(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function hHt(e,t){var r={},n={},i;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in e?r[i]=AR(e[i],t[i]):n[i]=t[i];return function(a){for(i in r)n[i]=r[i](a);return n}}var SF=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,eP=new RegExp(SF.source,"g");function fHt(e){return function(){return e}}function dHt(e){return function(t){return e(t)+""}}function pHt(e,t){var r=SF.lastIndex=eP.lastIndex=0,n,i,a,o=-1,s=[],l=[];for(e=e+"",t=t+"";(n=SF.exec(e))&&(i=eP.exec(t));)(a=i.index)>r&&(a=t.slice(r,a),s[o]?s[o]+=a:s[++o]=a),(n=n[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,l.push({i:o,x:CF(n,i)})),r=eP.lastIndex;return r<t.length&&(a=t.slice(r),s[o]?s[o]+=a:s[++o]=a),s.length<2?l[0]?dHt(l[0].x):fHt(t):(t=l.length,function(u){for(var c=0,f;c<t;++c)s[(f=l[c]).i]=f.x(u);return s.join("")})}function AR(e,t){var r=typeof t,n;return t==null||r==="boolean"?sN(t):(r==="number"?CF:r==="string"?(n=t0(t))?(t=n,EV):pHt:t instanceof t0?EV:t instanceof Date?cHt:Let(t)?Iet:Array.isArray(t)?Oet:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?hHt:CF)(e,t)}function vHt(e){return+e}function gHt(e){return e*e}function mHt(e){return e*(2-e)}function wV(e){return((e*=2)<=1?e*e:--e*(2-e)+1)/2}function yHt(e){return e*e*e}function _Ht(e){return--e*e*e+1}function CV(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var lN=3,xHt=function e(t){t=+t;function r(n){return Math.pow(n,t)}return r.exponent=e,r}(lN),bHt=function e(t){t=+t;function r(n){return 1-Math.pow(1-n,t)}return r.exponent=e,r}(lN),SV=function e(t){t=+t;function r(n){return((n*=2)<=1?Math.pow(n,t):2-Math.pow(2-n,t))/2}return r.exponent=e,r}(lN),Pet=Math.PI,Det=Pet/2;function EHt(e){return+e==1?1:1-Math.cos(e*Det)}function wHt(e){return Math.sin(e*Det)}function TV(e){return(1-Math.cos(Pet*e))/2}function n0(e){return(Math.pow(2,-10*e)-.0009765625)*1.0009775171065494}function CHt(e){return n0(1-+e)}function SHt(e){return 1-n0(e)}function AV(e){return((e*=2)<=1?n0(1-e):2-n0(e-1))/2}function THt(e){return 1-Math.sqrt(1-e*e)}function AHt(e){return Math.sqrt(1- --e*e)}function MV(e){return((e*=2)<=1?1-Math.sqrt(1-e*e):Math.sqrt(1-(e-=2)*e)+1)/2}var TF=4/11,MHt=6/11,RHt=8/11,IHt=3/4,LHt=9/11,OHt=10/11,PHt=15/16,DHt=21/22,FHt=63/64,rA=1/TF/TF;function BHt(e){return 1-zC(1-e)}function zC(e){return(e=+e)<TF?rA*e*e:e<RHt?rA*(e-=MHt)*e+IHt:e<OHt?rA*(e-=LHt)*e+PHt:rA*(e-=DHt)*e+FHt}function NHt(e){return((e*=2)<=1?1-zC(1-e):zC(e-1)+1)/2}var uN=1.70158,kHt=function e(t){t=+t;function r(n){return(n=+n)*n*(t*(n-1)+n)}return r.overshoot=e,r}(uN),zHt=function e(t){t=+t;function r(n){return--n*n*((n+1)*t+n)+1}return r.overshoot=e,r}(uN),RV=function e(t){t=+t;function r(n){return((n*=2)<1?n*n*((t+1)*n-t):(n-=2)*n*((t+1)*n+t)+2)/2}return r.overshoot=e,r}(uN),ob=2*Math.PI,cN=1,hN=.3,UHt=function e(t,r){var n=Math.asin(1/(t=Math.max(1,t)))*(r/=ob);function i(a){return t*n0(- --a)*Math.sin((n-a)/r)}return i.amplitude=function(a){return e(a,r*ob)},i.period=function(a){return e(t,a)},i}(cN,hN),IV=function e(t,r){var n=Math.asin(1/(t=Math.max(1,t)))*(r/=ob);function i(a){return 1-t*n0(a=+a)*Math.sin((a+n)/r)}return i.amplitude=function(a){return e(a,r*ob)},i.period=function(a){return e(t,a)},i}(cN,hN),$Ht=function e(t,r){var n=Math.asin(1/(t=Math.max(1,t)))*(r/=ob);function i(a){return((a=a*2-1)<0?t*n0(-a)*Math.sin((n-a)/r):2-t*n0(a)*Math.sin((n+a)/r))/2}return i.amplitude=function(a){return e(a,r*ob)},i.period=function(a){return e(t,a)},i}(cN,hN);const HHt=Object.freeze(Object.defineProperty({__proto__:null,easeBack:RV,easeBackIn:kHt,easeBackInOut:RV,easeBackOut:zHt,easeBounce:zC,easeBounceIn:BHt,easeBounceInOut:NHt,easeBounceOut:zC,easeCircle:MV,easeCircleIn:THt,easeCircleInOut:MV,easeCircleOut:AHt,easeCubic:CV,easeCubicIn:yHt,easeCubicInOut:CV,easeCubicOut:_Ht,easeElastic:IV,easeElasticIn:UHt,easeElasticInOut:$Ht,easeElasticOut:IV,easeExp:AV,easeExpIn:CHt,easeExpInOut:AV,easeExpOut:SHt,easeLinear:vHt,easePoly:SV,easePolyIn:xHt,easePolyInOut:SV,easePolyOut:bHt,easeQuad:wV,easeQuadIn:gHt,easeQuadInOut:wV,easeQuadOut:mHt,easeSin:TV,easeSinIn:EHt,easeSinInOut:TV,easeSinOut:wHt},Symbol.toStringTag,{value:"Module"}));var Fet={};function VHt(e){return Fet[e.toLowerCase()]||HHt[e]}function fN(e,t){Fet[e.toLowerCase()]=t}var GHt=function(e){return["fill","stroke","fillStyle","strokeStyle"].includes(e)},WHt=function(e){return/^[r,R,L,l]{1}[\s]*\(/.test(e)},LV=[1,0,0,0,1,0,0,0,1];function XHt(e,t,r){var n={},i=t.fromAttrs,a=t.toAttrs;if(!e.destroyed){var o;for(var s in a)if(!Di(i[s],a[s]))if(s==="path"){var l=a[s],u=i[s];l.length>u.length?(l=cx(a[s]),u=cx(i[s]),u=pet(u,l),u=xF(u,l),t.fromAttrs.path=u,t.toAttrs.path=l):t.pathFormatted||(l=cx(a[s]),u=cx(i[s]),u=xF(u,l),t.fromAttrs.path=u,t.toAttrs.path=l,t.pathFormatted=!0),n[s]=[];for(var c=0;c<l.length;c++){for(var f=l[c],d=u[c],v=[],g=0;g<f.length;g++)Rn(f[g])&&d&&Rn(d[g])?(o=AR(d[g],f[g]),v.push(o(r))):v.push(f[g]);n[s].push(v)}}else if(s==="matrix"){var x=uHt(i[s]||LV,a[s]||LV),w=x(r);n[s]=w}else GHt(s)&&WHt(a[s])?n[s]=a[s]:Rr(a[s])||(o=AR(i[s],a[s]),n[s]=o(r));e.attr(n)}}function jHt(e,t,r){var n=t.startTime,i=t.delay;if(r<n+i||t._paused)return!1;var a,o=t.duration,s=t.easing,l=VHt(s);if(r=r-n-t.delay,t.repeat)a=r%o/o,a=l(a);else if(a=r/o,a<1)a=l(a);else return t.onFrame?e.attr(t.onFrame(1)):e.attr(t.toAttrs),!0;if(t.onFrame){var u=t.onFrame(a);e.attr(u)}else XHt(e,t,a);return!1}var YHt=function(){function e(t){this.animators=[],this.current=0,this.timer=null,this.canvas=t}return e.prototype.initTimer=function(){var t=this,r=!1,n,i,a;this.timer=Met(function(o){if(t.current=o,t.animators.length>0){for(var s=t.animators.length-1;s>=0;s--){if(n=t.animators[s],n.destroyed){t.removeAnimator(s);continue}if(!n.isAnimatePaused()){i=n.get("animations");for(var l=i.length-1;l>=0;l--)a=i[l],r=jHt(n,a,o),r&&(i.splice(l,1),r=!1,a.callback&&a.callback())}i.length===0&&t.removeAnimator(s)}var u=t.canvas.get("autoDraw");u||t.canvas.draw()}})},e.prototype.addAnimator=function(t){this.animators.push(t)},e.prototype.removeAnimator=function(t){this.animators.splice(t,1)},e.prototype.isAnimating=function(){return!!this.animators.length},e.prototype.stop=function(){this.timer&&this.timer.stop()},e.prototype.stopAllAnimations=function(t){t===void 0&&(t=!0),this.animators.forEach(function(r){r.stopAnimate(t)}),this.animators=[],this.canvas.draw()},e.prototype.getTime=function(){return this.current},e}(),ZHt=40,OV=0,PV=["mousedown","mouseup","dblclick","mouseout","mouseover","mousemove","mouseleave","mouseenter","touchstart","touchmove","touchend","dragenter","dragover","dragleave","drop","contextmenu","mousewheel"];function DV(e,t,r){r.name=t,r.target=e,r.currentTarget=e,r.delegateTarget=e,e.emit(t,r)}function qHt(e,t,r){if(r.bubbles){var n=void 0,i=!1;if(t==="mouseenter"?(n=r.fromShape,i=!0):t==="mouseleave"&&(i=!0,n=r.toShape),e.isCanvas()&&i)return;if(n&&met(e,n)){r.bubbles=!1;return}r.name=t,r.currentTarget=e,r.delegateTarget=e,e.emit(t,r)}}var KHt=function(){function e(t){var r=this;this.draggingShape=null,this.dragging=!1,this.currentShape=null,this.mousedownShape=null,this.mousedownPoint=null,this._eventCallback=function(n){var i=n.type;r._triggerEvent(i,n)},this._onDocumentMove=function(n){var i=r.canvas,a=i.get("el");if(a!==n.target&&(r.dragging||r.currentShape)){var o=r._getPointInfo(n);r.dragging&&r._emitEvent("drag",n,o,r.draggingShape)}},this._onDocumentMouseUp=function(n){var i=r.canvas,a=i.get("el");if(a!==n.target&&r.dragging){var o=r._getPointInfo(n);r.draggingShape&&r._emitEvent("drop",n,o,null),r._emitEvent("dragend",n,o,r.draggingShape),r._afterDrag(r.draggingShape,o,n)}},this.canvas=t.canvas}return e.prototype.init=function(){this._bindEvents()},e.prototype._bindEvents=function(){var t=this,r=this.canvas.get("el");ft(PV,function(n){r.addEventListener(n,t._eventCallback)}),document&&(document.addEventListener("mousemove",this._onDocumentMove),document.addEventListener("mouseup",this._onDocumentMouseUp))},e.prototype._clearEvents=function(){var t=this,r=this.canvas.get("el");ft(PV,function(n){r.removeEventListener(n,t._eventCallback)}),document&&(document.removeEventListener("mousemove",this._onDocumentMove),document.removeEventListener("mouseup",this._onDocumentMouseUp))},e.prototype._getEventObj=function(t,r,n,i,a,o){var s=new Nb(t,r);return s.fromShape=a,s.toShape=o,s.x=n.x,s.y=n.y,s.clientX=n.clientX,s.clientY=n.clientY,s.propagationPath.push(i),s},e.prototype._getShape=function(t,r){return this.canvas.getShape(t.x,t.y,r)},e.prototype._getPointInfo=function(t){var r=this.canvas,n=r.getClientByEvent(t),i=r.getPointByEvent(t);return{x:i.x,y:i.y,clientX:n.x,clientY:n.y}},e.prototype._triggerEvent=function(t,r){var n=this._getPointInfo(r),i=this._getShape(n,r),a=this["_on"+t],o=!1;if(a)a.call(this,n,i,r);else{var s=this.currentShape;t==="mouseenter"||t==="dragenter"||t==="mouseover"?(this._emitEvent(t,r,n,null,null,i),i&&this._emitEvent(t,r,n,i,null,i),t==="mouseenter"&&this.draggingShape&&this._emitEvent("dragenter",r,n,null)):t==="mouseleave"||t==="dragleave"||t==="mouseout"?(o=!0,s&&this._emitEvent(t,r,n,s,s,null),this._emitEvent(t,r,n,null,s,null),t==="mouseleave"&&this.draggingShape&&this._emitEvent("dragleave",r,n,null)):this._emitEvent(t,r,n,i,null,null)}if(o||(this.currentShape=i),i&&!i.get("destroyed")){var l=this.canvas,u=l.get("el");u.style.cursor=i.attr("cursor")||l.get("cursor")}},e.prototype._onmousedown=function(t,r,n){n.button===OV&&(this.mousedownShape=r,this.mousedownPoint=t,this.mousedownTimeStamp=n.timeStamp),this._emitEvent("mousedown",n,t,r,null,null)},e.prototype._emitMouseoverEvents=function(t,r,n,i){var a=this.canvas.get("el");n!==i&&(n&&(this._emitEvent("mouseout",t,r,n,n,i),this._emitEvent("mouseleave",t,r,n,n,i),(!i||i.get("destroyed"))&&(a.style.cursor=this.canvas.get("cursor"))),i&&(this._emitEvent("mouseover",t,r,i,n,i),this._emitEvent("mouseenter",t,r,i,n,i)))},e.prototype._emitDragoverEvents=function(t,r,n,i,a){i?(i!==n&&(n&&this._emitEvent("dragleave",t,r,n,n,i),this._emitEvent("dragenter",t,r,i,n,i)),a||this._emitEvent("dragover",t,r,i)):n&&this._emitEvent("dragleave",t,r,n,n,i),a&&this._emitEvent("dragover",t,r,i)},e.prototype._afterDrag=function(t,r,n){t&&(t.set("capture",!0),this.draggingShape=null),this.dragging=!1;var i=this._getShape(r,n);i!==t&&this._emitMouseoverEvents(n,r,t,i),this.currentShape=i},e.prototype._onmouseup=function(t,r,n){if(n.button===OV){var i=this.draggingShape;this.dragging?(i&&this._emitEvent("drop",n,t,r),this._emitEvent("dragend",n,t,i),this._afterDrag(i,t,n)):(this._emitEvent("mouseup",n,t,r),r===this.mousedownShape&&this._emitEvent("click",n,t,r),this.mousedownShape=null,this.mousedownPoint=null)}},e.prototype._ondragover=function(t,r,n){n.preventDefault();var i=this.currentShape;this._emitDragoverEvents(n,t,i,r,!0)},e.prototype._onmousemove=function(t,r,n){var i=this.canvas,a=this.currentShape,o=this.draggingShape;if(this.dragging)o&&this._emitDragoverEvents(n,t,a,r,!1),this._emitEvent("drag",n,t,o);else{var s=this.mousedownPoint;if(s){var l=this.mousedownShape,u=n.timeStamp,c=u-this.mousedownTimeStamp,f=s.clientX-t.clientX,d=s.clientY-t.clientY,v=f*f+d*d;c>120||v>ZHt?l&&l.get("draggable")?(o=this.mousedownShape,o.set("capture",!1),this.draggingShape=o,this.dragging=!0,this._emitEvent("dragstart",n,t,o),this.mousedownShape=null,this.mousedownPoint=null):!l&&i.get("draggable")?(this.dragging=!0,this._emitEvent("dragstart",n,t,null),this.mousedownShape=null,this.mousedownPoint=null):(this._emitMouseoverEvents(n,t,a,r),this._emitEvent("mousemove",n,t,r)):(this._emitMouseoverEvents(n,t,a,r),this._emitEvent("mousemove",n,t,r))}else this._emitMouseoverEvents(n,t,a,r),this._emitEvent("mousemove",n,t,r)}},e.prototype._emitEvent=function(t,r,n,i,a,o){var s=this._getEventObj(t,r,n,i,a,o);if(i){s.shape=i,DV(i,t,s);for(var l=i.getParent();l;)l.emitDelegation(t,s),s.propagationStopped||qHt(l,t,s),s.propagationPath.push(l),l=l.getParent()}else{var u=this.canvas;DV(u,t,s)}},e.prototype.destroy=function(){this._clearEvents(),this.canvas=null,this.currentShape=null,this.draggingShape=null,this.mousedownPoint=null,this.mousedownShape=null,this.mousedownTimeStamp=null},e}(),FV="px",BV=yet(),QHt=BV&&BV.name==="firefox",QS=function(e){$t(t,e);function t(r){var n=e.call(this,r)||this;return n.initContainer(),n.initDom(),n.initEvents(),n.initTimeline(),n}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return r.cursor="default",r.supportCSSTransform=!1,r},t.prototype.initContainer=function(){var r=this.get("container");en(r)&&(r=document.getElementById(r),this.set("container",r))},t.prototype.initDom=function(){var r=this.createDom();this.set("el",r);var n=this.get("container");n.appendChild(r),this.setDOMSize(this.get("width"),this.get("height"))},t.prototype.initEvents=function(){var r=new KHt({canvas:this});r.init(),this.set("eventController",r)},t.prototype.initTimeline=function(){var r=new YHt(this);this.set("timeline",r)},t.prototype.setDOMSize=function(r,n){var i=this.get("el");pV&&(i.style.width=r+FV,i.style.height=n+FV)},t.prototype.changeSize=function(r,n){this.setDOMSize(r,n),this.set("width",r),this.set("height",n),this.onCanvasChange("changeSize")},t.prototype.getRenderer=function(){return this.get("renderer")},t.prototype.getCursor=function(){return this.get("cursor")},t.prototype.setCursor=function(r){this.set("cursor",r);var n=this.get("el");pV&&n&&(n.style.cursor=r)},t.prototype.getPointByEvent=function(r){var n=this.get("supportCSSTransform");if(n){if(QHt&&!ze(r.layerX)&&r.layerX!==r.offsetX)return{x:r.layerX,y:r.layerY};if(!ze(r.offsetX))return{x:r.offsetX,y:r.offsetY}}var i=this.getClientByEvent(r),a=i.x,o=i.y;return this.getPointByClient(a,o)},t.prototype.getClientByEvent=function(r){var n=r;return r.touches&&(r.type==="touchend"?n=r.changedTouches[0]:n=r.touches[0]),{x:n.clientX,y:n.clientY}},t.prototype.getPointByClient=function(r,n){var i=this.get("el"),a=i.getBoundingClientRect();return{x:r-a.left,y:n-a.top}},t.prototype.getClientByPoint=function(r,n){var i=this.get("el"),a=i.getBoundingClientRect();return{x:r+a.left,y:n+a.top}},t.prototype.draw=function(){},t.prototype.removeDom=function(){var r=this.get("el");r.parentNode.removeChild(r)},t.prototype.clearEvents=function(){var r=this.get("eventController");r.destroy()},t.prototype.isCanvas=function(){return!0},t.prototype.getParent=function(){return null},t.prototype.destroy=function(){var r=this.get("timeline");this.get("destroyed")||(this.clear(),r&&r.stop(),this.clearEvents(),this.removeDom(),e.prototype.destroy.call(this))},t}(wet),JS=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.isGroup=function(){return!0},t.prototype.isEntityGroup=function(){return!1},t.prototype.clone=function(){for(var r=e.prototype.clone.call(this),n=this.getChildren(),i=0;i<n.length;i++){var a=n[i];r.add(a.clone())}return r},t}(wet),t2=function(e){$t(t,e);function t(r){return e.call(this,r)||this}return t.prototype._isInBBox=function(r,n){var i=this.getBBox();return i.minX<=r&&i.maxX>=r&&i.minY<=n&&i.maxY>=n},t.prototype.afterAttrsChange=function(r){e.prototype.afterAttrsChange.call(this,r),this.clearCacheBBox()},t.prototype.getBBox=function(){var r=this.cfg.bbox;return r||(r=this.calculateBBox(),this.set("bbox",r)),r},t.prototype.getCanvasBBox=function(){var r=this.cfg.canvasBBox;return r||(r=this.calculateCanvasBBox(),this.set("canvasBBox",r)),r},t.prototype.applyMatrix=function(r){e.prototype.applyMatrix.call(this,r),this.set("canvasBBox",null)},t.prototype.calculateCanvasBBox=function(){var r=this.getBBox(),n=this.getTotalMatrix(),i=r.minX,a=r.minY,o=r.maxX,s=r.maxY;if(n){var l=Hp(n,[r.minX,r.minY]),u=Hp(n,[r.maxX,r.minY]),c=Hp(n,[r.minX,r.maxY]),f=Hp(n,[r.maxX,r.maxY]);i=Math.min(l[0],u[0],c[0],f[0]),o=Math.max(l[0],u[0],c[0],f[0]),a=Math.min(l[1],u[1],c[1],f[1]),s=Math.max(l[1],u[1],c[1],f[1])}var d=this.attrs;if(d.shadowColor){var v=d.shadowBlur,g=v===void 0?0:v,x=d.shadowOffsetX,w=x===void 0?0:x,S=d.shadowOffsetY,M=S===void 0?0:S,R=i-g+w,I=o+g+w,P=a-g+M,k=s+g+M;i=Math.min(i,R),o=Math.max(o,I),a=Math.min(a,P),s=Math.max(s,k)}return{x:i,y:a,minX:i,minY:a,maxX:o,maxY:s,width:o-i,height:s-a}},t.prototype.clearCacheBBox=function(){this.set("bbox",null),this.set("canvasBBox",null)},t.prototype.isClipShape=function(){return this.get("isClipShape")},t.prototype.isInShape=function(r,n){return!1},t.prototype.isOnlyHitBox=function(){return!1},t.prototype.isHit=function(r,n){var i=this.get("startArrowShape"),a=this.get("endArrowShape"),o=[r,n,1];o=this.invertFromMatrix(o);var s=o[0],l=o[1],u=this._isInBBox(s,l);return this.isOnlyHitBox()?u:!!(u&&!this.isClipped(s,l)&&(this.isInShape(s,l)||i&&i.isHit(s,l)||a&&a.isHit(s,l)))},t}(xet),Bet=new Map;function Kh(e,t){Bet.set(e,t)}function e2(e){return Bet.get(e)}function Net(e){var t=e.attr(),r=t.x,n=t.y,i=t.width,a=t.height;return{x:r,y:n,width:i,height:a}}function ket(e){var t=e.attr(),r=t.x,n=t.y,i=t.r;return{x:r-i,y:n-i,width:i*2,height:i*2}}function zu(e,t,r,n){var i=e-r,a=t-n;return Math.sqrt(i*i+a*a)}function pM(e,t){return Math.abs(e-t)<.001}function kb(e,t){var r=Wh(e),n=Wh(t),i=nh(e),a=nh(t);return{x:r,y:n,width:i-r,height:a-n}}function i3(e){return(e+Math.PI*2)%(Math.PI*2)}const Wl={box:function(e,t,r,n){return kb([e,r],[t,n])},length:function(e,t,r,n){return zu(e,t,r,n)},pointAt:function(e,t,r,n,i){return{x:(1-i)*e+i*r,y:(1-i)*t+i*n}},pointDistance:function(e,t,r,n,i,a){var o=(r-e)*(i-e)+(n-t)*(a-t);if(o<0)return zu(e,t,i,a);var s=(r-e)*(r-e)+(n-t)*(n-t);return o>s?zu(r,n,i,a):this.pointToLine(e,t,r,n,i,a)},pointToLine:function(e,t,r,n,i,a){var o=[r-e,n-t];if(n3t(o,[0,0]))return Math.sqrt((i-e)*(i-e)+(a-t)*(a-t));var s=[-o[1],o[0]];jx(s,s);var l=[i-e,a-t];return Math.abs(XM(l,s))},tangentAngle:function(e,t,r,n){return Math.atan2(n-t,r-e)}};var JHt=1e-4;function zet(e,t,r,n,i,a){var o,s=1/0,l=[r,n],u=20;a&&a>200&&(u=a/10);for(var c=1/u,f=c/10,d=0;d<=u;d++){var v=d*c,g=[i.apply(null,e.concat([v])),i.apply(null,t.concat([v]))],x=zu(l[0],l[1],g[0],g[1]);x<s&&(o=v,s=x)}if(o===0)return{x:e[0],y:t[0]};if(o===1){var w=e.length;return{x:e[w-1],y:t[w-1]}}s=1/0;for(var d=0;d<32&&!(f<JHt);d++){var S=o-f,M=o+f,g=[i.apply(null,e.concat([S])),i.apply(null,t.concat([S]))],x=zu(l[0],l[1],g[0],g[1]);if(S>=0&&x<s)o=S,s=x;else{var R=[i.apply(null,e.concat([M])),i.apply(null,t.concat([M]))],I=zu(l[0],l[1],R[0],R[1]);M<=1&&I<s?(o=M,s=I):f*=.5}}return{x:i.apply(null,e.concat([o])),y:i.apply(null,t.concat([o]))}}function tVt(e,t){for(var r=0,n=e.length,i=0;i<n;i++){var a=e[i],o=t[i],s=e[(i+1)%n],l=t[(i+1)%n];r+=zu(a,o,s,l)}return r/2}function Mm(e,t,r,n){var i=1-n;return i*i*e+2*n*i*t+n*n*r}function NV(e,t,r){var n=e+r-2*t;if(pM(n,0))return[.5];var i=(e-t)/n;return i<=1&&i>=0?[i]:[]}function kV(e,t,r,n){return 2*(1-n)*(t-e)+2*n*(r-t)}function Uet(e,t,r,n,i,a,o){var s=Mm(e,r,i,o),l=Mm(t,n,a,o),u=Wl.pointAt(e,t,r,n,o),c=Wl.pointAt(r,n,i,a,o);return[[e,t,u.x,u.y,s,l],[s,l,c.x,c.y,i,a]]}function AF(e,t,r,n,i,a,o){if(o===0)return(zu(e,t,r,n)+zu(r,n,i,a)+zu(e,t,i,a))/2;var s=Uet(e,t,r,n,i,a,.5),l=s[0],u=s[1];return l.push(o-1),u.push(o-1),AF.apply(null,l)+AF.apply(null,u)}const $et={box:function(e,t,r,n,i,a){var o=NV(e,r,i)[0],s=NV(t,n,a)[0],l=[e,i],u=[t,a];return o!==void 0&&l.push(Mm(e,r,i,o)),s!==void 0&&u.push(Mm(t,n,a,s)),kb(l,u)},length:function(e,t,r,n,i,a){return AF(e,t,r,n,i,a,3)},nearestPoint:function(e,t,r,n,i,a,o,s){return zet([e,r,i],[t,n,a],o,s,Mm)},pointDistance:function(e,t,r,n,i,a,o,s){var l=this.nearestPoint(e,t,r,n,i,a,o,s);return zu(l.x,l.y,o,s)},interpolationAt:Mm,pointAt:function(e,t,r,n,i,a,o){return{x:Mm(e,r,i,o),y:Mm(t,n,a,o)}},divide:function(e,t,r,n,i,a,o){return Uet(e,t,r,n,i,a,o)},tangentAngle:function(e,t,r,n,i,a,o){var s=kV(e,r,i,o),l=kV(t,n,a,o),u=Math.atan2(l,s);return i3(u)}};function Rm(e,t,r,n,i){var a=1-i;return a*a*a*e+3*t*i*a*a+3*r*i*i*a+n*i*i*i}function zV(e,t,r,n,i){var a=1-i;return 3*(a*a*(t-e)+2*a*i*(r-t)+i*i*(n-r))}function rP(e,t,r,n){var i=-3*e+9*t-9*r+3*n,a=6*e-12*t+6*r,o=3*t-3*e,s=[],l,u,c;if(pM(i,0))pM(a,0)||(l=-o/a,l>=0&&l<=1&&s.push(l));else{var f=a*a-4*i*o;pM(f,0)?s.push(-a/(2*i)):f>0&&(c=Math.sqrt(f),l=(-a+c)/(2*i),u=(-a-c)/(2*i),l>=0&&l<=1&&s.push(l),u>=0&&u<=1&&s.push(u))}return s}function Het(e,t,r,n,i,a,o,s,l){var u=Rm(e,r,i,o,l),c=Rm(t,n,a,s,l),f=Wl.pointAt(e,t,r,n,l),d=Wl.pointAt(r,n,i,a,l),v=Wl.pointAt(i,a,o,s,l),g=Wl.pointAt(f.x,f.y,d.x,d.y,l),x=Wl.pointAt(d.x,d.y,v.x,v.y,l);return[[e,t,f.x,f.y,g.x,g.y,u,c],[u,c,x.x,x.y,v.x,v.y,o,s]]}function MF(e,t,r,n,i,a,o,s,l){if(l===0)return tVt([e,r,i,o],[t,n,a,s]);var u=Het(e,t,r,n,i,a,o,s,.5),c=u[0],f=u[1];return c.push(l-1),f.push(l-1),MF.apply(null,c)+MF.apply(null,f)}const Jw={extrema:rP,box:function(e,t,r,n,i,a,o,s){for(var l=[e,o],u=[t,s],c=rP(e,r,i,o),f=rP(t,n,a,s),d=0;d<c.length;d++)l.push(Rm(e,r,i,o,c[d]));for(var d=0;d<f.length;d++)u.push(Rm(t,n,a,s,f[d]));return kb(l,u)},length:function(e,t,r,n,i,a,o,s){return MF(e,t,r,n,i,a,o,s,3)},nearestPoint:function(e,t,r,n,i,a,o,s,l,u,c){return zet([e,r,i,o],[t,n,a,s],l,u,Rm,c)},pointDistance:function(e,t,r,n,i,a,o,s,l,u,c){var f=this.nearestPoint(e,t,r,n,i,a,o,s,l,u,c);return zu(f.x,f.y,l,u)},interpolationAt:Rm,pointAt:function(e,t,r,n,i,a,o,s,l){return{x:Rm(e,r,i,o,l),y:Rm(t,n,a,s,l)}},divide:function(e,t,r,n,i,a,o,s,l){return Het(e,t,r,n,i,a,o,s,l)},tangentAngle:function(e,t,r,n,i,a,o,s,l){var u=zV(e,r,i,o,l),c=zV(t,n,a,s,l);return i3(Math.atan2(c,u))}};function UV(e,t){var r=Math.abs(e);return t>0?r:r*-1}const eVt={box:function(e,t,r,n){return{x:e-r,y:t-n,width:r*2,height:n*2}},length:function(e,t,r,n){return Math.PI*(3*(r+n)-Math.sqrt((3*r+n)*(r+3*n)))},nearestPoint:function(e,t,r,n,i,a){var o=r,s=n;if(o===0||s===0)return{x:e,y:t};for(var l=i-e,u=a-t,c=Math.abs(l),f=Math.abs(u),d=o*o,v=s*s,g=Math.PI/4,x,w,S=0;S<4;S++){x=o*Math.cos(g),w=s*Math.sin(g);var M=(d-v)*Math.pow(Math.cos(g),3)/o,R=(v-d)*Math.pow(Math.sin(g),3)/s,I=x-M,P=w-R,k=c-M,z=f-R,G=Math.hypot(P,I),J=Math.hypot(z,k),Z=G*Math.asin((I*z-P*k)/(G*J)),X=Z/Math.sqrt(d+v-x*x-w*w);g+=X,g=Math.min(Math.PI/2,Math.max(0,g))}return{x:e+UV(x,l),y:t+UV(w,u)}},pointDistance:function(e,t,r,n,i,a){var o=this.nearestPoint(e,t,r,n,i,a);return zu(o.x,o.y,i,a)},pointAt:function(e,t,r,n,i){var a=2*Math.PI*i;return{x:e+r*Math.cos(a),y:t+n*Math.sin(a)}},tangentAngle:function(e,t,r,n,i){var a=2*Math.PI*i,o=Math.atan2(n*Math.cos(a),-r*Math.sin(a));return i3(o)}};function rVt(e,t,r,n,i,a,o,s){return-1*r*Math.cos(i)*Math.sin(s)-n*Math.sin(i)*Math.cos(s)}function nVt(e,t,r,n,i,a,o,s){return-1*r*Math.sin(i)*Math.sin(s)+n*Math.cos(i)*Math.cos(s)}function iVt(e,t,r){return Math.atan(-t/e*Math.tan(r))}function aVt(e,t,r){return Math.atan(t/(e*Math.tan(r)))}function $V(e,t,r,n,i,a){return r*Math.cos(i)*Math.cos(a)-n*Math.sin(i)*Math.sin(a)+e}function HV(e,t,r,n,i,a){return r*Math.sin(i)*Math.cos(a)+n*Math.cos(i)*Math.sin(a)+t}function oVt(e,t,r,n){var i=Math.atan2(n*e,r*t);return(i+Math.PI*2)%(Math.PI*2)}function VV(e,t,r){return{x:e*Math.cos(r),y:t*Math.sin(r)}}function GV(e,t,r){var n=Math.cos(r),i=Math.sin(r);return[e*n-t*i,e*i+t*n]}const sVt={box:function(e,t,r,n,i,a,o){for(var s=iVt(r,n,i),l=1/0,u=-1/0,c=[a,o],f=-Math.PI*2;f<=Math.PI*2;f+=Math.PI){var d=s+f;a<o?a<d&&d<o&&c.push(d):o<d&&d<a&&c.push(d)}for(var f=0;f<c.length;f++){var v=$V(e,t,r,n,i,c[f]);v<l&&(l=v),v>u&&(u=v)}for(var g=aVt(r,n,i),x=1/0,w=-1/0,S=[a,o],f=-Math.PI*2;f<=Math.PI*2;f+=Math.PI){var M=g+f;a<o?a<M&&M<o&&S.push(M):o<M&&M<a&&S.push(M)}for(var f=0;f<S.length;f++){var R=HV(e,t,r,n,i,S[f]);R<x&&(x=R),R>w&&(w=R)}return{x:l,y:x,width:u-l,height:w-x}},length:function(e,t,r,n,i,a,o){},nearestPoint:function(e,t,r,n,i,a,o,s,l){var u=GV(s-e,l-t,-i),c=u[0],f=u[1],d=eVt.nearestPoint(0,0,r,n,c,f),v=oVt(r,n,d.x,d.y);v<a?d=VV(r,n,a):v>o&&(d=VV(r,n,o));var g=GV(d.x,d.y,i);return{x:g[0]+e,y:g[1]+t}},pointDistance:function(e,t,r,n,i,a,o,s,l){var u=this.nearestPoint(e,t,r,n,s,l);return zu(u.x,u.y,s,l)},pointAt:function(e,t,r,n,i,a,o,s){var l=(o-a)*s+a;return{x:$V(e,t,r,n,i,l),y:HV(e,t,r,n,i,l)}},tangentAngle:function(e,t,r,n,i,a,o,s){var l=(o-a)*s+a,u=rVt(e,t,r,n,i,a,o,l),c=nVt(e,t,r,n,i,a,o,l);return i3(Math.atan2(c,u))}};function Vet(e){for(var t=0,r=[],n=0;n<e.length-1;n++){var i=e[n],a=e[n+1],o=zu(i[0],i[1],a[0],a[1]),s={from:i,to:a,length:o};r.push(s),t+=o}return{segments:r,totalLength:t}}function lVt(e){if(e.length<2)return 0;for(var t=0,r=0;r<e.length-1;r++){var n=e[r],i=e[r+1];t+=zu(n[0],n[1],i[0],i[1])}return t}function uVt(e,t){if(t>1||t<0||e.length<2)return null;var r=Vet(e),n=r.segments,i=r.totalLength;if(i===0)return{x:e[0][0],y:e[0][1]};for(var a=0,o=null,s=0;s<n.length;s++){var l=n[s],u=l.from,c=l.to,f=l.length/i;if(t>=a&&t<=a+f){var d=(t-a)/f;o=Wl.pointAt(u[0],u[1],c[0],c[1],d);break}a+=f}return o}function cVt(e,t){if(t>1||t<0||e.length<2)return 0;for(var r=Vet(e),n=r.segments,i=r.totalLength,a=0,o=0,s=0;s<n.length;s++){var l=n[s],u=l.from,c=l.to,f=l.length/i;if(t>=a&&t<=a+f){o=Math.atan2(c[1]-u[1],c[0]-u[0]);break}a+=f}return o}function hVt(e,t,r){for(var n=1/0,i=0;i<e.length-1;i++){var a=e[i],o=e[i+1],s=Wl.pointDistance(a[0],a[1],o[0],o[1],t,r);s<n&&(n=s)}return n}const Get={box:function(e){for(var t=[],r=[],n=0;n<e.length;n++){var i=e[n];t.push(i[0]),r.push(i[1])}return kb(t,r)},length:function(e){return lVt(e)},pointAt:function(e,t){return uVt(e,t)},pointDistance:function(e,t,r){return hVt(e,t,r)},tangentAngle:function(e,t){return cVt(e,t)}};function WV(e,t){return!e||!t?e||t:{minX:Math.min(e.minX,t.minX),minY:Math.min(e.minY,t.minY),maxX:Math.max(e.maxX,t.maxX),maxY:Math.max(e.maxY,t.maxY)}}function dN(e,t){var r=e.get("startArrowShape"),n=e.get("endArrowShape"),i=null,a=null;return r&&(i=r.getCanvasBBox(),t=WV(t,i)),n&&(a=n.getCanvasBBox(),t=WV(t,a)),t}function fVt(e){for(var t=e.attr(),r=t.points,n=[],i=[],a=0;a<r.length;a++){var o=r[a];n.push(o[0]),i.push(o[1])}var s=kb(n,i),l=s.x,u=s.y,c=s.width,f=s.height,d={minX:l,minY:u,maxX:l+c,maxY:u+f};return d=dN(e,d),{x:d.minX,y:d.minY,width:d.maxX-d.minX,height:d.maxY-d.minY}}function dVt(e){for(var t=e.attr(),r=t.points,n=[],i=[],a=0;a<r.length;a++){var o=r[a];n.push(o[0]),i.push(o[1])}return kb(n,i)}var nP=null;function r2(){if(!nP){var e=document.createElement("canvas");e.width=1,e.height=1,nP=e.getContext("2d")}return nP}function n2(e,t,r){var n=1;if(en(e)&&(n=e.split(`
`).length),n>1){var i=pVt(t,r);return t*n+i*(n-1)}return t}function pVt(e,t){return t?t-e:e*.14}function vVt(e,t){var r=r2(),n=0;if(ze(e)||e==="")return n;if(r.save(),r.font=t,en(e)&&e.includes(`
`)){var i=e.split(`
`);ft(i,function(a){var o=r.measureText(a).width;n<o&&(n=o)})}else n=r.measureText(e).width;return r.restore(),n}function i2(e){var t=e.fontSize,r=e.fontFamily,n=e.fontWeight,i=e.fontStyle,a=e.fontVariant;return[i,a,n,t+"px",r].join(" ").trim()}function gVt(e){var t=e.attr(),r=t.x,n=t.y,i=t.text,a=t.fontSize,o=t.lineHeight,s=t.font;s||(s=i2(t));var l=vVt(i,s),u;if(!l)u={x:r,y:n,width:0,height:0};else{var c=t.textAlign,f=t.textBaseline,d=n2(i,a,o),v={x:r,y:n-d};c&&(c==="end"||c==="right"?v.x-=l:c==="center"&&(v.x-=l/2)),f&&(f==="top"?v.y+=d:f==="middle"&&(v.y+=d/2)),u={x:v.x,y:v.y,width:l,height:d}}return u}var mVt=/[MLHVQTCSAZ]([^MLHVQTCSAZ]*)/ig,yVt=/[^\s\,]+/ig;function _Vt(e){var t=e||[];if(Fe(t))return t;if(en(t))return t=t.match(mVt),ft(t,function(r,n){if(r=r.match(yVt),r[0].length>1){var i=r[0].charAt(0);r.splice(1,0,r[0].substr(1)),r[0]=i}ft(r,function(a,o){isNaN(a)||(r[o]=+a)}),t[n]=r}),t}function nA(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function RF(e,t){return nA(e)*nA(t)?(e[0]*t[0]+e[1]*t[1])/(nA(e)*nA(t)):1}function XV(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(RF(e,t))}function IF(e,t){return e[0]===t[0]&&e[1]===t[1]}function xVt(e,t){var r=t[1],n=t[2],i=jS(YS(t[3]),Math.PI*2),a=t[4],o=t[5],s=e[0],l=e[1],u=t[6],c=t[7],f=Math.cos(i)*(s-u)/2+Math.sin(i)*(l-c)/2,d=-1*Math.sin(i)*(s-u)/2+Math.cos(i)*(l-c)/2,v=f*f/(r*r)+d*d/(n*n);v>1&&(r*=Math.sqrt(v),n*=Math.sqrt(v));var g=r*r*(d*d)+n*n*(f*f),x=g?Math.sqrt((r*r*(n*n)-g)/g):1;a===o&&(x*=-1),isNaN(x)&&(x=0);var w=n?x*r*d/n:0,S=r?x*-n*f/r:0,M=(s+u)/2+Math.cos(i)*w-Math.sin(i)*S,R=(l+c)/2+Math.sin(i)*w+Math.cos(i)*S,I=[(f-w)/r,(d-S)/n],P=[(-1*f-w)/r,(-1*d-S)/n],k=XV([1,0],I),z=XV(I,P);return RF(I,P)<=-1&&(z=Math.PI),RF(I,P)>=1&&(z=0),o===0&&z>0&&(z=z-2*Math.PI),o===1&&z<0&&(z=z+2*Math.PI),{cx:M,cy:R,rx:IF(e,[u,c])?0:r,ry:IF(e,[u,c])?0:n,startAngle:k,endAngle:k+z,xRotation:i,arcFlag:a,sweepFlag:o}}function jV(e,t){return[t[0]+(t[0]-e[0]),t[1]+(t[1]-e[1])]}function bVt(e){e=_Vt(e);for(var t=[],r=null,n=null,i=null,a=0,o=e.length,s=0;s<o;s++){var l=e[s];n=e[s+1];var u=l[0],c={command:u,prePoint:r,params:l,startTangent:null,endTangent:null};switch(u){case"M":i=[l[1],l[2]],a=s;break;case"A":var f=xVt(r,l);c.arcParams=f;break}if(u==="Z")r=i,n=e[a+1];else{var d=l.length;r=[l[d-2],l[d-1]]}n&&n[0]==="Z"&&(n=e[a],t[a]&&(t[a].prePoint=r)),c.currentPoint=r,t[a]&&IF(r,t[a].currentPoint)&&(t[a].prePoint=c.prePoint);var v=n?[n[n.length-2],n[n.length-1]]:null;c.nextPoint=v;var g=c.prePoint;if(["L","H","V"].includes(u))c.startTangent=[g[0]-r[0],g[1]-r[1]],c.endTangent=[r[0]-g[0],r[1]-g[1]];else if(u==="Q"){var x=[l[1],l[2]];c.startTangent=[g[0]-x[0],g[1]-x[1]],c.endTangent=[r[0]-x[0],r[1]-x[1]]}else if(u==="T"){var w=t[s-1],x=jV(w.currentPoint,g);w.command==="Q"?(c.command="Q",c.startTangent=[g[0]-x[0],g[1]-x[1]],c.endTangent=[r[0]-x[0],r[1]-x[1]]):(c.command="TL",c.startTangent=[g[0]-r[0],g[1]-r[1]],c.endTangent=[r[0]-g[0],r[1]-g[1]])}else if(u==="C"){var S=[l[1],l[2]],M=[l[3],l[4]];c.startTangent=[g[0]-S[0],g[1]-S[1]],c.endTangent=[r[0]-M[0],r[1]-M[1]],c.startTangent[0]===0&&c.startTangent[1]===0&&(c.startTangent=[S[0]-M[0],S[1]-M[1]]),c.endTangent[0]===0&&c.endTangent[1]===0&&(c.endTangent=[M[0]-S[0],M[1]-S[1]])}else if(u==="S"){var w=t[s-1],S=jV(w.currentPoint,g),M=[l[1],l[2]];w.command==="C"?(c.command="C",c.startTangent=[g[0]-S[0],g[1]-S[1]],c.endTangent=[r[0]-M[0],r[1]-M[1]]):(c.command="SQ",c.startTangent=[g[0]-M[0],g[1]-M[1]],c.endTangent=[r[0]-M[0],r[1]-M[1]])}else if(u==="A"){var R=.001,I=c.arcParams||{},P=I.cx,k=P===void 0?0:P,z=I.cy,G=z===void 0?0:z,J=I.rx,Z=J===void 0?0:J,X=I.ry,et=X===void 0?0:X,at=I.sweepFlag,wt=at===void 0?0:at,Tt=I.startAngle,vt=Tt===void 0?0:Tt,zt=I.endAngle,oe=zt===void 0?0:zt;wt===0&&(R*=-1);var Qt=Z*Math.cos(vt-R)+k,ne=et*Math.sin(vt-R)+G;c.startTangent=[Qt-i[0],ne-i[1]];var de=Z*Math.cos(vt+oe+R)+k,De=et*Math.sin(vt+oe-R)+G;c.endTangent=[g[0]-de,g[1]-De]}t.push(c)}return t}function EVt(e,t){for(var r=[],n=[],i=[],a=0;a<e.length;a++){var o=e[a],s=o.currentPoint,l=o.params,u=o.prePoint,c=void 0;switch(o.command){case"Q":c=$et.box(u[0],u[1],l[1],l[2],l[3],l[4]);break;case"C":c=Jw.box(u[0],u[1],l[1],l[2],l[3],l[4],l[5],l[6]);break;case"A":var f=o.arcParams;c=sVt.box(f.cx,f.cy,f.rx,f.ry,f.xRotation,f.startAngle,f.endAngle);break;default:r.push(s[0]),n.push(s[1]);break}c&&(o.box=c,r.push(c.x,c.x+c.width),n.push(c.y,c.y+c.height)),t&&(o.command==="L"||o.command==="M")&&o.prePoint&&o.nextPoint&&i.push(o)}r=r.filter(function(S){return!Number.isNaN(S)&&S!==1/0&&S!==-1/0}),n=n.filter(function(S){return!Number.isNaN(S)&&S!==1/0&&S!==-1/0});var d=Wh(r),v=Wh(n),g=nh(r),x=nh(n);if(i.length===0)return{x:d,y:v,width:g-d,height:x-v};for(var a=0;a<i.length;a++){var o=i[a],s=o.currentPoint,w=void 0;s[0]===d?(w=iA(o,t),d=d-w.xExtra):s[0]===g&&(w=iA(o,t),g=g+w.xExtra),s[1]===v?(w=iA(o,t),v=v-w.yExtra):s[1]===x&&(w=iA(o,t),x=x+w.yExtra)}return{x:d,y:v,width:g-d,height:x-v}}function iA(e,t){var r=e.prePoint,n=e.currentPoint,i=e.nextPoint,a=Math.pow(n[0]-r[0],2)+Math.pow(n[1]-r[1],2),o=Math.pow(n[0]-i[0],2)+Math.pow(n[1]-i[1],2),s=Math.pow(r[0]-i[0],2)+Math.pow(r[1]-i[1],2),l=Math.acos((a+o-s)/(2*Math.sqrt(a)*Math.sqrt(o)));if(!l||Math.sin(l)===0||xl(l,0))return{xExtra:0,yExtra:0};var u=Math.abs(Math.atan2(i[1]-n[1],i[0]-n[0])),c=Math.abs(Math.atan2(i[0]-n[0],i[1]-n[1]));u=u>Math.PI/2?Math.PI-u:u,c=c>Math.PI/2?Math.PI-c:c;var f={xExtra:Math.cos(l/2-u)*(t/2*(1/Math.sin(l/2)))-t/2||0,yExtra:Math.cos(c-l/2)*(t/2*(1/Math.sin(l/2)))-t/2||0};return f}function wVt(e){var t=e.attr(),r=t.path,n=t.stroke,i=n?t.lineWidth:0,a=e.get("segments")||bVt(r),o=EVt(a,i),s=o.x,l=o.y,u=o.width,c=o.height,f={minX:s,minY:l,maxX:s+u,maxY:l+c};return f=dN(e,f),{x:f.minX,y:f.minY,width:f.maxX-f.minX,height:f.maxY-f.minY}}function CVt(e){var t=e.attr(),r=t.x1,n=t.y1,i=t.x2,a=t.y2,o=Math.min(r,i),s=Math.max(r,i),l=Math.min(n,a),u=Math.max(n,a),c={minX:o,maxX:s,minY:l,maxY:u};return c=dN(e,c),{x:c.minX,y:c.minY,width:c.maxX-c.minX,height:c.maxY-c.minY}}function SVt(e){var t=e.attr(),r=t.x,n=t.y,i=t.rx,a=t.ry;return{x:r-i,y:n-a,width:i*2,height:a*2}}Kh("rect",Net);Kh("image",Net);Kh("circle",ket);Kh("marker",ket);Kh("polyline",fVt);Kh("polygon",dVt);Kh("text",gVt);Kh("path",wVt);Kh("line",CVt);Kh("ellipse",SVt);var TVt="0.5.11";const rOe=Object.freeze(Object.defineProperty({__proto__:null,AbstractCanvas:QS,AbstractGroup:JS,AbstractShape:t2,Base:qS,Event:Nb,PathUtil:r3,assembleFont:i2,getBBoxMethod:e2,getOffScreenContext:r2,getTextHeight:n2,invert:KS,isAllowCapture:ib,multiplyVec2:Hp,registerBBox:Kh,registerEasing:fN,version:TVt},Symbol.toStringTag,{value:"Module"}));var YV=0,AVt=1/2,MVt=1/2,RVt=.05,a2=function(){function e(t){var r=t.xField,n=t.yField,i=t.adjustNames,a=i===void 0?["x","y"]:i,o=t.dimValuesMap;this.adjustNames=a,this.xField=r,this.yField=n,this.dimValuesMap=o}return e.prototype.isAdjust=function(t){return this.adjustNames.indexOf(t)>=0},e.prototype.getAdjustRange=function(t,r,n){var i=this.yField,a=n.indexOf(r),o=n.length,s,l;return!i&&this.isAdjust("y")?(s=0,l=1):o>1?(s=n[a===0?0:a-1],l=n[a===o-1?o-1:a+1],a!==0?s+=(r-s)/2:s-=(l-r)/2,a!==o-1?l-=(l-r)/2:l+=(r-n[o-2])/2):(s=r===0?0:r-.5,l=r===0?1:r+.5),{pre:s,next:l}},e.prototype.adjustData=function(t,r){var n=this,i=this.getDimValues(r);ft(t,function(a,o){ft(i,function(s,l){n.adjustDim(l,s,a,o)})})},e.prototype.groupData=function(t,r){return ft(t,function(n){n[r]===void 0&&(n[r]=YV)}),Qc(t,r)},e.prototype.adjustDim=function(t,r,n,i){},e.prototype.getDimValues=function(t){var r=this,n=r.xField,i=r.yField,a=Qi({},this.dimValuesMap),o=[];if(n&&this.isAdjust("x")&&o.push(n),i&&this.isAdjust("y")&&o.push(i),o.forEach(function(l){a&&a[l]||(a[l]=Zf(t,l).sort(function(u,c){return u-c}))}),!i&&this.isAdjust("y")){var s="y";a[s]=[YV,1]}return a},e}(),Wet={},pN=function(e){return Wet[e.toLowerCase()]},o2=function(e,t){if(pN(e))throw new Error("Adjust type '"+e+"' existed.");Wet[e.toLowerCase()]=t};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var LF=function(e,t){return LF=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i])},LF(e,t)};function a3(e,t){LF(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var Vp=function(){return Vp=Object.assign||function(t){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},Vp.apply(this,arguments)},IVt=function(e){a3(t,e);function t(r){var n=e.call(this,r)||this;n.cacheMap={},n.adjustDataArray=[],n.mergeData=[];var i=r.marginRatio,a=i===void 0?AVt:i,o=r.dodgeRatio,s=o===void 0?MVt:o,l=r.dodgeBy,u=r.intervalPadding,c=r.dodgePadding,f=r.xDimensionLength,d=r.groupNum,v=r.defaultSize,g=r.maxColumnWidth,x=r.minColumnWidth,w=r.columnWidthRatio,S=r.customOffset;return n.marginRatio=a,n.dodgeRatio=s,n.dodgeBy=l,n.intervalPadding=u,n.dodgePadding=c,n.xDimensionLegenth=f,n.groupNum=d,n.defaultSize=v,n.maxColumnWidth=g,n.minColumnWidth=x,n.columnWidthRatio=w,n.customOffset=S,n}return t.prototype.process=function(r){var n=bl(r),i=rh(n),a=this.dodgeBy,o=a?qtt(i,a):n;return this.cacheMap={},this.adjustDataArray=o,this.mergeData=i,this.adjustData(o,i),this.adjustDataArray=[],this.mergeData=[],n},t.prototype.adjustDim=function(r,n,i,a){var o=this,s=this.customOffset,l=this.getDistribution(r),u=this.groupData(i,r);return ft(u,function(c,f){var d;n.length===1?d={pre:n[0]-1,next:n[0]+1}:d=o.getAdjustRange(r,parseFloat(f),n),ft(c,function(v){var g=v[r],x=l[g],w=x.indexOf(a);if(ze(s))v[r]=o.getDodgeOffset(d,w,x.length);else{var S=d.pre,M=d.next;v[r]=Rr(s)?s(v,d):(S+M)/2+s}})}),[]},t.prototype.getDodgeOffset=function(r,n,i){var a=this,o=a.dodgeRatio,s=a.marginRatio,l=a.intervalPadding,u=a.dodgePadding,c=r.pre,f=r.next,d=f-c,v;if(!ze(l)&&ze(u)&&l>=0){var g=this.getIntervalOnlyOffset(i,n);v=c+g}else if(!ze(u)&&ze(l)&&u>=0){var g=this.getDodgeOnlyOffset(i,n);v=c+g}else if(!ze(l)&&!ze(u)&&l>=0&&u>=0){var g=this.getIntervalAndDodgeOffset(i,n);v=c+g}else{var x=d*o/i,w=s*x,g=1/2*(d-i*x-(i-1)*w)+((n+1)*x+n*w)-1/2*x-1/2*d;v=(c+f)/2+g}return v},t.prototype.getIntervalOnlyOffset=function(r,n){var i=this,a=i.defaultSize,o=i.intervalPadding,s=i.xDimensionLegenth,l=i.groupNum,u=i.dodgeRatio,c=i.maxColumnWidth,f=i.minColumnWidth,d=i.columnWidthRatio,v=o/s,g=(1-(l-1)*v)/l*u/(r-1),x=((1-v*(l-1))/l-g*(r-1))/r;if(x=ze(d)?x:1/l/r*d,!ze(c)){var w=c/s;x=Math.min(x,w)}if(!ze(f)){var S=f/s;x=Math.max(x,S)}x=a?a/s:x,g=((1-(l-1)*v)/l-r*x)/(r-1);var M=((1/2+n)*x+n*g+1/2*v)*l-v/2;return M},t.prototype.getDodgeOnlyOffset=function(r,n){var i=this,a=i.defaultSize,o=i.dodgePadding,s=i.xDimensionLegenth,l=i.groupNum,u=i.marginRatio,c=i.maxColumnWidth,f=i.minColumnWidth,d=i.columnWidthRatio,v=o/s,g=1*u/(l-1),x=((1-g*(l-1))/l-v*(r-1))/r;if(x=d?1/l/r*d:x,!ze(c)){var w=c/s;x=Math.min(x,w)}if(!ze(f)){var S=f/s;x=Math.max(x,S)}x=a?a/s:x,g=(1-(x*r+v*(r-1))*l)/(l-1);var M=((1/2+n)*x+n*v+1/2*g)*l-g/2;return M},t.prototype.getIntervalAndDodgeOffset=function(r,n){var i=this,a=i.intervalPadding,o=i.dodgePadding,s=i.xDimensionLegenth,l=i.groupNum,u=a/s,c=o/s,f=((1-u*(l-1))/l-c*(r-1))/r,d=((1/2+n)*f+n*c+1/2*u)*l-u/2;return d},t.prototype.getDistribution=function(r){var n=this.adjustDataArray,i=this.cacheMap,a=i[r];return a||(a={},ft(n,function(o,s){var l=Zf(o,r);l.length||l.push(0),ft(l,function(u){a[u]||(a[u]=[]),a[u].push(s)})}),i[r]=a),a},t}(a2);function LVt(e,t){return(t-e)*Math.random()+e}var OVt=function(e){a3(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.process=function(r){var n=bl(r),i=rh(n);return this.adjustData(n,i),n},t.prototype.adjustDim=function(r,n,i){var a=this,o=this.groupData(i,r);return ft(o,function(s,l){return a.adjustGroup(s,r,parseFloat(l),n)})},t.prototype.getAdjustOffset=function(r){var n=r.pre,i=r.next,a=(i-n)*RVt;return LVt(n+a,i-a)},t.prototype.adjustGroup=function(r,n,i,a){var o=this,s=this.getAdjustRange(n,i,a);return ft(r,function(l){l[n]=o.getAdjustOffset(s)}),r},t}(a2),iP=set,PVt=function(e){a3(t,e);function t(r){var n=e.call(this,r)||this,i=r.adjustNames,a=i===void 0?["y"]:i,o=r.height,s=o===void 0?NaN:o,l=r.size,u=l===void 0?10:l,c=r.reverseOrder,f=c===void 0?!1:c;return n.adjustNames=a,n.height=s,n.size=u,n.reverseOrder=f,n}return t.prototype.process=function(r){var n=this,i=n.yField,a=n.reverseOrder,o=i?this.processStack(r):this.processOneDimStack(r);return a?this.reverse(o):o},t.prototype.reverse=function(r){return r.slice(0).reverse()},t.prototype.processStack=function(r){var n=this,i=n.xField,a=n.yField,o=n.reverseOrder,s=o?this.reverse(r):r,l=new iP,u=new iP;return s.map(function(c){return c.map(function(f){var d,v=xt(f,i,0),g=xt(f,[a]),x=v.toString();if(g=Fe(g)?g[1]:g,!ze(g)){var w=g>=0?l:u;w.has(x)||w.set(x,0);var S=w.get(x),M=g+S;return w.set(x,M),Vp(Vp({},f),(d={},d[a]=[S,M],d))}return f})})},t.prototype.processOneDimStack=function(r){var n=this,i=this,a=i.xField,o=i.height,s=i.reverseOrder,l="y",u=s?this.reverse(r):r,c=new iP;return u.map(function(f){return f.map(function(d){var v,g=n.size,x=d[a],w=g*2/o;c.has(x)||c.set(x,w/2);var S=c.get(x);return c.set(x,S+w),Vp(Vp({},d),(v={},v[l]=S,v))})})},t}(a2),DVt=function(e){a3(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.process=function(r){var n=rh(r),i=this,a=i.xField,o=i.yField,s=this.getXValuesMaxMap(n),l=Math.max.apply(Math,Object.keys(s).map(function(u){return s[u]}));return fo(r,function(u){return fo(u,function(c){var f,d,v=c[o],g=c[a];if(Fe(v)){var x=(l-s[g])/2;return Vp(Vp({},c),(f={},f[o]=fo(v,function(S){return x+S}),f))}var w=(l-v)/2;return Vp(Vp({},c),(d={},d[o]=[w,v+w],d))})})},t.prototype.getXValuesMaxMap=function(r){var n=this,i=this,a=i.xField,o=i.yField,s=Qc(r,function(l){return l[a]});return iet(s,function(l){return n.getDimMaxValue(l,o)})},t.prototype.getDimMaxValue=function(r,n){var i=fo(r,function(o){return xt(o,n,[])}),a=rh(i);return Math.max.apply(Math,a)},t}(a2);o2("Dodge",IVt);o2("Jitter",OVt);o2("Stack",PVt);o2("Symmetric",DVt);const nOe=Object.freeze(Object.defineProperty({__proto__:null,Adjust:a2,getAdjust:pN,registerAdjust:o2},Symbol.toStringTag,{value:"Module"}));var ZV=function(e,t){return en(t)?t:e.invert(e.scale(t))},zb=function(){function e(t){this.names=[],this.scales=[],this.linear=!1,this.values=[],this.callback=function(){return[]},this._parseCfg(t)}return e.prototype.mapping=function(){for(var t=this,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=r.map(function(a,o){return t._toOriginParam(a,t.scales[o])});return this.callback.apply(this,i)},e.prototype.getLinearValue=function(t){var r=this.values.length-1,n=Math.floor(r*t),i=r*t-n,a=this.values[n],o=n===r?a:this.values[n+1];return a+(o-a)*i},e.prototype.getNames=function(){for(var t=this.scales,r=this.names,n=Math.min(t.length,r.length),i=[],a=0;a<n;a+=1)i.push(r[a]);return i},e.prototype.getFields=function(){return this.scales.map(function(t){return t.field})},e.prototype.getScale=function(t){return this.scales[this.names.indexOf(t)]},e.prototype.defaultCallback=function(){for(var t=this,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return r.length===0?this.values:r.map(function(i,a){var o=t.scales[a];return o.type==="identity"?o.values[0]:t._getAttributeValue(o,i)})},e.prototype._parseCfg=function(t){var r=this,n=t.type,i=n===void 0?"base":n,a=t.names,o=a===void 0?[]:a,s=t.scales,l=s===void 0?[]:s,u=t.values,c=u===void 0?[]:u,f=t.callback;this.type=i,this.scales=l,this.values=c,this.names=o,this.callback=function(){for(var d=[],v=0;v<arguments.length;v++)d[v]=arguments[v];if(f){var g=f.apply(void 0,d);if(!ze(g))return[g]}return r.defaultCallback.apply(r,d)}},e.prototype._getAttributeValue=function(t,r){if(t.isCategory&&!this.linear){var n=t.translate(r);return this.values[n%this.values.length]}var i=t.scale(r);return this.getLinearValue(i)},e.prototype._toOriginParam=function(t,r){return r.isLinear?t:Fe(t)?t.map(function(n){return ZV(r,n)}):ZV(r,t)},e}(),FVt=/rgba?\(([\s.,0-9]+)\)/,BVt=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,NVt=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,kVt=/[\d.]+:(#[^\s]+|[^\)]+\))/gi,zVt=function(e){return/^[r,R,L,l]{1}[\s]*\(/.test(e)},UVt=function(){var e=document.createElement("i");return e.title="Web Colour Picker",e.style.display="none",document.body.appendChild(e),e},aP=function(e,t,r,n){return e[n]+(t[n]-e[n])*r};function Xet(e){return"#"+oP(e[0])+oP(e[1])+oP(e[2])}var jet=function(e){return[parseInt(e.substr(1,2),16),parseInt(e.substr(3,2),16),parseInt(e.substr(5,2),16)]},oP=function(e){var t=Math.round(e).toString(16);return t.length===1?"0"+t:t},$Vt=function(e,t){var r=isNaN(Number(t))||t<0?0:t>1?1:Number(t),n=e.length-1,i=Math.floor(n*r),a=n*r-i,o=e[i],s=i===n?o:e[i+1];return Xet([aP(o,s,a,0),aP(o,s,a,1),aP(o,s,a,2)])},aA,Yet=function(e){if(e[0]==="#"&&e.length===7)return e;aA||(aA=UVt()),aA.style.color=e;var t=document.defaultView.getComputedStyle(aA,"").getPropertyValue("color"),r=FVt.exec(t),n=r[1].split(/\s*,\s*/).map(function(i){return Number(i)});return t=Xet(n),t},HVt=function(e){var t=en(e)?e.split("-"):e,r=fo(t,function(n){return jet(n.indexOf("#")===-1?Yet(n):n)});return function(n){return $Vt(r,n)}},VVt=function(e){if(zVt(e)){var t,r=void 0;if(e[0]==="l"){var n=BVt.exec(e),i=+n[1]+90;r=n[2],t="linear-gradient("+i+"deg, "}else if(e[0]==="r"){t="radial-gradient(";var n=NVt.exec(e);r=n[4]}var a=r.match(kVt);return ft(a,function(o,s){var l=o.split(":");t+=l[1]+" "+l[0]*100+"%",s!==a.length-1&&(t+=", ")}),t+=")",t}return e};const Zm={rgb2arr:jet,gradient:HVt,toRGB:D_(Yet),toCSSGradient:VVt};var Zet=function(e){$t(t,e);function t(r){var n=e.call(this,r)||this;return n.type="color",n.names=["color"],en(n.values)&&(n.linear=!0),n.gradient=Zm.gradient(n.values),n}return t.prototype.getLinearValue=function(r){return this.gradient(r)},t}(zb),qet=function(e){$t(t,e);function t(r){var n=e.call(this,r)||this;return n.type="opacity",n.names=["opacity"],n}return t}(zb),Ket=function(e){$t(t,e);function t(r){var n=e.call(this,r)||this;return n.names=["x","y"],n.type="position",n}return t.prototype.mapping=function(r,n){var i=this.scales,a=i[0],o=i[1];return ze(r)||ze(n)?[]:[Fe(r)?r.map(function(s){return a.scale(s)}):a.scale(r),Fe(n)?n.map(function(s){return o.scale(s)}):o.scale(n)]},t}(zb),Qet=function(e){$t(t,e);function t(r){var n=e.call(this,r)||this;return n.type="shape",n.names=["shape"],n}return t.prototype.getLinearValue=function(r){var n=Math.round((this.values.length-1)*r);return this.values[n]},t}(zb),Jet=function(e){$t(t,e);function t(r){var n=e.call(this,r)||this;return n.type="size",n.names=["size"],n}return t}(zb),trt={};function ert(e){return trt[e]}function ep(e,t){trt[e]=t}var s2=function(){function e(t){this.type="base",this.isCategory=!1,this.isLinear=!1,this.isContinuous=!1,this.isIdentity=!1,this.values=[],this.range=[0,1],this.ticks=[],this.__cfg__=t,this.initCfg(),this.init()}return e.prototype.translate=function(t){return t},e.prototype.change=function(t){Qi(this.__cfg__,t),this.init()},e.prototype.clone=function(){return this.constructor(this.__cfg__)},e.prototype.getTicks=function(){var t=this;return fo(this.ticks,function(r,n){return Xi(r)?r:{text:t.getText(r,n),tickValue:r,value:t.scale(r)}})},e.prototype.getText=function(t,r){var n=this.formatter,i=n?n(t,r):t;return ze(i)||!Rr(i.toString)?"":i.toString()},e.prototype.getConfig=function(t){return this.__cfg__[t]},e.prototype.init=function(){Qi(this,this.__cfg__),this.setDomain(),cc(this.getConfig("ticks"))&&(this.ticks=this.calculateTicks())},e.prototype.initCfg=function(){},e.prototype.setDomain=function(){},e.prototype.calculateTicks=function(){var t=this.tickMethod,r=[];if(en(t)){var n=ert(t);if(!n)throw new Error("There is no method to to calculate ticks!");r=n(this)}else Rr(t)&&(r=t(this));return r},e.prototype.rangeMin=function(){return this.range[0]},e.prototype.rangeMax=function(){return this.range[1]},e.prototype.calcPercent=function(t,r,n){return Rn(t)?(t-r)/(n-r):NaN},e.prototype.calcValue=function(t,r,n){return r+t*(n-r)},e}(),l2=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="cat",r.isCategory=!0,r}return t.prototype.buildIndexMap=function(){if(!this.translateIndexMap){this.translateIndexMap=new Map;for(var r=0;r<this.values.length;r++)this.translateIndexMap.set(this.values[r],r)}},t.prototype.translate=function(r){this.buildIndexMap();var n=this.translateIndexMap.get(r);return n===void 0&&(n=Rn(r)?r:NaN),n},t.prototype.scale=function(r){var n=this.translate(r),i=this.calcPercent(n,this.min,this.max);return this.calcValue(i,this.rangeMin(),this.rangeMax())},t.prototype.invert=function(r){var n=this.max-this.min,i=this.calcPercent(r,this.rangeMin(),this.rangeMax()),a=Math.round(n*i)+this.min;return a<this.min||a>this.max?NaN:this.values[a]},t.prototype.getText=function(r){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var a=r;return Rn(r)&&!this.values.includes(r)&&(a=this.values[a]),e.prototype.getText.apply(this,Jy([a],n))},t.prototype.initCfg=function(){this.tickMethod="cat"},t.prototype.setDomain=function(){if(ze(this.getConfig("min"))&&(this.min=0),ze(this.getConfig("max"))){var r=this.values.length;this.max=r>1?r-1:r}this.translateIndexMap&&(this.translateIndexMap=void 0)},t}(s2),rrt=/d{1,4}|M{1,4}|YY(?:YY)?|S{1,3}|Do|ZZ|Z|([HhMsDm])\1?|[aA]|"[^"]*"|'[^']*'/g,Tm="\\d\\d?",bm="\\d\\d",GVt="\\d{3}",WVt="\\d{4}",tC="[^\\s]+",nrt=/\[([^]*?)\]/gm;function irt(e,t){for(var r=[],n=0,i=e.length;n<i;n++)r.push(e[n].substr(0,t));return r}var qV=function(e){return function(t,r){var n=r[e].map(function(a){return a.toLowerCase()}),i=n.indexOf(t.toLowerCase());return i>-1?i:null}};function i0(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n=0,i=t;n<i.length;n++){var a=i[n];for(var o in a)e[o]=a[o]}return e}var art=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],ort=["January","February","March","April","May","June","July","August","September","October","November","December"],XVt=irt(ort,3),jVt=irt(art,3),vN={dayNamesShort:jVt,dayNames:art,monthNamesShort:XVt,monthNames:ort,amPm:["am","pm"],DoFn:function(e){return e+["th","st","nd","rd"][e%10>3?0:(e-e%10!==10?1:0)*e%10]}},MR=i0({},vN),srt=function(e){return MR=i0(MR,e)},KV=function(e){return e.replace(/[|\\{()[^$+*?.-]/g,"\\$&")},Pc=function(e,t){for(t===void 0&&(t=2),e=String(e);e.length<t;)e="0"+e;return e},YVt={D:function(e){return String(e.getDate())},DD:function(e){return Pc(e.getDate())},Do:function(e,t){return t.DoFn(e.getDate())},d:function(e){return String(e.getDay())},dd:function(e){return Pc(e.getDay())},ddd:function(e,t){return t.dayNamesShort[e.getDay()]},dddd:function(e,t){return t.dayNames[e.getDay()]},M:function(e){return String(e.getMonth()+1)},MM:function(e){return Pc(e.getMonth()+1)},MMM:function(e,t){return t.monthNamesShort[e.getMonth()]},MMMM:function(e,t){return t.monthNames[e.getMonth()]},YY:function(e){return Pc(String(e.getFullYear()),4).substr(2)},YYYY:function(e){return Pc(e.getFullYear(),4)},h:function(e){return String(e.getHours()%12||12)},hh:function(e){return Pc(e.getHours()%12||12)},H:function(e){return String(e.getHours())},HH:function(e){return Pc(e.getHours())},m:function(e){return String(e.getMinutes())},mm:function(e){return Pc(e.getMinutes())},s:function(e){return String(e.getSeconds())},ss:function(e){return Pc(e.getSeconds())},S:function(e){return String(Math.round(e.getMilliseconds()/100))},SS:function(e){return Pc(Math.round(e.getMilliseconds()/10),2)},SSS:function(e){return Pc(e.getMilliseconds(),3)},a:function(e,t){return e.getHours()<12?t.amPm[0]:t.amPm[1]},A:function(e,t){return e.getHours()<12?t.amPm[0].toUpperCase():t.amPm[1].toUpperCase()},ZZ:function(e){var t=e.getTimezoneOffset();return(t>0?"-":"+")+Pc(Math.floor(Math.abs(t)/60)*100+Math.abs(t)%60,4)},Z:function(e){var t=e.getTimezoneOffset();return(t>0?"-":"+")+Pc(Math.floor(Math.abs(t)/60),2)+":"+Pc(Math.abs(t)%60,2)}},QV=function(e){return+e-1},JV=[null,Tm],tG=[null,tC],eG=["isPm",tC,function(e,t){var r=e.toLowerCase();return r===t.amPm[0]?0:r===t.amPm[1]?1:null}],rG=["timezoneOffset","[^\\s]*?[\\+\\-]\\d\\d:?\\d\\d|[^\\s]*?Z?",function(e){var t=(e+"").match(/([+-]|\d\d)/gi);if(t){var r=+t[1]*60+parseInt(t[2],10);return t[0]==="+"?r:-r}return 0}],ZVt={D:["day",Tm],DD:["day",bm],Do:["day",Tm+tC,function(e){return parseInt(e,10)}],M:["month",Tm,QV],MM:["month",bm,QV],YY:["year",bm,function(e){var t=new Date,r=+(""+t.getFullYear()).substr(0,2);return+(""+(+e>68?r-1:r)+e)}],h:["hour",Tm,void 0,"isPm"],hh:["hour",bm,void 0,"isPm"],H:["hour",Tm],HH:["hour",bm],m:["minute",Tm],mm:["minute",bm],s:["second",Tm],ss:["second",bm],YYYY:["year",WVt],S:["millisecond","\\d",function(e){return+e*100}],SS:["millisecond",bm,function(e){return+e*10}],SSS:["millisecond",GVt],d:JV,dd:JV,ddd:tG,dddd:tG,MMM:["month",tC,qV("monthNamesShort")],MMMM:["month",tC,qV("monthNames")],a:eG,A:eG,ZZ:rG,Z:rG},RR={default:"ddd MMM DD YYYY HH:mm:ss",shortDate:"M/D/YY",mediumDate:"MMM D, YYYY",longDate:"MMMM D, YYYY",fullDate:"dddd, MMMM D, YYYY",isoDate:"YYYY-MM-DD",isoDateTime:"YYYY-MM-DDTHH:mm:ssZ",shortTime:"HH:mm",mediumTime:"HH:mm:ss",longTime:"HH:mm:ss.SSS"},lrt=function(e){return i0(RR,e)},urt=function(e,t,r){if(t===void 0&&(t=RR.default),r===void 0&&(r={}),typeof e=="number"&&(e=new Date(e)),Object.prototype.toString.call(e)!=="[object Date]"||isNaN(e.getTime()))throw new Error("Invalid Date pass to format");t=RR[t]||t;var n=[];t=t.replace(nrt,function(a,o){return n.push(o),"@@@"});var i=i0(i0({},MR),r);return t=t.replace(rrt,function(a){return YVt[a](e,i)}),t.replace(/@@@/g,function(){return n.shift()})};function crt(e,t,r){if(r===void 0&&(r={}),typeof t!="string")throw new Error("Invalid format in fecha parse");if(t=RR[t]||t,e.length>1e3)return null;var n=new Date,i={year:n.getFullYear(),month:0,day:1,hour:0,minute:0,second:0,millisecond:0,isPm:null,timezoneOffset:null},a=[],o=[],s=t.replace(nrt,function(I,P){return o.push(KV(P)),"@@@"}),l={},u={};s=KV(s).replace(rrt,function(I){var P=ZVt[I],k=P[0],z=P[1],G=P[3];if(l[k])throw new Error("Invalid format. "+k+" specified twice in format");return l[k]=!0,G&&(u[G]=!0),a.push(P),"("+z+")"}),Object.keys(u).forEach(function(I){if(!l[I])throw new Error("Invalid format. "+I+" is required in specified format")}),s=s.replace(/@@@/g,function(){return o.shift()});var c=e.match(new RegExp(s,"i"));if(!c)return null;for(var f=i0(i0({},MR),r),d=1;d<c.length;d++){var v=a[d-1],g=v[0],x=v[2],w=x?x(c[d],f):+c[d];if(w==null)return null;i[g]=w}i.isPm===1&&i.hour!=null&&+i.hour!=12?i.hour=+i.hour+12:i.isPm===0&&+i.hour==12&&(i.hour=0);var S;if(i.timezoneOffset==null){S=new Date(i.year,i.month,i.day,i.hour,i.minute,i.second,i.millisecond);for(var M=[["month","getMonth"],["day","getDate"],["hour","getHours"],["minute","getMinutes"],["second","getSeconds"]],d=0,R=M.length;d<R;d++)if(l[M[d][0]]&&i[M[d][0]]!==S[M[d][1]]())return null}else if(S=new Date(Date.UTC(i.year,i.month,i.day,i.hour,i.minute-i.timezoneOffset,i.second,i.millisecond)),i.month>11||i.month<0||i.day>31||i.day<1||i.hour>23||i.hour<0||i.minute>59||i.minute<0||i.second>59||i.second<0)return null;return S}var hrt={format:urt,parse:crt,defaultI18n:vN,setGlobalDateI18n:srt,setGlobalDateMasks:lrt};const qVt=Object.freeze(Object.defineProperty({__proto__:null,assign:i0,default:hrt,defaultI18n:vN,format:urt,parse:crt,setGlobalDateI18n:srt,setGlobalDateMasks:lrt},Symbol.toStringTag,{value:"Module"}));function KVt(e){return function(t,r,n,i){for(var a=ze(n)?0:n,o=ze(i)?t.length:i;a<o;){var s=a+o>>>1;e(t[s])>r?o=s:a=s+1}return a}}var nG="format";function frt(e,t){var r=qVt[nG]||hrt[nG];return r(e,t)}function IR(e){return en(e)&&(e.indexOf("T")>0?e=new Date(e).getTime():e=new Date(e.replace(/-/gi,"/")).getTime()),tN(e)&&(e=e.getTime()),e}var Od=1e3,Hy=60*Od,Vy=60*Hy,og=24*Vy,eC=og*31,iG=og*365,cw=[["HH:mm:ss",Od],["HH:mm:ss",Od*10],["HH:mm:ss",Od*30],["HH:mm",Hy],["HH:mm",Hy*10],["HH:mm",Hy*30],["HH",Vy],["HH",Vy*6],["HH",Vy*12],["YYYY-MM-DD",og],["YYYY-MM-DD",og*4],["YYYY-WW",og*7],["YYYY-MM",eC],["YYYY-MM",eC*4],["YYYY-MM",eC*6],["YYYY",og*380]];function QVt(e,t,r){var n=(t-e)/r,i=KVt(function(o){return o[1]})(cw,n)-1,a=cw[i];return i<0?a=cw[0]:i>=cw.length&&(a=Ds(cw)),a}var drt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="timeCat",r}return t.prototype.translate=function(r){r=IR(r);var n=this.values.indexOf(r);return n===-1&&(Rn(r)&&r<this.values.length?n=r:n=NaN),n},t.prototype.getText=function(r,n){var i=this.translate(r);if(i>-1){var a=this.values[i],o=this.formatter;return a=o?o(a,n):frt(a,this.mask),a}return r},t.prototype.initCfg=function(){this.tickMethod="time-cat",this.mask="YYYY-MM-DD",this.tickCount=7},t.prototype.setDomain=function(){var r=this.values;ft(r,function(n,i){r[i]=IR(n)}),r.sort(function(n,i){return n-i}),e.prototype.setDomain.call(this)},t}(l2),o3=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.isContinuous=!0,r}return t.prototype.scale=function(r){if(ze(r))return NaN;var n=this.rangeMin(),i=this.rangeMax(),a=this.max,o=this.min;if(a===o)return n;var s=this.getScalePercent(r);return n+s*(i-n)},t.prototype.init=function(){e.prototype.init.call(this);var r=this.ticks,n=Kc(r),i=Ds(r);n<this.min&&(this.min=n),i>this.max&&(this.max=i),ze(this.minLimit)||(this.min=n),ze(this.maxLimit)||(this.max=i)},t.prototype.setDomain=function(){var r=K4(this.values),n=r.min,i=r.max;ze(this.min)&&(this.min=n),ze(this.max)&&(this.max=i),this.min>this.max&&(this.min=n,this.max=i)},t.prototype.calculateTicks=function(){var r=this,n=e.prototype.calculateTicks.call(this);return this.nice||(n=Al(n,function(i){return i>=r.min&&i<=r.max})),n},t.prototype.getScalePercent=function(r){var n=this.max,i=this.min;return(r-i)/(n-i)},t.prototype.getInvertPercent=function(r){return(r-this.rangeMin())/(this.rangeMax()-this.rangeMin())},t}(s2),u2=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="linear",r.isLinear=!0,r}return t.prototype.invert=function(r){var n=this.getInvertPercent(r);return this.min+n*(this.max-this.min)},t.prototype.initCfg=function(){this.tickMethod="wilkinson-extended",this.nice=!1},t}(o3);function Im(e,t){var r=Math.E,n;return t>=0?n=Math.pow(r,Math.log(t)/e):n=Math.pow(r,Math.log(-t)/e)*-1,n}function Df(e,t){return e===1?1:Math.log(t)/Math.log(e)}function prt(e,t,r){ze(r)&&(r=Math.max.apply(null,e));var n=r;return ft(e,function(i){i>0&&i<n&&(n=i)}),n===r&&(n=r/t),n>1&&(n=1),n}var vrt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="log",r}return t.prototype.invert=function(r){var n=this.base,i=Df(n,this.max),a=this.rangeMin(),o=this.rangeMax()-a,s,l=this.positiveMin;if(l){if(r===0)return 0;s=Df(n,l/n);var u=1/(i-s)*o;if(r<u)return r/u*l}else s=Df(n,this.min);var c=(r-a)/o,f=c*(i-s)+s;return Math.pow(n,f)},t.prototype.initCfg=function(){this.tickMethod="log",this.base=10,this.tickCount=6,this.nice=!0},t.prototype.setDomain=function(){e.prototype.setDomain.call(this);var r=this.min;if(r<0)throw new Error("When you use log scale, the minimum value must be greater than zero!");r===0&&(this.positiveMin=prt(this.values,this.base,this.max))},t.prototype.getScalePercent=function(r){var n=this.max,i=this.min;if(n===i||r<=0)return 0;var a=this.base,o=this.positiveMin;o&&(i=o*1/a);var s;return r<o?s=r/o/(Df(a,n)-Df(a,i)):s=(Df(a,r)-Df(a,i))/(Df(a,n)-Df(a,i)),s},t}(o3),grt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="pow",r}return t.prototype.invert=function(r){var n=this.getInvertPercent(r),i=this.exponent,a=Im(i,this.max),o=Im(i,this.min),s=n*(a-o)+o,l=s>=0?1:-1;return Math.pow(s,i)*l},t.prototype.initCfg=function(){this.tickMethod="pow",this.exponent=2,this.tickCount=5,this.nice=!0},t.prototype.getScalePercent=function(r){var n=this.max,i=this.min;if(n===i)return 0;var a=this.exponent,o=(Im(a,r)-Im(a,i))/(Im(a,n)-Im(a,i));return o},t}(o3),mrt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="time",r}return t.prototype.getText=function(r,n){var i=this.translate(r),a=this.formatter;return a?a(i,n):frt(i,this.mask)},t.prototype.scale=function(r){var n=r;return(en(n)||tN(n))&&(n=this.translate(n)),e.prototype.scale.call(this,n)},t.prototype.translate=function(r){return IR(r)},t.prototype.initCfg=function(){this.tickMethod="time-pretty",this.mask="YYYY-MM-DD",this.tickCount=7,this.nice=!1},t.prototype.setDomain=function(){var r=this.values,n=this.getConfig("min"),i=this.getConfig("max");if((!ze(n)||!Rn(n))&&(this.min=this.translate(this.min)),(!ze(i)||!Rn(i))&&(this.max=this.translate(this.max)),r&&r.length){var a=[],o=1/0,s=o,l=0;ft(r,function(u){var c=IR(u);if(isNaN(c))throw new TypeError("Invalid Time: "+u+" in time scale!");o>c?(s=o,o=c):s>c&&(s=c),l<c&&(l=c),a.push(c)}),r.length>1&&(this.minTickInterval=s-o),ze(n)&&(this.min=o),ze(i)&&(this.max=l)}},t}(u2),gN=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="quantize",r}return t.prototype.invert=function(r){var n=this.ticks,i=n.length,a=this.getInvertPercent(r),o=Math.floor(a*(i-1));if(o>=i-1)return Ds(n);if(o<0)return Kc(n);var s=n[o],l=n[o+1],u=o/(i-1),c=(o+1)/(i-1);return s+(a-u)/(c-u)*(l-s)},t.prototype.initCfg=function(){this.tickMethod="r-pretty",this.tickCount=5,this.nice=!0},t.prototype.calculateTicks=function(){var r=e.prototype.calculateTicks.call(this);return this.nice||(Ds(r)!==this.max&&r.push(this.max),Kc(r)!==this.min&&r.unshift(this.min)),r},t.prototype.getScalePercent=function(r){var n=this.ticks;if(r<Kc(n))return 0;if(r>Ds(n))return 1;var i=0;return ft(n,function(a,o){if(r>=a)i=o;else return!1}),i/(n.length-1)},t}(o3),yrt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="quantile",r}return t.prototype.initCfg=function(){this.tickMethod="quantile",this.tickCount=5,this.nice=!0},t}(gN),_rt={};function LR(e){return _rt[e]}function rp(e,t){if(LR(e))throw new Error("type '"+e+"' existed.");_rt[e]=t}var xrt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="identity",r.isIdentity=!0,r}return t.prototype.calculateTicks=function(){return this.values},t.prototype.scale=function(r){return this.values[0]!==r&&Rn(r)?r:this.range[0]},t.prototype.invert=function(r){var n=this.range;return r<n[0]||r>n[1]?NaN:this.values[0]},t}(s2);function brt(e){var t=e.values,r=e.tickInterval,n=e.tickCount,i=e.showLast;if(Rn(r)){var a=Al(t,function(g,x){return x%r===0}),o=Ds(t);return i&&Ds(a)!==o&&a.push(o),a}var s=t.length,l=e.min,u=e.max;if(ze(l)&&(l=0),ze(u)&&(u=t.length-1),!Rn(n)||n>=s)return t.slice(l,u+1);if(n<=0||u<=0)return[];for(var c=n===1?s:Math.floor(s/(n-1)),f=[],d=l,v=0;v<n&&!(d>=u);v++)d=Math.min(l+v*c,u),v===n-1&&i?f.push(t[u]):f.push(t[d]);return f}function JVt(e){var t=e.min,r=e.max,n=e.nice,i=e.tickCount,a=new tGt;return a.domain([t,r]),n&&a.nice(i),a.ticks(i)}var sP=5,aG=Math.sqrt(50),oG=Math.sqrt(10),sG=Math.sqrt(2),tGt=function(){function e(){this._domain=[0,1]}return e.prototype.domain=function(t){return t?(this._domain=Array.from(t,Number),this):this._domain.slice()},e.prototype.nice=function(t){var r,n;t===void 0&&(t=sP);var i=this._domain.slice(),a=0,o=this._domain.length-1,s=this._domain[a],l=this._domain[o],u;return l<s&&(r=[l,s],s=r[0],l=r[1],n=[o,a],a=n[0],o=n[1]),u=vM(s,l,t),u>0?(s=Math.floor(s/u)*u,l=Math.ceil(l/u)*u,u=vM(s,l,t)):u<0&&(s=Math.ceil(s*u)/u,l=Math.floor(l*u)/u,u=vM(s,l,t)),u>0?(i[a]=Math.floor(s/u)*u,i[o]=Math.ceil(l/u)*u,this.domain(i)):u<0&&(i[a]=Math.ceil(s*u)/u,i[o]=Math.floor(l*u)/u,this.domain(i)),this},e.prototype.ticks=function(t){return t===void 0&&(t=sP),eGt(this._domain[0],this._domain[this._domain.length-1],t||sP)},e}();function eGt(e,t,r){var n,i=-1,a,o,s;if(t=+t,e=+e,r=+r,e===t&&r>0)return[e];if((n=t<e)&&(a=e,e=t,t=a),(s=vM(e,t,r))===0||!isFinite(s))return[];if(s>0)for(e=Math.ceil(e/s),t=Math.floor(t/s),o=new Array(a=Math.ceil(t-e+1));++i<a;)o[i]=(e+i)*s;else for(e=Math.floor(e*s),t=Math.ceil(t*s),o=new Array(a=Math.ceil(e-t+1));++i<a;)o[i]=(e-i)/s;return n&&o.reverse(),o}function vM(e,t,r){var n=(t-e)/Math.max(0,r),i=Math.floor(Math.log(n)/Math.LN10),a=n/Math.pow(10,i);return i>=0?(a>=aG?10:a>=oG?5:a>=sG?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=aG?10:a>=oG?5:a>=sG?2:1)}function lG(e,t,r){var n;return r==="ceil"?n=Math.ceil(e/t):r==="floor"?n=Math.floor(e/t):n=Math.round(e/t),n*t}function mN(e,t,r){var n=lG(e,r,"floor"),i=lG(t,r,"ceil");n=dM(n,r),i=dM(i,r);for(var a=[],o=Math.max((i-n)/(Math.pow(2,12)-1),r),s=n;s<=i;s=s+o){var l=dM(s,o);a.push(l)}return{min:n,max:i,ticks:a}}function yN(e,t,r){var n,i=e.minLimit,a=e.maxLimit,o=e.min,s=e.max,l=e.tickCount,u=l===void 0?5:l,c=ze(i)?ze(t)?o:t:i,f=ze(a)?ze(r)?s:r:a;if(c>f&&(n=[c,f],f=n[0],c=n[1]),u<=2)return[c,f];for(var d=(f-c)/(u-1),v=[],g=0;g<u;g++)v.push(c+d*g);return v}function rGt(e){var t=e.min,r=e.max,n=e.tickInterval,i=e.minLimit,a=e.maxLimit,o=JVt(e);return!ze(i)||!ze(a)?yN(e,Kc(o),Ds(o)):n?mN(t,r,n).ticks:o}function by(e){return Math.abs(e)<1e-15?e:parseFloat(e.toFixed(15))}var nGt=[1,5,2,2.5,4,3],uG=Number.EPSILON*100;function iGt(e,t){return(e%t+t)%t}function aGt(e){return Math.round(e*1e12)/1e12}function oGt(e,t,r,n,i,a){var o=il(t),s=nN(t,e),l=0,u=iGt(n,a);return(u<uG||a-u<uG)&&n<=0&&i>=0&&(l=1),1-s/(o-1)-r+l}function sGt(e,t,r){var n=il(t),i=nN(t,e),a=1;return 1-i/(n-1)-r+a}function lGt(e,t,r,n,i,a){var o=(e-1)/(a-i),s=(t-1)/(Math.max(a,n)-Math.min(r,i));return 2-Math.max(o/s,s/o)}function uGt(e,t){return e>=t?2-(e-1)/(t-1):1}function cGt(e,t,r,n){var i=t-e;return 1-.5*(Math.pow(t-n,2)+Math.pow(e-r,2))/Math.pow(.1*i,2)}function hGt(e,t,r){var n=t-e;if(r>n){var i=(r-n)/2;return 1-Math.pow(i,2)/Math.pow(.1*n,2)}return 1}function fGt(){return 1}function dGt(e,t,r,n,i,a){r===void 0&&(r=5),n===void 0&&(n=!0),i===void 0&&(i=nGt),a===void 0&&(a=[.25,.2,.5,.05]);var o=r<0?0:Math.round(r);if(Number.isNaN(e)||Number.isNaN(t)||typeof e!="number"||typeof t!="number"||!o)return{min:0,max:0,ticks:[]};if(t-e<1e-15||o===1)return{min:e,max:t,ticks:[e]};if(t-e>1e148){var s=r||5,l=(t-e)/s;return{min:e,max:t,ticks:Array(s).fill(null).map(function(de,De){return by(e+l*De)})}}for(var u={score:-2,lmin:0,lmax:0,lstep:0},c=1;c<1/0;){for(var f=0;f<i.length;f+=1){var d=i[f],v=sGt(d,i,c);if(a[0]*v+a[1]+a[2]+a[3]<u.score){c=1/0;break}for(var g=2;g<1/0;){var x=uGt(g,o);if(a[0]*v+a[1]+a[2]*x+a[3]<u.score)break;for(var w=(t-e)/(g+1)/c/d,S=Math.ceil(Math.log10(w));S<1/0;){var M=c*d*Math.pow(10,S),R=hGt(e,t,M*(g-1));if(a[0]*v+a[1]*R+a[2]*x+a[3]<u.score)break;var I=Math.floor(t/M)*c-(g-1)*c,P=Math.ceil(e/M)*c;if(I<=P)for(var s=P-I,k=0;k<=s;k+=1){var z=I+k,G=z*(M/c),J=G+M*(g-1),Z=M,X=oGt(d,i,c,G,J,Z),et=cGt(e,t,G,J),at=lGt(g,o,e,t,G,J),wt=fGt(),Tt=a[0]*X+a[1]*et+a[2]*at+a[3]*wt;Tt>u.score&&(!n||G<=e&&J>=t)&&(u.lmin=G,u.lmax=J,u.lstep=Z,u.score=Tt)}S+=1}g+=1}}c+=1}var vt=by(u.lmax),zt=by(u.lmin),oe=by(u.lstep),Qt=Math.floor(aGt((vt-zt)/oe))+1,ne=new Array(Qt);ne[0]=by(zt);for(var f=1;f<Qt;f++)ne[f]=by(ne[f-1]+oe);return{min:Math.min(e,Kc(ne)),max:Math.max(t,Ds(ne)),ticks:ne}}function pGt(e){var t=e.min,r=e.max,n=e.tickCount,i=e.nice,a=e.tickInterval,o=e.minLimit,s=e.maxLimit,l=dGt(t,r,n,i).ticks;return!ze(o)||!ze(s)?yN(e,Kc(l),Ds(l)):a?mN(t,r,a).ticks:l}function vGt(e){var t=e.base,r=e.tickCount,n=e.min,i=e.max,a=e.values,o,s=Df(t,i);if(n>0)o=Math.floor(Df(t,n));else{var l=prt(a,t,i);o=Math.floor(Df(t,l))}for(var u=s-o,c=Math.ceil(u/r),f=[],d=o;d<s+c;d=d+c)f.push(Math.pow(t,d));return n<=0&&f.unshift(0),f}function Ert(e,t,r){if(r===void 0&&(r=5),e===t)return{max:t,min:e,ticks:[e]};var n=r<0?0:Math.round(r);if(n===0)return{max:t,min:e,ticks:[]};var i=1.5,a=.5+1.5*i,o=t-e,s=o/n,l=Math.pow(10,Math.floor(Math.log10(s))),u=l;2*l-s<i*(s-u)&&(u=2*l,5*l-s<a*(s-u)&&(u=5*l,10*l-s<i*(s-u)&&(u=10*l)));for(var c=Math.ceil(t/u),f=Math.floor(e/u),d=Math.max(c*u,t),v=Math.min(f*u,e),g=Math.floor((d-v)/u)+1,x=new Array(g),w=0;w<g;w++)x[w]=by(v+w*u);return{min:v,max:d,ticks:x}}function gGt(e){var t=e.exponent,r=e.tickCount,n=Math.ceil(Im(t,e.max)),i=Math.floor(Im(t,e.min)),a=Ert(i,n,r).ticks;return a.map(function(o){var s=o>=0?1:-1;return Math.pow(o,t)*s})}function mGt(e,t){var r=e.length*t;return t===1?e[e.length-1]:t===0?e[0]:r%1!==0?e[Math.ceil(r)-1]:e.length%2===0?(e[r-1]+e[r])/2:e[r]}function yGt(e){var t=e.tickCount,r=e.values;if(!r||!r.length)return[];for(var n=r.slice().sort(function(s,l){return s-l}),i=[],a=0;a<t;a++){var o=a/(t-1);i.push(mGt(n,o))}return i}function _Gt(e){var t=e.min,r=e.max,n=e.tickCount,i=e.tickInterval,a=e.minLimit,o=e.maxLimit,s=Ert(t,r,n).ticks;return!ze(a)||!ze(o)?yN(e,Kc(s),Ds(s)):i?mN(t,r,i).ticks:s}function xGt(e){var t=e.min,r=e.max,n=e.minTickInterval,i=e.tickInterval,a=e.tickCount;if(i)a=Math.ceil((r-t)/i);else{i=QVt(t,r,a)[1];var o=(r-t)/i,s=o/a;s>1&&(i=i*Math.ceil(s)),n&&i<n&&(i=n)}i=Math.max(Math.floor((r-t)/(Math.pow(2,12)-1)),i);for(var l=[],u=t;u<r+i;u+=i)l.push(u);return l}function bGt(e){var t=brt($({showLast:!0},e));return t}function OR(e){return new Date(e).getFullYear()}function EGt(e){return new Date(e,0,1).getTime()}function OF(e){return new Date(e).getMonth()}function wGt(e,t){var r=OR(e),n=OR(t),i=OF(e),a=OF(t);return(n-r)*12+(a-i)%12}function CGt(e,t){return new Date(e,t,1).getTime()}function SGt(e,t){return Math.ceil((t-e)/og)}function TGt(e,t){return Math.ceil((t-e)/Vy)}function AGt(e,t){return Math.ceil((t-e)/(60*1e3))}function MGt(e){var t=e.min,r=e.max,n=e.minTickInterval,i=e.tickCount,a=e.tickInterval,o=[];a||(a=(r-t)/i,n&&a<n&&(a=n)),a=Math.max(Math.floor((r-t)/(Math.pow(2,12)-1)),a);var s=OR(t);if(a>iG)for(var l=OR(r),u=Math.ceil(a/iG),c=s;c<=l+u;c=c+u)o.push(EGt(c));else if(a>eC)for(var f=Math.ceil(a/eC),d=OF(t),v=wGt(t,r),c=0;c<=v+f;c=c+f)o.push(CGt(s,c+d));else if(a>og)for(var g=new Date(t),x=g.getFullYear(),w=g.getMonth(),S=g.getDate(),M=Math.ceil(a/og),R=SGt(t,r),c=0;c<R+M;c=c+M)o.push(new Date(x,w,S+c).getTime());else if(a>Vy)for(var g=new Date(t),x=g.getFullYear(),w=g.getMonth(),M=g.getDate(),I=g.getHours(),P=Math.ceil(a/Vy),k=TGt(t,r),c=0;c<=k+P;c=c+P)o.push(new Date(x,w,M,I+c).getTime());else if(a>Hy)for(var z=AGt(t,r),G=Math.ceil(a/Hy),c=0;c<=z+G;c=c+G)o.push(t+c*Hy);else{var J=a;J<Od&&(J=Od);for(var Z=Math.floor(t/Od)*Od,X=Math.ceil((r-t)/Od),et=Math.ceil(J/Od),c=0;c<X+et;c=c+et)o.push(Z+c*Od)}return o.length>=512&&console.warn("Notice: current ticks length("+o.length+') >= 512, may cause performance issues, even out of memory. Because of the configure "tickInterval"(in milliseconds, current is '+a+") is too small, increase the value to solve the problem!"),o}ep("cat",brt);ep("time-cat",bGt);ep("wilkinson-extended",pGt);ep("r-pretty",_Gt);ep("time",xGt);ep("time-pretty",MGt);ep("log",vGt);ep("pow",gGt);ep("quantile",yGt);ep("d3-linear",rGt);rp("cat",l2);rp("category",l2);rp("identity",xrt);rp("linear",u2);rp("log",vrt);rp("pow",grt);rp("time",mrt);rp("timeCat",drt);rp("quantize",gN);rp("quantile",yrt);const iOe=Object.freeze(Object.defineProperty({__proto__:null,Category:l2,Identity:xrt,Linear:u2,Log:vrt,Pow:grt,Quantile:yrt,Quantize:gN,Scale:s2,Time:mrt,TimeCat:drt,getScale:LR,getTickMethod:ert,registerScale:rp,registerTickMethod:ep},Symbol.toStringTag,{value:"Module"}));var wrt={},_N=function(e){return wrt[e.toLowerCase()]},Ub=function(e,t){if(_N(e))throw new Error("Attribute type '".concat(e,"' existed."));wrt[e.toLowerCase()]=t};Ub("Color",Zet);Ub("Opacity",qet);Ub("Position",Ket);Ub("Shape",Qet);Ub("Size",Jet);const aOe=Object.freeze(Object.defineProperty({__proto__:null,Attribute:zb,Color:Zet,Opacity:qet,Position:Ket,Scale:s2,Shape:Qet,Size:Jet,getAttribute:_N,registerAttribute:Ub},Symbol.toStringTag,{value:"Module"}));var s3=function(){function e(t){this.type="coordinate",this.isRect=!1,this.isHelix=!1,this.isPolar=!1,this.isReflectX=!1,this.isReflectY=!1;var r=t.start,n=t.end,i=t.matrix,a=i===void 0?[1,0,0,0,1,0,0,0,1]:i,o=t.isTransposed,s=o===void 0?!1:o;this.start=r,this.end=n,this.matrix=a,this.originalMatrix=on([],a),this.isTransposed=s}return e.prototype.initial=function(){this.center={x:(this.start.x+this.end.x)/2,y:(this.start.y+this.end.y)/2},this.width=Math.abs(this.end.x-this.start.x),this.height=Math.abs(this.end.y-this.start.y)},e.prototype.update=function(t){Qi(this,t),this.initial()},e.prototype.convertDim=function(t,r){var n,i=this[r],a=i.start,o=i.end;return this.isReflect(r)&&(n=[o,a],a=n[0],o=n[1]),a+t*(o-a)},e.prototype.invertDim=function(t,r){var n,i=this[r],a=i.start,o=i.end;return this.isReflect(r)&&(n=[o,a],a=n[0],o=n[1]),(t-a)/(o-a)},e.prototype.applyMatrix=function(t,r,n){n===void 0&&(n=0);var i=this.matrix,a=[t,r,n];return wC(a,a,i),a},e.prototype.invertMatrix=function(t,r,n){n===void 0&&(n=0);var i=this.matrix,a=$It([0,0,0,0,0,0,0,0,0],i),o=[t,r,n];return a&&wC(o,o,a),o},e.prototype.convert=function(t){var r=this.convertPoint(t),n=r.x,i=r.y,a=this.applyMatrix(n,i,1);return{x:a[0],y:a[1]}},e.prototype.invert=function(t){var r=this.invertMatrix(t.x,t.y,1);return this.invertPoint({x:r[0],y:r[1]})},e.prototype.rotate=function(t){var r=this.matrix,n=this.center;return Q1(r,r,[-n.x,-n.y]),aN(r,r,t),Q1(r,r,[n.x,n.y]),this},e.prototype.reflect=function(t){return t==="x"?this.isReflectX=!this.isReflectX:this.isReflectY=!this.isReflectY,this},e.prototype.scale=function(t,r){var n=this.matrix,i=this.center;return Q1(n,n,[-i.x,-i.y]),_et(n,n,[t,r]),Q1(n,n,[i.x,i.y]),this},e.prototype.translate=function(t,r){var n=this.matrix;return Q1(n,n,[t,r]),this},e.prototype.transpose=function(){return this.isTransposed=!this.isTransposed,this},e.prototype.getCenter=function(){return this.center},e.prototype.getWidth=function(){return this.width},e.prototype.getHeight=function(){return this.height},e.prototype.getRadius=function(){return this.radius},e.prototype.isReflect=function(t){return t==="x"?this.isReflectX:this.isReflectY},e.prototype.resetMatrix=function(t){this.matrix=t||on([],this.originalMatrix)},e}(),Crt=function(e){$t(t,e);function t(r){var n=e.call(this,r)||this;return n.isRect=!0,n.type="cartesian",n.initial(),n}return t.prototype.initial=function(){e.prototype.initial.call(this);var r=this.start,n=this.end;this.x={start:r.x,end:n.x},this.y={start:r.y,end:n.y}},t.prototype.convertPoint=function(r){var n,i=r.x,a=r.y;return this.isTransposed&&(n=[a,i],i=n[0],a=n[1]),{x:this.convertDim(i,"x"),y:this.convertDim(a,"y")}},t.prototype.invertPoint=function(r){var n,i=this.invertDim(r.x,"x"),a=this.invertDim(r.y,"y");return this.isTransposed&&(n=[a,i],i=n[0],a=n[1]),{x:i,y:a}},t}(s3),RGt=function(e){$t(t,e);function t(r){var n=e.call(this,r)||this;n.isHelix=!0,n.type="helix";var i=r.startAngle,a=i===void 0?1.25*Math.PI:i,o=r.endAngle,s=o===void 0?7.25*Math.PI:o,l=r.innerRadius,u=l===void 0?0:l,c=r.radius;return n.startAngle=a,n.endAngle=s,n.innerRadius=u,n.radius=c,n.initial(),n}return t.prototype.initial=function(){e.prototype.initial.call(this);var r=(this.endAngle-this.startAngle)/(2*Math.PI)+1,n=Math.min(this.width,this.height)/2;this.radius&&this.radius>=0&&this.radius<=1&&(n=n*this.radius),this.d=Math.floor(n*(1-this.innerRadius)/r),this.a=this.d/(Math.PI*2),this.x={start:this.startAngle,end:this.endAngle},this.y={start:this.innerRadius*n,end:this.innerRadius*n+this.d*.99}},t.prototype.convertPoint=function(r){var n,i=r.x,a=r.y;this.isTransposed&&(n=[a,i],i=n[0],a=n[1]);var o=this.convertDim(i,"x"),s=this.a*o,l=this.convertDim(a,"y");return{x:this.center.x+Math.cos(o)*(s+l),y:this.center.y+Math.sin(o)*(s+l)}},t.prototype.invertPoint=function(r){var n,i=this.d+this.y.start,a=WM([0,0],[r.x,r.y],[this.center.x,this.center.y]),o=oN(a,[1,0],!0),s=o*this.a;nx(a)<s&&(s=nx(a));var l=Math.floor((nx(a)-s)/i);o=2*l*Math.PI+o;var u=this.a*o,c=nx(a)-u;c=xl(c,0)?0:c;var f=this.invertDim(o,"x"),d=this.invertDim(c,"y");return f=xl(f,0)?0:f,d=xl(d,0)?0:d,this.isTransposed&&(n=[d,f],f=n[0],d=n[1]),{x:f,y:d}},t}(s3),IGt=function(e){$t(t,e);function t(r){var n=e.call(this,r)||this;n.isPolar=!0,n.type="polar";var i=r.startAngle,a=i===void 0?-Math.PI/2:i,o=r.endAngle,s=o===void 0?Math.PI*3/2:o,l=r.innerRadius,u=l===void 0?0:l,c=r.radius;return n.startAngle=a,n.endAngle=s,n.innerRadius=u,n.radius=c,n.initial(),n}return t.prototype.initial=function(){for(e.prototype.initial.call(this);this.endAngle<this.startAngle;)this.endAngle+=Math.PI*2;var r=this.getOneBox(),n=r.maxX-r.minX,i=r.maxY-r.minY,a=Math.abs(r.minX)/n,o=Math.abs(r.minY)/i,s;this.height/i>this.width/n?(s=this.width/n,this.circleCenter={x:this.center.x-(.5-a)*this.width,y:this.center.y-(.5-o)*s*i}):(s=this.height/i,this.circleCenter={x:this.center.x-(.5-a)*s*n,y:this.center.y-(.5-o)*this.height}),this.polarRadius=this.radius,this.radius?this.radius>0&&this.radius<=1?this.polarRadius=s*this.radius:(this.radius<=0||this.radius>s)&&(this.polarRadius=s):this.polarRadius=s,this.x={start:this.startAngle,end:this.endAngle},this.y={start:this.innerRadius*this.polarRadius,end:this.polarRadius}},t.prototype.getRadius=function(){return this.polarRadius},t.prototype.convertPoint=function(r){var n,i=this.getCenter(),a=r.x,o=r.y;return this.isTransposed&&(n=[o,a],a=n[0],o=n[1]),a=this.convertDim(a,"x"),o=this.convertDim(o,"y"),{x:i.x+Math.cos(a)*o,y:i.y+Math.sin(a)*o}},t.prototype.invertPoint=function(r){var n,i=this.getCenter(),a=[r.x-i.x,r.y-i.y],o=this,s=o.startAngle,l=o.endAngle;this.isReflect("x")&&(n=[l,s],s=n[0],l=n[1]);var u=[1,0,0,0,1,0,0,0,1];aN(u,u,s);var c=[1,0,0];wC(c,c,u);var f=[c[0],c[1]],d=oN(f,a,l<s);xl(d,Math.PI*2)&&(d=0);var v=nx(a),g=d/(l-s);g=l-s>0?g:-g;var x=this.invertDim(v,"y"),w={x:0,y:0};return w.x=this.isTransposed?x:g,w.y=this.isTransposed?g:x,w},t.prototype.getCenter=function(){return this.circleCenter},t.prototype.getOneBox=function(){var r=this.startAngle,n=this.endAngle;if(Math.abs(n-r)>=Math.PI*2)return{minX:-1,maxX:1,minY:-1,maxY:1};for(var i=[0,Math.cos(r),Math.cos(n)],a=[0,Math.sin(r),Math.sin(n)],o=Math.min(r,n);o<Math.max(r,n);o+=Math.PI/18)i.push(Math.cos(o)),a.push(Math.sin(o));return{minX:Math.min.apply(Math,i),maxX:Math.max.apply(Math,i),minY:Math.min.apply(Math,a),maxY:Math.max.apply(Math,a)}},t}(s3),Srt={},Trt=function(e){return Srt[e.toLowerCase()]},c2=function(e,t){Srt[e.toLowerCase()]=t};c2("rect",Crt);c2("cartesian",Crt);c2("polar",IGt);c2("helix",RGt);const oOe=Object.freeze(Object.defineProperty({__proto__:null,Coordinate:s3,getCoordinate:Trt,registerCoordinate:c2},Symbol.toStringTag,{value:"Module"}));function xN(e,t,r){var n=new Nb(t,r);n.target=e,n.propagationPath.push(e),e.emitDelegation(t,n);for(var i=e.getParent();i;)i.emitDelegation(t,n),n.propagationPath.push(i),i=i.getParent()}var Art=[1,0,0,0,1,0,0,0,1];function u_(e,t,r){if(r===void 0&&(r=Art),!t)return null;var n=Ws(r,[["t",-e.x,-e.y],["r",t],["t",e.x,e.y]]);return n}function bN(e,t){return!e.x&&!e.y?null:Ws(t||Art,[["t",e.x,e.y]])}function LGt(e){var t=[1,0,0],r=[0,0,0];return wC(r,t,e),Math.atan2(r[1],r[0])}function oA(e,t){var r=[0,0];return r3t(r,t,e),r}function OGt(e,t){var r=oA(e,[t.minX,t.minY]),n=oA(e,[t.maxX,t.minY]),i=oA(e,[t.minX,t.maxY]),a=oA(e,[t.maxX,t.maxY]),o=Math.min(r[0],n[0],i[0],a[0]),s=Math.max(r[0],n[0],i[0],a[0]),l=Math.min(r[1],n[1],i[1],a[1]),u=Math.max(r[1],n[1],i[1],a[1]);return{x:o,y:l,minX:o,minY:l,maxX:s,maxY:u,width:s-o,height:u-l}}function Mrt(e,t,r,n){if(t){var i=u_({x:r,y:n},t,e.getMatrix());e.setMatrix(i)}}function EN(e,t,r){var n=bN({x:t,y:r});e.attr("matrix",n)}function PR(e){var t=0,r=0,n=0,i=0;return Rn(e)?t=r=n=i=e:Fe(e)&&(t=e[0],n=ze(e[1])?e[0]:e[1],i=ze(e[2])?e[0]:e[2],r=ze(e[3])?n:e[3]),[t,n,i,r]}function wN(e){for(var t=e.childNodes,r=t.length,n=r-1;n>=0;n--)e.removeChild(t[n])}function PGt(e,t){return!!e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function UC(e){var t=e.start,r=e.end,n=Math.min(t.x,r.x),i=Math.min(t.y,r.y),a=Math.max(t.x,r.x),o=Math.max(t.y,r.y);return{x:n,y:i,minX:n,minY:i,maxX:a,maxY:o,width:a-n,height:o-i}}function DGt(e){var t=e.map(function(s){return s.x}),r=e.map(function(s){return s.y}),n=Math.min.apply(Math,t),i=Math.min.apply(Math,r),a=Math.max.apply(Math,t),o=Math.max.apply(Math,r);return{x:n,y:i,minX:n,minY:i,maxX:a,maxY:o,width:a-n,height:o-i}}function l3(e,t,r,n){var i=e+r,a=t+n;return{x:e,y:t,width:r,height:n,minX:e,minY:t,maxX:isNaN(i)?0:i,maxY:isNaN(a)?0:a}}function Gy(e,t,r){return(1-r)*e+t*r}function Ax(e,t,r){return{x:e.x+Math.cos(r)*t,y:e.y+Math.sin(r)*t}}function FGt(e,t){var r=t.x-e.x,n=t.y-e.y;return Math.sqrt(r*r+n*n)}var DR=function(e,t,r){return r===void 0&&(r=Math.pow(Number.EPSILON,.5)),[e,t].includes(1/0)?Math.abs(e)===Math.abs(t):Math.abs(e-t)<r};function BGt(e,t){var r=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),a=Math.min(e.maxY,t.maxY);return l3(r,n,i-r,a-n)}function Rrt(e){var t=e.getClip(),r=t&&t.getBBox(),n;if(!e.isGroup())n=e.getBBox();else{var i=1/0,a=-1/0,o=1/0,s=-1/0,l=e.getChildren();l.length>0?ft(l,function(u){if(u.get("visible")){if(u.isGroup()&&u.get("children").length===0)return!0;var c=Rrt(u),f=u.applyToMatrix([c.minX,c.minY,1]),d=u.applyToMatrix([c.minX,c.maxY,1]),v=u.applyToMatrix([c.maxX,c.minY,1]),g=u.applyToMatrix([c.maxX,c.maxY,1]),x=Math.min(f[0],d[0],v[0],g[0]),w=Math.max(f[0],d[0],v[0],g[0]),S=Math.min(f[1],d[1],v[1],g[1]),M=Math.max(f[1],d[1],v[1],g[1]);x<i&&(i=x),w>a&&(a=w),S<o&&(o=S),M>s&&(s=M)}}):(i=0,a=0,o=0,s=0),n=l3(i,o,a-i,s-o)}return r?BGt(n,r):n}function NGt(e,t){if(!(!e.getClip()&&!t.getClip())){var r=t.getClip();if(!r){e.setClip(null);return}var n={type:r.get("type"),attrs:r.attr()};e.setClip(n)}}function Hc(e){return e+"px"}function Irt(e,t,r,n){var i=FGt(e,t),a=n/i,o=0;return r==="start"?o=0-a:r==="end"&&(o=1+a),{x:Gy(e.x,t.x,o),y:Gy(e.y,t.y,o)}}var kGt={none:[],point:["x","y"],region:["start","end"],points:["points"],circle:["center","radius","startAngle","endAngle"]},CN=function(e){$t(t,e);function t(r){var n=e.call(this,r)||this;return n.initCfg(),n}return t.prototype.getDefaultCfg=function(){return{id:"",name:"",type:"",locationType:"none",offsetX:0,offsetY:0,animate:!1,capture:!0,updateAutoRender:!1,animateOption:{appear:null,update:{duration:400,easing:"easeQuadInOut"},enter:{duration:400,easing:"easeQuadInOut"},leave:{duration:350,easing:"easeQuadIn"}},events:null,defaultCfg:{},visible:!0}},t.prototype.clear=function(){},t.prototype.update=function(r){var n=this,i=this.get("defaultCfg")||{};ft(r,function(a,o){var s=n.get(o),l=a;s!==a&&(Xi(a)&&i[o]&&(l=Tr({},i[o],a)),n.set(o,l))}),this.updateInner(r),this.afterUpdate(r)},t.prototype.updateInner=function(r){},t.prototype.afterUpdate=function(r){ev(r,"visible")&&(r.visible?this.show():this.hide()),ev(r,"capture")&&this.setCapture(r.capture)},t.prototype.getLayoutBBox=function(){return this.getBBox()},t.prototype.getLocationType=function(){return this.get("locationType")},t.prototype.getOffset=function(){return{offsetX:this.get("offsetX"),offsetY:this.get("offsetY")}},t.prototype.setOffset=function(r,n){this.update({offsetX:r,offsetY:n})},t.prototype.setLocation=function(r){var n=$({},r);this.update(n)},t.prototype.getLocation=function(){var r=this,n={},i=this.get("locationType"),a=kGt[i];return ft(a,function(o){n[o]=r.get(o)}),n},t.prototype.isList=function(){return!1},t.prototype.isSlider=function(){return!1},t.prototype.init=function(){},t.prototype.initCfg=function(){var r=this,n=this.get("defaultCfg");ft(n,function(i,a){var o=r.get(a);if(Xi(o)){var s=Tr({},i,o);r.set(a,s)}})},t}(qS),py="update_status",zGt=["visible","tip","delegateObject"],UGt=["container","group","shapesMap","isRegister","isUpdating","destroyed"],Yl=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{container:null,shapesMap:{},group:null,capture:!0,isRegister:!1,isUpdating:!1,isInit:!0})},t.prototype.remove=function(){this.clear();var r=this.get("group");r.remove()},t.prototype.clear=function(){var r=this.get("group");r.clear(),this.set("shapesMap",{}),this.clearOffScreenCache(),this.set("isInit",!0)},t.prototype.getChildComponentById=function(r){var n=this.getElementById(r),i=n&&n.get("component");return i},t.prototype.getElementById=function(r){return this.get("shapesMap")[r]},t.prototype.getElementByLocalId=function(r){var n=this.getElementId(r);return this.getElementById(n)},t.prototype.getElementsByName=function(r){var n=[];return ft(this.get("shapesMap"),function(i){i.get("name")===r&&n.push(i)}),n},t.prototype.getContainer=function(){return this.get("container")},t.prototype.updateInner=function(r){this.offScreenRender(),this.get("updateAutoRender")&&this.render()},t.prototype.render=function(){var r=this.get("offScreenGroup");r||(r=this.offScreenRender());var n=this.get("group");this.updateElements(r,n),this.deleteElements(),this.applyOffset(),this.get("eventInitted")||(this.initEvent(),this.set("eventInitted",!0)),this.set("isInit",!1)},t.prototype.show=function(){var r=this.get("group");r.show(),this.set("visible",!0)},t.prototype.hide=function(){var r=this.get("group");r.hide(),this.set("visible",!1)},t.prototype.setCapture=function(r){var n=this.get("group");n.set("capture",r),this.set("capture",r)},t.prototype.destroy=function(){this.removeEvent(),this.remove(),e.prototype.destroy.call(this)},t.prototype.getBBox=function(){return this.get("group").getCanvasBBox()},t.prototype.getLayoutBBox=function(){var r=this.get("group"),n=this.getInnerLayoutBBox(),i=r.getTotalMatrix();return i&&(n=OGt(i,n)),n},t.prototype.on=function(r,n,i){var a=this.get("group");return a.on(r,n,i),this},t.prototype.off=function(r,n){var i=this.get("group");return i&&i.off(r,n),this},t.prototype.emit=function(r,n){var i=this.get("group");i.emit(r,n)},t.prototype.init=function(){e.prototype.init.call(this),this.get("group")||this.initGroup(),this.offScreenRender()},t.prototype.getInnerLayoutBBox=function(){return this.get("offScreenBBox")||this.get("group").getBBox()},t.prototype.delegateEmit=function(r,n){var i=this.get("group");n.target=i,i.emit(r,n),xN(i,r,n)},t.prototype.createOffScreenGroup=function(){var r=this.get("group"),n=r.getGroupBase(),i=new n({delegateObject:this.getDelegateObject()});return i},t.prototype.applyOffset=function(){var r=this.get("offsetX"),n=this.get("offsetY");this.moveElementTo(this.get("group"),{x:r,y:n})},t.prototype.initGroup=function(){var r=this.get("container");this.set("group",r.addGroup({id:this.get("id"),name:this.get("name"),capture:this.get("capture"),visible:this.get("visible"),isComponent:!0,component:this,delegateObject:this.getDelegateObject()}))},t.prototype.offScreenRender=function(){this.clearOffScreenCache();var r=this.createOffScreenGroup();return this.renderInner(r),this.set("offScreenGroup",r),this.set("offScreenBBox",Rrt(r)),r},t.prototype.addGroup=function(r,n){this.appendDelegateObject(r,n);var i=r.addGroup(n);return this.get("isRegister")&&this.registerElement(i),i},t.prototype.addShape=function(r,n){this.appendDelegateObject(r,n);var i=r.addShape(n);return this.get("isRegister")&&this.registerElement(i),i},t.prototype.addComponent=function(r,n){var i=n.id,a=n.component,o=fi(n,["id","component"]),s=new a($($({},o),{id:i,container:r,updateAutoRender:this.get("updateAutoRender")}));return s.init(),s.render(),this.get("isRegister")&&this.registerElement(s.get("group")),s},t.prototype.initEvent=function(){},t.prototype.removeEvent=function(){var r=this.get("group");r.off()},t.prototype.getElementId=function(r){var n=this.get("id"),i=this.get("name");return n+"-"+i+"-"+r},t.prototype.registerElement=function(r){var n=r.get("id");this.get("shapesMap")[n]=r},t.prototype.unregisterElement=function(r){var n=r.get("id");delete this.get("shapesMap")[n]},t.prototype.moveElementTo=function(r,n){var i=bN(n);r.attr("matrix",i)},t.prototype.addAnimation=function(r,n,i){var a=n.attr("opacity");ze(a)&&(a=1),n.attr("opacity",0),n.animate({opacity:a},i)},t.prototype.removeAnimation=function(r,n,i){n.animate({opacity:0},i)},t.prototype.updateAnimation=function(r,n,i,a){n.animate(i,a)},t.prototype.updateElements=function(r,n){var i=this,a=this.get("animate"),o=this.get("animateOption"),s=r.getChildren().slice(0),l;ft(s,function(u){var c=u.get("id"),f=i.getElementById(c),d=u.get("name");if(f)if(u.get("isComponent")){var v=u.get("component"),g=f.get("component"),x=Vd(v.cfg,Vtt(P_(v.cfg),UGt));g.update(x),f.set(py,"update")}else{var w=i.getReplaceAttrs(f,u);a&&o.update?i.updateAnimation(d,f,w,o.update):f.attr(w),u.isGroup()&&i.updateElements(u,f),ft(zGt,function(I){f.set(I,u.get(I))}),NGt(f,u),l=f,f.set(py,"update")}else{n.add(u);var S=n.getChildren();if(S.splice(S.length-1,1),l){var M=S.indexOf(l);S.splice(M+1,0,u)}else S.unshift(u);if(i.registerElement(u),u.set(py,"add"),u.get("isComponent")){var v=u.get("component");v.set("container",n)}else u.isGroup()&&i.registerNewGroup(u);if(l=u,a){var R=i.get("isInit")?o.appear:o.enter;R&&i.addAnimation(d,u,R)}}})},t.prototype.clearUpdateStatus=function(r){var n=r.getChildren();ft(n,function(i){i.set(py,null)})},t.prototype.clearOffScreenCache=function(){var r=this.get("offScreenGroup");r&&r.destroy(),this.set("offScreenGroup",null),this.set("offScreenBBox",null)},t.prototype.getDelegateObject=function(){var r,n=this.get("name"),i=(r={},r[n]=this,r.component=this,r);return i},t.prototype.appendDelegateObject=function(r,n){var i=r.get("delegateObject");n.delegateObject||(n.delegateObject={}),Qi(n.delegateObject,i)},t.prototype.getReplaceAttrs=function(r,n){var i=r.attr(),a=n.attr();return ft(i,function(o,s){a[s]===void 0&&(a[s]=void 0)}),a},t.prototype.registerNewGroup=function(r){var n=this,i=r.getChildren();ft(i,function(a){n.registerElement(a),a.set(py,"add"),a.isGroup()&&n.registerNewGroup(a)})},t.prototype.deleteElements=function(){var r=this,n=this.get("shapesMap"),i=[];ft(n,function(s,l){!s.get(py)||s.destroyed?i.push([l,s]):s.set(py,null)});var a=this.get("animate"),o=this.get("animateOption");ft(i,function(s){var l=s[0],u=s[1];if(!u.destroyed){var c=u.get("name");if(a&&o.leave){var f=Qi({callback:function(){r.removeElement(u)}},o.leave);r.removeAnimation(c,u,f)}else r.removeElement(u)}delete n[l]})},t.prototype.removeElement=function(r){if(r.get("isGroup")){var n=r.get("component");n&&n.destroy()}r.remove()},t}(CN),lP="…";function $Gt(e){for(var t=0,r=0;r<e.length;r++)t+=Ey(e,r);return t}function Ey(e,t){return e.charCodeAt(t)>0&&e.charCodeAt(t)<128?1:2}function HGt(e,t,r){r===void 0&&(r="tail");var n=e.length,i="";if(r==="tail"){for(var a=0,o=0;a<t;){var s=Ey(e,o);if(a+s<=t)i+=e[o],a+=Ey(e,o),o++;else break}i+=lP}else if(r==="head"){for(var a=0,o=n-1;a<t;){var s=Ey(e,o);if(a+s<=t)i+=e[o],a+=Ey(e,o),o--;else break}i=lP+i}else{for(var l="",u="",a=0,c=0,f=n-1;a<t;){var d=Ey(e,c),v=!1;d+a<=t&&(l+=e[c],c++,a+=d,v=!0);var g=Ey(e,f);if(g+a<=t&&(u=e[f]+u,a+=g,f--,v=!0),!v)break}i=l+lP+u}return i}var VGt="…",GGt=2,WGt=400;function XGt(e){for(var t=e.map(function(l){var u=l.attr("text");return ze(u)?"":""+u}),r=0,n=0,i=0;i<t.length;i+=1){for(var a=0,o=0;o<=t[i].length;o+=1){var s=t[i].charCodeAt(o);s>=19968&&s<=40869?a+=2:a+=1}a>r&&(r=a,n=i)}return e[n].getBBox().width}function PF(e){if(e.length>WGt)return XGt(e);var t=0;return ft(e,function(r){var n=r.getBBox(),i=n.width;t<i&&(t=i)}),t}function jGt(e,t){var r=t.getCanvasBBox();return e?r.width:r.height}function rC(e,t,r,n){var i;n===void 0&&(n="tail");var a=(i=t.attr("text"))!==null&&i!==void 0?i:"";if(n==="tail"){var o=Vd(t.attr(),["fontSize","fontFamily","fontWeight","fontStyle","fontVariant"]),s=oet(a,r,o,"…");return a!==s?(t.attr("text",s),t.set("tip",a),!0):(t.set("tip",null),!1)}var l=jGt(e,t),u=$Gt(a),c=!1;if(r<l){var f=Math.floor(r/l*u)-GGt,d=void 0;f>=0?d=HGt(a,f,n):d=VGt,d&&(t.attr("text",d),c=!0)}return c?t.set("tip",a):t.set("tip",null),c}function u3(e,t){var r=t.x,n=t.y,i=t.content,a=t.style,o=t.id,s=t.name,l=t.rotate,u=t.maxLength,c=t.autoEllipsis,f=t.isVertical,d=t.ellipsisPosition,v=t.background,g=e.addGroup({id:o+"-group",name:s+"-group",attrs:{x:r,y:n}}),x=g.addShape({type:"text",id:o,name:s,attrs:$({x:0,y:0,text:i},a)}),w=PR(xt(v,"padding",0));if(u&&c){var S=u-(w[1]+w[3]);rC(!f,x,S,d)}if(v){var M=xt(v,"style",{}),R=x.getCanvasBBox(),I=R.minX,P=R.minY,k=R.width,z=R.height,G=g.addShape("rect",{id:o+"-bg",name:o+"-bg",attrs:$({x:I-w[3],y:P-w[0],width:k+w[1]+w[3],height:z+w[0]+w[2]},M)});G.toBack()}EN(g,r,n),Mrt(g,l,r,n)}const Mi={fontFamily:`
  BlinkMacSystemFont, "Segoe UI", Roboto,"Helvetica Neue",
  Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei",
  SimSun, "sans-serif"`,textColor:"#2C3542",activeTextColor:"#333333",uncheckedColor:"#D8D8D8",lineColor:"#416180",regionColor:"#CCD7EB",verticalAxisRotate:-Math.PI/4,horizontalAxisRotate:Math.PI/4,descriptionIconStroke:"#fff",descriptionIconFill:"rgba(58, 73, 101, .25)"};var YGt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{name:"annotation",type:"line",locationType:"region",start:null,end:null,style:{},text:null,defaultCfg:{style:{fill:Mi.textColor,fontSize:12,textAlign:"center",textBaseline:"bottom",fontFamily:Mi.fontFamily},text:{position:"center",autoRotate:!0,content:null,offsetX:0,offsetY:0,style:{stroke:Mi.lineColor,lineWidth:1}}}})},t.prototype.renderInner=function(r){this.renderLine(r),this.get("text")&&this.renderLabel(r)},t.prototype.renderLine=function(r){var n=this.get("start"),i=this.get("end"),a=this.get("style");this.addShape(r,{type:"line",id:this.getElementId("line"),name:"annotation-line",attrs:$({x1:n.x,y1:n.y,x2:i.x,y2:i.y},a)})},t.prototype.getLabelPoint=function(r,n,i){var a;return i==="start"?a=0:i==="center"?a=.5:en(i)&&i.indexOf("%")!==-1?a=parseInt(i,10)/100:Rn(i)?a=i:a=1,(a>1||a<0)&&(a=1),{x:Gy(r.x,n.x,a),y:Gy(r.y,n.y,a)}},t.prototype.renderLabel=function(r){var n=this.get("text"),i=this.get("start"),a=this.get("end"),o=n.position,s=n.content,l=n.style,u=n.offsetX,c=n.offsetY,f=n.autoRotate,d=n.maxLength,v=n.autoEllipsis,g=n.ellipsisPosition,x=n.background,w=n.isVertical,S=w===void 0?!1:w,M=this.getLabelPoint(i,a,o),R=M.x+u,I=M.y+c,P={id:this.getElementId("line-text"),name:"annotation-line-text",x:R,y:I,content:s,style:l,maxLength:d,autoEllipsis:v,ellipsisPosition:g,background:x,isVertical:S};if(f){var k=[a.x-i.x,a.y-i.y];P.rotate=Math.atan2(k[1],k[0])}u3(r,P)},t}(Yl),ZGt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{name:"annotation",type:"text",locationType:"point",x:0,y:0,content:"",rotate:null,style:{},background:null,maxLength:null,autoEllipsis:!0,isVertical:!1,ellipsisPosition:"tail",defaultCfg:{style:{fill:Mi.textColor,fontSize:12,textAlign:"center",textBaseline:"middle",fontFamily:Mi.fontFamily}}})},t.prototype.setLocation=function(r){this.set("x",r.x),this.set("y",r.y),this.resetLocation()},t.prototype.renderInner=function(r){var n=this.getLocation(),i=n.x,a=n.y,o=this.get("content"),s=this.get("style"),l=this.getElementId("text"),u=this.get("name")+"-text",c=this.get("maxLength"),f=this.get("autoEllipsis"),d=this.get("isVertical"),v=this.get("ellipsisPosition"),g=this.get("background"),x=this.get("rotate"),w={id:l,name:u,x:i,y:a,content:o,style:s,maxLength:c,autoEllipsis:f,isVertical:d,ellipsisPosition:v,background:g,rotate:x};u3(r,w)},t.prototype.resetLocation=function(){var r=this.getElementByLocalId("text-group");if(r){var n=this.getLocation(),i=n.x,a=n.y,o=this.get("rotate");EN(r,i,a),Mrt(r,o,i,a)}},t}(Yl),qGt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{name:"annotation",type:"arc",locationType:"circle",center:null,radius:100,startAngle:-Math.PI/2,endAngle:Math.PI*3/2,style:{stroke:"#999",lineWidth:1}})},t.prototype.renderInner=function(r){this.renderArc(r)},t.prototype.getArcPath=function(){var r=this.getLocation(),n=r.center,i=r.radius,a=r.startAngle,o=r.endAngle,s=Ax(n,i,a),l=Ax(n,i,o),u=o-a>Math.PI?1:0,c=[["M",s.x,s.y]];if(o-a===Math.PI*2){var f=Ax(n,i,a+Math.PI);c.push(["A",i,i,0,u,1,f.x,f.y]),c.push(["A",i,i,0,u,1,l.x,l.y])}else c.push(["A",i,i,0,u,1,l.x,l.y]);return c},t.prototype.renderArc=function(r){var n=this.getArcPath(),i=this.get("style");this.addShape(r,{type:"path",id:this.getElementId("arc"),name:"annotation-arc",attrs:$({path:n},i)})},t}(Yl),KGt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{name:"annotation",type:"region",locationType:"region",start:null,end:null,style:{},defaultCfg:{style:{lineWidth:0,fill:Mi.regionColor,opacity:.4}}})},t.prototype.renderInner=function(r){this.renderRegion(r)},t.prototype.renderRegion=function(r){var n=this.get("start"),i=this.get("end"),a=this.get("style"),o=UC({start:n,end:i});this.addShape(r,{type:"rect",id:this.getElementId("region"),name:"annotation-region",attrs:$({x:o.x,y:o.y,width:o.width,height:o.height},a)})},t}(Yl),QGt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{name:"annotation",type:"image",locationType:"region",start:null,end:null,src:null,style:{}})},t.prototype.renderInner=function(r){this.renderImage(r)},t.prototype.getImageAttrs=function(){var r=this.get("start"),n=this.get("end"),i=this.get("style"),a=UC({start:r,end:n}),o=this.get("src");return $({x:a.x,y:a.y,img:o,width:a.width,height:a.height},i)},t.prototype.renderImage=function(r){this.addShape(r,{type:"image",id:this.getElementId("image"),name:"annotation-image",attrs:this.getImageAttrs()})},t}(Yl),JGt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{name:"annotation",type:"dataMarker",locationType:"point",x:0,y:0,point:{},line:{},text:{},direction:"upward",autoAdjust:!0,coordinateBBox:null,defaultCfg:{point:{display:!0,style:{r:3,fill:"#FFFFFF",stroke:"#1890FF",lineWidth:2}},line:{display:!0,length:20,style:{stroke:Mi.lineColor,lineWidth:1}},text:{content:"",display:!0,style:{fill:Mi.textColor,opacity:.65,fontSize:12,textAlign:"start",fontFamily:Mi.fontFamily}}}})},t.prototype.renderInner=function(r){xt(this.get("line"),"display")&&this.renderLine(r),xt(this.get("text"),"display")&&this.renderText(r),xt(this.get("point"),"display")&&this.renderPoint(r),this.get("autoAdjust")&&this.autoAdjust(r)},t.prototype.applyOffset=function(){this.moveElementTo(this.get("group"),{x:this.get("x")+this.get("offsetX"),y:this.get("y")+this.get("offsetY")})},t.prototype.renderPoint=function(r){var n=this.getShapeAttrs().point;this.addShape(r,{type:"circle",id:this.getElementId("point"),name:"annotation-point",attrs:n})},t.prototype.renderLine=function(r){var n=this.getShapeAttrs().line;this.addShape(r,{type:"path",id:this.getElementId("line"),name:"annotation-line",attrs:n})},t.prototype.renderText=function(r){var n=this.getShapeAttrs().text,i=n.x,a=n.y,o=n.text,s=fi(n,["x","y","text"]),l=this.get("text"),u=l.background,c=l.maxLength,f=l.autoEllipsis,d=l.isVertival,v=l.ellipsisPosition,g={x:i,y:a,id:this.getElementId("text"),name:"annotation-text",content:o,style:s,background:u,maxLength:c,autoEllipsis:f,isVertival:d,ellipsisPosition:v};u3(r,g)},t.prototype.autoAdjust=function(r){var n=this.get("direction"),i=this.get("x"),a=this.get("y"),o=xt(this.get("line"),"length",0),s=this.get("coordinateBBox"),l=r.getBBox(),u=l.minX,c=l.maxX,f=l.minY,d=l.maxY,v=r.findById(this.getElementId("text-group")),g=r.findById(this.getElementId("text")),x=r.findById(this.getElementId("line"));if(s&&v){var w=v.attr("x"),S=v.attr("y"),M=g.getCanvasBBox(),R=M.width,I=M.height,P=0,k=0;if(i+u<=s.minX)if(n==="leftward")P=1;else{var z=s.minX-(i+u);w=v.attr("x")+z}else if(i+c>=s.maxX)if(n==="rightward")P=-1;else{var z=i+c-s.maxX;w=v.attr("x")-z}if(P&&(x&&x.attr("path",[["M",0,0],["L",o*P,0]]),w=(o+2+R)*P),a+f<=s.minY)if(n==="upward")k=1;else{var z=s.minY-(a+f);S=v.attr("y")+z}else if(a+d>=s.maxY)if(n==="downward")k=-1;else{var z=a+d-s.maxY;S=v.attr("y")-z}k&&(x&&x.attr("path",[["M",0,0],["L",0,o*k]]),S=(o+2+I)*k),(w!==v.attr("x")||S!==v.attr("y"))&&EN(v,w,S)}},t.prototype.getShapeAttrs=function(){var r=xt(this.get("line"),"display"),n=xt(this.get("point"),"style",{}),i=xt(this.get("line"),"style",{}),a=xt(this.get("text"),"style",{}),o=this.get("direction"),s=r?xt(this.get("line"),"length",0):0,l=0,u=0,c="top",f="start";switch(o){case"upward":u=-1,c="bottom";break;case"downward":u=1,c="top";break;case"leftward":l=-1,f="end";break;case"rightward":l=1,f="start";break}return{point:$({x:0,y:0},n),line:$({path:[["M",0,0],["L",s*l,s*u]]},i),text:$({x:(s+2)*l,y:(s+2)*u,text:xt(this.get("text"),"content",""),textBaseline:c,textAlign:f},a)}},t}(Yl),tWt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{name:"annotation",type:"dataRegion",locationType:"points",points:[],lineLength:0,region:{},text:{},defaultCfg:{region:{style:{lineWidth:0,fill:Mi.regionColor,opacity:.4}},text:{content:"",style:{textAlign:"center",textBaseline:"bottom",fontSize:12,fill:Mi.textColor,fontFamily:Mi.fontFamily}}}})},t.prototype.renderInner=function(r){var n=xt(this.get("region"),"style",{});xt(this.get("text"),"style",{});var i=this.get("lineLength")||0,a=this.get("points");if(a.length){var o=DGt(a),s=[];s.push(["M",a[0].x,o.minY-i]),a.forEach(function(u){s.push(["L",u.x,u.y])}),s.push(["L",a[a.length-1].x,a[a.length-1].y-i]),this.addShape(r,{type:"path",id:this.getElementId("region"),name:"annotation-region",attrs:$({path:s},n)});var l=$({id:this.getElementId("text"),name:"annotation-text",x:(o.minX+o.maxX)/2,y:o.minY-i},this.get("text"));u3(r,l)}},t}(Yl),eWt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{name:"annotation",type:"regionFilter",locationType:"region",start:null,end:null,color:null,shape:[]})},t.prototype.renderInner=function(r){var n=this,i=this.get("start"),a=this.get("end"),o=this.addGroup(r,{id:this.getElementId("region-filter"),capture:!1});ft(this.get("shapes"),function(l,u){var c=l.get("type"),f=bl(l.attr());n.adjustShapeAttrs(f),n.addShape(o,{id:n.getElementId("shape-"+c+"-"+u),capture:!1,type:c,attrs:f})});var s=UC({start:i,end:a});o.setClip({type:"rect",attrs:{x:s.minX,y:s.minY,width:s.width,height:s.height}})},t.prototype.adjustShapeAttrs=function(r){var n=this.get("color");r.fill&&(r.fill=r.fillStyle=n),r.stroke=r.strokeStyle=n},t}(Yl),rWt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{name:"annotation",type:"shape",draw:ag})},t.prototype.renderInner=function(r){var n=this.get("render");Rr(n)&&n(r)},t}(Yl),c3=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{container:null,containerTpl:"<div></div>",updateAutoRender:!0,containerClassName:"",parent:null})},t.prototype.getContainer=function(){return this.get("container")},t.prototype.show=function(){var r=this.get("container");r.style.display="",this.set("visible",!0)},t.prototype.hide=function(){var r=this.get("container");r.style.display="none",this.set("visible",!1)},t.prototype.setCapture=function(r){var n=this.getContainer(),i=r?"auto":"none";n.style.pointerEvents=i,this.set("capture",r)},t.prototype.getBBox=function(){var r=this.getContainer(),n=parseFloat(r.style.left)||0,i=parseFloat(r.style.top)||0;return l3(n,i,r.clientWidth,r.clientHeight)},t.prototype.clear=function(){var r=this.get("container");wN(r)},t.prototype.destroy=function(){this.removeEvent(),this.removeDom(),e.prototype.destroy.call(this)},t.prototype.init=function(){e.prototype.init.call(this),this.initContainer(),this.initDom(),this.resetStyles(),this.applyStyles(),this.initEvent(),this.initCapture(),this.initVisible()},t.prototype.initCapture=function(){this.setCapture(this.get("capture"))},t.prototype.initVisible=function(){this.get("visible")?this.show():this.hide()},t.prototype.initDom=function(){},t.prototype.initContainer=function(){var r=this.get("container");if(ze(r)){r=this.createDom();var n=this.get("parent");en(n)&&(n=document.getElementById(n),this.set("parent",n)),n.appendChild(r),this.get("containerId")&&r.setAttribute("id",this.get("containerId")),this.set("container",r)}else en(r)&&(r=document.getElementById(r),this.set("container",r));this.get("parent")||this.set("parent",r.parentNode)},t.prototype.resetStyles=function(){var r=this.get("domStyles"),n=this.get("defaultStyles");r?r=Tr({},n,r):r=n,this.set("domStyles",r)},t.prototype.applyStyles=function(){var r=this.get("domStyles");if(r){var n=this.getContainer();this.applyChildrenStyles(n,r);var i=this.get("containerClassName");if(i&&PGt(n,i)){var a=r[i];za(n,a)}}},t.prototype.applyChildrenStyles=function(r,n){ft(n,function(i,a){var o=r.getElementsByClassName(a);ft(o,function(s){za(s,i)})})},t.prototype.applyStyle=function(r,n){var i=this.get("domStyles");za(n,i[r])},t.prototype.createDom=function(){var r=this.get("containerTpl");return hg(r)},t.prototype.initEvent=function(){},t.prototype.removeDom=function(){var r=this.get("container");r&&r.parentNode&&r.parentNode.removeChild(r)},t.prototype.removeEvent=function(){},t.prototype.updateInner=function(r){ev(r,"domStyles")&&(this.resetStyles(),this.applyStyles()),this.resetPosition()},t.prototype.resetPosition=function(){},t}(CN),nWt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{name:"annotation",type:"html",locationType:"point",x:0,y:0,containerTpl:'<div class="g2-html-annotation" style="position:absolute"></div>',alignX:"left",alignY:"top",html:"",zIndex:7})},t.prototype.render=function(){var r=this.getContainer(),n=this.get("html");wN(r);var i=Rr(n)?n(r):n;if(eN(i))r.appendChild(i);else if(en(i)||Rn(i)){var a=hg(""+i);a&&r.appendChild(a)}this.resetPosition()},t.prototype.resetPosition=function(){var r=this.getContainer(),n=this.getLocation(),i=n.x,a=n.y,o=this.get("alignX"),s=this.get("alignY"),l=this.get("offsetX"),u=this.get("offsetY"),c=f$t(r),f=c$t(r),d={x:i,y:a};o==="middle"?d.x-=Math.round(c/2):o==="right"&&(d.x-=Math.round(c)),s==="middle"?d.y-=Math.round(f/2):s==="bottom"&&(d.y-=Math.round(f)),l&&(d.x+=l),u&&(d.y+=u),za(r,{position:"absolute",left:d.x+"px",top:d.y+"px",zIndex:this.get("zIndex")})},t}(c3);const Lrt=Object.freeze(Object.defineProperty({__proto__:null,Arc:qGt,DataMarker:JGt,DataRegion:tWt,Html:nWt,Image:QGt,Line:YGt,Region:KGt,RegionFilter:eWt,Shape:rWt,Text:ZGt},Symbol.toStringTag,{value:"Module"}));function Nw(e,t,r){var n=t+"Style",i=null;return ft(r,function(a,o){e[o]&&a[n]&&(i||(i={}),Qi(i,a[n]))}),i}var SN=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{name:"axis",ticks:[],line:{},tickLine:{},subTickLine:null,title:null,label:{},verticalFactor:1,verticalLimitLength:null,overlapOrder:["autoRotate","autoEllipsis","autoHide"],tickStates:{},optimize:{},defaultCfg:{line:{style:{lineWidth:1,stroke:Mi.lineColor}},tickLine:{style:{lineWidth:1,stroke:Mi.lineColor},alignTick:!0,length:5,displayWithLabel:!0},subTickLine:{style:{lineWidth:1,stroke:Mi.lineColor},count:4,length:2},label:{autoRotate:!0,autoHide:!1,autoEllipsis:!1,style:{fontSize:12,fill:Mi.textColor,fontFamily:Mi.fontFamily,fontWeight:"normal"},offset:10,offsetX:0,offsetY:0},title:{autoRotate:!0,spacing:5,position:"center",style:{fontSize:12,fill:Mi.textColor,textBaseline:"middle",fontFamily:Mi.fontFamily,textAlign:"center"},iconStyle:{fill:Mi.descriptionIconFill,stroke:Mi.descriptionIconStroke},description:""},tickStates:{active:{labelStyle:{fontWeight:500},tickLineStyle:{lineWidth:2}},inactive:{labelStyle:{fill:Mi.uncheckedColor}}},optimize:{enable:!0,threshold:400}},theme:{}})},t.prototype.renderInner=function(r){this.get("line")&&this.drawLine(r),this.drawTicks(r),this.get("title")&&this.drawTitle(r)},t.prototype.isList=function(){return!0},t.prototype.getItems=function(){return this.get("ticks")},t.prototype.setItems=function(r){this.update({ticks:r})},t.prototype.updateItem=function(r,n){Qi(r,n),this.clear(),this.render()},t.prototype.clearItems=function(){var r=this.getElementByLocalId("label-group");r&&r.clear()},t.prototype.setItemState=function(r,n,i){r[n]=i,this.updateTickStates(r)},t.prototype.hasState=function(r,n){return!!r[n]},t.prototype.getItemStates=function(r){var n=this.get("tickStates"),i=[];return ft(n,function(a,o){r[o]&&i.push(o)}),i},t.prototype.clearItemsState=function(r){var n=this,i=this.getItemsByState(r);ft(i,function(a){n.setItemState(a,r,!1)})},t.prototype.getItemsByState=function(r){var n=this,i=this.getItems();return Al(i,function(a){return n.hasState(a,r)})},t.prototype.getSidePoint=function(r,n){var i=this,a=i.getSideVector(n,r);return{x:r.x+a[0],y:r.y+a[1]}},t.prototype.getTextAnchor=function(r){var n;return xl(r[0],0)?n="center":r[0]>0?n="start":r[0]<0&&(n="end"),n},t.prototype.getTextBaseline=function(r){var n;return xl(r[1],0)?n="middle":r[1]>0?n="top":r[1]<0&&(n="bottom"),n},t.prototype.processOverlap=function(r){},t.prototype.drawLine=function(r){var n=this.getLinePath(),i=this.get("line");this.addShape(r,{type:"path",id:this.getElementId("line"),name:"axis-line",attrs:Qi({path:n},i.style)})},t.prototype.getTickLineItems=function(r){var n=this,i=[],a=this.get("tickLine"),o=a.alignTick,s=a.length,l=1,u=r.length;return u>=2&&(l=r[1].value-r[0].value),ft(r,function(c){var f=c.point;o||(f=n.getTickPoint(c.value-l/2));var d=n.getSidePoint(f,s);i.push({startPoint:f,tickValue:c.value,endPoint:d,tickId:c.id,id:"tickline-"+c.id})}),i},t.prototype.getSubTickLineItems=function(r){var n=[],i=this.get("subTickLine"),a=i.count,o=r.length;if(o>=2)for(var s=0;s<o-1;s++)for(var l=r[s],u=r[s+1],c=0;c<a;c++){var f=(c+1)/(a+1),d=(1-f)*l.tickValue+f*u.tickValue,v=this.getTickPoint(d),g=this.getSidePoint(v,i.length);n.push({startPoint:v,endPoint:g,tickValue:d,id:"sub-"+l.id+"-"+c})}return n},t.prototype.getTickLineAttrs=function(r,n,i,a){var o=this.get(n).style,s={points:[r.startPoint,r.endPoint]},l=xt(this.get("theme"),["tickLine","style"],{});o=Rr(o)?Qi({},l,o(s,i,a)):o;var u=r.startPoint,c=r.endPoint;return $({x1:u.x,y1:u.y,x2:c.x,y2:c.y},o)},t.prototype.drawTick=function(r,n,i,a,o){this.addShape(n,{type:"line",id:this.getElementId(r.id),name:"axis-"+i,attrs:this.getTickLineAttrs(r,i,a,o)})},t.prototype.drawTickLines=function(r){var n=this,i=this.get("ticks"),a=this.get("subTickLine"),o=this.getTickLineItems(i),s=this.addGroup(r,{name:"axis-tickline-group",id:this.getElementId("tickline-group")}),l=this.get("tickLine");if(ft(o,function(c,f){if(l.displayWithLabel){var d=n.getElementId("label-"+c.tickId);r.findById(d)&&n.drawTick(c,s,"tickLine",f,o)}else n.drawTick(c,s,"tickLine",f,o)}),a){var u=this.getSubTickLineItems(o);ft(u,function(c,f){n.drawTick(c,s,"subTickLine",f,u)})}},t.prototype.processTicks=function(){var r=this,n=this.get("ticks");ft(n,function(i){i.point=r.getTickPoint(i.value),ze(i.id)&&(i.id=i.name)})},t.prototype.drawTicks=function(r){var n=this;this.optimizeTicks(),this.processTicks(),this.get("label")&&this.drawLabels(r),this.get("tickLine")&&this.drawTickLines(r);var i=this.get("ticks");ft(i,function(a){n.applyTickStates(a,r)})},t.prototype.optimizeTicks=function(){var r=this.get("optimize"),n=this.get("ticks");if(r&&r.enable&&r.threshold>0){var i=il(n);if(i>r.threshold){var a=Math.ceil(i/r.threshold),o=n.filter(function(s,l){return l%a===0});this.set("ticks",o),this.set("originalTicks",n)}}},t.prototype.getLabelAttrs=function(r,n,i){var a=this.get("label"),o=a.offset,s=a.offsetX,l=a.offsetY,u=a.rotate,c=a.formatter,f=this.getSidePoint(r.point,o),d=this.getSideVector(o,f),v=c?c(r.name,r,n):r.name,g=a.style;g=Rr(g)?xt(this.get("theme"),["label","style"],{}):g;var x=Qi({x:f.x+s,y:f.y+l,text:v,textAlign:this.getTextAnchor(d),textBaseline:this.getTextBaseline(d)},g);return u&&(x.matrix=u_(f,u)),x},t.prototype.drawLabels=function(r){var n=this,i=this.get("ticks"),a=this.addGroup(r,{name:"axis-label-group",id:this.getElementId("label-group")});ft(i,function(d,v){n.addShape(a,{type:"text",name:"axis-label",id:n.getElementId("label-"+d.id),attrs:n.getLabelAttrs(d,v,i),delegateObject:{tick:d,item:d,index:v}})}),this.processOverlap(a);var o=a.getChildren(),s=xt(this.get("theme"),["label","style"],{}),l=this.get("label"),u=l.style,c=l.formatter;if(Rr(u)){var f=o.map(function(d){return xt(d.get("delegateObject"),"tick")});ft(o,function(d,v){var g=d.get("delegateObject").tick,x=c?c(g.name,g,v):g.name,w=Qi({},s,u(x,v,f));d.attr(w)})}},t.prototype.getTitleAttrs=function(){var r=this.get("title"),n=r.style,i=r.position,a=r.offset,o=r.spacing,s=o===void 0?0:o,l=r.autoRotate,u=n.fontSize,c=.5;i==="start"?c=0:i==="end"&&(c=1);var f=this.getTickPoint(c),d=this.getSidePoint(f,a||s+u/2),v=Qi({x:d.x,y:d.y,text:r.text},n),g=r.rotate,x=g;if(ze(g)&&l){var w=this.getAxisVector(f),S=[1,0];x=oN(w,S,!0)}if(x){var M=u_(d,x);v.matrix=M}return v},t.prototype.drawTitle=function(r){var n,i=this.getTitleAttrs(),a=this.addShape(r,{type:"text",id:this.getElementId("title"),name:"axis-title",attrs:i});!((n=this.get("title"))===null||n===void 0)&&n.description&&this.drawDescriptionIcon(r,a,i.matrix)},t.prototype.drawDescriptionIcon=function(r,n,i){var a=this.addGroup(r,{name:"axis-description",id:this.getElementById("description")}),o=n.getBBox(),s=o.maxX,l=o.maxY,u=o.height,c=this.get("title").iconStyle,f=4,d=u/2,v=d/6,g=s+f,x=l-u/2,w=[g+d,x-d],S=w[0],M=w[1],R=[S+d,M+d],I=R[0],P=R[1],k=[S,P+d],z=k[0],G=k[1],J=[g,M+d],Z=J[0],X=J[1],et=[g+d,x-u/4],at=et[0],wt=et[1],Tt=[at,wt+v],vt=Tt[0],zt=Tt[1],oe=[vt,zt+v],Qt=oe[0],ne=oe[1],de=[Qt,ne+d*3/4],De=de[0],Ze=de[1];this.addShape(a,{type:"path",id:this.getElementId("title-description-icon"),name:"axis-title-description-icon",attrs:$({path:[["M",S,M],["A",d,d,0,0,1,I,P],["A",d,d,0,0,1,z,G],["A",d,d,0,0,1,Z,X],["A",d,d,0,0,1,S,M],["M",at,wt],["L",vt,zt],["M",Qt,ne],["L",De,Ze]],lineWidth:v,matrix:i},c)}),this.addShape(a,{type:"rect",id:this.getElementId("title-description-rect"),name:"axis-title-description-rect",attrs:{x:g,y:x-u/2,width:u,height:u,stroke:"#000",fill:"#000",opacity:0,matrix:i,cursor:"pointer"}})},t.prototype.applyTickStates=function(r,n){var i=this.getItemStates(r);if(i.length){var a=this.get("tickStates"),o=this.getElementId("label-"+r.id),s=n.findById(o);if(s){var l=Nw(r,"label",a);l&&s.attr(l)}var u=this.getElementId("tickline-"+r.id),c=n.findById(u);if(c){var f=Nw(r,"tickLine",a);f&&c.attr(f)}}},t.prototype.updateTickStates=function(r){var n=this.getItemStates(r),i=this.get("tickStates"),a=this.get("label"),o=this.getElementByLocalId("label-"+r.id),s=this.get("tickLine"),l=this.getElementByLocalId("tickline-"+r.id);if(n.length){if(o){var u=Nw(r,"label",i);u&&o.attr(u)}if(l){var c=Nw(r,"tickLine",i);c&&l.attr(c)}}else o&&o.attr(a.style),l&&l.attr(s.style)},t}(Yl);function TN(e,t,r,n){var i=t.getChildren(),a=!1;return ft(i,function(o){var s=rC(e,o,r,n);a=a||s}),a}function iWt(){return Ort}function aWt(e,t,r){return TN(e,t,r,"head")}function Ort(e,t,r){return TN(e,t,r,"tail")}function oWt(e,t,r){return TN(e,t,r,"middle")}const sWt=Object.freeze(Object.defineProperty({__proto__:null,ellipsisHead:aWt,ellipsisMiddle:oWt,ellipsisTail:Ort,getDefault:iWt},Symbol.toStringTag,{value:"Module"}));function lWt(e){var t=e.attr("matrix");return t&&t[0]!==1}function Prt(e){var t=lWt(e)?LGt(e.attr("matrix")):0;return t%360}function DF(e,t,r,n){var i=!1,a=Prt(t),o=Math.abs(e?r.attr("y")-t.attr("y"):r.attr("x")-t.attr("x")),s=(e?r.attr("y")>t.attr("y"):r.attr("x")>t.attr("x"))?t.getBBox():r.getBBox();if(e){var l=Math.abs(Math.cos(a));DR(l,0,Math.PI/180)?i=s.width+n>o:i=s.height/l+n>o}else{var l=Math.abs(Math.sin(a));DR(l,0,Math.PI/180)?i=s.width+n>o:i=s.height/l+n>o}return i}function $C(e,t,r,n){var i=(n==null?void 0:n.minGap)||0,a=t.getChildren().slice().filter(function(v){return v.get("visible")});if(!a.length)return!1;var o=!1;r&&a.reverse();for(var s=a.length,l=a[0],u=l,c=1;c<s;c++){var f=a[c];f.getBBox();var d=DF(e,u,f,i);d?(f.hide(),o=!0):u=f}return o}function Drt(e,t,r){var n=(r==null?void 0:r.minGap)||0,i=t.getChildren().slice();if(i.length<2)return!1;var a=!1,o=i[0],s=o.getBBox(),l=i[1],u=i.length,c=Prt(o),f=Math.abs(e?l.attr("y")-o.attr("y"):l.attr("x")-o.attr("x")),d=0;if(e){var v=Math.abs(Math.cos(c));if(DR(v,0,Math.PI/180)){var g=PF(i);d=(g+n)/f}else d=(s.height/v+n)/f}else{var v=Math.abs(Math.sin(c));if(DR(v,0,Math.PI/180)){var g=PF(i);d=(g+n)/f}else d=(s.height/v+n)/f}if(d>1){d=Math.ceil(d);for(var x=0;x<u;x++)x%d!==0&&(i[x].hide(),a=!0)}return a}function uWt(){return Frt}function cWt(e,t,r,n){return $C(e,t,!1,n)}function hWt(e,t,r,n){return $C(e,t,!0,n)}function fWt(e,t,r,n){var i=(n==null?void 0:n.minGap)||0,a=t.getChildren().slice();if(a.length<=2)return!1;for(var o=!1,s=a.length,l=a[0],u=a[s-1],c=l,f=1;f<s-1;f++){var d=a[f];d.getBBox();var v=DF(e,c,d,i);v?(d.hide(),o=!0):c=d}var g=DF(e,c,u,i);return g&&(c.hide(),o=!0),o}function Frt(e,t,r,n){var i=Drt(e,t,n);return $C(e,t,!1)&&(i=!0),i}function dWt(e,t,r,n){var i=t.getChildren().slice(),a=Drt(e,t,n);if(i.length>2){var o=i[0],s=i[i.length-1];o.get("visible")||(o.show(),$C(e,t,!1,n)&&(a=!0)),s.get("visible")||(s.show(),$C(e,t,!0,n)&&(a=!0))}return a}const pWt=Object.freeze(Object.defineProperty({__proto__:null,equidistance:Frt,equidistanceWithReverseBoth:dWt,getDefault:uWt,reserveBoth:fWt,reserveFirst:cWt,reserveLast:hWt},Symbol.toStringTag,{value:"Module"}));function vWt(e,t){ft(e,function(r){var n=r.attr("x"),i=r.attr("y"),a=u_({x:n,y:i},t);r.attr("matrix",a)})}function Brt(e,t,r,n){var i=t.getChildren();if(!i.length||!e&&i.length<2)return!1;var a=PF(i),o=!1;if(e)o=!!r&&a>r;else{var s=Math.abs(i[1].attr("x")-i[0].attr("x"));o=a>s}if(o){var l=n(r,a);vWt(i,l)}return o}function gWt(){return Nrt}function Nrt(e,t,r,n){return Brt(e,t,r,function(){return Rn(n)?n:e?Mi.verticalAxisRotate:Mi.horizontalAxisRotate})}function mWt(e,t,r){return Brt(e,t,r,function(n,i){if(!n)return e?Mi.verticalAxisRotate:Mi.horizontalAxisRotate;if(e)return-Math.acos(n/i);var a=0;return n>i?a=Math.PI/4:(a=Math.asin(n/i),a>Math.PI/4&&(a=Math.PI/4)),a})}const yWt=Object.freeze(Object.defineProperty({__proto__:null,fixedAngle:Nrt,getDefault:gWt,unfixedAngle:mWt},Symbol.toStringTag,{value:"Module"})),krt=Object.freeze(Object.defineProperty({__proto__:null,autoEllipsis:sWt,autoHide:pWt,autoRotate:yWt},Symbol.toStringTag,{value:"Module"}));var zrt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{type:"line",locationType:"region",start:null,end:null})},t.prototype.getLinePath=function(){var r=this.get("start"),n=this.get("end"),i=[];return i.push(["M",r.x,r.y]),i.push(["L",n.x,n.y]),i},t.prototype.getInnerLayoutBBox=function(){var r=this.get("start"),n=this.get("end"),i=e.prototype.getInnerLayoutBBox.call(this),a=Math.min(r.x,n.x,i.x),o=Math.min(r.y,n.y,i.y),s=Math.max(r.x,n.x,i.maxX),l=Math.max(r.y,n.y,i.maxY);return{x:a,y:o,minX:a,minY:o,maxX:s,maxY:l,width:s-a,height:l-o}},t.prototype.isVertical=function(){var r=this.get("start"),n=this.get("end");return xl(r.x,n.x)},t.prototype.isHorizontal=function(){var r=this.get("start"),n=this.get("end");return xl(r.y,n.y)},t.prototype.getTickPoint=function(r){var n=this,i=n.get("start"),a=n.get("end"),o=a.x-i.x,s=a.y-i.y;return{x:i.x+o*r,y:i.y+s*r}},t.prototype.getSideVector=function(r){var n=this.getAxisVector(),i=jx([0,0],n),a=this.get("verticalFactor"),o=[i[1],i[0]*-1];return oc([0,0],o,r*a)},t.prototype.getAxisVector=function(){var r=this.get("start"),n=this.get("end");return[n.x-r.x,n.y-r.y]},t.prototype.processOverlap=function(r){var n=this,i=this.isVertical(),a=this.isHorizontal();if(!(!i&&!a)){var o=this.get("label"),s=this.get("title"),l=this.get("verticalLimitLength"),u=o.offset,c=l,f=0,d=0;s&&(f=s.style.fontSize,d=s.spacing),c&&(c=c-u-d-f);var v=this.get("overlapOrder");if(ft(v,function(w){o[w]&&n.canProcessOverlap(w)&&n.autoProcessOverlap(w,o[w],r,c)}),s&&ze(s.offset)){var g=r.getCanvasBBox(),x=i?g.width:g.height;s.offset=u+x+d+f/2}}},t.prototype.canProcessOverlap=function(r){var n=this.get("label");return r==="autoRotate"?ze(n.rotate):!0},t.prototype.autoProcessOverlap=function(r,n,i,a){var o=this,s=this.isVertical(),l=!1,u=krt[r];if(n===!0)this.get("label"),l=u.getDefault()(s,i,a);else if(Rr(n))l=n(s,i,a);else if(Xi(n)){var c=n;u[c.type]&&(l=u[c.type](s,i,a,c.cfg))}else u[n]&&(l=u[n](s,i,a));if(r==="autoRotate"){if(l){var f=i.getChildren(),d=this.get("verticalFactor");ft(f,function(g){var x=g.attr("textAlign");if(x==="center"){var w=d>0?"end":"start";g.attr("textAlign",w)}})}}else if(r==="autoHide"){var v=i.getChildren().slice(0);ft(v,function(g){g.get("visible")||(o.get("isRegister")&&o.unregisterElement(g),g.remove())})}},t}(SN),Urt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{type:"circle",locationType:"circle",center:null,radius:null,startAngle:-Math.PI/2,endAngle:Math.PI*3/2})},t.prototype.getLinePath=function(){var r=this.get("center"),n=r.x,i=r.y,a=this.get("radius"),o=a,s=this.get("startAngle"),l=this.get("endAngle"),u=[];if(Math.abs(l-s)===Math.PI*2)u=[["M",n,i-o],["A",a,o,0,1,1,n,i+o],["A",a,o,0,1,1,n,i-o],["Z"]];else{var c=this.getCirclePoint(s),f=this.getCirclePoint(l),d=Math.abs(l-s)>Math.PI?1:0,v=s>l?0:1;u=[["M",n,i],["L",c.x,c.y],["A",a,o,0,d,v,f.x,f.y],["L",n,i]]}return u},t.prototype.getTickPoint=function(r){var n=this.get("startAngle"),i=this.get("endAngle"),a=n+(i-n)*r;return this.getCirclePoint(a)},t.prototype.getSideVector=function(r,n){var i=this.get("center"),a=[n.x-i.x,n.y-i.y],o=this.get("verticalFactor"),s=nx(a);return oc(a,a,o*r/s),a},t.prototype.getAxisVector=function(r){var n=this.get("center"),i=[r.x-n.x,r.y-n.y];return[i[1],-1*i[0]]},t.prototype.getCirclePoint=function(r,n){var i=this.get("center");return n=n||this.get("radius"),{x:i.x+Math.cos(r)*n,y:i.y+Math.sin(r)*n}},t.prototype.canProcessOverlap=function(r){var n=this.get("label");return r==="autoRotate"?ze(n.rotate):!0},t.prototype.processOverlap=function(r){var n=this,i=this.get("label"),a=this.get("title"),o=this.get("verticalLimitLength"),s=i.offset,l=o,u=0,c=0;a&&(u=a.style.fontSize,c=a.spacing),l&&(l=l-s-c-u);var f=this.get("overlapOrder");if(ft(f,function(v){i[v]&&n.canProcessOverlap(v)&&n.autoProcessOverlap(v,i[v],r,l)}),a&&ze(a.offset)){var d=r.getCanvasBBox().height;a.offset=s+d+c+u/2}},t.prototype.autoProcessOverlap=function(r,n,i,a){var o=this,s=!1,l=krt[r];if(a>0)if(n===!0)s=l.getDefault()(!1,i,a);else if(Rr(n))s=n(!1,i,a);else if(Xi(n)){var u=n;l[u.type]&&(s=l[u.type](!1,i,a,u.cfg))}else l[n]&&(s=l[n](!1,i,a));if(r==="autoRotate"){if(s){var c=i.getChildren(),f=this.get("verticalFactor");ft(c,function(v){var g=v.attr("textAlign");if(g==="center"){var x=f>0?"end":"start";v.attr("textAlign",x)}})}}else if(r==="autoHide"){var d=i.getChildren().slice(0);ft(d,function(v){v.get("visible")||(o.get("isRegister")&&o.unregisterElement(v),v.remove())})}},t}(SN);const _Wt=Object.freeze(Object.defineProperty({__proto__:null,Base:SN,Circle:Urt,Line:zrt},Symbol.toStringTag,{value:"Module"}));var AN=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{name:"crosshair",type:"base",line:{},text:null,textBackground:{},capture:!1,defaultCfg:{line:{style:{lineWidth:1,stroke:Mi.lineColor}},text:{position:"start",offset:10,autoRotate:!1,content:null,style:{fill:Mi.textColor,textAlign:"center",textBaseline:"middle",fontFamily:Mi.fontFamily}},textBackground:{padding:5,style:{stroke:Mi.lineColor}}}})},t.prototype.renderInner=function(r){this.get("line")&&this.renderLine(r),this.get("text")&&(this.renderText(r),this.renderBackground(r))},t.prototype.renderText=function(r){var n=this.get("text"),i=n.style,a=n.autoRotate,o=n.content;if(!ze(o)){var s=this.getTextPoint(),l=null;if(a){var u=this.getRotateAngle();l=u_(s,u)}this.addShape(r,{type:"text",name:"crosshair-text",id:this.getElementId("text"),attrs:$($($({},s),{text:o,matrix:l}),i)})}},t.prototype.renderLine=function(r){var n=this.getLinePath(),i=this.get("line"),a=i.style;this.addShape(r,{type:"path",name:"crosshair-line",id:this.getElementId("line"),attrs:$({path:n},a)})},t.prototype.renderBackground=function(r){var n=this.getElementId("text"),i=r.findById(n),a=this.get("textBackground");if(a&&i){var o=i.getBBox(),s=PR(a.padding),l=a.style,u=this.addShape(r,{type:"rect",name:"crosshair-text-background",id:this.getElementId("text-background"),attrs:$({x:o.x-s[3],y:o.y-s[0],width:o.width+s[1]+s[3],height:o.height+s[0]+s[2],matrix:i.attr("matrix")},l)});u.toBack()}},t}(Yl),$rt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{type:"line",locationType:"region",start:null,end:null})},t.prototype.getRotateAngle=function(){var r=this.getLocation(),n=r.start,i=r.end,a=this.get("text").position,o=Math.atan2(i.y-n.y,i.x-n.x),s=a==="start"?o-Math.PI/2:o+Math.PI/2;return s},t.prototype.getTextPoint=function(){var r=this.getLocation(),n=r.start,i=r.end,a=this.get("text"),o=a.position,s=a.offset;return Irt(n,i,o,s)},t.prototype.getLinePath=function(){var r=this.getLocation(),n=r.start,i=r.end;return[["M",n.x,n.y],["L",i.x,i.y]]},t}(AN),xWt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{type:"circle",locationType:"circle",center:null,radius:100,startAngle:-Math.PI/2,endAngle:Math.PI*3/2})},t.prototype.getRotateAngle=function(){var r=this.getLocation(),n=r.startAngle,i=r.endAngle,a=this.get("text").position,o=a==="start"?n+Math.PI/2:i-Math.PI/2;return o},t.prototype.getTextPoint=function(){var r=this.get("text"),n=r.position,i=r.offset,a=this.getLocation(),o=a.center,s=a.radius,l=a.startAngle,u=a.endAngle,c=n==="start"?l:u,f=this.getRotateAngle()-Math.PI,d=Ax(o,s,c),v=Math.cos(f)*i,g=Math.sin(f)*i;return{x:d.x+v,y:d.y+g}},t.prototype.getLinePath=function(){var r=this.getLocation(),n=r.center,i=r.radius,a=r.startAngle,o=r.endAngle,s=null;if(o-a===Math.PI*2){var l=n.x,u=n.y;s=[["M",l,u-i],["A",i,i,0,1,1,l,u+i],["A",i,i,0,1,1,l,u-i],["Z"]]}else{var c=Ax(n,i,a),f=Ax(n,i,o),d=Math.abs(o-a)>Math.PI?1:0,v=a>o?0:1;s=[["M",c.x,c.y],["A",i,i,0,d,v,f.x,f.y]]}return s},t}(AN),HC="g2-crosshair",FF=HC+"-line",BF=HC+"-text",hw;const bWt=(hw={},hw[""+HC]={position:"relative"},hw[""+FF]={position:"absolute",backgroundColor:"rgba(0, 0, 0, 0.25)"},hw[""+BF]={position:"absolute",color:Mi.textColor,fontFamily:Mi.fontFamily},hw);var EWt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{name:"crosshair",type:"html",locationType:"region",start:{x:0,y:0},end:{x:0,y:0},capture:!1,text:null,containerTpl:'<div class="'+HC+'"></div>',crosshairTpl:'<div class="'+FF+'"></div>',textTpl:'<span class="'+BF+'">{content}</span>',domStyles:null,containerClassName:HC,defaultStyles:bWt,defaultCfg:{text:{position:"start",content:null,align:"center",offset:10}}})},t.prototype.render=function(){this.resetText(),this.resetPosition()},t.prototype.initCrossHair=function(){var r=this.getContainer(),n=this.get("crosshairTpl"),i=hg(n);r.appendChild(i),this.applyStyle(FF,i),this.set("crosshairEl",i)},t.prototype.getTextPoint=function(){var r=this.getLocation(),n=r.start,i=r.end,a=this.get("text"),o=a.position,s=a.offset;return Irt(n,i,o,s)},t.prototype.resetText=function(){var r=this.get("text"),n=this.get("textEl");if(r){var i=r.content;if(!n){var a=this.getContainer(),o=Tb(this.get("textTpl"),r);n=hg(o),a.appendChild(n),this.applyStyle(BF,n),this.set("textEl",n)}n.innerHTML=i}else n&&n.remove()},t.prototype.isVertical=function(r,n){return r.x===n.x},t.prototype.resetPosition=function(){var r=this.get("crosshairEl");r||(this.initCrossHair(),r=this.get("crosshairEl"));var n=this.get("start"),i=this.get("end"),a=Math.min(n.x,i.x),o=Math.min(n.y,i.y);this.isVertical(n,i)?za(r,{width:"1px",height:Hc(Math.abs(i.y-n.y))}):za(r,{height:"1px",width:Hc(Math.abs(i.x-n.x))}),za(r,{top:Hc(o),left:Hc(a)}),this.alignText()},t.prototype.alignText=function(){var r=this.get("textEl");if(r){var n=this.get("text").align,i=r.clientWidth,a=this.getTextPoint();switch(n){case"center":a.x=a.x-i/2;break;case"right":a.x=a.x-i}za(r,{top:Hc(a.y),left:Hc(a.x)})}},t.prototype.updateInner=function(r){ev(r,"text")&&this.resetText(),e.prototype.updateInner.call(this,r)},t}(c3);const NF=Object.freeze(Object.defineProperty({__proto__:null,Base:AN,Circle:xWt,Html:EWt,Line:$rt},Symbol.toStringTag,{value:"Module"}));var MN=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{name:"grid",line:{},alternateColor:null,capture:!1,items:[],closed:!1,defaultCfg:{line:{type:"line",style:{lineWidth:1,stroke:Mi.lineColor}}}})},t.prototype.getLineType=function(){var r=this.get("line")||this.get("defaultCfg").line;return r.type},t.prototype.renderInner=function(r){this.drawGrid(r)},t.prototype.getAlternatePath=function(r,n){var i=this.getGridPath(r),a=n.slice(0).reverse(),o=this.getGridPath(a,!0),s=this.get("closed");return s?i=i.concat(o):(o[0][0]="L",i=i.concat(o),i.push(["Z"])),i},t.prototype.getPathStyle=function(){return this.get("line").style},t.prototype.drawGrid=function(r){var n=this,i=this.get("line"),a=this.get("items"),o=this.get("alternateColor"),s=null;ft(a,function(l,u){var c=l.id||u;if(i){var f=n.getPathStyle();f=Rr(f)?f(l,u,a):f;var d=n.getElementId("line-"+c),v=n.getGridPath(l.points);n.addShape(r,{type:"path",name:"grid-line",id:d,attrs:Qi({path:v},f)})}if(o&&u>0){var g=n.getElementId("region-"+c),x=u%2===0;if(en(o))x&&n.drawAlternateRegion(g,r,s.points,l.points,o);else{var w=x?o[1]:o[0];n.drawAlternateRegion(g,r,s.points,l.points,w)}}s=l})},t.prototype.drawAlternateRegion=function(r,n,i,a,o){var s=this.getAlternatePath(i,a);this.addShape(n,{type:"path",id:r,name:"grid-region",attrs:{path:s,fill:o}})},t}(Yl);function wWt(e,t,r,n){var i=r-e,a=n-t;return Math.sqrt(i*i+a*a)}var Hrt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{type:"circle",center:null,closed:!0})},t.prototype.getGridPath=function(r,n){var i=this.getLineType(),a=this.get("closed"),o=[];if(r.length)if(i==="circle"){var s=this.get("center"),l=r[0],u=wWt(s.x,s.y,l.x,l.y),c=n?0:1;a?(o.push(["M",s.x,s.y-u]),o.push(["A",u,u,0,0,c,s.x,s.y+u]),o.push(["A",u,u,0,0,c,s.x,s.y-u]),o.push(["Z"])):ft(r,function(f,d){d===0?o.push(["M",f.x,f.y]):o.push(["A",u,u,0,0,c,f.x,f.y])})}else ft(r,function(f,d){d===0?o.push(["M",f.x,f.y]):o.push(["L",f.x,f.y])}),a&&o.push(["Z"]);return o},t}(MN),Vrt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{type:"line"})},t.prototype.getGridPath=function(r){var n=[];return ft(r,function(i,a){a===0?n.push(["M",i.x,i.y]):n.push(["L",i.x,i.y])}),n},t}(MN);const CWt=Object.freeze(Object.defineProperty({__proto__:null,Base:MN,Circle:Hrt,Line:Vrt},Symbol.toStringTag,{value:"Module"}));var RN=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{name:"legend",layout:"horizontal",locationType:"point",x:0,y:0,offsetX:0,offsetY:0,title:null,background:null})},t.prototype.getLayoutBBox=function(){var r=e.prototype.getLayoutBBox.call(this),n=this.get("maxWidth"),i=this.get("maxHeight"),a=r.width,o=r.height;return n&&(a=Math.min(a,n)),i&&(o=Math.min(o,i)),l3(r.minX,r.minY,a,o)},t.prototype.setLocation=function(r){this.set("x",r.x),this.set("y",r.y),this.resetLocation()},t.prototype.resetLocation=function(){var r=this.get("x"),n=this.get("y"),i=this.get("offsetX"),a=this.get("offsetY");this.moveElementTo(this.get("group"),{x:r+i,y:n+a})},t.prototype.applyOffset=function(){this.resetLocation()},t.prototype.getDrawPoint=function(){return this.get("currentPoint")},t.prototype.setDrawPoint=function(r){return this.set("currentPoint",r)},t.prototype.renderInner=function(r){this.resetDraw(),this.get("title")&&this.drawTitle(r),this.drawLegendContent(r),this.get("background")&&this.drawBackground(r)},t.prototype.drawBackground=function(r){var n=this.get("background"),i=r.getBBox(),a=PR(n.padding),o=$({x:0,y:0,width:i.width+a[1]+a[3],height:i.height+a[0]+a[2]},n.style),s=this.addShape(r,{type:"rect",id:this.getElementId("background"),name:"legend-background",attrs:o});s.toBack()},t.prototype.drawTitle=function(r){var n=this.get("currentPoint"),i=this.get("title"),a=i.spacing,o=i.style,s=i.text,l=this.addShape(r,{type:"text",id:this.getElementId("title"),name:"legend-title",attrs:$({text:s,x:n.x,y:n.y},o)}),u=l.getBBox();this.set("currentPoint",{x:n.x,y:u.maxY+a})},t.prototype.resetDraw=function(){var r=this.get("background"),n={x:0,y:0};if(r){var i=PR(r.padding);n.x=i[3],n.y=i[0]}this.set("currentPoint",n)},t}(Yl),uP={marker:{style:{inactiveFill:"#000",inactiveOpacity:.45,fill:"#000",opacity:1,size:12}},text:{style:{fill:"#ccc",fontSize:12}}},sA={fill:Mi.textColor,fontSize:12,textAlign:"start",textBaseline:"middle",fontFamily:Mi.fontFamily,fontWeight:"normal",lineHeight:12},cP="navigation-arrow-right",hP="navigation-arrow-left",cG={right:90*Math.PI/180,left:(360-90)*Math.PI/180,up:0,down:180*Math.PI/180},Grt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.currentPageIndex=1,r.totalPagesCnt=1,r.pageWidth=0,r.pageHeight=0,r.startX=0,r.startY=0,r.onNavigationBack=function(){var n=r.getElementByLocalId("item-group");if(r.currentPageIndex>1){r.currentPageIndex-=1,r.updateNavigation();var i=r.getCurrentNavigationMatrix();r.get("animate")?n.animate({matrix:i},100):n.attr({matrix:i})}},r.onNavigationAfter=function(){var n=r.getElementByLocalId("item-group");if(r.currentPageIndex<r.totalPagesCnt){r.currentPageIndex+=1,r.updateNavigation();var i=r.getCurrentNavigationMatrix();r.get("animate")?n.animate({matrix:i},100):n.attr({matrix:i})}},r}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{name:"legend",type:"category",itemSpacing:24,itemMarginBottom:8,maxItemWidth:null,itemWidth:null,itemHeight:null,itemName:{},itemValue:null,maxWidth:null,maxHeight:null,marker:{},radio:null,items:[],itemStates:{},itemBackground:{},pageNavigator:{},defaultCfg:{title:{spacing:5,style:{fill:Mi.textColor,fontSize:12,textAlign:"start",textBaseline:"top"}},background:{padding:5,style:{stroke:Mi.lineColor}},itemBackground:{style:{opacity:0,fill:"#fff"}},pageNavigator:uP,itemName:{spacing:16,style:sA},marker:{spacing:8,style:{r:6,symbol:"circle"}},itemValue:{alignRight:!1,formatter:null,style:sA,spacing:6},itemStates:{active:{nameStyle:{opacity:.8}},unchecked:{nameStyle:{fill:Mi.uncheckedColor},markerStyle:{fill:Mi.uncheckedColor,stroke:Mi.uncheckedColor}},inactive:{nameStyle:{fill:Mi.uncheckedColor},markerStyle:{opacity:.2}}}}})},t.prototype.isList=function(){return!0},t.prototype.getItems=function(){return this.get("items")},t.prototype.setItems=function(r){this.update({items:r})},t.prototype.updateItem=function(r,n){Qi(r,n),this.clear(),this.render()},t.prototype.clearItems=function(){var r=this.getElementByLocalId("item-group");r&&r.clear()},t.prototype.setItemState=function(r,n,i){r[n]=i;var a=this.getElementByLocalId("item-"+r.id);if(a){var o=this.getItems(),s=o.indexOf(r),l=this.createOffScreenGroup(),u=this.drawItem(r,s,this.getItemHeight(),l);this.updateElements(u,a),this.clearUpdateStatus(a)}},t.prototype.hasState=function(r,n){return!!r[n]},t.prototype.getItemStates=function(r){var n=this.get("itemStates"),i=[];return ft(n,function(a,o){r[o]&&i.push(o)}),i},t.prototype.clearItemsState=function(r){var n=this,i=this.getItemsByState(r);ft(i,function(a){n.setItemState(a,r,!1)})},t.prototype.getItemsByState=function(r){var n=this,i=this.getItems();return Al(i,function(a){return n.hasState(a,r)})},t.prototype.drawLegendContent=function(r){this.processItems(),this.drawItems(r)},t.prototype.processItems=function(){var r=this.get("items");ft(r,function(n){n.id||(n.id=n.name)})},t.prototype.drawItems=function(r){var n=this,i=this.addGroup(r,{id:this.getElementId("item-container-group"),name:"legend-item-container-group"}),a=this.addGroup(i,{id:this.getElementId("item-group"),name:"legend-item-group"}),o=this.getItemHeight(),s=this.get("itemWidth"),l=this.get("itemSpacing"),u=this.get("itemMarginBottom"),c=this.get("currentPoint"),f=c.x,d=c.y,v=this.get("layout"),g=this.get("items"),x=!1,w=0,S=this.get("maxWidth"),M=this.get("maxHeight");ft(g,function(R,I){var P=n.drawItem(R,I,o,a),k=P.getBBox(),z=s||k.width;z>w&&(w=z),v==="horizontal"?(S&&S<c.x+z-f&&(x=!0,c.x=f,c.y+=o+u),n.moveElementTo(P,c),c.x+=z+l):(M&&M<c.y+o+u-d&&(x=!0,c.x+=w+l,c.y=d,w=0),n.moveElementTo(P,c),c.y+=o+u)}),x&&this.get("flipPage")&&(this.pageHeight=0,this.pageWidth=0,this.totalPagesCnt=1,this.startX=f,this.startY=d,this.adjustNavigation(r,a))},t.prototype.getItemHeight=function(){var r=this.get("itemHeight");if(!r){var n=(this.get("itemName")||{}).style;if(Rr(n)){var i=this.getItems();i.forEach(function(a,o){var s=$($({},sA),n(a,o,i)).fontSize;r<s&&(r=s)})}else n&&(r=n.fontSize)}return r},t.prototype.drawMarker=function(r,n,i,a){var o=$($($({x:0,y:a/2},n.style),{symbol:xt(i.marker,"symbol","circle")}),xt(i.marker,"style",{})),s=this.addShape(r,{type:"marker",id:this.getElementId("item-"+i.id+"-marker"),name:"legend-item-marker",attrs:o}),l=s.getBBox();s.attr("x",l.width/2);var u=s.attr(),c=u.stroke,f=u.fill;return c&&s.set("isStroke",!0),f&&s.set("isFill",!0),s},t.prototype.drawItemText=function(r,n,i,a,o,s,l){var u=i.formatter,c=i.style,f=$($({x:s,y:o/2,text:u?u(a[n],a,l):a[n]},sA),Rr(c)?c(a,l,this.getItems()):c);return this.addShape(r,{type:"text",id:this.getElementId("item-"+a.id+"-"+n),name:"legend-item-"+n,attrs:f})},t.prototype.drawRadio=function(r,n,i,a,o){var s,l,u=n.style||{},c=(s=u.r)!==null&&s!==void 0?s:a/2,f=c*3.6/8,d=[o+c,a/2-c],v=d[0],g=d[1],x=[v+c,g+c],w=x[0],S=x[1],M=[v,S+c],R=M[0],I=M[1],P=[o,g+c],k=P[0],z=P[1],G=i.showRadio,J=$($({path:[["M",v,g],["A",c,c,0,0,1,w,S],["L",w-f,S],["L",w,S],["A",c,c,0,0,1,R,I],["L",R,I-f],["L",R,I],["A",c,c,0,0,1,k,z],["L",k+f,z],["L",k,z],["A",c,c,0,0,1,v,g],["L",v,g+f]],stroke:"#000000",fill:"#ffffff"},u),{opacity:G?(l=u==null?void 0:u.opacity)!==null&&l!==void 0?l:.45:0}),Z=this.addShape(r,{type:"path",id:this.getElementId("item-"+i.id+"-radio"),name:"legend-item-radio",attrs:J});return Z.set("tip",n.tip),Z},t.prototype.drawItem=function(r,n,i,a){var o="item-"+r.id,s=this.addGroup(a,{name:"legend-item-container",id:this.getElementId("item-container-"+o),delegateObject:{item:r,index:n}}),l=this.addGroup(s,{name:"legend-item",id:this.getElementId(o),delegateObject:{item:r,index:n}}),u=this.get("marker"),c=this.get("itemName"),f=this.get("itemValue"),d=this.get("itemBackground"),v=this.get("radio"),g=this.getLimitItemWidth(),x=0;if(u){var w=this.drawMarker(l,u,r,i),S=u.spacing,M=xt(r,["marker","spacing"]);Rn(M)&&(S=M),x=w.getBBox().maxX+S}if(c){var R=this.drawItemText(l,"name",c,r,i,x,n);g&&rC(!0,R,to(g-x,0,g)),x=R.getBBox().maxX+c.spacing}if(f){var I=this.drawItemText(l,"value",f,r,i,x,n);g&&(f.alignRight?(I.attr({textAlign:"right",x:g}),rC(!0,I,to(g-x,0,g),"head")):rC(!0,I,to(g-x,0,g))),x=I.getBBox().maxX+f.spacing}if(v&&this.drawRadio(l,v,r,i,x),d){var P=l.getBBox(),k=this.addShape(l,{type:"rect",name:"legend-item-background",id:this.getElementId(o+"-background"),attrs:$({x:0,y:0,width:P.width,height:i},d.style)});k.toBack()}return this.applyItemStates(r,l),l},t.prototype.adjustNavigation=function(r,n){var i=this,a=this.startX,o=this.startY,s=this.get("layout"),l=n.findAll(function(et){return et.get("name")==="legend-item"}),u=this.get("maxWidth"),c=this.get("maxHeight"),f=this.get("itemWidth"),d=this.get("itemSpacing"),v=this.getItemHeight(),g=Tr({},uP,this.get("pageNavigator")),x=this.drawNavigation(r,s,"00/00",g),w=x.getBBox(),S={x:a,y:o},M=1,R=0,I=0,P=0,k=this.get("itemMarginBottom");function z(et,at){var wt=et.getBBox(),Tt=f||wt.width,vt=at.x+Tt+d+w.width;return vt>u}if(s==="horizontal"){var G=this.get("maxRow")||1,J=v+(G===1?0:k),Z=u-d-w.width-w.minX;this.pageHeight=J*G,this.pageWidth=Z,ft(l,function(et){var at=et.getBBox(),wt=f||at.width;(R&&R<S.x+wt+d||z(et,S))&&(M===1&&(R=S.x+d,i.moveElementTo(x,{x:Z,y:S.y+v/2-w.height/2-w.minY})),M+=1,S.x=a,S.y+=J),i.moveElementTo(et,S),et.getParent().setClip({type:"rect",attrs:{x:S.x,y:S.y,width:wt+d,height:v}}),S.x+=wt+d})}else{ft(l,function(et){var at=et.getBBox();at.width>I&&(I=at.width)}),P=I,I+=d,u&&(I=Math.min(u,I),P=Math.min(u,P)),this.pageWidth=I,this.pageHeight=c-Math.max(w.height,v+k);var X=Math.floor(this.pageHeight/(v+k));ft(l,function(et,at){at!==0&&at%X===0&&(M+=1,S.x+=I,S.y=o),i.moveElementTo(et,S),et.getParent().setClip({type:"rect",attrs:{x:S.x,y:S.y,width:I,height:v}}),S.y+=v+k}),this.totalPagesCnt=M,this.moveElementTo(x,{x:a+P/2-w.width/2-w.minX,y:c-w.height-w.minY})}this.pageHeight&&this.pageWidth&&n.getParent().setClip({type:"rect",attrs:{x:this.startX,y:this.startY,width:this.pageWidth,height:this.pageHeight}}),s==="horizontal"&&this.get("maxRow")?this.totalPagesCnt=Math.ceil(M/this.get("maxRow")):this.totalPagesCnt=M,this.currentPageIndex>this.totalPagesCnt&&(this.currentPageIndex=1),this.updateNavigation(x),n.attr("matrix",this.getCurrentNavigationMatrix())},t.prototype.drawNavigation=function(r,n,i,a){var o={x:0,y:0},s=this.addGroup(r,{id:this.getElementId("navigation-group"),name:"legend-navigation"}),l=xt(a.marker,"style",{}),u=l.size,c=u===void 0?12:u,f=fi(l,["size"]),d=this.drawArrow(s,o,hP,n==="horizontal"?"up":"left",c,f);d.on("click",this.onNavigationBack);var v=d.getBBox();o.x+=v.width+2;var g=this.addShape(s,{type:"text",id:this.getElementId("navigation-text"),name:"navigation-text",attrs:$({x:o.x,y:o.y+c/2,text:i,textBaseline:"middle"},xt(a.text,"style"))}),x=g.getBBox();o.x+=x.width+2;var w=this.drawArrow(s,o,cP,n==="horizontal"?"down":"right",c,f);return w.on("click",this.onNavigationAfter),s},t.prototype.updateNavigation=function(r){var n=Tr({},uP,this.get("pageNavigator")),i=n.marker.style,a=i.fill,o=i.opacity,s=i.inactiveFill,l=i.inactiveOpacity,u=this.currentPageIndex+"/"+this.totalPagesCnt,c=r?r.getChildren()[1]:this.getElementByLocalId("navigation-text"),f=r?r.findById(this.getElementId(hP)):this.getElementByLocalId(hP),d=r?r.findById(this.getElementId(cP)):this.getElementByLocalId(cP);c.attr("text",u),f.attr("opacity",this.currentPageIndex===1?l:o),f.attr("fill",this.currentPageIndex===1?s:a),f.attr("cursor",this.currentPageIndex===1?"not-allowed":"pointer"),d.attr("opacity",this.currentPageIndex===this.totalPagesCnt?l:o),d.attr("fill",this.currentPageIndex===this.totalPagesCnt?s:a),d.attr("cursor",this.currentPageIndex===this.totalPagesCnt?"not-allowed":"pointer");var v=f.getBBox().maxX+2;c.attr("x",v),v+=c.getBBox().width+2,this.updateArrowPath(d,{x:v,y:0})},t.prototype.drawArrow=function(r,n,i,a,o,s){var l=n.x,u=n.y,c=this.addShape(r,{type:"path",id:this.getElementId(i),name:i,attrs:$({size:o,direction:a,path:[["M",l+o/2,u],["L",l,u+o],["L",l+o,u+o],["Z"]],cursor:"pointer"},s)});return c.attr("matrix",u_({x:l+o/2,y:u+o/2},cG[a])),c},t.prototype.updateArrowPath=function(r,n){var i=n.x,a=n.y,o=r.attr(),s=o.size,l=o.direction,u=u_({x:i+s/2,y:a+s/2},cG[l]);r.attr("path",[["M",i+s/2,a],["L",i,a+s],["L",i+s,a+s],["Z"]]),r.attr("matrix",u)},t.prototype.getCurrentNavigationMatrix=function(){var r=this,n=r.currentPageIndex,i=r.pageWidth,a=r.pageHeight,o=this.get("layout"),s=o==="horizontal"?{x:0,y:a*(1-n)}:{x:i*(1-n),y:0};return bN(s)},t.prototype.applyItemStates=function(r,n){var i=this.getItemStates(r),a=i.length>0;if(a){var o=n.getChildren(),s=this.get("itemStates");ft(o,function(l){var u=l.get("name"),c=u.split("-")[2],f=Nw(r,c,s);f&&(l.attr(f),c==="marker"&&!(l.get("isStroke")&&l.get("isFill"))&&(l.get("isStroke")&&l.attr("fill",null),l.get("isFill")&&l.attr("stroke",null)))})}},t.prototype.getLimitItemWidth=function(){var r=this.get("itemWidth"),n=this.get("maxItemWidth");return n?r&&(n=r<=n?r:n):r&&(n=r),n},t}(RN),SWt=1.4,hG=.4,Wrt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{type:"continue",min:0,max:100,value:null,colors:[],track:{},rail:{},label:{},handler:{},slidable:!0,tip:null,step:null,maxWidth:null,maxHeight:null,defaultCfg:{label:{align:"rail",spacing:5,formatter:null,style:{fontSize:12,fill:Mi.textColor,textBaseline:"middle",fontFamily:Mi.fontFamily}},handler:{size:10,style:{fill:"#fff",stroke:"#333"}},track:{},rail:{type:"color",size:20,defaultLength:100,style:{fill:"#DCDEE2"}},title:{spacing:5,style:{fill:Mi.textColor,fontSize:12,textAlign:"start",textBaseline:"top"}}}})},t.prototype.isSlider=function(){return!0},t.prototype.getValue=function(){return this.getCurrentValue()},t.prototype.getRange=function(){return{min:this.get("min"),max:this.get("max")}},t.prototype.setRange=function(r,n){this.update({min:r,max:n})},t.prototype.setValue=function(r){var n=this.getValue();this.set("value",r);var i=this.get("group");this.resetTrackClip(),this.get("slidable")&&this.resetHandlers(i),this.delegateEmit("valuechanged",{originValue:n,value:r})},t.prototype.initEvent=function(){var r=this.get("group");this.bindSliderEvent(r),this.bindRailEvent(r),this.bindTrackEvent(r)},t.prototype.drawLegendContent=function(r){this.drawRail(r),this.drawLabels(r),this.fixedElements(r),this.resetTrack(r),this.resetTrackClip(r),this.get("slidable")&&this.resetHandlers(r)},t.prototype.bindSliderEvent=function(r){this.bindHandlersEvent(r)},t.prototype.bindHandlersEvent=function(r){var n=this;r.on("legend-handler-min:drag",function(i){var a=n.getValueByCanvasPoint(i.x,i.y),o=n.getCurrentValue(),s=o[1];s<a&&(s=a),n.setValue([a,s])}),r.on("legend-handler-max:drag",function(i){var a=n.getValueByCanvasPoint(i.x,i.y),o=n.getCurrentValue(),s=o[0];s>a&&(s=a),n.setValue([s,a])})},t.prototype.bindRailEvent=function(r){},t.prototype.bindTrackEvent=function(r){var n=this,i=null;r.on("legend-track:dragstart",function(a){i={x:a.x,y:a.y}}),r.on("legend-track:drag",function(a){if(i){var o=n.getValueByCanvasPoint(i.x,i.y),s=n.getValueByCanvasPoint(a.x,a.y),l=n.getCurrentValue(),u=l[1]-l[0],c=n.getRange(),f=s-o;f<0?l[0]+f>c.min?n.setValue([l[0]+f,l[1]+f]):n.setValue([c.min,c.min+u]):f>0&&(f>0&&l[1]+f<c.max?n.setValue([l[0]+f,l[1]+f]):n.setValue([c.max-u,c.max])),i={x:a.x,y:a.y}}}),r.on("legend-track:dragend",function(a){i=null})},t.prototype.drawLabels=function(r){this.drawLabel("min",r),this.drawLabel("max",r)},t.prototype.drawLabel=function(r,n){var i=this.get("label"),a=i.style,o=i.align,s=i.formatter,l=this.get(r),u=this.getLabelAlignAttrs(r,o),c="label-"+r;this.addShape(n,{type:"text",id:this.getElementId(c),name:"legend-label-"+r,attrs:$($({x:0,y:0,text:Rr(s)?s(l):l},a),u)})},t.prototype.getLabelAlignAttrs=function(r,n){var i=this.isVertical(),a="center",o="middle";return i?(a="start",n!=="rail"?r==="min"?o="top":o="bottom":o="top"):n!=="rail"?(o="top",r==="min"?a="start":a="end"):(a="start",o="middle"),{textAlign:a,textBaseline:o}},t.prototype.getRailPath=function(r,n,i,a){var o=this.get("rail"),s=o.size,l=o.defaultLength,u=o.type,c=this.isVertical(),f=l,d=i,v=a;d||(d=c?s:f),v||(v=c?f:s);var g=[];return u==="color"?(g.push(["M",r,n]),g.push(["L",r+d,n]),g.push(["L",r+d,n+v]),g.push(["L",r,n+v]),g.push(["Z"])):(g.push(["M",r+d,n]),g.push(["L",r+d,n+v]),g.push(["L",r,n+v]),g.push(["Z"])),g},t.prototype.drawRail=function(r){var n=this.get("rail"),i=n.style;this.addShape(r,{type:"path",id:this.getElementId("rail"),name:"legend-rail",attrs:$({path:this.getRailPath(0,0)},i)})},t.prototype.getTrackColor=function(r){var n=r.length;if(!n)return null;if(n===1)return r[0];var i;this.isVertical()?i="l(90)":i="l(0)";for(var a=0;a<n;a++){var o=a/(n-1);i+=" "+o+":"+r[a]}return i},t.prototype.getTrackPath=function(r){var n=this.getRailShape(r),i=n.attr("path");return bl(i)},t.prototype.getClipTrackAttrs=function(r){var n=this.getCurrentValue(),i=n[0],a=n[1],o=this.getRailBBox(r),s=this.getPointByValue(i,r),l=this.getPointByValue(a,r),u=this.isVertical(),c,f,d,v;return u?(c=o.minX,f=s.y,d=o.width,v=l.y-s.y):(c=s.x,f=o.minY,d=l.x-s.x,v=o.height),{x:c,y:f,width:d,height:v}},t.prototype.getTrackAttrs=function(r){var n=this.get("track"),i=this.get("colors"),a=this.getTrackPath(r);return Qi({path:a,fill:this.getTrackColor(i)},n.style)},t.prototype.resetTrackClip=function(r){var n=r||this.get("group"),i=this.getElementId("track"),a=n.findById(i),o=a.getClip(),s=this.getClipTrackAttrs(r);o?o.attr(s):a.setClip({type:"rect",attrs:s})},t.prototype.resetTrack=function(r){var n=this.getElementId("track"),i=r.findById(n),a=this.getTrackAttrs(r);i?i.attr(a):this.addShape(r,{type:"path",id:n,draggable:this.get("slidable"),name:"legend-track",attrs:a})},t.prototype.getPointByValue=function(r,n){var i=this.getRange(),a=i.min,o=i.max,s=(r-a)/(o-a),l=this.getRailBBox(n),u=this.isVertical(),c={x:0,y:0};return u?(c.x=l.minX+l.width/2,c.y=Gy(l.minY,l.maxY,s)):(c.x=Gy(l.minX,l.maxX,s),c.y=l.minY+l.height/2),c},t.prototype.getRailShape=function(r){var n=r||this.get("group");return n.findById(this.getElementId("rail"))},t.prototype.getRailBBox=function(r){var n=this.getRailShape(r),i=n.getBBox();return i},t.prototype.getRailCanvasBBox=function(){var r=this.get("group"),n=r.findById(this.getElementId("rail")),i=n.getCanvasBBox();return i},t.prototype.isVertical=function(){return this.get("layout")==="vertical"},t.prototype.getValueByCanvasPoint=function(r,n){var i=this.getRange(),a=i.min,o=i.max,s=this.getRailCanvasBBox(),l=this.isVertical(),u=this.get("step"),c;l?c=(n-s.minY)/s.height:c=(r-s.minX)/s.width;var f=Gy(a,o,c);if(u){var d=Math.round((f-a)/u);f=a+d*u}return f>o&&(f=o),f<a&&(f=a),f},t.prototype.getCurrentValue=function(){var r=this.get("value");if(!r){var n=this.get("values");return n?[Math.max(Math.min.apply(Math,Jy(n,[this.get("max")])),this.get("min")),Math.min(Math.max.apply(Math,Jy(n,[this.get("min")])),this.get("max"))]:[this.get("min"),this.get("max")]}return r},t.prototype.resetHandlers=function(r){var n=this.getCurrentValue(),i=n[0],a=n[1];this.resetHandler(r,"min",i),this.resetHandler(r,"max",a)},t.prototype.getHandlerPath=function(r,n){var i=this.isVertical(),a=[],o=r.size,s=n.x,l=n.y,u=o*SWt,c=o/2,f=o/6;if(i){var d=s+u*hG;a.push(["M",s,l]),a.push(["L",d,l+c]),a.push(["L",s+u,l+c]),a.push(["L",s+u,l-c]),a.push(["L",d,l-c]),a.push(["Z"]),a.push(["M",d,l+f]),a.push(["L",s+u-2,l+f]),a.push(["M",d,l-f]),a.push(["L",s+u-2,l-f])}else{var v=l+u*hG;a.push(["M",s,l]),a.push(["L",s-c,v]),a.push(["L",s-c,l+u]),a.push(["L",s+c,l+u]),a.push(["L",s+c,v]),a.push(["Z"]),a.push(["M",s-f,v]),a.push(["L",s-f,l+u-2]),a.push(["M",s+f,v]),a.push(["L",s+f,l+u-2])}return a},t.prototype.resetHandler=function(r,n,i){var a=this.getPointByValue(i,r),o=this.get("handler"),s=this.getHandlerPath(o,a),l=this.getElementId("handler-"+n),u=r.findById(l),c=this.isVertical();u?u.attr("path",s):this.addShape(r,{type:"path",name:"legend-handler-"+n,draggable:!0,id:l,attrs:$($({path:s},o.style),{cursor:c?"ns-resize":"ew-resize"})})},t.prototype.fixedElements=function(r){var n=r.findById(this.getElementId("rail")),i=r.findById(this.getElementId("label-min")),a=r.findById(this.getElementId("label-max")),o=this.getDrawPoint();this.isVertical()?this.fixedVertail(i,a,n,o):this.fixedHorizontal(i,a,n,o)},t.prototype.fitRailLength=function(r,n,i,a){var o=this.isVertical(),s=o?"height":"width",l=this.get("label"),u=l.align,c=l.spacing,f=this.get("max"+E0(s));if(f){var d=u==="rail"?i[s]+r[s]+n[s]+c*2:i[s],v=d-f;v>0&&this.changeRailLength(a,s,i[s]-v)}},t.prototype.changeRailLength=function(r,n,i){var a=r.getBBox(),o;n==="height"?o=this.getRailPath(a.x,a.y,a.width,i):o=this.getRailPath(a.x,a.y,i,a.height),r.attr("path",o)},t.prototype.changeRailPosition=function(r,n,i){var a=r.getBBox(),o=this.getRailPath(n,i,a.width,a.height);r.attr("path",o)},t.prototype.fixedHorizontal=function(r,n,i,a){var o=this.get("label"),s=o.align,l=o.spacing,u=i.getBBox(),c=r.getBBox(),f=n.getBBox(),d=u.height;this.fitRailLength(c,f,u,i),u=i.getBBox(),s==="rail"?(r.attr({x:a.x,y:a.y+d/2}),this.changeRailPosition(i,a.x+c.width+l,a.y),n.attr({x:a.x+c.width+u.width+l*2,y:a.y+d/2})):s==="top"?(r.attr({x:a.x,y:a.y}),n.attr({x:a.x+u.width,y:a.y}),this.changeRailPosition(i,a.x,a.y+c.height+l)):(this.changeRailPosition(i,a.x,a.y),r.attr({x:a.x,y:a.y+u.height+l}),n.attr({x:a.x+u.width,y:a.y+u.height+l}))},t.prototype.fixedVertail=function(r,n,i,a){var o=this.get("label"),s=o.align,l=o.spacing,u=i.getBBox(),c=r.getBBox(),f=n.getBBox();if(this.fitRailLength(c,f,u,i),u=i.getBBox(),s==="rail")r.attr({x:a.x,y:a.y}),this.changeRailPosition(i,a.x,a.y+c.height+l),n.attr({x:a.x,y:a.y+c.height+u.height+l*2});else if(s==="right")r.attr({x:a.x+u.width+l,y:a.y}),this.changeRailPosition(i,a.x,a.y),n.attr({x:a.x+u.width+l,y:a.y+u.height});else{var d=Math.max(c.width,f.width);r.attr({x:a.x,y:a.y}),this.changeRailPosition(i,a.x+d+l,a.y),n.attr({x:a.x,y:a.y+u.height})}},t}(RN);const TWt=Object.freeze(Object.defineProperty({__proto__:null,Base:RN,Category:Grt,Continuous:Wrt},Symbol.toStringTag,{value:"Module"}));var Eg="g2-tooltip",wg="g2-tooltip-title",VC="g2-tooltip-list",h3="g2-tooltip-list-item",f3="g2-tooltip-marker",d3="g2-tooltip-value",Xrt="g2-tooltip-name",IN="g2-tooltip-crosshair-x",LN="g2-tooltip-crosshair-y";const jrt=Object.freeze(Object.defineProperty({__proto__:null,CONTAINER_CLASS:Eg,CROSSHAIR_X:IN,CROSSHAIR_Y:LN,LIST_CLASS:VC,LIST_ITEM_CLASS:h3,MARKER_CLASS:f3,NAME_CLASS:Xrt,TITLE_CLASS:wg,VALUE_CLASS:d3},Symbol.toStringTag,{value:"Module"}));var Pp;const AWt=(Pp={},Pp[""+Eg]={position:"absolute",visibility:"visible",zIndex:8,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)",backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"0px 0px 10px #aeaeae",borderRadius:"3px",color:"rgb(87, 87, 87)",fontSize:"12px",fontFamily:Mi.fontFamily,lineHeight:"20px",padding:"10px 10px 6px 10px"},Pp[""+wg]={marginBottom:"4px"},Pp[""+VC]={margin:"0px",listStyleType:"none",padding:"0px"},Pp[""+h3]={listStyleType:"none",marginBottom:"4px"},Pp[""+f3]={width:"8px",height:"8px",borderRadius:"50%",display:"inline-block",marginRight:"8px"},Pp[""+d3]={display:"inline-block",float:"right",marginLeft:"30px"},Pp[""+IN]={position:"absolute",width:"1px",backgroundColor:"rgba(0, 0, 0, 0.25)"},Pp[""+LN]={position:"absolute",height:"1px",backgroundColor:"rgba(0, 0, 0, 0.25)"},Pp);function MWt(e,t,r,n,i){var a={left:e<i.x,right:e+r>i.x+i.width,top:t<i.y,bottom:t+n>i.y+i.height};return a}function RWt(e,t,r,n,i,a){var o=e,s=t;switch(a){case"left":o=e-n-r,s=t-i/2;break;case"right":o=e+r,s=t-i/2;break;case"top":o=e-n/2,s=t-i-r;break;case"bottom":o=e-n/2,s=t+r;break;default:o=e+r,s=t-i-r;break}return{x:o,y:s}}function IWt(e,t,r,n,i,a,o){var s=RWt(e,t,r,n,i,a);if(o){var l=MWt(s.x,s.y,n,i,o);a==="auto"?(l.right&&(s.x=Math.max(0,e-n-r)),l.top&&(s.y=Math.max(0,t-i-r))):a==="top"||a==="bottom"?(l.left&&(s.x=o.x),l.right&&(s.x=o.x+o.width-n),a==="top"&&l.top&&(s.y=t+r),a==="bottom"&&l.bottom&&(s.y=t-i-r)):(l.top&&(s.y=o.y),l.bottom&&(s.y=o.y+o.height-i),a==="left"&&l.left&&(s.x=e+r),a==="right"&&l.right&&(s.x=e-n-r))}return s}function LWt(e,t){var r=!1;return ft(t,function(n){if(ev(e,n))return r=!0,!1}),r}var Yrt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{name:"tooltip",type:"html",x:0,y:0,items:[],customContent:null,containerTpl:'<div class="'+Eg+'"><div class="'+wg+'"></div><ul class="'+VC+'"></ul></div>',itemTpl:'<li class="'+h3+`" data-index={index}>
          <span class="`+f3+`" style="background:{color}"></span>
          <span class="`+Xrt+`">{name}</span>:
          <span class="`+d3+`">{value}</span>
        </li>`,xCrosshairTpl:'<div class="'+IN+'"></div>',yCrosshairTpl:'<div class="'+LN+'"></div>',title:null,showTitle:!0,region:null,crosshairsRegion:null,containerClassName:Eg,crosshairs:null,offset:10,position:"right",domStyles:null,defaultStyles:AWt})},t.prototype.render=function(){this.get("customContent")?this.renderCustomContent():(this.resetTitle(),this.renderItems()),this.resetPosition()},t.prototype.clear=function(){this.clearCrosshairs(),this.setTitle(""),this.clearItemDoms()},t.prototype.show=function(){var r=this.getContainer();!r||this.destroyed||(this.set("visible",!0),za(r,{visibility:"visible"}),this.setCrossHairsVisible(!0))},t.prototype.hide=function(){var r=this.getContainer();!r||this.destroyed||(this.set("visible",!1),za(r,{visibility:"hidden"}),this.setCrossHairsVisible(!1))},t.prototype.getLocation=function(){return{x:this.get("x"),y:this.get("y")}},t.prototype.setLocation=function(r){this.set("x",r.x),this.set("y",r.y),this.resetPosition()},t.prototype.setCrossHairsVisible=function(r){var n=r?"":"none",i=this.get("xCrosshairDom"),a=this.get("yCrosshairDom");i&&za(i,{display:n}),a&&za(a,{display:n})},t.prototype.initContainer=function(){if(e.prototype.initContainer.call(this),this.get("customContent")){this.get("container")&&this.get("container").remove();var r=this.getHtmlContentNode();this.get("parent").appendChild(r),this.set("container",r),this.resetStyles(),this.applyStyles()}},t.prototype.updateInner=function(r){this.get("customContent")?this.renderCustomContent():(LWt(r,["title","showTitle"])&&this.resetTitle(),ev(r,"items")&&this.renderItems()),e.prototype.updateInner.call(this,r)},t.prototype.initDom=function(){this.cacheDoms()},t.prototype.removeDom=function(){e.prototype.removeDom.call(this),this.clearCrosshairs()},t.prototype.resetPosition=function(){var r=this.get("x"),n=this.get("y"),i=this.get("offset"),a=this.getOffset(),o=a.offsetX,s=a.offsetY,l=this.get("position"),u=this.get("region"),c=this.getContainer(),f=this.getBBox(),d=f.width,v=f.height,g;u&&(g=UC(u));var x=IWt(r,n,i,d,v,l,g);za(c,{left:Hc(x.x+o),top:Hc(x.y+s)}),this.resetCrosshairs()},t.prototype.renderCustomContent=function(){var r=this.getHtmlContentNode(),n=this.get("parent"),i=this.get("container");i&&i.parentNode===n?n.replaceChild(r,i):n.appendChild(r),this.set("container",r),this.resetStyles(),this.applyStyles()},t.prototype.getHtmlContentNode=function(){var r,n=this.get("customContent");if(n){var i=n(this.get("title"),this.get("items"));eN(i)?r=i:r=hg(i)}return r},t.prototype.cacheDoms=function(){var r=this.getContainer(),n=r.getElementsByClassName(wg)[0],i=r.getElementsByClassName(VC)[0];this.set("titleDom",n),this.set("listDom",i)},t.prototype.resetTitle=function(){var r=this.get("title"),n=this.get("showTitle");n&&r?this.setTitle(r):this.setTitle("")},t.prototype.setTitle=function(r){var n=this.get("titleDom");n&&(n.innerText=r)},t.prototype.resetCrosshairs=function(){var r=this.get("crosshairsRegion"),n=this.get("crosshairs");if(!r||!n)this.clearCrosshairs();else{var i=UC(r),a=this.get("xCrosshairDom"),o=this.get("yCrosshairDom");n==="x"?(this.resetCrosshair("x",i),o&&(o.remove(),this.set("yCrosshairDom",null))):n==="y"?(this.resetCrosshair("y",i),a&&(a.remove(),this.set("xCrosshairDom",null))):(this.resetCrosshair("x",i),this.resetCrosshair("y",i)),this.setCrossHairsVisible(this.get("visible"))}},t.prototype.resetCrosshair=function(r,n){var i=this.checkCrosshair(r),a=this.get(r);r==="x"?za(i,{left:Hc(a),top:Hc(n.y),height:Hc(n.height)}):za(i,{top:Hc(a),left:Hc(n.x),width:Hc(n.width)})},t.prototype.checkCrosshair=function(r){var n=r+"CrosshairDom",i=r+"CrosshairTpl",a="CROSSHAIR_"+r.toUpperCase(),o=jrt[a],s=this.get(n),l=this.get("parent");return s||(s=hg(this.get(i)),this.applyStyle(o,s),l.appendChild(s),this.set(n,s)),s},t.prototype.renderItems=function(){this.clearItemDoms();var r=this.get("items"),n=this.get("itemTpl"),i=this.get("listDom");i&&(ft(r,function(a){var o=Zm.toCSSGradient(a.color),s=$($({},a),{color:o}),l=Tb(n,s),u=hg(l);i.appendChild(u)}),this.applyChildrenStyles(i,this.get("domStyles")))},t.prototype.clearItemDoms=function(){this.get("listDom")&&wN(this.get("listDom"))},t.prototype.clearCrosshairs=function(){var r=this.get("xCrosshairDom"),n=this.get("yCrosshairDom");r&&r.remove(),n&&n.remove(),this.set("xCrosshairDom",null),this.set("yCrosshairDom",null)},t}(c3);const OWt=Object.freeze(Object.defineProperty({__proto__:null,Html:Yrt},Symbol.toStringTag,{value:"Module"}));var PWt={opacity:0},DWt={stroke:"#C5C5C5",strokeOpacity:.85},FWt={fill:"#CACED4",opacity:.85};function BWt(e,t,r,n){var i=[],a=!!n,o,s,l,u,c,f,d;if(a){l=n[0],u=n[1];for(var v=0,g=e.length;v<g;v+=1){var x=e[v];l=$l([0,0],l,x),u=Hl([0,0],u,x)}}for(var v=0,w=e.length;v<w;v+=1){var x=e[v];if(v===0&&!r)d=x;else if(v===w-1&&!r)f=x,i.push(d),i.push(f);else{var S=[v?v-1:w-1,v-1][r?0:1];o=e[S],s=e[r?(v+1)%w:v+1];var M=[0,0];M=fg(M,s,o),M=oc(M,M,t);var R=Xx(x,o),I=Xx(x,s),P=R+I;P!==0&&(R/=P,I/=P);var k=oc([0,0],M,-R),z=oc([0,0],M,I);f=Vl([0,0],x,k),c=Vl([0,0],x,z),c=$l([0,0],c,Hl([0,0],s,x)),c=Hl([0,0],c,$l([0,0],s,x)),k=fg([0,0],c,x),k=oc([0,0],k,-R/I),f=Vl([0,0],x,k),f=$l([0,0],f,Hl([0,0],o,x)),f=Hl([0,0],f,$l([0,0],o,x)),z=fg([0,0],x,f),z=oc([0,0],z,I/R),c=Vl([0,0],x,z),a&&(f=Hl([0,0],f,l),f=$l([0,0],f,u),c=Hl([0,0],c,l),c=$l([0,0],c,u)),i.push(d),i.push(f),d=c}}return r&&i.push(i.shift()),i}function NWt(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=[[0,0],[1,1]]);for(var n=!!t,i=[],a=0,o=e.length;a<o;a+=2)i.push([e[a],e[a+1]]);for(var s=BWt(i,.4,n,r),l=i.length,u=[],c,f,d,a=0;a<l-1;a+=1)c=s[a*2],f=s[a*2+1],d=i[a+1],u.push(["C",c[0],c[1],f[0],f[1],d[0],d[1]]);return n&&(c=s[l],f=s[l+1],d=i[0],u.push(["C",c[0],c[1],f[0],f[1],d[0],d[1]])),u}function kWt(e){return fo(e,function(t,r){var n=r===0?"M":"L",i=t[0],a=t[1];return[n,i,a]})}function Zrt(e){return kWt(e)}function zWt(e){if(e.length<=2)return Zrt(e);var t=[];ft(e,function(o){Di(o,t.slice(t.length-2))||t.push(o[0],o[1])});var r=NWt(t,!1),n=Kc(e),i=n[0],a=n[1];return r.unshift(["M",i,a]),r}function UWt(e,t,r,n){n===void 0&&(n=!0);var i=new u2({values:e}),a=new l2({values:fo(e,function(s,l){return l})}),o=fo(e,function(s,l){return[a.scale(l)*t,r-i.scale(s)*r]});return n?zWt(o):Zrt(o)}function $Wt(e,t){var r=new u2({values:e}),n=r.max<0?r.max:Math.max(0,r.min);return t-r.scale(n)*t}function HWt(e,t,r,n){var i=Jy(e),a=$Wt(n,r);return i.push(["L",t,a]),i.push(["L",0,a]),i.push(["Z"]),i}var VWt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{name:"trend",x:0,y:0,width:200,height:16,smooth:!0,isArea:!1,data:[],backgroundStyle:PWt,lineStyle:DWt,areaStyle:FWt})},t.prototype.renderInner=function(r){var n=this.cfg,i=n.width,a=n.height,o=n.data,s=n.smooth,l=n.isArea,u=n.backgroundStyle,c=n.lineStyle,f=n.areaStyle;this.addShape(r,{id:this.getElementId("background"),type:"rect",attrs:$({x:0,y:0,width:i,height:a},u)});var d=UWt(o,i,a,s);if(this.addShape(r,{id:this.getElementId("line"),type:"path",attrs:$({path:d},c)}),l){var v=HWt(d,i,a,o);this.addShape(r,{id:this.getElementId("area"),type:"path",attrs:$({path:v},f)})}},t.prototype.applyOffset=function(){var r=this.cfg,n=r.x,i=r.y;this.moveElementTo(this.get("group"),{x:n,y:i})},t}(Yl),qrt={fill:"#F7F7F7",stroke:"#BFBFBF",radius:2,opacity:1,cursor:"ew-resize",highLightFill:"#FFF"},fG=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{name:"handler",x:0,y:0,width:10,height:24,style:qrt})},t.prototype.renderInner=function(r){var n=this.cfg,i=n.width,a=n.height,o=n.style,s=o.fill,l=o.stroke,u=o.radius,c=o.opacity,f=o.cursor;this.addShape(r,{type:"rect",id:this.getElementId("background"),attrs:{x:0,y:0,width:i,height:a,fill:s,stroke:l,radius:u,opacity:c,cursor:f}});var d=1/3*i,v=2/3*i,g=1/4*a,x=3/4*a;this.addShape(r,{id:this.getElementId("line-left"),type:"line",attrs:{x1:d,y1:g,x2:d,y2:x,stroke:l,cursor:f}}),this.addShape(r,{id:this.getElementId("line-right"),type:"line",attrs:{x1:v,y1:g,x2:v,y2:x,stroke:l,cursor:f}})},t.prototype.applyOffset=function(){this.moveElementTo(this.get("group"),{x:this.get("x"),y:this.get("y")})},t.prototype.initEvent=function(){this.bindEvents()},t.prototype.bindEvents=function(){var r=this;this.get("group").on("mouseenter",function(){var n=r.get("style").highLightFill;r.getElementByLocalId("background").attr("fill",n),r.draw()}),this.get("group").on("mouseleave",function(){var n=r.get("style").fill;r.getElementByLocalId("background").attr("fill",n),r.draw()})},t.prototype.draw=function(){var r=this.get("container").get("canvas");r&&r.draw()},t}(Yl),GWt={fill:"#416180",opacity:.05},WWt={fill:"#5B8FF9",opacity:.15,cursor:"move"},gM=10,XWt={width:gM,height:24},jWt={textBaseline:"middle",fill:"#000",opacity:.45},YWt="sliderchange",Krt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onMouseDown=function(n){return function(i){r.currentTarget=n;var a=i.originalEvent;a.stopPropagation(),a.preventDefault(),r.prevX=xt(a,"touches.0.pageX",a.pageX),r.prevY=xt(a,"touches.0.pageY",a.pageY);var o=r.getContainerDOM();o.addEventListener("mousemove",r.onMouseMove),o.addEventListener("mouseup",r.onMouseUp),o.addEventListener("mouseleave",r.onMouseUp),o.addEventListener("touchmove",r.onMouseMove),o.addEventListener("touchend",r.onMouseUp),o.addEventListener("touchcancel",r.onMouseUp)}},r.onMouseMove=function(n){var i=r.cfg.width,a=[r.get("start"),r.get("end")];n.stopPropagation(),n.preventDefault();var o=xt(n,"touches.0.pageX",n.pageX),s=xt(n,"touches.0.pageY",n.pageY),l=o-r.prevX,u=r.adjustOffsetRange(l/i);r.updateStartEnd(u),r.updateUI(r.getElementByLocalId("foreground"),r.getElementByLocalId("minText"),r.getElementByLocalId("maxText")),r.prevX=o,r.prevY=s,r.draw(),r.emit(YWt,[r.get("start"),r.get("end")].sort()),r.delegateEmit("valuechanged",{originValue:a,value:[r.get("start"),r.get("end")]})},r.onMouseUp=function(){r.currentTarget&&(r.currentTarget=void 0);var n=r.getContainerDOM();n&&(n.removeEventListener("mousemove",r.onMouseMove),n.removeEventListener("mouseup",r.onMouseUp),n.removeEventListener("mouseleave",r.onMouseUp),n.removeEventListener("touchmove",r.onMouseMove),n.removeEventListener("touchend",r.onMouseUp),n.removeEventListener("touchcancel",r.onMouseUp))},r}return t.prototype.setRange=function(r,n){this.set("minLimit",r),this.set("maxLimit",n);var i=this.get("start"),a=this.get("end"),o=to(i,r,n),s=to(a,r,n);!this.get("isInit")&&(i!==o||a!==s)&&this.setValue([o,s])},t.prototype.getRange=function(){return{min:this.get("minLimit")||0,max:this.get("maxLimit")||1}},t.prototype.setValue=function(r){var n=this.getRange();if(Fe(r)&&r.length===2){var i=[this.get("start"),this.get("end")];this.update({start:to(r[0],n.min,n.max),end:to(r[1],n.min,n.max)}),this.get("updateAutoRender")||this.render(),this.delegateEmit("valuechanged",{originValue:i,value:r})}},t.prototype.getValue=function(){return[this.get("start"),this.get("end")]},t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{name:"slider",x:0,y:0,width:100,height:16,backgroundStyle:{},foregroundStyle:{},handlerStyle:{},textStyle:{},defaultCfg:{backgroundStyle:GWt,foregroundStyle:WWt,handlerStyle:XWt,textStyle:jWt}})},t.prototype.update=function(r){var n=r.start,i=r.end,a=$({},r);ze(n)||(a.start=to(n,0,1)),ze(i)||(a.end=to(i,0,1)),e.prototype.update.call(this,a),this.minHandler=this.getChildComponentById(this.getElementId("minHandler")),this.maxHandler=this.getChildComponentById(this.getElementId("maxHandler")),this.trend=this.getChildComponentById(this.getElementId("trend"))},t.prototype.init=function(){this.set("start",to(this.get("start"),0,1)),this.set("end",to(this.get("end"),0,1)),e.prototype.init.call(this)},t.prototype.render=function(){e.prototype.render.call(this),this.updateUI(this.getElementByLocalId("foreground"),this.getElementByLocalId("minText"),this.getElementByLocalId("maxText"))},t.prototype.renderInner=function(r){var n=this.cfg;n.start,n.end;var i=n.width,a=n.height,o=n.trendCfg,s=o===void 0?{}:o,l=n.minText,u=n.maxText,c=n.backgroundStyle,f=c===void 0?{}:c,d=n.foregroundStyle,v=d===void 0?{}:d,g=n.textStyle,x=g===void 0?{}:g,w=Tr({},qrt,this.cfg.handlerStyle);il(xt(s,"data"))&&(this.trend=this.addComponent(r,$({component:VWt,id:this.getElementId("trend"),x:0,y:0,width:i,height:a},s))),this.addShape(r,{id:this.getElementId("background"),type:"rect",attrs:$({x:0,y:0,width:i,height:a},f)}),this.addShape(r,{id:this.getElementId("minText"),type:"text",attrs:$({y:a/2,textAlign:"right",text:l,silent:!1},x)}),this.addShape(r,{id:this.getElementId("maxText"),type:"text",attrs:$({y:a/2,textAlign:"left",text:u,silent:!1},x)}),this.addShape(r,{id:this.getElementId("foreground"),name:"foreground",type:"rect",attrs:$({y:0,height:a},v)});var S=xt(w,"width",gM),M=xt(w,"height",24);this.minHandler=this.addComponent(r,{component:fG,id:this.getElementId("minHandler"),name:"handler-min",x:0,y:(a-M)/2,width:S,height:M,cursor:"ew-resize",style:w}),this.maxHandler=this.addComponent(r,{component:fG,id:this.getElementId("maxHandler"),name:"handler-max",x:0,y:(a-M)/2,width:S,height:M,cursor:"ew-resize",style:w})},t.prototype.applyOffset=function(){this.moveElementTo(this.get("group"),{x:this.get("x"),y:this.get("y")})},t.prototype.initEvent=function(){this.bindEvents()},t.prototype.updateUI=function(r,n,i){var a=this.cfg,o=a.start,s=a.end,l=a.width,u=a.minText,c=a.maxText,f=a.handlerStyle,d=a.height,v=o*l,g=s*l;this.trend&&(this.trend.update({width:l,height:d}),this.get("updateAutoRender")||this.trend.render()),r.attr("x",v),r.attr("width",g-v);var x=xt(f,"width",gM);n.attr("text",u),i.attr("text",c);var w=this._dodgeText([v,g],n,i),S=w[0],M=w[1];this.minHandler&&(this.minHandler.update({x:v-x/2}),this.get("updateAutoRender")||this.minHandler.render()),ft(S,function(R,I){return n.attr(I,R)}),this.maxHandler&&(this.maxHandler.update({x:g-x/2}),this.get("updateAutoRender")||this.maxHandler.render()),ft(M,function(R,I){return i.attr(I,R)})},t.prototype.bindEvents=function(){var r=this.get("group");r.on("handler-min:mousedown",this.onMouseDown("minHandler")),r.on("handler-min:touchstart",this.onMouseDown("minHandler")),r.on("handler-max:mousedown",this.onMouseDown("maxHandler")),r.on("handler-max:touchstart",this.onMouseDown("maxHandler"));var n=r.findById(this.getElementId("foreground"));n.on("mousedown",this.onMouseDown("foreground")),n.on("touchstart",this.onMouseDown("foreground"))},t.prototype.adjustOffsetRange=function(r){var n=this.cfg,i=n.start,a=n.end;switch(this.currentTarget){case"minHandler":{var o=0-i,s=1-i;return Math.min(s,Math.max(o,r))}case"maxHandler":{var o=0-a,s=1-a;return Math.min(s,Math.max(o,r))}case"foreground":{var o=0-i,s=1-a;return Math.min(s,Math.max(o,r))}}},t.prototype.updateStartEnd=function(r){var n=this.cfg,i=n.start,a=n.end;switch(this.currentTarget){case"minHandler":i+=r;break;case"maxHandler":a+=r;break;case"foreground":i+=r,a+=r;break}this.set("start",i),this.set("end",a)},t.prototype._dodgeText=function(r,n,i){var a,o,s=this.cfg,l=s.handlerStyle,u=s.width,c=2,f=xt(l,"width",gM),d=r[0],v=r[1],g=!1;d>v&&(a=[v,d],d=a[0],v=a[1],o=[i,n],n=o[0],i=o[1],g=!0);var x=n.getBBox(),w=i.getBBox(),S=x.width>d-c?{x:d+f/2+c,textAlign:"left"}:{x:d-f/2-c,textAlign:"right"},M=w.width>u-v-c?{x:v-f/2-c,textAlign:"right"}:{x:v+f/2+c,textAlign:"left"};return g?[M,S]:[S,M]},t.prototype.draw=function(){var r=this.get("container"),n=r&&r.get("canvas");n&&n.draw()},t.prototype.getContainerDOM=function(){var r=this.get("container"),n=r&&r.get("canvas");return n&&n.get("container")},t}(Yl),ZWt={trackColor:"rgba(0,0,0,0)",thumbColor:"rgba(0,0,0,0.15)",size:8,lineCap:"round"},fP={default:ZWt,hover:{thumbColor:"rgba(0,0,0,0.2)"}},Qrt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.clearEvents=ag,r.onStartEvent=function(n){return function(i){r.isMobile=n,i.originalEvent.preventDefault();var a=n?xt(i.originalEvent,"touches.0.clientX"):i.clientX,o=n?xt(i.originalEvent,"touches.0.clientY"):i.clientY;r.startPos=r.cfg.isHorizontal?a:o,r.bindLaterEvent()}},r.bindLaterEvent=function(){var n=r.getContainerDOM(),i=[];r.isMobile?i=[V1(n,"touchmove",r.onMouseMove),V1(n,"touchend",r.onMouseUp),V1(n,"touchcancel",r.onMouseUp)]:i=[V1(n,"mousemove",r.onMouseMove),V1(n,"mouseup",r.onMouseUp),V1(n,"mouseleave",r.onMouseUp)],r.clearEvents=function(){i.forEach(function(a){a.remove()})}},r.onMouseMove=function(n){var i=r.cfg,a=i.isHorizontal,o=i.thumbOffset;n.preventDefault();var s=r.isMobile?xt(n,"touches.0.clientX"):n.clientX,l=r.isMobile?xt(n,"touches.0.clientY"):n.clientY,u=a?s:l,c=u-r.startPos;r.startPos=u,r.updateThumbOffset(o+c)},r.onMouseUp=function(n){n.preventDefault(),r.clearEvents()},r.onTrackClick=function(n){var i=r.cfg,a=i.isHorizontal,o=i.x,s=i.y,l=i.thumbLen,u=r.getContainerDOM(),c=u.getBoundingClientRect(),f=n.clientX,d=n.clientY,v=a?f-c.left-o-l/2:d-c.top-s-l/2,g=r.validateRange(v);r.updateThumbOffset(g)},r.onThumbMouseOver=function(){var n=r.cfg.theme.hover.thumbColor;r.getElementByLocalId("thumb").attr("stroke",n),r.draw()},r.onThumbMouseOut=function(){var n=r.cfg.theme.default.thumbColor;r.getElementByLocalId("thumb").attr("stroke",n),r.draw()},r}return t.prototype.setRange=function(r,n){this.set("minLimit",r),this.set("maxLimit",n);var i=this.getValue(),a=to(i,r,n);i!==a&&!this.get("isInit")&&this.setValue(a)},t.prototype.getRange=function(){var r=this.get("minLimit")||0,n=this.get("maxLimit")||1;return{min:r,max:n}},t.prototype.setValue=function(r){var n=this.getRange(),i=this.getValue();this.update({thumbOffset:(this.get("trackLen")-this.get("thumbLen"))*to(r,n.min,n.max)}),this.delegateEmit("valuechange",{originalValue:i,value:this.getValue()})},t.prototype.getValue=function(){return to(this.get("thumbOffset")/(this.get("trackLen")-this.get("thumbLen")),0,1)},t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return $($({},r),{name:"scrollbar",isHorizontal:!0,minThumbLen:20,thumbOffset:0,theme:fP})},t.prototype.renderInner=function(r){this.renderTrackShape(r),this.renderThumbShape(r)},t.prototype.applyOffset=function(){this.moveElementTo(this.get("group"),{x:this.get("x"),y:this.get("y")})},t.prototype.initEvent=function(){this.bindEvents()},t.prototype.renderTrackShape=function(r){var n=this.cfg,i=n.trackLen,a=n.theme,o=a===void 0?{default:{}}:a,s=Tr({},fP,o).default,l=s.lineCap,u=s.trackColor,c=s.size,f=xt(this.cfg,"size",c),d=this.get("isHorizontal")?{x1:0+f/2,y1:f/2,x2:i-f/2,y2:f/2,lineWidth:f,stroke:u,lineCap:l}:{x1:f/2,y1:0+f/2,x2:f/2,y2:i-f/2,lineWidth:f,stroke:u,lineCap:l};return this.addShape(r,{id:this.getElementId("track"),name:"track",type:"line",attrs:d})},t.prototype.renderThumbShape=function(r){var n=this.cfg,i=n.thumbOffset,a=n.thumbLen,o=n.theme,s=Tr({},fP,o).default,l=s.size,u=s.lineCap,c=s.thumbColor,f=xt(this.cfg,"size",l),d=this.get("isHorizontal")?{x1:i+f/2,y1:f/2,x2:i+a-f/2,y2:f/2,lineWidth:f,stroke:c,lineCap:u,cursor:"default"}:{x1:f/2,y1:i+f/2,x2:f/2,y2:i+a-f/2,lineWidth:f,stroke:c,lineCap:u,cursor:"default"};return this.addShape(r,{id:this.getElementId("thumb"),name:"thumb",type:"line",attrs:d})},t.prototype.bindEvents=function(){var r=this.get("group");r.on("mousedown",this.onStartEvent(!1)),r.on("mouseup",this.onMouseUp),r.on("touchstart",this.onStartEvent(!0)),r.on("touchend",this.onMouseUp);var n=r.findById(this.getElementId("track"));n.on("click",this.onTrackClick);var i=r.findById(this.getElementId("thumb"));i.on("mouseover",this.onThumbMouseOver),i.on("mouseout",this.onThumbMouseOut)},t.prototype.getContainerDOM=function(){var r=this.get("container"),n=r&&r.get("canvas");return n&&n.get("container")},t.prototype.validateRange=function(r){var n=this.cfg,i=n.thumbLen,a=n.trackLen,o=r;return r+i>a?o=a-i:r+i<i&&(o=0),o},t.prototype.draw=function(){var r=this.get("container"),n=r&&r.get("canvas");n&&n.draw()},t.prototype.updateThumbOffset=function(r){var n=this.cfg,i=n.thumbOffset,a=n.isHorizontal,o=n.thumbLen,s=n.size,l=this.validateRange(r);if(l!==i){var u=this.getElementByLocalId("thumb");a?u.attr({x1:l+s/2,x2:l+o-s/2}):u.attr({y1:l+s/2,y2:l+o-s/2}),this.emitOffsetChange(l)}},t.prototype.emitOffsetChange=function(r){var n=this.cfg,i=n.thumbOffset,a=n.trackLen,o=n.thumbLen;this.cfg.thumbOffset=r,this.emit("scrollchange",{thumbOffset:r,ratio:to(r/(a-o),0,1)}),this.delegateEmit("valuechange",{originalValue:i,value:r})},t}(Yl);const sOe=Object.freeze(Object.defineProperty({__proto__:null,Annotation:Lrt,Axis:_Wt,Component:CN,Crosshair:NF,Grid:CWt,GroupComponent:Yl,HtmlComponent:c3,Legend:TWt,Scrollbar:Qrt,Slider:Krt,TOOLTIP_CSS_CONST:jrt,Tooltip:OWt,propagationDelegate:xN},Symbol.toStringTag,{value:"Module"}));var qWt=zrt,KWt=Urt,QWt=Vrt,JWt=Hrt,dG=Grt,tXt=Wrt,p3=Yrt;function eXt(e){if(cc(e))return null;var t=e[0].x,r=e[0].x,n=e[0].y,i=e[0].y;return ft(e,function(a){t=t>a.x?a.x:t,r=r<a.x?a.x:r,n=n>a.y?a.y:n,i=i<a.y?a.y:i}),{minX:t,maxX:r,minY:n,maxY:i,centerX:(t+r)/2,centerY:(n+i)/2}}function pG(e){return Array.from(new Set(e)).length===1}function vG(e){return(Wh(e)+nh(e))/2}function Ps(e,t,r,n){return{x:e+r*Math.cos(n),y:t+r*Math.sin(n)}}function qm(e,t,r,n,i,a){a===void 0&&(a=0);var o=Ps(e,t,r,n),s=Ps(e,t,r,i),l=Ps(e,t,a,n),u=Ps(e,t,a,i);if(i-n===Math.PI*2){var c=Ps(e,t,r,n+Math.PI),f=Ps(e,t,a,n+Math.PI),d=[["M",o.x,o.y],["A",r,r,0,1,1,c.x,c.y],["A",r,r,0,1,1,s.x,s.y],["M",l.x,l.y]];return a&&(d.push(["A",a,a,0,1,0,f.x,f.y]),d.push(["A",a,a,0,1,0,u.x,u.y])),d.push(["M",o.x,o.y]),d.push(["Z"]),d}var v=i-n<=Math.PI?0:1,g=[["M",o.x,o.y],["A",r,r,0,v,1,s.x,s.y],["L",u.x,u.y]];return a&&g.push(["A",a,a,0,v,0,l.x,l.y]),g.push(["L",o.x,o.y]),g.push(["Z"]),g}function Jrt(e,t,r,n,i){var a=Ps(e,t,r,n),o=Ps(e,t,r,i);if(xl(i-n,Math.PI*2)){var s=Ps(e,t,r,n+Math.PI);return[["M",a.x,a.y],["A",r,r,0,1,1,s.x,s.y],["A",r,r,0,1,1,a.x,a.y],["A",r,r,0,1,0,s.x,s.y],["A",r,r,0,1,0,a.x,a.y],["Z"]]}var l=i-n<=Math.PI?0:1;return[["M",a.x,a.y],["A",r,r,0,l,1,o.x,o.y]]}function GC(e,t){var r=e.points,n=eXt(r),i,a,o=t.startAngle,s=t.endAngle,l=s-o;return t.isTransposed?(i=n.maxY*l,a=n.minY*l):(i=n.maxX*l,a=n.minX*l),i+=o,a+=o,{startAngle:a,endAngle:i}}function rXt(e,t){if(Rn(e)&&Rn(t))return[e,t];if(e=e,t=t,pG(e)||pG(t))return[vG(e),vG(t)];for(var r=-1,n=0,i=0,a,o=e.length-1,s,l=0;++r<e.length;)a=o,o=r,l+=s=e[a]*t[o]-e[o]*t[a],n+=(e[a]+e[o])*s,i+=(t[a]+t[o])*s;return l*=3,[n/l,i/l]}function tnt(e,t){var r=e.attr(),n=t.attr();return ft(r,function(i,a){n[a]===void 0&&(n[a]=void 0)}),n}function hx(e,t,r){var n=Math.min(t,r),i=Math.max(t,r);return e>=n&&e<=i}function nXt(e,t,r){if(en(e))return e.padEnd(t,r);if(Fe(e)){var n=e.length;if(n<t)for(var i=t-n,a=0;a<i;a++)e.push(r)}return e}function Vc(e,t){return typeof e=="object"&&t.forEach(function(r){delete e[r]}),e}function Bm(e,t,r){var n,i;t===void 0&&(t=[]),r===void 0&&(r=new Map);try{for(var a=yi(e),o=a.next();!o.done;o=a.next()){var s=o.value;r.has(s)||(t.push(s),r.set(s,!0))}}catch(l){n={error:l}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return t}var uc=function(){function e(t,r,n,i){t===void 0&&(t=0),r===void 0&&(r=0),n===void 0&&(n=0),i===void 0&&(i=0),this.x=t,this.y=r,this.height=i,this.width=n}return e.fromRange=function(t,r,n,i){return new e(t,r,n-t,i-r)},e.fromObject=function(t){return new e(t.minX,t.minY,t.width,t.height)},Object.defineProperty(e.prototype,"minX",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxX",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"minY",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxY",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tl",{get:function(){return{x:this.x,y:this.y}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tr",{get:function(){return{x:this.maxX,y:this.y}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bl",{get:function(){return{x:this.x,y:this.maxY}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"br",{get:function(){return{x:this.maxX,y:this.maxY}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return{x:this.x+this.width/2,y:this.minY}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return{x:this.maxX,y:this.y+this.height/2}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return{x:this.x+this.width/2,y:this.maxY}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return{x:this.minX,y:this.y+this.height/2}},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},e.prototype.contains=function(t){return t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY},e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height)},e.prototype.add=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=this.clone();return ft(t,function(i){n.x=Math.min(i.x,n.x),n.y=Math.min(i.y,n.y),n.width=Math.max(i.maxX,n.maxX)-n.x,n.height=Math.max(i.maxY,n.maxY)-n.y}),n},e.prototype.merge=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=this.clone();return ft(t,function(i){n.x=Math.max(i.x,n.x),n.y=Math.max(i.y,n.y),n.width=Math.min(i.maxX,n.maxX)-n.x,n.height=Math.min(i.maxY,n.maxY)-n.y}),n},e.prototype.cut=function(t,r){var n=t.width,i=t.height;switch(r){case br.TOP:case br.TOP_LEFT:case br.TOP_RIGHT:return e.fromRange(this.minX,this.minY+i,this.maxX,this.maxY);case br.RIGHT:case br.RIGHT_TOP:case br.RIGHT_BOTTOM:return e.fromRange(this.minX,this.minY,this.maxX-n,this.maxY);case br.BOTTOM:case br.BOTTOM_LEFT:case br.BOTTOM_RIGHT:return e.fromRange(this.minX,this.minY,this.maxX,this.maxY-i);case br.LEFT:case br.LEFT_TOP:case br.LEFT_BOTTOM:return e.fromRange(this.minX+n,this.minY,this.maxX,this.maxY);default:return this}},e.prototype.shrink=function(t){var r=Pr(t,4),n=r[0],i=r[1],a=r[2],o=r[3];return new e(this.x+o,this.y+n,this.width-o-i,this.height-n-a)},e.prototype.expand=function(t){var r=Pr(t,4),n=r[0],i=r[1],a=r[2],o=r[3];return new e(this.x-o,this.y-n,this.width+o+i,this.height+n+a)},e.prototype.exceed=function(t){return[Math.max(-this.minY+t.minY,0),Math.max(this.maxX-t.maxX,0),Math.max(this.maxY-t.maxY,0),Math.max(-this.minX+t.minX,0)]},e.prototype.collide=function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},e.prototype.size=function(){return this.width*this.height},e.prototype.isPointIn=function(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY},e}();function iXt(e){return[[e.minX,e.minY],[e.maxX,e.minY],[e.maxX,e.maxY],[e.minX,e.maxY]]}function h2(e){if(e.isPolar&&!e.isTransposed)return(e.endAngle-e.startAngle)*e.getRadius();var t=e.convert({x:0,y:0}),r=e.convert({x:1,y:0});return Math.sqrt(Math.pow(r.x-t.x,2)+Math.pow(r.y-t.y,2))}function aXt(e){if(e.isPolar){var t=e.startAngle,r=e.endAngle;return r-t===Math.PI*2}return!1}function v3(e,t){var r=e.getCenter();return Math.sqrt(Math.pow(t.x-r.x,2)+Math.pow(t.y-r.y,2))}function oXt(e,t){var r=!1;if(e)if(e.type==="theta"){var n=e.start,i=e.end;r=hx(t.x,n.x,i.x)&&hx(t.y,n.y,i.y)}else{var a=e.invert(t);r=hx(a.x,0,1)&&hx(a.y,0,1)}return r}function sb(e,t){var r=e.getCenter();return Math.atan2(t.y-r.y,t.x-r.x)}function ON(e,t){t===void 0&&(t=0);var r=e.start,n=e.end,i=e.getWidth(),a=e.getHeight();if(e.isPolar){var o=e.startAngle,s=e.endAngle,l=e.getCenter(),u=e.getRadius();return{type:"path",startState:{path:qm(l.x,l.y,u+t,o,o)},endState:function(f){var d=(s-o)*f+o,v=qm(l.x,l.y,u+t,o,d);return{path:v}},attrs:{path:qm(l.x,l.y,u+t,o,s)}}}var c;return e.isTransposed?c={height:a+t*2}:c={width:i+t*2},{type:"rect",startState:{x:r.x-t,y:n.y-t,width:e.isTransposed?i+t*2:0,height:e.isTransposed?0:a+t*2},endState:c,attrs:{x:r.x-t,y:n.y-t,width:i+t*2,height:a+t*2}}}function sXt(e,t){t===void 0&&(t=0);var r=e.start,n=e.end,i=e.getWidth(),a=e.getHeight(),o=Math.min(r.x,n.x),s=Math.min(r.y,n.y);return uc.fromRange(o-t,s-t,o+i+t,s+a+t)}var lXt=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]+)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/;function uXt(e){var t="linear";return lXt.test(e)?t="timeCat":en(e)&&(t="cat"),t}function ent(e,t,r,n){return t===void 0&&(t={}),t.type?t.type:e.type!=="identity"&&ux.includes(r)&&["interval"].includes(n)||e.isCategory?"cat":e.type}function cXt(e,t,r){var n=t||[];if(Rn(e)||ze(Gtt(n,e))&&cc(r)){var i=LR("identity");return new i({field:e.toString(),values:[e]})}var a=Zf(n,e),o=xt(r,"type",uXt(a[0])),s=LR(o);return new s($({field:e,values:a},r))}function hXt(e,t){if(e.type!=="identity"&&t.type!=="identity"){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n]);e.change(r)}}function WC(e){return e.alias||e.field}function rnt(e,t,r){var n=e.values,i=n.length,a;if(i===1)a=[.5,1];else{var o=1,s=0;aXt(t)?t.isTransposed?(o=xt(r,"widthRatio.multiplePie",1/1.3),s=1/i*o,a=[s/2,1-s/2]):a=[0,1-1/i]:(s=1/i/2,a=[s,1-s])}return a}function fXt(e){var t=e.values.filter(function(r){return!ze(r)&&!isNaN(r)});return Math.max.apply(Math,on(on([],Pr(t),!1),[ze(e.max)?-1/0:e.max],!1))}function dXt(e){var t,r;switch(e){case br.TOP:t={x:0,y:1},r={x:1,y:1};break;case br.RIGHT:t={x:1,y:0},r={x:1,y:1};break;case br.BOTTOM:t={x:0,y:0},r={x:1,y:0};break;case br.LEFT:t={x:0,y:0},r={x:0,y:1};break;default:t=r={x:0,y:0}}return{start:t,end:r}}function pXt(e){var t,r;return e.isTransposed?(t={x:0,y:0},r={x:1,y:0}):(t={x:0,y:0},r={x:0,y:1}),{start:t,end:r}}function lA(e,t){var r={start:{x:0,y:0},end:{x:0,y:0}};e.isRect?r=dXt(t):e.isPolar&&(r=pXt(e));var n=r.start,i=r.end;return{start:e.convert(n),end:e.convert(i)}}function nnt(e){var t=e.start,r=e.end;return t.x===r.x}function gG(e,t){var r=e.start,n=e.end,i=nnt(e);return i?(r.y-n.y)*(t.x-r.x)>0?1:-1:(n.x-r.x)*(r.y-t.y)>0?-1:1}function uA(e,t){var r=xt(e,["components","axis"],{});return Tr({},xt(r,["common"],{}),Tr({},xt(r,[t],{})))}function mG(e,t,r){var n=xt(e,["components","axis"],{});return Tr({},xt(n,["common","title"],{}),Tr({},xt(n,[t,"title"],{})),r)}function dP(e){var t=e.x,r=e.y,n=e.circleCenter,i=r.start>r.end,a=e.isTransposed?e.convert({x:i?0:1,y:0}):e.convert({x:0,y:i?0:1}),o=[a.x-n.x,a.y-n.y],s=[1,0],l=a.y>n.y?LD(o,s):LD(o,s)*-1,u=l+(t.end-t.start),c=Math.sqrt(Math.pow(a.x-n.x,2)+Math.pow(a.y-n.y,2));return{center:n,radius:c,startAngle:l,endAngle:u}}function FR(e,t){return bg(e)?e===!1?!1:{}:xt(e,[t])}function yG(e,t){return xt(e,"position",t)}function _G(e,t){return xt(t,["title","text"],WC(e))}var $b=function(){function e(t,r){this.destroyed=!1,this.facets=[],this.view=t,this.cfg=Tr({},this.getDefaultCfg(),r)}return e.prototype.init=function(){this.container||(this.container=this.createContainer());var t=this.view.getData();this.facets=this.generateFacets(t)},e.prototype.render=function(){this.renderViews()},e.prototype.update=function(){},e.prototype.clear=function(){this.clearFacetViews()},e.prototype.destroy=function(){this.clear(),this.container&&(this.container.remove(!0),this.container=void 0),this.destroyed=!0,this.view=void 0,this.facets=[]},e.prototype.facetToView=function(t){var r=t.region,n=t.data,i=t.padding,a=i===void 0?this.cfg.padding:i,o=this.view.createView({region:r,padding:a});o.data(n||[]),t.view=o,this.beforeEachView(o,t);var s=this.cfg.eachView;return s&&s(o,t),this.afterEachView(o,t),o},e.prototype.createContainer=function(){var t=this.view.getLayer(_s.FORE);return t.addGroup()},e.prototype.renderViews=function(){this.createFacetViews()},e.prototype.createFacetViews=function(){var t=this;return this.facets.map(function(r){return t.facetToView(r)})},e.prototype.clearFacetViews=function(){var t=this;ft(this.facets,function(r){r.view&&(t.view.removeView(r.view),r.view=void 0)})},e.prototype.parseSpacing=function(){var t=this.view.viewBBox,r=t.width,n=t.height,i=this.cfg.spacing;return i.map(function(a,o){return Rn(a)?a/(o===0?r:n):parseFloat(a)/100})},e.prototype.getFieldValues=function(t,r){var n=[],i={};return ft(t,function(a){var o=a[r];!ze(o)&&!i[o]&&(n.push(o),i[o]=!0)}),n},e.prototype.getRegion=function(t,r,n,i){var a=Pr(this.parseSpacing(),2),o=a[0],s=a[1],l=(1+o)/(r===0?1:r)-o,u=(1+s)/(t===0?1:t)-s,c={x:(l+o)*n,y:(u+s)*i},f={x:c.x+l,y:c.y+u};return{start:c,end:f}},e.prototype.getDefaultCfg=function(){return{eachView:void 0,showTitle:!0,spacing:[0,0],padding:10,fields:[]}},e.prototype.getDefaultTitleCfg=function(){var t=this.view.getTheme().fontFamily;return{style:{fontSize:14,fill:"#666",fontFamily:t}}},e.prototype.processAxis=function(t,r){var n=t.getOptions(),i=n.coordinate,a=t.geometries,o=xt(i,"type","rect");if(o==="rect"&&a.length){ze(n.axes)&&(n.axes={});var s=n.axes,l=Pr(a[0].getXYFields(),2),u=l[0],c=l[1],f=FR(s,u),d=FR(s,c);f!==!1&&(n.axes[u]=this.getXAxisOption(u,s,f,r)),d!==!1&&(n.axes[c]=this.getYAxisOption(c,s,d,r))}},e.prototype.getFacetDataFilter=function(t){return function(r){return t3(t,function(n){var i=n.field,a=n.value;return!ze(a)&&i?r[i]===a:!0})}},e}(),int={},vXt=function(e){return int[b0(e)]},Hb=function(e,t){int[b0(e)]=t},io=function(){function e(t,r){this.context=t,this.cfg=r,t.addAction(this)}return e.prototype.applyCfg=function(t){Qi(this,t)},e.prototype.init=function(){this.applyCfg(this.cfg)},e.prototype.destroy=function(){this.context.removeAction(this),this.context=null},e}(),gXt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.execute=function(){this.callback&&this.callback(this.context)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.callback=null},t}(io),PN={};function mXt(e,t){var r=PN[e],n=null;if(r){var i=r.ActionClass,a=r.cfg;n=new i(t,a),n.name=e,n.init()}return n}function g3(e){var t=PN[e];return xt(t,"ActionClass")}function yn(e,t,r){PN[e]={ActionClass:t,cfg:r}}function yXt(e,t){var r=new gXt(t);return r.callback=e,r.name="callback",r}function _Xt(e,t){var r=[];if(e.length){r.push(["M",e[0].x,e[0].y]);for(var n=1,i=e.length;n<i;n+=1){var a=e[n];r.push(["L",a.x,a.y])}t&&r.push(["Z"])}return r}function kF(e,t){for(var r=[e[0]],n=1,i=e.length;n<i;n=n+2){var a=t.convert({x:e[n],y:e[n+1]});r.push(a.x,a.y)}return r}function ant(e,t){var r=t.isTransposed,n=e[1],i=e[6],a=e[7],o=t.convert({x:i,y:a}),s=r?0:1;return["A",n,n,0,0,s,o.x,o.y]}function xXt(e,t,r){var n=r.isTransposed,i=r.startAngle,a=r.endAngle,o=e[0].toLowerCase()==="a"?{x:e[6],y:e[7]}:{x:e[1],y:e[2]},s={x:t[1],y:t[2]},l=[],u=n?"y":"x",c=Math.abs(s[u]-o[u])*(a-i),f=s[u]>=o[u]?1:0,d=c>Math.PI?1:0,v=r.convert(s),g=v3(r,v);if(g>=.5)if(c===Math.PI*2){var x={x:(s.x+o.x)/2,y:(s.y+o.y)/2},w=r.convert(x);l.push(["A",g,g,0,d,f,w.x,w.y]),l.push(["A",g,g,0,d,f,v.x,v.y])}else l.push(["A",g,g,0,d,f,v.x,v.y]);return l}function bXt(e){ft(e,function(t,r){var n=t;if(n[0].toLowerCase()==="a"){var i=e[r-1],a=e[r+1];a&&a[0].toLowerCase()==="a"?i&&i[0].toLowerCase()==="l"&&(i[0]="M"):i&&i[0].toLowerCase()==="a"&&a&&a[0].toLowerCase()==="l"&&(a[0]="M")}})}var EXt=function(e,t,r,n){var i,a=[],o=!!n,s,l,u,c,f,d,v;if(o){i=Pr(n,2),u=i[0],c=i[1];for(var g=0,x=e.length;g<x;g++){var w=e[g];u=$l([0,0],u,w),c=Hl([0,0],c,w)}}for(var g=0,S=e.length;g<S;g++){var w=e[g];if(g===0&&!r)v=w;else if(g===S-1&&!r)d=w,a.push(v),a.push(d);else{s=e[r?g?g-1:S-1:g-1],l=e[r?(g+1)%S:g+1];var M=[0,0];M=fg(M,l,s),M=oc(M,M,t);var R=Xx(w,s),I=Xx(w,l),P=R+I;P!==0&&(R/=P,I/=P);var k=oc([0,0],M,-R),z=oc([0,0],M,I);d=Vl([0,0],w,k),f=Vl([0,0],w,z),f=$l([0,0],f,Hl([0,0],l,w)),f=Hl([0,0],f,$l([0,0],l,w)),k=fg([0,0],f,w),k=oc([0,0],k,-R/I),d=Vl([0,0],w,k),d=$l([0,0],d,Hl([0,0],s,w)),d=Hl([0,0],d,$l([0,0],s,w)),z=fg([0,0],w,d),z=oc([0,0],z,I/R),f=Vl([0,0],w,z),o&&(d=Hl([0,0],d,u),d=$l([0,0],d,c),f=Hl([0,0],f,u),f=$l([0,0],f,c)),a.push(v),a.push(d),v=f}}return r&&a.push(a.shift()),a};function ont(e,t,r){for(var n=!!t,i=[],a=0,o=e.length;a<o;a+=2)i.push([e[a],e[a+1]]);for(var s=EXt(i,.4,n,r),l=i.length,u=[],c,f,d,a=0;a<l-1;a++)c=s[a*2],f=s[a*2+1],d=i[a+1],u.push(["C",c[0],c[1],f[0],f[1],d[0],d[1]]);return n&&(c=s[l],f=s[l+1],d=i[0],u.push(["C",c[0],c[1],f[0],f[1],d[0],d[1]])),u}function f2(e,t){return _Xt(e,t)}function BR(e,t,r){var n=[],i=e[0],a=null;if(e.length<=2)return f2(e,t);for(var o=0,s=e.length;o<s;o++){var l=e[o];(!a||!(a.x===l.x&&a.y===l.y))&&(n.push(l.x),n.push(l.y),a=l)}var u=r||[[0,0],[1,1]],c=ont(n,t,u);return c.unshift(["M",i.x,i.y]),c}function wXt(e,t){var r=[];return ft(t,function(n){var i=n[0];switch(i.toLowerCase()){case"m":case"l":case"c":r.push(kF(n,e));break;case"a":r.push(ant(n,e));break;case"z":default:r.push(n);break}}),r}function CXt(e,t){var r=[],n,i,a,o;return ft(t,function(s,l){var u=s[0];switch(u.toLowerCase()){case"m":case"c":case"q":r.push(kF(s,e));break;case"l":n=t[l-1],i=s,a=e.isTransposed,o=a?n[n.length-2]===i[1]:n[n.length-1]===i[2],o?r=r.concat(xXt(n,i,e)):r.push(kF(s,e));break;case"a":r.push(ant(s,e));break;case"z":default:r.push(s);break}}),bXt(r),r}var nC=`	
\v\f\r   ᠎             　\u2028\u2029`,SXt=new RegExp("([a-z])["+nC+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+nC+"]*,?["+nC+"]*)+)","ig"),TXt=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+nC+"]*,?["+nC+"]*","ig");function AXt(e){if(!e)return null;if(Fe(e))return e;var t={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},r=[];return String(e).replace(SXt,function(n,i,a){var o=[],s=i.toLowerCase();if(a.replace(TXt,function(l,u){u&&o.push(+u)}),s==="m"&&o.length>2&&(r.push([i].concat(o.splice(0,2))),s="l",i=i==="m"?"l":"L"),s==="o"&&o.length===1&&r.push([i,o[0]]),s==="r")r.push([i].concat(o));else for(;o.length>=t[s]&&(r.push([i].concat(o.splice(0,t[s]))),!!t[s]););return""}),r}var xG=function(e,t,r){return e>=t&&e<=r};function MXt(e,t,r,n){var i=.001,a={x:r.x-e.x,y:r.y-e.y},o={x:t.x-e.x,y:t.y-e.y},s={x:n.x-r.x,y:n.y-r.y},l=o.x*s.y-o.y*s.x,u=l*l,c=o.x*o.x+o.y*o.y,f=s.x*s.x+s.y*s.y,d=null;if(u>i*c*f){var v=(a.x*s.y-a.y*s.x)/l,g=(a.x*o.y-a.y*o.x)/l;xG(v,0,1)&&xG(g,0,1)&&(d={x:e.x+v*o.x,y:e.y+v*o.y})}return d}var RXt=1e-6;function pP(e){return Math.abs(e)<RXt?0:e<0?-1:1}function IXt(e,t,r){return(r[0]-e[0])*(t[1]-e[1])===(t[0]-e[0])*(r[1]-e[1])&&Math.min(e[0],t[0])<=r[0]&&r[0]<=Math.max(e[0],t[0])&&Math.min(e[1],t[1])<=r[1]&&r[1]<=Math.max(e[1],t[1])}function bG(e,t,r){var n=!1,i=e.length;if(i<=2)return!1;for(var a=0;a<i;a++){var o=e[a],s=e[(a+1)%i];if(IXt(o,s,[t,r]))return!0;pP(o[1]-r)>0!=pP(s[1]-r)>0&&pP(t-(r-o[1])*(o[0]-s[0])/(o[1]-s[1])-o[0])<0&&(n=!n)}return n}function EG(e){for(var t=[],r=e.length,n=0;n<r-1;n++){var i=e[n],a=e[n+1];t.push({from:{x:i[0],y:i[1]},to:{x:a[0],y:a[1]}})}if(t.length>1){var o=e[0],s=e[r-1];t.push({from:{x:s[0],y:s[1]},to:{x:o[0],y:o[1]}})}return t}function LXt(e,t){var r=!1;return ft(e,function(n){if(MXt(n.from,n.to,t.from,t.to))return r=!0,!1}),r}function wG(e){var t=e.map(function(n){return n[0]}),r=e.map(function(n){return n[1]});return{minX:Math.min.apply(null,t),maxX:Math.max.apply(null,t),minY:Math.min.apply(null,r),maxY:Math.max.apply(null,r)}}function OXt(e,t){return!(t.minX>e.maxX||t.maxX<e.minX||t.minY>e.maxY||t.maxY<e.minY)}function PXt(e,t){if(e.length<2||t.length<2)return!1;var r=wG(e),n=wG(t);if(!OXt(r,n))return!1;var i=!1;if(ft(t,function(l){if(bG(e,l[0],l[1]))return i=!0,!1}),i||(ft(e,function(l){if(bG(t,l[0],l[1]))return i=!0,!1}),i))return!0;var a=EG(e),o=EG(t),s=!1;return ft(o,function(l){if(LXt(a,l))return s=!0,!1}),s}function snt(e,t){var r=e.event,n=r.target;return unt(n,t)}function lnt(e,t){var r=e.getCanvasBBox(),n=r.width,i=r.height;return n>0&&i>0&&(n>=t||i>=t)}function unt(e,t){var r=e.getCanvasBBox();return lnt(e,t)?r:null}function cnt(e,t){var r=e.event.maskShapes;return r.map(function(n){return unt(n,t)}).filter(function(n){return!!n})}function DXt(e,t){var r=e.event,n=r.target;return hnt(n,t)}function hnt(e,t){return lnt(e,t)?e.attr("path"):null}function FXt(e,t){var r=e.event.maskShapes;return r.map(function(n){return hnt(n,t)})}function a0(e){var t=e.event,r,n=t.target;return n&&(r=n.get("element")),r}function c_(e){var t=e.event,r=t.target,n;return r&&(n=r.get("delegateObject")),n}function fnt(e){var t=e.event.gEvent;return!(t&&t.fromShape&&t.toShape&&t.fromShape.get("element")===t.toShape.get("element"))}function XC(e){return e&&e.component&&e.component.isList()}function dnt(e){return e&&e.component&&e.component.isSlider()}function jC(e){var t=e.event,r=t.target;return r&&(r==null?void 0:r.get("name"))==="mask"||m3(e)}function m3(e){var t;return((t=e.event.target)===null||t===void 0?void 0:t.get("name"))==="multi-mask"}function DN(e,t){var r=e.event.target;if(m3(e))return BXt(e,t);if(r.get("type")==="path"){var n=DXt(e,t);return n?mnt(e.view,n):void 0}var i=snt(e,t);return i?y3(e.view,i):null}function BXt(e,t){var r=e.event.target;if(r.get("type")==="path"){var n=FXt(e,t);return n.length>0?n.flatMap(function(a){return mnt(e.view,a)}):null}var i=cnt(e,t);return i.length>0?i.flatMap(function(a){return y3(e.view,a)}):null}function pnt(e,t,r){if(m3(e))return NXt(e,t,r);var n=snt(e,r);return n?vnt(n,e,t):null}function vnt(e,t,r){var n=t.view,i=zF(n,r,{x:e.x,y:e.y}),a=zF(n,r,{x:e.maxX,y:e.maxY}),o={minX:i.x,minY:i.y,maxX:a.x,maxY:a.y};return y3(r,o)}function NXt(e,t,r){var n=cnt(e,r);return n.length>0?n.flatMap(function(i){return vnt(i,e,t)}):null}function Xl(e){var t=e.geometries,r=[];return ft(t,function(n){var i=n.elements;r=r.concat(i)}),e.views&&e.views.length&&ft(e.views,function(n){r=r.concat(Xl(n))}),r}function kXt(e,t,r){var n=Xl(e);return n.filter(function(i){return Yd(i,t)===r})}function gnt(e,t){var r=e.geometries,n=[];return ft(r,function(i){var a=i.getElementsBy(function(o){return o.hasState(t)});n=n.concat(a)}),n}function Yd(e,t){var r=e.getModel(),n=r.data,i;return Fe(n)?i=n[0][t]:i=n[t],i}function zXt(e,t){return!(t.minX>e.maxX||t.maxX<e.minX||t.minY>e.maxY||t.maxY<e.minY)}function y3(e,t){var r=Xl(e),n=[];return ft(r,function(i){var a=i.shape,o=a.getCanvasBBox();zXt(t,o)&&n.push(i)}),n}function CG(e){var t=[];return ft(e,function(r){var n=r[0];if(n!=="A")for(var i=1;i<r.length;i=i+2)t.push([r[i],r[i+1]]);else{var a=r.length;t.push([r[a-2],r[a-1]])}}),t}function mnt(e,t){var r=Xl(e),n=CG(t),i=r.filter(function(a){var o=a.shape,s;if(o.get("type")==="path")s=CG(o.attr("path"));else{var l=o.getCanvasBBox();s=iXt(l)}return PXt(n,s)});return i}function ynt(e){return e.getComponents().map(function(t){return t.component})}function FN(e,t){var r=t.x-e.x,n=t.y-e.y;return Math.sqrt(r*r+n*n)}function UXt(e,t){if(e.length<=2)return f2(e,!1);var r=e[0],n=[];ft(e,function(a){n.push(a.x),n.push(a.y)});var i=ont(n,t,null);return i.unshift(["M",r.x,r.y]),i}function SG(e,t){return e.x<=t.x&&e.maxX>=t.x&&e.y<=t.y&&e.maxY>t.y}function Zp(e){var t=e.parent,r=null;return t&&(r=t.views.filter(function(n){return n!==e})),r}function $Xt(e,t){var r=e.getCoordinate();return r.invert(t)}function zF(e,t,r){var n=$Xt(e,r);return t.getCoordinate().convert(n)}function _nt(e,t,r,n){var i=!1;return ft(e,function(a){if(a[r]===t[r]&&a[n]===t[n])return i=!0,!1}),i}function lb(e,t){var r=e.getScaleByField(t);return!r&&e.views&&ft(e.views,function(n){if(r=lb(n,t),r)return!1}),r}var HXt=function(){function e(t){this.actions=[],this.event=null,this.cacheMap={},this.view=t}return e.prototype.cache=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(t.length===1)return this.cacheMap[t[0]];t.length===2&&(this.cacheMap[t[0]]=t[1])},e.prototype.getAction=function(t){return this.actions.find(function(r){return r.name===t})},e.prototype.addAction=function(t){this.actions.push(t)},e.prototype.removeAction=function(t){var r=this.actions,n=this.actions.indexOf(t);n>=0&&r.splice(n,1)},e.prototype.getCurrentPoint=function(){var t=this.event;if(t)if(t.target instanceof HTMLElement){var r=this.view.getCanvas(),n=r.getPointByClient(t.clientX,t.clientY);return n}else return{x:t.x,y:t.y};return null},e.prototype.getCurrentShape=function(){return xt(this.event,["gEvent","shape"])},e.prototype.isInPlot=function(){var t=this.getCurrentPoint();return t?this.view.isPointInPlot(t):!1},e.prototype.isInShape=function(t){var r=this.getCurrentShape();return r?r.get("name")===t:!1},e.prototype.isInComponent=function(t){var r=ynt(this.view),n=this.getCurrentPoint();return n?!!r.find(function(i){var a=i.getBBox();return t?i.get("name")===t&&SG(a,n):SG(a,n)}):!1},e.prototype.destroy=function(){ft(this.actions.slice(),function(t){t.destroy()}),this.view=null,this.event=null,this.actions=null,this.cacheMap=null},e}(),VXt=function(){function e(t,r){this.view=t,this.cfg=r}return e.prototype.init=function(){this.initEvents()},e.prototype.initEvents=function(){},e.prototype.clearEvents=function(){},e.prototype.destroy=function(){this.clearEvents()},e}();function TG(e,t,r){var n=e.split(":"),i=n[0],a=t.getAction(i)||mXt(i,t);if(!a)throw new Error("There is no action named ".concat(i));var o=n[1];return{action:a,methodName:o,arg:r}}function AG(e){var t=e.action,r=e.methodName,n=e.arg;if(t[r])t[r](n);else throw new Error("Action(".concat(t.name,") doesn't have a method called ").concat(r))}var Ph={START:"start",SHOW_ENABLE:"showEnable",END:"end",ROLLBACK:"rollback",PROCESSING:"processing"},GXt=function(e){$t(t,e);function t(r,n){var i=e.call(this,r,n)||this;return i.callbackCaches={},i.emitCaches={},i.steps=n,i}return t.prototype.init=function(){this.initContext(),e.prototype.init.call(this)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.steps=null,this.context&&(this.context.destroy(),this.context=null),this.callbackCaches=null,this.view=null},t.prototype.initEvents=function(){var r=this;ft(this.steps,function(n,i){ft(n,function(a){var o=r.getActionCallback(i,a);o&&r.bindEvent(a.trigger,o)})})},t.prototype.clearEvents=function(){var r=this;ft(this.steps,function(n,i){ft(n,function(a){var o=r.getActionCallback(i,a);o&&r.offEvent(a.trigger,o)})})},t.prototype.initContext=function(){var r=this.view,n=new HXt(r);this.context=n;var i=this.steps;ft(i,function(a){ft(a,function(o){if(Rr(o.action))o.actionObject={action:yXt(o.action,n),methodName:"execute"};else if(en(o.action))o.actionObject=TG(o.action,n,o.arg);else if(Fe(o.action)){var s=o.action,l=Fe(o.arg)?o.arg:[o.arg];o.actionObject=[],ft(s,function(u,c){o.actionObject.push(TG(u,n,l[c]))})}})})},t.prototype.isAllowStep=function(r){var n=this.currentStepName,i=this.steps;if(n===r||r===Ph.SHOW_ENABLE)return!0;if(r===Ph.PROCESSING)return n===Ph.START;if(r===Ph.START)return n!==Ph.PROCESSING;if(r===Ph.END)return n===Ph.PROCESSING||n===Ph.START;if(r===Ph.ROLLBACK){if(i[Ph.END])return n===Ph.END;if(n===Ph.START)return!0}return!1},t.prototype.isAllowExecute=function(r,n){if(this.isAllowStep(r)){var i=this.getKey(r,n);return n.once&&this.emitCaches[i]?!1:n.isEnable?n.isEnable(this.context):!0}return!1},t.prototype.enterStep=function(r){this.currentStepName=r,this.emitCaches={}},t.prototype.afterExecute=function(r,n){r!==Ph.SHOW_ENABLE&&this.currentStepName!==r&&this.enterStep(r);var i=this.getKey(r,n);this.emitCaches[i]=!0},t.prototype.getKey=function(r,n){return r+n.trigger+n.action},t.prototype.getActionCallback=function(r,n){var i=this,a=this.context,o=this.callbackCaches,s=n.actionObject;if(n.action&&s){var l=this.getKey(r,n);if(!o[l]){var u=function(c){a.event=c,i.isAllowExecute(r,n)?(Fe(s)?ft(s,function(f){a.event=c,AG(f)}):(a.event=c,AG(s)),i.afterExecute(r,n),n.callback&&(a.event=c,n.callback(a))):a.event=null};n.debounce?o[l]=rN(u,n.debounce.wait,n.debounce.immediate):n.throttle?o[l]=e3(u,n.throttle.wait,{leading:n.throttle.leading,trailing:n.throttle.trailing}):o[l]=u}return o[l]}return null},t.prototype.bindEvent=function(r,n){var i=r.split(":");i[0]==="window"?window.addEventListener(i[1],n):i[0]==="document"?document.addEventListener(i[1],n):this.view.on(r,n)},t.prototype.offEvent=function(r,n){var i=r.split(":");i[0]==="window"?window.removeEventListener(i[1],n):i[0]==="document"?document.removeEventListener(i[1],n):this.view.off(r,n)},t}(VXt),xnt={};function WXt(e){return xnt[b0(e)]}function Zn(e,t){xnt[b0(e)]=t}function XXt(e,t,r){var n=WXt(e);if(!n)return null;if(Hd(n)){var i=Qi(bl(n),r);return new GXt(t,i)}else{var a=n;return new a(t,r)}}function jXt(e){return{title:{autoRotate:!0,position:"center",spacing:e.axisTitleSpacing,style:{fill:e.axisTitleTextFillColor,fontSize:e.axisTitleTextFontSize,lineHeight:e.axisTitleTextLineHeight,textBaseline:"middle",fontFamily:e.fontFamily},iconStyle:{fill:e.axisDescriptionIconFillColor}},label:{autoRotate:!1,autoEllipsis:!1,autoHide:{type:"equidistance",cfg:{minGap:6}},offset:e.axisLabelOffset,style:{fill:e.axisLabelFillColor,fontSize:e.axisLabelFontSize,lineHeight:e.axisLabelLineHeight,fontFamily:e.fontFamily}},line:{style:{lineWidth:e.axisLineBorder,stroke:e.axisLineBorderColor}},grid:{line:{type:"line",style:{stroke:e.axisGridBorderColor,lineWidth:e.axisGridBorder,lineDash:e.axisGridLineDash}},alignTick:!0,animate:!0},tickLine:{style:{lineWidth:e.axisTickLineBorder,stroke:e.axisTickLineBorderColor},alignTick:!0,length:e.axisTickLineLength},subTickLine:null,animate:!0}}function YXt(e){return{title:null,marker:{symbol:"circle",spacing:e.legendMarkerSpacing,style:{r:e.legendCircleMarkerSize,fill:e.legendMarkerColor}},itemName:{spacing:5,style:{fill:e.legendItemNameFillColor,fontFamily:e.fontFamily,fontSize:e.legendItemNameFontSize,lineHeight:e.legendItemNameLineHeight,fontWeight:e.legendItemNameFontWeight,textAlign:"start",textBaseline:"middle"}},itemStates:{active:{nameStyle:{opacity:.8}},unchecked:{nameStyle:{fill:"#D8D8D8"},markerStyle:{fill:"#D8D8D8",stroke:"#D8D8D8"}},inactive:{nameStyle:{fill:"#D8D8D8"},markerStyle:{opacity:.2}}},flipPage:!0,pageNavigator:{marker:{style:{size:e.legendPageNavigatorMarkerSize,inactiveFill:e.legendPageNavigatorMarkerInactiveFillColor,inactiveOpacity:e.legendPageNavigatorMarkerInactiveFillOpacity,fill:e.legendPageNavigatorMarkerFillColor,opacity:e.legendPageNavigatorMarkerFillOpacity}},text:{style:{fill:e.legendPageNavigatorTextFillColor,fontSize:e.legendPageNavigatorTextFontSize}}},animate:!1,maxItemWidth:200,itemSpacing:e.legendItemSpacing,itemMarginBottom:e.legendItemMarginBottom,padding:e.legendPadding}}function bnt(e){var t,r={point:{default:{fill:e.pointFillColor,r:e.pointSize,stroke:e.pointBorderColor,lineWidth:e.pointBorder,fillOpacity:e.pointFillOpacity},active:{stroke:e.pointActiveBorderColor,lineWidth:e.pointActiveBorder},selected:{stroke:e.pointSelectedBorderColor,lineWidth:e.pointSelectedBorder},inactive:{fillOpacity:e.pointInactiveFillOpacity,strokeOpacity:e.pointInactiveBorderOpacity}},hollowPoint:{default:{fill:e.hollowPointFillColor,lineWidth:e.hollowPointBorder,stroke:e.hollowPointBorderColor,strokeOpacity:e.hollowPointBorderOpacity,r:e.hollowPointSize},active:{stroke:e.hollowPointActiveBorderColor,strokeOpacity:e.hollowPointActiveBorderOpacity},selected:{lineWidth:e.hollowPointSelectedBorder,stroke:e.hollowPointSelectedBorderColor,strokeOpacity:e.hollowPointSelectedBorderOpacity},inactive:{strokeOpacity:e.hollowPointInactiveBorderOpacity}},area:{default:{fill:e.areaFillColor,fillOpacity:e.areaFillOpacity,stroke:null},active:{fillOpacity:e.areaActiveFillOpacity},selected:{fillOpacity:e.areaSelectedFillOpacity},inactive:{fillOpacity:e.areaInactiveFillOpacity}},hollowArea:{default:{fill:null,stroke:e.hollowAreaBorderColor,lineWidth:e.hollowAreaBorder,strokeOpacity:e.hollowAreaBorderOpacity},active:{fill:null,lineWidth:e.hollowAreaActiveBorder},selected:{fill:null,lineWidth:e.hollowAreaSelectedBorder},inactive:{strokeOpacity:e.hollowAreaInactiveBorderOpacity}},interval:{default:{fill:e.intervalFillColor,fillOpacity:e.intervalFillOpacity},active:{stroke:e.intervalActiveBorderColor,lineWidth:e.intervalActiveBorder},selected:{stroke:e.intervalSelectedBorderColor,lineWidth:e.intervalSelectedBorder},inactive:{fillOpacity:e.intervalInactiveFillOpacity,strokeOpacity:e.intervalInactiveBorderOpacity}},hollowInterval:{default:{fill:e.hollowIntervalFillColor,stroke:e.hollowIntervalBorderColor,lineWidth:e.hollowIntervalBorder,strokeOpacity:e.hollowIntervalBorderOpacity},active:{stroke:e.hollowIntervalActiveBorderColor,lineWidth:e.hollowIntervalActiveBorder,strokeOpacity:e.hollowIntervalActiveBorderOpacity},selected:{stroke:e.hollowIntervalSelectedBorderColor,lineWidth:e.hollowIntervalSelectedBorder,strokeOpacity:e.hollowIntervalSelectedBorderOpacity},inactive:{stroke:e.hollowIntervalInactiveBorderColor,lineWidth:e.hollowIntervalInactiveBorder,strokeOpacity:e.hollowIntervalInactiveBorderOpacity}},line:{default:{stroke:e.lineBorderColor,lineWidth:e.lineBorder,strokeOpacity:e.lineBorderOpacity,fill:null,lineAppendWidth:10,lineCap:"round",lineJoin:"round"},active:{lineWidth:e.lineActiveBorder},selected:{lineWidth:e.lineSelectedBorder},inactive:{strokeOpacity:e.lineInactiveBorderOpacity}}},n=jXt(e),i=YXt(e);return{background:e.backgroundColor,defaultColor:e.brandColor,subColor:e.subColor,semanticRed:e.paletteSemanticRed,semanticGreen:e.paletteSemanticGreen,padding:"auto",fontFamily:e.fontFamily,columnWidthRatio:1/2,maxColumnWidth:null,minColumnWidth:null,roseWidthRatio:.9999999,multiplePieWidthRatio:1/1.3,colors10:e.paletteQualitative10,colors20:e.paletteQualitative20,sequenceColors:e.paletteSequence,shapes:{point:["hollow-circle","hollow-square","hollow-bowtie","hollow-diamond","hollow-hexagon","hollow-triangle","hollow-triangle-down","circle","square","bowtie","diamond","hexagon","triangle","triangle-down","cross","tick","plus","hyphen","line"],line:["line","dash","dot","smooth"],area:["area","smooth","line","smooth-line"],interval:["rect","hollow-rect","line","tick"]},sizes:[1,10],geometries:{interval:{rect:{default:{style:r.interval.default},active:{style:r.interval.active},inactive:{style:r.interval.inactive},selected:{style:function(a){var o=a.geometry.coordinate;if(o.isPolar&&o.isTransposed){var s=GC(a.getModel(),o),l=s.startAngle,u=s.endAngle,c=(l+u)/2,f=7.5,d=f*Math.cos(c),v=f*Math.sin(c);return{matrix:Ws(null,[["t",d,v]])}}return r.interval.selected}}},"hollow-rect":{default:{style:r.hollowInterval.default},active:{style:r.hollowInterval.active},inactive:{style:r.hollowInterval.inactive},selected:{style:r.hollowInterval.selected}},line:{default:{style:r.hollowInterval.default},active:{style:r.hollowInterval.active},inactive:{style:r.hollowInterval.inactive},selected:{style:r.hollowInterval.selected}},tick:{default:{style:r.hollowInterval.default},active:{style:r.hollowInterval.active},inactive:{style:r.hollowInterval.inactive},selected:{style:r.hollowInterval.selected}},funnel:{default:{style:r.interval.default},active:{style:r.interval.active},inactive:{style:r.interval.inactive},selected:{style:r.interval.selected}},pyramid:{default:{style:r.interval.default},active:{style:r.interval.active},inactive:{style:r.interval.inactive},selected:{style:r.interval.selected}}},line:{line:{default:{style:r.line.default},active:{style:r.line.active},inactive:{style:r.line.inactive},selected:{style:r.line.selected}},dot:{default:{style:$($({},r.line.default),{lineCap:null,lineDash:[1,1]})},active:{style:$($({},r.line.active),{lineCap:null,lineDash:[1,1]})},inactive:{style:$($({},r.line.inactive),{lineCap:null,lineDash:[1,1]})},selected:{style:$($({},r.line.selected),{lineCap:null,lineDash:[1,1]})}},dash:{default:{style:$($({},r.line.default),{lineCap:null,lineDash:[5.5,1]})},active:{style:$($({},r.line.active),{lineCap:null,lineDash:[5.5,1]})},inactive:{style:$($({},r.line.inactive),{lineCap:null,lineDash:[5.5,1]})},selected:{style:$($({},r.line.selected),{lineCap:null,lineDash:[5.5,1]})}},smooth:{default:{style:r.line.default},active:{style:r.line.active},inactive:{style:r.line.inactive},selected:{style:r.line.selected}},hv:{default:{style:r.line.default},active:{style:r.line.active},inactive:{style:r.line.inactive},selected:{style:r.line.selected}},vh:{default:{style:r.line.default},active:{style:r.line.active},inactive:{style:r.line.inactive},selected:{style:r.line.selected}},hvh:{default:{style:r.line.default},active:{style:r.line.active},inactive:{style:r.line.inactive},selected:{style:r.line.selected}},vhv:{default:{style:r.line.default},active:{style:r.line.active},inactive:{style:r.line.inactive},selected:{style:r.line.selected}}},polygon:{polygon:{default:{style:r.interval.default},active:{style:r.interval.active},inactive:{style:r.interval.inactive},selected:{style:r.interval.selected}}},point:{circle:{default:{style:r.point.default},active:{style:r.point.active},inactive:{style:r.point.inactive},selected:{style:r.point.selected}},square:{default:{style:r.point.default},active:{style:r.point.active},inactive:{style:r.point.inactive},selected:{style:r.point.selected}},bowtie:{default:{style:r.point.default},active:{style:r.point.active},inactive:{style:r.point.inactive},selected:{style:r.point.selected}},diamond:{default:{style:r.point.default},active:{style:r.point.active},inactive:{style:r.point.inactive},selected:{style:r.point.selected}},hexagon:{default:{style:r.point.default},active:{style:r.point.active},inactive:{style:r.point.inactive},selected:{style:r.point.selected}},triangle:{default:{style:r.point.default},active:{style:r.point.active},inactive:{style:r.point.inactive},selected:{style:r.point.selected}},"triangle-down":{default:{style:r.point.default},active:{style:r.point.active},inactive:{style:r.point.inactive},selected:{style:r.point.selected}},"hollow-circle":{default:{style:r.hollowPoint.default},active:{style:r.hollowPoint.active},inactive:{style:r.hollowPoint.inactive},selected:{style:r.hollowPoint.selected}},"hollow-square":{default:{style:r.hollowPoint.default},active:{style:r.hollowPoint.active},inactive:{style:r.hollowPoint.inactive},selected:{style:r.hollowPoint.selected}},"hollow-bowtie":{default:{style:r.hollowPoint.default},active:{style:r.hollowPoint.active},inactive:{style:r.hollowPoint.inactive},selected:{style:r.hollowPoint.selected}},"hollow-diamond":{default:{style:r.hollowPoint.default},active:{style:r.hollowPoint.active},inactive:{style:r.hollowPoint.inactive},selected:{style:r.hollowPoint.selected}},"hollow-hexagon":{default:{style:r.hollowPoint.default},active:{style:r.hollowPoint.active},inactive:{style:r.hollowPoint.inactive},selected:{style:r.hollowPoint.selected}},"hollow-triangle":{default:{style:r.hollowPoint.default},active:{style:r.hollowPoint.active},inactive:{style:r.hollowPoint.inactive},selected:{style:r.hollowPoint.selected}},"hollow-triangle-down":{default:{style:r.hollowPoint.default},active:{style:r.hollowPoint.active},inactive:{style:r.hollowPoint.inactive},selected:{style:r.hollowPoint.selected}},cross:{default:{style:r.hollowPoint.default},active:{style:r.hollowPoint.active},inactive:{style:r.hollowPoint.inactive},selected:{style:r.hollowPoint.selected}},tick:{default:{style:r.hollowPoint.default},active:{style:r.hollowPoint.active},inactive:{style:r.hollowPoint.inactive},selected:{style:r.hollowPoint.selected}},plus:{default:{style:r.hollowPoint.default},active:{style:r.hollowPoint.active},inactive:{style:r.hollowPoint.inactive},selected:{style:r.hollowPoint.selected}},hyphen:{default:{style:r.hollowPoint.default},active:{style:r.hollowPoint.active},inactive:{style:r.hollowPoint.inactive},selected:{style:r.hollowPoint.selected}},line:{default:{style:r.hollowPoint.default},active:{style:r.hollowPoint.active},inactive:{style:r.hollowPoint.inactive},selected:{style:r.hollowPoint.selected}}},area:{area:{default:{style:r.area.default},active:{style:r.area.active},inactive:{style:r.area.inactive},selected:{style:r.area.selected}},smooth:{default:{style:r.area.default},active:{style:r.area.active},inactive:{style:r.area.inactive},selected:{style:r.area.selected}},line:{default:{style:r.hollowArea.default},active:{style:r.hollowArea.active},inactive:{style:r.hollowArea.inactive},selected:{style:r.hollowArea.selected}},"smooth-line":{default:{style:r.hollowArea.default},active:{style:r.hollowArea.active},inactive:{style:r.hollowArea.inactive},selected:{style:r.hollowArea.selected}}},schema:{candle:{default:{style:r.hollowInterval.default},active:{style:r.hollowInterval.active},inactive:{style:r.hollowInterval.inactive},selected:{style:r.hollowInterval.selected}},box:{default:{style:r.hollowInterval.default},active:{style:r.hollowInterval.active},inactive:{style:r.hollowInterval.inactive},selected:{style:r.hollowInterval.selected}}},edge:{line:{default:{style:r.line.default},active:{style:r.line.active},inactive:{style:r.line.inactive},selected:{style:r.line.selected}},vhv:{default:{style:r.line.default},active:{style:r.line.active},inactive:{style:r.line.inactive},selected:{style:r.line.selected}},smooth:{default:{style:r.line.default},active:{style:r.line.active},inactive:{style:r.line.inactive},selected:{style:r.line.selected}},arc:{default:{style:r.line.default},active:{style:r.line.active},inactive:{style:r.line.inactive},selected:{style:r.line.selected}}},violin:{violin:{default:{style:r.line.default},active:{style:r.line.active},inactive:{style:r.line.inactive},selected:{style:r.line.selected}},smooth:{default:{style:r.line.default},active:{style:r.line.active},inactive:{style:r.line.inactive},selected:{style:r.line.selected}},hollow:{default:{style:r.hollowArea.default},active:{style:r.hollowArea.active},inactive:{style:r.hollowArea.inactive},selected:{style:r.hollowArea.selected}},"hollow-smooth":{default:{style:r.hollowArea.default},active:{style:r.hollowArea.active},inactive:{style:r.hollowArea.inactive},selected:{style:r.hollowArea.selected}}}},components:{axis:{common:n,top:{position:"top",grid:null,title:null,verticalLimitLength:1/2},bottom:{position:"bottom",grid:null,title:null,verticalLimitLength:1/2},left:{position:"left",title:null,line:null,tickLine:null,verticalLimitLength:1/3},right:{position:"right",title:null,line:null,tickLine:null,verticalLimitLength:1/3},circle:{title:null,grid:Tr({},n.grid,{line:{type:"line"}})},radius:{title:null,grid:Tr({},n.grid,{line:{type:"circle"}})}},legend:{common:i,right:{layout:"vertical",padding:e.legendVerticalPadding},left:{layout:"vertical",padding:e.legendVerticalPadding},top:{layout:"horizontal",padding:e.legendHorizontalPadding},bottom:{layout:"horizontal",padding:e.legendHorizontalPadding},continuous:{title:null,background:null,track:{},rail:{type:"color",size:e.sliderRailHeight,defaultLength:e.sliderRailWidth,style:{fill:e.sliderRailFillColor,stroke:e.sliderRailBorderColor,lineWidth:e.sliderRailBorder}},label:{align:"rail",spacing:4,formatter:null,style:{fill:e.sliderLabelTextFillColor,fontSize:e.sliderLabelTextFontSize,lineHeight:e.sliderLabelTextLineHeight,textBaseline:"middle",fontFamily:e.fontFamily}},handler:{size:e.sliderHandlerWidth,style:{fill:e.sliderHandlerFillColor,stroke:e.sliderHandlerBorderColor}},slidable:!0,padding:i.padding}},tooltip:{showContent:!0,follow:!0,showCrosshairs:!1,showMarkers:!0,shared:!1,enterable:!1,position:"auto",marker:{symbol:"circle",stroke:"#fff",shadowBlur:10,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(0,0,0,0.09)",lineWidth:2,r:4},crosshairs:{line:{style:{stroke:e.tooltipCrosshairsBorderColor,lineWidth:e.tooltipCrosshairsBorder}},text:null,textBackground:{padding:2,style:{fill:"rgba(0, 0, 0, 0.25)",lineWidth:0,stroke:null}},follow:!1},domStyles:(t={},t["".concat(Eg)]={position:"absolute",visibility:"hidden",zIndex:8,transition:"left 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s, top 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s",backgroundColor:e.tooltipContainerFillColor,opacity:e.tooltipContainerFillOpacity,boxShadow:e.tooltipContainerShadow,borderRadius:"".concat(e.tooltipContainerBorderRadius,"px"),color:e.tooltipTextFillColor,fontSize:"".concat(e.tooltipTextFontSize,"px"),fontFamily:e.fontFamily,lineHeight:"".concat(e.tooltipTextLineHeight,"px"),padding:"0 12px 0 12px"},t["".concat(wg)]={marginBottom:"12px",marginTop:"12px"},t["".concat(VC)]={margin:0,listStyleType:"none",padding:0},t["".concat(h3)]={listStyleType:"none",padding:0,marginBottom:"12px",marginTop:"12px",marginLeft:0,marginRight:0},t["".concat(f3)]={width:"8px",height:"8px",borderRadius:"50%",display:"inline-block",marginRight:"8px"},t["".concat(d3)]={display:"inline-block",float:"right",marginLeft:"30px"},t)},annotation:{arc:{style:{stroke:e.annotationArcBorderColor,lineWidth:e.annotationArcBorder},animate:!0},line:{style:{stroke:e.annotationLineBorderColor,lineDash:e.annotationLineDash,lineWidth:e.annotationLineBorder},text:{position:"start",autoRotate:!0,style:{fill:e.annotationTextFillColor,stroke:e.annotationTextBorderColor,lineWidth:e.annotationTextBorder,fontSize:e.annotationTextFontSize,textAlign:"start",fontFamily:e.fontFamily,textBaseline:"bottom"}},animate:!0},text:{style:{fill:e.annotationTextFillColor,stroke:e.annotationTextBorderColor,lineWidth:e.annotationTextBorder,fontSize:e.annotationTextFontSize,textBaseline:"middle",textAlign:"start",fontFamily:e.fontFamily},animate:!0},region:{top:!1,style:{lineWidth:e.annotationRegionBorder,stroke:e.annotationRegionBorderColor,fill:e.annotationRegionFillColor,fillOpacity:e.annotationRegionFillOpacity},animate:!0},image:{top:!1,animate:!0},dataMarker:{top:!0,point:{style:{r:3,stroke:e.brandColor,lineWidth:2}},line:{style:{stroke:e.annotationLineBorderColor,lineWidth:e.annotationLineBorder},length:e.annotationDataMarkerLineLength},text:{style:{textAlign:"start",fill:e.annotationTextFillColor,stroke:e.annotationTextBorderColor,lineWidth:e.annotationTextBorder,fontSize:e.annotationTextFontSize,fontFamily:e.fontFamily}},direction:"upward",autoAdjust:!0,animate:!0},dataRegion:{style:{region:{fill:e.annotationRegionFillColor,fillOpacity:e.annotationRegionFillOpacity},text:{textAlign:"center",textBaseline:"bottom",fill:e.annotationTextFillColor,stroke:e.annotationTextBorderColor,lineWidth:e.annotationTextBorder,fontSize:e.annotationTextFontSize,fontFamily:e.fontFamily}},animate:!0}},slider:{common:{padding:[8,8,8,8],backgroundStyle:{fill:e.cSliderBackgroundFillColor,opacity:e.cSliderBackgroundFillOpacity},foregroundStyle:{fill:e.cSliderForegroundFillColor,opacity:e.cSliderForegroundFillOpacity},handlerStyle:{width:e.cSliderHandlerWidth,height:e.cSliderHandlerHeight,fill:e.cSliderHandlerFillColor,opacity:e.cSliderHandlerFillOpacity,stroke:e.cSliderHandlerBorderColor,lineWidth:e.cSliderHandlerBorder,radius:e.cSliderHandlerBorderRadius,highLightFill:e.cSliderHandlerHighlightFillColor},textStyle:{fill:e.cSliderTextFillColor,opacity:e.cSliderTextFillOpacity,fontSize:e.cSliderTextFontSize,lineHeight:e.cSliderTextLineHeight,fontWeight:e.cSliderTextFontWeight,stroke:e.cSliderTextBorderColor,lineWidth:e.cSliderTextBorder}}},scrollbar:{common:{padding:[8,8,8,8]},default:{style:{trackColor:e.scrollbarTrackFillColor,thumbColor:e.scrollbarThumbFillColor}},hover:{style:{thumbColor:e.scrollbarThumbHighlightFillColor}}}},labels:{offset:12,style:{fill:e.labelFillColor,fontSize:e.labelFontSize,fontFamily:e.fontFamily,stroke:e.labelBorderColor,lineWidth:e.labelBorder},fillColorDark:e.labelFillColorDark,fillColorLight:e.labelFillColorLight,autoRotate:!0},innerLabels:{style:{fill:e.innerLabelFillColor,fontSize:e.innerLabelFontSize,fontFamily:e.fontFamily,stroke:e.innerLabelBorderColor,lineWidth:e.innerLabelBorder},autoRotate:!0},overflowLabels:{style:{fill:e.overflowLabelFillColor,fontSize:e.overflowLabelFontSize,fontFamily:e.fontFamily,stroke:e.overflowLabelBorderColor,lineWidth:e.overflowLabelBorder}},pieLabels:{labelHeight:14,offset:10,labelLine:{style:{lineWidth:e.labelLineBorder}},autoRotate:!0}}}var _a={100:"#000",95:"#0D0D0D",85:"#262626",65:"#595959",45:"#8C8C8C",25:"#BFBFBF",15:"#D9D9D9",6:"#F0F0F0"},G1={100:"#FFFFFF",95:"#F2F2F2",85:"#D9D9D9",65:"#A6A6A6",45:"#737373",25:"#404040",15:"#262626",6:"#0F0F0F"},ZXt=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#6F5EF9","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],qXt=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#6F5EF9","#D3CEFD","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],KXt=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"],Ent=function(e){e===void 0&&(e={});var t=e.paletteQualitative10,r=t===void 0?ZXt:t,n=e.paletteQualitative20,i=n===void 0?qXt:n,a=e.brandColor,o=a===void 0?r[0]:a,s={backgroundColor:"transparent",brandColor:o,subColor:"rgba(0,0,0,0.05)",paletteQualitative10:r,paletteQualitative20:i,paletteSemanticRed:"#F4664A",paletteSemanticGreen:"#30BF78",paletteSemanticYellow:"#FAAD14",paletteSequence:KXt,fontFamily:`"Segoe UI", Roboto, "Helvetica Neue", Arial,
    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
    "Noto Color Emoji"`,axisLineBorderColor:_a[25],axisLineBorder:1,axisLineDash:null,axisTitleTextFillColor:_a[65],axisTitleTextFontSize:12,axisTitleTextLineHeight:12,axisTitleTextFontWeight:"normal",axisTitleSpacing:12,axisDescriptionIconFillColor:G1[85],axisTickLineBorderColor:_a[25],axisTickLineLength:4,axisTickLineBorder:1,axisSubTickLineBorderColor:_a[15],axisSubTickLineLength:2,axisSubTickLineBorder:1,axisLabelFillColor:_a[45],axisLabelFontSize:12,axisLabelLineHeight:12,axisLabelFontWeight:"normal",axisLabelOffset:8,axisGridBorderColor:_a[15],axisGridBorder:1,axisGridLineDash:null,legendTitleTextFillColor:_a[45],legendTitleTextFontSize:12,legendTitleTextLineHeight:21,legendTitleTextFontWeight:"normal",legendMarkerColor:o,legendMarkerSpacing:8,legendMarkerSize:4,legendCircleMarkerSize:4,legendSquareMarkerSize:4,legendLineMarkerSize:5,legendItemNameFillColor:_a[65],legendItemNameFontSize:12,legendItemNameLineHeight:12,legendItemNameFontWeight:"normal",legendItemSpacing:24,legendItemMarginBottom:12,legendPadding:[8,8,8,8],legendHorizontalPadding:[8,0,8,0],legendVerticalPadding:[0,8,0,8],legendPageNavigatorMarkerSize:12,legendPageNavigatorMarkerInactiveFillColor:_a[100],legendPageNavigatorMarkerInactiveFillOpacity:.45,legendPageNavigatorMarkerFillColor:_a[100],legendPageNavigatorMarkerFillOpacity:1,legendPageNavigatorTextFillColor:_a[45],legendPageNavigatorTextFontSize:12,sliderRailFillColor:_a[15],sliderRailBorder:0,sliderRailBorderColor:null,sliderRailWidth:100,sliderRailHeight:12,sliderLabelTextFillColor:_a[45],sliderLabelTextFontSize:12,sliderLabelTextLineHeight:12,sliderLabelTextFontWeight:"normal",sliderHandlerFillColor:_a[6],sliderHandlerWidth:10,sliderHandlerHeight:14,sliderHandlerBorder:1,sliderHandlerBorderColor:_a[25],annotationArcBorderColor:_a[15],annotationArcBorder:1,annotationLineBorderColor:_a[25],annotationLineBorder:1,annotationLineDash:null,annotationTextFillColor:_a[65],annotationTextFontSize:12,annotationTextLineHeight:12,annotationTextFontWeight:"normal",annotationTextBorderColor:null,annotationTextBorder:0,annotationRegionFillColor:_a[100],annotationRegionFillOpacity:.06,annotationRegionBorder:0,annotationRegionBorderColor:null,annotationDataMarkerLineLength:16,tooltipCrosshairsBorderColor:_a[25],tooltipCrosshairsBorder:1,tooltipCrosshairsLineDash:null,tooltipContainerFillColor:"rgb(255, 255, 255)",tooltipContainerFillOpacity:.95,tooltipContainerShadow:"0px 0px 10px #aeaeae",tooltipContainerBorderRadius:3,tooltipTextFillColor:_a[65],tooltipTextFontSize:12,tooltipTextLineHeight:12,tooltipTextFontWeight:"bold",labelFillColor:_a[65],labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,labelLineHeight:12,labelFontWeight:"normal",labelBorderColor:null,labelBorder:0,innerLabelFillColor:G1[100],innerLabelFontSize:12,innerLabelLineHeight:12,innerLabelFontWeight:"normal",innerLabelBorderColor:null,innerLabelBorder:0,overflowLabelFillColor:_a[65],overflowLabelFontSize:12,overflowLabelLineHeight:12,overflowLabelFontWeight:"normal",overflowLabelBorderColor:G1[100],overflowLabelBorder:1,labelLineBorder:1,labelLineBorderColor:_a[25],cSliderRailHieght:16,cSliderBackgroundFillColor:"#416180",cSliderBackgroundFillOpacity:.05,cSliderForegroundFillColor:"#5B8FF9",cSliderForegroundFillOpacity:.15,cSliderHandlerHeight:24,cSliderHandlerWidth:10,cSliderHandlerFillColor:"#F7F7F7",cSliderHandlerFillOpacity:1,cSliderHandlerHighlightFillColor:"#FFF",cSliderHandlerBorderColor:"#BFBFBF",cSliderHandlerBorder:1,cSliderHandlerBorderRadius:2,cSliderTextFillColor:"#000",cSliderTextFillOpacity:.45,cSliderTextFontSize:12,cSliderTextLineHeight:12,cSliderTextFontWeight:"normal",cSliderTextBorderColor:null,cSliderTextBorder:0,scrollbarTrackFillColor:"rgba(0,0,0,0)",scrollbarThumbFillColor:"rgba(0,0,0,0.15)",scrollbarThumbHighlightFillColor:"rgba(0,0,0,0.2)",pointFillColor:o,pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:G1[100],pointBorderOpacity:1,pointActiveBorderColor:_a[100],pointSelectedBorder:2,pointSelectedBorderColor:_a[100],pointInactiveFillOpacity:.3,pointInactiveBorderOpacity:.3,hollowPointSize:4,hollowPointBorder:1,hollowPointBorderColor:o,hollowPointBorderOpacity:.95,hollowPointFillColor:G1[100],hollowPointActiveBorder:1,hollowPointActiveBorderColor:_a[100],hollowPointActiveBorderOpacity:1,hollowPointSelectedBorder:2,hollowPointSelectedBorderColor:_a[100],hollowPointSelectedBorderOpacity:1,hollowPointInactiveBorderOpacity:.3,lineBorder:2,lineBorderColor:o,lineBorderOpacity:1,lineActiveBorder:3,lineSelectedBorder:3,lineInactiveBorderOpacity:.3,areaFillColor:o,areaFillOpacity:.25,areaActiveFillColor:o,areaActiveFillOpacity:.5,areaSelectedFillColor:o,areaSelectedFillOpacity:.5,areaInactiveFillOpacity:.3,hollowAreaBorderColor:o,hollowAreaBorder:2,hollowAreaBorderOpacity:1,hollowAreaActiveBorder:3,hollowAreaActiveBorderColor:_a[100],hollowAreaSelectedBorder:3,hollowAreaSelectedBorderColor:_a[100],hollowAreaInactiveBorderOpacity:.3,intervalFillColor:o,intervalFillOpacity:.95,intervalActiveBorder:1,intervalActiveBorderColor:_a[100],intervalActiveBorderOpacity:1,intervalSelectedBorder:2,intervalSelectedBorderColor:_a[100],intervalSelectedBorderOpacity:1,intervalInactiveBorderOpacity:.3,intervalInactiveFillOpacity:.3,hollowIntervalBorder:2,hollowIntervalBorderColor:o,hollowIntervalBorderOpacity:1,hollowIntervalFillColor:G1[100],hollowIntervalActiveBorder:2,hollowIntervalActiveBorderColor:_a[100],hollowIntervalSelectedBorder:3,hollowIntervalSelectedBorderColor:_a[100],hollowIntervalSelectedBorderOpacity:1,hollowIntervalInactiveBorderOpacity:.3};return $($({},s),e)};Ent();function NR(e){var t=e.styleSheet,r=t===void 0?{}:t,n=fi(e,["styleSheet"]),i=Ent(r);return Tr({},bnt(i),n)}var QXt=NR({}),UF={default:QXt};function iC(e){return xt(UF,b0(e),UF.default)}function JXt(e,t){UF[b0(e)]=NR(t)}function MG(e,t,r){var n=r.translate(e),i=r.translate(t);return xl(n,i)}function tjt(e,t){var r=t.coordinate,n=t.getXScale(),i=n.range,a=i[i.length-1],o=i[0],s=r.invert(e),l=s.x;return r.isPolar&&l>(1+a)/2&&(l=o),n.translate(n.invert(l))}function RG(e,t,r){var n=r.coordinate,i=r.getYScale(),a=i.field,o=n.invert(t),s=i.invert(o.y),l=Xf(e,function(u){var c=u[Pa];return c[a][0]<=s&&c[a][1]>=s});return l||e[e.length-1]}var ejt=D_(function(e){if(e.isCategory)return 1;for(var t=e.values,r=t.length,n=e.translate(t[0]),i=n,a=0;a<r;a++){var o=t[a],s=e.translate(o);s<n&&(n=s),s>i&&(i=s)}return(i-n)/(r-1)});function rjt(e,t,r){var n=t.getAttribute("position"),i=n.getFields(),a=t.scales,o=Rr(r)||!r?i[0]:r,s=a[o],l=s?s.getText(e[o]):e[o]||o;return Rr(r)?r(l,e):l}function njt(e){var t=Bb(e.attributes);return Al(t,function(r){return Up(ux,r.type)})}function wnt(e){var t,r,n=njt(e),i;try{for(var a=yi(n),o=a.next();!o.done;o=a.next()){var s=o.value,l=s.getScale(s.type);if(l&&l.isLinear){var u=xt(e.scaleDefs,l.field),c=ent(l,u,s.type,e.type);if(c!=="cat"){i=l;break}}}}catch(v){t={error:v}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}var f=e.getXScale(),d=e.getYScale();return i||d||f}function ijt(e,t){var r=t.field,n=e[r];if(Fe(n)){var i=n.map(function(a){return t.getText(a)});return i.join("-")}return t.getText(n)}function ajt(e,t){var r,n=t.getGroupScales();if(n.length&&(r=n[0]),r){var i=r.field;return r.getText(e[i])}var a=wnt(t);return WC(a)}function Cnt(e,t,r){if(t.length===0)return null;var n=r.type,i=r.getXScale(),a=r.getYScale(),o=i.field,s=a.field,l=null;if(n==="heatmap"||n==="point"){for(var u=r.coordinate,c=u.invert(e),f=i.invert(c.x),d=a.invert(c.y),v=1/0,g=0;g<t.length;g++){var x=t[g],w=x[Pa],S=Math.pow(w[o]-f,2)+Math.pow(w[s]-d,2);S<v&&(v=S,l=x)}return l}var M=t[0],R=t[t.length-1],I=tjt(e,r),P=M[Pa][o],k=M[Pa][s],z=R[Pa][o],G=a.isLinear&&Fe(k);if(Fe(P)){for(var g=0;g<t.length;g++){var J=t[g],w=J[Pa];if(i.translate(w[o][0])<=I&&i.translate(w[o][1])>=I)if(G)Fe(l)||(l=[]),l.push(J);else{l=J;break}}Fe(l)&&(l=RG(l,e,r))}else{var Z=void 0;if(!i.isLinear&&i.type!=="timeCat"){for(var g=0;g<t.length;g++){var J=t[g],w=J[Pa];if(MG(w[o],I,i))if(G)Fe(l)||(l=[]),l.push(J);else{l=J;break}else i.translate(w[o])<=I&&(R=J,Z=t[g+1])}Fe(l)&&(l=RG(l,e,r))}else{if((I>i.translate(z)||I<i.translate(P))&&(I>i.max||I<i.min))return null;for(var X=0,et=t.length-1,at=void 0;X<=et;){at=Math.floor((X+et)/2);var wt=t[at][Pa][o];if(MG(wt,I,i))return t[at];i.translate(wt)<=i.translate(I)?(X=at+1,R=t[at],Z=t[at+1]):(et===0&&(R=t[0]),et=at-1)}}R&&Z&&Math.abs(i.translate(R[Pa][o])-I)>Math.abs(i.translate(Z[Pa][o])-I)&&(R=Z)}var Tt=ejt(r.getXScale());return!l&&Math.abs(i.translate(R[Pa][o])-I)<=Tt/2&&(l=R),l}function BN(e,t,r,n){var i,a;r===void 0&&(r=""),n===void 0&&(n=!1);var o=e[Pa],s=rjt(o,t,r),l=t.tooltipOption,u=t.theme.defaultColor,c=[],f,d;function v(J,Z){if(n||!ze(Z)&&Z!==""){var X={title:s,data:o,mappingData:e,name:J,value:Z,color:e.color||u,marker:!0};c.push(X)}}if(Xi(l)){var g=l.fields,x=l.callback;if(x){var w=g.map(function(J){return e[Pa][J]}),S=x.apply(void 0,on([],Pr(w),!1)),M=$({data:e[Pa],mappingData:e,title:s,color:e.color||u,marker:!0},S);c.push(M)}else{var R=t.scales;try{for(var I=yi(g),P=I.next();!P.done;P=I.next()){var k=P.value;if(!ze(o[k])){var z=R[k];f=WC(z),d=z.getText(o[k]),v(f,d)}}}catch(J){i={error:J}}finally{try{P&&!P.done&&(a=I.return)&&a.call(I)}finally{if(i)throw i.error}}}}else{var G=wnt(t);d=ijt(o,G),f=ajt(o,t),v(f,d)}return c}function IG(e,t,r,n){var i,a,o=n.showNil,s=[],l=e.dataArray;if(!cc(l)){e.sort(l);try{for(var u=yi(l),c=u.next();!c.done;c=u.next()){var f=c.value,d=Cnt(t,f,e);if(d){var v=e.getElementId(d),g=e.elementsMap[v];if(e.type==="heatmap"||g.visible){var x=BN(d,e,r,o);x.length&&s.push(x)}}}}catch(w){i={error:w}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(i)throw i.error}}}return s}function LG(e,t,r,n){var i=n.showNil,a=[],o=e.container,s=o.getShape(t.x,t.y);if(s&&s.get("visible")&&s.get("origin")){var l=s.get("origin").mappingData,u=BN(l,e,r,i);u.length&&a.push(u)}return a}function $F(e,t,r){var n,i,a=[],o=e.geometries,s=r.shared,l=r.title,u=r.reversed;try{for(var c=yi(o),f=c.next();!f.done;f=c.next()){var d=f.value;if(d.visible&&d.tooltipOption!==!1){var v=d.type,g=void 0;["point","edge","polygon"].includes(v)?g=LG(d,t,l,r):["area","line","path","heatmap"].includes(v)||s!==!1?g=IG(d,t,l,r):g=LG(d,t,l,r),g.length&&(u&&g.reverse(),a.push(g))}}}catch(x){n={error:x}}finally{try{f&&!f.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}return a}function ojt(e,t,r){var n,i,a=$F(e,t,r);try{for(var o=yi(e.views),s=o.next();!s.done;s=o.next()){var l=s.value;a=a.concat($F(l,t,r))}}catch(u){n={error:u}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return a}function sjt(e){return!Rn(e)&&!Fe(e)}function NN(e){e===void 0&&(e=0);var t=Fe(e)?e:[e];switch(t.length){case 0:t=[0,0,0,0];break;case 1:t=new Array(4).fill(t[0]);break;case 2:t=on(on([],Pr(t),!1),Pr(t),!1);break;case 3:t=on(on([],Pr(t),!1),[t[1]],!1);break;default:t=t.slice(0,4);break}return t}var kN={};function B_(e,t){kN[e]=t}function ljt(){return Object.keys(kN)}function ujt(e){return kN[e]}var cjt=function(){function e(t){this.option=this.wrapperOption(t)}return e.prototype.update=function(t){return this.option=this.wrapperOption(t),this},e.prototype.hasAction=function(t){var r=this.option.actions;return XS(r,function(n){return n[0]===t})},e.prototype.create=function(t,r){var n=this.option,i=n.type,a=n.cfg,o=i==="theta",s=$({start:t,end:r},a),l=Trt(o?"polar":i);return this.coordinate=new l(s),this.coordinate.type=i,o&&(this.hasAction("transpose")||this.transpose()),this.execActions(),this.coordinate},e.prototype.adjust=function(t,r){return this.coordinate.update({start:t,end:r}),this.coordinate.resetMatrix(),this.execActions(["scale","rotate","translate"]),this.coordinate},e.prototype.rotate=function(t){return this.option.actions.push(["rotate",t]),this},e.prototype.reflect=function(t){return this.option.actions.push(["reflect",t]),this},e.prototype.scale=function(t,r){return this.option.actions.push(["scale",t,r]),this},e.prototype.transpose=function(){return this.option.actions.push(["transpose"]),this},e.prototype.getOption=function(){return this.option},e.prototype.getCoordinate=function(){return this.coordinate},e.prototype.wrapperOption=function(t){return $({type:"rect",actions:[],cfg:{}},t)},e.prototype.execActions=function(t){var r=this,n=this.option.actions;ft(n,function(i){var a,o=Pr(i),s=o[0],l=o.slice(1),u=ze(t)?!0:t.includes(s);u&&(a=r.coordinate)[s].apply(a,on([],Pr(l),!1))})},e}(),To=function(){function e(t,r,n){this.view=t,this.gEvent=r,this.data=n,this.type=r.type}return e.fromData=function(t,r,n){return new e(t,new Nb(r,{}),n)},Object.defineProperty(e.prototype,"target",{get:function(){return this.gEvent.target},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"event",{get:function(){return this.gEvent.originalEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this.gEvent.x},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.gEvent.y},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clientX",{get:function(){return this.gEvent.clientX},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"clientY",{get:function(){return this.gEvent.clientY},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return"[Event (type=".concat(this.type,")]")},e.prototype.clone=function(){return new e(this.view,this.gEvent,this.data)},e}();function hjt(e){var t=e.getController("axis"),r=e.getController("legend"),n=e.getController("annotation"),i=e.getController("slider"),a=e.getController("scrollbar");[t,i,a,r,n].forEach(function(o){o&&o.layout()})}var fjt=function(){function e(){this.scales=new Map,this.syncScales=new Map}return e.prototype.createScale=function(t,r,n,i){var a=n,o=this.getScaleMeta(i);if(r.length===0&&o){var s=o.scale,l={type:s.type};s.isCategory&&(l.values=s.values),a=Tr(l,o.scaleDef,n)}var u=cXt(t,r,a);return this.cacheScale(u,n,i),u},e.prototype.sync=function(t,r){var n=this;this.syncScales.forEach(function(i,a){var o=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER,l=[];ft(i,function(u){var c=n.getScale(u);s=Rn(c.max)?Math.max(s,c.max):s,o=Rn(c.min)?Math.min(o,c.min):o,ft(c.values,function(f){l.includes(f)||l.push(f)})}),ft(i,function(u){var c=n.getScale(u);if(c.isContinuous)c.change({min:o,max:s,values:l});else if(c.isCategory){var f=c.range,d=n.getScaleMeta(u);l&&!xt(d,["scaleDef","range"])&&(f=rnt(Tr({},c,{values:l}),t,r)),c.change({values:l,range:f})}})})},e.prototype.cacheScale=function(t,r,n){var i=this.getScaleMeta(n);i&&i.scale.type===t.type?(hXt(i.scale,t),i.scaleDef=r):(i={key:n,scale:t,scaleDef:r},this.scales.set(n,i));var a=this.getSyncKey(i);if(i.syncKey=a,this.removeFromSyncScales(n),a){var o=this.syncScales.get(a);o||(o=[],this.syncScales.set(a,o)),o.push(n)}},e.prototype.getScale=function(t){var r=this.getScaleMeta(t);if(!r){var n=Ds(t.split("-")),i=this.syncScales.get(n);i&&i.length&&(r=this.getScaleMeta(i[0]))}return r&&r.scale},e.prototype.deleteScale=function(t){var r=this.getScaleMeta(t);if(r){var n=r.syncKey,i=this.syncScales.get(n);if(i&&i.length){var a=i.indexOf(t);a!==-1&&i.splice(a,1)}}this.scales.delete(t)},e.prototype.clear=function(){this.scales.clear(),this.syncScales.clear()},e.prototype.removeFromSyncScales=function(t){var r=this;this.syncScales.forEach(function(n,i){var a=n.indexOf(t);if(a!==-1)return n.splice(a,1),n.length===0&&r.syncScales.delete(i),!1})},e.prototype.getSyncKey=function(t){var r=t.scale,n=t.scaleDef,i=r.field,a=xt(n,["sync"]);return a===!0?i:a===!1?void 0:a},e.prototype.getScaleMeta=function(t){return this.scales.get(t)},e}(),mM=function(){function e(t,r,n,i){t===void 0&&(t=0),r===void 0&&(r=0),n===void 0&&(n=0),i===void 0&&(i=0),this.top=t,this.right=r,this.bottom=n,this.left=i}return e.instance=function(t,r,n,i){return t===void 0&&(t=0),r===void 0&&(r=0),n===void 0&&(n=0),i===void 0&&(i=0),new e(t,r,n,i)},e.prototype.max=function(t){var r=Pr(t,4),n=r[0],i=r[1],a=r[2],o=r[3];return this.top=Math.max(this.top,n),this.right=Math.max(this.right,i),this.bottom=Math.max(this.bottom,a),this.left=Math.max(this.left,o),this},e.prototype.shrink=function(t){var r=Pr(t,4),n=r[0],i=r[1],a=r[2],o=r[3];return this.top+=n,this.right+=i,this.bottom+=a,this.left+=o,this},e.prototype.inc=function(t,r){var n=t.width,i=t.height;switch(r){case br.TOP:case br.TOP_LEFT:case br.TOP_RIGHT:this.top+=i;break;case br.RIGHT:case br.RIGHT_TOP:case br.RIGHT_BOTTOM:this.right+=n;break;case br.BOTTOM:case br.BOTTOM_LEFT:case br.BOTTOM_RIGHT:this.bottom+=i;break;case br.LEFT:case br.LEFT_TOP:case br.LEFT_BOTTOM:this.left+=n;break}return this},e.prototype.getPadding=function(){return[this.top,this.right,this.bottom,this.left]},e.prototype.clone=function(){return new(e.bind.apply(e,on([void 0],Pr(this.getPadding()),!1)))},e}();function djt(e){var t=e.padding;if(!sjt(t))return new(mM.bind.apply(mM,on([void 0],Pr(NN(t)),!1)));var r=e.viewBBox,n=new mM,i=[],a=[],o=[];return ft(e.getComponents(),function(s){var l=s.type;l===ml.AXIS?i.push(s):[ml.LEGEND,ml.SLIDER,ml.SCROLLBAR].includes(l)?a.push(s):l!==ml.GRID&&l!==ml.TOOLTIP&&o.push(s)}),ft(i,function(s){var l=s.component,u=l.getLayoutBBox(),c=new uc(u.x,u.y,u.width,u.height),f=c.exceed(r);n.max(f)}),ft(a,function(s){var l=s.component,u=s.direction,c=l.getLayoutBBox(),f=l.get("padding"),d=new uc(c.x,c.y,c.width,c.height).expand(f);n.inc(d,u)}),ft(o,function(s){var l=s.component,u=s.direction,c=l.getLayoutBBox(),f=new uc(c.x,c.y,c.width,c.height);n.inc(f,u)}),n}function pjt(e,t,r){var n=r.instance();t.forEach(function(i){i.autoPadding=n.max(i.autoPadding.getPadding())})}var Snt=function(e){$t(t,e);function t(r){var n=e.call(this,{visible:r.visible})||this;n.views=[],n.geometries=[],n.controllers=[],n.interactions={},n.limitInPlot=!1,n.options={data:[],animate:!0},n.usedControllers=ljt(),n.scalePool=new fjt,n.layoutFunc=hjt,n.isPreMouseInPlot=!1,n.isDataChanged=!1,n.isCoordinateChanged=!1,n.createdScaleKeys=new Map,n.onCanvasEvent=function(R){var I=R.name;if(!I.includes(":")){var P=n.createViewEvent(R);n.doPlotEvent(P),n.emit(I,P)}},n.onDelegateEvents=function(R){var I=R.name;if(I.includes(":")){var P=n.createViewEvent(R);n.emit(I,P)}};var i=r.id,a=i===void 0?lh("view"):i,o=r.parent,s=r.canvas,l=r.backgroundGroup,u=r.middleGroup,c=r.foregroundGroup,f=r.region,d=f===void 0?{start:{x:0,y:0},end:{x:1,y:1}}:f,v=r.padding,g=r.appendPadding,x=r.theme,w=r.options,S=r.limitInPlot,M=r.syncViewPadding;return n.parent=o,n.canvas=s,n.backgroundGroup=l,n.middleGroup=u,n.foregroundGroup=c,n.region=d,n.padding=v,n.appendPadding=g,n.options=$($({},n.options),w),n.limitInPlot=S,n.id=a,n.syncViewPadding=M,n.themeObject=Xi(x)?Tr({},iC("default"),NR(x)):iC(x),n.init(),n}return t.prototype.setLayout=function(r){this.layoutFunc=r},t.prototype.init=function(){this.calculateViewBBox(),this.initEvents(),this.initComponentController(),this.initOptions()},t.prototype.render=function(r,n){r===void 0&&(r=!1),this.emit(pi.BEFORE_RENDER,To.fromData(this,pi.BEFORE_RENDER,n)),this.paint(r),this.emit(pi.AFTER_RENDER,To.fromData(this,pi.AFTER_RENDER,n)),this.visible===!1&&this.changeVisible(!1)},t.prototype.clear=function(){var r=this;this.emit(pi.BEFORE_CLEAR),this.filteredData=[],this.coordinateInstance=void 0,this.isDataChanged=!1,this.isCoordinateChanged=!1;for(var n=this.geometries,i=0;i<n.length;i++)n[i].clear(),n[i].container.remove(!0),n[i].labelsContainer.remove(!0);this.geometries=[];for(var a=this.controllers,i=0;i<a.length;i++)a[i].name==="annotation"?a[i].clear(!0):a[i].clear();this.createdScaleKeys.forEach(function(s,l){r.getRootView().scalePool.deleteScale(l)}),this.createdScaleKeys.clear();for(var o=this.views,i=0;i<o.length;i++)o[i].clear();this.emit(pi.AFTER_CLEAR)},t.prototype.destroy=function(){this.emit(pi.BEFORE_DESTROY);var r=this.interactions;ft(r,function(s){s&&s.destroy()}),this.clear();for(var n=this.controllers,i=0,a=n.length;i<a;i++){var o=n[i];o.destroy()}this.backgroundGroup.remove(!0),this.middleGroup.remove(!0),this.foregroundGroup.remove(!0),e.prototype.destroy.call(this)},t.prototype.changeVisible=function(r){e.prototype.changeVisible.call(this,r);for(var n=this.geometries,i=0,a=n.length;i<a;i++){var o=n[i];o.changeVisible(r)}for(var s=this.controllers,i=0,a=s.length;i<a;i++){var l=s[i];l.changeVisible(r)}return this.foregroundGroup.set("visible",r),this.middleGroup.set("visible",r),this.backgroundGroup.set("visible",r),this.getCanvas().draw(),this},t.prototype.data=function(r){return Is(this.options,"data",r),this.isDataChanged=!0,this},t.prototype.source=function(r){return console.warn("This method will be removed at G2 V4.1. Please use chart.data() instead."),this.data(r)},t.prototype.filter=function(r,n){return Rr(n)?(Is(this.options,["filters",r],n),this):(!n&&xt(this.options,["filters",r])&&delete this.options.filters[r],this)},t.prototype.axis=function(r,n){return bg(r)?Is(this.options,["axes"],r):Is(this.options,["axes",r],n),this},t.prototype.legend=function(r,n){return bg(r)?Is(this.options,["legends"],r):en(r)?(Is(this.options,["legends",r],n),Hd(n)&&(n!=null&&n.selected)&&Is(this.options,["filters",r],function(i){var a;return(a=n==null?void 0:n.selected[i])!==null&&a!==void 0?a:!0})):Is(this.options,["legends"],r),this},t.prototype.scale=function(r,n){var i=this;return en(r)?Is(this.options,["scales",r],n):Xi(r)&&ft(r,function(a,o){Is(i.options,["scales",o],a)}),this},t.prototype.tooltip=function(r){return Is(this.options,"tooltip",r),this},t.prototype.annotation=function(){return this.getController("annotation")},t.prototype.guide=function(){return console.warn("This method will be removed at G2 V4.1. Please use chart.annotation() instead."),this.annotation()},t.prototype.coordinate=function(r,n){return en(r)?Is(this.options,"coordinate",{type:r,cfg:n}):Is(this.options,"coordinate",r),this.coordinateController.update(this.options.coordinate),this.coordinateController},t.prototype.coord=function(r,n){return console.warn("This method will be removed at G2 V4.1. Please use chart.coordinate() instead."),this.coordinate(r,n)},t.prototype.facet=function(r,n){this.facetInstance&&this.facetInstance.destroy();var i=vXt(r);if(!i)throw new Error("facet '".concat(r,"' is not exist!"));return this.facetInstance=new i(this,$($({},n),{type:r})),this},t.prototype.animate=function(r){return Is(this.options,"animate",r),this},t.prototype.updateOptions=function(r){return this.clear(),Qi(this.options,r),this.views.forEach(function(n){return n.destroy()}),this.views=[],this.initOptions(),this.coordinateBBox=this.viewBBox,this},t.prototype.option=function(r,n){if(t.prototype[r])throw new Error(`Can't use built in variable name "`.concat(r,'", please change another one.'));return Is(this.options,r,n),this},t.prototype.theme=function(r){return this.themeObject=Xi(r)?Tr({},this.themeObject,NR(r)):iC(r),this},t.prototype.interaction=function(r,n){var i=this.interactions[r];i&&i.destroy();var a=XXt(r,this,n);return a&&(a.init(),this.interactions[r]=a),this},t.prototype.removeInteraction=function(r){var n=this.interactions[r];n&&(n.destroy(),this.interactions[r]=void 0)},t.prototype.changeData=function(r){this.isDataChanged=!0,this.emit(pi.BEFORE_CHANGE_DATA,To.fromData(this,pi.BEFORE_CHANGE_DATA,null)),this.data(r),this.paint(!0);for(var n=this.views,i=0,a=n.length;i<a;i++){var o=n[i];o.changeData(r)}this.emit(pi.AFTER_CHANGE_DATA,To.fromData(this,pi.AFTER_CHANGE_DATA,null))},t.prototype.createView=function(r){this.parent&&this.parent.parent&&console.warn("The view nesting recursive feature will be removed at G2 V4.1. Please avoid to use it.");var n={data:this.options.data,scales:bl(this.options.scales),axes:bl(this.options.axes),coordinate:bl(this.coordinateController.getOption()),tooltip:bl(this.options.tooltip),legends:bl(this.options.legends),animate:this.options.animate,visible:this.visible},i=new t($($({parent:this,canvas:this.canvas,backgroundGroup:this.backgroundGroup.addGroup({zIndex:Tx.BG}),middleGroup:this.middleGroup.addGroup({zIndex:Tx.MID}),foregroundGroup:this.foregroundGroup.addGroup({zIndex:Tx.FORE}),theme:this.themeObject,padding:this.padding},r),{options:$($({},n),xt(r,"options",{}))}));return this.views.push(i),i},t.prototype.view=function(r){return console.warn("This method will be removed at G2 V4.1. Please use chart.createView() instead."),this.createView(r)},t.prototype.removeView=function(r){var n=Ytt(this.views,function(i){return i===r})[0];return n&&n.destroy(),n},t.prototype.getCoordinate=function(){return this.coordinateInstance},t.prototype.getTheme=function(){return this.themeObject},t.prototype.getXScale=function(){var r=this.geometries[0];return r?r.getXScale():null},t.prototype.getYScales=function(){var r={},n=[];return this.geometries.forEach(function(i){var a=i.getYScale(),o=a.field;r[o]||(r[o]=!0,n.push(a))}),n},t.prototype.getScalesByDim=function(r){for(var n=this.geometries,i={},a=0,o=n.length;a<o;a++){var s=n[a],l=r==="x"?s.getXScale():s.getYScale();l&&!i[l.field]&&(i[l.field]=l)}return i},t.prototype.getScale=function(r,n){var i=n||this.getScaleKey(r);return this.getRootView().scalePool.getScale(i)},t.prototype.getScaleByField=function(r,n){return this.getScale(r,n)},t.prototype.getOptions=function(){return this.options},t.prototype.getData=function(){return this.filteredData},t.prototype.getOriginalData=function(){return this.options.data},t.prototype.getPadding=function(){return this.autoPadding.getPadding()},t.prototype.getGeometries=function(){return this.geometries},t.prototype.getElements=function(){return du(this.geometries,function(r,n){return r.concat(n.getElements())},[])},t.prototype.getElementsBy=function(r){return this.getElements().filter(function(n){return r(n)})},t.prototype.getLayer=function(r){return r===_s.BG?this.backgroundGroup:r===_s.MID?this.middleGroup:r===_s.FORE?this.foregroundGroup:this.foregroundGroup},t.prototype.isPointInPlot=function(r){return oXt(this.getCoordinate(),r)},t.prototype.getLegendAttributes=function(){return rh(this.geometries.map(function(r){return r.getGroupAttributes()}))},t.prototype.getGroupScales=function(){var r=this.geometries.map(function(n){return n.getGroupScales()});return Bm(rh(r))},t.prototype.getCanvas=function(){return this.getRootView().canvas},t.prototype.getRootView=function(){for(var r=this;;){if(r.parent){r=r.parent;continue}break}return r},t.prototype.getXY=function(r){var n=this.getCoordinate(),i=this.getScalesByDim("x"),a=this.getScalesByDim("y"),o,s;if(ft(r,function(l,u){i[u]&&(o=i[u].scale(l)),a[u]&&(s=a[u].scale(l))}),!ze(o)&&!ze(s))return n.convert({x:o,y:s})},t.prototype.getController=function(r){return Xf(this.controllers,function(n){return n.name===r})},t.prototype.showTooltip=function(r){var n=this.getController("tooltip");return n&&n.showTooltip(r),this},t.prototype.hideTooltip=function(){var r=this.getController("tooltip");return r&&r.hideTooltip(),this},t.prototype.lockTooltip=function(){var r=this.getController("tooltip");return r&&r.lockTooltip(),this},t.prototype.unlockTooltip=function(){var r=this.getController("tooltip");return r&&r.unlockTooltip(),this},t.prototype.isTooltipLocked=function(){var r=this.getController("tooltip");return r&&r.isTooltipLocked()},t.prototype.getTooltipItems=function(r){var n=this.getController("tooltip");return n?n.getTooltipItems(r):[]},t.prototype.getSnapRecords=function(r){for(var n=this.geometries,i=[],a=0,o=n.length;a<o;a++){var s=n[a],l=s.dataArray;s.sort(l);for(var u=void 0,c=0,f=l.length;c<f;c++){var d=l[c];u=Cnt(r,d,s),u&&i.push(u)}}for(var v=this.views,a=0,o=v.length;a<o;a++){var g=v[a],x=g.getSnapRecords(r);i=i.concat(x)}return i},t.prototype.getComponents=function(){for(var r=[],n=this.controllers,i=0,a=n.length;i<a;i++){var o=n[i];r=r.concat(o.getComponents())}return r},t.prototype.filterData=function(r){var n=this.options.filters;return il(n)===0?r:Al(r,function(i,a){var o=Object.keys(n);return o.every(function(s){var l=n[s];return l(i[s],i,a)})})},t.prototype.filterFieldData=function(r,n){var i=this.options.filters,a=xt(i,r);return Gl(a)?n:n.filter(function(o,s){return a(o[r],o,s)})},t.prototype.adjustCoordinate=function(){var r=this.getCoordinate(),n=r.start,i=r.end,a=this.coordinateBBox.bl,o=this.coordinateBBox.tr;if(Di(n,a)&&Di(i,o)){this.isCoordinateChanged=!1;return}this.isCoordinateChanged=!0,this.coordinateInstance=this.coordinateController.adjust(a,o)},t.prototype.paint=function(r){this.renderDataRecursive(r),this.syncScale(),this.emit(pi.BEFORE_PAINT),this.renderPaddingRecursive(r),this.renderLayoutRecursive(r),this.renderBackgroundStyleShape(),this.renderPaintRecursive(r),this.emit(pi.AFTER_PAINT),this.isDataChanged=!1},t.prototype.renderBackgroundStyleShape=function(){if(!this.parent){var r=xt(this.themeObject,"background");if(r){this.backgroundStyleRectShape||(this.backgroundStyleRectShape=this.backgroundGroup.addShape("rect",{attrs:{},zIndex:-1,capture:!1}),this.backgroundStyleRectShape.toBack());var n=this.viewBBox,i=n.x,a=n.y,o=n.width,s=n.height;this.backgroundStyleRectShape.attr({fill:r,x:i,y:a,width:o,height:s})}else this.backgroundStyleRectShape&&(this.backgroundStyleRectShape.remove(!0),this.backgroundStyleRectShape=void 0)}},t.prototype.renderPaddingRecursive=function(r){this.calculateViewBBox(),this.adjustCoordinate(),this.initComponents(r),this.autoPadding=djt(this).shrink(NN(this.appendPadding)),this.coordinateBBox=this.viewBBox.shrink(this.autoPadding.getPadding()),this.adjustCoordinate();var n=this.controllers.find(function(l){return l.name==="tooltip"});n.update();for(var i=this.views,a=0,o=i.length;a<o;a++){var s=i[a];s.renderPaddingRecursive(r)}},t.prototype.renderLayoutRecursive=function(r){var n=this.syncViewPadding===!0?pjt:Rr(this.syncViewPadding)?this.syncViewPadding:void 0;n&&(n(this,this.views,mM),this.views.forEach(function(l){l.coordinateBBox=l.viewBBox.shrink(l.autoPadding.getPadding()),l.adjustCoordinate()})),this.doLayout();for(var i=this.views,a=0,o=i.length;a<o;a++){var s=i[a];s.renderLayoutRecursive(r)}},t.prototype.renderPaintRecursive=function(r){var n=this.middleGroup;if(this.limitInPlot){var i=ON(this.coordinateInstance),a=i.type,o=i.attrs;n.setClip({type:a,attrs:o})}else n.setClip(void 0);this.paintGeometries(r),this.renderComponents(r);for(var s=this.views,l=0,u=s.length;l<u;l++){var c=s[l];c.renderPaintRecursive(r)}},t.prototype.createScale=function(r,n,i,a){var o=xt(this.options.scales,[r]),s=$($({},o),i);return this.parent?this.parent.createScale(r,n,s,a):this.scalePool.createScale(r,n,s,a)},t.prototype.renderDataRecursive=function(r){this.doFilterData(),this.createCoordinate(),this.initGeometries(r),this.renderFacet(r);for(var n=this.views,i=0,a=n.length;i<a;i++){var o=n[i];o.renderDataRecursive(r)}},t.prototype.calculateViewBBox=function(){var r,n,i,a;if(this.parent){var o=this.parent.coordinateBBox;r=o.x,n=o.y,i=o.width,a=o.height}else r=0,n=0,i=this.canvas.get("width"),a=this.canvas.get("height");var s=this.region,l=s.start,u=s.end,c=new uc(r+i*l.x,n+a*l.y,i*(u.x-l.x),a*(u.y-l.y));(!this.viewBBox||!this.viewBBox.isEqual(c))&&(this.viewBBox=new uc(r+i*l.x,n+a*l.y,i*(u.x-l.x),a*(u.y-l.y))),this.coordinateBBox=this.viewBBox},t.prototype.initEvents=function(){this.foregroundGroup.on("*",this.onDelegateEvents),this.middleGroup.on("*",this.onDelegateEvents),this.backgroundGroup.on("*",this.onDelegateEvents),this.canvas.on("*",this.onCanvasEvent)},t.prototype.initComponentController=function(){for(var r=this.usedControllers,n=0,i=r.length;n<i;n++){var a=r[n],o=ujt(a);o&&this.controllers.push(new o(this))}},t.prototype.createViewEvent=function(r){var n=r.shape,i=r.name,a=n?n.get("origin"):null,o=new To(this,r,a);return o.type=i,o},t.prototype.doPlotEvent=function(r){var n=r.type,i=r.x,a=r.y,o={x:i,y:a},s=["mousedown","mouseup","mousemove","mouseleave","mousewheel","touchstart","touchmove","touchend","touchcancel","click","dblclick","contextmenu"];if(s.includes(n)){var l=this.isPointInPlot(o),u=r.clone();if(l){var c="plot:".concat(n);u.type=c,this.emit(c,u),(n==="mouseleave"||n==="touchend")&&(this.isPreMouseInPlot=!1)}n==="mousemove"||n==="touchmove"?(this.isPreMouseInPlot&&!l?(n==="mousemove"&&(u.type=Dc.MOUSE_LEAVE,this.emit(Dc.MOUSE_LEAVE,u)),u.type=Dc.LEAVE,this.emit(Dc.LEAVE,u)):!this.isPreMouseInPlot&&l&&(n==="mousemove"&&(u.type=Dc.MOUSE_ENTER,this.emit(Dc.MOUSE_ENTER,u)),u.type=Dc.ENTER,this.emit(Dc.ENTER,u)),this.isPreMouseInPlot=l):(n==="mouseleave"||n==="touchend")&&this.isPreMouseInPlot&&(n==="mouseleave"&&(u.type=Dc.MOUSE_LEAVE,this.emit(Dc.MOUSE_LEAVE,u)),u.type=Dc.LEAVE,this.emit(Dc.LEAVE,u),this.isPreMouseInPlot=!1)}},t.prototype.doFilterData=function(){var r=this.options.data;this.filteredData=this.filterData(r)},t.prototype.initGeometries=function(r){this.createOrUpdateScales();for(var n=this.getCoordinate(),i=xt(this.options,"scales",{}),a=this.geometries,o=0,s=a.length;o<s;o++){var l=a[o];l.scales=this.getGeometryScales();var u={coordinate:n,scaleDefs:i,data:this.filteredData,theme:this.themeObject,isDataChanged:this.isDataChanged,isCoordinateChanged:this.isCoordinateChanged};r?l.update(u):l.init(u)}this.adjustScales()},t.prototype.createOrUpdateScales=function(){for(var r=this.getScaleFields(),n=this.getGroupedFields(),i=this.getOptions(),a=i.data,o=i.scales,s=o===void 0?{}:o,l=this.filteredData,u=0,c=r.length;u<c;u++){var f=r[u],d=s[f],v=this.getScaleKey(f);this.createScale(f,n.includes(f)?a:l,d,v),this.createdScaleKeys.set(v,!0)}},t.prototype.syncScale=function(){this.getRootView().scalePool.sync(this.getCoordinate(),this.theme)},t.prototype.getGeometryScales=function(){for(var r=this.getScaleFields(),n={},i=0;i<r.length;i++){var a=r[i];n[a]=this.getScaleByField(a)}return n},t.prototype.getScaleFields=function(){for(var r=[],n=new Map,i=this.geometries,a=0;a<i.length;a++){var o=i[a],s=o.getScaleFields();Bm(s,r,n)}return r},t.prototype.getGroupedFields=function(){for(var r=[],n=new Map,i=this.geometries,a=0;a<i.length;a++){var o=i[a],s=o.getGroupFields();Bm(s,r,n)}return r},t.prototype.adjustScales=function(){this.adjustCategoryScaleRange()},t.prototype.adjustCategoryScaleRange=function(){var r=this,n=on([this.getXScale()],Pr(this.getYScales()),!1).filter(function(o){return!!o}),i=this.getCoordinate(),a=this.options.scales;ft(n,function(o){var s=o.field,l=o.values,u=o.isCategory,c=o.isIdentity;(u||c)&&l&&!xt(a,[s,"range"])&&(o.range=rnt(o,i,r.theme))})},t.prototype.initComponents=function(r){for(var n=this.controllers,i=0;i<n.length;i++){var a=n[i];r?a.update():(a.clear(),a.render())}},t.prototype.doLayout=function(){this.layoutFunc(this)},t.prototype.createCoordinate=function(){var r=this.coordinateBBox.bl,n=this.coordinateBBox.tr;this.coordinateInstance=this.coordinateController.create(r,n)},t.prototype.paintGeometries=function(r){for(var n=this.options.animate,i=this.getCoordinate(),a={x:this.viewBBox.x,y:this.viewBBox.y,minX:this.viewBBox.minX,minY:this.viewBBox.minY,maxX:this.viewBBox.maxX,maxY:this.viewBBox.maxY,width:this.viewBBox.width,height:this.viewBBox.height},o=this.geometries,s=0;s<o.length;s++){var l=o[s];l.coordinate=i,l.canvasRegion=a,n||l.animate(!1),l.paint(r)}},t.prototype.renderComponents=function(r){for(var n=this.getComponents(),i=0;i<n.length;i++){var a=n[i];a.component.render()}},t.prototype.renderFacet=function(r){this.facetInstance&&(r?this.facetInstance.update():(this.facetInstance.clear(),this.facetInstance.init(),this.facetInstance.render()))},t.prototype.initOptions=function(){var r=this,n=this.options,i=n.geometries,a=i===void 0?[]:i,o=n.interactions,s=o===void 0?[]:o,l=n.views,u=l===void 0?[]:l,c=n.annotations,f=c===void 0?[]:c,d=n.coordinate,v=n.events,g=n.facets;this.coordinateController?d&&this.coordinateController.update(d):this.coordinateController=new cjt(d);for(var x=0;x<a.length;x++){var w=a[x];this.createGeometry(w)}for(var S=0;S<s.length;S++){var M=s[S],R=M.type,I=M.cfg;this.interaction(R,I)}for(var P=0;P<u.length;P++){var k=u[P];this.createView(k)}for(var z=this.getController("annotation"),G=0;G<f.length;G++){var J=f[G];z.annotation(J)}v&&ft(v,function(Z,X){r.on(X,Z)}),g&&ft(g,function(Z){var X=Z.type,et=fi(Z,["type"]);r.facet(X,et)})},t.prototype.createGeometry=function(r){var n=r.type,i=r.cfg,a=i===void 0?{}:i;if(this[n]){var o=this[n](a);ft(r,function(s,l){Rr(o[l])&&o[l](s)})}},t.prototype.getScaleKey=function(r){return"".concat(this.id,"-").concat(r)},t}(iN);function uv(e,t){Snt.prototype[e.toLowerCase()]=function(r){r===void 0&&(r={});var n=$({container:this.middleGroup.addGroup(),labelsContainer:this.foregroundGroup.addGroup()},r),i=new t(n);return this.geometries.push(i),i}}var vjt=function(e){$t(t,e);function t(r){var n=this,i=r.container,a=r.width,o=r.height,s=r.autoFit,l=s===void 0?!1:s,u=r.padding,c=r.appendPadding,f=r.renderer,d=f===void 0?"canvas":f,v=r.pixelRatio,g=r.localRefresh,x=g===void 0?!0:g,w=r.visible,S=w===void 0?!0:w,M=r.supportCSSTransform,R=M===void 0?!1:M,I=r.defaultInteractions,P=I===void 0?["tooltip","legend-filter","legend-active","continuous-filter","ellipsis-text","axis-description"]:I,k=r.options,z=r.limitInPlot,G=r.theme,J=r.syncViewPadding,Z=en(i)?document.getElementById(i):i,X=hg('<div style="position:relative;"></div>');Z.appendChild(X);var et=lV(Z,l,a,o),at=l$t(d),wt=new at.Canvas($({container:X,pixelRatio:v,localRefresh:x,supportCSSTransform:R},et));return n=e.call(this,{parent:null,canvas:wt,backgroundGroup:wt.addGroup({zIndex:Tx.BG}),middleGroup:wt.addGroup({zIndex:Tx.MID}),foregroundGroup:wt.addGroup({zIndex:Tx.FORE}),padding:u,appendPadding:c,visible:S,options:k,limitInPlot:z,theme:G,syncViewPadding:J})||this,n.onResize=rN(function(){n.forceFit()},300),n.ele=Z,n.canvas=wt,n.width=et.width,n.height=et.height,n.autoFit=l,n.localRefresh=x,n.renderer=d,n.wrapperElement=X,n.updateCanvasStyle(),n.bindAutoFit(),n.initDefaultInteractions(P),n}return t.prototype.initDefaultInteractions=function(r){var n=this;ft(r,function(i){n.interaction(i)})},t.prototype.aria=function(r){var n="aria-label";r===!1?this.ele.removeAttribute(n):this.ele.setAttribute(n,r.label)},t.prototype.changeSize=function(r,n){return this.width===r&&this.height===n?this:(this.emit(pi.BEFORE_CHANGE_SIZE),this.width=r,this.height=n,this.canvas.changeSize(r,n),this.render(!0),this.emit(pi.AFTER_CHANGE_SIZE),this)},t.prototype.clear=function(){e.prototype.clear.call(this),this.aria(!1)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.unbindAutoFit(),this.canvas.destroy(),p$t(this.wrapperElement),this.wrapperElement=null},t.prototype.changeVisible=function(r){return e.prototype.changeVisible.call(this,r),this.wrapperElement.style.display=r?"":"none",this},t.prototype.forceFit=function(){if(!this.destroyed){var r=lV(this.ele,!0,this.width,this.height),n=r.width,i=r.height;this.changeSize(n,i)}},t.prototype.updateCanvasStyle=function(){za(this.canvas.get("el"),{display:"inline-block",verticalAlign:"middle"})},t.prototype.bindAutoFit=function(){this.autoFit&&window.addEventListener("resize",this.onResize)},t.prototype.unbindAutoFit=function(){this.autoFit&&window.removeEventListener("resize",this.onResize)},t}(Snt),Vb=function(){function e(t){this.visible=!0,this.components=[],this.view=t}return e.prototype.clear=function(t){ft(this.components,function(r){r.component.destroy()}),this.components=[]},e.prototype.destroy=function(){this.clear()},e.prototype.getComponents=function(){return this.components},e.prototype.changeVisible=function(t){this.visible!==t&&(this.components.forEach(function(r){t?r.component.show():r.component.hide()}),this.visible=t)},e}();function gjt(e){for(var t=[],r=function(i){var a=e[i],o=Xf(t,function(s){return s.color===a.color&&s.name===a.name&&s.value===a.value&&s.title===a.title});o||t.push(a)},n=0;n<e.length;n++)r(n);return t}var Tnt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.isLocked=!1,r}return Object.defineProperty(t.prototype,"name",{get:function(){return"tooltip"},enumerable:!1,configurable:!0}),t.prototype.init=function(){},t.prototype.isVisible=function(){var r=this.view.getOptions().tooltip;return r!==!1},t.prototype.render=function(){},t.prototype.showTooltip=function(r){if(this.point=r,!!this.isVisible()){var n=this.view,i=this.getTooltipItems(r);if(!i.length){this.hideTooltip();return}var a=this.getTitle(i),o={x:i[0].x,y:i[0].y};n.emit("tooltip:show",To.fromData(n,"tooltip:show",$({items:i,title:a},r)));var s=this.getTooltipCfg(),l=s.follow,u=s.showMarkers,c=s.showCrosshairs,f=s.showContent,d=s.marker,v=this.items,g=this.title;if(!Di(g,a)||!Di(v,i)?(n.emit("tooltip:change",To.fromData(n,"tooltip:change",$({items:i,title:a},r))),(Rr(f)?f(i):f)&&(this.tooltip||this.renderTooltip(),this.tooltip.update(Qi({},s,{items:this.getItemsAfterProcess(i),title:a},l?r:{})),this.tooltip.show()),u&&this.renderTooltipMarkers(i,d)):(this.tooltip&&l&&(this.tooltip.update(r),this.tooltip.show()),this.tooltipMarkersGroup&&this.tooltipMarkersGroup.show()),this.items=i,this.title=a,c){var x=xt(s,["crosshairs","follow"],!1);this.renderCrosshairs(x?r:o,s)}}},t.prototype.hideTooltip=function(){var r=this.getTooltipCfg().follow;if(!r){this.point=null;return}var n=this.tooltipMarkersGroup;n&&n.hide();var i=this.xCrosshair,a=this.yCrosshair;i&&i.hide(),a&&a.hide();var o=this.tooltip;o&&o.hide(),this.view.emit("tooltip:hide",To.fromData(this.view,"tooltip:hide",{})),this.point=null},t.prototype.lockTooltip=function(){this.isLocked=!0,this.tooltip&&this.tooltip.setCapture(!0)},t.prototype.unlockTooltip=function(){this.isLocked=!1;var r=this.getTooltipCfg();this.tooltip&&this.tooltip.setCapture(r.capture)},t.prototype.isTooltipLocked=function(){return this.isLocked},t.prototype.clear=function(){var r=this,n=r.tooltip,i=r.xCrosshair,a=r.yCrosshair,o=r.tooltipMarkersGroup;n&&(n.hide(),n.clear()),i&&i.clear(),a&&a.clear(),o&&o.clear(),n!=null&&n.get("customContent")&&(this.tooltip.destroy(),this.tooltip=null),this.title=null,this.items=null},t.prototype.destroy=function(){this.tooltip&&this.tooltip.destroy(),this.xCrosshair&&this.xCrosshair.destroy(),this.yCrosshair&&this.yCrosshair.destroy(),this.guideGroup&&this.guideGroup.remove(!0),this.reset()},t.prototype.reset=function(){this.items=null,this.title=null,this.tooltipMarkersGroup=null,this.tooltipCrosshairsGroup=null,this.xCrosshair=null,this.yCrosshair=null,this.tooltip=null,this.guideGroup=null,this.isLocked=!1,this.point=null},t.prototype.changeVisible=function(r){if(this.visible!==r){var n=this,i=n.tooltip,a=n.tooltipMarkersGroup,o=n.xCrosshair,s=n.yCrosshair;r?(i&&i.show(),a&&a.show(),o&&o.show(),s&&s.show()):(i&&i.hide(),a&&a.hide(),o&&o.hide(),s&&s.hide()),this.visible=r}},t.prototype.getTooltipItems=function(r){var n,i,a,o,s,l,u=this.findItemsFromView(this.view,r);if(u.length){u=rh(u);try{for(var c=yi(u),f=c.next();!f.done;f=c.next()){var d=f.value;try{for(var v=(a=void 0,yi(d)),g=v.next();!g.done;g=v.next()){var x=g.value,w=x.mappingData,S=w.x,M=w.y;x.x=Fe(S)?S[S.length-1]:S,x.y=Fe(M)?M[M.length-1]:M}}catch(Z){a={error:Z}}finally{try{g&&!g.done&&(o=v.return)&&o.call(v)}finally{if(a)throw a.error}}}}catch(Z){n={error:Z}}finally{try{f&&!f.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}var R=this.getTooltipCfg().shared;if(R===!1&&u.length>1){var I=u[0],P=Math.abs(r.y-I[0].y);try{for(var k=yi(u),z=k.next();!z.done;z=k.next()){var G=z.value,J=Math.abs(r.y-G[0].y);J<=P&&(I=G,P=J)}}catch(Z){s={error:Z}}finally{try{z&&!z.done&&(l=k.return)&&l.call(k)}finally{if(s)throw s.error}}u=[I]}return gjt(rh(u))}return[]},t.prototype.layout=function(){},t.prototype.update=function(){if(this.point&&this.showTooltip(this.point),this.tooltip){var r=this.view.getCanvas();this.tooltip.set("region",{start:{x:0,y:0},end:{x:r.get("width"),y:r.get("height")}})}},t.prototype.isCursorEntered=function(r){if(this.tooltip){var n=this.tooltip.getContainer(),i=this.tooltip.get("capture");if(n&&i){var a=n.getBoundingClientRect(),o=a.x,s=a.y,l=a.width,u=a.height;return new uc(o,s,l,u).isPointIn(r)}}return!1},t.prototype.getTooltipCfg=function(){var r=this.view,n=r.getOptions().tooltip,i=this.processCustomContent(n),a=r.getTheme(),o=xt(a,["components","tooltip"],{}),s=xt(i,"enterable",o.enterable);return Tr({},o,i,{capture:!!(s||this.isLocked)})},t.prototype.processCustomContent=function(r){if(bg(r)||!xt(r,"customContent"))return r;var n=r.customContent,i=function(a,o){var s=n(a,o)||"";return en(s)?'<div class="g2-tooltip">'+s+"</div>":s};return $($({},r),{customContent:i})},t.prototype.getTitle=function(r){var n=r[0].title||r[0].name;return this.title=n,n},t.prototype.renderTooltip=function(){var r=this.view.getCanvas(),n={start:{x:0,y:0},end:{x:r.get("width"),y:r.get("height")}},i=this.getTooltipCfg(),a=new p3($($({parent:r.get("el").parentNode,region:n},i),{visible:!1,crosshairs:null}));a.init(),this.tooltip=a},t.prototype.renderTooltipMarkers=function(r,n){var i,a,o=this.getTooltipMarkersGroup(),s=this.view.getRootView(),l=s.limitInPlot;try{for(var u=yi(r),c=u.next();!c.done;c=u.next()){var f=c.value,d=f.x,v=f.y;if(l||o!=null&&o.getClip()){var g=ON(s.getCoordinate()),x=g.type,w=g.attrs;o==null||o.setClip({type:x,attrs:w})}else o==null||o.setClip(void 0);var S=this.view.getTheme(),M=xt(S,["components","tooltip","marker"],{}),R=$($({fill:f.color,symbol:"circle",shadowColor:f.color},Rr(n)?$($({},M),n(f)):n),{x:d,y:v});o.addShape("marker",{attrs:R})}}catch(I){i={error:I}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(i)throw i.error}}},t.prototype.renderCrosshairs=function(r,n){var i=xt(n,["crosshairs","type"],"x");i==="x"?(this.yCrosshair&&this.yCrosshair.hide(),this.renderXCrosshairs(r,n)):i==="y"?(this.xCrosshair&&this.xCrosshair.hide(),this.renderYCrosshairs(r,n)):i==="xy"&&(this.renderXCrosshairs(r,n),this.renderYCrosshairs(r,n))},t.prototype.renderXCrosshairs=function(r,n){var i=this.getViewWithGeometry(this.view).getCoordinate(),a,o;if(i.isRect)i.isTransposed?(a={x:i.start.x,y:r.y},o={x:i.end.x,y:r.y}):(a={x:r.x,y:i.end.y},o={x:r.x,y:i.start.y});else{var s=sb(i,r),l=i.getCenter(),u=i.getRadius();o=Ps(l.x,l.y,u,s),a=l}var c=Tr({start:a,end:o,container:this.getTooltipCrosshairsGroup()},xt(n,"crosshairs",{}),this.getCrosshairsText("x",r,n));delete c.type;var f=this.xCrosshair;f?f.update(c):(f=new $rt(c),f.init()),f.render(),f.show(),this.xCrosshair=f},t.prototype.renderYCrosshairs=function(r,n){var i=this.getViewWithGeometry(this.view).getCoordinate(),a,o;if(i.isRect){var s=void 0,l=void 0;i.isTransposed?(s={x:r.x,y:i.end.y},l={x:r.x,y:i.start.y}):(s={x:i.start.x,y:r.y},l={x:i.end.x,y:r.y}),a={start:s,end:l},o="Line"}else a={center:i.getCenter(),radius:v3(i,r),startAngle:i.startAngle,endAngle:i.endAngle},o="Circle";a=Tr({container:this.getTooltipCrosshairsGroup()},a,xt(n,"crosshairs",{}),this.getCrosshairsText("y",r,n)),delete a.type;var u=this.yCrosshair;u?i.isRect&&u.get("type")==="circle"||!i.isRect&&u.get("type")==="line"?(u=new NF[o](a),u.init()):u.update(a):(u=new NF[o](a),u.init()),u.render(),u.show(),this.yCrosshair=u},t.prototype.getCrosshairsText=function(r,n,i){var a=xt(i,["crosshairs","text"]),o=xt(i,["crosshairs","follow"]),s=this.items;if(a){var l=this.getViewWithGeometry(this.view),u=s[0],c=l.getXScale(),f=l.getYScales()[0],d=void 0,v=void 0;if(o){var g=this.view.getCoordinate().invert(n);d=c.invert(g.x),v=f.invert(g.y)}else d=u.data[c.field],v=u.data[f.field];var x=r==="x"?d:v;return Rr(a)?a=a(r,x,s,n):a.content=x,{text:a}}},t.prototype.getGuideGroup=function(){if(!this.guideGroup){var r=this.view.foregroundGroup;this.guideGroup=r.addGroup({name:"tooltipGuide",capture:!1})}return this.guideGroup},t.prototype.getTooltipMarkersGroup=function(){var r=this.tooltipMarkersGroup;return r&&!r.destroyed?(r.clear(),r.show()):(r=this.getGuideGroup().addGroup({name:"tooltipMarkersGroup"}),r.toFront(),this.tooltipMarkersGroup=r),r},t.prototype.getTooltipCrosshairsGroup=function(){var r=this.tooltipCrosshairsGroup;return r||(r=this.getGuideGroup().addGroup({name:"tooltipCrosshairsGroup",capture:!1}),r.toBack(),this.tooltipCrosshairsGroup=r),r},t.prototype.findItemsFromView=function(r,n){var i,a;if(r.getOptions().tooltip===!1)return[];var o=this.getTooltipCfg(),s=$F(r,n,o);try{for(var l=yi(r.views),u=l.next();!u.done;u=l.next()){var c=u.value;s=s.concat(this.findItemsFromView(c,n))}}catch(f){i={error:f}}finally{try{u&&!u.done&&(a=l.return)&&a.call(l)}finally{if(i)throw i.error}}return s},t.prototype.getViewWithGeometry=function(r){var n=this;return r.geometries.length?r:Xf(r.views,function(i){return n.getViewWithGeometry(i)})},t.prototype.getItemsAfterProcess=function(r){var n=this.getTooltipCfg().customItems,i=n||function(a){return a};return i(r)},t}(Vb),Ant={};function Mnt(e){return Ant[e.toLowerCase()]}function Qh(e,t){Ant[e.toLowerCase()]=t}var ub={appear:{duration:450,easing:"easeQuadOut"},update:{duration:400,easing:"easeQuadInOut"},enter:{duration:400,easing:"easeQuadInOut"},leave:{duration:350,easing:"easeQuadIn"}},mjt={interval:function(e){return{enter:{animation:e.isRect?e.isTransposed?"scale-in-x":"scale-in-y":"fade-in"},update:{animation:e.isPolar&&e.isTransposed?"sector-path-update":null},leave:{animation:"fade-out"}}},line:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},path:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},point:{appear:{animation:"zoom-in"},enter:{animation:"zoom-in"},leave:{animation:"zoom-out"}},area:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},polygon:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},schema:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},edge:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},label:{appear:{animation:"fade-in",delay:450},enter:{animation:"fade-in"},update:{animation:"position-update"},leave:{animation:"fade-out"}}},OG={line:function(){return{animation:"wave-in"}},area:function(){return{animation:"wave-in"}},path:function(){return{animation:"fade-in"}},interval:function(e){var t;return e.isRect?t=e.isTransposed?"grow-in-x":"grow-in-y":(t="grow-in-xy",e.isPolar&&e.isTransposed&&(t="wave-in")),{animation:t}},schema:function(e){var t;return e.isRect?t=e.isTransposed?"grow-in-x":"grow-in-y":t="grow-in-xy",{animation:t}},polygon:function(){return{animation:"fade-in",duration:500}},edge:function(){return{animation:"fade-in"}}};function yjt(e,t){return{delay:Rr(e.delay)?e.delay(t):e.delay,easing:Rr(e.easing)?e.easing(t):e.easing,duration:Rr(e.duration)?e.duration(t):e.duration,callback:e.callback,repeat:e.repeat}}function Rnt(e,t,r){var n=mjt[e];return n&&(Rr(n)&&(n=n(t)),n=Tr({},ub,n),r)?n[r]:n}function Mx(e,t,r){var n=xt(e.get("origin"),"data",Pa),i=t.animation,a=yjt(t,n);if(i){var o=Mnt(i);o&&o(e,a,r)}else e.animate(r.toAttrs,a)}function _jt(e,t,r,n,i){if(OG[r]){var a=OG[r](n),o=Mnt(xt(a,"animation",""));if(o){var s=$($($({},ub.appear),a),t);e.stopAnimate(),o(e,s,{coordinate:n,minYPoint:i,toAttrs:null})}}}var zN="element-background",Int=function(e){$t(t,e);function t(r){var n=e.call(this,r)||this;n.labelShape=[],n.states=[];var i=r.shapeFactory,a=r.container,o=r.offscreenGroup,s=r.elementIndex,l=r.visible,u=l===void 0?!0:l;return n.shapeFactory=i,n.container=a,n.offscreenGroup=o,n.visible=u,n.elementIndex=s,n}return t.prototype.draw=function(r,n){n===void 0&&(n=!1),this.model=r,this.data=r.data,this.shapeType=this.getShapeType(r),this.drawShape(r,n),this.visible===!1&&this.changeVisible(!1)},t.prototype.update=function(r){var n=this,i=n.shapeFactory,a=n.shape;if(a){this.model=r,this.data=r.data,this.shapeType=this.getShapeType(r),this.setShapeInfo(a,r);var o=this.getOffscreenGroup(),s=i.drawShape(this.shapeType,r,o);s.cfg.data=this.data,s.cfg.origin=r,s.cfg.element=this,this.syncShapeStyle(a,s,this.getStates(),this.getAnimateCfg("update"))}},t.prototype.destroy=function(){var r=this,n=r.shapeFactory,i=r.shape;if(i){var a=this.getAnimateCfg("leave");a?Mx(i,a,{coordinate:n.coordinate,toAttrs:$({},i.attr())}):i.remove(!0)}this.states=[],this.shapeFactory=void 0,this.container=void 0,this.shape=void 0,this.animate=void 0,this.geometry=void 0,this.labelShape=[],this.model=void 0,this.data=void 0,this.offscreenGroup=void 0,this.statesStyle=void 0,e.prototype.destroy.call(this)},t.prototype.changeVisible=function(r){e.prototype.changeVisible.call(this,r),r?(this.shape&&this.shape.show(),this.labelShape&&this.labelShape.forEach(function(n){n.show()})):(this.shape&&this.shape.hide(),this.labelShape&&this.labelShape.forEach(function(n){n.hide()}))},t.prototype.setState=function(r,n){var i=this,a=i.states,o=i.shapeFactory,s=i.model,l=i.shape,u=i.shapeType,c=a.indexOf(r);if(n){if(c>-1)return;a.push(r),(r==="active"||r==="selected")&&(l==null||l.toFront())}else{if(c===-1)return;if(a.splice(c,1),r==="active"||r==="selected"){var f=this.geometry,d=f.sortZIndex,v=f.zIndexReversed,g=v?this.geometry.elements.length-this.elementIndex:this.elementIndex;d?l.setZIndex(g):l.set("zIndex",g)}}var x=o.drawShape(u,s,this.getOffscreenGroup());a.length?this.syncShapeStyle(l,x,a,null):this.syncShapeStyle(l,x,["reset"],null),x.remove(!0);var w={state:r,stateStatus:n,element:this,target:this.container};this.container.emit("statechange",w),xN(this.shape,"statechange",w)},t.prototype.clearStates=function(){var r=this,n=this.states;ft(n,function(i){r.setState(i,!1)}),this.states=[]},t.prototype.hasState=function(r){return this.states.includes(r)},t.prototype.getStates=function(){return this.states},t.prototype.getData=function(){return this.data},t.prototype.getModel=function(){return this.model},t.prototype.getBBox=function(){var r=this,n=r.shape,i=r.labelShape,a={x:0,y:0,minX:0,minY:0,maxX:0,maxY:0,width:0,height:0};return n&&(a=n.getCanvasBBox()),i&&i.forEach(function(o){var s=o.getCanvasBBox();a.x=Math.min(s.x,a.x),a.y=Math.min(s.y,a.y),a.minX=Math.min(s.minX,a.minX),a.minY=Math.min(s.minY,a.minY),a.maxX=Math.max(s.maxX,a.maxX),a.maxY=Math.max(s.maxY,a.maxY)}),a.width=a.maxX-a.minX,a.height=a.maxY-a.minY,a},t.prototype.getStatesStyle=function(){if(!this.statesStyle){var r=this,n=r.shapeType,i=r.geometry,a=r.shapeFactory,o=i.stateOption,s=a.defaultShapeType,l=a.theme[n]||a.theme[s];this.statesStyle=Tr({},l,o)}return this.statesStyle},t.prototype.getStateStyle=function(r,n){var i=this.getStatesStyle(),a=xt(i,[r,"style"],{}),o=a[n]||a;return Rr(o)?o(this):o},t.prototype.getAnimateCfg=function(r){var n=this,i=this.animate;if(i){var a=i[r];return a&&$($({},a),{callback:function(){var o;Rr(a.callback)&&a.callback(),(o=n.geometry)===null||o===void 0||o.emit(Ym.AFTER_DRAW_ANIMATE)}})}return null},t.prototype.drawShape=function(r,n){var i;n===void 0&&(n=!1);var a=this,o=a.shapeFactory,s=a.container,l=a.shapeType;if(this.shape=o.drawShape(l,r,s),this.shape){this.setShapeInfo(this.shape,r);var u=this.shape.cfg.name;u?en(u)&&(this.shape.cfg.name=["element",u]):this.shape.cfg.name=["element",this.shapeFactory.geometryType];var c=n?"enter":"appear",f=this.getAnimateCfg(c);f&&((i=this.geometry)===null||i===void 0||i.emit(Ym.BEFORE_DRAW_ANIMATE),Mx(this.shape,f,{coordinate:o.coordinate,toAttrs:$({},this.shape.attr())}))}},t.prototype.getOffscreenGroup=function(){if(!this.offscreenGroup){var r=this.container.getGroupBase();this.offscreenGroup=new r({})}return this.offscreenGroup},t.prototype.setShapeInfo=function(r,n){var i=this;if(r.cfg.origin=n,r.cfg.element=this,r.isGroup()){var a=r.get("children");a.forEach(function(o){i.setShapeInfo(o,n)})}},t.prototype.syncShapeStyle=function(r,n,i,a,o){var s=this,l;if(i===void 0&&(i=[]),o===void 0&&(o=0),!(!r||!n)){var u=r.get("clipShape"),c=n.get("clipShape");if(this.syncShapeStyle(u,c,i,a),r.isGroup())for(var f=r.get("children"),d=n.get("children"),v=0;v<f.length;v++)this.syncShapeStyle(f[v],d[v],i,a,o+v);else{if(!cc(i)&&!Di(i,["reset"])){var g=r.get("name");Fe(g)&&(g=g[1]),ft(i,function(w){if(n.get("name")!==zN){var S=s.getStateStyle(w,g||o);n.attr(S)}})}var x=tnt(r,n);this.animate?a?((l=this.geometry)===null||l===void 0||l.emit(Ym.BEFORE_DRAW_ANIMATE),Mx(r,a,{coordinate:this.shapeFactory.coordinate,toAttrs:x,shapeModel:this.model})):cc(i)?r.attr(x):(r.stopAnimate(),r.animate(x,{duration:300})):r.attr(x)}}},t.prototype.getShapeType=function(r){var n=xt(r,"shape");return Fe(n)?n[0]:n},t}(iN),Lnt={},Ont={};function xjt(e){return Lnt[e.toLowerCase()]}function d2(e,t){Lnt[e.toLowerCase()]=t}function bjt(e){return Ont[e.toLowerCase()]}function uh(e,t){Ont[e.toLowerCase()]=t}var Ejt={coordinate:null,defaultShapeType:null,theme:null,getShapePoints:function(e,t){var r=this.getShape(e);return r.getPoints?r.getPoints(t):this.getDefaultPoints(t)},getShape:function(e){var t=this[e]||this[this.defaultShapeType];return t.coordinate=this.coordinate,t},getDefaultPoints:function(){return[]},getDefaultStyle:function(e){return xt(e,[this.defaultShapeType,"default","style"],{})},getMarker:function(e,t){var r=this.getShape(e);if(!r.getMarker){var n=this.defaultShapeType;r=this.getShape(n)}var i=this.theme,a=xt(i,[e,"default"],{}),o=r.getMarker(t);return Tr({},a,o)},drawShape:function(e,t,r){var n=this.getShape(e);return n.draw(t,r)}},wjt={coordinate:null,parsePath:function(e){var t=this.coordinate,r=AXt(e);return t.isPolar?r=CXt(t,r):r=wXt(t,r),r},parsePoint:function(e){var t=this.coordinate;return t.convert(e)},parsePoints:function(e){var t=this.coordinate;return e.map(function(r){return t.convert(r)})},draw:function(e,t){}},UN={};function w0(e,t){var r=E0(e),n=$($($({},Ejt),t),{geometryType:e});return UN[r]=n,n}function fa(e,t,r){var n=E0(e),i=UN[n],a=$($({},wjt),r);return i[t]=a,a}function PG(e){var t=E0(e);return UN[t]}function Cjt(e,t,r){var n,i;if(r===void 0&&(r={}),!t)return[e];var a=Q4(e,t),o=[];if(t.length===1&&r[t[0]]){var s=r[t[0]];try{for(var l=yi(s),u=l.next();!u.done;u=l.next()){var c=u.value,f=a["_".concat(c)];f&&o.push(f)}}catch(g){n={error:g}}finally{try{u&&!u.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}}else for(var d in a)if(a.hasOwnProperty(d)){var v=a[d];o.push(v)}return o}function Pnt(e,t){return XS(["color","shape","size","x","y","isInCircle","data","style","defaultStyle","points","mappingData"],function(r){return!Di(e[r],t[r])})}function fw(e){return Fe(e)?e:e.split("*")}function Dnt(e,t){for(var r=[],n=[],i=[],a=new Map,o=0;o<t.length;o++){var s=t[o];e[s]?n.push(s):r.push(s),a.set(s,!0)}return Object.keys(e).forEach(function(l){a.has(l)||i.push(l)}),{added:r,updated:n,removed:i}}var C0=function(e){$t(t,e);function t(r){var n=e.call(this,r)||this;n.type="base",n.attributes={},n.elements=[],n.elementsMap={},n.animateOption=!0,n.attributeOption={},n.lastElementsMap={},n.generatePoints=!1,n.beforeMappingData=null,n.adjusts={},n.idFields=[],n.hasSorted=!1,n.isCoordinateChanged=!1;var i=r.container,a=r.labelsContainer,o=r.coordinate,s=r.data,l=r.sortable,u=l===void 0?!1:l,c=r.visible,f=c===void 0?!0:c,d=r.theme,v=r.scales,g=v===void 0?{}:v,x=r.scaleDefs,w=x===void 0?{}:x,S=r.intervalPadding,M=r.dodgePadding,R=r.maxColumnWidth,I=r.minColumnWidth,P=r.columnWidthRatio,k=r.roseWidthRatio,z=r.multiplePieWidthRatio,G=r.zIndexReversed,J=r.sortZIndex,Z=r.useDeferredLabel;return n.container=i,n.labelsContainer=a,n.coordinate=o,n.data=s,n.sortable=u,n.visible=f,n.userTheme=d,n.scales=g,n.scaleDefs=w,n.intervalPadding=S,n.dodgePadding=M,n.maxColumnWidth=R,n.minColumnWidth=I,n.columnWidthRatio=P,n.roseWidthRatio=k,n.multiplePieWidthRatio=z,n.zIndexReversed=G,n.sortZIndex=J,n.useDeferredLabel=Z?typeof Z=="number"?Z:1/0:null,n}return t.prototype.position=function(r){var n=r;Hd(r)||(n={fields:fw(r)});var i=xt(n,"fields");return i.length===1&&(i.unshift("1"),Is(n,"fields",i)),Is(this.attributeOption,"position",n),this},t.prototype.color=function(r,n){return this.createAttrOption("color",r,n),this},t.prototype.shape=function(r,n){return this.createAttrOption("shape",r,n),this},t.prototype.size=function(r,n){return this.createAttrOption("size",r,n),this},t.prototype.adjust=function(r){var n=r;return(en(r)||Hd(r))&&(n=[r]),ft(n,function(i,a){Xi(i)||(n[a]={type:i})}),this.adjustOption=n,this},t.prototype.style=function(r,n){if(en(r)){var i=fw(r);this.styleOption={fields:i,callback:n}}else{var a=r,i=a.fields,o=a.callback,s=a.cfg;i||o||s?this.styleOption=r:this.styleOption={cfg:r}}return this},t.prototype.tooltip=function(r,n){if(en(r)){var i=fw(r);this.tooltipOption={fields:i,callback:n}}else this.tooltipOption=r;return this},t.prototype.animate=function(r){return this.animateOption=r,this},t.prototype.label=function(r,n,i){if(en(r)){var a={},o=fw(r);a.fields=o,Rr(n)?a.callback=n:Hd(n)&&(a.cfg=n),i&&(a.cfg=i),this.labelOption=a}else this.labelOption=r;return this},t.prototype.state=function(r){return this.stateOption=r,this},t.prototype.customInfo=function(r){return this.customOption=r,this},t.prototype.init=function(r){r===void 0&&(r={}),this.setCfg(r),this.initAttributes(),this.processData(this.data),this.adjustScale()},t.prototype.update=function(r){r===void 0&&(r={});var n=r.data,i=r.isDataChanged,a=r.isCoordinateChanged,o=this,s=o.attributeOption,l=o.lastAttributeOption;Di(s,l)?n&&(i||!Di(n,this.data))?(this.setCfg(r),this.initAttributes(),this.processData(n)):this.setCfg(r):this.init(r),this.adjustScale(),this.isCoordinateChanged=a},t.prototype.paint=function(r){var n=this;r===void 0&&(r=!1),this.animateOption&&(this.animateOption=Tr({},Rnt(this.type,this.coordinate),this.animateOption)),this.defaultSize=void 0,this.elementsMap={},this.elements=[];var i=this.getOffscreenGroup();i.clear();var a=this.beforeMappingData,o=this.beforeMapping(a);this.dataArray=new Array(o.length);for(var s=0;s<o.length;s++){var l=o[s];this.dataArray[s]=this.mapping(l)}if(this.updateElements(this.dataArray,r),this.lastElementsMap=this.elementsMap,this.canDoGroupAnimation(r)){var u=this.container,c=this.type,f=this.coordinate,d=xt(this.animateOption,"appear"),v=this.getYScale(),g=f.convert({x:0,y:v.scale(this.getYMinValue())});_jt(u,d,c,f,g)}if(this.labelOption){var x=this.useDeferredLabel,w=(function(){return n.renderLabels(rh(n.dataArray),r)}).bind(this);if(typeof x=="number"){var S=typeof x=="number"&&x!==1/0?x:0;if(!window.requestIdleCallback)setTimeout(w,S);else{var M=S&&S!==1/0?{timeout:S}:void 0;window.requestIdleCallback(w,M)}}else w()}this.lastAttributeOption=$({},this.attributeOption),this.visible===!1&&this.changeVisible(!1)},t.prototype.clear=function(){var r=this,n=r.container,i=r.geometryLabel,a=r.offscreenGroup;n&&n.clear(),i&&i.clear(),a&&a.clear(),this.scaleDefs=void 0,this.attributes={},this.scales={},this.elementsMap={},this.lastElementsMap={},this.elements=[],this.adjusts={},this.dataArray=null,this.beforeMappingData=null,this.lastAttributeOption=void 0,this.defaultSize=void 0,this.idFields=[],this.groupScales=void 0,this.hasSorted=!1,this.isCoordinateChanged=!1},t.prototype.destroy=function(){this.clear();var r=this.container;r.remove(!0),this.offscreenGroup&&(this.offscreenGroup.remove(!0),this.offscreenGroup=null),this.geometryLabel&&(this.geometryLabel.destroy(),this.geometryLabel=null),this.theme=void 0,this.shapeFactory=void 0,e.prototype.destroy.call(this)},t.prototype.getGroupScales=function(){return this.groupScales},t.prototype.getAttribute=function(r){return this.attributes[r]},t.prototype.getXScale=function(){return this.getAttribute("position").scales[0]},t.prototype.getYScale=function(){return this.getAttribute("position").scales[1]},t.prototype.getGroupAttributes=function(){var r=[];return ft(this.attributes,function(n){ux.includes(n.type)&&r.push(n)}),r},t.prototype.getDefaultValue=function(r){var n,i=this.getAttribute(r);return i&&cc(i.scales)&&(n=i.values[0]),n},t.prototype.getAttributeValues=function(r,n){for(var i=[],a=r.scales,o=0,s=a.length;o<s;o++){var l=a[o],u=l.field;l.isIdentity?i.push(l.values):i.push(n[u])}return r.mapping.apply(r,on([],Pr(i),!1))},t.prototype.getAdjust=function(r){return this.adjusts[r]},t.prototype.getCoordinate=function(){return this.coordinate},t.prototype.getData=function(){return this.data},t.prototype.getShapeMarker=function(r,n){var i=this.getShapeFactory();return i.getMarker(r,n)},t.prototype.getElementsBy=function(r){return this.elements.filter(function(n){return r(n)})},t.prototype.getElements=function(){return this.elements},t.prototype.getElementId=function(r){r=Fe(r)?r[0]:r;var n=r[Pa];if(this.idFields.length){for(var i=n[this.idFields[0]],a=1;a<this.idFields.length;a++)i+="-"+n[this.idFields[a]];return i}var o=this.type,s=this.getXScale(),l=this.getYScale(),u=s.field||"x",c=l.field||"y",f=n[c],d;s.type==="identity"?d=s.values[0]:d=n[u];var v;o==="interval"||o==="schema"?v="".concat(d):o==="line"||o==="area"||o==="path"?v=o:v="".concat(d,"-").concat(f);for(var g=this.groupScales,a=0,x=g.length;a<x;a++){var w=g[a],S=w.field;v="".concat(v,"-").concat(n[S])}var M=this.getAdjust("dodge");if(M){var R=M.dodgeBy;R&&(v="".concat(v,"-").concat(n[R]))}return this.getAdjust("jitter")&&(v="".concat(v,"-").concat(r.x,"-").concat(r.y)),v},t.prototype.getScaleFields=function(){var r=[],n=new Map,i=this,a=i.attributeOption,o=i.labelOption,s=i.tooltipOption;for(var l in a)if(a.hasOwnProperty(l)){var u=a[l];u.fields?Bm(u.fields,r,n):u.values&&Bm(u.values,r,n)}return o&&o.fields&&Bm(o.fields,r,n),Xi(s)&&s.fields&&Bm(s.fields,r,n),r},t.prototype.changeVisible=function(r){e.prototype.changeVisible.call(this,r);for(var n=this.elements,i=0,a=n.length;i<a;i++){var o=n[i];o.changeVisible(r)}r?(this.container&&this.container.show(),this.labelsContainer&&this.labelsContainer.show()):(this.container&&this.container.hide(),this.labelsContainer&&this.labelsContainer.hide())},t.prototype.getFields=function(){var r=new Map,n=[];return Object.values(this.attributeOption).forEach(function(i){var a=(i==null?void 0:i.fields)||[];a.forEach(function(o){r.has(o)||n.push(o),r.set(o,!0)})},[]),n},t.prototype.getGroupFields=function(){for(var r=[],n=new Map,i=0,a=ux.length;i<a;i++){var o=ux[i],s=this.attributeOption[o];s&&s.fields&&Bm(s.fields,r,n)}return r},t.prototype.getXYFields=function(){var r=Pr(this.attributeOption.position.fields,2),n=r[0],i=r[1];return[n,i]},t.prototype.getXField=function(){return xt(this.getXYFields(),[0])},t.prototype.getYField=function(){return xt(this.getXYFields(),[1])},t.prototype.getShapes=function(){return this.elements.map(function(r){return r.shape})},t.prototype.getOffscreenGroup=function(){if(!this.offscreenGroup){var r=this.container.getGroupBase();this.offscreenGroup=new r({})}return this.offscreenGroup},t.prototype.sort=function(r){if(!this.hasSorted)for(var n=this.getXScale(),i=n.field,a=0;a<r.length;a++){var o=r[a];o.sort(function(s,l){return n.translate(s[Pa][i])-n.translate(l[Pa][i])})}this.hasSorted=!0},t.prototype.adjustScale=function(){var r=this.getYScale();r&&this.getAdjust("stack")&&this.updateStackRange(r,this.beforeMappingData)},t.prototype.getShapeFactory=function(){var r=this.shapeType;if(PG(r))return this.shapeFactory||(this.shapeFactory=bl(PG(r))),this.shapeFactory.coordinate=this.coordinate,this.shapeFactory.theme=this.theme.geometries[r]||{},this.shapeFactory},t.prototype.createShapePointsCfg=function(r){var n=this.getXScale(),i=this.getYScale(),a=this.normalizeValues(r[n.field],n),o;return i?o=this.normalizeValues(r[i.field],i):o=r.y?r.y:.1,{x:a,y:o,y0:i?i.scale(this.getYMinValue()):void 0}},t.prototype.createElement=function(r,n,i){i===void 0&&(i=!1);var a=this.container,o=this.getDrawCfg(r),s=this.getShapeFactory(),l=new Int({shapeFactory:s,container:a,offscreenGroup:this.getOffscreenGroup(),elementIndex:n});return l.animate=this.animateOption,l.geometry=this,l.draw(o,i),l},t.prototype.getDrawCfg=function(r){var n=r[Pa],i={mappingData:r,data:n,x:r.x,y:r.y,color:r.color,size:r.size,isInCircle:this.coordinate.isPolar,customInfo:this.customOption},a=r.shape;!a&&this.getShapeFactory()&&(a=this.getShapeFactory().defaultShapeType),i.shape=a;var o=this.theme.geometries[this.shapeType];i.defaultStyle=xt(o,[a,"default"],{}).style,!i.defaultStyle&&this.getShapeFactory()&&(i.defaultStyle=this.getShapeFactory().getDefaultStyle(o));var s=this.styleOption;return s&&(i.style=this.getStyleCfg(s,n)),this.generatePoints&&(i.points=r.points,i.nextPoints=r.nextPoints),i},t.prototype.updateElements=function(r,n){var i,a,o,s,l,u;n===void 0&&(n=!1);for(var c=new Map,f=[],d=new Map,v=0,g=0;g<r.length;g++)for(var x=r[g],w=0;w<x.length;w++){var S=x[w],M=this.getElementId(S),R=c.has(M)?"".concat(M,"-").concat(g,"-").concat(w):M;f.push(R),c.set(R,S),d.set(R,v),v++}this.elements=new Array(v);var I=Dnt(this.lastElementsMap,f),P=I.added,k=I.updated,z=I.removed;try{for(var G=yi(P),J=G.next();!J.done;J=G.next()){var M=J.value,S=c.get(M),g=d.get(M),Z=this.createElement(S,g,n);this.elements[g]=Z,this.elementsMap[M]=Z,Z.shape&&Z.shape.set("zIndex",this.zIndexReversed?this.elements.length-g:g)}}catch(zt){i={error:zt}}finally{try{J&&!J.done&&(a=G.return)&&a.call(G)}finally{if(i)throw i.error}}try{for(var X=yi(k),et=X.next();!et.done;et=X.next()){var M=et.value,Z=this.lastElementsMap[M],S=c.get(M),at=this.getDrawCfg(S),wt=Z.getModel(),g=d.get(M);(this.isCoordinateChanged||Pnt(at,wt))&&(Z.animate=this.animateOption,Z.update(at)),this.elements[g]=Z,this.elementsMap[M]=Z,Z.shape&&Z.shape.set("zIndex",this.zIndexReversed?this.elements.length-g:g)}}catch(zt){o={error:zt}}finally{try{et&&!et.done&&(s=X.return)&&s.call(X)}finally{if(o)throw o.error}}this.container&&this.container.sort();try{for(var Tt=yi(z),vt=Tt.next();!vt.done;vt=Tt.next()){var M=vt.value,Z=this.lastElementsMap[M];Z.animate=this.animateOption,Z.destroy()}}catch(zt){l={error:zt}}finally{try{vt&&!vt.done&&(u=Tt.return)&&u.call(Tt)}finally{if(l)throw l.error}}},t.prototype.getLabelType=function(){var r=this,n=r.labelOption,i=r.coordinate,a=r.type,o=i.type,s=i.isTransposed,l=xt(n,["cfg","type"]);return l||(o==="polar"?l=s?"pie":"polar":o==="theta"?l="pie":a==="interval"||a==="polygon"?l="interval":l="base"),l},t.prototype.getYMinValue=function(){var r=this.getYScale(),n=r.min,i=r.max,a;return n>=0?a=n:i<=0?a=i:a=0,a},t.prototype.createAttrOption=function(r,n,i){if(ze(n)||Xi(n))Xi(n)&&Di(Object.keys(n),["values"])?Is(this.attributeOption,r,{fields:n.values}):Is(this.attributeOption,r,n);else{var a={};Rn(n)?a.values=[n]:a.fields=fw(n),i&&(Rr(i)?a.callback=i:a.values=i),Is(this.attributeOption,r,a)}},t.prototype.initAttributes=function(){var r=this,n=this,i=n.attributes,a=n.attributeOption,o=n.theme,s=n.shapeType;this.groupScales=[];var l={},u=function(d){if(a.hasOwnProperty(d)){var v=a[d];if(!v)return{value:void 0};var g=$({},v),x=g.callback,w=g.values,S=g.fields,M=S===void 0?[]:S,R=M.map(function(P){var k=r.scales[P];if(!l[P]&&ux.includes(d)){var z=ent(k,xt(r.scaleDefs,P),d,r.type);z==="cat"&&(r.groupScales.push(k),l[P]=!0)}return k});g.scales=R,d!=="position"&&R.length===1&&R[0].type==="identity"?g.values=R[0].values:!x&&!w&&(d==="size"?g.values=o.sizes:d==="shape"?g.values=o.shapes[s]||[]:d==="color"&&(R.length?g.values=R[0].values.length<=10?o.colors10:o.colors20:g.values=o.colors10));var I=_N(d);i[d]=new I(g)}};for(var c in a){var f=u(c);if(typeof f=="object")return f.value}},t.prototype.processData=function(r){var n,i;this.hasSorted=!1;for(var a=this.getAttribute("position").scales,o=a.filter(function(z){return z.isCategory}),s=this.groupData(r),l=[],u=0,c=s.length;u<c;u++){for(var f=s[u],d=[],v=0,g=f.length;v<g;v++){var x=f[v],w={};for(var S in x)w[S]=x[S];w[Pa]=x;try{for(var M=(n=void 0,yi(o)),R=M.next();!R.done;R=M.next()){var I=R.value,P=I.field;w[P]=I.translate(w[P])}}catch(z){n={error:z}}finally{try{R&&!R.done&&(i=M.return)&&i.call(M)}finally{if(n)throw n.error}}d.push(w)}l.push(d)}var k=this.adjustData(l);return this.beforeMappingData=k,k},t.prototype.adjustData=function(r){var n=this.adjustOption,i=this,a=i.intervalPadding,o=i.dodgePadding,s=i.theme,l=this.maxColumnWidth||s.maxColumnWidth,u=this.minColumnWidth||s.minColumnWidth,c=this.columnWidthRatio||s.columnWidthRatio,f=r;if(n){var d=this.getXScale(),v=this.getYScale(),g=d.field,x=v?v.field:null,w=h2(this.coordinate),S=d.values.length,M=this.getAttribute("size"),R=void 0;M&&(R=M.values[0]);for(var I=0,P=n.length;I<P;I++){var k=n[I],z=$({xField:g,yField:x,intervalPadding:a,dodgePadding:o,xDimensionLength:w,groupNum:S,defaultSize:R,maxColumnWidth:l,minColumnWidth:u,columnWidthRatio:c},k),G=k.type;if(G==="dodge"){var J=[];if(d.isCategory||d.type==="identity")J.push("x");else if(!v)J.push("y");else throw new Error("dodge is not support linear attribute, please use category attribute!");z.adjustNames=J,z.dodgeRatio=c}else if(G==="stack"){var Z=this.coordinate;if(!v){z.height=Z.getHeight();var X=this.getDefaultValue("size")||3;z.size=X}!Z.isTransposed&&ze(z.reverseOrder)&&(z.reverseOrder=!0)}var et=pN(G);z.dimValuesMap={},d&&d.values&&(z.dimValuesMap[d.field]=d.values.map(function(wt){return d.translate(wt)}));var at=new et(z);f=at.process(f),this.adjusts[G]=at}}return f},t.prototype.groupData=function(r){for(var n=this.getGroupScales(),i=this.scaleDefs,a={},o=[],s=0;s<n.length;s++){var l=n[s],u=l.field;o.push(u),xt(i,[u,"values"])&&(a[u]=i[u].values)}return Cjt(r,o,a)},t.prototype.updateStackRange=function(r,n){for(var i=rh(n),a=r.field,o=r.min,s=r.max,l=0;l<i.length;l++){var u=i[l],c=Math.min.apply(null,u[a]),f=Math.max.apply(null,u[a]);c<o&&(o=c),f>s&&(s=f)}var d=this.scaleDefs,v={};o<r.min&&!xt(d,[a,"min"])&&(v.min=o),s>r.max&&!xt(d,[a,"max"])&&(v.max=s),r.change(v)},t.prototype.beforeMapping=function(r){var n=r;if(this.sortable&&this.sort(n),this.generatePoints)for(var i=0,a=n.length;i<a;i++){var o=n[i];this.generateShapePoints(o);var s=n[i+1];s&&(this.generateShapePoints(s),o[0].nextPoints=s[0].points)}return n},t.prototype.generateShapePoints=function(r){for(var n=this.getShapeFactory(),i=this.getAttribute("shape"),a=0;a<r.length;a++){var o=r[a],s=this.createShapePointsCfg(o),l=i?this.getAttributeValues(i,o):null,u=n.getShapePoints(l,s);o.points=u}},t.prototype.normalizeValues=function(r,n){var i=[];if(Fe(r))for(var a=0;a<r.length;a++){var o=r[a];i.push(n.scale(o))}else i=n.scale(r);return i},t.prototype.mapping=function(r){for(var n=this.attributes,i=[],a=0;a<r.length;a++){var o=r[a],s={_origin:o[Pa],points:o.points,nextPoints:o.nextPoints};for(var l in n)if(n.hasOwnProperty(l)){var u=n[l],c=u.names,f=this.getAttributeValues(u,o);if(c.length>1)for(var d=0;d<f.length;d+=1){var v=f[d],g=c[d];s[g]=Fe(v)&&v.length===1?v[0]:v}else s[c[0]]=f.length===1?f[0]:f}this.convertPoint(s),i.push(s)}return i},t.prototype.convertPoint=function(r){var n=r.x,i=r.y,a,o,s,l=this.coordinate;if(Fe(n)&&Fe(i)){a=[],o=[];for(var u=0,c=0,f=n.length,d=i.length;u<f&&c<d;u+=1,c+=1)s=l.convert({x:n[u],y:i[c]}),a.push(s.x),o.push(s.y)}else if(Fe(i)){o=[];for(var v=0;v<i.length;v++){var g=i[v];s=l.convert({x:n,y:g}),a&&a!==s.x?(Fe(a)||(a=[a]),a.push(s.x)):a=s.x,o.push(s.y)}}else if(Fe(n)){a=[];for(var v=0;v<n.length;v++){var x=n[v];s=l.convert({x,y:i}),o&&o!==s.y?(Fe(o)||(o=[o]),o.push(s.y)):o=s.y,a.push(s.x)}}else{var w=l.convert({x:n,y:i});a=w.x,o=w.y}r.x=a,r.y=o},t.prototype.getStyleCfg=function(r,n){var i=r.fields,a=i===void 0?[]:i,o=r.callback,s=r.cfg;if(s)return s;var l=a.map(function(u){return n[u]});return o.apply(void 0,on([],Pr(l),!1))},t.prototype.setCfg=function(r){var n=this,i=r.coordinate,a=r.data,o=r.theme,s=r.scaleDefs;i&&(this.coordinate=i),a&&(this.data=a),s&&(this.scaleDefs=s,this.idFields=[],ft(s,function(l,u){l&&l.key&&n.idFields.push(u)})),o&&(this.theme=this.userTheme?Tr({},o,this.userTheme):o)},t.prototype.renderLabels=function(r,n){return n===void 0&&(n=!1),lu(this,void 0,void 0,function(){var i,a,o,s,l,u,c,f,d,v,g,x,w=this;return $h(this,function(S){switch(S.label){case 0:return i=this.geometryLabel,this.emit(Ym.BEFORE_RENDER_LABEL),i||(a=this.getLabelType(),o=xjt(a),i=new o(this),this.geometryLabel=i),[4,i.render(r,n)];case 1:S.sent(),s=i.labelsRenderer.shapesMap,l=new Map,ft(s,function(M,R){for(var I=M.getChildren()||[],P=0;P<I.length;P++){var k=I[P],z=w.elementsMap[k.get("elementId")||R.split(" ")[0]];if(z){k.cfg.name=["element","label"],k.cfg.element=z;var G=l.get(z)||new Set;G.add(M),l.set(z,G)}}});try{for(u=yi(l.entries()),c=u.next();!c.done;c=u.next())f=Pr(c.value,2),d=f[0],v=f[1],d.labelShape=on([],Pr(v),!1)}catch(M){g={error:M}}finally{try{c&&!c.done&&(x=u.return)&&x.call(u)}finally{if(g)throw g.error}}return this.emit(Ym.AFTER_RENDER_LABEL),[2]}})})},t.prototype.canDoGroupAnimation=function(r){return!r&&this.animateOption&&(xt(this.animateOption,"appear")===void 0||xt(this.animateOption,"appear")&&xt(this.animateOption,["appear","animation"])===void 0)},t}(iN),_3=Ws;function p2(e,t,r){var n=_3(e.getMatrix(),[["t",t,r]]);e.setMatrix(n)}function Sjt(e,t){var r=e.attr(),n=r.x,i=r.y,a=_3(e.getMatrix(),[["t",-n,-i],["r",t],["t",n,i]]);return a}function $N(e,t){var r=Sjt(e,t);e.setMatrix(r)}function Tjt(e,t){var r=e.getBBox(),n=(r.minX+r.maxX)/2,i=(r.minY+r.maxY)/2;e.applyToMatrix([n,i,1]);var a=_3(e.getMatrix(),[["t",-n,-i],["s",t,t],["t",n,i]]);e.setMatrix(a)}function o0(e){return e.find(function(t){return t.get("type")==="text"})}function Fnt(e,t,r){r===void 0&&(r=[0,0,0,0]);var n=e&&e.getChildren()[0];if(n){var i=n.clone();t!=null&&t.rotate&&$N(i,-t.rotate);var a=i.getCanvasBBox(),o=a.x,s=a.y,l=a.width,u=a.height;i.destroy();var c=r;return ze(c)?c=[2,2,2,2]:Rn(c)&&(c=new Array(4).fill(c)),{x:o-c[3],y:s-c[0],width:l+c[1]+c[3],height:u+c[0]+c[2],rotation:(t==null?void 0:t.rotate)||0}}return{x:0,y:0,width:0,height:0,rotation:0}}function Ajt(e,t,r){r===void 0&&(r=0);var n=Math.max(0,Math.min(e.x+e.width+r,t.x+t.width+r)-Math.max(e.x-r,t.x-r)),i=Math.max(0,Math.min(e.y+e.height+r,t.y+t.height+r)-Math.max(e.y-r,t.y-r));return n*i}function Mjt(e,t){var r=e.getBBox();return XS(t,function(n){var i=n.getBBox();return Ajt(r,i,2)>0})}function Bnt(e,t,r){var n=r.data,i=r.origin,a=r.animateCfg,o=r.coordinate,s=xt(a,"update");e.set("data",n),e.set("origin",i),e.set("animateCfg",a),e.set("coordinate",o),e.set("visible",t.get("visible")),(e.getChildren()||[]).forEach(function(l,u){var c=t.getChildByIndex(u);if(!c)e.removeChild(l),l.remove(!0);else{l.set("data",n),l.set("origin",i),l.set("animateCfg",a),l.set("coordinate",o);var f=tnt(l,c);s?Mx(l,s,{toAttrs:f,coordinate:o}):l.attr(f),c.isGroup()&&Bnt(l,c,r)}}),ft(t.getChildren(),function(l,u){Fe(e.getChildren())&&u>=e.getCount()&&(l.destroyed||e.add(l))})}var Rjt=function(){function e(t){this.shapesMap={};var r=t.layout,n=t.container;this.layout=r,this.container=n}return e.prototype.render=function(t,r,n){return n===void 0&&(n=!1),lu(this,void 0,void 0,function(){var i,a,o,s,l,u,c,f,d=this;return $h(this,function(v){switch(v.label){case 0:if(i={},a=this.createOffscreenGroup(),!t.length)return[3,2];try{for(o=yi(t),s=o.next();!s.done;s=o.next())l=s.value,l&&(i[l.id]=this.renderLabel(l,a))}catch(g){c={error:g}}finally{try{s&&!s.done&&(f=o.return)&&f.call(o)}finally{if(c)throw c.error}}return[4,this.doLayout(t,r,i)];case 1:v.sent(),this.renderLabelLine(t,i),this.renderLabelBackground(t,i),this.adjustLabel(t,i),v.label=2;case 2:return u=this.shapesMap,ft(i,function(g,x){if(g.destroyed)delete i[x];else{if(u[x]){var w=g.get("data"),S=g.get("origin"),M=g.get("coordinate"),R=g.get("animateCfg"),I=u[x];Bnt(I,i[x],{data:w,origin:S,animateCfg:R,coordinate:M}),i[x]=I}else{if(d.container.destroyed)return;d.container.add(g);var P=xt(g.get("animateCfg"),n?"enter":"appear");P&&Mx(g,P,{toAttrs:$({},g.attr()),coordinate:g.get("coordinate")})}delete u[x]}}),ft(u,function(g){var x=xt(g.get("animateCfg"),"leave");x?Mx(g,x,{toAttrs:null,coordinate:g.get("coordinate")}):g.remove(!0)}),this.shapesMap=i,a.destroy(),[2]}})})},e.prototype.clear=function(){this.container.clear(),this.shapesMap={}},e.prototype.destroy=function(){this.container.destroy(),this.shapesMap=null},e.prototype.renderLabel=function(t,r){var n=t.id,i=t.elementId,a=t.data,o=t.mappingData,s=t.coordinate,l=t.animate,u=t.content,c=t.capture,f={id:n,elementId:i,capture:c,data:a,origin:$($({},o),{data:o[Pa]}),coordinate:s},d=r.addGroup($({name:"label",animateCfg:this.animate===!1||l===null||l===!1?!1:Tr({},this.animate,l)},f)),v;if(u.isGroup&&u.isGroup()||u.isShape&&u.isShape()){var g=u.getCanvasBBox(),x=g.width,w=g.height,S=xt(t,"textAlign","left"),M=t.x,R=t.y-w/2;S==="center"?M=M-x/2:(S==="right"||S==="end")&&(M=M-x),p2(u,M,R),v=u,d.add(u)}else{var I=xt(t,["style","fill"]);v=d.addShape("text",$({attrs:$($({x:t.x,y:t.y,textAlign:t.textAlign,textBaseline:xt(t,"textBaseline","middle"),text:t.content},t.style),{fill:Jtt(I)?t.color:I})},f))}return t.rotate&&$N(v,t.rotate),d},e.prototype.doLayout=function(t,r,n){return lu(this,void 0,void 0,function(){var i,a=this;return $h(this,function(o){switch(o.label){case 0:return this.layout?(i=Fe(this.layout)?this.layout:[this.layout],[4,Promise.all(i.map(function(s){var l=bjt(xt(s,"type",""));if(l){var u=[],c=[];return ft(n,function(f,d){u.push(f),c.push(r[f.get("elementId")])}),l(t,u,c,a.region,s.cfg)}}))]):[3,2];case 1:o.sent(),o.label=2;case 2:return[2]}})})},e.prototype.renderLabelLine=function(t,r){ft(t,function(n){var i=xt(n,"coordinate");if(!(!n||!i)){var a=i.getCenter(),o=i.getRadius();if(n.labelLine){var s=xt(n,"labelLine",{}),l=n.id,u=s.path;if(!u){var c=Ps(a.x,a.y,o,n.angle);u=[["M",c.x,c.y],["L",n.x,n.y]]}var f=r[l];f.destroyed||f.addShape("path",{capture:!1,attrs:$({path:u,stroke:n.color?n.color:xt(n,["style","fill"],"#000"),fill:null},s.style),id:l,origin:n.mappingData,data:n.data,coordinate:n.coordinate})}}})},e.prototype.renderLabelBackground=function(t,r){ft(t,function(n){var i=xt(n,"coordinate"),a=xt(n,"background");if(!(!a||!i)){var o=n.id,s=r[o];if(!s.destroyed){var l=s.getChildren()[0];if(l){var u=Fnt(s,n,a.padding),c=u.rotation,f=fi(u,["rotation"]),d=s.addShape("rect",{attrs:$($({},f),a.style||{}),id:o,origin:n.mappingData,data:n.data,coordinate:n.coordinate});if(d.setZIndex(-1),c){var v=l.getMatrix();d.setMatrix(v)}}}}})},e.prototype.createOffscreenGroup=function(){var t=this.container,r=t.getGroupBase(),n=new r({});return n},e.prototype.adjustLabel=function(t,r){ft(t,function(n){if(n){var i=n.id,a=r[i];if(!a.destroyed){var o=a.findAll(function(s){return s.get("type")!=="path"});ft(o,function(s){s&&(n.offsetX&&s.attr("x",s.attr("x")+n.offsetX),n.offsetY&&s.attr("y",s.attr("y")+n.offsetY))})}}})},e}();function DG(e){var t=0;return ft(e,function(r){t+=r}),t/e.length}var x3=function(){function e(t){this.geometry=t}return e.prototype.getLabelItems=function(t){var r=this,n=[],i=this.getLabelCfgs(t);return ft(t,function(a,o){var s=i[o];if(!s||ze(a.x)||ze(a.y)){n.push(null);return}var l=Fe(s.content)?s.content:[s.content];s.content=l;var u=l.length;ft(l,function(c,f){if(ze(c)||c===""){n.push(null);return}var d=$($({},s),r.getLabelPoint(s,a,f));d.textAlign||(d.textAlign=r.getLabelAlign(d,f,u)),d.offset<=0&&(d.labelLine=null),n.push(d)})}),n},e.prototype.render=function(t,r){return r===void 0&&(r=!1),lu(this,void 0,void 0,function(){var n,i,a;return $h(this,function(o){switch(o.label){case 0:return n=this.getLabelItems(t),i=this.getLabelsRenderer(),a=this.getGeometryShapes(),[4,i.render(n,a,r)];case 1:return o.sent(),[2]}})})},e.prototype.clear=function(){var t=this.labelsRenderer;t&&t.clear()},e.prototype.destroy=function(){var t=this.labelsRenderer;t&&t.destroy(),this.labelsRenderer=null},e.prototype.getCoordinate=function(){return this.geometry.coordinate},e.prototype.getDefaultLabelCfg=function(t,r){var n=this.geometry,i=n.type,a=n.theme;return i==="polygon"||i==="interval"&&r==="middle"||t<0&&!["line","point","path"].includes(i)?xt(a,"innerLabels",{}):xt(a,"labels",{})},e.prototype.getThemedLabelCfg=function(t){var r=this.geometry,n=this.getDefaultLabelCfg(),i=r.type,a=r.theme,o;return i==="polygon"||t.offset<0&&!["line","point","path"].includes(i)?o=Tr({},n,a.innerLabels,t):o=Tr({},n,a.labels,t),o},e.prototype.setLabelPosition=function(t,r,n,i){},e.prototype.getLabelOffset=function(t){var r=this.getCoordinate(),n=this.getOffsetVector(t);return r.isTransposed?n[0]:n[1]},e.prototype.getLabelOffsetPoint=function(t,r,n){var i=t.offset,a=this.getCoordinate(),o=a.isTransposed,s=o?"x":"y",l=o?1:-1,u={x:0,y:0};return r>0||n===1?u[s]=i*l:u[s]=i*l*-1,u},e.prototype.getLabelPoint=function(t,r,n){var i=this.getCoordinate(),a=t.content.length;function o(w,S,M){M===void 0&&(M=!1);var R=w;return Fe(R)&&(t.content.length===1?M?R=DG(R):R.length<=2?R=R[w.length-1]:R=DG(R):R=R[S]),R}var s={content:t.content[n],x:0,y:0,start:{x:0,y:0},color:"#fff"},l=Fe(r.shape)?r.shape[0]:r.shape,u=l==="funnel"||l==="pyramid";if(this.geometry.type==="polygon"){var c=rXt(r.x,r.y);s.x=c[0],s.y=c[1]}else this.geometry.type==="interval"&&!u?(s.x=o(r.x,n,!0),s.y=o(r.y,n)):(s.x=o(r.x,n),s.y=o(r.y,n));if(u){var f=xt(r,"nextPoints"),d=xt(r,"points");if(f){var v=i.convert(d[1]),g=i.convert(f[1]);s.x=(v.x+g.x)/2,s.y=(v.y+g.y)/2}else if(l==="pyramid"){var v=i.convert(d[1]),g=i.convert(d[2]);s.x=(v.x+g.x)/2,s.y=(v.y+g.y)/2}}t.position&&this.setLabelPosition(s,r,n,t.position);var x=this.getLabelOffsetPoint(t,n,a);return s.start={x:s.x,y:s.y},s.x+=x.x,s.y+=x.y,s.color=r.color,s},e.prototype.getLabelAlign=function(t,r,n){var i="center",a=this.getCoordinate();if(a.isTransposed){var o=t.offset;o<0?i="right":o===0?i="center":i="left",n>1&&r===0&&(i==="right"?i="left":i==="left"&&(i="right"))}return i},e.prototype.getLabelId=function(t){var r=this.geometry,n=r.type,i=r.getXScale(),a=r.getYScale(),o=t[Pa],s=r.getElementId(t);return n==="line"||n==="area"?s+=" ".concat(o[i.field]):n==="path"&&(s+=" ".concat(o[i.field],"-").concat(o[a.field])),s},e.prototype.getLabelsRenderer=function(){var t=this.geometry,r=t.labelsContainer,n=t.labelOption,i=t.canvasRegion,a=t.animateOption,o=this.geometry.coordinate,s=this.labelsRenderer;return s||(s=new Rjt({container:r,layout:xt(n,["cfg","layout"],{type:this.defaultLayout})}),this.labelsRenderer=s),s.region=i,s.animate=a?Rnt("label",o):!1,s},e.prototype.getLabelCfgs=function(t){var r=this,n=this.geometry,i=n.labelOption,a=n.scales,o=n.coordinate,s=i,l=s.fields,u=s.callback,c=s.cfg,f=l.map(function(v){return a[v]}),d=[];return ft(t,function(v,g){var x=v[Pa],w=r.getLabelText(x,f),S;if(u){var M=l.map(function(z){return x[z]});if(S=u.apply(void 0,on([],Pr(M),!1)),ze(S)){d.push(null);return}}var R=$($({id:r.getLabelId(v),elementId:r.geometry.getElementId(v),data:x,mappingData:v,coordinate:o},c),S);Rr(R.position)&&(R.position=R.position(x,v,g));var I=r.getLabelOffset(R.offset||0),P=r.getDefaultLabelCfg(I,R.position);R=Tr({},P,R),R.offset=r.getLabelOffset(R.offset||0);var k=R.content;Rr(k)?R.content=k(x,v,g):Gl(k)&&(R.content=w[0]),d.push(R)}),d},e.prototype.getLabelText=function(t,r){var n=[];return ft(r,function(i){var a=t[i.field];Fe(a)?a=a.map(function(o){return i.getText(o)}):a=i.getText(a),ze(a)||a===""?n.push(null):n.push(a)}),n},e.prototype.getOffsetVector=function(t){t===void 0&&(t=0);var r=this.getCoordinate(),n=0;return Rn(t)&&(n=t),r.isTransposed?r.applyMatrix(n,0):r.applyMatrix(0,n)},e.prototype.getGeometryShapes=function(){var t=this.geometry,r={};return ft(t.elementsMap,function(n,i){r[i]=n.shape}),ft(t.getOffscreenGroup().getChildren(),function(n){var i=t.getElementId(n.get("origin").mappingData);r[i]=n}),r},e}();function HF(e,t,r){if(!e)return r;var n;if(e.callback&&e.callback.length>1){var i=Array(e.callback.length-1).fill("");n=e.mapping.apply(e,on([t],Pr(i),!1)).join("")}else n=e.mapping(t).join("");return n||r}var h_={hexagon:function(e,t,r){var n=r/2*Math.sqrt(3);return[["M",e,t-r],["L",e+n,t-r/2],["L",e+n,t+r/2],["L",e,t+r],["L",e-n,t+r/2],["L",e-n,t-r/2],["Z"]]},bowtie:function(e,t,r){var n=r-1.5;return[["M",e-r,t-n],["L",e+r,t+n],["L",e+r,t-n],["L",e-r,t+n],["Z"]]},cross:function(e,t,r){return[["M",e-r,t-r],["L",e+r,t+r],["M",e+r,t-r],["L",e-r,t+r]]},tick:function(e,t,r){return[["M",e-r/2,t-r],["L",e+r/2,t-r],["M",e,t-r],["L",e,t+r],["M",e-r/2,t+r],["L",e+r/2,t+r]]},plus:function(e,t,r){return[["M",e-r,t],["L",e+r,t],["M",e,t-r],["L",e,t+r]]},hyphen:function(e,t,r){return[["M",e-r,t],["L",e+r,t]]},line:function(e,t,r){return[["M",e,t-r],["L",e,t+r]]}},Ijt=["line","cross","tick","plus","hyphen"];function Ljt(e,t){return Rr(t)?t(e):Tr({},e,t)}function Ojt(e,t){var r=e.symbol;if(en(r)&&Ijt.indexOf(r)!==-1){var n=xt(e,"style",{}),i=xt(n,"lineWidth",1),a=n.stroke||n.fill||t;e.style=Tr({},e.style,{lineWidth:i,stroke:a,fill:null})}}function Nnt(e){var t=e.symbol;en(t)&&h_[t]&&(e.symbol=h_[t])}function vP(e){return e.startsWith(br.LEFT)||e.startsWith(br.RIGHT)?"vertical":"horizontal"}function knt(e,t,r,n,i){var a=r.getScale(r.type);if(a.isCategory){var o=a.field,s=t.getAttribute("color"),l=t.getAttribute("shape"),u=e.getTheme().defaultColor,c=t.coordinate.isPolar;return a.getTicks().map(function(f,d){var v,g=f.text,x=f.value,w=g,S=a.invert(x),M=e.filterFieldData(o,[(v={},v[o]=S,v)]).length===0;ft(e.views,function(z){var G;z.filterFieldData(o,[(G={},G[o]=S,G)]).length||(M=!0)});var R=HF(s,S,u),I=HF(l,S,"point"),P=t.getShapeMarker(I,{color:R,isInPolar:c}),k=i;return Rr(k)&&(k=k(w,d,$({name:w,value:S},Tr({},n,P)))),P=Tr({},n,P,Vc($({},k),["style"])),Ojt(P,R),k&&k.style&&(P.style=Ljt(P.style,k.style)),Nnt(P),{id:S,name:w,value:S,marker:P,unchecked:M}})}return[]}function Pjt(e,t,r){return r.map(function(n,i){var a=t;Rr(a)&&(a=a(n.name,i,Tr({},e,n)));var o=Rr(n.marker)?n.marker(n.name,i,Tr({},e,n)):n.marker,s=Tr({},e,a,o);return Nnt(s),n.marker=s,n})}function FG(e,t){var r=xt(e,["components","legend"],{});return Tr({},xt(r,["common"],{}),Tr({},xt(r,[t],{})))}function gP(e){return e?!1:e==null||isNaN(e)}function BG(e){if(Fe(e))return gP(e[1].y);var t=e.y;return Fe(t)?gP(t[0]):gP(t)}function b3(e,t,r){if(t===void 0&&(t=!1),r===void 0&&(r=!0),!e.length||e.length===1&&!r)return[];if(t){for(var n=[],i=0,a=e.length;i<a;i++){var o=e[i];BG(o)||n.push(o)}return[n]}for(var s=[],l=[],i=0,a=e.length;i<a;i++){var o=e[i];BG(o)?l.length&&(l.length===1&&!r||s.push(l),l=[]):l.push(o)}return l.length&&s.push(l),s}function znt(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];if(n){var i=r===0?"M":"L";t.push([i,n.x,n.y])}}var a=e[0];return a&&(t.push(["L",a.x,a.y]),t.push(["z"])),t}function Unt(e){for(var t=e.length/2,r=[],n=[],i=0;i<e.length;i++)i<t?r.push(e[i]):n.push(e[i]);var a=BR(r,!1),o=BR(n,!1);n.length&&a.push(["L",n[0].x,n[0].y]),o.shift();var s=a.concat(o);return r.length&&s.push(["L",r[0].x,r[0].y]),s.push(["z"]),s}function bs(e,t,r,n){n===void 0&&(n="");var i=e.style,a=i===void 0?{}:i,o=e.defaultStyle,s=e.color,l=e.size,u=$($({},o),a);return s&&(t&&(a.stroke||(u.stroke=s)),r&&(a.fill||(u.fill=s))),n&&ze(a[n])&&!ze(l)&&(u[n]=l),u}function $nt(e){return Tr({},{fill:"#CCD6EC",fillOpacity:.3},xt(e,["background","style"]))}function HN(e){var t=e.x,r=Fe(e.y)?e.y:[e.y];return r.map(function(n,i){return{x:Fe(t)?t[i]:t,y:n}})}var Djt={line:function(e,t,r){return[["M",e-r,t],["L",e+r,t]]},dot:function(e,t,r){return[["M",e-r,t],["L",e+r,t]]},dash:function(e,t,r){return[["M",e-r,t],["L",e+r,t]]},smooth:function(e,t,r){return[["M",e-r,t],["A",r/2,r/2,0,1,1,e,t],["A",r/2,r/2,0,1,0,e+r,t]]},hv:function(e,t,r){return[["M",e-r-1,t-2.5],["L",e,t-2.5],["L",e,t+2.5],["L",e+r+1,t+2.5]]},vh:function(e,t,r){return[["M",e-r-1,t+2.5],["L",e,t+2.5],["L",e,t-2.5],["L",e+r+1,t-2.5]]},hvh:function(e,t,r){return[["M",e-(r+1),t+2.5],["L",e-r/2,t+2.5],["L",e-r/2,t-2.5],["L",e+r/2,t-2.5],["L",e+r/2,t+2.5],["L",e+r+1,t+2.5]]},vhv:function(e,t){return[["M",e-5,t+2.5],["L",e-5,t],["L",e,t],["L",e,t-3],["L",e,t+3],["L",e+6.5,t+3]]}};function Hnt(e,t){var r=e.color;return{symbol:Djt[t],style:{lineWidth:2,r:6,stroke:r}}}function Fjt(e,t,r){for(var n=e.isStack,i=e.connectNulls,a=e.isInCircle,o=e.showSinglePoint,s=bs(e,!0,!1,"lineWidth"),l=b3(e.points,i,o),u=[],c=0,f=l.length;c<f;c++){var d=l[c];u=u.concat(Vnt(d,a,n,t,r,s))}return s.path=u,s}function VF(e,t,r,n,i){if(e.length===1)return[["M",e[0].x,e[0].y-i.lineWidth/2],["L",e[0].x,e[0].y],["L",e[0].x,e[0].y+i.lineWidth/2]];var a;return r?(t&&e.length&&e.push({x:e[0].x,y:e[0].y}),a=BR(e,!1,n)):(a=f2(e,!1),t&&a.push(["Z"])),a}function Bjt(e,t,r,n,i,a){var o=[],s=[];ft(e,function(c){var f=HN(c);o.push(f[1]),s.push(f[0])});var l=VF(o,t,n,i,a),u=VF(s,t,n,i,a);return r?l:l.concat(u)}function Vnt(e,t,r,n,i,a){if(e.length){var o=e[0];return Fe(o.y)?Bjt(e,t,r,n,i,a):VF(e,t,n,i,a)}return[]}w0("line",{defaultShapeType:"line"});ft(["line","dot","dash","smooth"],function(e){fa("line",e,{draw:function(t,r){var n=e==="smooth",i;if(n){var a=this.coordinate,o=a.start,s=a.end;i=[[o.x,s.y],[s.x,o.y]]}var l=Fjt(t,n,i),u=r.addShape({type:"path",attrs:l,name:"line",capture:!n});return u},getMarker:function(t){return Hnt(t,e)}})});var ih={getLegendItems:knt,translate:p2,rotate:$N,zoom:Tjt,transform:_3,getAngle:GC,getSectorPath:qm,polarToCartesian:Ps,getDelegationObject:c_,getTooltipItems:BN,getMappingValue:HF,getPath:Vnt,getPathPoints:b3},Em={100:"#000",95:"#0D0D0D",85:"#262626",65:"#595959",45:"#8C8C8C",25:"#BFBFBF",15:"#D9D9D9",6:"#F0F0F0"},Oa={100:"#FFFFFF",95:"#F2F2F2",85:"#D9D9D9",65:"#A6A6A6",45:"#737373",25:"#404040",15:"#262626",6:"#0F0F0F"},Ad=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#E86452","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],Njt=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#E86452","#F8D0CB","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],kjt=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"],zjt=function(e){e===void 0&&(e={});var t=e.paletteQualitative10,r=t===void 0?Ad:t,n=e.paletteQualitative20,i=n===void 0?Njt:n,a=e.brandColor,o=a===void 0?r[0]:a,s={backgroundColor:"#141414",brandColor:o,subColor:"rgba(255,255,255,0.05)",paletteQualitative10:r,paletteQualitative20:i,paletteSemanticRed:"#F4664A",paletteSemanticGreen:"#30BF78",paletteSemanticYellow:"#FAAD14",paletteSequence:kjt,fontFamily:`"Segoe UI", Roboto, "Helvetica Neue", Arial,
    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
    "Noto Color Emoji"`,axisLineBorderColor:Oa[25],axisLineBorder:1,axisLineDash:null,axisTitleTextFillColor:Oa[65],axisTitleTextFontSize:12,axisTitleTextLineHeight:12,axisTitleTextFontWeight:"normal",axisTitleSpacing:12,axisDescriptionIconFillColor:Em[85],axisTickLineBorderColor:Oa[25],axisTickLineLength:4,axisTickLineBorder:1,axisSubTickLineBorderColor:Oa[15],axisSubTickLineLength:2,axisSubTickLineBorder:1,axisLabelFillColor:Oa[45],axisLabelFontSize:12,axisLabelLineHeight:12,axisLabelFontWeight:"normal",axisLabelOffset:8,axisGridBorderColor:Oa[15],axisGridBorder:1,axisGridLineDash:null,legendTitleTextFillColor:Oa[45],legendTitleTextFontSize:12,legendTitleTextLineHeight:21,legendTitleTextFontWeight:"normal",legendMarkerColor:Ad[0],legendMarkerSpacing:8,legendMarkerSize:4,legendCircleMarkerSize:4,legendSquareMarkerSize:4,legendLineMarkerSize:5,legendItemNameFillColor:Oa[65],legendItemNameFontSize:12,legendItemNameLineHeight:12,legendItemNameFontWeight:"normal",legendItemSpacing:24,legendItemMarginBottom:12,legendSpacing:16,legendPadding:[8,8,8,8],legendHorizontalPadding:[8,0,8,0],legendVerticalPadding:[0,8,0,8],legendPageNavigatorMarkerSize:12,legendPageNavigatorMarkerInactiveFillColor:Oa[45],legendPageNavigatorMarkerInactiveFillOpacity:.45,legendPageNavigatorMarkerFillColor:Oa[45],legendPageNavigatorMarkerFillOpacity:1,legendPageNavigatorTextFillColor:Oa[65],legendPageNavigatorTextFontSize:12,sliderRailFillColor:Oa[15],sliderRailBorder:0,sliderRailBorderColor:null,sliderRailWidth:100,sliderRailHeight:12,sliderLabelTextFillColor:Oa[45],sliderLabelTextFontSize:12,sliderLabelTextLineHeight:12,sliderLabelTextFontWeight:"normal",sliderHandlerFillColor:Em[6],sliderHandlerWidth:10,sliderHandlerHeight:14,sliderHandlerBorder:1,sliderHandlerBorderColor:Em[25],annotationArcBorderColor:Oa[15],annotationArcBorder:1,annotationLineBorderColor:Oa[25],annotationLineBorder:1,annotationLineDash:null,annotationTextFillColor:Oa[65],annotationTextFontSize:12,annotationTextLineHeight:12,annotationTextFontWeight:"normal",annotationTextBorderColor:null,annotationTextBorder:0,annotationRegionFillColor:Oa[100],annotationRegionFillOpacity:.06,annotationRegionBorder:0,annotationRegionBorderColor:null,annotationDataMarkerLineLength:16,tooltipCrosshairsBorderColor:Oa[25],tooltipCrosshairsBorder:1,tooltipCrosshairsLineDash:null,tooltipContainerFillColor:"#1f1f1f",tooltipContainerFillOpacity:.95,tooltipContainerShadow:"0px 2px 4px rgba(0,0,0,.5)",tooltipContainerBorderRadius:3,tooltipTextFillColor:Oa[65],tooltipTextFontSize:12,tooltipTextLineHeight:12,tooltipTextFontWeight:"bold",labelFillColor:Oa[65],labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,labelLineHeight:12,labelFontWeight:"normal",labelBorderColor:null,labelBorder:0,innerLabelFillColor:Em[100],innerLabelFontSize:12,innerLabelLineHeight:12,innerLabelFontWeight:"normal",innerLabelBorderColor:null,innerLabelBorder:0,overflowLabelFillColor:Oa[65],overflowLabelFillColorDark:"#2c3542",overflowLabelFillColorLight:"#ffffff",overflowLabelFontSize:12,overflowLabelLineHeight:12,overflowLabelFontWeight:"normal",overflowLabelBorderColor:Em[100],overflowLabelBorder:1,labelLineBorder:1,labelLineBorderColor:Oa[25],cSliderRailHieght:16,cSliderBackgroundFillColor:"#416180",cSliderBackgroundFillOpacity:.05,cSliderForegroundFillColor:"#5B8FF9",cSliderForegroundFillOpacity:.15,cSliderHandlerHeight:24,cSliderHandlerWidth:10,cSliderHandlerFillColor:"#F7F7F7",cSliderHandlerFillOpacity:1,cSliderHandlerHighlightFillColor:"#FFF",cSliderHandlerBorderColor:"#BFBFBF",cSliderHandlerBorder:1,cSliderHandlerBorderRadius:2,cSliderTextFillColor:"#fff",cSliderTextFillOpacity:.45,cSliderTextFontSize:12,cSliderTextLineHeight:12,cSliderTextFontWeight:"normal",cSliderTextBorderColor:null,cSliderTextBorder:0,scrollbarTrackFillColor:"rgba(255,255,255,0.65)",scrollbarThumbFillColor:"rgba(0,0,0,0.35)",scrollbarThumbHighlightFillColor:"rgba(0,0,0,0.45)",pointFillColor:Ad[0],pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:Em[100],pointBorderOpacity:1,pointActiveBorderColor:Oa[100],pointSelectedBorder:2,pointSelectedBorderColor:Oa[100],pointInactiveFillOpacity:.3,pointInactiveBorderOpacity:.3,hollowPointSize:4,hollowPointBorder:1,hollowPointBorderColor:Ad[0],hollowPointBorderOpacity:.95,hollowPointFillColor:Em[100],hollowPointActiveBorder:1,hollowPointActiveBorderColor:Oa[100],hollowPointActiveBorderOpacity:1,hollowPointSelectedBorder:2,hollowPointSelectedBorderColor:Oa[100],hollowPointSelectedBorderOpacity:1,hollowPointInactiveBorderOpacity:.3,lineBorder:2,lineBorderColor:Ad[0],lineBorderOpacity:1,lineActiveBorder:3,lineSelectedBorder:3,lineInactiveBorderOpacity:.3,areaFillColor:Ad[0],areaFillOpacity:.25,areaActiveFillColor:Ad[0],areaActiveFillOpacity:.5,areaSelectedFillColor:Ad[0],areaSelectedFillOpacity:.5,areaInactiveFillOpacity:.3,hollowAreaBorderColor:Ad[0],hollowAreaBorder:2,hollowAreaBorderOpacity:1,hollowAreaActiveBorder:3,hollowAreaActiveBorderColor:Oa[100],hollowAreaSelectedBorder:3,hollowAreaSelectedBorderColor:Oa[100],hollowAreaInactiveBorderOpacity:.3,intervalFillColor:Ad[0],intervalFillOpacity:.95,intervalActiveBorder:1,intervalActiveBorderColor:Oa[100],intervalActiveBorderOpacity:1,intervalSelectedBorder:2,intervalSelectedBorderColor:Oa[100],intervalSelectedBorderOpacity:1,intervalInactiveBorderOpacity:.3,intervalInactiveFillOpacity:.3,hollowIntervalBorder:2,hollowIntervalBorderColor:Ad[0],hollowIntervalBorderOpacity:1,hollowIntervalFillColor:Em[100],hollowIntervalActiveBorder:2,hollowIntervalActiveBorderColor:Oa[100],hollowIntervalSelectedBorder:3,hollowIntervalSelectedBorderColor:Oa[100],hollowIntervalSelectedBorderOpacity:1,hollowIntervalInactiveBorderOpacity:.3};return $($({},s),e)},Ujt=zjt();function $jt(){return window?window.devicePixelRatio:1}function Gnt(e,t,r,n){var i=e-r,a=t-n;return Math.sqrt(i*i+a*a)}function Ly(e,t,r,n,i,a){return i>=e&&i<=e+r&&a>=t&&a<=t+n}function YC(e,t){return!(t.minX>e.maxX||t.maxX<e.minX||t.minY>e.maxY||t.maxY<e.minY)}function Hjt(e,t){return!e||!t?e||t:{minX:Math.min(e.minX,t.minX),minY:Math.min(e.minY,t.minY),maxX:Math.max(e.maxX,t.maxX),maxY:Math.max(e.maxY,t.maxY)}}function NG(e,t){return e[0]===t[0]&&e[1]===t[1]}var Vjt=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,Gjt=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,Wjt=/^p\s*\(\s*([axyn])\s*\)\s*(.*)/i,Wnt=/[\d.]+:(#[^\s]+|[^\)]+\))/gi;function Xnt(e,t){var r=e.match(Wnt);ft(r,function(n){var i=n.split(":");t.addColorStop(i[0],i[1])})}function Xjt(e,t,r){var n=Vjt.exec(r),i=parseFloat(n[1])%360*(Math.PI/180),a=n[2],o=t.getBBox(),s,l;i>=0&&i<1/2*Math.PI?(s={x:o.minX,y:o.minY},l={x:o.maxX,y:o.maxY}):1/2*Math.PI<=i&&i<Math.PI?(s={x:o.maxX,y:o.minY},l={x:o.minX,y:o.maxY}):Math.PI<=i&&i<3/2*Math.PI?(s={x:o.maxX,y:o.maxY},l={x:o.minX,y:o.minY}):(s={x:o.minX,y:o.maxY},l={x:o.maxX,y:o.minY});var u=Math.tan(i),c=u*u,f=(l.x-s.x+u*(l.y-s.y))/(c+1)+s.x,d=u*(l.x-s.x+u*(l.y-s.y))/(c+1)+s.y,v=e.createLinearGradient(s.x,s.y,f,d);return Xnt(a,v),v}function jjt(e,t,r){var n=Gjt.exec(r),i=parseFloat(n[1]),a=parseFloat(n[2]),o=parseFloat(n[3]),s=n[4];if(o===0){var l=s.match(Wnt);return l[l.length-1].split(":")[1]}var u=t.getBBox(),c=u.maxX-u.minX,f=u.maxY-u.minY,d=Math.sqrt(c*c+f*f)/2,v=e.createRadialGradient(u.minX+c*i,u.minY+f*a,0,u.minX+c/2,u.minY+f/2,o*d);return Xnt(s,v),v}function Yjt(e,t,r){if(t.get("patternSource")&&t.get("patternSource")===r)return t.get("pattern");var n,i,a=Wjt.exec(r),o=a[1],s=a[2];function l(){n=e.createPattern(i,o),t.set("pattern",n),t.set("patternSource",r)}switch(o){case"a":o="repeat";break;case"x":o="repeat-x";break;case"y":o="repeat-y";break;case"n":o="no-repeat";break;default:o="no-repeat"}return i=new Image,s.match(/^data:/i)||(i.crossOrigin="Anonymous"),i.src=s,i.complete?l():(i.onload=l,i.src=i.src),n}function Zjt(e,t,r){var n=t.getBBox();if(isNaN(n.x)||isNaN(n.y)||isNaN(n.width)||isNaN(n.height))return r;if(en(r)){if(r[1]==="("||r[2]==="("){if(r[0]==="l")return Xjt(e,t,r);if(r[0]==="r")return jjt(e,t,r);if(r[0]==="p")return Yjt(e,t,r)}return r}if(r instanceof CanvasPattern)return r}function qjt(e){var t=0,r=0,n=0,i=0;return Fe(e)?e.length===1?t=r=n=i=e[0]:e.length===2?(t=n=e[0],r=i=e[1]):e.length===3?(t=e[0],r=i=e[1],n=e[2]):(t=e[0],r=e[1],n=e[2],i=e[3]):t=r=n=i=e,[t,r,n,i]}function cA(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function GF(e,t){return cA(e)*cA(t)?(e[0]*t[0]+e[1]*t[1])/(cA(e)*cA(t)):1}function kG(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(GF(e,t))}function kR(e,t){var r=t[1],n=t[2],i=jS(YS(t[3]),Math.PI*2),a=t[4],o=t[5],s=e[0],l=e[1],u=t[6],c=t[7],f=Math.cos(i)*(s-u)/2+Math.sin(i)*(l-c)/2,d=-1*Math.sin(i)*(s-u)/2+Math.cos(i)*(l-c)/2,v=f*f/(r*r)+d*d/(n*n);v>1&&(r*=Math.sqrt(v),n*=Math.sqrt(v));var g=r*r*(d*d)+n*n*(f*f),x=g?Math.sqrt((r*r*(n*n)-g)/g):1;a===o&&(x*=-1),isNaN(x)&&(x=0);var w=n?x*r*d/n:0,S=r?x*-n*f/r:0,M=(s+u)/2+Math.cos(i)*w-Math.sin(i)*S,R=(l+c)/2+Math.sin(i)*w+Math.cos(i)*S,I=[(f-w)/r,(d-S)/n],P=[(-1*f-w)/r,(-1*d-S)/n],k=kG([1,0],I),z=kG(I,P);return GF(I,P)<=-1&&(z=Math.PI),GF(I,P)>=1&&(z=0),o===0&&z>0&&(z=z-2*Math.PI),o===1&&z<0&&(z=z+2*Math.PI),{cx:M,cy:R,rx:NG(e,[u,c])?0:r,ry:NG(e,[u,c])?0:n,startAngle:k,endAngle:k+z,xRotation:i,arcFlag:a,sweepFlag:o}}var zR=Math.sin,UR=Math.cos,VN=Math.atan2,hA=Math.PI;function jnt(e,t,r,n,i,a,o){var s=t.stroke,l=t.lineWidth,u=r-i,c=n-a,f=VN(c,u),d=new YN({type:"path",canvas:e.get("canvas"),isArrowShape:!0,attrs:{path:"M"+10*UR(hA/6)+","+10*zR(hA/6)+" L0,0 L"+10*UR(hA/6)+",-"+10*zR(hA/6),stroke:s,lineWidth:l}});d.translate(i,a),d.rotateAtPoint(i,a,f),e.set(o?"startArrowShape":"endArrowShape",d)}function Ynt(e,t,r,n,i,a,o){var s=t.startArrow,l=t.endArrow,u=t.stroke,c=t.lineWidth,f=o?s:l,d=f.d,v=f.fill,g=f.stroke,x=f.lineWidth,w=fi(f,["d","fill","stroke","lineWidth"]),S=r-i,M=n-a,R=VN(M,S);d&&(i=i-UR(R)*d,a=a-zR(R)*d);var I=new YN({type:"path",canvas:e.get("canvas"),isArrowShape:!0,attrs:$($({},w),{stroke:g||u,lineWidth:x||c,fill:v})});I.translate(i,a),I.rotateAtPoint(i,a,R),e.set(o?"startArrowShape":"endArrowShape",I)}function Wy(e,t,r,n,i){var a=VN(n-t,r-e);return{dx:UR(a)*i,dy:zR(a)*i}}function GN(e,t,r,n,i,a){typeof t.startArrow=="object"?Ynt(e,t,r,n,i,a,!0):t.startArrow?jnt(e,t,r,n,i,a,!0):e.set("startArrowShape",null)}function WN(e,t,r,n,i,a){typeof t.endArrow=="object"?Ynt(e,t,r,n,i,a,!1):t.endArrow?jnt(e,t,r,n,i,a,!1):e.set("startArrowShape",null)}var zG={fill:"fillStyle",stroke:"strokeStyle",opacity:"globalAlpha"};function cb(e,t){var r=t.attr();for(var n in r){var i=r[n],a=zG[n]?zG[n]:n;a==="matrix"&&i?e.transform(i[0],i[1],i[3],i[4],i[6],i[7]):a==="lineDash"&&e.setLineDash?Fe(i)&&e.setLineDash(i):(a==="strokeStyle"||a==="fillStyle"?i=Zjt(e,t,i):a==="globalAlpha"&&(i=i*e.globalAlpha),e[a]=i)}}function WF(e,t,r){for(var n=0;n<t.length;n++){var i=t[n];i.cfg.visible?i.draw(e,r):i.skipDraw()}}function Kjt(e,t,r){var n=e.get("refreshElements");ft(n,function(i){if(i!==e)for(var a=i.cfg.parent;a&&a!==e&&!a.cfg.refresh;)a.cfg.refresh=!0,a=a.cfg.parent}),n[0]===e?XN(t):XF(t,r)}function XF(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(n.cfg.visible)if(n.cfg.hasChanged)n.cfg.refresh=!0,n.isGroup()&&XN(n.cfg.children);else if(n.cfg.refresh)n.isGroup()&&XF(n.cfg.children,t);else{var i=Qjt(n,t);n.cfg.refresh=i,i&&n.isGroup()&&XF(n.cfg.children,t)}}}function Znt(e){for(var t=0;t<e.length;t++){var r=e[t];r.cfg.hasChanged=!1,r.isGroup()&&!r.destroyed&&Znt(r.cfg.children)}}function XN(e,t){for(var r=0;r<e.length;r++){var n=e[r];n.cfg.visible&&(n.cfg.refresh=!0,n.isGroup()&&XN(n.get("children")))}}function Qjt(e,t){var r=e.cfg.cacheCanvasBBox,n=e.cfg.isInView&&r&&YC(r,t);return n}function qnt(e,t,r,n){var i=r.path,a=r.startArrow,o=r.endArrow;if(i){var s=[0,0],l=[0,0],u={dx:0,dy:0};t.beginPath();for(var c=0;c<i.length;c++){var f=i[c],d=f[0];if(c===0&&a&&a.d){var v=e.getStartTangent();u=Wy(v[0][0],v[0][1],v[1][0],v[1][1],a.d)}else if(c===i.length-2&&i[c+1][0]==="Z"&&o&&o.d){var g=i[c+1];if(g[0]==="Z"){var v=e.getEndTangent();u=Wy(v[0][0],v[0][1],v[1][0],v[1][1],o.d)}}else if(c===i.length-1&&o&&o.d&&i[0]!=="Z"){var v=e.getEndTangent();u=Wy(v[0][0],v[0][1],v[1][0],v[1][1],o.d)}var x=u.dx,w=u.dy;switch(d){case"M":t.moveTo(f[1]-x,f[2]-w),l=[f[1],f[2]];break;case"L":t.lineTo(f[1]-x,f[2]-w);break;case"Q":t.quadraticCurveTo(f[1],f[2],f[3]-x,f[4]-w);break;case"C":t.bezierCurveTo(f[1],f[2],f[3],f[4],f[5]-x,f[6]-w);break;case"A":{var S=void 0;n?(S=n[c],S||(S=kR(s,f),n[c]=S)):S=kR(s,f);var M=S.cx,R=S.cy,I=S.rx,P=S.ry,k=S.startAngle,z=S.endAngle,G=S.xRotation,J=S.sweepFlag;if(t.ellipse)t.ellipse(M,R,I,P,G,k,z,1-J);else{var Z=I>P?I:P,X=I>P?1:I/P,et=I>P?P/I:1;t.translate(M,R),t.rotate(G),t.scale(X,et),t.arc(0,0,Z,k,z,1-J),t.scale(1/X,1/et),t.rotate(-G),t.translate(-M,-R)}break}case"Z":t.closePath();break}if(d==="Z")s=l;else{var at=f.length;s=[f[at-2],f[at-1]]}}}}function Knt(e,t){var r=e.get("canvas");r&&(t==="remove"&&(e._cacheCanvasBBox=e.get("cacheCanvasBBox")),e.get("hasChanged")||(e.set("hasChanged",!0),e.cfg.parent&&e.cfg.parent.get("hasChanged")||(r.refreshElement(e,t,r),r.get("autoDraw")&&r.draw())))}function Jjt(e){var t;if(e.destroyed)t=e._cacheCanvasBBox;else{var r=e.get("cacheCanvasBBox"),n=r&&!!(r.width&&r.height),i=e.getCanvasBBox(),a=i&&!!(i.width&&i.height);n&&a?t=Hjt(r,i):n?t=r:a&&(t=i)}return t}function tYt(e){if(!e.length)return null;var t=[],r=[],n=[],i=[];return ft(e,function(a){var o=Jjt(a);o&&(t.push(o.minX),r.push(o.minY),n.push(o.maxX),i.push(o.maxY))}),{minX:Wh(t),minY:Wh(r),maxX:nh(n),maxY:nh(i)}}function eYt(e,t){return!e||!t||!YC(e,t)?null:{minX:Math.max(e.minX,t.minX),minY:Math.max(e.minY,t.minY),maxX:Math.min(e.maxX,t.maxX),maxY:Math.min(e.maxY,t.maxY)}}var jN=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.onCanvasChange=function(r){Knt(this,r)},t.prototype.getShapeBase=function(){return SI},t.prototype.getGroupBase=function(){return t},t.prototype._applyClip=function(r,n){n&&(r.save(),cb(r,n),n.createPath(r),r.restore(),r.clip(),n._afterDraw())},t.prototype.cacheCanvasBBox=function(){var r=this.cfg.children,n=[],i=[];ft(r,function(d){var v=d.cfg.cacheCanvasBBox;v&&d.cfg.isInView&&(n.push(v.minX,v.maxX),i.push(v.minY,v.maxY))});var a=null;if(n.length){var o=Wh(n),s=nh(n),l=Wh(i),u=nh(i);a={minX:o,minY:l,x:o,y:l,maxX:s,maxY:u,width:s-o,height:u-l};var c=this.cfg.canvas;if(c){var f=c.getViewRange();this.set("isInView",YC(a,f))}}else this.set("isInView",!1);this.set("cacheCanvasBBox",a)},t.prototype.draw=function(r,n){var i=this.cfg.children,a=n?this.cfg.refresh:!0;i.length&&a&&(r.save(),cb(r,this),this._applyClip(r,this.getClip()),WF(r,i,n),r.restore(),this.cacheCanvasBBox()),this.cfg.refresh=null,this.set("hasChanged",!1)},t.prototype.skipDraw=function(){this.set("cacheCanvasBBox",null),this.set("hasChanged",!1)},t}(JS),np=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var r=e.prototype.getDefaultAttrs.call(this);return $($({},r),{lineWidth:1,lineAppendWidth:0,strokeOpacity:1,fillOpacity:1})},t.prototype.getShapeBase=function(){return SI},t.prototype.getGroupBase=function(){return jN},t.prototype.onCanvasChange=function(r){Knt(this,r)},t.prototype.calculateBBox=function(){var r=this.get("type"),n=this.getHitLineWidth(),i=e2(r),a=i(this),o=n/2,s=a.x-o,l=a.y-o,u=a.x+a.width+o,c=a.y+a.height+o;return{x:s,minX:s,y:l,minY:l,width:a.width+n,height:a.height+n,maxX:u,maxY:c}},t.prototype.isFill=function(){return!!this.attrs.fill||this.isClipShape()},t.prototype.isStroke=function(){return!!this.attrs.stroke},t.prototype._applyClip=function(r,n){n&&(r.save(),cb(r,n),n.createPath(r),r.restore(),r.clip(),n._afterDraw())},t.prototype.draw=function(r,n){var i=this.cfg.clipShape;if(n){if(this.cfg.refresh===!1){this.set("hasChanged",!1);return}var a=this.getCanvasBBox();if(!YC(n,a)){this.set("hasChanged",!1),this.cfg.isInView&&this._afterDraw();return}}r.save(),cb(r,this),this._applyClip(r,i),this.drawPath(r),r.restore(),this._afterDraw()},t.prototype.getCanvasViewBox=function(){var r=this.cfg.canvas;return r?r.getViewRange():null},t.prototype.cacheCanvasBBox=function(){var r=this.getCanvasViewBox();if(r){var n=this.getCanvasBBox(),i=YC(n,r);this.set("isInView",i),i?this.set("cacheCanvasBBox",n):this.set("cacheCanvasBBox",null)}},t.prototype._afterDraw=function(){this.cacheCanvasBBox(),this.set("hasChanged",!1),this.set("refresh",null)},t.prototype.skipDraw=function(){this.set("cacheCanvasBBox",null),this.set("isInView",null),this.set("hasChanged",!1)},t.prototype.drawPath=function(r){this.createPath(r),this.strokeAndFill(r),this.afterDrawPath(r)},t.prototype.fill=function(r){r.fill()},t.prototype.stroke=function(r){r.stroke()},t.prototype.strokeAndFill=function(r){var n=this.attrs,i=n.lineWidth,a=n.opacity,o=n.strokeOpacity,s=n.fillOpacity;this.isFill()&&(!ze(s)&&s!==1?(r.globalAlpha=s,this.fill(r),r.globalAlpha=a):this.fill(r)),this.isStroke()&&i>0&&(!ze(o)&&o!==1&&(r.globalAlpha=o),this.stroke(r)),this.afterDrawPath(r)},t.prototype.createPath=function(r){},t.prototype.afterDrawPath=function(r){},t.prototype.isInShape=function(r,n){var i=this.isStroke(),a=this.isFill(),o=this.getHitLineWidth();return this.isInStrokeOrPath(r,n,i,a,o)},t.prototype.isInStrokeOrPath=function(r,n,i,a,o){return!1},t.prototype.getHitLineWidth=function(){if(!this.isStroke())return 0;var r=this.attrs;return r.lineWidth+r.lineAppendWidth},t}(t2),rYt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var r=e.prototype.getDefaultAttrs.call(this);return $($({},r),{x:0,y:0,r:0})},t.prototype.isInStrokeOrPath=function(r,n,i,a,o){var s=this.attr(),l=s.x,u=s.y,c=s.r,f=o/2,d=Gnt(l,u,r,n);return a&&i?d<=c+f:a?d<=c:i?d>=c-f&&d<=c+f:!1},t.prototype.createPath=function(r){var n=this.attr(),i=n.x,a=n.y,o=n.r;r.beginPath(),r.arc(i,a,o,0,Math.PI*2,!1),r.closePath()},t}(np);function fA(e,t,r,n){return e/(r*r)+t/(n*n)}var nYt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var r=e.prototype.getDefaultAttrs.call(this);return $($({},r),{x:0,y:0,rx:0,ry:0})},t.prototype.isInStrokeOrPath=function(r,n,i,a,o){var s=this.attr(),l=o/2,u=s.x,c=s.y,f=s.rx,d=s.ry,v=(r-u)*(r-u),g=(n-c)*(n-c);return a&&i?fA(v,g,f+l,d+l)<=1:a?fA(v,g,f,d)<=1:i?fA(v,g,f-l,d-l)>=1&&fA(v,g,f+l,d+l)<=1:!1},t.prototype.createPath=function(r){var n=this.attr(),i=n.x,a=n.y,o=n.rx,s=n.ry;if(r.beginPath(),r.ellipse)r.ellipse(i,a,o,s,0,0,Math.PI*2,!1);else{var l=o>s?o:s,u=o>s?1:o/s,c=o>s?s/o:1;r.save(),r.translate(i,a),r.scale(u,c),r.arc(0,0,l,0,Math.PI*2),r.restore(),r.closePath()}},t}(np);function UG(e){return e instanceof HTMLElement&&en(e.nodeName)&&e.nodeName.toUpperCase()==="CANVAS"}var iYt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var r=e.prototype.getDefaultAttrs.call(this);return $($({},r),{x:0,y:0,width:0,height:0})},t.prototype.initAttrs=function(r){this._setImage(r.img)},t.prototype.isStroke=function(){return!1},t.prototype.isOnlyHitBox=function(){return!0},t.prototype._afterLoading=function(){if(this.get("toDraw")===!0){var r=this.get("canvas");r?r.draw():this.createPath(this.get("context"))}},t.prototype._setImage=function(r){var n=this,i=this.attrs;if(en(r)){var a=new Image;a.onload=function(){if(n.destroyed)return!1;n.attr("img",a),n.set("loading",!1),n._afterLoading();var o=n.get("callback");o&&o.call(n)},a.crossOrigin="Anonymous",a.src=r,this.set("loading",!0)}else r instanceof Image?(i.width||(i.width=r.width),i.height||(i.height=r.height)):UG(r)&&(i.width||(i.width=Number(r.getAttribute("width"))),i.height||(i.height,Number(r.getAttribute("height"))))},t.prototype.onAttrChange=function(r,n,i){e.prototype.onAttrChange.call(this,r,n,i),r==="img"&&this._setImage(n)},t.prototype.createPath=function(r){if(this.get("loading")){this.set("toDraw",!0),this.set("context",r);return}var n=this.attr(),i=n.x,a=n.y,o=n.width,s=n.height,l=n.sx,u=n.sy,c=n.swidth,f=n.sheight,d=n.img;(d instanceof Image||UG(d))&&(!ze(l)&&!ze(u)&&!ze(c)&&!ze(f)?r.drawImage(d,l,u,c,f,i,a,o,s):r.drawImage(d,i,a,o,s))},t}(np);function $m(e,t,r,n,i,a,o){var s=Math.min(e,r),l=Math.max(e,r),u=Math.min(t,n),c=Math.max(t,n),f=i/2;return a>=s-f&&a<=l+f&&o>=u-f&&o<=c+f?Wl.pointToLine(e,t,r,n,a,o)<=i/2:!1}var aYt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var r=e.prototype.getDefaultAttrs.call(this);return $($({},r),{x1:0,y1:0,x2:0,y2:0,startArrow:!1,endArrow:!1})},t.prototype.initAttrs=function(r){this.setArrow()},t.prototype.onAttrChange=function(r,n,i){e.prototype.onAttrChange.call(this,r,n,i),this.setArrow()},t.prototype.setArrow=function(){var r=this.attr(),n=r.x1,i=r.y1,a=r.x2,o=r.y2,s=r.startArrow,l=r.endArrow;s&&GN(this,r,a,o,n,i),l&&WN(this,r,n,i,a,o)},t.prototype.isInStrokeOrPath=function(r,n,i,a,o){if(!i||!o)return!1;var s=this.attr(),l=s.x1,u=s.y1,c=s.x2,f=s.y2;return $m(l,u,c,f,o,r,n)},t.prototype.createPath=function(r){var n=this.attr(),i=n.x1,a=n.y1,o=n.x2,s=n.y2,l=n.startArrow,u=n.endArrow,c={dx:0,dy:0},f={dx:0,dy:0};l&&l.d&&(c=Wy(i,a,o,s,n.startArrow.d)),u&&u.d&&(f=Wy(i,a,o,s,n.endArrow.d)),r.beginPath(),r.moveTo(i+c.dx,a+c.dy),r.lineTo(o-f.dx,s-f.dy)},t.prototype.afterDrawPath=function(r){var n=this.get("startArrowShape"),i=this.get("endArrowShape");n&&n.draw(r),i&&i.draw(r)},t.prototype.getTotalLength=function(){var r=this.attr(),n=r.x1,i=r.y1,a=r.x2,o=r.y2;return Wl.length(n,i,a,o)},t.prototype.getPoint=function(r){var n=this.attr(),i=n.x1,a=n.y1,o=n.x2,s=n.y2;return Wl.pointAt(i,a,o,s,r)},t}(np),oYt=/[MLHVQTCSAZ]([^MLHVQTCSAZ]*)/ig,sYt=/[^\s\,]+/ig;function lYt(e){var t=e||[];if(Fe(t))return t;if(en(t))return t=t.match(oYt),ft(t,function(r,n){if(r=r.match(sYt),r[0].length>1){var i=r[0].charAt(0);r.splice(1,0,r[0].substr(1)),r[0]=i}ft(r,function(a,o){isNaN(a)||(r[o]=+a)}),t[n]=r}),t}var aC=`	
\v\f\r   ᠎             　\u2028\u2029`,uYt=new RegExp("([a-z])["+aC+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+aC+"]*,?["+aC+"]*)+)","ig"),cYt=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+aC+"]*,?["+aC+"]*","ig");function hYt(e){if(!e)return null;if(Fe(e))return e;var t={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},r=[];return String(e).replace(uYt,function(n,i,a){var o=[],s=i.toLowerCase();if(a.replace(cYt,function(l,u){u&&o.push(+u)}),s==="m"&&o.length>2&&(r.push([i].concat(o.splice(0,2))),s="l",i=i==="m"?"l":"L"),s==="o"&&o.length===1&&r.push([i,o[0]]),s==="r")r.push([i].concat(o));else for(;o.length>=t[s]&&(r.push([i].concat(o.splice(0,t[s]))),!!t[s]););return""}),r}var fYt=/[a-z]/;function $G(e,t){return[t[0]+(t[0]-e[0]),t[1]+(t[1]-e[1])]}function Qnt(e){var t=hYt(e);if(!t||!t.length)return[["M",0,0]];for(var r=!1,n=0;n<t.length;n++){var i=t[n][0];if(fYt.test(i)||["V","H","T","S"].indexOf(i)>=0){r=!0;break}}if(!r)return t;var a=[],o=0,s=0,l=0,u=0,c=0,f=t[0];(f[0]==="M"||f[0]==="m")&&(o=+f[1],s=+f[2],l=o,u=s,c++,a[0]=["M",o,s]);for(var n=c,d=t.length;n<d;n++){var v=t[n],g=a[n-1],x=[],i=v[0],w=i.toUpperCase();if(i!==w)switch(x[0]=w,w){case"A":x[1]=v[1],x[2]=v[2],x[3]=v[3],x[4]=v[4],x[5]=v[5],x[6]=+v[6]+o,x[7]=+v[7]+s;break;case"V":x[1]=+v[1]+s;break;case"H":x[1]=+v[1]+o;break;case"M":l=+v[1]+o,u=+v[2]+s,x[1]=l,x[2]=u;break;default:for(var S=1,M=v.length;S<M;S++)x[S]=+v[S]+(S%2?o:s)}else x=t[n];switch(w){case"Z":o=+l,s=+u;break;case"H":o=x[1],x=["L",o,s];break;case"V":s=x[1],x=["L",o,s];break;case"T":o=x[1],s=x[2];var R=$G([g[1],g[2]],[g[3],g[4]]);x=["Q",R[0],R[1],o,s];break;case"S":o=x[x.length-2],s=x[x.length-1];var I=g.length,P=$G([g[I-4],g[I-3]],[g[I-2],g[I-1]]);x=["C",P[0],P[1],x[1],x[2],o,s];break;case"M":l=x[x.length-2],u=x[x.length-1];break;default:o=x[x.length-2],s=x[x.length-1]}a.push(x)}return a}function dA(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function jF(e,t){return dA(e)*dA(t)?(e[0]*t[0]+e[1]*t[1])/(dA(e)*dA(t)):1}function HG(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(jF(e,t))}function YF(e,t){return e[0]===t[0]&&e[1]===t[1]}function dYt(e,t){var r=t[1],n=t[2],i=jS(YS(t[3]),Math.PI*2),a=t[4],o=t[5],s=e[0],l=e[1],u=t[6],c=t[7],f=Math.cos(i)*(s-u)/2+Math.sin(i)*(l-c)/2,d=-1*Math.sin(i)*(s-u)/2+Math.cos(i)*(l-c)/2,v=f*f/(r*r)+d*d/(n*n);v>1&&(r*=Math.sqrt(v),n*=Math.sqrt(v));var g=r*r*(d*d)+n*n*(f*f),x=g?Math.sqrt((r*r*(n*n)-g)/g):1;a===o&&(x*=-1),isNaN(x)&&(x=0);var w=n?x*r*d/n:0,S=r?x*-n*f/r:0,M=(s+u)/2+Math.cos(i)*w-Math.sin(i)*S,R=(l+c)/2+Math.sin(i)*w+Math.cos(i)*S,I=[(f-w)/r,(d-S)/n],P=[(-1*f-w)/r,(-1*d-S)/n],k=HG([1,0],I),z=HG(I,P);return jF(I,P)<=-1&&(z=Math.PI),jF(I,P)>=1&&(z=0),o===0&&z>0&&(z=z-2*Math.PI),o===1&&z<0&&(z=z+2*Math.PI),{cx:M,cy:R,rx:YF(e,[u,c])?0:r,ry:YF(e,[u,c])?0:n,startAngle:k,endAngle:k+z,xRotation:i,arcFlag:a,sweepFlag:o}}function VG(e,t){return[t[0]+(t[0]-e[0]),t[1]+(t[1]-e[1])]}function pYt(e){e=lYt(e);for(var t=[],r=null,n=null,i=null,a=0,o=e.length,s=0;s<o;s++){var l=e[s];n=e[s+1];var u=l[0],c={command:u,prePoint:r,params:l,startTangent:null,endTangent:null};switch(u){case"M":i=[l[1],l[2]],a=s;break;case"A":var f=dYt(r,l);c.arcParams=f;break}if(u==="Z")r=i,n=e[a+1];else{var d=l.length;r=[l[d-2],l[d-1]]}n&&n[0]==="Z"&&(n=e[a],t[a]&&(t[a].prePoint=r)),c.currentPoint=r,t[a]&&YF(r,t[a].currentPoint)&&(t[a].prePoint=c.prePoint);var v=n?[n[n.length-2],n[n.length-1]]:null;c.nextPoint=v;var g=c.prePoint;if(["L","H","V"].includes(u))c.startTangent=[g[0]-r[0],g[1]-r[1]],c.endTangent=[r[0]-g[0],r[1]-g[1]];else if(u==="Q"){var x=[l[1],l[2]];c.startTangent=[g[0]-x[0],g[1]-x[1]],c.endTangent=[r[0]-x[0],r[1]-x[1]]}else if(u==="T"){var w=t[s-1],x=VG(w.currentPoint,g);w.command==="Q"?(c.command="Q",c.startTangent=[g[0]-x[0],g[1]-x[1]],c.endTangent=[r[0]-x[0],r[1]-x[1]]):(c.command="TL",c.startTangent=[g[0]-r[0],g[1]-r[1]],c.endTangent=[r[0]-g[0],r[1]-g[1]])}else if(u==="C"){var S=[l[1],l[2]],M=[l[3],l[4]];c.startTangent=[g[0]-S[0],g[1]-S[1]],c.endTangent=[r[0]-M[0],r[1]-M[1]],c.startTangent[0]===0&&c.startTangent[1]===0&&(c.startTangent=[S[0]-M[0],S[1]-M[1]]),c.endTangent[0]===0&&c.endTangent[1]===0&&(c.endTangent=[M[0]-S[0],M[1]-S[1]])}else if(u==="S"){var w=t[s-1],S=VG(w.currentPoint,g),M=[l[1],l[2]];w.command==="C"?(c.command="C",c.startTangent=[g[0]-S[0],g[1]-S[1]],c.endTangent=[r[0]-M[0],r[1]-M[1]]):(c.command="SQ",c.startTangent=[g[0]-M[0],g[1]-M[1]],c.endTangent=[r[0]-M[0],r[1]-M[1]])}else if(u==="A"){var R=.001,I=c.arcParams||{},P=I.cx,k=P===void 0?0:P,z=I.cy,G=z===void 0?0:z,J=I.rx,Z=J===void 0?0:J,X=I.ry,et=X===void 0?0:X,at=I.sweepFlag,wt=at===void 0?0:at,Tt=I.startAngle,vt=Tt===void 0?0:Tt,zt=I.endAngle,oe=zt===void 0?0:zt;wt===0&&(R*=-1);var Qt=Z*Math.cos(vt-R)+k,ne=et*Math.sin(vt-R)+G;c.startTangent=[Qt-i[0],ne-i[1]];var de=Z*Math.cos(vt+oe+R)+k,De=et*Math.sin(vt+oe-R)+G;c.endTangent=[g[0]-de,g[1]-De]}t.push(c)}return t}var vYt={circle:function(e,t,r){return[["M",e-r,t],["A",r,r,0,1,0,e+r,t],["A",r,r,0,1,0,e-r,t]]},square:function(e,t,r){return[["M",e-r,t-r],["L",e+r,t-r],["L",e+r,t+r],["L",e-r,t+r],["Z"]]},diamond:function(e,t,r){return[["M",e-r,t],["L",e,t-r],["L",e+r,t],["L",e,t+r],["Z"]]},triangle:function(e,t,r){var n=r*Math.sin(.3333333333333333*Math.PI);return[["M",e-r,t+n],["L",e,t-n],["L",e+r,t+n],["Z"]]},"triangle-down":function(e,t,r){var n=r*Math.sin(.3333333333333333*Math.PI);return[["M",e-r,t-n],["L",e+r,t-n],["L",e,t+n],["Z"]]}},gYt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.initAttrs=function(r){this._resetParamsCache()},t.prototype._resetParamsCache=function(){this.set("paramsCache",{})},t.prototype.onAttrChange=function(r,n,i){e.prototype.onAttrChange.call(this,r,n,i),["symbol","x","y","r","radius"].indexOf(r)!==-1&&this._resetParamsCache()},t.prototype.isOnlyHitBox=function(){return!0},t.prototype._getR=function(r){return ze(r.r)?r.radius:r.r},t.prototype._getPath=function(){var r=this.attr(),n=r.x,i=r.y,a=r.symbol||"circle",o=this._getR(r),s,l;if(Rr(a))s=a,l=s(n,i,o),l=Qnt(l);else{if(s=t.Symbols[a],!s)return console.warn(a+" marker is not supported."),null;l=s(n,i,o)}return l},t.prototype.createPath=function(r){var n=this._getPath(),i=this.get("paramsCache");qnt(this,r,{path:n},i)},t.Symbols=vYt,t}(np);function Jnt(e,t,r){var n=r2();return e.createPath(n),n.isPointInPath(t,r)}var mYt=1e-6;function mP(e){return Math.abs(e)<mYt?0:e<0?-1:1}function yYt(e,t,r){return(r[0]-e[0])*(t[1]-e[1])===(t[0]-e[0])*(r[1]-e[1])&&Math.min(e[0],t[0])<=r[0]&&r[0]<=Math.max(e[0],t[0])&&Math.min(e[1],t[1])<=r[1]&&r[1]<=Math.max(e[1],t[1])}function tit(e,t,r){var n=!1,i=e.length;if(i<=2)return!1;for(var a=0;a<i;a++){var o=e[a],s=e[(a+1)%i];if(yYt(o,s,[t,r]))return!0;mP(o[1]-r)>0!=mP(s[1]-r)>0&&mP(t-(r-o[1])*(o[0]-s[0])/(o[1]-s[1])-o[0])<0&&(n=!n)}return n}function kw(e,t,r,n,i,a,o,s){var l=(Math.atan2(s-t,o-e)+Math.PI*2)%(Math.PI*2);if(l<n||l>i)return!1;var u={x:e+r*Math.cos(l),y:t+r*Math.sin(l)};return Gnt(u.x,u.y,o,s)<=a/2}var _Yt=Ws;function xYt(e){for(var t=!1,r=e.length,n=0;n<r;n++){var i=e[n],a=i[0];if(a==="C"||a==="A"||a==="Q"){t=!0;break}}return t}function bYt(e,t,r,n,i){for(var a=!1,o=t/2,s=0;s<e.length;s++){var l=e[s],u=l.currentPoint,c=l.params,f=l.prePoint,d=l.box;if(!(d&&!Ly(d.x-o,d.y-o,d.width+t,d.height+t,r,n))){switch(l.command){case"L":case"Z":a=$m(f[0],f[1],u[0],u[1],t,r,n);break;case"Q":var v=$et.pointDistance(f[0],f[1],c[1],c[2],c[3],c[4],r,n);a=v<=t/2;break;case"C":var g=Jw.pointDistance(f[0],f[1],c[1],c[2],c[3],c[4],c[5],c[6],r,n,i);a=g<=t/2;break;case"A":var x=l.arcParams,w=x.cx,S=x.cy,M=x.rx,R=x.ry,I=x.startAngle,P=x.endAngle,k=x.xRotation,z=[r,n,1],G=M>R?M:R,J=M>R?1:M/R,Z=M>R?R/M:1,X=_Yt(null,[["t",-w,-S],["r",-k],["s",1/J,1/Z]]);wC(z,z,X),a=kw(0,0,G,I,P,t,z[0],z[1]);break}if(a)break}}return a}function EYt(e){for(var t=e.length,r=[],n=[],i=[],a=0;a<t;a++){var o=e[a],s=o[0];s==="M"?(i.length&&(n.push(i),i=[]),i.push([o[1],o[2]])):s==="Z"?i.length&&(r.push(i),i=[]):i.push([o[1],o[2]])}return i.length>0&&n.push(i),{polygons:r,polylines:n}}const pA=$({hasArc:xYt,extractPolygons:EYt,isPointInStroke:bYt},r3);function GG(e,t,r){for(var n=!1,i=0;i<e.length;i++){var a=e[i];if(n=tit(a,t,r),n)break}return n}var YN=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var r=e.prototype.getDefaultAttrs.call(this);return $($({},r),{startArrow:!1,endArrow:!1})},t.prototype.initAttrs=function(r){this._setPathArr(r.path),this.setArrow()},t.prototype.onAttrChange=function(r,n,i){e.prototype.onAttrChange.call(this,r,n,i),r==="path"&&this._setPathArr(n),this.setArrow()},t.prototype._setPathArr=function(r){this.attrs.path=Qnt(r);var n=pA.hasArc(r);this.set("hasArc",n),this.set("paramsCache",{}),this.set("segments",null),this.set("curve",null),this.set("tCache",null),this.set("totalLength",null)},t.prototype.getSegments=function(){var r=this.get("segements");return r||(r=pYt(this.attr("path")),this.set("segments",r)),r},t.prototype.setArrow=function(){var r=this.attr(),n=r.startArrow,i=r.endArrow;if(n){var a=this.getStartTangent();GN(this,r,a[0][0],a[0][1],a[1][0],a[1][1])}if(i){var a=this.getEndTangent();WN(this,r,a[0][0],a[0][1],a[1][0],a[1][1])}},t.prototype.isInStrokeOrPath=function(r,n,i,a,o){var s=this.getSegments(),l=this.get("hasArc"),u=!1;if(i){var c=this.getTotalLength();u=pA.isPointInStroke(s,o,r,n,c)}if(!u&&a)if(l)u=Jnt(this,r,n);else{var f=this.attr("path"),d=pA.extractPolygons(f);u=GG(d.polygons,r,n)||GG(d.polylines,r,n)}return u},t.prototype.createPath=function(r){var n=this.attr(),i=this.get("paramsCache");qnt(this,r,n,i)},t.prototype.afterDrawPath=function(r){var n=this.get("startArrowShape"),i=this.get("endArrowShape");n&&n.draw(r),i&&i.draw(r)},t.prototype.getTotalLength=function(){var r=this.get("totalLength");return ze(r)?(this._calculateCurve(),this._setTcache(),this.get("totalLength")):r},t.prototype.getPoint=function(r){var n=this.get("tCache");n||(this._calculateCurve(),this._setTcache(),n=this.get("tCache"));var i,a,o=this.get("curve");if(!n||n.length===0)return o?{x:o[0][1],y:o[0][2]}:null;ft(n,function(c,f){r>=c[0]&&r<=c[1]&&(i=(r-c[0])/(c[1]-c[0]),a=f)});var s=o[a];if(ze(s)||ze(a))return null;var l=s.length,u=o[a+1];return Jw.pointAt(s[l-2],s[l-1],u[1],u[2],u[3],u[4],u[5],u[6],i)},t.prototype._calculateCurve=function(){var r=this.attr().path;this.set("curve",pA.pathToCurve(r))},t.prototype._setTcache=function(){var r=0,n=0,i=[],a,o,s,l,u=this.get("curve");if(u){if(ft(u,function(c,f){s=u[f+1],l=c.length,s&&(r+=Jw.length(c[l-2],c[l-1],s[1],s[2],s[3],s[4],s[5],s[6])||0)}),this.set("totalLength",r),r===0){this.set("tCache",[]);return}ft(u,function(c,f){s=u[f+1],l=c.length,s&&(a=[],a[0]=n/r,o=Jw.length(c[l-2],c[l-1],s[1],s[2],s[3],s[4],s[5],s[6]),n+=o||0,a[1]=n/r,i.push(a))}),this.set("tCache",i)}},t.prototype.getStartTangent=function(){var r=this.getSegments(),n;if(r.length>1){var i=r[0].currentPoint,a=r[1].currentPoint,o=r[1].startTangent;n=[],o?(n.push([i[0]-o[0],i[1]-o[1]]),n.push([i[0],i[1]])):(n.push([a[0],a[1]]),n.push([i[0],i[1]]))}return n},t.prototype.getEndTangent=function(){var r=this.getSegments(),n=r.length,i;if(n>1){var a=r[n-2].currentPoint,o=r[n-1].currentPoint,s=r[n-1].endTangent;i=[],s?(i.push([o[0]-s[0],o[1]-s[1]]),i.push([o[0],o[1]])):(i.push([a[0],a[1]]),i.push([o[0],o[1]]))}return i},t}(np);function eit(e,t,r,n,i){var a=e.length;if(a<2)return!1;for(var o=0;o<a-1;o++){var s=e[o][0],l=e[o][1],u=e[o+1][0],c=e[o+1][1];if($m(s,l,u,c,t,r,n))return!0}if(i){var f=e[0],d=e[a-1];if($m(f[0],f[1],d[0],d[1],t,r,n))return!0}return!1}var wYt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.isInStrokeOrPath=function(r,n,i,a,o){var s=this.attr().points,l=!1;return i&&(l=eit(s,o,r,n,!0)),!l&&a&&(l=tit(s,r,n)),l},t.prototype.createPath=function(r){var n=this.attr(),i=n.points;if(!(i.length<2)){r.beginPath();for(var a=0;a<i.length;a++){var o=i[a];a===0?r.moveTo(o[0],o[1]):r.lineTo(o[0],o[1])}r.closePath()}},t}(np),CYt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var r=e.prototype.getDefaultAttrs.call(this);return $($({},r),{startArrow:!1,endArrow:!1})},t.prototype.initAttrs=function(r){this.setArrow()},t.prototype.onAttrChange=function(r,n,i){e.prototype.onAttrChange.call(this,r,n,i),this.setArrow(),["points"].indexOf(r)!==-1&&this._resetCache()},t.prototype._resetCache=function(){this.set("totalLength",null),this.set("tCache",null)},t.prototype.setArrow=function(){var r=this.attr(),n=this.attrs,i=n.points,a=n.startArrow,o=n.endArrow,s=i.length,l=i[0][0],u=i[0][1],c=i[s-1][0],f=i[s-1][1];a&&GN(this,r,i[1][0],i[1][1],l,u),o&&WN(this,r,i[s-2][0],i[s-2][1],c,f)},t.prototype.isFill=function(){return!1},t.prototype.isInStrokeOrPath=function(r,n,i,a,o){if(!i||!o)return!1;var s=this.attr().points;return eit(s,o,r,n,!1)},t.prototype.isStroke=function(){return!0},t.prototype.createPath=function(r){var n=this.attr(),i=n.points,a=n.startArrow,o=n.endArrow,s=i.length;if(!(i.length<2)){var l=i[0][0],u=i[0][1],c=i[s-1][0],f=i[s-1][1];if(a&&a.d){var d=Wy(l,u,i[1][0],i[1][1],a.d);l+=d.dx,u+=d.dy}if(o&&o.d){var d=Wy(i[s-2][0],i[s-2][1],c,f,o.d);c-=d.dx,f-=d.dy}r.beginPath(),r.moveTo(l,u);for(var v=0;v<s-1;v++){var g=i[v];r.lineTo(g[0],g[1])}r.lineTo(c,f)}},t.prototype.afterDrawPath=function(r){var n=this.get("startArrowShape"),i=this.get("endArrowShape");n&&n.draw(r),i&&i.draw(r)},t.prototype.getTotalLength=function(){var r=this.attr().points,n=this.get("totalLength");return ze(n)?(this.set("totalLength",Get.length(r)),this.get("totalLength")):n},t.prototype.getPoint=function(r){var n=this.attr().points,i=this.get("tCache");i||(this._setTcache(),i=this.get("tCache"));var a,o;return ft(i,function(s,l){r>=s[0]&&r<=s[1]&&(a=(r-s[0])/(s[1]-s[0]),o=l)}),Wl.pointAt(n[o][0],n[o][1],n[o+1][0],n[o+1][1],a)},t.prototype._setTcache=function(){var r=this.attr().points;if(!(!r||r.length===0)){var n=this.getTotalLength();if(!(n<=0)){var i=0,a=[],o,s;ft(r,function(l,u){r[u+1]&&(o=[],o[0]=i/n,s=Wl.length(l[0],l[1],r[u+1][0],r[u+1][1]),i+=s,o[1]=i/n,a.push(o))}),this.set("tCache",a)}}},t.prototype.getStartTangent=function(){var r=this.attr().points,n=[];return n.push([r[1][0],r[1][1]]),n.push([r[0][0],r[0][1]]),n},t.prototype.getEndTangent=function(){var r=this.attr().points,n=r.length-1,i=[];return i.push([r[n-1][0],r[n-1][1]]),i.push([r[n][0],r[n][1]]),i},t}(np);function SYt(e,t,r,n,i,a,o){var s=i/2;return Ly(e-s,t-s,r,i,a,o)||Ly(e+r-s,t-s,i,n,a,o)||Ly(e+s,t+n-s,r,i,a,o)||Ly(e-s,t+s,i,n,a,o)}function TYt(e,t,r,n,i,a,o,s){return $m(e+i,t,e+r-i,t,a,o,s)||$m(e+r,t+i,e+r,t+n-i,a,o,s)||$m(e+r-i,t+n,e+i,t+n,a,o,s)||$m(e,t+n-i,e,t+i,a,o,s)||kw(e+r-i,t+i,i,1.5*Math.PI,2*Math.PI,a,o,s)||kw(e+r-i,t+n-i,i,0,.5*Math.PI,a,o,s)||kw(e+i,t+n-i,i,.5*Math.PI,Math.PI,a,o,s)||kw(e+i,t+i,i,Math.PI,1.5*Math.PI,a,o,s)}var AYt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var r=e.prototype.getDefaultAttrs.call(this);return $($({},r),{x:0,y:0,width:0,height:0,radius:0})},t.prototype.isInStrokeOrPath=function(r,n,i,a,o){var s=this.attr(),l=s.x,u=s.y,c=s.width,f=s.height,d=s.radius;if(d){var g=!1;return i&&(g=TYt(l,u,c,f,d,o,r,n)),!g&&a&&(g=Jnt(this,r,n)),g}else{var v=o/2;if(a&&i)return Ly(l-v,u-v,c+v,f+v,r,n);if(a)return Ly(l,u,c,f,r,n);if(i)return SYt(l,u,c,f,o,r,n)}},t.prototype.createPath=function(r){var n=this.attr(),i=n.x,a=n.y,o=n.width,s=n.height,l=n.radius;if(r.beginPath(),l===0)r.rect(i,a,o,s);else{var u=qjt(l),c=u[0],f=u[1],d=u[2],v=u[3];r.moveTo(i+c,a),r.lineTo(i+o-f,a),f!==0&&r.arc(i+o-f,a+f,f,-Math.PI/2,0),r.lineTo(i+o,a+s-d),d!==0&&r.arc(i+o-d,a+s-d,d,0,Math.PI/2),r.lineTo(i+v,a+s),v!==0&&r.arc(i+v,a+s-v,v,Math.PI/2,Math.PI),r.lineTo(i,a+c),c!==0&&r.arc(i+c,a+c,c,Math.PI,Math.PI*1.5),r.closePath()}},t}(np),MYt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var r=e.prototype.getDefaultAttrs.call(this);return $($({},r),{x:0,y:0,text:null,fontSize:12,fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"normal",fontVariant:"normal",textAlign:"start",textBaseline:"bottom"})},t.prototype.isOnlyHitBox=function(){return!0},t.prototype.initAttrs=function(r){this._assembleFont(),r.text&&this._setText(r.text)},t.prototype._assembleFont=function(){var r=this.attrs;r.font=i2(r)},t.prototype._setText=function(r){var n=null;en(r)&&r.indexOf(`
`)!==-1&&(n=r.split(`
`)),this.set("textArr",n)},t.prototype.onAttrChange=function(r,n,i){e.prototype.onAttrChange.call(this,r,n,i),r.startsWith("font")&&this._assembleFont(),r==="text"&&this._setText(n)},t.prototype._getSpaceingY=function(){var r=this.attrs,n=r.lineHeight,i=r.fontSize*1;return n?n-i:i*.14},t.prototype._drawTextArr=function(r,n,i){var a=this.attrs,o=a.textBaseline,s=a.x,l=a.y,u=a.fontSize*1,c=this._getSpaceingY(),f=n2(a.text,a.fontSize,a.lineHeight),d;ft(n,function(v,g){d=l+g*(c+u)-f+u,o==="middle"&&(d+=f-u-(f-u)/2),o==="top"&&(d+=f-u),ze(v)||(i?r.fillText(v,s,d):r.strokeText(v,s,d))})},t.prototype._drawText=function(r,n){var i=this.attr(),a=i.x,o=i.y,s=this.get("textArr");if(s)this._drawTextArr(r,s,n);else{var l=i.text;ze(l)||(n?r.fillText(l,a,o):r.strokeText(l,a,o))}},t.prototype.strokeAndFill=function(r){var n=this.attrs,i=n.lineWidth,a=n.opacity,o=n.strokeOpacity,s=n.fillOpacity;this.isStroke()&&i>0&&(!ze(o)&&o!==1&&(r.globalAlpha=a),this.stroke(r)),this.isFill()&&(!ze(s)&&s!==1?(r.globalAlpha=s,this.fill(r),r.globalAlpha=a):this.fill(r)),this.afterDrawPath(r)},t.prototype.fill=function(r){this._drawText(r,!0)},t.prototype.stroke=function(r){this._drawText(r,!1)},t}(np);function RYt(e,t){if(t){var r=KS(t);return Hp(r,e)}return e}function rit(e,t,r){var n=e.getTotalMatrix();if(n){var i=RYt([t,r,1],n),a=i[0],o=i[1];return[a,o]}return[t,r]}function WG(e,t,r){if(e.isCanvas&&e.isCanvas())return!0;if(!ib(e)||e.cfg.isInView===!1)return!1;if(e.cfg.clipShape){var n=rit(e,t,r),i=n[0],a=n[1];if(e.isClipped(i,a))return!1}var o=e.cfg.cacheCanvasBBox||e.getCanvasBBox();return t>=o.minX&&t<=o.maxX&&r>=o.minY&&r<=o.maxY}function nit(e,t,r){if(!WG(e,t,r))return null;for(var n=null,i=e.getChildren(),a=i.length,o=a-1;o>=0;o--){var s=i[o];if(s.isGroup())n=nit(s,t,r);else if(WG(s,t,r)){var l=s,u=rit(s,t,r),c=u[0],f=u[1];l.isInShape(c,f)&&(n=s)}if(n)break}return n}var IYt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return r.renderer="canvas",r.autoDraw=!0,r.localRefresh=!0,r.refreshElements=[],r.clipView=!0,r.quickHit=!1,r},t.prototype.onCanvasChange=function(r){(r==="attr"||r==="sort"||r==="changeSize")&&(this.set("refreshElements",[this]),this.draw())},t.prototype.getShapeBase=function(){return SI},t.prototype.getGroupBase=function(){return jN},t.prototype.getPixelRatio=function(){var r=this.get("pixelRatio")||$jt();return r>=1?Math.ceil(r):1},t.prototype.getViewRange=function(){return{minX:0,minY:0,maxX:this.cfg.width,maxY:this.cfg.height}},t.prototype.createDom=function(){var r=document.createElement("canvas"),n=r.getContext("2d");return this.set("context",n),r},t.prototype.setDOMSize=function(r,n){e.prototype.setDOMSize.call(this,r,n);var i=this.get("context"),a=this.get("el"),o=this.getPixelRatio();a.width=o*r,a.height=o*n,o>1&&i.scale(o,o)},t.prototype.clear=function(){e.prototype.clear.call(this),this._clearFrame();var r=this.get("context"),n=this.get("el");r.clearRect(0,0,n.width,n.height)},t.prototype.getShape=function(r,n){var i;return this.get("quickHit")?i=nit(this,r,n):i=e.prototype.getShape.call(this,r,n,null),i},t.prototype._getRefreshRegion=function(){var r=this.get("refreshElements"),n=this.getViewRange(),i;if(r.length&&r[0]===this)i=n;else if(i=tYt(r),i){i.minX=Math.floor(i.minX),i.minY=Math.floor(i.minY),i.maxX=Math.ceil(i.maxX),i.maxY=Math.ceil(i.maxY),i.maxY+=1;var a=this.get("clipView");a&&(i=eYt(i,n))}return i},t.prototype.refreshElement=function(r){var n=this.get("refreshElements");n.push(r)},t.prototype._clearFrame=function(){var r=this.get("drawFrame");r&&(ret(r),this.set("drawFrame",null),this.set("refreshElements",[]))},t.prototype.draw=function(){var r=this.get("drawFrame");this.get("autoDraw")&&r||this._startDraw()},t.prototype._drawAll=function(){var r=this.get("context"),n=this.get("el"),i=this.getChildren();r.clearRect(0,0,n.width,n.height),cb(r,this),WF(r,i),this.set("refreshElements",[])},t.prototype._drawRegion=function(){var r=this.get("context"),n=this.get("refreshElements"),i=this.getChildren(),a=this._getRefreshRegion();a?(r.clearRect(a.minX,a.minY,a.maxX-a.minX,a.maxY-a.minY),r.save(),r.beginPath(),r.rect(a.minX,a.minY,a.maxX-a.minX,a.maxY-a.minY),r.clip(),cb(r,this),Kjt(this,i,a),WF(r,i,a),r.restore()):n.length&&Znt(n),ft(n,function(o){o.get("hasChanged")&&o.set("hasChanged",!1)}),this.set("refreshElements",[])},t.prototype._startDraw=function(){var r=this,n=this.get("drawFrame"),i=this.get("drawFrameCallback");n||(n=eet(function(){r.get("localRefresh")?r._drawRegion():r._drawAll(),r.set("drawFrame",null),i&&i()}),this.set("drawFrame",n))},t.prototype.skipDraw=function(){},t.prototype.removeDom=function(){var r=this.get("el");r.width=0,r.height=0,r.parentNode.removeChild(r)},t}(QS),LYt="0.5.12";const OYt=Object.freeze(Object.defineProperty({__proto__:null,AbstractCanvas:QS,AbstractGroup:JS,AbstractShape:t2,Base:qS,Canvas:IYt,Event:Nb,Group:jN,PathUtil:r3,Shape:SI,assembleFont:i2,getArcParams:kR,getBBoxMethod:e2,getOffScreenContext:r2,getTextHeight:n2,invert:KS,isAllowCapture:ib,multiplyVec2:Hp,registerBBox:Kh,registerEasing:fN,version:LYt},Symbol.toStringTag,{value:"Module"}));var ZF={rect:"path",circle:"circle",line:"line",path:"path",marker:"path",text:"text",polyline:"polyline",polygon:"polygon",image:"image",ellipse:"ellipse",dom:"foreignObject"},aa={opacity:"opacity",fillStyle:"fill",fill:"fill",fillOpacity:"fill-opacity",strokeStyle:"stroke",strokeOpacity:"stroke-opacity",stroke:"stroke",x:"x",y:"y",r:"r",rx:"rx",ry:"ry",width:"width",height:"height",x1:"x1",x2:"x2",y1:"y1",y2:"y2",lineCap:"stroke-linecap",lineJoin:"stroke-linejoin",lineWidth:"stroke-width",lineDash:"stroke-dasharray",lineDashOffset:"stroke-dashoffset",miterLimit:"stroke-miterlimit",font:"font",fontSize:"font-size",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",fontFamily:"font-family",startArrow:"marker-start",endArrow:"marker-end",path:"d",class:"class",id:"id",style:"style",preserveAspectRatio:"preserveAspectRatio"};function qf(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function iit(e){var t=ZF[e.type],r=e.getParent();if(!t)throw new Error("the type "+e.type+" is not supported by svg");var n=qf(t);if(e.get("id")&&(n.id=e.get("id")),e.set("el",n),e.set("attrs",{}),r){var i=r.get("el");i||(i=r.createDom(),r.set("el",i)),i.appendChild(n)}return n}function ait(e,t){var r=e.get("el"),n=aet(r.children).sort(t),i=document.createDocumentFragment();n.forEach(function(a){i.appendChild(a)}),r.appendChild(i)}function PYt(e,t){var r=e.parentNode,n=Array.from(r.childNodes).filter(function(s){return s.nodeType===1&&s.nodeName.toLowerCase()!=="defs"}),i=n[t],a=n.indexOf(e);if(i){if(a>t)r.insertBefore(e,i);else if(a<t){var o=n[t+1];o?r.insertBefore(e,o):r.appendChild(e)}}else r.appendChild(e)}function DYt(e,t){var r=e.cfg.el,n=e.attr(),i={dx:n.shadowOffsetX,dy:n.shadowOffsetY,blur:n.shadowBlur,color:n.shadowColor};if(!i.dx&&!i.dy&&!i.blur&&!i.color)r.removeAttribute("filter");else{var a=t.find("filter",i);a||(a=t.addShadow(i)),r.setAttribute("filter","url(#"+a+")")}}function v2(e){var t=e.attr().matrix;if(t){for(var r=e.cfg.el,n=[],i=0;i<9;i+=3)n.push(t[i]+","+t[i+1]);n=n.join(","),n.indexOf("NaN")===-1?r.setAttribute("transform","matrix("+n+")"):console.warn("invalid matrix:",t)}}function ZC(e,t){var r=e.getClip(),n=e.get("el");if(!r)n.removeAttribute("clip-path");else if(r&&!n.hasAttribute("clip-path")){iit(r),r.createPath(t);var i=t.addClip(r);n.setAttribute("clip-path","url(#"+i+")")}}function oit(e,t){t.forEach(function(r){r.draw(e)})}function sit(e,t){var r=e.get("canvas");if(r&&r.get("autoDraw")){var n=r.get("context"),i=e.getParent(),a=i?i.getChildren():[r],o=e.get("el");if(t==="remove"){var s=e.get("isClipShape");if(s){var l=o&&o.parentNode,u=l&&l.parentNode;l&&u&&u.removeChild(l)}else o&&o.parentNode&&o.parentNode.removeChild(o)}else if(t==="show")o.setAttribute("visibility","visible");else if(t==="hide")o.setAttribute("visibility","hidden");else if(t==="zIndex")PYt(o,a.indexOf(e));else if(t==="sort"){var c=e.get("children");c&&c.length&&ait(e,function(f,d){return c.indexOf(f)-c.indexOf(d)?1:0})}else t==="clear"?o&&(o.innerHTML=""):t==="matrix"?v2(e):t==="clip"?ZC(e,n):t==="attr"||t==="add"&&e.draw(n)}}var ZN=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.isEntityGroup=function(){return!0},t.prototype.createDom=function(){var r=qf("g");this.set("el",r);var n=this.getParent();if(n){var i=n.get("el");i||(i=n.createDom(),n.set("el",i)),i.appendChild(r)}return r},t.prototype.afterAttrsChange=function(r){e.prototype.afterAttrsChange.call(this,r);var n=this.get("canvas");if(n&&n.get("autoDraw")){var i=n.get("context");this.createPath(i,r)}},t.prototype.onCanvasChange=function(r){sit(this,r)},t.prototype.getShapeBase=function(){return TI},t.prototype.getGroupBase=function(){return t},t.prototype.draw=function(r){var n=this.getChildren(),i=this.get("el");this.get("destroyed")?i&&i.parentNode.removeChild(i):(i||this.createDom(),ZC(this,r),this.createPath(r),n.length&&oit(r,n))},t.prototype.createPath=function(r,n){var i=this.attr(),a=this.get("el");ft(n||i,function(o,s){aa[s]&&a.setAttribute(aa[s],o)}),v2(this)},t}(JS),od=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="svg",r.canFill=!1,r.canStroke=!1,r}return t.prototype.getDefaultAttrs=function(){var r=e.prototype.getDefaultAttrs.call(this);return $($({},r),{lineWidth:1,lineAppendWidth:0,strokeOpacity:1,fillOpacity:1})},t.prototype.afterAttrsChange=function(r){e.prototype.afterAttrsChange.call(this,r);var n=this.get("canvas");if(n&&n.get("autoDraw")){var i=n.get("context");this.draw(i,r)}},t.prototype.getShapeBase=function(){return TI},t.prototype.getGroupBase=function(){return ZN},t.prototype.onCanvasChange=function(r){sit(this,r)},t.prototype.calculateBBox=function(){var r=this.get("el"),n=null;if(r)n=r.getBBox();else{var i=e2(this.get("type"));i&&(n=i(this))}if(n){var a=n.x,o=n.y,s=n.width,l=n.height,u=this.getHitLineWidth(),c=u/2,f=a-c,d=o-c,v=a+s+c,g=o+l+c;return{x:f,y:d,minX:f,minY:d,maxX:v,maxY:g,width:s+u,height:l+u}}return{x:0,y:0,minX:0,minY:0,maxX:0,maxY:0,width:0,height:0}},t.prototype.isFill=function(){var r=this.attr(),n=r.fill,i=r.fillStyle;return(n||i||this.isClipShape())&&this.canFill},t.prototype.isStroke=function(){var r=this.attr(),n=r.stroke,i=r.strokeStyle;return(n||i)&&this.canStroke},t.prototype.draw=function(r,n){var i=this.get("el");this.get("destroyed")?i&&i.parentNode.removeChild(i):(i||iit(this),ZC(this,r),this.createPath(r,n),this.shadow(r,n),this.strokeAndFill(r,n),this.transform(n))},t.prototype.createPath=function(r,n){},t.prototype.strokeAndFill=function(r,n){var i=n||this.attr(),a=i.fill,o=i.fillStyle,s=i.stroke,l=i.strokeStyle,u=i.fillOpacity,c=i.strokeOpacity,f=i.lineWidth,d=this.get("el");this.canFill&&(n?"fill"in i?this._setColor(r,"fill",a):"fillStyle"in i&&this._setColor(r,"fill",o):this._setColor(r,"fill",a||o),u&&d.setAttribute(aa.fillOpacity,u)),this.canStroke&&f>0&&(n?"stroke"in i?this._setColor(r,"stroke",s):"strokeStyle"in i&&this._setColor(r,"stroke",l):this._setColor(r,"stroke",s||l),c&&d.setAttribute(aa.strokeOpacity,c),f&&d.setAttribute(aa.lineWidth,f))},t.prototype._setColor=function(r,n,i){var a=this.get("el");if(!i){a.setAttribute(aa[n],"none");return}if(i=i.trim(),/^[r,R,L,l]{1}[\s]*\(/.test(i)){var o=r.find("gradient",i);o||(o=r.addGradient(i)),a.setAttribute(aa[n],"url(#"+o+")")}else if(/^[p,P]{1}[\s]*\(/.test(i)){var o=r.find("pattern",i);o||(o=r.addPattern(i)),a.setAttribute(aa[n],"url(#"+o+")")}else a.setAttribute(aa[n],i)},t.prototype.shadow=function(r,n){var i=this.attr(),a=n||i,o=a.shadowOffsetX,s=a.shadowOffsetY,l=a.shadowBlur,u=a.shadowColor;(o||s||l||u)&&DYt(this,r)},t.prototype.transform=function(r){var n=this.attr(),i=(r||n).matrix;i&&v2(this)},t.prototype.isInShape=function(r,n){return this.isPointInPath(r,n)},t.prototype.isPointInPath=function(r,n){var i=this.get("el"),a=this.get("canvas"),o=a.get("el").getBoundingClientRect(),s=r+o.left,l=n+o.top,u=document.elementFromPoint(s,l);return!!(u&&u.isEqualNode(i))},t.prototype.getHitLineWidth=function(){var r=this.attrs,n=r.lineWidth,i=r.lineAppendWidth;return this.isStroke()?n+i:0},t}(t2),FYt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="circle",r.canFill=!0,r.canStroke=!0,r}return t.prototype.getDefaultAttrs=function(){var r=e.prototype.getDefaultAttrs.call(this);return $($({},r),{x:0,y:0,r:0})},t.prototype.createPath=function(r,n){var i=this.attr(),a=this.get("el");ft(n||i,function(o,s){s==="x"||s==="y"?a.setAttribute("c"+s,o):aa[s]&&a.setAttribute(aa[s],o)})},t}(od),BYt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="dom",r.canFill=!1,r.canStroke=!1,r}return t.prototype.createPath=function(r,n){var i=this.attr(),a=this.get("el");if(ft(n||i,function(u,c){aa[c]&&a.setAttribute(aa[c],u)}),typeof i.html=="function"){var o=i.html.call(this,i);if(o instanceof Element||o instanceof HTMLDocument){for(var s=a.childNodes,l=s.length-1;l>=0;l--)a.removeChild(s[l]);a.appendChild(o)}else a.innerHTML=o}else a.innerHTML=i.html},t}(od),NYt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="ellipse",r.canFill=!0,r.canStroke=!0,r}return t.prototype.getDefaultAttrs=function(){var r=e.prototype.getDefaultAttrs.call(this);return $($({},r),{x:0,y:0,rx:0,ry:0})},t.prototype.createPath=function(r,n){var i=this.attr(),a=this.get("el");ft(n||i,function(o,s){s==="x"||s==="y"?a.setAttribute("c"+s,o):aa[s]&&a.setAttribute(aa[s],o)})},t}(od),kYt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="image",r.canFill=!1,r.canStroke=!1,r}return t.prototype.getDefaultAttrs=function(){var r=e.prototype.getDefaultAttrs.call(this);return $($({},r),{x:0,y:0,width:0,height:0})},t.prototype.createPath=function(r,n){var i=this,a=this.attr(),o=this.get("el");ft(n||a,function(s,l){l==="img"?i._setImage(a.img):aa[l]&&o.setAttribute(aa[l],s)})},t.prototype.setAttr=function(r,n){this.attrs[r]=n,r==="img"&&this._setImage(n)},t.prototype._setImage=function(r){var n=this.attr(),i=this.get("el");if(en(r))i.setAttribute("href",r);else if(r instanceof window.Image)n.width||(i.setAttribute("width",r.width),this.attr("width",r.width)),n.height||(i.setAttribute("height",r.height),this.attr("height",r.height)),i.setAttribute("href",r.src);else if(r instanceof HTMLElement&&en(r.nodeName)&&r.nodeName.toUpperCase()==="CANVAS")i.setAttribute("href",r.toDataURL());else if(r instanceof ImageData){var a=document.createElement("canvas");a.setAttribute("width",""+r.width),a.setAttribute("height",""+r.height),a.getContext("2d").putImageData(r,0,0),n.width||(i.setAttribute("width",""+r.width),this.attr("width",r.width)),n.height||(i.setAttribute("height",""+r.height),this.attr("height",r.height)),i.setAttribute("href",a.toDataURL())}},t}(od),zYt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="line",r.canFill=!1,r.canStroke=!0,r}return t.prototype.getDefaultAttrs=function(){var r=e.prototype.getDefaultAttrs.call(this);return $($({},r),{x1:0,y1:0,x2:0,y2:0,startArrow:!1,endArrow:!1})},t.prototype.createPath=function(r,n){var i=this.attr(),a=this.get("el");ft(n||i,function(o,s){if(s==="startArrow"||s==="endArrow")if(o){var l=Xi(o)?r.addArrow(i,aa[s]):r.getDefaultArrow(i,aa[s]);a.setAttribute(aa[s],"url(#"+l+")")}else a.removeAttribute(aa[s]);else aa[s]&&a.setAttribute(aa[s],o)})},t.prototype.getTotalLength=function(){var r=this.attr(),n=r.x1,i=r.y1,a=r.x2,o=r.y2;return Wl.length(n,i,a,o)},t.prototype.getPoint=function(r){var n=this.attr(),i=n.x1,a=n.y1,o=n.x2,s=n.y2;return Wl.pointAt(i,a,o,s,r)},t}(od),vA={circle:function(e,t,r){return[["M",e,t],["m",-r,0],["a",r,r,0,1,0,r*2,0],["a",r,r,0,1,0,-r*2,0]]},square:function(e,t,r){return[["M",e-r,t-r],["L",e+r,t-r],["L",e+r,t+r],["L",e-r,t+r],["Z"]]},diamond:function(e,t,r){return[["M",e-r,t],["L",e,t-r],["L",e+r,t],["L",e,t+r],["Z"]]},triangle:function(e,t,r){var n=r*Math.sin(.3333333333333333*Math.PI);return[["M",e-r,t+n],["L",e,t-n],["L",e+r,t+n],["z"]]},triangleDown:function(e,t,r){var n=r*Math.sin(.3333333333333333*Math.PI);return[["M",e-r,t-n],["L",e+r,t-n],["L",e,t+n],["Z"]]}};const XG={get:function(e){return vA[e]},register:function(e,t){vA[e]=t},remove:function(e){delete vA[e]},getAll:function(){return vA}};var UYt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="marker",r.canFill=!0,r.canStroke=!0,r}return t.prototype.createPath=function(r){var n=this.get("el");n.setAttribute("d",this._assembleMarker())},t.prototype._assembleMarker=function(){var r=this._getPath();return Fe(r)?r.map(function(n){return n.join(" ")}).join(""):r},t.prototype._getPath=function(){var r=this.attr(),n=r.x,i=r.y,a=r.r||r.radius,o=r.symbol||"circle",s;return Rr(o)?s=o:s=XG.get(o),s?s(n,i,a):(console.warn(s+" symbol is not exist."),null)},t.symbolsFactory=XG,t}(od),$Yt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="path",r.canFill=!0,r.canStroke=!0,r}return t.prototype.getDefaultAttrs=function(){var r=e.prototype.getDefaultAttrs.call(this);return $($({},r),{startArrow:!1,endArrow:!1})},t.prototype.createPath=function(r,n){var i=this,a=this.attr(),o=this.get("el");ft(n||a,function(s,l){if(l==="path"&&Fe(s))o.setAttribute("d",i._formatPath(s));else if(l==="startArrow"||l==="endArrow")if(s){var u=Xi(s)?r.addArrow(a,aa[l]):r.getDefaultArrow(a,aa[l]);o.setAttribute(aa[l],"url(#"+u+")")}else o.removeAttribute(aa[l]);else aa[l]&&o.setAttribute(aa[l],s)})},t.prototype._formatPath=function(r){var n=r.map(function(i){return i.join(" ")}).join("");return~n.indexOf("NaN")?"":n},t.prototype.getTotalLength=function(){var r=this.get("el");return r?r.getTotalLength():null},t.prototype.getPoint=function(r){var n=this.get("el"),i=this.getTotalLength();if(i===0)return null;var a=n?n.getPointAtLength(r*i):null;return a?{x:a.x,y:a.y}:null},t}(od),HYt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="polygon",r.canFill=!0,r.canStroke=!0,r}return t.prototype.createPath=function(r,n){var i=this.attr(),a=this.get("el");ft(n||i,function(o,s){s==="points"&&Fe(o)&&o.length>=2?a.setAttribute("points",o.map(function(l){return l[0]+","+l[1]}).join(" ")):aa[s]&&a.setAttribute(aa[s],o)})},t}(od),VYt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="polyline",r.canFill=!0,r.canStroke=!0,r}return t.prototype.getDefaultAttrs=function(){var r=e.prototype.getDefaultAttrs.call(this);return $($({},r),{startArrow:!1,endArrow:!1})},t.prototype.onAttrChange=function(r,n,i){e.prototype.onAttrChange.call(this,r,n,i),["points"].indexOf(r)!==-1&&this._resetCache()},t.prototype._resetCache=function(){this.set("totalLength",null),this.set("tCache",null)},t.prototype.createPath=function(r,n){var i=this.attr(),a=this.get("el");ft(n||i,function(o,s){s==="points"&&Fe(o)&&o.length>=2?a.setAttribute("points",o.map(function(l){return l[0]+","+l[1]}).join(" ")):aa[s]&&a.setAttribute(aa[s],o)})},t.prototype.getTotalLength=function(){var r=this.attr().points,n=this.get("totalLength");return ze(n)?(this.set("totalLength",Get.length(r)),this.get("totalLength")):n},t.prototype.getPoint=function(r){var n=this.attr().points,i=this.get("tCache");i||(this._setTcache(),i=this.get("tCache"));var a,o;return ft(i,function(s,l){r>=s[0]&&r<=s[1]&&(a=(r-s[0])/(s[1]-s[0]),o=l)}),Wl.pointAt(n[o][0],n[o][1],n[o+1][0],n[o+1][1],a)},t.prototype._setTcache=function(){var r=this.attr().points;if(!(!r||r.length===0)){var n=this.getTotalLength();if(!(n<=0)){var i=0,a=[],o,s;ft(r,function(l,u){r[u+1]&&(o=[],o[0]=i/n,s=Wl.length(l[0],l[1],r[u+1][0],r[u+1][1]),i+=s,o[1]=i/n,a.push(o))}),this.set("tCache",a)}}},t.prototype.getStartTangent=function(){var r=this.attr().points,n=[];return n.push([r[1][0],r[1][1]]),n.push([r[0][0],r[0][1]]),n},t.prototype.getEndTangent=function(){var r=this.attr().points,n=r.length-1,i=[];return i.push([r[n-1][0],r[n-1][1]]),i.push([r[n][0],r[n][1]]),i},t}(od);function GYt(e){var t=0,r=0,n=0,i=0;return Fe(e)?e.length===1?t=r=n=i=e[0]:e.length===2?(t=n=e[0],r=i=e[1]):e.length===3?(t=e[0],r=i=e[1],n=e[2]):(t=e[0],r=e[1],n=e[2],i=e[3]):t=r=n=i=e,{r1:t,r2:r,r3:n,r4:i}}var WYt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="rect",r.canFill=!0,r.canStroke=!0,r}return t.prototype.getDefaultAttrs=function(){var r=e.prototype.getDefaultAttrs.call(this);return $($({},r),{x:0,y:0,width:0,height:0,radius:0})},t.prototype.createPath=function(r,n){var i=this,a=this.attr(),o=this.get("el"),s=!1,l=["x","y","width","height","radius"];ft(n||a,function(u,c){l.indexOf(c)!==-1&&!s?(o.setAttribute("d",i._assembleRect(a)),s=!0):l.indexOf(c)===-1&&aa[c]&&o.setAttribute(aa[c],u)})},t.prototype._assembleRect=function(r){var n=r.x,i=r.y,a=r.width,o=r.height,s=r.radius;if(!s)return"M "+n+","+i+" l "+a+",0 l 0,"+o+" l"+-a+" 0 z";var l=GYt(s);Fe(s)?s.length===1?l.r1=l.r2=l.r3=l.r4=s[0]:s.length===2?(l.r1=l.r3=s[0],l.r2=l.r4=s[1]):s.length===3?(l.r1=s[0],l.r2=l.r4=s[1],l.r3=s[2]):(l.r1=s[0],l.r2=s[1],l.r3=s[2],l.r4=s[3]):l.r1=l.r2=l.r3=l.r4=s;var u=[["M "+(n+l.r1)+","+i],["l "+(a-l.r1-l.r2)+",0"],["a "+l.r2+","+l.r2+",0,0,1,"+l.r2+","+l.r2],["l 0,"+(o-l.r2-l.r3)],["a "+l.r3+","+l.r3+",0,0,1,"+-l.r3+","+l.r3],["l "+(l.r3+l.r4-a)+",0"],["a "+l.r4+","+l.r4+",0,0,1,"+-l.r4+","+-l.r4],["l 0,"+(l.r4+l.r1-o)],["a "+l.r1+","+l.r1+",0,0,1,"+l.r1+","+-l.r1],["z"]];return u.join(" ")},t}(od),jG=.3,XYt={top:"before-edge",middle:"central",bottom:"after-edge",alphabetic:"baseline",hanging:"hanging"},jYt={top:"text-before-edge",middle:"central",bottom:"text-after-edge",alphabetic:"alphabetic",hanging:"hanging"},YYt={left:"left",start:"left",center:"middle",right:"end",end:"end"},ZYt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="text",r.canFill=!0,r.canStroke=!0,r}return t.prototype.getDefaultAttrs=function(){var r=e.prototype.getDefaultAttrs.call(this);return $($({},r),{x:0,y:0,text:null,fontSize:12,fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"normal",fontVariant:"normal",textAlign:"start",textBaseline:"bottom"})},t.prototype.createPath=function(r,n){var i=this,a=this.attr(),o=this.get("el");this._setFont(),ft(n||a,function(s,l){l==="text"?i._setText(""+s):l==="matrix"&&s?v2(i):aa[l]&&o.setAttribute(aa[l],s)}),o.setAttribute("paint-order","stroke"),o.setAttribute("style","stroke-linecap:butt; stroke-linejoin:miter;")},t.prototype._setFont=function(){var r=this.get("el"),n=this.attr(),i=n.textBaseline,a=n.textAlign,o=yet();o&&o.name==="firefox"?r.setAttribute("dominant-baseline",jYt[i]||"alphabetic"):r.setAttribute("alignment-baseline",XYt[i]||"baseline"),r.setAttribute("text-anchor",YYt[a]||"left")},t.prototype._setText=function(r){var n=this.get("el"),i=this.attr(),a=i.x,o=i.textBaseline,s=o===void 0?"bottom":o;if(!r)n.innerHTML="";else if(~r.indexOf(`
`)){var l=r.split(`
`),u=l.length-1,c="";ft(l,function(f,d){d===0?s==="alphabetic"?c+='<tspan x="'+a+'" dy="'+-u+'em">'+f+"</tspan>":s==="top"?c+='<tspan x="'+a+'" dy="0.9em">'+f+"</tspan>":s==="middle"?c+='<tspan x="'+a+'" dy="'+-(u-1)/2+'em">'+f+"</tspan>":s==="bottom"?c+='<tspan x="'+a+'" dy="-'+(u+jG)+'em">'+f+"</tspan>":s==="hanging"&&(c+='<tspan x="'+a+'" dy="'+(-(u-1)-jG)+'em">'+f+"</tspan>"):c+='<tspan x="'+a+'" dy="1em">'+f+"</tspan>"}),n.innerHTML=c}else n.innerHTML=r},t}(od),qYt=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,KYt=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,QYt=/[\d.]+:(#[^\s]+|[^)]+\))/gi;function lit(e){var t=e.match(QYt);if(!t)return"";var r="";return t.sort(function(n,i){return n=n.split(":"),i=i.split(":"),Number(n[0])-Number(i[0])}),ft(t,function(n){n=n.split(":"),r+='<stop offset="'+n[0]+'" stop-color="'+n[1]+'"></stop>'}),r}function JYt(e,t){var r=qYt.exec(e),n=jS(YS(parseFloat(r[1])),Math.PI*2),i=r[2],a,o;n>=0&&n<.5*Math.PI?(a={x:0,y:0},o={x:1,y:1}):.5*Math.PI<=n&&n<Math.PI?(a={x:1,y:0},o={x:0,y:1}):Math.PI<=n&&n<1.5*Math.PI?(a={x:1,y:1},o={x:0,y:0}):(a={x:0,y:1},o={x:1,y:0});var s=Math.tan(n),l=s*s,u=(o.x-a.x+s*(o.y-a.y))/(l+1)+a.x,c=s*(o.x-a.x+s*(o.y-a.y))/(l+1)+a.y;t.setAttribute("x1",a.x),t.setAttribute("y1",a.y),t.setAttribute("x2",u),t.setAttribute("y2",c),t.innerHTML=lit(i)}function tZt(e,t){var r=KYt.exec(e),n=parseFloat(r[1]),i=parseFloat(r[2]),a=parseFloat(r[3]),o=r[4];t.setAttribute("cx",n),t.setAttribute("cy",i),t.setAttribute("r",a),t.innerHTML=lit(o)}var eZt=function(){function e(t){this.cfg={};var r=null,n=lh("gradient_");return t.toLowerCase()[0]==="l"?(r=qf("linearGradient"),JYt(t,r)):(r=qf("radialGradient"),tZt(t,r)),r.setAttribute("id",n),this.el=r,this.id=n,this.cfg=t,this}return e.prototype.match=function(t,r){return this.cfg===r},e}(),rZt={shadowColor:"color",shadowOpacity:"opacity",shadowBlur:"blur",shadowOffsetX:"dx",shadowOffsetY:"dy"},nZt={x:"-40%",y:"-40%",width:"200%",height:"200%"},iZt=function(){function e(t){this.type="filter",this.cfg={},this.type="filter";var r=qf("filter");return ft(nZt,function(n,i){r.setAttribute(i,n)}),this.el=r,this.id=lh("filter_"),this.el.id=this.id,this.cfg=t,this._parseShadow(t,r),this}return e.prototype.match=function(t,r){if(this.type!==t)return!1;var n=!0,i=this.cfg;return ft(Object.keys(i),function(a){if(i[a]!==r[a])return n=!1,!1}),n},e.prototype.update=function(t,r){var n=this.cfg;return n[rZt[t]]=r,this._parseShadow(n,this.el),this},e.prototype._parseShadow=function(t,r){var n=`<feDropShadow
      dx="`+(t.dx||0)+`"
      dy="`+(t.dy||0)+`"
      stdDeviation="`+(t.blur?t.blur/10:0)+`"
      flood-color="`+(t.color?t.color:"#000")+`"
      flood-opacity="`+(t.opacity?t.opacity:1)+`"
      />`;r.innerHTML=n},e}(),YG=function(){function e(t,r){this.cfg={};var n=qf("marker"),i=lh("marker_");n.setAttribute("id",i);var a=qf("path");a.setAttribute("stroke",t.stroke||"none"),a.setAttribute("fill",t.fill||"none"),n.appendChild(a),n.setAttribute("overflow","visible"),n.setAttribute("orient","auto-start-reverse"),this.el=n,this.child=a,this.id=i;var o=t[r==="marker-start"?"startArrow":"endArrow"];return this.stroke=t.stroke||"#000",o===!0?this._setDefaultPath(r,a):(this.cfg=o,this._setMarker(t.lineWidth,a)),this}return e.prototype.match=function(){return!1},e.prototype._setDefaultPath=function(t,r){var n=this.el;r.setAttribute("d","M0,0 L"+10*Math.cos(Math.PI/6)+",5 L0,10"),n.setAttribute("refX",""+10*Math.cos(Math.PI/6)),n.setAttribute("refY","5")},e.prototype._setMarker=function(t,r){var n=this.el,i=this.cfg.path,a=this.cfg.d;Fe(i)&&(i=i.map(function(o){return o.join(" ")}).join("")),r.setAttribute("d",i),n.appendChild(r),a&&n.setAttribute("refX",""+a/t)},e.prototype.update=function(t){var r=this.child;r.attr?r.attr("fill",t):r.setAttribute("fill",t)},e}(),aZt=function(){function e(t){this.type="clip",this.cfg={};var r=qf("clipPath");this.el=r,this.id=lh("clip_"),r.id=this.id;var n=t.cfg.el;return r.appendChild(n),this.cfg=t,this}return e.prototype.match=function(){return!1},e.prototype.remove=function(){var t=this.el;t.parentNode.removeChild(t)},e}(),oZt=/^p\s*\(\s*([axyn])\s*\)\s*(.*)/i,sZt=function(){function e(t){this.cfg={};var r=qf("pattern");r.setAttribute("patternUnits","userSpaceOnUse");var n=qf("image");r.appendChild(n);var i=lh("pattern_");r.id=i,this.el=r,this.id=i,this.cfg=t;var a=oZt.exec(t),o=a[2];n.setAttribute("href",o);var s=new Image;o.match(/^data:/i)||(s.crossOrigin="Anonymous"),s.src=o;function l(){r.setAttribute("width",""+s.width),r.setAttribute("height",""+s.height)}return s.complete?l():(s.onload=l,s.src=s.src),this}return e.prototype.match=function(t,r){return this.cfg===r},e}(),lZt=function(){function e(t){var r=qf("defs"),n=lh("defs_");r.id=n,t.appendChild(r),this.children=[],this.defaultArrow={},this.el=r,this.canvas=t}return e.prototype.find=function(t,r){for(var n=this.children,i=null,a=0;a<n.length;a++)if(n[a].match(t,r)){i=n[a].id;break}return i},e.prototype.findById=function(t){for(var r=this.children,n=null,i=0;i<r.length;i++)if(r[i].id===t){n=r[i];break}return n},e.prototype.add=function(t){this.children.push(t),t.canvas=this.canvas,t.parent=this},e.prototype.getDefaultArrow=function(t,r){var n=t.stroke||t.strokeStyle;if(this.defaultArrow[n])return this.defaultArrow[n].id;var i=new YG(t,r);return this.defaultArrow[n]=i,this.el.appendChild(i.el),this.add(i),i.id},e.prototype.addGradient=function(t){var r=new eZt(t);return this.el.appendChild(r.el),this.add(r),r.id},e.prototype.addArrow=function(t,r){var n=new YG(t,r);return this.el.appendChild(n.el),this.add(n),n.id},e.prototype.addShadow=function(t){var r=new iZt(t);return this.el.appendChild(r.el),this.add(r),r.id},e.prototype.addPattern=function(t){var r=new sZt(t);return this.el.appendChild(r.el),this.add(r),r.id},e.prototype.addClip=function(t){var r=new aZt(t);return this.el.appendChild(r.el),this.add(r),r.id},e}(),uZt=function(e){$t(t,e);function t(r){return e.call(this,$($({},r),{autoDraw:!0,renderer:"svg"}))||this}return t.prototype.getShapeBase=function(){return TI},t.prototype.getGroupBase=function(){return ZN},t.prototype.getShape=function(r,n,i){var a=i.target||i.srcElement;if(!ZF[a.tagName]){for(var o=a.parentNode;o&&!ZF[o.tagName];)o=o.parentNode;a=o}return this.find(function(s){return s.get("el")===a})},t.prototype.createDom=function(){var r=qf("svg"),n=new lZt(r);return r.setAttribute("width",""+this.get("width")),r.setAttribute("height",""+this.get("height")),this.set("context",n),r},t.prototype.onCanvasChange=function(r){var n=this.get("context"),i=this.get("el");if(r==="sort"){var a=this.get("children");a&&a.length&&ait(this,function(s,l){return a.indexOf(s)-a.indexOf(l)?1:0})}else if(r==="clear"){if(i){i.innerHTML="";var o=n.el;o.innerHTML="",i.appendChild(o)}}else r==="matrix"?v2(this):r==="clip"?ZC(this,n):r==="changeSize"&&(i.setAttribute("width",""+this.get("width")),i.setAttribute("height",""+this.get("height")))},t.prototype.draw=function(){var r=this.get("context"),n=this.getChildren();ZC(this,r),n.length&&oit(r,n)},t}(QS),cZt="0.5.6";const hZt=Object.freeze(Object.defineProperty({__proto__:null,AbstractCanvas:QS,AbstractGroup:JS,AbstractShape:t2,Base:qS,Canvas:uZt,Event:Nb,Group:ZN,PathUtil:r3,Shape:TI,assembleFont:i2,getBBoxMethod:e2,getOffScreenContext:r2,getTextHeight:n2,invert:KS,isAllowCapture:ib,multiplyVec2:Hp,registerBBox:Kh,registerEasing:fN,version:cZt},Symbol.toStringTag,{value:"Module"}));var qN=function(e){$t(t,e);function t(r){var n=e.call(this,r)||this;n.type="path",n.shapeType="line";var i=r.connectNulls,a=i===void 0?!1:i,o=r.showSinglePoint,s=o===void 0?!0:o;return n.connectNulls=a,n.showSinglePoint=s,n}return t.prototype.updateElements=function(r,n){var i,a,o,s,l,u;n===void 0&&(n=!1);for(var c=new Map,f=new Map,d=[],v=0,g=0;g<r.length;g++){var x=r[g],w=this.getElementId(x);d.push(w),c.set(w,x),f.set(w,v),v++}this.elements=new Array(v);var S=Dnt(this.lastElementsMap,d),M=S.added,R=S.updated,I=S.removed;try{for(var P=yi(M),k=P.next();!k.done;k=P.next()){var w=k.value,x=c.get(w),z=this.getShapeFactory(),G=this.getShapeInfo(x),g=f.get(w),J=new Int({shapeFactory:z,container:this.container,offscreenGroup:this.getOffscreenGroup(),elementIndex:g});J.geometry=this,J.animate=this.animateOption,J.draw(G,n),this.elementsMap[w]=J,this.elements[g]=J}}catch(Tt){i={error:Tt}}finally{try{k&&!k.done&&(a=P.return)&&a.call(P)}finally{if(i)throw i.error}}try{for(var Z=yi(R),X=Z.next();!X.done;X=Z.next()){var w=X.value,x=c.get(w),J=this.lastElementsMap[w],g=f.get(w),G=this.getShapeInfo(x),et=J.getModel();(this.isCoordinateChanged||Pnt(et,G))&&(J.animate=this.animateOption,J.update(G)),this.elementsMap[w]=J,this.elements[g]=J}}catch(Tt){o={error:Tt}}finally{try{X&&!X.done&&(s=Z.return)&&s.call(Z)}finally{if(o)throw o.error}}try{for(var at=yi(I),wt=at.next();!wt.done;wt=at.next()){var w=wt.value,J=this.lastElementsMap[w];J.animate=this.animateOption,J.destroy()}}catch(Tt){l={error:Tt}}finally{try{wt&&!wt.done&&(u=at.return)&&u.call(at)}finally{if(l)throw l.error}}},t.prototype.getPointsAndData=function(r){for(var n=[],i=[],a=0,o=r.length;a<o;a++){var s=r[a];n.push({x:s.x,y:s.y}),i.push(s[Pa])}return{points:n,data:i}},t.prototype.getShapeInfo=function(r){var n=this.getDrawCfg(r[0]),i=this.getPointsAndData(r),a=i.points,o=i.data;return n.mappingData=r,n.data=o,n.isStack=!!this.getAdjust("stack"),n.points=a,n.connectNulls=this.connectNulls,n.showSinglePoint=this.showSinglePoint,n},t}(C0);function fZt(e,t,r,n,i){var a=[];if(e.length){for(var o=[],s=[],l=0,u=e.length;l<u;l++){var c=e[l];o.push(c[1]),s.push(c[0])}s=s.reverse(),ft([o,s],function(f,d){var v=[],g=n.parsePoints(f),x=g[0];o.length===1&&s.length===1?v=d===0?[["M",x.x-.5,x.y],["L",x.x+.5,x.y]]:[["L",x.x+.5,x.y],["L",x.x-.5,x.y]]:(t&&g.push({x:x.x,y:x.y}),r?v=BR(g,!1,i):v=f2(g,!1),d>0&&(v[0][0]="L")),a=a.concat(v)}),a.push(["Z"])}return a}function E3(e,t,r,n,i){for(var a=bs(e,t,!t,"lineWidth"),o=e.connectNulls,s=e.isInCircle,l=e.points,u=e.showSinglePoint,c=b3(l,o,u),f=[],d=0,v=c.length;d<v;d++){var g=c[d];f=f.concat(fZt(g,s,r,n,i))}return a.path=f,a}function uit(e){var t=e.start,r=e.end;return[[t.x,r.y],[r.x,t.y]]}w0("area",{defaultShapeType:"area",getDefaultPoints:function(e){var t=e.x,r=e.y0,n=Fe(e.y)?e.y:[r,e.y];return n.map(function(i){return{x:t,y:i}})}});fa("area","area",{draw:function(e,t){var r=E3(e,!1,!1,this),n=t.addShape({type:"path",attrs:r,name:"area"});return n},getMarker:function(e){var t=e.color;return{symbol:function(r,n,i){return i===void 0&&(i=5.5),[["M",r-i,n-4],["L",r+i,n-4],["L",r+i,n+4],["L",r-i,n+4],["Z"]]},style:{r:5,fill:t,fillOpacity:1}}}});var dZt=function(e){$t(t,e);function t(r){var n=e.call(this,r)||this;n.type="area",n.shapeType="area",n.generatePoints=!0,n.startOnZero=!0;var i=r.startOnZero,a=i===void 0?!0:i,o=r.sortable,s=o===void 0?!1:o,l=r.showSinglePoint,u=l===void 0?!1:l;return n.startOnZero=a,n.sortable=s,n.showSinglePoint=u,n}return t.prototype.getPointsAndData=function(r){for(var n=[],i=[],a=0,o=r.length;a<o;a++){var s=r[a];n.push(s.points),i.push(s[Pa])}return{points:n,data:i}},t.prototype.getYMinValue=function(){if(this.startOnZero)return e.prototype.getYMinValue.call(this);var r=this.getYScale();return r.min},t}(qN);w0("edge",{defaultShapeType:"line",getDefaultPoints:function(e){return HN(e)}});fa("edge","line",{draw:function(e,t){var r=bs(e,!0,!1,"lineWidth"),n=f2(this.parsePoints(e.points),this.coordinate.isPolar);return t.addShape("path",{attrs:$($({},r),{path:n})})},getMarker:function(e){return{symbol:"circle",style:{r:4.5,fill:e.color}}}});var pZt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="edge",r.shapeType="edge",r.generatePoints=!0,r}return t}(C0),vZt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="heatmap",r.paletteCache={},r}return t.prototype.updateElements=function(r,n){for(var i=0;i<r.length;i++){var a=r[i],o=this.prepareRange(a),s=this.prepareSize(),l=xt(this.styleOption,["cfg","shadowBlur"]);Rn(l)||(l=s/2),this.prepareGreyScaleBlurredCircle(s,l),this.drawWithRange(a,o,s,l)}},t.prototype.color=function(r,n){return this.createAttrOption("color",r,typeof n!="function"?n:""),this},t.prototype.clear=function(){e.prototype.clear.call(this),this.clearShadowCanvasCtx(),this.paletteCache={}},t.prototype.prepareRange=function(r){var n=this.getAttribute("color"),i=n.getFields()[0],a=1/0,o=-1/0;return r.forEach(function(s){var l=s[Pa][i];l>o&&(o=l),l<a&&(a=l)}),a===o&&(a=o-1),[a,o]},t.prototype.prepareSize=function(){var r=this.getDefaultValue("size");return Rn(r)||(r=this.getDefaultSize()),r},t.prototype.prepareGreyScaleBlurredCircle=function(r,n){var i=this.getGrayScaleBlurredCanvas(),a=r+n,o=i.getContext("2d");i.width=i.height=a*2,o.clearRect(0,0,i.width,i.height),o.shadowOffsetX=o.shadowOffsetY=a*2,o.shadowBlur=n,o.shadowColor="black",o.beginPath(),o.arc(-a,-a,r,0,Math.PI*2,!0),o.closePath(),o.fill()},t.prototype.drawWithRange=function(r,n,i,a){var o,s,l=this.coordinate,u=l.start,c=l.end,f=this.coordinate.getWidth(),d=this.coordinate.getHeight(),v=this.getAttribute("color"),g=v.getFields()[0];this.clearShadowCanvasCtx();var x=this.getShadowCanvasCtx();n&&(r=r.filter(function(Z){return Z[Pa][g]<=n[1]&&Z[Pa][g]>=n[0]}));var w=this.scales[g];try{for(var S=yi(r),M=S.next();!M.done;M=S.next()){var R=M.value,I=this.getDrawCfg(R),P=I.x,k=I.y,z=w.scale(R[Pa][g]);this.drawGrayScaleBlurredCircle(P-u.x,k-c.y,i+a,z,x)}}catch(Z){o={error:Z}}finally{try{M&&!M.done&&(s=S.return)&&s.call(S)}finally{if(o)throw o.error}}var G=x.getImageData(0,0,f,d);this.clearShadowCanvasCtx(),this.colorize(G),x.putImageData(G,0,0);var J=this.getImageShape();J.attr("x",u.x),J.attr("y",c.y),J.attr("width",f),J.attr("height",d),J.attr("img",x.canvas),J.set("origin",this.getShapeInfo(r))},t.prototype.getDefaultSize=function(){var r=this.getAttribute("position"),n=this.coordinate;return Math.min(n.getWidth()/(r.scales[0].ticks.length*4),n.getHeight()/(r.scales[1].ticks.length*4))},t.prototype.clearShadowCanvasCtx=function(){var r=this.getShadowCanvasCtx();r.clearRect(0,0,r.canvas.width,r.canvas.height)},t.prototype.getShadowCanvasCtx=function(){var r=this.shadowCanvas;return r||(r=document.createElement("canvas"),this.shadowCanvas=r),r.width=this.coordinate.getWidth(),r.height=this.coordinate.getHeight(),r.getContext("2d")},t.prototype.getGrayScaleBlurredCanvas=function(){return this.grayScaleBlurredCanvas||(this.grayScaleBlurredCanvas=document.createElement("canvas")),this.grayScaleBlurredCanvas},t.prototype.drawGrayScaleBlurredCircle=function(r,n,i,a,o){var s=this.getGrayScaleBlurredCanvas();o.globalAlpha=a,o.drawImage(s,r-i,n-i)},t.prototype.colorize=function(r){for(var n=this.getAttribute("color"),i=r.data,a=this.paletteCache,o=3;o<i.length;o+=4){var s=i[o];if(Rn(s)){var l=a[s]?a[s]:Zm.rgb2arr(n.gradient(s/256));i[o-3]=l[0],i[o-2]=l[1],i[o-1]=l[2],i[o]=s}}},t.prototype.getImageShape=function(){var r=this.imageShape;if(r)return r;var n=this.container;return r=n.addShape({type:"image",attrs:{}}),this.imageShape=r,r},t.prototype.getShapeInfo=function(r){var n=this.getDrawCfg(r[0]),i=r.map(function(a){return a[Pa]});return $($({},n),{mappingData:r,data:i})},t}(C0);function KN(e){var t,r,n=e.x,i=e.y,a=e.y0,o=e.size,s,l;Fe(i)?(t=Pr(i,2),s=t[0],l=t[1]):(s=a,l=i);var u,c;Fe(n)?(r=Pr(n,2),u=r[0],c=r[1]):(u=n-o/2,c=n+o/2);var f=[{x:u,y:s},{x:u,y:l}];return f.push({x:c,y:l},{x:c,y:s}),f}function QN(e,t){t===void 0&&(t=!0);var r=[],n=e[0];r.push(["M",n.x,n.y]);for(var i=1,a=e.length;i<a;i++)r.push(["L",e[i].x,e[i].y]);return t&&(r.push(["L",n.x,n.y]),r.push(["z"])),r}function cit(e,t){var r=0,n=0,i=0,a=0;return Fe(e)?e.length===1?r=n=i=a=e[0]:e.length===2?(r=i=e[0],n=a=e[1]):e.length===3?(r=e[0],n=a=e[1],i=e[2]):(r=e[0],n=e[1],i=e[2],a=e[3]):r=n=i=a=e,r+n>t&&(r=r?t/(1+n/r):0,n=t-r),i+a>t&&(i=i?t/(1+a/i):0,a=t-i),[r||0,n||0,i||0,a||0]}function hit(e,t,r){var n=[];if(r.isRect){var i=r.isTransposed?{x:r.start.x,y:t[0].y}:{x:t[0].x,y:r.start.y},a=r.isTransposed?{x:r.end.x,y:t[2].y}:{x:t[3].x,y:r.end.y},o=xt(e,["background","style","radius"]);if(o){var s=r.isTransposed?Math.abs(t[0].y-t[2].y):t[2].x-t[1].x,l=r.isTransposed?r.getWidth():r.getHeight(),u=Pr(cit(o,Math.min(s,l)),4),c=u[0],f=u[1],d=u[2],v=u[3],g=r.isTransposed&&r.isReflect("y"),x=g?0:1,w=function(k){return g?-k:k};n.push(["M",i.x,a.y+w(c)]),c!==0&&n.push(["A",c,c,0,0,x,i.x+c,a.y]),n.push(["L",a.x-f,a.y]),f!==0&&n.push(["A",f,f,0,0,x,a.x,a.y+w(f)]),n.push(["L",a.x,i.y-w(d)]),d!==0&&n.push(["A",d,d,0,0,x,a.x-d,i.y]),n.push(["L",i.x+v,i.y]),v!==0&&n.push(["A",v,v,0,0,x,i.x,i.y-w(v)])}else n.push(["M",i.x,i.y]),n.push(["L",a.x,i.y]),n.push(["L",a.x,a.y]),n.push(["L",i.x,a.y]),n.push(["L",i.x,i.y]);n.push(["z"])}if(r.isPolar){var S=r.getCenter(),M=GC(e,r),R=M.startAngle,I=M.endAngle;if(r.type!=="theta"&&!r.isTransposed)n=qm(S.x,S.y,r.getRadius(),R,I);else{var P=function(G){return Math.pow(G,2)},c=Math.sqrt(P(S.x-t[0].x)+P(S.y-t[0].y)),f=Math.sqrt(P(S.x-t[2].x)+P(S.y-t[2].y));n=qm(S.x,S.y,c,r.startAngle,r.endAngle,f)}}return n}function gZt(e,t,r){var n=r.getWidth(),i=r.getHeight(),a=r.type==="rect",o=[],s=(e[2].x-e[1].x)/2,l=r.isTransposed?s*i/n:s*n/i;return t==="round"?(a?(o.push(["M",e[0].x,e[0].y+l]),o.push(["L",e[1].x,e[1].y-l]),o.push(["A",s,s,0,0,1,e[2].x,e[2].y-l]),o.push(["L",e[3].x,e[3].y+l]),o.push(["A",s,s,0,0,1,e[0].x,e[0].y+l])):(o.push(["M",e[0].x,e[0].y]),o.push(["L",e[1].x,e[1].y]),o.push(["A",s,s,0,0,1,e[2].x,e[2].y]),o.push(["L",e[3].x,e[3].y]),o.push(["A",s,s,0,0,1,e[0].x,e[0].y])),o.push(["z"])):o=QN(e),o}function fit(e,t,r){var n=[];return ze(t)?r?n.push(["M",e[0].x,e[0].y],["L",e[1].x,e[1].y],["L",(e[2].x+e[3].x)/2,(e[2].y+e[3].y)/2],["Z"]):n.push(["M",e[0].x,e[0].y],["L",e[1].x,e[1].y],["L",e[2].x,e[2].y],["L",e[3].x,e[3].y],["Z"]):n.push(["M",e[0].x,e[0].y],["L",e[1].x,e[1].y],["L",t[1].x,t[1].y],["L",t[0].x,t[0].y],["Z"]),n}function dw(e,t){return[t,e]}function mZt(e,t,r){var n,i,a,o,s,l,u,c=Pr(on([],Pr(e),!1),4),f=c[0],d=c[1],v=c[2],g=c[3],x=Pr(typeof r=="number"?Array(4).fill(r):r,4),w=x[0],S=x[1],M=x[2],R=x[3];t.isTransposed&&(n=Pr(dw(d,g),2),d=n[0],g=n[1]),t.isReflect("y")&&(i=Pr(dw(f,d),2),f=i[0],d=i[1],a=Pr(dw(v,g),2),v=a[0],g=a[1]),t.isReflect("x")&&(o=Pr(dw(f,g),2),f=o[0],g=o[1],s=Pr(dw(d,v),2),d=s[0],v=s[1]);var I=[],P=function(k){return Math.abs(k)};return l=Pr(cit([w,S,M,R],Math.min(P(g.x-f.x),P(d.y-f.y))).map(function(k){return P(k)}),4),w=l[0],S=l[1],M=l[2],R=l[3],t.isTransposed&&(u=Pr([R,w,S,M],4),w=u[0],S=u[1],M=u[2],R=u[3]),f.y<d.y?(I.push(["M",g.x,g.y+M]),M!==0&&I.push(["A",M,M,0,0,0,g.x-M,g.y]),I.push(["L",f.x+R,f.y]),R!==0&&I.push(["A",R,R,0,0,0,f.x,f.y+R]),I.push(["L",d.x,d.y-w]),w!==0&&I.push(["A",w,w,0,0,0,d.x+w,d.y]),I.push(["L",v.x-S,v.y]),S!==0&&I.push(["A",S,S,0,0,0,v.x,v.y-S]),I.push(["L",g.x,g.y+M]),I.push(["z"])):g.x<f.x?(I.push(["M",v.x+S,v.y]),S!==0&&I.push(["A",S,S,0,0,0,v.x,v.y+S]),I.push(["L",g.x,g.y-M]),M!==0&&I.push(["A",M,M,0,0,0,g.x+M,g.y]),I.push(["L",f.x-R,f.y]),R!==0&&I.push(["A",R,R,0,0,0,f.x,f.y-R]),I.push(["L",d.x,d.y+w]),w!==0&&I.push(["A",w,w,0,0,0,d.x-w,d.y]),I.push(["L",v.x+S,v.y]),I.push(["z"])):(I.push(["M",d.x,d.y+w]),w!==0&&I.push(["A",w,w,0,0,1,d.x+w,d.y]),I.push(["L",v.x-S,v.y]),S!==0&&I.push(["A",S,S,0,0,1,v.x,v.y+S]),I.push(["L",g.x,g.y-M]),M!==0&&I.push(["A",M,M,0,0,1,g.x-M,g.y]),I.push(["L",f.x+R,f.y]),R!==0&&I.push(["A",R,R,0,0,1,f.x,f.y-R]),I.push(["L",d.x,d.y+w]),I.push(["z"])),I}w0("interval",{defaultShapeType:"rect",getDefaultPoints:function(e){return KN(e)}});fa("interval","rect",{draw:function(e,t){var r=bs(e,!1,!0),n=t,i=e==null?void 0:e.background;if(i){n=t.addGroup({name:"interval-group"});var a=$nt(e),o=hit(e,this.parsePoints(e.points),this.coordinate);n.addShape("path",{attrs:$($({},a),{path:o}),capture:!1,zIndex:-1,name:zN})}var s;r.radius&&this.coordinate.isRect?s=mZt(this.parsePoints(e.points),this.coordinate,r.radius):s=this.parsePath(gZt(e.points,r.lineCap,this.coordinate));var l=n.addShape("path",{attrs:$($({},r),{path:s}),name:"interval"});return i?n:l},getMarker:function(e){var t=e.color,r=e.isInPolar;return r?{symbol:"circle",style:{r:4.5,fill:t}}:{symbol:"square",style:{r:4,fill:t}}}});function yZt(e,t){var r=e.length,n=e;en(n[0])&&(n=e.map(function(s){return t.translate(s)}));for(var i=n[1]-n[0],a=2;a<r;a++){var o=n[a]-n[a-1];i>o&&(i=o)}return i}function _Zt(e,t){if(t){var r=rh(e),n=Zf(r,t);return n.length}return e.length}function JN(e){var t=e.theme,r=e.coordinate,n=e.getXScale(),i=n.values,a=e.beforeMappingData,o=i.length,s=h2(e.coordinate),l=e.intervalPadding,u=e.dodgePadding,c=e.maxColumnWidth||t.maxColumnWidth,f=e.minColumnWidth||t.minColumnWidth,d=e.columnWidthRatio||t.columnWidthRatio,v=e.multiplePieWidthRatio||t.multiplePieWidthRatio,g=e.roseWidthRatio||t.roseWidthRatio;if(n.isLinear&&i.length>1){i.sort();var x=yZt(i,n);o=(n.max-n.min)/x,i.length>o&&(o=i.length)}var w=n.range,S=1/o,M=1;if(r.isPolar?r.isTransposed&&o>1?M=v:M=g:(n.isLinear&&(S*=w[1]-w[0]),M=d),!ze(l)&&l>=0){var R=l/s;S=(1-(o-1)*R)/o}else S*=M;if(e.getAdjust("dodge")){var I=e.getAdjust("dodge"),P=I.dodgeBy,k=_Zt(a,P);if(!ze(u)&&u>=0){var z=u/s;S=(S-z*(k-1))/k}else!ze(l)&&l>=0&&(S*=M),S=S/k;S=S>=0?S:0}if(!ze(c)&&c>=0){var G=c/s;S>G&&(S=G)}if(!ze(f)&&f>=0){var J=f/s;S<J&&(S=J)}return S}var xZt=function(e){$t(t,e);function t(r){var n=e.call(this,r)||this;n.type="interval",n.shapeType="interval",n.generatePoints=!0;var i=r.background;return n.background=i,n}return t.prototype.createShapePointsCfg=function(r){var n=e.prototype.createShapePointsCfg.call(this,r),i,a=this.getAttribute("size");if(a){i=this.getAttributeValues(a,r)[0];var o=this.coordinate,s=h2(o);i=i/s}else this.defaultSize||(this.defaultSize=JN(this)),i=this.defaultSize;return n.size=i,n},t.prototype.adjustScale=function(){e.prototype.adjustScale.call(this);var r=this.getYScale();if(this.coordinate.type==="theta")r.change({nice:!1,min:0,max:fXt(r)});else{var n=this.scaleDefs,i=r.field,a=r.min,o=r.max,s=r.type;s!=="time"&&(a>0&&!xt(n,[i,"min"])&&r.change({min:0}),o<=0&&!xt(n,[i,"max"])&&r.change({max:0}))}},t.prototype.getDrawCfg=function(r){var n=e.prototype.getDrawCfg.call(this,r);return n.background=this.background,n},t}(C0),bZt=function(e){$t(t,e);function t(r){var n=e.call(this,r)||this;n.type="line";var i=r.sortable,a=i===void 0?!1:i;return n.sortable=a,n}return t}(qN),dit=["circle","square","bowtie","diamond","hexagon","triangle","triangle-down"],EZt=["cross","tick","plus","hyphen","line"];function tk(e,t,r,n,i){var a,o,s=bs(t,i,!i,"r"),l=e.parsePoints(t.points),u=l[0];if(t.isStack)u=l[1];else if(l.length>1){var c=r.addGroup();try{for(var f=yi(l),d=f.next();!d.done;d=f.next()){var v=d.value;c.addShape({type:"marker",attrs:$($($({},s),{symbol:h_[n]||n}),v)})}}catch(g){a={error:g}}finally{try{d&&!d.done&&(o=f.return)&&o.call(f)}finally{if(a)throw a.error}}return c}return r.addShape({type:"marker",attrs:$($($({},s),{symbol:h_[n]||n}),u)})}w0("point",{defaultShapeType:"hollow-circle",getDefaultPoints:function(e){return HN(e)}});ft(dit,function(e){fa("point","hollow-".concat(e),{draw:function(t,r){return tk(this,t,r,e,!0)},getMarker:function(t){var r=t.color;return{symbol:h_[e]||e,style:{r:4.5,stroke:r,fill:null}}}})});var wZt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="point",r.shapeType="point",r.generatePoints=!0,r}return t.prototype.getDrawCfg=function(r){var n=e.prototype.getDrawCfg.call(this,r);return $($({},n),{isStack:!!this.getAdjust("stack")})},t}(C0);function CZt(e){for(var t=e[0],r=1,n=[["M",t.x,t.y]];r<e.length;){var i=e[r];(i.x!==e[r-1].x||i.y!==e[r-1].y)&&(n.push(["L",i.x,i.y]),i.x===t.x&&i.y===t.y&&r<e.length-1&&(t=e[r+1],n.push(["Z"]),n.push(["M",t.x,t.y]),r++)),r++}return Di(Ds(n),t)||n.push(["L",t.x,t.y]),n.push(["Z"]),n}w0("polygon",{defaultShapeType:"polygon",getDefaultPoints:function(e){var t=[];return ft(e.x,function(r,n){var i=e.y[n];t.push({x:r,y:i})}),t}});fa("polygon","polygon",{draw:function(e,t){if(!cc(e.points)){var r=bs(e,!0,!0),n=this.parsePath(CZt(e.points));return t.addShape("path",{attrs:$($({},r),{path:n}),name:"polygon"})}},getMarker:function(e){var t=e.color;return{symbol:"square",style:{r:4,fill:t}}}});var SZt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="polygon",r.shapeType="polygon",r.generatePoints=!0,r}return t.prototype.createShapePointsCfg=function(r){var n=e.prototype.createShapePointsCfg.call(this,r),i=n.x,a=n.y,o;if(!(Fe(i)&&Fe(a))){var s=this.getXScale(),l=this.getYScale(),u=s.values.length,c=l.values.length,f=.5*1/u,d=.5*1/c;s.isCategory&&l.isCategory?(i=[i-f,i-f,i+f,i+f],a=[a-d,a+d,a+d,a-d]):Fe(i)?(o=i,i=[o[0],o[0],o[1],o[1]],a=[a-d/2,a+d/2,a+d/2,a-d/2]):Fe(a)&&(o=a,a=[o[0],o[1],o[1],o[0]],i=[i-f/2,i-f/2,i+f/2,i+f/2]),n.x=i,n.y=a}return n},t}(C0);w0("schema",{defaultShapeType:""});var TZt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="schema",r.shapeType="schema",r.generatePoints=!0,r}return t.prototype.createShapePointsCfg=function(r){var n=e.prototype.createShapePointsCfg.call(this,r),i,a=this.getAttribute("size");if(a){i=this.getAttributeValues(a,r)[0];var o=this.coordinate,s=h2(o);i=i/s}else this.defaultSize||(this.defaultSize=JN(this)),i=this.defaultSize;return n.size=i,n},t}(C0);function AZt(e){if(!Fe(e))return[];var t=nh(e);return fo(e,function(r){return r/t})}w0("violin",{defaultShapeType:"violin",getDefaultPoints:function(e){var t=e.size/2,r=[],n=AZt(e._size);return ft(e.y,function(i,a){var o=n[a]*t,s=a===0,l=a===e.y.length-1;r.push({isMin:s,isMax:l,x:e.x-o,y:i}),r.unshift({isMin:s,isMax:l,x:e.x+o,y:i})}),r}});fa("violin","violin",{draw:function(e,t){var r=bs(e,!0,!0),n=this.parsePath(znt(e.points));return t.addShape("path",{attrs:$($({},r),{path:n}),name:"violin"})},getMarker:function(e){var t=e.color;return{symbol:"circle",style:{r:4,fill:t}}}});var MZt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="violin",r.shapeType="violin",r.generatePoints=!0,r}return t.prototype.createShapePointsCfg=function(r){var n=e.prototype.createShapePointsCfg.call(this,r),i,a=this.getAttribute("size");if(a){i=this.getAttributeValues(a,r)[0];var o=this.coordinate,s=h2(o);i=i/s}else this.defaultSize||(this.defaultSize=JN(this)),i=this.defaultSize;return n.size=i,n._size=xt(r[Pa],[this._sizeField]),n},t.prototype.initAttributes=function(){var r=this.attributeOption,n=r.size?r.size.fields[0]:this._sizeField?this._sizeField:"size";this._sizeField=n,delete r.size,e.prototype.initAttributes.call(this)},t}(C0);fa("area","line",{draw:function(e,t){var r=E3(e,!0,!1,this),n=t.addShape({type:"path",attrs:r,name:"area"});return n},getMarker:function(e){var t=e.color;return{symbol:function(r,n,i){return i===void 0&&(i=5.5),[["M",r-i,n-4],["L",r+i,n-4],["L",r+i,n+4],["L",r-i,n+4],["Z"]]},style:{r:5,stroke:t,fill:null}}}});fa("area","smooth",{draw:function(e,t){var r=this.coordinate,n=E3(e,!1,!0,this,uit(r)),i=t.addShape({type:"path",attrs:n,name:"area"});return i},getMarker:function(e){var t=e.color;return{symbol:function(r,n,i){return i===void 0&&(i=5.5),[["M",r-i,n-4],["L",r+i,n-4],["L",r+i,n+4],["L",r-i,n+4],["Z"]]},style:{r:5,fill:t,fillOpacity:1}}}});fa("area","smooth-line",{draw:function(e,t){var r=this.coordinate,n=E3(e,!0,!0,this,uit(r)),i=t.addShape({type:"path",attrs:n,name:"area"});return i},getMarker:function(e){var t=e.color;return{symbol:function(r,n,i){return i===void 0&&(i=5.5),[["M",r-i,n-4],["L",r+i,n-4],["L",r+i,n+4],["L",r-i,n+4],["Z"]]},style:{r:5,stroke:t,fill:null}}}});function qF(e,t){return["C",e.x*1/2+t.x*1/2,e.y,e.x*1/2+t.x*1/2,t.y,t.x,t.y]}function KF(e,t){var r=[];r.push({x:t.x,y:t.y}),r.push(e);var n=["Q"];return ft(r,function(i){n.push(i.x,i.y)}),n}function RZt(e,t,r){var n=KF(t,r),i=[["M",e.x,e.y]];return i.push(n),i}function IZt(e,t){var r=KF(e[1],t),n=KF(e[3],t),i=[["M",e[0].x,e[0].y]];return i.push(n),i.push(["L",e[3].x,e[3].y]),i.push(["L",e[2].x,e[2].y]),i.push(r),i.push(["L",e[1].x,e[1].y]),i.push(["L",e[0].x,e[0].y]),i.push(["Z"]),i}fa("edge","arc",{draw:function(e,t){var r=bs(e,!0,!1,"lineWidth"),n=e.points,i=n.length>2?"weight":"normal",a;if(e.isInCircle){var o={x:0,y:1};return i==="normal"?a=RZt(n[0],n[1],o):(r.fill=r.stroke,a=IZt(n,o)),a=this.parsePath(a),t.addShape("path",{attrs:$($({},r),{path:a})})}else{if(i==="normal")return n=this.parsePoints(n),a=Jrt((n[1].x+n[0].x)/2,n[0].y,Math.abs(n[1].x-n[0].x)/2,Math.PI,Math.PI*2),t.addShape("path",{attrs:$($({},r),{path:a})});var s=qF(n[1],n[3]),l=qF(n[2],n[0]);return a=[["M",n[0].x,n[0].y],["L",n[1].x,n[1].y],s,["L",n[3].x,n[3].y],["L",n[2].x,n[2].y],l,["Z"]],a=this.parsePath(a),r.fill=r.stroke,t.addShape("path",{attrs:$($({},r),{path:a})})}},getMarker:function(e){return{symbol:"circle",style:{r:4.5,fill:e.color}}}});function LZt(e,t){var r=qF(e,t),n=[["M",e.x,e.y]];return n.push(r),n}fa("edge","smooth",{draw:function(e,t){var r=bs(e,!0,!1,"lineWidth"),n=e.points,i=this.parsePath(LZt(n[0],n[1]));return t.addShape("path",{attrs:$($({},r),{path:i})})},getMarker:function(e){return{symbol:"circle",style:{r:4.5,fill:e.color}}}});var gA=1/3;function OZt(e,t){var r=[];r.push({x:e.x,y:e.y*(1-gA)+t.y*gA}),r.push({x:t.x,y:e.y*(1-gA)+t.y*gA}),r.push(t);var n=[["M",e.x,e.y]];return ft(r,function(i){n.push(["L",i.x,i.y])}),n}fa("edge","vhv",{draw:function(e,t){var r=bs(e,!0,!1,"lineWidth"),n=e.points,i=this.parsePath(OZt(n[0],n[1]));return t.addShape("path",{attrs:$($({},r),{path:i})})},getMarker:function(e){return{symbol:"circle",style:{r:4.5,fill:e.color}}}});fa("interval","funnel",{getPoints:function(e){return e.size=e.size*2,KN(e)},draw:function(e,t){var r=bs(e,!1,!0),n=this.parsePath(fit(e.points,e.nextPoints,!1)),i=t.addShape("path",{attrs:$($({},r),{path:n}),name:"interval"});return i},getMarker:function(e){var t=e.color;return{symbol:"square",style:{r:4,fill:t}}}});fa("interval","hollow-rect",{draw:function(e,t){var r=bs(e,!0,!1),n=t,i=e==null?void 0:e.background;if(i){n=t.addGroup();var a=$nt(e),o=hit(e,this.parsePoints(e.points),this.coordinate);n.addShape("path",{attrs:$($({},a),{path:o}),capture:!1,zIndex:-1,name:zN})}var s=this.parsePath(QN(e.points)),l=n.addShape("path",{attrs:$($({},r),{path:s}),name:"interval"});return i?n:l},getMarker:function(e){var t=e.color,r=e.isInPolar;return r?{symbol:"circle",style:{r:4.5,stroke:t,fill:null}}:{symbol:"square",style:{r:4,stroke:t,fill:null}}}});function PZt(e){var t=e.x,r=e.y,n=e.y0;return Fe(r)?r.map(function(i,a){return{x:Fe(t)?t[a]:t,y:i}}):[{x:t,y:n},{x:t,y:r}]}fa("interval","line",{getPoints:function(e){return PZt(e)},draw:function(e,t){var r=bs(e,!0,!1,"lineWidth"),n=Vc($({},r),["fill"]),i=this.parsePath(QN(e.points,!1)),a=t.addShape("path",{attrs:$($({},n),{path:i}),name:"interval"});return a},getMarker:function(e){var t=e.color;return{symbol:function(r,n,i){return[["M",r,n-i],["L",r,n+i]]},style:{r:5,stroke:t}}}});fa("interval","pyramid",{getPoints:function(e){return e.size=e.size*2,KN(e)},draw:function(e,t){var r=bs(e,!1,!0),n=this.parsePath(fit(e.points,e.nextPoints,!0)),i=t.addShape("path",{attrs:$($({},r),{path:n}),name:"interval"});return i},getMarker:function(e){var t=e.color;return{symbol:"square",style:{r:4,fill:t}}}});function DZt(e){var t,r=e.x,n=e.y,i=e.y0,a=e.size,o,s;Fe(n)?(t=Pr(n,2),o=t[0],s=t[1]):(o=i,s=n);var l=r+a/2,u=r-a/2;return[{x:r,y:o},{x:r,y:s},{x:u,y:o},{x:l,y:o},{x:u,y:s},{x:l,y:s}]}function FZt(e){return[["M",e[0].x,e[0].y],["L",e[1].x,e[1].y],["M",e[2].x,e[2].y],["L",e[3].x,e[3].y],["M",e[4].x,e[4].y],["L",e[5].x,e[5].y]]}fa("interval","tick",{getPoints:function(e){return DZt(e)},draw:function(e,t){var r=bs(e,!0,!1),n=this.parsePath(FZt(e.points)),i=t.addShape("path",{attrs:$($({},r),{path:n}),name:"interval"});return i},getMarker:function(e){var t=e.color;return{symbol:function(r,n,i){return[["M",r-i/2,n-i],["L",r+i/2,n-i],["M",r,n-i],["L",r,n+i],["M",r-i/2,n+i],["L",r+i/2,n+i]]},style:{r:5,stroke:t}}}});var BZt=function(e,t,r){var n=e.x,i=e.y,a=t.x,o=t.y,s;switch(r){case"hv":s=[{x:a,y:i}];break;case"vh":s=[{x:n,y:o}];break;case"hvh":var l=(a+n)/2;s=[{x:l,y:i},{x:l,y:o}];break;case"vhv":var u=(i+o)/2;s=[{x:n,y:u},{x:a,y:u}];break}return s};function NZt(e,t){var r=[];return ft(e,function(n,i){var a=e[i+1];if(r.push(n),a){var o=BZt(n,a,t);r=r.concat(o)}}),r}function kZt(e){return e.map(function(t,r){return r===0?["M",t.x,t.y]:["L",t.x,t.y]})}function zZt(e,t){var r=b3(e.points,e.connectNulls,e.showSinglePoint),n=[];return ft(r,function(i){var a=NZt(i,t);n=n.concat(kZt(a))}),$($({},bs(e,!0,!1,"lineWidth")),{path:n})}ft(["hv","vh","hvh","vhv"],function(e){fa("line",e,{draw:function(t,r){var n=zZt(t,e),i=r.addShape({type:"path",attrs:n,name:"line"});return i},getMarker:function(t){return Hnt(t,e)}})});ft(EZt,function(e){fa("point",e,{draw:function(t,r){return tk(this,t,r,e,!0)},getMarker:function(t){var r=t.color;return{symbol:h_[e],style:{r:4.5,stroke:r,fill:null}}}})});fa("point","image",{draw:function(e,t){var r,n,i=bs(e,!1,!1,"r").r,a=this.parsePoints(e.points),o=a[0];if(e.isStack)o=a[1];else if(a.length>1){var s=t.addGroup();try{for(var l=yi(a),u=l.next();!u.done;u=l.next()){var c=u.value;s.addShape("image",{attrs:{x:c.x-i/2,y:c.y-i,width:i,height:i,img:e.shape[1]}})}}catch(f){r={error:f}}finally{try{u&&!u.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}return s}return t.addShape("image",{attrs:{x:o.x-i/2,y:o.y-i,width:i,height:i,img:e.shape[1]}})},getMarker:function(e){var t=e.color;return{symbol:"circle",style:{r:4.5,fill:t}}}});ft(dit,function(e){fa("point",e,{draw:function(t,r){return tk(this,t,r,e,!1)},getMarker:function(t){var r=t.color;return{symbol:h_[e]||e,style:{r:4.5,fill:r}}}})});function ZG(e){var t=Fe(e)?e:[e],r=t[0],n=t[t.length-1],i=t.length>1?t[1]:r,a=t.length>3?t[3]:n,o=t.length>2?t[2]:i;return{min:r,max:n,min1:i,max1:a,median:o}}function qG(e,t,r){var n=r/2,i;if(Fe(t)){var a=ZG(t),o=a.min,s=a.max,l=a.median,u=a.min1,c=a.max1,f=e-n,d=e+n;i=[[f,s],[d,s],[e,s],[e,c],[f,u],[f,c],[d,c],[d,u],[e,u],[e,o],[f,o],[d,o],[f,l],[d,l]]}else{t=ze(t)?.5:t;var v=ZG(e),o=v.min,s=v.max,l=v.median,u=v.min1,c=v.max1,g=t-n,x=t+n;i=[[o,g],[o,x],[o,t],[u,t],[u,g],[u,x],[c,x],[c,g],[c,t],[s,t],[s,g],[s,x],[l,g],[l,x]]}return i.map(function(w){return{x:w[0],y:w[1]}})}function UZt(e){return[["M",e[0].x,e[0].y],["L",e[1].x,e[1].y],["M",e[2].x,e[2].y],["L",e[3].x,e[3].y],["M",e[4].x,e[4].y],["L",e[5].x,e[5].y],["L",e[6].x,e[6].y],["L",e[7].x,e[7].y],["L",e[4].x,e[4].y],["Z"],["M",e[8].x,e[8].y],["L",e[9].x,e[9].y],["M",e[10].x,e[10].y],["L",e[11].x,e[11].y],["M",e[12].x,e[12].y],["L",e[13].x,e[13].y]]}fa("schema","box",{getPoints:function(e){var t=e.x,r=e.y,n=e.size;return qG(t,r,n)},draw:function(e,t){var r=bs(e,!0,!1),n=this.parsePath(UZt(e.points)),i=t.addShape("path",{attrs:$($({},r),{path:n,name:"schema"})});return i},getMarker:function(e){var t=e.color;return{symbol:function(r,n,i){var a=[n-6,n-3,n,n+3,n+6],o=qG(r,a,i);return[["M",o[0].x+1,o[0].y],["L",o[1].x-1,o[1].y],["M",o[2].x,o[2].y],["L",o[3].x,o[3].y],["M",o[4].x,o[4].y],["L",o[5].x,o[5].y],["L",o[6].x,o[6].y],["L",o[7].x,o[7].y],["L",o[4].x,o[4].y],["Z"],["M",o[8].x,o[8].y],["L",o[9].x,o[9].y],["M",o[10].x+1,o[10].y],["L",o[11].x-1,o[11].y],["M",o[12].x,o[12].y],["L",o[13].x,o[13].y]]},style:{r:6,lineWidth:1,stroke:t}}}});function $Zt(e){var t=Fe(e)?e:[e],r=t.sort(function(n,i){return i-n});return nXt(r,4,r[r.length-1])}function KG(e,t,r){var n=$Zt(t);return[{x:e,y:n[0]},{x:e,y:n[1]},{x:e-r/2,y:n[2]},{x:e-r/2,y:n[1]},{x:e+r/2,y:n[1]},{x:e+r/2,y:n[2]},{x:e,y:n[2]},{x:e,y:n[3]}]}function HZt(e){return[["M",e[0].x,e[0].y],["L",e[1].x,e[1].y],["M",e[2].x,e[2].y],["L",e[3].x,e[3].y],["L",e[4].x,e[4].y],["L",e[5].x,e[5].y],["Z"],["M",e[6].x,e[6].y],["L",e[7].x,e[7].y]]}fa("schema","candle",{getPoints:function(e){var t=e.x,r=e.y,n=e.size;return KG(t,r,n)},draw:function(e,t){var r=bs(e,!0,!0),n=this.parsePath(HZt(e.points)),i=t.addShape("path",{attrs:$($({},r),{path:n,name:"schema"})});return i},getMarker:function(e){var t=e.color;return{symbol:function(r,n,i){var a=[n+7.5,n+3,n-3,n-7.5],o=KG(r,a,i);return[["M",o[0].x,o[0].y],["L",o[1].x,o[1].y],["M",o[2].x,o[2].y],["L",o[3].x,o[3].y],["L",o[4].x,o[4].y],["L",o[5].x,o[5].y],["Z"],["M",o[6].x,o[6].y],["L",o[7].x,o[7].y]]},style:{lineWidth:1,stroke:t,fill:t,r:6}}}});function VZt(e,t){var r=Math.abs(e[0].x-e[2].x),n=Math.abs(e[0].y-e[2].y),i=Math.min(r,n);t&&(i=to(t,0,Math.min(r,n))),i=i/2;var a=(e[0].x+e[2].x)/2,o=(e[0].y+e[2].y)/2;return{x:a-i,y:o-i,width:i*2,height:i*2}}fa("polygon","square",{draw:function(e,t){if(!cc(e.points)){var r=bs(e,!0,!0),n=this.parsePoints(e.points);return t.addShape("rect",{attrs:$($({},r),VZt(n,e.size)),name:"polygon"})}},getMarker:function(e){var t=e.color;return{symbol:"square",style:{r:4,fill:t}}}});fa("violin","smooth",{draw:function(e,t){var r=bs(e,!0,!0),n=this.parsePath(Unt(e.points));return t.addShape("path",{attrs:$($({},r),{path:n})})},getMarker:function(e){var t=e.color;return{symbol:"circle",style:{stroke:null,r:4,fill:t}}}});fa("violin","hollow",{draw:function(e,t){var r=bs(e,!0,!1),n=this.parsePath(znt(e.points));return t.addShape("path",{attrs:$($({},r),{path:n})})},getMarker:function(e){var t=e.color;return{symbol:"circle",style:{r:4,fill:null,stroke:t}}}});fa("violin","hollow-smooth",{draw:function(e,t){var r=bs(e,!0,!1),n=this.parsePath(Unt(e.points));return t.addShape("path",{attrs:$($({},r),{path:n})})},getMarker:function(e){var t=e.color;return{symbol:"circle",style:{r:4,fill:null,stroke:t}}}});var GZt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getLabelValueDir=function(r){var n="y",i=r.points;return i[0][n]<=i[2][n]?1:-1},t.prototype.getLabelOffsetPoint=function(r,n,i,a){var o,s=e.prototype.getLabelOffsetPoint.call(this,r,n,i),l=this.getCoordinate(),u=l.isTransposed,c=u?"x":"y",f=this.getLabelValueDir(r.mappingData);return s=$($({},s),(o={},o[c]=s[c]*f,o)),l.isReflect("x")&&(s=$($({},s),{x:s.x*-1})),l.isReflect("y")&&(s=$($({},s),{y:s.y*-1})),s},t.prototype.getThemedLabelCfg=function(r){var n=this.geometry,i=this.getDefaultLabelCfg(),a=n.theme;return Tr({},i,a.labels,r.position==="middle"?{offset:0}:{},r)},t.prototype.setLabelPosition=function(r,n,i,a){var o=this.getCoordinate(),s=o.isTransposed,l=n.points,u=o.convert(l[0]),c=o.convert(l[2]),f=this.getLabelValueDir(n),d,v,g,x,w=Fe(n.shape)?n.shape[0]:n.shape;if(w==="funnel"||w==="pyramid"){var S=xt(n,"nextPoints"),M=xt(n,"points");if(S){var R=o.convert(M[0]),I=o.convert(M[1]),P=o.convert(S[0]),k=o.convert(S[1]);s?(d=Math.min(P.y,R.y),g=Math.max(P.y,R.y),v=(I.x+k.x)/2,x=(R.x+P.x)/2):(d=Math.min((I.y+k.y)/2,(R.y+P.y)/2),g=Math.max((I.y+k.y)/2,(R.y+P.y)/2),v=k.x,x=R.x)}else d=Math.min(c.y,u.y),g=Math.max(c.y,u.y),v=c.x,x=u.x}else d=Math.min(c.y,u.y),g=Math.max(c.y,u.y),v=c.x,x=u.x;switch(a){case"right":r.x=v,r.y=(d+g)/2,r.textAlign=xt(r,"textAlign",f>0?"left":"right");break;case"left":r.x=x,r.y=(d+g)/2,r.textAlign=xt(r,"textAlign",f>0?"left":"right");break;case"bottom":s&&(r.x=(v+x)/2),r.y=g,r.textAlign=xt(r,"textAlign","center"),r.textBaseline=xt(r,"textBaseline",f>0?"bottom":"top");break;case"middle":s&&(r.x=(v+x)/2),r.y=(d+g)/2,r.textAlign=xt(r,"textAlign","center"),r.textBaseline=xt(r,"textBaseline","middle");break;case"top":s&&(r.x=(v+x)/2),r.y=d,r.textAlign=xt(r,"textAlign","center"),r.textBaseline=xt(r,"textBaseline",f>0?"bottom":"top");break}},t}(x3),mA=Math.PI/2,pit=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getLabelOffset=function(r){var n=this.getCoordinate(),i=0;if(Rn(r))i=r;else if(en(r)&&r.indexOf("%")!==-1){var a=n.getRadius();n.innerRadius>0&&(a=a*(1-n.innerRadius)),i=parseFloat(r)*.01*a}return i},t.prototype.getLabelItems=function(r){var n=e.prototype.getLabelItems.call(this,r),i=this.geometry.getYScale();return fo(n,function(a){if(a&&i){var o=i.scale(xt(a.data,i.field));return $($({},a),{percent:o})}return a})},t.prototype.getLabelAlign=function(r){var n=this.getCoordinate(),i;if(r.labelEmit)i=r.angle<=Math.PI/2&&r.angle>=-Math.PI/2?"left":"right";else if(!n.isTransposed)i="center";else{var a=n.getCenter(),o=r.offset;Math.abs(r.x-a.x)<1?i="center":r.angle>Math.PI||r.angle<=0?i=o>0?"left":"right":i=o>0?"right":"left"}return i},t.prototype.getLabelPoint=function(r,n,i){var a=1,o,s=r.content[i];this.isToMiddle(n)?o=this.getMiddlePoint(n.points):(r.content.length===1&&i===0?i=1:i===0&&(a=-1),o=this.getArcPoint(n,i));var l=r.offset*a,u=this.getPointAngle(o),c=r.labelEmit,f=this.getCirclePoint(u,l,o,c);return f.r===0?f.content="":(f.content=s,f.angle=u,f.color=n.color),f.rotate=r.autoRotate?this.getLabelRotate(u,l,c):r.rotate,f.start={x:o.x,y:o.y},f},t.prototype.getArcPoint=function(r,n){return n===void 0&&(n=0),!Fe(r.x)&&!Fe(r.y)?{x:r.x,y:r.y}:{x:Fe(r.x)?r.x[n]:r.x,y:Fe(r.y)?r.y[n]:r.y}},t.prototype.getPointAngle=function(r){return sb(this.getCoordinate(),r)},t.prototype.getCirclePoint=function(r,n,i,a){var o=this.getCoordinate(),s=o.getCenter(),l=v3(o,i);if(l===0)return $($({},s),{r:l});var u=r;if(o.isTransposed&&l>n&&!a){var c=Math.asin(n/(2*l));u=r+c*2}else l=l+n;return{x:s.x+l*Math.cos(u),y:s.y+l*Math.sin(u),r:l}},t.prototype.getLabelRotate=function(r,n,i){var a=r+mA;return i&&(a-=mA),a&&(a>mA?a=a-Math.PI:a<-mA&&(a=a+Math.PI)),a},t.prototype.getMiddlePoint=function(r){var n=this.getCoordinate(),i=r.length,a={x:0,y:0};return ft(r,function(o){a.x+=o.x,a.y+=o.y}),a.x/=i,a.y/=i,a=n.convert(a),a},t.prototype.isToMiddle=function(r){return r.x.length>2},t}(x3),WZt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.defaultLayout="distribute",r}return t.prototype.getDefaultLabelCfg=function(r,n){var i=e.prototype.getDefaultLabelCfg.call(this,r,n);return Tr({},i,xt(this.geometry.theme,"pieLabels",{}))},t.prototype.getLabelOffset=function(r){return e.prototype.getLabelOffset.call(this,r)||0},t.prototype.getLabelRotate=function(r,n,i){var a;return n<0&&(a=r,a>Math.PI/2&&(a=a-Math.PI),a<-Math.PI/2&&(a=a+Math.PI)),a},t.prototype.getLabelAlign=function(r){var n=this.getCoordinate(),i=n.getCenter(),a;return r.angle<=Math.PI/2&&r.x>=i.x?a="left":a="right",r.offset<=0&&(a==="right"?a="left":a="right"),a},t.prototype.getArcPoint=function(r){return r},t.prototype.getPointAngle=function(r){var n=this.getCoordinate(),i={x:Fe(r.x)?r.x[0]:r.x,y:r.y[0]},a={x:Fe(r.x)?r.x[1]:r.x,y:r.y[1]},o,s=sb(n,i);if(r.points&&r.points[0].y===r.points[1].y)o=s;else{var l=sb(n,a);s>=l&&(l=l+Math.PI*2),o=s+(l-s)/2}return o},t.prototype.getCirclePoint=function(r,n){var i=this.getCoordinate(),a=i.getCenter(),o=i.getRadius()+n;return $($({},Ps(a.x,a.y,o,r)),{angle:r,r:o})},t}(pit),QG=4;function XZt(e,t,r,n,i,a){var o,s,l=!0,u=n.start,c=n.end,f=Math.min(u.y,c.y),d=Math.abs(u.y-c.y),v,g=0,x=Number.MIN_VALUE,w=t.map(function(z){return z.y>g&&(g=z.y),z.y<x&&(x=z.y),{size:r,targets:[z.y-f]}});for(x-=f,g-f>d&&(d=g-f);l;)for(w.forEach(function(z){var G=(Math.min.apply(x,z.targets)+Math.max.apply(x,z.targets))/2;z.pos=Math.min(Math.max(x,G-z.size/2),d-z.size)}),l=!1,v=w.length;v--;)if(v>0){var S=w[v-1],M=w[v];S.pos+S.size>M.pos&&(S.size+=M.size,S.targets=S.targets.concat(M.targets),S.pos+S.size>d&&(S.pos=d-S.size),w.splice(v,1),l=!0)}v=0,w.forEach(function(z){var G=f+r/2;z.targets.forEach(function(){t[v].y=z.pos+G,G+=r,v++})});var R={};try{for(var I=yi(e),P=I.next();!P.done;P=I.next()){var k=P.value;R[k.get("id")]=k}}catch(z){o={error:z}}finally{try{P&&!P.done&&(s=I.return)&&s.call(I)}finally{if(o)throw o.error}}t.forEach(function(z){var G=z.r*z.r,J=Math.pow(Math.abs(z.y-i.y),2);if(G<J)z.x=i.x;else{var Z=Math.sqrt(G-J);a?z.x=i.x+Z:z.x=i.x-Z}var X=R[z.id];X.attr("x",z.x),X.attr("y",z.y);var et=Xf(X.getChildren(),function(at){return at.get("type")==="text"});et&&(et.attr("y",z.y),et.attr("x",z.x))})}function jZt(e,t,r,n){if(!(!e.length||!t.length)){var i=e[0]?e[0].offset:0,a=t[0].get("coordinate"),o=a.getRadius(),s=a.getCenter();if(i>0){var l=14,u=o+i,c=u*2+l*2,f={start:a.start,end:a.end},d=[[],[]];e.forEach(function(v){v&&(v.textAlign==="right"?d[0].push(v):d[1].push(v))}),d.forEach(function(v,g){var x=c/l;v.length>x&&(v.sort(function(w,S){return S["..percent"]-w["..percent"]}),v.splice(x,v.length-x)),v.sort(function(w,S){return w.y-S.y}),XZt(t,v,l,f,s,g)})}ft(e,function(v){if(v&&v.labelLine){var g=v.offset,x=v.angle,w=Ps(s.x,s.y,o,x),S=Ps(s.x,s.y,o+g/2,x),M=v.x+xt(v,"offsetX",0),R=v.y+xt(v,"offsetY",0),I={x:M-Math.cos(x)*QG,y:R-Math.sin(x)*QG};Xi(v.labelLine)||(v.labelLine={}),v.labelLine.path=["M ".concat(w.x),"".concat(w.y," Q").concat(S.x),"".concat(S.y," ").concat(I.x),I.y].join(",")}})}}function vit(e,t,r){var n=e.filter(function(g){return!g.invisible});n.sort(function(g,x){return g.y-x.y});var i=!0,a=r.minY,o=r.maxY,s=Math.abs(a-o),l,u=0,c=Number.MIN_VALUE,f=n.map(function(g){return g.y>u&&(u=g.y),g.y<c&&(c=g.y),{content:g.content,size:t,targets:[g.y-a],pos:null}});for(c-=a,u-a>s&&(s=u-a);i;)for(f.forEach(function(g){var x=(Math.min.apply(c,g.targets)+Math.max.apply(c,g.targets))/2;g.pos=Math.min(Math.max(c,x-g.size/2),s-g.size),g.pos=Math.max(0,g.pos)}),i=!1,l=f.length;l--;)if(l>0){var d=f[l-1],v=f[l];d.pos+d.size>v.pos&&(d.size+=v.size,d.targets=d.targets.concat(v.targets),d.pos+d.size>s&&(d.pos=s-d.size),f.splice(l,1),i=!0)}l=0,f.forEach(function(g){var x=a+t/2;g.targets.forEach(function(){n[l].y=g.pos+x,x+=t,l++})})}var JG=4;function YZt(e,t){var r=t.getCenter(),n=t.getRadius();if(e&&e.labelLine){var i=e.angle,a=e.offset,o=Ps(r.x,r.y,n,i),s=e.x+xt(e,"offsetX",0)*(Math.cos(i)>0?1:-1),l=e.y+xt(e,"offsetY",0)*(Math.sin(i)>0?1:-1),u={x:s-Math.cos(i)*JG,y:l-Math.sin(i)*JG},c=e.labelLine.smooth,f=[],d=u.x-r.x,v=u.y-r.y,g=Math.atan(v/d);if(d<0&&(g+=Math.PI),c===!1){Xi(e.labelLine)||(e.labelLine={});var x=0;(i<0&&i>-Math.PI/2||i>Math.PI*1.5)&&u.y>o.y&&(x=1),i>=0&&i<Math.PI/2&&u.y>o.y&&(x=1),i>=Math.PI/2&&i<Math.PI&&o.y>u.y&&(x=1),(i<-Math.PI/2||i>=Math.PI&&i<Math.PI*1.5)&&o.y>u.y&&(x=1);var w=a/2>4?4:Math.max(a/2-1,0),S=Ps(r.x,r.y,n+w,i),M=Ps(r.x,r.y,n+a/2,g),R=0;f.push("M ".concat(o.x," ").concat(o.y)),f.push("L ".concat(S.x," ").concat(S.y)),f.push("A ".concat(r.x," ").concat(r.y," 0 ").concat(R," ").concat(x," ").concat(M.x," ").concat(M.y)),f.push("L ".concat(u.x," ").concat(u.y))}else{var S=Ps(r.x,r.y,n+(a/2>4?4:Math.max(a/2-1,0)),i),I=o.x<r.x?1:-1;f.push("M ".concat(u.x," ").concat(u.y));var P=(o.y-r.y)/(o.x-r.x),k=(u.y-r.y)/(u.x-r.x);Math.abs(P-k)>Math.pow(Math.E,-16)&&f.push.apply(f,["C",u.x+I*4,u.y,2*S.x-o.x,2*S.y-o.y,o.x,o.y]),f.push("L ".concat(o.x," ").concat(o.y))}e.labelLine.path=f.join(" ")}}function ZZt(e,t,r,n){var i,a,o=Al(e,function(G){return!ze(G)}),s=t[0]&&t[0].get("coordinate");if(s){var l=s.getCenter(),u=s.getRadius(),c={};try{for(var f=yi(t),d=f.next();!d.done;d=f.next()){var v=d.value;c[v.get("id")]=v}}catch(G){i={error:G}}finally{try{d&&!d.done&&(a=f.return)&&a.call(f)}finally{if(i)throw i.error}}var g=xt(o[0],"labelHeight",14),x=xt(o[0],"offset",0);if(!(x<=0)){var w="left",S="right",M=Qc(o,function(G){return G.x<l.x?w:S}),R=s.start,I=s.end,P=Math.min((u+x+g)*2,s.getHeight()),k=P/2,z={minX:R.x,maxX:I.x,minY:l.y-k,maxY:l.y+k};ft(M,function(G,J){var Z=Math.floor(P/g);G.length>Z&&(G.sort(function(X,et){return et.percent-X.percent}),ft(G,function(X,et){et+1>Z&&(c[X.id].set("visible",!1),X.invisible=!0)})),vit(G,g,z)}),ft(M,function(G,J){ft(G,function(Z){var X=J===S,et=c[Z.id],at=et.getChildByIndex(0);if(at){var wt=u+x,Tt=Z.y-l.y,vt=Math.pow(wt,2),zt=Math.pow(Tt,2),oe=vt-zt>0?vt-zt:0,Qt=Math.sqrt(oe),ne=Math.abs(Math.cos(Z.angle)*wt);X?Z.x=l.x+Math.max(Qt,ne):Z.x=l.x-Math.max(Qt,ne)}at&&(at.attr("y",Z.y),at.attr("x",Z.x)),YZt(Z,s)})})}}}var QF=4,qZt=4,tW=4;function KZt(e,t,r){var n=t.getCenter(),i=t.getRadius(),a={x:e.x-(r?tW:-tW),y:e.y},o=Ps(n.x,n.y,i+QF,e.angle),s={x:a.x,y:a.y},l={x:o.x,y:o.y},u=Ps(n.x,n.y,i,e.angle),c="";if(a.y!==o.y){var f=r?4:-4;s.y=a.y,e.angle<0&&e.angle>=-Math.PI/2&&(s.x=Math.max(o.x,a.x-f),a.y<o.y?l.y=s.y:(l.y=o.y,l.x=Math.max(l.x,s.x-f))),e.angle>0&&e.angle<Math.PI/2&&(s.x=Math.max(o.x,a.x-f),a.y>o.y?l.y=s.y:(l.y=o.y,l.x=Math.max(l.x,s.x-f))),e.angle>Math.PI/2&&(s.x=Math.min(o.x,a.x-f),a.y>o.y?l.y=s.y:(l.y=o.y,l.x=Math.min(l.x,s.x-f))),e.angle<-Math.PI/2&&(s.x=Math.min(o.x,a.x-f),a.y<o.y?l.y=s.y:(l.y=o.y,l.x=Math.min(l.x,s.x-f)))}c=["M ".concat(a.x,",").concat(a.y),"L ".concat(s.x,",").concat(s.y),"L ".concat(l.x,",").concat(l.y),"L ".concat(o.x,",").concat(o.y),"L ".concat(u.x,",").concat(u.y)].join(" "),e.labelLine=Tr({},e.labelLine,{path:c})}function QZt(e,t,r,n){var i,a,o=t[0]&&t[0].get("coordinate");if(o){var s=o.getCenter(),l=o.getRadius(),u={};try{for(var c=yi(t),f=c.next();!f.done;f=c.next()){var d=f.value;u[d.get("id")]=d}}catch(G){i={error:G}}finally{try{f&&!f.done&&(a=c.return)&&a.call(c)}finally{if(i)throw i.error}}var v=xt(e[0],"labelHeight",14),g=Math.max(xt(e[0],"offset",0),QF);ft(e,function(G){if(G){var J=xt(u,[G.id]);if(J){var Z=G.x>s.x||G.x===s.x&&G.y>s.y,X=ze(G.offsetX)?qZt:G.offsetX,et=Ps(s.x,s.y,l+QF,G.angle),at=g+X;G.x=s.x+(Z?1:-1)*(l+at),G.y=et.y}}});var x=o.start,w=o.end,S="left",M="right",R=Qc(e,function(G){return G.x<s.x?S:M}),I=(l+g)*2+v;ft(R,function(G){var J=G.length*v;J>I&&(I=Math.min(J,Math.abs(x.y-w.y)))});var P={minX:x.x,maxX:w.x,minY:s.y-I/2,maxY:s.y+I/2};ft(R,function(G,J){var Z=I/v;G.length>Z&&(G.sort(function(X,et){return et.percent-X.percent}),ft(G,function(X,et){et>Z&&(u[X.id].set("visible",!1),X.invisible=!0)})),vit(G,v,P)});var k=P.minY,z=P.maxY;ft(R,function(G,J){var Z=J===M;ft(G,function(X){var et=xt(u,X&&[X.id]);if(et){if(X.y<k||X.y>z){et.set("visible",!1);return}var at=et.getChildByIndex(0),wt=at.getCanvasBBox(),Tt={x:Z?wt.x:wt.maxX,y:wt.y+wt.height/2};p2(at,X.x-Tt.x,X.y-Tt.y),X.labelLine&&KZt(X,o,Z)}})})}}function JZt(e,t,r,n){ft(t,function(i){var a=n.minX,o=n.minY,s=n.maxX,l=n.maxY,u=i.getCanvasBBox(),c=u.minX,f=u.minY,d=u.maxX,v=u.maxY,g=u.x,x=u.y,w=u.width,S=u.height,M=g,R=x;(c<a||d<a)&&(M=a),(f<o||v<o)&&(R=o),c>s?M=s-w:d>s&&(M=M-(d-s)),f>l?R=l-S:v>l&&(R=R-(v-l)),(M!==g||R!==x)&&p2(i,M-g,R-x)})}function tqt(e,t,r,n){ft(t,function(i,a){var o=i.getCanvasBBox(),s=r[a].getBBox();(o.minX<s.minX||o.minY<s.minY||o.maxX>s.maxX||o.maxY>s.maxY)&&i.remove(!0)})}var eqt=100,git=function(){function e(t){t===void 0&&(t={}),this.bitmap={};var r=t.xGap,n=r===void 0?1:r,i=t.yGap,a=i===void 0?8:i;this.xGap=n,this.yGap=a}return e.prototype.hasGap=function(t){for(var r=!0,n=this.bitmap,i=Math.round(t.minX),a=Math.round(t.maxX),o=Math.round(t.minY),s=Math.round(t.maxY),l=i;l<=a;l+=1){if(!n[l]){n[l]={};continue}if(l===i||l===a){for(var u=o;u<=s;u++)if(n[l][u]){r=!1;break}}else if(n[l][o]||n[l][s]){r=!1;break}}return r},e.prototype.fillGap=function(t){for(var r=this.bitmap,n=Math.round(t.minX),i=Math.round(t.maxX),a=Math.round(t.minY),o=Math.round(t.maxY),s=n;s<=i;s+=1)r[s]||(r[s]={});for(var s=n;s<=i;s+=this.xGap){for(var l=a;l<=o;l+=this.yGap)r[s][l]=!0;r[s][o]=!0}if(this.yGap!==1)for(var s=a;s<=o;s+=1)r[n][s]=!0,r[i][s]=!0;if(this.xGap!==1)for(var s=n;s<=i;s+=1)r[s][a]=!0,r[s][o]=!0},e.prototype.destroy=function(){this.bitmap={}},e}();function rqt(e,t,r){r===void 0&&(r=eqt);var n=-1,i=e.attr(),a=i.x,o=i.y,s=e.getCanvasBBox(),l=Math.sqrt(s.width*s.width+s.height*s.height),u,c=-n,f=0,d=0,v=function(S){var M=S*.1;return[M*Math.cos(M),M*Math.sin(M)]};if(t.hasGap(s))return t.fillGap(s),!0;for(var g=!1,x=0,w={};Math.min(Math.abs(f),Math.abs(d))<l&&x<r;)if(u=v(c+=n),f=~~u[0],d=~~u[1],!(!f&&!d||w["".concat(f,"-").concat(d)])&&(e.attr({x:a+f,y:o+d}),f+d<0&&e.attr("textAlign","right"),x++,t.hasGap(e.getCanvasBBox()))){t.fillGap(e.getCanvasBBox()),g=!0,w["".concat(f,"-").concat(d)]=!0;break}return g}function nqt(e,t,r,n){var i=e.getCanvasBBox(),a=i.width,o=i.height,s={x:t,y:r,textAlign:"center"};switch(n){case 0:s.y-=o+1,s.x+=1,s.textAlign="left";break;case 1:s.y-=o+1,s.x-=1,s.textAlign="right";break;case 2:s.y+=o+1,s.x-=1,s.textAlign="right";break;case 3:s.y+=o+1,s.x+=1,s.textAlign="left";break;case 5:s.y-=o*2+2;break;case 6:s.y+=o*2+2;break;case 7:s.x+=a+1,s.textAlign="left";break;case 8:s.x-=a+1,s.textAlign="right";break}return e.attr(s),e.getCanvasBBox()}function iqt(e,t,r,n){var i=new git;ft(t,function(a){var o=a.find(function(s){return s.get("type")==="text"});rqt(o,i)||a.remove(!0)}),i.destroy()}function aqt(e,t,r,n){var i=new git;ft(t,function(a){for(var o=a.find(function(v){return v.get("type")==="text"}),s=o.attr(),l=s.x,u=s.y,c=!1,f=0;f<=8;f++){var d=nqt(o,l,u,f);if(i.hasGap(d)){i.fillGap(d),c=!0;break}}c||a.remove(!0)}),i.destroy()}function oqt(e,t){return(e[0]||0)*(t[0]||0)+(e[1]||0)*(t[1]||0)+(e[2]||0)*(t[2]||0)}function eW(e){if(e.length>4)return[];var t=function(i,a){return[a.x-i.x,a.y-i.y]},r=t(e[0],e[1]),n=t(e[1],e[2]);return[r,n]}function yA(e,t,r){t===void 0&&(t=0),r===void 0&&(r={x:0,y:0});var n=e.x,i=e.y;return{x:(n-r.x)*Math.cos(-t)+(i-r.y)*Math.sin(-t)+r.x,y:(r.x-n)*Math.sin(-t)+(i-r.y)*Math.cos(-t)+r.y}}function rW(e){var t=[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}],r=e.rotation;return r?[yA(t[0],r,t[0]),yA(t[1],r,t[0]),yA(t[2],r,t[0]),yA(t[3],r,t[0])]:t}function nW(e,t){if(e.length>4)return{min:0,max:0};var r=[];return e.forEach(function(n){r.push(oqt([n.x,n.y],t))}),{min:Math.min.apply(Math,on([],Pr(r),!1)),max:Math.max.apply(Math,on([],Pr(r),!1))}}function sqt(e,t){return e.max>t.min&&e.min<t.max}function lqt(e){return typeof e=="number"&&!Number.isNaN(e)&&e!==1/0&&e!==-1/0}function iW(e){return["x","y","width","height"].every(function(t){return lqt(e[t])})}function uqt(e,t,r){return r===void 0&&(r=0),!(t.x>e.x+e.width+r||t.x+t.width<e.x-r||t.y>e.y+e.height+r||t.y+t.height<e.y-r)}function cqt(e,t,r){if(r===void 0&&(r=0),!iW(e)||!iW(t))return!1;if(!e.rotation&&!t.rotation)return uqt(e,t,r);for(var n=rW(e),i=rW(t),a=eW(n).concat(eW(i)),o=0;o<a.length;o++){var s=a[o],l=nW(n,s),u=nW(i,s);if(!sqt(l,u))return!1}return!0}var hqt=function(){function e(t){var r=this;this.queue=[],this.worker=new Worker(t),this.worker.onmessage=function(n){var i;(i=r.queue.shift())===null||i===void 0||i.resolve(n)},this.worker.onmessageerror=function(n){var i;console.warn("[AntV G2] Web worker is not available"),(i=r.queue.shift())===null||i===void 0||i.reject(n)}}return e.prototype.post=function(t,r){var n=this;return new Promise(function(i,a){n.queue.push({resolve:i,reject:a});try{n.worker.postMessage(t)}catch{console.warn("[AntV G2] Web worker is not available"),Rr(r)&&r()}})},e.prototype.destroy=function(){this.worker.terminate()},e}();function fqt(e){if(!(typeof window>"u")){var t;try{t=new Blob([e.toString()],{type:"application/javascript"})}catch{t=new window.BlobBuilder,t.append(e.toString()),t=t.getBlob()}return new hqt(URL.createObjectURL(t))}}var dqt=function(e){function t(){function u(R,I){return(R[0]||0)*(I[0]||0)+(R[1]||0)*(I[1]||0)+(R[2]||0)*(I[2]||0)}function c(R){if(R.length>4)return[];var I=function(z,G){return[G.x-z.x,G.y-z.y]},P=I(R[0],R[1]),k=I(R[1],R[2]);return[P,k]}function f(R,I,P){I===void 0&&(I=0),P===void 0&&(P={x:0,y:0});var k=R.x,z=R.y;return{x:(k-P.x)*Math.cos(-I)+(z-P.y)*Math.sin(-I)+P.x,y:(P.x-k)*Math.sin(-I)+(z-P.y)*Math.cos(-I)+P.y}}function d(R){var I=[{x:R.x,y:R.y},{x:R.x+R.width,y:R.y},{x:R.x+R.width,y:R.y+R.height},{x:R.x,y:R.y+R.height}],P=R.rotation;return P?[f(I[0],P,I[0]),f(I[1],P,I[0]),f(I[2],P,I[0]),f(I[3],P,I[0])]:I}function v(R,I){if(R.length>4)return{min:0,max:0};var P=[];return R.forEach(function(k){P.push(u([k.x,k.y],I))}),{min:Math.min.apply(null,P),max:Math.max.apply(null,P)}}function g(R,I){return R.max>I.min&&R.min<I.max}function x(R){return typeof R=="number"&&!Number.isNaN(R)&&R!==1/0&&R!==-1/0}function w(R){return["x","y","width","height"].every(function(I){return x(R[I])})}function S(R,I,P){return P===void 0&&(P=0),!(I.x>R.x+R.width+P||I.x+I.width<R.x-P||I.y>R.y+R.height+P||I.y+I.height<R.y-P)}function M(R,I,P){if(P===void 0&&(P=0),!w(R)||!w(I))return!1;if(!R.rotation&&!I.rotation)return S(R,I,P);for(var k=d(R),z=d(I),G=c(k).concat(c(z)),J=0;J<G.length;J++){var Z=G[J],X=v(k,Z),et=v(z,Z);if(!g(X,et))return!1}return!0}return{intersect:M}}var r=t().intersect;function n(u){for(var c=u.slice(),f=0;f<c.length;f++){var d=c[f];if(d.visible)for(var v=f+1;v<c.length;v++){var g=c[v];d!==g&&g.visible&&r(d,g)&&(g.visible=!1)}}return c}var i={"hide-overlap":n};try{var a=JSON.parse(e.data);if(!a||!a.type||!i[a.type])return;var o=a.type,s=a.items,l=i[o](s);self.postMessage(l)}catch(u){throw u}},pqt=`
   self.onmessage = `.concat(dqt.toString(),`
`),yP=function(e){for(var t=e.slice(),r=0;r<t.length;r++){var n=t[r];if(n.visible)for(var i=r+1;i<t.length;i++){var a=t[i];n!==a&&a.visible&&cqt(n,a)&&(a.visible=!1)}}return t},_P=new Map,aW=fqt(pqt);function vqt(e,t,r,n){return lu(this,void 0,void 0,function(){var i,a,o,s,l,u;return $h(this,function(c){switch(c.label){case 0:return i=t.map(function(f,d){return $($({},Fnt(f,e[d],xt(e[d],"background.padding"))),{visible:!0})}),a=JSON.stringify(i),o=function(f){return _P.set(a,f),ft(f,function(d,v){var g=d.visible,x=t[v];g?x==null||x.show():x==null||x.hide()}),f},_P.get(a)?(o(_P.get(a)),[3,7]):[3,1];case 1:if(!aW)return[3,6];c.label=2;case 2:return c.trys.push([2,4,,5]),s=JSON.stringify({type:"hide-overlap",items:i}),[4,aW.post(s,function(){return o(yP(i))})];case 3:return l=c.sent(),o(Array.isArray(l.data)?l.data:[]),[3,5];case 4:return u=c.sent(),console.error(u),o(yP(i)),[3,5];case 5:return[3,7];case 6:o(yP(i)),c.label=7;case 7:return[2]}})})}var oW={"#5B8FF9":!0},gqt=function(e){var t=Zm.toRGB(e).toUpperCase();if(oW[t])return oW[t];var r=Pr(Zm.rgb2arr(t),3),n=r[0],i=r[1],a=r[2],o=(n*299+i*587+a*114)/1e3<128;return o};function mqt(e,t,r){if(r.length!==0){var n=r[0].get("element"),i=n.geometry.theme,a=i.labels||{},o=a.fillColorLight,s=a.fillColorDark;r.forEach(function(l,u){var c=t[u],f=c.find(function(S){return S.get("type")==="text"}),d=uc.fromObject(l.getBBox()),v=uc.fromObject(f.getCanvasBBox()),g=!d.contains(v),x=l.attr("fill"),w=gqt(x);g?f.attr(i.overflowLabels.style):w?o&&f.attr("fill",o):s&&f.attr("fill",s)})}}function yqt(e,t,r){var n=e.coordinate,i=o0(t),a=uc.fromObject(i.getCanvasBBox()),o=uc.fromObject(r.getBBox());return n.isTransposed?o.height>=a.height:o.width>=a.width}function _qt(e,t,r){var n=!!e.getAdjust("stack");return n||t.every(function(i,a){var o=r[a];return yqt(e,i,o)})}function xqt(e,t,r){var n=e.coordinate,i=uc.fromObject(r.getBBox()),a=o0(t);n.isTransposed?a.attr({x:i.minX+i.width/2,textAlign:"center"}):a.attr({y:i.minY+i.height/2,textBaseline:"middle"})}function bqt(e,t,r){var n;if(r.length!==0){var i=(n=r[0])===null||n===void 0?void 0:n.get("element"),a=i==null?void 0:i.geometry;if(!(!a||a.type!=="interval")){var o=_qt(a,t,r);o&&r.forEach(function(s,l){var u=t[l];xqt(a,u,s)})}}}function Eqt(e){var t=500,r=[],n=Math.max(Math.floor(e.length/t),1);return ft(e,function(i,a){a%n===0?r.push(i):i.set("visible",!1)}),r}function wqt(e,t,r){var n;if(r.length!==0){var i=(n=r[0])===null||n===void 0?void 0:n.get("element"),a=i==null?void 0:i.geometry;if(!(!a||a.type!=="interval")){var o=Eqt(t),s=Pr(a.getXYFields(),1),l=s[0],u=[],c=[],f=Qc(o,function(w){return w.get("data")[l]}),d=xg(fo(o,function(w){return w.get("data")[l]})),v;o.forEach(function(w){w.set("visible",!0)});var g=function(w){w&&(w.length&&c.push(w.pop()),c.push.apply(c,on([],Pr(w),!1)))};for(il(d)>0&&(v=d.shift(),g(f[v])),il(d)>0&&(v=d.pop(),g(f[v])),ft(d.reverse(),function(w){g(f[w])});c.length>0;){var x=c.shift();x.get("visible")&&(Mjt(x,u)?x.set("visible",!1):u.push(x))}}}}function Cqt(e,t){var r=e.getXYFields()[1],n=[],i=t.sort(function(a,o){return a.get("data")[r]-a.get("data")[r]});return i.length>0&&n.push(i.shift()),i.length>0&&n.push(i.pop()),n.push.apply(n,on([],Pr(i),!1)),n}function mit(e,t,r){return e.some(function(n){return r(n,t)})}function Sqt(e,t,r){r===void 0&&(r=0);var n=Math.max(0,Math.min(e.x+e.width+r,t.x+t.width+r)-Math.max(e.x-r,t.x-r)),i=Math.max(0,Math.min(e.y+e.height+r,t.y+t.height+r)-Math.max(e.y-r,t.y-r));return n*i}function sW(e,t){return mit(e,t,function(r,n){var i=o0(r),a=o0(n);return Sqt(i.getCanvasBBox(),a.getCanvasBBox(),2)>0})}function Tqt(e,t,r,n,i){var a,o;if(r.length!==0){var s=(a=r[0])===null||a===void 0?void 0:a.get("element"),l=s==null?void 0:s.geometry;if(!(!l||l.type!=="point")){var u=Pr(l.getXYFields(),2),c=u[0],f=u[1],d=Qc(t,function(x){return x.get("data")[c]}),v=[],g=i&&i.offset||((o=e[0])===null||o===void 0?void 0:o.offset)||12;fo(P_(d).reverse(),function(x){for(var w=Cqt(l,d[x]);w.length;){var S=w.shift(),M=o0(S);if(mit(v,S,function(P,k){return P.get("data")[c]===k.get("data")[c]&&P.get("data")[f]===k.get("data")[f]})){M.set("visible",!1);continue}var R=sW(v,S),I=!1;if(R&&(M.attr("y",M.attr("y")+2*g),I=sW(v,S)),I){M.set("visible",!1);continue}v.push(S)}})}}}function Aqt(e,t){var r=e.getXYFields()[1],n=[],i=t.sort(function(a,o){return a.get("data")[r]-a.get("data")[r]});return i.length>0&&n.push(i.shift()),i.length>0&&n.push(i.pop()),n.push.apply(n,on([],Pr(i),!1)),n}function yit(e,t,r){return e.some(function(n){return r(n,t)})}function Mqt(e,t,r){r===void 0&&(r=0);var n=Math.max(0,Math.min(e.x+e.width+r,t.x+t.width+r)-Math.max(e.x-r,t.x-r)),i=Math.max(0,Math.min(e.y+e.height+r,t.y+t.height+r)-Math.max(e.y-r,t.y-r));return n*i}function lW(e,t){return yit(e,t,function(r,n){var i=o0(r),a=o0(n);return Mqt(i.getCanvasBBox(),a.getCanvasBBox(),2)>0})}function Rqt(e,t,r,n,i){var a,o;if(r.length!==0){var s=(a=r[0])===null||a===void 0?void 0:a.get("element"),l=s==null?void 0:s.geometry;if(!(!l||["path","line","area"].indexOf(l.type)<0)){var u=Pr(l.getXYFields(),2),c=u[0],f=u[1],d=Qc(t,function(x){return x.get("data")[c]}),v=[],g=i&&i.offset||((o=e[0])===null||o===void 0?void 0:o.offset)||12;fo(P_(d).reverse(),function(x){for(var w=Aqt(l,d[x]);w.length;){var S=w.shift(),M=o0(S);if(yit(v,S,function(P,k){return P.get("data")[c]===k.get("data")[c]&&P.get("data")[f]===k.get("data")[f]})){M.set("visible",!1);continue}var R=lW(v,S),I=!1;if(R&&(M.attr("y",M.attr("y")+2*g),I=lW(v,S)),I){M.set("visible",!1);continue}v.push(S)}})}}}var xP;function Iqt(){return xP||(xP=document.createElement("canvas").getContext("2d")),xP}var _A=D_(function(e,t){t===void 0&&(t={});var r=t.fontSize,n=t.fontFamily,i=t.fontWeight,a=t.fontStyle,o=t.fontVariant,s=Iqt();return s.font=[a,o,i,"".concat(r,"px"),n].join(" "),s.measureText(en(e)?e:"").width},function(e,t){return t===void 0&&(t={}),on([e],Pr(Bb(t)),!1).join("")}),Lqt=function(e,t,r){var n=16,i=_A("...",r),a;en(e)?a=e:a=x0(e);var o=t,s=[],l,u;if(_A(e,r)<=t)return e;for(;l=a.substr(0,n),u=_A(l,r),!(u+i>o&&u>o);)if(s.push(l),o-=u,a=a.substr(n),!a)return s.join("");for(;l=a.substr(0,1),u=_A(l,r),!(u+i>o);)if(s.push(l),o-=u,a=a.substr(1),!a)return s.join("");return"".concat(s.join(""),"...")};function Oqt(e,t,r,n,i){if(!(t.length<=0)){var a=(i==null?void 0:i.direction)||["top","right","bottom","left"],o=(i==null?void 0:i.action)||"translate",s=(i==null?void 0:i.margin)||0,l=t[0].get("coordinate");if(l){var u=sXt(l,s),c=u.minX,f=u.minY,d=u.maxX,v=u.maxY;ft(t,function(g){var x=g.getCanvasBBox(),w=x.minX,S=x.minY,M=x.maxX,R=x.maxY,I=x.x,P=x.y,k=x.width,z=x.height,G=I,J=P;if(a.indexOf("left")>=0&&(w<c||M<c)&&(G=c),a.indexOf("top")>=0&&(S<f||R<f)&&(J=f),a.indexOf("right")>=0&&(w>d?G=d-k:M>d&&(G=G-(M-d))),a.indexOf("bottom")>=0&&(S>v?J=v-z:R>v&&(J=J-(R-v))),G!==I||J!==P){var Z=G-I;if(o==="translate")p2(g,Z,J-P);else if(o==="ellipsis"){var X=g.findAll(function(et){return et.get("type")==="text"});X.forEach(function(et){var at=Vd(et.attr(),["fontSize","fontFamily","fontWeight","fontStyle","fontVariant"]),wt=et.getCanvasBBox(),Tt=Lqt(et.attr("text"),wt.width-Math.abs(Z),at);et.attr("text",Tt)})}else g.hide()}})}}}function Pqt(e,t,r){var n={fillOpacity:ze(e.attr("fillOpacity"))?1:e.attr("fillOpacity"),strokeOpacity:ze(e.attr("strokeOpacity"))?1:e.attr("strokeOpacity"),opacity:ze(e.attr("opacity"))?1:e.attr("opacity")};e.attr({fillOpacity:0,strokeOpacity:0,opacity:0}),e.animate(n,t)}function Dqt(e,t,r){var n={fillOpacity:0,strokeOpacity:0,opacity:0},i=t.easing,a=t.duration,o=t.delay;e.animate(n,a,i,function(){e.remove(!0)},o)}function Fqt(e,t,r){var n,i=Pr(t,2),a=i[0],o=i[1];return e.applyToMatrix([a,o,1]),r==="x"?(e.setMatrix(Ws(e.getMatrix(),[["t",-a,-o],["s",.01,1],["t",a,o]])),n=Ws(e.getMatrix(),[["t",-a,-o],["s",100,1],["t",a,o]])):r==="y"?(e.setMatrix(Ws(e.getMatrix(),[["t",-a,-o],["s",1,.01],["t",a,o]])),n=Ws(e.getMatrix(),[["t",-a,-o],["s",1,100],["t",a,o]])):r==="xy"&&(e.setMatrix(Ws(e.getMatrix(),[["t",-a,-o],["s",.01,.01],["t",a,o]])),n=Ws(e.getMatrix(),[["t",-a,-o],["s",100,100],["t",a,o]])),n}function ek(e,t,r,n,i){var a=r.start,o=r.end,s=r.getWidth(),l=r.getHeight(),u,c;i==="y"?(u=a.x+s/2,c=n.y<a.y?n.y:a.y):i==="x"?(u=n.x>a.x?n.x:a.x,c=a.y+l/2):i==="xy"&&(r.isPolar?(u=r.getCenter().x,c=r.getCenter().y):(u=(a.x+o.x)/2,c=(a.y+o.y)/2));var f=Fqt(e,[u,c],i);e.animate({matrix:f},t)}function Bqt(e,t,r){var n=r.coordinate,i=r.minYPoint;ek(e,t,n,i,"x")}function Nqt(e,t,r){var n=r.coordinate,i=r.minYPoint;ek(e,t,n,i,"y")}function kqt(e,t,r){var n=r.coordinate,i=r.minYPoint;ek(e,t,n,i,"xy")}function zqt(e,t,r){var n=e.getTotalLength();e.attr("lineDash",[n]),e.animate(function(i){return{lineDashOffset:(1-i)*n}},t)}function Uqt(e,t,r){var n=r.toAttrs,i=n.x,a=n.y;delete n.x,delete n.y,e.attr(n),e.animate({x:i,y:a},t)}function $qt(e,t,r){var n=e.getBBox(),i=e.get("origin").mappingData,a=i.points,o=a[0].y-a[1].y>0?n.maxX:n.minX,s=(n.minY+n.maxY)/2;e.applyToMatrix([o,s,1]);var l=Ws(e.getMatrix(),[["t",-o,-s],["s",.01,1],["t",o,s]]);e.setMatrix(l),e.animate({matrix:Ws(e.getMatrix(),[["t",-o,-s],["s",100,1],["t",o,s]])},t)}function Hqt(e,t,r){var n=e.getBBox(),i=e.get("origin").mappingData,a=(n.minX+n.maxX)/2,o=i.points,s=o[0].y-o[1].y<=0?n.maxY:n.minY;e.applyToMatrix([a,s,1]);var l=Ws(e.getMatrix(),[["t",-a,-s],["s",1,.01],["t",a,s]]);e.setMatrix(l),e.animate({matrix:Ws(e.getMatrix(),[["t",-a,-s],["s",1,100],["t",a,s]])},t)}function uW(e,t){var r,n=kR(e,t),i=n.startAngle,a=n.endAngle;return!xl(i,-Math.PI*.5)&&i<-Math.PI*.5&&(i+=Math.PI*2),!xl(a,-Math.PI*.5)&&a<-Math.PI*.5&&(a+=Math.PI*2),t[5]===0&&(r=Pr([a,i],2),i=r[0],a=r[1]),xl(i,Math.PI*1.5)&&(i=Math.PI*-.5),xl(a,Math.PI*-.5)&&!xl(i,a)&&(a=Math.PI*1.5),{startAngle:i,endAngle:a}}function cW(e){var t;return e[0]==="M"||e[0]==="L"?t=[e[1],e[2]]:(e[0]==="a"||e[0]==="A"||e[0]==="C")&&(t=[e[e.length-2],e[e.length-1]]),t}function hW(e){var t,r,n,i=e.filter(function(R){return R[0]==="A"||R[0]==="a"});if(i.length===0)return{startAngle:0,endAngle:0,radius:0,innerRadius:0};var a=i[0],o=i.length>1?i[1]:i[0],s=e.indexOf(a),l=e.indexOf(o),u=cW(e[s-1]),c=cW(e[l-1]),f=uW(u,a),d=f.startAngle,v=f.endAngle,g=uW(c,o),x=g.startAngle,w=g.endAngle;xl(d,x)&&xl(v,w)?(r=d,n=v):(r=Math.min(d,x),n=Math.max(v,w));var S=a[1],M=i[i.length-1][1];return S<M?(t=Pr([M,S],2),S=t[0],M=t[1]):S===M&&(M=0),{startAngle:r,endAngle:n,radius:S,innerRadius:M}}function Vqt(e,t,r){var n=r.toAttrs,i=r.coordinate,a=n.path||[],o=a.map(function(M){return M[0]});if(!(a.length<1)){var s=hW(a),l=s.startAngle,u=s.endAngle,c=s.radius,f=s.innerRadius,d=hW(e.attr("path")),v=d.startAngle,g=d.endAngle,x=i.getCenter(),w=l-v,S=u-g;if(w===0&&S===0){e.attr(n);return}e.animate(function(M){var R=v+M*w,I=g+M*S;return $($({},n),{path:Di(o,["M","A","A","Z"])?Jrt(x.x,x.y,c,R,I):qm(x.x,x.y,c,R,I,f)})},$($({},t),{callback:function(){e.attr("path",a),Rr(t.callback)&&t.callback()}}))}}function Gqt(e,t,r){var n=ON(r.coordinate,20),i=n.type,a=n.startState,o=n.endState,s=e.setClip({type:i,attrs:a});r.toAttrs&&e.attr(r.toAttrs),s.animate(o,$($({},t),{callback:function(){e&&!e.get("destroyed")&&e.set("clipShape",null),s.remove(!0),Rr(t.callback)&&t.callback()}}))}function rk(e,t,r){if(e.isGroup())ft(e.getChildren(),function(s){rk(s,t,r)});else{var n=e.getBBox(),i=(n.minX+n.maxX)/2,a=(n.minY+n.maxY)/2;if(e.applyToMatrix([i,a,1]),r==="zoomIn"){var o=Ws(e.getMatrix(),[["t",-i,-a],["s",.01,.01],["t",i,a]]);e.setMatrix(o),e.animate({matrix:Ws(e.getMatrix(),[["t",-i,-a],["s",100,100],["t",i,a]])},t)}else e.animate({matrix:Ws(e.getMatrix(),[["t",-i,-a],["s",.01,.01],["t",i,a]])},$($({},t),{callback:function(){e.remove(!0),Rr(t.callback)&&t.callback()}}))}}function Wqt(e,t,r){rk(e,t,"zoomIn")}function Xqt(e,t,r){rk(e,t,"zoomOut")}function Cg(e){return[br.TOP,br.BOTTOM].includes(e)?{offsetX:0,offsetY:e===br.TOP?-8:8,style:{textAlign:"center",textBaseline:e===br.TOP?"bottom":"top"}}:[br.LEFT,br.RIGHT].includes(e)?{offsetX:e===br.LEFT?-8:8,offsetY:0,style:{textAlign:e===br.LEFT?"right":"left",textBaseline:"middle",rotate:Math.PI/2}}:{}}function bP(e,t,r){return{x:e.x+t*Math.cos(r),y:e.y+t*Math.sin(r)}}var jqt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){return Tr({},e.prototype.getDefaultCfg.call(this),{type:"circle",showTitle:!0,title:e.prototype.getDefaultTitleCfg.call(this)})},t.prototype.render=function(){e.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},t.prototype.getRegion=function(r,n){var i=.5,a={x:.5,y:.5},o=Math.PI*2/r,s=-1*Math.PI/2+o*n,l=i/(1+1/Math.sin(o/2)),u=bP(a,i-l,s),c=Math.PI*5/4,f=Math.PI*1/4;return{start:bP(u,l,c),end:bP(u,l,f)}},t.prototype.afterEachView=function(r,n){this.processAxis(r,n)},t.prototype.beforeEachView=function(r,n){},t.prototype.generateFacets=function(r){var n=this,i=this.cfg,a=i.fields,o=i.type,s=Pr(a,1),l=s[0];if(!l)throw new Error("No `fields` specified!");var u=this.getFieldValues(r,l),c=u.length,f=[];return u.forEach(function(d,v){var g=[{field:l,value:d,values:u}],x=Al(r,n.getFacetDataFilter(g)),w={type:o,data:x,region:n.getRegion(c,v),columnValue:d,columnField:l,columnIndex:v,columnValuesLength:c,rowValue:null,rowField:null,rowIndex:0,rowValuesLength:1};f.push(w)}),f},t.prototype.getXAxisOption=function(r,n,i,a){return i},t.prototype.getYAxisOption=function(r,n,i,a){return i},t.prototype.renderTitle=function(){var r=this;ft(this.facets,function(n){var i=n.columnValue,a=n.view,o=xt(r.cfg.title,"formatter"),s=Tr({position:["50%","0%"],content:o?o(i):i},Cg(br.TOP),r.cfg.title);a.annotation().text(s)})},t}($b),Yqt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){return Tr({},e.prototype.getDefaultCfg.call(this),{type:"list",cols:null,showTitle:!0,title:e.prototype.getDefaultTitleCfg.call(this)})},t.prototype.render=function(){e.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},t.prototype.afterEachView=function(r,n){this.processAxis(r,n)},t.prototype.beforeEachView=function(r,n){},t.prototype.generateFacets=function(r){var n=this,i=this.cfg.fields,a=this.cfg.cols,o=Pr(i,1),s=o[0];if(!s)throw new Error("No `fields` specified!");var l=this.getFieldValues(r,s),u=l.length;a=a||u;var c=this.getPageCount(u,a),f=[];return l.forEach(function(d,v){var g=n.getRowCol(v,a),x=g.row,w=g.col,S=[{field:s,value:d,values:l}],M=Al(r,n.getFacetDataFilter(S)),R={type:n.cfg.type,data:M,region:n.getRegion(c,a,w,x),columnValue:d,rowValue:d,columnField:s,rowField:null,columnIndex:w,rowIndex:x,columnValuesLength:a,rowValuesLength:c,total:u};f.push(R)}),f},t.prototype.getXAxisOption=function(r,n,i,a){return a.rowIndex!==a.rowValuesLength-1&&a.columnValuesLength*a.rowIndex+a.columnIndex+1+a.columnValuesLength<=a.total?$($({},i),{label:null,title:null}):i},t.prototype.getYAxisOption=function(r,n,i,a){return a.columnIndex!==0?$($({},i),{title:null,label:null}):i},t.prototype.renderTitle=function(){var r=this;ft(this.facets,function(n){var i=n.columnValue,a=n.view,o=xt(r.cfg.title,"formatter"),s=Tr({position:["50%","0%"],content:o?o(i):i},Cg(br.TOP),r.cfg.title);a.annotation().text(s)})},t.prototype.getPageCount=function(r,n){return Math.floor((r+n-1)/n)},t.prototype.getRowCol=function(r,n){var i=Math.floor(r/n),a=r%n;return{row:i,col:a}},t}($b),Zqt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){return Tr({},e.prototype.getDefaultCfg.call(this),{type:"matrix",showTitle:!1,columnTitle:$({},e.prototype.getDefaultTitleCfg.call(this)),rowTitle:$({},e.prototype.getDefaultTitleCfg.call(this))})},t.prototype.render=function(){e.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},t.prototype.afterEachView=function(r,n){this.processAxis(r,n)},t.prototype.beforeEachView=function(r,n){},t.prototype.generateFacets=function(r){for(var n=this.cfg,i=n.fields,a=n.type,o=i.length,s=o,l=[],u=0;u<s;u++)for(var c=i[u],f=0;f<o;f++){var d=i[f],v={type:a,data:r,region:this.getRegion(o,s,u,f),columnValue:c,rowValue:d,columnField:c,rowField:d,columnIndex:u,rowIndex:f,columnValuesLength:s,rowValuesLength:o};l.push(v)}return l},t.prototype.getXAxisOption=function(r,n,i,a){return a.rowIndex!==a.rowValuesLength-1?$($({},i),{label:null,title:null}):i},t.prototype.getYAxisOption=function(r,n,i,a){return a.columnIndex!==0?$($({},i),{title:null,label:null}):i},t.prototype.renderTitle=function(){var r=this;ft(this.facets,function(n,i){var a=n.columnIndex,o=n.rowIndex,s=n.columnValuesLength;n.rowValuesLength;var l=n.columnValue,u=n.rowValue,c=n.view;if(o===0){var f=xt(r.cfg.columnTitle,"formatter"),d=Tr({position:["50%","0%"],content:f?f(l):l},Cg(br.TOP),r.cfg.columnTitle);c.annotation().text(d)}if(a===s-1){var f=xt(r.cfg.rowTitle,"formatter"),d=Tr({position:["100%","50%"],content:f?f(u):u},Cg(br.RIGHT),r.cfg.rowTitle);c.annotation().text(d)}})},t}($b),qqt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){return Tr({},e.prototype.getDefaultCfg.call(this),{type:"mirror",showTitle:!0,title:e.prototype.getDefaultTitleCfg.call(this),transpose:!1})},t.prototype.render=function(){e.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},t.prototype.beforeEachView=function(r,n){this.cfg.transpose?n.columnIndex%2===0?r.coordinate().transpose().reflect("x"):r.coordinate().transpose():n.rowIndex%2!==0&&r.coordinate().reflect("y")},t.prototype.afterEachView=function(r,n){this.processAxis(r,n)},t.prototype.generateFacets=function(r){var n=this,i=Pr(this.cfg.fields,1),a=i[0],o=[],s=1,l=1,u=[""],c=[""],f,d;return this.cfg.transpose?(f=a,u=this.getFieldValues(r,f).slice(0,2),s=u.length):(d=a,c=this.getFieldValues(r,d).slice(0,2),l=c.length),u.forEach(function(v,g){c.forEach(function(x,w){var S=[{field:f,value:v,values:u},{field:d,value:x,values:c}],M=Al(r,n.getFacetDataFilter(S)),R={type:n.cfg.type,data:M,region:n.getRegion(l,s,g,w),columnValue:v,rowValue:x,columnField:f,rowField:d,columnIndex:g,rowIndex:w,columnValuesLength:s,rowValuesLength:l};o.push(R)})}),o},t.prototype.getXAxisOption=function(r,n,i,a){return a.columnIndex===1||a.rowIndex===1?$($({},i),{label:null,title:null}):i},t.prototype.getYAxisOption=function(r,n,i,a){return i},t.prototype.renderTitle=function(){var r=this;ft(this.facets,function(n,i){var a=n.columnValue,o=n.rowValue,s=n.view,l=xt(r.cfg.title,"formatter");if(r.cfg.transpose){var u=Tr({position:["50%","0%"],content:l?l(a):a},Cg(br.TOP),r.cfg.title);s.annotation().text(u)}else{var u=Tr({position:["100%","50%"],content:l?l(o):o},Cg(br.RIGHT),r.cfg.title);s.annotation().text(u)}})},t}($b),Kqt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.afterEachView=function(r,n){this.processAxis(r,n)},t.prototype.beforeEachView=function(r,n){},t.prototype.getDefaultCfg=function(){return Tr({},e.prototype.getDefaultCfg.call(this),{type:"rect",columnTitle:$({},e.prototype.getDefaultTitleCfg.call(this)),rowTitle:$({},e.prototype.getDefaultTitleCfg.call(this))})},t.prototype.render=function(){e.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},t.prototype.generateFacets=function(r){var n=this,i=Pr(this.cfg.fields,2),a=i[0],o=i[1],s=[],l=1,u=1,c=[""],f=[""];return a&&(c=this.getFieldValues(r,a),l=c.length),o&&(f=this.getFieldValues(r,o),u=f.length),c.forEach(function(d,v){f.forEach(function(g,x){var w=[{field:a,value:d,values:c},{field:o,value:g,values:f}],S=Al(r,n.getFacetDataFilter(w)),M={type:n.cfg.type,data:S,region:n.getRegion(u,l,v,x),columnValue:d,rowValue:g,columnField:a,rowField:o,columnIndex:v,rowIndex:x,columnValuesLength:l,rowValuesLength:u};s.push(M)})}),s},t.prototype.renderTitle=function(){var r=this;ft(this.facets,function(n,i){var a=n.columnIndex,o=n.rowIndex,s=n.columnValuesLength,l=n.columnValue,u=n.rowValue,c=n.view;if(o===0){var f=xt(r.cfg.columnTitle,"formatter"),d=Tr({position:["50%","0%"],content:f?f(l):l},Cg(br.TOP),r.cfg.columnTitle);c.annotation().text(d)}if(a===s-1){var f=xt(r.cfg.rowTitle,"formatter"),d=Tr({position:["100%","50%"],content:f?f(u):u},Cg(br.RIGHT),r.cfg.rowTitle);c.annotation().text(d)}})},t.prototype.getXAxisOption=function(r,n,i,a){return a.rowIndex!==a.rowValuesLength-1?$($({},i),{title:null,label:null}):a.columnIndex!==Math.floor((a.columnValuesLength-1)/2)?$($({},i),{title:null}):i},t.prototype.getYAxisOption=function(r,n,i,a){return a.columnIndex!==0?$($({},i),{title:null,label:null}):a.rowIndex!==Math.floor((a.rowValuesLength-1)/2)?$($({},i),{title:null}):i},t}($b),Qqt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.afterChartRender=function(){r.facets&&r.cfg.line&&(r.container.clear(),r.drawLines(r.facets))},r}return t.prototype.afterEachView=function(r,n){this.processAxis(r,n)},t.prototype.beforeEachView=function(r,n){},t.prototype.init=function(){e.prototype.init.call(this),this.view.on(pi.AFTER_RENDER,this.afterChartRender)},t.prototype.getDefaultCfg=function(){return Tr({},e.prototype.getDefaultCfg.call(this),{type:"tree",line:{style:{lineWidth:1,stroke:"#ddd"},smooth:!1},showTitle:!0,title:e.prototype.getDefaultTitleCfg.call(this)})},t.prototype.generateFacets=function(r){var n=this.cfg.fields;if(!n.length)throw new Error("Please specify for the fields for rootFacet!");var i=[],a={type:this.cfg.type,data:r,region:null,rowValuesLength:this.getRows(),columnValuesLength:1,rowIndex:0,columnIndex:0,rowField:"",columnField:"",rowValue:"",columnValue:""};return i.push(a),a.children=this.getChildFacets(r,1,i),this.setRegion(i),i},t.prototype.setRegion=function(r){var n=this;this.forceColIndex(r),r.forEach(function(i){i.region=n.getRegion(i.rowValuesLength,i.columnValuesLength,i.columnIndex,i.rowIndex)})},t.prototype.getRegion=function(r,n,i,a){var o=1/n,s=1/r,l={x:o*i,y:s*a},u={x:l.x+o,y:l.y+s*2/3};return{start:l,end:u}},t.prototype.forceColIndex=function(r){var n,i,a=this,o=[],s=0;r.forEach(function(g){a.isLeaf(g)&&(o.push(g),g.columnIndex=s,s++)}),o.forEach(function(g){g.columnValuesLength=o.length});for(var l=this.cfg.fields.length,u=l-1;u>=0;u--){var c=this.getFacetsByLevel(r,u);try{for(var f=(n=void 0,yi(c)),d=f.next();!d.done;d=f.next()){var v=d.value;this.isLeaf(v)||(v.originColIndex=v.columnIndex,v.columnIndex=this.getRegionIndex(v.children),v.columnValuesLength=o.length)}}catch(g){n={error:g}}finally{try{d&&!d.done&&(i=f.return)&&i.call(f)}finally{if(n)throw n.error}}}},t.prototype.getFacetsByLevel=function(r,n){var i=[];return r.forEach(function(a){a.rowIndex===n&&i.push(a)}),i},t.prototype.getRegionIndex=function(r){var n=r[0],i=r[r.length-1];return(i.columnIndex-n.columnIndex)/2+n.columnIndex},t.prototype.isLeaf=function(r){return!r.children||!r.children.length},t.prototype.getRows=function(){return this.cfg.fields.length+1},t.prototype.getChildFacets=function(r,n,i){var a=this,o=this.cfg.fields,s=o.length;if(!(s<n)){var l=[],u=o[n-1],c=this.getFieldValues(r,u);return c.forEach(function(f,d){var v=[{field:u,value:f,values:c}],g=r.filter(a.getFacetDataFilter(v));if(g.length){var x={type:a.cfg.type,data:g,region:null,columnValue:f,rowValue:"",columnField:u,rowField:"",columnIndex:d,rowValuesLength:a.getRows(),columnValuesLength:1,rowIndex:n,children:a.getChildFacets(g,n+1,i)};l.push(x),i.push(x)}}),l}},t.prototype.render=function(){e.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},t.prototype.renderTitle=function(){var r=this;ft(this.facets,function(n){var i=n.columnValue,a=n.view,o=xt(r.cfg.title,"formatter"),s=Tr({position:["50%","0%"],content:o?o(i):i},Cg(br.TOP),r.cfg.title);a.annotation().text(s)})},t.prototype.drawLines=function(r){var n=this;r.forEach(function(i){if(!n.isLeaf(i)){var a=i.children;n.addFacetLines(i,a)}})},t.prototype.addFacetLines=function(r,n){var i=this,a=r.view,o=a.coordinateBBox,s={x:o.x+o.width/2,y:o.y+o.height};n.forEach(function(l){var u=l.view.coordinateBBox,c={x:u.bl.x+(u.tr.x-u.bl.x)/2,y:u.tr.y},f={x:s.x,y:s.y+(c.y-s.y)/2},d={x:c.x,y:f.y};i.drawLine([s,f,d,c])})},t.prototype.getPath=function(r){var n=[],i=this.cfg.line.smooth;return i?(n.push(["M",r[0].x,r[0].y]),n.push(["C",r[1].x,r[1].y,r[2].x,r[2].y,r[3].x,r[3].y])):r.forEach(function(a,o){o===0?n.push(["M",a.x,a.y]):n.push(["L",a.x,a.y])}),n},t.prototype.drawLine=function(r){var n=this.getPath(r),i=this.cfg.line.style;this.container.addShape("path",{attrs:Qi({path:n},i)})},t.prototype.getXAxisOption=function(r,n,i,a){return a.rowIndex!==a.rowValuesLength-1?$($({},i),{title:null,label:null}):i},t.prototype.getYAxisOption=function(r,n,i,a){return a.originColIndex!==0&&a.columnIndex!==0?$($({},i),{title:null,label:null}):i},t}($b);function fW(e){var t=on([],Pr(e),!1);t.sort(function(n,i){return n-i});var r=t.length;return r===0?0:r%2===1?t[(r-1)/2]:(t[r/2]+t[r/2-1])/2}function Jqt(e){var t=du(e,function(r,n){return r+=isNaN(n)||!Rn(n)?0:n},0);return e.length===0?0:t/e.length}function xA(e,t){if(!t)return null;var r;switch(e){case"start":return 0;case"center":return .5;case"end":return 1;case"median":{r=t.isCategory?fW(t.values.map(function(n,i){return i})):fW(t.values);break}case"mean":{r=t.isCategory?(t.values.length-1)/2:Jqt(t.values);break}case"min":r=t.isCategory?0:t[e];break;case"max":r=t.isCategory?t.values.length-1:t[e];break;default:r=e;break}return t.scale(r)}var bA=["regionFilter","shape"],tKt=function(e){$t(t,e);function t(r){var n=e.call(this,r)||this;return n.cache=new Map,n.foregroundContainer=n.view.getLayer(_s.FORE).addGroup(),n.backgroundContainer=n.view.getLayer(_s.BG).addGroup(),n.option=[],n}return Object.defineProperty(t.prototype,"name",{get:function(){return"annotation"},enumerable:!1,configurable:!0}),t.prototype.init=function(){},t.prototype.layout=function(){this.update()},t.prototype.render=function(){},t.prototype.update=function(){var r=this;this.onAfterRender(function(){var i=new Map;ft(r.option,function(a){if(Up(bA,a.type)){var o=r.updateOrCreate(a);o&&i.set(r.getCacheKey(a),o)}}),r.cache=r.syncCache(i)});var n=new Map;ft(this.option,function(i){if(!Up(bA,i.type)){var a=r.updateOrCreate(i);a&&n.set(r.getCacheKey(i),a)}}),this.cache=this.syncCache(n)},t.prototype.clear=function(r){r===void 0&&(r=!1),e.prototype.clear.call(this),this.clearComponents(),this.foregroundContainer.clear(),this.backgroundContainer.clear(),r&&(this.option=[])},t.prototype.destroy=function(){this.clear(!0),this.foregroundContainer.remove(!0),this.backgroundContainer.remove(!0)},t.prototype.getComponents=function(){var r=[];return this.cache.forEach(function(n){r.push(n)}),r},t.prototype.clearComponents=function(){this.getComponents().forEach(function(r){r.component.destroy()}),this.cache.clear()},t.prototype.onAfterRender=function(r){var n=!1;this.view.getOptions().animate&&this.view.geometries.forEach(function(i){i.animateOption&&(i.once(Ym.AFTER_DRAW_ANIMATE,function(){r()}),n=!0)}),n||this.view.getRootView().once(pi.AFTER_RENDER,function(){r()})},t.prototype.createAnnotation=function(r){var n=r.type,i=Lrt[E0(n)];if(i){var a=this.getAnnotationTheme(n),o=this.getAnnotationCfg(n,r,a);if(!o)return null;var s=new i(o);return{component:s,layer:this.isTop(o)?_s.FORE:_s.BG,direction:br.NONE,type:ml.ANNOTATION,extra:r}}},t.prototype.annotation=function(r){this.option.push(r)},t.prototype.arc=function(r){return this.annotation($({type:"arc"},r)),this},t.prototype.image=function(r){return this.annotation($({type:"image"},r)),this},t.prototype.line=function(r){return this.annotation($({type:"line"},r)),this},t.prototype.region=function(r){return this.annotation($({type:"region"},r)),this},t.prototype.text=function(r){return this.annotation($({type:"text"},r)),this},t.prototype.dataMarker=function(r){return this.annotation($({type:"dataMarker"},r)),this},t.prototype.dataRegion=function(r){this.annotation($({type:"dataRegion"},r))},t.prototype.regionFilter=function(r){this.annotation($({type:"regionFilter"},r))},t.prototype.shape=function(r){this.annotation($({type:"shape"},r))},t.prototype.html=function(r){this.annotation($({type:"html"},r))},t.prototype.parsePosition=function(r){var n,i,a=this.view.getXScale(),o=this.view.getScalesByDim("y"),s=Rr(r)?r.call(null,a,o):r,l=0,u=0;if(Fe(s)){var c=Pr(s,2),f=c[0],d=c[1];if(en(f)&&f.indexOf("%")!==-1&&!isNaN(f.slice(0,-1)))return this.parsePercentPosition(s);l=xA(f,a),u=xA(d,Object.values(o)[0])}else if(!ze(s))try{for(var v=yi(P_(s)),g=v.next();!g.done;g=v.next()){var x=g.value,w=s[x];x===a.field&&(l=xA(w,a)),o[x]&&(u=xA(w,o[x]))}}catch(S){n={error:S}}finally{try{g&&!g.done&&(i=v.return)&&i.call(v)}finally{if(n)throw n.error}}return isNaN(l)||isNaN(u)?null:this.view.getCoordinate().convert({x:l,y:u})},t.prototype.getRegionPoints=function(r,n){var i=this,a=this.view.getXScale(),o=this.view.getScalesByDim("y"),s=Object.values(o)[0],l=a.field,u=this.view.getData(),c=Fe(r)?r[0]:r[l],f=Fe(n)?n[0]:n[l],d=[],v;return ft(u,function(g,x){if(g[l]===c&&(v=x),x>=v){var w=i.parsePosition([g[l],g[s.field]]);w&&d.push(w)}if(g[l]===f)return!1}),d},t.prototype.parsePercentPosition=function(r){var n=parseFloat(r[0])/100,i=parseFloat(r[1])/100,a=this.view.getCoordinate(),o=a.start,s=a.end,l={x:Math.min(o.x,s.x),y:Math.min(o.y,s.y)},u=a.getWidth()*n+l.x,c=a.getHeight()*i+l.y;return{x:u,y:c}},t.prototype.getCoordinateBBox=function(){var r=this.view.getCoordinate(),n=r.start,i=r.end,a=r.getWidth(),o=r.getHeight(),s={x:Math.min(n.x,i.x),y:Math.min(n.y,i.y)};return{x:s.x,y:s.y,minX:s.x,minY:s.y,maxX:s.x+a,maxY:s.y+o,width:a,height:o}},t.prototype.getAnnotationCfg=function(r,n,i){var a=this,o=this.view.getCoordinate(),s=this.view.getCanvas(),l={};if(ze(n))return null;var u=n.start,c=n.end,f=n.position,d=this.parsePosition(u),v=this.parsePosition(c),g=this.parsePosition(f);if(["arc","image","line","region","regionFilter"].includes(r)&&(!d||!v))return null;if(["text","dataMarker","html"].includes(r)&&!g)return null;if(r==="arc"){var x=n;x.start,x.end;var w=fi(x,["start","end"]),S=sb(o,d),M=sb(o,v);S>M&&(M=Math.PI*2+M),l=$($({},w),{center:o.getCenter(),radius:v3(o,d),startAngle:S,endAngle:M})}else if(r==="image"){var R=n;R.start,R.end;var w=fi(R,["start","end"]);l=$($({},w),{start:d,end:v,src:n.src})}else if(r==="line"){var I=n;I.start,I.end;var w=fi(I,["start","end"]);l=$($({},w),{start:d,end:v,text:xt(n,"text",null)})}else if(r==="region"){var P=n;P.start,P.end;var w=fi(P,["start","end"]);l=$($({},w),{start:d,end:v})}else if(r==="text"){var k=this.view.getData(),z=n;z.position;var G=z.content,w=fi(z,["position","content"]),J=G;Rr(G)&&(J=G(k)),l=$($($({},g),w),{content:J})}else if(r==="dataMarker"){var Z=n;Z.position;var X=Z.point,et=Z.line,at=Z.text,wt=Z.autoAdjust,Tt=Z.direction,w=fi(Z,["position","point","line","text","autoAdjust","direction"]);l=$($($({},w),g),{coordinateBBox:this.getCoordinateBBox(),point:X,line:et,text:at,autoAdjust:wt,direction:Tt})}else if(r==="dataRegion"){var vt=n,zt=vt.start,oe=vt.end,Qt=vt.region,at=vt.text,ne=vt.lineLength,w=fi(vt,["start","end","region","text","lineLength"]);l=$($({},w),{points:this.getRegionPoints(zt,oe),region:Qt,text:at,lineLength:ne})}else if(r==="regionFilter"){var de=n;de.start,de.end;var De=de.apply,Ze=de.color,w=fi(de,["start","end","apply","color"]),ke=this.view.geometries,Be=[],Zr=function(gn){gn&&(gn.isGroup()?gn.getChildren().forEach(function(bn){return Zr(bn)}):Be.push(gn))};ft(ke,function(gn){De?Up(De,gn.type)&&ft(gn.elements,function(bn){Zr(bn.shape)}):ft(gn.elements,function(bn){Zr(bn.shape)})}),l=$($({},w),{color:Ze,shapes:Be,start:d,end:v})}else if(r==="shape"){var Wr=n,In=Wr.render,re=fi(Wr,["render"]),nr=function(Qn){if(Rr(n.render))return In(Qn,a.view,{parsePosition:a.parsePosition.bind(a)})};l=$($({},re),{render:nr})}else if(r==="html"){var zr=n,Ne=zr.html;zr.position;var re=fi(zr,["html","position"]),Vr=function(gn){return Rr(Ne)?Ne(gn,a.view):Ne};l=$($($({},re),g),{parent:s.get("el").parentNode,html:Vr})}var xn=Tr({},i,$($({},l),{top:n.top,style:n.style,offsetX:n.offsetX,offsetY:n.offsetY}));return r!=="html"&&(xn.container=this.getComponentContainer(xn)),xn.animate=this.view.getOptions().animate&&xn.animate&&xt(n,"animate",xn.animate),xn.animateOption=Tr({},ub,xn.animateOption,n.animateOption),xn},t.prototype.isTop=function(r){return xt(r,"top",!0)},t.prototype.getComponentContainer=function(r){return this.isTop(r)?this.foregroundContainer:this.backgroundContainer},t.prototype.getAnnotationTheme=function(r){return xt(this.view.getTheme(),["components","annotation",r],{})},t.prototype.updateOrCreate=function(r){var n=this.cache.get(this.getCacheKey(r));if(n){var i=r.type,a=this.getAnnotationTheme(i),o=this.getAnnotationCfg(i,r,a);o&&Vc(o,["container"]),n.component.update($($({},o||{}),{visible:!!o})),Up(bA,r.type)&&n.component.render()}else n=this.createAnnotation(r),n&&(n.component.init(),Up(bA,r.type)&&n.component.render());return n},t.prototype.syncCache=function(r){var n=this,i=new Map(this.cache);return r.forEach(function(a,o){i.set(o,a)}),i.forEach(function(a,o){Xf(n.option,function(s){return o===n.getCacheKey(s)})||(a.component.destroy(),i.delete(o))}),i},t.prototype.getCacheKey=function(r){return r},t}(Vb);function dW(e,t){var r=Tr({},xt(e,["components","axis","common"]),xt(e,["components","axis",t]));return xt(r,["grid"],{})}function EA(e,t,r,n){var i=[],a=t.getTicks();return e.isPolar&&a.push({value:1,text:"",tickValue:""}),a.reduce(function(o,s,l){var u=s.value;if(n)i.push({points:[e.convert(r==="y"?{x:0,y:u}:{x:u,y:0}),e.convert(r==="y"?{x:1,y:u}:{x:u,y:1})]});else if(l){var c=o.value,f=(c+u)/2;i.push({points:[e.convert(r==="y"?{x:0,y:f}:{x:f,y:0}),e.convert(r==="y"?{x:1,y:f}:{x:f,y:1})]})}return s},a[0]),i}function EP(e,t,r,n,i){var a=t.values.length,o=[],s=r.getTicks();return s.reduce(function(l,u){var c=l?l.value:u.value,f=u.value,d=(c+f)/2;return i==="x"?o.push({points:[e.convert({x:n?f:d,y:0}),e.convert({x:n?f:d,y:1})]}):o.push({points:fo(Array(a+1),function(v,g){return e.convert({x:g/a,y:n?f:d})})}),u},s[0]),o}function pW(e,t){var r=xt(t,"grid");if(r===null)return!1;var n=xt(e,"grid");return!(r===void 0&&n===null)}var wm=["container"],vW=$($({},ub),{appear:null}),eKt=function(e){$t(t,e);function t(r){var n=e.call(this,r)||this;return n.cache=new Map,n.gridContainer=n.view.getLayer(_s.BG).addGroup(),n.gridForeContainer=n.view.getLayer(_s.FORE).addGroup(),n.axisContainer=n.view.getLayer(_s.BG).addGroup(),n.axisForeContainer=n.view.getLayer(_s.FORE).addGroup(),n}return Object.defineProperty(t.prototype,"name",{get:function(){return"axis"},enumerable:!1,configurable:!0}),t.prototype.init=function(){},t.prototype.render=function(){this.update()},t.prototype.layout=function(){var r=this,n=this.view.getCoordinate();ft(this.getComponents(),function(i){var a=i.component,o=i.direction,s=i.type,l=i.extra,u=l.dim,c=l.scale,f=l.alignTick,d;if(s===ml.AXIS)n.isPolar?u==="x"?d=n.isTransposed?lA(n,o):dP(n):u==="y"&&(d=n.isTransposed?dP(n):lA(n,o)):d=lA(n,o);else if(s===ml.GRID)if(n.isPolar){var v=void 0;n.isTransposed?v=u==="x"?EP(n,r.view.getYScales()[0],c,f,u):EA(n,c,u,f):v=u==="x"?EA(n,c,u,f):EP(n,r.view.getXScale(),c,f,u),d={items:v,center:r.view.getCoordinate().getCenter()}}else d={items:EA(n,c,u,f)};a.update(d)})},t.prototype.update=function(){this.option=this.view.getOptions().axes;var r=new Map;this.updateXAxes(r),this.updateYAxes(r);var n=new Map;this.cache.forEach(function(i,a){r.has(a)?n.set(a,i):i.component.destroy()}),this.cache=n},t.prototype.clear=function(){e.prototype.clear.call(this),this.cache.clear(),this.gridContainer.clear(),this.gridForeContainer.clear(),this.axisContainer.clear(),this.axisForeContainer.clear()},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gridContainer.remove(!0),this.gridForeContainer.remove(!0),this.axisContainer.remove(!0),this.axisForeContainer.remove(!0)},t.prototype.getComponents=function(){var r=[];return this.cache.forEach(function(n){r.push(n)}),r},t.prototype.updateXAxes=function(r){var n=this.view.getXScale();if(!(!n||n.isIdentity)){var i=FR(this.option,n.field);if(i!==!1){var a=yG(i,br.BOTTOM),o=_s.BG,s="x",l=this.view.getCoordinate(),u=this.getId("axis",n.field),c=this.getId("grid",n.field);if(l.isRect){var f=this.cache.get(u);if(f){var d=this.getLineAxisCfg(n,i,a);Vc(d,wm),f.component.update(d),r.set(u,f)}else f=this.createLineAxis(n,i,o,a,s),this.cache.set(u,f),r.set(u,f);var v=this.cache.get(c);if(v){var d=this.getLineGridCfg(n,i,a,s);Vc(d,wm),v.component.update(d),r.set(c,v)}else v=this.createLineGrid(n,i,o,a,s),v&&(this.cache.set(c,v),r.set(c,v))}else if(l.isPolar){var f=this.cache.get(u);if(f){var d=l.isTransposed?this.getLineAxisCfg(n,i,br.RADIUS):this.getCircleAxisCfg(n,i,a);Vc(d,wm),f.component.update(d),r.set(u,f)}else{if(l.isTransposed){if(Gl(i))return;f=this.createLineAxis(n,i,o,br.RADIUS,s)}else f=this.createCircleAxis(n,i,o,a,s);this.cache.set(u,f),r.set(u,f)}var v=this.cache.get(c);if(v){var d=l.isTransposed?this.getCircleGridCfg(n,i,br.RADIUS,s):this.getLineGridCfg(n,i,br.CIRCLE,s);Vc(d,wm),v.component.update(d),r.set(c,v)}else{if(l.isTransposed){if(Gl(i))return;v=this.createCircleGrid(n,i,o,br.RADIUS,s)}else v=this.createLineGrid(n,i,o,br.CIRCLE,s);v&&(this.cache.set(c,v),r.set(c,v))}}}}},t.prototype.updateYAxes=function(r){var n=this,i=this.view.getYScales();ft(i,function(a,o){if(!(!a||a.isIdentity)){var s=a.field,l=FR(n.option,s);if(l!==!1){var u=_s.BG,c="y",f=n.getId("axis",s),d=n.getId("grid",s),v=n.view.getCoordinate();if(v.isRect){var g=yG(l,o===0?br.LEFT:br.RIGHT),x=n.cache.get(f);if(x){var w=n.getLineAxisCfg(a,l,g);Vc(w,wm),x.component.update(w),r.set(f,x)}else x=n.createLineAxis(a,l,u,g,c),n.cache.set(f,x),r.set(f,x);var S=n.cache.get(d);if(S){var w=n.getLineGridCfg(a,l,g,c);Vc(w,wm),S.component.update(w),r.set(d,S)}else S=n.createLineGrid(a,l,u,g,c),S&&(n.cache.set(d,S),r.set(d,S))}else if(v.isPolar){var x=n.cache.get(f);if(x){var w=v.isTransposed?n.getCircleAxisCfg(a,l,br.CIRCLE):n.getLineAxisCfg(a,l,br.RADIUS);Vc(w,wm),x.component.update(w),r.set(f,x)}else{if(v.isTransposed){if(Gl(l))return;x=n.createCircleAxis(a,l,u,br.CIRCLE,c)}else x=n.createLineAxis(a,l,u,br.RADIUS,c);n.cache.set(f,x),r.set(f,x)}var S=n.cache.get(d);if(S){var w=v.isTransposed?n.getLineGridCfg(a,l,br.CIRCLE,c):n.getCircleGridCfg(a,l,br.RADIUS,c);Vc(w,wm),S.component.update(w),r.set(d,S)}else{if(v.isTransposed){if(Gl(l))return;S=n.createLineGrid(a,l,u,br.CIRCLE,c)}else S=n.createCircleGrid(a,l,u,br.RADIUS,c);S&&(n.cache.set(d,S),r.set(d,S))}}}}})},t.prototype.createLineAxis=function(r,n,i,a,o){var s={component:new qWt(this.getLineAxisCfg(r,n,a)),layer:i,direction:a===br.RADIUS?br.NONE:a,type:ml.AXIS,extra:{dim:o,scale:r}};return s.component.set("field",r.field),s.component.init(),s},t.prototype.createLineGrid=function(r,n,i,a,o){var s=this.getLineGridCfg(r,n,a,o);if(s){var l={component:new QWt(s),layer:i,direction:br.NONE,type:ml.GRID,extra:{dim:o,scale:r,alignTick:xt(s,"alignTick",!0)}};return l.component.init(),l}},t.prototype.createCircleAxis=function(r,n,i,a,o){var s={component:new KWt(this.getCircleAxisCfg(r,n,a)),layer:i,direction:a,type:ml.AXIS,extra:{dim:o,scale:r}};return s.component.set("field",r.field),s.component.init(),s},t.prototype.createCircleGrid=function(r,n,i,a,o){var s=this.getCircleGridCfg(r,n,a,o);if(s){var l={component:new JWt(s),layer:i,direction:br.NONE,type:ml.GRID,extra:{dim:o,scale:r,alignTick:xt(s,"alignTick",!0)}};return l.component.init(),l}},t.prototype.getLineAxisCfg=function(r,n,i){var a=xt(n,["top"])?this.axisForeContainer:this.axisContainer,o=this.view.getCoordinate(),s=lA(o,i),l=_G(r,n),u=uA(this.view.getTheme(),i),c=xt(n,["title"])?Tr({title:{style:{text:l}}},{title:mG(this.view.getTheme(),i,n.title)},n):n,f=Tr($($({container:a},s),{ticks:r.getTicks().map(function(R){return{id:"".concat(R.tickValue),name:R.text,value:R.value}}),verticalFactor:o.isPolar?gG(s,o.getCenter())*-1:gG(s,o.getCenter()),theme:u}),u,c),d=this.getAnimateCfg(f),v=d.animate,g=d.animateOption;f.animateOption=g,f.animate=v;var x=nnt(s),w=xt(f,"verticalLimitLength",x?1/3:1/2);if(w<=1){var S=this.view.getCanvas().get("width"),M=this.view.getCanvas().get("height");f.verticalLimitLength=w*(x?S:M)}return f},t.prototype.getLineGridCfg=function(r,n,i,a){if(pW(uA(this.view.getTheme(),i),n)){var o=dW(this.view.getTheme(),i),s=Tr({container:xt(n,["top"])?this.gridForeContainer:this.gridContainer},o,xt(n,"grid"),this.getAnimateCfg(n));return s.items=EA(this.view.getCoordinate(),r,a,xt(s,"alignTick",!0)),s}},t.prototype.getCircleAxisCfg=function(r,n,i){var a=xt(n,["top"])?this.axisForeContainer:this.axisContainer,o=this.view.getCoordinate(),s=r.getTicks().map(function(x){return{id:"".concat(x.tickValue),name:x.text,value:x.value}});!r.isCategory&&Math.abs(o.endAngle-o.startAngle)===Math.PI*2&&s.length&&(s[s.length-1].name="");var l=_G(r,n),u=uA(this.view.getTheme(),br.CIRCLE),c=xt(n,["title"])?Tr({title:{style:{text:l}}},{title:mG(this.view.getTheme(),i,n.title)},n):n,f=Tr($($({container:a},dP(this.view.getCoordinate())),{ticks:s,verticalFactor:1,theme:u}),u,c),d=this.getAnimateCfg(f),v=d.animate,g=d.animateOption;return f.animate=v,f.animateOption=g,f},t.prototype.getCircleGridCfg=function(r,n,i,a){if(pW(uA(this.view.getTheme(),i),n)){var o=dW(this.view.getTheme(),br.RADIUS),s=Tr({container:xt(n,["top"])?this.gridForeContainer:this.gridContainer,center:this.view.getCoordinate().getCenter()},o,xt(n,"grid"),this.getAnimateCfg(n)),l=xt(s,"alignTick",!0),u=a==="x"?this.view.getYScales()[0]:this.view.getXScale();return s.items=EP(this.view.getCoordinate(),u,r,l,a),s}},t.prototype.getId=function(r,n){var i=this.view.getCoordinate();return"".concat(r,"-").concat(n,"-").concat(i.type)},t.prototype.getAnimateCfg=function(r){return{animate:this.view.getOptions().animate&&xt(r,"animate"),animateOption:r&&r.animateOption?Tr({},vW,r.animateOption):vW}},t}(Vb);function Hm(e,t,r){return r===br.TOP?[e.minX+e.width/2-t.width/2,e.minY]:r===br.BOTTOM?[e.minX+e.width/2-t.width/2,e.maxY-t.height]:r===br.LEFT?[e.minX,e.minY+e.height/2-t.height/2]:r===br.RIGHT?[e.maxX-t.width,e.minY+e.height/2-t.height/2]:r===br.TOP_LEFT||r===br.LEFT_TOP?[e.tl.x,e.tl.y]:r===br.TOP_RIGHT||r===br.RIGHT_TOP?[e.tr.x-t.width,e.tr.y]:r===br.BOTTOM_LEFT||r===br.LEFT_BOTTOM?[e.bl.x,e.bl.y-t.height]:r===br.BOTTOM_RIGHT||r===br.RIGHT_BOTTOM?[e.br.x-t.width,e.br.y-t.height]:[0,0]}function gW(e,t){return bg(e)?e===!1?!1:{}:xt(e,[t],e)}function wA(e){return xt(e,"position",br.BOTTOM)}var rKt=function(e){$t(t,e);function t(r){var n=e.call(this,r)||this;return n.container=n.view.getLayer(_s.FORE).addGroup(),n}return Object.defineProperty(t.prototype,"name",{get:function(){return"legend"},enumerable:!1,configurable:!0}),t.prototype.init=function(){},t.prototype.render=function(){this.update()},t.prototype.layout=function(){var r=this;this.layoutBBox=this.view.viewBBox,ft(this.components,function(n){var i=n.component,a=n.direction,o=vP(a),s=i.get("maxWidthRatio"),l=i.get("maxHeightRatio"),u=r.getCategoryLegendSizeCfg(o,s,l),c=i.get("maxWidth"),f=i.get("maxHeight");i.update({maxWidth:Math.min(u.maxWidth,c||0),maxHeight:Math.min(u.maxHeight,f||0)});var d=i.get("padding"),v=i.getLayoutBBox(),g=new uc(v.x,v.y,v.width,v.height).expand(d),x=Pr(Hm(r.view.viewBBox,g,a),2),w=x[0],S=x[1],M=Pr(Hm(r.layoutBBox,g,a),2),R=M[0],I=M[1],P=0,k=0;a.startsWith("top")||a.startsWith("bottom")?(P=w,k=I):(P=R,k=S),i.setLocation({x:P+d[3],y:k+d[0]}),r.layoutBBox=r.layoutBBox.cut(g,a)})},t.prototype.update=function(){var r=this;this.option=this.view.getOptions().legends;var n={},i=function(d,v,g){var x=r.getId(g.field),w=r.getComponentById(x);if(w){var S=void 0,M=gW(r.option,g.field);M!==!1&&(xt(M,"custom")?S=r.getCategoryCfg(d,v,g,M,!0):g.isLinear?S=r.getContinuousCfg(d,v,g,M):g.isCategory&&(S=r.getCategoryCfg(d,v,g,M))),S&&(Vc(S,["container"]),w.direction=wA(M),w.component.update(S),n[x]=!0)}else{var R=r.createFieldLegend(d,v,g);R&&(R.component.init(),r.components.push(R),n[x]=!0)}};if(xt(this.option,"custom")){var a="global-custom",o=this.getComponentById(a);if(o){var s=this.getCategoryCfg(void 0,void 0,void 0,this.option,!0);Vc(s,["container"]),o.component.update(s),n[a]=!0}else{var l=this.createCustomLegend(void 0,void 0,void 0,this.option);if(l){l.init();var u=_s.FORE,c=wA(this.option);this.components.push({id:a,component:l,layer:u,direction:c,type:ml.LEGEND,extra:void 0}),n[a]=!0}}}else this.loopLegends(i);var f=[];ft(this.getComponents(),function(d){n[d.id]?f.push(d):d.component.destroy()}),this.components=f},t.prototype.clear=function(){e.prototype.clear.call(this),this.container.clear()},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.container.remove(!0)},t.prototype.getGeometries=function(r){var n=this,i=r.geometries;return ft(r.views,function(a){i=i.concat(n.getGeometries(a))}),i},t.prototype.loopLegends=function(r){var n=this.view.getRootView()===this.view;if(n){var i=this.getGeometries(this.view),a={};ft(i,function(o){var s=o.getGroupAttributes();ft(s,function(l){var u=l.getScale(l.type);!u||u.type==="identity"||a[u.field]||(r(o,l,u),a[u.field]=!0)})})}},t.prototype.createFieldLegend=function(r,n,i){var a,o=gW(this.option,i.field),s=_s.FORE,l=wA(o);if(o!==!1&&(xt(o,"custom")?a=this.createCustomLegend(r,n,i,o):i.isLinear?a=this.createContinuousLegend(r,n,i,o):i.isCategory&&(a=this.createCategoryLegend(r,n,i,o))),a)return a.set("field",i.field),{id:this.getId(i.field),component:a,layer:s,direction:l,type:ml.LEGEND,extra:{scale:i}}},t.prototype.createCustomLegend=function(r,n,i,a){var o=this.getCategoryCfg(r,n,i,a,!0);return new dG(o)},t.prototype.createContinuousLegend=function(r,n,i,a){var o=this.getContinuousCfg(r,n,i,Vc(a,["value"]));return new tXt(o)},t.prototype.createCategoryLegend=function(r,n,i,a){var o=this.getCategoryCfg(r,n,i,a);return new dG(o)},t.prototype.getContinuousCfg=function(r,n,i,a){var o=i.getTicks(),s=Xf(o,function(x){return x.value===0}),l=Xf(o,function(x){return x.value===1}),u=o.map(function(x){var w=x.value,S=x.tickValue,M=n.mapping(i.invert(w)).join("");return{value:S,attrValue:M,color:M,scaleValue:w}});s||u.push({value:i.min,attrValue:n.mapping(i.invert(0)).join(""),color:n.mapping(i.invert(0)).join(""),scaleValue:0}),l||u.push({value:i.max,attrValue:n.mapping(i.invert(1)).join(""),color:n.mapping(i.invert(1)).join(""),scaleValue:1}),u.sort(function(x,w){return x.value-w.value});var c={min:Kc(u).value,max:Ds(u).value,colors:[],rail:{type:n.type},track:{}};n.type==="size"&&(c.track={style:{fill:n.type==="size"?this.view.getTheme().defaultColor:void 0}}),n.type==="color"&&(c.colors=u.map(function(x){return x.attrValue}));var f=this.container,d=wA(a),v=vP(d),g=xt(a,"title");return g&&(g=Tr({text:WC(i)},g)),c.container=f,c.layout=v,c.title=g,c.animateOption=ub,this.mergeLegendCfg(c,a,"continuous")},t.prototype.getCategoryCfg=function(r,n,i,a,o){var s=this.container,l=xt(a,"position",br.BOTTOM),u=FG(this.view.getTheme(),l),c=xt(u,["marker"]),f=xt(a,"marker"),d=vP(l),v=xt(u,["pageNavigator"]),g=xt(a,"pageNavigator"),x=o?Pjt(c,f,a.items):knt(this.view,r,n,c,f),w=xt(a,"title");w&&(w=Tr({text:i?WC(i):""},w));var S=xt(a,"maxWidthRatio"),M=xt(a,"maxHeightRatio"),R=this.getCategoryLegendSizeCfg(d,S,M);R.container=s,R.layout=d,R.items=x,R.title=w,R.animateOption=ub,R.pageNavigator=Tr({},v,g);var I=this.mergeLegendCfg(R,a,l);I.reversed&&I.items.reverse();var P=xt(I,"maxItemWidth");return P&&P<=1&&(I.maxItemWidth=this.view.viewBBox.width*P),I},t.prototype.mergeLegendCfg=function(r,n,i){var a=i.split("-")[0],o=FG(this.view.getTheme(),a);return Tr({},o,r,n)},t.prototype.getId=function(r){return"".concat(this.name,"-").concat(r)},t.prototype.getComponentById=function(r){return Xf(this.components,function(n){return n.id===r})},t.prototype.getCategoryLegendSizeCfg=function(r,n,i){n===void 0&&(n=oV),i===void 0&&(i=oV);var a=this.view.viewBBox,o=a.width,s=a.height;return r==="vertical"?{maxWidth:o*n,maxHeight:s}:{maxWidth:o,maxHeight:s*i}},t}(Vb),nKt=function(e){$t(t,e);function t(r){var n=e.call(this,r)||this;return n.onChangeFn=ag,n.resetMeasure=function(){n.clear()},n.onValueChange=function(i){var a=Pr(i,2),o=a[0],s=a[1];n.start=o,n.end=s,n.changeViewData(o,s)},n.container=n.view.getLayer(_s.FORE).addGroup(),n.onChangeFn=e3(n.onValueChange,20,{leading:!0}),n.width=0,n.view.on(pi.BEFORE_CHANGE_DATA,n.resetMeasure),n.view.on(pi.BEFORE_CHANGE_SIZE,n.resetMeasure),n}return Object.defineProperty(t.prototype,"name",{get:function(){return"slider"},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.view.off(pi.BEFORE_CHANGE_DATA,this.resetMeasure),this.view.off(pi.BEFORE_CHANGE_SIZE,this.resetMeasure)},t.prototype.init=function(){},t.prototype.render=function(){this.option=this.view.getOptions().slider;var r=this.getSliderCfg(),n=r.start,i=r.end;ze(this.start)&&(this.start=n,this.end=i);var a=this.view.getOptions().data;this.option&&!cc(a)?this.slider?this.slider=this.updateSlider():(this.slider=this.createSlider(),this.slider.component.on("sliderchange",this.onChangeFn)):this.slider&&(this.slider.component.destroy(),this.slider=void 0)},t.prototype.layout=function(){var r=this;if(this.option&&!this.width&&(this.measureSlider(),setTimeout(function(){r.view.destroyed||r.changeViewData(r.start,r.end)},0)),this.slider){var n=this.view.coordinateBBox.width,i=this.slider.component.get("padding"),a=Pr(i,4),o=a[0];a[1],a[2];var s=a[3],l=this.slider.component.getLayoutBBox(),u=new uc(l.x,l.y,Math.min(l.width,n),l.height).expand(i),c=this.getMinMaxText(this.start,this.end),f=c.minText,d=c.maxText,v=Pr(Hm(this.view.viewBBox,u,br.BOTTOM),2);v[0];var g=v[1],x=Pr(Hm(this.view.coordinateBBox,u,br.BOTTOM),2),w=x[0];x[1],this.slider.component.update($($({},this.getSliderCfg()),{x:w+s,y:g+o,width:this.width,start:this.start,end:this.end,minText:f,maxText:d})),this.view.viewBBox=this.view.viewBBox.cut(u,br.BOTTOM)}},t.prototype.update=function(){this.render()},t.prototype.createSlider=function(){var r=this.getSliderCfg(),n=new Krt($({container:this.container},r));return n.init(),{component:n,layer:_s.FORE,direction:br.BOTTOM,type:ml.SLIDER}},t.prototype.updateSlider=function(){var r=this.getSliderCfg();if(this.width){var n=this.getMinMaxText(this.start,this.end),i=n.minText,a=n.maxText;r=$($({},r),{width:this.width,start:this.start,end:this.end,minText:i,maxText:a})}return this.slider.component.update(r),this.slider},t.prototype.measureSlider=function(){var r=this.getSliderCfg().width;this.width=r},t.prototype.getSliderCfg=function(){var r={height:16,start:0,end:1,minText:"",maxText:"",x:0,y:0,width:this.view.coordinateBBox.width};if(Xi(this.option)){var n=$({data:this.getData()},xt(this.option,"trendCfg",{}));r=Tr({},r,this.getThemeOptions(),this.option),r=$($({},r),{trendCfg:n})}return r.start=to(Math.min(ze(r.start)?0:r.start,ze(r.end)?1:r.end),0,1),r.end=to(Math.max(ze(r.start)?0:r.start,ze(r.end)?1:r.end),0,1),r},t.prototype.getData=function(){var r=this.view.getOptions().data,n=Pr(this.view.getYScales(),1),i=n[0],a=this.view.getGroupScales();if(a.length){var o=a[0],s=o.field,l=o.ticks;return r.reduce(function(u,c){return c[s]===l[0]&&u.push(c[i.field]),u},[])}return r.map(function(u){return u[i.field]||0})},t.prototype.getThemeOptions=function(){var r=this.view.getTheme();return xt(r,["components","slider","common"],{})},t.prototype.getMinMaxText=function(r,n){var i=this.view.getOptions().data,a=this.view.getXScale(),o=Zf(i,a.field);a.isLinear&&(o=o.sort());var s=o,l=il(i);if(!a||!l)return{};var u=il(s),c=Math.round(r*(u-1)),f=Math.round(n*(u-1)),d=xt(s,[c]),v=xt(s,[f]),g=this.getSliderCfg().formatter;return g&&(d=g(d,i[c],c),v=g(v,i[f],f)),{minText:d,maxText:v}},t.prototype.changeViewData=function(r,n){var i=this.view.getOptions().data,a=this.view.getXScale(),o=il(i);if(!(!a||!o)){var s=Zf(i,a.field),l=this.view.getXScale().isLinear?s.sort(function(v,g){return Number(v)-Number(g)}):s,u=l,c=il(u),f=Math.round(r*(c-1)),d=Math.round(n*(c-1));this.view.filter(a.field,function(v,g){var x=u.indexOf(v);return x>-1?hx(x,f,d):!0}),this.view.render(!0)}},t.prototype.getComponents=function(){return this.slider?[this.slider]:[]},t.prototype.clear=function(){this.slider&&(this.slider.component.destroy(),this.slider=void 0),this.width=0,this.start=void 0,this.end=void 0},t}(Vb),CA=0,mW=8,iKt=32,aKt=20,oKt=function(e){$t(t,e);function t(r){var n=e.call(this,r)||this;return n.onChangeFn=ag,n.resetMeasure=function(){n.clear()},n.onValueChange=function(i){var a=i.ratio,o=n.getValidScrollbarCfg().animate;n.ratio=to(a,0,1);var s=n.view.getOptions().animate;o||n.view.animate(!1),n.changeViewData(n.getScrollRange(),!0),n.view.animate(s)},n.container=n.view.getLayer(_s.FORE).addGroup(),n.onChangeFn=e3(n.onValueChange,20,{leading:!0}),n.trackLen=0,n.thumbLen=0,n.ratio=0,n.view.on(pi.BEFORE_CHANGE_DATA,n.resetMeasure),n.view.on(pi.BEFORE_CHANGE_SIZE,n.resetMeasure),n}return Object.defineProperty(t.prototype,"name",{get:function(){return"scrollbar"},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.view.off(pi.BEFORE_CHANGE_DATA,this.resetMeasure),this.view.off(pi.BEFORE_CHANGE_SIZE,this.resetMeasure)},t.prototype.init=function(){},t.prototype.render=function(){this.option=this.view.getOptions().scrollbar,this.option?this.scrollbar?this.scrollbar=this.updateScrollbar():(this.scrollbar=this.createScrollbar(),this.scrollbar.component.on("scrollchange",this.onChangeFn)):this.scrollbar&&(this.scrollbar.component.destroy(),this.scrollbar=void 0)},t.prototype.layout=function(){var r=this;if(this.option&&!this.trackLen&&(this.measureScrollbar(),setTimeout(function(){r.view.destroyed||r.changeViewData(r.getScrollRange(),!0)})),this.scrollbar){var n=this.view.coordinateBBox.width,i=this.scrollbar.component.get("padding"),a=this.scrollbar.component.getLayoutBBox(),o=new uc(a.x,a.y,Math.min(a.width,n),a.height).expand(i),s=this.getScrollbarComponentCfg(),l=void 0,u=void 0;if(s.isHorizontal){var c=Pr(Hm(this.view.viewBBox,o,br.BOTTOM),2);c[0];var f=c[1],d=Pr(Hm(this.view.coordinateBBox,o,br.BOTTOM),2),v=d[0];d[1],l=v,u=f}else{var g=Pr(Hm(this.view.viewBBox,o,br.RIGHT),2);g[0];var f=g[1],x=Pr(Hm(this.view.viewBBox,o,br.RIGHT),2),v=x[0];x[1],l=v,u=f}l+=i[3],u+=i[0],this.trackLen?this.scrollbar.component.update($($({},s),{x:l,y:u,trackLen:this.trackLen,thumbLen:this.thumbLen,thumbOffset:(this.trackLen-this.thumbLen)*this.ratio})):this.scrollbar.component.update($($({},s),{x:l,y:u})),this.view.viewBBox=this.view.viewBBox.cut(o,s.isHorizontal?br.BOTTOM:br.RIGHT)}},t.prototype.update=function(){this.render()},t.prototype.getComponents=function(){return this.scrollbar?[this.scrollbar]:[]},t.prototype.clear=function(){this.scrollbar&&(this.scrollbar.component.destroy(),this.scrollbar=void 0),this.trackLen=0,this.thumbLen=0,this.ratio=0,this.cnt=0,this.step=0,this.data=void 0,this.xScaleCfg=void 0,this.yScalesCfg=[]},t.prototype.setValue=function(r){this.onValueChange({ratio:r})},t.prototype.getValue=function(){return this.ratio},t.prototype.getThemeOptions=function(){var r=this.view.getTheme();return xt(r,["components","scrollbar","common"],{})},t.prototype.getScrollbarTheme=function(r){var n=xt(this.view.getTheme(),["components","scrollbar"]),i=r||{},a=i.thumbHighlightColor,o=fi(i,["thumbHighlightColor"]);return{default:Tr({},xt(n,["default","style"],{}),o),hover:Tr({},xt(n,["hover","style"],{}),{thumbColor:a})}},t.prototype.measureScrollbar=function(){var r=this.view.getXScale(),n=this.view.getYScales().slice();this.data=this.getScrollbarData(),this.step=this.getStep(),this.cnt=this.getCnt();var i=this.getScrollbarComponentCfg(),a=i.trackLen,o=i.thumbLen;this.trackLen=a,this.thumbLen=o,this.xScaleCfg={field:r.field,values:r.values||[]},this.yScalesCfg=n},t.prototype.getScrollRange=function(){var r=Math.floor((this.cnt-this.step)*to(this.ratio,0,1)),n=Math.min(r+this.step-1,this.cnt-1);return[r,n]},t.prototype.changeViewData=function(r,n){var i=this,a=Pr(r,2),o=a[0],s=a[1],l=this.getValidScrollbarCfg().type,u=l!=="vertical",c=Zf(this.data,this.xScaleCfg.field),f=this.view.getXScale().isLinear?c.sort(function(v,g){return Number(v)-Number(g)}):c,d=u?f:f.reverse();this.yScalesCfg.forEach(function(v){i.view.scale(v.field,{formatter:v.formatter,type:v.type,min:v.min,max:v.max,tickMethod:v.tickMethod})}),this.view.filter(this.xScaleCfg.field,function(v){var g=d.indexOf(v);return g>-1?hx(g,o,s):!0}),this.view.render(!0)},t.prototype.createScrollbar=function(){var r=this.getValidScrollbarCfg().type,n=r!=="vertical",i=new Qrt($($({container:this.container},this.getScrollbarComponentCfg()),{x:0,y:0}));return i.init(),{component:i,layer:_s.FORE,direction:n?br.BOTTOM:br.RIGHT,type:ml.SCROLLBAR}},t.prototype.updateScrollbar=function(){var r=this.getScrollbarComponentCfg(),n=this.trackLen?$($({},r),{trackLen:this.trackLen,thumbLen:this.thumbLen,thumbOffset:(this.trackLen-this.thumbLen)*this.ratio}):$({},r);return this.scrollbar.component.update(n),this.scrollbar},t.prototype.getStep=function(){if(this.step)return this.step;var r=this.view.coordinateBBox,n=this.getValidScrollbarCfg(),i=n.type,a=n.categorySize,o=i!=="vertical";return Math.floor((o?r.width:r.height)/a)},t.prototype.getCnt=function(){if(this.cnt)return this.cnt;var r=this.view.getXScale(),n=this.getScrollbarData(),i=Zf(n,r.field);return il(i)},t.prototype.getScrollbarComponentCfg=function(){var r=this.view,n=r.coordinateBBox,i=r.viewBBox,a=this.getValidScrollbarCfg(),o=a.type,s=a.padding,l=a.width,u=a.height,c=a.style,f=o!=="vertical",d=Pr(s,4),v=d[0],g=d[1],x=d[2],w=d[3],S=f?{x:n.minX+w,y:i.maxY-u-x}:{x:i.maxX-l-g,y:n.minY+v},M=this.getStep(),R=this.getCnt(),I=f?n.width-w-g:n.height-v-x,P=Math.max(I*to(M/R,0,1),aKt);return $($({},this.getThemeOptions()),{x:S.x,y:S.y,size:f?u:l,isHorizontal:f,trackLen:I,thumbLen:P,thumbOffset:0,theme:this.getScrollbarTheme(c)})},t.prototype.getValidScrollbarCfg=function(){var r={type:"horizontal",categorySize:iKt,width:mW,height:mW,padding:[0,0,0,0],animate:!0,style:{}};return Xi(this.option)&&(r=$($({},r),this.option)),(!Xi(this.option)||!this.option.padding)&&(r.padding=r.type==="horizontal"?[CA,0,CA,0]:[0,CA,0,CA]),r},t.prototype.getScrollbarData=function(){var r=this.view.getCoordinate(),n=this.getValidScrollbarCfg(),i=this.view.getOptions().data||[];return r.isReflect("y")&&n.type==="vertical"&&(i=on([],Pr(i),!1).reverse()),i},t}(Vb),sKt={fill:"#CCD6EC",opacity:.3};function lKt(e,t,r){var n,i,a,o,s,l,u=ojt(e,t,r);if(u.length){u=rh(u);try{for(var c=yi(u),f=c.next();!f.done;f=c.next()){var d=f.value;try{for(var v=(a=void 0,yi(d)),g=v.next();!g.done;g=v.next()){var x=g.value,w=x.mappingData,S=w.x,M=w.y;x.x=Fe(S)?S[S.length-1]:S,x.y=Fe(M)?M[M.length-1]:M}}catch(Z){a={error:Z}}finally{try{g&&!g.done&&(o=v.return)&&o.call(v)}finally{if(a)throw a.error}}}}catch(Z){n={error:Z}}finally{try{f&&!f.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}var R=r.shared;if(R===!1&&u.length>1){var I=u[0],P=Math.abs(t.y-I[0].y);try{for(var k=yi(u),z=k.next();!z.done;z=k.next()){var G=z.value,J=Math.abs(t.y-G[0].y);J<=P&&(I=G,P=J)}}catch(Z){s={error:Z}}finally{try{z&&!z.done&&(l=k.return)&&l.call(k)}finally{if(s)throw s.error}}u=[I]}return xg(rh(u))}return[]}var uKt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.show=function(r){var n=this.context.view,i=this.context.event,a=n.getController("tooltip").getTooltipCfg(),o=lKt(n,{x:i.x,y:i.y},a);if(!Di(o,this.items)&&(this.items=o,o.length)){var s=n.getXScale().field,l=o[0].data[s],u=[],c=n.geometries;if(ft(c,function(oe){if(oe.type==="interval"||oe.type==="schema"){var Qt=oe.getElementsBy(function(ne){var de=ne.getData();return de[s]===l});u=u.concat(Qt)}}),u.length){var f=n.getCoordinate(),d=u[0].shape.getCanvasBBox(),v=u[0].shape.getCanvasBBox(),g=d;ft(u,function(oe){var Qt=oe.shape.getCanvasBBox();f.isTransposed?(Qt.minY<d.minY&&(d=Qt),Qt.maxY>v.maxY&&(v=Qt)):(Qt.minX<d.minX&&(d=Qt),Qt.maxX>v.maxX&&(v=Qt)),g.x=Math.min(Qt.minX,g.minX),g.y=Math.min(Qt.minY,g.minY),g.width=Math.max(Qt.maxX,g.maxX)-g.x,g.height=Math.max(Qt.maxY,g.maxY)-g.y});var x=n.backgroundGroup,w=n.coordinateBBox,S=void 0;if(f.isRect){var M=n.getXScale(),R=r||{},I=R.appendRatio,P=R.appendWidth;ze(P)&&(I=ze(I)?M.isLinear?0:.25:I,P=f.isTransposed?I*v.height:I*d.width);var k=void 0,z=void 0,G=void 0,J=void 0;f.isTransposed?(k=w.minX,z=Math.min(v.minY,d.minY)-P,G=w.width,J=g.height+P*2):(k=Math.min(d.minX,v.minX)-P,z=w.minY,G=g.width+P*2,J=w.height),S=[["M",k,z],["L",k+G,z],["L",k+G,z+J],["L",k,z+J],["Z"]]}else{var Z=Kc(u),X=Ds(u),et=GC(Z.getModel(),f).startAngle,at=GC(X.getModel(),f).endAngle,wt=f.getCenter(),Tt=f.getRadius(),vt=f.innerRadius*Tt;S=qm(wt.x,wt.y,Tt,et,at,vt)}if(this.regionPath)this.regionPath.attr("path",S),this.regionPath.show();else{var zt=xt(r,"style",sKt);this.regionPath=x.addShape({type:"path",name:"active-region",capture:!1,attrs:$($({},zt),{path:S})})}}}},t.prototype.hide=function(){this.regionPath&&this.regionPath.hide(),this.items=null},t.prototype.destroy=function(){this.hide(),this.regionPath&&this.regionPath.remove(!0),e.prototype.destroy.call(this)},t}(io),_it=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.timeStamp=0,r}return t.prototype.show=function(){var r=this.context,n=r.event,i=r.view,a=i.isTooltipLocked();if(!a){var o=this.timeStamp,s=+new Date,l=xt(r.view.getOptions(),"tooltip.showDelay",16);if(s-o>l){var u=this.location,c={x:n.x,y:n.y};(!u||!Di(u,c))&&this.showTooltip(i,c),this.timeStamp=s,this.location=c}}},t.prototype.hide=function(){var r=this.context.view,n=r.getController("tooltip"),i=this.context.event,a=i.clientX,o=i.clientY;n.isCursorEntered({x:a,y:o})||r.isTooltipLocked()||(this.hideTooltip(r),this.location=null)},t.prototype.showTooltip=function(r,n){r.showTooltip(n)},t.prototype.hideTooltip=function(r){r.hideTooltip()},t}(io),cKt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.showTooltip=function(r,n){var i=Zp(r);ft(i,function(a){var o=zF(r,a,n);a.showTooltip(o)})},t.prototype.hideTooltip=function(r){var n=Zp(r);ft(n,function(i){i.hideTooltip()})},t}(_it),hKt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.timeStamp=0,r}return t.prototype.destroy=function(){e.prototype.destroy.call(this),this.tooltip&&this.tooltip.destroy()},t.prototype.show=function(){var r=this.context,n=r.event,i=this.timeStamp,a=+new Date;if(a-i>16){var o=this.location,s={x:n.x,y:n.y};(!o||!Di(o,s))&&this.showTooltip(s),this.timeStamp=a,this.location=s}},t.prototype.hide=function(){this.hideTooltip(),this.location=null},t.prototype.showTooltip=function(r){var n=this.context,i=n.event,a=i.target;if(a&&a.get("tip")){if(!this.tooltip)this.renderTooltip();else{var o=n.view,s=o.canvas,l={start:{x:0,y:0},end:{x:s.get("width"),y:s.get("height")}};this.tooltip.set("region",l)}var u=a.get("tip");this.tooltip.update($({title:u},r)),this.tooltip.show()}},t.prototype.hideTooltip=function(){this.tooltip&&this.tooltip.hide()},t.prototype.renderTooltip=function(){var r,n=this.context.view,i=n.canvas,a={start:{x:0,y:0},end:{x:i.get("width"),y:i.get("height")}},o=n.getTheme(),s=xt(o,["components","tooltip","domStyles"],{}),l=new p3({parent:i.get("el").parentNode,region:a,visible:!1,crosshairs:null,domStyles:$({},Tr({},s,(r={},r[Eg]={"max-width":"50%"},r[wg]={"word-break":"break-all"},r)))});l.init(),l.setCapture(!1),this.tooltip=l},t}(io),nk=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.stateName="",r}return t.prototype.hasState=function(r){return r.hasState(this.stateName)},t.prototype.setElementState=function(r,n){r.setState(this.stateName,n)},t.prototype.setState=function(){this.setStateEnable(!0)},t.prototype.clear=function(){var r=this.context.view;this.clearViewState(r)},t.prototype.clearViewState=function(r){var n=this,i=gnt(r,this.stateName);ft(i,function(a){n.setElementState(a,!1)})},t}(io);function yW(e){return xt(e.get("delegateObject"),"item")}var ik=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.ignoreListItemStates=["unchecked"],r}return t.prototype.isItemIgnore=function(r,n){var i=this.ignoreListItemStates,a=i.filter(function(o){return n.hasState(r,o)});return!!a.length},t.prototype.setStateByComponent=function(r,n,i){var a=this.context.view,o=r.get("field"),s=Xl(a);this.setElementsStateByItem(s,o,n,i)},t.prototype.setStateByElement=function(r,n){this.setElementState(r,n)},t.prototype.isMathItem=function(r,n,i){var a=this.context.view,o=lb(a,n),s=Yd(r,n);return!ze(s)&&i.name===o.getText(s)},t.prototype.setElementsStateByItem=function(r,n,i,a){var o=this;ft(r,function(s){o.isMathItem(s,n,i)&&s.setState(o.stateName,a)})},t.prototype.setStateEnable=function(r){var n=a0(this.context);if(n)fnt(this.context)&&this.setStateByElement(n,r);else{var i=c_(this.context);if(XC(i)){var a=i.item,o=i.component;if(a&&o&&!this.isItemIgnore(a,o)){var s=this.context.event.gEvent;if(s&&s.fromShape&&s.toShape&&yW(s.fromShape)===yW(s.toShape))return;this.setStateByComponent(o,a,r)}}}},t.prototype.toggle=function(){var r=a0(this.context);if(r){var n=r.hasState(this.stateName);this.setElementState(r,!n)}},t.prototype.reset=function(){this.setStateEnable(!1)},t}(nk),fKt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.stateName="active",r}return t.prototype.active=function(){this.setState()},t}(ik),dKt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.cache={},r}return t.prototype.getColorScale=function(r,n){var i=n.geometry.getAttribute("color");if(!i)return null;var a=r.getScaleByField(i.getFields()[0]);return a},t.prototype.getLinkPath=function(r,n){var i=this.context.view,a=i.getCoordinate().isTransposed,o=r.shape.getCanvasBBox(),s=n.shape.getCanvasBBox(),l=a?[["M",o.minX,o.minY],["L",s.minX,s.maxY],["L",s.maxX,s.maxY],["L",o.maxX,o.minY],["Z"]]:[["M",o.maxX,o.minY],["L",s.minX,s.minY],["L",s.minX,s.maxY],["L",o.maxX,o.maxY],["Z"]];return l},t.prototype.addLinkShape=function(r,n,i,a){var o={opacity:.4,fill:n.shape.attr("fill")};r.addShape({type:"path",attrs:$($({},Tr({},o,Rr(a)?a(o,n):a)),{path:this.getLinkPath(n,i)})})},t.prototype.linkByElement=function(r,n){var i=this,a=this.context.view,o=this.getColorScale(a,r);if(o){var s=Yd(r,o.field);if(!this.cache[s]){var l=kXt(a,o.field,s),u=this.linkGroup,c=u.addGroup();this.cache[s]=c;var f=l.length;ft(l,function(d,v){if(v<f-1){var g=l[v+1];i.addLinkShape(c,d,g,n)}})}}},t.prototype.removeLink=function(r){var n=this.getColorScale(this.context.view,r);if(n){var i=Yd(r,n.field);this.cache[i]&&(this.cache[i].remove(),this.cache[i]=null)}},t.prototype.link=function(r){var n=this.context;this.linkGroup||(this.linkGroup=n.view.foregroundGroup.addGroup({id:"link-by-color-group",capture:!1}));var i=a0(n);i&&this.linkByElement(i,r==null?void 0:r.style)},t.prototype.unlink=function(){var r=a0(this.context);r&&this.removeLink(r)},t.prototype.clear=function(){this.linkGroup&&this.linkGroup.clear(),this.cache={}},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.linkGroup&&this.linkGroup.remove()},t}(io),ak=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.startPoint=null,r.endPoint=null,r.isStarted=!1,r.effectSiblings=!1,r.effectByRecord=!1,r}return t.prototype.getCurrentPoint=function(){var r=this.context.event;return{x:r.x,y:r.y}},t.prototype.start=function(){this.clear(),this.startPoint=this.getCurrentPoint(),this.isStarted=!0},t.prototype.getIntersectElements=function(){var r=null;if(jC(this.context))r=DN(this.context,10);else{var n=this.startPoint,i=this.isStarted?this.getCurrentPoint():this.endPoint;if(!n||!i)return;var a={minX:Math.min(n.x,i.x),minY:Math.min(n.y,i.y),maxX:Math.max(n.x,i.x),maxY:Math.max(n.y,i.y)},o=this.context.view;r=y3(o,a)}return r},t.prototype.setStateEnable=function(r){if(this.effectSiblings&&!this.effectByRecord)this.setSiblingsState(r);else{var n=Xl(this.context.view),i=this.getIntersectElements();i&&i.length?this.effectByRecord?this.setSiblingsStateByRecord(i,r):this.setElementsState(i,r,n):this.clear()}},t.prototype.setSiblingsStateByRecord=function(r,n){var i=this,a=this.context.view,o=Zp(a),s=r.map(function(c){return c.getModel().data}),l=a.getXScale().field,u=a.getYScales()[0].field;ft(o,function(c){var f=Xl(c),d=f.filter(function(v){var g=v.getModel().data;return _nt(s,g,l,u)});i.setElementsState(d,n,f)})},t.prototype.setSiblingsState=function(r){var n=this,i=this.context.view,a=Zp(i);jC(this.context)&&ft(a,function(o){var s=Xl(o),l=pnt(n.context,o,10);l&&l.length?n.setElementsState(l,r,s):n.clearViewState(o)})},t.prototype.setElementsState=function(r,n,i){var a=this;ft(i,function(o){r.includes(o)?a.setElementState(o,n):a.setElementState(o,!1)})},t.prototype.end=function(){this.isStarted=!1,this.endPoint=this.getCurrentPoint()},t.prototype.clear=function(){var r=this,n=this.context.view;if(this.effectSiblings){var i=Zp(n);ft(i,function(a){r.clearViewState(a)})}else this.clearViewState(n)},t}(nk),pKt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.stateName="active",r}return t.prototype.active=function(){this.setState()},t}(ak),ok=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.setStateEnable=function(r){var n=a0(this.context);if(n){if(!fnt(this.context))return;r?(this.clear(),this.setElementState(n,!0)):this.hasState(n)&&this.setElementState(n,!1)}},t.prototype.toggle=function(){var r=a0(this.context);if(r){var n=this.hasState(r);n||this.clear(),this.setElementState(r,!n)}},t.prototype.reset=function(){this.setStateEnable(!1)},t}(nk),vKt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.stateName="active",r}return t.prototype.active=function(){this.setState()},t}(ok),oC="inactive",sC="active";function sk(e){var t=Xl(e);ft(t,function(r){r.hasState(sC)&&r.setState(sC,!1),r.hasState(oC)&&r.setState(oC,!1)})}function xit(e,t,r){ft(e,function(n){t(n)?(n.hasState(oC)&&n.setState(oC,!1),n.setState(sC,r)):(n.hasState(sC)&&n.setState(sC,!1),n.setState(oC,r))})}var Oy=CR.INACTIVE,eg=CR.ACTIVE,lk=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.stateName=eg,r}return t.prototype.setElementsStateByItem=function(r,n,i,a){var o=this,s=function(l){return o.isMathItem(l,n,i)};this.setHighlightBy(r,s,a)},t.prototype.setElementHighlight=function(r,n){n(r)?(r.hasState(Oy)&&r.setState(Oy,!1),r.setState(eg,!0)):r.hasState(eg)||r.setState(Oy,!0)},t.prototype.setHighlightBy=function(r,n,i){var a=this;if(i)ft(r,function(l){a.setElementHighlight(l,n)});else{var o=gnt(this.context.view,eg),s=!0;ft(o,function(l){if(!n(l))return s=!1,!1}),s?this.clear():ft(r,function(l){n(l)&&(l.hasState(eg)&&l.setState(eg,!1),l.setState(Oy,!0))})}},t.prototype.setElementState=function(r,n){var i=this.context.view,a=Xl(i);this.setHighlightBy(a,function(o){return r===o},n)},t.prototype.highlight=function(){this.setState()},t.prototype.clear=function(){var r=this.context.view;sk(r)},t}(ik),gKt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.setStateByElement=function(r,n){var i=this.context.view,a=r.geometry.getAttribute("color");if(a){var o=i.getScaleByField(a.getFields()[0]),s=Yd(r,o.field),l=Xl(i),u=l.filter(function(c){return Yd(c,o.field)===s});this.setHighlightBy(l,function(c){return u.includes(c)},n)}},t}(lk),mKt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.setElementHighlight=function(r,n){n(r)?(r.hasState(Oy)&&r.setState(Oy,!1),r.setState(eg,!0)):(r.setState(Oy,!0),r.hasState(eg)&&r.setState(eg,!1))},t.prototype.setStateByElement=function(r,n){var i=this.context.view,a=i.getXScale(),o=Yd(r,a.field),s=Xl(i),l=s.filter(function(u){return Yd(u,a.field)===o});this.setHighlightBy(s,function(u){return l.includes(u)},n)},t.prototype.toggle=function(){var r=a0(this.context);if(r){var n=r.hasState(this.stateName);this.setStateByElement(r,!n)}},t}(lk),Fp;(function(e){e.BEFORE_HIGHLIGHT="element-range-highlight:beforehighlight",e.AFTER_HIGHLIGHT="element-range-highlight:afterhighlight",e.BEFORE_CLEAR="element-range-highlight:beforeclear",e.AFTER_CLEAR="element-range-highlight:afterclear"})(Fp||(Fp={}));var bit=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.stateName="active",r}return t.prototype.clearViewState=function(r){sk(r)},t.prototype.highlight=function(){var r=this.context,n=r.view,i=r.event,a=this.getIntersectElements(),o={view:n,event:i,highlightElements:a};n.emit(Fp.BEFORE_HIGHLIGHT,To.fromData(n,Fp.BEFORE_HIGHLIGHT,o)),this.setState(),n.emit(Fp.AFTER_HIGHLIGHT,To.fromData(n,Fp.AFTER_HIGHLIGHT,o))},t.prototype.clear=function(){var r=this.context.view;r.emit(Fp.BEFORE_CLEAR,To.fromData(r,Fp.BEFORE_CLEAR,{})),e.prototype.clear.call(this),r.emit(Fp.AFTER_CLEAR,To.fromData(r,Fp.AFTER_CLEAR,{}))},t.prototype.setElementsState=function(r,n,i){xit(i,function(a){return r.indexOf(a)>=0},n)},t}(ak),yKt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.stateName="active",r}return t.prototype.highlight=function(){this.setState()},t.prototype.setElementState=function(r,n){var i=this.context.view,a=Xl(i);xit(a,function(o){return r===o},n)},t.prototype.clear=function(){var r=this.context.view;sk(r)},t}(ok),_Kt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.stateName="selected",r}return t.prototype.selected=function(){this.setState()},t}(ak),xKt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.stateName="selected",r}return t.prototype.selected=function(){this.setState()},t}(ik),bKt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.stateName="selected",r}return t.prototype.selected=function(){this.setState()},t}(ok),N_=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.stateName="",r.ignoreItemStates=[],r}return t.prototype.getTriggerListInfo=function(){var r=c_(this.context),n=null;return XC(r)&&(n={item:r.item,list:r.component}),n},t.prototype.getAllowComponents=function(){var r=this,n=this.context.view,i=ynt(n),a=[];return ft(i,function(o){o.isList()&&r.allowSetStateByElement(o)&&a.push(o)}),a},t.prototype.hasState=function(r,n){return r.hasState(n,this.stateName)},t.prototype.clearAllComponentsState=function(){var r=this,n=this.getAllowComponents();ft(n,function(i){i.clearItemsState(r.stateName)})},t.prototype.allowSetStateByElement=function(r){var n=r.get("field");if(!n)return!1;if(this.cfg&&this.cfg.componentNames){var i=r.get("name");if(this.cfg.componentNames.indexOf(i)===-1)return!1}var a=this.context.view,o=lb(a,n);return o&&o.isCategory},t.prototype.allowSetStateByItem=function(r,n){var i=this.ignoreItemStates;if(i.length){var a=i.filter(function(o){return n.hasState(r,o)});return a.length===0}return!0},t.prototype.setStateByElement=function(r,n,i){var a=r.get("field"),o=this.context.view,s=lb(o,a),l=Yd(n,a),u=s.getText(l);this.setItemsState(r,u,i)},t.prototype.setStateEnable=function(r){var n=this,i=a0(this.context);if(i){var a=this.getAllowComponents();ft(a,function(u){n.setStateByElement(u,i,r)})}else{var o=c_(this.context);if(XC(o)){var s=o.item,l=o.component;this.allowSetStateByElement(l)&&this.allowSetStateByItem(s,l)&&this.setItemState(l,s,r)}}},t.prototype.setItemsState=function(r,n,i){var a=this,o=r.getItems();ft(o,function(s){s.name===n&&a.setItemState(r,s,i)})},t.prototype.setItemState=function(r,n,i){r.setItemState(n,this.stateName,i)},t.prototype.setState=function(){this.setStateEnable(!0)},t.prototype.reset=function(){this.setStateEnable(!1)},t.prototype.toggle=function(){var r=this.getTriggerListInfo();if(r&&r.item){var n=r.list,i=r.item,a=this.hasState(n,i);this.setItemState(n,i,!a)}},t.prototype.clear=function(){var r=this.getTriggerListInfo();r?r.list.clearItemsState(this.stateName):this.clearAllComponentsState()},t}(io),EKt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.stateName="active",r}return t.prototype.active=function(){this.setState()},t}(N_),_W="inactive",xW="active";function wKt(e){var t=e.getItems();ft(t,function(r){e.hasState(r,xW)&&e.setItemState(r,xW,!1),e.hasState(r,_W)&&e.setItemState(r,_W,!1)})}var pw="inactive",vy="active",uk=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.stateName=vy,r.ignoreItemStates=["unchecked"],r}return t.prototype.setItemsState=function(r,n,i){this.setHighlightBy(r,function(a){return a.name===n},i)},t.prototype.setItemState=function(r,n,i){r.getItems(),this.setHighlightBy(r,function(a){return a===n},i)},t.prototype.setHighlightBy=function(r,n,i){var a=r.getItems();if(i)ft(a,function(l){n(l)?(r.hasState(l,pw)&&r.setItemState(l,pw,!1),r.setItemState(l,vy,!0)):r.hasState(l,vy)||r.setItemState(l,pw,!0)});else{var o=r.getItemsByState(vy),s=!0;ft(o,function(l){if(!n(l))return s=!1,!1}),s?this.clear():ft(a,function(l){n(l)&&(r.hasState(l,vy)&&r.setItemState(l,vy,!1),r.setItemState(l,pw,!0))})}},t.prototype.highlight=function(){this.setState()},t.prototype.clear=function(){var r=this.getTriggerListInfo();if(r)wKt(r.list);else{var n=this.getAllowComponents();ft(n,function(i){i.clearItemsState(vy),i.clearItemsState(pw)})}},t}(N_),CKt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.stateName="selected",r}return t.prototype.selected=function(){this.setState()},t}(N_),SKt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.stateName="unchecked",r}return t.prototype.unchecked=function(){this.setState()},t}(N_),W1="unchecked",SA="checked",TKt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.stateName=SA,r}return t.prototype.setItemState=function(r,n,i){this.setCheckedBy(r,function(a){return a===n},i)},t.prototype.setCheckedBy=function(r,n,i){var a=r.getItems();i&&ft(a,function(o){n(o)?(r.hasState(o,W1)&&r.setItemState(o,W1,!1),r.setItemState(o,SA,!0)):r.hasState(o,SA)||r.setItemState(o,W1,!0)})},t.prototype.toggle=function(){var r=this.getTriggerListInfo();if(r&&r.item){var n=r.list,i=r.item,a=!XS(n.getItems(),function(o){return n.hasState(o,W1)});a||n.hasState(i,W1)?this.setItemState(n,i,!0):this.reset()}},t.prototype.checked=function(){this.setState()},t.prototype.reset=function(){var r=this.getAllowComponents();ft(r,function(n){n.clearItemsState(SA),n.clearItemsState(W1)})},t}(N_),X1="unchecked",AKt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.toggle=function(){var r,n,i,a,o,s,l,u,c=this.getTriggerListInfo();if(c!=null&&c.item){var f=c.list,d=c.item,v=f.getItems(),g=v.filter(function(Z){return!f.hasState(Z,X1)}),x=v.filter(function(Z){return f.hasState(Z,X1)}),w=g[0];if(v.length===g.length)try{for(var S=yi(v),M=S.next();!M.done;M=S.next()){var R=M.value;f.setItemState(R,X1,R.id!==d.id)}}catch(Z){r={error:Z}}finally{try{M&&!M.done&&(n=S.return)&&n.call(S)}finally{if(r)throw r.error}}else if(v.length-x.length===1)if(w.id===d.id)try{for(var I=yi(v),P=I.next();!P.done;P=I.next()){var R=P.value;f.setItemState(R,X1,!1)}}catch(Z){i={error:Z}}finally{try{P&&!P.done&&(a=I.return)&&a.call(I)}finally{if(i)throw i.error}}else try{for(var k=yi(v),z=k.next();!z.done;z=k.next()){var R=z.value;f.setItemState(R,X1,R.id!==d.id)}}catch(Z){o={error:Z}}finally{try{z&&!z.done&&(s=k.return)&&s.call(k)}finally{if(o)throw o.error}}else try{for(var G=yi(v),J=G.next();!J.done;J=G.next()){var R=J.value;f.setItemState(R,X1,R.id!==d.id)}}catch(Z){l={error:Z}}finally{try{J&&!J.done&&(u=G.return)&&u.call(G)}finally{if(l)throw l.error}}}},t}(N_),bW="showRadio",wP="legend-radio-tip",MKt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.timeStamp=0,r}return t.prototype.show=function(){var r=this.getTriggerListInfo();if(r!=null&&r.item){var n=r.list,i=r.item;n.setItemState(i,bW,!0)}},t.prototype.hide=function(){var r=this.getTriggerListInfo();if(r!=null&&r.item){var n=r.list,i=r.item;n.setItemState(i,bW,!1)}},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.tooltip&&this.tooltip.destroy()},t.prototype.showTip=function(){var r=this.context,n=r.event,i=this.timeStamp,a=+new Date,o=this.context.event.target;if(a-i>16&&o.get("name")==="legend-item-radio"){var s=this.location,l={x:n.x,y:n.y};this.timeStamp=a,this.location=l,(!s||!Di(s,l))&&this.showTooltip(l)}},t.prototype.hideTip=function(){this.hideTooltip(),this.location=null},t.prototype.showTooltip=function(r){var n=this.context,i=n.event,a=i.target;if(a&&a.get("tip")){this.tooltip||this.renderTooltip();var o=n.view.getCanvas().get("el").getBoundingClientRect(),s=o.x,l=o.y;this.tooltip.update($($({title:a.get("tip")},r),{x:r.x+s,y:r.y+l})),this.tooltip.show()}},t.prototype.hideTooltip=function(){this.tooltip&&this.tooltip.hide()},t.prototype.renderTooltip=function(){var r,n=(r={},r[Eg]={padding:"6px 8px",transform:"translate(-50%, -80%)",background:"rgba(0,0,0,0.75)",color:"#fff","border-radius":"2px","z-index":100},r[wg]={"font-size":"12px","line-height":"14px","margin-bottom":0,"word-break":"break-all"},r);document.getElementById(wP)&&document.body.removeChild(document.getElementById(wP));var i=new p3({parent:document.body,region:null,visible:!1,crosshairs:null,domStyles:n,containerId:wP});i.init(),i.setCapture(!1),this.tooltip=i},t}(N_),ck=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.maskShape=null,r.points=[],r.starting=!1,r.moving=!1,r.preMovePoint=null,r.shapeType="path",r}return t.prototype.getCurrentPoint=function(){var r=this.context.event;return{x:r.x,y:r.y}},t.prototype.emitEvent=function(r){var n="mask:".concat(r),i=this.context.view,a=this.context.event;i.emit(n,{target:this.maskShape,shape:this.maskShape,points:this.points,x:a.x,y:a.y})},t.prototype.createMask=function(){var r=this.context.view,n=this.getMaskAttrs(),i=r.foregroundGroup.addShape({type:this.shapeType,name:"mask",draggable:!0,attrs:$({fill:"#C5D4EB",opacity:.3},n)});return i},t.prototype.getMaskPath=function(){return[]},t.prototype.show=function(){this.maskShape&&(this.maskShape.show(),this.emitEvent("show"))},t.prototype.start=function(r){this.starting=!0,this.moving=!1,this.points=[this.getCurrentPoint()],this.maskShape||(this.maskShape=this.createMask(),this.maskShape.set("capture",!1)),this.updateMask(r==null?void 0:r.maskStyle),this.emitEvent("start")},t.prototype.moveStart=function(){this.moving=!0,this.preMovePoint=this.getCurrentPoint()},t.prototype.move=function(){if(!(!this.moving||!this.maskShape)){var r=this.getCurrentPoint(),n=this.preMovePoint,i=r.x-n.x,a=r.y-n.y,o=this.points;ft(o,function(s){s.x+=i,s.y+=a}),this.updateMask(),this.emitEvent("change"),this.preMovePoint=r}},t.prototype.updateMask=function(r){var n=Tr({},this.getMaskAttrs(),r);this.maskShape.attr(n)},t.prototype.moveEnd=function(){this.moving=!1,this.preMovePoint=null},t.prototype.end=function(){this.starting=!1,this.emitEvent("end"),this.maskShape&&this.maskShape.set("capture",!0)},t.prototype.hide=function(){this.maskShape&&(this.maskShape.hide(),this.emitEvent("hide"))},t.prototype.resize=function(){this.starting&&this.maskShape&&(this.points.push(this.getCurrentPoint()),this.updateMask(),this.emitEvent("change"))},t.prototype.destroy=function(){this.points=[],this.maskShape&&this.maskShape.remove(),this.maskShape=null,this.preMovePoint=null,e.prototype.destroy.call(this)},t}(io);function Eit(e){var t=Ds(e),r=0,n=0,i=0;if(e.length){var a=e[0];r=FN(a,t)/2,n=(t.x+a.x)/2,i=(t.y+a.y)/2}return{x:n,y:i,r}}var RKt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.shapeType="circle",r}return t.prototype.getMaskAttrs=function(){return Eit(this.points)},t}(ck);function wit(e){return{start:Kc(e),end:Ds(e)}}function Cit(e,t){var r=Math.min(e.x,t.x),n=Math.min(e.y,t.y),i=Math.abs(t.x-e.x),a=Math.abs(t.y-e.y);return{x:r,y:n,width:i,height:a}}var Sit=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.shapeType="rect",r}return t.prototype.getRegion=function(){return wit(this.points)},t.prototype.getMaskAttrs=function(){var r=this.getRegion(),n=r.start,i=r.end;return Cit(n,i)},t}(ck);function EW(e){e.x=to(e.x,0,1),e.y=to(e.y,0,1)}function Tit(e,t,r,n){var i=null,a=null,o=n.invert(Kc(e)),s=n.invert(Ds(e));return r&&(EW(o),EW(s)),t==="x"?(i=n.convert({x:o.x,y:0}),a=n.convert({x:s.x,y:1})):(i=n.convert({x:0,y:o.y}),a=n.convert({x:1,y:s.y})),{start:i,end:a}}var Ait=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.dim="x",r.inPlot=!0,r}return t.prototype.getRegion=function(){var r=this.context.view.getCoordinate();return Tit(this.points,this.dim,this.inPlot,r)},t}(Sit);function hk(e){var t=[];return e.length&&(ft(e,function(r,n){n===0?t.push(["M",r.x,r.y]):t.push(["L",r.x,r.y])}),t.push(["L",e[0].x,e[0].y])),t}function Mit(e){return{path:hk(e)}}var Rit=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getMaskPath=function(){return hk(this.points)},t.prototype.getMaskAttrs=function(){return Mit(this.points)},t.prototype.addPoint=function(){this.resize()},t}(ck);function fk(e){return UXt(e,!0)}function Iit(e){return{path:fk(e)}}var IKt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getMaskPath=function(){return fk(this.points)},t.prototype.getMaskAttrs=function(){return Iit(this.points)},t}(Rit),dk=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.maskShapes=[],r.starting=!1,r.moving=!1,r.recordPoints=null,r.preMovePoint=null,r.shapeType="path",r.maskType="multi-mask",r}return t.prototype.getCurrentPoint=function(){var r=this.context.event;return{x:r.x,y:r.y}},t.prototype.emitEvent=function(r){var n="".concat(this.maskType,":").concat(r),i=this.context.view,a=this.context.event,o={type:this.shapeType,name:this.maskType,get:function(s){return o.hasOwnProperty(s)?o[s]:void 0}};i.emit(n,{target:o,maskShapes:this.maskShapes,multiPoints:this.recordPoints,x:a.x,y:a.y})},t.prototype.createMask=function(r){var n=this.context.view,i=this.recordPoints[r],a=this.getMaskAttrs(i),o=n.foregroundGroup.addShape({type:this.shapeType,name:"mask",draggable:!0,attrs:$({fill:"#C5D4EB",opacity:.3},a)});this.maskShapes.push(o)},t.prototype.getMaskPath=function(r){return[]},t.prototype.show=function(){this.maskShapes.length>0&&(this.maskShapes.forEach(function(r){return r.show()}),this.emitEvent("show"))},t.prototype.start=function(r){this.recordPointStart(),this.starting=!0,this.moving=!1;var n=this.recordPoints.length-1;this.createMask(n),this.updateShapesCapture(!1),this.updateMask(r==null?void 0:r.maskStyle),this.emitEvent("start")},t.prototype.moveStart=function(){this.moving=!0,this.preMovePoint=this.getCurrentPoint(),this.updateShapesCapture(!1)},t.prototype.move=function(){if(!(!this.moving||this.maskShapes.length===0)){var r=this.getCurrentPoint(),n=this.preMovePoint,i=r.x-n.x,a=r.y-n.y,o=this.getCurMaskShapeIndex();o>-1&&(this.recordPoints[o].forEach(function(s){s.x+=i,s.y+=a}),this.updateMask(),this.emitEvent("change"),this.preMovePoint=r)}},t.prototype.updateMask=function(r){var n=this;this.recordPoints.forEach(function(i,a){var o=Tr({},n.getMaskAttrs(i),r);n.maskShapes[a].attr(o)})},t.prototype.resize=function(){this.starting&&this.maskShapes.length>0&&(this.recordPointContinue(),this.updateMask(),this.emitEvent("change"))},t.prototype.moveEnd=function(){this.moving=!1,this.preMovePoint=null,this.updateShapesCapture(!0)},t.prototype.end=function(){this.starting=!1,this.emitEvent("end"),this.updateShapesCapture(!0)},t.prototype.hide=function(){this.maskShapes.length>0&&(this.maskShapes.forEach(function(r){return r.hide()}),this.emitEvent("hide"))},t.prototype.remove=function(){var r=this.getCurMaskShapeIndex();r>-1&&(this.recordPoints.splice(r,1),this.maskShapes[r].remove(),this.maskShapes.splice(r,1),this.preMovePoint=null,this.updateShapesCapture(!0),this.emitEvent("change"))},t.prototype.clearAll=function(){this.recordPointClear(),this.maskShapes.forEach(function(r){return r.remove()}),this.maskShapes=[],this.preMovePoint=null},t.prototype.clear=function(){var r=this.getCurMaskShapeIndex();r===-1?(this.recordPointClear(),this.maskShapes.forEach(function(n){return n.remove()}),this.maskShapes=[],this.emitEvent("clearAll")):(this.recordPoints.splice(r,1),this.maskShapes[r].remove(),this.maskShapes.splice(r,1),this.preMovePoint=null,this.emitEvent("clearSingle")),this.preMovePoint=null},t.prototype.destroy=function(){this.clear(),e.prototype.destroy.call(this)},t.prototype.getRecordPoints=function(){var r;return on([],Pr((r=this.recordPoints)!==null&&r!==void 0?r:[]),!1)},t.prototype.recordPointStart=function(){var r=this.getRecordPoints(),n=this.getCurrentPoint();this.recordPoints=on(on([],Pr(r),!1),[[n]],!1)},t.prototype.recordPointContinue=function(){var r=this.getRecordPoints(),n=this.getCurrentPoint(),i=r.splice(-1,1)[0]||[];i.push(n),this.recordPoints=on(on([],Pr(r),!1),[i],!1)},t.prototype.recordPointClear=function(){this.recordPoints=[]},t.prototype.updateShapesCapture=function(r){this.maskShapes.forEach(function(n){return n.set("capture",r)})},t.prototype.getCurMaskShapeIndex=function(){var r=this.getCurrentPoint();return this.maskShapes.findIndex(function(n){var i=n.attrs,a=i.width,o=i.height,s=i.r,l=a===0||o===0||s===0;return!l&&n.isHit(r.x,r.y)})},t}(io),Lit=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.shapeType="rect",r}return t.prototype.getRegion=function(r){return wit(r)},t.prototype.getMaskAttrs=function(r){var n=this.getRegion(r),i=n.start,a=n.end;return Cit(i,a)},t}(dk),Oit=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.dim="x",r.inPlot=!0,r}return t.prototype.getRegion=function(r){var n=this.context.view.getCoordinate();return Tit(r,this.dim,this.inPlot,n)},t}(Lit),LKt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.shapeType="circle",r.getMaskAttrs=Eit,r}return t}(dk),Pit=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.getMaskPath=hk,r.getMaskAttrs=Mit,r}return t.prototype.addPoint=function(){this.resize()},t}(dk),OKt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.getMaskPath=fk,r.getMaskAttrs=Iit,r}return t}(Pit),PKt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.setCursor=function(r){var n=this.context.view;n.getCanvas().setCursor(r)},t.prototype.default=function(){this.setCursor("default")},t.prototype.pointer=function(){this.setCursor("pointer")},t.prototype.move=function(){this.setCursor("move")},t.prototype.crosshair=function(){this.setCursor("crosshair")},t.prototype.wait=function(){this.setCursor("wait")},t.prototype.help=function(){this.setCursor("help")},t.prototype.text=function(){this.setCursor("text")},t.prototype.eResize=function(){this.setCursor("e-resize")},t.prototype.wResize=function(){this.setCursor("w-resize")},t.prototype.nResize=function(){this.setCursor("n-resize")},t.prototype.sResize=function(){this.setCursor("s-resize")},t.prototype.neResize=function(){this.setCursor("ne-resize")},t.prototype.nwResize=function(){this.setCursor("nw-resize")},t.prototype.seResize=function(){this.setCursor("se-resize")},t.prototype.swResize=function(){this.setCursor("sw-resize")},t.prototype.nsResize=function(){this.setCursor("ns-resize")},t.prototype.ewResize=function(){this.setCursor("ew-resize")},t.prototype.zoomIn=function(){this.setCursor("zoom-in")},t.prototype.zoomOut=function(){this.setCursor("zoom-out")},t}(io),DKt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.filterView=function(r,n,i){var a=this;r.getScaleByField(n)&&r.filter(n,i),r.views&&r.views.length&&ft(r.views,function(o){a.filterView(o,n,i)})},t.prototype.filter=function(){var r=c_(this.context);if(r){var n=this.context.view,i=r.component,a=i.get("field");if(XC(r)){if(a){var o=i.getItemsByState("unchecked"),s=lb(n,a),l=o.map(function(v){return v.name});l.length?this.filterView(n,a,function(v){var g=s.getText(v);return!l.includes(g)}):this.filterView(n,a,null),n.render(!0)}}else if(dnt(r)){var u=i.getValue(),c=Pr(u,2),f=c[0],d=c[1];this.filterView(n,a,function(v){return v>=f&&v<=d}),n.render(!0)}}},t}(io);function wW(e,t,r,n){var i=Math.min(r[t],n[t]),a=Math.max(r[t],n[t]),o=Pr(e.range,2),s=o[0],l=o[1];if(i<s&&(i=s),a>l&&(a=l),i===l&&a===l)return null;var u=e.invert(i),c=e.invert(a);if(e.isCategory){var f=e.values.indexOf(u),d=e.values.indexOf(c),v=e.values.slice(f,d+1);return function(g){return v.includes(g)}}else return function(g){return g>=u&&g<=c}}var Bc;(function(e){e.FILTER="brush-filter-processing",e.RESET="brush-filter-reset",e.BEFORE_FILTER="brush-filter:beforefilter",e.AFTER_FILTER="brush-filter:afterfilter",e.BEFORE_RESET="brush-filter:beforereset",e.AFTER_RESET="brush-filter:afterreset"})(Bc||(Bc={}));var w3=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.dims=["x","y"],r.startPoint=null,r.isStarted=!1,r}return t.prototype.hasDim=function(r){return this.dims.includes(r)},t.prototype.start=function(){var r=this.context;this.isStarted=!0,this.startPoint=r.getCurrentPoint()},t.prototype.filter=function(){var r,n;if(jC(this.context)){var i=this.context.event.target,a=i.getCanvasBBox();r={x:a.x,y:a.y},n={x:a.maxX,y:a.maxY}}else{if(!this.isStarted)return;r=this.startPoint,n=this.context.getCurrentPoint()}if(!(Math.abs(r.x-n.x)<5||Math.abs(r.x-n.y)<5)){var o=this.context,s=o.view,l=o.event,u={view:s,event:l,dims:this.dims};s.emit(Bc.BEFORE_FILTER,To.fromData(s,Bc.BEFORE_FILTER,u));var c=s.getCoordinate(),f=c.invert(n),d=c.invert(r);if(this.hasDim("x")){var v=s.getXScale(),g=wW(v,"x",f,d);this.filterView(s,v.field,g)}if(this.hasDim("y")){var x=s.getYScales()[0],g=wW(x,"y",f,d);this.filterView(s,x.field,g)}this.reRender(s,{source:Bc.FILTER}),s.emit(Bc.AFTER_FILTER,To.fromData(s,Bc.AFTER_FILTER,u))}},t.prototype.end=function(){this.isStarted=!1},t.prototype.reset=function(){var r=this.context.view;if(r.emit(Bc.BEFORE_RESET,To.fromData(r,Bc.BEFORE_RESET,{})),this.isStarted=!1,this.hasDim("x")){var n=r.getXScale();this.filterView(r,n.field,null)}if(this.hasDim("y")){var i=r.getYScales()[0];this.filterView(r,i.field,null)}this.reRender(r,{source:Bc.RESET}),r.emit(Bc.AFTER_RESET,To.fromData(r,Bc.AFTER_RESET,{}))},t.prototype.filterView=function(r,n,i){r.filter(n,i)},t.prototype.reRender=function(r,n){r.render(!0,n)},t}(io),pk=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.filterView=function(r,n,i){var a=Zp(r);ft(a,function(o){o.filter(n,i)})},t.prototype.reRender=function(r){var n=Zp(r);ft(n,function(i){i.render(!0)})},t}(w3),FKt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.filter=function(){var r=c_(this.context),n=this.context.view,i=Xl(n);if(jC(this.context)){var a=DN(this.context,10);a&&ft(i,function(x){a.includes(x)?x.show():x.hide()})}else if(r){var o=r.component,s=o.get("field");if(XC(r)){if(s){var l=o.getItemsByState("unchecked"),u=lb(n,s),c=l.map(function(x){return x.name});ft(i,function(x){var w=Yd(x,s),S=u.getText(w);c.indexOf(S)>=0?x.hide():x.show()})}}else if(dnt(r)){var f=o.getValue(),d=Pr(f,2),v=d[0],g=d[1];ft(i,function(x){var w=Yd(x,s);w>=v&&w<=g?x.show():x.hide()})}}},t.prototype.clear=function(){var r=Xl(this.context.view);ft(r,function(n){n.show()})},t.prototype.reset=function(){this.clear()},t}(io),Dit=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.byRecord=!1,r}return t.prototype.filter=function(){jC(this.context)&&(this.byRecord?this.filterByRecord():this.filterByBBox())},t.prototype.filterByRecord=function(){var r=this.context.view,n=DN(this.context,10);if(n){var i=r.getXScale().field,a=r.getYScales()[0].field,o=n.map(function(l){return l.getModel().data}),s=Zp(r);ft(s,function(l){var u=Xl(l);ft(u,function(c){var f=c.getModel().data;_nt(o,f,i,a)?c.show():c.hide()})})}},t.prototype.filterByBBox=function(){var r=this,n=this.context.view,i=Zp(n);ft(i,function(a){var o=pnt(r.context,a,10),s=Xl(a);o&&ft(s,function(l){o.includes(l)?l.show():l.hide()})})},t.prototype.reset=function(){var r=Zp(this.context.view);ft(r,function(n){var i=Xl(n);ft(i,function(a){a.show()})})},t}(io),BKt=10,NKt=5,kKt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.buttonGroup=null,r.buttonCfg={name:"button",text:"button",textStyle:{x:0,y:0,fontSize:12,fill:"#333333",cursor:"pointer"},padding:[8,10],style:{fill:"#f7f7f7",stroke:"#cccccc",cursor:"pointer"},activeStyle:{fill:"#e6e6e6"}},r}return t.prototype.getButtonCfg=function(){return Tr(this.buttonCfg,this.cfg)},t.prototype.drawButton=function(){var r=this.getButtonCfg(),n=this.context.view.foregroundGroup.addGroup({name:r.name}),i=n.addShape({type:"text",name:"button-text",attrs:$({text:r.text},r.textStyle)}),a=i.getBBox(),o=NN(r.padding),s=n.addShape({type:"rect",name:"button-rect",attrs:$({x:a.x-o[3],y:a.y-o[0],width:a.width+o[1]+o[3],height:a.height+o[0]+o[2]},r.style)});s.toBack(),n.on("mouseenter",function(){s.attr(r.activeStyle)}),n.on("mouseleave",function(){s.attr(r.style)}),this.buttonGroup=n},t.prototype.resetPosition=function(){var r=this.context.view,n=r.getCoordinate(),i=n.convert({x:1,y:1}),a=this.buttonGroup,o=a.getBBox(),s=Ws(null,[["t",i.x-o.width-BKt,i.y+o.height+NKt]]);a.setMatrix(s)},t.prototype.show=function(){this.buttonGroup||this.drawButton(),this.resetPosition(),this.buttonGroup.show()},t.prototype.hide=function(){this.buttonGroup&&this.buttonGroup.hide()},t.prototype.destroy=function(){var r=this.buttonGroup;r&&r.remove(),e.prototype.destroy.call(this)},t}(io),zKt=4,UKt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.starting=!1,r.dragStart=!1,r}return t.prototype.start=function(){this.starting=!0,this.startPoint=this.context.getCurrentPoint()},t.prototype.drag=function(){if(this.startPoint){var r=this.context.getCurrentPoint(),n=this.context.view,i=this.context.event;this.dragStart?n.emit("drag",{target:i.target,x:i.x,y:i.y}):FN(r,this.startPoint)>zKt&&(n.emit("dragstart",{target:i.target,x:i.x,y:i.y}),this.dragStart=!0)}},t.prototype.end=function(){if(this.dragStart){var r=this.context.view,n=this.context.event;r.emit("dragend",{target:n.target,x:n.x,y:n.y})}this.starting=!1,this.dragStart=!1},t}(io),$Kt=5,HKt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.starting=!1,r.isMoving=!1,r.startPoint=null,r.startMatrix=null,r}return t.prototype.start=function(){this.starting=!0,this.startPoint=this.context.getCurrentPoint(),this.startMatrix=this.context.view.middleGroup.getMatrix()},t.prototype.move=function(){if(this.starting){var r=this.startPoint,n=this.context.getCurrentPoint(),i=FN(r,n);if(i>$Kt&&!this.isMoving&&(this.isMoving=!0),this.isMoving){var a=this.context.view,o=Ws(this.startMatrix,[["t",n.x-r.x,n.y-r.y]]);a.backgroundGroup.setMatrix(o),a.foregroundGroup.setMatrix(o),a.middleGroup.setMatrix(o)}}},t.prototype.end=function(){this.isMoving&&(this.isMoving=!1),this.startMatrix=null,this.starting=!1,this.startPoint=null},t.prototype.reset=function(){this.starting=!1,this.startPoint=null,this.isMoving=!1;var r=this.context.view;r.backgroundGroup.resetMatrix(),r.foregroundGroup.resetMatrix(),r.middleGroup.resetMatrix(),this.isMoving=!1},t}(io),CW="x",SW="y",Fit=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.dims=[CW,SW],r.cfgFields=["dims"],r.cacheScaleDefs={},r}return t.prototype.hasDim=function(r){return this.dims.includes(r)},t.prototype.getScale=function(r){var n=this.context.view;return r==="x"?n.getXScale():n.getYScales()[0]},t.prototype.resetDim=function(r){var n=this.context.view;if(this.hasDim(r)&&this.cacheScaleDefs[r]){var i=this.getScale(r);n.scale(i.field,this.cacheScaleDefs[r]),this.cacheScaleDefs[r]=null}},t.prototype.reset=function(){this.resetDim(CW),this.resetDim(SW);var r=this.context.view;r.render(!0)},t}(io),VKt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.startPoint=null,r.starting=!1,r.startCache={},r}return t.prototype.start=function(){var r=this;this.startPoint=this.context.getCurrentPoint(),this.starting=!0;var n=this.dims;ft(n,function(i){var a=r.getScale(i),o=a.min,s=a.max,l=a.values;r.startCache[i]={min:o,max:s,values:l}})},t.prototype.end=function(){this.startPoint=null,this.starting=!1,this.startCache={}},t.prototype.translate=function(){var r=this;if(this.starting){var n=this.startPoint,i=this.context.view.getCoordinate(),a=this.context.getCurrentPoint(),o=i.invert(n),s=i.invert(a),l=s.x-o.x,u=s.y-o.y,c=this.context.view,f=this.dims;ft(f,function(d){r.translateDim(d,{x:l*-1,y:u*-1})}),c.render(!0)}},t.prototype.translateDim=function(r,n){if(this.hasDim(r)){var i=this.getScale(r);i.isLinear&&this.translateLinear(r,i,n)}},t.prototype.translateLinear=function(r,n,i){var a=this.context.view,o=this.startCache[r],s=o.min,l=o.max,u=l-s,c=i[r]*u;this.cacheScaleDefs[r]||(this.cacheScaleDefs[r]={nice:n.nice,min:s,max:l}),a.scale(n.field,{nice:!1,min:s+c,max:l+c})},t.prototype.reset=function(){e.prototype.reset.call(this),this.startPoint=null,this.starting=!1},t}(Fit),GKt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.zoomRatio=.05,r}return t.prototype.zoomIn=function(){this.zoom(this.zoomRatio)},t.prototype.zoom=function(r){var n=this,i=this.dims;ft(i,function(a){n.zoomDim(a,r)}),this.context.view.render(!0)},t.prototype.zoomOut=function(){this.zoom(-1*this.zoomRatio)},t.prototype.zoomDim=function(r,n){if(this.hasDim(r)){var i=this.getScale(r);i.isLinear&&this.zoomLinear(r,i,n)}},t.prototype.zoomLinear=function(r,n,i){var a=this.context.view;this.cacheScaleDefs[r]||(this.cacheScaleDefs[r]={nice:n.nice,min:n.min,max:n.max});var o=this.cacheScaleDefs[r],s=o.max-o.min,l=n.min,u=n.max,c=i*s,f=l-c,d=u+c,v=d-f,g=v/s;d>f&&g<100&&g>.01&&a.scale(n.field,{nice:!1,min:l-c,max:u+c})},t}(Fit);function WKt(e){var t=e.gEvent.originalEvent;return t.deltaY>0}var XKt=1,jKt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.scroll=function(r){var n=this.context,i=n.view,a=n.event;if(i.getOptions().scrollbar){var o=(r==null?void 0:r.wheelDelta)||XKt,s=i.getController("scrollbar"),l=i.getXScale(),u=i.getOptions().data,c=il(Zf(u,l.field)),f=il(l.values),d=s.getValue(),v=Math.floor((c-f)*d),g=v+(WKt(a)?o:-o),x=o/(c-f)/1e4,w=to(g/(c-f)+x,0,1);s.setValue(w)}},t}(io),YKt="aixs-description-tooltip",ZKt=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.show=function(){var r=this.context,n=c_(r).axis,i=n.cfg.title,a=i.description,o=i.text,s=i.descriptionTooltipStyle,l=r.event,u=l.x,c=l.y;this.tooltip||this.renderTooltip(),this.tooltip.update({title:o||"",customContent:function(){return`
          <div class="`.concat(Eg,'" style={').concat(s,`}>
            <div class="`).concat(wg,`">
              字段说明：`).concat(a,`
            </div>
          </div>
        `)},x:u,y:c}),this.tooltip.show()},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.tooltip&&this.tooltip.destroy()},t.prototype.hide=function(){this.tooltip&&this.tooltip.hide()},t.prototype.renderTooltip=function(){var r,n=this.context.view,i=n.canvas,a={start:{x:0,y:0},end:{x:i.get("width"),y:i.get("height")}},o=new p3({parent:i.get("el").parentNode,region:a,visible:!1,containerId:YKt,domStyles:$({},Tr({},(r={},r[Eg]={"max-width":"50%",padding:"10px","line-height":"15px","font-size":"12px",color:"rgba(0, 0, 0, .65)"},r[wg]={"word-break":"break-all","margin-bottom":"3px"},r)))});o.init(),o.setCapture(!1),this.tooltip=o},t}(io);JXt("dark",bnt(Ujt));cet("canvas",OYt);cet("svg",hZt);uv("Polygon",SZt);uv("Interval",xZt);uv("Schema",TZt);uv("Path",qN);uv("Point",wZt);uv("Line",bZt);uv("Area",dZt);uv("Edge",pZt);uv("Heatmap",vZt);uv("Violin",MZt);d2("base",x3);d2("interval",GZt);d2("pie",WZt);d2("polar",pit);uh("overlap",aqt);uh("distribute",jZt);uh("fixed-overlap",iqt);uh("hide-overlap",vqt);uh("limit-in-shape",tqt);uh("limit-in-canvas",JZt);uh("limit-in-plot",Oqt);uh("pie-outer",ZZt);uh("adjust-color",mqt);uh("interval-adjust-position",bqt);uh("interval-hide-overlap",wqt);uh("point-adjust-position",Tqt);uh("pie-spider",QZt);uh("path-adjust-position",Rqt);Qh("fade-in",Pqt);Qh("fade-out",Dqt);Qh("grow-in-x",Bqt);Qh("grow-in-xy",kqt);Qh("grow-in-y",Nqt);Qh("scale-in-x",$qt);Qh("scale-in-y",Hqt);Qh("wave-in",Gqt);Qh("zoom-in",Wqt);Qh("zoom-out",Xqt);Qh("position-update",Uqt);Qh("sector-path-update",Vqt);Qh("path-in",zqt);Hb("rect",Kqt);Hb("mirror",qqt);Hb("list",Yqt);Hb("matrix",Zqt);Hb("circle",jqt);Hb("tree",Qqt);B_("axis",eKt);B_("legend",rKt);B_("tooltip",Tnt);B_("annotation",tKt);B_("slider",nKt);B_("scrollbar",oKt);yn("tooltip",_it);yn("sibling-tooltip",cKt);yn("ellipsis-text",hKt);yn("element-active",fKt);yn("element-single-active",vKt);yn("element-range-active",pKt);yn("element-highlight",lk);yn("element-highlight-by-x",mKt);yn("element-highlight-by-color",gKt);yn("element-single-highlight",yKt);yn("element-range-highlight",bit);yn("element-sibling-highlight",bit,{effectSiblings:!0,effectByRecord:!0});yn("element-selected",xKt);yn("element-single-selected",bKt);yn("element-range-selected",_Kt);yn("element-link-by-color",dKt);yn("active-region",uKt);yn("list-active",EKt);yn("list-selected",CKt);yn("list-highlight",uk);yn("list-unchecked",SKt);yn("list-checked",TKt);yn("list-focus",AKt);yn("list-radio",MKt);yn("legend-item-highlight",uk,{componentNames:["legend"]});yn("axis-label-highlight",uk,{componentNames:["axis"]});yn("axis-description",ZKt);yn("rect-mask",Sit);yn("x-rect-mask",Ait,{dim:"x"});yn("y-rect-mask",Ait,{dim:"y"});yn("circle-mask",RKt);yn("path-mask",Rit);yn("smooth-path-mask",IKt);yn("rect-multi-mask",Lit);yn("x-rect-multi-mask",Oit,{dim:"x"});yn("y-rect-multi-mask",Oit,{dim:"y"});yn("circle-multi-mask",LKt);yn("path-multi-mask",Pit);yn("smooth-path-multi-mask",OKt);yn("cursor",PKt);yn("data-filter",DKt);yn("brush",w3);yn("brush-x",w3,{dims:["x"]});yn("brush-y",w3,{dims:["y"]});yn("sibling-filter",pk);yn("sibling-x-filter",pk,{dims:"x"});yn("sibling-y-filter",pk,{dims:"y"});yn("element-filter",FKt);yn("element-sibling-filter",Dit);yn("element-sibling-filter-record",Dit,{byRecord:!0});yn("view-drag",UKt);yn("view-move",HKt);yn("scale-translate",VKt);yn("scale-zoom",GKt);yn("reset-button",kKt,{name:"reset-button",text:"reset"});yn("mousewheel-scroll",jKt);function vg(e){return e.isInPlot()}Zn("tooltip",{start:[{trigger:"plot:mousemove",action:"tooltip:show",throttle:{wait:50,leading:!0,trailing:!1}},{trigger:"plot:touchmove",action:"tooltip:show",throttle:{wait:50,leading:!0,trailing:!1}}],end:[{trigger:"plot:mouseleave",action:"tooltip:hide"},{trigger:"plot:leave",action:"tooltip:hide"},{trigger:"plot:touchend",action:"tooltip:hide"}]});Zn("ellipsis-text",{start:[{trigger:"legend-item-name:mousemove",action:"ellipsis-text:show",throttle:{wait:50,leading:!0,trailing:!1}},{trigger:"legend-item-name:touchstart",action:"ellipsis-text:show",throttle:{wait:50,leading:!0,trailing:!1}},{trigger:"axis-label:mousemove",action:"ellipsis-text:show",throttle:{wait:50,leading:!0,trailing:!1}},{trigger:"axis-label:touchstart",action:"ellipsis-text:show",throttle:{wait:50,leading:!0,trailing:!1}}],end:[{trigger:"legend-item-name:mouseleave",action:"ellipsis-text:hide"},{trigger:"legend-item-name:touchend",action:"ellipsis-text:hide"},{trigger:"axis-label:mouseleave",action:"ellipsis-text:hide"},{trigger:"axis-label:mouseout",action:"ellipsis-text:hide"},{trigger:"axis-label:touchend",action:"ellipsis-text:hide"}]});Zn("element-active",{start:[{trigger:"element:mouseenter",action:"element-active:active"}],end:[{trigger:"element:mouseleave",action:"element-active:reset"}]});Zn("element-selected",{start:[{trigger:"element:click",action:"element-selected:toggle"}]});Zn("element-highlight",{start:[{trigger:"element:mouseenter",action:"element-highlight:highlight"}],end:[{trigger:"element:mouseleave",action:"element-highlight:reset"}]});Zn("element-highlight-by-x",{start:[{trigger:"element:mouseenter",action:"element-highlight-by-x:highlight"}],end:[{trigger:"element:mouseleave",action:"element-highlight-by-x:reset"}]});Zn("element-highlight-by-color",{start:[{trigger:"element:mouseenter",action:"element-highlight-by-color:highlight"}],end:[{trigger:"element:mouseleave",action:"element-highlight-by-color:reset"}]});Zn("legend-active",{start:[{trigger:"legend-item:mouseenter",action:["list-active:active","element-active:active"]}],end:[{trigger:"legend-item:mouseleave",action:["list-active:reset","element-active:reset"]}]});Zn("legend-highlight",{start:[{trigger:"legend-item:mouseenter",action:["legend-item-highlight:highlight","element-highlight:highlight"]}],end:[{trigger:"legend-item:mouseleave",action:["legend-item-highlight:reset","element-highlight:reset"]}]});Zn("axis-label-highlight",{start:[{trigger:"axis-label:mouseenter",action:["axis-label-highlight:highlight","element-highlight:highlight"]}],end:[{trigger:"axis-label:mouseleave",action:["axis-label-highlight:reset","element-highlight:reset"]}]});Zn("element-list-highlight",{start:[{trigger:"element:mouseenter",action:["list-highlight:highlight","element-highlight:highlight"]}],end:[{trigger:"element:mouseleave",action:["list-highlight:reset","element-highlight:reset"]}]});Zn("element-range-highlight",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"mask:mouseenter",action:"cursor:move"},{trigger:"plot:mouseleave",action:"cursor:default"},{trigger:"mask:mouseleave",action:"cursor:crosshair"}],start:[{trigger:"plot:mousedown",isEnable:function(e){return!e.isInShape("mask")},action:["rect-mask:start","rect-mask:show"]},{trigger:"mask:dragstart",action:["rect-mask:moveStart"]}],processing:[{trigger:"plot:mousemove",action:["rect-mask:resize"]},{trigger:"mask:drag",action:["rect-mask:move"]},{trigger:"mask:change",action:["element-range-highlight:highlight"]}],end:[{trigger:"plot:mouseup",action:["rect-mask:end"]},{trigger:"mask:dragend",action:["rect-mask:moveEnd"]},{trigger:"document:mouseup",isEnable:function(e){return!e.isInPlot()},action:["element-range-highlight:clear","rect-mask:end","rect-mask:hide"]}],rollback:[{trigger:"dblclick",action:["element-range-highlight:clear","rect-mask:hide"]}]});Zn("brush",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:vg,action:["brush:start","rect-mask:start","rect-mask:show"]}],processing:[{trigger:"mousemove",isEnable:vg,action:["rect-mask:resize"]}],end:[{trigger:"mouseup",isEnable:vg,action:["brush:filter","brush:end","rect-mask:end","rect-mask:hide","reset-button:show"]}],rollback:[{trigger:"reset-button:click",action:["brush:reset","reset-button:hide","cursor:crosshair"]}]});Zn("brush-visible",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"plot:mousedown",action:["rect-mask:start","rect-mask:show"]}],processing:[{trigger:"plot:mousemove",action:["rect-mask:resize"]},{trigger:"mask:change",action:["element-range-highlight:highlight"]}],end:[{trigger:"plot:mouseup",action:["rect-mask:end","rect-mask:hide","element-filter:filter","element-range-highlight:clear"]}],rollback:[{trigger:"dblclick",action:["element-filter:clear"]}]});Zn("brush-x",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:vg,action:["brush-x:start","x-rect-mask:start","x-rect-mask:show"]}],processing:[{trigger:"mousemove",isEnable:vg,action:["x-rect-mask:resize"]}],end:[{trigger:"mouseup",isEnable:vg,action:["brush-x:filter","brush-x:end","x-rect-mask:end","x-rect-mask:hide"]}],rollback:[{trigger:"dblclick",action:["brush-x:reset"]}]});Zn("element-path-highlight",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:vg,action:"path-mask:start"},{trigger:"mousedown",isEnable:vg,action:"path-mask:show"}],processing:[{trigger:"mousemove",action:"path-mask:addPoint"}],end:[{trigger:"mouseup",action:"path-mask:end"}],rollback:[{trigger:"dblclick",action:"path-mask:hide"}]});Zn("brush-x-multi",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"mask:mouseenter",action:"cursor:move"},{trigger:"plot:mouseleave",action:"cursor:default"},{trigger:"mask:mouseleave",action:"cursor:crosshair"}],start:[{trigger:"mousedown",isEnable:vg,action:["x-rect-multi-mask:start","x-rect-multi-mask:show"]},{trigger:"mask:dragstart",action:["x-rect-multi-mask:moveStart"]}],processing:[{trigger:"mousemove",isEnable:function(e){return!m3(e)},action:["x-rect-multi-mask:resize"]},{trigger:"multi-mask:change",action:"element-range-highlight:highlight"},{trigger:"mask:drag",action:["x-rect-multi-mask:move"]}],end:[{trigger:"mouseup",action:["x-rect-multi-mask:end"]},{trigger:"mask:dragend",action:["x-rect-multi-mask:moveEnd"]}],rollback:[{trigger:"dblclick",action:["x-rect-multi-mask:clear","cursor:crosshair"]},{trigger:"multi-mask:clearAll",action:["element-range-highlight:clear"]},{trigger:"multi-mask:clearSingle",action:["element-range-highlight:highlight"]}]});Zn("element-single-selected",{start:[{trigger:"element:click",action:"element-single-selected:toggle"}]});Zn("legend-filter",{showEnable:[{trigger:"legend-item:mouseenter",action:["cursor:pointer","list-radio:show"]},{trigger:"legend-item:mouseleave",action:["cursor:default","list-radio:hide"]}],start:[{trigger:"legend-item:click",isEnable:function(e){return!e.isInShape("legend-item-radio")},action:["legend-item-highlight:reset","element-highlight:reset","list-unchecked:toggle","data-filter:filter","list-radio:show"]},{trigger:"legend-item-radio:mouseenter",action:["list-radio:showTip"]},{trigger:"legend-item-radio:mouseleave",action:["list-radio:hideTip"]},{trigger:"legend-item-radio:click",action:["list-focus:toggle","data-filter:filter","list-radio:show"]}]});Zn("continuous-filter",{start:[{trigger:"legend:valuechanged",action:"data-filter:filter"}]});Zn("continuous-visible-filter",{start:[{trigger:"legend:valuechanged",action:"element-filter:filter"}]});Zn("legend-visible-filter",{showEnable:[{trigger:"legend-item:mouseenter",action:"cursor:pointer"},{trigger:"legend-item:mouseleave",action:"cursor:default"}],start:[{trigger:"legend-item:click",action:["legend-item-highlight:reset","element-highlight:reset","list-unchecked:toggle","element-filter:filter"]}]});Zn("active-region",{start:[{trigger:"plot:mousemove",action:"active-region:show"}],end:[{trigger:"plot:mouseleave",action:"active-region:hide"}]});Zn("axis-description",{start:[{trigger:"axis-description:mousemove",action:"axis-description:show"}],end:[{trigger:"axis-description:mouseleave",action:"axis-description:hide"}]});function TW(e){return e.gEvent.preventDefault(),e.gEvent.originalEvent.deltaY>0}Zn("view-zoom",{start:[{trigger:"plot:mousewheel",isEnable:function(e){return TW(e.event)},action:"scale-zoom:zoomOut",throttle:{wait:100,leading:!0,trailing:!1}},{trigger:"plot:mousewheel",isEnable:function(e){return!TW(e.event)},action:"scale-zoom:zoomIn",throttle:{wait:100,leading:!0,trailing:!1}}]});Zn("sibling-tooltip",{start:[{trigger:"plot:mousemove",action:"sibling-tooltip:show"}],end:[{trigger:"plot:mouseleave",action:"sibling-tooltip:hide"}]});Zn("plot-mousewheel-scroll",{start:[{trigger:"plot:mousewheel",action:"mousewheel-scroll:scroll"}]});var Xc=["type","alias","tickCount","tickInterval","min","max","nice","minLimit","maxLimit","range","tickMethod","base","exponent","mask","sync"],Zd;(function(e){e.ERROR="error",e.WARN="warn",e.INFO="log"})(Zd||(Zd={}));var qKt="AntV/G2Plot";function KKt(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=0;return"".concat(qKt,": ").concat(e.replace(/%s/g,function(){return"".concat(t[n++])}))}function Sg(e,t,r){for(var n=[],i=3;i<arguments.length;i++)n[i-3]=arguments[i];t||console[e](KKt.apply(void 0,on([r],n,!1)))}function Ea(e,t){var r={};return e!==null&&typeof e=="object"&&t.forEach(function(n){var i=e[n];i!==void 0&&(r[n]=i)}),r}function vk(e,t){if(!e)return{};var r=e.filter(function(a){var o=xt(a,[t]);return Rn(o)&&!isNaN(o)}),n=r.every(function(a){return xt(a,[t])>=0}),i=r.every(function(a){return xt(a,[t])<=0});return n?{min:0}:i?{max:0}:{}}function Bit(e,t,r,n,i){if(i===void 0&&(i=[]),!Array.isArray(e))return{nodes:[],links:[]};var a=[],o={},s=-1;return e.forEach(function(l){var u=l[t],c=l[r],f=l[n],d=Ea(l,i);o[u]||(o[u]=$({id:++s,name:u},d)),o[c]||(o[c]=$({id:++s,name:c},d)),a.push($({source:o[u].id,target:o[c].id,value:f},d))}),{nodes:Object.values(o).sort(function(l,u){return l.id-u.id}),links:a}}function hb(e,t){var r=Al(e,function(n){var i=n[t];return i===null||typeof i=="number"&&!isNaN(i)});return Sg(Zd.WARN,r.length===e.length,"illegal data existed in chart data."),r}var QKt=5,JKt={}.toString,Nit=function(e,t){return JKt.call(e)==="[object "+t+"]"},tQt=function(e){return Nit(e,"Array")},eQt=function(e){return typeof e=="object"&&e!==null},AW=function(e){if(!eQt(e)||!Nit(e,"Object"))return!1;for(var t=e;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t},kit=function(e,t,r,n){r=r||0,n=n||QKt;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var a=t[i];a?AW(a)?(AW(e[i])||(e[i]={}),r<n?kit(e[i],a,r+1,n):e[i]=t[i]):tQt(a)?(e[i]=[],e[i]=e[i].concat(a)):e[i]=a:e[i]=a}},me=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];for(var n=0;n<t.length;n+=1)kit(e,t[n]);return e};function JF(e){if(!e)return{width:0,height:0};var t=getComputedStyle(e);return{width:(e.clientWidth||parseInt(t.width,10))-parseInt(t.paddingLeft,10)-parseInt(t.paddingRight,10),height:(e.clientHeight||parseInt(t.height,10))-parseInt(t.paddingTop,10)-parseInt(t.paddingBottom,10)}}function zn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(r){return e.reduce(function(n,i){return i(n)},r)}}function vu(e,t){return e.geometries.find(function(r){return r.type===t})}function $R(e){return du(e.geometries,function(t,r){return t.concat(r.elements)},[])}function qC(e){return xt(e,["views","length"],0)<=0?$R(e):du(e.views,function(t,r){return t.concat(qC(r))},$R(e))}function rQt(e){return xt(e,["views","length"],0)<=0?e.geometries:du(e.views,function(t,r){return t.concat(r.geometries)},e.geometries)}function MW(e){if(!e)return e;var t=e.match(/(([A-Z]{0,1}[a-z]*[^A-Z])|([A-Z]{1}))/g);return t.map(function(r){return r.toLowerCase()}).join("-")}function Cl(e){if(!ad(e,"Object"))return e;var t=$({},e);return t.formatter&&!t.content&&(t.content=t.formatter),t}var CP;function nQt(){return CP||(CP=document.createElement("canvas").getContext("2d")),CP}D_(function(e,t){t===void 0&&(t={});var r=t.fontSize,n=t.fontFamily,i=n===void 0?"sans-serif":n,a=t.fontWeight,o=t.fontStyle,s=t.fontVariant,l=nQt();l.font=[o,a,s,"".concat(r,"px"),i].join(" ");var u=l.measureText(en(e)?e:"");return u.width},function(e,t){return t===void 0&&(t={}),on([e],Bb(t),!0).join("")});function f_(e){return typeof e=="number"&&!isNaN(e)}function iQt(e,t,r){var n=Math.min(t,r),i=Math.max(t,r);return e>=n&&e<=i}function s0(e){if(Rn(e))return[e,e,e,e];if(Fe(e)){var t=e.length;if(t===1)return[e[0],e[0],e[0],e[0]];if(t===2)return[e[0],e[1],e[0],e[1]];if(t===3)return[e[0],e[1],e[2],e[1]];if(t===4)return e}return[0,0,0,0]}function C3(e,t,r){t===void 0&&(t="bottom"),r===void 0&&(r=25);var n=s0(e),i=[t.startsWith("top")?r:0,t.startsWith("right")?r:0,t.startsWith("bottom")?r:0,t.startsWith("left")?r:0];return[n[0]+i[0],n[1]+i[1],n[2]+i[2],n[3]+i[3]]}function gk(e){var t=e.map(function(n){return s0(n)}),r=[0,0,0,0];return t.length>0&&(r=r.map(function(n,i){return t.forEach(function(a,o){n+=t[o][i]}),n})),r}function aQt(e,t){var r=[];if(e.length){r.push(["M",e[0].x,e[0].y]);for(var n=1,i=e.length;n<i;n+=1){var a=e[n];r.push(["L",a.x,a.y])}t&&r.push(["Z"])}return r}var oQt=function(e,t,r,n){var i=[],a,o,s=!!n,l,u;if(s){l=[1/0,1/0],u=[-1/0,-1/0];for(var c=0,f=e.length;c<f;c++){var d=e[c];l=$l([0,0],l,d),u=Hl([0,0],u,d)}l=$l([0,0],l,n[0]),u=Hl([0,0],u,n[1])}for(var c=0,v=e.length;c<v;c++){var d=e[c];if(r)a=e[c?c-1:v-1],o=e[(c+1)%v];else if(c===0||c===v-1){i.push(d);continue}else a=e[c-1],o=e[c+1];var g=[0,0];g=fg(g,o,a),g=oc(g,g,t);var x=Xx(d,a),w=Xx(d,o),S=x+w;S!==0&&(x/=S,w/=S);var M=oc([0,0],g,-x),R=oc([0,0],g,w),I=Vl([0,0],d,M),P=Vl([0,0],d,R);s&&(I=Hl([0,0],I,l),I=$l([0,0],I,u),P=Hl([0,0],P,l),P=$l([0,0],P,u)),i.push(I),i.push(P)}return r&&i.push(i.shift()),i};function sQt(e,t,r){for(var n=!!t,i=[],a=0,o=e.length;a<o;a+=2)i.push([e[a],e[a+1]]);for(var s=oQt(i,.4,n,r),l=i.length,u=[],c,f,d,a=0;a<l-1;a++)c=s[a*2],f=s[a*2+1],d=i[a+1],u.push(["C",c[0],c[1],f[0],f[1],d[0],d[1]]);return n&&(c=s[l],f=s[l+1],d=i[0],u.push(["C",c[0],c[1],f[0],f[1],d[0],d[1]])),u}function lQt(e,t,r){var n=[],i=e[0],a=null;if(e.length<=2)return aQt(e,t);for(var o=0,s=e.length;o<s;o++){var l=e[o];(!a||!(a.x===l.x&&a.y===l.y))&&(n.push(l.x),n.push(l.y),a=l)}var u=r||[[0,0],[1,1]],c=sQt(n,t,u);return c.unshift(["M",i.x,i.y]),c}function zit(e){var t={overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis",display:"flex",justifyContent:"center",alignItems:"center"},r=["stroke","lineWidth","shadowColor","strokeOpacity","shadowBlur","shadowOffsetX","shadowOffsetY","fill"];xt(e,"fill")&&(t.color=e.fill);var n=Ea(e,r),i=n.shadowColor,a=n.shadowBlur,o=a===void 0?0:a,s=n.shadowOffsetX,l=s===void 0?0:s,u=n.shadowOffsetY,c=u===void 0?0:u;t["text-shadow"]="".concat([i,"".concat(l,"px"),"".concat(c,"px"),"".concat(o,"px")].join(" "));var f=Ea(e,r),d=f.stroke,v=f.lineWidth,g=v===void 0?0:v;return t["-webkit-text-stroke"]="".concat(["".concat(g,"px"),d].join(" ")),ft(e,function(x,w){["fontSize"].includes(w)&&Rn(x)?t[MW(w)]="".concat(x,"px"):w&&!r.includes(w)&&(t[MW(w)]="".concat(x))}),t}function Uit(e,t){e.style["pointer-events"]="none",ft(t,function(r,n){n&&r&&(e.style[n]=r)})}var S3=function(e,t,r){var n=t.statistic,i=t.plotType,a=n.title,o=n.content;[a,o].forEach(function(s,l){if(s){var u="";l===0?u=o?"translate(-50%, -100%)":"translate(-50%, -50%)":u=a?"translate(-50%, 0)":"translate(-50%, -50%)";var c=Rr(s.style)?s.style(r):s.style;e.annotation().html($({position:["50%","50%"],html:function(f,d){var v=d.getCoordinate(),g=0;if(i==="pie"||i==="ring-progress")g=v.getRadius()*v.innerRadius*2;else if(i==="liquid"){var x=xt(d.geometries,[0,"elements",0,"shape"]);if(x){var w=x.find(function(I){return I.get("name")==="wrap"}),S=w.getCanvasBBox().width;g=S}}else g||(g=v.getWidth());Uit(f,$({width:"".concat(g,"px"),transform:u},zit(c)));var M=d.getData();if(s.customHtml)return s.customHtml(f,d,r,M);var R=s.content;return s.formatter&&(R=s.formatter(r,M)),R?en(R)?R:"".concat(R):"<div></div>"},key:"".concat(l===0?"top":"bottom","-statistic")},Ea(s,["offsetX","offsetY","rotate","style","formatter"])))}})},uQt=function(e,t,r){var n=t.statistic,i=n.title,a=n.content;[i,a].forEach(function(o){if(o){var s=Rr(o.style)?o.style(r):o.style;e.annotation().html($({position:["50%","100%"],html:function(l,u){var c=u.getCoordinate(),f=u.views[0].getCoordinate(),d=f.getCenter(),v=f.getRadius(),g=Math.max(Math.sin(f.startAngle),Math.sin(f.endAngle))*v,x=d.y+g-c.y.start-parseFloat(xt(s,"fontSize",0)),w=c.getRadius()*c.innerRadius*2;Uit(l,$({width:"".concat(w,"px"),transform:"translate(-50%, ".concat(x,"px)")},zit(s)));var S=u.getData();if(o.customHtml)return o.customHtml(l,u,r,S);var M=o.content;return o.formatter&&(M=o.formatter(r,S)),M?en(M)?M:"".concat(M):"<div></div>"}},Ea(o,["offsetX","offsetY","rotate","style","formatter"])))}})};function $it(e,t){return t?du(t,function(r,n,i){return r.replace(new RegExp("{\\s*".concat(i,"\\s*}"),"g"),n)},e):e}function _i(e,t){return e.views.find(function(r){return r.id===t})}function zw(e){var t=e.parent;return t?t.views:[]}function RW(e){return zw(e).filter(function(t){return t!==e})}function g2(e,t,r){r===void 0&&(r=e.geometries),typeof t=="boolean"?e.animate(t):e.animate(!0),ft(r,function(n){var i;Rr(t)?i=t(n.type||n.shapeType,n)||!0:i=t,n.animate(i)})}function T3(){return typeof window=="object"?window==null?void 0:window.devicePixelRatio:2}function mk(e,t){t===void 0&&(t=e);var r=document.createElement("canvas"),n=T3();r.width=e*n,r.height=t*n,r.style.width="".concat(e,"px"),r.style.height="".concat(t,"px");var i=r.getContext("2d");return i.scale(n,n),r}function yk(e,t,r,n){n===void 0&&(n=r);var i=t.backgroundColor,a=t.opacity;e.globalAlpha=a,e.fillStyle=i,e.beginPath(),e.fillRect(0,0,r,n),e.closePath()}function Hit(e,t,r){var n=e+t;return r?n*2:n}function Vit(e,t){var r=t?[[e*.25,e*.25],[e*.75,e*.75]]:[[e*.5,e*.5]];return r}function _k(e,t){var r=t*Math.PI/180,n={a:Math.cos(r)*(1/e),b:Math.sin(r)*(1/e),c:-Math.sin(r)*(1/e),d:Math.cos(r)*(1/e),e:0,f:0};return n}var cQt={size:6,padding:2,backgroundColor:"transparent",opacity:1,rotation:0,fill:"#fff",fillOpacity:.5,stroke:"transparent",lineWidth:0,isStagger:!0};function hQt(e,t,r,n){var i=t.size,a=t.fill,o=t.lineWidth,s=t.stroke,l=t.fillOpacity;e.beginPath(),e.globalAlpha=l,e.fillStyle=a,e.strokeStyle=s,e.lineWidth=o,e.arc(r,n,i/2,0,2*Math.PI,!1),e.fill(),o&&e.stroke(),e.closePath()}function fQt(e){var t=me({},cQt,e),r=t.size,n=t.padding,i=t.isStagger,a=t.rotation,o=Hit(r,n,i),s=Vit(o,i),l=mk(o,o),u=l.getContext("2d");yk(u,t,o);for(var c=0,f=s;c<f.length;c++){var d=f[c],v=d[0],g=d[1];hQt(u,t,v,g)}var x=u.createPattern(l,"repeat");if(x){var w=T3(),S=_k(w,a);x.setTransform(S)}return x}var dQt={rotation:45,spacing:5,opacity:1,backgroundColor:"transparent",strokeOpacity:.5,stroke:"#fff",lineWidth:2};function pQt(e,t,r){var n=t.stroke,i=t.lineWidth,a=t.strokeOpacity,o=new Path2D(r);e.globalAlpha=a,e.lineCap="square",e.strokeStyle=i?n:"transparent",e.lineWidth=i,e.stroke(o)}function vQt(e){var t=me({},dQt,e),r=t.spacing,n=t.rotation,i=t.lineWidth,a=r+i||1,o=r+i||1,s=`
            M 0 0 L `.concat(a,` 0
            M 0 `).concat(o," L ").concat(a," ").concat(o,`
            `),l=mk(a,o),u=l.getContext("2d");yk(u,t,a,o),pQt(u,t,s);var c=u.createPattern(l,"repeat");if(c){var f=T3(),d=_k(f,n);c.setTransform(d)}return c}var gQt={size:6,padding:1,isStagger:!0,backgroundColor:"transparent",opacity:1,rotation:0,fill:"#fff",fillOpacity:.5,stroke:"transparent",lineWidth:0};function mQt(e,t,r,n){var i=t.stroke,a=t.size,o=t.fill,s=t.lineWidth,l=t.fillOpacity;e.globalAlpha=l,e.strokeStyle=i,e.lineWidth=s,e.fillStyle=o,e.strokeRect(r-a/2,n-a/2,a,a),e.fillRect(r-a/2,n-a/2,a,a)}function yQt(e){var t=me({},gQt,e),r=t.size,n=t.padding,i=t.isStagger,a=t.rotation,o=Hit(r,n,i),s=Vit(o,i),l=mk(o,o),u=l.getContext("2d");yk(u,t,o);for(var c=0,f=s;c<f.length;c++){var d=f[c],v=d[0],g=d[1];mQt(u,t,v,g)}var x=u.createPattern(l,"repeat");if(x){var w=T3(),S=_k(w,a);x.setTransform(S)}return x}function _Qt(e){var t=e.type,r=e.cfg,n;switch(t){case"dot":n=fQt(r);break;case"line":n=vQt(r);break;case"square":n=yQt(r);break}return n}function Jh(e){var t=this;return function(r){var n,i=r.options,a=r.chart,o=i.pattern;if(!o)return r;var s=function(l){for(var u,c,f,d=[],v=1;v<arguments.length;v++)d[v-1]=arguments[v];var g=a.getTheme().defaultColor,x=g,w=(c=(u=a.geometries)===null||u===void 0?void 0:u[0])===null||c===void 0?void 0:c.getAttribute("color");if(w){var S=w.getFields()[0],M=xt(l,S);x=ih.getMappingValue(w,M,((f=w.values)===null||f===void 0?void 0:f[0])||g)}var R=o;typeof o=="function"&&(R=o.call(t,l,x)),R instanceof CanvasPattern||(R=_Qt(me({},{cfg:{backgroundColor:x}},R)));var I=i[e];return $($({},typeof I=="function"?I.call.apply(I,on([t,l],d,!1)):I||{}),{fill:R||x})};return me({},r,{options:(n={},n[e]=s,n)})}}function Gb(e){var t=e.chart,r=e.options,n=r.legend,i=r.colorField,a=r.seriesField;return n===!1?t.legend(!1):(i||a)&&t.legend(i||a,n),e}function al(e){var t=e.chart,r=e.options,n=r.tooltip;return n!==void 0&&t.tooltip(n),e}function xo(e){var t=e.chart,r=e.options,n=r.interactions;return ft(n,function(i){i.enable===!1?t.removeInteraction(i.type):t.interaction(i.type,i.cfg||{})}),e}function Ma(e){var t=e.chart,r=e.options,n=r.animation;return g2(t,n),e}function ea(e){var t=e.chart,r=e.options,n=r.theme;return n&&t.theme(n),e}function S0(e){var t=e.chart,r=e.options,n=r.state;return n&&ft(t.geometries,function(i){i.state(n)}),e}function m2(e){var t=e.chart,r=e.options,n=r.slider;return t.option("slider",n),e}function xk(e){var t=e.chart,r=e.options,n=r.scrollbar;return t.option("scrollbar",n),e}function ns(e,t){return function(r){var n=r.chart,i=r.options,a={};return ft(e,function(o,s){a[s]=Ea(o,Xc)}),a=me({},t,i.meta,a),n.scale(a),r}}function Ao(e){return function(t){var r=t.chart,n=t.options,i=r.getController("annotation");return ft(on(on([],n.annotations||[],!0),e||[],!0),function(a){i.annotation(a)}),t}}function d_(e){var t=e.chart,r=e.options,n=r.yAxis,i=r.limitInPlot,a=i;return Xi(n)&&ze(i)&&(Object.values(Ea(n,["min","max","minLimit","maxLimit"])).some(function(o){return!ze(o)})?a=!0:a=!1),t.limitInPlot=a,e}function Git(e){return e===void 0&&(e="rect"),function(t){var r=t.chart,n=t.options,i=n.coordinate,a=Array.from(i||[]).map(function(o){return o.type==="reflectX"?["reflect","x"]:o.type==="reflectY"?["reflect","y"]:o.type==="transpose"?["transpose"]:null}).filter(function(o){return!!o});return a.length!==0&&r.coordinate({type:e,actions:a}),t}}var xQt={locale:"en-US"},yM={};function Wit(e,t){yM[e]=t}function A3(e){return{get:function(t,r){return $it(xt(yM[e],t)||xt(yM[xQt.locale],t)||xt(yM["en-US"],t)||t,r)}}}var bQt={locale:"en-US",general:{increase:"Increase",decrease:"Decrease",root:"Root"},statistic:{total:"Total"},conversionTag:{label:"Rate"},legend:{},tooltip:{},slider:{},scrollbar:{},waterfall:{total:"Total"}},EQt={locale:"zh-CN",general:{increase:"增加",decrease:"减少",root:"初始"},statistic:{total:"总计"},conversionTag:{label:"转化率"},legend:{},tooltip:{},slider:{},scrollbar:{},waterfall:{total:"总计"}};function sd(e,t){if(e===!1)return{fields:!1};var r=xt(e,"fields"),n=xt(e,"formatter");return n&&!r&&(r=t),{fields:r,formatter:n}}function TA(e,t){var r=e.type,n=e.xField,i=e.yField,a=e.colorField,o=e.shapeField,s=e.sizeField,l=e.styleField,u=e.rawFields,c=[];if(u=(Rr(u)?u(r,t):u)||[],t==="color")c=on([a||n],u,!0);else if(t==="shape")c=on([o||n],u,!0);else if(t==="size")c=on([s||n],u,!0);else{c=on([n,i,a,o,s,l],u,!0);var f=["x","y","color","shape","size","style"].indexOf(t),d=c[f];c.splice(f,1),c.unshift(d)}var v=xg(c.filter(function(x){return!!x})),g=r==="line"&&[n,i].includes(v.join("*"))?"":v.join("*");return{mappingFields:v,tileMappingField:g}}function J1(e,t){if(t)return function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i={};return e.forEach(function(a,o){i[a]=r[o]}),delete i.undefined,t(i)}}function ch(e){var t=e.chart,r=e.options,n=r.type,i=r.args,a=r.mapping,o=r.xField,s=r.yField,l=r.colorField,u=r.shapeField,c=r.sizeField,f=r.tooltipFields,d=r.label,v=r.state,g=r.customInfo,x=r.customMappingField;if(!a)return e;var w=a.color,S=a.shape,M=a.size,R=a.style,I=a.tooltip,P=t[n](i).position("".concat(o,"*").concat(s));if(en(w))l?P.color(l,w):P.color(w);else if(Rr(w)){var k=TA(r,"color"),z=k.mappingFields,G=k.tileMappingField;P.color(x||G,J1(z,w))}else l&&P.color(l,w);if(en(S))u?P.shape(u,[S]):P.shape(S);else if(Rr(S)){var J=TA(r,"shape"),z=J.mappingFields,G=J.tileMappingField;P.shape(G,J1(z,S))}else u&&P.shape(u,S);if(Rn(M))c?P.size(c,M):P.size(M);else if(Rr(M)){var Z=TA(r,"size"),z=Z.mappingFields,G=Z.tileMappingField;P.size(G,J1(z,M))}else c&&P.size(c,M);if(Rr(R)){var X=TA(r,"style"),z=X.mappingFields,G=X.tileMappingField;P.style(G,J1(z,R))}else Xi(R)&&P.style(R);if(f===!1?P.tooltip(!1):cc(f)||P.tooltip(f.join("*"),J1(f,I)),d===!1)P.label(!1);else if(d){var et=d.callback,at=d.fields,wt=fi(d,["callback","fields"]);P.label({fields:at||[s],callback:et,cfg:Cl(wt)})}return v&&P.state(v),g&&P.customInfo(g),[o,s].filter(function(Tt){return Tt!==l}).forEach(function(Tt){t.legend(Tt,!1)}),$($({},e),{ext:{geometry:P}})}function M3(e){var t=e.options,r=t.area,n=t.xField,i=t.yField,a=t.seriesField,o=t.smooth,s=t.tooltip,l=t.useDeferredLabel,u=sd(s,[n,i,a]),c=u.fields,f=u.formatter;return r?ch(me({},e,{options:{type:"area",colorField:a,tooltipFields:c,mapping:Tr({shape:o?"smooth":"area",tooltip:f},r),args:{useDeferredLabel:l}}})):e}function Xit(e){var t=e.options,r=t.edge,n=t.xField,i=t.yField,a=t.seriesField,o=t.tooltip,s=t.useDeferredLabel,l=sd(o,[n,i,a]),u=l.fields,c=l.formatter;return r?ch(me({},e,{options:{type:"edge",colorField:a,tooltipFields:u,mapping:$({tooltip:c},r),args:{useDeferredLabel:s}}})):e}function wQt(e){var t=e.chart,r=e.options,n=e.ext,i=r.seriesField,a=r.isGroup,o=r.isStack,s=r.marginRatio,l=r.widthRatio,u=r.groupField,c=r.theme,f=[];if(i&&(a&&f.push({type:"dodge",dodgeBy:u||i,marginRatio:s}),o&&f.push({type:"stack",marginRatio:s})),f.length&&(n!=null&&n.geometry)){var d=n==null?void 0:n.geometry;d.adjust(f)}return ze(l)||t.theme(me({},Xi(c)?c:iC(c),{columnWidthRatio:l})),e}function gu(e){var t=e.options,r=t.xField,n=t.yField,i=t.interval,a=t.seriesField,o=t.tooltip,s=t.minColumnWidth,l=t.maxColumnWidth,u=t.columnBackground,c=t.dodgePadding,f=t.intervalPadding,d=t.useDeferredLabel,v=sd(o,[r,n,a]),g=v.fields,x=v.formatter,w=(i?ch(me({},e,{options:{type:"interval",colorField:a,tooltipFields:g,mapping:$({tooltip:x},i),args:{dodgePadding:c,intervalPadding:f,minColumnWidth:s,maxColumnWidth:l,background:u,useDeferredLabel:d}}})):e).ext;return wQt($($({},e),{ext:w}))}function Wb(e){var t=e.options,r=t.line,n=t.stepType,i=t.xField,a=t.yField,o=t.seriesField,s=t.smooth,l=t.connectNulls,u=t.tooltip,c=t.useDeferredLabel,f=sd(u,[i,a,o]),d=f.fields,v=f.formatter;return r?ch(me({},e,{options:{type:"line",colorField:o,tooltipFields:d,mapping:Tr({shape:n||(s?"smooth":"line"),tooltip:v},r),args:{connectNulls:l,useDeferredLabel:c}}})):e}function tf(e){var t=e.options,r=t.point,n=t.xField,i=t.yField,a=t.seriesField,o=t.sizeField,s=t.shapeField,l=t.tooltip,u=t.useDeferredLabel,c=sd(l,[n,i,a,o,s]),f=c.fields,d=c.formatter;return r?ch(me({},e,{options:{type:"point",colorField:a,shapeField:s,tooltipFields:f,mapping:$({tooltip:d},r),args:{useDeferredLabel:u}}})):e}function R3(e){var t=e.options,r=t.polygon,n=t.xField,i=t.yField,a=t.seriesField,o=t.tooltip,s=t.useDeferredLabel,l=sd(o,[n,i,a]),u=l.fields,c=l.formatter;return r?ch(me({},e,{options:{type:"polygon",colorField:a,tooltipFields:u,mapping:$({tooltip:c},r),args:{useDeferredLabel:s}}})):e}function bk(e){var t=e.options,r=t.schema,n=t.xField,i=t.yField,a=t.seriesField,o=t.tooltip,s=t.useDeferredLabel,l=sd(o,[n,i,a]),u=l.fields,c=l.formatter;return r?ch(me({},e,{options:{type:"schema",colorField:a,tooltipFields:u,mapping:$({tooltip:c},r),args:{useDeferredLabel:s}}})):e}function CQt(e){var t=e.options,r=t.violin,n=t.xField,i=t.yField,a=t.seriesField,o=t.sizeField,s=t.tooltip,l=sd(s,[n,i,a,o]),u=l.fields,c=l.formatter;return r?ch(me({},e,{options:{type:"violin",colorField:a,tooltipFields:u,mapping:$({tooltip:c},r)}})):e}var Xy={},Km={},jit={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=1,r=function(){return"".concat(t++)};e.default=r})(jit);var I3={},L3={},Ek={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:60,a=null;return function(){for(var o=this,s=arguments.length,l=new Array(s),u=0;u<s;u++)l[u]=arguments[u];clearTimeout(a),a=setTimeout(function(){n.apply(o,l)},i)}};e.default=t})(Ek);var qp={};Object.defineProperty(qp,"__esModule",{value:!0});qp.SizeSensorId=qp.SensorTabIndex=qp.SensorClassName=void 0;var SQt="size-sensor-id";qp.SizeSensorId=SQt;var TQt="size-sensor-object";qp.SensorClassName=TQt;var AQt="-1";qp.SensorTabIndex=AQt;Object.defineProperty(L3,"__esModule",{value:!0});L3.createSensor=void 0;var MQt=RQt(Ek),SP=qp;function RQt(e){return e&&e.__esModule?e:{default:e}}var IQt=function(t,r){var n=void 0,i=[],a=function(){getComputedStyle(t).position==="static"&&(t.style.position="relative");var f=document.createElement("object");return f.onload=function(){f.contentDocument.defaultView.addEventListener("resize",o),o()},f.style.display="block",f.style.position="absolute",f.style.top="0",f.style.left="0",f.style.height="100%",f.style.width="100%",f.style.overflow="hidden",f.style.pointerEvents="none",f.style.zIndex="-1",f.style.opacity="0",f.setAttribute("class",SP.SensorClassName),f.setAttribute("tabindex",SP.SensorTabIndex),f.type="text/html",t.appendChild(f),f.data="about:blank",f},o=(0,MQt.default)(function(){i.forEach(function(c){c(t)})}),s=function(f){n||(n=a()),i.indexOf(f)===-1&&i.push(f)},l=function(){n&&n.parentNode&&(n.contentDocument&&n.contentDocument.defaultView.removeEventListener("resize",o),n.parentNode.removeChild(n),t.removeAttribute(SP.SizeSensorId),n=void 0,i=[],r&&r())},u=function(f){var d=i.indexOf(f);d!==-1&&i.splice(d,1),i.length===0&&n&&l()};return{element:t,bind:s,destroy:l,unbind:u}};L3.createSensor=IQt;var O3={};Object.defineProperty(O3,"__esModule",{value:!0});O3.createSensor=void 0;var LQt=qp,OQt=PQt(Ek);function PQt(e){return e&&e.__esModule?e:{default:e}}var DQt=function(t,r){var n=void 0,i=[],a=(0,OQt.default)(function(){i.forEach(function(c){c(t)})}),o=function(){var f=new ResizeObserver(a);return f.observe(t),a(),f},s=function(f){n||(n=o()),i.indexOf(f)===-1&&i.push(f)},l=function(){n.disconnect(),i=[],n=void 0,t.removeAttribute(LQt.SizeSensorId),r&&r()},u=function(f){var d=i.indexOf(f);d!==-1&&i.splice(d,1),i.length===0&&n&&l()};return{element:t,bind:s,destroy:l,unbind:u}};O3.createSensor=DQt;Object.defineProperty(I3,"__esModule",{value:!0});I3.createSensor=void 0;var FQt=L3,BQt=O3,NQt=typeof ResizeObserver<"u"?BQt.createSensor:FQt.createSensor;I3.createSensor=NQt;Object.defineProperty(Km,"__esModule",{value:!0});Km.removeSensor=Km.getSensor=Km.Sensors=void 0;var kQt=UQt(jit),zQt=I3,tB=qp;function UQt(e){return e&&e.__esModule?e:{default:e}}var Rx={};Km.Sensors=Rx;function Yit(e){e&&Rx[e]&&delete Rx[e]}var $Qt=function(t){var r=t.getAttribute(tB.SizeSensorId);if(r&&Rx[r])return Rx[r];var n=(0,kQt.default)();t.setAttribute(tB.SizeSensorId,n);var i=(0,zQt.createSensor)(t,function(){return Yit(n)});return Rx[n]=i,i};Km.getSensor=$Qt;var HQt=function(t){var r=t.element.getAttribute(tB.SizeSensorId);t.destroy(),Yit(r)};Km.removeSensor=HQt;Object.defineProperty(Xy,"__esModule",{value:!0});Xy.ver=Xy.clear=Zit=Xy.bind=void 0;var eB=Km,VQt=function(t,r){var n=(0,eB.getSensor)(t);return n.bind(r),function(){n.unbind(r)}},Zit=Xy.bind=VQt,GQt=function(t){var r=(0,eB.getSensor)(t);(0,eB.removeSensor)(r)};Xy.clear=GQt;var WQt="1.0.2";Xy.ver=WQt;var IW="data-chart-source-type",qit=["padding","appendPadding","renderer","pixelRatio","syncViewPadding","supportCSSTransform","limitInPlot"],ti=function(e){$t(t,e);function t(r,n){var i=e.call(this)||this;return i.container=typeof r=="string"?document.getElementById(r):r,i.options=me({},i.getDefaultOptions(),n),i.createG2(),i.bindEvents(),i}return t.getDefaultOptions=function(){return{renderer:"canvas",xAxis:{nice:!0,label:{autoRotate:!1,autoHide:{type:"equidistance",cfg:{minGap:6}}}},yAxis:{nice:!0,label:{autoHide:!0,autoRotate:!1}},animation:!0}},t.prototype.createG2=function(){var r=this.options,n=r.width,i=r.height,a=r.defaultInteractions;this.chart=new vjt($($($($({container:this.container,autoFit:!1},this.getChartSize(n,i)),{localRefresh:!1}),Ea(this.options,qit)),{defaultInteractions:a})),this.container.setAttribute(IW,"G2Plot")},t.prototype.getChartSize=function(r,n){var i=JF(this.container);return{width:r||i.width||400,height:n||i.height||400}},t.prototype.bindEvents=function(){var r=this;this.chart&&this.chart.on("*",function(n){n!=null&&n.type&&r.emit(n.type,n)})},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.render=function(){this.chart.clear(),this.chart.options={data:[],animate:!0},this.chart.views=[],this.execAdaptor(),this.chart.render(),this.bindSizeSensor()},t.prototype.update=function(r){this.updateOption(r),this.render()},t.prototype.updateOption=function(r){this.options=me({},this.options,r)},t.prototype.setState=function(r,n,i){i===void 0&&(i=!0);var a=qC(this.chart);ft(a,function(o){n(o.getData())&&o.setState(r,i)})},t.prototype.getStates=function(){var r=qC(this.chart),n=[];return ft(r,function(i){var a=i.getData(),o=i.getStates();ft(o,function(s){n.push({data:a,state:s,geometry:i.geometry,element:i})})}),n},t.prototype.changeData=function(r){this.update({data:r})},t.prototype.changeSize=function(r,n){this.chart.changeSize(r,n)},t.prototype.addAnnotations=function(r,n){n=n||this.chart;var i=on([],r,!0),a=n.getController("annotation"),o=a.getComponents().map(function(u){return u.extra});a.clear(!0);for(var s=function(u){var c=o[u],f=i.findIndex(function(d){return d.id&&d.id===c.id});f!==-1&&(c=me({},c,i[f]),i.splice(f,1)),a.annotation(c)},l=0;l<o.length;l++)s(l);i.forEach(function(u){return a.annotation(u)}),n.render(!0)},t.prototype.removeAnnotations=function(r){var n=this.chart.getController("annotation"),i=n.getComponents().map(function(s){return s.extra});n.clear(!0);for(var a=function(s){var l=i[s];r.find(function(u){return u.id&&u.id===l.id})||n.annotation(l)},o=0;o<i.length;o++)a(o);this.chart.render(!0)},t.prototype.destroy=function(){this.unbindSizeSensor(),this.chart.destroy(),this.off(),this.container.removeAttribute(IW)},t.prototype.execAdaptor=function(){var r=this.getSchemaAdaptor(),n=this.options,i=n.padding,a=n.appendPadding;this.chart.padding=i,this.chart.appendPadding=a,r({chart:this.chart,options:this.options})},t.prototype.triggerResize=function(){this.chart.forceFit()},t.prototype.bindSizeSensor=function(){var r=this;if(!this.unbind){var n=this.options.autoFit,i=n===void 0?!0:n;i&&(this.unbind=Zit(this.container,function(){var a=JF(r.container),o=a.width,s=a.height;(o!==r.chart.width||s!==r.chart.height)&&r.triggerResize()}))}},t.prototype.unbindSizeSensor=function(){this.unbind&&(this.unbind(),this.unbind=void 0)},t}(F_);function Kit(e,t,r,n){var i=du(e,function(a,o){var s=o[r],l=a.has(s)?a.get(s):0,u=o[t];return l=f_(u)?l+u:l,a.set(s,l),a},new Map);return fo(e,function(a){var o,s=a[t],l=a[r],u=f_(s)&&i.get(l)!==0?s/i.get(l):0;return $($({},a),(o={},o[n]=u,o))})}function XQt(e,t,r,n){var i=du(e,function(a,o){var s=du(r,function(c,f){return"".concat(c).concat(o[f])},""),l=a.has(s)?a.get(s):0,u=o[t];return l=f_(u)?l+u:l,a.set(s,l),a},new Map);return fo(e,function(a){var o,s=a[t],l=du(r,function(c,f){return"".concat(c).concat(a[f])},""),u=f_(s)&&i.get(l)!==0?s/i.get(l):0;return $($({},a),(o={},o[n]=u,o))})}function y2(e,t,r,n,i){return i?Kit(e,t,r,n):e}function jQt(e){var t=e.chart,r=e.options,n=r.data,i=r.color,a=r.lineStyle,o=r.lineShape,s=r.point,l=r.area,u=r.seriesField,c=s==null?void 0:s.state,f=l==null?void 0:l.state;t.data(n);var d=me({},e,{options:{shapeField:u,line:{color:i,style:a,shape:o},point:s&&$({color:i,shape:"circle"},s),area:l&&$({color:i},l),label:void 0}}),v=me({},d,{options:{tooltip:!1,state:c}}),g=me({},d,{options:{tooltip:!1,state:f}});return Wb(d),tf(v),M3(g),e}function P3(e){var t,r,n=e.options,i=n.xAxis,a=n.yAxis,o=n.xField,s=n.yField,l=n.data;return zn(ns((t={},t[o]=i,t[s]=a,t),(r={},r[o]={type:"cat"},r[s]=vk(l,s),r)))(e)}function YQt(e){var t=e.chart,r=e.options,n=r.reflect;if(n){var i=n;Fe(i)||(i=[i]);var a=i.map(function(o){return["reflect",o]});t.coordinate({type:"rect",actions:a})}return e}function Qit(e){var t=e.chart,r=e.options,n=r.xAxis,i=r.yAxis,a=r.xField,o=r.yField;return n===!1?t.axis(a,!1):t.axis(a,n),i===!1?t.axis(o,!1):t.axis(o,i),e}function Jit(e){var t=e.chart,r=e.options,n=r.legend,i=r.seriesField;return n&&i?t.legend(i,n):n===!1&&t.legend(!1),e}function ZQt(e){var t=e.chart,r=e.options,n=r.label,i=r.yField,a=vu(t,"line");if(!n)a.label(!1);else{var o=n.fields,s=n.callback,l=fi(n,["fields","callback"]);a.label({fields:o||[i],callback:s,cfg:$({layout:[{type:"limit-in-plot"},{type:"path-adjust-position"},{type:"point-adjust-position"},{type:"limit-in-plot",cfg:{action:"hide"}}]},Cl(l))})}return e}function qQt(e){var t=e.chart,r=e.options,n=r.isStack;return n&&ft(t.geometries,function(i){i.adjust("stack")}),e}function tat(e){return zn(jQt,P3,qQt,ea,YQt,Qit,Jit,al,ZQt,m2,xk,xo,Ma,Ao(),d_)(e)}function KQt(e){var t=e.chart,r=e.options,n=r.data,i=r.areaStyle,a=r.areaShape,o=r.color,s=r.point,l=r.line,u=r.isPercent,c=r.xField,f=r.yField,d=r.tooltip,v=r.seriesField,g=r.startOnZero,x=s==null?void 0:s.state,w=y2(n,f,c,f,u);t.data(w);var S=u?$({formatter:function(P){return{name:P[v]||P[c],value:(Number(P[f])*100).toFixed(2)+"%"}}},d):d,M=me({},e,{options:{area:{color:o,style:i,shape:a},point:s&&$({color:o},s),tooltip:S,label:void 0,args:{startOnZero:g}}}),R={chart:t,options:me({line:{size:2}},ZS(r,["state"]),{line:l&&$({color:o},l),sizeField:v,state:l==null?void 0:l.state,tooltip:!1,label:void 0,args:{startOnZero:g}})},I=me({},M,{options:{tooltip:!1,state:x}});return M3(M),Wb(R),tf(I),e}function QQt(e){var t=e.chart,r=e.options,n=r.label,i=r.yField,a=vu(t,"area");if(!n)a.label(!1);else{var o=n.fields,s=n.callback,l=fi(n,["fields","callback"]);a.label({fields:o||[i],callback:s,cfg:$({layout:[{type:"limit-in-plot"},{type:"path-adjust-position"},{type:"point-adjust-position"},{type:"limit-in-plot",cfg:{action:"hide"}}]},Cl(l))})}return e}function JQt(e){var t=e.chart,r=e.options,n=r.isStack,i=r.isPercent,a=r.seriesField;return(i||n)&&a&&ft(t.geometries,function(o){o.adjust("stack")}),e}function eat(e){return zn(ea,Jh("areaStyle"),Git("rect"),KQt,P3,JQt,Qit,Jit,al,QQt,m2,Ao(),xo,Ma,d_)(e)}var tJt=me({},ti.getDefaultOptions(),{tooltip:{shared:!0,showMarkers:!0,showCrosshairs:!0,crosshairs:{type:"x"}},isStack:!0,line:{},legend:{position:"top-left",radio:{}}}),rat=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="area",r}return t.getDefaultOptions=function(){return tJt},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.changeData=function(r){this.updateOption({data:r});var n=this.options,i=n.isPercent,a=n.xField,o=n.yField,s=this,l=s.chart,u=s.options;P3({chart:l,options:u}),this.chart.changeData(y2(r,o,a,o,i))},t.prototype.getSchemaAdaptor=function(){return eat},t}(ti);const lOe=Object.freeze(Object.defineProperty({__proto__:null,Area:rat},Symbol.toStringTag,{value:"Module"}));var eJt=10,rJt=5,nJt={padding:[8,10],text:"reset",textStyle:{default:{x:0,y:0,fontSize:12,fill:"#333333",cursor:"pointer"}},buttonStyle:{default:{fill:"#f7f7f7",stroke:"#cccccc",cursor:"pointer"},active:{fill:"#e6e6e6"}}},iJt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.buttonGroup=null,r.buttonCfg=$({name:"button"},nJt),r}return t.prototype.getButtonCfg=function(){var r=this.context.view,n=xt(r,["interactions","filter-action","cfg","buttonConfig"]);return me(this.buttonCfg,n,this.cfg)},t.prototype.drawButton=function(){var r=this.getButtonCfg(),n=this.context.view.foregroundGroup.addGroup({name:r.name}),i=this.drawText(n);this.drawBackground(n,i.getBBox()),this.buttonGroup=n},t.prototype.drawText=function(r){var n,i=this.getButtonCfg();return r.addShape({type:"text",name:"button-text",attrs:$({text:i.text},(n=i.textStyle)===null||n===void 0?void 0:n.default)})},t.prototype.drawBackground=function(r,n){var i,a=this.getButtonCfg(),o=s0(a.padding),s=r.addShape({type:"rect",name:"button-rect",attrs:$({x:n.x-o[3],y:n.y-o[0],width:n.width+o[1]+o[3],height:n.height+o[0]+o[2]},(i=a.buttonStyle)===null||i===void 0?void 0:i.default)});return s.toBack(),r.on("mouseenter",function(){var l;s.attr((l=a.buttonStyle)===null||l===void 0?void 0:l.active)}),r.on("mouseleave",function(){var l;s.attr((l=a.buttonStyle)===null||l===void 0?void 0:l.default)}),s},t.prototype.resetPosition=function(){var r=this.context.view,n=r.getCoordinate(),i=n.convert({x:1,y:1}),a=this.buttonGroup,o=a.getBBox(),s=ih.transform(null,[["t",i.x-o.width-eJt,i.y+o.height+rJt]]);a.setMatrix(s)},t.prototype.show=function(){this.buttonGroup||this.drawButton(),this.resetPosition(),this.buttonGroup.show()},t.prototype.hide=function(){this.buttonGroup&&this.buttonGroup.hide()},t.prototype.destroy=function(){var r=this.buttonGroup;r&&r.remove(),e.prototype.destroy.call(this)},t}(io);yn("brush-reset-button",iJt,{name:"brush-reset-button"});Zn("filter-action",{});function Zv(e){return e.isInPlot()}function k_(e,t,r){var n=r||{},i=n.mask,a=n.isStartEnable,o=t||"rect";switch(e){case"brush":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:a||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:a||Zv,action:["brush:start","".concat(o,"-mask:start"),"".concat(o,"-mask:show")],arg:[null,{maskStyle:i==null?void 0:i.style}]}],processing:[{trigger:"mousemove",isEnable:Zv,action:["".concat(o,"-mask:resize")]}],end:[{trigger:"mouseup",isEnable:Zv,action:["brush:filter","brush:end","".concat(o,"-mask:end"),"".concat(o,"-mask:hide"),"brush-reset-button:show"]}],rollback:[{trigger:"brush-reset-button:click",action:["brush:reset","brush-reset-button:hide","cursor:crosshair"]}]};case"brush-highlight":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:a||function(){return!0}},{trigger:"plot:mousemove",action:"cursor:crosshair",isEnable:a||function(){return!0}},{trigger:"plot:mousemove",action:"cursor:default",isEnable:function(s){return a?!a(s):!1}},{trigger:"mask:mouseenter",action:"cursor:move",isEnable:a||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"},{trigger:"mask:mouseleave",action:"cursor:crosshair"}],start:[{trigger:"plot:mousedown",isEnable:a||function(s){return!s.isInShape("mask")},action:["".concat(o,"-mask:start"),"".concat(o,"-mask:show")],arg:[{maskStyle:i==null?void 0:i.style}]},{trigger:"mask:dragstart",action:["".concat(o,"-mask:moveStart")]}],processing:[{trigger:"plot:mousemove",action:["".concat(o,"-mask:resize")]},{trigger:"mask:drag",action:["".concat(o,"-mask:move")]},{trigger:"mask:change",action:["element-range-highlight:highlight"]}],end:[{trigger:"plot:mouseup",action:["".concat(o,"-mask:end")]},{trigger:"mask:dragend",action:["".concat(o,"-mask:moveEnd")]},{trigger:"document:mouseup",isEnable:function(s){return!s.isInPlot()},action:["element-range-highlight:clear","".concat(o,"-mask:end"),"".concat(o,"-mask:hide")]}],rollback:[{trigger:"dblclick",action:["element-range-highlight:clear","".concat(o,"-mask:hide")]}]};case"brush-x":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:a||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:a||Zv,action:["brush-x:start","".concat(o,"-mask:start"),"".concat(o,"-mask:show")],arg:[null,{maskStyle:i==null?void 0:i.style}]}],processing:[{trigger:"mousemove",isEnable:Zv,action:["".concat(o,"-mask:resize")]}],end:[{trigger:"mouseup",isEnable:Zv,action:["brush-x:filter","brush-x:end","".concat(o,"-mask:end"),"".concat(o,"-mask:hide")]}],rollback:[{trigger:"dblclick",action:["brush-x:reset"]}]};case"brush-x-highlight":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:a||function(){return!0}},{trigger:"mask:mouseenter",action:"cursor:move",isEnable:a||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"},{trigger:"mask:mouseleave",action:"cursor:crosshair"}],start:[{trigger:"plot:mousedown",isEnable:a||function(s){return!s.isInShape("mask")},action:["".concat(o,"-mask:start"),"".concat(o,"-mask:show")],arg:[{maskStyle:i==null?void 0:i.style}]},{trigger:"mask:dragstart",action:["".concat(o,"-mask:moveStart")]}],processing:[{trigger:"plot:mousemove",action:["".concat(o,"-mask:resize")]},{trigger:"mask:drag",action:["".concat(o,"-mask:move")]},{trigger:"mask:change",action:["element-range-highlight:highlight"]}],end:[{trigger:"plot:mouseup",action:["".concat(o,"-mask:end")]},{trigger:"mask:dragend",action:["".concat(o,"-mask:moveEnd")]},{trigger:"document:mouseup",isEnable:function(s){return!s.isInPlot()},action:["element-range-highlight:clear","".concat(o,"-mask:end"),"".concat(o,"-mask:hide")]}],rollback:[{trigger:"dblclick",action:["element-range-highlight:clear","".concat(o,"-mask:hide")]}]};case"brush-y":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:a||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:a||Zv,action:["brush-y:start","".concat(o,"-mask:start"),"".concat(o,"-mask:show")],arg:[null,{maskStyle:i==null?void 0:i.style}]}],processing:[{trigger:"mousemove",isEnable:Zv,action:["".concat(o,"-mask:resize")]}],end:[{trigger:"mouseup",isEnable:Zv,action:["brush-y:filter","brush-y:end","".concat(o,"-mask:end"),"".concat(o,"-mask:hide")]}],rollback:[{trigger:"dblclick",action:["brush-y:reset"]}]};case"brush-y-highlight":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:a||function(){return!0}},{trigger:"mask:mouseenter",action:"cursor:move",isEnable:a||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"},{trigger:"mask:mouseleave",action:"cursor:crosshair"}],start:[{trigger:"plot:mousedown",isEnable:a||function(s){return!s.isInShape("mask")},action:["".concat(o,"-mask:start"),"".concat(o,"-mask:show")],arg:[{maskStyle:i==null?void 0:i.style}]},{trigger:"mask:dragstart",action:["".concat(o,"-mask:moveStart")]}],processing:[{trigger:"plot:mousemove",action:["".concat(o,"-mask:resize")]},{trigger:"mask:drag",action:["".concat(o,"-mask:move")]},{trigger:"mask:change",action:["element-range-highlight:highlight"]}],end:[{trigger:"plot:mouseup",action:["".concat(o,"-mask:end")]},{trigger:"mask:dragend",action:["".concat(o,"-mask:moveEnd")]},{trigger:"document:mouseup",isEnable:function(s){return!s.isInPlot()},action:["element-range-highlight:clear","".concat(o,"-mask:end"),"".concat(o,"-mask:hide")]}],rollback:[{trigger:"dblclick",action:["element-range-highlight:clear","".concat(o,"-mask:hide")]}]};default:return{}}}Zn("brush",k_("brush"));Zn("brush-highlight",k_("brush-highlight"));Zn("brush-x",k_("brush-x","x-rect"));Zn("brush-y",k_("brush-y","y-rect"));Zn("brush-x-highlight",k_("brush-x-highlight","x-rect"));Zn("brush-y-highlight",k_("brush-y-highlight","y-rect"));var LW=["brush","brush-x","brush-y","brush-highlight","brush-x-highlight","brush-y-highlight"];function nat(e){var t=e.options,r=t.brush,n=Al(t.interactions||[],function(i){return LW.indexOf(i.type)===-1});return r!=null&&r.enabled&&(LW.forEach(function(i){var a=!1;switch(r.type){case"x-rect":a=i===(r.action==="highlight"?"brush-x-highlight":"brush-x");break;case"y-rect":a=i===(r.action==="highlight"?"brush-y-highlight":"brush-y");break;default:a=i===(r.action==="highlight"?"brush-highlight":"brush");break}var o={type:i,enable:a};r&&(o.cfg=k_(i,r.type,r)),n.push(o)}),(r==null?void 0:r.action)!=="highlight"&&n.push({type:"filter-action",cfg:{buttonConfig:r.button}})),me({},e,{options:{interactions:n}})}var jy={hover:"__interval-connected-area-hover__",click:"__interval-connected-area-click__"},wk=function(e,t){return e==="hover"?[{trigger:"interval:mouseenter",action:["element-highlight-by-color:highlight","element-link-by-color:link"],arg:[null,{style:t}]}]:[{trigger:"interval:click",action:["element-highlight-by-color:clear","element-highlight-by-color:highlight","element-link-by-color:clear","element-link-by-color:unlink","element-link-by-color:link"],arg:[null,null,null,null,{style:t}]}]};Zn(jy.hover,{start:wk(jy.hover),end:[{trigger:"interval:mouseleave",action:["element-highlight-by-color:reset","element-link-by-color:unlink"]}]});Zn(jy.click,{start:wk(jy.click),end:[{trigger:"document:mousedown",action:["element-highlight-by-color:clear","element-link-by-color:clear"]}]});function aJt(e){return e===void 0&&(e=!1),function(t){var r=t.chart,n=t.options,i=n.connectedArea,a=function(){r.removeInteraction(jy.hover),r.removeInteraction(jy.click)};if(!e&&i){var o=i.trigger||"hover";a(),r.interaction(jy[o],{start:wk(o,i.style)})}else a();return t}}function iat(e,t){return!Rn(e)||!Rn(t)||e===0&&t===0?"-":e===t?"100%":e===0?"∞":"".concat((100*t/e).toFixed(2),"%")}function oJt(e,t){return me({size:t?32:80,spacing:t?8:12,offset:t?32:0,arrow:e.arrow!==!1&&{headSize:12,style:{fill:"rgba(0, 0, 0, 0.05)"}},text:e.text!==!1&&{style:{fontSize:12,fill:"rgba(0, 0, 0, 0.85)",textAlign:"center",textBaseline:"middle"},formatter:iat}},e)}function HR(e,t){return fo(t.getModel().points,function(r){return e.convertPoint(r)})}function sJt(e,t,r){var n=e.view,i=e.geometry,a=e.group,o=e.options,s=e.horizontal,l=o.offset,u=o.size,c=o.arrow,f=n.getCoordinate(),d=HR(f,t)[3],v=HR(f,r)[0],g=v.y-d.y,x=v.x-d.x;if(typeof c!="boolean"){var w=c.headSize,S=o.spacing,M;s?(x-w)/2<S?(S=Math.max(1,(x-w)/2),M=[[d.x+S,d.y-l],[d.x+S,d.y-l-u],[v.x-S,v.y-l-u/2]]):M=[[d.x+S,d.y-l],[d.x+S,d.y-l-u],[v.x-S-w,v.y-l-u],[v.x-S,v.y-l-u/2],[v.x-S-w,v.y-l]]:(g-w)/2<S?(S=Math.max(1,(g-w)/2),M=[[d.x+l,d.y+S],[d.x+l+u,d.y+S],[v.x+l+u/2,v.y-S]]):M=[[d.x+l,d.y+S],[d.x+l+u,d.y+S],[v.x+l+u,v.y-S-w],[v.x+l+u/2,v.y-S],[v.x+l,v.y-S-w]],a.addShape("polygon",{id:"".concat(n.id,"-conversion-tag-arrow-").concat(i.getElementId(t.getModel().mappingData)),name:"conversion-tag-arrow",origin:{element:t,nextElement:r},attrs:$($({},c.style||{}),{points:M})})}}function lJt(e,t,r){var n,i,a,o=e.view,s=e.geometry,l=e.group,u=e.options,c=e.field,f=e.horizontal,d=u.offset,v=u.size;if(typeof u.text!="boolean"){var g=o.getCoordinate(),x=((n=u.text)===null||n===void 0?void 0:n.formatter)&&((i=u.text)===null||i===void 0?void 0:i.formatter(t.getData()[c],r.getData()[c])),w=HR(g,t)[f?3:0],S=HR(g,r)[f?0:3],M=l.addShape("text",{id:"".concat(o.id,"-conversion-tag-text-").concat(s.getElementId(t.getModel().mappingData)),name:"conversion-tag-text",origin:{element:t,nextElement:r},attrs:$($({},((a=u.text)===null||a===void 0?void 0:a.style)||{}),{text:x,x:f?(w.x+S.x)/2:w.x+d+v/2,y:f?w.y-d-v/2:(w.y+S.y)/2})});if(f){var R=S.x-w.x,I=M.getBBox().width;if(I>R){var P=I/x.length,k=Math.max(1,Math.ceil(R/P)-1),z="".concat(x.slice(0,k),"...");M.attr("text",z)}}}}function uJt(e,t,r){sJt(e,t,r),lJt(e,t,r)}function cJt(e,t,r){return t===void 0&&(t=!0),r===void 0&&(r=!1),function(n){var i=n.options,a=n.chart,o=i.conversionTag,s=i.theme;return o&&!r&&(a.theme(me({},Xi(s)?s:iC(s),{columnWidthRatio:1/3})),a.annotation().shape({render:function(l,u){var c=l.addGroup({id:"".concat(a.id,"-conversion-tag-group"),name:"conversion-tag-group"}),f=Xf(a.geometries,function(g){return g.type==="interval"}),d={view:u,geometry:f,group:c,field:e,horizontal:t,options:oJt(o,t)},v=f.elements;ft(v,function(g,x){x>0&&uJt(d,v[x-1],g)})}})),n}}function hJt(e){var t=e.options,r=t.legend,n=t.seriesField,i=t.isStack;return n?r!==!1&&(r=$({position:i?"right-top":"top-left"},r)):r=!1,e.options.legend=r,e}function fJt(e){var t=e.chart,r=e.options,n=r.data,i=r.columnStyle,a=r.color,o=r.columnWidthRatio,s=r.isPercent,l=r.isGroup,u=r.isStack,c=r.xField,f=r.yField,d=r.seriesField,v=r.groupField,g=r.tooltip,x=r.shape,w=s&&l&&u?XQt(n,f,[c,v],f):y2(n,f,c,f,s),S=[];u&&d&&!l?w.forEach(function(I){var P=S.find(function(k){return k[c]===I[c]&&k[d]===I[d]});P?P[f]+=I[f]||0:S.push($({},I))}):S=w,t.data(S);var M=s?$({formatter:function(I){var P;return{name:l&&u?"".concat(I[d]," - ").concat(I[v]):(P=I[d])!==null&&P!==void 0?P:I[c],value:(Number(I[f])*100).toFixed(2)+"%"}}},g):g,R=me({},e,{options:{data:S,widthRatio:o,tooltip:M,interval:{shape:x,style:i,color:a}}});return gu(R),R}function Ck(e){var t,r,n=e.options,i=n.xAxis,a=n.yAxis,o=n.xField,s=n.yField,l=n.data,u=n.isPercent,c=u?{max:1,min:0,minLimit:0,maxLimit:1}:{};return zn(ns((t={},t[o]=i,t[s]=a,t),(r={},r[o]={type:"cat"},r[s]=$($({},vk(l,s)),c),r)))(e)}function dJt(e){var t=e.chart,r=e.options,n=r.xAxis,i=r.yAxis,a=r.xField,o=r.yField;return n===!1?t.axis(a,!1):t.axis(a,n),i===!1?t.axis(o,!1):t.axis(o,i),e}function pJt(e){var t=e.chart,r=e.options,n=r.legend,i=r.seriesField;return n&&i?t.legend(i,n):n===!1&&t.legend(!1),e}function vJt(e){var t=e.chart,r=e.options,n=r.label,i=r.yField,a=r.isRange,o=vu(t,"interval");if(!n)o.label(!1);else{var s=n.callback,l=fi(n,["callback"]);o.label({fields:[i],callback:s,cfg:$({layout:l!=null&&l.position?void 0:[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"},{type:"limit-in-plot",cfg:{action:"hide"}}]},Cl(a?$({content:function(u){var c;return(c=u[i])===null||c===void 0?void 0:c.join("-")}},l):l))})}return e}function gJt(e){var t=e.chart,r=e.options,n=r.tooltip,i=r.isGroup,a=r.isStack,o=r.groupField,s=r.data,l=r.xField,u=r.yField,c=r.seriesField;if(n===!1)t.tooltip(!1);else{var f=n;if(i&&a){var d=f.customItems,v=(f==null?void 0:f.formatter)||function(g){return{name:"".concat(g[c]," - ").concat(g[o]),value:g[u]}};f=$($({},f),{customItems:function(g){var x=[];return ft(g,function(w){var S=Al(s,function(M){return Z4(M,Ea(w.data,[l,c]))});S.forEach(function(M){x.push($($($({},w),{value:M[u],data:M,mappingData:{_origin:M}}),v(M)))})}),d?d(x):x}})}t.tooltip(f)}return e}function D3(e,t){t===void 0&&(t=!1);var r=e.options,n=r.seriesField;return zn(hJt,ea,Jh("columnStyle"),S0,Git("rect"),fJt,Ck,dJt,pJt,gJt,m2,xk,vJt,nat,xo,Ma,Ao(),cJt(r.yField,!t,!!n),aJt(!r.isStack),d_)(e)}function mJt(e){var t=e.options,r=t.xField,n=t.yField,i=t.xAxis,a=t.yAxis,o={left:"bottom",right:"top",top:"left",bottom:"right"},s=a!==!1?$({position:o[(a==null?void 0:a.position)||"left"]},a):!1,l=i!==!1?$({position:o[(i==null?void 0:i.position)||"bottom"]},i):!1;return $($({},e),{options:$($({},t),{xField:n,yField:r,xAxis:s,yAxis:l})})}function yJt(e){var t=e.options,r=t.label;return r&&!r.position&&(r.position="left",r.layout||(r.layout=[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"},{type:"limit-in-plot",cfg:{action:"hide"}}])),me({},e,{options:{label:r}})}function _Jt(e){var t=e.options,r=t.seriesField,n=t.isStack,i=t.legend;return r?i!==!1&&(i=$({position:n?"top-left":"right-top"},i||{})):i=!1,me({},e,{options:{legend:i}})}function xJt(e){var t=e.options,r=[{type:"transpose"},{type:"reflectY"}].concat(t.coordinate||[]);return me({},e,{options:{coordinate:r}})}function bJt(e){var t=e.chart,r=e.options,n=r.barStyle,i=r.barWidthRatio,a=r.minBarWidth,o=r.maxBarWidth,s=r.barBackground;return D3({chart:t,options:$($({},r),{columnStyle:n,columnWidthRatio:i,minColumnWidth:a,maxColumnWidth:o,columnBackground:s})},!0)}function aat(e){return zn(mJt,yJt,_Jt,al,xJt,bJt)(e)}var EJt=me({},ti.getDefaultOptions(),{barWidthRatio:.6,marginRatio:1/32,tooltip:{shared:!0,showMarkers:!1,offset:20},legend:{radio:{}},interactions:[{type:"active-region"}]}),oat=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="bar",r}return t.getDefaultOptions=function(){return EJt},t.prototype.changeData=function(r){var n,i;this.updateOption({data:r});var a=this,o=a.chart,s=a.options,l=s.isPercent,u=s.xField,c=s.yField,f=s.xAxis,d=s.yAxis;n=[c,u],u=n[0],c=n[1],i=[d,f],f=i[0],d=i[1];var v=$($({},s),{xField:u,yField:c,yAxis:d,xAxis:f});Ck({chart:o,options:v}),o.changeData(y2(r,u,c,u,l))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return aat},t}(ti);const uOe=Object.freeze(Object.defineProperty({__proto__:null,Bar:oat},Symbol.toStringTag,{value:"Module"}));var wJt=me({},ti.getDefaultOptions(),{columnWidthRatio:.6,marginRatio:1/32,tooltip:{shared:!0,showMarkers:!1,offset:20},legend:{radio:{}},interactions:[{type:"active-region"}]}),sat=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="column",r}return t.getDefaultOptions=function(){return wJt},t.prototype.changeData=function(r){this.updateOption({data:r});var n=this.options,i=n.yField,a=n.xField,o=n.isPercent,s=this,l=s.chart,u=s.options;Ck({chart:l,options:u}),this.chart.changeData(y2(r,i,a,i,o))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return D3},t}(ti);const cOe=Object.freeze(Object.defineProperty({__proto__:null,Column:sat},Symbol.toStringTag,{value:"Module"}));var TP,l0="$$percentage$$",u0="$$mappingValue$$",Kp="$$conversion$$",rB="$$totalPercentage$$",KC="$$x$$",QC="$$y$$",CJt={appendPadding:[0,80],minSize:0,maxSize:1,meta:(TP={},TP[u0]={min:0,max:1,nice:!1},TP),label:{style:{fill:"#fff",fontSize:12}},tooltip:{showTitle:!1,showMarkers:!1,shared:!1},conversionTag:{offsetX:10,offsetY:0,style:{fontSize:12,fill:"rgba(0,0,0,0.45)"}}},lat="CONVERSION_TAG_NAME";function Sk(e,t,r){var n=[],i=r.yField,a=r.maxSize,o=r.minSize,s=xt(J4(t,i),[i]),l=Rn(a)?a:1,u=Rn(o)?o:0;return n=fo(e,function(c,f){var d=(c[i]||0)/s;return c[l0]=d,c[u0]=(l-u)*d+u,c[Kp]=[xt(e,[f-1,i]),c[i]],c}),n}function Tk(e){return function(t){var r=t.chart,n=t.options,i=n.conversionTag,a=n.filteredData,o=a||r.getOptions().data;if(i){var s=i.formatter;o.forEach(function(l,u){if(!(u<=0||Number.isNaN(l[u0]))){var c=e(l,u,o,{top:!0,name:lat,text:{content:Rr(s)?s(l,o):s,offsetX:i.offsetX,offsetY:i.offsetY,position:"end",autoRotate:!1,style:$({textAlign:"start",textBaseline:"middle"},i.style)}});r.annotation().line(c)}})}return t}}function SJt(e){var t=e.chart,r=e.options,n=r.data,i=n===void 0?[]:n,a=r.yField,o=r.maxSize,s=r.minSize,l=Sk(i,i,{yField:a,maxSize:o,minSize:s});return t.data(l),e}function TJt(e){var t=e.chart,r=e.options,n=r.xField,i=r.yField,a=r.color,o=r.tooltip,s=r.label,l=r.shape,u=l===void 0?"funnel":l,c=r.funnelStyle,f=r.state,d=sd(o,[n,i]),v=d.fields,g=d.formatter;ch({chart:t,options:{type:"interval",xField:n,yField:u0,colorField:n,tooltipFields:Fe(v)&&v.concat([l0,Kp]),mapping:{shape:u,tooltip:g,color:a,style:c},label:s,state:f}});var x=vu(e.chart,"interval");return x.adjust("symmetric"),e}function AJt(e){var t=e.chart,r=e.options,n=r.isTransposed;return t.coordinate({type:"rect",actions:n?[]:[["transpose"],["scale",1,-1]]}),e}function uat(e){var t=e.options,r=e.chart,n=t.maxSize,i=xt(r,["geometries","0","dataArray"],[]),a=xt(r,["options","data","length"]),o=fo(i,function(l){return xt(l,["0","nextPoints","0","x"])*a-.5}),s=function(l,u,c,f){var d=n-(n-l[u0])/2;return $($({},f),{start:[o[u-1]||u-.5,d],end:[o[u-1]||u-.5,d+.05]})};return Tk(s)(e),e}function cat(e){return zn(SJt,TJt,AJt,uat)(e)}function MJt(e){var t,r=e.chart,n=e.options,i=n.data,a=i===void 0?[]:i,o=n.yField;return r.data(a),r.scale((t={},t[o]={sync:!0},t)),e}function RJt(e){var t=e.chart,r=e.options,n=r.data,i=r.xField,a=r.yField,o=r.color,s=r.compareField,l=r.isTransposed,u=r.tooltip,c=r.maxSize,f=r.minSize,d=r.label,v=r.funnelStyle,g=r.state,x=r.showFacetTitle;return t.facet("mirror",{fields:[s],transpose:!l,padding:l?0:[32,0,0,0],showTitle:x,eachView:function(w,S){var M=l?S.rowIndex:S.columnIndex;l||w.coordinate({type:"rect",actions:[["transpose"],["scale",M===0?-1:1,-1]]});var R=Sk(S.data,n,{yField:a,maxSize:c,minSize:f});w.data(R);var I=sd(u,[i,a,s]),P=I.fields,k=I.formatter,z=l?{offset:M===0?10:-23,position:M===0?"bottom":"top"}:{offset:10,position:"left",style:{textAlign:M===0?"end":"start"}};ch({chart:w,options:{type:"interval",xField:i,yField:u0,colorField:i,tooltipFields:Fe(P)&&P.concat([l0,Kp]),mapping:{shape:"funnel",tooltip:k,color:o,style:v},label:d===!1?!1:me({},z,d),state:g}})}}),e}function hat(e){var t=e.chart,r=e.index,n=e.options,i=n.conversionTag,a=n.isTransposed;(Rn(r)?[t]:t.views).forEach(function(o,s){var l=xt(o,["geometries","0","dataArray"],[]),u=xt(o,["options","data","length"]),c=fo(l,function(d){return xt(d,["0","nextPoints","0","x"])*u-.5}),f=function(d,v,g,x){var w=(r||s)===0?-1:1;return me({},x,{start:[c[v-1]||v-.5,d[u0]],end:[c[v-1]||v-.5,d[u0]+.05],text:a?{style:{textAlign:"start"}}:{offsetX:i!==!1?w*i.offsetX:0,style:{textAlign:(r||s)===0?"end":"start"}}})};Tk(f)(me({},{chart:o,options:n}))})}function IJt(e){var t=e.chart;return t.once("beforepaint",function(){return hat(e)}),e}function LJt(e){return zn(MJt,RJt,IJt)(e)}function OJt(e){var t=e.chart,r=e.options,n=r.data,i=n===void 0?[]:n,a=r.yField,o=du(i,function(u,c){return u+(c[a]||0)},0),s=J4(i,a)[a],l=fo(i,function(u,c){var f=[],d=[];if(u[rB]=(u[a]||0)/o,c){var v=i[c-1][KC],g=i[c-1][QC];f[0]=v[3],d[0]=g[3],f[1]=v[2],d[1]=g[2]}else f[0]=-.5,d[0]=1,f[1]=.5,d[1]=1;return d[2]=d[1]-u[rB],f[2]=(d[2]+1)/4,d[3]=d[2],f[3]=-f[2],u[KC]=f,u[QC]=d,u[l0]=(u[a]||0)/s,u[Kp]=[xt(i,[c-1,a]),u[a]],u});return t.data(l),e}function PJt(e){var t=e.chart,r=e.options,n=r.xField,i=r.yField,a=r.color,o=r.tooltip,s=r.label,l=r.funnelStyle,u=r.state,c=sd(o,[n,i]),f=c.fields,d=c.formatter;return ch({chart:t,options:{type:"polygon",xField:KC,yField:QC,colorField:n,tooltipFields:Fe(f)&&f.concat([l0,Kp]),label:s,state:u,mapping:{tooltip:d,color:a,style:l}}}),e}function DJt(e){var t=e.chart,r=e.options,n=r.isTransposed;return t.coordinate({type:"rect",actions:n?[["transpose"],["reflect","x"]]:[]}),e}function FJt(e){var t=function(r,n,i,a){return $($({},a),{start:[r[KC][1],r[QC][1]],end:[r[KC][1]+.05,r[QC][1]]})};return Tk(t)(e),e}function BJt(e){return zn(OJt,PJt,DJt,FJt)(e)}function NJt(e){var t,r=e.chart,n=e.options,i=n.data,a=i===void 0?[]:i,o=n.yField;return r.data(a),r.scale((t={},t[o]={sync:!0},t)),e}function kJt(e){var t=e.chart,r=e.options,n=r.seriesField,i=r.isTransposed,a=r.showFacetTitle;return t.facet("rect",{fields:[n],padding:[i?0:32,10,0,10],showTitle:a,eachView:function(o,s){cat(me({},e,{chart:o,options:{data:s.data}}))}}),e}function zJt(e){return zn(NJt,kJt)(e)}var UJt=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.rendering=!1,r}return t.prototype.change=function(r){var n=this;if(!this.rendering){var i=r.seriesField,a=r.compareField,o=a?hat:uat,s=this.context.view,l=i||a?s.views:[s];fo(l,function(u,c){var f=u.getController("annotation"),d=Al(xt(f,["option"],[]),function(g){var x=g.name;return x!==lat});f.clear(!0),ft(d,function(g){typeof g=="object"&&u.annotation()[g.type](g)});var v=xt(u,["filteredData"],u.getOptions().data);o({chart:u,index:c,options:$($({},r),{filteredData:Sk(v,v,r)})}),u.filterData(v),n.rendering=!0,u.render(!0)})}this.rendering=!1},t}(io),fat="funnel-conversion-tag",nB="funnel-afterrender",dat={trigger:"afterrender",action:"".concat(fat,":change")};yn(fat,UJt);Zn(nB,{start:[dat]});function $Jt(e){var t=e.options,r=t.compareField,n=t.xField,i=t.yField,a=t.locale,o=t.funnelStyle,s=t.data,l=A3(a),u={label:r?{fields:[n,i,r,l0,Kp],formatter:function(f){return"".concat(f[i])}}:{fields:[n,i,l0,Kp],offset:0,position:"middle",formatter:function(f){return"".concat(f[n]," ").concat(f[i])}},tooltip:{title:n,formatter:function(f){return{name:f[n],value:f[i]}}},conversionTag:{formatter:function(f){return"".concat(l.get(["conversionTag","label"]),": ").concat(iat.apply(void 0,f[Kp]))}}},c;return(r||o)&&(c=function(f){return me({},r&&{lineWidth:1,stroke:"#fff"},Rr(o)?o(f):o)}),me({options:u},e,{options:{funnelStyle:c,data:bl(s)}})}function HJt(e){var t=e.options,r=t.compareField,n=t.dynamicHeight,i=t.seriesField;return i?zJt(e):r?LJt(e):n?BJt(e):cat(e)}function VJt(e){var t,r=e.options,n=r.xAxis,i=r.yAxis,a=r.xField,o=r.yField;return zn(ns((t={},t[a]=n,t[o]=i,t)))(e)}function GJt(e){var t=e.chart;return t.axis(!1),e}function WJt(e){var t=e.chart,r=e.options,n=r.legend;return n===!1?t.legend(!1):t.legend(n),e}function XJt(e){var t=e.chart,r=e.options,n=r.interactions,i=r.dynamicHeight;return ft(n,function(a){a.enable===!1?t.removeInteraction(a.type):t.interaction(a.type,a.cfg||{})}),i?t.removeInteraction(nB):t.interaction(nB,{start:[$($({},dat),{arg:r})]}),e}function pat(e){return zn($Jt,HJt,VJt,GJt,al,XJt,WJt,Ma,ea,Ao())(e)}var vat=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="funnel",r}return t.getDefaultOptions=function(){return CJt},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return pat},t.prototype.setState=function(r,n,i){i===void 0&&(i=!0);var a=qC(this.chart);ft(a,function(o){n(o.getData())&&o.setState(r,i)})},t.prototype.getStates=function(){var r=qC(this.chart),n=[];return ft(r,function(i){var a=i.getData(),o=i.getStates();ft(o,function(s){n.push({data:a,state:s,geometry:i.geometry,element:i})})}),n},t.CONVERSATION_FIELD=Kp,t.PERCENT_FIELD=l0,t.TOTAL_PERCENT_FIELD=rB,t}(ti);const hOe=Object.freeze(Object.defineProperty({__proto__:null,FUNNEL_CONVERSATION_FIELD:Kp,Funnel:vat},Symbol.toStringTag,{value:"Module"}));var AA,Ak="range",gat="type",sg="percent",jJt="#f0f0f0",mat="indicator-view",yat="range-view",YJt={percent:0,range:{ticks:[]},innerRadius:.9,radius:.95,startAngle:-7/6*Math.PI,endAngle:1/6*Math.PI,syncViewPadding:!0,axis:{line:null,label:{offset:-24,style:{textAlign:"center",textBaseline:"middle"}},subTickLine:{length:-8},tickLine:{length:-12},grid:null},indicator:{pointer:{style:{lineWidth:5,lineCap:"round"}},pin:{style:{r:9.75,lineWidth:4.5,fill:"#fff"}}},statistic:{title:!1},meta:(AA={},AA[Ak]={sync:"v"},AA[sg]={sync:"v",tickCount:5,tickInterval:.2},AA),animation:!1};function ZJt(e,t){return e.map(function(r,n){var i;return i={},i[Ak]=r-(e[n-1]||0),i[gat]="".concat(n),i[sg]=t,i})}function _at(e){var t;return[(t={},t[sg]=to(e,0,1),t)]}function xat(e,t){var r=xt(t,["ticks"],[]),n=il(r)?xg(r):[0,to(e,0,1),1];return n[0]||n.shift(),ZJt(n,e)}function qJt(e){var t=e.chart,r=e.options,n=r.percent,i=r.range,a=r.radius,o=r.innerRadius,s=r.startAngle,l=r.endAngle,u=r.axis,c=r.indicator,f=r.gaugeStyle,d=r.type,v=r.meter,g=i.color,x=i.width;if(c){var w=_at(n),S=t.createView({id:mat});S.data(w),S.point().position("".concat(sg,"*1")).shape(c.shape||"gauge-indicator").customInfo({defaultColor:t.getTheme().defaultColor,indicator:c}),S.coordinate("polar",{startAngle:s,endAngle:l,radius:o*a}),S.axis(sg,u),S.scale(sg,Ea(u,Xc))}var M=xat(n,r.range),R=t.createView({id:yat});R.data(M);var I=en(g)?[g,jJt]:g,P=gu({chart:R,options:{xField:"1",yField:Ak,seriesField:gat,rawFields:[sg],isStack:!0,interval:{color:I,style:f,shape:d==="meter"?"meter-gauge":null},args:{zIndexReversed:!0,sortZIndex:!0},minColumnWidth:x,maxColumnWidth:x}}).ext,k=P.geometry;return k.customInfo({meter:v}),R.coordinate("polar",{innerRadius:o,radius:a,startAngle:s,endAngle:l}).transpose(),e}function KJt(e){var t;return zn(ns((t={range:{min:0,max:1,maxLimit:1,minLimit:0}},t[sg]={},t)))(e)}function bat(e,t){var r=e.chart,n=e.options,i=n.statistic,a=n.percent;if(r.getController("annotation").clear(!0),i){var o=i.content,s=void 0;o&&(s=me({},{content:"".concat((a*100).toFixed(2),"%"),style:{opacity:.75,fontSize:"30px",lineHeight:1,textAlign:"center",color:"rgba(44,53,66,0.85)"}},o)),uQt(r,{statistic:$($({},i),{content:s})},{percent:a})}return t&&r.render(!0),e}function QJt(e){var t=e.chart,r=e.options,n=r.tooltip;return n?t.tooltip(me({showTitle:!1,showMarkers:!1,containerTpl:'<div class="g2-tooltip"><div class="g2-tooltip-list"></div></div>',domStyles:{"g2-tooltip":{padding:"4px 8px",fontSize:"10px"}},customContent:function(i,a){var o=xt(a,[0,"data",sg],0);return"".concat((o*100).toFixed(2),"%")}},n)):t.tooltip(!1),e}function JJt(e){var t=e.chart;return t.legend(!1),e}function Eat(e){return zn(ea,Ma,qJt,KJt,QJt,bat,xo,Ao(),JJt)(e)}fa("point","gauge-indicator",{draw:function(e,t){var r=e.customInfo,n=r.indicator,i=r.defaultColor,a=n,o=a.pointer,s=a.pin,l=t.addGroup(),u=this.parsePoint({x:0,y:0});return o&&l.addShape("line",{name:"pointer",attrs:$({x1:u.x,y1:u.y,x2:e.x,y2:e.y,stroke:i},o.style)}),s&&l.addShape("circle",{name:"pin",attrs:$({x:u.x,y:u.y,stroke:i},s.style)}),l}});fa("interval","meter-gauge",{draw:function(e,t){var r=e.customInfo.meter,n=r===void 0?{}:r,i=n.steps,a=i===void 0?50:i,o=n.stepRatio,s=o===void 0?.5:o;a=a<1?1:a,s=to(s,0,1);var l=this.coordinate,u=l.startAngle,c=l.endAngle,f=0;if(s>0&&s<1){var d=c-u;f=d/a/(s/(1-s)+1-1/a)}for(var v=f/(1-s)*s,g=t.addGroup(),x=this.coordinate.getCenter(),w=this.coordinate.getRadius(),S=ih.getAngle(e,this.coordinate),M=S.startAngle,R=S.endAngle,I=M;I<R;){var P=void 0,k=(I-u)%(v+f);k<v?P=I+(v-k):(I+=v+f-k,P=I+v);var z=ih.getSectorPath(x.x,x.y,w,I,Math.min(P,R),w*this.coordinate.innerRadius);g.addShape("path",{name:"meter-gauge",attrs:{path:z,fill:e.color,stroke:e.color,lineWidth:.5}}),I=P+f}return g}});var wat=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="gauge",r}return t.getDefaultOptions=function(){return YJt},t.prototype.changeData=function(r){this.chart.emit(pi.BEFORE_CHANGE_DATA,To.fromData(this.chart,pi.BEFORE_CHANGE_DATA,null)),this.updateOption({percent:r});var n=this.chart.views.find(function(a){return a.id===mat});n&&n.data(_at(r));var i=this.chart.views.find(function(a){return a.id===yat});i&&i.data(xat(r,this.options.range)),bat({chart:this.chart,options:this.options},!0),this.chart.emit(pi.AFTER_CHANGE_DATA,To.fromData(this.chart,pi.AFTER_CHANGE_DATA,null))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return Eat},t}(ti);const fOe=Object.freeze(Object.defineProperty({__proto__:null,Gauge:wat},Symbol.toStringTag,{value:"Module"}));function OW(e,t,r){if(r===1)return[0,t];var n=Math.floor(e/t);return[t*n,t*(n+1)]}function tte(e){return Math.ceil(Math.log(e.length)/Math.LN2)+1}function Cat(e,t,r,n,i){var a=bl(e);Ztt(a,t);var o=Zf(a,t),s=K4(o),l=s.max-s.min,u=r;if(!r&&n&&(u=n>1?l/(n-1):s.max),!r&&!n){var c=tte(o);u=l/c}var f={},d=Qc(a,i);cc(d)?ft(a,function(g){var x=g[t],w=OW(x,u,n),S="".concat(w[0],"-").concat(w[1]);ev(f,S)||(f[S]={range:w,count:0}),f[S].count+=1}):Object.keys(d).forEach(function(g){ft(d[g],function(x){var w=x[t],S=OW(w,u,n),M="".concat(S[0],"-").concat(S[1]),R="".concat(M,"-").concat(g);ev(f,R)||(f[R]={range:S,count:0},f[R][i]=g),f[R].count+=1})});var v=[];return ft(f,function(g){v.push(g)}),v}var VR="range",JC="count",ete=me({},ti.getDefaultOptions(),{columnStyle:{stroke:"#FFFFFF"},tooltip:{shared:!0,showMarkers:!1},interactions:[{type:"active-region"}]});function rte(e){var t=e.chart,r=e.options,n=r.data,i=r.binField,a=r.binNumber,o=r.binWidth,s=r.color,l=r.stackField,u=r.legend,c=r.columnStyle,f=Cat(n,i,o,a,l);t.data(f);var d=me({},e,{options:{xField:VR,yField:JC,seriesField:l,isStack:!0,interval:{color:s,style:c}}});return gu(d),u&&l?t.legend(l,u):t.legend(!1),e}function nte(e){var t,r=e.options,n=r.xAxis,i=r.yAxis;return zn(ns((t={},t[VR]=n,t[JC]=i,t)))(e)}function ite(e){var t=e.chart,r=e.options,n=r.xAxis,i=r.yAxis;return n===!1?t.axis(VR,!1):t.axis(VR,n),i===!1?t.axis(JC,!1):t.axis(JC,i),e}function ate(e){var t=e.chart,r=e.options,n=r.label,i=vu(t,"interval");if(!n)i.label(!1);else{var a=n.callback,o=fi(n,["callback"]);i.label({fields:[JC],callback:a,cfg:Cl(o)})}return e}function Sat(e){return zn(ea,Jh("columnStyle"),rte,nte,ite,S0,ate,al,xo,Ma)(e)}var ote=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="histogram",r}return t.getDefaultOptions=function(){return ete},t.prototype.changeData=function(r){this.updateOption({data:r});var n=this.options,i=n.binField,a=n.binNumber,o=n.binWidth,s=n.stackField;this.chart.changeData(Cat(r,i,o,a,s))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return Sat},t}(ti),ste=me({},ti.getDefaultOptions(),{tooltip:{shared:!0,showMarkers:!0,showCrosshairs:!0,crosshairs:{type:"x"}},legend:{position:"top-left",radio:{}},isStack:!1}),lte=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.active=function(){var r=this.getView(),n=this.context.event;if(n.data){var i=n.data.items,a=r.geometries.filter(function(o){return o.type==="point"});ft(a,function(o){ft(o.elements,function(s){var l=q4(i,function(u){return u.data===s.data})!==-1;s.setState("active",l)})})}},t.prototype.reset=function(){var r=this.getView(),n=r.geometries.filter(function(i){return i.type==="point"});ft(n,function(i){ft(i.elements,function(a){a.setState("active",!1)})})},t.prototype.getView=function(){return this.context.view},t}(io);yn("marker-active",lte);Zn("marker-active",{start:[{trigger:"tooltip:show",action:"marker-active:active"}],end:[{trigger:"tooltip:hide",action:"marker-active:reset"}]});var Tat=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="line",r}return t.getDefaultOptions=function(){return ste},t.prototype.changeData=function(r){this.updateOption({data:r});var n=this,i=n.chart,a=n.options;P3({chart:i,options:a}),this.chart.changeData(r)},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return tat},t}(ti);const dOe=Object.freeze(Object.defineProperty({__proto__:null,Line:Tat},Symbol.toStringTag,{value:"Module"}));var Aat=me({},ti.getDefaultOptions(),{legend:{position:"right",radio:{}},tooltip:{shared:!1,showTitle:!1,showMarkers:!1},label:{layout:{type:"limit-in-plot",cfg:{action:"ellipsis"}}},pieStyle:{stroke:"white",lineWidth:1},statistic:{title:{style:{fontWeight:300,color:"#4B535E",textAlign:"center",fontSize:"20px",lineHeight:1}},content:{style:{fontWeight:"bold",color:"rgba(44,53,66,0.85)",textAlign:"center",fontSize:"32px",lineHeight:1}}},theme:{components:{annotation:{text:{animate:!1}}}}}),ute=[1,0,0,0,1,0,0,0,1];function iB(e,t){var r=t?on([],t,!0):on([],ute,!0);return ih.transform(r,e)}var cte=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getActiveElements=function(){var r=ih.getDelegationObject(this.context);if(r){var n=this.context.view,i=r.component,a=r.item,o=i.get("field");if(o){var s=n.geometries[0].elements;return s.filter(function(l){return l.getModel().data[o]===a.value})}}return[]},t.prototype.getActiveElementLabels=function(){var r=this.context.view,n=this.getActiveElements(),i=r.geometries[0].labelsContainer.getChildren();return i.filter(function(a){return n.find(function(o){return Di(o.getData(),a.get("data"))})})},t.prototype.transfrom=function(r){r===void 0&&(r=7.5);var n=this.getActiveElements(),i=this.getActiveElementLabels();n.forEach(function(a,o){var s=i[o],l=a.geometry.coordinate;if(l.isPolar&&l.isTransposed){var u=ih.getAngle(a.getModel(),l),c=u.startAngle,f=u.endAngle,d=(c+f)/2,v=r,g=v*Math.cos(d),x=v*Math.sin(d);a.shape.setMatrix(iB([["t",g,x]])),s.setMatrix(iB([["t",g,x]]))}})},t.prototype.active=function(){this.transfrom()},t.prototype.reset=function(){this.transfrom(0)},t}(io);function hte(e){var t=e.event,r,n=t.target;return n&&(r=n.get("element")),r}var fte=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getAnnotations=function(r){var n=r||this.context.view;return n.getController("annotation").option},t.prototype.getInitialAnnotation=function(){return this.initialAnnotation},t.prototype.init=function(){var r=this,n=this.context.view;n.removeInteraction("tooltip"),n.on("afterchangesize",function(){var i=r.getAnnotations(n);r.initialAnnotation=i})},t.prototype.change=function(r){var n=this.context,i=n.view,a=n.event;this.initialAnnotation||(this.initialAnnotation=this.getAnnotations());var o=xt(a,["data","data"]);if(a.type.match("legend-item")){var s=ih.getDelegationObject(this.context),l=i.getGroupedFields()[0];if(s&&l){var u=s.item;o=i.getData().find(function(v){return v[l]===u.value})}}if(o){var c=xt(r,"annotations",[]),f=xt(r,"statistic",{});i.getController("annotation").clear(!0),ft(c,function(v){typeof v=="object"&&i.annotation()[v.type](v)}),S3(i,{statistic:f,plotType:"pie"},o),i.render(!0)}var d=hte(this.context);d&&d.shape.toFront()},t.prototype.reset=function(){var r=this.context.view,n=r.getController("annotation");n.clear(!0);var i=this.getInitialAnnotation();ft(i,function(a){r.annotation()[a.type](a)}),r.render(!0)},t}(io),Mat="pie-statistic";yn(Mat,fte);Zn("pie-statistic-active",{start:[{trigger:"element:mouseenter",action:"pie-statistic:change"}],end:[{trigger:"element:mouseleave",action:"pie-statistic:reset"}]});yn("pie-legend",cte);Zn("pie-legend-active",{start:[{trigger:"legend-item:mouseenter",action:"pie-legend:active"}],end:[{trigger:"legend-item:mouseleave",action:"pie-legend:reset"}]});function dte(e,t){var r=null;return ft(e,function(n){typeof n[t]=="number"&&(r+=n[t])}),r}function pte(e,t){var r;switch(e){case"inner":return r="-30%",en(t)&&t.endsWith("%")?parseFloat(t)*.01>0?r:t:t<0?t:r;case"outer":return r=12,en(t)&&t.endsWith("%")?parseFloat(t)*.01<0?r:t:t>0?t:r;default:return t}}function GR(e,t){return t3(hb(e,t),function(r){return r[t]===0})}function vte(e){var t=e.chart,r=e.options,n=r.data,i=r.angleField,a=r.colorField,o=r.color,s=r.pieStyle,l=r.shape,u=hb(n,i);if(GR(u,i)){var c="$$percentage$$";u=u.map(function(d){var v;return $($({},d),(v={},v[c]=1/u.length,v))}),t.data(u);var f=me({},e,{options:{xField:"1",yField:c,seriesField:a,isStack:!0,interval:{color:o,shape:l,style:s},args:{zIndexReversed:!0,sortZIndex:!0}}});gu(f)}else{t.data(u);var f=me({},e,{options:{xField:"1",yField:i,seriesField:a,isStack:!0,interval:{color:o,shape:l,style:s},args:{zIndexReversed:!0,sortZIndex:!0}}});gu(f)}return e}function gte(e){var t,r=e.chart,n=e.options,i=n.meta,a=n.colorField,o=me({},i);return r.scale(o,(t={},t[a]={type:"cat"},t)),e}function mte(e){var t=e.chart,r=e.options,n=r.radius,i=r.innerRadius,a=r.startAngle,o=r.endAngle;return t.coordinate({type:"theta",cfg:{radius:n,innerRadius:i,startAngle:a,endAngle:o}}),e}function yte(e){var t=e.chart,r=e.options,n=r.label,i=r.colorField,a=r.angleField,o=t.geometries[0];if(!n)o.label(!1);else{var s=n.callback,l=fi(n,["callback"]),u=Cl(l);if(u.content){var c=u.content;u.content=function(g,x,w){var S=g[i],M=g[a],R=t.getScaleByField(a),I=R==null?void 0:R.scale(M);return Rr(c)?c($($({},g),{percent:I}),x,w):en(c)?$it(c,{value:M,name:S,percentage:Rn(I)&&!ze(M)?"".concat((I*100).toFixed(2),"%"):null}):c}}var f={inner:"",outer:"pie-outer",spider:"pie-spider"},d=u.type?f[u.type]:"pie-outer",v=u.layout?Fe(u.layout)?u.layout:[u.layout]:[];u.layout=(d?[{type:d}]:[]).concat(v),o.label({fields:i?[a,i]:[a],callback:s,cfg:$($({},u),{offset:pte(u.type,u.offset),type:"pie"})})}return e}function Rat(e){var t=e.innerRadius,r=e.statistic,n=e.angleField,i=e.colorField,a=e.meta,o=e.locale,s=A3(o);if(t&&r){var l=me({},Aat.statistic,r),u=l.title,c=l.content;return u!==!1&&(u=me({},{formatter:function(f){var d=f?f[i]:ze(u.content)?s.get(["statistic","total"]):u.content,v=xt(a,[i,"formatter"])||function(g){return g};return v(d)}},u)),c!==!1&&(c=me({},{formatter:function(f,d){var v=f?f[n]:dte(d,n),g=xt(a,[n,"formatter"])||function(x){return x};return f||ze(c.content)?g(v):c.content}},c)),me({},{statistic:{title:u,content:c}},e)}return e}function Iat(e){var t=e.chart,r=e.options,n=Rat(r),i=n.innerRadius,a=n.statistic;return t.getController("annotation").clear(!0),zn(Ao())(e),i&&a&&S3(t,{statistic:a,plotType:"pie"}),e}function _te(e){var t=e.chart,r=e.options,n=r.tooltip,i=r.colorField,a=r.angleField,o=r.data;if(n===!1)t.tooltip(n);else if(t.tooltip(me({},n,{shared:!1})),GR(o,a)){var s=xt(n,"fields"),l=xt(n,"formatter");cc(xt(n,"fields"))&&(s=[i,a],l=l||function(u){return{name:u[i],value:x0(u[a])}}),t.geometries[0].tooltip(s.join("*"),J1(s,l))}return e}function xte(e){var t=e.chart,r=e.options,n=Rat(r),i=n.interactions,a=n.statistic,o=n.annotations;return ft(i,function(s){var l,u;if(s.enable===!1)t.removeInteraction(s.type);else if(s.type==="pie-statistic-active"){var c=[];!((l=s.cfg)===null||l===void 0)&&l.start||(c=[{trigger:"element:mouseenter",action:"".concat(Mat,":change"),arg:{statistic:a,annotations:o}}]),ft((u=s.cfg)===null||u===void 0?void 0:u.start,function(f){c.push($($({},f),{arg:{statistic:a,annotations:o}}))}),t.interaction(s.type,me({},s.cfg,{start:c}))}else t.interaction(s.type,s.cfg||{})}),e}function Lat(e){return zn(Jh("pieStyle"),vte,gte,ea,mte,Gb,_te,yte,S0,Iat,xte,Ma)(e)}var Oat=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="pie",r}return t.getDefaultOptions=function(){return Aat},t.prototype.changeData=function(r){this.chart.emit(pi.BEFORE_CHANGE_DATA,To.fromData(this.chart,pi.BEFORE_CHANGE_DATA,null));var n=this.options,i=this.options.angleField,a=hb(n.data,i),o=hb(r,i);GR(a,i)||GR(o,i)?this.update({data:r}):(this.updateOption({data:r}),this.chart.data(o),Iat({chart:this.chart,options:this.options}),this.chart.render(!0)),this.chart.emit(pi.AFTER_CHANGE_DATA,To.fromData(this.chart,pi.AFTER_CHANGE_DATA,null))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return Lat},t}(ti);const pOe=Object.freeze(Object.defineProperty({__proto__:null,Pie:Oat},Symbol.toStringTag,{value:"Module"}));var Pat=["#FAAD14","#E8EDF3"],bte={percent:.2,color:Pat,animation:{}};function Mk(e){var t=to(f_(e)?e:0,0,1);return[{current:"".concat(t),type:"current",percent:t},{current:"".concat(t),type:"target",percent:1}]}function Dat(e){var t=e.chart,r=e.options,n=r.percent,i=r.progressStyle,a=r.color,o=r.barWidthRatio;t.data(Mk(n));var s=me({},e,{options:{xField:"current",yField:"percent",seriesField:"type",widthRatio:o,interval:{style:i,color:en(a)?[a,Pat[1]]:a},args:{zIndexReversed:!0,sortZIndex:!0}}});return gu(s),t.tooltip(!1),t.axis(!1),t.legend(!1),e}function Ete(e){var t=e.chart;return t.coordinate("rect").transpose(),e}function Fat(e){return zn(Dat,ns({}),Ete,Ma,ea,Ao())(e)}var wte=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="process",r}return t.getDefaultOptions=function(){return bte},t.prototype.changeData=function(r){this.updateOption({percent:r}),this.chart.changeData(Mk(r))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return Fat},t}(ti);function Cte(e){var t=e.chart,r=e.options,n=r.innerRadius,i=r.radius;return t.coordinate("theta",{innerRadius:n,radius:i}),e}function Bat(e,t){var r=e.chart,n=e.options,i=n.innerRadius,a=n.statistic,o=n.percent,s=n.meta;if(r.getController("annotation").clear(!0),i&&a){var l=xt(s,["percent","formatter"])||function(c){return"".concat((c*100).toFixed(2),"%")},u=a.content;u&&(u=me({},u,{content:ze(u.content)?l(o):u.content})),S3(r,{statistic:$($({},a),{content:u}),plotType:"ring-progress"},{percent:o})}return t&&r.render(!0),e}function Nat(e){return zn(Dat,ns({}),Cte,Bat,Ma,ea,Ao())(e)}var Ste={percent:.2,innerRadius:.8,radius:.98,color:["#FAAD14","#E8EDF3"],statistic:{title:!1,content:{style:{fontSize:"14px",fontWeight:300,fill:"#4D4D4D",textAlign:"center",textBaseline:"middle"}}},animation:{}},Tte=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="ring-process",r}return t.getDefaultOptions=function(){return Ste},t.prototype.changeData=function(r){this.chart.emit(pi.BEFORE_CHANGE_DATA,To.fromData(this.chart,pi.BEFORE_CHANGE_DATA,null)),this.updateOption({percent:r}),this.chart.data(Mk(r)),Bat({chart:this.chart,options:this.options},!0),this.chart.emit(pi.AFTER_CHANGE_DATA,To.fromData(this.chart,pi.AFTER_CHANGE_DATA,null))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return Nat},t}(ti);function c0(e,t){return Ate(e)||Mte(e,t)||Rte()}function Ate(e){if(Array.isArray(e))return e}function Mte(e,t){var r=[],n=!0,i=!1,a=void 0;try{for(var o=e[Symbol.iterator](),s;!(n=(s=o.next()).done)&&(r.push(s.value),!(t&&r.length===t));n=!0);}catch(l){i=!0,a=l}finally{try{!n&&o.return!=null&&o.return()}finally{if(i)throw a}}return r}function Rte(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function Rk(e,t,r,n){e=e.filter(function(g,x){var w=t(g,x),S=r(g,x);return w!=null&&isFinite(w)&&S!=null&&isFinite(S)}),n&&e.sort(function(g,x){return t(g)-t(x)});for(var i=e.length,a=new Float64Array(i),o=new Float64Array(i),s=0,l=0,u,c,f,d=0;d<i;)f=e[d],a[d]=u=+t(f,d,e),o[d]=c=+r(f,d,e),++d,s+=(u-s)/d,l+=(c-l)/d;for(var v=0;v<i;++v)a[v]-=s,o[v]-=l;return[a,o,s,l]}function z_(e,t,r,n){for(var i=0,a=0,o=e.length;a<o;a++){var s=e[a],l=+t(s,a,e),u=+r(s,a,e);l!=null&&isFinite(l)&&u!=null&&isFinite(u)&&n(l,u,i++)}}function Xb(e,t,r,n,i){var a=0,o=0;return z_(e,t,r,function(s,l){var u=l-i(s),c=l-n;a+=u*u,o+=c*c}),1-a/o}function PW(e){return Math.atan2(e[1][1]-e[0][1],e[1][0]-e[0][0])*180/Math.PI}function Ite(e){return[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2]}function _2(e,t,r){for(var n=Math.log(t-e)*Math.LOG10E+1|0,i=1*Math.pow(10,-n/2-1),a=1e4,o=[l(e),l(t)],s=0;u(o)&&s<a;);return o;function l(c){return[c,r(c)]}function u(c){s++;for(var f=c.length,d=!1,v=0;v<f-1;v++){var g=c[v],x=c[v+1],w=Ite([g,x]),S=l(w[0]),M=PW([g,w]),R=PW([g,S]),I=Math.abs(M-R);I>i&&(c.splice(v+1,0,S),d=!0)}return d}}function x2(e,t,r,n){var i=n-e*e,a=Math.abs(i)<1e-24?0:(r-e*t)/i,o=t-a*e;return[o,a]}function Lte(){var e=function(a){return a[0]},t=function(a){return a[1]},r;function n(i){var a=0,o=0,s=0,l=0,u=0,c=0,f=r?+r[0]:1/0,d=r?+r[1]:-1/0;z_(i,e,t,function(R,I){var P=Math.log(I),k=R*I;++a,o+=(I-o)/a,l+=(k-l)/a,c+=(R*k-c)/a,s+=(I*P-s)/a,u+=(k*P-u)/a,r||(R<f&&(f=R),R>d&&(d=R))});var v=x2(l/o,s/o,u/o,c/o),g=c0(v,2),x=g[0],w=g[1];x=Math.exp(x);var S=function(I){return x*Math.exp(w*I)},M=_2(f,d,S);return M.a=x,M.b=w,M.predict=S,M.rSquared=Xb(i,e,t,o,S),M}return n.domain=function(i){return arguments.length?(r=i,n):r},n.x=function(i){return arguments.length?(e=i,n):e},n.y=function(i){return arguments.length?(t=i,n):t},n}function kat(){var e=function(a){return a[0]},t=function(a){return a[1]},r;function n(i){var a=0,o=0,s=0,l=0,u=0,c=r?+r[0]:1/0,f=r?+r[1]:-1/0;z_(i,e,t,function(M,R){++a,o+=(M-o)/a,s+=(R-s)/a,l+=(M*R-l)/a,u+=(M*M-u)/a,r||(M<c&&(c=M),M>f&&(f=M))});var d=x2(o,s,l,u),v=c0(d,2),g=v[0],x=v[1],w=function(R){return x*R+g},S=[[c,w(c)],[f,w(f)]];return S.a=x,S.b=g,S.predict=w,S.rSquared=Xb(i,e,t,s,w),S}return n.domain=function(i){return arguments.length?(r=i,n):r},n.x=function(i){return arguments.length?(e=i,n):e},n.y=function(i){return arguments.length?(t=i,n):t},n}function Ote(e){e.sort(function(r,n){return r-n});var t=e.length/2;return t%1===0?(e[t-1]+e[t])/2:e[Math.floor(t)]}var DW=2,FW=1e-12;function Pte(){var e=function(a){return a[0]},t=function(a){return a[1]},r=.3;function n(i){for(var a=Rk(i,e,t,!0),o=c0(a,4),s=o[0],l=o[1],u=o[2],c=o[3],f=s.length,d=Math.max(2,~~(r*f)),v=new Float64Array(f),g=new Float64Array(f),x=new Float64Array(f).fill(1),w=-1;++w<=DW;){for(var S=[0,d-1],M=0;M<f;++M){for(var R=s[M],I=S[0],P=S[1],k=R-s[I]>s[P]-R?I:P,z=0,G=0,J=0,Z=0,X=0,et=1/Math.abs(s[k]-R||1),at=I;at<=P;++at){var wt=s[at],Tt=l[at],vt=Dte(Math.abs(R-wt)*et)*x[at],zt=wt*vt;z+=vt,G+=zt,J+=Tt*vt,Z+=Tt*zt,X+=wt*zt}var oe=x2(G/z,J/z,Z/z,X/z),Qt=c0(oe,2),ne=Qt[0],de=Qt[1];v[M]=ne+de*R,g[M]=Math.abs(l[M]-v[M]),Fte(s,M+1,S)}if(w===DW)break;var De=Ote(g);if(Math.abs(De)<FW)break;for(var Ze=0,ke,Be;Ze<f;++Ze)ke=g[Ze]/(6*De),x[Ze]=ke>=1?FW:(Be=1-ke*ke)*Be}return Bte(s,v,u,c)}return n.bandwidth=function(i){return arguments.length?(r=i,n):r},n.x=function(i){return arguments.length?(e=i,n):e},n.y=function(i){return arguments.length?(t=i,n):t},n}function Dte(e){return(e=1-e*e*e)*e*e}function Fte(e,t,r){var n=e[t],i=r[0],a=r[1]+1;if(!(a>=e.length))for(;t>i&&e[a]-n<=n-e[i];)r[0]=++i,r[1]=a,++a}function Bte(e,t,r,n){for(var i=e.length,a=[],o=0,s=0,l=[],u;o<i;++o)u=e[o]+r,l[0]===u?l[1]+=(t[o]-l[1])/++s:(s=0,l[1]+=n,l=[u,t[o]],a.push(l));return l[1]+=n,a}function Nte(){var e=function(o){return o[0]},t=function(o){return o[1]},r=Math.E,n;function i(a){var o=0,s=0,l=0,u=0,c=0,f=n?+n[0]:1/0,d=n?+n[1]:-1/0,v=Math.log(r);z_(a,e,t,function(I,P){var k=Math.log(I)/v;++o,s+=(k-s)/o,l+=(P-l)/o,u+=(k*P-u)/o,c+=(k*k-c)/o,n||(I<f&&(f=I),I>d&&(d=I))});var g=x2(s,l,u,c),x=c0(g,2),w=x[0],S=x[1],M=function(P){return S*Math.log(P)/v+w},R=_2(f,d,M);return R.a=S,R.b=w,R.predict=M,R.rSquared=Xb(a,e,t,l,M),R}return i.domain=function(a){return arguments.length?(n=a,i):n},i.x=function(a){return arguments.length?(e=a,i):e},i.y=function(a){return arguments.length?(t=a,i):t},i.base=function(a){return arguments.length?(r=a,i):r},i}function zat(){var e=function(a){return a[0]},t=function(a){return a[1]},r;function n(i){var a=Rk(i,e,t),o=c0(a,4),s=o[0],l=o[1],u=o[2],c=o[3],f=s.length,d=0,v=0,g=0,x=0,w=0,S,M,R,I;for(S=0;S<f;)M=s[S],R=l[S++],I=M*M,d+=(I-d)/S,v+=(I*M-v)/S,g+=(I*I-g)/S,x+=(M*R-x)/S,w+=(I*R-w)/S;var P=0,k=0,z=r?+r[0]:1/0,G=r?+r[1]:-1/0;z_(i,e,t,function(vt,zt){k++,P+=(zt-P)/k,r||(vt<z&&(z=vt),vt>G&&(G=vt))});var J=g-d*d,Z=d*J-v*v,X=(w*d-x*v)/Z,et=(x*J-w*v)/Z,at=-X*d,wt=function(zt){return zt=zt-u,X*zt*zt+et*zt+at+c},Tt=_2(z,G,wt);return Tt.a=X,Tt.b=et-2*X*u,Tt.c=at-et*u+X*u*u+c,Tt.predict=wt,Tt.rSquared=Xb(i,e,t,P,wt),Tt}return n.domain=function(i){return arguments.length?(r=i,n):r},n.x=function(i){return arguments.length?(e=i,n):e},n.y=function(i){return arguments.length?(t=i,n):t},n}function kte(){var e=function(o){return o[0]},t=function(o){return o[1]},r=3,n;function i(a){if(r===1){var o=kat().x(e).y(t).domain(n)(a);return o.coefficients=[o.b,o.a],delete o.a,delete o.b,o}if(r===2){var s=zat().x(e).y(t).domain(n)(a);return s.coefficients=[s.c,s.b,s.a],delete s.a,delete s.b,delete s.c,s}var l=Rk(a,e,t),u=c0(l,4),c=u[0],f=u[1],d=u[2],v=u[3],g=c.length,x=[],w=[],S=r+1,M=0,R=0,I=n?+n[0]:1/0,P=n?+n[1]:-1/0;z_(a,e,t,function(wt,Tt){++R,M+=(Tt-M)/R,n||(wt<I&&(I=wt),wt>P&&(P=wt))});var k,z,G,J,Z;for(k=0;k<S;++k){for(G=0,J=0;G<g;++G)J+=Math.pow(c[G],k)*f[G];for(x.push(J),Z=new Float64Array(S),z=0;z<S;++z){for(G=0,J=0;G<g;++G)J+=Math.pow(c[G],k+z);Z[z]=J}w.push(Z)}w.push(x);var X=Ute(w),et=function(Tt){Tt-=d;var vt=v+X[0]+X[1]*Tt+X[2]*Tt*Tt;for(k=3;k<S;++k)vt+=X[k]*Math.pow(Tt,k);return vt},at=_2(I,P,et);return at.coefficients=zte(S,X,-d,v),at.predict=et,at.rSquared=Xb(a,e,t,M,et),at}return i.domain=function(a){return arguments.length?(n=a,i):n},i.x=function(a){return arguments.length?(e=a,i):e},i.y=function(a){return arguments.length?(t=a,i):t},i.order=function(a){return arguments.length?(r=a,i):r},i}function zte(e,t,r,n){var i=Array(e),a,o,s,l;for(a=0;a<e;++a)i[a]=0;for(a=e-1;a>=0;--a)for(s=t[a],l=1,i[a]+=s,o=1;o<=a;++o)l*=(a+1-o)/o,i[a-o]+=s*Math.pow(r,o)*l;return i[0]+=n,i}function Ute(e){var t=e.length-1,r=[],n,i,a,o,s;for(n=0;n<t;++n){for(o=n,i=n+1;i<t;++i)Math.abs(e[n][i])>Math.abs(e[n][o])&&(o=i);for(a=n;a<t+1;++a)s=e[a][n],e[a][n]=e[a][o],e[a][o]=s;for(i=n+1;i<t;++i)for(a=t;a>=n;a--)e[a][i]-=e[a][n]*e[n][i]/e[n][n]}for(i=t-1;i>=0;--i){for(s=0,a=i+1;a<t;++a)s+=e[a][i]*r[a];r[i]=(e[t][i]-s)/e[i][i]}return r}function $te(){var e=function(a){return a[0]},t=function(a){return a[1]},r;function n(i){var a=0,o=0,s=0,l=0,u=0,c=0,f=r?+r[0]:1/0,d=r?+r[1]:-1/0;z_(i,e,t,function(R,I){var P=Math.log(R),k=Math.log(I);++a,o+=(P-o)/a,s+=(k-s)/a,l+=(P*k-l)/a,u+=(P*P-u)/a,c+=(I-c)/a,r||(R<f&&(f=R),R>d&&(d=R))});var v=x2(o,s,l,u),g=c0(v,2),x=g[0],w=g[1];x=Math.exp(x);var S=function(I){return x*Math.pow(I,w)},M=_2(f,d,S);return M.a=x,M.b=w,M.predict=S,M.rSquared=Xb(i,e,t,c,S),M}return n.domain=function(i){return arguments.length?(r=i,n):r},n.x=function(i){return arguments.length?(e=i,n):e},n.y=function(i){return arguments.length?(t=i,n):t},n}var Hte={exp:Lte,linear:kat,loess:Pte,log:Nte,poly:kte,pow:$te,quad:zat};function Vte(e,t){var r=10,n={regionStyle:[{position:{start:[e,"max"],end:["max",t]},style:{fill:"#d8d0c0",opacity:.4}},{position:{start:["min","max"],end:[e,t]},style:{fill:"#a3dda1",opacity:.4}},{position:{start:["min",t],end:[e,"min"]},style:{fill:"#d8d0c0",opacity:.4}},{position:{start:[e,t],end:["max","min"]},style:{fill:"#a3dda1",opacity:.4}}],lineStyle:{stroke:"#9ba29a",lineWidth:1},labelStyle:[{position:["max",t],offsetX:-r,offsetY:-r,style:{textAlign:"right",textBaseline:"bottom",fontSize:14,fill:"#ccc"}},{position:["min",t],offsetX:r,offsetY:-r,style:{textAlign:"left",textBaseline:"bottom",fontSize:14,fill:"#ccc"}},{position:["min",t],offsetX:r,offsetY:r,style:{textAlign:"left",textBaseline:"top",fontSize:14,fill:"#ccc"}},{position:["max",t],offsetX:-r,offsetY:r,style:{textAlign:"right",textBaseline:"top",fontSize:14,fill:"#ccc"}}]};return n}var Gte=function(e,t){var r=t.view,n=t.options,i=n.xField,a=n.yField,o=r.getScaleByField(i),s=r.getScaleByField(a),l=e.map(function(u){return r.getCoordinate().convert({x:o.scale(u[0]),y:s.scale(u[1])})});return lQt(l,!1)},Wte=function(e){var t=e.options,r=t.xField,n=t.yField,i=t.data,a=t.regressionLine,o=a.type,s=o===void 0?"linear":o,l=a.algorithm,u=a.equation,c,f=null;if(l)c=Fe(l)?l:l(i),f=u;else{var d=Hte[s]().x(function(v){return v[r]}).y(function(v){return v[n]});c=d(i),f=jte(s,c)}return[Gte(c,e),f]},Xte=function(e){var t,r=e.meta,n=r===void 0?{}:r,i=e.xField,a=e.yField,o=e.data,s=o[0][i],l=o[0][a],u=s>0,c=l>0;function f(d,v){var g=xt(n,[d]);function x(S){return xt(g,S)}var w={};return v==="x"?(Rn(s)&&(Rn(x("min"))||(w.min=u?0:s*2),Rn(x("max"))||(w.max=u?s*2:0)),w):(Rn(l)&&(Rn(x("min"))||(w.min=c?0:l*2),Rn(x("max"))||(w.max=c?l*2:0)),w)}return $($({},n),(t={},t[i]=$($({},n[i]),f(i,"x")),t[a]=$($({},n[a]),f(a,"y")),t))};function jte(e,t){var r,n,i,a=function(u,c){return c===void 0&&(c=4),Math.round(u*Math.pow(10,c))/Math.pow(10,c)},o=function(u){return Number.isFinite(u)?a(u):"?"};switch(e){case"linear":return"y = ".concat(o(t.a),"x + ").concat(o(t.b),", R^2 = ").concat(o(t.rSquared));case"exp":return"y = ".concat(o(t.a),"e^(").concat(o(t.b),"x), R^2 = ").concat(o(t.rSquared));case"log":return"y = ".concat(o(t.a),"ln(x) + ").concat(o(t.b),", R^2 = ").concat(o(t.rSquared));case"quad":return"y = ".concat(o(t.a),"x^2 + ").concat(o(t.b),"x + ").concat(o(t.c),", R^2 = ").concat(o(t.rSquared));case"poly":for(var s="y = ".concat(o((r=t.coefficients)===null||r===void 0?void 0:r[0])," + ").concat(o((n=t.coefficients)===null||n===void 0?void 0:n[1]),"x + ").concat(o((i=t.coefficients)===null||i===void 0?void 0:i[2]),"x^2"),l=3;l<t.coefficients.length;++l)s+=" + ".concat(o(t.coefficients[l]),"x^").concat(l);return"".concat(s,", R^2 = ").concat(o(t.rSquared));case"pow":return"y = ".concat(o(t.a),"x^").concat(o(t.b),", R^2 = ").concat(o(t.rSquared))}return null}function Uat(e){var t=e.data,r=t===void 0?[]:t,n=e.xField,i=e.yField;if(r.length){for(var a=!0,o=!0,s=r[0],l=void 0,u=1;u<r.length&&(l=r[u],s[n]!==l[n]&&(a=!1),s[i]!==l[i]&&(o=!1),!(!a&&!o));u++)s=l;var c=[];a&&c.push(n),o&&c.push(i);var f=Ea(Xte(e),c);return me({},e,{meta:f})}return e}function Yte(e){var t=e.chart,r=e.options,n=r.data,i=r.type,a=r.color,o=r.shape,s=r.pointStyle,l=r.shapeField,u=r.colorField,c=r.xField,f=r.yField,d=r.sizeField,v=r.size,g=r.tooltip;d&&(v||(v=[2,8]),Rn(v)&&(v=[v,v])),g&&!g.fields&&(g=$($({},g),{fields:[c,f,u,d,l]})),t.data(n),tf(me({},e,{options:{seriesField:u,point:{color:a,shape:o,size:v,style:s},tooltip:g}}));var x=vu(t,"point");return i&&x.adjust(i),e}function _M(e){var t,r=e.options,n=r.xAxis,i=r.yAxis,a=r.xField,o=r.yField,s=Uat(r);return zn(ns((t={},t[a]=n,t[o]=i,t)))(me({},e,{options:s}))}function Zte(e){var t=e.chart,r=e.options,n=r.xAxis,i=r.yAxis,a=r.xField,o=r.yField;return t.axis(a,n),t.axis(o,i),e}function qte(e){var t=e.chart,r=e.options,n=r.legend,i=r.colorField,a=r.shapeField,o=r.sizeField,s=r.shapeLegend,l=r.sizeLegend,u=n!==!1;return i&&t.legend(i,u?n:!1),a&&(s?t.legend(a,s):t.legend(a,s===!1?!1:n)),o&&t.legend(o,l||!1),!u&&!s&&!l&&t.legend(!1),e}function Kte(e){var t=e.chart,r=e.options,n=r.label,i=r.yField,a=vu(t,"point");if(!n)a.label(!1);else{var o=n.callback,s=fi(n,["callback"]);a.label({fields:[i],callback:o,cfg:Cl(s)})}return e}function Qte(e){var t=e.options,r=t.quadrant,n=[];if(r){var i=r.xBaseline,a=i===void 0?0:i,o=r.yBaseline,s=o===void 0?0:o,l=r.labels,u=r.regionStyle,c=r.lineStyle,f=Vte(a,s),d=new Array(4).join(",").split(",");d.forEach(function(v,g){n.push($($({type:"region",top:!1},f.regionStyle[g].position),{style:me({},f.regionStyle[g].style,u==null?void 0:u[g])}),$({type:"text",top:!0},me({},f.labelStyle[g],l==null?void 0:l[g])))}),n.push({type:"line",top:!1,start:["min",s],end:["max",s],style:me({},f.lineStyle,c)},{type:"line",top:!1,start:[a,"min"],end:[a,"max"],style:me({},f.lineStyle,c)})}return zn(Ao(n))(e)}function Jte(e){var t=e.options,r=e.chart,n=t.regressionLine;if(n){var i=n.style,a=n.equationStyle,o=a===void 0?{}:a,s=n.top,l=s===void 0?!1:s,u=n.showEquation,c=u===void 0?!1:u,f={stroke:"#9ba29a",lineWidth:2,opacity:.5},d={x:20,y:20,textAlign:"left",textBaseline:"middle",fontSize:14,fillOpacity:.5};r.annotation().shape({top:l,render:function(v,g){var x=v.addGroup({id:"".concat(r.id,"-regression-line"),name:"regression-line-group"}),w=Wte({view:g,options:t}),S=w[0],M=w[1];x.addShape("path",{name:"regression-line",attrs:$($({path:S},f),i)}),c&&x.addShape("text",{name:"regression-equation",attrs:$($($({},d),o),{text:M})})}})}return e}function tee(e){var t=e.chart,r=e.options,n=r.tooltip;return n?t.tooltip(n):n===!1&&t.tooltip(!1),e}function $at(e){return zn(Yte,_M,Zte,qte,tee,Kte,nat,m2,xk,xo,Qte,Ma,ea,Jte)(e)}var eee=me({},ti.getDefaultOptions(),{size:4,tooltip:{showTitle:!1,showMarkers:!1,showCrosshairs:!0,crosshairs:{type:"xy"}}});Zn("drag-move",{start:[{trigger:"plot:mousedown",action:"scale-translate:start"}],processing:[{trigger:"plot:mousemove",action:"scale-translate:translate",throttle:{wait:100,leading:!0,trailing:!1}}],end:[{trigger:"plot:mouseup",action:"scale-translate:end"}]});var Hat=function(e){$t(t,e);function t(r,n){var i=e.call(this,r,n)||this;return i.type="scatter",i.on(pi.BEFORE_RENDER,function(a){var o,s,l=i,u=l.options,c=l.chart;if(((o=a.data)===null||o===void 0?void 0:o.source)===Bc.FILTER){var f=i.chart.filterData(i.chart.getData());_M({chart:c,options:$($({},u),{data:f})})}((s=a.data)===null||s===void 0?void 0:s.source)===Bc.RESET&&_M({chart:c,options:u})}),i}return t.getDefaultOptions=function(){return eee},t.prototype.changeData=function(r){this.updateOption(Uat(me({},this.options,{data:r})));var n=this,i=n.options,a=n.chart;_M({chart:a,options:i}),this.chart.changeData(r)},t.prototype.getSchemaAdaptor=function(){return $at},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t}(ti);const vOe=Object.freeze(Object.defineProperty({__proto__:null,Scatter:Hat},Symbol.toStringTag,{value:"Module"}));var tS="$$stock-range$$",F3="trend",Vat="up",Gat="down",ree={showMarkers:!1,showCrosshairs:!0,shared:!0,crosshairs:{type:"xy",follow:!0,text:function(e,t,r){var n;if(e==="x"){var i=r[0];n=i?i.title:t}else n=t;return{position:e==="y"?"start":"end",content:n,style:{fill:"#dfdfdf"}}},textBackground:{padding:[2,4],style:{fill:"#666"}}}},nee=me({},ti.getDefaultOptions(),{tooltip:ree,interactions:[{type:"tooltip"}],legend:{position:"top-left"},risingFill:"#ef5350",fallingFill:"#26a69a"});function Wat(e,t){return fo(e,function(r){var n=r&&$({},r);if(Fe(t)&&n){var i=t[0],a=t[1],o=t[2],s=t[3];n[F3]=n[i]<=n[a]?Vat:Gat,n[tS]=[n[i],n[a],n[o],n[s]]}return n})}function iee(e){var t=e.chart,r=e.options,n=r.yField,i=r.data,a=r.risingFill,o=r.fallingFill,s=r.tooltip,l=r.stockStyle;t.data(Wat(i,n));var u=s;return u!==!1&&(u=me({},{fields:n},u)),bk(me({},e,{options:{schema:{shape:"candle",color:[a,o],style:l},yField:tS,seriesField:F3,rawFields:n,tooltip:u}})),e}function aee(e){var t,r,n=e.chart,i=e.options,a=i.meta,o=i.xAxis,s=i.yAxis,l=i.xField,u=(t={},t[l]={type:"timeCat",tickCount:6},t[F3]={values:[Vat,Gat]},t),c=me(u,a,(r={},r[l]=Ea(o,Xc),r[tS]=Ea(s,Xc),r));return n.scale(c),e}function oee(e){var t=e.chart,r=e.options,n=r.xAxis,i=r.yAxis,a=r.xField;return n===!1?t.axis(a,!1):t.axis(a,n),i===!1?t.axis(tS,!1):t.axis(tS,i),e}function see(e){var t=e.chart,r=e.options,n=r.tooltip;return n!==!1?t.tooltip(n):t.tooltip(!1),e}function lee(e){var t=e.chart,r=e.options,n=r.legend;return n?t.legend(F3,n):n===!1&&t.legend(!1),e}function Xat(e){zn(ea,iee,aee,oee,see,lee,xo,Ma,Ao(),m2)(e)}var uee=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="stock",r}return t.getDefaultOptions=function(){return nee},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return Xat},t.prototype.changeData=function(r){this.updateOption({data:r});var n=this.options.yField;this.chart.changeData(Wat(r,n))},t}(ti);function U_(e){return fo(e||[],function(t,r){return{x:"".concat(r),y:t}})}var eS="x",Ix="y",jat={showTitle:!1,shared:!0,showMarkers:!1,customContent:function(e,t){return"".concat(xt(t,[0,"data","y"],0))},containerTpl:'<div class="g2-tooltip"><div class="g2-tooltip-list"></div></div>',itemTpl:"<span>{value}</span>",domStyles:{"g2-tooltip":{padding:"2px 4px",fontSize:"10px"}},showCrosshairs:!0,crosshairs:{type:"x"}},cee={appendPadding:2,tooltip:$({},jat),animation:{}};function hee(e){var t=e.chart,r=e.options,n=r.data,i=r.color,a=r.areaStyle,o=r.point,s=r.line,l=o==null?void 0:o.state,u=U_(n);t.data(u);var c=me({},e,{options:{xField:eS,yField:Ix,area:{color:i,style:a},line:s,point:o}}),f=me({},c,{options:{tooltip:!1}}),d=me({},c,{options:{tooltip:!1,state:l}});return M3(c),Wb(f),tf(d),t.axis(!1),t.legend(!1),e}function jb(e){var t,r,n=e.options,i=n.xAxis,a=n.yAxis,o=n.data,s=U_(o);return zn(ns((t={},t[eS]=i,t[Ix]=a,t),(r={},r[eS]={type:"cat"},r[Ix]=vk(s,Ix),r)))(e)}function Yat(e){return zn(Jh("areaStyle"),hee,jb,al,ea,Ma,Ao())(e)}var fee={appendPadding:2,tooltip:$({},jat),color:"l(90) 0:#E5EDFE 1:#ffffff",areaStyle:{fillOpacity:.6},line:{size:1,color:"#5B8FF9"},animation:{}},dee=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="tiny-area",r}return t.getDefaultOptions=function(){return fee},t.prototype.changeData=function(r){this.updateOption({data:r});var n=this,i=n.chart,a=n.options;jb({chart:i,options:a}),i.changeData(U_(r))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return Yat},t}(ti);function pee(e){var t=e.chart,r=e.options,n=r.data,i=r.color,a=r.columnStyle,o=r.columnWidthRatio,s=U_(n);t.data(s);var l=me({},e,{options:{xField:eS,yField:Ix,widthRatio:o,interval:{style:a,color:i}}});return gu(l),t.axis(!1),t.legend(!1),t.interaction("element-active"),e}function Zat(e){return zn(ea,Jh("columnStyle"),pee,jb,al,Ma,Ao())(e)}var vee={showTitle:!1,shared:!0,showMarkers:!1,customContent:function(e,t){return"".concat(xt(t,[0,"data","y"],0))},containerTpl:'<div class="g2-tooltip"><div class="g2-tooltip-list"></div></div>',itemTpl:"<span>{value}</span>",domStyles:{"g2-tooltip":{padding:"2px 4px",fontSize:"10px"}}},gee={appendPadding:2,tooltip:$({},vee),animation:{}},mee=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="tiny-column",r}return t.getDefaultOptions=function(){return gee},t.prototype.changeData=function(r){this.updateOption({data:r});var n=this,i=n.chart,a=n.options;jb({chart:i,options:a}),i.changeData(U_(r))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return Zat},t}(ti);function yee(e){var t=e.chart,r=e.options,n=r.data,i=r.color,a=r.lineStyle,o=r.point,s=o==null?void 0:o.state,l=U_(n);t.data(l);var u=me({},e,{options:{xField:eS,yField:Ix,line:{color:i,style:a},point:o}}),c=me({},u,{options:{tooltip:!1,state:s}});return Wb(u),tf(c),t.axis(!1),t.legend(!1),e}function qat(e){return zn(yee,jb,ea,al,Ma,Ao())(e)}var _ee=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="tiny-line",r}return t.getDefaultOptions=function(){return cee},t.prototype.changeData=function(r){this.updateOption({data:r});var n=this,i=n.chart,a=n.options;jb({chart:i,options:a}),i.changeData(U_(r))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return qat},t}(ti),xee={line:tat,pie:Lat,column:D3,bar:aat,area:eat,gauge:Eat,"tiny-line":qat,"tiny-column":Zat,"tiny-area":Yat,"ring-progress":Nat,progress:Fat,scatter:$at,histogram:Sat,funnel:pat,stock:Xat},bee={line:Tat,pie:Oat,column:sat,bar:oat,area:rat,gauge:wat,"tiny-line":_ee,"tiny-column":mee,"tiny-area":dee,"ring-progress":Tte,progress:wte,scatter:Hat,histogram:ote,funnel:vat,stock:uee},Eee={pie:{label:!1},column:{tooltip:{showMarkers:!1}},bar:{tooltip:{showMarkers:!1}}};function aB(e,t,r){var n=bee[e];if(!n){console.error("could not find ".concat(e," plot"));return}var i=xee[e];i({chart:t,options:me({},n.getDefaultOptions(),xt(Eee,e,{}),r)})}function wee(e){var t=e.chart,r=e.options,n=r.views,i=r.legend;return ft(n,function(a){var o=a.region,s=a.data,l=a.meta,u=a.axes,c=a.coordinate,f=a.interactions,d=a.annotations,v=a.tooltip,g=a.geometries,x=t.createView({region:o});x.data(s);var w={};u&&ft(u,function(S,M){w[M]=Ea(S,Xc)}),w=me({},l,w),x.scale(w),u?ft(u,function(S,M){x.axis(M,S)}):x.axis(!1),x.coordinate(c),ft(g,function(S){var M=ch({chart:x,options:S}).ext,R=S.adjust;R&&M.geometry.adjust(R)}),ft(f,function(S){S.enable===!1?x.removeInteraction(S.type):x.interaction(S.type,S.cfg)}),ft(d,function(S){x.annotation()[S.type]($({},S))}),typeof a.animation=="boolean"?x.animate(!1):(x.animate(!0),ft(x.geometries,function(S){S.animate(a.animation)})),v&&(x.interaction("tooltip"),x.tooltip(v))}),i?ft(i,function(a,o){t.legend(o,a)}):t.legend(!1),t.tooltip(r.tooltip),e}function Cee(e){var t=e.chart,r=e.options,n=r.plots,i=r.data,a=i===void 0?[]:i;return ft(n,function(o){var s=o.type,l=o.region,u=o.options,c=u===void 0?{}:u,f=o.top,d=c.tooltip;if(f){aB(s,t,$($({},c),{data:a}));return}var v=t.createView($({region:l},Ea(c,qit)));d&&v.interaction("tooltip"),aB(s,v,$({data:a},c))}),e}function See(e){var t=e.chart,r=e.options;return t.option("slider",r.slider),e}function Tee(e){return zn(Ma,wee,Cee,xo,Ma,ea,al,See,Ao())(e)}function Aee(e,t){var r=e.getModel(),n=r.data,i;return Fe(n)?i=n[0][t]:i=n[t],i}function Mee(e){var t=$R(e);ft(t,function(r){r.hasState("active")&&r.setState("active",!1),r.hasState("selected")&&r.setState("selected",!1),r.hasState("inactive")&&r.setState("inactive",!1)})}var Ree=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getAssociationItems=function(r,n){var i,a=this.context.event,o=n||{},s=o.linkField,l=o.dim,u=[];if(!((i=a.data)===null||i===void 0)&&i.data){var c=a.data.data;ft(r,function(f){var d,v,g=s;if(l==="x"?g=f.getXScale().field:l==="y"?g=(d=f.getYScales().find(function(w){return w.field===g}))===null||d===void 0?void 0:d.field:g||(g=(v=f.getGroupScales()[0])===null||v===void 0?void 0:v.field),!!g){var x=fo($R(f),function(w){var S=!1,M=!1,R=Fe(c)?xt(c[0],g):xt(c,g);return Aee(w,g)===R?S=!0:M=!0,{element:w,view:f,active:S,inactive:M}});u.push.apply(u,x)}})}return u},t.prototype.showTooltip=function(r){var n=RW(this.context.view),i=this.getAssociationItems(n,r);ft(i,function(a){if(a.active){var o=a.element.shape.getCanvasBBox();a.view.showTooltip({x:o.minX+o.width/2,y:o.minY+o.height/2})}})},t.prototype.hideTooltip=function(){var r=RW(this.context.view);ft(r,function(n){n.hideTooltip()})},t.prototype.active=function(r){var n=zw(this.context.view),i=this.getAssociationItems(n,r);ft(i,function(a){var o=a.active,s=a.element;o&&s.setState("active",!0)})},t.prototype.selected=function(r){var n=zw(this.context.view),i=this.getAssociationItems(n,r);ft(i,function(a){var o=a.active,s=a.element;o&&s.setState("selected",!0)})},t.prototype.highlight=function(r){var n=zw(this.context.view),i=this.getAssociationItems(n,r);ft(i,function(a){var o=a.inactive,s=a.element;o&&s.setState("inactive",!0)})},t.prototype.reset=function(){var r=zw(this.context.view);ft(r,function(n){Mee(n)})},t}(io);yn("association",Ree);Zn("association-active",{start:[{trigger:"element:mouseenter",action:"association:active"}],end:[{trigger:"element:mouseleave",action:"association:reset"}]});Zn("association-selected",{start:[{trigger:"element:mouseenter",action:"association:selected"}],end:[{trigger:"element:mouseleave",action:"association:reset"}]});Zn("association-highlight",{start:[{trigger:"element:mouseenter",action:"association:highlight"}],end:[{trigger:"element:mouseleave",action:"association:reset"}]});Zn("association-tooltip",{start:[{trigger:"element:mousemove",action:"association:showTooltip"}],end:[{trigger:"element:mouseleave",action:"association:hideTooltip"}]});var Iee=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="mix",r}return t.prototype.getSchemaAdaptor=function(){return Tee},t}(ti);const gOe=Object.freeze(Object.defineProperty({__proto__:null,Mix:Iee},Symbol.toStringTag,{value:"Module"}));var BW;(function(e){e.DEV="DEV",e.BETA="BETA",e.STABLE="STABLE"})(BW||(BW={}));var rv="first-axes-view",nv="second-axes-view",Py="series-field-key";function Kat(e,t,r,n,i){var a=[];t.forEach(function(f){n.forEach(function(d){var v,g=(v={},v[e]=d[e],v[r]=f,v[f]=d[f],v);a.push(g)})});var o=Object.values(Qc(a,r)),s=o[0],l=s===void 0?[]:s,u=o[1],c=u===void 0?[]:u;return i?[l.reverse(),c.reverse()]:[l,c]}function lg(e){return e!=="vertical"}function Lee(e,t,r){var n=t[0],i=t[1],a=n.autoPadding,o=i.autoPadding,s=e.__axisPosition,l=s.layout,u=s.position;if(lg(l)&&u==="top"&&(n.autoPadding=r.instance(a.top,0,a.bottom,a.left),i.autoPadding=r.instance(o.top,a.left,o.bottom,0)),lg(l)&&u==="bottom"&&(n.autoPadding=r.instance(a.top,a.right/2+5,a.bottom,a.left),i.autoPadding=r.instance(o.top,o.right,o.bottom,a.right/2+5)),!lg(l)&&u==="bottom"){var c=a.left>=o.left?a.left:o.left;n.autoPadding=r.instance(a.top,a.right,a.bottom/2+5,c),i.autoPadding=r.instance(a.bottom/2+5,o.right,o.bottom,c)}if(!lg(l)&&u==="top"){var c=a.left>=o.left?a.left:o.left;n.autoPadding=r.instance(a.top,a.right,0,c),i.autoPadding=r.instance(0,o.right,a.top,c)}}function Oee(e){var t=e.chart,r=e.options,n=r.data,i=r.xField,a=r.yField,o=r.color,s=r.barStyle,l=r.widthRatio,u=r.legend,c=r.layout,f=Kat(i,a,Py,n,lg(c));u?t.legend(Py,u):u===!1&&t.legend(!1);var d,v,g=f[0],x=f[1];lg(c)?(d=t.createView({region:{start:{x:0,y:0},end:{x:.5,y:1}},id:rv}),d.coordinate().transpose().reflect("x"),v=t.createView({region:{start:{x:.5,y:0},end:{x:1,y:1}},id:nv}),v.coordinate().transpose(),d.data(g),v.data(x)):(d=t.createView({region:{start:{x:0,y:0},end:{x:1,y:.5}},id:rv}),v=t.createView({region:{start:{x:0,y:.5},end:{x:1,y:1}},id:nv}),v.coordinate().reflect("y"),d.data(g),v.data(x));var w=me({},e,{chart:d,options:{widthRatio:l,xField:i,yField:a[0],seriesField:Py,interval:{color:o,style:s}}});gu(w);var S=me({},e,{chart:v,options:{xField:i,yField:a[1],seriesField:Py,widthRatio:l,interval:{color:o,style:s}}});return gu(S),e}function Pee(e){var t,r,n,i=e.options,a=e.chart,o=i.xAxis,s=i.yAxis,l=i.xField,u=i.yField,c=_i(a,rv),f=_i(a,nv),d={};return P_((i==null?void 0:i.meta)||{}).map(function(v){xt(i==null?void 0:i.meta,[v,"alias"])&&(d[v]=i.meta[v].alias)}),a.scale((t={},t[Py]={sync:!0,formatter:function(v){return xt(d,v,v)}},t)),ns((r={},r[l]=o,r[u[0]]=s[u[0]],r))(me({},e,{chart:c})),ns((n={},n[l]=o,n[u[1]]=s[u[1]],n))(me({},e,{chart:f})),e}function Dee(e){var t=e.chart,r=e.options,n=r.xAxis,i=r.yAxis,a=r.xField,o=r.yField,s=r.layout,l=_i(t,rv),u=_i(t,nv);return(n==null?void 0:n.position)==="bottom"?u.axis(a,$($({},n),{label:{formatter:function(){return""}}})):u.axis(a,!1),n===!1?l.axis(a,!1):l.axis(a,$({position:lg(s)?"top":"bottom"},n)),i===!1?(l.axis(o[0],!1),u.axis(o[1],!1)):(l.axis(o[0],i[o[0]]),u.axis(o[1],i[o[1]])),t.__axisPosition={position:l.getOptions().axes[a].position,layout:s},e}function Fee(e){var t=e.chart;return xo(me({},e,{chart:_i(t,rv)})),xo(me({},e,{chart:_i(t,nv)})),e}function Bee(e){var t=e.chart,r=e.options,n=r.yField,i=r.yAxis;return d_(me({},e,{chart:_i(t,rv),options:{yAxis:i[n[0]]}})),d_(me({},e,{chart:_i(t,nv),options:{yAxis:i[n[1]]}})),e}function Nee(e){var t=e.chart;return ea(me({},e,{chart:_i(t,rv)})),ea(me({},e,{chart:_i(t,nv)})),ea(e),e}function kee(e){var t=e.chart;return Ma(me({},e,{chart:_i(t,rv)})),Ma(me({},e,{chart:_i(t,nv)})),e}function zee(e){var t=this,r,n,i=e.chart,a=e.options,o=a.label,s=a.yField,l=a.layout,u=_i(i,rv),c=_i(i,nv),f=vu(u,"interval"),d=vu(c,"interval");if(!o)f.label(!1),d.label(!1);else{var v=o.callback,g=fi(o,["callback"]);g.position||(g.position="middle"),g.offset===void 0&&(g.offset=2);var x=$({},g);if(lg(l)){var w=((r=x.style)===null||r===void 0?void 0:r.textAlign)||(g.position==="middle"?"center":"left");g.style=me({},g.style,{textAlign:w});var S={left:"right",right:"left",center:"center"};x.style=me({},x.style,{textAlign:S[w]})}else{var M={top:"bottom",bottom:"top",middle:"middle"};typeof g.position=="string"?g.position=M[g.position]:typeof g.position=="function"&&(g.position=function(){for(var P=[],k=0;k<arguments.length;k++)P[k]=arguments[k];return M[g.position.apply(t,P)]});var R=((n=x.style)===null||n===void 0?void 0:n.textBaseline)||"bottom";x.style=me({},x.style,{textBaseline:R});var I={top:"bottom",bottom:"top",middle:"middle"};g.style=me({},g.style,{textBaseline:I[R]})}f.label({fields:[s[0]],callback:v,cfg:Cl(x)}),d.label({fields:[s[1]],callback:v,cfg:Cl(g)})}return e}function Uee(e){return zn(Oee,Pee,Dee,Bee,Nee,zee,al,Fee,kee)(e)}var $ee=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="bidirectional-bar",r}return t.getDefaultOptions=function(){return me({},e.getDefaultOptions.call(this),{syncViewPadding:Lee})},t.prototype.changeData=function(r){r===void 0&&(r=[]),this.chart.emit(pi.BEFORE_CHANGE_DATA,To.fromData(this.chart,pi.BEFORE_CHANGE_DATA,null)),this.updateOption({data:r});var n=this.options,i=n.xField,a=n.yField,o=n.layout,s=Kat(i,a,Py,r,lg(o)),l=s[0],u=s[1],c=_i(this.chart,rv),f=_i(this.chart,nv);c.data(l),f.data(u),this.chart.render(!0),this.chart.emit(pi.AFTER_CHANGE_DATA,To.fromData(this.chart,pi.AFTER_CHANGE_DATA,null))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return Uee},t.SERIES_FIELD_KEY=Py,t}(ti);const mOe=Object.freeze(Object.defineProperty({__proto__:null,BidirectionalBar:$ee},Symbol.toStringTag,{value:"Module"}));var AP,fb="$$range$$",Hee="low-q1-median-q3-high",Vee="$$y_outliers$$",Qat="outliers_view",Gee=me({},ti.getDefaultOptions(),{meta:(AP={},AP[fb]={min:0,alias:Hee},AP),interactions:[{type:"active-region"}],tooltip:{showMarkers:!1,shared:!0},boxStyle:{lineWidth:1}}),Jat=function(e,t){var r=e;if(Array.isArray(t)){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4];r=fo(e,function(l){return l[fb]=[l[n],l[i],l[a],l[o],l[s]],l})}return r};function Wee(e){var t=e.chart,r=e.options,n=r.xField,i=r.yField,a=r.groupField,o=r.color,s=r.tooltip,l=r.boxStyle;t.data(Jat(r.data,i));var u=Fe(i)?fb:i,c=i?Fe(i)?i:[i]:[],f=s;f!==!1&&(f=me({},{fields:Fe(i)?i:[]},f));var d=bk(me({},e,{options:{xField:n,yField:u,seriesField:a,tooltip:f,rawFields:c,label:!1,schema:{shape:"box",color:o,style:l}}})).ext;return a&&d.geometry.adjust("dodge"),e}function Xee(e){var t=e.chart,r=e.options,n=r.xField,i=r.data,a=r.outliersField,o=r.outliersStyle,s=r.padding,l=r.label;if(!a)return e;var u=t.createView({padding:s,id:Qat}),c=i.reduce(function(f,d){var v=d[a];return v.forEach(function(g){var x;return f.push($($({},d),(x={},x[a]=g,x)))}),f},[]);return u.data(c),tf({chart:u,options:{xField:n,yField:a,point:{shape:"circle",style:o},label:l}}),u.axis(!1),e}function jee(e){var t,r,n=e.chart,i=e.options,a=i.meta,o=i.xAxis,s=i.yAxis,l=i.xField,u=i.yField,c=i.outliersField,f=Array.isArray(u)?fb:u,d={};if(c){var v=Vee;d=(t={},t[c]={sync:v,nice:!0},t[f]={sync:v,nice:!0},t)}var g=me(d,a,(r={},r[l]=Ea(o,Xc),r[f]=Ea(s,Xc),r));return n.scale(g),e}function Yee(e){var t=e.chart,r=e.options,n=r.xAxis,i=r.yAxis,a=r.xField,o=r.yField,s=Array.isArray(o)?fb:o;return n===!1?t.axis(a,!1):t.axis(a,n),i===!1?t.axis(fb,!1):t.axis(s,i),e}function Zee(e){var t=e.chart,r=e.options,n=r.legend,i=r.groupField;return i?n?t.legend(i,n):t.legend(i,{position:"bottom"}):t.legend(!1),e}function qee(e){return zn(Wee,Xee,jee,Yee,Zee,al,Ao(),xo,Ma,ea)(e)}(function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="box",r}return t.getDefaultOptions=function(){return Gee},t.prototype.changeData=function(r){this.updateOption({data:r});var n=this.options.yField,i=this.chart.views.find(function(a){return a.id===Qat});i&&i.data(r),this.chart.changeData(Jat(r,n))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return qee},t})(ti);function NW(e,t,r){return e.length>1?"".concat(t,"_").concat(r):"".concat(t)}function tot(e){var t=e.data,r=e.xField,n=e.measureField,i=e.rangeField,a=e.targetField,o=e.layout,s=[],l=[];t.forEach(function(f,d){var v=[f[i]].flat();v.sort(function(w,S){return w-S}),v.forEach(function(w,S){var M,R=S===0?w:v[S]-v[S-1];s.push((M={rKey:"".concat(i,"_").concat(S)},M[r]=r?f[r]:String(d),M[i]=R,M))});var g=[f[n]].flat();g.forEach(function(w,S){var M;s.push((M={mKey:NW(g,n,S)},M[r]=r?f[r]:String(d),M[n]=w,M))});var x=[f[a]].flat();x.forEach(function(w,S){var M;s.push((M={tKey:NW(x,a,S)},M[r]=r?f[r]:String(d),M[a]=w,M))}),l.push(f[i],f[n],f[a])});var u=Math.min.apply(Math,l.flat(1/0)),c=Math.max.apply(Math,l.flat(1/0));return u=u>0?0:u,o==="vertical"&&s.reverse(),{min:u,max:c,ds:s}}function Kee(e){var t=e.chart,r=e.options,n=r.bulletStyle,i=r.targetField,a=r.rangeField,o=r.measureField,s=r.xField,l=r.color,u=r.layout,c=r.size,f=r.label,d=tot(r),v=d.min,g=d.max,x=d.ds;t.data(x);var w=me({},e,{options:{xField:s,yField:a,seriesField:"rKey",isStack:!0,label:xt(f,"range"),interval:{color:xt(l,"range"),style:xt(n,"range"),size:xt(c,"range")}}});gu(w),t.geometries[0].tooltip(!1);var S=me({},e,{options:{xField:s,yField:o,seriesField:"mKey",isStack:!0,label:xt(f,"measure"),interval:{color:xt(l,"measure"),style:xt(n,"measure"),size:xt(c,"measure")}}});gu(S);var M=me({},e,{options:{xField:s,yField:i,seriesField:"tKey",label:xt(f,"target"),point:{color:xt(l,"target"),style:xt(n,"target"),size:Rr(xt(c,"target"))?function(R){return xt(c,"target")(R)/2}:xt(c,"target")/2,shape:u==="horizontal"?"line":"hyphen"}}});return tf(M),u==="horizontal"&&t.coordinate().transpose(),$($({},e),{ext:{data:{min:v,max:g}}})}function eot(e){var t,r,n=e.options,i=e.ext,a=n.xAxis,o=n.yAxis,s=n.targetField,l=n.rangeField,u=n.measureField,c=n.xField,f=i.data;return zn(ns((t={},t[c]=a,t[u]=o,t),(r={},r[u]={min:f==null?void 0:f.min,max:f==null?void 0:f.max,sync:!0},r[s]={sync:"".concat(u)},r[l]={sync:"".concat(u)},r)))(e)}function Qee(e){var t=e.chart,r=e.options,n=r.xAxis,i=r.yAxis,a=r.xField,o=r.measureField,s=r.rangeField,l=r.targetField;return t.axis("".concat(s),!1),t.axis("".concat(l),!1),n===!1?t.axis("".concat(a),!1):t.axis("".concat(a),n),i===!1?t.axis("".concat(o),!1):t.axis("".concat(o),i),e}function Jee(e){var t=e.chart,r=e.options,n=r.legend;return t.removeInteraction("legend-filter"),t.legend(n),t.legend("rKey",!1),t.legend("mKey",!1),t.legend("tKey",!1),e}function tre(e){var t=e.chart,r=e.options,n=r.label,i=r.measureField,a=r.targetField,o=r.rangeField,s=t.geometries,l=s[0],u=s[1],c=s[2];return xt(n,"range")?l.label("".concat(o),$({layout:[{type:"limit-in-plot"}]},Cl(n.range))):l.label(!1),xt(n,"measure")?u.label("".concat(i),$({layout:[{type:"limit-in-plot"}]},Cl(n.measure))):u.label(!1),xt(n,"target")?c.label("".concat(a),$({layout:[{type:"limit-in-plot"}]},Cl(n.target))):c.label(!1),e}function ere(e){zn(Kee,eot,Qee,Jee,ea,tre,al,xo,Ma)(e)}var rre=me({},ti.getDefaultOptions(),{layout:"horizontal",size:{range:30,measure:20,target:20},xAxis:{tickLine:!1,line:null},bulletStyle:{range:{fillOpacity:.5}},label:{measure:{position:"right"}},tooltip:{showMarkers:!1}}),nre=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="bullet",r}return t.getDefaultOptions=function(){return rre},t.prototype.changeData=function(r){this.updateOption({data:r});var n=tot(this.options),i=n.min,a=n.max,o=n.ds;eot({options:this.options,ext:{data:{min:i,max:a}},chart:this.chart}),this.chart.changeData(o)},t.prototype.getSchemaAdaptor=function(){return ere},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t}(ti);const yOe=Object.freeze(Object.defineProperty({__proto__:null,Bullet:nre},Symbol.toStringTag,{value:"Module"}));var ire={y:0,nodeWidthRatio:.05,weight:!1,nodePaddingRatio:.1,id:function(e){return e.id},source:function(e){return e.source},target:function(e){return e.target},sourceWeight:function(e){return e.value||1},targetWeight:function(e){return e.value||1},sortBy:null};function are(e,t,r){ft(e,function(n,i){n.inEdges=t.filter(function(a){return"".concat(r.target(a))==="".concat(i)}),n.outEdges=t.filter(function(a){return"".concat(r.source(a))==="".concat(i)}),n.edges=n.outEdges.concat(n.inEdges),n.frequency=n.edges.length,n.value=0,n.inEdges.forEach(function(a){n.value+=r.targetWeight(a)}),n.outEdges.forEach(function(a){n.value+=r.sourceWeight(a)})})}function ore(e,t){var r={weight:function(i,a){return a.value-i.value},frequency:function(i,a){return a.frequency-i.frequency},id:function(i,a){return"".concat(t.id(i)).localeCompare("".concat(t.id(a)))}},n=r[t.sortBy];!n&&Rr(t.sortBy)&&(n=t.sortBy),n&&e.sort(n)}function sre(e,t){var r=e.length;if(!r)throw new TypeError("Invalid nodes: it's empty!");if(t.weight){var n=t.nodePaddingRatio;if(n<0||n>=1)throw new TypeError("Invalid nodePaddingRatio: it must be in range [0, 1)!");var i=n/(2*r),a=t.nodeWidthRatio;if(a<=0||a>=1)throw new TypeError("Invalid nodeWidthRatio: it must be in range (0, 1)!");var o=0;e.forEach(function(l){o+=l.value}),e.forEach(function(l){l.weight=l.value/o,l.width=l.weight*(1-n),l.height=a}),e.forEach(function(l,u){for(var c=0,f=u-1;f>=0;f--)c+=e[f].width+2*i;var d=l.minX=i+c,v=l.maxX=l.minX+l.width,g=l.minY=t.y-a/2,x=l.maxY=g+a;l.x=[d,v,v,d],l.y=[g,g,x,x]})}else{var s=1/r;e.forEach(function(l,u){l.x=(u+.5)*s,l.y=t.y})}return e}function lre(e,t,r){if(r.weight){var n={};ft(e,function(i,a){n[a]=i.value}),t.forEach(function(i){var a=r.source(i),o=r.target(i),s=e[a],l=e[o];if(s&&l){var u=n[a],c=r.sourceWeight(i),f=s.minX+(s.value-u)/s.value*s.width,d=f+c/s.value*s.width;n[a]-=c;var v=n[o],g=r.targetWeight(i),x=l.minX+(l.value-v)/l.value*l.width,w=x+g/l.value*l.width;n[o]-=g;var S=r.y;i.x=[f,d,x,w],i.y=[S,S,S,S],i.source=s,i.target=l}})}else t.forEach(function(i){var a=e[r.source(i)],o=e[r.target(i)];a&&o&&(i.x=[a.x,o.x],i.y=[a.y,o.y],i.source=a,i.target=o)});return t}function ure(e){return Qi({},ire,e)}function cre(e,t){var r=ure(e),n={},i=t.nodes,a=t.links;i.forEach(function(l){var u=r.id(l);n[u]=l}),are(n,a,r),ore(i,r);var o=sre(i,r),s=lre(n,a,r);return{nodes:o,links:s}}var rot="x",not="y",iot="name",aot="source",hre={nodeStyle:{opacity:1,fillOpacity:1,lineWidth:1},edgeStyle:{opacity:.5,lineWidth:2},label:{fields:["x","name"],callback:function(e,t){var r=(e[0]+e[1])/2,n=r>.5?-4:4;return{offsetX:n,content:t}},labelEmit:!0,style:{fill:"#8c8c8c"}},tooltip:{showTitle:!1,showMarkers:!1,fields:["source","target","value","isNode"],showContent:function(e){return!xt(e,[0,"data","isNode"])},formatter:function(e){var t=e.source,r=e.target,n=e.value;return{name:"".concat(t," -> ").concat(r),value:n}}},interactions:[{type:"element-active"}],weight:!0,nodePaddingRatio:.1,nodeWidthRatio:.05};function fre(e){var t=e.options,r=t.data,n=t.sourceField,i=t.targetField,a=t.weightField,o=t.nodePaddingRatio,s=t.nodeWidthRatio,l=t.rawFields,u=l===void 0?[]:l,c=Bit(r,n,i,a),f=cre({weight:!0,nodePaddingRatio:o,nodeWidthRatio:s},c),d=f.nodes,v=f.links,g=d.map(function(w){return $($({},Ea(w,on(["id","x","y","name"],u,!0))),{isNode:!0})}),x=v.map(function(w){return $($({source:w.source.name,target:w.target.name,name:w.source.name||w.target.name},Ea(w,on(["x","y","value"],u,!0))),{isNode:!1})});return $($({},e),{ext:$($({},e.ext),{chordData:{nodesData:g,edgesData:x}})})}function dre(e){var t,r=e.chart;return r.scale((t={x:{sync:!0,nice:!0},y:{sync:!0,nice:!0,max:1}},t[iot]={sync:"color"},t[aot]={sync:"color"},t)),e}function pre(e){var t=e.chart;return t.axis(!1),e}function vre(e){var t=e.chart;return t.legend(!1),e}function gre(e){var t=e.chart,r=e.options,n=r.tooltip;return t.tooltip(n),e}function mre(e){var t=e.chart;return t.coordinate("polar").reflect("y"),e}function yre(e){var t=e.chart,r=e.options,n=e.ext.chordData.nodesData,i=r.nodeStyle,a=r.label,o=r.tooltip,s=t.createView();return s.data(n),R3({chart:s,options:{xField:rot,yField:not,seriesField:iot,polygon:{style:i},label:a,tooltip:o}}),e}function _re(e){var t=e.chart,r=e.options,n=e.ext.chordData.edgesData,i=r.edgeStyle,a=r.tooltip,o=t.createView();o.data(n);var s={xField:rot,yField:not,seriesField:aot,edge:{style:i,shape:"arc"},tooltip:a};return Xit({chart:o,options:s}),e}function xre(e){var t=e.chart,r=e.options,n=r.animation;return g2(t,n,rQt(t)),e}function bre(e){return zn(ea,fre,mre,dre,pre,vre,gre,_re,yre,xo,S0,xre)(e)}(function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="chord",r}return t.getDefaultOptions=function(){return hre},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return bre},t})(ti);var Ere=["x","y","r","name","value","path","depth"],wre={colorField:"name",autoFit:!0,pointStyle:{lineWidth:0,stroke:"#fff"},legend:!1,hierarchyConfig:{size:[1,1],padding:0},label:{fields:["name"],layout:{type:"limit-in-shape"}},tooltip:{showMarkers:!1,showTitle:!1},drilldown:{enabled:!1}},kW=4,Cre=0,zW=5,UW="drilldown-bread-crumb",Sre={position:"top-left",dividerText:"/",textStyle:{fontSize:12,fill:"rgba(0, 0, 0, 0.65)",cursor:"pointer"},activeTextStyle:{fill:"#87B5FF"}},rS="hierarchy-data-transform-params",Tre=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.name="drill-down",r.historyCache=[],r.breadCrumbGroup=null,r.breadCrumbCfg=Sre,r}return t.prototype.click=function(){var r=xt(this.context,["event","data","data"]);if(!r)return!1;this.drill(r),this.drawBreadCrumb()},t.prototype.resetPosition=function(){if(this.breadCrumbGroup){var r=this.context.view.getCoordinate(),n=this.breadCrumbGroup,i=n.getBBox(),a=this.getButtonCfg().position,o={x:r.start.x,y:r.end.y-(i.height+zW*2)};r.isPolar&&(o={x:0,y:0}),a==="bottom-left"&&(o={x:r.start.x,y:r.start.y});var s=ih.transform(null,[["t",o.x+Cre,o.y+i.height+zW]]);n.setMatrix(s)}},t.prototype.back=function(){il(this.historyCache)&&this.backTo(this.historyCache.slice(0,-1))},t.prototype.reset=function(){this.historyCache[0]&&this.backTo(this.historyCache.slice(0,1)),this.historyCache=[],this.hideCrumbGroup()},t.prototype.drill=function(r){var n=this.context.view,i=xt(n,["interactions","drill-down","cfg","transformData"],function(u){return u}),a=i($({data:r.data},r[rS]));n.changeData(a);for(var o=[],s=r;s;){var l=s.data;o.unshift({id:"".concat(l.name,"_").concat(s.height,"_").concat(s.depth),name:l.name,children:i($({data:l},r[rS]))}),s=s.parent}this.historyCache=(this.historyCache||[]).slice(0,-1).concat(o)},t.prototype.backTo=function(r){if(!(!r||r.length<=0)){var n=this.context.view,i=Ds(r).children;n.changeData(i),r.length>1?(this.historyCache=r,this.drawBreadCrumb()):(this.historyCache=[],this.hideCrumbGroup())}},t.prototype.getButtonCfg=function(){var r=this.context.view,n=xt(r,["interactions","drill-down","cfg","drillDownConfig"]);return me(this.breadCrumbCfg,n==null?void 0:n.breadCrumb,this.cfg)},t.prototype.drawBreadCrumb=function(){this.drawBreadCrumbGroup(),this.resetPosition(),this.breadCrumbGroup.show()},t.prototype.drawBreadCrumbGroup=function(){var r=this,n=this.getButtonCfg(),i=this.historyCache;this.breadCrumbGroup?this.breadCrumbGroup.clear():this.breadCrumbGroup=this.context.view.foregroundGroup.addGroup({name:UW});var a=0;i.forEach(function(o,s){var l=r.breadCrumbGroup.addShape({type:"text",id:o.id,name:"".concat(UW,"_").concat(o.name,"_text"),attrs:$($({text:s===0&&!ze(n.rootText)?n.rootText:o.name},n.textStyle),{x:a,y:0})}),u=l.getBBox();if(a+=u.width+kW,l.on("click",function(d){var v,g=d.target.get("id");if(g!==((v=Ds(i))===null||v===void 0?void 0:v.id)){var x=i.slice(0,i.findIndex(function(w){return w.id===g})+1);r.backTo(x)}}),l.on("mouseenter",function(d){var v,g=d.target.get("id");g!==((v=Ds(i))===null||v===void 0?void 0:v.id)?l.attr(n.activeTextStyle):l.attr({cursor:"default"})}),l.on("mouseleave",function(){l.attr(n.textStyle)}),s<i.length-1){var c=r.breadCrumbGroup.addShape({type:"text",name:"".concat(n.name,"_").concat(o.name,"_divider"),attrs:$($({text:n.dividerText},n.textStyle),{x:a,y:0})}),f=c.getBBox();a+=f.width+kW}})},t.prototype.hideCrumbGroup=function(){this.breadCrumbGroup&&this.breadCrumbGroup.hide()},t.prototype.destroy=function(){this.breadCrumbGroup&&this.breadCrumbGroup.remove(),e.prototype.destroy.call(this)},t}(io);function Are(e,t){return e.parent===t.parent?1:2}function Mre(e){return e.reduce(Rre,0)/e.length}function Rre(e,t){return e+t.x}function Ire(e){return 1+e.reduce(Lre,0)}function Lre(e,t){return Math.max(e,t.y)}function Ore(e){for(var t;t=e.children;)e=t[0];return e}function Pre(e){for(var t;t=e.children;)e=t[t.length-1];return e}function Dre(){var e=Are,t=1,r=1,n=!1;function i(a){var o,s=0;a.eachAfter(function(d){var v=d.children;v?(d.x=Mre(v),d.y=Ire(v)):(d.x=o?s+=e(d,o):0,d.y=0,o=d)});var l=Ore(a),u=Pre(a),c=l.x-e(l,u)/2,f=u.x+e(u,l)/2;return a.eachAfter(n?function(d){d.x=(d.x-a.x)*t,d.y=(a.y-d.y)*r}:function(d){d.x=(d.x-c)/(f-c)*t,d.y=(1-(a.y?d.y/a.y:1))*r})}return i.separation=function(a){return arguments.length?(e=a,i):e},i.size=function(a){return arguments.length?(n=!1,t=+a[0],r=+a[1],i):n?null:[t,r]},i.nodeSize=function(a){return arguments.length?(n=!0,t=+a[0],r=+a[1],i):n?[t,r]:null},i}function Fre(e){var t=0,r=e.children,n=r&&r.length;if(!n)t=1;else for(;--n>=0;)t+=r[n].value;e.value=t}function Bre(){return this.eachAfter(Fre)}function Nre(e,t){let r=-1;for(const n of this)e.call(t,n,++r,this);return this}function kre(e,t){for(var r=this,n=[r],i,a,o=-1;r=n.pop();)if(e.call(t,r,++o,this),i=r.children)for(a=i.length-1;a>=0;--a)n.push(i[a]);return this}function zre(e,t){for(var r=this,n=[r],i=[],a,o,s,l=-1;r=n.pop();)if(i.push(r),a=r.children)for(o=0,s=a.length;o<s;++o)n.push(a[o]);for(;r=i.pop();)e.call(t,r,++l,this);return this}function Ure(e,t){let r=-1;for(const n of this)if(e.call(t,n,++r,this))return n}function $re(e){return this.eachAfter(function(t){for(var r=+e(t.data)||0,n=t.children,i=n&&n.length;--i>=0;)r+=n[i].value;t.value=r})}function Hre(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})}function Vre(e){for(var t=this,r=Gre(t,e),n=[t];t!==r;)t=t.parent,n.push(t);for(var i=n.length;e!==r;)n.splice(i,0,e),e=e.parent;return n}function Gre(e,t){if(e===t)return e;var r=e.ancestors(),n=t.ancestors(),i=null;for(e=r.pop(),t=n.pop();e===t;)i=e,e=r.pop(),t=n.pop();return i}function Wre(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t}function Xre(){return Array.from(this)}function jre(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e}function Yre(){var e=this,t=[];return e.each(function(r){r!==e&&t.push({source:r.parent,target:r})}),t}function*Zre(){var e=this,t,r=[e],n,i,a;do for(t=r.reverse(),r=[];e=t.pop();)if(yield e,n=e.children)for(i=0,a=n.length;i<a;++i)r.push(n[i]);while(r.length)}function Yb(e,t){e instanceof Map?(e=[void 0,e],t===void 0&&(t=Qre)):t===void 0&&(t=Kre);for(var r=new db(e),n,i=[r],a,o,s,l;n=i.pop();)if((o=t(n.data))&&(l=(o=Array.from(o)).length))for(n.children=o,s=l-1;s>=0;--s)i.push(a=o[s]=new db(o[s])),a.parent=n,a.depth=n.depth+1;return r.eachBefore(oot)}function qre(){return Yb(this).eachBefore(Jre)}function Kre(e){return e.children}function Qre(e){return Array.isArray(e)?e[1]:null}function Jre(e){e.data.value!==void 0&&(e.value=e.data.value),e.data=e.data.data}function oot(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function db(e){this.data=e,this.depth=this.height=0,this.parent=null}db.prototype=Yb.prototype={constructor:db,count:Bre,each:Nre,eachAfter:zre,eachBefore:kre,find:Ure,sum:$re,sort:Hre,path:Vre,ancestors:Wre,descendants:Xre,leaves:jre,links:Yre,copy:qre,[Symbol.iterator]:Zre};function tne(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function ene(e){for(var t=e.length,r,n;t;)n=Math.random()*t--|0,r=e[t],e[t]=e[n],e[n]=r;return e}function sot(e){for(var t=0,r=(e=ene(Array.from(e))).length,n=[],i,a;t<r;)i=e[t],a&&lot(a,i)?++t:(a=nne(n=rne(n,i)),t=0);return a}function rne(e,t){var r,n;if(MP(t,e))return[t];for(r=0;r<e.length;++r)if(MA(t,e[r])&&MP(Uw(e[r],t),e))return[e[r],t];for(r=0;r<e.length-1;++r)for(n=r+1;n<e.length;++n)if(MA(Uw(e[r],e[n]),t)&&MA(Uw(e[r],t),e[n])&&MA(Uw(e[n],t),e[r])&&MP(uot(e[r],e[n],t),e))return[e[r],e[n],t];throw new Error}function MA(e,t){var r=e.r-t.r,n=t.x-e.x,i=t.y-e.y;return r<0||r*r<n*n+i*i}function lot(e,t){var r=e.r-t.r+Math.max(e.r,t.r,1)*1e-9,n=t.x-e.x,i=t.y-e.y;return r>0&&r*r>n*n+i*i}function MP(e,t){for(var r=0;r<t.length;++r)if(!lot(e,t[r]))return!1;return!0}function nne(e){switch(e.length){case 1:return ine(e[0]);case 2:return Uw(e[0],e[1]);case 3:return uot(e[0],e[1],e[2])}}function ine(e){return{x:e.x,y:e.y,r:e.r}}function Uw(e,t){var r=e.x,n=e.y,i=e.r,a=t.x,o=t.y,s=t.r,l=a-r,u=o-n,c=s-i,f=Math.sqrt(l*l+u*u);return{x:(r+a+l/f*c)/2,y:(n+o+u/f*c)/2,r:(f+i+s)/2}}function uot(e,t,r){var n=e.x,i=e.y,a=e.r,o=t.x,s=t.y,l=t.r,u=r.x,c=r.y,f=r.r,d=n-o,v=n-u,g=i-s,x=i-c,w=l-a,S=f-a,M=n*n+i*i-a*a,R=M-o*o-s*s+l*l,I=M-u*u-c*c+f*f,P=v*g-d*x,k=(g*I-x*R)/(P*2)-n,z=(x*w-g*S)/P,G=(v*R-d*I)/(P*2)-i,J=(d*S-v*w)/P,Z=z*z+J*J-1,X=2*(a+k*z+G*J),et=k*k+G*G-a*a,at=-(Z?(X+Math.sqrt(X*X-4*Z*et))/(2*Z):et/X);return{x:n+k+z*at,y:i+G+J*at,r:at}}function $W(e,t,r){var n=e.x-t.x,i,a,o=e.y-t.y,s,l,u=n*n+o*o;u?(a=t.r+r.r,a*=a,l=e.r+r.r,l*=l,a>l?(i=(u+l-a)/(2*u),s=Math.sqrt(Math.max(0,l/u-i*i)),r.x=e.x-i*n-s*o,r.y=e.y-i*o+s*n):(i=(u+a-l)/(2*u),s=Math.sqrt(Math.max(0,a/u-i*i)),r.x=t.x+i*n-s*o,r.y=t.y+i*o+s*n)):(r.x=t.x+r.r,r.y=t.y)}function HW(e,t){var r=e.r+t.r-1e-6,n=t.x-e.x,i=t.y-e.y;return r>0&&r*r>n*n+i*i}function VW(e){var t=e._,r=e.next._,n=t.r+r.r,i=(t.x*r.r+r.x*t.r)/n,a=(t.y*r.r+r.y*t.r)/n;return i*i+a*a}function RA(e){this._=e,this.next=null,this.previous=null}function cot(e){if(!(i=(e=tne(e)).length))return 0;var t,r,n,i,a,o,s,l,u,c,f;if(t=e[0],t.x=0,t.y=0,!(i>1))return t.r;if(r=e[1],t.x=-r.r,r.x=t.r,r.y=0,!(i>2))return t.r+r.r;$W(r,t,n=e[2]),t=new RA(t),r=new RA(r),n=new RA(n),t.next=n.previous=r,r.next=t.previous=n,n.next=r.previous=t;t:for(s=3;s<i;++s){$W(t._,r._,n=e[s]),n=new RA(n),l=r.next,u=t.previous,c=r._.r,f=t._.r;do if(c<=f){if(HW(l._,n._)){r=l,t.next=r,r.previous=t,--s;continue t}c+=l._.r,l=l.next}else{if(HW(u._,n._)){t=u,t.next=r,r.previous=t,--s;continue t}f+=u._.r,u=u.previous}while(l!==u.next);for(n.previous=t,n.next=r,t.next=r.previous=r=n,a=VW(t);(n=n.next)!==r;)(o=VW(n))<a&&(t=n,a=o);r=t.next}for(t=[r._],n=r;(n=n.next)!==r;)t.push(n._);for(n=sot(t),s=0;s<i;++s)t=e[s],t.x-=n.x,t.y-=n.y;return n.r}function ane(e){return cot(e),e}function one(e){return e==null?null:WR(e)}function WR(e){if(typeof e!="function")throw new Error;return e}function Ay(){return 0}function tx(e){return function(){return e}}function sne(e){return Math.sqrt(e.value)}function hot(){var e=null,t=1,r=1,n=Ay;function i(a){return a.x=t/2,a.y=r/2,e?a.eachBefore(GW(e)).eachAfter(RP(n,.5)).eachBefore(WW(1)):a.eachBefore(GW(sne)).eachAfter(RP(Ay,1)).eachAfter(RP(n,a.r/Math.min(t,r))).eachBefore(WW(Math.min(t,r)/(2*a.r))),a}return i.radius=function(a){return arguments.length?(e=one(a),i):e},i.size=function(a){return arguments.length?(t=+a[0],r=+a[1],i):[t,r]},i.padding=function(a){return arguments.length?(n=typeof a=="function"?a:tx(+a),i):n},i}function GW(e){return function(t){t.children||(t.r=Math.max(0,+e(t)||0))}}function RP(e,t){return function(r){if(n=r.children){var n,i,a=n.length,o=e(r)*t||0,s;if(o)for(i=0;i<a;++i)n[i].r+=o;if(s=cot(n),o)for(i=0;i<a;++i)n[i].r-=o;r.r=s+o}}}function WW(e){return function(t){var r=t.parent;t.r*=e,r&&(t.x=r.x+e*t.x,t.y=r.y+e*t.y)}}function fot(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function b2(e,t,r,n,i){for(var a=e.children,o,s=-1,l=a.length,u=e.value&&(n-t)/e.value;++s<l;)o=a[s],o.y0=r,o.y1=i,o.x0=t,o.x1=t+=o.value*u}function dot(){var e=1,t=1,r=0,n=!1;function i(o){var s=o.height+1;return o.x0=o.y0=r,o.x1=e,o.y1=t/s,o.eachBefore(a(t,s)),n&&o.eachBefore(fot),o}function a(o,s){return function(l){l.children&&b2(l,l.x0,o*(l.depth+1)/s,l.x1,o*(l.depth+2)/s);var u=l.x0,c=l.y0,f=l.x1-r,d=l.y1-r;f<u&&(u=f=(u+f)/2),d<c&&(c=d=(c+d)/2),l.x0=u,l.y0=c,l.x1=f,l.y1=d}}return i.round=function(o){return arguments.length?(n=!!o,i):n},i.size=function(o){return arguments.length?(e=+o[0],t=+o[1],i):[e,t]},i.padding=function(o){return arguments.length?(r=+o,i):r},i}var lne={depth:-1},XW={};function une(e){return e.id}function cne(e){return e.parentId}function hne(){var e=une,t=cne;function r(n){var i=Array.from(n),a=i.length,o,s,l,u,c,f,d,v=new Map;for(s=0;s<a;++s)o=i[s],c=i[s]=new db(o),(f=e(o,s,n))!=null&&(f+="")&&(d=c.id=f,v.set(d,v.has(d)?XW:c)),(f=t(o,s,n))!=null&&(f+="")&&(c.parent=f);for(s=0;s<a;++s)if(c=i[s],f=c.parent){if(u=v.get(f),!u)throw new Error("missing: "+f);if(u===XW)throw new Error("ambiguous: "+f);u.children?u.children.push(c):u.children=[c],c.parent=u}else{if(l)throw new Error("multiple roots");l=c}if(!l)throw new Error("no root");if(l.parent=lne,l.eachBefore(function(g){g.depth=g.parent.depth+1,--a}).eachBefore(oot),l.parent=null,a>0)throw new Error("cycle");return l}return r.id=function(n){return arguments.length?(e=WR(n),r):e},r.parentId=function(n){return arguments.length?(t=WR(n),r):t},r}function fne(e,t){return e.parent===t.parent?1:2}function IP(e){var t=e.children;return t?t[0]:e.t}function LP(e){var t=e.children;return t?t[t.length-1]:e.t}function dne(e,t,r){var n=r/(t.i-e.i);t.c-=n,t.s+=r,e.c+=n,t.z+=r,t.m+=r}function pne(e){for(var t=0,r=0,n=e.children,i=n.length,a;--i>=0;)a=n[i],a.z+=t,a.m+=t,t+=a.s+(r+=a.c)}function vne(e,t,r){return e.a.parent===t.parent?e.a:r}function xM(e,t){this._=e,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=t}xM.prototype=Object.create(db.prototype);function gne(e){for(var t=new xM(e,0),r,n=[t],i,a,o,s;r=n.pop();)if(a=r._.children)for(r.children=new Array(s=a.length),o=s-1;o>=0;--o)n.push(i=r.children[o]=new xM(a[o],o)),i.parent=r;return(t.parent=new xM(null,0)).children=[t],t}function mne(){var e=fne,t=1,r=1,n=null;function i(u){var c=gne(u);if(c.eachAfter(a),c.parent.m=-c.z,c.eachBefore(o),n)u.eachBefore(l);else{var f=u,d=u,v=u;u.eachBefore(function(M){M.x<f.x&&(f=M),M.x>d.x&&(d=M),M.depth>v.depth&&(v=M)});var g=f===d?1:e(f,d)/2,x=g-f.x,w=t/(d.x+g+x),S=r/(v.depth||1);u.eachBefore(function(M){M.x=(M.x+x)*w,M.y=M.depth*S})}return u}function a(u){var c=u.children,f=u.parent.children,d=u.i?f[u.i-1]:null;if(c){pne(u);var v=(c[0].z+c[c.length-1].z)/2;d?(u.z=d.z+e(u._,d._),u.m=u.z-v):u.z=v}else d&&(u.z=d.z+e(u._,d._));u.parent.A=s(u,d,u.parent.A||f[0])}function o(u){u._.x=u.z+u.parent.m,u.m+=u.parent.m}function s(u,c,f){if(c){for(var d=u,v=u,g=c,x=d.parent.children[0],w=d.m,S=v.m,M=g.m,R=x.m,I;g=LP(g),d=IP(d),g&&d;)x=IP(x),v=LP(v),v.a=u,I=g.z+M-d.z-w+e(g._,d._),I>0&&(dne(vne(g,u,f),u,I),w+=I,S+=I),M+=g.m,w+=d.m,R+=x.m,S+=v.m;g&&!LP(v)&&(v.t=g,v.m+=M-S),d&&!IP(x)&&(x.t=d,x.m+=w-R,f=u)}return f}function l(u){u.x*=t,u.y=u.depth*r}return i.separation=function(u){return arguments.length?(e=u,i):e},i.size=function(u){return arguments.length?(n=!1,t=+u[0],r=+u[1],i):n?null:[t,r]},i.nodeSize=function(u){return arguments.length?(n=!0,t=+u[0],r=+u[1],i):n?[t,r]:null},i}function B3(e,t,r,n,i){for(var a=e.children,o,s=-1,l=a.length,u=e.value&&(i-r)/e.value;++s<l;)o=a[s],o.x0=t,o.x1=n,o.y0=r,o.y1=r+=o.value*u}var pot=(1+Math.sqrt(5))/2;function vot(e,t,r,n,i,a){for(var o=[],s=t.children,l,u,c=0,f=0,d=s.length,v,g,x=t.value,w,S,M,R,I,P,k;c<d;){v=i-r,g=a-n;do w=s[f++].value;while(!w&&f<d);for(S=M=w,P=Math.max(g/v,v/g)/(x*e),k=w*w*P,I=Math.max(M/k,k/S);f<d;++f){if(w+=u=s[f].value,u<S&&(S=u),u>M&&(M=u),k=w*w*P,R=Math.max(M/k,k/S),R>I){w-=u;break}I=R}o.push(l={value:w,dice:v<g,children:s.slice(c,f)}),l.dice?b2(l,r,n,i,x?n+=g*w/x:a):B3(l,r,n,x?r+=v*w/x:i,a),x-=w,c=f}return o}const got=function e(t){function r(n,i,a,o,s){vot(t,n,i,a,o,s)}return r.ratio=function(n){return e((n=+n)>1?n:1)},r}(pot);function mot(){var e=got,t=!1,r=1,n=1,i=[0],a=Ay,o=Ay,s=Ay,l=Ay,u=Ay;function c(d){return d.x0=d.y0=0,d.x1=r,d.y1=n,d.eachBefore(f),i=[0],t&&d.eachBefore(fot),d}function f(d){var v=i[d.depth],g=d.x0+v,x=d.y0+v,w=d.x1-v,S=d.y1-v;w<g&&(g=w=(g+w)/2),S<x&&(x=S=(x+S)/2),d.x0=g,d.y0=x,d.x1=w,d.y1=S,d.children&&(v=i[d.depth+1]=a(d)/2,g+=u(d)-v,x+=o(d)-v,w-=s(d)-v,S-=l(d)-v,w<g&&(g=w=(g+w)/2),S<x&&(x=S=(x+S)/2),e(d,g,x,w,S))}return c.round=function(d){return arguments.length?(t=!!d,c):t},c.size=function(d){return arguments.length?(r=+d[0],n=+d[1],c):[r,n]},c.tile=function(d){return arguments.length?(e=WR(d),c):e},c.padding=function(d){return arguments.length?c.paddingInner(d).paddingOuter(d):c.paddingInner()},c.paddingInner=function(d){return arguments.length?(a=typeof d=="function"?d:tx(+d),c):a},c.paddingOuter=function(d){return arguments.length?c.paddingTop(d).paddingRight(d).paddingBottom(d).paddingLeft(d):c.paddingTop()},c.paddingTop=function(d){return arguments.length?(o=typeof d=="function"?d:tx(+d),c):o},c.paddingRight=function(d){return arguments.length?(s=typeof d=="function"?d:tx(+d),c):s},c.paddingBottom=function(d){return arguments.length?(l=typeof d=="function"?d:tx(+d),c):l},c.paddingLeft=function(d){return arguments.length?(u=typeof d=="function"?d:tx(+d),c):u},c}function yne(e,t,r,n,i){var a=e.children,o,s=a.length,l,u=new Array(s+1);for(u[0]=l=o=0;o<s;++o)u[o+1]=l+=a[o].value;c(0,s,e.value,t,r,n,i);function c(f,d,v,g,x,w,S){if(f>=d-1){var M=a[f];M.x0=g,M.y0=x,M.x1=w,M.y1=S;return}for(var R=u[f],I=v/2+R,P=f+1,k=d-1;P<k;){var z=P+k>>>1;u[z]<I?P=z+1:k=z}I-u[P-1]<u[P]-I&&f+1<P&&--P;var G=u[P]-R,J=v-G;if(w-g>S-x){var Z=v?(g*J+w*G)/v:w;c(f,P,G,g,x,Z,S),c(P,d,J,Z,x,w,S)}else{var X=v?(x*J+S*G)/v:S;c(f,P,G,g,x,w,X),c(P,d,J,g,X,w,S)}}}function _ne(e,t,r,n,i){(e.depth&1?B3:b2)(e,t,r,n,i)}const xne=function e(t){function r(n,i,a,o,s){if((l=n._squarify)&&l.ratio===t)for(var l,u,c,f,d=-1,v,g=l.length,x=n.value;++d<g;){for(u=l[d],c=u.children,f=u.value=0,v=c.length;f<v;++f)u.value+=c[f].value;u.dice?b2(u,i,a,o,x?a+=(s-a)*u.value/x:s):B3(u,i,a,x?i+=(o-i)*u.value/x:o,s),x-=u.value}else n._squarify=l=vot(t,n,i,a,o,s),l.ratio=t}return r.ratio=function(n){return e((n=+n)>1?n:1)},r}(pot),jW=Object.freeze(Object.defineProperty({__proto__:null,cluster:Dre,hierarchy:Yb,pack:hot,packEnclose:sot,packSiblings:ane,partition:dot,stratify:hne,tree:mne,treemap:mot,treemapBinary:yne,treemapDice:b2,treemapResquarify:xne,treemapSlice:B3,treemapSliceDice:_ne,treemapSquarify:got},Symbol.toStringTag,{value:"Module"}));var yot="nodeIndex",_ot="childNodeCount",Ik="nodeAncestor",OP="Invalid field: it must be a string!";function Lk(e,t){var r=e.field,n=e.fields;if(en(r))return r;if(Fe(r))return console.warn(OP),r[0];if(console.warn("".concat(OP," will try to get fields instead.")),en(n))return n;if(Fe(n)&&n.length)return n[0];if(t)return t;throw new TypeError(OP)}function Ok(e){var t=[];if(e&&e.each){var r,n;e.each(function(i){var a,o;i.parent!==r?(r=i.parent,n=0):n+=1;var s=Al((((a=i.ancestors)===null||a===void 0?void 0:a.call(i))||[]).map(function(l){return t.find(function(u){return u.name===l.name})||l}),function(l){var u=l.depth;return u>0&&u<i.depth});i[Ik]=s,i[_ot]=((o=i.children)===null||o===void 0?void 0:o.length)||0,i[yot]=n,t.push(i)})}else e&&e.eachNode&&e.eachNode(function(i){t.push(i)});return t}var bne={field:"value",as:["x","y","r"],sort:function(e,t){return t.value-e.value}};function Ene(e,t){t=Qi({},bne,t);var r=t.as;if(!Fe(r)||r.length!==3)throw new TypeError('Invalid as: it must be an array with 3 strings (e.g. [ "x", "y", "r" ])!');var n;try{n=Lk(t)}catch(u){console.warn(u)}var i=function(u){return hot().size(t.size).padding(t.padding)(Yb(u).sum(function(c){return c[n]}).sort(t.sort))},a=i(e),o=r[0],s=r[1],l=r[2];return a.each(function(u){u[o]=u.x,u[s]=u.y,u[l]=u.r}),Ok(a)}function xot(e){var t=e.data,r=e.hierarchyConfig,n=e.rawFields,i=n===void 0?[]:n,a=e.enableDrillDown,o=Ene(t,$($({},r),{field:"value",as:["x","y","r"]})),s=[];return o.forEach(function(l){for(var u,c=l.data.name,f=$({},l);f.depth>1;)c="".concat((u=f.parent.data)===null||u===void 0?void 0:u.name," / ").concat(c),f=f.parent;if(a&&l.depth>2)return null;var d=me({},l.data,$($($({},Ea(l.data,i)),{path:c}),l));d.ext=r,d[rS]={hierarchyConfig:r,rawFields:i,enableDrillDown:a},s.push(d)}),s}function bot(e,t,r){var n=gk([e,t]),i=n[0],a=n[1],o=n[2],s=n[3],l=r.width,u=r.height,c=l-(s+a),f=u-(i+o),d=Math.min(c,f),v=(c-d)/2,g=(f-d)/2,x=i+g,w=a+v,S=o+g,M=s+v,R=[x,w,S,M],I=d<0?0:d;return{finalPadding:R,finalSize:I}}function wne(e){var t=e.chart,r=Math.min(t.viewBBox.width,t.viewBBox.height);return me({options:{size:function(n){var i=n.r;return i*r}}},e)}function Cne(e){var t=e.options,r=e.chart,n=r.viewBBox,i=t.padding,a=t.appendPadding,o=t.drilldown,s=a;if(o!=null&&o.enabled){var l=C3(r.appendPadding,xt(o,["breadCrumb","position"]));s=gk([l,a])}var u=bot(i,s,n).finalPadding;return r.padding=u,r.appendPadding=0,e}function Sne(e){var t=e.chart,r=e.options,n=t.padding,i=t.appendPadding,a=r.color,o=r.colorField,s=r.pointStyle,l=r.hierarchyConfig,u=r.sizeField,c=r.rawFields,f=c===void 0?[]:c,d=r.drilldown,v=xot({data:r.data,hierarchyConfig:l,enableDrillDown:d==null?void 0:d.enabled,rawFields:f});t.data(v);var g=t.viewBBox,x=bot(n,i,g).finalSize,w=function(S){var M=S.r;return M*x};return u&&(w=function(S){return S[u]*x}),tf(me({},e,{options:{xField:"x",yField:"y",seriesField:o,sizeField:u,rawFields:on(on([],Ere,!0),f,!0),point:{color:a,style:s,shape:"circle",size:w}}})),e}function Tne(e){return zn(ns({},{x:{min:0,max:1,minLimit:0,maxLimit:1,nice:!0},y:{min:0,max:1,minLimit:0,maxLimit:1,nice:!0}}))(e)}function Ane(e){var t=e.chart,r=e.options,n=r.tooltip;if(n===!1)t.tooltip(!1);else{var i=n;xt(n,"fields")||(i=me({},{customItems:function(a){return a.map(function(o){var s=xt(t.getOptions(),"scales"),l=xt(s,["name","formatter"],function(c){return c}),u=xt(s,["value","formatter"],function(c){return c});return $($({},o),{name:l(o.data.name),value:u(o.data.value)})})}},i)),t.tooltip(i)}return e}function Mne(e){var t=e.chart;return t.axis(!1),e}function Rne(e){var t=e.drilldown,r=e.interactions,n=r===void 0?[]:r;return t!=null&&t.enabled?me({},e,{interactions:on(on([],n,!0),[{type:"drill-down",cfg:{drillDownConfig:t,transformData:xot,enableDrillDown:!0}}],!1)}):e}function Ine(e){var t=e.chart,r=e.options;return xo({chart:t,options:Rne(r)}),e}function Lne(e){return zn(Jh("pointStyle"),wne,Cne,ea,Tne,Sne,Mne,Gb,Ane,Ine,Ma,Ao())(e)}function YW(e){var t=xt(e,["event","data","data"],{});return Fe(t.children)&&t.children.length>0}function ZW(e){var t=e.view.getCoordinate(),r=t.innerRadius;if(r){var n=e.event,i=n.x,a=n.y,o=t.center,s=o.x,l=o.y,u=t.getRadius()*r,c=Math.sqrt(Math.pow(s-i,2)+Math.pow(l-a,2));return c<u}return!1}yn("drill-down-action",Tre);Zn("drill-down",{showEnable:[{trigger:"element:mouseenter",action:"cursor:pointer",isEnable:YW},{trigger:"element:mouseleave",action:"cursor:default"},{trigger:"element:mouseleave",action:"cursor:pointer",isEnable:ZW}],start:[{trigger:"element:click",isEnable:YW,action:["drill-down-action:click"]},{trigger:"afterchangesize",action:["drill-down-action:resetPosition"]},{trigger:"click",isEnable:ZW,action:["drill-down-action:back"]}]});var One=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="circle-packing",r}return t.getDefaultOptions=function(){return wre},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return Lne},t.prototype.triggerResize=function(){this.chart.destroyed||(this.chart.forceFit(),this.chart.clear(),this.execAdaptor(),this.chart.render(!0))},t}(ti);const _Oe=Object.freeze(Object.defineProperty({__proto__:null,CirclePacking:One},Symbol.toStringTag,{value:"Module"}));var ef="left-axes-view",rf="right-axes-view",Eot={nice:!0,label:{autoHide:!0,autoRotate:!1}},Pne=$($({},Eot),{position:"left"}),Dne=$($({},Eot),{position:"right",grid:null}),pb;(function(e){e.Left="Left",e.Right="Right"})(pb||(pb={}));var p_;(function(e){e.Line="line",e.Column="column"})(p_||(p_={}));function oB(e){return xt(e,"geometry")===p_.Line}function Pk(e){return xt(e,"geometry")===p_.Column}function qW(e,t,r){return Pk(r)?me({},{geometry:p_.Column,label:r.label&&r.isRange?{content:function(n){var i;return(i=n[t])===null||i===void 0?void 0:i.join("-")}}:void 0},r):$({geometry:p_.Line},r)}function KW(e,t){var r=e[0],n=e[1];if(Fe(t)){var i=t[0],a=t[1];return[i,a]}var o=xt(t,r),s=xt(t,n);return[o,s]}function QW(e,t){return t===pb.Left?e===!1?!1:me({},Pne,e):t===pb.Right?e===!1?!1:me({},Dne,e):e}function Fne(e){var t=e.options,r=e.chart,n=t.geometryOption,i=n.isStack,a=n.color,o=n.seriesField,s=n.groupField,l=n.isGroup,u=["xField","yField"];if(oB(n)){Wb(me({},e,{options:$($($({},Ea(t,u)),n),{line:{color:n.color,style:n.lineStyle}})})),tf(me({},e,{options:$($($({},Ea(t,u)),n),{point:n.point&&$({color:a,shape:"circle"},n.point)})}));var c=[];l&&c.push({type:"dodge",dodgeBy:s||o,customOffset:0}),i&&c.push({type:"stack"}),c.length&&ft(r.geometries,function(f){f.adjust(c)})}return Pk(n)&&D3(me({},e,{options:$($($({},Ea(t,u)),n),{widthRatio:n.columnWidthRatio,interval:$($({},Ea(n,["color"])),{style:n.columnStyle})})})),e}function JW(e){var t=e.view,r=e.geometryOption,n=e.yField,i=e.legend,a=xt(i,"marker"),o=vu(t,oB(r)?"line":"interval");if(!r.seriesField){var s=xt(t,"options.scales.".concat(n,".alias"))||n,l=o.getAttribute("color"),u=t.getTheme().defaultColor;l&&(u=ih.getMappingValue(l,s,xt(l,["values",0],u)));var c=(Rr(a)?a:!cc(a)&&me({},{style:{stroke:u,fill:u}},a))||(oB(r)?{symbol:function(d,v,g){return[["M",d-g,v],["L",d+g,v]]},style:{lineWidth:2,r:6,stroke:u}}:{symbol:"square",style:{fill:u}});return[{value:n,name:s,marker:c,isGeometry:!0,viewId:t.id}]}var f=o.getGroupAttributes();return du(f,function(d,v){var g=ih.getLegendItems(t,o,v,t.getTheme(),a);return d.concat(g)},[])}var tX=function(e,t){var r=t[0],n=t[1],i=e.getOptions().data,a=e.getXScale(),o=il(i);if(!(!a||!o)){var s=Zf(i,a.field),l=s,u=il(l),c=Math.round(r*(u-1)),f=Math.round(n*(u-1));e.filter(a.field,function(d){var v=l.indexOf(d);return v>-1?iQt(v,c,f):!0}),e.getRootView().render(!0)}};function Bne(e){var t,r=e.options,n=r.geometryOptions,i=n===void 0?[]:n,a=r.xField,o=r.yField,s=t3(i,function(l){var u=l.geometry;return u===p_.Line||u===void 0});return me({},{options:{geometryOptions:[],meta:(t={},t[a]={type:"cat",sync:!0,range:s?[0,1]:void 0},t),tooltip:{showMarkers:s,showCrosshairs:s,shared:!0,crosshairs:{type:"x"}},interactions:s?[{type:"legend-visible-filter"}]:[{type:"legend-visible-filter"},{type:"active-region"}],legend:{position:"top-left"}}},e,{options:{yAxis:KW(o,r.yAxis),geometryOptions:[qW(a,o[0],i[0]),qW(a,o[1],i[1])],annotations:KW(o,r.annotations)}})}function Nne(e){var t,r,n=e.chart,i=e.options,a=i.geometryOptions,o={line:0,column:1},s=[{type:(t=a[0])===null||t===void 0?void 0:t.geometry,id:ef},{type:(r=a[1])===null||r===void 0?void 0:r.geometry,id:rf}];return s.sort(function(l,u){return-o[l.type]+o[u.type]}).forEach(function(l){return n.createView({id:l.id})}),e}function kne(e){var t=e.chart,r=e.options,n=r.xField,i=r.yField,a=r.geometryOptions,o=r.data,s=r.tooltip,l=[$($({},a[0]),{id:ef,data:o[0],yField:i[0]}),$($({},a[1]),{id:rf,data:o[1],yField:i[1]})];return l.forEach(function(u){var c=u.id,f=u.data,d=u.yField,v=Pk(u)&&u.isPercent,g=v?Kit(f,d,n,d):f,x=_i(t,c).data(g),w=v?$({formatter:function(S){return{name:S[u.seriesField]||d,value:(Number(S[d])*100).toFixed(2)+"%"}}},s):s;Fne({chart:x,options:{xField:n,yField:d,tooltip:w,geometryOption:u}})}),e}function zne(e){var t,r=e.chart,n=e.options,i=n.geometryOptions,a=((t=r.getTheme())===null||t===void 0?void 0:t.colors10)||[],o=0;return r.once("beforepaint",function(){ft(i,function(s,l){var u=_i(r,l===0?ef:rf);if(!s.color){var c=u.getGroupScales(),f=xt(c,[0,"values","length"],1),d=a.slice(o,o+f).concat(l===0?[]:a);u.geometries.forEach(function(v){s.seriesField?v.color(s.seriesField,d):v.color(d[0])}),o+=f}}),r.render(!0)}),e}function Une(e){var t,r,n=e.chart,i=e.options,a=i.xAxis,o=i.yAxis,s=i.xField,l=i.yField;return ns((t={},t[s]=a,t[l[0]]=o[0],t))(me({},e,{chart:_i(n,ef)})),ns((r={},r[s]=a,r[l[1]]=o[1],r))(me({},e,{chart:_i(n,rf)})),e}function $ne(e){var t=e.chart,r=e.options,n=_i(t,ef),i=_i(t,rf),a=r.xField,o=r.yField,s=r.xAxis,l=r.yAxis;return t.axis(a,!1),t.axis(o[0],!1),t.axis(o[1],!1),n.axis(a,s),n.axis(o[0],QW(l[0],pb.Left)),i.axis(a,!1),i.axis(o[1],QW(l[1],pb.Right)),e}function Hne(e){var t=e.chart,r=e.options,n=r.tooltip,i=_i(t,ef),a=_i(t,rf);return t.tooltip(n),i.tooltip({shared:!0}),a.tooltip({shared:!0}),e}function Vne(e){var t=e.chart;return xo(me({},e,{chart:_i(t,ef)})),xo(me({},e,{chart:_i(t,rf)})),e}function Gne(e){var t=e.chart,r=e.options,n=r.annotations,i=xt(n,[0]),a=xt(n,[1]);return Ao(i)(me({},e,{chart:_i(t,ef),options:{annotations:i}})),Ao(a)(me({},e,{chart:_i(t,rf),options:{annotations:a}})),e}function Wne(e){var t=e.chart;return ea(me({},e,{chart:_i(t,ef)})),ea(me({},e,{chart:_i(t,rf)})),ea(e),e}function Xne(e){var t=e.chart;return Ma(me({},e,{chart:_i(t,ef)})),Ma(me({},e,{chart:_i(t,rf)})),e}function jne(e){var t=e.chart,r=e.options,n=r.yAxis;return d_(me({},e,{chart:_i(t,ef),options:{yAxis:n[0]}})),d_(me({},e,{chart:_i(t,rf),options:{yAxis:n[1]}})),e}function Yne(e){var t=e.chart,r=e.options,n=r.legend,i=r.geometryOptions,a=r.yField,o=r.data,s=_i(t,ef),l=_i(t,rf);if(n===!1)t.legend(!1);else if(Xi(n)&&n.custom===!0)t.legend(n);else{var u=xt(i,[0,"legend"],n),c=xt(i,[1,"legend"],n);t.once("beforepaint",function(){var f=o[0].length?JW({view:s,geometryOption:i[0],yField:a[0],legend:u}):[],d=o[1].length?JW({view:l,geometryOption:i[1],yField:a[1],legend:c}):[];t.legend(me({},n,{custom:!0,items:f.concat(d)}))}),i[0].seriesField&&s.legend(i[0].seriesField,u),i[1].seriesField&&l.legend(i[1].seriesField,c),t.on("legend-item:click",function(f){var d=xt(f,"gEvent.delegateObject",{});if(d&&d.item){var v=d.item,g=v.value,x=v.isGeometry,w=v.viewId;if(x){var S=q4(a,function(I){return I===g});if(S>-1){var M=xt(_i(t,w),"geometries");ft(M,function(I){I.changeVisible(!d.item.unchecked)})}}else{var R=xt(t.getController("legend"),"option.items",[]);ft(t.views,function(I){var P=I.getGroupScales();ft(P,function(k){k.values&&k.values.indexOf(g)>-1&&I.filter(k.field,function(z){var G=Xf(R,function(J){return J.value===z});return!G.unchecked})}),t.render(!0)})}}})}return e}function Zne(e){var t=e.chart,r=e.options,n=r.slider,i=_i(t,ef),a=_i(t,rf);return n&&(i.option("slider",n),i.on("slider:valuechanged",function(o){var s=o.event,l=s.value,u=s.originValue;Di(l,u)||tX(a,l)}),t.once("afterpaint",function(){if(!bg(n)){var o=n.start,s=n.end;(o||s)&&tX(a,[o,s])}})),e}function qne(e){return zn(Bne,Nne,Wne,kne,Une,$ne,jne,Hne,Vne,Gne,Xne,zne,Yne,Zne)(e)}var Kne=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="dual-axes",r}return t.prototype.getDefaultOptions=function(){return me({},e.prototype.getDefaultOptions.call(this),{yAxis:[],syncViewPadding:!0})},t.prototype.getSchemaAdaptor=function(){return qne},t}(ti);const xOe=Object.freeze(Object.defineProperty({__proto__:null,DualAxes:Kne},Symbol.toStringTag,{value:"Module"}));function Qne(e,t){var r=t.data,n=t.coordinate,i=t.interactions,a=t.annotations,o=t.animation,s=t.tooltip,l=t.axes,u=t.meta,c=t.geometries;r&&e.data(r);var f={};l&&ft(l,function(d,v){f[v]=Ea(d,Xc)}),f=me({},u,f),e.scale(f),n&&e.coordinate(n),l===!1?e.axis(!1):ft(l,function(d,v){e.axis(v,d)}),ft(c,function(d){var v=ch({chart:e,options:d}).ext,g=d.adjust;g&&v.geometry.adjust(g)}),ft(i,function(d){d.enable===!1?e.removeInteraction(d.type):e.interaction(d.type,d.cfg)}),ft(a,function(d){e.annotation()[d.type]($({},d))}),g2(e,o),s?(e.interaction("tooltip"),e.tooltip(s)):s===!1&&e.removeInteraction("tooltip")}function Jne(e){var t=e.chart,r=e.options,n=r.type,i=r.data,a=r.fields,o=r.eachView,s=ZS(r,["type","data","fields","eachView","axes","meta","tooltip","coordinate","theme","legend","interactions","annotations"]);return t.data(i),t.facet(n,$($({},s),{fields:a,eachView:function(l,u){var c=o(l,u);if(c.geometries)Qne(l,c);else{var f=c,d=f.options;d.tooltip&&l.interaction("tooltip"),aB(f.type,l,d)}}})),e}function tie(e){var t=e.chart,r=e.options,n=r.axes,i=r.meta,a=r.tooltip,o=r.coordinate,s=r.theme,l=r.legend,u=r.interactions,c=r.annotations,f={};return n&&ft(n,function(d,v){f[v]=Ea(d,Xc)}),f=me({},i,f),t.scale(f),t.coordinate(o),n?ft(n,function(d,v){t.axis(v,d)}):t.axis(!1),a?(t.interaction("tooltip"),t.tooltip(a)):a===!1&&t.removeInteraction("tooltip"),t.legend(l),s&&t.theme(s),ft(u,function(d){d.enable===!1?t.removeInteraction(d.type):t.interaction(d.type,d.cfg)}),ft(c,function(d){t.annotation()[d.type]($({},d))}),e}function eie(e){return zn(ea,Jne,tie)(e)}var rie={title:{style:{fontSize:12,fill:"rgba(0,0,0,0.65)"}},rowTitle:{style:{fontSize:12,fill:"rgba(0,0,0,0.65)"}},columnTitle:{style:{fontSize:12,fill:"rgba(0,0,0,0.65)"}}};(function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="area",r}return t.getDefaultOptions=function(){return rie},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return eie},t})(ti);function nie(e){var t=e.chart,r=e.options,n=r.data,i=r.type,a=r.xField,o=r.yField,s=r.colorField,l=r.sizeField,u=r.sizeRatio,c=r.shape,f=r.color,d=r.tooltip,v=r.heatmapStyle,g=r.meta;t.data(n);var x="polygon";i==="density"&&(x="heatmap");var w=sd(d,[a,o,s]),S=w.fields,M=w.formatter,R=1;return(u||u===0)&&(!c&&!l?console.warn("sizeRatio is not in effect: Must define shape or sizeField first"):u<0||u>1?console.warn("sizeRatio is not in effect: It must be a number in [0,1]"):R=u),ch(me({},e,{options:{type:x,colorField:s,tooltipFields:S,shapeField:l||"",label:void 0,mapping:{tooltip:M,shape:c&&(l?function(I){var P=n.map(function(J){return J[l]}),k=(g==null?void 0:g[l])||{},z=k.min,G=k.max;return z=Rn(z)?z:Math.min.apply(Math,P),G=Rn(G)?G:Math.max.apply(Math,P),[c,(xt(I,l)-z)/(G-z),R]}:function(){return[c,1,R]}),color:f||s&&t.getTheme().sequenceColors.join("-"),style:v}}})),e}function iie(e){var t,r=e.options,n=r.xAxis,i=r.yAxis,a=r.xField,o=r.yField;return zn(ns((t={},t[a]=n,t[o]=i,t)))(e)}function aie(e){var t=e.chart,r=e.options,n=r.xAxis,i=r.yAxis,a=r.xField,o=r.yField;return n===!1?t.axis(a,!1):t.axis(a,n),i===!1?t.axis(o,!1):t.axis(o,i),e}function oie(e){var t=e.chart,r=e.options,n=r.legend,i=r.colorField,a=r.sizeField,o=r.sizeLegend,s=n!==!1;return i&&t.legend(i,s?n:!1),a&&t.legend(a,o===void 0?n:o),!s&&!o&&t.legend(!1),e}function sie(e){var t=e.chart,r=e.options,n=r.label,i=r.colorField,a=r.type,o=vu(t,a==="density"?"heatmap":"polygon");if(!n)o.label(!1);else if(i){var s=n.callback,l=fi(n,["callback"]);o.label({fields:[i],callback:s,cfg:Cl(l)})}return e}function lie(e){var t,r,n=e.chart,i=e.options,a=i.coordinate,o=i.reflect,s=me({actions:[]},a??{type:"rect"});return o&&((r=(t=s.actions)===null||t===void 0?void 0:t.push)===null||r===void 0||r.call(t,["reflect",o])),n.coordinate(s),e}function uie(e){return zn(ea,Jh("heatmapStyle"),iie,lie,nie,aie,oie,al,sie,Ao(),xo,Ma,S0)(e)}var cie=me({},ti.getDefaultOptions(),{type:"polygon",legend:!1,coordinate:{type:"rect"},xAxis:{tickLine:null,line:null,grid:{alignTick:!1,line:{style:{lineWidth:1,lineDash:null,stroke:"#f0f0f0"}}}},yAxis:{grid:{alignTick:!1,line:{style:{lineWidth:1,lineDash:null,stroke:"#f0f0f0"}}}}});fa("polygon","circle",{draw:function(e,t){var r,n,i=e.x,a=e.y,o=this.parsePoints(e.points),s=Math.abs(o[2].x-o[1].x),l=Math.abs(o[1].y-o[0].y),u=Math.min(s,l)/2,c=Number(e.shape[1]),f=Number(e.shape[2]),d=Math.sqrt(f),v=u*d*Math.sqrt(c),g=((r=e.style)===null||r===void 0?void 0:r.fill)||e.color||((n=e.defaultStyle)===null||n===void 0?void 0:n.fill),x=t.addShape("circle",{attrs:$($($({x:i,y:a,r:v},e.defaultStyle),e.style),{fill:g})});return x}});fa("polygon","square",{draw:function(e,t){var r,n,i=e.x,a=e.y,o=this.parsePoints(e.points),s=Math.abs(o[2].x-o[1].x),l=Math.abs(o[1].y-o[0].y),u=Math.min(s,l),c=Number(e.shape[1]),f=Number(e.shape[2]),d=Math.sqrt(f),v=u*d*Math.sqrt(c),g=((r=e.style)===null||r===void 0?void 0:r.fill)||e.color||((n=e.defaultStyle)===null||n===void 0?void 0:n.fill),x=t.addShape("rect",{attrs:$($($({x:i-v/2,y:a-v/2,width:v,height:v},e.defaultStyle),e.style),{fill:g})});return x}});var hie=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="heatmap",r}return t.getDefaultOptions=function(){return cie},t.prototype.getSchemaAdaptor=function(){return uie},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t}(ti);const bOe=Object.freeze(Object.defineProperty({__proto__:null,Heatmap:hie},Symbol.toStringTag,{value:"Module"}));var fie="liquid";function wot(e){return[{percent:e,type:fie}]}function die(e){var t=e.chart,r=e.options,n=r.percent,i=r.liquidStyle,a=r.radius,o=r.outline,s=r.wave,l=r.shape,u=r.shapeStyle,c=r.animation;t.scale({percent:{min:0,max:1}}),t.data(wot(n));var f=r.color||t.getTheme().defaultColor,d=me({},e,{options:{xField:"type",yField:"percent",widthRatio:a,interval:{color:f,style:i,shape:"liquid-fill-gauge"}}}),v=gu(d).ext,g=v.geometry,x=t.getTheme().background,w={percent:n,radius:a,outline:o,wave:s,shape:l,shapeStyle:u,background:x,animation:c};return g.customInfo(w),t.legend(!1),t.axis(!1),t.tooltip(!1),e}function Cot(e,t){var r=e.chart,n=e.options,i=n.statistic,a=n.percent,o=n.meta;r.getController("annotation").clear(!0);var s=xt(o,["percent","formatter"])||function(u){return"".concat((u*100).toFixed(2),"%")},l=i.content;return l&&(l=me({},l,{content:ze(l.content)?s(a):l.content})),S3(r,{statistic:$($({},i),{content:l}),plotType:"liquid"},{percent:a}),t&&r.render(!0),e}function pie(e){return zn(ea,Jh("liquidStyle"),die,Cot,ns({}),Ma,xo)(e)}var vie={radius:.9,statistic:{title:!1,content:{style:{opacity:.75,fontSize:"30px",lineHeight:"30px",textAlign:"center"}}},outline:{border:2,distance:0},wave:{count:3,length:192},shape:"circle"},eX=5e3;function rX(e,t,r){return e+(t-e)*r}function gie(e){var t=$({opacity:1},e.style);return e.color&&!t.fill&&(t.fill=e.color),t}function mie(e){var t={fill:"#fff",fillOpacity:0,lineWidth:4},r=Qi({},t,e.style);return e.color&&!r.stroke&&(r.stroke=e.color),Rn(e.opacity)&&(r.opacity=r.strokeOpacity=e.opacity),r}function yie(e,t,r,n){return t===0?[[e+1/2*r/Math.PI/2,n/2],[e+1/2*r/Math.PI,n],[e+r/4,n]]:t===1?[[e+1/2*r/Math.PI/2*(Math.PI-2),n],[e+1/2*r/Math.PI/2*(Math.PI-1),n/2],[e+r/4,0]]:t===2?[[e+1/2*r/Math.PI/2,-n/2],[e+1/2*r/Math.PI,-n],[e+r/4,-n]]:[[e+1/2*r/Math.PI/2*(Math.PI-2),-n],[e+1/2*r/Math.PI/2*(Math.PI-1),-n/2],[e+r/4,0]]}function _ie(e,t,r,n,i,a,o){for(var s=Math.ceil(2*e/r*4)*4,l=[],u=n;u<-Math.PI*2;)u+=Math.PI*2;for(;u>0;)u-=Math.PI*2;u=u/Math.PI/2*r;var c=a-e+u-e*2;l.push(["M",c,t]);for(var f=0,d=0;d<s;++d){var v=d%4,g=yie(d*r/4,v,r,i);l.push(["C",g[0][0]+c,-g[0][1]+t,g[1][0]+c,-g[1][1]+t,g[2][0]+c,-g[2][1]+t]),d===s-1&&(f=g[2][0])}return l.push(["L",f+c,o+e]),l.push(["L",c,o+e]),l.push(["Z"]),l}function Sot(e,t,r,n,i,a,o,s,l,u){for(var c=i.fill,f=i.opacity,d=o.getBBox(),v=d.maxX-d.minX,g=d.maxY-d.minY,x=0;x<n;x++){var w=n<=1?1:x/(n-1),S=a.addShape("path",{name:"waterwave-path",attrs:{path:_ie(s,d.minY+g*r,l,0,v/32,e,t),fill:c,opacity:rX(.2,.9,w)*f}});try{if(u===!1)return;var M=iB([["t",l,0]]);S.stopAnimate(),S.animate({matrix:M},{duration:rX(.5*eX,eX,w),repeat:!0})}catch{console.warn("off-screen group animate error!")}}}function xie(e,t,r,n){var i=r*2/3,a=Math.max(i,n),o=i/2,s=e,l=o+t-a/2,u=Math.asin(o/((a-o)*.85)),c=Math.sin(u)*o,f=Math.cos(u)*o,d=s-f,v=l+c,g=e,x=l+o/Math.sin(u);return`
      M `.concat(d," ").concat(v,`
      A `).concat(o," ").concat(o," 0 1 1 ").concat(d+f*2," ").concat(v,`
      Q `).concat(g," ").concat(x," ").concat(e," ").concat(t+a/2,`
      Q `).concat(g," ").concat(x," ").concat(d," ").concat(v,`
      Z 
    `)}function bie(e,t,r,n){var i=r/2,a=n/2;return`
      M `.concat(e," ").concat(t-a,` 
      a `).concat(i," ").concat(a," 0 1 0 0 ").concat(a*2,`
      a `).concat(i," ").concat(a," 0 1 0 0 ").concat(-a*2,`
      Z
    `)}function Eie(e,t,r,n){var i=n/2,a=r/2;return`
      M `.concat(e," ").concat(t-i,`
      L `).concat(e+a," ").concat(t,`
      L `).concat(e," ").concat(t+i,`
      L `).concat(e-a," ").concat(t,`
      Z
    `)}function wie(e,t,r,n){var i=n/2,a=r/2;return`
      M `.concat(e," ").concat(t-i,`
      L `).concat(e+a," ").concat(t+i,`
      L `).concat(e-a," ").concat(t+i,`
      Z
    `)}function Cie(e,t,r,n){var i=.618,a=n/2,o=r/2*i;return`
      M `.concat(e-o," ").concat(t-a,`
      L `).concat(e+o," ").concat(t-a,`
      L `).concat(e+o," ").concat(t+a,`
      L `).concat(e-o," ").concat(t+a,`
      Z
    `)}var nX={pin:xie,circle:bie,diamond:Eie,triangle:wie,rect:Cie};fa("interval","liquid-fill-gauge",{draw:function(e,t){var r=.5,n=.5,i=e.customInfo,a=i,o=a.percent,s=a.radius,l=a.shape,u=a.shapeStyle,c=a.background,f=a.animation,d=i.outline,v=i.wave,g=d.border,x=d.distance,w=v.count,S=v.length,M=du(e.points,function(wt,Tt){return Math.min(wt,Tt.x)},1/0),R=this.parsePoint({x:r,y:n}),I=this.parsePoint({x:M,y:n}),P=R.x-I.x,k=Math.min(P,I.y*s),z=gie(e),G=mie(Qi({},e,d)),J=k-g/2,Z=typeof l=="function"?l:nX[l]||nX.circle,X=Z(R.x,R.y,J*2,J*2);if(u&&t.addShape("path",{name:"shape",attrs:$({path:X},u)}),o>0){var et=t.addGroup({name:"waves"}),at=et.setClip({type:"path",attrs:{path:X}});Sot(R.x,R.y,1-e.points[1].y,w,z,et,at,k*2,S,f)}return t.addShape("path",{name:"distance",attrs:{path:X,fill:"transparent",lineWidth:g+x*2,stroke:c==="transparent"?"#fff":c}}),t.addShape("path",{name:"wrap",attrs:Qi(G,{path:X,fill:"transparent",lineWidth:g})}),t}});var Sie=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="liquid",r}return t.getDefaultOptions=function(){return vie},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.changeData=function(r){this.chart.emit(pi.BEFORE_CHANGE_DATA,To.fromData(this.chart,pi.BEFORE_CHANGE_DATA,null)),this.updateOption({percent:r}),this.chart.data(wot(r)),Cot({chart:this.chart,options:this.options},!0),this.chart.emit(pi.AFTER_CHANGE_DATA,To.fromData(this.chart,pi.AFTER_CHANGE_DATA,null))},t.prototype.getSchemaAdaptor=function(){return pie},t}(ti);const EOe=Object.freeze(Object.defineProperty({__proto__:null,Liquid:Sie,addWaterWave:Sot},Symbol.toStringTag,{value:"Module"}));function Tie(e){var t=e.chart,r=e.options,n=r.data,i=r.lineStyle,a=r.color,o=r.point,s=r.area;t.data(n);var l=me({},e,{options:{line:{style:i,color:a},point:o&&$({color:a},o),area:s&&$({color:a},s),label:void 0}}),u=me({},l,{options:{tooltip:!1}}),c=(o==null?void 0:o.state)||r.state,f=me({},l,{options:{tooltip:!1,state:c}});return Wb(l),tf(f),M3(u),e}function Aie(e){var t,r=e.options,n=r.xAxis,i=r.yAxis,a=r.xField,o=r.yField;return zn(ns((t={},t[a]=n,t[o]=i,t)))(e)}function Mie(e){var t=e.chart,r=e.options,n=r.radius,i=r.startAngle,a=r.endAngle;return t.coordinate("polar",{radius:n,startAngle:i,endAngle:a}),e}function Rie(e){var t=e.chart,r=e.options,n=r.xField,i=r.xAxis,a=r.yField,o=r.yAxis;return t.axis(n,i),t.axis(a,o),e}function Iie(e){var t=e.chart,r=e.options,n=r.label,i=r.yField,a=vu(t,"line");if(!n)a.label(!1);else{var o=n.fields,s=n.callback,l=fi(n,["fields","callback"]);a.label({fields:o||[i],callback:s,cfg:Cl(l)})}return e}function Lie(e){return zn(Tie,Aie,ea,Mie,Rie,Gb,al,Iie,xo,Ma,Ao())(e)}var Oie=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"name",{get:function(){return"radar-tooltip"},enumerable:!1,configurable:!0}),t.prototype.getTooltipItems=function(r){var n=this.getTooltipCfg(),i=n.shared,a=n.title,o=e.prototype.getTooltipItems.call(this,r);if(o.length>0){var s=this.view.geometries[0],l=s.dataArray,u=o[0].name,c=[];return l.forEach(function(f){f.forEach(function(d){var v=ih.getTooltipItems(d,s),g=v[0];if(!i&&g&&g.name===u){var x=ze(a)?u:a;c.push($($({},g),{name:g.title,title:x}))}else if(i&&g){var x=ze(a)?g.name||u:a;c.push($($({},g),{name:g.title,title:x}))}})}),c}return[]},t}(Tnt);B_("radar-tooltip",Oie);var Pie=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.init=function(){var r=this.context.view;r.removeInteraction("tooltip")},t.prototype.show=function(){var r=this.context.event,n=this.getTooltipController();n.showTooltip({x:r.x,y:r.y})},t.prototype.hide=function(){var r=this.getTooltipController();r.hideTooltip()},t.prototype.getTooltipController=function(){var r=this.context.view;return r.getController("radar-tooltip")},t}(io);yn("radar-tooltip",Pie);Zn("radar-tooltip",{start:[{trigger:"plot:mousemove",action:"radar-tooltip:show"}],end:[{trigger:"plot:mouseleave",action:"radar-tooltip:hide"}]});var Die=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="radar",r}return t.prototype.changeData=function(r){this.updateOption({data:r}),this.chart.changeData(r)},t.prototype.getDefaultOptions=function(){return me({},e.prototype.getDefaultOptions.call(this),{xAxis:{label:{offset:15},grid:{line:{type:"line"}}},yAxis:{grid:{line:{type:"circle"}}},legend:{position:"top"},tooltip:{shared:!0,showCrosshairs:!0,showMarkers:!0,crosshairs:{type:"xy",line:{style:{stroke:"#565656",lineDash:[4]}},follow:!0}}})},t.prototype.getSchemaAdaptor=function(){return Lie},t}(ti);const wOe=Object.freeze(Object.defineProperty({__proto__:null,Radar:Die},Symbol.toStringTag,{value:"Module"}));function Fie(e,t,r){var n=r.map(function(o){return o[t]}).filter(function(o){return o!==void 0}),i=n.length>0?Math.max.apply(Math,n):0,a=Math.abs(e)%360;return a?i*360/a:i}function Bie(e,t,r){var n=[];return e.forEach(function(i){var a=n.find(function(o){return o[t]===i[t]});a?a[r]+=i[r]||null:n.push($({},i))}),n}function Nie(e){var t=e.chart,r=e.options,n=r.barStyle,i=r.color,a=r.tooltip,o=r.colorField,s=r.type,l=r.xField,u=r.yField,c=r.data,f=r.shape,d=hb(c,u);t.data(d);var v=me({},e,{options:{tooltip:a,seriesField:o,interval:{style:n,color:i,shape:f||(s==="line"?"line":"intervel")},minColumnWidth:r.minBarWidth,maxColumnWidth:r.maxBarWidth,columnBackground:r.barBackground}});return gu(v),s==="line"&&tf({chart:t,options:{xField:l,yField:u,seriesField:o,point:{shape:"circle",color:i}}}),e}function Tot(e){var t,r=e.options,n=r.yField,i=r.xField,a=r.data,o=r.isStack,s=r.isGroup,l=r.colorField,u=r.maxAngle,c=o&&!s&&l?Bie(a,i,n):a,f=hb(c,n);return zn(ns((t={},t[n]={min:0,max:Fie(u,n,f)},t)))(e)}function kie(e){var t=e.chart,r=e.options,n=r.radius,i=r.innerRadius,a=r.startAngle,o=r.endAngle;return t.coordinate({type:"polar",cfg:{radius:n,innerRadius:i,startAngle:a,endAngle:o}}).transpose(),e}function zie(e){var t=e.chart,r=e.options,n=r.xField,i=r.xAxis;return t.axis(n,i),e}function Uie(e){var t=e.chart,r=e.options,n=r.label,i=r.yField,a=vu(t,"interval");if(!n)a.label(!1);else{var o=n.callback,s=fi(n,["callback"]);a.label({fields:[i],callback:o,cfg:$($({},Cl(s)),{type:"polar"})})}return e}function $ie(e){return zn(Jh("barStyle"),Nie,Tot,zie,kie,xo,Ma,ea,al,Gb,Ao(),Uie)(e)}var Hie=me({},ti.getDefaultOptions(),{interactions:[{type:"element-active"}],legend:!1,tooltip:{showMarkers:!1},xAxis:{grid:null,tickLine:null,line:null},maxAngle:240});(function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="radial-bar",r}return t.getDefaultOptions=function(){return Hie},t.prototype.changeData=function(r){this.updateOption({data:r}),Tot({chart:this.chart,options:this.options}),this.chart.changeData(r)},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return $ie},t})(ti);function Vie(e){var t=e.chart,r=e.options,n=r.data,i=r.sectorStyle,a=r.shape,o=r.color;return t.data(n),zn(gu)(me({},e,{options:{marginRatio:1,interval:{style:i,color:o,shape:a}}})),e}function Gie(e){var t=e.chart,r=e.options,n=r.label,i=r.xField,a=vu(t,"interval");if(n===!1)a.label(!1);else if(Xi(n)){var o=n.callback,s=n.fields,l=fi(n,["callback","fields"]),u=l.offset,c=l.layout;(u===void 0||u>=0)&&(c=c?Fe(c)?c:[c]:[],l.layout=Al(c,function(f){return f.type!=="limit-in-shape"}),l.layout.length||delete l.layout),a.label({fields:s||[i],callback:o,cfg:Cl(l)})}else Sg(Zd.WARN,n===null,"the label option must be an Object."),a.label({fields:[i]});return e}function Wie(e){var t=e.chart,r=e.options,n=r.legend,i=r.seriesField;return n===!1?t.legend(!1):i&&t.legend(i,n),e}function Xie(e){var t=e.chart,r=e.options,n=r.radius,i=r.innerRadius,a=r.startAngle,o=r.endAngle;return t.coordinate({type:"polar",cfg:{radius:n,innerRadius:i,startAngle:a,endAngle:o}}),e}function jie(e){var t,r=e.options,n=r.xAxis,i=r.yAxis,a=r.xField,o=r.yField;return zn(ns((t={},t[a]=n,t[o]=i,t)))(e)}function Yie(e){var t=e.chart,r=e.options,n=r.xAxis,i=r.yAxis,a=r.xField,o=r.yField;return n?t.axis(a,n):t.axis(a,!1),i?t.axis(o,i):t.axis(o,!1),e}function Zie(e){zn(Jh("sectorStyle"),Vie,jie,Gie,Xie,Yie,Wie,al,xo,Ma,ea,Ao(),S0)(e)}var qie=me({},ti.getDefaultOptions(),{xAxis:!1,yAxis:!1,legend:{position:"right",radio:{}},sectorStyle:{stroke:"#fff",lineWidth:1},label:{layout:{type:"limit-in-shape"}},tooltip:{shared:!0,showMarkers:!1},interactions:[{type:"active-region"}]}),Kie=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="rose",r}return t.getDefaultOptions=function(){return qie},t.prototype.changeData=function(r){this.updateOption({data:r}),this.chart.changeData(r)},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return Zie},t}(ti);const COe=Object.freeze(Object.defineProperty({__proto__:null,Rose:Kie},Symbol.toStringTag,{value:"Module"}));var iX="x",aX="y",oX="name",N3="nodes",k3="edges";function Qie(e,t,r){var n=[];return e.forEach(function(i){var a=i[t],o=i[r];n.includes(a)||n.push(a),n.includes(o)||n.push(o)}),n}function Jie(e,t,r,n){var i={};return t.forEach(function(a){i[a]={},t.forEach(function(o){i[a][o]=0})}),e.forEach(function(a){i[a[r]][a[n]]=1}),i}function tae(e,t,r){if(!Fe(e))return[];var n=[],i=Qie(e,t,r),a=Jie(e,i,t,r),o={};i.forEach(function(l){o[l]=0});function s(l){o[l]=1,i.forEach(function(u){if(a[l][u]!=0)if(o[u]==1)n.push("".concat(l,"_").concat(u));else{if(o[u]==-1)return;s(u)}}),o[l]=-1}return i.forEach(function(l){o[l]!=-1&&s(l)}),n.length!==0&&console.warn("sankey data contains circle, ".concat(n.length," records removed."),n),e.filter(function(l){return n.findIndex(function(u){return u==="".concat(l[t],"_").concat(l[r])})<0})}function eae(e){return e.target.depth}function rae(e){return e.depth}function nae(e,t){return t-1-e.height}function Dk(e,t){return e.sourceLinks.length?e.depth:t-1}function iae(e){return e.targetLinks.length?e.depth:e.sourceLinks.length?Ktt(e.sourceLinks,eae)-1:0}function IA(e){return function(){return e}}function PP(e,t){for(var r=0,n=0;n<e.length;n++)r+=t(e[n]);return r}function DP(e,t){for(var r=-1/0,n=0;n<e.length;n++)r=Math.max(t(e[n]),r);return r}function aae(e,t){for(var r=1/0,n=0;n<e.length;n++)r=Math.min(t(e[n]),r);return r}function sX(e,t){return XR(e.source,t.source)||e.index-t.index}function lX(e,t){return XR(e.target,t.target)||e.index-t.index}function XR(e,t){return e.y0-t.y0}function FP(e){return e.value}function oae(e){return e.index}function sae(e){return e.nodes}function lae(e){return e.links}function uX(e,t){var r=e.get(t);if(!r)throw new Error("missing: "+t);return r}function cX(e){for(var t=e.nodes,r=0,n=t;r<n.length;r++){for(var i=n[r],a=i.y0,o=a,s=0,l=i.sourceLinks;s<l.length;s++){var u=l[s];u.y0=a+u.width/2,a+=u.width}for(var c=0,f=i.targetLinks;c<f.length;c++){var u=f[c];u.y1=o+u.width/2,o+=u.width}}}function uae(){var e=0,t=0,r=1,n=1,i=24,a=8,o,s=oae,l=Dk,u,c,f,d=sae,v=lae,g=6;function x(vt){var zt={nodes:d(vt),links:v(vt)};return w(zt),S(zt),M(zt),R(zt),k(zt),cX(zt),zt}x.update=function(vt){return cX(vt),vt},x.nodeId=function(vt){return arguments.length?(s=typeof vt=="function"?vt:IA(vt),x):s},x.nodeAlign=function(vt){return arguments.length?(l=typeof vt=="function"?vt:IA(vt),x):l},x.nodeDepth=function(vt){return arguments.length?(u=vt,x):u},x.nodeSort=function(vt){return arguments.length?(c=vt,x):c},x.nodeWidth=function(vt){return arguments.length?(i=+vt,x):i},x.nodePadding=function(vt){return arguments.length?(a=o=+vt,x):a},x.nodes=function(vt){return arguments.length?(d=typeof vt=="function"?vt:IA(vt),x):d},x.links=function(vt){return arguments.length?(v=typeof vt=="function"?vt:IA(vt),x):v},x.linkSort=function(vt){return arguments.length?(f=vt,x):f},x.size=function(vt){return arguments.length?(e=t=0,r=+vt[0],n=+vt[1],x):[r-e,n-t]},x.extent=function(vt){return arguments.length?(e=+vt[0][0],r=+vt[1][0],t=+vt[0][1],n=+vt[1][1],x):[[e,t],[r,n]]},x.iterations=function(vt){return arguments.length?(g=+vt,x):g};function w(vt){var zt=vt.nodes,oe=vt.links;zt.forEach(function(Be,Zr){Be.index=Zr,Be.sourceLinks=[],Be.targetLinks=[]});var Qt=new Map(zt.map(function(Be){return[s(Be),Be]}));if(oe.forEach(function(Be,Zr){Be.index=Zr;var Wr=Be.source,In=Be.target;typeof Wr!="object"&&(Wr=Be.source=uX(Qt,Wr)),typeof In!="object"&&(In=Be.target=uX(Qt,In)),Wr.sourceLinks.push(Be),In.targetLinks.push(Be)}),f!=null)for(var ne=0,de=zt;ne<de.length;ne++){var De=de[ne],Ze=De.sourceLinks,ke=De.targetLinks;Ze.sort(f),ke.sort(f)}}function S(vt){for(var zt=vt.nodes,oe=0,Qt=zt;oe<Qt.length;oe++){var ne=Qt[oe];ne.value=ne.fixedValue===void 0?Math.max(PP(ne.sourceLinks,FP),PP(ne.targetLinks,FP)):ne.fixedValue}}function M(vt){for(var zt=vt.nodes,oe=zt.length,Qt=new Set(zt),ne=new Set,de=0;Qt.size;){if(Qt.forEach(function(Be){Be.depth=de;for(var Zr=0,Wr=Be.sourceLinks;Zr<Wr.length;Zr++){var In=Wr[Zr].target;ne.add(In)}}),++de>oe)throw new Error("circular link");Qt=ne,ne=new Set}if(u)for(var De=Math.max(DP(zt,function(Be){return Be.depth})+1,0),Ze=void 0,ke=0;ke<zt.length;ke++)Ze=zt[ke],Ze.depth=u.call(null,Ze,De)}function R(vt){for(var zt=vt.nodes,oe=zt.length,Qt=new Set(zt),ne=new Set,de=0;Qt.size;){if(Qt.forEach(function(De){De.height=de;for(var Ze=0,ke=De.targetLinks;Ze<ke.length;Ze++){var Be=ke[Ze].source;ne.add(Be)}}),++de>oe)throw new Error("circular link");Qt=ne,ne=new Set}}function I(vt){for(var zt=vt.nodes,oe=Math.max(DP(zt,function(In){return In.depth})+1,0),Qt=(r-e-i)/(oe-1),ne=new Array(oe).fill(0).map(function(){return[]}),de=0,De=zt;de<De.length;de++){var Ze=De[de],ke=Math.max(0,Math.min(oe-1,Math.floor(l.call(null,Ze,oe))));Ze.layer=ke,Ze.x0=e+ke*Qt,Ze.x1=Ze.x0+i,ne[ke]?ne[ke].push(Ze):ne[ke]=[Ze]}if(c)for(var Be=0,Zr=ne;Be<Zr.length;Be++){var Wr=Zr[Be];Wr.sort(c)}return ne}function P(vt){for(var zt=aae(vt,function(re){return(n-t-(re.length-1)*o)/PP(re,FP)}),oe=0,Qt=vt;oe<Qt.length;oe++){for(var ne=Qt[oe],de=t,De=0,Ze=ne;De<Ze.length;De++){var ke=Ze[De];ke.y0=de,ke.y1=de+ke.value*zt,de=ke.y1+o;for(var Be=0,Zr=ke.sourceLinks;Be<Zr.length;Be++){var Wr=Zr[Be];Wr.width=Wr.value*zt}}de=(n-de+o)/(ne.length+1);for(var In=0;In<ne.length;++In){var ke=ne[In];ke.y0+=de*(In+1),ke.y1+=de*(In+1)}at(ne)}}function k(vt){var zt=I(vt);o=Math.min(a,(n-t)/(DP(zt,function(de){return de.length})-1)),P(zt);for(var oe=0;oe<g;++oe){var Qt=Math.pow(.99,oe),ne=Math.max(1-Qt,(oe+1)/g);G(zt,Qt,ne),z(zt,Qt,ne)}}function z(vt,zt,oe){for(var Qt=1,ne=vt.length;Qt<ne;++Qt){for(var de=vt[Qt],De=0,Ze=de;De<Ze.length;De++){for(var ke=Ze[De],Be=0,Zr=0,Wr=0,In=ke.targetLinks;Wr<In.length;Wr++){var re=In[Wr],nr=re.source,zr=re.value,Ne=zr*(ke.layer-nr.layer);Be+=wt(nr,ke)*Ne,Zr+=Ne}if(Zr>0){var Vr=(Be/Zr-ke.y0)*zt;ke.y0+=Vr,ke.y1+=Vr,et(ke)}}c===void 0&&de.sort(XR),de.length&&J(de,oe)}}function G(vt,zt,oe){for(var Qt=vt.length,ne=Qt-2;ne>=0;--ne){for(var de=vt[ne],De=0,Ze=de;De<Ze.length;De++){for(var ke=Ze[De],Be=0,Zr=0,Wr=0,In=ke.sourceLinks;Wr<In.length;Wr++){var re=In[Wr],nr=re.target,zr=re.value,Ne=zr*(nr.layer-ke.layer);Be+=Tt(ke,nr)*Ne,Zr+=Ne}if(Zr>0){var Vr=(Be/Zr-ke.y0)*zt;ke.y0+=Vr,ke.y1+=Vr,et(ke)}}c===void 0&&de.sort(XR),de.length&&J(de,oe)}}function J(vt,zt){var oe=vt.length>>1,Qt=vt[oe];X(vt,Qt.y0-o,oe-1,zt),Z(vt,Qt.y1+o,oe+1,zt),X(vt,n,vt.length-1,zt),Z(vt,t,0,zt)}function Z(vt,zt,oe,Qt){for(;oe<vt.length;++oe){var ne=vt[oe],de=(zt-ne.y0)*Qt;de>1e-6&&(ne.y0+=de,ne.y1+=de),zt=ne.y1+o}}function X(vt,zt,oe,Qt){for(;oe>=0;--oe){var ne=vt[oe],de=(ne.y1-zt)*Qt;de>1e-6&&(ne.y0-=de,ne.y1-=de),zt=ne.y0-o}}function et(vt){var zt=vt.sourceLinks,oe=vt.targetLinks;if(f===void 0){for(var Qt=0,ne=oe;Qt<ne.length;Qt++){var de=ne[Qt].source.sourceLinks;de.sort(lX)}for(var De=0,Ze=zt;De<Ze.length;De++){var ke=Ze[De].target.targetLinks;ke.sort(sX)}}}function at(vt){if(f===void 0)for(var zt=0,oe=vt;zt<oe.length;zt++){var Qt=oe[zt],ne=Qt.sourceLinks,de=Qt.targetLinks;ne.sort(lX),de.sort(sX)}}function wt(vt,zt){for(var oe=vt.y0-(vt.sourceLinks.length-1)*o/2,Qt=0,ne=vt.sourceLinks;Qt<ne.length;Qt++){var de=ne[Qt],De=de.target,Ze=de.width;if(De===zt)break;oe+=Ze+o}for(var ke=0,Be=zt.targetLinks;ke<Be.length;ke++){var Zr=Be[ke],De=Zr.source,Ze=Zr.width;if(De===vt)break;oe-=Ze}return oe}function Tt(vt,zt){for(var oe=zt.y0-(zt.targetLinks.length-1)*o/2,Qt=0,ne=zt.targetLinks;Qt<ne.length;Qt++){var de=ne[Qt],De=de.source,Ze=de.width;if(De===vt)break;oe+=Ze+o}for(var ke=0,Be=vt.sourceLinks;ke<Be.length;ke++){var Zr=Be[ke],De=Zr.target,Ze=Zr.width;if(De===zt)break;oe-=Ze}return oe}return x}var cae={left:rae,right:nae,center:iae,justify:Dk},hae={nodeId:function(e){return e.index},nodeAlign:"justify",nodeWidth:.008,nodePadding:.03,nodeSort:void 0};function fae(e){var t=en(e)?cae[e]:Rr(e)?e:null;return t||Dk}function dae(e){return Qi({},hae,e)}function pae(e,t){var r=dae(e),n=r.nodeId,i=r.nodeSort,a=r.nodeAlign,o=r.nodeWidth,s=r.nodePadding,l=r.nodeDepth,u=uae().nodeSort(i).nodeWidth(o).nodePadding(s).nodeDepth(l).nodeAlign(fae(a)).extent([[0,0],[1,1]]).nodeId(n),c=u(t),f=c.nodes.map(function(v){var g=v.x0,x=v.x1,w=v.y0,S=v.y1;return v.x=[g,x,x,g],v.y=[w,w,S,S],v}).filter(function(v){return v.name!==null}),d=c.links.map(function(v){var g=v.source,x=v.target,w=g.x1,S=x.x0;v.x=[w,w,S,S];var M=v.width/2;return v.y=[v.y0+M,v.y0-M,v.y1+M,v.y1-M],v}).filter(function(v){var g=v.source,x=v.target;return g.name!==null&&x.name!==null});return{nodes:f,links:d}}function vae(e){return e==="node-link"}function gae(e,t,r){return f_(e)?e/r:t}function mae(e,t,r){return f_(e)?e/r:t}function Aot(e,t,r){var n=e.dataType,i=e.data,a=e.sourceField,o=e.targetField,s=e.weightField,l=e.nodeAlign,u=e.nodeSort,c=e.nodePadding,f=e.nodePaddingRatio,d=e.nodeWidth,v=e.nodeWidthRatio,g=e.nodeDepth,x=e.rawFields,w=x===void 0?[]:x,S;vae(n)?S=i:S=Bit(tae(i,a,o),a,o,s,w);var M=pae({nodeAlign:l,nodePadding:mae(c,f,r),nodeWidth:gae(d,v,t),nodeSort:u,nodeDepth:g},S),R=M.nodes,I=M.links;return{nodes:R.map(function(P){return $($({},Ea(P,on(["x","y","name"],w,!0))),{isNode:!0})}),edges:I.map(function(P){return $($({source:P.source.name,target:P.target.name,name:P.source.name||P.target.name},Ea(P,on(["x","y","value"],w,!0))),{isNode:!1})})}}function yae(e){var t=e.options,r=t.rawFields,n=r===void 0?[]:r;return me({},{options:{tooltip:{fields:xg(on(["name","source","target","value","isNode"],n,!0))},label:{fields:xg(on(["x","name"],n,!0))}}},e)}function _ae(e){var t=e.chart,r=e.options,n=r.color,i=r.nodeStyle,a=r.edgeStyle,o=r.label,s=r.tooltip,l=r.nodeState,u=r.edgeState,c=r.rawFields,f=c===void 0?[]:c;t.legend(!1),t.tooltip(s),t.axis(!1),t.coordinate().reflect("y");var d=Aot(r,t.width,t.height),v=d.nodes,g=d.edges,x=t.createView({id:k3});x.data(g),Xit({chart:x,options:{xField:iX,yField:aX,seriesField:oX,rawFields:on(["source","target"],f,!0),edge:{color:n,style:a,shape:"arc"},tooltip:s,state:u}});var w=t.createView({id:N3});return w.data(v),R3({chart:w,options:{xField:iX,yField:aX,seriesField:oX,polygon:{color:n,style:i},label:o,tooltip:s,state:l}}),t.interaction("element-active"),t.scale({x:{sync:!0,nice:!0,min:0,max:1,minLimit:0,maxLimit:1},y:{sync:!0,nice:!0,min:0,max:1,minLimit:0,maxLimit:1},name:{sync:"color",type:"cat"}}),e}function xae(e){var t=e.chart,r=e.options,n=r.animation,i=on(on([],t.views[0].geometries,!0),t.views[1].geometries,!0);return g2(t,n,i),e}function bae(e){var t=e.chart,r=e.options,n=r.nodeDraggable,i="sankey-node-draggable";return n?t.interaction(i):t.removeInteraction(i),e}function Eae(e){var t=e.chart,r=e.options,n=r.interactions,i=n===void 0?[]:n,a=[].concat(i,r.nodeInteractions||[]),o=[].concat(i,r.edgeInteractions||[]),s=_i(t,N3),l=_i(t,k3);return a.forEach(function(u){(u==null?void 0:u.enable)===!1?s.removeInteraction(u.type):s.interaction(u.type,u.cfg||{})}),o.forEach(function(u){(u==null?void 0:u.enable)===!1?l.removeInteraction(u.type):l.interaction(u.type,u.cfg||{})}),e}function wae(e){return zn(yae,_ae,Eae,bae,xae,ea)(e)}var Cae=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.isDragging=!1,r}return t.prototype.isNodeElement=function(){var r=xt(this.context,"event.target");if(r){var n=r.get("element");return n&&n.getModel().data.isNode}return!1},t.prototype.getNodeView=function(){return _i(this.context.view,N3)},t.prototype.getEdgeView=function(){return _i(this.context.view,k3)},t.prototype.getCurrentDatumIdx=function(r){return this.getNodeView().geometries[0].elements.indexOf(r)},t.prototype.start=function(){if(this.isNodeElement()){this.prevPoint={x:xt(this.context,"event.x"),y:xt(this.context,"event.y")};var r=this.context.event.target.get("element"),n=this.getCurrentDatumIdx(r);if(n===-1)return;this.currentElementIdx=n,this.context.isDragging=!0,this.isDragging=!0,this.prevNodeAnimateCfg=this.getNodeView().getOptions().animate,this.prevEdgeAnimateCfg=this.getEdgeView().getOptions().animate,this.getNodeView().animate(!1),this.getEdgeView().animate(!1)}},t.prototype.translate=function(){if(this.isDragging){var r=this.context.view,n={x:xt(this.context,"event.x"),y:xt(this.context,"event.y")},i=n.x-this.prevPoint.x,a=n.y-this.prevPoint.y,o=this.getNodeView(),s=o.geometries[0].elements[this.currentElementIdx];if(s&&s.getModel()){var l=s.getModel().data,u=o.getOptions().data,c=o.getCoordinate(),f={x:i/c.getWidth(),y:a/c.getHeight()},d=$($({},l),{x:l.x.map(function(S){return S+=f.x}),y:l.y.map(function(S){return S+=f.y})}),v=on([],u,!0);v[this.currentElementIdx]=d,o.data(v);var g=l.name,x=this.getEdgeView(),w=x.getOptions().data;w.forEach(function(S){S.source===g&&(S.x[0]+=f.x,S.x[1]+=f.x,S.y[0]+=f.y,S.y[1]+=f.y),S.target===g&&(S.x[2]+=f.x,S.x[3]+=f.x,S.y[2]+=f.y,S.y[3]+=f.y)}),x.data(w),this.prevPoint=n,r.render(!0)}}},t.prototype.end=function(){this.isDragging=!1,this.context.isDragging=!1,this.prevPoint=null,this.currentElementIdx=null,this.getNodeView().animate(this.prevNodeAnimateCfg),this.getEdgeView().animate(this.prevEdgeAnimateCfg)},t}(io);yn("sankey-node-drag",Cae);Zn("sankey-node-draggable",{showEnable:[{trigger:"polygon:mouseenter",action:"cursor:pointer"},{trigger:"polygon:mouseleave",action:"cursor:default"}],start:[{trigger:"polygon:mousedown",action:"sankey-node-drag:start"}],processing:[{trigger:"plot:mousemove",action:"sankey-node-drag:translate"},{isEnable:function(e){return e.isDragging},trigger:"plot:mousemove",action:"cursor:move"}],end:[{trigger:"plot:mouseup",action:"sankey-node-drag:end"}]});var Sae=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="sankey",r}return t.getDefaultOptions=function(){return{appendPadding:8,syncViewPadding:!0,nodeStyle:{opacity:1,fillOpacity:1,lineWidth:1},edgeStyle:{opacity:.3,lineWidth:0},edgeState:{active:{style:{opacity:.8,lineWidth:0}}},label:{formatter:function(r){var n=r.name;return n},callback:function(r){var n=r[1]===1;return{style:{fill:"#545454",textAlign:n?"end":"start"},offsetX:n?-8:8}},layout:[{type:"hide-overlap"}]},tooltip:{showTitle:!1,showMarkers:!1,shared:!1,showContent:function(r){return!xt(r,[0,"data","isNode"])},formatter:function(r){var n=r.source,i=r.target,a=r.value;return{name:n+" -> "+i,value:a}}},nodeWidthRatio:.008,nodePaddingRatio:.01,animation:{appear:{animation:"wave-in"},enter:{animation:"wave-in"}}}},t.prototype.changeData=function(r){this.updateOption({data:r});var n=Aot(this.options,this.chart.width,this.chart.height),i=n.nodes,a=n.edges,o=_i(this.chart,N3),s=_i(this.chart,k3);o.changeData(i),s.changeData(a)},t.prototype.getSchemaAdaptor=function(){return wae},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t}(ti);const SOe=Object.freeze(Object.defineProperty({__proto__:null,Sankey:Sae},Symbol.toStringTag,{value:"Module"}));var Fk="ancestor-node",Mot="value",nS="path",Tae=[nS,yot,Ik,_ot,"name","depth","height"],Aae=me({},ti.getDefaultOptions(),{innerRadius:0,radius:.85,hierarchyConfig:{field:"value"},tooltip:{shared:!0,showMarkers:!1,offset:20,showTitle:!1},legend:!1,sunburstStyle:{lineWidth:.5,stroke:"#FFF"},drilldown:{enabled:!0}}),Mae={field:"value",size:[1,1],round:!1,padding:0,sort:function(e,t){return t.value-e.value},as:["x","y"],ignoreParentValue:!0};function Rae(e,t){t=Qi({},Mae,t);var r=t.as;if(!Fe(r)||r.length!==2)throw new TypeError('Invalid as: it must be an array with 2 strings (e.g. [ "x", "y" ])!');var n;try{n=Lk(t)}catch(l){console.warn(l)}var i=function(l){return dot().size(t.size).round(t.round).padding(t.padding)(Yb(l).sum(function(u){return il(u.children)?t.ignoreParentValue?0:u[n]-du(u.children,function(c,f){return c+f[n]},0):u[n]}).sort(t.sort))},a=i(e),o=r[0],s=r[1];return a.each(function(l){var u,c;l[o]=[l.x0,l.x1,l.x1,l.x0],l[s]=[l.y1,l.y1,l.y0,l.y0],l.name=l.name||((u=l.data)===null||u===void 0?void 0:u.name)||((c=l.data)===null||c===void 0?void 0:c.label),l.data.name=l.name,["x0","x1","y0","y1"].forEach(function(f){r.indexOf(f)===-1&&delete l[f]})}),Ok(a)}var Iae={field:"value",tile:"treemapSquarify",size:[1,1],round:!1,ignoreParentValue:!0,padding:0,paddingInner:0,paddingOuter:0,paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0,as:["x","y"],sort:function(e,t){return t.value-e.value},ratio:.5*(1+Math.sqrt(5))};function Lae(e,t){return e==="treemapSquarify"?jW[e].ratio(t):jW[e]}function Rot(e,t){t=Qi({},Iae,t);var r=t.as;if(!Fe(r)||r.length!==2)throw new TypeError('Invalid as: it must be an array with 2 strings (e.g. [ "x", "y" ])!');var n;try{n=Lk(t)}catch(u){console.warn(u)}var i=Lae(t.tile,t.ratio),a=function(u){return mot().tile(i).size(t.size).round(t.round).padding(t.padding).paddingInner(t.paddingInner).paddingOuter(t.paddingOuter).paddingTop(t.paddingTop).paddingRight(t.paddingRight).paddingBottom(t.paddingBottom).paddingLeft(t.paddingLeft)(Yb(u).sum(function(c){return t.ignoreParentValue&&c.children?0:c[n]}).sort(t.sort))},o=a(e),s=r[0],l=r[1];return o.each(function(u){u[s]=[u.x0,u.x1,u.x1,u.x0],u[l]=[u.y1,u.y1,u.y0,u.y0],["x0","x1","y0","y1"].forEach(function(c){r.indexOf(c)===-1&&delete u[c]})}),Ok(o)}function Iot(e){var t=e.data,r=e.colorField,n=e.rawFields,i=e.hierarchyConfig,a=i===void 0?{}:i,o=a.activeDepth,s={partition:Rae,treemap:Rot},l=e.seriesField,u=e.type||"partition",c=s[u](t,$($({field:l||"value"},ZS(a,["activeDepth"])),{type:"hierarchy.".concat(u),as:["x","y"]})),f=[];return c.forEach(function(d){var v,g,x,w,S,M;if(d.depth===0||o>0&&d.depth>o)return null;for(var R=d.data.name,I=$({},d);I.depth>1;)R="".concat((g=I.parent.data)===null||g===void 0?void 0:g.name," / ").concat(R),I=I.parent;var P=$($($({},Ea(d.data,on(on([],n||[],!0),[a.field],!1))),(v={},v[nS]=R,v[Fk]=I.data.name,v)),d);l&&(P[l]=d.data[l]||((w=(x=d.parent)===null||x===void 0?void 0:x.data)===null||w===void 0?void 0:w[l])),r&&(P[r]=d.data[r]||((M=(S=d.parent)===null||S===void 0?void 0:S.data)===null||M===void 0?void 0:M[r])),P.ext=a,P[rS]={hierarchyConfig:a,colorField:r,rawFields:n},f.push(P)}),f}function Oae(e){var t=e.chart,r=e.options,n=r.color,i=r.colorField,a=i===void 0?Fk:i,o=r.sunburstStyle,s=r.rawFields,l=s===void 0?[]:s,u=r.shape,c=Iot(r);t.data(c);var f;return o&&(f=function(d){return me({},{fillOpacity:Math.pow(.85,d.depth)},Rr(o)?o(d):o)}),R3(me({},e,{options:{xField:"x",yField:"y",seriesField:a,rawFields:xg(on(on([],Tae,!0),l,!0)),polygon:{color:n,style:f,shape:u}}})),e}function Pae(e){var t=e.chart;return t.axis(!1),e}function Dae(e){var t=e.chart,r=e.options,n=r.label,i=vu(t,"polygon");if(!n)i.label(!1);else{var a=n.fields,o=a===void 0?["name"]:a,s=n.callback,l=fi(n,["fields","callback"]);i.label({fields:o,callback:s,cfg:Cl(l)})}return e}function Fae(e){var t=e.chart,r=e.options,n=r.innerRadius,i=r.radius,a=r.reflect,o=t.coordinate({type:"polar",cfg:{innerRadius:n,radius:i}});return a&&o.reflect(a),e}function Bae(e){var t,r=e.options,n=r.hierarchyConfig,i=r.meta;return zn(ns({},(t={},t[Mot]=xt(i,xt(n,["field"],"value")),t)))(e)}function Nae(e){var t=e.chart,r=e.options,n=r.tooltip;if(n===!1)t.tooltip(!1);else{var i=n;xt(n,"fields")||(i=me({},{customItems:function(a){return a.map(function(o){var s=xt(t.getOptions(),"scales"),l=xt(s,[nS,"formatter"],function(c){return c}),u=xt(s,[Mot,"formatter"],function(c){return c});return $($({},o),{name:l(o.data[nS]),value:u(o.data.value)})})}},i)),t.tooltip(i)}return e}function kae(e){var t=e.drilldown,r=e.interactions,n=r===void 0?[]:r;return t!=null&&t.enabled?me({},e,{interactions:on(on([],n,!0),[{type:"drill-down",cfg:{drillDownConfig:t,transformData:Iot}}],!1)}):e}function zae(e){var t=e.chart,r=e.options,n=r.drilldown;return xo({chart:t,options:kae(r)}),n!=null&&n.enabled&&(t.appendPadding=C3(t.appendPadding,xt(n,["breadCrumb","position"]))),e}function Uae(e){return zn(ea,Jh("sunburstStyle"),Oae,Pae,Bae,Gb,Fae,Nae,Dae,zae,Ma,Ao())(e)}(function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="sunburst",r}return t.getDefaultOptions=function(){return Aae},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return Uae},t.SUNBURST_ANCESTOR_FIELD=Fk,t.SUNBURST_PATH_FIELD=nS,t.NODE_ANCESTORS_FIELD=Ik,t})(ti);function Lot(e,t){if(Fe(e))return e.find(function(r){return r.type===t})}function Oot(e,t){var r=Lot(e,t);return r&&r.enable!==!1}function Bk(e){var t=e.interactions,r=e.drilldown;return xt(r,"enabled")||Oot(t,"treemap-drill-down")}function $ae(e){var t=e.interactions["drill-down"];if(t){var r=t.context.actions.find(function(n){return n.name==="drill-down-action"});r.reset()}}function Nk(e){var t=e.data,r=e.colorField,n=e.enableDrillDown,i=e.hierarchyConfig,a=Rot(t,$($({},i),{type:"hierarchy.treemap",field:"value",as:["x","y"]})),o=[];return a.forEach(function(s){if(s.depth===0||n&&s.depth!==1||!n&&s.children)return null;var l=s.ancestors().map(function(d){return{data:d.data,height:d.height,value:d.value}}),u=n&&Fe(t.path)?l.concat(t.path.slice(1)):l,c=Object.assign({},s.data,$({x:s.x,y:s.y,depth:s.depth,value:s.value,path:u},s));if(!s.data[r]&&s.parent){var f=s.ancestors().find(function(d){return d.data[r]});c[r]=f==null?void 0:f.data[r]}else c[r]=s.data[r];c[rS]={hierarchyConfig:i,colorField:r,enableDrillDown:n},o.push(c)}),o}function Hae(e){var t=e.options,r=t.colorField;return me({options:{rawFields:["value"],tooltip:{fields:["name","value",r,"path"],formatter:function(n){return{name:n.name,value:n.value}}}}},e)}function Vae(e){var t=e.chart,r=e.options,n=r.color,i=r.colorField,a=r.rectStyle,o=r.hierarchyConfig,s=r.rawFields,l=Nk({data:r.data,colorField:r.colorField,enableDrillDown:Bk(r),hierarchyConfig:o});return t.data(l),R3(me({},e,{options:{xField:"x",yField:"y",seriesField:i,rawFields:s,polygon:{color:n,style:a}}})),t.coordinate().reflect("y"),e}function Gae(e){var t=e.chart;return t.axis(!1),e}function Wae(e){var t=e.drilldown,r=e.interactions,n=r===void 0?[]:r,i=Bk(e);return i?me({},e,{interactions:on(on([],n,!0),[{type:"drill-down",cfg:{drillDownConfig:t,transformData:Nk}}],!1)}):e}function Xae(e){var t=e.chart,r=e.options,n=r.interactions,i=r.drilldown;xo({chart:t,options:Wae(r)});var a=Lot(n,"view-zoom");a&&(a.enable!==!1?t.getCanvas().on("mousewheel",function(s){s.preventDefault()}):t.getCanvas().off("mousewheel"));var o=Bk(r);return o&&(t.appendPadding=C3(t.appendPadding,xt(i,["breadCrumb","position"]))),e}function jae(e){return zn(Hae,ea,Jh("rectStyle"),Vae,Gae,Gb,al,Xae,Ma,Ao())(e)}var Yae={colorField:"name",rectStyle:{lineWidth:1,stroke:"#fff"},hierarchyConfig:{tile:"treemapSquarify"},label:{fields:["name"],layout:{type:"limit-in-shape"}},tooltip:{showMarkers:!1,showTitle:!1},drilldown:{enabled:!1,breadCrumb:{position:"bottom-left",rootText:"初始",dividerText:"/",textStyle:{fontSize:12,fill:"rgba(0, 0, 0, 0.65)",cursor:"pointer"},activeTextStyle:{fill:"#87B5FF"}}}},Zae=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="treemap",r}return t.getDefaultOptions=function(){return Yae},t.prototype.changeData=function(r){var n=this.options,i=n.colorField,a=n.interactions,o=n.hierarchyConfig;this.updateOption({data:r});var s=Nk({data:r,colorField:i,enableDrillDown:Oot(a,"treemap-drill-down"),hierarchyConfig:o});this.chart.changeData(s),$ae(this.chart)},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return jae},t}(ti);const TOe=Object.freeze(Object.defineProperty({__proto__:null,Treemap:Zae},Symbol.toStringTag,{value:"Module"}));var gg="id",sB="path",qae={appendPadding:[10,0,20,0],blendMode:"multiply",tooltip:{showTitle:!1,showMarkers:!1,fields:["id","size"],formatter:function(e){return{name:e.id,value:e.size}}},legend:{position:"top-left"},label:{style:{textAlign:"center",fill:"#fff"}},interactions:[{type:"legend-filter",enable:!1}],state:{active:{style:{stroke:"#000"}},selected:{style:{stroke:"#000",lineWidth:2}},inactive:{style:{fillOpacity:.3,strokeOpacity:.3}}},defaultInteractions:["tooltip","venn-legend-active"]};function z3(e){if(e){var t=e.geometries[0].elements;t.forEach(function(r){r.shape.toFront()})}}var Kae=g3("element-active"),Qae=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.syncElementsPos=function(){z3(this.context.view)},t.prototype.active=function(){e.prototype.active.call(this),this.syncElementsPos()},t.prototype.toggle=function(){e.prototype.toggle.call(this),this.syncElementsPos()},t.prototype.reset=function(){e.prototype.reset.call(this),this.syncElementsPos()},t}(Kae),Jae=g3("element-highlight"),toe=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.syncElementsPos=function(){z3(this.context.view)},t.prototype.highlight=function(){e.prototype.highlight.call(this),this.syncElementsPos()},t.prototype.toggle=function(){e.prototype.toggle.call(this),this.syncElementsPos()},t.prototype.clear=function(){e.prototype.clear.call(this),this.syncElementsPos()},t.prototype.reset=function(){e.prototype.reset.call(this),this.syncElementsPos()},t}(Jae),eoe=g3("element-selected"),roe=g3("element-single-selected"),noe=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.syncElementsPos=function(){z3(this.context.view)},t.prototype.selected=function(){e.prototype.selected.call(this),this.syncElementsPos()},t.prototype.toggle=function(){e.prototype.toggle.call(this),this.syncElementsPos()},t.prototype.reset=function(){e.prototype.reset.call(this),this.syncElementsPos()},t}(eoe),ioe=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.syncElementsPos=function(){z3(this.context.view)},t.prototype.selected=function(){e.prototype.selected.call(this),this.syncElementsPos()},t.prototype.toggle=function(){e.prototype.toggle.call(this),this.syncElementsPos()},t.prototype.reset=function(){e.prototype.reset.call(this),this.syncElementsPos()},t}(roe);yn("venn-element-active",Qae);yn("venn-element-highlight",toe);yn("venn-element-selected",noe);yn("venn-element-single-selected",ioe);Zn("venn-element-active",{start:[{trigger:"element:mouseenter",action:"venn-element-active:active"}],end:[{trigger:"element:mouseleave",action:"venn-element-active:reset"}]});Zn("venn-element-highlight",{start:[{trigger:"element:mouseenter",action:"venn-element-highlight:highlight"}],end:[{trigger:"element:mouseleave",action:"venn-element-highlight:reset"}]});Zn("venn-element-selected",{start:[{trigger:"element:click",action:"venn-element-selected:toggle"}],rollback:[{trigger:"dblclick",action:["venn-element-selected:reset"]}]});Zn("venn-element-single-selected",{start:[{trigger:"element:click",action:"venn-element-single-selected:toggle"}],rollback:[{trigger:"dblclick",action:["venn-element-single-selected:reset"]}]});Zn("venn-legend-active",{start:[{trigger:"legend-item:mouseenter",action:["list-active:active","venn-element-active:active"]}],end:[{trigger:"legend-item:mouseleave",action:["list-active:reset","venn-element-active:reset"]}]});Zn("venn-legend-highlight",{start:[{trigger:"legend-item:mouseenter",action:["legend-item-highlight:highlight","venn-element-highlight:highlight"]}],end:[{trigger:"legend-item:mouseleave",action:["legend-item-highlight:reset","venn-element-highlight:reset"]}]});var aoe=function(e){$t(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getLabelPoint=function(r,n,i){var a=r.data,o=a.x,s=a.y,l=r.customLabelInfo,u=l.offsetX,c=l.offsetY;return{content:r.content[i],x:o+u,y:s+c}},t}(x3);d2("venn",aoe);var lC=`	
\v\f\r   ᠎             　\u2028\u2029`,ooe=new RegExp("([a-z])["+lC+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+lC+"]*,?["+lC+"]*)+)","ig"),soe=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+lC+"]*,?["+lC+"]*","ig");function loe(e){if(!e)return null;if(qft(e))return e;var t={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},r=[];return String(e).replace(ooe,function(n,i,a){var o=[],s=i.toLowerCase();if(a.replace(soe,function(l,u){u&&o.push(+u)}),s==="m"&&o.length>2&&(r.push([i].concat(o.splice(0,2))),s="l",i=i==="m"?"l":"L"),s==="o"&&o.length===1&&r.push([i,o[0]]),s==="r")r.push([i].concat(o));else for(;o.length>=t[s]&&(r.push([i].concat(o.splice(0,t[s]))),!!t[s]););return""}),r}function uoe(e){return me({},e.defaultStyle,{fill:e.color},e.style)}fa("schema","venn",{draw:function(e,t){var r=e.data,n=loe(r[sB]),i=uoe(e),a=t.addGroup({name:"venn-shape"});a.addShape("path",{attrs:$($({},i),{path:n}),name:"venn-path"});var o=e.customInfo,s=o.offsetX,l=o.offsetY,u=ih.transform(null,[["t",s,l]]);return a.setMatrix(u),a},getMarker:function(e){var t=e.color;return{symbol:"circle",style:{lineWidth:0,stroke:t,fill:t,r:4}}}});var coe=function(e){return function(t,r){var n=[];return n[0]=e(t[0],r[0]),n[1]=e(t[1],r[1]),n[2]=e(t[2],r[2]),n}},hX={normal:function(e){return e},multiply:function(e,t){return e*t/255},screen:function(e,t){return 255*(1-(1-e/255)*(1-t/255))},overlay:function(e,t){return t<128?2*e*t/255:255*(1-2*(1-e/255)*(1-t/255))},darken:function(e,t){return e>t?t:e},lighten:function(e,t){return e>t?e:t},dodge:function(e,t){return e===255?255:(e=255*(t/255)/(1-e/255),e>255?255:e)},burn:function(e,t){return t===255?255:e===0?0:255*(1-Math.min(1,(1-t/255)/(e/255)))}},hoe=function(e){if(!hX[e])throw new Error("unknown blend mode "+e);return hX[e]};function foe(e,t,r){r===void 0&&(r="normal");var n=coe(hoe(r))(LA(e),LA(t)),i=LA(e),a=i[0],o=i[1],s=i[2],l=i[3],u=LA(t),c=u[0],f=u[1],d=u[2],v=u[3],g=Number((l+v*(1-l)).toFixed(2)),x=Math.round((l*(1-v)*(a/255)+l*v*(n[0]/255)+(1-l)*v*(c/255))/g*255),w=Math.round((l*(1-v)*(o/255)+l*v*(n[1]/255)+(1-l)*v*(f/255))/g*255),S=Math.round((l*(1-v)*(s/255)+l*v*(n[2]/255)+(1-l)*v*(d/255))/g*255);return"rgba(".concat(x,", ").concat(w,", ").concat(S,", ").concat(g,")")}function LA(e){var t=e.replace("/s+/g",""),r;return typeof t=="string"&&!t.startsWith("rgba")&&!t.startsWith("#")?r=Zm.rgb2arr(Zm.toRGB(t)).concat([1]):(t.startsWith("rgba")&&(r=t.replace("rgba(","").replace(")","").split(",")),t.startsWith("#")&&(r=Zm.rgb2arr(t).concat([1])),r.map(function(n,i){return i===3?Number(n):n|0}))}function doe(e,t,r,n){n=n||{};var i=n.maxIterations||100,a=n.tolerance||1e-10,o=e(t),s=e(r),l=r-t;if(o*s>0)throw"Initial bisect points must have opposite signs";if(o===0)return t;if(s===0)return r;for(var u=0;u<i;++u){l/=2;var c=t+l,f=e(c);if(f*o>=0&&(t=c),Math.abs(l)<a||f===0)return c}return t+l}function lB(e){for(var t=new Array(e),r=0;r<e;++r)t[r]=0;return t}function fX(e,t){return lB(e).map(function(){return lB(t)})}function Lx(e,t){for(var r=0,n=0;n<e.length;++n)r+=e[n]*t[n];return r}function uB(e){return Math.sqrt(Lx(e,e))}function cB(e,t,r){for(var n=0;n<t.length;++n)e[n]=t[n]*r}function ng(e,t,r,n,i){for(var a=0;a<e.length;++a)e[a]=t*r[a]+n*i[a]}function Pot(e,t,r){r=r||{};var n=r.maxIterations||t.length*200,i=r.nonZeroDelta||1.05,a=r.zeroDelta||.001,o=r.minErrorDelta||1e-6,s=r.minErrorDelta||1e-5,l=r.rho!==void 0?r.rho:1,u=r.chi!==void 0?r.chi:2,c=r.psi!==void 0?r.psi:-.5,f=r.sigma!==void 0?r.sigma:.5,d,v=t.length,g=new Array(v+1);g[0]=t,g[0].fx=e(t),g[0].id=0;for(var x=0;x<v;++x){var w=t.slice();w[x]=w[x]?w[x]*i:a,g[x+1]=w,g[x+1].fx=e(w),g[x+1].id=x+1}function S(et){for(var at=0;at<et.length;at++)g[v][at]=et[at];g[v].fx=et.fx}for(var M=function(et,at){return et.fx-at.fx},R=t.slice(),I=t.slice(),P=t.slice(),k=t.slice(),z=0;z<n;++z){if(g.sort(M),r.history){var G=g.map(function(et){var at=et.slice();return at.fx=et.fx,at.id=et.id,at});G.sort(function(et,at){return et.id-at.id}),r.history.push({x:g[0].slice(),fx:g[0].fx,simplex:G})}for(d=0,x=0;x<v;++x)d=Math.max(d,Math.abs(g[0][x]-g[1][x]));if(Math.abs(g[0].fx-g[v].fx)<o&&d<s)break;for(x=0;x<v;++x){R[x]=0;for(var J=0;J<v;++J)R[x]+=g[J][x];R[x]/=v}var Z=g[v];if(ng(I,1+l,R,-l,Z),I.fx=e(I),I.fx<g[0].fx)ng(k,1+u,R,-u,Z),k.fx=e(k),k.fx<I.fx?S(k):S(I);else if(I.fx>=g[v-1].fx){var X=!1;if(I.fx>Z.fx?(ng(P,1+c,R,-c,Z),P.fx=e(P),P.fx<Z.fx?S(P):X=!0):(ng(P,1-c*l,R,c*l,Z),P.fx=e(P),P.fx<I.fx?S(P):X=!0),X){if(f>=1)break;for(x=1;x<g.length;++x)ng(g[x],1-f,g[0],f,g[x]),g[x].fx=e(g[x])}}else S(I)}return g.sort(M),{fx:g[0].fx,x:g[0]}}function poe(e,t,r,n,i,a,o){var s=r.fx,l=Lx(r.fxprime,t),u=s,c=s,f=l,d=0;i=i||1,a=a||1e-6,o=o||.1;function v(x,w,S){for(var M=0;M<16;++M)if(i=(x+w)/2,ng(n.x,1,r.x,i,t),u=n.fx=e(n.x,n.fxprime),f=Lx(n.fxprime,t),u>s+a*i*l||u>=S)w=i;else{if(Math.abs(f)<=-o*l)return i;f*(w-x)>=0&&(w=x),x=i,S=u}return 0}for(var g=0;g<10;++g){if(ng(n.x,1,r.x,i,t),u=n.fx=e(n.x,n.fxprime),f=Lx(n.fxprime,t),u>s+a*i*l||g&&u>=c)return v(d,i,c);if(Math.abs(f)<=-o*l)return i;if(f>=0)return v(i,d,u);c=u,d=i,i*=2}return i}function voe(e,t,r){var n={x:t.slice(),fx:0,fxprime:t.slice()},i={x:t.slice(),fx:0,fxprime:t.slice()},a=t.slice(),o,s,l=1,u;r=r||{},u=r.maxIterations||t.length*20,n.fx=e(n.x,n.fxprime),o=n.fxprime.slice(),cB(o,n.fxprime,-1);for(var c=0;c<u;++c){if(l=poe(e,o,n,i,l),r.history&&r.history.push({x:n.x.slice(),fx:n.fx,fxprime:n.fxprime.slice(),alpha:l}),!l)cB(o,n.fxprime,-1);else{ng(a,1,i.fxprime,-1,n.fxprime);var f=Lx(n.fxprime,n.fxprime),d=Math.max(0,Lx(a,i.fxprime)/f);ng(o,d,o,-1,i.fxprime),s=n,n=i,i=s}if(uB(n.fxprime)<=1e-5)break}return r.history&&r.history.push({x:n.x.slice(),fx:n.fx,fxprime:n.fxprime.slice(),alpha:l}),n}var Dot=1e-10;function kk(e,t){var r=moe(e),n=r.filter(function(z){return goe(z,e)}),i=0,a=0,o,s=[];if(n.length>1){var l=Not(n);for(o=0;o<n.length;++o){var u=n[o];u.angle=Math.atan2(u.x-l.x,u.y-l.y)}n.sort(function(z,G){return G.angle-z.angle});var c=n[n.length-1];for(o=0;o<n.length;++o){var f=n[o];a+=(c.x+f.x)*(f.y-c.y);for(var d={x:(f.x+c.x)/2,y:(f.y+c.y)/2},v=null,g=0;g<f.parentIndex.length;++g)if(c.parentIndex.indexOf(f.parentIndex[g])>-1){var x=e[f.parentIndex[g]],w=Math.atan2(f.x-x.x,f.y-x.y),S=Math.atan2(c.x-x.x,c.y-x.y),M=S-w;M<0&&(M+=2*Math.PI);var R=S-M/2,I=Gd(d,{x:x.x+x.radius*Math.sin(R),y:x.y+x.radius*Math.cos(R)});I>x.radius*2&&(I=x.radius*2),(v===null||v.width>I)&&(v={circle:x,width:I,p1:f,p2:c})}v!==null&&(s.push(v),i+=hB(v.circle.radius,v.width),c=f)}}else{var P=e[0];for(o=1;o<e.length;++o)e[o].radius<P.radius&&(P=e[o]);var k=!1;for(o=0;o<e.length;++o)if(Gd(e[o],P)>Math.abs(P.radius-e[o].radius)){k=!0;break}k?i=a=0:(i=P.radius*P.radius*Math.PI,s.push({circle:P,p1:{x:P.x,y:P.y+P.radius},p2:{x:P.x-Dot,y:P.y+P.radius},width:P.radius*2}))}return a/=2,t&&(t.area=i+a,t.arcArea=i,t.polygonArea=a,t.arcs=s,t.innerPoints=n,t.intersectionPoints=r),i+a}function goe(e,t){for(var r=0;r<t.length;++r)if(Gd(e,t[r])>t[r].radius+Dot)return!1;return!0}function moe(e){for(var t=[],r=0;r<e.length;++r)for(var n=r+1;n<e.length;++n)for(var i=Bot(e[r],e[n]),a=0;a<i.length;++a){var o=i[a];o.parentIndex=[r,n],t.push(o)}return t}function hB(e,t){return e*e*Math.acos(1-t/e)-(e-t)*Math.sqrt(t*(2*e-t))}function Gd(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))}function Fot(e,t,r){if(r>=e+t)return 0;if(r<=Math.abs(e-t))return Math.PI*Math.min(e,t)*Math.min(e,t);var n=e-(r*r-t*t+e*e)/(2*r),i=t-(r*r-e*e+t*t)/(2*r);return hB(e,n)+hB(t,i)}function Bot(e,t){var r=Gd(e,t),n=e.radius,i=t.radius;if(r>=n+i||r<=Math.abs(n-i))return[];var a=(n*n-i*i+r*r)/(2*r),o=Math.sqrt(n*n-a*a),s=e.x+a*(t.x-e.x)/r,l=e.y+a*(t.y-e.y)/r,u=-(t.y-e.y)*(o/r),c=-(t.x-e.x)*(o/r);return[{x:s+u,y:l-c},{x:s-u,y:l+c}]}function Not(e){for(var t={x:0,y:0},r=0;r<e.length;++r)t.x+=e[r].x,t.y+=e[r].y;return t.x/=e.length,t.y/=e.length,t}function BP(e,t,r){var n=t[0].radius-Gd(t[0],e),i,a;for(i=1;i<t.length;++i)a=t[i].radius-Gd(t[i],e),a<=n&&(n=a);for(i=0;i<r.length;++i)a=Gd(r[i],e)-r[i].radius,a<=n&&(n=a);return n}function kot(e,t){var r=[],n;for(n=0;n<e.length;++n){var i=e[n];r.push({x:i.x,y:i.y}),r.push({x:i.x+i.radius/2,y:i.y}),r.push({x:i.x-i.radius/2,y:i.y}),r.push({x:i.x,y:i.y+i.radius/2}),r.push({x:i.x,y:i.y-i.radius/2})}var a=r[0],o=BP(r[0],e,t);for(n=1;n<r.length;++n){var s=BP(r[n],e,t);s>=o&&(a=r[n],o=s)}var l=Pot(function(d){return-1*BP({x:d[0],y:d[1]},e,t)},[a.x,a.y],{maxIterations:500,minErrorDelta:1e-10}).x,u={x:l[0],y:l[1]},c=!0;for(n=0;n<e.length;++n)if(Gd(u,e[n])>e[n].radius){c=!1;break}for(n=0;n<t.length;++n)if(Gd(u,t[n])<t[n].radius){c=!1;break}if(!c)if(e.length==1)u={x:e[0].x,y:e[0].y};else{var f={};kk(e,f),f.arcs.length===0?u={x:0,y:-1e3,disjoint:!0}:f.arcs.length==1?u={x:f.arcs[0].circle.x,y:f.arcs[0].circle.y}:t.length?u=kot(e,[]):u=Not(f.arcs.map(function(d){return d.p1}))}return u}function yoe(e){var t={},r=[];for(var n in e)r.push(n),t[n]=[];for(var i=0;i<r.length;i++)for(var a=e[r[i]],o=i+1;o<r.length;++o){var s=e[r[o]],l=Gd(a,s);l+s.radius<=a.radius+1e-10?t[r[o]].push(r[i]):l+a.radius<=s.radius+1e-10&&t[r[i]].push(r[o])}return t}function _oe(e,t){for(var r={},n=yoe(e),i=0;i<t.length;++i){for(var a=t[i].sets,o={},s={},l=0;l<a.length;++l){o[a[l]]=!0;for(var u=n[a[l]],c=0;c<u.length;++c)s[u[c]]=!0}var f=[],d=[];for(var v in e)v in o?f.push(e[v]):v in s||d.push(e[v]);var g=kot(f,d);r[a]=g,g.disjoint&&t[i].size>0&&console.log("WARNING: area "+a+" not represented on screen")}return r}function xoe(e,t,r){var n=[],i=e-r,a=t;return n.push("M",i,a),n.push("A",r,r,0,1,0,i+2*r,a),n.push("A",r,r,0,1,0,i,a),n.join(" ")}function boe(e){var t={};kk(e,t);var r=t.arcs;if(r.length===0)return"M 0 0";if(r.length==1){var n=r[0].circle;return xoe(n.x,n.y,n.radius)}else{for(var i=[`
M`,r[0].p2.x,r[0].p2.y],a=0;a<r.length;++a){var o=r[a],s=o.circle.radius,l=o.width>s;i.push(`
A`,s,s,0,l?1:0,1,o.p1.x,o.p1.y)}return i.join(" ")}}function Eoe(e,t){t=t||{},t.maxIterations=t.maxIterations||500;var r=t.initialLayout||Toe,n=t.lossFunction||zk;e=woe(e);var i=r(e,t),a=[],o=[],s;for(s in i)i.hasOwnProperty(s)&&(a.push(i[s].x),a.push(i[s].y),o.push(s));for(var l=Pot(function(f){for(var d={},v=0;v<o.length;++v){var g=o[v];d[g]={x:f[2*v],y:f[2*v+1],radius:i[g].radius}}return n(d,e)},a,t),u=l.x,c=0;c<o.length;++c)s=o[c],i[s].x=u[2*c],i[s].y=u[2*c+1];return i}var zot=1e-10;function fB(e,t,r){return Math.min(e,t)*Math.min(e,t)*Math.PI<=r+zot?Math.abs(e-t):doe(function(n){return Fot(e,t,n)-r},0,e+t)}function woe(e){e=e.slice();var t=[],r={},n,i,a,o;for(n=0;n<e.length;++n){var s=e[n];s.sets.length==1?t.push(s.sets[0]):s.sets.length==2&&(a=s.sets[0],o=s.sets[1],r[[a,o]]=!0,r[[o,a]]=!0)}for(t.sort(function(l,u){return l>u?1:-1}),n=0;n<t.length;++n)for(a=t[n],i=n+1;i<t.length;++i)o=t[i],[a,o]in r||e.push({sets:[a,o],size:0});return e}function Coe(e,t,r){var n=fX(t.length,t.length),i=fX(t.length,t.length);return e.filter(function(a){return a.sets.length==2}).map(function(a){var o=r[a.sets[0]],s=r[a.sets[1]],l=Math.sqrt(t[o].size/Math.PI),u=Math.sqrt(t[s].size/Math.PI),c=fB(l,u,a.size);n[o][s]=n[s][o]=c;var f=0;a.size+1e-10>=Math.min(t[o].size,t[s].size)?f=1:a.size<=1e-10&&(f=-1),i[o][s]=i[s][o]=f}),{distances:n,constraints:i}}function Soe(e,t,r,n){var i=0,a;for(a=0;a<t.length;++a)t[a]=0;for(a=0;a<r.length;++a)for(var o=e[2*a],s=e[2*a+1],l=a+1;l<r.length;++l){var u=e[2*l],c=e[2*l+1],f=r[a][l],d=n[a][l],v=(u-o)*(u-o)+(c-s)*(c-s),g=Math.sqrt(v),x=v-f*f;d>0&&g<=f||d<0&&g>=f||(i+=2*x*x,t[2*a]+=4*x*(o-u),t[2*a+1]+=4*x*(s-c),t[2*l]+=4*x*(u-o),t[2*l+1]+=4*x*(c-s))}return i}function Toe(e,t){var r=Moe(e,t),n=t.lossFunction||zk;if(e.length>=8){var i=Aoe(e,t),a=n(i,e),o=n(r,e);a+1e-8<o&&(r=i)}return r}function Aoe(e,t){t=t||{};var r=t.restarts||10,n=[],i={},a;for(a=0;a<e.length;++a){var o=e[a];o.sets.length==1&&(i[o.sets[0]]=n.length,n.push(o))}var s=Coe(e,n,i),l=s.distances,u=s.constraints,c=uB(l.map(uB))/l.length;l=l.map(function(M){return M.map(function(R){return R/c})});var f=function(M,R){return Soe(M,R,l,u)},d,v;for(a=0;a<r;++a){var g=lB(l.length*2).map(Math.random);v=voe(f,g,t),(!d||v.fx<d.fx)&&(d=v)}var x=d.x,w={};for(a=0;a<n.length;++a){var S=n[a];w[S.sets[0]]={x:x[2*a]*c,y:x[2*a+1]*c,radius:Math.sqrt(S.size/Math.PI)}}if(t.history)for(a=0;a<t.history.length;++a)cB(t.history[a].x,c);return w}function Moe(e,t){for(var r=t&&t.lossFunction?t.lossFunction:zk,n={},i={},a,o=0;o<e.length;++o){var s=e[o];s.sets.length==1&&(a=s.sets[0],n[a]={x:1e10,y:1e10,rowid:Object.keys(n).length,size:s.size,radius:Math.sqrt(s.size/Math.PI)},i[a]=[])}e=e.filter(function(vt){return vt.sets.length==2});for(var o=0;o<e.length;++o){var l=e[o],u=l.hasOwnProperty("weight")?l.weight:1,c=l.sets[0],f=l.sets[1];l.size+zot>=Math.min(n[c].size,n[f].size)&&(u=0),i[c].push({set:f,size:l.size,weight:u}),i[f].push({set:c,size:l.size,weight:u})}var d=[];for(a in i)if(i.hasOwnProperty(a)){for(var v=0,o=0;o<i[a].length;++o)v+=i[a][o].size*i[a][o].weight;d.push({set:a,size:v})}function g(vt,zt){return zt.size-vt.size}d.sort(g);var x={};function w(vt){return vt.set in x}function S(vt,zt){n[zt].x=vt.x,n[zt].y=vt.y,x[zt]=!0}S({x:0,y:0},d[0].set);for(var o=1;o<d.length;++o){var M=d[o].set,R=i[M].filter(w);if(a=n[M],R.sort(g),R.length===0)throw"ERROR: missing pairwise overlap information";for(var I=[],P=0;P<R.length;++P){var k=n[R[P].set],z=fB(a.radius,k.radius,R[P].size);I.push({x:k.x+z,y:k.y}),I.push({x:k.x-z,y:k.y}),I.push({y:k.y+z,x:k.x}),I.push({y:k.y-z,x:k.x});for(var G=P+1;G<R.length;++G)for(var J=n[R[G].set],Z=fB(a.radius,J.radius,R[G].size),X=Bot({x:k.x,y:k.y,radius:z},{x:J.x,y:J.y,radius:Z}),et=0;et<X.length;++et)I.push(X[et])}for(var at=1e50,wt=I[0],P=0;P<I.length;++P){n[M].x=I[P].x,n[M].y=I[P].y;var Tt=r(n,e);Tt<at&&(at=Tt,wt=I[P])}S(wt,M)}return n}function zk(e,t){var r=0;function n(c){return c.map(function(f){return e[f]})}for(var i=0;i<t.length;++i){var a=t[i],o=void 0;if(a.sets.length!=1){if(a.sets.length==2){var s=e[a.sets[0]],l=e[a.sets[1]];o=Fot(s.radius,l.radius,Gd(s,l))}else o=kk(n(a.sets));var u=a.hasOwnProperty("weight")?a.weight:1;r+=u*(o-a.size)*(o-a.size)}}return r}function Roe(e){var t=function(r){var n=Math.max.apply(null,e.map(function(a){return a[r]+a.radius})),i=Math.min.apply(null,e.map(function(a){return a[r]-a.radius}));return{max:n,min:i}};return{xRange:t("x"),yRange:t("y")}}function Ioe(e,t,r,n){var i=[],a=[];for(var o in e)e.hasOwnProperty(o)&&(a.push(o),i.push(e[o]));t-=2*n,r-=2*n;var s=Roe(i),l=s.xRange,u=s.yRange;if(l.max==l.min||u.max==u.min)return console.log("not scaling solution: zero size detected"),e;for(var c=t/(l.max-l.min),f=r/(u.max-u.min),d=Math.min(f,c),v=(t-(l.max-l.min)*d)/2,g=(r-(u.max-u.min)*d)/2,x={},w=0;w<i.length;++w){var S=i[w];x[a[w]]={radius:d*S.radius,x:n+v+(S.x-l.min)*d,y:n+g+(S.y-u.min)*d}}return x}var Loe=D_(function(e,t,r,n){var i=new Map,a=e.length;return t.forEach(function(o,s){if(o[n].length===1)i.set(o[gg],e[(s+a)%a]);else{var l=o[n].map(function(u){return i.get(u)});i.set(o[gg],l.slice(1).reduce(function(u,c){return foe(u,c,r)},l[0]))}}),i},function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return JSON.stringify(e)});function Ooe(e,t,r,n){n===void 0&&(n=0);var i=e.data,a=e.setsField,o=e.sizeField;if(i.length===0)return Sg(Zd.WARN,!1,"warn: %s","数据不能为空"),[];var s=i.map(function(f){var d;return $($({},f),(d={sets:f[a]||[],size:f[o]},d[sB]="",d[gg]="",d))});s.sort(function(f,d){return f.sets.length-d.sets.length});var l=Eoe(s),u=Ioe(l,t,r,n),c=_oe(u,s);return s.forEach(function(f){var d=f.sets,v=d.join(",");f[gg]=v;var g=d.map(function(S){return u[S]}),x=boe(g);/[zZ]$/.test(x)||(x+=" Z"),f[sB]=x;var w=c[v]||{x:0,y:0};Qi(f,w)}),s}function Poe(e,t){for(var r=0;r<t.length;r++)if(!e.includes(t[r]))return!1;return!0}var Doe=40;function Uot(e,t,r){var n=e.chart,i=e.options,a=i.blendMode,o=i.setsField,s=n.getTheme(),l=s.colors10,u=s.colors20,c=r;Fe(c)||(c=t.filter(function(d){return d[o].length===1}).length<=10?l:u);var f=Loe(c,t,a,o);return function(d){return f.get(d)||c[0]}}function Foe(e,t){var r=e.options,n=r.color;if(typeof n!="function"){var i=typeof n=="string"?[n]:n,a=Uot(e,t,i);return function(o){return a(o[gg])}}return n}function Boe(e){var t=e.chart,r=e.options,n=r.legend,i=r.appendPadding,a=r.padding,o=s0(i);return n!==!1&&(o=C3(i,xt(n,"position"),Doe)),t.appendPadding=gk([o,a]),e}function Noe(e){var t=e.options,r=t.data;r||(Sg(Zd.WARN,!1,"warn: %s","数据不能为空"),r=[]);var n=r.filter(function(a){return a.sets.length===1}).map(function(a){return a.sets[0]}),i=r.filter(function(a){var o=a.sets;return Poe(n,o)});return Di(i,r)||Sg(Zd.WARN,!1,"warn: %s","交集中不能出现不存在的集合, 请输入合法数据"),Tr({},e,{options:{data:i}})}function koe(e){var t=e.chart,r=e.options,n=r.pointStyle,i=r.setsField,a=r.sizeField,o=s0(t.appendPadding),s=o[0],l=o[1],u=o[2],c=o[3],f={offsetX:c,offsetY:s},d=t.viewBBox,v=d.width,g=d.height,x=Ooe(r,Math.max(v-(l+c),0),Math.max(g-(s+u),0),0);t.data(x);var w=bk(me({},e,{options:{xField:"x",yField:"y",sizeField:a,seriesField:gg,rawFields:[i,a],schema:{shape:"venn",style:n}}})).ext,S=w.geometry;S.customInfo(f);var M=Foe(e,x);return typeof M=="function"&&S.color(gg,function(R){var I=x.find(function(k){return k[gg]===R}),P=Uot(e,x)(R);return M(I,P)}),e}function zoe(e){var t=e.chart,r=e.options,n=r.label,i=s0(t.appendPadding),a=i[0],o=i[3],s={offsetX:o,offsetY:a},l=vu(t,"schema");if(!n)l.label(!1);else{var u=n.callback,c=fi(n,["callback"]);l.label({fields:["id"],callback:u,cfg:Tr({},Cl(c),{type:"venn",customLabelInfo:s})})}return e}function Uoe(e){var t=e.chart,r=e.options,n=r.legend,i=r.sizeField;return t.legend(gg,n),t.legend(i,!1),e}function $oe(e){var t=e.chart;return t.axis(!1),e}function Hoe(e){var t=e.options,r=e.chart,n=t.interactions;if(n){var i={"legend-active":"venn-legend-active","legend-highlight":"venn-legend-highlight"};xo(me({},e,{options:{interactions:n.map(function(a){return $($({},a),{type:i[a.type]||a.type})})}}))}return r.removeInteraction("legend-active"),r.removeInteraction("legend-highlight"),e}function Voe(e){return zn(Boe,ea,Noe,koe,zoe,ns({}),Uoe,$oe,al,Hoe,Ma)(e)}(function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="venn",r}return t.getDefaultOptions=function(){return qae},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return Voe},t.prototype.triggerResize=function(){this.chart.destroyed||(this.chart.forceFit(),this.chart.clear(),this.execAdaptor(),this.chart.render(!0))},t})(ti);var kf="x",Dy="violinY",Goe="violinSize",$ot="minMax",Hot="quantile",Vot="median",Uk="violin_view",Woe="min_max_view",Xoe="quantile_view",joe="median_view",Yoe=me({},ti.getDefaultOptions(),{syncViewPadding:!0,kde:{type:"triangular",sampleSize:32,width:3},violinStyle:{lineWidth:1,fillOpacity:.3,strokeOpacity:.75},xAxis:{grid:{line:null},tickLine:{alignTick:!1}},yAxis:{grid:{line:{style:{lineWidth:.5,lineDash:[4,4]}}}},legend:{position:"top-left"},tooltip:{showMarkers:!1}}),Got={exports:{}},Wot={exports:{}};(function(e){var t=e.exports;e.exports.isNumber=function(r){return typeof r=="number"},e.exports.findMin=function(r){if(r.length===0)return 1/0;for(var n=r[0],i=1;i<r.length;i++)n=Math.min(n,r[i]);return n},e.exports.findMax=function(r){if(r.length===0)return-1/0;for(var n=r[0],i=1;i<r.length;i++)n=Math.max(n,r[i]);return n},e.exports.findMinMulti=function(r){for(var n=t.findMin(r[0]),i=1;i<r.length;i++)n=Math.min(n,t.findMin(r[i]));return n},e.exports.findMaxMulti=function(r){for(var n=t.findMax(r[0]),i=1;i<r.length;i++)n=Math.max(n,t.findMax(r[i]));return n},e.exports.inside=function(r,n,i){return r<=i&&i<=n}})(Wot);var Zoe=Wot.exports;(function(e){var t=50,r=2,n=Math.log(2),i=e.exports,a=Zoe;function o(l){return 1-Math.abs(l)}e.exports.getUnifiedMinMax=function(l,u){return i.getUnifiedMinMaxMulti([l],u)},e.exports.getUnifiedMinMaxMulti=function(l,u){u=u||{};var c=!1,f=!1,d=a.isNumber(u.width)?u.width:r,v=a.isNumber(u.size)?u.size:t,g=a.isNumber(u.min)?u.min:(c=!0,a.findMinMulti(l)),x=a.isNumber(u.max)?u.max:(f=!0,a.findMaxMulti(l)),w=x-g,S=w/(v-1);return c&&(g=g-2*d*S),f&&(x=x+2*d*S),{min:g,max:x}},e.exports.create=function(l,u){if(u=u||{},!l||l.length===0)return[];var c=a.isNumber(u.size)?u.size:t,f=a.isNumber(u.width)?u.width:r,d=i.getUnifiedMinMax(l,{size:c,width:f,min:u.min,max:u.max}),v=d.min,g=d.max,x=g-v,w=x/(c-1);if(x===0)return[{x:v,y:1}];for(var S=[],M=0;M<c;M++)S.push({x:v+M*w,y:0});var R=function(X){return Math.floor((X-v)/w)},I=s(o,f),P=I[f],k=I[f-1]-I[f-2],z=0;l.forEach(function(X){var et=R(X);if(!(et+f<0||et-f>=S.length)){var at=Math.max(et-f,0),wt=et,Tt=Math.min(et+f,S.length-1),vt=at-(et-f),zt=et+f-Tt,oe=I[-f-1+vt]||0,Qt=I[-f-1+zt]||0,ne=P/(P-oe-Qt);vt>0&&(z+=ne*(vt-1)*k);var de=Math.max(0,et-f+1);a.inside(0,S.length-1,de)&&(S[de].y+=ne*1*k),a.inside(0,S.length-1,wt+1)&&(S[wt+1].y-=ne*2*k),a.inside(0,S.length-1,Tt+1)&&(S[Tt+1].y+=ne*1*k)}});var G=z,J=0,Z=0;return S.forEach(function(X){J+=X.y,G+=J,X.y=G,Z+=G}),Z>0&&S.forEach(function(X){X.y/=Z}),S};function s(l,u){for(var c={},f=0,d=-u;d<=u;d++)f+=l(d/u),c[d]=f;return c}e.exports.getExpectedValueFromPdf=function(l){if(!(!l||l.length===0)){var u=0;return l.forEach(function(c){u+=c.x*c.y}),u}},e.exports.getXWithLeftTailArea=function(l,u){if(!(!l||l.length===0)){for(var c=0,f=0,d=0;d<l.length&&(f=d,c+=l[d].y,!(c>=u));d++);return l[f].x}},e.exports.getPerplexity=function(l){if(!(!l||l.length===0)){var u=0;return l.forEach(function(c){var f=Math.log(c.y);isFinite(f)&&(u+=c.y*f)}),u=-u/n,Math.pow(2,u)}}})(Got);var qoe=Got.exports;const Koe=sa(qoe);function dX(e,t){var r=e.length*t;if(e.length===0)throw new Error("quantile requires at least one data point.");if(t<0||t>1)throw new Error("quantiles must be between 0 and 1");return t===1?e[e.length-1]:t===0?e[0]:r%1!==0?e[Math.ceil(r)-1]:e.length%2===0?(e[r-1]+e[r])/2:e[r]}function vw(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function bM(e,t,r,n){for(r=r||0,n=n||e.length-1;n>r;){if(n-r>600){var i=n-r+1,a=t-r+1,o=Math.log(i),s=.5*Math.exp(2*o/3),l=.5*Math.sqrt(o*s*(i-s)/i);a-i/2<0&&(l*=-1);var u=Math.max(r,Math.floor(t-a*s/i+l)),c=Math.min(n,Math.floor(t+(i-a)*s/i+l));bM(e,t,u,c)}var f=e[t],d=r,v=n;for(vw(e,r,t),e[n]>f&&vw(e,r,n);d<v;){for(vw(e,d,v),d++,v--;e[d]<f;)d++;for(;e[v]>f;)v--}e[r]===f?vw(e,r,v):(v++,vw(e,v,n)),v<=t&&(r=v+1),t<=v&&(n=v-1)}}function gw(e,t){var r=e.slice();if(Array.isArray(t)){Qoe(r,t);for(var n=[],i=0;i<t.length;i++)n[i]=dX(r,t[i]);return n}else{var a=jot(r.length,t);return Xot(r,a,0,r.length-1),dX(r,t)}}function Xot(e,t,r,n){t%1===0?bM(e,t,r,n):(t=Math.floor(t),bM(e,t,r,n),bM(e,t+1,t+1,n))}function Qoe(e,t){for(var r=[0],n=0;n<t.length;n++)r.push(jot(e.length,t[n]));r.push(e.length-1),r.sort(Joe);for(var i=[0,r.length-1];i.length;){var a=Math.ceil(i.pop()),o=Math.floor(i.pop());if(!(a-o<=1)){var s=Math.floor((o+a)/2);Xot(e,r[s],Math.floor(r[o]),Math.ceil(r[a])),i.push(o,s,s,a)}}}function Joe(e,t){return e-t}function jot(e,t){var r=e*t;return t===1?e-1:t===0?0:r%1!==0?Math.ceil(r)-1:e%2===0?r-.5:r}var pX=function(e){return{low:Wh(e),high:nh(e),q1:gw(e,.25),q3:gw(e,.75),median:gw(e,[.5]),minMax:[Wh(e),nh(e)],quantile:[gw(e,.25),gw(e,.75)]}},vX=function(e,t){var r=Koe.create(e,t);return{violinSize:r.map(function(n){return n.y}),violinY:r.map(function(n){return n.x})}},Yot=function(e){var t=e.xField,r=e.yField,n=e.seriesField,i=e.data,a=e.kde,o={min:a.min,max:a.max,size:a.sampleSize,width:a.width};if(!n){var s=Qc(i,t);return Object.keys(s).map(function(c){var f=s[c],d=f.map(function(v){return v[r]});return $($({x:c},vX(d,o)),pX(d))})}var l=[],u=Qc(i,n);return Object.keys(u).forEach(function(c){var f=Qc(u[c],t);return Object.keys(f).forEach(function(d){var v,g=f[d],x=g.map(function(w){return w[r]});l.push($($((v={x:d},v[n]=c,v),vX(x,o)),pX(x)))})}),l},EM=["low","high","q1","q3","median"],wM=[{type:"dodge",marginRatio:1/32}];function tse(e){var t=e.chart,r=e.options;return t.data(Yot(r)),e}function ese(e){var t=e.chart,r=e.options,n=r.seriesField,i=r.color,a=r.shape,o=a===void 0?"violin":a,s=r.violinStyle,l=r.tooltip,u=r.state,c=t.createView({id:Uk});return CQt({chart:c,options:{xField:kf,yField:Dy,seriesField:n||kf,sizeField:Goe,tooltip:$({fields:EM},l),violin:{style:s,color:i,shape:o},state:u}}),c.geometries[0].adjust(wM),e}function rse(e){var t=e.chart,r=e.options,n=r.seriesField,i=r.color,a=r.tooltip,o=r.box;if(o===!1)return e;var s=t.createView({id:Woe});gu({chart:s,options:{xField:kf,yField:$ot,seriesField:n||kf,tooltip:$({fields:EM},a),state:typeof o=="object"?o.state:{},interval:{color:i,size:1,style:{lineWidth:0}}}}),s.geometries[0].adjust(wM);var l=t.createView({id:Xoe});gu({chart:l,options:{xField:kf,yField:Hot,seriesField:n||kf,tooltip:$({fields:EM},a),state:typeof o=="object"?o.state:{},interval:{color:i,size:8,style:{fillOpacity:1}}}}),l.geometries[0].adjust(wM);var u=t.createView({id:joe});return tf({chart:u,options:{xField:kf,yField:Vot,seriesField:n||kf,tooltip:$({fields:EM},a),state:typeof o=="object"?o.state:{},point:{color:i,size:1,style:{fill:"white",lineWidth:0}}}}),u.geometries[0].adjust(wM),l.axis(!1),s.axis(!1),u.axis(!1),u.legend(!1),s.legend(!1),l.legend(!1),e}function nse(e){var t,r=e.chart,n=e.options,i=n.meta,a=n.xAxis,o=n.yAxis,s={},l=me(s,i,(t={},t[kf]=$($({sync:!0},Ea(a,Xc)),{type:"cat"}),t[Dy]=$({sync:!0},Ea(o,Xc)),t[$ot]=$({sync:Dy},Ea(o,Xc)),t[Hot]=$({sync:Dy},Ea(o,Xc)),t[Vot]=$({sync:Dy},Ea(o,Xc)),t));return r.scale(l),e}function ise(e){var t=e.chart,r=e.options,n=r.xAxis,i=r.yAxis,a=_i(t,Uk);return n===!1?a.axis(kf,!1):a.axis(kf,n),i===!1?a.axis(Dy,!1):a.axis(Dy,i),t.axis(!1),e}function ase(e){var t=e.chart,r=e.options,n=r.legend,i=r.seriesField,a=r.shape;if(n===!1)t.legend(!1);else{var o=i||kf,s=ZS(n,["selected"]);(!a||!a.startsWith("hollow"))&&(xt(s,["marker","style","lineWidth"])||Is(s,["marker","style","lineWidth"],0)),t.legend(o,s),xt(n,"selected")&&ft(t.views,function(l){return l.legend(o,n)})}return e}function ose(e){var t=e.chart,r=_i(t,Uk);return Ao()($($({},e),{chart:r})),e}function sse(e){var t=e.chart,r=e.options,n=r.animation;return ft(t.views,function(i){g2(i,n)}),e}function lse(e){return zn(ea,tse,ese,rse,nse,al,ise,ase,xo,ose,sse)(e)}(function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="violin",r}return t.getDefaultOptions=function(){return Yoe},t.prototype.changeData=function(r){this.updateOption({data:r}),this.chart.changeData(Yot(this.options))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.getSchemaAdaptor=function(){return lse},t})(ti);var Wf="$$yField$$",U3="$$diffField$$",$k="$$absoluteField$$",dB="$$isTotal$$",use={label:{},leaderLine:{style:{lineWidth:1,stroke:"#8c8c8c",lineDash:[4,2]}},total:{style:{fill:"rgba(0, 0, 0, 0.25)"}},interactions:[{type:"element-active"}],risingFill:"#f4664a",fallingFill:"#30bf78",waterfallStyle:{fill:"rgba(0, 0, 0, 0.25)"},yAxis:{grid:{line:{style:{lineDash:[4,2]}}}}};function cse(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];if(n){var i=r===0?"M":"L";t.push([i,n.x,n.y])}}var a=e[0];return t.push(["L",a.x,a.y]),t.push(["z"]),t}function hse(e){return me({},e.defaultStyle,e.style,{fill:e.color})}fa("interval","waterfall",{draw:function(e,t){var r=e.customInfo,n=e.points,i=e.nextPoints,a=t.addGroup(),o=this.parsePath(cse(n)),s=hse(e);a.addShape("path",{attrs:$($({},s),{path:o})});var l=xt(r,"leaderLine");if(l&&i){var u=[["M",n[2].x,n[2].y],["L",i[0].x,i[0].y]];n[2].y===i[1].y&&(u[1]=["L",i[1].x,i[1].y]),u=this.parsePath(u),a.addShape("path",{attrs:$({path:u},l.style||{})})}return a}});function fse(e,t,r,n,i){var a,o=[];if(du(e,function(l,u){var c;Sg(Zd.WARN,Rn(u[r]),"".concat(u[r]," is not a valid number"));var f=Gl(u[r])?null:u[r];return o.push($($({},u),(c={},c[n]=[l,l+f],c))),l+f},0),o.length&&i){var s=xt(o,[[e.length-1],n,[1]]);o.push((a={},a[t]=i.label,a[r]=s,a[n]=[0,s],a))}return o}function Zot(e,t,r,n){var i=fse(e,t,r,Wf,n);return i.map(function(a,o){var s;return Xi(a)?$($({},a),(s={},s[$k]=a[Wf][1],s[U3]=a[Wf][1]-a[Wf][0],s[dB]=o===e.length,s)):a})}function dse(e){var t=e.options,r=t.locale,n=t.total,i=A3(r).get(["waterfall","total"]);return n&&typeof n.label!="string"&&i&&(e.options.total.label=i),e}function pse(e){var t=e.chart,r=e.options,n=r.data,i=r.xField,a=r.yField,o=r.total,s=r.leaderLine,l=r.columnWidthRatio,u=r.waterfallStyle,c=r.risingFill,f=r.fallingFill,d=r.color,v=r.shape,g=r.customInfo;t.data(Zot(n,i,a,o));var x=d||function(R){return xt(R,[dB])?xt(o,["style","fill"],""):xt(R,[Wf,1])-xt(R,[Wf,0])>0?c:f},w=me({},e,{options:{xField:i,yField:Wf,seriesField:i,rawFields:[a,U3,dB,Wf],widthRatio:l,interval:{style:u,shape:v||"waterfall",color:x}}}),S=gu(w).ext,M=S.geometry;return M.customInfo($($({},g),{leaderLine:s})),e}function vse(e){var t,r,n=e.options,i=n.xAxis,a=n.yAxis,o=n.xField,s=n.yField,l=n.meta,u=me({},{alias:s},xt(l,s));return zn(ns((t={},t[o]=i,t[s]=a,t[Wf]=a,t),me({},l,(r={},r[Wf]=u,r[U3]=u,r[$k]=u,r))))(e)}function gse(e){var t=e.chart,r=e.options,n=r.xAxis,i=r.yAxis,a=r.xField,o=r.yField;return n===!1?t.axis(a,!1):t.axis(a,n),i===!1?(t.axis(o,!1),t.axis(Wf,!1)):(t.axis(o,i),t.axis(Wf,i)),e}function mse(e){var t=e.chart,r=e.options,n=r.legend,i=r.total,a=r.risingFill,o=r.fallingFill,s=r.locale,l=A3(s);if(n===!1)t.legend(!1);else{var u=[{name:l.get(["general","increase"]),value:"increase",marker:{symbol:"square",style:{r:5,fill:a}}},{name:l.get(["general","decrease"]),value:"decrease",marker:{symbol:"square",style:{r:5,fill:o}}}];i&&u.push({name:i.label||"",value:"total",marker:{symbol:"square",style:me({},{r:5},xt(i,"style"))}}),t.legend(me({},{custom:!0,position:"top",items:u},n)),t.removeInteraction("legend-filter")}return e}function yse(e){var t=e.chart,r=e.options,n=r.label,i=r.labelMode,a=r.xField,o=vu(t,"interval");if(!n)o.label(!1);else{var s=n.callback,l=fi(n,["callback"]);o.label({fields:i==="absolute"?[$k,a]:[U3,a],callback:s,cfg:Cl(l)})}return e}function _se(e){var t=e.chart,r=e.options,n=r.tooltip,i=r.xField,a=r.yField;if(n!==!1){t.tooltip($({showCrosshairs:!1,showMarkers:!1,shared:!0,fields:[a]},n));var o=t.geometries[0];n!=null&&n.formatter?o.tooltip("".concat(i,"*").concat(a),n.formatter):o.tooltip(a)}else t.tooltip(!1);return e}function xse(e){return zn(dse,ea,pse,vse,gse,mse,_se,yse,S0,xo,Ma,Ao())(e)}var bse=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="waterfall",r}return t.getDefaultOptions=function(){return use},t.prototype.changeData=function(r){var n=this.options,i=n.xField,a=n.yField,o=n.total;this.updateOption({data:r}),this.chart.changeData(Zot(r,i,a,o))},t.prototype.getSchemaAdaptor=function(){return xse},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t}(ti);const AOe=Object.freeze(Object.defineProperty({__proto__:null,Waterfall:bse},Symbol.toStringTag,{value:"Module"}));var Hk="color",Ese=me({},ti.getDefaultOptions(),{timeInterval:2e3,legend:!1,tooltip:{showTitle:!1,showMarkers:!1,showCrosshairs:!1,fields:["text","value",Hk],formatter:function(e){return{name:e.text,value:e.value}}},wordStyle:{fontFamily:"Verdana",fontWeight:"normal",padding:1,fontSize:[12,60],rotation:[0,90],rotationSteps:2,rotateRatio:.5}}),wse={font:function(){return"serif"},padding:1,size:[500,500],spiral:"archimedean",timeInterval:3e3};function Cse(e,t){return t=Qi({},wse,t),Sse(e,t)}function Sse(e,t){var r=kse();["font","fontSize","fontWeight","padding","rotate","size","spiral","timeInterval","random"].forEach(function(l){ze(t[l])||r[l](t[l])}),r.words(e),t.imageMask&&r.createMask(t.imageMask);var n=r.start(),i=n._tags;i.forEach(function(l){l.x+=t.size[0]/2,l.y+=t.size[1]/2});var a=t.size,o=a[0],s=a[1];return i.push({text:"",value:0,x:0,y:0,opacity:0}),i.push({text:"",value:0,x:o,y:s,opacity:0}),i}var NP=Math.PI/180,$w=64,CM=2048;function Tse(e){return e.text}function Ase(){return"serif"}function gX(){return"normal"}function Mse(e){return e.value}function Rse(){return~~(Math.random()*2)*90}function Ise(){return 1}function Lse(e,t,r,n){if(!t.sprite){var i=e.context,a=e.ratio;i.clearRect(0,0,($w<<5)/a,CM/a);var o=0,s=0,l=0,u=r.length;for(--n;++n<u;){t=r[n],i.save(),i.font=t.style+" "+t.weight+" "+~~((t.size+1)/a)+"px "+t.font;var c=i.measureText(t.text+"m").width*a,f=t.size<<1;if(t.rotate){var d=Math.sin(t.rotate*NP),v=Math.cos(t.rotate*NP),g=c*v,x=c*d,w=f*v,S=f*d;c=Math.max(Math.abs(g+S),Math.abs(g-S))+31>>5<<5,f=~~Math.max(Math.abs(x+w),Math.abs(x-w))}else c=c+31>>5<<5;if(f>l&&(l=f),o+c>=$w<<5&&(o=0,s+=l,l=0),s+f>=CM)break;i.translate((o+(c>>1))/a,(s+(f>>1))/a),t.rotate&&i.rotate(t.rotate*NP),i.fillText(t.text,0,0),t.padding&&(i.lineWidth=2*t.padding,i.strokeText(t.text,0,0)),i.restore(),t.width=c,t.height=f,t.xoff=o,t.yoff=s,t.x1=c>>1,t.y1=f>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,o+=c}for(var M=i.getImageData(0,0,($w<<5)/a,CM/a).data,R=[];--n>=0;)if(t=r[n],!!t.hasText){for(var c=t.width,I=c>>5,f=t.y1-t.y0,P=0;P<f*I;P++)R[P]=0;if(o=t.xoff,o==null)return;s=t.yoff;for(var k=0,z=-1,G=0;G<f;G++){for(var P=0;P<c;P++){var J=I*G+(P>>5),Z=M[(s+G)*($w<<5)+(o+P)<<2]?1<<31-P%32:0;R[J]|=Z,k|=Z}k?z=G:(t.y0++,f--,G--,s++)}t.y1=t.y0+z,t.sprite=R.slice(0,(t.y1-t.y0)*I)}}}function Ose(e,t,r){r>>=5;for(var n=e.sprite,i=e.width>>5,a=e.x-(i<<4),o=a&127,s=32-o,l=e.y1-e.y0,u=(e.y+e.y0)*r+(a>>5),c,f=0;f<l;f++){c=0;for(var d=0;d<=i;d++)if((c<<s|(d<i?(c=n[f*i+d])>>>o:0))&t[u+d])return!0;u+=r}return!1}function Pse(e,t){var r=e[0],n=e[1];t.x+t.x0<r.x&&(r.x=t.x+t.x0),t.y+t.y0<r.y&&(r.y=t.y+t.y0),t.x+t.x1>n.x&&(n.x=t.x+t.x1),t.y+t.y1>n.y&&(n.y=t.y+t.y1)}function Dse(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function qot(e){var t=e[0]/e[1];return function(r){return[t*(r*=.1)*Math.cos(r),r*Math.sin(r)]}}function Fse(e){var t=4,r=t*e[0]/e[1],n=0,i=0;return function(a){var o=a<0?-1:1;switch(Math.sqrt(1+4*o*a)-o&3){case 0:n+=r;break;case 1:i+=t;break;case 2:n-=r;break;default:i-=t;break}return[n,i]}}function mX(e){for(var t=[],r=-1;++r<e;)t[r]=0;return t}function Bse(){return document.createElement("canvas")}function Bp(e){return Rr(e)?e:function(){return e}}var Nse={archimedean:qot,rectangular:Fse};function kse(){var e=[256,256],t=Ase,r=Mse,n=gX,i=Rse,a=Ise,o=qot,s=Math.random,l=[],u=1/0,c=Tse,f=gX,d=Bse,v={};v.start=function(){var w=e[0],S=e[1],M=g(d()),R=v.board?v.board:mX((e[0]>>5)*e[1]),I=l.length,P=[],k=l.map(function(Z,X,et){return Z.text=c.call(this,Z,X,et),Z.font=t.call(this,Z,X,et),Z.style=f.call(this,Z,X,et),Z.weight=n.call(this,Z,X,et),Z.rotate=i.call(this,Z,X,et),Z.size=~~r.call(this,Z,X,et),Z.padding=a.call(this,Z,X,et),Z}).sort(function(Z,X){return X.size-Z.size}),z=-1,G=v.board?[{x:0,y:0},{x:w,y:S}]:null;J();function J(){for(var Z=Date.now();Date.now()-Z<u&&++z<I;){var X=k[z];X.x=w*(s()+.5)>>1,X.y=S*(s()+.5)>>1,Lse(M,X,k,z),X.hasText&&x(R,X,G)&&(P.push(X),G?v.hasImage||Pse(G,X):G=[{x:X.x+X.x0,y:X.y+X.y0},{x:X.x+X.x1,y:X.y+X.y1}],X.x-=e[0]>>1,X.y-=e[1]>>1)}v._tags=P,v._bounds=G}return v};function g(w){w.width=w.height=1;var S=Math.sqrt(w.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,1,1).data.length>>2);w.width=($w<<5)/S,w.height=CM/S;var M=w.getContext("2d",{willReadFrequently:!0});return M.fillStyle=M.strokeStyle="red",M.textAlign="center",{context:M,ratio:S}}function x(w,S,M){for(var R=S.x,I=S.y,P=Math.sqrt(e[0]*e[0]+e[1]*e[1]),k=o(e),z=s()<.5?1:-1,G,J=-z,Z,X;(G=k(J+=z))&&(Z=~~G[0],X=~~G[1],!(Math.min(Math.abs(Z),Math.abs(X))>=P));)if(S.x=R+Z,S.y=I+X,!(S.x+S.x0<0||S.y+S.y0<0||S.x+S.x1>e[0]||S.y+S.y1>e[1])&&(!M||!Ose(S,w,e[0]))&&(!M||Dse(S,M))){for(var et=S.sprite,at=S.width>>5,wt=e[0]>>5,Tt=S.x-(at<<4),vt=Tt&127,zt=32-vt,oe=S.y1-S.y0,Qt=void 0,ne=(S.y+S.y0)*wt+(Tt>>5),de=0;de<oe;de++){Qt=0;for(var De=0;De<=at;De++)w[ne+De]|=Qt<<zt|(De<at?(Qt=et[de*at+De])>>>vt:0);ne+=wt}return delete S.sprite,!0}return!1}return v.createMask=function(w){var S=document.createElement("canvas"),M=e[0],R=e[1];if(!(!M||!R)){var I=M>>5,P=mX((M>>5)*R);S.width=M,S.height=R;var k=S.getContext("2d");k.drawImage(w,0,0,w.width,w.height,0,0,M,R);for(var z=k.getImageData(0,0,M,R).data,G=0;G<R;G++)for(var J=0;J<M;J++){var Z=I*G+(J>>5),X=G*M+J<<2,et=z[X]>=250&&z[X+1]>=250&&z[X+2]>=250,at=et?1<<31-J%32:0;P[Z]|=at}v.board=P,v.hasImage=!0}},v.timeInterval=function(w){u=w??1/0},v.words=function(w){l=w},v.size=function(w){e=[+w[0],+w[1]]},v.font=function(w){t=Bp(w)},v.fontWeight=function(w){n=Bp(w)},v.rotate=function(w){i=Bp(w)},v.spiral=function(w){o=Nse[w]||w},v.fontSize=function(w){r=Bp(w)},v.padding=function(w){a=Bp(w)},v.random=function(w){s=Bp(w)},v}function Kot(e){var t=e.options,r=e.chart,n=r,i=n.width,a=n.height,o=n.padding,s=n.appendPadding,l=n.ele,u=t.data,c=t.imageMask,f=t.wordField,d=t.weightField,v=t.colorField,g=t.wordStyle,x=t.timeInterval,w=t.random,S=t.spiral,M=t.autoFit,R=M===void 0?!0:M,I=t.placementStrategy;if(!u||!u.length)return[];var P=g.fontFamily,k=g.fontWeight,z=g.padding,G=g.fontSize,J=Vse(u,d),Z=[Xse(J),jse(J)],X=u.map(function(wt){return{text:wt[f],value:wt[d],color:wt[v],datum:wt}}),et={imageMask:c,font:P,fontSize:Hse(G,Z),fontWeight:k,size:zse({width:i,height:a,padding:o,appendPadding:s,autoFit:R,container:l}),padding:z,timeInterval:x,random:w,spiral:S,rotate:Gse(t)};if(Rr(I)){var at=X.map(function(wt,Tt,vt){return $($($({},wt),{hasText:!!wt.text,font:Bp(et.font)(wt,Tt,vt),weight:Bp(et.fontWeight)(wt,Tt,vt),rotate:Bp(et.rotate)(wt,Tt,vt),size:Bp(et.fontSize)(wt,Tt,vt),style:"normal"}),I.call(r,wt,Tt,vt))});return at.push({text:"",value:0,x:0,y:0,opacity:0}),at.push({text:"",value:0,x:et.size[0],y:et.size[1],opacity:0}),at}return Cse(X,et)}function zse(e){var t=e.width,r=e.height,n=e.container,i=e.autoFit,a=e.padding,o=e.appendPadding;if(i){var s=JF(n);t=s.width,r=s.height}t=t||400,r=r||400;var l=Use({padding:a,appendPadding:o}),u=l[0],c=l[1],f=l[2],d=l[3],v=[t-(d+c),r-(u+f)];return v}function Use(e){var t=s0(e.padding),r=s0(e.appendPadding),n=t[0]+r[0],i=t[1]+r[1],a=t[2]+r[2],o=t[3]+r[3];return[n,i,a,o]}function $se(e){return new Promise(function(t,r){if(e instanceof HTMLImageElement){t(e);return}if(en(e)){var n=new Image;n.crossOrigin="anonymous",n.src=e,n.onload=function(){t(n)},n.onerror=function(){Sg(Zd.ERROR,!1,"image %s load failed !!!",e),r()};return}Sg(Zd.WARN,e===void 0,"The type of imageMask option must be String or HTMLImageElement."),r()})}function Hse(e,t){if(Rr(e))return e;if(Fe(e)){var r=e[0],n=e[1];if(!t)return function(){return(n+r)/2};var i=t[0],a=t[1];return a===i?function(){return(n+r)/2}:function(s){var l=s.value;return(n-r)/(a-i)*(l-i)+r}}return function(){return e}}function Vse(e,t){return e.map(function(r){return r[t]}).filter(function(r){return typeof r=="number"&&!isNaN(r)})}function Gse(e){var t=Wse(e),r=t.rotation,n=t.rotationSteps;if(!Fe(r))return r;var i=r[0],a=r[1],o=n===1?0:(a-i)/(n-1);return function(){return a===i?a:Math.floor(Math.random()*n)*o}}function Wse(e){var t=e.wordStyle.rotationSteps;return t<1&&(Sg(Zd.WARN,!1,"The rotationSteps option must be greater than or equal to 1."),t=1),{rotation:e.wordStyle.rotation,rotationSteps:t}}function Xse(e){return Math.min.apply(Math,e)}function jse(e){return Math.max.apply(Math,e)}function Yse(e){var t=e.chart,r=e.options,n=r.colorField,i=r.color,a=Kot(e);t.data(a);var o=me({},e,{options:{xField:"x",yField:"y",seriesField:n&&Hk,rawFields:Rr(i)&&on(on([],xt(r,"rawFields",[]),!0),["datum"],!1),point:{color:i,shape:"word-cloud"}}}),s=tf(o).ext;return s.geometry.label(!1),t.coordinate().reflect("y"),t.axis(!1),e}function Zse(e){return zn(ns({x:{nice:!1},y:{nice:!1}}))(e)}function qse(e){var t=e.chart,r=e.options,n=r.legend,i=r.colorField;return n===!1?t.legend(!1):i&&t.legend(Hk,n),e}function Kse(e){zn(Yse,Zse,al,qse,xo,Ma,ea,S0)(e)}fa("point","word-cloud",{draw:function(e,t){var r=e.x,n=e.y,i=t.addShape("text",{attrs:$($({},Qse(e)),{x:r,y:n})}),a=e.data.rotate;return typeof a=="number"&&ih.rotate(i,a*Math.PI/180),i}});function Qse(e){return{fontSize:e.data.size,text:e.data.text,textAlign:"center",fontFamily:e.data.font,fontWeight:e.data.weight,fill:e.color||e.defaultStyle.stroke,textBaseline:"alphabetic"}}var Jse=function(e){$t(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type="word-cloud",r}return t.getDefaultOptions=function(){return Ese},t.prototype.changeData=function(r){this.updateOption({data:r}),this.options.imageMask?this.render():this.chart.changeData(Kot({chart:this.chart,options:this.options}))},t.prototype.getDefaultOptions=function(){return t.getDefaultOptions()},t.prototype.render=function(){var r=this;return new Promise(function(n){var i=r.options.imageMask;if(!i){e.prototype.render.call(r),n();return}var a=function(o){r.options=$($({},r.options),{imageMask:o||null}),e.prototype.render.call(r),n()};$se(i).then(a).catch(a)})},t.prototype.getSchemaAdaptor=function(){return Kse},t.prototype.triggerResize=function(){var r=this;this.chart.destroyed||(this.execAdaptor(),window.setTimeout(function(){e.prototype.triggerResize.call(r)}))},t}(ti);const MOe=Object.freeze(Object.defineProperty({__proto__:null,WordCloud:Jse},Symbol.toStringTag,{value:"Module"}));(function(e){$t(t,e);function t(r,n,i,a){var o=e.call(this,r,me({},a,n))||this;return o.type="g2-plot",o.defaultOptions=a,o.adaptor=i,o}return t.prototype.getDefaultOptions=function(){return this.defaultOptions},t.prototype.getSchemaAdaptor=function(){return this.adaptor},t})(ti);Wit("en-US",bQt);Wit("zh-CN",EQt);class Vk extends F_{constructor(t=[],r={}){super(),this.name=r.name?r.name:lh("layerGroup"),this.layers=t}addTo(t){this.scene=t;let r=0;const n=this.layers.length;this.layers.forEach(i=>{i.once("inited",a=>{r++,this.emit("inited",a),r===n&&this.emit("inited-all")}),i.addTo(t)})}hasLayer(t){return this.layers.some(r=>r===t)}addLayer(t){this.layers.push(t),this.scene&&(t.once("inited",r=>this.emit("inited",r)),t.addTo(this.scene))}removeLayer(t){const r=this.layers.findIndex(n=>n===t);return r===-1?!1:(this.layers.splice(r,1),this.scene&&t.remove(this.scene),!0)}getLayers(){return this.layers}getInteractionLayers(){return this.layers.filter(({interaction:t})=>t)}getLayer(t){return this.layers.find(({layer:r})=>r.id===t)}getLayerByName(t){return this.layers.find(r=>r.name===t)}removeAllLayer(){this.layers.forEach(t=>{this.scene&&t.remove(this.scene)}),this.layers=[]}isEmpty(){return this.layers.length===0}}const Gk={fontFamily:`
  "-apple-system", BlinkMacSystemFont, "Segoe UI", Roboto,"Helvetica Neue",
  Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei",
  SimSun, "sans-serif"`},Wk="l7plot-tooltip",Xk="l7plot-tooltip__title",jk="l7plot-tooltip__list",Qot="l7plot-tooltip__list-item",Jot="l7plot-tooltip__name",tst="l7plot-tooltip__value",tle=`<div class="${Wk}">
  <div class="${Xk}"></div>
  <ul class="${jk}"></ul>
</div>`,yX=`<li class="${Qot}" data-index={index}>
  <span class="${Jot}">{name}</span>
  <span class="${tst}">{value}</span>
</li>`,ele={[Wk]:{visibility:"visible",zIndex:999,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)",backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontSize:"12px",fontFamily:Gk.fontFamily,lineHeight:"20px",padding:"10px 10px 6px 10px"},[Xk]:{marginBottom:"4px"},[jk]:{margin:"0px",listStyleType:"none",padding:"0px"},[Qot]:{listStyleType:"none",marginBottom:"4px",whiteSpace:"nowrap",display:"flex",justifyContent:"space-between"},[Jot]:{},[tst]:{marginLeft:"30px"}};function rle(e,t){return!!e.className.match(new RegExp(`(\\s|^)${t}(\\s|$)`))}function Yk(e){const t=e.childNodes,r=t.length;for(let n=r-1;n>=0;n--)e.removeChild(t[n])}class Zk{constructor(t){this.destroyed=!1,this.options=Tr({},this.getDefaultOptions(),t),this.container=this.initContainer(),this.initDom(),this.applyStyles(),this.initEvent(),this.initCapture(),this.initVisible(),this.render()}getDefaultOptions(){return{name:"",containerTpl:"<div></div>",visible:!0,capture:!0,domStyles:{}}}getContainer(){return this.container}getParentContainer(){const t=this.options.parent;let r;if(!t)return r;if(en(t)){const n=document.getElementById(t);if(n)r=n;else throw new Error(`No parent id ${t}`)}else r=t;return r}initContainer(){const t=this.createDom(this.options.containerTpl),r=this.getParentContainer();return r&&r.appendChild(t),t}initVisible(){this.options.visible?this.show():this.hide()}initCapture(){this.setCapture(this.options.capture)}update(t){this.options=Tr({},this.options,t),this.updateInner(t),this.afterUpdate(t)}updateInner(t){t.domStyles&&this.applyStyles()}afterUpdate(t){t.capture&&this.setCapture(t.capture)}setCapture(t){const r=this.container,n=t?"auto":"none";r.style.pointerEvents=n}applyStyles(){const t=this.options.domStyles;if(!t)return;const r=this.container;this.applyChildrenStyles(r,t);const n=this.options.className;if(n&&rle(r,n)){const i=t[n];za(r,i)}}applyChildrenStyles(t,r){ft(r,(n,i)=>{const a=t.getElementsByClassName(i);ft(a,o=>{za(o,n)})})}applyStyle(t,r){const n=this.options.domStyles;n&&za(r,n[t])}createDom(t="<div></div>"){return hg(t)}removeDom(){const t=this.container;t&&t.parentNode&&t.parentNode.removeChild(t)}destroy(){this.removeEvent(),this.removeDom(),this.destroyed=!0}}let nle=class extends Zk{getDefaultOptions(){return Tr({},super.getDefaultOptions(),{id:"l7plot-tooltip",name:"l7plot-tooltip",title:"",showTitle:!0,items:[],containerTpl:tle,itemTpl:yX,domStyles:ele,className:Wk})}initContainer(){const{customContent:t}=this.options;if(t){const r=this.getHtmlContentNode(t),n=this.getParentContainer();return n&&n.appendChild(r),r}else return super.initContainer()}initDom(){this.cacheDoms()}initEvent(){}removeEvent(){}cacheDoms(){const t=this.container,r=t.getElementsByClassName(Xk)[0],n=t.getElementsByClassName(jk)[0];this.titleDom=r,this.listDom=n}render(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderItems())}show(){const t=this.container;!t||this.destroyed||za(t,{visibility:"visible"})}hide(){const t=this.container;!t||this.destroyed||za(t,{visibility:"hidden"})}updateInner(t){this.options.customContent?this.renderCustomContent(this.options.customContent):(t.title&&this.resetTitle(),t.items&&this.renderItems()),super.updateInner(t)}renderCustomContent(t){const r=this.container.parentNode,n=this.getHtmlContentNode(t),i=this.container;r&&r.replaceChild(n,i),this.container=n,this.applyStyles()}getHtmlContentNode(t){let r;const n=t(this.options.title||"",this.options.items);return en(n)?r=this.createDom(n):r=n,r}resetTitle(){const t=this.options.title;this.options.showTitle&&t?(this.showTitle(),this.setTitle(t)):this.hideTitle()}showTitle(){const t=this.titleDom;t&&za(t,{display:"block"})}hideTitle(){const t=this.titleDom;t&&za(t,{display:"none"})}setTitle(t){const r=this.titleDom;r&&(r.innerHTML=t)}renderItems(){this.clearItemDoms();const t=this.options.items,r=this.options.itemTpl||yX,n=this.listDom;n&&(t.forEach(i=>{const a=Object.assign({},i),o=Tb(r,a),s=this.createDom(o);n.appendChild(s)}),this.applyChildrenStyles(n,this.options.domStyles))}clearItemDoms(){this.listDom&&Yk(this.listDom)}clear(){this.setTitle(""),this.clearItemDoms()}};const ile={[P5]:{visibility:"visible",zIndex:1,backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontFamily:Gk.fontFamily,padding:"10px 10px 6px 10px",lineHeight:1,fontSize:"12px"},[D5]:{fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},[F5]:{margin:"0px",listStyleType:"none",padding:"0px"},[hq]:{listStyleType:"none",display:"flex",alignItems:"center",marginBottom:"2px"},[fq]:{width:"10px",height:"10px"},[dq]:{paddingLeft:"8px"}};class ale extends Zk{getDefaultOptions(){return Tr({},super.getDefaultOptions(),{id:"l7plot-category-legend",name:"l7plot-category-legend",title:"",items:[],containerTpl:rdt,itemTpl:O7,domStyles:ile,className:P5})}initContainer(){const{customContent:t}=this.options;if(t){const r=this.getHtmlContentNode(t),n=this.getParentContainer();return n&&n.appendChild(r),r}else return super.initContainer()}initDom(){this.cacheDoms()}initEvent(){}removeEvent(){}cacheDoms(){const t=this.container,r=t.getElementsByClassName(D5)[0],n=t.getElementsByClassName(F5)[0];this.titleDom=r,this.listDom=n}render(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderItems())}show(){const t=this.container;!t||this.destroyed||za(t,{visibility:"visible"})}hide(){const t=this.container;!t||this.destroyed||za(t,{visibility:"hidden"})}updateInner(t){this.options.customContent?this.renderCustomContent(this.options.customContent):(t.title&&this.resetTitle(),t.items&&this.renderItems()),super.updateInner(t)}renderCustomContent(t){const r=this.container.parentNode,n=this.getHtmlContentNode(t),i=this.container;r&&r.replaceChild(n,i),this.container=n,this.applyStyles()}getHtmlContentNode(t){let r;const n=t(this.options.title||"",this.options.items);return en(n)?r=this.createDom(n):r=n,r}resetTitle(){const t=this.options.title;t?(this.showTitle(),this.setTitle(t)):this.hideTitle()}showTitle(){const t=this.titleDom;t&&za(t,{display:"block"})}hideTitle(){const t=this.titleDom;t&&za(t,{display:"none"})}setTitle(t){const r=this.titleDom;r&&(r.innerHTML=t)}renderItems(){this.clearItemDoms();const t=this.options.items.length>30?this.options.items.slice(0,30):this.options.items,r=this.options.itemTpl||O7,n=this.listDom;n&&(t.forEach(i=>{const o=i.value===""?"—":Array.isArray(i.value)?i.value.join(" - "):i.value,s=Object.assign(Object.assign({},i),{value:o}),l=Tb(r,s),u=this.createDom(l);n.appendChild(u)}),this.applyChildrenStyles(n,this.options.domStyles))}clearItemDoms(){this.listDom&&Yk(this.listDom)}clear(){this.setTitle(""),this.clearItemDoms()}}const qk="l7plot-legend l7plot-legend__continue",Kk="l7plot-legend__title",est="l7plot-legend__ribbon-container",rst="l7plot-legend__ribbon",nst="l7plot-legend__gradient-bar",pB="l7plot-legend__value-range",ole=`<div class="${qk}">
  <div class="${Kk}"></div>
  <div class="${est}"></div>
</div>`,_X=`<div class="${rst}">
  <span class="${pB}">{min}</span>
  <div class="${nst}" style="background-image: {backgroundImage}"></div>
  <span class="${pB}">{max}</span>
</div>`,sle={[qk]:{visibility:"visible",zIndex:1,backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",borderRadius:"2px",color:"rgb(87, 87, 87)",fontFamily:Gk.fontFamily,padding:"10px",lineHeight:1,fontSize:"12px"},[Kk]:{fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},[rst]:{display:"flex",alignItems:"center"},[nst]:{width:"140px",height:"14px",margin:"0px 5px"},[pB]:{padding:"0px"}};class lle extends Zk{getDefaultOptions(){return Tr({},super.getDefaultOptions(),{id:"l7plot-continue-legend",name:"l7plot-continue-legend",title:"",containerTpl:ole,ribbonTpl:_X,domStyles:sle,className:qk})}initContainer(){const{customContent:t}=this.options;if(t){const r=this.getHtmlContentNode(t),n=this.getParentContainer();return n&&n.appendChild(r),r}else return super.initContainer()}initDom(){this.cacheDoms()}initEvent(){}removeEvent(){}cacheDoms(){const t=this.container,r=t.getElementsByClassName(Kk)[0],n=t.getElementsByClassName(est)[0];this.titleDom=r,this.ribbonContainerDom=n}render(){this.options.customContent?this.renderCustomContent(this.options.customContent):(this.resetTitle(),this.renderRibbon())}show(){const t=this.container;!t||this.destroyed||za(t,{visibility:"visible"})}hide(){const t=this.container;!t||this.destroyed||za(t,{visibility:"hidden"})}updateInner(t){this.options.customContent?this.renderCustomContent(this.options.customContent):(t.title&&this.resetTitle(),t.colors&&this.renderRibbon()),super.updateInner(t)}renderCustomContent(t){const r=this.container.parentNode,n=this.getHtmlContentNode(t),i=this.container;r&&r.replaceChild(n,i),this.container=n,this.applyStyles()}getHtmlContentNode(t){let r;const n=t(this.options.title||"",this.options.min,this.options.max,this.options.colors);return en(n)?r=this.createDom(n):r=n,r}resetTitle(){const t=this.options.title;t?(this.showTitle(),this.setTitle(t)):this.hideTitle()}showTitle(){const t=this.titleDom;t&&za(t,{display:"block"})}hideTitle(){const t=this.titleDom;t&&za(t,{display:"none"})}setTitle(t){const r=this.titleDom;r&&(r.innerHTML=t)}renderRibbon(){this.clearRibbonContainerDoms();const{min:t,max:r,colors:n,ribbonTpl:i=_X}=this.options,a=this.ribbonContainerDom;if(a){const o=`linear-gradient(to right, ${n.join(", ")})`,l=Tb(i,{min:t,max:r,backgroundImage:o}),u=this.createDom(l);a.appendChild(u),this.applyChildrenStyles(a,this.options.domStyles)}}clearRibbonContainerDoms(){this.ribbonContainerDom&&Yk(this.ribbonContainerDom)}clear(){this.setTitle(""),this.clearRibbonContainerDoms()}}class ule extends yg{constructor(t){super(t),this.legendComponents=[],this.options=t,this.legendComponents=this.initLegendComponents(t.items)}initLegendComponents(t){const r=[];for(let n=0;n<t.length;n++){const i=t[n];if(i.type==="category"){const a=new ale({title:i.options.title,items:i.options.items,className:i.options.className,customContent:i.options.customContent,domStyles:i.options.domStyles});r.push(a)}else if(i.type==="continue"){const a=new lle({title:i.options.title,min:i.options.min,max:i.options.max,colors:i.options.colors,className:i.options.className,customContent:i.options.customContent,domStyles:i.options.domStyles});r.push(a)}}return r}getDefaultOptions(){return{position:"bottomleft"}}onAdd(){const t=window.document.createElement("div");return t.className="l7plot-legend-container",this.legendComponents.forEach(r=>{const n=r.getContainer();t.appendChild(n)}),t}onRemove(){this.legendComponents.forEach(t=>{t.destroy()})}}var xX;(function(e){e[e.solid=0]="solid",e[e.dash=1]="dash"})(xX||(xX={}));var vB;(function(e){e.TextLayer="textLayer",e.DotLayer="dotLayer",e.IconLayer="iconLayer",e.DotDensity="dotDensityLayer",e.ColumnLayer="columnLayer",e.HeatmapLayer="heatmapLayer",e.GridLayer="gridLayer",e.HexbinLayer="hexbinLayer",e.LinesLayer="linesLayer",e.PathLayer="pathLayer",e.ArcLayer="arcLayer",e.AreaLayer="areaLayer",e.PrismLayer="prismLayer"})(vB||(vB={}));var Id;(function(e){e.Map="map",e.Amap="amap",e.AmapV1="amapv1",e.AmapV2="amapv2",e.Mapbox="mapbox"})(Id||(Id={}));var gB;(function(e){e.Dot="dot",e.DotDensity="dotDensity",e.Heatmap="heatmap",e.Grid="grid",e.Hexbin="hexbin",e.Path="path",e.Flow="flow",e.Area="area",e.Choropleth="choropleth"})(gB||(gB={}));const cle=5,hle=new Object().toString,ist=(e,t)=>hle.call(e)==="[object "+t+"]",fle=e=>ist(e,"Array"),dle=e=>typeof e=="object"&&e!==null,bX=e=>{if(!dle(e)||!ist(e,"Object"))return!1;let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t},ast=(e,t,r,n)=>{r=r||0,n=n||cle;for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){const a=t[i];a?bX(a)?(bX(e[i])||(e[i]={}),r<n?ast(e[i],a,r+1,n):e[i]=t[i]):fle(a)?(e[i]=[],e[i]=e[i].concat(a)):e[i]=a:e[i]=a}},Os=(e,...t)=>{for(let r=0;r<t.length;r+=1)ast(e,t[r]);return e},ple=["mousemove","click"];class vle extends F_{constructor(t,r,n){super(),this.currentVisible=!1,this.interactionTriggerHander=f=>{const{feature:d,featureId:v}=f,{title:g,customTitle:x,items:w,customItems:S}=this.options,R=d.type==="Feature"&&d.geometry&&d.properties?d.properties:d;let I=[];if(S){const k=S(d);if(Array.isArray(k))I=k;else throw new Error("customItems return array")}else w&&w.forEach(k=>{if(en(k)){const z=k.split(".").pop()||k,G=I7(R,k);G!==void 0&&I.push({name:z,value:G})}else{const{field:z,alias:G,customValue:J}=k,Z=G||z.split(".").pop()||z,X=I7(R,z);X!==void 0&&I.push({name:Z,value:J?J(X,R,v):X})}});const P={title:x?x(R):g,items:I};this.updateTooltip(f,P)},this.interactionUntriggerHander=()=>{this.hideTooltip()},this.scene=t,this.interactionLayers=r,this.options=Os({},this.getDefaultOptions(),n);const{offsets:i,title:a,showTitle:o,customContent:s,domStyles:l,anchor:u,className:c}=this.options;this.marker=new z9({offsets:i,anchor:u,draggable:!1}),this.tooltipComponent=new nle({title:a,showTitle:o,items:[],customContent:s,domStyles:l,className:c}),this.setComponent(),this.initInteractionEvent()}getDefaultOptions(){return{showTitle:!0,showComponent:!0,items:[],offsets:[15,0],trigger:"mousemove",anchor:MI["TOP-LEFT"]}}update(t){this.marker.remove(),this.currentVisible=!1,this.options=Os({},this.options,t);const{offsets:r,showTitle:n,customContent:i,domStyles:a,anchor:o,className:s}=this.options;this.marker=new z9({offsets:r,anchor:o,draggable:!1}),this.tooltipComponent.update({showTitle:n,customContent:i,domStyles:a,className:s}),this.setComponent()}initInteractionEvent(){const t=this.options.trigger||"mousemove";if(!ple.includes(t))throw new Error("trigger is mousemove or click");this.interactionLayers.forEach(({layer:r})=>{r.on(t,this.interactionTriggerHander),r.on(`un${t}`,this.interactionUntriggerHander)})}unBindInteractionEvent(){const t=this.options.trigger||"mousemove";this.interactionLayers.forEach(({layer:r})=>{r.off(t,this.interactionTriggerHander),r.off(`un${t}`,this.interactionUntriggerHander)})}updateTooltip(t,r){const{lngLat:n,x:i,y:a}=t;if(this.options.showComponent&&(this.updateComponent(r),this.setPostion(n)),this.currentVisible){const o={type:"tooltip:change",data:r,lngLat:n,x:i,y:a};this.emit("tooltip:change",o)}else{this.showTooltip();const o={type:"tooltip:show",data:r,lngLat:n,x:i,y:a};this.emit("tooltip:show",o)}}showTooltip(){this.currentVisible||(this.options.showComponent&&this.scene.addMarker(this.marker),this.currentVisible=!0)}hideTooltip(){if(!this.currentVisible)return;this.options.showComponent&&this.marker.remove(),this.currentVisible=!1;const t={type:"tooltip:hide"};this.emit("tooltip:hide",t)}updateComponent(t){Di(this.lastComponentOptions,t)||(this.tooltipComponent.update(t),this.lastComponentOptions=t)}setComponent(){const t=this.tooltipComponent.getContainer(),r=window.document.createElement("div");r.style.cursor="auto",r.style.userSelect="text",r.className="l7plot-tooltip-container",["mousemove","mousedown","mouseup","click","dblclick"].forEach(n=>{r.addEventListener(n,i=>i.stopPropagation())}),r.appendChild(t),this.marker.setElement(r)}setPostion(t){this.marker.setLnglat(t)}destroy(){this.unBindInteractionEvent(),this.off(),this.marker.remove(),this.tooltipComponent.destroy()}}var wy={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ITEM_TPL=e.CONTAINER_TPL=e.VALUE_CLASS=e.NAME_CLASS=e.LIST_ITEM_CLASS=e.LIST_CLASS=e.TITLE_CLASS=e.CONTAINER_CLASS=void 0,e.CONTAINER_CLASS="l7plot-tooltip",e.TITLE_CLASS="l7plot-tooltip__title",e.LIST_CLASS="l7plot-tooltip__list",e.LIST_ITEM_CLASS="l7plot-tooltip__list-item",e.NAME_CLASS="l7plot-tooltip__name",e.VALUE_CLASS="l7plot-tooltip__value",e.CONTAINER_TPL=`<div class="${e.CONTAINER_CLASS}">
  <div class="${e.TITLE_CLASS}"></div>
  <ul class="${e.LIST_CLASS}"></ul>
</div>`,e.ITEM_TPL=`<li class="${e.LIST_ITEM_CLASS}" data-index={index}>
  <span class="${e.NAME_CLASS}">{name}</span>
  <span class="${e.VALUE_CLASS}">{value}</span>
</li>`})(wy);var Cy={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ITEM_TPL=e.CONTAINER_TPL=e.VALUE_CLASS=e.MARKER_CLASS=e.LIST_ITEM_CLASS=e.LIST_CLASS=e.TITLE_CLASS=e.CONTAINER_CLASS=void 0,e.CONTAINER_CLASS="l7plot-legend l7plot-legend__category",e.TITLE_CLASS="l7plot-legend__title",e.LIST_CLASS="l7plot-legend__category-list",e.LIST_ITEM_CLASS="l7plot-legend__list-item",e.MARKER_CLASS="l7plot-legend__category-marker",e.VALUE_CLASS="l7plot-legend__category-value",e.CONTAINER_TPL=`<div class="${e.CONTAINER_CLASS}">
  <div class="${e.TITLE_CLASS}"></div>
  <ul class="${e.LIST_CLASS}"></ul>
</div>`,e.ITEM_TPL=`<li class="${e.LIST_ITEM_CLASS}" data-index={index}>
  <span class="${e.MARKER_CLASS}" style="background:{color}"></span>
  <span class="${e.VALUE_CLASS}">{value}</span>
</li>`})(Cy);var ex={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.RIBBON_TPL=e.CONTAINER_TPL=e.VALUE_RANGE_CLASS=e.GRADIENT_BAR_CLASS=e.RIBBON_CLASS=e.RIBBON_CONTAINER_CLASS=e.TITLE_CLASS=e.CONTAINER_CLASS=void 0,e.CONTAINER_CLASS="l7plot-legend l7plot-legend__continue",e.TITLE_CLASS="l7plot-legend__title",e.RIBBON_CONTAINER_CLASS="l7plot-legend__ribbon-container",e.RIBBON_CLASS="l7plot-legend__ribbon",e.GRADIENT_BAR_CLASS="l7plot-legend__gradient-bar",e.VALUE_RANGE_CLASS="l7plot-legend__value-range",e.CONTAINER_TPL=`<div class="${e.CONTAINER_CLASS}">
  <div class="${e.TITLE_CLASS}"></div>
  <div class="${e.RIBBON_CONTAINER_CLASS}"></div>
</div>`,e.RIBBON_TPL=`<div class="${e.RIBBON_CLASS}">
  <span class="${e.VALUE_RANGE_CLASS}">{min}</span>
  <div class="${e.GRADIENT_BAR_CLASS}" style="background-image: {backgroundImage}"></div>
  <span class="${e.VALUE_RANGE_CLASS}">{max}</span>
</div>`})(ex);function ost(e){const t={point:{default:{fill:e.pointFillColor,size:e.pointSize,stroke:e.pointBorderColor,lineWidth:e.pointBorder,fillOpacity:e.pointFillOpacity},active:{fill:e.pointActiveFillColor},selected:{fill:e.pointSelectedFillColor}}};return{mapStyle:e.mapStyle,defaultColor:e.brandColor,subColor:e.subColor,semanticRed:e.paletteSemanticRed,semanticGreen:e.paletteSemanticGreen,fontFamily:e.fontFamily,colors10:e.paletteQualitative10,colors20:e.paletteQualitative20,sequenceColors:e.paletteSequence,shapes:{point:["circle","square"],line:["line"]},sizes:[1,10],geometries:{point:{circle:{default:{style:t.point.default},active:{style:t.point.active},selected:{style:t.point.selected}}},line:{},polygon:{}},components:{legend:{category:{domStyles:{[Cy.CONTAINER_CLASS]:{visibility:"visible",zIndex:1,backgroundColor:e.legendContainerFillColor,boxShadow:e.legendContainerShadow,borderRadius:`${e.legendContainerBorderRadius}px`,color:e.legendTextFillColor,fontFamily:e.fontFamily,padding:"10px",lineHeight:"1",fontSize:`${e.legendTextFontSize}px`},[Cy.TITLE_CLASS]:{fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},[Cy.LIST_CLASS]:{margin:"0px",padding:"0px"},[Cy.LIST_ITEM_CLASS]:{marginBottom:"2px"},[Cy.MARKER_CLASS]:{width:"10px",height:"10px"},[Cy.VALUE_CLASS]:{paddingLeft:"8px"}}},continue:{domStyles:{[ex.CONTAINER_CLASS]:{visibility:"visible",zIndex:1,backgroundColor:e.legendContainerFillColor,boxShadow:e.legendContainerShadow,borderRadius:`${e.legendContainerBorderRadius}px`,color:e.legendTextFillColor,fontFamily:e.fontFamily,padding:"10px",lineHeight:1,fontSize:`${e.legendTextFontSize}px`},[ex.TITLE_CLASS]:{fontSize:"13px",lineHeight:"19px",marginBottom:"8px"},[ex.RIBBON_CLASS]:{display:"flex",alignItems:"center"},[ex.GRADIENT_BAR_CLASS]:{width:"140px",height:"14px",margin:"0px 5px"},[ex.VALUE_RANGE_CLASS]:{padding:"0px"}}}},tooltip:{domStyles:{[wy.CONTAINER_CLASS]:{visibility:"visible",zIndex:999,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)",backgroundColor:e.tooltipContainerFillColor,boxShadow:e.tooltipContainerShadow,borderRadius:`${e.tooltipContainerBorderRadius}px`,color:e.tooltipTextFillColor,fontSize:`${e.tooltipTextFontSize}px`,fontFamily:e.fontFamily,lineHeight:e.tooltipTextLineHeight},[wy.TITLE_CLASS]:{marginBottom:"4px"},[wy.LIST_CLASS]:{margin:"0px",padding:"0px"},[wy.LIST_ITEM_CLASS]:{marginBottom:"4px"},[wy.NAME_CLASS]:{color:e.tooltipItemNameFillColor},[wy.VALUE_CLASS]:{color:e.tooltipItemValueFillColor,marginLeft:"30px"}}},label:{style:{textAnchor:"center",textOffset:[0,0],fill:e.labelFillColor,fontSize:e.labelFontSize,fontFamily:e.fontFamily,fillColorDark:e.labelFillColorDark,fillColorLight:e.labelFillColorLight}}}}}const gy={100:"#000",95:"#0D0D0D",85:"#262626",65:"#595959",45:"#8C8C8C",25:"#BFBFBF",15:"#D9D9D9",6:"#F0F0F0"},gle={100:"#FFFFFF",95:"#F2F2F2",85:"#D9D9D9",65:"#A6A6A6",45:"#737373",25:"#404040",15:"#262626",6:"#0F0F0F"},mle=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#6F5EF9","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],yle=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#6F5EF9","#D3CEFD","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],_le=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"],sst=(e={})=>{const{mapStyle:t="light",subColor:r="rgba(0,0,0,0.05)",paletteQualitative10:n=mle,paletteQualitative20:i=yle,paletteSemanticRed:a="#F4664A",paletteSemanticGreen:o="#30BF78",paletteSemanticYellow:s="#FAAD14",paletteSequence:l=_le,fontFamily:u=`"-apple-system", "Segoe UI", Roboto, "Helvetica Neue", Arial,
    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
    "Noto Color Emoji"`}=e,{brandColor:c=n[0]}=e;return{mapStyle:t,brandColor:c,subColor:r,paletteQualitative10:n,paletteQualitative20:i,paletteSemanticRed:a,paletteSemanticGreen:o,paletteSemanticYellow:s,paletteSequence:l,fontFamily:u,legendContainerFillColor:"rgba(255, 255, 255, 0.85)",legendContainerShadow:"0 2px 8px 0 rgba(166, 166, 166, 0.20)",legendContainerBorderRadius:2,legendTextFillColor:gy[65],legendTextFontSize:12,tooltipContainerFillColor:"rgba(255, 255, 255, 0.9)",tooltipContainerShadow:"rgb(0 0 0 / 16%) 0px 6px 12px 0px",tooltipContainerBorderRadius:2,tooltipTextFillColor:gy[65],tooltipItemNameFillColor:gy[65],tooltipItemValueFillColor:gy[65],tooltipTextFontSize:12,tooltipTextLineHeight:"20px",labelFillColor:gy[65],labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,pointFillColor:c,pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:gle[100],pointActiveBorderColor:gy[100],pointSelectedBorderColor:gy[100]}};sst();const xle={100:"#000",95:"#0D0D0D",85:"#262626",65:"#595959",45:"#8C8C8C",25:"#BFBFBF",15:"#D9D9D9",6:"#F0F0F0"},yy={100:"#FFFFFF",95:"#F2F2F2",85:"#D9D9D9",65:"#A6A6A6",45:"#737373",25:"#404040",15:"#262626",6:"#0F0F0F"},EX=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#E86452","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],ble=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#E86452","#F8D0CB","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],Ele=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"],lst=(e={})=>{const{mapStyle:t="dark",subColor:r="rgba(255,255,255,0.05)",paletteQualitative10:n=EX,paletteQualitative20:i=ble,paletteSemanticRed:a="#F4664A",paletteSemanticGreen:o="#30BF78",paletteSemanticYellow:s="#FAAD14",paletteSequence:l=Ele,fontFamily:u=`"-apple-system", "Segoe UI", Roboto, "Helvetica Neue", Arial,
    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
    "Noto Color Emoji"`}=e,{brandColor:c=n[0]}=e;return{mapStyle:t,brandColor:c,subColor:r,paletteQualitative10:n,paletteQualitative20:i,paletteSemanticRed:a,paletteSemanticGreen:o,paletteSemanticYellow:s,paletteSequence:l,fontFamily:u,legendContainerFillColor:"rgba(31, 31, 31, 0.85)",legendContainerShadow:"0 2px 8px 0 rgba(166, 166, 166, 0.20)",legendContainerBorderRadius:2,legendTextFillColor:yy[65],legendTextFontSize:12,tooltipContainerFillColor:"rgba(31, 31, 31, 0.9)",tooltipContainerShadow:"0px 2px 4px rgba(0, 0, 0, 0.5)",tooltipContainerBorderRadius:2,tooltipTextFillColor:yy[65],tooltipItemNameFillColor:yy[65],tooltipItemValueFillColor:yy[65],tooltipTextFontSize:12,tooltipTextLineHeight:"20px",labelFillColor:yy[65],labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,pointFillColor:EX[0],pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:xle[100],pointActiveBorderColor:yy[100],pointSelectedBorderColor:yy[100]}};lst();function ust(e){const{styleSheet:t={}}=e,r=fi(e,["styleSheet"]),n=sst(t);return Tr({},ost(n),r)}function wle(e){const{styleSheet:t={}}=e,r=fi(e,["styleSheet"]),n=lst(t);return Tr({},ost(n),r)}const wX=ust({}),Cle=wle({}),CX={default:wX,light:wX,dark:Cle};function mB(e="default"){return xt(CX,b0(e),CX.default)}const Sle=[{original:"loaded",adaptation:"scene-loaded"},{original:"resize",adaptation:"resize"},{original:"destroy",adaptation:"destroy"},{original:"resize",adaptation:"resize"}],Tle=["mapmove","movestart","moveend","zoomchange","zoomstart","zoomend","click","dblclick","contextmenu","mousemove","mousewheel","mouseover","mouseout","mouseup","mousedown","dragstart","dragging","dragend"],SM=["inited","add","remove","dataUpdate","click","unclick","dblclick","undblclick","contextmenu","uncontextmenu","mouseenter","mousemove","unmousemove","mouseout","mouseup","unmouseup","mousedown","uncontextmenu","unpick","legend","legend:color","legend:size"],SX=new Map,TX=new Map,AX=new Map,cst={map:{type:Id.Amap},logo:!0};let hst=class fst extends F_{constructor(t){super(),this.inited=!1,this.sceneLoaded=!1,this.layersLoaded=!1,this.loaded=!1,this.layerGroup=new Vk,this.options=Os({},this.getDefaultOptions(),t),this.lastOptions=this.options}getDefaultOptions(){return fst.DefaultOptions}createContainer(t){const{width:r,height:n}=this.options,i=typeof t=="string"?document.getElementById(t):t;return i.style.position||(i.style.position="relative"),r&&(i.style.width||(i.style.width=`${r}px`)),n&&(i.style.height||(i.style.height=`${n}px`)),i}createTheme(){return Xi(this.options.theme)?Os({},mB("default"),ust(this.options.theme)):mB(this.options.theme)}createMap(){const t=this.options.map?this.options.map:cst.map,{type:r}=t,n=fi(t,["type"]),i=Object.assign({style:this.theme.mapStyle},n);return r===Id.Amap?new f7t(i):r===Id.AmapV1?new d7t(i):r===Id.AmapV2?new p7t(i):r===Id.Mapbox?new t7t(i):new j8t(i)}createScene(){const{logo:t,antialias:r,preserveDrawingBuffer:n}=this.options,i=bg(t)?{logoVisible:t}:{logoVisible:t==null?void 0:t.visible,logoPosition:t==null?void 0:t.position},a=Object.assign({antialias:r,preserveDrawingBuffer:n},i),o=this.createMap();return new x9t(Object.assign({id:this.container,map:o},a))}registerResources(){SX.size&&SX.forEach((t,r)=>{!this.scene.hasImage(r)&&this.scene.addImage(r,t)}),TX.size&&TX.forEach((t,r)=>{this.scene.addFontFace(r,t)}),AX.size&&AX.forEach((t,r)=>{this.scene.addIconFont(r,t)})}update(t){this.updateOption(t),t.map&&!Di(this.lastOptions.map,this.options.map)&&this.updateMap(t.map),this.render(),this.emit("update")}updateOption(t){this.lastOptions=this.options,this.options=Os({},this.options,t)}updateMap(t){var r;if(!this.scene)return;const{style:n,center:i,zoom:a,rotation:o,pitch:s}=t;Gl(s)||this.scene.setPitch(s),Gl(o)||this.scene.setRotation(o),n&&n!==((r=this.lastOptions.map)===null||r===void 0?void 0:r.style)&&this.scene.setMapStyle(n),a&&i&&this.scene.setZoomAndCenter(a,i)}changeSize(t,r){this.options.width===t&&this.options.height===r||(this.container.style.width=`${t}px`,this.container.style.height=`${r}px`,this.options=Object.assign(this.options,{width:t,height:r}))}on(t,r,n){return this.proxyEventHander("on",t,r,n),this}once(t,r){return this.proxyEventHander("once",t,r),this}off(t,r){return this.proxyEventHander("off",t,r),this}proxyEventHander(t,r,n,i){const a=Sle.find(o=>o.adaptation===r);if(a)this.scene[t](a.original,n);else if(Tle.indexOf(r)!==-1)this.scene[t](r,n);else if(r.includes("Layer:")){const[o,s]=r.split(":");if(this[o]&&this[o][t]&&SM.indexOf(s)!==-1)this[o][t](s,n);else throw new Error(`No event name "${r}"`)}else super[t](r,n,i)}getScene(){return this.scene}getMap(){var t,r,n,i;return((t=this.options.map)===null||t===void 0?void 0:t.type)===Id.Amap?this.scene.map:((r=this.options.map)===null||r===void 0?void 0:r.type)===Id.AmapV2?this.scene.map:((n=this.options.map)===null||n===void 0?void 0:n.type)===Id.Mapbox?this.scene.map:((i=this.options.map)===null||i===void 0?void 0:i.type)===Id.Map?this.scene.map:this.scene.map}addLayer(t){this.layerGroup.addLayer(t)}getLayes(){return console.warn("Replace to use getLayers()"),this.getLayers()}getLayers(){return this.layerGroup.getLayers()}getLayerByName(t){return this.layerGroup.getLayerByName(t)}removeLayer(t){return this.layerGroup.removeLayer(t)}removeAllLayer(){this.layerGroup.removeAllLayer()}zoomIn(){this.scene.zoomIn()}zoomOut(){this.scene.zoomOut()}setPitch(t){this.scene.setPitch(t)}fitBounds(t){this.scene.fitBounds(t)}setMapStatus(t){this.scene.setMapStatus(t)}setBgColor(t){this.scene.setBgColor(t)}initComponents(){this.initControls(),this.initTooltip()}updateComponents(){this.updateControls(),this.initTooltip()}initControls(){const{zoom:t,scale:r,layerMenu:n,legend:i}=this.options;r&&this.addScaleControl(r),t&&this.addZoomControl(t),n&&this.addLayerMenuControl(n),i&&(this.addLegendControl(i),this.emit("add-legend"))}updateControls(){const{zoom:t,scale:r,layerMenu:n,legend:i}=this.options;Di(this.lastOptions.zoom,t)||(t?this.updateZoomControl(t):this.removeZoomControl()),Di(this.lastOptions.scale,r)||(r?this.updateScaleControl(r):this.removeScaleControl()),Di(this.lastOptions.layerMenu,n)||(n?this.updateLayerMenuControl(n):this.removeLayerMenuControl()),Di(this.lastOptions.legend,i)||(i?this.updateLegendControl(i):this.removeLegendControl())}addZoomControl(t){this.zoomControl||(this.zoomControl=new c6t(t),this.scene.addControl(this.zoomControl))}updateZoomControl(t){if(!this.zoomControl){this.addZoomControl(t);return}this.removeZoomControl(),this.addZoomControl(t)}removeZoomControl(){this.zoomControl&&(this.zoomControl.remove(),this.zoomControl=void 0)}addScaleControl(t){this.scaleControl||(this.scaleControl=new _Dt(t),this.scene.addControl(this.scaleControl))}updateScaleControl(t){if(!this.scaleControl){this.addScaleControl(t);return}this.removeScaleControl(),this.addScaleControl(t)}removeScaleControl(){this.scaleControl&&(this.scaleControl.remove(),this.scaleControl=void 0)}addLayerMenuControl(t){this.layerGroup.getLayers().forEach(({name:r,layer:n})=>{})}updateLayerMenuControl(t){this.removeLayerMenuControl(),this.addLayerMenuControl(t)}removeLayerMenuControl(){}getLegendOptions(){return{}}addLegendControl(t){if(this.legendControl)return;const r=this.theme.components.legend,n=Os({},this.getLegendOptions(),t),{type:i,position:a}=n,o=fi(n,["type","position"]),s=[];if(i==="category"){const l=Os({},{domStyles:r.category.domStyles},o);s.push({type:i,options:l})}else if(i==="continue"){const l=Os({},{domStyles:r.continue.domStyles},o);s.push({type:i,options:l})}s.length&&(this.legendControl=new ule({position:a,items:s}),this.scene.addControl(this.legendControl))}updateLegendControl(t){if(!this.legendControl){this.addLegendControl(t);return}this.removeLegendControl(),this.addLegendControl(t)}removeLegendControl(){this.legendControl&&(this.legendControl.remove(),this.legendControl=void 0)}initTooltip(){this.tooltip&&this.tooltip.destroy();const{tooltip:t}=this.options;if(t){const r=Os({},{domStyles:this.theme.components.tooltip.domStyles},t),n=this.layerGroup.getInteractionLayers();this.tooltip=new vle(this.scene,n,r),this.tooltip.on("*",i=>this.emit(i.type,i))}}exportPng(t){return this.scene.exportPng(t)}destroy(){var t;super.off("*"),this.removeScaleControl(),this.removeZoomControl(),this.removeLayerMenuControl(),this.removeLegendControl(),(t=this.tooltip)===null||t===void 0||t.destroy(),this.scene.destroy()}};hst.DefaultOptions=cst;class yB{static aggregation(t,r){const{type:n="grid",radius:i,method:a,field:o}=r,s={type:n,size:i,method:a,field:o};t.transforms?(t.transforms=t.transforms.filter(l=>l.type!==s.type),t.transforms.push(s)):t.transforms=[s]}}const dst=["name","zIndex","visible","minZoom","maxZoom","pickingBuffer","autoFit","blend"];class ah extends F_{constructor(t){super(),this.options=Os({},this.getDefaultOptions(),t),this.lastOptions=this.options}getDefaultOptions(){return{}}pickLayerConfig(t){return Vd(t,dst)}addTo(t){t.addLayer(this.layer)}remove(t){t.removeLayer(this.layer)}update(t){this.updateOption(t),this.updateConfig(t)}updateOption(t){this.lastOptions=this.options,this.options=Os({},this.options,t)}updateConfig(t){!Gl(t.zIndex)&&!Di(this.lastOptions.zIndex,this.options.zIndex)&&this.setIndex(t.zIndex),!Gl(t.blend)&&!Di(this.lastOptions.blend,this.options.blend)&&this.setBlend(t.blend),!Gl(t.minZoom)&&!Di(this.lastOptions.minZoom,this.options.minZoom)&&this.setMinZoom(t.minZoom),!Gl(t.maxZoom)&&!Di(this.lastOptions.maxZoom,this.options.maxZoom)&&this.setMinZoom(t.maxZoom),!Gl(t.visible)&&!Di(this.lastOptions.visible,this.options.visible)&&(t.visible?this.show():this.hide())}render(){this.layer.renderLayers()}setSource(t){if(t instanceof WI)this.layer.setSource(t);else{const{data:r,aggregation:n}=t,i=fi(t,["data","aggregation"]);n&&yB.aggregation(i,n),this.layer.getSource()?this.layer.setData(r,i):this.layer.source(r,i)}}changeData(t){this.setSource(t)}setIndex(t){this.layer.setIndex(t)}setBlend(t){this.layer.setBlend(t)}setMinZoom(t){this.layer.setMinZoom(t)}setMaxZoom(t){this.layer.setMaxZoom(t)}show(){this.layer.inited&&this.layer.show()}hide(){this.layer.inited&&this.layer.hide()}toggleVisible(){this.isVisible()?this.hide():this.show()}isVisible(){return this.layer.inited?this.layer.isVisible():this.options.visible}fitBounds(t){this.layer.fitBounds(t)}on(t,r){return SM.indexOf(t)!==-1?this.layer.on(t,r):super.on(t,r),this}once(t,r){return SM.indexOf(t)!==-1?this.layer.once(t,r):super.once(t,r),this}off(t,r){return SM.indexOf(t)!==-1?this.layer.off(t,r):super.off(t,r),this}}ah.LayerType=vB;ah.LayerConfigkeys=dst;function _y(e,t){return(...r)=>{const n={};return e.forEach((i,a)=>{n[i]=r[a]}),delete n.undefined,t(n)}}class Ui{static shape(t,r){if(en(r))t.shape(r);else if(Rr(r)){const n=[];t.shape(n.join("*"),_y(n,r))}else if(Xi(r)){const n=r.field?r.field:"";if(Rr(r.value)){const i=Fe(n)?n:n.split("*");t.shape(n,_y(i,r.value))}else t.shape(n,r.value);en(n)&&r.scale&&Ui.scale(t,n,r.scale)}}static size(t,r){if(Rn(r))t.size(r);else if(Fe(r))t.size(r);else if(Rr(r)){const n=[];t.size(n.join("*"),_y(n,r))}else if(Xi(r)){const n=r.field?r.field:"";if(Rr(r.value)){const i=Fe(n)?n:n.split("*");t.size(n,_y(i,r.value))}else t.size(n,r.value);en(n)&&r.scale&&Ui.scale(t,n,r.scale)}}static color(t,r){if(en(r))t.color(r);else if(Rr(r)){const n=[];t.color(n.join("*"),_y(n,r))}else if(Xi(r)){const n=r.field?r.field:"";if(Rr(r.value)){const i=Fe(n)?n:n.split("*");t.color(n,_y(i,r.value))}else t.color(n,r.value);en(n)&&r.scale&&Ui.scale(t,n,r.scale)}}static style(t,r){r&&t.style(r)}static state(t,r){const{active:n,select:i}=r;n&&t.active(n),i&&t.select(i)}static rotate(t,r){en(r)||Rr(r)}static texture(t,r){en(r)&&t.texture(r)}static animate(t,r){(bg(r)||Xi(r))&&t.animate(r)}static scale(t,r,n){t.scale(r,n)}static filter(t,r){const n=r.field?r.field:"",i=Fe(n)?n:n.split("*");t.filter(i.join("*"),_y(i,r.value))}}function Ale(e,t){const{field:r,content:n,style:i={},state:a}=t,{fontSize:o,fill:s}=i,u={field:r||n||"",value:"text"};Ui.shape(e,u),o&&Ui.size(e,o),s&&Ui.color(e,s),i&&Ui.style(e,i),a&&Ui.state(e,a)}const pst={style:{fontSize:12}},Mle=[];class $3 extends ah{constructor(t){super(t),this.type=ah.LayerType.TextLayer,this.interaction=!1;const{name:r,source:n}=this.options,i=this.pickLayerConfig(this.options);this.name=r||lh(this.type),this.layer=new DC(Object.assign(Object.assign({},i),{name:this.name})),this.mappingLayer(this.layer,this.options),this.setSource(n)}getDefaultOptions(){return pst}mappingLayer(t,r){Ale(t,r)}update(t){super.update(t),this.mappingLayer(this.layer,this.options)}}$3.DefaultOptions=pst;$3.LayerOptionsKeys=ah.LayerConfigkeys.concat(Mle);const Rle={autoFit:!1};class iv extends hst{constructor(t,r){if(typeof t=="string"||t instanceof Element){if(r===void 0)throw new Error("options is undefined");super(r),this.container=this.createContainer(t),this.theme=this.createTheme(),this.scene=this.createScene(),this.registerResources(),this.initSource()}else super(t)}initSource(){this.source=this.createSource(),this.render(),this.inited=!0}initLayersEvent(){}getDefaultOptions(){return iv.DefaultOptions}createSource(){const t=this.options.source,{data:r,aggregation:n}=t,i=fi(t,["data","aggregation"]);return n&&yB.aggregation(i,n),new WI(r,i)}createLabelLayer(t,r,n){const{visible:i,minZoom:a,maxZoom:o,zIndex:s=0}=n||{};return new $3(Object.assign({name:"labelLayer",visible:i,minZoom:a,maxZoom:o,zIndex:s+.1,source:t},r))}updateLabelLayer(t,r,n,i){r?i?i.update(Object.assign({},r)):(i=this.createLabelLayer(t,r,n),this.layerGroup.addLayer(i)):r===!1&&i&&this.layerGroup.removeLayer(i)}render(){const t=this.createLayers(this.source);this.inited?(this.layerGroup.removeAllLayer(),t.addTo(this.scene),this.layerGroup=t):(this.layerGroup=t,this.scene.sceneService.loaded?this.onSceneLoaded():this.scene.once("loaded",()=>{this.onSceneLoaded()})),this.initLayersEvent()}onSceneLoaded(){this.sceneLoaded=!0,this.layerGroup.isEmpty()?this.onLayersLoaded():this.layerGroup.once("inited-all",()=>{this.onLayersLoaded()}),this.layerGroup.addTo(this.scene)}onLayersLoaded(){this.layersLoaded=!0,this.initComponents(),this.loaded=!0,this.emit("loaded")}attachToScene(t,r){this.scene=t,this.theme=r||mB("default"),this.registerResources(),this.initSource()}unattachFromScene(){var t;this.removeAllLayer(),(t=this.tooltip)===null||t===void 0||t.destroy()}addToScene(t){this.attachToScene(t)}removeFromScene(){var t;this.removeAllLayer(),this.removeScaleControl(),this.removeZoomControl(),this.removeLayerMenuControl(),this.removeLegendControl(),(t=this.tooltip)===null||t===void 0||t.destroy()}update(t){if(this.updateOption(t),t.map&&!Di(this.lastOptions.map,this.options.map)&&this.updateMap(t.map),this.scene.setEnableRender(!1),t.source&&!Di(this.lastOptions.source,this.options.source)){const r=t.source,{data:n}=r,i=fi(r,["data"]);this.changeData(n,i)}this.scene.setEnableRender(!0),this.render(),this.updateComponents(),this.emit("update")}changeData(t,r){this.options.source=Os({},this.options.source,Object.assign({data:t},r));const n=this.options.source,{aggregation:i}=n,a=fi(n,["aggregation"]);i&&yB.aggregation(a,i),this.source.setData(this.options.source.data,a);const o=this.options.legend;o&&setTimeout(()=>{this.updateLegendControl(o)},500),this.emit("change-data")}}iv.DefaultOptions=Rle;iv.PlotType=gB;const MX="#2f54eb",kl={active:{fill:!1,stroke:MX,lineWidth:1.5,lineOpacity:.8},select:{fill:!1,stroke:MX,lineWidth:1.5,lineOpacity:.8}},Hw=e=>(Gl(e)||(e.active===!1?kl.active=Object.assign(kl.active,{fill:!1,stroke:!1}):typeof e.active=="object"&&(e.active.fill===!1?kl.active.fill=!1:typeof e.active.fill=="string"&&(kl.active.fill=e.active.fill),e.active.stroke===!1?kl.active.stroke=!1:typeof e.active.stroke=="string"&&(kl.active.stroke=e.active.stroke),typeof e.active.lineWidth=="number"&&(kl.active.lineWidth=e.active.lineWidth),typeof e.active.lineOpacity=="number"&&(kl.active.lineOpacity=e.active.lineOpacity)),e.select===!1?kl.select=Object.assign(kl.select,{fill:!1,stroke:!1}):typeof e.select=="object"&&(e.select.fill===!1?kl.select.fill=!1:typeof e.select.fill=="string"&&(kl.select.fill=e.select.fill),e.select.stroke===!1?kl.select.stroke=!1:typeof e.select.stroke=="string"&&(kl.select.stroke=e.select.stroke),typeof e.select.lineWidth=="number"&&(kl.select.lineWidth=e.select.lineWidth),typeof e.select.lineOpacity=="number"&&(kl.select.lineOpacity=e.select.lineOpacity))),kl);function Ile(e,t,r,n,i,a){const{color:o,style:s,state:l}=a,u=Hw(l),c={active:u.active.fill===!1?!1:{color:u.active.fill},select:!1},f={opacity:s==null?void 0:s.opacity},d=s==null?void 0:s.lineWidth,v=s==null?void 0:s.stroke,g={opacity:s==null?void 0:s.lineOpacity,dashArray:s==null?void 0:s.lineDash,lineType:s==null?void 0:s.lineType};if(Ui.shape(e,"fill"),o&&Ui.color(e,o),f&&Ui.style(e,f),c&&Ui.state(e,c),Ui.shape(t,"line"),d&&Ui.size(t,d),v&&Ui.color(t,v),g&&Ui.style(t,g),u.active.stroke){const x=u.active.stroke,w=u.active.lineWidth||d,S={opacity:u.active.lineOpacity};Ui.shape(r,"line"),w&&Ui.size(r,w),x&&Ui.color(r,x),S&&Ui.style(r,S)}if(u.select.fill){const x=u.select.fill;Ui.shape(n,"fill"),x&&Ui.color(n,x),f&&Ui.style(n,f),Ui.state(n,{select:!1,active:!1})}if(u.select.stroke){const x=u.select.stroke,w=u.select.lineWidth||d,S={opacity:u.select.lineOpacity};Ui.shape(i,"line"),w&&Ui.size(i,w),x&&Ui.color(i,x),S&&Ui.style(i,S)}}const Lle=e=>!Array.isArray(e[0].value),Qk=e=>Lle(e)?e:e.map(r=>Object.assign(Object.assign({},r),{value:[L7(r.value[0],4),L7(r.value[1],4)]})),vst={visible:!0,state:{active:!1,select:!1},enabledMultiSelect:!1},Ole=["color","style","state","enabledMultiSelect"];class uC extends ah{constructor(t){super(t),this.selectData=[],this.type=ah.LayerType.AreaLayer,this.interaction=!0,this.onHighlighHandle=c=>{const{feature:f,featureId:d}=c;this.setHighlightLayerSource(f,d)},this.onUnhighlighHandle=()=>{this.setHighlightLayerSource()},this.onSelectHandle=c=>{const f=this.options.enabledMultiSelect,{feature:d,featureId:v}=c;let g=bl(this.selectData);const x=g.findIndex(w=>w.featureId===v);if(x===-1)f?g.push({feature:d,featureId:v}):g=[{feature:d,featureId:v}],this.emit("select",d,bl(g));else{const w=g[x];f?g.splice(x,1):g=[],this.emit("unselect",w,bl(g))}this.setSelectLayerSource(g)};const{name:r,source:n,visible:i,minZoom:a,maxZoom:o,zIndex:s=0}=this.options,l=this.pickLayerConfig(this.options),u=Hw(this.options.state);this.name=r||lh(this.type),this.layer=new cR(Object.assign(Object.assign({},l),{name:this.name})),this.strokeLayer=new Cx({name:"strokeLayer",visible:i,zIndex:s,minZoom:a,maxZoom:o}),this.highlightLayer=new Cx({name:"highlightLayer",visible:i&&!!u.active.stroke,zIndex:s+.1,minZoom:a,maxZoom:o}),this.selectFillLayer=new cR({name:"selectFillLayer",visible:i&&!!u.select.fill,zIndex:s+.1,minZoom:a,maxZoom:o}),this.selectStrokeLayer=new Cx({name:"selectStrokeLayer",visible:i&&!!u.select.stroke,zIndex:s+.1,minZoom:a,maxZoom:o}),this.mappingLayer(this.options),this.setSource(n),this.initEvent()}getDefaultOptions(){return vst}mappingLayer(t){Ile(this.layer,this.strokeLayer,this.highlightLayer,this.selectFillLayer,this.selectStrokeLayer,t)}setSource(t){super.setSource(t),this.setStrokeLayerSource(),this.setHighlightLayerSource(),this.selectFillLayer.source({type:"FeatureCollection",features:[]},{parser:{type:"geojson"}}),this.selectStrokeLayer.source({type:"FeatureCollection",features:[]},{parser:{type:"geojson"}})}setStrokeLayerSource(){const t=this.layer.getSource();if(t)this.strokeLayer.setSource(t);else{const{data:r,options:n}=this.layer.sourceOption;this.strokeLayer.source(r,n)}}setHighlightLayerSource(t,r=-999){if(this.highlightLayerData===r)return;const n=t?[t]:[];this.highlightLayer.getSource()?this.highlightLayer.setData({type:"FeatureCollection",features:n},{parser:{type:"geojson"}}):this.highlightLayer.source({type:"FeatureCollection",features:[]},{parser:{type:"geojson"}}),this.highlightLayerData=r}setSelectLayerSource(t=[]){if(this.selectData.length===t.length&&Di(this.selectData.map(({featureId:n})=>n),t.map(({featureId:n})=>n)))return;const r=t.map(({feature:n})=>n);this.selectFillLayer.setData({type:"FeatureCollection",features:r},{parser:{type:"geojson"}}),this.selectStrokeLayer.setData({type:"FeatureCollection",features:r},{parser:{type:"geojson"}}),this.selectData=t}initEvent(){this.layer.off("mousemove",this.onHighlighHandle),this.layer.off("unmousemove",this.onHighlighHandle),this.layer.off("click",this.onSelectHandle),this.selectData=[],this.highlightLayerData=null,this.options.state&&(this.options.state.active&&(this.layer.on("mousemove",this.onHighlighHandle),this.layer.on("unmousemove",this.onUnhighlighHandle)),this.options.state.select&&this.layer.on("click",this.onSelectHandle))}addTo(t){t.addLayer(this.layer),t.addLayer(this.strokeLayer),t.addLayer(this.highlightLayer),t.addLayer(this.selectFillLayer),t.addLayer(this.selectStrokeLayer)}remove(t){t.removeLayer(this.layer),t.removeLayer(this.strokeLayer),t.removeLayer(this.highlightLayer),t.removeLayer(this.selectFillLayer),t.removeLayer(this.selectStrokeLayer)}update(t){if(super.update(t),this.mappingLayer(this.options),this.options.visible){!Gl(t.state)&&!Di(this.lastOptions.state,this.options.state)&&this.updateHighlightLayer();const r=Hw(this.options.state);r.active.stroke&&this.setHighlightLayerSource(),(r.select.fill||r.select.stroke)&&this.setSelectLayerSource()}this.initEvent()}updateHighlightLayer(){const t=Hw(this.options.state),r=Hw(this.lastOptions.state);r.active.stroke!==t.active.stroke&&(t.active.stroke?this.highlightLayer.show():this.highlightLayer.hide()),r.select.fill!==t.select.fill&&(t.select.fill?this.selectFillLayer.show():this.selectFillLayer.hide()),r.select.stroke!==t.select.stroke&&(t.select.stroke?this.selectStrokeLayer.show():this.selectStrokeLayer.hide())}setIndex(t){this.layer.setIndex(t),this.strokeLayer.setIndex(t),this.highlightLayer.setIndex(t+.1),this.selectFillLayer.setIndex(t+.1),this.selectStrokeLayer.setIndex(t+.1)}setMinZoom(t){this.layer.setMinZoom(t),this.strokeLayer.setMinZoom(t),this.highlightLayer.setMinZoom(t),this.selectFillLayer.setMinZoom(t),this.selectStrokeLayer.setMinZoom(t)}setMaxZoom(t){this.layer.setMaxZoom(t),this.strokeLayer.setMaxZoom(t),this.highlightLayer.setMaxZoom(t),this.selectFillLayer.setMaxZoom(t),this.selectStrokeLayer.setMaxZoom(t)}show(){this.layer.inited&&(this.layer.show(),this.strokeLayer.show(),this.selectFillLayer.show(),this.selectStrokeLayer.show())}hide(){this.layer.inited&&(this.layer.hide(),this.strokeLayer.hide(),this.selectFillLayer.hide(),this.selectStrokeLayer.hide())}getColorLegendItems(){const t=this.layer.getLegendItems("color");return Array.isArray(t)&&t.length!==0?Qk(t):[]}setActive(t){}setSelect(t){}}uC.DefaultOptions=vst;uC.LayerOptionsKeys=ah.LayerConfigkeys.concat(Ole);const gst=new Map;function Ple(e,t){gst.set(e,t)}function Dle(e){return gst.get(e)}const Fle=Os({},iv.DefaultOptions,{source:{data:[],joinBy:{geoField:"adcode"}},viewLevel:{level:"country",adcode:"100000"},chinaBorder:!0}),j1={world:"country",country:"province",province:"city",city:"district",district:"district"},mst="https://gw.alipayobjects.com/os/alisis/geo-data-v0.1.2",_B=`${mst}/choropleth-data`,RX={national:{color:"red",width:1,opacity:1},dispute:{color:"red",width:1,opacity:.8,dashArray:[2,4]},coast:{color:"blue",width:.7,opacity:.8},hkm:{color:"gray",width:.7,opacity:.8,dashArray:[2,4]}};function Ble(e){return e}function Nle(e){if(e==null)return Ble;var t,r,n=e.scale[0],i=e.scale[1],a=e.translate[0],o=e.translate[1];return function(s,l){l||(t=r=0);var u=2,c=s.length,f=new Array(c);for(f[0]=(t+=s[0])*n+a,f[1]=(r+=s[1])*i+o;u<c;)f[u]=s[u],++u;return f}}function kle(e,t){for(var r,n=e.length,i=n-t;i<--n;)r=e[i],e[i++]=e[n],e[n]=r}function zle(e,t){return typeof t=="string"&&(t=e.objects[t]),t.type==="GeometryCollection"?{type:"FeatureCollection",features:t.geometries.map(function(r){return IX(e,r)})}:IX(e,t)}function IX(e,t){var r=t.id,n=t.bbox,i=t.properties==null?{}:t.properties,a=Ule(e,t);return r==null&&n==null?{type:"Feature",properties:i,geometry:a}:n==null?{type:"Feature",id:r,properties:i,geometry:a}:{type:"Feature",id:r,bbox:n,properties:i,geometry:a}}function Ule(e,t){var r=Nle(e.transform),n=e.arcs;function i(c,f){f.length&&f.pop();for(var d=n[c<0?~c:c],v=0,g=d.length;v<g;++v)f.push(r(d[v],v));c<0&&kle(f,g)}function a(c){return r(c)}function o(c){for(var f=[],d=0,v=c.length;d<v;++d)i(c[d],f);return f.length<2&&f.push(f[0]),f}function s(c){for(var f=o(c);f.length<4;)f.push(f[0]);return f}function l(c){return c.map(s)}function u(c){var f=c.type,d;switch(f){case"GeometryCollection":return{type:f,geometries:c.geometries.map(u)};case"Point":d=a(c.coordinates);break;case"MultiPoint":d=c.coordinates.map(a);break;case"LineString":d=o(c.arcs);break;case"MultiLineString":d=c.arcs.map(o);break;case"Polygon":d=l(c.arcs);break;case"MultiPolygon":d=c.arcs.map(l);break;default:return null}return{type:f,coordinates:d}}return u(t)}const $le=e=>{const t={url:_B,type:"topojson",extension:"topo.json"};return Gl(e)||(typeof e=="string"?t.url=e:(t.url=(e==null?void 0:e.url)||_B,t.type=e.type,t.extension=e.type==="topojson"?"topo.json":"json")),t},Hle=e=>{try{return zle(e,"json")}catch{throw new Error('Failed convert to geojson from topojson, topojson default layer name "json"')}},Vle=(e,t)=>{if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++){const{level:n,granularity:i}=e[r];if(t[r].level!==n||t[r].granularity!==i)return!1}return!0},LX=e=>Vd(e,["source","color","style","state","label","tooltip"]);function Gle(e,t){const{shape:r,color:n,size:i,style:a,state:o,animate:s,texture:l}=t;r&&Ui.shape(e,r),i&&Ui.size(e,i),n&&Ui.color(e,n),a&&Ui.style(e,a),o&&Ui.state(e,o),s&&Ui.animate(e,s),l&&Ui.texture(e,l)}const yst={},Wle=["shape","color","size","style","state","animate"];class Ox extends ah{constructor(t){super(t),this.type=ah.LayerType.LinesLayer,this.interaction=!0;const{name:r,source:n}=this.options,i=this.pickLayerConfig(this.options);this.name=r||lh(this.type),this.layer=new Cx(Object.assign(Object.assign({},i),{name:this.name})),this.mappingLayer(this.layer,this.options),this.setSource(n)}getDefaultOptions(){return yst}mappingLayer(t,r){Gle(t,r)}update(t){super.update(t),this.mappingLayer(this.layer,this.options)}getColorLegendItems(){const t=this.layer.getLegendItems("color");return Array.isArray(t)&&t.length!==0?Qk(t):[]}}Ox.DefaultOptions=yst;Ox.LayerOptionsKeys=ah.LayerConfigkeys.concat(Wle);const Xle=["color","size","style","state","animate"];class TM extends Ox{constructor(){super(...arguments),this.type=Ox.LayerType.PathLayer}getDefaultOptions(){return Os({},Ox.DefaultOptions,{shape:"line"})}}TM.LayerOptionsKeys=Ox.LayerConfigkeys.concat(Xle);const jle=(e,t)=>{const{visible:r,minZoom:n,maxZoom:i,zIndex:a=0,chinaBorder:o}=t||{},s=typeof o=="object"?Os({},RX,o):RX,l=e.features.filter(({properties:g})=>["coast","national"].includes(g==null?void 0:g.type)),u=e.features.filter(({properties:g})=>(g==null?void 0:g.type)==="dispute"),c=e.features.filter(({properties:g})=>(g==null?void 0:g.type)==="hkm"),f=new TM({name:"chinaBoundaryLayer",visible:r,minZoom:n,maxZoom:i,zIndex:a+.1,source:{data:{type:"FeatureCollection",features:l},parser:{type:"geojson"}},color:{field:"type",value:({type:g})=>s[g].color},size:{field:"type",value:({type:g})=>s[g].width},style:{opacity:s.national.opacity}}),d=new TM({name:"chinaHkmBoundaryLayer",visible:r,minZoom:n,maxZoom:i,zIndex:a+.1,source:{data:{type:"FeatureCollection",features:c},parser:{type:"geojson"}},color:s.hkm.color,size:s.hkm.width,style:{opacity:s.hkm.opacity,lineType:"dash",dashArray:s.hkm.dashArray}}),v=new TM({name:"chinaDisputeBoundaryLayer",visible:r,minZoom:n,maxZoom:i,zIndex:a+.1,source:{data:{type:"FeatureCollection",features:u},parser:{type:"geojson"}},color:s.dispute.color,size:s.dispute.width,style:{opacity:s.dispute.opacity,lineType:"dash",dashArray:s.dispute.dashArray}});return{chinaBoundaryLayer:f,chinaHkmBoundaryLayer:d,chinaDisputeBoundaryLayer:v}};class Zb extends iv{constructor(){super(...arguments),this.type=iv.PlotType.Choropleth,this.chinaBoundaryData={type:"FeatureCollection",features:[]},this.currentDistrictData={type:"FeatureCollection",features:[]},this.drillSteps=[],this.drillStacks=[],this.onDrillDownHander=t=>{var r;const{steps:n,onDown:i}=this.options.drill,a=(r=t.feature)===null||r===void 0?void 0:r.properties,{adcode:o}=a;if(this.drillStacks.length===n.length+1)return;const s=this.drillStacks.slice(-1)[0],l=this.drillStacks.length-1,u=this.drillSteps[l],{level:c,granularity:f=j1[c]}=u,d=fi(u,["level","granularity"]),v={nativeEvent:!0,from:{level:s.level,adcode:s.adcode,granularity:s.granularity},to:{level:c,adcode:o,granularity:f,properties:a}},g=(x={})=>{const w={level:c,adcode:o,granularity:f},S=Os({},d,x);this.changeView(w,S).then(M=>{M&&(this.drillStacks.push(M),this.emit("drilldown",v))})};i?i(v.from,v.to,g):g()},this.onDrillUpHander=()=>{const{onUp:t}=this.options.drill;if(this.drillStacks.length===0||this.drillStacks.length===1)return;const n=this.drillStacks.length-1,i=this.drillStacks[n],a=this.drillStacks[n-1],o={nativeEvent:!0,from:{level:i.level,adcode:i.adcode,granularity:i.granularity},to:{level:a.level,adcode:a.adcode,granularity:a.granularity}},s=(l={})=>{const u=o.to,c=Os({},a.config,l);this.changeView(u,c).then(f=>{f&&(this.drillStacks.pop(),this.emit("drillup",o))})};t?t(o.from,o.to,s):s()}}initSource(){this.getInitDistrictData().then(()=>{this.source=this.createSource(),this.render(),this.inited=!0})}render(){if(this.inited)this.scene.setEnableRender(!0),this.scene.render();else{const t=this.createLayers(this.source);this.layerGroup=t,this.scene.sceneService.loaded?this.onSceneLoaded():this.scene.once("loaded",()=>{this.onSceneLoaded()}),this.initLayersEvent()}}update(t){var r,n,i;if(this.updateOption(t),t.map&&!Di(this.lastOptions.map,this.options.map)&&this.updateMap(t.map),t.drill&&t.drill.enabled!==!1&&!Di((r=this.lastOptions.drill)===null||r===void 0?void 0:r.steps,(n=this.options.drill)===null||n===void 0?void 0:n.steps)&&(this.drillReset(),this.initDrillEvent()),this.scene.setEnableRender(!1),t.viewLevel&&!Di(this.lastOptions.viewLevel,this.options.viewLevel)){const a=(i=t.source)===null||i===void 0?void 0:i.joinBy.geoData;this.getDistrictData(a).then(()=>{const o=this.options.source,{data:s}=o,l=fi(o,["data"]);this.changeData(s,l),this.updateLayers(t),this.render(),this.updateComponents(),this.emit("update")})}else{if(t.source&&!Di(this.lastOptions.source,this.options.source)){const a=this.options.source,{data:o}=a,s=fi(a,["data"]);this.changeData(o,s)}this.updateLayers(t),this.render(),this.updateComponents(),this.emit("update")}}getDefaultOptions(){return Zb.DefaultOptions}parserSourceConfig(t){const{data:r,joinBy:n}=t,i=fi(t,["data","joinBy"]),{sourceField:a,geoField:o,geoData:s}=n,l=s,u={type:"join",sourceField:a,targetField:o,data:r};return i.transforms?i.transforms.push(u):i.transforms=[u],i.parser&&delete i.parser,{data:l,sourceCFG:i}}createSource(){const{data:t,sourceCFG:r}=this.parserSourceConfig(this.options.source);return new WI(t,r)}changeData(t,r){this.options.source=Os({},this.options.source,Object.assign({data:t},r));const{data:n,sourceCFG:i}=this.parserSourceConfig(this.options.source);this.source.setData(n,i),this.emit("change-data")}createLayers(t){this.fillAreaLayer=new uC(Object.assign({name:"fillAreaLayer",source:t},Vd(this.options,uC.LayerOptionsKeys)));const r=new Vk([this.fillAreaLayer]);return this.options.chinaBorder&&this.createCountryBoundaryLayer(this.chinaBoundaryData,this.options).forEach(i=>r.addLayer(i)),this.options.label&&(this.labelLayer=this.createLabelLayer(t,this.options.label),r.addLayer(this.labelLayer)),r}createCountryBoundaryLayer(t,r){const{chinaBoundaryLayer:n,chinaHkmBoundaryLayer:i,chinaDisputeBoundaryLayer:a}=jle(t,r);return this.chinaBoundaryLayer=n,this.chinaHkmBoundaryLayer=i,this.chinaDisputeBoundaryLayer=a,[n,i,a]}createLabelLayer(t,r){const n=t.originData.features.map(({properties:c})=>Object.assign({},c,{centroid:c.centroid||c.center})).filter(({centroid:c})=>c),{visible:i,minZoom:a,maxZoom:o,zIndex:s=0}=this.options,l=new $3(Object.assign({name:"labelLayer",source:{data:n,parser:{type:"json",coordinates:"centroid"},transforms:t.transforms},visible:i,minZoom:a,maxZoom:o,zIndex:s+.1},r)),u=()=>{const c=this.source.originData.features.map(({properties:f})=>f).filter(({centroid:f})=>f);l.layer.setData(c,{transforms:t.transforms})};return t.on("update",u),l.on("remove",()=>{t.off("update",u)}),l}updateLayers(t){const r=Vd(t,uC.LayerOptionsKeys);this.fillAreaLayer.update(r);const n=()=>{this.createCountryBoundaryLayer(this.chinaBoundaryData,this.options).forEach(o=>this.layerGroup.addLayer(o))},i=()=>{this.chinaBoundaryLayer&&this.layerGroup.removeLayer(this.chinaBoundaryLayer),this.chinaHkmBoundaryLayer&&this.layerGroup.removeLayer(this.chinaHkmBoundaryLayer),this.chinaDisputeBoundaryLayer&&this.layerGroup.removeLayer(this.chinaDisputeBoundaryLayer)};t.chinaBorder?(this.chinaBoundaryLayer&&i(),n()):t.chinaBorder===!1&&i(),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)}initLayersEvent(){this.initDrillEvent(),this.initLegendEvent()}initDrillEvent(){if(this.lastOptions.drill){const{triggerUp:a="unclick",triggerDown:o="click"}=this.lastOptions.drill;this.fillAreaLayer.off(a,this.onDrillUpHander),this.fillAreaLayer.off(o,this.onDrillDownHander)}if(!this.options.drill||this.options.drill.enabled===!1)return;const{steps:t,triggerUp:r="unclick",triggerDown:n="click"}=this.options.drill,i=t.map(a=>typeof a=="string"?{level:a,granularity:j1[a]}:(a.granularity||(a.granularity=j1[a.level]),a));if(Vle(i,this.drillSteps)||(this.drillSteps=i,this.drillStacks=[]),!this.drillStacks.length){const{level:a,adcode:o,granularity:s=j1[a]}=this.options.viewLevel,l=LX(this.options);this.drillStacks=[{level:a,adcode:o,granularity:s,config:l}]}this.fillAreaLayer.on(r,this.onDrillUpHander),this.fillAreaLayer.on(n,this.onDrillDownHander)}initLegendEvent(){const t=this.options.legend;if(!t)return;const r=()=>{this.updateLegendControl(t)};this.fillAreaLayer.on("legend:color",r)}drillReset(){this.drillStacks=[]}getCurrentDrillSteps(){return this.drillStacks.map(r=>Vd(r,["level","adcode","granularity"]))}getLegendOptions(){const t=this.fillAreaLayer.getColorLegendItems();return t.length!==0?{type:"category",items:t}:{}}fetchData(t,r,n){return lu(this,void 0,void 0,function*(){const i=`${r}_${t}_${n}`,a=Dle(i);if(a)return a;const{url:o,type:s,extension:l}=$le(this.options.geoArea);let u;const c=this.options.customFetchGeoData;return c?u=yield c({url:o,level:t,adcode:r,granularity:n,extension:l}):u=yield(yield fetch(`${o}/${t}/${i}.${l}`)).json(),s==="topojson"&&(u=Hle(u)),Ple(i,u),u})}getInitDistrictData(){return lu(this,void 0,void 0,function*(){var t;const r=this.fetchData("country","100000","boundary"),n=(t=this.options.source)===null||t===void 0?void 0:t.joinBy.geoData;try{[this.chinaBoundaryData]=yield Promise.all([r,this.getDistrictData(n)])}catch(i){throw new Error(`Failed to get china boundary data，${i}`)}})}getDistrictData(t){return lu(this,void 0,void 0,function*(){const{level:r,adcode:n,granularity:i=j1[r]}=this.options.viewLevel,a=t?Promise.resolve(t):this.fetchData(r,n,i);try{this.currentDistrictData=yield a,this.options.source=Os({},this.options.source,{joinBy:{geoData:this.currentDistrictData}})}catch(o){throw new Error(`Failed to get district data，${o}`)}})}drillDown(t,r={}){const n=this.drillStacks.slice(-1)[0],{level:i,adcode:a,granularity:o}=t,s={nativeEvent:!1,from:{level:n.level,adcode:n.adcode,granularity:n.granularity},to:{level:i,adcode:a,granularity:o}};this.changeView(t,r).then(l=>{l&&(this.drillStacks.push(l),this.emit("drilldown",s))})}drillUp(t={},r){const n=this.drillStacks.length;if([0,1].includes(n))return;const a=r?this.drillStacks.findIndex(g=>g.level===r):-1,o=a!==-1,s=o?a:n-2,l=this.drillStacks[s],{config:u}=l,c=fi(l,["config"]),f=Os({},u,t),d=this.drillStacks[this.drillStacks.length-1],v={nativeEvent:!1,from:{level:d.level,adcode:d.adcode,granularity:d.granularity},to:{level:c.level,adcode:c.adcode,granularity:c.granularity}};this.changeView(c,f).then(g=>{g&&(o?this.drillStacks.splice(a+1):this.drillStacks.pop(),this.emit("drillup",v))})}changeView(t){return lu(this,arguments,void 0,function*(r,n={}){const{level:i,adcode:a,granularity:o=j1[i]}=r,s=yield this.fetchData(i,a,o);if(!s.features.length)return;const l=Os({},LX(this.options),n,{viewLevel:{level:i,adcode:a,granularity:o},source:{joinBy:{geoData:s}}});return this.update(l),{level:i,adcode:a,granularity:o,config:l}})}}Zb.DefaultOptions=Fle;Zb.GeoDataUrl=mst;Zb.GeoAreaUrl=_B;const IOe=Object.freeze(Object.defineProperty({__proto__:null,Choropleth:Zb},Symbol.toStringTag,{value:"Module"})),Yle=Os({},iv.DefaultOptions,{source:{data:[],parser:{type:"json",x:"x",y:"y"}}});function Zle(e,t){const{shape:r,color:n,size:i,style:a,state:o,animate:s}=t;r&&Ui.shape(e,r),i&&Ui.size(e,i),n&&Ui.color(e,n),a&&Ui.style(e,a),o&&Ui.state(e,o),s&&Ui.animate(e,s)}const _st={source:{data:[],parser:{type:"json",x:"x",y:"y"}},shape:"circle",size:12,color:"#5FD3A6"},qle=["shape","color","size","style","state","animate"];class cC extends ah{constructor(t){super(t),this.type=ah.LayerType.DotLayer,this.interaction=!0;const{name:r,source:n}=this.options,i=this.pickLayerConfig(this.options);this.name=r||lh(this.type),this.layer=new DC(Object.assign(Object.assign({},i),{name:this.name})),this.mappingLayer(this.layer,this.options),this.setSource(n)}getDefaultOptions(){return _st}mappingLayer(t,r){Zle(t,r)}update(t){super.update(t),this.mappingLayer(this.layer,this.options)}getColorLegendItems(){const t=this.layer.getLegendItems("color");return Array.isArray(t)&&t.length!==0?Qk(t):[]}}cC.DefaultOptions=_st;cC.LayerOptionsKeys=ah.LayerConfigkeys.concat(qle);class Jk extends iv{constructor(){super(...arguments),this.type=iv.PlotType.Dot}getDefaultOptions(){return Jk.DefaultOptions}createLayers(t){this.dotLayer=new cC(Object.assign({source:t},Vd(this.options,cC.LayerOptionsKeys)));const r=new Vk([this.dotLayer]);return this.options.label&&(this.labelLayer=this.createLabelLayer(t,this.options.label,this.options),r.addLayer(this.labelLayer)),r}updateLayers(t){const r=Vd(t,cC.LayerOptionsKeys);this.dotLayer.update(r),this.updateLabelLayer(this.source,t.label,this.options,this.labelLayer)}getLegendOptions(){const t=this.dotLayer.getColorLegendItems();return t.length!==0?{type:"category",items:t}:{}}}Jk.DefaultOptions=Yle;var t6=Object.freeze({__proto__:null,get Base(){return ip},get Circle(){return mfe},get Ellipse(){return _fe},get Image(){return d6},get Line(){return Efe},get Marker(){return Sfe},get Path(){return p6},get Polygon(){return Dfe},get Polyline(){return Bfe},get Rect(){return Ufe},get Text(){return Hfe}}),xB=function(e,t){return xB=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])},xB(e,t)};function nn(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");xB(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var qt=function(){return qt=Object.assign||function(t){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])}return t},qt.apply(this,arguments)};function H3(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}function Kf(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ur(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,a=[],o;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)a.push(i.value)}catch(s){o={error:s}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return a}function Kle(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),i=0,t=0;t<r;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)n[i]=a[o];return n}function Gr(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,a;n<i;n++)(a||!(n in t))&&(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))}var OX=function(e){return e!==null&&typeof e!="function"&&isFinite(e.length)},Qle={}.toString,V3=function(e,t){return Qle.call(e)==="[object "+t+"]"},v_=function(e){return V3(e,"Function")},wl=function(e){return e==null},Qf=function(e){return Array.isArray?Array.isArray(e):V3(e,"Array")},hC=function(e){var t=typeof e;return e!==null&&t==="object"||t==="function"};function Aa(e,t){if(e){var r;if(Qf(e))for(var n=0,i=e.length;n<i&&(r=t(e[n],n),r!==!1);n++);else if(hC(e)){for(var a in e)if(e.hasOwnProperty(a)&&(r=t(e[a],a),r===!1))break}}}var PX=function(e){return typeof e=="object"&&e!==null},h0=function(e){if(Qf(e))return e.reduce(function(t,r){return Math.max(t,r)},e[0])},f0=function(e){if(Qf(e))return e.reduce(function(t,r){return Math.min(t,r)},e[0])},qd=function(e){return V3(e,"String")},bB=function(e){return V3(e,"Number")},Jle=1e-5;function tue(e,t,r){return r===void 0&&(r=Jle),Math.abs(e-t)<r}var xst=function(e,t){return(e%t+t)%t},eue=Math.PI/180,bst=function(e){return eue*e},rue=Object.values?function(e){return Object.values(e)}:function(e){var t=[];return Aa(e,function(r,n){v_(e)&&n==="prototype"||t.push(r)}),t},nue=function(e){return wl(e)?"":e.toString()},Est=function(e){var t=nue(e);return t.charAt(0).toUpperCase()+t.substring(1)};function iue(e){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(r){return setTimeout(r,16)};return t(e)}function aue(e){var t=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||clearTimeout;t(e)}function kP(e,t){for(var r in t)t.hasOwnProperty(r)&&r!=="constructor"&&t[r]!==void 0&&(e[r]=t[r])}function wst(e,t,r,n){return t&&kP(e,t),r&&kP(e,r),n&&kP(e,n),e}var oue=function(e,t){if(!v_(e))throw new TypeError("Expected a function");var r=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var a=t?t.apply(this,n):n[0],o=r.cache;if(o.has(a))return o.get(a);var s=e.apply(this,n);return o.set(a,s),s};return r.cache=new Map,r},jR=function(e,t){if(e===t)return!0;if(!e||!t||qd(e)||qd(t))return!1;if(OX(e)||OX(t)){if(e.length!==t.length)return!1;for(var r=!0,n=0;n<e.length&&(r=jR(e[n],t[n]),!!r);n++);return r}if(PX(e)||PX(t)){var i=Object.keys(e),a=Object.keys(t);if(i.length!==a.length)return!1;for(var r=!0,n=0;n<i.length&&(r=jR(e[i[n]],t[i[n]]),!!r);n++);return r}return!1},OA={},sue=function(e){return e=e||"g",OA[e]?OA[e]+=1:OA[e]=1,e+OA[e]},PA=function(){},DA;oue(function(e,t){t===void 0&&(t={});var r=t.fontSize,n=t.fontFamily,i=t.fontWeight,a=t.fontStyle,o=t.fontVariant;return DA||(DA=document.createElement("canvas").getContext("2d")),DA.font=[a,o,i,r+"px",n].join(" "),DA.measureText(qd(e)?e:"").width},function(e,t){return t===void 0&&(t={}),Kle([e],rue(t)).join("")});var fC=`	
\v\f\r   ᠎             　\u2028\u2029`,lue=new RegExp("([a-z])["+fC+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+fC+"]*,?["+fC+"]*)+)","ig"),uue=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+fC+"]*,?["+fC+"]*","ig"),fx=function(e){if(!e)return null;if(Qf(e))return e;var t={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},r=[];return String(e).replace(lue,function(n,i,a){var o=[],s=i.toLowerCase();if(a.replace(uue,function(l,u){u&&o.push(+u)}),s==="m"&&o.length>2&&(r.push([i].concat(o.splice(0,2))),s="l",i=i==="m"?"l":"L"),s==="o"&&o.length===1&&r.push([i,o[0]]),s==="r")r.push([i].concat(o));else for(;o.length>=t[s]&&(r.push([i].concat(o.splice(0,t[s]))),!!t[s]););return e}),r},EB=function(e,t){for(var r=[],n=0,i=e.length;i-2*!t>n;n+=2){var a=[{x:+e[n-2],y:+e[n-1]},{x:+e[n],y:+e[n+1]},{x:+e[n+2],y:+e[n+3]},{x:+e[n+4],y:+e[n+5]}];t?n?i-4===n?a[3]={x:+e[0],y:+e[1]}:i-2===n&&(a[2]={x:+e[0],y:+e[1]},a[3]={x:+e[2],y:+e[3]}):a[0]={x:+e[i-2],y:+e[i-1]}:i-4===n?a[3]=a[2]:n||(a[0]={x:+e[n],y:+e[n+1]}),r.push(["C",(-a[0].x+6*a[1].x+a[2].x)/6,(-a[0].y+6*a[1].y+a[2].y)/6,(a[1].x+6*a[2].x-a[3].x)/6,(a[1].y+6*a[2].y-a[3].y)/6,a[2].x,a[2].y])}return r},FA=function(e,t,r,n,i){var a=[];if(i===null&&n===null&&(n=r),e=+e,t=+t,r=+r,n=+n,i!==null){var o=Math.PI/180,s=e+r*Math.cos(-n*o),l=e+r*Math.cos(-i*o),u=t+r*Math.sin(-n*o),c=t+r*Math.sin(-i*o);a=[["M",s,u],["A",r,r,0,+(i-n>180),0,l,c]]}else a=[["M",e,t],["m",0,-n],["a",r,n,0,1,1,0,2*n],["a",r,n,0,1,1,0,-2*n],["z"]];return a},wB=function(e){if(e=fx(e),!e||!e.length)return[["M",0,0]];var t=[],r=0,n=0,i=0,a=0,o=0,s,l;e[0][0]==="M"&&(r=+e[0][1],n=+e[0][2],i=r,a=n,o++,t[0]=["M",r,n]);for(var u=e.length===3&&e[0][0]==="M"&&e[1][0].toUpperCase()==="R"&&e[2][0].toUpperCase()==="Z",c=void 0,f=void 0,d=o,v=e.length;d<v;d++){if(t.push(c=[]),f=e[d],s=f[0],s!==s.toUpperCase())switch(c[0]=s.toUpperCase(),c[0]){case"A":c[1]=f[1],c[2]=f[2],c[3]=f[3],c[4]=f[4],c[5]=f[5],c[6]=+f[6]+r,c[7]=+f[7]+n;break;case"V":c[1]=+f[1]+n;break;case"H":c[1]=+f[1]+r;break;case"R":l=[r,n].concat(f.slice(1));for(var g=2,x=l.length;g<x;g++)l[g]=+l[g]+r,l[++g]=+l[g]+n;t.pop(),t=t.concat(EB(l,u));break;case"O":t.pop(),l=FA(r,n,f[1],f[2]),l.push(l[0]),t=t.concat(l);break;case"U":t.pop(),t=t.concat(FA(r,n,f[1],f[2],f[3])),c=["U"].concat(t[t.length-1].slice(-2));break;case"M":i=+f[1]+r,a=+f[2]+n;break;default:for(var g=1,x=f.length;g<x;g++)c[g]=+f[g]+(g%2?r:n)}else if(s==="R")l=[r,n].concat(f.slice(1)),t.pop(),t=t.concat(EB(l,u)),c=["R"].concat(f.slice(-2));else if(s==="O")t.pop(),l=FA(r,n,f[1],f[2]),l.push(l[0]),t=t.concat(l);else if(s==="U")t.pop(),t=t.concat(FA(r,n,f[1],f[2],f[3])),c=["U"].concat(t[t.length-1].slice(-2));else for(var w=0,S=f.length;w<S;w++)c[w]=f[w];if(s=s.toUpperCase(),s!=="O")switch(c[0]){case"Z":r=+i,n=+a;break;case"H":r=c[1];break;case"V":n=c[1];break;case"M":i=c[c.length-2],a=c[c.length-1];break;default:r=c[c.length-2],n=c[c.length-1]}}return t},BA=function(e,t,r,n){return[e,t,r,n,r,n]},DX=function(e,t,r,n,i,a){var o=.3333333333333333,s=2/3;return[o*e+s*r,o*t+s*n,o*i+s*r,o*a+s*n,i,a]},Cst=function(e,t,r,n,i,a,o,s,l,u){r===n&&(r+=1);var c=Math.PI*120/180,f=Math.PI/180*(+i||0),d=[],v,g,x,w,S,M=function(Wr,In,re){var nr=Wr*Math.cos(re)-In*Math.sin(re),zr=Wr*Math.sin(re)+In*Math.cos(re);return{x:nr,y:zr}};if(u)g=u[0],x=u[1],w=u[2],S=u[3];else{v=M(e,t,-f),e=v.x,t=v.y,v=M(s,l,-f),s=v.x,l=v.y,e===s&&t===l&&(s+=1,l+=1);var R=(e-s)/2,I=(t-l)/2,P=R*R/(r*r)+I*I/(n*n);P>1&&(P=Math.sqrt(P),r=P*r,n=P*n);var k=r*r,z=n*n,G=(a===o?-1:1)*Math.sqrt(Math.abs((k*z-k*I*I-z*R*R)/(k*I*I+z*R*R)));w=G*r*I/n+(e+s)/2,S=G*-n*R/r+(t+l)/2,g=Math.asin(((t-S)/n).toFixed(9)),x=Math.asin(((l-S)/n).toFixed(9)),g=e<w?Math.PI-g:g,x=s<w?Math.PI-x:x,g<0&&(g=Math.PI*2+g),x<0&&(x=Math.PI*2+x),o&&g>x&&(g=g-Math.PI*2),!o&&x>g&&(x=x-Math.PI*2)}var J=x-g;if(Math.abs(J)>c){var Z=x,X=s,et=l;x=g+c*(o&&x>g?1:-1),s=w+r*Math.cos(x),l=S+n*Math.sin(x),d=Cst(s,l,r,n,i,0,o,X,et,[x,Z,w,S])}J=x-g;var at=Math.cos(g),wt=Math.sin(g),Tt=Math.cos(x),vt=Math.sin(x),zt=Math.tan(J/4),oe=4/3*r*zt,Qt=4/3*n*zt,ne=[e,t],de=[e+oe*wt,t-Qt*at],De=[s+oe*vt,l-Qt*Tt],Ze=[s,l];if(de[0]=2*ne[0]-de[0],de[1]=2*ne[1]-de[1],u)return[de,De,Ze].concat(d);d=[de,De,Ze].concat(d).join().split(",");for(var ke=[],Be=0,Zr=d.length;Be<Zr;Be++)ke[Be]=Be%2?M(d[Be-1],d[Be],f).y:M(d[Be],d[Be+1],f).x;return ke},CB=function(e,t){var r=wB(e),n=t&&wB(t),i={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},a={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},o=[],s=[],l="",u="",c,f=function(R,I,P){var k,z;if(!R)return["C",I.x,I.y,I.x,I.y,I.x,I.y];switch(!(R[0]in{T:1,Q:1})&&(I.qx=I.qy=null),R[0]){case"M":I.X=R[1],I.Y=R[2];break;case"A":R=["C"].concat(Cst.apply(0,[I.x,I.y].concat(R.slice(1))));break;case"S":P==="C"||P==="S"?(k=I.x*2-I.bx,z=I.y*2-I.by):(k=I.x,z=I.y),R=["C",k,z].concat(R.slice(1));break;case"T":P==="Q"||P==="T"?(I.qx=I.x*2-I.qx,I.qy=I.y*2-I.qy):(I.qx=I.x,I.qy=I.y),R=["C"].concat(DX(I.x,I.y,I.qx,I.qy,R[1],R[2]));break;case"Q":I.qx=R[1],I.qy=R[2],R=["C"].concat(DX(I.x,I.y,R[1],R[2],R[3],R[4]));break;case"L":R=["C"].concat(BA(I.x,I.y,R[1],R[2]));break;case"H":R=["C"].concat(BA(I.x,I.y,R[1],I.y));break;case"V":R=["C"].concat(BA(I.x,I.y,I.x,R[1]));break;case"Z":R=["C"].concat(BA(I.x,I.y,I.X,I.Y));break}return R},d=function(R,I){if(R[I].length>7){R[I].shift();for(var P=R[I];P.length;)o[I]="A",n&&(s[I]="A"),R.splice(I++,0,["C"].concat(P.splice(0,6)));R.splice(I,1),c=Math.max(r.length,n&&n.length||0)}},v=function(R,I,P,k,z){R&&I&&R[z][0]==="M"&&I[z][0]!=="M"&&(I.splice(z,0,["M",k.x,k.y]),P.bx=0,P.by=0,P.x=R[z][1],P.y=R[z][2],c=Math.max(r.length,n&&n.length||0))};c=Math.max(r.length,n&&n.length||0);for(var g=0;g<c;g++){r[g]&&(l=r[g][0]),l!=="C"&&(o[g]=l,g&&(u=o[g-1])),r[g]=f(r[g],i,u),o[g]!=="A"&&l==="C"&&(o[g]="C"),d(r,g),n&&(n[g]&&(l=n[g][0]),l!=="C"&&(s[g]=l,g&&(u=s[g-1])),n[g]=f(n[g],a,u),s[g]!=="A"&&l==="C"&&(s[g]="C"),d(n,g)),v(r,n,i,a,g),v(n,r,a,i,g);var x=r[g],w=n&&n[g],S=x.length,M=n&&w.length;i.x=x[S-2],i.y=x[S-1],i.bx=parseFloat(x[S-4])||i.x,i.by=parseFloat(x[S-3])||i.y,a.bx=n&&(parseFloat(w[M-4])||a.x),a.by=n&&(parseFloat(w[M-3])||a.y),a.x=n&&w[M-2],a.y=n&&w[M-1]}return n?[r,n]:r},cue=/,?([a-z]),?/gi,Sst=function(e){return e.join(",").replace(cue,"$1")},FX=function(e,t,r,n,i){var a=-3*t+9*r-9*n+3*i,o=e*a+6*t-12*r+6*n;return e*o-3*t+3*r},BX=function(e,t,r,n,i,a,o,s,l){l===null&&(l=1),l=l>1?1:l<0?0:l;for(var u=l/2,c=12,f=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],d=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],v=0,g=0;g<c;g++){var x=u*f[g]+u,w=FX(x,e,r,i,o),S=FX(x,t,n,a,s),M=w*w+S*S;v+=d[g]*Math.sqrt(M)}return u*v},hue=function(e,t,r,n,i,a,o,s){for(var l=[],u=[[],[]],c,f,d,v,g=0;g<2;++g){if(g===0?(f=6*e-12*r+6*i,c=-3*e+9*r-9*i+3*o,d=3*r-3*e):(f=6*t-12*n+6*a,c=-3*t+9*n-9*a+3*s,d=3*n-3*t),Math.abs(c)<1e-12){if(Math.abs(f)<1e-12)continue;v=-d/f,v>0&&v<1&&l.push(v);continue}var x=f*f-4*d*c,w=Math.sqrt(x);if(!(x<0)){var S=(-f+w)/(2*c);S>0&&S<1&&l.push(S);var M=(-f-w)/(2*c);M>0&&M<1&&l.push(M)}}for(var R=l.length,I=R,P;R--;)v=l[R],P=1-v,u[0][R]=P*P*P*e+3*P*P*v*r+3*P*v*v*i+v*v*v*o,u[1][R]=P*P*P*t+3*P*P*v*n+3*P*v*v*a+v*v*v*s;return u[0][I]=e,u[1][I]=t,u[0][I+1]=o,u[1][I+1]=s,u[0].length=u[1].length=I+2,{min:{x:Math.min.apply(0,u[0]),y:Math.min.apply(0,u[1])},max:{x:Math.max.apply(0,u[0]),y:Math.max.apply(0,u[1])}}},fue=function(e,t,r,n,i,a,o,s){if(!(Math.max(e,r)<Math.min(i,o)||Math.min(e,r)>Math.max(i,o)||Math.max(t,n)<Math.min(a,s)||Math.min(t,n)>Math.max(a,s))){var l=(e*n-t*r)*(i-o)-(e-r)*(i*s-a*o),u=(e*n-t*r)*(a-s)-(t-n)*(i*s-a*o),c=(e-r)*(a-s)-(t-n)*(i-o);if(c){var f=l/c,d=u/c,v=+f.toFixed(2),g=+d.toFixed(2);if(!(v<+Math.min(e,r).toFixed(2)||v>+Math.max(e,r).toFixed(2)||v<+Math.min(i,o).toFixed(2)||v>+Math.max(i,o).toFixed(2)||g<+Math.min(t,n).toFixed(2)||g>+Math.max(t,n).toFixed(2)||g<+Math.min(a,s).toFixed(2)||g>+Math.max(a,s).toFixed(2)))return{x:f,y:d}}}},Cm=function(e,t,r){return t>=e.x&&t<=e.x+e.width&&r>=e.y&&r<=e.y+e.height},Tst=function(e,t,r,n,i){if(i)return[["M",+e+ +i,t],["l",r-i*2,0],["a",i,i,0,0,1,i,i],["l",0,n-i*2],["a",i,i,0,0,1,-i,i],["l",i*2-r,0],["a",i,i,0,0,1,-i,-i],["l",0,i*2-n],["a",i,i,0,0,1,i,-i],["z"]];var a=[["M",e,t],["l",r,0],["l",0,n],["l",-r,0],["z"]];return a.parsePathArray=Sst,a},SB=function(e,t,r,n){return e===null&&(e=t=r=n=0),t===null&&(t=e.y,r=e.width,n=e.height,e=e.x),{x:e,y:t,width:r,w:r,height:n,h:n,x2:e+r,y2:t+n,cx:e+r/2,cy:t+n/2,r1:Math.min(r,n)/2,r2:Math.max(r,n)/2,r0:Math.sqrt(r*r+n*n)/2,path:Tst(e,t,r,n),vb:[e,t,r,n].join(" ")}},due=function(e,t){return e=SB(e),t=SB(t),Cm(t,e.x,e.y)||Cm(t,e.x2,e.y)||Cm(t,e.x,e.y2)||Cm(t,e.x2,e.y2)||Cm(e,t.x,t.y)||Cm(e,t.x2,t.y)||Cm(e,t.x,t.y2)||Cm(e,t.x2,t.y2)||(e.x<t.x2&&e.x>t.x||t.x<e.x2&&t.x>e.x)&&(e.y<t.y2&&e.y>t.y||t.y<e.y2&&t.y>e.y)},NX=function(e,t,r,n,i,a,o,s){Qf(e)||(e=[e,t,r,n,i,a,o,s]);var l=hue.apply(null,e);return SB(l.min.x,l.min.y,l.max.x-l.min.x,l.max.y-l.min.y)},kX=function(e,t,r,n,i,a,o,s,l){var u=1-l,c=Math.pow(u,3),f=Math.pow(u,2),d=l*l,v=d*l,g=c*e+f*3*l*r+u*3*l*l*i+v*o,x=c*t+f*3*l*n+u*3*l*l*a+v*s,w=e+2*l*(r-e)+d*(i-2*r+e),S=t+2*l*(n-t)+d*(a-2*n+t),M=r+2*l*(i-r)+d*(o-2*i+r),R=n+2*l*(a-n)+d*(s-2*a+n),I=u*e+l*r,P=u*t+l*n,k=u*i+l*o,z=u*a+l*s,G=90-Math.atan2(w-M,S-R)*180/Math.PI;return{x:g,y:x,m:{x:w,y:S},n:{x:M,y:R},start:{x:I,y:P},end:{x:k,y:z},alpha:G}},pue=function(e,t,r){var n=NX(e),i=NX(t);if(!due(n,i))return r?0:[];for(var a=BX.apply(0,e),o=BX.apply(0,t),s=~~(a/8),l=~~(o/8),u=[],c=[],f={},d=r?0:[],v=0;v<s+1;v++){var g=kX.apply(0,e.concat(v/s));u.push({x:g.x,y:g.y,t:v/s})}for(var v=0;v<l+1;v++){var g=kX.apply(0,t.concat(v/l));c.push({x:g.x,y:g.y,t:v/l})}for(var v=0;v<s;v++)for(var x=0;x<l;x++){var w=u[v],S=u[v+1],M=c[x],R=c[x+1],I=Math.abs(S.x-w.x)<.001?"y":"x",P=Math.abs(R.x-M.x)<.001?"y":"x",k=fue(w.x,w.y,S.x,S.y,M.x,M.y,R.x,R.y);if(k){if(f[k.x.toFixed(4)]===k.y.toFixed(4))continue;f[k.x.toFixed(4)]=k.y.toFixed(4);var z=w.t+Math.abs((k[I]-w[I])/(S[I]-w[I]))*(S.t-w.t),G=M.t+Math.abs((k[P]-M[P])/(R[P]-M[P]))*(R.t-M.t);z>=0&&z<=1&&G>=0&&G<=1&&(r?d+=1:d.push({x:k.x,y:k.y,t1:z,t2:G}))}}return d},vue=function(e,t,r){e=CB(e),t=CB(t);for(var n,i,a,o,s,l,u,c,f,d,v=r?0:[],g=0,x=e.length;g<x;g++){var w=e[g];if(w[0]==="M")n=s=w[1],i=l=w[2];else{w[0]==="C"?(f=[n,i].concat(w.slice(1)),n=f[6],i=f[7]):(f=[n,i,n,i,s,l,s,l],n=s,i=l);for(var S=0,M=t.length;S<M;S++){var R=t[S];if(R[0]==="M")a=u=R[1],o=c=R[2];else{R[0]==="C"?(d=[a,o].concat(R.slice(1)),a=d[6],o=d[7]):(d=[a,o,a,o,u,c,u,c],a=u,o=c);var I=pue(f,d,r);if(r)v+=I;else{for(var P=0,k=I.length;P<k;P++)I[P].segment1=g,I[P].segment2=S,I[P].bez1=f,I[P].bez2=d;v=v.concat(I)}}}}}return v},gue=function(e,t){return vue(e,t)};function mue(e,t){var r=[],n=[];function i(a,o){if(a.length===1)r.push(a[0]),n.push(a[0]);else{for(var s=[],l=0;l<a.length-1;l++)l===0&&r.push(a[0]),l===a.length-2&&n.push(a[l+1]),s[l]=[(1-o)*a[l][0]+o*a[l+1][0],(1-o)*a[l][1]+o*a[l+1][1]];i(s,o)}}return e.length&&i(e,t),{left:r,right:n.reverse()}}function yue(e,t,r){var n=[[e[1],e[2]]];r=r||2;var i=[];t[0]==="A"?(n.push(t[6]),n.push(t[7])):t[0]==="C"?(n.push([t[1],t[2]]),n.push([t[3],t[4]]),n.push([t[5],t[6]])):t[0]==="S"||t[0]==="Q"?(n.push([t[1],t[2]]),n.push([t[3],t[4]])):n.push([t[1],t[2]]);for(var a=n,o=1/r,s=0;s<r-1;s++){var l=o/(1-o*s),u=mue(a,l);i.push(u.left),a=u.right}i.push(a);var c=i.map(function(f){var d=[];return f.length===4&&(d.push("C"),d=d.concat(f[2])),f.length>=3&&(f.length===3&&d.push("Q"),d=d.concat(f[1])),f.length===2&&d.push("L"),d=d.concat(f[f.length-1]),d});return c}var _ue=function(e,t,r){if(r===1)return[[].concat(e)];var n=[];if(t[0]==="L"||t[0]==="C"||t[0]==="Q")n=n.concat(yue(e,t,r));else{var i=[].concat(e);i[0]==="M"&&(i[0]="L");for(var a=0;a<=r-1;a++)n.push(i)}return n},xue=function(e,t){if(e.length===1)return e;var r=e.length-1,n=t.length-1,i=r/n,a=[];if(e.length===1&&e[0][0]==="M"){for(var o=0;o<n-r;o++)e.push(e[0]);return e}for(var o=0;o<n;o++){var s=Math.floor(i*o);a[s]=(a[s]||0)+1}var l=a.reduce(function(u,c,f){return f===r?u.concat(e[r]):u.concat(_ue(e[f],e[f+1],c))},[]);return l.unshift(e[0]),(t[n]==="Z"||t[n]==="z")&&l.push("Z"),l},bue=function(e,t){if(e.length!==t.length)return!1;var r=!0;return Aa(e,function(n,i){if(n!==t[i])return r=!1,!1}),r};function Eue(e,t,r){var n=null,i=r;return t<i&&(i=t,n="add"),e<i&&(i=e,n="del"),{type:n,min:i}}var wue=function(e,t){var r=e.length,n=t.length,i,a,o=0;if(r===0||n===0)return null;for(var s=[],l=0;l<=r;l++)s[l]=[],s[l][0]={min:l};for(var u=0;u<=n;u++)s[0][u]={min:u};for(var l=1;l<=r;l++){i=e[l-1];for(var u=1;u<=n;u++){a=t[u-1],bue(i,a)?o=0:o=1;var c=s[l-1][u].min+1,f=s[l][u-1].min+1,d=s[l-1][u-1].min+o;s[l][u]=Eue(c,f,d)}}return s},Ast=function(e,t){var r=wue(e,t),n=e.length,i=t.length,a=[],o=1,s=1;if(r[n][i].min!==n){for(var l=1;l<=n;l++){var u=r[l][l].min;s=l;for(var c=o;c<=i;c++)r[l][c].min<u&&(u=r[l][c].min,s=c);o=s,r[l][o].type&&a.push({index:l-1,type:r[l][o].type})}for(var l=a.length-1;l>=0;l--)o=a[l].index,a[l].type==="add"?e.splice(o,0,[].concat(e[o])):e.splice(o,1)}n=e.length;var f=i-n;if(n<i)for(var l=0;l<f;l++)e[n-1][0]==="z"||e[n-1][0]==="Z"?e.splice(n-2,0,e[n-2]):e.push(e[n-1]),n+=1;return e};function zP(e,t,r){for(var n=[].concat(e),i,a=1/(r+1),o=Mst(t)[0],s=1;s<=r;s++)a*=s,i=Math.floor(e.length*a),i===0?n.unshift([o[0]*a+e[i][0]*(1-a),o[1]*a+e[i][1]*(1-a)]):n.splice(i,0,[o[0]*a+e[i][0]*(1-a),o[1]*a+e[i][1]*(1-a)]);return n}function Mst(e){var t=[];switch(e[0]){case"M":t.push([e[1],e[2]]);break;case"L":t.push([e[1],e[2]]);break;case"A":t.push([e[6],e[7]]);break;case"Q":t.push([e[3],e[4]]),t.push([e[1],e[2]]);break;case"T":t.push([e[1],e[2]]);break;case"C":t.push([e[5],e[6]]),t.push([e[1],e[2]]),t.push([e[3],e[4]]);break;case"S":t.push([e[3],e[4]]),t.push([e[1],e[2]]);break;case"H":t.push([e[1],e[1]]);break;case"V":t.push([e[1],e[1]]);break}return t}var TB=function(e,t){if(e.length<=1)return e;for(var r,n=0;n<t.length;n++)if(e[n][0]!==t[n][0])switch(r=Mst(e[n]),t[n][0]){case"M":e[n]=["M"].concat(r[0]);break;case"L":e[n]=["L"].concat(r[0]);break;case"A":e[n]=[].concat(t[n]),e[n][6]=r[0][0],e[n][7]=r[0][1];break;case"Q":if(r.length<2)if(n>0)r=zP(r,e[n-1],1);else{e[n]=t[n];break}e[n]=["Q"].concat(r.reduce(function(i,a){return i.concat(a)},[]));break;case"T":e[n]=["T"].concat(r[0]);break;case"C":if(r.length<3)if(n>0)r=zP(r,e[n-1],2);else{e[n]=t[n];break}e[n]=["C"].concat(r.reduce(function(i,a){return i.concat(a)},[]));break;case"S":if(r.length<2)if(n>0)r=zP(r,e[n-1],1);else{e[n]=t[n];break}e[n]=["S"].concat(r.reduce(function(i,a){return i.concat(a)},[]));break;default:e[n]=t[n]}return e},Cue=Object.freeze({__proto__:null,catmullRomToBezier:EB,fillPath:xue,fillPathByDiff:Ast,formatPath:TB,intersection:gue,parsePathArray:Sst,parsePathString:fx,pathToAbsolute:wB,pathToCurve:CB,rectPath:Tst}),Sue=function(){function e(t,r){this.bubbles=!0,this.target=null,this.currentTarget=null,this.delegateTarget=null,this.delegateObject=null,this.defaultPrevented=!1,this.propagationStopped=!1,this.shape=null,this.fromShape=null,this.toShape=null,this.propagationPath=[],this.type=t,this.name=t,this.originalEvent=r,this.timeStamp=r.timeStamp}return e.prototype.preventDefault=function(){this.defaultPrevented=!0,this.originalEvent.preventDefault&&this.originalEvent.preventDefault()},e.prototype.stopPropagation=function(){this.propagationStopped=!0},e.prototype.toString=function(){var t=this.type;return"[Event (type="+t+")]"},e.prototype.save=function(){},e.prototype.restore=function(){},e}(),Tue="*",G3=function(){function e(){this._events={}}return e.prototype.on=function(t,r,n){return this._events[t]||(this._events[t]=[]),this._events[t].push({callback:r,once:!!n}),this},e.prototype.once=function(t,r){return this.on(t,r,!0)},e.prototype.emit=function(t){for(var r=this,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var a=this._events[t]||[],o=this._events[Tue]||[],s=function(l){for(var u=l.length,c=0;c<u;c++)if(l[c]){var f=l[c],d=f.callback,v=f.once;v&&(l.splice(c,1),l.length===0&&delete r._events[t],u--,c--),d.apply(r,n)}};s(a),s(o)},e.prototype.off=function(t,r){if(!t)this._events={};else if(!r)delete this._events[t];else{for(var n=this._events[t]||[],i=n.length,a=0;a<i;a++)n[a].callback===r&&(n.splice(a,1),i--,a--);n.length===0&&delete this._events[t]}return this},e.prototype.getEvents=function(){return this._events},e}();function Rst(e,t){var r=e.indexOf(t);r!==-1&&e.splice(r,1)}var zX=typeof window<"u"&&typeof window.document<"u";function Ist(e,t){if(e.isCanvas())return!0;for(var r=t.getParent(),n=!1;r;){if(r===e){n=!0;break}r=r.getParent()}return n}function AB(e){return e.cfg.visible&&e.cfg.capture}var Aue=function(e){nn(t,e);function t(r){var n=e.call(this)||this;n.destroyed=!1;var i=n.getDefaultCfg();return n.cfg=wst(i,r),n}return t.prototype.getDefaultCfg=function(){return{}},t.prototype.get=function(r){return this.cfg[r]},t.prototype.set=function(r,n){this.cfg[r]=n},t.prototype.destroy=function(){this.cfg={destroyed:!0},this.off(),this.destroyed=!0},t}(G3),UX=function(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,a;n<i;n++)(a||!(n in t))&&(a||(a=Array.prototype.slice.call(t,0,n)),a[n]=t[n]);return e.concat(a||Array.prototype.slice.call(t))},Mue=function(){function e(t,r,n){this.name=t,this.version=r,this.os=n,this.type="browser"}return e}(),Rue=function(){function e(t){this.version=t,this.type="node",this.name="node",this.os=process.platform}return e}(),Iue=function(){function e(t,r,n,i){this.name=t,this.version=r,this.os=n,this.bot=i,this.type="bot-device"}return e}(),Lue=function(){function e(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return e}(),Oue=function(){function e(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return e}(),Pue=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Due=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,$X=3,Fue=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Pue]],HX=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Bue(e){return e?VX(e):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new Oue:typeof navigator<"u"?VX(navigator.userAgent):zue()}function Nue(e){return e!==""&&Fue.reduce(function(t,r){var n=r[0],i=r[1];if(t)return t;var a=i.exec(e);return!!a&&[n,a]},!1)}function VX(e){var t=Nue(e);if(!t)return null;var r=t[0],n=t[1];if(r==="searchbot")return new Lue;var i=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);i?i.length<$X&&(i=UX(UX([],i,!0),Uue($X-i.length),!0)):i=[];var a=i.join("."),o=kue(e),s=Due.exec(e);return s&&s[1]?new Iue(r,a,o,s[1]):new Mue(r,a,o)}function kue(e){for(var t=0,r=HX.length;t<r;t++){var n=HX[t],i=n[0],a=n[1],o=a.exec(e);if(o)return i}return null}function zue(){var e=typeof process<"u"&&process.version;return e?new Rue(process.version.slice(1)):null}function Uue(e){for(var t=[],r=0;r<e;r++)t.push("0");return t}var YR=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function W3(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],f=t[8],d=r[0],v=r[1],g=r[2],x=r[3],w=r[4],S=r[5],M=r[6],R=r[7],I=r[8];return e[0]=d*n+v*o+g*u,e[1]=d*i+v*s+g*c,e[2]=d*a+v*l+g*f,e[3]=x*n+w*o+S*u,e[4]=x*i+w*s+S*c,e[5]=x*a+w*l+S*f,e[6]=M*n+R*o+I*u,e[7]=M*i+R*s+I*c,e[8]=M*a+R*l+I*f,e}function $ue(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function Hue(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=-r,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Vue(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Gue(){var e=new YR(3);return YR!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Wue(e,t,r){var n=t[0],i=t[1],a=t[2];return e[0]=n*r[0]+i*r[3]+a*r[6],e[1]=n*r[1]+i*r[4]+a*r[7],e[2]=n*r[2]+i*r[5]+a*r[8],e}(function(){var e=Gue();return function(t,r,n,i,a,o){var s,l;for(r||(r=3),n||(n=0),i?l=Math.min(i*r+n,t.length):l=t.length,s=n;s<l;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}})();function Xue(){var e=new YR(2);return YR!=Float32Array&&(e[0]=0,e[1]=0),e}function jue(e,t){var r=t[0],n=t[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e}function Yue(e,t){return e[0]*t[0]+e[1]*t[1]}function Zue(e,t){return e[0]===t[0]&&e[1]===t[1]}(function(){var e=Xue();return function(t,r,n,i,a,o){var s,l;for(r||(r=2),n||(n=0),i?l=Math.min(i*r+n,t.length):l=t.length,s=n;s<l;s+=r)e[0]=t[s],e[1]=t[s+1],a(e,e,o),t[s]=e[0],t[s+1]=e[1];return t}})();function que(e,t,r){var n=[0,0,0,0,0,0,0,0,0];return $ue(n,r),W3(e,n,t)}function Kue(e,t,r){var n=[0,0,0,0,0,0,0,0,0];return Hue(n,r),W3(e,n,t)}function Que(e,t,r){var n=[0,0,0,0,0,0,0,0,0];return Vue(n,r),W3(e,n,t)}function Jue(e,t,r){return W3(e,r,t)}function Lst(e,t){for(var r=e?[].concat(e):[1,0,0,0,1,0,0,0,1],n=0,i=t.length;n<i;n++){var a=t[n];switch(a[0]){case"t":que(r,r,[a[1],a[2]]);break;case"s":Que(r,r,[a[1],a[2]]);break;case"r":Kue(r,r,a[1]);break;case"m":Jue(r,r,a[1]);break}}return r}function GX(e,t){var r=[],n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],l=e[5],u=e[6],c=e[7],f=e[8],d=t[0],v=t[1],g=t[2],x=t[3],w=t[4],S=t[5],M=t[6],R=t[7],I=t[8];return r[0]=d*n+v*o+g*u,r[1]=d*i+v*s+g*c,r[2]=d*a+v*l+g*f,r[3]=x*n+w*o+S*u,r[4]=x*i+w*s+S*c,r[5]=x*a+w*l+S*f,r[6]=M*n+R*o+I*u,r[7]=M*i+R*s+I*c,r[8]=M*a+R*l+I*f,r}function Fy(e,t){var r=[],n=t[0],i=t[1];return r[0]=e[0]*n+e[3]*i+e[6],r[1]=e[1]*n+e[4]*i+e[7],r}function Ost(e){var t=[],r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],l=e[6],u=e[7],c=e[8],f=c*o-s*u,d=-c*a+s*l,v=u*a-o*l,g=r*f+n*d+i*v;return g?(g=1/g,t[0]=f*g,t[1]=(-c*n+i*u)*g,t[2]=(s*n-i*o)*g,t[3]=d*g,t[4]=(c*r-i*l)*g,t[5]=(-s*r+i*a)*g,t[6]=v*g,t[7]=(-u*r+n*l)*g,t[8]=(o*r-n*a)*g,t):null}var mw=Lst,UP="matrix",tce=["zIndex","capture","visible","type"],ece=["repeat"],rce=":",nce="*";function ice(e){for(var t=[],r=0;r<e.length;r++)Qf(e[r])?t.push([].concat(e[r])):t.push(e[r]);return t}function ace(e,t){var r={},n=t.attrs;for(var i in e)r[i]=n[i];return r}function oce(e,t){var r={},n=t.attr();return Aa(e,function(i,a){ece.indexOf(a)===-1&&!jR(n[a],i)&&(r[a]=i)}),r}function sce(e,t){if(t.onFrame)return e;var r=t.startTime,n=t.delay,i=t.duration,a=Object.prototype.hasOwnProperty;return Aa(e,function(o){r+n<o.startTime+o.delay+o.duration&&i>o.delay&&Aa(t.toAttrs,function(s,l){a.call(o.toAttrs,l)&&(delete o.toAttrs[l],delete o.fromAttrs[l])})}),e}var Pst=function(e){nn(t,e);function t(r){var n=e.call(this,r)||this;n.attrs={};var i=n.getDefaultAttrs();return wst(i,r.attrs),n.attrs=i,n.initAttrs(i),n.initAnimate(),n}return t.prototype.getDefaultCfg=function(){return{visible:!0,capture:!0,zIndex:0}},t.prototype.getDefaultAttrs=function(){return{matrix:this.getDefaultMatrix(),opacity:1}},t.prototype.onCanvasChange=function(r){},t.prototype.initAttrs=function(r){},t.prototype.initAnimate=function(){this.set("animable",!0),this.set("animating",!1)},t.prototype.isGroup=function(){return!1},t.prototype.getParent=function(){return this.get("parent")},t.prototype.getCanvas=function(){return this.get("canvas")},t.prototype.attr=function(){for(var r,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var a=n[0],o=n[1];if(!a)return this.attrs;if(hC(a)){for(var s in a)this.setAttr(s,a[s]);return this.afterAttrsChange(a),this}return n.length===2?(this.setAttr(a,o),this.afterAttrsChange((r={},r[a]=o,r)),this):this.attrs[a]},t.prototype.isClipped=function(r,n){var i=this.getClip();return i&&!i.isHit(r,n)},t.prototype.setAttr=function(r,n){var i=this.attrs[r];i!==n&&(this.attrs[r]=n,this.onAttrChange(r,n,i))},t.prototype.onAttrChange=function(r,n,i){r==="matrix"&&this.set("totalMatrix",null)},t.prototype.afterAttrsChange=function(r){if(this.cfg.isClipShape){var n=this.cfg.applyTo;n&&n.onCanvasChange("clip")}else this.onCanvasChange("attr")},t.prototype.show=function(){return this.set("visible",!0),this.onCanvasChange("show"),this},t.prototype.hide=function(){return this.set("visible",!1),this.onCanvasChange("hide"),this},t.prototype.setZIndex=function(r){this.set("zIndex",r);var n=this.getParent();return n&&n.sort(),this},t.prototype.toFront=function(){var r=this.getParent();if(r){var n=r.getChildren();this.get("el");var i=n.indexOf(this);n.splice(i,1),n.push(this),this.onCanvasChange("zIndex")}},t.prototype.toBack=function(){var r=this.getParent();if(r){var n=r.getChildren();this.get("el");var i=n.indexOf(this);n.splice(i,1),n.unshift(this),this.onCanvasChange("zIndex")}},t.prototype.remove=function(r){r===void 0&&(r=!0);var n=this.getParent();n?(Rst(n.getChildren(),this),n.get("clearing")||this.onCanvasChange("remove")):this.onCanvasChange("remove"),r&&this.destroy()},t.prototype.resetMatrix=function(){this.attr(UP,this.getDefaultMatrix()),this.onCanvasChange("matrix")},t.prototype.getMatrix=function(){return this.attr(UP)},t.prototype.setMatrix=function(r){this.attr(UP,r),this.onCanvasChange("matrix")},t.prototype.getTotalMatrix=function(){var r=this.cfg.totalMatrix;if(!r){var n=this.attr("matrix"),i=this.cfg.parentMatrix;i&&n?r=GX(i,n):r=n||i,this.set("totalMatrix",r)}return r},t.prototype.applyMatrix=function(r){var n=this.attr("matrix"),i=null;r&&n?i=GX(r,n):i=n||r,this.set("totalMatrix",i),this.set("parentMatrix",r)},t.prototype.getDefaultMatrix=function(){return null},t.prototype.applyToMatrix=function(r){var n=this.attr("matrix");return n?Fy(n,r):r},t.prototype.invertFromMatrix=function(r){var n=this.attr("matrix");if(n){var i=Ost(n);if(i)return Fy(i,r)}return r},t.prototype.setClip=function(r){var n=this.getCanvas(),i=null;if(r){var a=this.getShapeBase(),o=Est(r.type),s=a[o];s&&(i=new s({type:r.type,isClipShape:!0,applyTo:this,attrs:r.attrs,canvas:n}))}return this.set("clipShape",i),this.onCanvasChange("clip"),i},t.prototype.getClip=function(){var r=this.cfg.clipShape;return r||null},t.prototype.clone=function(){var r=this,n=this.attrs,i={};Aa(n,function(s,l){Qf(n[l])?i[l]=ice(n[l]):i[l]=n[l]});var a=this.constructor,o=new a({attrs:i});return Aa(tce,function(s){o.set(s,r.get(s))}),o},t.prototype.destroy=function(){var r=this.destroyed;r||(this.attrs={},e.prototype.destroy.call(this))},t.prototype.isAnimatePaused=function(){return this.get("_pause").isPaused},t.prototype.animate=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];if(!(!this.get("timeline")&&!this.get("canvas"))){this.set("animating",!0);var i=this.get("timeline");i||(i=this.get("canvas").get("timeline"),this.set("timeline",i));var a=this.get("animations")||[];i.timer||i.initTimer();var o=r[0],s=r[1],l=r[2],u=l===void 0?"easeLinear":l,c=r[3],f=c===void 0?PA:c,d=r[4],v=d===void 0?0:d,g,x,w,S,M;v_(o)?(g=o,o={}):hC(o)&&o.onFrame&&(g=o.onFrame,x=o.repeat),hC(s)?(M=s,s=M.duration,u=M.easing||"easeLinear",v=M.delay||0,x=M.repeat||x||!1,f=M.callback||PA,w=M.pauseCallback||PA,S=M.resumeCallback||PA):(bB(f)&&(v=f,f=null),v_(u)?(f=u,u="easeLinear"):u=u||"easeLinear");var R=oce(o,this),I={fromAttrs:ace(R,this),toAttrs:R,duration:s,easing:u,repeat:x,callback:f,pauseCallback:w,resumeCallback:S,delay:v,startTime:i.getTime(),id:sue(),onFrame:g,pathFormatted:!1};a.length>0?a=sce(a,I):i.addAnimator(this),a.push(I),this.set("animations",a),this.set("_pause",{isPaused:!1})}},t.prototype.stopAnimate=function(r){var n=this;r===void 0&&(r=!0);var i=this.get("animations");Aa(i,function(a){r&&(a.onFrame?n.attr(a.onFrame(1)):n.attr(a.toAttrs)),a.callback&&a.callback()}),this.set("animating",!1),this.set("animations",[])},t.prototype.pauseAnimate=function(){var r=this.get("timeline"),n=this.get("animations"),i=r.getTime();return Aa(n,function(a){a._paused=!0,a._pauseTime=i,a.pauseCallback&&a.pauseCallback()}),this.set("_pause",{isPaused:!0,pauseTime:i}),this},t.prototype.resumeAnimate=function(){var r=this.get("timeline"),n=r.getTime(),i=this.get("animations"),a=this.get("_pause").pauseTime;return Aa(i,function(o){o.startTime=o.startTime+(n-a),o._paused=!1,o._pauseTime=null,o.resumeCallback&&o.resumeCallback()}),this.set("_pause",{isPaused:!1}),this.set("animations",i),this},t.prototype.emitDelegation=function(r,n){var i=this,a=n.propagationPath;this.getEvents();var o;r==="mouseenter"?o=n.fromShape:r==="mouseleave"&&(o=n.toShape);for(var s=function(f){var d=a[f],v=d.get("name");if(v){if((d.isGroup()||d.isCanvas&&d.isCanvas())&&o&&Ist(d,o))return"break";Qf(v)?Aa(v,function(g){i.emitDelegateEvent(d,g,n)}):l.emitDelegateEvent(d,v,n)}},l=this,u=0;u<a.length;u++){var c=s(u);if(c==="break")break}},t.prototype.emitDelegateEvent=function(r,n,i){var a=this.getEvents(),o=n+rce+i.type;(a[o]||a[nce])&&(i.name=o,i.currentTarget=r,i.delegateTarget=this,i.delegateObject=r.get("delegateObject"),this.emit(o,i))},t.prototype.translate=function(r,n){r===void 0&&(r=0),n===void 0&&(n=0);var i=this.getMatrix(),a=mw(i,[["t",r,n]]);return this.setMatrix(a),this},t.prototype.move=function(r,n){var i=this.attr("x")||0,a=this.attr("y")||0;return this.translate(r-i,n-a),this},t.prototype.moveTo=function(r,n){return this.move(r,n)},t.prototype.scale=function(r,n){var i=this.getMatrix(),a=mw(i,[["s",r,n||r]]);return this.setMatrix(a),this},t.prototype.rotate=function(r){var n=this.getMatrix(),i=mw(n,[["r",r]]);return this.setMatrix(i),this},t.prototype.rotateAtStart=function(r){var n=this.attr(),i=n.x,a=n.y,o=this.getMatrix(),s=mw(o,[["t",-i,-a],["r",r],["t",i,a]]);return this.setMatrix(s),this},t.prototype.rotateAtPoint=function(r,n,i){var a=this.getMatrix(),o=mw(a,[["t",-r,-n],["r",i],["t",r,n]]);return this.setMatrix(o),this},t}(Aue),WX={},MB="_INDEX";function Dst(e,t){if(e.set("canvas",t),e.isGroup()){var r=e.get("children");r.length&&r.forEach(function(n){Dst(n,t)})}}function Fst(e,t){if(e.set("timeline",t),e.isGroup()){var r=e.get("children");r.length&&r.forEach(function(n){Fst(n,t)})}}function lce(e,t,r){r===void 0&&(r=!0),r?t.destroy():(t.set("parent",null),t.set("canvas",null)),Rst(e.getChildren(),t)}function uce(e){return function(t,r){var n=e(t,r);return n===0?t[MB]-r[MB]:n}}var Bst=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.isCanvas=function(){return!1},t.prototype.getBBox=function(){var r=1/0,n=-1/0,i=1/0,a=-1/0,o=this.getChildren().filter(function(l){return l.get("visible")&&(!l.isGroup()||l.isGroup()&&l.getChildren().length>0)});o.length>0?Aa(o,function(l){var u=l.getBBox(),c=u.minX,f=u.maxX,d=u.minY,v=u.maxY;c<r&&(r=c),f>n&&(n=f),d<i&&(i=d),v>a&&(a=v)}):(r=0,n=0,i=0,a=0);var s={x:r,y:i,minX:r,minY:i,maxX:n,maxY:a,width:n-r,height:a-i};return s},t.prototype.getCanvasBBox=function(){var r=1/0,n=-1/0,i=1/0,a=-1/0,o=this.getChildren().filter(function(l){return l.get("visible")&&(!l.isGroup()||l.isGroup()&&l.getChildren().length>0)});o.length>0?Aa(o,function(l){var u=l.getCanvasBBox(),c=u.minX,f=u.maxX,d=u.minY,v=u.maxY;c<r&&(r=c),f>n&&(n=f),d<i&&(i=d),v>a&&(a=v)}):(r=0,n=0,i=0,a=0);var s={x:r,y:i,minX:r,minY:i,maxX:n,maxY:a,width:n-r,height:a-i};return s},t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return r.children=[],r},t.prototype.onAttrChange=function(r,n,i){if(e.prototype.onAttrChange.call(this,r,n,i),r==="matrix"){var a=this.getTotalMatrix();this._applyChildrenMarix(a)}},t.prototype.applyMatrix=function(r){var n=this.getTotalMatrix();e.prototype.applyMatrix.call(this,r);var i=this.getTotalMatrix();i!==n&&this._applyChildrenMarix(i)},t.prototype._applyChildrenMarix=function(r){var n=this.getChildren();Aa(n,function(i){i.applyMatrix(r)})},t.prototype.addShape=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=r[0],a=r[1];hC(i)?a=i:a.type=i;var o=WX[a.type];o||(o=Est(a.type),WX[a.type]=o);var s=this.getShapeBase(),l=new s[o](a);return this.add(l),l},t.prototype.addGroup=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=r[0],a=r[1],o;if(v_(i))a?o=new i(a):o=new i({parent:this});else{var s=i||{},l=this.getGroupBase();o=new l(s)}return this.add(o),o},t.prototype.getCanvas=function(){var r;return this.isCanvas()?r=this:r=this.get("canvas"),r},t.prototype.getShape=function(r,n,i){if(!AB(this))return null;var a=this.getChildren(),o;if(this.isCanvas())o=this._findShape(a,r,n,i);else{var s=[r,n,1];s=this.invertFromMatrix(s),this.isClipped(s[0],s[1])||(o=this._findShape(a,s[0],s[1],i))}return o},t.prototype._findShape=function(r,n,i,a){for(var o=null,s=r.length-1;s>=0;s--){var l=r[s];if(AB(l)&&(l.isGroup()?o=l.getShape(n,i,a):l.isHit(n,i)&&(o=l)),o)break}return o},t.prototype.add=function(r){var n=this.getCanvas(),i=this.getChildren(),a=this.get("timeline"),o=r.getParent();o&&lce(o,r,!1),r.set("parent",this),n&&Dst(r,n),a&&Fst(r,a),i.push(r),r.onCanvasChange("add"),this._applyElementMatrix(r)},t.prototype._applyElementMatrix=function(r){var n=this.getTotalMatrix();n&&r.applyMatrix(n)},t.prototype.getChildren=function(){return this.get("children")},t.prototype.sort=function(){var r=this.getChildren();Aa(r,function(n,i){return n[MB]=i,n}),r.sort(uce(function(n,i){return n.get("zIndex")-i.get("zIndex")})),this.onCanvasChange("sort")},t.prototype.clear=function(){if(this.set("clearing",!0),!this.destroyed){for(var r=this.getChildren(),n=r.length-1;n>=0;n--)r[n].destroy();this.set("children",[]),this.onCanvasChange("clear"),this.set("clearing",!1)}},t.prototype.destroy=function(){this.get("destroyed")||(this.clear(),e.prototype.destroy.call(this))},t.prototype.getFirst=function(){return this.getChildByIndex(0)},t.prototype.getLast=function(){var r=this.getChildren();return this.getChildByIndex(r.length-1)},t.prototype.getChildByIndex=function(r){var n=this.getChildren();return n[r]},t.prototype.getCount=function(){var r=this.getChildren();return r.length},t.prototype.contain=function(r){var n=this.getChildren();return n.indexOf(r)>-1},t.prototype.removeChild=function(r,n){n===void 0&&(n=!0),this.contain(r)&&r.remove(n)},t.prototype.findAll=function(r){var n=[],i=this.getChildren();return Aa(i,function(a){r(a)&&n.push(a),a.isGroup()&&(n=n.concat(a.findAll(r)))}),n},t.prototype.find=function(r){var n=null,i=this.getChildren();return Aa(i,function(a){if(r(a)?n=a:a.isGroup()&&(n=a.find(r)),n)return!1}),n},t.prototype.findById=function(r){return this.find(function(n){return n.get("id")===r})},t.prototype.findByClassName=function(r){return this.find(function(n){return n.get("className")===r})},t.prototype.findAllByName=function(r){return this.findAll(function(n){return n.get("name")===r})},t}(Pst),vb=0,Vw=0,yw=0,Nst=1e3,ZR,Gw,qR=0,g_=0,X3=0,iS=typeof performance=="object"&&performance.now?performance:Date,kst=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function zst(){return g_||(kst(cce),g_=iS.now()+X3)}function cce(){g_=0}function RB(){this._call=this._time=this._next=null}RB.prototype=e6.prototype={constructor:RB,restart:function(e,t,r){if(typeof e!="function")throw new TypeError("callback is not a function");r=(r==null?zst():+r)+(t==null?0:+t),!this._next&&Gw!==this&&(Gw?Gw._next=this:ZR=this,Gw=this),this._call=e,this._time=r,IB()},stop:function(){this._call&&(this._call=null,this._time=1/0,IB())}};function e6(e,t,r){var n=new RB;return n.restart(e,t,r),n}function hce(){zst(),++vb;for(var e=ZR,t;e;)(t=g_-e._time)>=0&&e._call.call(null,t),e=e._next;--vb}function XX(){g_=(qR=iS.now())+X3,vb=Vw=0;try{hce()}finally{vb=0,dce(),g_=0}}function fce(){var e=iS.now(),t=e-qR;t>Nst&&(X3-=t,qR=e)}function dce(){for(var e,t=ZR,r,n=1/0;t;)t._call?(n>t._time&&(n=t._time),e=t,t=t._next):(r=t._next,t._next=null,t=e?e._next=r:ZR=r);Gw=e,IB(n)}function IB(e){if(!vb){Vw&&(Vw=clearTimeout(Vw));var t=e-g_;t>24?(e<1/0&&(Vw=setTimeout(XX,e-iS.now()-X3)),yw&&(yw=clearInterval(yw))):(yw||(qR=iS.now(),yw=setInterval(fce,Nst)),vb=1,kst(XX))}}function r6(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function Ust(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function E2(){}var aS=.7,KR=1/aS,Px="\\s*([+-]?\\d+)\\s*",oS="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Qp="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",pce=/^#([0-9a-f]{3,8})$/,vce=new RegExp(`^rgb\\(${Px},${Px},${Px}\\)$`),gce=new RegExp(`^rgb\\(${Qp},${Qp},${Qp}\\)$`),mce=new RegExp(`^rgba\\(${Px},${Px},${Px},${oS}\\)$`),yce=new RegExp(`^rgba\\(${Qp},${Qp},${Qp},${oS}\\)$`),_ce=new RegExp(`^hsl\\(${oS},${Qp},${Qp}\\)$`),xce=new RegExp(`^hsla\\(${oS},${Qp},${Qp},${oS}\\)$`),jX={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};r6(E2,sS,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:YX,formatHex:YX,formatHex8:bce,formatHsl:Ece,formatRgb:ZX,toString:ZX});function YX(){return this.rgb().formatHex()}function bce(){return this.rgb().formatHex8()}function Ece(){return $st(this).formatHsl()}function ZX(){return this.rgb().formatRgb()}function sS(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=pce.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?qX(t):r===3?new Yc(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?NA(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?NA(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=vce.exec(e))?new Yc(t[1],t[2],t[3],1):(t=gce.exec(e))?new Yc(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=mce.exec(e))?NA(t[1],t[2],t[3],t[4]):(t=yce.exec(e))?NA(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=_ce.exec(e))?JX(t[1],t[2]/100,t[3]/100,1):(t=xce.exec(e))?JX(t[1],t[2]/100,t[3]/100,t[4]):jX.hasOwnProperty(e)?qX(jX[e]):e==="transparent"?new Yc(NaN,NaN,NaN,0):null}function qX(e){return new Yc(e>>16&255,e>>8&255,e&255,1)}function NA(e,t,r,n){return n<=0&&(e=t=r=NaN),new Yc(e,t,r,n)}function wce(e){return e instanceof E2||(e=sS(e)),e?(e=e.rgb(),new Yc(e.r,e.g,e.b,e.opacity)):new Yc}function LB(e,t,r,n){return arguments.length===1?wce(e):new Yc(e,t,r,n??1)}function Yc(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}r6(Yc,LB,Ust(E2,{brighter(e){return e=e==null?KR:Math.pow(KR,e),new Yc(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?aS:Math.pow(aS,e),new Yc(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Yc(Yy(this.r),Yy(this.g),Yy(this.b),QR(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:KX,formatHex:KX,formatHex8:Cce,formatRgb:QX,toString:QX}));function KX(){return`#${By(this.r)}${By(this.g)}${By(this.b)}`}function Cce(){return`#${By(this.r)}${By(this.g)}${By(this.b)}${By((isNaN(this.opacity)?1:this.opacity)*255)}`}function QX(){const e=QR(this.opacity);return`${e===1?"rgb(":"rgba("}${Yy(this.r)}, ${Yy(this.g)}, ${Yy(this.b)}${e===1?")":`, ${e})`}`}function QR(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Yy(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function By(e){return e=Yy(e),(e<16?"0":"")+e.toString(16)}function JX(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new Dd(e,t,r,n)}function $st(e){if(e instanceof Dd)return new Dd(e.h,e.s,e.l,e.opacity);if(e instanceof E2||(e=sS(e)),!e)return new Dd;if(e instanceof Dd)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,i=Math.min(t,r,n),a=Math.max(t,r,n),o=NaN,s=a-i,l=(a+i)/2;return s?(t===a?o=(r-n)/s+(r<n)*6:r===a?o=(n-t)/s+2:o=(t-r)/s+4,s/=l<.5?a+i:2-a-i,o*=60):s=l>0&&l<1?0:o,new Dd(o,s,l,e.opacity)}function Sce(e,t,r,n){return arguments.length===1?$st(e):new Dd(e,t,r,n??1)}function Dd(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}r6(Dd,Sce,Ust(E2,{brighter(e){return e=e==null?KR:Math.pow(KR,e),new Dd(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?aS:Math.pow(aS,e),new Dd(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,i=2*r-n;return new Yc($P(e>=240?e-240:e+120,i,n),$P(e,i,n),$P(e<120?e+240:e-120,i,n),this.opacity)},clamp(){return new Dd(tj(this.h),kA(this.s),kA(this.l),QR(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=QR(this.opacity);return`${e===1?"hsl(":"hsla("}${tj(this.h)}, ${kA(this.s)*100}%, ${kA(this.l)*100}%${e===1?")":`, ${e})`}`}}));function tj(e){return e=(e||0)%360,e<0?e+360:e}function kA(e){return Math.max(0,Math.min(1,e||0))}function $P(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}var n6=e=>()=>e;function Tce(e,t){return function(r){return e+r*t}}function Ace(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function Mce(e){return(e=+e)==1?Hst:function(t,r){return r-t?Ace(t,r,e):n6(isNaN(t)?r:t)}}function Hst(e,t){var r=t-e;return r?Tce(e,r):n6(isNaN(e)?t:e)}var ej=function e(t){var r=Mce(t);function n(i,a){var o=r((i=LB(i)).r,(a=LB(a)).r),s=r(i.g,a.g),l=r(i.b,a.b),u=Hst(i.opacity,a.opacity);return function(c){return i.r=o(c),i.g=s(c),i.b=l(c),i.opacity=u(c),i+""}}return n.gamma=e,n}(1);function Vst(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),i;return function(a){for(i=0;i<r;++i)n[i]=e[i]*(1-a)+t[i]*a;return n}}function Gst(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Rce(e,t){return(Gst(t)?Vst:Wst)(e,t)}function Wst(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,i=new Array(n),a=new Array(r),o;for(o=0;o<n;++o)i[o]=JR(e[o],t[o]);for(;o<r;++o)a[o]=t[o];return function(s){for(o=0;o<n;++o)a[o]=i[o](s);return a}}function Ice(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function OB(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function Lce(e,t){var r={},n={},i;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in e?r[i]=JR(e[i],t[i]):n[i]=t[i];return function(a){for(i in r)n[i]=r[i](a);return n}}var PB=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,HP=new RegExp(PB.source,"g");function Oce(e){return function(){return e}}function Pce(e){return function(t){return e(t)+""}}function Dce(e,t){var r=PB.lastIndex=HP.lastIndex=0,n,i,a,o=-1,s=[],l=[];for(e=e+"",t=t+"";(n=PB.exec(e))&&(i=HP.exec(t));)(a=i.index)>r&&(a=t.slice(r,a),s[o]?s[o]+=a:s[++o]=a),(n=n[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,l.push({i:o,x:OB(n,i)})),r=HP.lastIndex;return r<t.length&&(a=t.slice(r),s[o]?s[o]+=a:s[++o]=a),s.length<2?l[0]?Pce(l[0].x):Oce(t):(t=l.length,function(u){for(var c=0,f;c<t;++c)s[(f=l[c]).i]=f.x(u);return s.join("")})}function JR(e,t){var r=typeof t,n;return t==null||r==="boolean"?n6(t):(r==="number"?OB:r==="string"?(n=sS(t))?(t=n,ej):Dce:t instanceof sS?ej:t instanceof Date?Ice:Gst(t)?Vst:Array.isArray(t)?Wst:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?Lce:OB)(e,t)}function Fce(e){return+e}function Bce(e){return e*e}function Nce(e){return e*(2-e)}function rj(e){return((e*=2)<=1?e*e:--e*(2-e)+1)/2}function Xst(e){return e*e*e}function kce(e){return--e*e*e+1}function nj(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var i6=3,zce=function e(t){t=+t;function r(n){return Math.pow(n,t)}return r.exponent=e,r}(i6),Uce=function e(t){t=+t;function r(n){return 1-Math.pow(1-n,t)}return r.exponent=e,r}(i6),ij=function e(t){t=+t;function r(n){return((n*=2)<=1?Math.pow(n,t):2-Math.pow(2-n,t))/2}return r.exponent=e,r}(i6),jst=Math.PI,Yst=jst/2;function $ce(e){return+e==1?1:1-Math.cos(e*Yst)}function Hce(e){return Math.sin(e*Yst)}function aj(e){return(1-Math.cos(jst*e))/2}function d0(e){return(Math.pow(2,-10*e)-.0009765625)*1.0009775171065494}function Vce(e){return d0(1-+e)}function Gce(e){return 1-d0(e)}function oj(e){return((e*=2)<=1?d0(1-e):2-d0(e-1))/2}function Wce(e){return 1-Math.sqrt(1-e*e)}function Xce(e){return Math.sqrt(1- --e*e)}function sj(e){return((e*=2)<=1?1-Math.sqrt(1-e*e):Math.sqrt(1-(e-=2)*e)+1)/2}var DB=4/11,jce=6/11,Yce=8/11,Zce=3/4,qce=9/11,Kce=10/11,Qce=15/16,Jce=21/22,the=63/64,zA=1/DB/DB;function ehe(e){return 1-lS(1-e)}function lS(e){return(e=+e)<DB?zA*e*e:e<Yce?zA*(e-=jce)*e+Zce:e<Kce?zA*(e-=qce)*e+Qce:zA*(e-=Jce)*e+the}function rhe(e){return((e*=2)<=1?1-lS(1-e):lS(e-1)+1)/2}var a6=1.70158,nhe=function e(t){t=+t;function r(n){return(n=+n)*n*(t*(n-1)+n)}return r.overshoot=e,r}(a6),ihe=function e(t){t=+t;function r(n){return--n*n*((n+1)*t+n)+1}return r.overshoot=e,r}(a6),lj=function e(t){t=+t;function r(n){return((n*=2)<1?n*n*((t+1)*n-t):(n-=2)*n*((t+1)*n+t)+2)/2}return r.overshoot=e,r}(a6),gb=2*Math.PI,o6=1,s6=.3,ahe=function e(t,r){var n=Math.asin(1/(t=Math.max(1,t)))*(r/=gb);function i(a){return t*d0(- --a)*Math.sin((n-a)/r)}return i.amplitude=function(a){return e(a,r*gb)},i.period=function(a){return e(t,a)},i}(o6,s6),uj=function e(t,r){var n=Math.asin(1/(t=Math.max(1,t)))*(r/=gb);function i(a){return 1-t*d0(a=+a)*Math.sin((a+n)/r)}return i.amplitude=function(a){return e(a,r*gb)},i.period=function(a){return e(t,a)},i}(o6,s6),ohe=function e(t,r){var n=Math.asin(1/(t=Math.max(1,t)))*(r/=gb);function i(a){return((a=a*2-1)<0?t*d0(-a)*Math.sin((n-a)/r):2-t*d0(a)*Math.sin((n+a)/r))/2}return i.amplitude=function(a){return e(a,r*gb)},i.period=function(a){return e(t,a)},i}(o6,s6),she=Object.freeze({__proto__:null,easeLinear:Fce,easeQuad:rj,easeQuadIn:Bce,easeQuadOut:Nce,easeQuadInOut:rj,easeCubic:nj,easeCubicIn:Xst,easeCubicOut:kce,easeCubicInOut:nj,easePoly:ij,easePolyIn:zce,easePolyOut:Uce,easePolyInOut:ij,easeSin:aj,easeSinIn:$ce,easeSinOut:Hce,easeSinInOut:aj,easeExp:oj,easeExpIn:Vce,easeExpOut:Gce,easeExpInOut:oj,easeCircle:sj,easeCircleIn:Wce,easeCircleOut:Xce,easeCircleInOut:sj,easeBounce:lS,easeBounceIn:ehe,easeBounceOut:lS,easeBounceInOut:rhe,easeBack:lj,easeBackIn:nhe,easeBackOut:ihe,easeBackInOut:lj,easeElastic:uj,easeElasticIn:ahe,easeElasticOut:uj,easeElasticInOut:ohe}),lhe={};function uhe(e){return lhe[e.toLowerCase()]||she[e]}var che=function(e){return["fill","stroke","fillStyle","strokeStyle"].includes(e)},hhe=function(e){return/^[r,R,L,l]{1}[\s]*\(/.test(e)},cj=[1,0,0,0,1,0,0,0,1];function fhe(e,t,r){var n={},i=t.fromAttrs,a=t.toAttrs;if(!e.destroyed){var o;for(var s in a)if(!jR(i[s],a[s]))if(s==="path"){var l=a[s],u=i[s];l.length>u.length?(l=fx(a[s]),u=fx(i[s]),u=Ast(u,l),u=TB(u,l),t.fromAttrs.path=u,t.toAttrs.path=l):t.pathFormatted||(l=fx(a[s]),u=fx(i[s]),u=TB(u,l),t.fromAttrs.path=u,t.toAttrs.path=l,t.pathFormatted=!0),n[s]=[];for(var c=0;c<l.length;c++){for(var f=l[c],d=u[c],v=[],g=0;g<f.length;g++)bB(f[g])&&d&&bB(d[g])?(o=JR(d[g],f[g]),v.push(o(r))):v.push(f[g]);n[s].push(v)}}else if(s==="matrix"){var x=Rce(i[s]||cj,a[s]||cj),w=x(r);n[s]=w}else che(s)&&hhe(a[s])?n[s]=a[s]:v_(a[s])||(o=JR(i[s],a[s]),n[s]=o(r));e.attr(n)}}function dhe(e,t,r){var n=t.startTime,i=t.delay;if(r<n+i||t._paused)return!1;var a,o=t.duration,s=t.easing,l=uhe(s);if(r=r-n-t.delay,t.repeat)a=r%o/o,a=l(a);else if(a=r/o,a<1)a=l(a);else return t.onFrame?e.attr(t.onFrame(1)):e.attr(t.toAttrs),!0;if(t.onFrame){var u=t.onFrame(a);e.attr(u)}else fhe(e,t,a);return!1}var phe=function(){function e(t){this.animators=[],this.current=0,this.timer=null,this.canvas=t}return e.prototype.initTimer=function(){var t=this,r=!1,n,i,a;this.timer=e6(function(o){if(t.current=o,t.animators.length>0){for(var s=t.animators.length-1;s>=0;s--){if(n=t.animators[s],n.destroyed){t.removeAnimator(s);continue}if(!n.isAnimatePaused()){i=n.get("animations");for(var l=i.length-1;l>=0;l--)a=i[l],r=dhe(n,a,o),r&&(i.splice(l,1),r=!1,a.callback&&a.callback())}i.length===0&&t.removeAnimator(s)}var u=t.canvas.get("autoDraw");u||t.canvas.draw()}})},e.prototype.addAnimator=function(t){this.animators.push(t)},e.prototype.removeAnimator=function(t){this.animators.splice(t,1)},e.prototype.isAnimating=function(){return!!this.animators.length},e.prototype.stop=function(){this.timer&&this.timer.stop()},e.prototype.stopAllAnimations=function(t){t===void 0&&(t=!0),this.animators.forEach(function(r){r.stopAnimate(t)}),this.animators=[],this.canvas.draw()},e.prototype.getTime=function(){return this.current},e}(),vhe=40,hj=0,fj=["mousedown","mouseup","dblclick","mouseout","mouseover","mousemove","mouseleave","mouseenter","touchstart","touchmove","touchend","dragenter","dragover","dragleave","drop","contextmenu","mousewheel"];function dj(e,t,r){r.name=t,r.target=e,r.currentTarget=e,r.delegateTarget=e,e.emit(t,r)}function ghe(e,t,r){if(r.bubbles){var n=void 0,i=!1;if(t==="mouseenter"?(n=r.fromShape,i=!0):t==="mouseleave"&&(i=!0,n=r.toShape),e.isCanvas()&&i)return;if(n&&Ist(e,n)){r.bubbles=!1;return}r.name=t,r.currentTarget=e,r.delegateTarget=e,e.emit(t,r)}}var mhe=function(){function e(t){var r=this;this.draggingShape=null,this.dragging=!1,this.currentShape=null,this.mousedownShape=null,this.mousedownPoint=null,this._eventCallback=function(n){var i=n.type;r._triggerEvent(i,n)},this._onDocumentMove=function(n){var i=r.canvas,a=i.get("el");if(a!==n.target&&(r.dragging||r.currentShape)){var o=r._getPointInfo(n);r.dragging&&r._emitEvent("drag",n,o,r.draggingShape)}},this._onDocumentMouseUp=function(n){var i=r.canvas,a=i.get("el");if(a!==n.target&&r.dragging){var o=r._getPointInfo(n);r.draggingShape&&r._emitEvent("drop",n,o,null),r._emitEvent("dragend",n,o,r.draggingShape),r._afterDrag(r.draggingShape,o,n)}},this.canvas=t.canvas}return e.prototype.init=function(){this._bindEvents()},e.prototype._bindEvents=function(){var t=this,r=this.canvas.get("el");Aa(fj,function(n){r.addEventListener(n,t._eventCallback)}),document&&(document.addEventListener("mousemove",this._onDocumentMove),document.addEventListener("mouseup",this._onDocumentMouseUp))},e.prototype._clearEvents=function(){var t=this,r=this.canvas.get("el");Aa(fj,function(n){r.removeEventListener(n,t._eventCallback)}),document&&(document.removeEventListener("mousemove",this._onDocumentMove),document.removeEventListener("mouseup",this._onDocumentMouseUp))},e.prototype._getEventObj=function(t,r,n,i,a,o){var s=new Sue(t,r);return s.fromShape=a,s.toShape=o,s.x=n.x,s.y=n.y,s.clientX=n.clientX,s.clientY=n.clientY,s.propagationPath.push(i),s},e.prototype._getShape=function(t,r){return this.canvas.getShape(t.x,t.y,r)},e.prototype._getPointInfo=function(t){var r=this.canvas,n=r.getClientByEvent(t),i=r.getPointByEvent(t);return{x:i.x,y:i.y,clientX:n.x,clientY:n.y}},e.prototype._triggerEvent=function(t,r){var n=this._getPointInfo(r),i=this._getShape(n,r),a=this["_on"+t],o=!1;if(a)a.call(this,n,i,r);else{var s=this.currentShape;t==="mouseenter"||t==="dragenter"||t==="mouseover"?(this._emitEvent(t,r,n,null,null,i),i&&this._emitEvent(t,r,n,i,null,i),t==="mouseenter"&&this.draggingShape&&this._emitEvent("dragenter",r,n,null)):t==="mouseleave"||t==="dragleave"||t==="mouseout"?(o=!0,s&&this._emitEvent(t,r,n,s,s,null),this._emitEvent(t,r,n,null,s,null),t==="mouseleave"&&this.draggingShape&&this._emitEvent("dragleave",r,n,null)):this._emitEvent(t,r,n,i,null,null)}if(o||(this.currentShape=i),i&&!i.get("destroyed")){var l=this.canvas,u=l.get("el");u.style.cursor=i.attr("cursor")||l.get("cursor")}},e.prototype._onmousedown=function(t,r,n){n.button===hj&&(this.mousedownShape=r,this.mousedownPoint=t,this.mousedownTimeStamp=n.timeStamp),this._emitEvent("mousedown",n,t,r,null,null)},e.prototype._emitMouseoverEvents=function(t,r,n,i){var a=this.canvas.get("el");n!==i&&(n&&(this._emitEvent("mouseout",t,r,n,n,i),this._emitEvent("mouseleave",t,r,n,n,i),(!i||i.get("destroyed"))&&(a.style.cursor=this.canvas.get("cursor"))),i&&(this._emitEvent("mouseover",t,r,i,n,i),this._emitEvent("mouseenter",t,r,i,n,i)))},e.prototype._emitDragoverEvents=function(t,r,n,i,a){i?(i!==n&&(n&&this._emitEvent("dragleave",t,r,n,n,i),this._emitEvent("dragenter",t,r,i,n,i)),a||this._emitEvent("dragover",t,r,i)):n&&this._emitEvent("dragleave",t,r,n,n,i),a&&this._emitEvent("dragover",t,r,i)},e.prototype._afterDrag=function(t,r,n){t&&(t.set("capture",!0),this.draggingShape=null),this.dragging=!1;var i=this._getShape(r,n);i!==t&&this._emitMouseoverEvents(n,r,t,i),this.currentShape=i},e.prototype._onmouseup=function(t,r,n){if(n.button===hj){var i=this.draggingShape;this.dragging?(i&&this._emitEvent("drop",n,t,r),this._emitEvent("dragend",n,t,i),this._afterDrag(i,t,n)):(this._emitEvent("mouseup",n,t,r),r===this.mousedownShape&&this._emitEvent("click",n,t,r),this.mousedownShape=null,this.mousedownPoint=null)}},e.prototype._ondragover=function(t,r,n){n.preventDefault();var i=this.currentShape;this._emitDragoverEvents(n,t,i,r,!0)},e.prototype._onmousemove=function(t,r,n){var i=this.canvas,a=this.currentShape,o=this.draggingShape;if(this.dragging)o&&this._emitDragoverEvents(n,t,a,r,!1),this._emitEvent("drag",n,t,o);else{var s=this.mousedownPoint;if(s){var l=this.mousedownShape,u=n.timeStamp,c=u-this.mousedownTimeStamp,f=s.clientX-t.clientX,d=s.clientY-t.clientY,v=f*f+d*d;c>120||v>vhe?l&&l.get("draggable")?(o=this.mousedownShape,o.set("capture",!1),this.draggingShape=o,this.dragging=!0,this._emitEvent("dragstart",n,t,o),this.mousedownShape=null,this.mousedownPoint=null):!l&&i.get("draggable")?(this.dragging=!0,this._emitEvent("dragstart",n,t,null),this.mousedownShape=null,this.mousedownPoint=null):(this._emitMouseoverEvents(n,t,a,r),this._emitEvent("mousemove",n,t,r)):(this._emitMouseoverEvents(n,t,a,r),this._emitEvent("mousemove",n,t,r))}else this._emitMouseoverEvents(n,t,a,r),this._emitEvent("mousemove",n,t,r)}},e.prototype._emitEvent=function(t,r,n,i,a,o){var s=this._getEventObj(t,r,n,i,a,o);if(i){s.shape=i,dj(i,t,s);for(var l=i.getParent();l;)l.emitDelegation(t,s),s.propagationStopped||ghe(l,t,s),s.propagationPath.push(l),l=l.getParent()}else{var u=this.canvas;dj(u,t,s)}},e.prototype.destroy=function(){this._clearEvents(),this.canvas=null,this.currentShape=null,this.draggingShape=null,this.mousedownPoint=null,this.mousedownShape=null,this.mousedownTimeStamp=null},e}(),pj="px",vj=Bue(),yhe=vj&&vj.name==="firefox",_he=function(e){nn(t,e);function t(r){var n=e.call(this,r)||this;return n.initContainer(),n.initDom(),n.initEvents(),n.initTimeline(),n}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return r.cursor="default",r.supportCSSTransform=!1,r},t.prototype.initContainer=function(){var r=this.get("container");qd(r)&&(r=document.getElementById(r),this.set("container",r))},t.prototype.initDom=function(){var r=this.createDom();this.set("el",r);var n=this.get("container");n.appendChild(r),this.setDOMSize(this.get("width"),this.get("height"))},t.prototype.initEvents=function(){var r=new mhe({canvas:this});r.init(),this.set("eventController",r)},t.prototype.initTimeline=function(){var r=new phe(this);this.set("timeline",r)},t.prototype.setDOMSize=function(r,n){var i=this.get("el");zX&&(i.style.width=r+pj,i.style.height=n+pj)},t.prototype.changeSize=function(r,n){this.setDOMSize(r,n),this.set("width",r),this.set("height",n),this.onCanvasChange("changeSize")},t.prototype.getRenderer=function(){return this.get("renderer")},t.prototype.getCursor=function(){return this.get("cursor")},t.prototype.setCursor=function(r){this.set("cursor",r);var n=this.get("el");zX&&n&&(n.style.cursor=r)},t.prototype.getPointByEvent=function(r){var n=this.get("supportCSSTransform");if(n){if(yhe&&!wl(r.layerX)&&r.layerX!==r.offsetX)return{x:r.layerX,y:r.layerY};if(!wl(r.offsetX))return{x:r.offsetX,y:r.offsetY}}var i=this.getClientByEvent(r),a=i.x,o=i.y;return this.getPointByClient(a,o)},t.prototype.getClientByEvent=function(r){var n=r;return r.touches&&(r.type==="touchend"?n=r.changedTouches[0]:n=r.touches[0]),{x:n.clientX,y:n.clientY}},t.prototype.getPointByClient=function(r,n){var i=this.get("el"),a=i.getBoundingClientRect();return{x:r-a.left,y:n-a.top}},t.prototype.getClientByPoint=function(r,n){var i=this.get("el"),a=i.getBoundingClientRect();return{x:r+a.left,y:n+a.top}},t.prototype.draw=function(){},t.prototype.removeDom=function(){var r=this.get("el");r.parentNode.removeChild(r)},t.prototype.clearEvents=function(){var r=this.get("eventController");r.destroy()},t.prototype.isCanvas=function(){return!0},t.prototype.getParent=function(){return null},t.prototype.destroy=function(){var r=this.get("timeline");this.get("destroyed")||(this.clear(),r&&r.stop(),this.clearEvents(),this.removeDom(),e.prototype.destroy.call(this))},t}(Bst),xhe=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.isGroup=function(){return!0},t.prototype.isEntityGroup=function(){return!1},t.prototype.clone=function(){for(var r=e.prototype.clone.call(this),n=this.getChildren(),i=0;i<n.length;i++){var a=n[i];r.add(a.clone())}return r},t}(Bst),bhe=function(e){nn(t,e);function t(r){return e.call(this,r)||this}return t.prototype._isInBBox=function(r,n){var i=this.getBBox();return i.minX<=r&&i.maxX>=r&&i.minY<=n&&i.maxY>=n},t.prototype.afterAttrsChange=function(r){e.prototype.afterAttrsChange.call(this,r),this.clearCacheBBox()},t.prototype.getBBox=function(){var r=this.cfg.bbox;return r||(r=this.calculateBBox(),this.set("bbox",r)),r},t.prototype.getCanvasBBox=function(){var r=this.cfg.canvasBBox;return r||(r=this.calculateCanvasBBox(),this.set("canvasBBox",r)),r},t.prototype.applyMatrix=function(r){e.prototype.applyMatrix.call(this,r),this.set("canvasBBox",null)},t.prototype.calculateCanvasBBox=function(){var r=this.getBBox(),n=this.getTotalMatrix(),i=r.minX,a=r.minY,o=r.maxX,s=r.maxY;if(n){var l=Fy(n,[r.minX,r.minY]),u=Fy(n,[r.maxX,r.minY]),c=Fy(n,[r.minX,r.maxY]),f=Fy(n,[r.maxX,r.maxY]);i=Math.min(l[0],u[0],c[0],f[0]),o=Math.max(l[0],u[0],c[0],f[0]),a=Math.min(l[1],u[1],c[1],f[1]),s=Math.max(l[1],u[1],c[1],f[1])}var d=this.attrs;if(d.shadowColor){var v=d.shadowBlur,g=v===void 0?0:v,x=d.shadowOffsetX,w=x===void 0?0:x,S=d.shadowOffsetY,M=S===void 0?0:S,R=i-g+w,I=o+g+w,P=a-g+M,k=s+g+M;i=Math.min(i,R),o=Math.max(o,I),a=Math.min(a,P),s=Math.max(s,k)}return{x:i,y:a,minX:i,minY:a,maxX:o,maxY:s,width:o-i,height:s-a}},t.prototype.clearCacheBBox=function(){this.set("bbox",null),this.set("canvasBBox",null)},t.prototype.isClipShape=function(){return this.get("isClipShape")},t.prototype.isInShape=function(r,n){return!1},t.prototype.isOnlyHitBox=function(){return!1},t.prototype.isHit=function(r,n){var i=this.get("startArrowShape"),a=this.get("endArrowShape"),o=[r,n,1];o=this.invertFromMatrix(o);var s=o[0],l=o[1],u=this._isInBBox(s,l);return this.isOnlyHitBox()?u:!!(u&&!this.isClipped(s,l)&&(this.isInShape(s,l)||i&&i.isHit(s,l)||a&&a.isHit(s,l)))},t}(Pst),Zst=new Map;function cv(e,t){Zst.set(e,t)}function Ehe(e){return Zst.get(e)}function qst(e){var t=e.attr(),r=t.x,n=t.y,i=t.width,a=t.height;return{x:r,y:n,width:i,height:a}}function Kst(e){var t=e.attr(),r=t.x,n=t.y,i=t.r;return{x:r-i,y:n-i,width:i*2,height:i*2}}function Uu(e,t,r,n){var i=e-r,a=t-n;return Math.sqrt(i*i+a*a)}function AM(e,t){return Math.abs(e-t)<.001}function qb(e,t){var r=f0(e),n=f0(t),i=h0(e),a=h0(t);return{x:r,y:n,width:i-r,height:a-n}}function j3(e){return(e+Math.PI*2)%(Math.PI*2)}var jc={box:function(e,t,r,n){return qb([e,r],[t,n])},length:function(e,t,r,n){return Uu(e,t,r,n)},pointAt:function(e,t,r,n,i){return{x:(1-i)*e+i*r,y:(1-i)*t+i*n}},pointDistance:function(e,t,r,n,i,a){var o=(r-e)*(i-e)+(n-t)*(a-t);if(o<0)return Uu(e,t,i,a);var s=(r-e)*(r-e)+(n-t)*(n-t);return o>s?Uu(r,n,i,a):this.pointToLine(e,t,r,n,i,a)},pointToLine:function(e,t,r,n,i,a){var o=[r-e,n-t];if(Zue(o,[0,0]))return Math.sqrt((i-e)*(i-e)+(a-t)*(a-t));var s=[-o[1],o[0]];jue(s,s);var l=[i-e,a-t];return Math.abs(Yue(l,s))},tangentAngle:function(e,t,r,n){return Math.atan2(n-t,r-e)}},whe=1e-4;function Qst(e,t,r,n,i,a){var o,s=1/0,l=[r,n],u=20;a&&a>200&&(u=a/10);for(var c=1/u,f=c/10,d=0;d<=u;d++){var v=d*c,g=[i.apply(null,e.concat([v])),i.apply(null,t.concat([v]))],x=Uu(l[0],l[1],g[0],g[1]);x<s&&(o=v,s=x)}if(o===0)return{x:e[0],y:t[0]};if(o===1){var w=e.length;return{x:e[w-1],y:t[w-1]}}s=1/0;for(var d=0;d<32&&!(f<whe);d++){var S=o-f,M=o+f,g=[i.apply(null,e.concat([S])),i.apply(null,t.concat([S]))],x=Uu(l[0],l[1],g[0],g[1]);if(S>=0&&x<s)o=S,s=x;else{var R=[i.apply(null,e.concat([M])),i.apply(null,t.concat([M]))],I=Uu(l[0],l[1],R[0],R[1]);M<=1&&I<s?(o=M,s=I):f*=.5}}return{x:i.apply(null,e.concat([o])),y:i.apply(null,t.concat([o]))}}function Che(e,t){for(var r=0,n=e.length,i=0;i<n;i++){var a=e[i],o=t[i],s=e[(i+1)%n],l=t[(i+1)%n];r+=Uu(a,o,s,l)}return r/2}function Lm(e,t,r,n){var i=1-n;return i*i*e+2*n*i*t+n*n*r}function gj(e,t,r){var n=e+r-2*t;if(AM(n,0))return[.5];var i=(e-t)/n;return i<=1&&i>=0?[i]:[]}function mj(e,t,r,n){return 2*(1-n)*(t-e)+2*n*(r-t)}function Jst(e,t,r,n,i,a,o){var s=Lm(e,r,i,o),l=Lm(t,n,a,o),u=jc.pointAt(e,t,r,n,o),c=jc.pointAt(r,n,i,a,o);return[[e,t,u.x,u.y,s,l],[s,l,c.x,c.y,i,a]]}function FB(e,t,r,n,i,a,o){if(o===0)return(Uu(e,t,r,n)+Uu(r,n,i,a)+Uu(e,t,i,a))/2;var s=Jst(e,t,r,n,i,a,.5),l=s[0],u=s[1];return l.push(o-1),u.push(o-1),FB.apply(null,l)+FB.apply(null,u)}var tlt={box:function(e,t,r,n,i,a){var o=gj(e,r,i)[0],s=gj(t,n,a)[0],l=[e,i],u=[t,a];return o!==void 0&&l.push(Lm(e,r,i,o)),s!==void 0&&u.push(Lm(t,n,a,s)),qb(l,u)},length:function(e,t,r,n,i,a){return FB(e,t,r,n,i,a,3)},nearestPoint:function(e,t,r,n,i,a,o,s){return Qst([e,r,i],[t,n,a],o,s,Lm)},pointDistance:function(e,t,r,n,i,a,o,s){var l=this.nearestPoint(e,t,r,n,i,a,o,s);return Uu(l.x,l.y,o,s)},interpolationAt:Lm,pointAt:function(e,t,r,n,i,a,o){return{x:Lm(e,r,i,o),y:Lm(t,n,a,o)}},divide:function(e,t,r,n,i,a,o){return Jst(e,t,r,n,i,a,o)},tangentAngle:function(e,t,r,n,i,a,o){var s=mj(e,r,i,o),l=mj(t,n,a,o),u=Math.atan2(l,s);return j3(u)}};function Om(e,t,r,n,i){var a=1-i;return a*a*a*e+3*t*i*a*a+3*r*i*i*a+n*i*i*i}function yj(e,t,r,n,i){var a=1-i;return 3*(a*a*(t-e)+2*a*i*(r-t)+i*i*(n-r))}function VP(e,t,r,n){var i=-3*e+9*t-9*r+3*n,a=6*e-12*t+6*r,o=3*t-3*e,s=[],l,u,c;if(AM(i,0))AM(a,0)||(l=-o/a,l>=0&&l<=1&&s.push(l));else{var f=a*a-4*i*o;AM(f,0)?s.push(-a/(2*i)):f>0&&(c=Math.sqrt(f),l=(-a+c)/(2*i),u=(-a-c)/(2*i),l>=0&&l<=1&&s.push(l),u>=0&&u<=1&&s.push(u))}return s}function elt(e,t,r,n,i,a,o,s,l){var u=Om(e,r,i,o,l),c=Om(t,n,a,s,l),f=jc.pointAt(e,t,r,n,l),d=jc.pointAt(r,n,i,a,l),v=jc.pointAt(i,a,o,s,l),g=jc.pointAt(f.x,f.y,d.x,d.y,l),x=jc.pointAt(d.x,d.y,v.x,v.y,l);return[[e,t,f.x,f.y,g.x,g.y,u,c],[u,c,x.x,x.y,v.x,v.y,o,s]]}function BB(e,t,r,n,i,a,o,s,l){if(l===0)return Che([e,r,i,o],[t,n,a,s]);var u=elt(e,t,r,n,i,a,o,s,.5),c=u[0],f=u[1];return c.push(l-1),f.push(l-1),BB.apply(null,c)+BB.apply(null,f)}var dC={extrema:VP,box:function(e,t,r,n,i,a,o,s){for(var l=[e,o],u=[t,s],c=VP(e,r,i,o),f=VP(t,n,a,s),d=0;d<c.length;d++)l.push(Om(e,r,i,o,c[d]));for(var d=0;d<f.length;d++)u.push(Om(t,n,a,s,f[d]));return qb(l,u)},length:function(e,t,r,n,i,a,o,s){return BB(e,t,r,n,i,a,o,s,3)},nearestPoint:function(e,t,r,n,i,a,o,s,l,u,c){return Qst([e,r,i,o],[t,n,a,s],l,u,Om,c)},pointDistance:function(e,t,r,n,i,a,o,s,l,u,c){var f=this.nearestPoint(e,t,r,n,i,a,o,s,l,u,c);return Uu(f.x,f.y,l,u)},interpolationAt:Om,pointAt:function(e,t,r,n,i,a,o,s,l){return{x:Om(e,r,i,o,l),y:Om(t,n,a,s,l)}},divide:function(e,t,r,n,i,a,o,s,l){return elt(e,t,r,n,i,a,o,s,l)},tangentAngle:function(e,t,r,n,i,a,o,s,l){var u=yj(e,r,i,o,l),c=yj(t,n,a,s,l);return j3(Math.atan2(c,u))}};function _j(e,t){var r=Math.abs(e);return t>0?r:r*-1}var She={box:function(e,t,r,n){return{x:e-r,y:t-n,width:r*2,height:n*2}},length:function(e,t,r,n){return Math.PI*(3*(r+n)-Math.sqrt((3*r+n)*(r+3*n)))},nearestPoint:function(e,t,r,n,i,a){var o=r,s=n;if(o===0||s===0)return{x:e,y:t};for(var l=i-e,u=a-t,c=Math.abs(l),f=Math.abs(u),d=o*o,v=s*s,g=Math.PI/4,x,w,S=0;S<4;S++){x=o*Math.cos(g),w=s*Math.sin(g);var M=(d-v)*Math.pow(Math.cos(g),3)/o,R=(v-d)*Math.pow(Math.sin(g),3)/s,I=x-M,P=w-R,k=c-M,z=f-R,G=Math.hypot(P,I),J=Math.hypot(z,k),Z=G*Math.asin((I*z-P*k)/(G*J)),X=Z/Math.sqrt(d+v-x*x-w*w);g+=X,g=Math.min(Math.PI/2,Math.max(0,g))}return{x:e+_j(x,l),y:t+_j(w,u)}},pointDistance:function(e,t,r,n,i,a){var o=this.nearestPoint(e,t,r,n,i,a);return Uu(o.x,o.y,i,a)},pointAt:function(e,t,r,n,i){var a=2*Math.PI*i;return{x:e+r*Math.cos(a),y:t+n*Math.sin(a)}},tangentAngle:function(e,t,r,n,i){var a=2*Math.PI*i,o=Math.atan2(n*Math.cos(a),-r*Math.sin(a));return j3(o)}};function The(e,t,r,n,i,a,o,s){return-1*r*Math.cos(i)*Math.sin(s)-n*Math.sin(i)*Math.cos(s)}function Ahe(e,t,r,n,i,a,o,s){return-1*r*Math.sin(i)*Math.sin(s)+n*Math.cos(i)*Math.cos(s)}function Mhe(e,t,r){return Math.atan(-t/e*Math.tan(r))}function Rhe(e,t,r){return Math.atan(t/(e*Math.tan(r)))}function xj(e,t,r,n,i,a){return r*Math.cos(i)*Math.cos(a)-n*Math.sin(i)*Math.sin(a)+e}function bj(e,t,r,n,i,a){return r*Math.sin(i)*Math.cos(a)+n*Math.cos(i)*Math.sin(a)+t}function Ihe(e,t,r,n){var i=Math.atan2(n*e,r*t);return(i+Math.PI*2)%(Math.PI*2)}function Ej(e,t,r){return{x:e*Math.cos(r),y:t*Math.sin(r)}}function wj(e,t,r){var n=Math.cos(r),i=Math.sin(r);return[e*n-t*i,e*i+t*n]}var Lhe={box:function(e,t,r,n,i,a,o){for(var s=Mhe(r,n,i),l=1/0,u=-1/0,c=[a,o],f=-Math.PI*2;f<=Math.PI*2;f+=Math.PI){var d=s+f;a<o?a<d&&d<o&&c.push(d):o<d&&d<a&&c.push(d)}for(var f=0;f<c.length;f++){var v=xj(e,t,r,n,i,c[f]);v<l&&(l=v),v>u&&(u=v)}for(var g=Rhe(r,n,i),x=1/0,w=-1/0,S=[a,o],f=-Math.PI*2;f<=Math.PI*2;f+=Math.PI){var M=g+f;a<o?a<M&&M<o&&S.push(M):o<M&&M<a&&S.push(M)}for(var f=0;f<S.length;f++){var R=bj(e,t,r,n,i,S[f]);R<x&&(x=R),R>w&&(w=R)}return{x:l,y:x,width:u-l,height:w-x}},length:function(e,t,r,n,i,a,o){},nearestPoint:function(e,t,r,n,i,a,o,s,l){var u=wj(s-e,l-t,-i),c=u[0],f=u[1],d=She.nearestPoint(0,0,r,n,c,f),v=Ihe(r,n,d.x,d.y);v<a?d=Ej(r,n,a):v>o&&(d=Ej(r,n,o));var g=wj(d.x,d.y,i);return{x:g[0]+e,y:g[1]+t}},pointDistance:function(e,t,r,n,i,a,o,s,l){var u=this.nearestPoint(e,t,r,n,s,l);return Uu(u.x,u.y,s,l)},pointAt:function(e,t,r,n,i,a,o,s){var l=(o-a)*s+a;return{x:xj(e,t,r,n,i,l),y:bj(e,t,r,n,i,l)}},tangentAngle:function(e,t,r,n,i,a,o,s){var l=(o-a)*s+a,u=The(e,t,r,n,i,a,o,l),c=Ahe(e,t,r,n,i,a,o,l);return j3(Math.atan2(c,u))}};function rlt(e){for(var t=0,r=[],n=0;n<e.length-1;n++){var i=e[n],a=e[n+1],o=Uu(i[0],i[1],a[0],a[1]),s={from:i,to:a,length:o};r.push(s),t+=o}return{segments:r,totalLength:t}}function Ohe(e){if(e.length<2)return 0;for(var t=0,r=0;r<e.length-1;r++){var n=e[r],i=e[r+1];t+=Uu(n[0],n[1],i[0],i[1])}return t}function Phe(e,t){if(t>1||t<0||e.length<2)return null;var r=rlt(e),n=r.segments,i=r.totalLength;if(i===0)return{x:e[0][0],y:e[0][1]};for(var a=0,o=null,s=0;s<n.length;s++){var l=n[s],u=l.from,c=l.to,f=l.length/i;if(t>=a&&t<=a+f){var d=(t-a)/f;o=jc.pointAt(u[0],u[1],c[0],c[1],d);break}a+=f}return o}function Dhe(e,t){if(t>1||t<0||e.length<2)return 0;for(var r=rlt(e),n=r.segments,i=r.totalLength,a=0,o=0,s=0;s<n.length;s++){var l=n[s],u=l.from,c=l.to,f=l.length/i;if(t>=a&&t<=a+f){o=Math.atan2(c[1]-u[1],c[0]-u[0]);break}a+=f}return o}function Fhe(e,t,r){for(var n=1/0,i=0;i<e.length-1;i++){var a=e[i],o=e[i+1],s=jc.pointDistance(a[0],a[1],o[0],o[1],t,r);s<n&&(n=s)}return n}var Bhe={box:function(e){for(var t=[],r=[],n=0;n<e.length;n++){var i=e[n];t.push(i[0]),r.push(i[1])}return qb(t,r)},length:function(e){return Ohe(e)},pointAt:function(e,t){return Phe(e,t)},pointDistance:function(e,t,r){return Fhe(e,t,r)},tangentAngle:function(e,t){return Dhe(e,t)}};function Cj(e,t){return!e||!t?e||t:{minX:Math.min(e.minX,t.minX),minY:Math.min(e.minY,t.minY),maxX:Math.max(e.maxX,t.maxX),maxY:Math.max(e.maxY,t.maxY)}}function l6(e,t){var r=e.get("startArrowShape"),n=e.get("endArrowShape"),i=null,a=null;return r&&(i=r.getCanvasBBox(),t=Cj(t,i)),n&&(a=n.getCanvasBBox(),t=Cj(t,a)),t}function Nhe(e){for(var t=e.attr(),r=t.points,n=[],i=[],a=0;a<r.length;a++){var o=r[a];n.push(o[0]),i.push(o[1])}var s=qb(n,i),l=s.x,u=s.y,c=s.width,f=s.height,d={minX:l,minY:u,maxX:l+c,maxY:u+f};return d=l6(e,d),{x:d.minX,y:d.minY,width:d.maxX-d.minX,height:d.maxY-d.minY}}function khe(e){for(var t=e.attr(),r=t.points,n=[],i=[],a=0;a<r.length;a++){var o=r[a];n.push(o[0]),i.push(o[1])}return qb(n,i)}var GP=null;function nlt(){if(!GP){var e=document.createElement("canvas");e.width=1,e.height=1,GP=e.getContext("2d")}return GP}function ilt(e,t,r){var n=1;if(qd(e)&&(n=e.split(`
`).length),n>1){var i=zhe(t,r);return t*n+i*(n-1)}return t}function zhe(e,t){return t?t-e:e*.14}function Uhe(e,t){var r=nlt(),n=0;if(wl(e)||e==="")return n;if(r.save(),r.font=t,qd(e)&&e.includes(`
`)){var i=e.split(`
`);Aa(i,function(a){var o=r.measureText(a).width;n<o&&(n=o)})}else n=r.measureText(e).width;return r.restore(),n}function alt(e){var t=e.fontSize,r=e.fontFamily,n=e.fontWeight,i=e.fontStyle,a=e.fontVariant;return[i,a,n,t+"px",r].join(" ").trim()}function $he(e){var t=e.attr(),r=t.x,n=t.y,i=t.text,a=t.fontSize,o=t.lineHeight,s=t.font;s||(s=alt(t));var l=Uhe(i,s),u;if(!l)u={x:r,y:n,width:0,height:0};else{var c=t.textAlign,f=t.textBaseline,d=ilt(i,a,o),v={x:r,y:n-d};c&&(c==="end"||c==="right"?v.x-=l:c==="center"&&(v.x-=l/2)),f&&(f==="top"?v.y+=d:f==="middle"&&(v.y+=d/2)),u={x:v.x,y:v.y,width:l,height:d}}return u}var Hhe=/[MLHVQTCSAZ]([^MLHVQTCSAZ]*)/ig,Vhe=/[^\s\,]+/ig;function Ghe(e){var t=e||[];if(Qf(t))return t;if(qd(t))return t=t.match(Hhe),Aa(t,function(r,n){if(r=r.match(Vhe),r[0].length>1){var i=r[0].charAt(0);r.splice(1,0,r[0].substr(1)),r[0]=i}Aa(r,function(a,o){isNaN(a)||(r[o]=+a)}),t[n]=r}),t}var pC=`	
\v\f\r   ᠎             　\u2028\u2029`,Whe=new RegExp("([a-z])["+pC+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+pC+"]*,?["+pC+"]*)+)","ig"),Xhe=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+pC+"]*,?["+pC+"]*","ig");function jhe(e){if(!e)return null;if(Qf(e))return e;var t={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},r=[];return String(e).replace(Whe,function(n,i,a){var o=[],s=i.toLowerCase();if(a.replace(Xhe,function(l,u){u&&o.push(+u)}),s==="m"&&o.length>2&&(r.push([i].concat(o.splice(0,2))),s="l",i=i==="m"?"l":"L"),s==="o"&&o.length===1&&r.push([i,o[0]]),s==="r")r.push([i].concat(o));else for(;o.length>=t[s]&&(r.push([i].concat(o.splice(0,t[s]))),!!t[s]););return""}),r}var Yhe=/[a-z]/;function Sj(e,t){return[t[0]+(t[0]-e[0]),t[1]+(t[1]-e[1])]}function olt(e){var t=jhe(e);if(!t||!t.length)return[["M",0,0]];for(var r=!1,n=0;n<t.length;n++){var i=t[n][0];if(Yhe.test(i)||["V","H","T","S"].indexOf(i)>=0){r=!0;break}}if(!r)return t;var a=[],o=0,s=0,l=0,u=0,c=0,f=t[0];(f[0]==="M"||f[0]==="m")&&(o=+f[1],s=+f[2],l=o,u=s,c++,a[0]=["M",o,s]);for(var n=c,d=t.length;n<d;n++){var v=t[n],g=a[n-1],x=[],i=v[0],w=i.toUpperCase();if(i!==w)switch(x[0]=w,w){case"A":x[1]=v[1],x[2]=v[2],x[3]=v[3],x[4]=v[4],x[5]=v[5],x[6]=+v[6]+o,x[7]=+v[7]+s;break;case"V":x[1]=+v[1]+s;break;case"H":x[1]=+v[1]+o;break;case"M":l=+v[1]+o,u=+v[2]+s,x[1]=l,x[2]=u;break;default:for(var S=1,M=v.length;S<M;S++)x[S]=+v[S]+(S%2?o:s)}else x=t[n];switch(w){case"Z":o=+l,s=+u;break;case"H":o=x[1],x=["L",o,s];break;case"V":s=x[1],x=["L",o,s];break;case"T":o=x[1],s=x[2];var R=Sj([g[1],g[2]],[g[3],g[4]]);x=["Q",R[0],R[1],o,s];break;case"S":o=x[x.length-2],s=x[x.length-1];var I=g.length,P=Sj([g[I-4],g[I-3]],[g[I-2],g[I-1]]);x=["C",P[0],P[1],x[1],x[2],o,s];break;case"M":l=x[x.length-2],u=x[x.length-1];break;default:o=x[x.length-2],s=x[x.length-1]}a.push(x)}return a}function UA(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function NB(e,t){return UA(e)*UA(t)?(e[0]*t[0]+e[1]*t[1])/(UA(e)*UA(t)):1}function Tj(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(NB(e,t))}function kB(e,t){return e[0]===t[0]&&e[1]===t[1]}function Zhe(e,t){var r=t[1],n=t[2],i=xst(bst(t[3]),Math.PI*2),a=t[4],o=t[5],s=e[0],l=e[1],u=t[6],c=t[7],f=Math.cos(i)*(s-u)/2+Math.sin(i)*(l-c)/2,d=-1*Math.sin(i)*(s-u)/2+Math.cos(i)*(l-c)/2,v=f*f/(r*r)+d*d/(n*n);v>1&&(r*=Math.sqrt(v),n*=Math.sqrt(v));var g=r*r*(d*d)+n*n*(f*f),x=g?Math.sqrt((r*r*(n*n)-g)/g):1;a===o&&(x*=-1),isNaN(x)&&(x=0);var w=n?x*r*d/n:0,S=r?x*-n*f/r:0,M=(s+u)/2+Math.cos(i)*w-Math.sin(i)*S,R=(l+c)/2+Math.sin(i)*w+Math.cos(i)*S,I=[(f-w)/r,(d-S)/n],P=[(-1*f-w)/r,(-1*d-S)/n],k=Tj([1,0],I),z=Tj(I,P);return NB(I,P)<=-1&&(z=Math.PI),NB(I,P)>=1&&(z=0),o===0&&z>0&&(z=z-2*Math.PI),o===1&&z<0&&(z=z+2*Math.PI),{cx:M,cy:R,rx:kB(e,[u,c])?0:r,ry:kB(e,[u,c])?0:n,startAngle:k,endAngle:k+z,xRotation:i,arcFlag:a,sweepFlag:o}}function Aj(e,t){return[t[0]+(t[0]-e[0]),t[1]+(t[1]-e[1])]}function slt(e){e=Ghe(e);for(var t=[],r=null,n=null,i=null,a=0,o=e.length,s=0;s<o;s++){var l=e[s];n=e[s+1];var u=l[0],c={command:u,prePoint:r,params:l,startTangent:null,endTangent:null};switch(u){case"M":i=[l[1],l[2]],a=s;break;case"A":var f=Zhe(r,l);c.arcParams=f;break}if(u==="Z")r=i,n=e[a+1];else{var d=l.length;r=[l[d-2],l[d-1]]}n&&n[0]==="Z"&&(n=e[a],t[a]&&(t[a].prePoint=r)),c.currentPoint=r,t[a]&&kB(r,t[a].currentPoint)&&(t[a].prePoint=c.prePoint);var v=n?[n[n.length-2],n[n.length-1]]:null;c.nextPoint=v;var g=c.prePoint;if(["L","H","V"].includes(u))c.startTangent=[g[0]-r[0],g[1]-r[1]],c.endTangent=[r[0]-g[0],r[1]-g[1]];else if(u==="Q"){var x=[l[1],l[2]];c.startTangent=[g[0]-x[0],g[1]-x[1]],c.endTangent=[r[0]-x[0],r[1]-x[1]]}else if(u==="T"){var w=t[s-1],x=Aj(w.currentPoint,g);w.command==="Q"?(c.command="Q",c.startTangent=[g[0]-x[0],g[1]-x[1]],c.endTangent=[r[0]-x[0],r[1]-x[1]]):(c.command="TL",c.startTangent=[g[0]-r[0],g[1]-r[1]],c.endTangent=[r[0]-g[0],r[1]-g[1]])}else if(u==="C"){var S=[l[1],l[2]],M=[l[3],l[4]];c.startTangent=[g[0]-S[0],g[1]-S[1]],c.endTangent=[r[0]-M[0],r[1]-M[1]],c.startTangent[0]===0&&c.startTangent[1]===0&&(c.startTangent=[S[0]-M[0],S[1]-M[1]]),c.endTangent[0]===0&&c.endTangent[1]===0&&(c.endTangent=[M[0]-S[0],M[1]-S[1]])}else if(u==="S"){var w=t[s-1],S=Aj(w.currentPoint,g),M=[l[1],l[2]];w.command==="C"?(c.command="C",c.startTangent=[g[0]-S[0],g[1]-S[1]],c.endTangent=[r[0]-M[0],r[1]-M[1]]):(c.command="SQ",c.startTangent=[g[0]-M[0],g[1]-M[1]],c.endTangent=[r[0]-M[0],r[1]-M[1]])}else if(u==="A"){var R=.001,I=c.arcParams||{},P=I.cx,k=P===void 0?0:P,z=I.cy,G=z===void 0?0:z,J=I.rx,Z=J===void 0?0:J,X=I.ry,et=X===void 0?0:X,at=I.sweepFlag,wt=at===void 0?0:at,Tt=I.startAngle,vt=Tt===void 0?0:Tt,zt=I.endAngle,oe=zt===void 0?0:zt;wt===0&&(R*=-1);var Qt=Z*Math.cos(vt-R)+k,ne=et*Math.sin(vt-R)+G;c.startTangent=[Qt-i[0],ne-i[1]];var de=Z*Math.cos(vt+oe+R)+k,De=et*Math.sin(vt+oe-R)+G;c.endTangent=[g[0]-de,g[1]-De]}t.push(c)}return t}function qhe(e,t){for(var r=[],n=[],i=[],a=0;a<e.length;a++){var o=e[a],s=o.currentPoint,l=o.params,u=o.prePoint,c=void 0;switch(o.command){case"Q":c=tlt.box(u[0],u[1],l[1],l[2],l[3],l[4]);break;case"C":c=dC.box(u[0],u[1],l[1],l[2],l[3],l[4],l[5],l[6]);break;case"A":var f=o.arcParams;c=Lhe.box(f.cx,f.cy,f.rx,f.ry,f.xRotation,f.startAngle,f.endAngle);break;default:r.push(s[0]),n.push(s[1]);break}c&&(o.box=c,r.push(c.x,c.x+c.width),n.push(c.y,c.y+c.height)),t&&(o.command==="L"||o.command==="M")&&o.prePoint&&o.nextPoint&&i.push(o)}r=r.filter(function(S){return!Number.isNaN(S)&&S!==1/0&&S!==-1/0}),n=n.filter(function(S){return!Number.isNaN(S)&&S!==1/0&&S!==-1/0});var d=f0(r),v=f0(n),g=h0(r),x=h0(n);if(i.length===0)return{x:d,y:v,width:g-d,height:x-v};for(var a=0;a<i.length;a++){var o=i[a],s=o.currentPoint,w=void 0;s[0]===d?(w=$A(o,t),d=d-w.xExtra):s[0]===g&&(w=$A(o,t),g=g+w.xExtra),s[1]===v?(w=$A(o,t),v=v-w.yExtra):s[1]===x&&(w=$A(o,t),x=x+w.yExtra)}return{x:d,y:v,width:g-d,height:x-v}}function $A(e,t){var r=e.prePoint,n=e.currentPoint,i=e.nextPoint,a=Math.pow(n[0]-r[0],2)+Math.pow(n[1]-r[1],2),o=Math.pow(n[0]-i[0],2)+Math.pow(n[1]-i[1],2),s=Math.pow(r[0]-i[0],2)+Math.pow(r[1]-i[1],2),l=Math.acos((a+o-s)/(2*Math.sqrt(a)*Math.sqrt(o)));if(!l||Math.sin(l)===0||tue(l,0))return{xExtra:0,yExtra:0};var u=Math.abs(Math.atan2(i[1]-n[1],i[0]-n[0])),c=Math.abs(Math.atan2(i[0]-n[0],i[1]-n[1]));u=u>Math.PI/2?Math.PI-u:u,c=c>Math.PI/2?Math.PI-c:c;var f={xExtra:Math.cos(l/2-u)*(t/2*(1/Math.sin(l/2)))-t/2||0,yExtra:Math.cos(c-l/2)*(t/2*(1/Math.sin(l/2)))-t/2||0};return f}function Khe(e){var t=e.attr(),r=t.path,n=t.stroke,i=n?t.lineWidth:0,a=e.get("segments")||slt(r),o=qhe(a,i),s=o.x,l=o.y,u=o.width,c=o.height,f={minX:s,minY:l,maxX:s+u,maxY:l+c};return f=l6(e,f),{x:f.minX,y:f.minY,width:f.maxX-f.minX,height:f.maxY-f.minY}}function Qhe(e){var t=e.attr(),r=t.x1,n=t.y1,i=t.x2,a=t.y2,o=Math.min(r,i),s=Math.max(r,i),l=Math.min(n,a),u=Math.max(n,a),c={minX:o,maxX:s,minY:l,maxY:u};return c=l6(e,c),{x:c.minX,y:c.minY,width:c.maxX-c.minX,height:c.maxY-c.minY}}function Jhe(e){var t=e.attr(),r=t.x,n=t.y,i=t.rx,a=t.ry;return{x:r-i,y:n-a,width:i*2,height:a*2}}cv("rect",qst);cv("image",qst);cv("circle",Kst);cv("marker",Kst);cv("polyline",Nhe);cv("polygon",khe);cv("text",$he);cv("path",Khe);cv("line",Qhe);cv("ellipse",Jhe);function tfe(){return window?window.devicePixelRatio:1}function llt(e,t,r,n){var i=e-r,a=t-n;return Math.sqrt(i*i+a*a)}function Ny(e,t,r,n,i,a){return i>=e&&i<=e+r&&a>=t&&a<=t+n}function uS(e,t){return!(t.minX>e.maxX||t.maxX<e.minX||t.minY>e.maxY||t.maxY<e.minY)}function efe(e,t){return!e||!t?e||t:{minX:Math.min(e.minX,t.minX),minY:Math.min(e.minY,t.minY),maxX:Math.max(e.maxX,t.maxX),maxY:Math.max(e.maxY,t.maxY)}}function Mj(e,t){return e[0]===t[0]&&e[1]===t[1]}var rfe=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,nfe=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,ife=/^p\s*\(\s*([axyn])\s*\)\s*(.*)/i,ult=/[\d.]+:(#[^\s]+|[^\)]+\))/gi;function clt(e,t){var r=e.match(ult);Aa(r,function(n){var i=n.split(":");t.addColorStop(i[0],i[1])})}function afe(e,t,r){var n=rfe.exec(r),i=parseFloat(n[1])%360*(Math.PI/180),a=n[2],o=t.getBBox(),s,l;i>=0&&i<1/2*Math.PI?(s={x:o.minX,y:o.minY},l={x:o.maxX,y:o.maxY}):1/2*Math.PI<=i&&i<Math.PI?(s={x:o.maxX,y:o.minY},l={x:o.minX,y:o.maxY}):Math.PI<=i&&i<3/2*Math.PI?(s={x:o.maxX,y:o.maxY},l={x:o.minX,y:o.minY}):(s={x:o.minX,y:o.maxY},l={x:o.maxX,y:o.minY});var u=Math.tan(i),c=u*u,f=(l.x-s.x+u*(l.y-s.y))/(c+1)+s.x,d=u*(l.x-s.x+u*(l.y-s.y))/(c+1)+s.y,v=e.createLinearGradient(s.x,s.y,f,d);return clt(a,v),v}function ofe(e,t,r){var n=nfe.exec(r),i=parseFloat(n[1]),a=parseFloat(n[2]),o=parseFloat(n[3]),s=n[4];if(o===0){var l=s.match(ult);return l[l.length-1].split(":")[1]}var u=t.getBBox(),c=u.maxX-u.minX,f=u.maxY-u.minY,d=Math.sqrt(c*c+f*f)/2,v=e.createRadialGradient(u.minX+c*i,u.minY+f*a,0,u.minX+c/2,u.minY+f/2,o*d);return clt(s,v),v}function sfe(e,t,r){if(t.get("patternSource")&&t.get("patternSource")===r)return t.get("pattern");var n,i,a=ife.exec(r),o=a[1],s=a[2];function l(){n=e.createPattern(i,o),t.set("pattern",n),t.set("patternSource",r)}switch(o){case"a":o="repeat";break;case"x":o="repeat-x";break;case"y":o="repeat-y";break;case"n":o="no-repeat";break;default:o="no-repeat"}return i=new Image,s.match(/^data:/i)||(i.crossOrigin="Anonymous"),i.src=s,i.complete?l():(i.onload=l,i.src=i.src),n}function lfe(e,t,r){var n=t.getBBox();if(isNaN(n.x)||isNaN(n.y)||isNaN(n.width)||isNaN(n.height))return r;if(qd(r)){if(r[1]==="("||r[2]==="("){if(r[0]==="l")return afe(e,t,r);if(r[0]==="r")return ofe(e,t,r);if(r[0]==="p")return sfe(e,t,r)}return r}if(r instanceof CanvasPattern)return r}function ufe(e){var t=0,r=0,n=0,i=0;return Qf(e)?e.length===1?t=r=n=i=e[0]:e.length===2?(t=n=e[0],r=i=e[1]):e.length===3?(t=e[0],r=i=e[1],n=e[2]):(t=e[0],r=e[1],n=e[2],i=e[3]):t=r=n=i=e,[t,r,n,i]}function HA(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function zB(e,t){return HA(e)*HA(t)?(e[0]*t[0]+e[1]*t[1])/(HA(e)*HA(t)):1}function Rj(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(zB(e,t))}function Ij(e,t){var r=t[1],n=t[2],i=xst(bst(t[3]),Math.PI*2),a=t[4],o=t[5],s=e[0],l=e[1],u=t[6],c=t[7],f=Math.cos(i)*(s-u)/2+Math.sin(i)*(l-c)/2,d=-1*Math.sin(i)*(s-u)/2+Math.cos(i)*(l-c)/2,v=f*f/(r*r)+d*d/(n*n);v>1&&(r*=Math.sqrt(v),n*=Math.sqrt(v));var g=r*r*(d*d)+n*n*(f*f),x=g?Math.sqrt((r*r*(n*n)-g)/g):1;a===o&&(x*=-1),isNaN(x)&&(x=0);var w=n?x*r*d/n:0,S=r?x*-n*f/r:0,M=(s+u)/2+Math.cos(i)*w-Math.sin(i)*S,R=(l+c)/2+Math.sin(i)*w+Math.cos(i)*S,I=[(f-w)/r,(d-S)/n],P=[(-1*f-w)/r,(-1*d-S)/n],k=Rj([1,0],I),z=Rj(I,P);return zB(I,P)<=-1&&(z=Math.PI),zB(I,P)>=1&&(z=0),o===0&&z>0&&(z=z-2*Math.PI),o===1&&z<0&&(z=z+2*Math.PI),{cx:M,cy:R,rx:Mj(e,[u,c])?0:r,ry:Mj(e,[u,c])?0:n,startAngle:k,endAngle:k+z,xRotation:i,arcFlag:a,sweepFlag:o}}var tI=Math.sin,eI=Math.cos,u6=Math.atan2,VA=Math.PI;function hlt(e,t,r,n,i,a,o){var s=t.stroke,l=t.lineWidth,u=r-i,c=n-a,f=u6(c,u),d=new p6({type:"path",canvas:e.get("canvas"),isArrowShape:!0,attrs:{path:"M"+10*eI(VA/6)+","+10*tI(VA/6)+" L0,0 L"+10*eI(VA/6)+",-"+10*tI(VA/6),stroke:s,lineWidth:l}});d.translate(i,a),d.rotateAtPoint(i,a,f),e.set(o?"startArrowShape":"endArrowShape",d)}function flt(e,t,r,n,i,a,o){var s=t.startArrow,l=t.endArrow,u=t.stroke,c=t.lineWidth,f=o?s:l,d=f.d,v=f.fill,g=f.stroke,x=f.lineWidth,w=H3(f,["d","fill","stroke","lineWidth"]),S=r-i,M=n-a,R=u6(M,S);d&&(i=i-eI(R)*d,a=a-tI(R)*d);var I=new p6({type:"path",canvas:e.get("canvas"),isArrowShape:!0,attrs:qt(qt({},w),{stroke:g||u,lineWidth:x||c,fill:v})});I.translate(i,a),I.rotateAtPoint(i,a,R),e.set(o?"startArrowShape":"endArrowShape",I)}function Zy(e,t,r,n,i){var a=u6(n-t,r-e);return{dx:eI(a)*i,dy:tI(a)*i}}function c6(e,t,r,n,i,a){typeof t.startArrow=="object"?flt(e,t,r,n,i,a,!0):t.startArrow?hlt(e,t,r,n,i,a,!0):e.set("startArrowShape",null)}function h6(e,t,r,n,i,a){typeof t.endArrow=="object"?flt(e,t,r,n,i,a,!1):t.endArrow?hlt(e,t,r,n,i,a,!1):e.set("startArrowShape",null)}var Lj={fill:"fillStyle",stroke:"strokeStyle",opacity:"globalAlpha"};function mb(e,t){var r=t.attr();for(var n in r){var i=r[n],a=Lj[n]?Lj[n]:n;a==="matrix"&&i?e.transform(i[0],i[1],i[3],i[4],i[6],i[7]):a==="lineDash"&&e.setLineDash?Qf(i)&&e.setLineDash(i):(a==="strokeStyle"||a==="fillStyle"?i=lfe(e,t,i):a==="globalAlpha"&&(i=i*e.globalAlpha),e[a]=i)}}function UB(e,t,r){for(var n=0;n<t.length;n++){var i=t[n];i.cfg.visible?i.draw(e,r):i.skipDraw()}}function cfe(e,t,r){var n=e.get("refreshElements");Aa(n,function(i){if(i!==e)for(var a=i.cfg.parent;a&&a!==e&&!a.cfg.refresh;)a.cfg.refresh=!0,a=a.cfg.parent}),n[0]===e?f6(t):$B(t,r)}function $B(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(n.cfg.visible)if(n.cfg.hasChanged)n.cfg.refresh=!0,n.isGroup()&&f6(n.cfg.children);else if(n.cfg.refresh)n.isGroup()&&$B(n.cfg.children,t);else{var i=hfe(n,t);n.cfg.refresh=i,i&&n.isGroup()&&$B(n.cfg.children,t)}}}function dlt(e){for(var t=0;t<e.length;t++){var r=e[t];r.cfg.hasChanged=!1,r.isGroup()&&!r.destroyed&&dlt(r.cfg.children)}}function f6(e,t){for(var r=0;r<e.length;r++){var n=e[r];n.cfg.visible&&(n.cfg.refresh=!0,n.isGroup()&&f6(n.get("children")))}}function hfe(e,t){var r=e.cfg.cacheCanvasBBox,n=e.cfg.isInView&&r&&uS(r,t);return n}function plt(e,t,r,n){var i=r.path,a=r.startArrow,o=r.endArrow;if(i){var s=[0,0],l=[0,0],u={dx:0,dy:0};t.beginPath();for(var c=0;c<i.length;c++){var f=i[c],d=f[0];if(c===0&&a&&a.d){var v=e.getStartTangent();u=Zy(v[0][0],v[0][1],v[1][0],v[1][1],a.d)}else if(c===i.length-2&&i[c+1][0]==="Z"&&o&&o.d){var g=i[c+1];if(g[0]==="Z"){var v=e.getEndTangent();u=Zy(v[0][0],v[0][1],v[1][0],v[1][1],o.d)}}else if(c===i.length-1&&o&&o.d&&i[0]!=="Z"){var v=e.getEndTangent();u=Zy(v[0][0],v[0][1],v[1][0],v[1][1],o.d)}var x=u.dx,w=u.dy;switch(d){case"M":t.moveTo(f[1]-x,f[2]-w),l=[f[1],f[2]];break;case"L":t.lineTo(f[1]-x,f[2]-w);break;case"Q":t.quadraticCurveTo(f[1],f[2],f[3]-x,f[4]-w);break;case"C":t.bezierCurveTo(f[1],f[2],f[3],f[4],f[5]-x,f[6]-w);break;case"A":{var S=void 0;n?(S=n[c],S||(S=Ij(s,f),n[c]=S)):S=Ij(s,f);var M=S.cx,R=S.cy,I=S.rx,P=S.ry,k=S.startAngle,z=S.endAngle,G=S.xRotation,J=S.sweepFlag;if(t.ellipse)t.ellipse(M,R,I,P,G,k,z,1-J);else{var Z=I>P?I:P,X=I>P?1:I/P,et=I>P?P/I:1;t.translate(M,R),t.rotate(G),t.scale(X,et),t.arc(0,0,Z,k,z,1-J),t.scale(1/X,1/et),t.rotate(-G),t.translate(-M,-R)}break}case"Z":t.closePath();break}if(d==="Z")s=l;else{var at=f.length;s=[f[at-2],f[at-1]]}}}}function vlt(e,t){var r=e.get("canvas");r&&(t==="remove"&&(e._cacheCanvasBBox=e.get("cacheCanvasBBox")),e.get("hasChanged")||(e.set("hasChanged",!0),e.cfg.parent&&e.cfg.parent.get("hasChanged")||(r.refreshElement(e,t,r),r.get("autoDraw")&&r.draw())))}function ffe(e){var t;if(e.destroyed)t=e._cacheCanvasBBox;else{var r=e.get("cacheCanvasBBox"),n=r&&!!(r.width&&r.height),i=e.getCanvasBBox(),a=i&&!!(i.width&&i.height);n&&a?t=efe(r,i):n?t=r:a&&(t=i)}return t}function dfe(e){if(!e.length)return null;var t=[],r=[],n=[],i=[];return Aa(e,function(a){var o=ffe(a);o&&(t.push(o.minX),r.push(o.minY),n.push(o.maxX),i.push(o.maxY))}),{minX:f0(t),minY:f0(r),maxX:h0(n),maxY:h0(i)}}function pfe(e,t){return!e||!t||!uS(e,t)?null:{minX:Math.max(e.minX,t.minX),minY:Math.max(e.minY,t.minY),maxX:Math.min(e.maxX,t.maxX),maxY:Math.min(e.maxY,t.maxY)}}var hv=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.onCanvasChange=function(r){vlt(this,r)},t.prototype.getShapeBase=function(){return t6},t.prototype.getGroupBase=function(){return t},t.prototype._applyClip=function(r,n){n&&(r.save(),mb(r,n),n.createPath(r),r.restore(),r.clip(),n._afterDraw())},t.prototype.cacheCanvasBBox=function(){var r=this.cfg.children,n=[],i=[];Aa(r,function(d){var v=d.cfg.cacheCanvasBBox;v&&d.cfg.isInView&&(n.push(v.minX,v.maxX),i.push(v.minY,v.maxY))});var a=null;if(n.length){var o=f0(n),s=h0(n),l=f0(i),u=h0(i);a={minX:o,minY:l,x:o,y:l,maxX:s,maxY:u,width:s-o,height:u-l};var c=this.cfg.canvas;if(c){var f=c.getViewRange();this.set("isInView",uS(a,f))}}else this.set("isInView",!1);this.set("cacheCanvasBBox",a)},t.prototype.draw=function(r,n){var i=this.cfg.children,a=n?this.cfg.refresh:!0;i.length&&a&&(r.save(),mb(r,this),this._applyClip(r,this.getClip()),UB(r,i,n),r.restore(),this.cacheCanvasBBox()),this.cfg.refresh=null,this.set("hasChanged",!1)},t.prototype.skipDraw=function(){this.set("cacheCanvasBBox",null),this.set("hasChanged",!1)},t}(xhe),vfe=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var r=e.prototype.getDefaultAttrs.call(this);return qt(qt({},r),{lineWidth:1,lineAppendWidth:0,strokeOpacity:1,fillOpacity:1})},t.prototype.getShapeBase=function(){return t6},t.prototype.getGroupBase=function(){return hv},t.prototype.onCanvasChange=function(r){vlt(this,r)},t.prototype.calculateBBox=function(){var r=this.get("type"),n=this.getHitLineWidth(),i=Ehe(r),a=i(this),o=n/2,s=a.x-o,l=a.y-o,u=a.x+a.width+o,c=a.y+a.height+o;return{x:s,minX:s,y:l,minY:l,width:a.width+n,height:a.height+n,maxX:u,maxY:c}},t.prototype.isFill=function(){return!!this.attrs.fill||this.isClipShape()},t.prototype.isStroke=function(){return!!this.attrs.stroke},t.prototype._applyClip=function(r,n){n&&(r.save(),mb(r,n),n.createPath(r),r.restore(),r.clip(),n._afterDraw())},t.prototype.draw=function(r,n){var i=this.cfg.clipShape;if(n){if(this.cfg.refresh===!1){this.set("hasChanged",!1);return}var a=this.getCanvasBBox();if(!uS(n,a)){this.set("hasChanged",!1),this.cfg.isInView&&this._afterDraw();return}}r.save(),mb(r,this),this._applyClip(r,i),this.drawPath(r),r.restore(),this._afterDraw()},t.prototype.getCanvasViewBox=function(){var r=this.cfg.canvas;return r?r.getViewRange():null},t.prototype.cacheCanvasBBox=function(){var r=this.getCanvasViewBox();if(r){var n=this.getCanvasBBox(),i=uS(n,r);this.set("isInView",i),i?this.set("cacheCanvasBBox",n):this.set("cacheCanvasBBox",null)}},t.prototype._afterDraw=function(){this.cacheCanvasBBox(),this.set("hasChanged",!1),this.set("refresh",null)},t.prototype.skipDraw=function(){this.set("cacheCanvasBBox",null),this.set("isInView",null),this.set("hasChanged",!1)},t.prototype.drawPath=function(r){this.createPath(r),this.strokeAndFill(r),this.afterDrawPath(r)},t.prototype.fill=function(r){r.fill()},t.prototype.stroke=function(r){r.stroke()},t.prototype.strokeAndFill=function(r){var n=this.attrs,i=n.lineWidth,a=n.opacity,o=n.strokeOpacity,s=n.fillOpacity;this.isFill()&&(!wl(s)&&s!==1?(r.globalAlpha=s,this.fill(r),r.globalAlpha=a):this.fill(r)),this.isStroke()&&i>0&&(!wl(o)&&o!==1&&(r.globalAlpha=o),this.stroke(r)),this.afterDrawPath(r)},t.prototype.createPath=function(r){},t.prototype.afterDrawPath=function(r){},t.prototype.isInShape=function(r,n){var i=this.isStroke(),a=this.isFill(),o=this.getHitLineWidth();return this.isInStrokeOrPath(r,n,i,a,o)},t.prototype.isInStrokeOrPath=function(r,n,i,a,o){return!1},t.prototype.getHitLineWidth=function(){if(!this.isStroke())return 0;var r=this.attrs;return r.lineWidth+r.lineAppendWidth},t}(bhe),ip=vfe,gfe=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var r=e.prototype.getDefaultAttrs.call(this);return qt(qt({},r),{x:0,y:0,r:0})},t.prototype.isInStrokeOrPath=function(r,n,i,a,o){var s=this.attr(),l=s.x,u=s.y,c=s.r,f=o/2,d=llt(l,u,r,n);return a&&i?d<=c+f:a?d<=c:i?d>=c-f&&d<=c+f:!1},t.prototype.createPath=function(r){var n=this.attr(),i=n.x,a=n.y,o=n.r;r.beginPath(),r.arc(i,a,o,0,Math.PI*2,!1),r.closePath()},t}(ip),mfe=gfe;function GA(e,t,r,n){return e/(r*r)+t/(n*n)}var yfe=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var r=e.prototype.getDefaultAttrs.call(this);return qt(qt({},r),{x:0,y:0,rx:0,ry:0})},t.prototype.isInStrokeOrPath=function(r,n,i,a,o){var s=this.attr(),l=o/2,u=s.x,c=s.y,f=s.rx,d=s.ry,v=(r-u)*(r-u),g=(n-c)*(n-c);return a&&i?GA(v,g,f+l,d+l)<=1:a?GA(v,g,f,d)<=1:i?GA(v,g,f-l,d-l)>=1&&GA(v,g,f+l,d+l)<=1:!1},t.prototype.createPath=function(r){var n=this.attr(),i=n.x,a=n.y,o=n.rx,s=n.ry;if(r.beginPath(),r.ellipse)r.ellipse(i,a,o,s,0,0,Math.PI*2,!1);else{var l=o>s?o:s,u=o>s?1:o/s,c=o>s?s/o:1;r.save(),r.translate(i,a),r.scale(u,c),r.arc(0,0,l,0,Math.PI*2),r.restore(),r.closePath()}},t}(ip),_fe=yfe;function Oj(e){return e instanceof HTMLElement&&qd(e.nodeName)&&e.nodeName.toUpperCase()==="CANVAS"}var xfe=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var r=e.prototype.getDefaultAttrs.call(this);return qt(qt({},r),{x:0,y:0,width:0,height:0})},t.prototype.initAttrs=function(r){this._setImage(r.img)},t.prototype.isStroke=function(){return!1},t.prototype.isOnlyHitBox=function(){return!0},t.prototype._afterLoading=function(){if(this.get("toDraw")===!0){var r=this.get("canvas");r?r.draw():this.createPath(this.get("context"))}},t.prototype._setImage=function(r){var n=this,i=this.attrs;if(qd(r)){var a=new Image;a.onload=function(){if(n.destroyed)return!1;n.attr("img",a),n.set("loading",!1),n._afterLoading();var o=n.get("callback");o&&o.call(n)},a.crossOrigin="Anonymous",a.src=r,this.set("loading",!0)}else r instanceof Image?(i.width||(i.width=r.width),i.height||(i.height=r.height)):Oj(r)&&(i.width||(i.width=Number(r.getAttribute("width"))),i.height||(i.height,Number(r.getAttribute("height"))))},t.prototype.onAttrChange=function(r,n,i){e.prototype.onAttrChange.call(this,r,n,i),r==="img"&&this._setImage(n)},t.prototype.createPath=function(r){if(this.get("loading")){this.set("toDraw",!0),this.set("context",r);return}var n=this.attr(),i=n.x,a=n.y,o=n.width,s=n.height,l=n.sx,u=n.sy,c=n.swidth,f=n.sheight,d=n.img;(d instanceof Image||Oj(d))&&(!wl(l)&&!wl(u)&&!wl(c)&&!wl(f)?r.drawImage(d,l,u,c,f,i,a,o,s):r.drawImage(d,i,a,o,s))},t}(ip),d6=xfe;function Vm(e,t,r,n,i,a,o){var s=Math.min(e,r),l=Math.max(e,r),u=Math.min(t,n),c=Math.max(t,n),f=i/2;return a>=s-f&&a<=l+f&&o>=u-f&&o<=c+f?jc.pointToLine(e,t,r,n,a,o)<=i/2:!1}var bfe=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var r=e.prototype.getDefaultAttrs.call(this);return qt(qt({},r),{x1:0,y1:0,x2:0,y2:0,startArrow:!1,endArrow:!1})},t.prototype.initAttrs=function(r){this.setArrow()},t.prototype.onAttrChange=function(r,n,i){e.prototype.onAttrChange.call(this,r,n,i),this.setArrow()},t.prototype.setArrow=function(){var r=this.attr(),n=r.x1,i=r.y1,a=r.x2,o=r.y2,s=r.startArrow,l=r.endArrow;s&&c6(this,r,a,o,n,i),l&&h6(this,r,n,i,a,o)},t.prototype.isInStrokeOrPath=function(r,n,i,a,o){if(!i||!o)return!1;var s=this.attr(),l=s.x1,u=s.y1,c=s.x2,f=s.y2;return Vm(l,u,c,f,o,r,n)},t.prototype.createPath=function(r){var n=this.attr(),i=n.x1,a=n.y1,o=n.x2,s=n.y2,l=n.startArrow,u=n.endArrow,c={dx:0,dy:0},f={dx:0,dy:0};l&&l.d&&(c=Zy(i,a,o,s,n.startArrow.d)),u&&u.d&&(f=Zy(i,a,o,s,n.endArrow.d)),r.beginPath(),r.moveTo(i+c.dx,a+c.dy),r.lineTo(o-f.dx,s-f.dy)},t.prototype.afterDrawPath=function(r){var n=this.get("startArrowShape"),i=this.get("endArrowShape");n&&n.draw(r),i&&i.draw(r)},t.prototype.getTotalLength=function(){var r=this.attr(),n=r.x1,i=r.y1,a=r.x2,o=r.y2;return jc.length(n,i,a,o)},t.prototype.getPoint=function(r){var n=this.attr(),i=n.x1,a=n.y1,o=n.x2,s=n.y2;return jc.pointAt(i,a,o,s,r)},t}(ip),Efe=bfe,wfe={circle:function(e,t,r){return[["M",e-r,t],["A",r,r,0,1,0,e+r,t],["A",r,r,0,1,0,e-r,t]]},square:function(e,t,r){return[["M",e-r,t-r],["L",e+r,t-r],["L",e+r,t+r],["L",e-r,t+r],["Z"]]},diamond:function(e,t,r){return[["M",e-r,t],["L",e,t-r],["L",e+r,t],["L",e,t+r],["Z"]]},triangle:function(e,t,r){var n=r*Math.sin(.3333333333333333*Math.PI);return[["M",e-r,t+n],["L",e,t-n],["L",e+r,t+n],["Z"]]},"triangle-down":function(e,t,r){var n=r*Math.sin(.3333333333333333*Math.PI);return[["M",e-r,t-n],["L",e+r,t-n],["L",e,t+n],["Z"]]}},Cfe=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.initAttrs=function(r){this._resetParamsCache()},t.prototype._resetParamsCache=function(){this.set("paramsCache",{})},t.prototype.onAttrChange=function(r,n,i){e.prototype.onAttrChange.call(this,r,n,i),["symbol","x","y","r","radius"].indexOf(r)!==-1&&this._resetParamsCache()},t.prototype.isOnlyHitBox=function(){return!0},t.prototype._getR=function(r){return wl(r.r)?r.radius:r.r},t.prototype._getPath=function(){var r=this.attr(),n=r.x,i=r.y,a=r.symbol||"circle",o=this._getR(r),s,l;if(v_(a))s=a,l=s(n,i,o),l=olt(l);else{if(s=t.Symbols[a],!s)return console.warn(a+" marker is not supported."),null;l=s(n,i,o)}return l},t.prototype.createPath=function(r){var n=this._getPath(),i=this.get("paramsCache");plt(this,r,{path:n},i)},t.Symbols=wfe,t}(ip),Sfe=Cfe;function glt(e,t,r){var n=nlt();return e.createPath(n),n.isPointInPath(t,r)}var Tfe=1e-6;function WP(e){return Math.abs(e)<Tfe?0:e<0?-1:1}function Afe(e,t,r){return(r[0]-e[0])*(t[1]-e[1])===(t[0]-e[0])*(r[1]-e[1])&&Math.min(e[0],t[0])<=r[0]&&r[0]<=Math.max(e[0],t[0])&&Math.min(e[1],t[1])<=r[1]&&r[1]<=Math.max(e[1],t[1])}function mlt(e,t,r){var n=!1,i=e.length;if(i<=2)return!1;for(var a=0;a<i;a++){var o=e[a],s=e[(a+1)%i];if(Afe(o,s,[t,r]))return!0;WP(o[1]-r)>0!=WP(s[1]-r)>0&&WP(t-(r-o[1])*(o[0]-s[0])/(o[1]-s[1])-o[0])<0&&(n=!n)}return n}function Ww(e,t,r,n,i,a,o,s){var l=(Math.atan2(s-t,o-e)+Math.PI*2)%(Math.PI*2);if(l<n||l>i)return!1;var u={x:e+r*Math.cos(l),y:t+r*Math.sin(l)};return llt(u.x,u.y,o,s)<=a/2}var Mfe=Lst;function Rfe(e){for(var t=!1,r=e.length,n=0;n<r;n++){var i=e[n],a=i[0];if(a==="C"||a==="A"||a==="Q"){t=!0;break}}return t}function Ife(e,t,r,n,i){for(var a=!1,o=t/2,s=0;s<e.length;s++){var l=e[s],u=l.currentPoint,c=l.params,f=l.prePoint,d=l.box;if(!(d&&!Ny(d.x-o,d.y-o,d.width+t,d.height+t,r,n))){switch(l.command){case"L":case"Z":a=Vm(f[0],f[1],u[0],u[1],t,r,n);break;case"Q":var v=tlt.pointDistance(f[0],f[1],c[1],c[2],c[3],c[4],r,n);a=v<=t/2;break;case"C":var g=dC.pointDistance(f[0],f[1],c[1],c[2],c[3],c[4],c[5],c[6],r,n,i);a=g<=t/2;break;case"A":var x=l.arcParams,w=x.cx,S=x.cy,M=x.rx,R=x.ry,I=x.startAngle,P=x.endAngle,k=x.xRotation,z=[r,n,1],G=M>R?M:R,J=M>R?1:M/R,Z=M>R?R/M:1,X=Mfe(null,[["t",-w,-S],["r",-k],["s",1/J,1/Z]]);Wue(z,z,X),a=Ww(0,0,G,I,P,t,z[0],z[1]);break}if(a)break}}return a}function Lfe(e){for(var t=e.length,r=[],n=[],i=[],a=0;a<t;a++){var o=e[a],s=o[0];s==="M"?(i.length&&(n.push(i),i=[]),i.push([o[1],o[2]])):s==="Z"?i.length&&(r.push(i),i=[]):i.push([o[1],o[2]])}return i.length>0&&n.push(i),{polygons:r,polylines:n}}var WA=qt({hasArc:Rfe,extractPolygons:Lfe,isPointInStroke:Ife},Cue);function Pj(e,t,r){for(var n=!1,i=0;i<e.length;i++){var a=e[i];if(n=mlt(a,t,r),n)break}return n}var Ofe=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var r=e.prototype.getDefaultAttrs.call(this);return qt(qt({},r),{startArrow:!1,endArrow:!1})},t.prototype.initAttrs=function(r){this._setPathArr(r.path),this.setArrow()},t.prototype.onAttrChange=function(r,n,i){e.prototype.onAttrChange.call(this,r,n,i),r==="path"&&this._setPathArr(n),this.setArrow()},t.prototype._setPathArr=function(r){this.attrs.path=olt(r);var n=WA.hasArc(r);this.set("hasArc",n),this.set("paramsCache",{}),this.set("segments",null),this.set("curve",null),this.set("tCache",null),this.set("totalLength",null)},t.prototype.getSegments=function(){var r=this.get("segements");return r||(r=slt(this.attr("path")),this.set("segments",r)),r},t.prototype.setArrow=function(){var r=this.attr(),n=r.startArrow,i=r.endArrow;if(n){var a=this.getStartTangent();c6(this,r,a[0][0],a[0][1],a[1][0],a[1][1])}if(i){var a=this.getEndTangent();h6(this,r,a[0][0],a[0][1],a[1][0],a[1][1])}},t.prototype.isInStrokeOrPath=function(r,n,i,a,o){var s=this.getSegments(),l=this.get("hasArc"),u=!1;if(i){var c=this.getTotalLength();u=WA.isPointInStroke(s,o,r,n,c)}if(!u&&a)if(l)u=glt(this,r,n);else{var f=this.attr("path"),d=WA.extractPolygons(f);u=Pj(d.polygons,r,n)||Pj(d.polylines,r,n)}return u},t.prototype.createPath=function(r){var n=this.attr(),i=this.get("paramsCache");plt(this,r,n,i)},t.prototype.afterDrawPath=function(r){var n=this.get("startArrowShape"),i=this.get("endArrowShape");n&&n.draw(r),i&&i.draw(r)},t.prototype.getTotalLength=function(){var r=this.get("totalLength");return wl(r)?(this._calculateCurve(),this._setTcache(),this.get("totalLength")):r},t.prototype.getPoint=function(r){var n=this.get("tCache");n||(this._calculateCurve(),this._setTcache(),n=this.get("tCache"));var i,a,o=this.get("curve");if(!n||n.length===0)return o?{x:o[0][1],y:o[0][2]}:null;Aa(n,function(c,f){r>=c[0]&&r<=c[1]&&(i=(r-c[0])/(c[1]-c[0]),a=f)});var s=o[a];if(wl(s)||wl(a))return null;var l=s.length,u=o[a+1];return dC.pointAt(s[l-2],s[l-1],u[1],u[2],u[3],u[4],u[5],u[6],i)},t.prototype._calculateCurve=function(){var r=this.attr().path;this.set("curve",WA.pathToCurve(r))},t.prototype._setTcache=function(){var r=0,n=0,i=[],a,o,s,l,u=this.get("curve");if(u){if(Aa(u,function(c,f){s=u[f+1],l=c.length,s&&(r+=dC.length(c[l-2],c[l-1],s[1],s[2],s[3],s[4],s[5],s[6])||0)}),this.set("totalLength",r),r===0){this.set("tCache",[]);return}Aa(u,function(c,f){s=u[f+1],l=c.length,s&&(a=[],a[0]=n/r,o=dC.length(c[l-2],c[l-1],s[1],s[2],s[3],s[4],s[5],s[6]),n+=o||0,a[1]=n/r,i.push(a))}),this.set("tCache",i)}},t.prototype.getStartTangent=function(){var r=this.getSegments(),n;if(r.length>1){var i=r[0].currentPoint,a=r[1].currentPoint,o=r[1].startTangent;n=[],o?(n.push([i[0]-o[0],i[1]-o[1]]),n.push([i[0],i[1]])):(n.push([a[0],a[1]]),n.push([i[0],i[1]]))}return n},t.prototype.getEndTangent=function(){var r=this.getSegments(),n=r.length,i;if(n>1){var a=r[n-2].currentPoint,o=r[n-1].currentPoint,s=r[n-1].endTangent;i=[],s?(i.push([o[0]-s[0],o[1]-s[1]]),i.push([o[0],o[1]])):(i.push([a[0],a[1]]),i.push([o[0],o[1]]))}return i},t}(ip),p6=Ofe;function ylt(e,t,r,n,i){var a=e.length;if(a<2)return!1;for(var o=0;o<a-1;o++){var s=e[o][0],l=e[o][1],u=e[o+1][0],c=e[o+1][1];if(Vm(s,l,u,c,t,r,n))return!0}if(i){var f=e[0],d=e[a-1];if(Vm(f[0],f[1],d[0],d[1],t,r,n))return!0}return!1}var Pfe=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.isInStrokeOrPath=function(r,n,i,a,o){var s=this.attr().points,l=!1;return i&&(l=ylt(s,o,r,n,!0)),!l&&a&&(l=mlt(s,r,n)),l},t.prototype.createPath=function(r){var n=this.attr(),i=n.points;if(!(i.length<2)){r.beginPath();for(var a=0;a<i.length;a++){var o=i[a];a===0?r.moveTo(o[0],o[1]):r.lineTo(o[0],o[1])}r.closePath()}},t}(ip),Dfe=Pfe,Ffe=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var r=e.prototype.getDefaultAttrs.call(this);return qt(qt({},r),{startArrow:!1,endArrow:!1})},t.prototype.initAttrs=function(r){this.setArrow()},t.prototype.onAttrChange=function(r,n,i){e.prototype.onAttrChange.call(this,r,n,i),this.setArrow(),["points"].indexOf(r)!==-1&&this._resetCache()},t.prototype._resetCache=function(){this.set("totalLength",null),this.set("tCache",null)},t.prototype.setArrow=function(){var r=this.attr(),n=this.attrs,i=n.points,a=n.startArrow,o=n.endArrow,s=i.length,l=i[0][0],u=i[0][1],c=i[s-1][0],f=i[s-1][1];a&&c6(this,r,i[1][0],i[1][1],l,u),o&&h6(this,r,i[s-2][0],i[s-2][1],c,f)},t.prototype.isFill=function(){return!1},t.prototype.isInStrokeOrPath=function(r,n,i,a,o){if(!i||!o)return!1;var s=this.attr().points;return ylt(s,o,r,n,!1)},t.prototype.isStroke=function(){return!0},t.prototype.createPath=function(r){var n=this.attr(),i=n.points,a=n.startArrow,o=n.endArrow,s=i.length;if(!(i.length<2)){var l=i[0][0],u=i[0][1],c=i[s-1][0],f=i[s-1][1];if(a&&a.d){var d=Zy(l,u,i[1][0],i[1][1],a.d);l+=d.dx,u+=d.dy}if(o&&o.d){var d=Zy(i[s-2][0],i[s-2][1],c,f,o.d);c-=d.dx,f-=d.dy}r.beginPath(),r.moveTo(l,u);for(var v=0;v<s-1;v++){var g=i[v];r.lineTo(g[0],g[1])}r.lineTo(c,f)}},t.prototype.afterDrawPath=function(r){var n=this.get("startArrowShape"),i=this.get("endArrowShape");n&&n.draw(r),i&&i.draw(r)},t.prototype.getTotalLength=function(){var r=this.attr().points,n=this.get("totalLength");return wl(n)?(this.set("totalLength",Bhe.length(r)),this.get("totalLength")):n},t.prototype.getPoint=function(r){var n=this.attr().points,i=this.get("tCache");i||(this._setTcache(),i=this.get("tCache"));var a,o;return Aa(i,function(s,l){r>=s[0]&&r<=s[1]&&(a=(r-s[0])/(s[1]-s[0]),o=l)}),jc.pointAt(n[o][0],n[o][1],n[o+1][0],n[o+1][1],a)},t.prototype._setTcache=function(){var r=this.attr().points;if(!(!r||r.length===0)){var n=this.getTotalLength();if(!(n<=0)){var i=0,a=[],o,s;Aa(r,function(l,u){r[u+1]&&(o=[],o[0]=i/n,s=jc.length(l[0],l[1],r[u+1][0],r[u+1][1]),i+=s,o[1]=i/n,a.push(o))}),this.set("tCache",a)}}},t.prototype.getStartTangent=function(){var r=this.attr().points,n=[];return n.push([r[1][0],r[1][1]]),n.push([r[0][0],r[0][1]]),n},t.prototype.getEndTangent=function(){var r=this.attr().points,n=r.length-1,i=[];return i.push([r[n-1][0],r[n-1][1]]),i.push([r[n][0],r[n][1]]),i},t}(ip),Bfe=Ffe;function Nfe(e,t,r,n,i,a,o){var s=i/2;return Ny(e-s,t-s,r,i,a,o)||Ny(e+r-s,t-s,i,n,a,o)||Ny(e+s,t+n-s,r,i,a,o)||Ny(e-s,t+s,i,n,a,o)}function kfe(e,t,r,n,i,a,o,s){return Vm(e+i,t,e+r-i,t,a,o,s)||Vm(e+r,t+i,e+r,t+n-i,a,o,s)||Vm(e+r-i,t+n,e+i,t+n,a,o,s)||Vm(e,t+n-i,e,t+i,a,o,s)||Ww(e+r-i,t+i,i,1.5*Math.PI,2*Math.PI,a,o,s)||Ww(e+r-i,t+n-i,i,0,.5*Math.PI,a,o,s)||Ww(e+i,t+n-i,i,.5*Math.PI,Math.PI,a,o,s)||Ww(e+i,t+i,i,Math.PI,1.5*Math.PI,a,o,s)}var zfe=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var r=e.prototype.getDefaultAttrs.call(this);return qt(qt({},r),{x:0,y:0,width:0,height:0,radius:0})},t.prototype.isInStrokeOrPath=function(r,n,i,a,o){var s=this.attr(),l=s.x,u=s.y,c=s.width,f=s.height,d=s.radius;if(d){var g=!1;return i&&(g=kfe(l,u,c,f,d,o,r,n)),!g&&a&&(g=glt(this,r,n)),g}else{var v=o/2;if(a&&i)return Ny(l-v,u-v,c+v,f+v,r,n);if(a)return Ny(l,u,c,f,r,n);if(i)return Nfe(l,u,c,f,o,r,n)}},t.prototype.createPath=function(r){var n=this.attr(),i=n.x,a=n.y,o=n.width,s=n.height,l=n.radius;if(r.beginPath(),l===0)r.rect(i,a,o,s);else{var u=ufe(l),c=u[0],f=u[1],d=u[2],v=u[3];r.moveTo(i+c,a),r.lineTo(i+o-f,a),f!==0&&r.arc(i+o-f,a+f,f,-Math.PI/2,0),r.lineTo(i+o,a+s-d),d!==0&&r.arc(i+o-d,a+s-d,d,0,Math.PI/2),r.lineTo(i+v,a+s),v!==0&&r.arc(i+v,a+s-v,v,Math.PI/2,Math.PI),r.lineTo(i,a+c),c!==0&&r.arc(i+c,a+c,c,Math.PI,Math.PI*1.5),r.closePath()}},t}(ip),Ufe=zfe,$fe=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultAttrs=function(){var r=e.prototype.getDefaultAttrs.call(this);return qt(qt({},r),{x:0,y:0,text:null,fontSize:12,fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"normal",fontVariant:"normal",textAlign:"start",textBaseline:"bottom"})},t.prototype.isOnlyHitBox=function(){return!0},t.prototype.initAttrs=function(r){this._assembleFont(),r.text&&this._setText(r.text)},t.prototype._assembleFont=function(){var r=this.attrs;r.font=alt(r)},t.prototype._setText=function(r){var n=null;qd(r)&&r.indexOf(`
`)!==-1&&(n=r.split(`
`)),this.set("textArr",n)},t.prototype.onAttrChange=function(r,n,i){e.prototype.onAttrChange.call(this,r,n,i),r.startsWith("font")&&this._assembleFont(),r==="text"&&this._setText(n)},t.prototype._getSpaceingY=function(){var r=this.attrs,n=r.lineHeight,i=r.fontSize*1;return n?n-i:i*.14},t.prototype._drawTextArr=function(r,n,i){var a=this.attrs,o=a.textBaseline,s=a.x,l=a.y,u=a.fontSize*1,c=this._getSpaceingY(),f=ilt(a.text,a.fontSize,a.lineHeight),d;Aa(n,function(v,g){d=l+g*(c+u)-f+u,o==="middle"&&(d+=f-u-(f-u)/2),o==="top"&&(d+=f-u),wl(v)||(i?r.fillText(v,s,d):r.strokeText(v,s,d))})},t.prototype._drawText=function(r,n){var i=this.attr(),a=i.x,o=i.y,s=this.get("textArr");if(s)this._drawTextArr(r,s,n);else{var l=i.text;wl(l)||(n?r.fillText(l,a,o):r.strokeText(l,a,o))}},t.prototype.strokeAndFill=function(r){var n=this.attrs,i=n.lineWidth,a=n.opacity,o=n.strokeOpacity,s=n.fillOpacity;this.isStroke()&&i>0&&(!wl(o)&&o!==1&&(r.globalAlpha=a),this.stroke(r)),this.isFill()&&(!wl(s)&&s!==1?(r.globalAlpha=s,this.fill(r),r.globalAlpha=a):this.fill(r)),this.afterDrawPath(r)},t.prototype.fill=function(r){this._drawText(r,!0)},t.prototype.stroke=function(r){this._drawText(r,!1)},t}(ip),Hfe=$fe;function Vfe(e,t){if(t){var r=Ost(t);return Fy(r,e)}return e}function _lt(e,t,r){var n=e.getTotalMatrix();if(n){var i=Vfe([t,r,1],n),a=i[0],o=i[1];return[a,o]}return[t,r]}function Dj(e,t,r){if(e.isCanvas&&e.isCanvas())return!0;if(!AB(e)||e.cfg.isInView===!1)return!1;if(e.cfg.clipShape){var n=_lt(e,t,r),i=n[0],a=n[1];if(e.isClipped(i,a))return!1}var o=e.cfg.cacheCanvasBBox||e.getCanvasBBox();return t>=o.minX&&t<=o.maxX&&r>=o.minY&&r<=o.maxY}function xlt(e,t,r){if(!Dj(e,t,r))return null;for(var n=null,i=e.getChildren(),a=i.length,o=a-1;o>=0;o--){var s=i[o];if(s.isGroup())n=xlt(s,t,r);else if(Dj(s,t,r)){var l=s,u=_lt(s,t,r),c=u[0],f=u[1];l.isInShape(c,f)&&(n=s)}if(n)break}return n}var Fj=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDefaultCfg=function(){var r=e.prototype.getDefaultCfg.call(this);return r.renderer="canvas",r.autoDraw=!0,r.localRefresh=!0,r.refreshElements=[],r.clipView=!0,r.quickHit=!1,r},t.prototype.onCanvasChange=function(r){(r==="attr"||r==="sort"||r==="changeSize")&&(this.set("refreshElements",[this]),this.draw())},t.prototype.getShapeBase=function(){return t6},t.prototype.getGroupBase=function(){return hv},t.prototype.getPixelRatio=function(){var r=this.get("pixelRatio")||tfe();return r>=1?Math.ceil(r):1},t.prototype.getViewRange=function(){return{minX:0,minY:0,maxX:this.cfg.width,maxY:this.cfg.height}},t.prototype.createDom=function(){var r=document.createElement("canvas"),n=r.getContext("2d");return this.set("context",n),r},t.prototype.setDOMSize=function(r,n){e.prototype.setDOMSize.call(this,r,n);var i=this.get("context"),a=this.get("el"),o=this.getPixelRatio();a.width=o*r,a.height=o*n,o>1&&i.scale(o,o)},t.prototype.clear=function(){e.prototype.clear.call(this),this._clearFrame();var r=this.get("context"),n=this.get("el");r.clearRect(0,0,n.width,n.height)},t.prototype.getShape=function(r,n){var i;return this.get("quickHit")?i=xlt(this,r,n):i=e.prototype.getShape.call(this,r,n,null),i},t.prototype._getRefreshRegion=function(){var r=this.get("refreshElements"),n=this.getViewRange(),i;if(r.length&&r[0]===this)i=n;else if(i=dfe(r),i){i.minX=Math.floor(i.minX),i.minY=Math.floor(i.minY),i.maxX=Math.ceil(i.maxX),i.maxY=Math.ceil(i.maxY),i.maxY+=1;var a=this.get("clipView");a&&(i=pfe(i,n))}return i},t.prototype.refreshElement=function(r){var n=this.get("refreshElements");n.push(r)},t.prototype._clearFrame=function(){var r=this.get("drawFrame");r&&(aue(r),this.set("drawFrame",null),this.set("refreshElements",[]))},t.prototype.draw=function(){var r=this.get("drawFrame");this.get("autoDraw")&&r||this._startDraw()},t.prototype._drawAll=function(){var r=this.get("context"),n=this.get("el"),i=this.getChildren();r.clearRect(0,0,n.width,n.height),mb(r,this),UB(r,i),this.set("refreshElements",[])},t.prototype._drawRegion=function(){var r=this.get("context"),n=this.get("refreshElements"),i=this.getChildren(),a=this._getRefreshRegion();a?(r.clearRect(a.minX,a.minY,a.maxX-a.minX,a.maxY-a.minY),r.save(),r.beginPath(),r.rect(a.minX,a.minY,a.maxX-a.minX,a.maxY-a.minY),r.clip(),mb(r,this),cfe(this,i,a),UB(r,i,a),r.restore()):n.length&&dlt(n),Aa(n,function(o){o.get("hasChanged")&&o.set("hasChanged",!1)}),this.set("refreshElements",[])},t.prototype._startDraw=function(){var r=this,n=this.get("drawFrame");n||(n=iue(function(){r.get("localRefresh")?r._drawRegion():r._drawAll(),r.set("drawFrame",null)}),this.set("drawFrame",n))},t.prototype.skipDraw=function(){},t.prototype.removeDom=function(){var r=this.get("el");r.width=0,r.height=0,r.parentNode.removeChild(r)},t}(_he),Zc="$$value$$",Fi="$$extra$$",v6="$$origin$$",Gfe="$$extra_column$$",av="$$total$$",MM="$$multi$$",m_="$$series_number$$",$_="$$empty_field_value$$",g6="$$empty_extra_placeholder$$",Bj;(function(e){e.DATA_CELL_CLICK_EVENT="interaction:data-cell-click",e.MERGED_CELLS_CLICK_EVENT="interaction:merged-cells-click",e.CORNER_TEXT_CLICK_EVENT="interaction:corner-cell-text-click",e.ROW_COLUMN_CLICK_EVENT="interaction:row-column-click",e.ROW_TEXT_CLICK_EVENT="interaction:row-text-click",e.HOVER_EVENT="interaction:hover",e.TREND_ICON_CLICK="interaction:trend-icon-click"})(Bj||(Bj={}));var nc;(function(e){e.MOUSE_DOWN="mousedown",e.MOUSE_MOVE="mousemove",e.MOUSE_OUT="mouseout",e.MOUSE_LEAVE="mouseleave",e.MOUSE_UP="mouseup",e.KEY_DOWN="keydown",e.KEY_UP="keyup",e.CLICK="click",e.HOVER="hover",e.DOUBLE_CLICK="dblclick",e.CONTEXT_MENU="contextmenu"})(nc||(nc={}));var Re;(function(e){e.ROW_CELL_HOVER="row-cell:hover",e.ROW_CELL_CLICK="row-cell:click",e.ROW_CELL_DOUBLE_CLICK="row-cell:double-click",e.ROW_CELL_CONTEXT_MENU="row-cell:context-menu",e.ROW_CELL_MOUSE_DOWN="row-cell:mouse-down",e.ROW_CELL_MOUSE_UP="row-cell:mouse-up",e.ROW_CELL_MOUSE_MOVE="row-cell:mouse-move",e.ROW_CELL_COLLAPSE_TREE_ROWS="row-cell:collapsed-tree-rows",e.ROW_CELL_SCROLL="row-cell:scroll",e.ROW_CELL_BRUSH_SELECTION="row-cell:brush-selection",e.COL_CELL_HOVER="col-cell:hover",e.COL_CELL_CLICK="col-cell:click",e.COL_CELL_DOUBLE_CLICK="col-cell:double-click",e.COL_CELL_CONTEXT_MENU="col-cell:context-menu",e.COL_CELL_MOUSE_DOWN="col-cell:mouse-down",e.COL_CELL_MOUSE_UP="col-cell:mouse-up",e.COL_CELL_MOUSE_MOVE="col-cell:mouse-move",e.COL_CELL_BRUSH_SELECTION="col-cell:brush-selection",e.DATA_CELL_HOVER="data-cell:hover",e.DATA_CELL_CLICK="data-cell:click",e.DATA_CELL_DOUBLE_CLICK="data-cell:double-click",e.DATA_CELL_CONTEXT_MENU="data-cell:context-menu",e.DATA_CELL_MOUSE_UP="data-cell:mouse-up",e.DATA_CELL_MOUSE_DOWN="data-cell:mouse-down",e.DATA_CELL_MOUSE_MOVE="data-cell:mouse-move",e.DATA_CELL_TREND_ICON_CLICK="data-cell:trend-icon-click",e.DATA_CELL_BRUSH_SELECTION="data-cell:brush-selection",e.DATA_CELL_SELECT_MOVE="data-cell:select-move",e.CORNER_CELL_HOVER="corner-cell:hover",e.CORNER_CELL_CLICK="corner-cell:click",e.CORNER_CELL_DOUBLE_CLICK="corner-cell:double-click",e.CORNER_CELL_CONTEXT_MENU="corner-cell:context-menu",e.CORNER_CELL_MOUSE_DOWN="corner-cell:mouse-down",e.CORNER_CELL_MOUSE_UP="corner-cell:mouse-up",e.CORNER_CELL_MOUSE_MOVE="corner-cell:mouse-move",e.MERGED_CELLS_HOVER="merged-cells:hover",e.MERGED_CELLS_CLICK="merged-cells:click",e.MERGED_CELLS_DOUBLE_CLICK="merged-cells:double-click",e.MERGED_CELLS_CONTEXT_MENU="merged-cell:context-menu",e.MERGED_CELLS_MOUSE_DOWN="merged-cells:mouse-down",e.MERGED_CELLS_MOUSE_UP="merged-cells:mouse-up",e.MERGED_CELLS_MOUSE_MOVE="merged-cells:mouse-move",e.RANGE_SORT="sort:range-sort",e.RANGE_SORTED="sort:range-sorted",e.RANGE_FILTER="filter:range-filter",e.RANGE_FILTERED="filter:range-filtered",e.LAYOUT_AFTER_HEADER_LAYOUT="layout:after-header-layout",e.LAYOUT_CELL_SCROLL="layout:cell-scroll",e.LAYOUT_PAGINATION="layout:pagination",e.LAYOUT_COLLAPSE_ROWS="layout:collapsed-rows",e.LAYOUT_AFTER_COLLAPSE_ROWS="layout:after-collapsed-rows",e.LAYOUT_AFTER_REAL_DATA_CELL_RENDER="layout:after-real-data-cell-render",e.LAYOUT_TREE_ROWS_COLLAPSE_ALL="layout:toggle-collapse-all",e.LAYOUT_COLS_EXPANDED="layout:table-col-expanded",e.LAYOUT_COLS_HIDDEN="layout:table-col-hidden",e.LAYOUT_AFTER_RENDER="layout:after-render",e.LAYOUT_BEFORE_RENDER="layout:before-render",e.LAYOUT_DESTROY="layout:destroy",e.LAYOUT_RESIZE="layout:resize",e.LAYOUT_RESIZE_SERIES_WIDTH="layout:resize-series-width",e.LAYOUT_RESIZE_ROW_WIDTH="layout:resize-row-width",e.LAYOUT_RESIZE_ROW_HEIGHT="layout:resize-row-height",e.LAYOUT_RESIZE_COL_WIDTH="layout:resize-column-width",e.LAYOUT_RESIZE_COL_HEIGHT="layout:resize-column-height",e.LAYOUT_RESIZE_TREE_WIDTH="layout:resize-tree-width",e.LAYOUT_RESIZE_MOUSE_DOWN="layout:resize:mouse-down",e.LAYOUT_RESIZE_MOUSE_MOVE="layout:resize:mouse-move",e.LAYOUT_RESIZE_MOUSE_UP="layout:resize-mouse-up",e.GLOBAL_KEYBOARD_DOWN="global:keyboard-down",e.GLOBAL_KEYBOARD_UP="global:keyboard-up",e.GLOBAL_COPIED="global:copied",e.GLOBAL_MOUSE_UP="global:mouse-up",e.GLOBAL_MOUSE_MOVE="global:mouse-move",e.GLOBAL_ACTION_ICON_CLICK="global:action-icon-click",e.GLOBAL_ACTION_ICON_HOVER="global:action-icon-hover",e.GLOBAL_ACTION_ICON_HOVER_OFF="global:action-icon-hover-off",e.GLOBAL_CONTEXT_MENU="global:context-menu",e.GLOBAL_CLICK="global:click",e.GLOBAL_DOUBLE_CLICK="global:double-click",e.GLOBAL_SELECTED="global:selected",e.GLOBAL_HOVER="global:hover",e.GLOBAL_RESET="global:reset",e.GLOBAL_LINK_FIELD_JUMP="global:link-field-jump",e.GLOBAL_SCROLL="global:scroll"})(Re||(Re={}));var Wfe=0,Xfe=3,blt=3,cS=4,jfe=5,Yfe=5,Zfe=1,qfe=1,Elt=2,Kfe="backGroundGroup",Qfe="foreGroundGroup",Jfe="panelGroup",tde="panelScrollGroup",Nj="mergedCellsGroup",wlt="frozenRowGroup",Clt="frozenColGroup",ede="frozenTrailingRowGroup",rde="frozenTrailingColGroup",nde="frozenTopGroup",ide="frozenBottomGroup",yb="rowResizeAreaGroup",Slt="rowFrozenResizeAreaGroup",rI="frozenSplitLine",kj="rowIndexResizeAreaGroup",HB="cornerResizeAreaGroup",Tlt="colResizeAreaGroup",Alt="colFrozenResizeAreaGroup",ade="colScrollGroup",ode="colFrozenGroup",sde="colFrozenTrailingGroup",zj="gridGroup",lde="rowScrollGroup",ude="rowHeaderFrozenGroup",cde="series-number-node",Mlt="horizontal-resize-area-",Rlt="root",Bu="[&]",VB="-",Y3="-",Uj=28,$j=16,Ilt=16,hde=.5,XP=50,_b;(function(e){e.Line="line",e.Bar="bar",e.Bullet="bullet"})(_b||(_b={}));var Hj="square",Dx="...",fde="antv-s2",nI="valueRanges",m6={},Llt="#000000",GB="#FFFFFF",dde={data:[],totalData:[],fields:{rows:[],columns:[],values:[],customTreeItems:[],valueInCols:!0},meta:[],sortParams:[],filterParams:[]},qv,el;(function(e){e.ROW="row",e.COL="col",e.TRAILING_ROW="trailingRow",e.TRAILING_COL="trailingCol",e.SCROLL="scroll",e.TOP="top",e.BOTTOM="bottom"})(el||(el={}));var Ff;(function(e){e.FROZEN_COL="frozenCol",e.FROZEN_ROW="frozenRow",e.FROZEN_TRAILING_COL="frozenTrailingCol",e.FROZEN_TRAILING_ROW="frozenTrailingRow"})(Ff||(Ff={}));var Olt=(qv={},qv[el.ROW]="frozenRowGroup",qv[el.COL]="frozenColGroup",qv[el.TRAILING_COL]="frozenTrailingColGroup",qv[el.TRAILING_ROW]="frozenTrailingRowGroup",qv[el.SCROLL]="panelScrollGroup",qv[el.TOP]="frozenTopGroup",qv[el.BOTTOM]="frozenBottomGroup",qv),rc;(function(e){e.CORNER_CELL_CLICK="cornerCellClick",e.DATA_CELL_CLICK="dataCellClick",e.MERGED_CELLS_CLICK="mergedCellsClick",e.ROW_COLUMN_CLICK="rowColumnClick",e.ROW_TEXT_CLICK="rowTextClick",e.HOVER="hover",e.BRUSH_SELECTION="brushSelection",e.ROW_BRUSH_SELECTION="rowBrushSelection",e.COL_BRUSH_SELECTION="colBrushSelection",e.COL_ROW_RESIZE="rowColResize",e.DATA_CELL_MULTI_SELECTION="dataCellMultiSelection",e.RANGE_SELECTION="rangeSelection",e.SELECTED_CELL_MOVE="selectedCellMove"})(rc||(rc={}));var Dn;(function(e){e.ALL_SELECTED="allSelected",e.SELECTED="selected",e.BRUSH_SELECTED="brushSelected",e.UNSELECTED="unselected",e.HOVER="hover",e.HOVER_FOCUS="hoverFocus",e.HIGHLIGHT="highlight",e.SEARCH_RESULT="searchResult",e.PREPARE_SELECT="prepareSelect"})(Dn||(Dn={}));var kr;(function(e){e.DATA_CELL="dataCell",e.HEADER_CELL="headerCell",e.ROW_CELL="rowCell",e.COL_CELL="colCell",e.CORNER_CELL="cornerCell",e.MERGED_CELL="mergedCell"})(kr||(kr={}));var WB=800,Fh={textOpacity:"fillOpacity",backgroundOpacity:"fillOpacity",backgroundColor:"fill",borderOpacity:"strokeOpacity",borderColor:"stroke",borderWidth:"lineWidth",opacity:"opacity"},pde={textShape:["textOpacity"],textShapes:["textOpacity"],linkFieldShape:["opacity"],interactiveBgShape:["backgroundColor","backgroundOpacity"],interactiveBorderShape:["borderColor","borderOpacity","borderWidth"]},XB="interactionStateInfo",Du;(function(e){e.CLICK="click",e.UN_DRAGGED="unDragged",e.DRAGGED="dragged"})(Du||(Du={}));var Nu;(function(e){e.SHIFT="Shift",e.COPY="c",e.ESC="Escape",e.META="Meta",e.CONTROL="Control",e.ARROW_UP="ArrowUp",e.ARROW_DOWN="ArrowDown",e.ARROW_LEFT="ArrowLeft",e.ARROW_RIGHT="ArrowRight"})(Nu||(Nu={}));var Vj;(function(e){e.ASC="ASC",e.DESC="DESC"})(Vj||(Vj={}));var Ai;(function(e){e.HOVER="hover",e.CLICK="click",e.BRUSH_SELECTION="brushSelection",e.ROW_BRUSH_SELECTION="rowBrushSelection",e.COL_BRUSH_SELECTION="colBrushSelection",e.MULTI_SELECTION="multiSelection",e.RESIZE="resize"})(Ai||(Ai={}));var Gj={x:{value:0,scroll:!1},y:{value:0,scroll:!1}},iI;(function(e){e.CONTENT="content",e.CANVAS="canvas"})(iI||(iI={}));var zl;(function(e){e.SCROLL_UP="scrollUp",e.SCROLL_DOWN="scrollDown"})(zl||(zl={}));var aI;(function(e){e[e.SCROLL_UP=-1]="SCROLL_UP",e[e.SCROLL_DOWN=1]="SCROLL_DOWN"})(aI||(aI={}));var vde="RESIZE_START_GUIDE_LINE",gde="RESIZE_END_GUIDE_LINE",mde="RESIZE_MASK",jf;(function(e){e.Horizontal="col",e.Vertical="row"})(jf||(jf={}));var ic;(function(e){e.Field="field",e.Cell="cell",e.Tree="tree",e.Series="series"})(ic||(ic={}));var oI;(function(e){e.ALL="all",e.CURRENT="current"})(oI||(oI={}));var Plt=1,y_;(function(e){e.Adaptive="adaptive",e.ColAdaptive="colAdaptive",e.Compact="compact"})(y_||(y_={}));var Wj=120,yde={layoutWidthType:y_.Adaptive,showTreeLeafNodeAlignDot:!1,collapsedRows:{},collapsedCols:{},cellCfg:{width:96,height:30},rowCfg:{width:null,widthByField:{},heightByField:{}},colCfg:{height:30,widthByFieldValue:{},heightByField:{}},device:"pc"},_de={width:600,height:480,debug:!1,hierarchyType:"grid",conditions:{},totals:{},tooltip:{showTooltip:!1,autoAdjustBoundary:"body",operation:{hiddenColumns:!1,trend:!1,sort:!1,menus:[]}},interaction:{linkFields:[],hiddenColumnFields:[],selectedCellsSpotlight:!1,hoverHighlight:!0,hoverFocus:{duration:WB},scrollSpeedRatio:{horizontal:1,vertical:1},autoResetSheetStyle:!0,brushSelection:{data:!0,row:!1,col:!1},multiSelection:!0,rangeSelection:!0,scrollbarPosition:iI.CONTENT,resize:{rowCellVertical:!0,cornerCellHorizontal:!0,colCellHorizontal:!0,colCellVertical:!0,rowResizeType:oI.ALL},eventListenerOptions:!1,selectedCellHighlight:!1,overscrollBehavior:"auto"},showSeriesNumber:!1,customSVGIcons:[],showDefaultHeaderActionIcon:!1,headerActionIcons:[],style:yde,frozenRowHeader:!0,frozenRowCount:0,frozenColCount:0,frozenTrailingRowCount:0,frozenTrailingColCount:0,hdAdapter:!0,cornerText:"",cornerExtraFieldText:"",placeholder:Y3,supportCSSTransform:!1,devicePixelRatio:window.devicePixelRatio},xde=typeof global=="object"&&global&&global.Object===Object&&global,Dlt=xde,bde=typeof self=="object"&&self&&self.Object===Object&&self,Ede=Dlt||bde||Function("return this")(),Zl=Ede,wde=Zl.Symbol,$u=wde,Flt=Object.prototype,Cde=Flt.hasOwnProperty,Sde=Flt.toString,_w=$u?$u.toStringTag:void 0;function Tde(e){var t=Cde.call(e,_w),r=e[_w];try{e[_w]=void 0;var n=!0}catch{}var i=Sde.call(e);return n&&(t?e[_w]=r:delete e[_w]),i}var Ade=Object.prototype,Mde=Ade.toString;function Rde(e){return Mde.call(e)}var Ide="[object Null]",Lde="[object Undefined]",Xj=$u?$u.toStringTag:void 0;function dc(e){return e==null?e===void 0?Lde:Ide:Xj&&Xj in Object(e)?Tde(e):Rde(e)}function Fs(e){return e!=null&&typeof e=="object"}var Ode="[object Symbol]";function Xh(e){return typeof e=="symbol"||Fs(e)&&dc(e)==Ode}var Pde=0/0;function jj(e){return typeof e=="number"?e:Xh(e)?Pde:+e}function rs(e,t){for(var r=-1,n=e==null?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}var Dde=Array.isArray,Xn=Dde,Fde=1/0,Yj=$u?$u.prototype:void 0,Zj=Yj?Yj.toString:void 0;function jh(e){if(typeof e=="string")return e;if(Xn(e))return rs(e,jh)+"";if(Xh(e))return Zj?Zj.call(e):"";var t=e+"";return t=="0"&&1/e==-Fde?"-0":t}function Z3(e,t){return function(r,n){var i;if(r===void 0&&n===void 0)return t;if(r!==void 0&&(i=r),n!==void 0){if(i===void 0)return n;typeof r=="string"||typeof n=="string"?(r=jh(r),n=jh(n)):(r=jj(r),n=jj(n)),i=e(r,n)}return i}}var Bde=Z3(function(e,t){return e+t},0),Nde=Bde,kde=/\s/;function Blt(e){for(var t=e.length;t--&&kde.test(e.charAt(t)););return t}var zde=/^\s+/;function Nlt(e){return e&&e.slice(0,Blt(e)+1).replace(zde,"")}function ro(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var qj=0/0,Ude=/^[-+]0x[0-9a-f]+$/i,$de=/^0b[01]+$/i,Hde=/^0o[0-7]+$/i,Vde=parseInt;function Hh(e){if(typeof e=="number")return e;if(Xh(e))return qj;if(ro(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ro(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Nlt(e);var r=$de.test(e);return r||Hde.test(e)?Vde(e.slice(2),r?2:8):Ude.test(e)?qj:+e}var Kj=1/0,Gde=17976931348623157e292;function mg(e){if(!e)return e===0?e:0;if(e=Hh(e),e===Kj||e===-Kj){var t=e<0?-1:1;return t*Gde}return e===e?e:0}function $i(e){var t=mg(e),r=t%1;return t===t?r?t-r:t:0}var Wde="Expected a function";function Xde(e,t){if(typeof t!="function")throw new TypeError(Wde);return e=$i(e),function(){if(--e<1)return t.apply(this,arguments)}}function Wu(e){return e}var jde="[object AsyncFunction]",Yde="[object Function]",Zde="[object GeneratorFunction]",qde="[object Proxy]";function mu(e){if(!ro(e))return!1;var t=dc(e);return t==Yde||t==Zde||t==jde||t==qde}var Kde=Zl["__core-js_shared__"],RM=Kde,Qj=function(){var e=/[^.]+$/.exec(RM&&RM.keys&&RM.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Qde(e){return!!Qj&&Qj in e}var Jde=Function.prototype,tpe=Jde.toString;function H_(e){if(e!=null){try{return tpe.call(e)}catch{}try{return e+""}catch{}}return""}var epe=/[\\^$.*+?()[\]{}|]/g,rpe=/^\[object .+?Constructor\]$/,npe=Function.prototype,ipe=Object.prototype,ape=npe.toString,ope=ipe.hasOwnProperty,spe=RegExp("^"+ape.call(ope).replace(epe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function klt(e){if(!ro(e)||Qde(e))return!1;var t=mu(e)?spe:rpe;return t.test(H_(e))}function lpe(e,t){return e==null?void 0:e[t]}function V_(e,t){var r=lpe(e,t);return klt(r)?r:void 0}var upe=V_(Zl,"WeakMap"),hS=upe,cpe=hS&&new hS,sI=cpe,hpe=sI?function(e,t){return sI.set(e,t),e}:Wu,zlt=hpe,Jj=Object.create,fpe=function(){function e(){}return function(t){if(!ro(t))return{};if(Jj)return Jj(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),Kb=fpe;function fS(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var r=Kb(e.prototype),n=e.apply(r,t);return ro(n)?n:r}}var dpe=1;function ppe(e,t,r){var n=t&dpe,i=fS(e);function a(){var o=this&&this!==Zl&&this instanceof a?i:e;return o.apply(n?r:this,arguments)}return a}function Yh(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var vpe=Math.max;function Ult(e,t,r,n){for(var i=-1,a=e.length,o=r.length,s=-1,l=t.length,u=vpe(a-o,0),c=Array(l+u),f=!n;++s<l;)c[s]=t[s];for(;++i<o;)(f||i<a)&&(c[r[i]]=e[i]);for(;u--;)c[s++]=e[i++];return c}var gpe=Math.max;function $lt(e,t,r,n){for(var i=-1,a=e.length,o=-1,s=r.length,l=-1,u=t.length,c=gpe(a-s,0),f=Array(c+u),d=!n;++i<c;)f[i]=e[i];for(var v=i;++l<u;)f[v+l]=t[l];for(;++o<s;)(d||i<a)&&(f[v+r[o]]=e[i++]);return f}function mpe(e,t){for(var r=e.length,n=0;r--;)e[r]===t&&++n;return n}function q3(){}var ype=4294967295;function ha(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ype,this.__views__=[]}ha.prototype=Kb(q3.prototype);ha.prototype.constructor=ha;function K3(){}var _pe=sI?function(e){return sI.get(e)}:K3,y6=_pe,xpe={},Fx=xpe,bpe=Object.prototype,Epe=bpe.hasOwnProperty;function IM(e){for(var t=e.name+"",r=Fx[t],n=Epe.call(Fx,t)?r.length:0;n--;){var i=r[n],a=i.func;if(a==null||a==e)return i.name}return t}function Jf(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=void 0}Jf.prototype=Kb(q3.prototype);Jf.prototype.constructor=Jf;function Jc(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}function Hlt(e){if(e instanceof ha)return e.clone();var t=new Jf(e.__wrapped__,e.__chain__);return t.__actions__=Jc(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var wpe=Object.prototype,Cpe=wpe.hasOwnProperty;function mt(e){if(Fs(e)&&!Xn(e)&&!(e instanceof ha)){if(e instanceof Jf)return e;if(Cpe.call(e,"__wrapped__"))return Hlt(e)}return new Jf(e)}mt.prototype=q3.prototype;mt.prototype.constructor=mt;function jB(e){var t=IM(e),r=mt[t];if(typeof r!="function"||!(t in ha.prototype))return!1;if(e===r)return!0;var n=y6(r);return!!n&&e===n[0]}var Spe=800,Tpe=16,Ape=Date.now;function Vlt(e){var t=0,r=0;return function(){var n=Ape(),i=Tpe-(n-r);if(r=n,i>0){if(++t>=Spe)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var Mpe=Vlt(zlt),Glt=Mpe,Rpe=/\{\n\/\* \[wrapped with (.+)\] \*/,Ipe=/,? & /;function Lpe(e){var t=e.match(Rpe);return t?t[1].split(Ipe):[]}var Ope=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/;function Ppe(e,t){var r=t.length;if(!r)return e;var n=r-1;return t[n]=(r>1?"& ":"")+t[n],t=t.join(r>2?", ":" "),e.replace(Ope,`{
/* [wrapped with `+t+`] */
`)}function Bx(e){return function(){return e}}var Dpe=function(){try{var e=V_(Object,"defineProperty");return e({},"",{}),e}catch{}}(),lI=Dpe,Fpe=lI?function(e,t){return lI(e,"toString",{configurable:!0,enumerable:!1,value:Bx(t),writable:!0})}:Wu,Bpe=Fpe,Npe=Vlt(Bpe),_6=Npe;function ld(e,t){for(var r=-1,n=e==null?0:e.length;++r<n&&t(e[r],r,e)!==!1;);return e}function Q3(e,t,r,n){for(var i=e.length,a=r+(n?1:-1);n?a--:++a<i;)if(t(e[a],a,e))return a;return-1}function Wlt(e){return e!==e}function kpe(e,t,r){for(var n=r-1,i=e.length;++n<i;)if(e[n]===t)return n;return-1}function Qb(e,t,r){return t===t?kpe(e,t,r):Q3(e,Wlt,r)}function J3(e,t){var r=e==null?0:e.length;return!!r&&Qb(e,t,0)>-1}var zpe=1,Upe=2,$pe=8,Hpe=16,Vpe=32,Gpe=64,Wpe=128,Xpe=256,jpe=512,Ype=[["ary",Wpe],["bind",zpe],["bindKey",Upe],["curry",$pe],["curryRight",Hpe],["flip",jpe],["partial",Vpe],["partialRight",Gpe],["rearg",Xpe]];function Zpe(e,t){return ld(Ype,function(r){var n="_."+r[0];t&r[1]&&!J3(e,n)&&e.push(n)}),e.sort()}function Xlt(e,t,r){var n=t+"";return _6(e,Ppe(n,Zpe(Lpe(n),r)))}var qpe=1,Kpe=2,Qpe=4,Jpe=8,tY=32,eY=64;function jlt(e,t,r,n,i,a,o,s,l,u){var c=t&Jpe,f=c?o:void 0,d=c?void 0:o,v=c?a:void 0,g=c?void 0:a;t|=c?tY:eY,t&=~(c?eY:tY),t&Qpe||(t&=~(qpe|Kpe));var x=[e,t,i,v,f,g,d,s,l,u],w=r.apply(void 0,x);return jB(e)&&Glt(w,x),w.placeholder=n,Xlt(w,e,t)}function Jb(e){var t=e;return t.placeholder}var tve=9007199254740991,eve=/^(?:0|[1-9]\d*)$/;function Rg(e,t){var r=typeof e;return t=t??tve,!!t&&(r=="number"||r!="symbol"&&eve.test(e))&&e>-1&&e%1==0&&e<t}var rve=Math.min;function nve(e,t){for(var r=e.length,n=rve(t.length,r),i=Jc(e);n--;){var a=t[n];e[n]=Rg(a,r)?i[a]:void 0}return e}var rY="__lodash_placeholder__";function p0(e,t){for(var r=-1,n=e.length,i=0,a=[];++r<n;){var o=e[r];(o===t||o===rY)&&(e[r]=rY,a[i++]=r)}return a}var ive=1,ave=2,ove=8,sve=16,lve=128,uve=512;function tL(e,t,r,n,i,a,o,s,l,u){var c=t&lve,f=t&ive,d=t&ave,v=t&(ove|sve),g=t&uve,x=d?void 0:fS(e);function w(){for(var S=arguments.length,M=Array(S),R=S;R--;)M[R]=arguments[R];if(v)var I=Jb(w),P=mpe(M,I);if(n&&(M=Ult(M,n,i,v)),a&&(M=$lt(M,a,o,v)),S-=P,v&&S<u){var k=p0(M,I);return jlt(e,t,tL,w.placeholder,r,M,k,s,l,u-S)}var z=f?r:this,G=d?z[e]:e;return S=M.length,s?M=nve(M,s):g&&S>1&&M.reverse(),c&&l<S&&(M.length=l),this&&this!==Zl&&this instanceof w&&(G=x||fS(G)),G.apply(z,M)}return w}function cve(e,t,r){var n=fS(e);function i(){for(var a=arguments.length,o=Array(a),s=a,l=Jb(i);s--;)o[s]=arguments[s];var u=a<3&&o[0]!==l&&o[a-1]!==l?[]:p0(o,l);if(a-=u.length,a<r)return jlt(e,t,tL,i.placeholder,void 0,o,u,void 0,void 0,r-a);var c=this&&this!==Zl&&this instanceof i?n:e;return Yh(c,this,o)}return i}var hve=1;function fve(e,t,r,n){var i=t&hve,a=fS(e);function o(){for(var s=-1,l=arguments.length,u=-1,c=n.length,f=Array(c+l),d=this&&this!==Zl&&this instanceof o?a:e;++u<c;)f[u]=n[u];for(;l--;)f[u++]=arguments[++s];return Yh(d,i?r:this,f)}return o}var nY="__lodash_placeholder__",jP=1,dve=2,pve=4,iY=8,xw=128,aY=256,vve=Math.min;function gve(e,t){var r=e[1],n=t[1],i=r|n,a=i<(jP|dve|xw),o=n==xw&&r==iY||n==xw&&r==aY&&e[7].length<=t[8]||n==(xw|aY)&&t[7].length<=t[8]&&r==iY;if(!(a||o))return e;n&jP&&(e[2]=t[2],i|=r&jP?0:pve);var s=t[3];if(s){var l=e[3];e[3]=l?Ult(l,s,t[4]):s,e[4]=l?p0(e[3],nY):t[4]}return s=t[5],s&&(l=e[5],e[5]=l?$lt(l,s,t[6]):s,e[6]=l?p0(e[5],nY):t[6]),s=t[7],s&&(e[7]=s),n&xw&&(e[8]=e[8]==null?t[8]:vve(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=i,e}var mve="Expected a function",oY=1,yve=2,YP=8,ZP=16,qP=32,sY=64,lY=Math.max;function Ig(e,t,r,n,i,a,o,s){var l=t&yve;if(!l&&typeof e!="function")throw new TypeError(mve);var u=n?n.length:0;if(u||(t&=~(qP|sY),n=i=void 0),o=o===void 0?o:lY($i(o),0),s=s===void 0?s:$i(s),u-=i?i.length:0,t&sY){var c=n,f=i;n=i=void 0}var d=l?void 0:y6(e),v=[e,t,r,n,i,c,f,a,o,s];if(d&&gve(v,d),e=v[0],t=v[1],r=v[2],n=v[3],i=v[4],s=v[9]=v[9]===void 0?l?0:e.length:lY(v[9]-u,0),!s&&t&(YP|ZP)&&(t&=~(YP|ZP)),!t||t==oY)var g=ppe(e,t,r);else t==YP||t==ZP?g=cve(e,t,s):(t==qP||t==(oY|qP))&&!i.length?g=fve(e,t,r,n):g=tL.apply(void 0,v);var x=d?zlt:Glt;return Xlt(x(g,v),e,t)}var _ve=128;function Ylt(e,t,r){return t=r?void 0:t,t=e&&t==null?e.length:t,Ig(e,_ve,void 0,void 0,void 0,void 0,t)}function Lg(e,t,r){t=="__proto__"&&lI?lI(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function ap(e,t){return e===t||e!==e&&t!==t}var xve=Object.prototype,bve=xve.hasOwnProperty;function w2(e,t,r){var n=e[t];(!(bve.call(e,t)&&ap(n,r))||r===void 0&&!(t in e))&&Lg(e,t,r)}function fv(e,t,r,n){var i=!r;r||(r={});for(var a=-1,o=t.length;++a<o;){var s=t[a],l=n?n(r[s],e[s],s,r,e):void 0;l===void 0&&(l=e[s]),i?Lg(r,s,l):w2(r,s,l)}return r}var uY=Math.max;function Zlt(e,t,r){return t=uY(t===void 0?e.length-1:t,0),function(){for(var n=arguments,i=-1,a=uY(n.length-t,0),o=Array(a);++i<a;)o[i]=n[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=n[i];return s[t]=r(o),Yh(e,this,s)}}function Ji(e,t){return _6(Zlt(e,t,Wu),e+"")}var Eve=9007199254740991;function eL(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Eve}function hh(e){return e!=null&&eL(e.length)&&!mu(e)}function hc(e,t,r){if(!ro(r))return!1;var n=typeof t;return(n=="number"?hh(r)&&Rg(t,r.length):n=="string"&&t in r)?ap(r[t],e):!1}function tE(e){return Ji(function(t,r){var n=-1,i=r.length,a=i>1?r[i-1]:void 0,o=i>2?r[2]:void 0;for(a=e.length>3&&typeof a=="function"?(i--,a):void 0,o&&hc(r[0],r[1],o)&&(a=i<3?void 0:a,i=1),t=Object(t);++n<i;){var s=r[n];s&&e(t,s,n,a)}return t})}var wve=Object.prototype;function C2(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||wve;return e===r}function x6(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var Cve="[object Arguments]";function cY(e){return Fs(e)&&dc(e)==Cve}var qlt=Object.prototype,Sve=qlt.hasOwnProperty,Tve=qlt.propertyIsEnumerable,Ave=cY(function(){return arguments}())?cY:function(e){return Fs(e)&&Sve.call(e,"callee")&&!Tve.call(e,"callee")},__=Ave;function b6(){return!1}var Klt=typeof exports=="object"&&exports&&!exports.nodeType&&exports,hY=Klt&&typeof module=="object"&&module&&!module.nodeType&&module,Mve=hY&&hY.exports===Klt,fY=Mve?Zl.Buffer:void 0,Rve=fY?fY.isBuffer:void 0,Ive=Rve||b6,v0=Ive,Lve="[object Arguments]",Ove="[object Array]",Pve="[object Boolean]",Dve="[object Date]",Fve="[object Error]",Bve="[object Function]",Nve="[object Map]",kve="[object Number]",zve="[object Object]",Uve="[object RegExp]",$ve="[object Set]",Hve="[object String]",Vve="[object WeakMap]",Gve="[object ArrayBuffer]",Wve="[object DataView]",Xve="[object Float32Array]",jve="[object Float64Array]",Yve="[object Int8Array]",Zve="[object Int16Array]",qve="[object Int32Array]",Kve="[object Uint8Array]",Qve="[object Uint8ClampedArray]",Jve="[object Uint16Array]",tge="[object Uint32Array]",zo={};zo[Xve]=zo[jve]=zo[Yve]=zo[Zve]=zo[qve]=zo[Kve]=zo[Qve]=zo[Jve]=zo[tge]=!0;zo[Lve]=zo[Ove]=zo[Gve]=zo[Pve]=zo[Wve]=zo[Dve]=zo[Fve]=zo[Bve]=zo[Nve]=zo[kve]=zo[zve]=zo[Uve]=zo[$ve]=zo[Hve]=zo[Vve]=!1;function ege(e){return Fs(e)&&eL(e.length)&&!!zo[dc(e)]}function Zh(e){return function(t){return e(t)}}var Qlt=typeof exports=="object"&&exports&&!exports.nodeType&&exports,vC=Qlt&&typeof module=="object"&&module&&!module.nodeType&&module,rge=vC&&vC.exports===Qlt,KP=rge&&Dlt.process,nge=function(){try{var e=vC&&vC.require&&vC.require("util").types;return e||KP&&KP.binding&&KP.binding("util")}catch{}}(),td=nge,dY=td&&td.isTypedArray,ige=dY?Zh(dY):ege,eE=ige,age=Object.prototype,oge=age.hasOwnProperty;function Jlt(e,t){var r=Xn(e),n=!r&&__(e),i=!r&&!n&&v0(e),a=!r&&!n&&!i&&eE(e),o=r||n||i||a,s=o?x6(e.length,String):[],l=s.length;for(var u in e)(t||oge.call(e,u))&&!(o&&(u=="length"||i&&(u=="offset"||u=="parent")||a&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||Rg(u,l)))&&s.push(u);return s}function tut(e,t){return function(r){return e(t(r))}}var sge=tut(Object.keys,Object),lge=sge,uge=Object.prototype,cge=uge.hasOwnProperty;function E6(e){if(!C2(e))return lge(e);var t=[];for(var r in Object(e))cge.call(e,r)&&r!="constructor"&&t.push(r);return t}function Es(e){return hh(e)?Jlt(e):E6(e)}var hge=Object.prototype,fge=hge.hasOwnProperty,dge=tE(function(e,t){if(C2(t)||hh(t)){fv(t,Es(t),e);return}for(var r in t)fge.call(t,r)&&w2(e,r,t[r])}),eut=dge;function pge(e){var t=[];if(e!=null)for(var r in Object(e))t.push(r);return t}var vge=Object.prototype,gge=vge.hasOwnProperty;function mge(e){if(!ro(e))return pge(e);var t=C2(e),r=[];for(var n in e)n=="constructor"&&(t||!gge.call(e,n))||r.push(n);return r}function fh(e){return hh(e)?Jlt(e,!0):mge(e)}var yge=tE(function(e,t){fv(t,fh(t),e)}),pY=yge,_ge=tE(function(e,t,r,n){fv(t,fh(t),e,n)}),uI=_ge,xge=tE(function(e,t,r,n){fv(t,Es(t),e,n)}),bge=xge,Ege=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,wge=/^\w*$/;function w6(e,t){if(Xn(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||Xh(e)?!0:wge.test(e)||!Ege.test(e)||t!=null&&e in Object(t)}var Cge=V_(Object,"create"),dS=Cge;function Sge(){this.__data__=dS?dS(null):{},this.size=0}function Tge(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var Age="__lodash_hash_undefined__",Mge=Object.prototype,Rge=Mge.hasOwnProperty;function Ige(e){var t=this.__data__;if(dS){var r=t[e];return r===Age?void 0:r}return Rge.call(t,e)?t[e]:void 0}var Lge=Object.prototype,Oge=Lge.hasOwnProperty;function Pge(e){var t=this.__data__;return dS?t[e]!==void 0:Oge.call(t,e)}var Dge="__lodash_hash_undefined__";function Fge(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=dS&&t===void 0?Dge:t,this}function x_(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}x_.prototype.clear=Sge;x_.prototype.delete=Tge;x_.prototype.get=Ige;x_.prototype.has=Pge;x_.prototype.set=Fge;function Bge(){this.__data__=[],this.size=0}function rL(e,t){for(var r=e.length;r--;)if(ap(e[r][0],t))return r;return-1}var Nge=Array.prototype,kge=Nge.splice;function zge(e){var t=this.__data__,r=rL(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():kge.call(t,r,1),--this.size,!0}function Uge(e){var t=this.__data__,r=rL(t,e);return r<0?void 0:t[r][1]}function $ge(e){return rL(this.__data__,e)>-1}function Hge(e,t){var r=this.__data__,n=rL(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}function Og(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Og.prototype.clear=Bge;Og.prototype.delete=zge;Og.prototype.get=Uge;Og.prototype.has=$ge;Og.prototype.set=Hge;var Vge=V_(Zl,"Map"),pS=Vge;function Gge(){this.size=0,this.__data__={hash:new x_,map:new(pS||Og),string:new x_}}function Wge(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function nL(e,t){var r=e.__data__;return Wge(t)?r[typeof t=="string"?"string":"hash"]:r.map}function Xge(e){var t=nL(this,e).delete(e);return this.size-=t?1:0,t}function jge(e){return nL(this,e).get(e)}function Yge(e){return nL(this,e).has(e)}function Zge(e,t){var r=nL(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}function Pg(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Pg.prototype.clear=Gge;Pg.prototype.delete=Xge;Pg.prototype.get=jge;Pg.prototype.has=Yge;Pg.prototype.set=Zge;var qge="Expected a function";function G_(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(qge);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],a=r.cache;if(a.has(i))return a.get(i);var o=e.apply(this,n);return r.cache=a.set(i,o)||a,o};return r.cache=new(G_.Cache||Pg),r}G_.Cache=Pg;var Kge=500;function Qge(e){var t=G_(e,function(n){return r.size===Kge&&r.clear(),n}),r=t.cache;return t}var Jge=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,tme=/\\(\\)?/g,eme=Qge(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Jge,function(r,n,i,a){t.push(i?a.replace(tme,"$1"):n||r)}),t}),rut=eme;function $a(e){return e==null?"":jh(e)}function T0(e,t){return Xn(e)?e:w6(e,t)?[e]:rut($a(e))}var rme=1/0;function dv(e){if(typeof e=="string"||Xh(e))return e;var t=e+"";return t=="0"&&1/e==-rme?"-0":t}function W_(e,t){t=T0(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[dv(t[r++])];return r&&r==n?e:void 0}function ai(e,t,r){var n=e==null?void 0:W_(e,t);return n===void 0?r:n}function C6(e,t){for(var r=-1,n=t.length,i=Array(n),a=e==null;++r<n;)i[r]=a?void 0:ai(e,t[r]);return i}function A0(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}var vY=$u?$u.isConcatSpreadable:void 0;function nme(e){return Xn(e)||__(e)||!!(vY&&e&&e[vY])}function yu(e,t,r,n,i){var a=-1,o=e.length;for(r||(r=nme),i||(i=[]);++a<o;){var s=e[a];t>0&&r(s)?t>1?yu(s,t-1,r,n,i):A0(i,s):n||(i[i.length]=s)}return i}function nut(e){var t=e==null?0:e.length;return t?yu(e,1):[]}function Dg(e){return _6(Zlt(e,void 0,nut),e+"")}var ime=Dg(C6),ame=ime,ome=tut(Object.getPrototypeOf,Object),iL=ome,sme="[object Object]",lme=Function.prototype,ume=Object.prototype,iut=lme.toString,cme=ume.hasOwnProperty,hme=iut.call(Object);function S2(e){if(!Fs(e)||dc(e)!=sme)return!1;var t=iL(e);if(t===null)return!0;var r=cme.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&iut.call(r)==hme}var fme="[object DOMException]",dme="[object Error]";function S6(e){if(!Fs(e))return!1;var t=dc(e);return t==dme||t==fme||typeof e.message=="string"&&typeof e.name=="string"&&!S2(e)}var pme=Ji(function(e,t){try{return Yh(e,void 0,t)}catch(r){return S6(r)?r:new Error(r)}}),aut=pme,vme="Expected a function";function out(e,t){var r;if(typeof t!="function")throw new TypeError(vme);return e=$i(e),function(){return--e>0&&(r=t.apply(this,arguments)),e<=1&&(t=void 0),r}}var gme=1,mme=32,T6=Ji(function(e,t,r){var n=gme;if(r.length){var i=p0(r,Jb(T6));n|=mme}return Ig(e,n,t,r,i)});T6.placeholder={};var sut=T6,yme=Dg(function(e,t){return ld(t,function(r){r=dv(r),Lg(e,r,sut(e[r],e))}),e}),_me=yme,xme=1,bme=2,Eme=32,A6=Ji(function(e,t,r){var n=xme|bme;if(r.length){var i=p0(r,Jb(A6));n|=Eme}return Ig(t,n,e,r,i)});A6.placeholder={};var wme=A6;function ed(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),r=r>i?i:r,r<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var a=Array(i);++n<i;)a[n]=e[n+t];return a}function M0(e,t,r){var n=e.length;return r=r===void 0?n:r,!t&&r>=n?e:ed(e,t,r)}var Cme="\\ud800-\\udfff",Sme="\\u0300-\\u036f",Tme="\\ufe20-\\ufe2f",Ame="\\u20d0-\\u20ff",Mme=Sme+Tme+Ame,Rme="\\ufe0e\\ufe0f",Ime="\\u200d",Lme=RegExp("["+Ime+Cme+Mme+Rme+"]");function rE(e){return Lme.test(e)}function Ome(e){return e.split("")}var lut="\\ud800-\\udfff",Pme="\\u0300-\\u036f",Dme="\\ufe20-\\ufe2f",Fme="\\u20d0-\\u20ff",Bme=Pme+Dme+Fme,Nme="\\ufe0e\\ufe0f",kme="["+lut+"]",YB="["+Bme+"]",ZB="\\ud83c[\\udffb-\\udfff]",zme="(?:"+YB+"|"+ZB+")",uut="[^"+lut+"]",cut="(?:\\ud83c[\\udde6-\\uddff]){2}",hut="[\\ud800-\\udbff][\\udc00-\\udfff]",Ume="\\u200d",fut=zme+"?",dut="["+Nme+"]?",$me="(?:"+Ume+"(?:"+[uut,cut,hut].join("|")+")"+dut+fut+")*",Hme=dut+fut+$me,Vme="(?:"+[uut+YB+"?",YB,cut,hut,kme].join("|")+")",Gme=RegExp(ZB+"(?="+ZB+")|"+Vme+Hme,"g");function Wme(e){return e.match(Gme)||[]}function Kd(e){return rE(e)?Wme(e):Ome(e)}function put(e){return function(t){t=$a(t);var r=rE(t)?Kd(t):void 0,n=r?r[0]:t.charAt(0),i=r?M0(r,1).join(""):t.slice(1);return n[e]()+i}}var Xme=put("toUpperCase"),M6=Xme;function vut(e){return M6($a(e).toLowerCase())}function R6(e,t,r,n){var i=-1,a=e==null?0:e.length;for(n&&a&&(r=e[++i]);++i<a;)r=t(r,e[i],i,e);return r}function I6(e){return function(t){return e==null?void 0:e[t]}}var jme={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},Yme=I6(jme),Zme=Yme,qme=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Kme="\\u0300-\\u036f",Qme="\\ufe20-\\ufe2f",Jme="\\u20d0-\\u20ff",t0e=Kme+Qme+Jme,e0e="["+t0e+"]",r0e=RegExp(e0e,"g");function gut(e){return e=$a(e),e&&e.replace(qme,Zme).replace(r0e,"")}var n0e=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function i0e(e){return e.match(n0e)||[]}var a0e=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function o0e(e){return a0e.test(e)}var mut="\\ud800-\\udfff",s0e="\\u0300-\\u036f",l0e="\\ufe20-\\ufe2f",u0e="\\u20d0-\\u20ff",c0e=s0e+l0e+u0e,yut="\\u2700-\\u27bf",_ut="a-z\\xdf-\\xf6\\xf8-\\xff",h0e="\\xac\\xb1\\xd7\\xf7",f0e="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",d0e="\\u2000-\\u206f",p0e=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",xut="A-Z\\xc0-\\xd6\\xd8-\\xde",v0e="\\ufe0e\\ufe0f",but=h0e+f0e+d0e+p0e,Eut="['’]",gY="["+but+"]",g0e="["+c0e+"]",wut="\\d+",m0e="["+yut+"]",Cut="["+_ut+"]",Sut="[^"+mut+but+wut+yut+_ut+xut+"]",y0e="\\ud83c[\\udffb-\\udfff]",_0e="(?:"+g0e+"|"+y0e+")",x0e="[^"+mut+"]",Tut="(?:\\ud83c[\\udde6-\\uddff]){2}",Aut="[\\ud800-\\udbff][\\udc00-\\udfff]",rx="["+xut+"]",b0e="\\u200d",mY="(?:"+Cut+"|"+Sut+")",E0e="(?:"+rx+"|"+Sut+")",yY="(?:"+Eut+"(?:d|ll|m|re|s|t|ve))?",_Y="(?:"+Eut+"(?:D|LL|M|RE|S|T|VE))?",Mut=_0e+"?",Rut="["+v0e+"]?",w0e="(?:"+b0e+"(?:"+[x0e,Tut,Aut].join("|")+")"+Rut+Mut+")*",C0e="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",S0e="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",T0e=Rut+Mut+w0e,A0e="(?:"+[m0e,Tut,Aut].join("|")+")"+T0e,M0e=RegExp([rx+"?"+Cut+"+"+yY+"(?="+[gY,rx,"$"].join("|")+")",E0e+"+"+_Y+"(?="+[gY,rx+mY,"$"].join("|")+")",rx+"?"+mY+"+"+yY,rx+"+"+_Y,S0e,C0e,wut,A0e].join("|"),"g");function R0e(e){return e.match(M0e)||[]}function Iut(e,t,r){return e=$a(e),t=r?void 0:t,t===void 0?o0e(e)?R0e(e):i0e(e):e.match(t)||[]}var I0e="['’]",L0e=RegExp(I0e,"g");function nE(e){return function(t){return R6(Iut(gut(t).replace(L0e,"")),e,"")}}var O0e=nE(function(e,t,r){return t=t.toLowerCase(),e+(r?vut(t):t)}),P0e=O0e;function D0e(){if(!arguments.length)return[];var e=arguments[0];return Xn(e)?e:[e]}var F0e=Zl.isFinite,B0e=Math.min;function L6(e){var t=Math[e];return function(r,n){if(r=Hh(r),n=n==null?0:B0e($i(n),292),n&&F0e(r)){var i=($a(r)+"e").split("e"),a=t(i[0]+"e"+(+i[1]+n));return i=($a(a)+"e").split("e"),+(i[0]+"e"+(+i[1]-n))}return t(r)}}var N0e=L6("ceil"),k0e=N0e;function Lut(e){var t=mt(e);return t.__chain__=!0,t}var z0e=Math.ceil,U0e=Math.max;function $0e(e,t,r){(r?hc(e,t,r):t===void 0)?t=1:t=U0e($i(t),0);var n=e==null?0:e.length;if(!n||t<1)return[];for(var i=0,a=0,o=Array(z0e(n/t));i<n;)o[a++]=ed(e,i,i+=t);return o}function X_(e,t,r){return e===e&&(r!==void 0&&(e=e<=r?e:r),t!==void 0&&(e=e>=t?e:t)),e}function cI(e,t,r){return r===void 0&&(r=t,t=void 0),r!==void 0&&(r=Hh(r),r=r===r?r:0),t!==void 0&&(t=Hh(t),t=t===t?t:0),X_(Hh(e),t,r)}function H0e(){this.__data__=new Og,this.size=0}function V0e(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}function G0e(e){return this.__data__.get(e)}function W0e(e){return this.__data__.has(e)}var X0e=200;function j0e(e,t){var r=this.__data__;if(r instanceof Og){var n=r.__data__;if(!pS||n.length<X0e-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new Pg(n)}return r.set(e,t),this.size=r.size,this}function Wd(e){var t=this.__data__=new Og(e);this.size=t.size}Wd.prototype.clear=H0e;Wd.prototype.delete=V0e;Wd.prototype.get=G0e;Wd.prototype.has=W0e;Wd.prototype.set=j0e;function Out(e,t){return e&&fv(t,Es(t),e)}function Y0e(e,t){return e&&fv(t,fh(t),e)}var Put=typeof exports=="object"&&exports&&!exports.nodeType&&exports,xY=Put&&typeof module=="object"&&module&&!module.nodeType&&module,Z0e=xY&&xY.exports===Put,bY=Z0e?Zl.Buffer:void 0,EY=bY?bY.allocUnsafe:void 0;function Dut(e,t){if(t)return e.slice();var r=e.length,n=EY?EY(r):new e.constructor(r);return e.copy(n),n}function R0(e,t){for(var r=-1,n=e==null?0:e.length,i=0,a=[];++r<n;){var o=e[r];t(o,r,e)&&(a[i++]=o)}return a}function O6(){return[]}var q0e=Object.prototype,K0e=q0e.propertyIsEnumerable,wY=Object.getOwnPropertySymbols,Q0e=wY?function(e){return e==null?[]:(e=Object(e),R0(wY(e),function(t){return K0e.call(e,t)}))}:O6,P6=Q0e;function J0e(e,t){return fv(e,P6(e),t)}var tye=Object.getOwnPropertySymbols,eye=tye?function(e){for(var t=[];e;)A0(t,P6(e)),e=iL(e);return t}:O6,Fut=eye;function rye(e,t){return fv(e,Fut(e),t)}function But(e,t,r){var n=t(e);return Xn(e)?n:A0(n,r(e))}function qB(e){return But(e,Es,P6)}function D6(e){return But(e,fh,Fut)}var nye=V_(Zl,"DataView"),KB=nye,iye=V_(Zl,"Promise"),QB=iye,aye=V_(Zl,"Set"),Nx=aye,CY="[object Map]",oye="[object Object]",SY="[object Promise]",TY="[object Set]",AY="[object WeakMap]",MY="[object DataView]",sye=H_(KB),lye=H_(pS),uye=H_(QB),cye=H_(Nx),hye=H_(hS),Sy=dc;(KB&&Sy(new KB(new ArrayBuffer(1)))!=MY||pS&&Sy(new pS)!=CY||QB&&Sy(QB.resolve())!=SY||Nx&&Sy(new Nx)!=TY||hS&&Sy(new hS)!=AY)&&(Sy=function(e){var t=dc(e),r=t==oye?e.constructor:void 0,n=r?H_(r):"";if(n)switch(n){case sye:return MY;case lye:return CY;case uye:return SY;case cye:return TY;case hye:return AY}return t});var ov=Sy,fye=Object.prototype,dye=fye.hasOwnProperty;function pye(e){var t=e.length,r=new e.constructor(t);return t&&typeof e[0]=="string"&&dye.call(e,"index")&&(r.index=e.index,r.input=e.input),r}var vye=Zl.Uint8Array,hI=vye;function F6(e){var t=new e.constructor(e.byteLength);return new hI(t).set(new hI(e)),t}function gye(e,t){var r=t?F6(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}var mye=/\w*$/;function yye(e){var t=new e.constructor(e.source,mye.exec(e));return t.lastIndex=e.lastIndex,t}var RY=$u?$u.prototype:void 0,IY=RY?RY.valueOf:void 0;function _ye(e){return IY?Object(IY.call(e)):{}}function Nut(e,t){var r=t?F6(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}var xye="[object Boolean]",bye="[object Date]",Eye="[object Map]",wye="[object Number]",Cye="[object RegExp]",Sye="[object Set]",Tye="[object String]",Aye="[object Symbol]",Mye="[object ArrayBuffer]",Rye="[object DataView]",Iye="[object Float32Array]",Lye="[object Float64Array]",Oye="[object Int8Array]",Pye="[object Int16Array]",Dye="[object Int32Array]",Fye="[object Uint8Array]",Bye="[object Uint8ClampedArray]",Nye="[object Uint16Array]",kye="[object Uint32Array]";function zye(e,t,r){var n=e.constructor;switch(t){case Mye:return F6(e);case xye:case bye:return new n(+e);case Rye:return gye(e,r);case Iye:case Lye:case Oye:case Pye:case Dye:case Fye:case Bye:case Nye:case kye:return Nut(e,r);case Eye:return new n;case wye:case Tye:return new n(e);case Cye:return yye(e);case Sye:return new n;case Aye:return _ye(e)}}function kut(e){return typeof e.constructor=="function"&&!C2(e)?Kb(iL(e)):{}}var Uye="[object Map]";function $ye(e){return Fs(e)&&ov(e)==Uye}var LY=td&&td.isMap,Hye=LY?Zh(LY):$ye,zut=Hye,Vye="[object Set]";function Gye(e){return Fs(e)&&ov(e)==Vye}var OY=td&&td.isSet,Wye=OY?Zh(OY):Gye,Uut=Wye,Xye=1,jye=2,Yye=4,$ut="[object Arguments]",Zye="[object Array]",qye="[object Boolean]",Kye="[object Date]",Qye="[object Error]",Hut="[object Function]",Jye="[object GeneratorFunction]",t_e="[object Map]",e_e="[object Number]",Vut="[object Object]",r_e="[object RegExp]",n_e="[object Set]",i_e="[object String]",a_e="[object Symbol]",o_e="[object WeakMap]",s_e="[object ArrayBuffer]",l_e="[object DataView]",u_e="[object Float32Array]",c_e="[object Float64Array]",h_e="[object Int8Array]",f_e="[object Int16Array]",d_e="[object Int32Array]",p_e="[object Uint8Array]",v_e="[object Uint8ClampedArray]",g_e="[object Uint16Array]",m_e="[object Uint32Array]",So={};So[$ut]=So[Zye]=So[s_e]=So[l_e]=So[qye]=So[Kye]=So[u_e]=So[c_e]=So[h_e]=So[f_e]=So[d_e]=So[t_e]=So[e_e]=So[Vut]=So[r_e]=So[n_e]=So[i_e]=So[a_e]=So[p_e]=So[v_e]=So[g_e]=So[m_e]=!0;So[Qye]=So[Hut]=So[o_e]=!1;function Yf(e,t,r,n,i,a){var o,s=t&Xye,l=t&jye,u=t&Yye;if(r&&(o=i?r(e,n,i,a):r(e)),o!==void 0)return o;if(!ro(e))return e;var c=Xn(e);if(c){if(o=pye(e),!s)return Jc(e,o)}else{var f=ov(e),d=f==Hut||f==Jye;if(v0(e))return Dut(e,s);if(f==Vut||f==$ut||d&&!i){if(o=l||d?{}:kut(e),!s)return l?rye(e,Y0e(o,e)):J0e(e,Out(o,e))}else{if(!So[f])return i?e:{};o=zye(e,f,s)}}a||(a=new Wd);var v=a.get(e);if(v)return v;a.set(e,o),Uut(e)?e.forEach(function(w){o.add(Yf(w,t,r,w,e,a))}):zut(e)&&e.forEach(function(w,S){o.set(S,Yf(w,t,r,S,e,a))});var g=u?l?D6:qB:l?fh:Es,x=c?void 0:g(e);return ld(x||e,function(w,S){x&&(S=w,w=e[S]),w2(o,S,Yf(w,t,r,S,e,a))}),o}var y_e=4;function T2(e){return Yf(e,y_e)}var __e=1,x_e=4;function JB(e){return Yf(e,__e|x_e)}var b_e=1,E_e=4;function w_e(e,t){return t=typeof t=="function"?t:void 0,Yf(e,b_e|E_e,t)}var C_e=4;function S_e(e,t){return t=typeof t=="function"?t:void 0,Yf(e,C_e,t)}function T_e(){return new Jf(this.value(),this.__chain__)}function Xd(e){for(var t=-1,r=e==null?0:e.length,n=0,i=[];++t<r;){var a=e[t];a&&(i[n++]=a)}return i}function dx(){var e=arguments.length;if(!e)return[];for(var t=Array(e-1),r=arguments[0],n=e;n--;)t[n-1]=arguments[n];return A0(Xn(r)?Jc(r):[r],yu(t,1))}var A_e="__lodash_hash_undefined__";function M_e(e){return this.__data__.set(e,A_e),this}function R_e(e){return this.__data__.has(e)}function b_(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new Pg;++t<r;)this.add(e[t])}b_.prototype.add=b_.prototype.push=M_e;b_.prototype.has=R_e;function B6(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}function vS(e,t){return e.has(t)}var I_e=1,L_e=2;function Gut(e,t,r,n,i,a){var o=r&I_e,s=e.length,l=t.length;if(s!=l&&!(o&&l>s))return!1;var u=a.get(e),c=a.get(t);if(u&&c)return u==t&&c==e;var f=-1,d=!0,v=r&L_e?new b_:void 0;for(a.set(e,t),a.set(t,e);++f<s;){var g=e[f],x=t[f];if(n)var w=o?n(x,g,f,t,e,a):n(g,x,f,e,t,a);if(w!==void 0){if(w)continue;d=!1;break}if(v){if(!B6(t,function(S,M){if(!vS(v,M)&&(g===S||i(g,S,r,n,a)))return v.push(M)})){d=!1;break}}else if(!(g===x||i(g,x,r,n,a))){d=!1;break}}return a.delete(e),a.delete(t),d}function N6(e){var t=-1,r=Array(e.size);return e.forEach(function(n,i){r[++t]=[i,n]}),r}function aL(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var O_e=1,P_e=2,D_e="[object Boolean]",F_e="[object Date]",B_e="[object Error]",N_e="[object Map]",k_e="[object Number]",z_e="[object RegExp]",U_e="[object Set]",$_e="[object String]",H_e="[object Symbol]",V_e="[object ArrayBuffer]",G_e="[object DataView]",PY=$u?$u.prototype:void 0,QP=PY?PY.valueOf:void 0;function W_e(e,t,r,n,i,a,o){switch(r){case G_e:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case V_e:return!(e.byteLength!=t.byteLength||!a(new hI(e),new hI(t)));case D_e:case F_e:case k_e:return ap(+e,+t);case B_e:return e.name==t.name&&e.message==t.message;case z_e:case $_e:return e==t+"";case N_e:var s=N6;case U_e:var l=n&O_e;if(s||(s=aL),e.size!=t.size&&!l)return!1;var u=o.get(e);if(u)return u==t;n|=P_e,o.set(e,t);var c=Gut(s(e),s(t),n,i,a,o);return o.delete(e),c;case H_e:if(QP)return QP.call(e)==QP.call(t)}return!1}var X_e=1,j_e=Object.prototype,Y_e=j_e.hasOwnProperty;function Z_e(e,t,r,n,i,a){var o=r&X_e,s=qB(e),l=s.length,u=qB(t),c=u.length;if(l!=c&&!o)return!1;for(var f=l;f--;){var d=s[f];if(!(o?d in t:Y_e.call(t,d)))return!1}var v=a.get(e),g=a.get(t);if(v&&g)return v==t&&g==e;var x=!0;a.set(e,t),a.set(t,e);for(var w=o;++f<l;){d=s[f];var S=e[d],M=t[d];if(n)var R=o?n(M,S,d,t,e,a):n(S,M,d,e,t,a);if(!(R===void 0?S===M||i(S,M,r,n,a):R)){x=!1;break}w||(w=d=="constructor")}if(x&&!w){var I=e.constructor,P=t.constructor;I!=P&&"constructor"in e&&"constructor"in t&&!(typeof I=="function"&&I instanceof I&&typeof P=="function"&&P instanceof P)&&(x=!1)}return a.delete(e),a.delete(t),x}var q_e=1,DY="[object Arguments]",FY="[object Array]",XA="[object Object]",K_e=Object.prototype,BY=K_e.hasOwnProperty;function Q_e(e,t,r,n,i,a){var o=Xn(e),s=Xn(t),l=o?FY:ov(e),u=s?FY:ov(t);l=l==DY?XA:l,u=u==DY?XA:u;var c=l==XA,f=u==XA,d=l==u;if(d&&v0(e)){if(!v0(t))return!1;o=!0,c=!1}if(d&&!c)return a||(a=new Wd),o||eE(e)?Gut(e,t,r,n,i,a):W_e(e,t,l,r,n,i,a);if(!(r&q_e)){var v=c&&BY.call(e,"__wrapped__"),g=f&&BY.call(t,"__wrapped__");if(v||g){var x=v?e.value():e,w=g?t.value():t;return a||(a=new Wd),i(x,w,r,n,a)}}return d?(a||(a=new Wd),Z_e(e,t,r,n,i,a)):!1}function A2(e,t,r,n,i){return e===t?!0:e==null||t==null||!Fs(e)&&!Fs(t)?e!==e&&t!==t:Q_e(e,t,r,n,A2,i)}var J_e=1,t1e=2;function k6(e,t,r,n){var i=r.length,a=i,o=!n;if(e==null)return!a;for(e=Object(e);i--;){var s=r[i];if(o&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<a;){s=r[i];var l=s[0],u=e[l],c=s[1];if(o&&s[2]){if(u===void 0&&!(l in e))return!1}else{var f=new Wd;if(n)var d=n(u,c,l,e,t,f);if(!(d===void 0?A2(c,u,J_e|t1e,n,f):d))return!1}}return!0}function Wut(e){return e===e&&!ro(e)}function z6(e){for(var t=Es(e),r=t.length;r--;){var n=t[r],i=e[n];t[r]=[n,i,Wut(i)]}return t}function Xut(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}function jut(e){var t=z6(e);return t.length==1&&t[0][2]?Xut(t[0][0],t[0][1]):function(r){return r===e||k6(r,e,t)}}function e1e(e,t){return e!=null&&t in Object(e)}function Yut(e,t,r){t=T0(t,e);for(var n=-1,i=t.length,a=!1;++n<i;){var o=dv(t[n]);if(!(a=e!=null&&r(e,o)))break;e=e[o]}return a||++n!=i?a:(i=e==null?0:e.length,!!i&&eL(i)&&Rg(o,i)&&(Xn(e)||__(e)))}function E_(e,t){return e!=null&&Yut(e,t,e1e)}var r1e=1,n1e=2;function Zut(e,t){return w6(e)&&Wut(t)?Xut(dv(e),t):function(r){var n=ai(r,e);return n===void 0&&n===t?E_(r,e):A2(t,n,r1e|n1e)}}function U6(e){return function(t){return t==null?void 0:t[e]}}function i1e(e){return function(t){return W_(t,e)}}function qut(e){return w6(e)?U6(dv(e)):i1e(e)}function Ri(e){return typeof e=="function"?e:e==null?Wu:typeof e=="object"?Xn(e)?Zut(e[0],e[1]):jut(e):qut(e)}var a1e="Expected a function";function Kut(e){var t=e==null?0:e.length,r=Ri;return e=t?rs(e,function(n){if(typeof n[1]!="function")throw new TypeError(a1e);return[r(n[0]),n[1]]}):[],Ji(function(n){for(var i=-1;++i<t;){var a=e[i];if(Yh(a[0],this,n))return Yh(a[1],this,n)}})}function Qut(e,t,r){var n=r.length;if(e==null)return!n;for(e=Object(e);n--;){var i=r[n],a=t[i],o=e[i];if(o===void 0&&!(i in e)||!a(o))return!1}return!0}function o1e(e){var t=Es(e);return function(r){return Qut(r,e,t)}}var s1e=1;function l1e(e){return o1e(Yf(e,s1e))}function u1e(e,t){return t==null||Qut(e,t,Es(t))}function c1e(e,t,r,n){for(var i=-1,a=e==null?0:e.length;++i<a;){var o=e[i];t(n,o,r(o),e)}return n}function Jut(e){return function(t,r,n){for(var i=-1,a=Object(t),o=n(t),s=o.length;s--;){var l=o[e?s:++i];if(r(a[l],l,a)===!1)break}return t}}var h1e=Jut(),$6=h1e;function pv(e,t){return e&&$6(e,t,Es)}function tct(e,t){return function(r,n){if(r==null)return r;if(!hh(r))return e(r,n);for(var i=r.length,a=t?i:-1,o=Object(r);(t?a--:++a<i)&&n(o[a],a,o)!==!1;);return r}}var f1e=tct(pv),I0=f1e;function d1e(e,t,r,n){return I0(e,function(i,a,o){t(n,i,r(i),o)}),n}function oL(e,t){return function(r,n){var i=Xn(r)?c1e:d1e,a=t?t():{};return i(r,e,Ri(n),a)}}var p1e=Object.prototype,v1e=p1e.hasOwnProperty,g1e=oL(function(e,t,r){v1e.call(e,r)?++e[r]:Lg(e,r,1)}),m1e=g1e;function y1e(e,t){var r=Kb(e);return t==null?r:Out(r,t)}var _1e=8;function H6(e,t,r){t=r?void 0:t;var n=Ig(e,_1e,void 0,void 0,void 0,void 0,void 0,t);return n.placeholder=H6.placeholder,n}H6.placeholder={};var x1e=16;function V6(e,t,r){t=r?void 0:t;var n=Ig(e,x1e,void 0,void 0,void 0,void 0,void 0,t);return n.placeholder=V6.placeholder,n}V6.placeholder={};var b1e=function(){return Zl.Date.now()},LM=b1e,E1e="Expected a function",w1e=Math.max,C1e=Math.min;function gS(e,t,r){var n,i,a,o,s,l,u=0,c=!1,f=!1,d=!0;if(typeof e!="function")throw new TypeError(E1e);t=Hh(t)||0,ro(r)&&(c=!!r.leading,f="maxWait"in r,a=f?w1e(Hh(r.maxWait)||0,t):a,d="trailing"in r?!!r.trailing:d);function v(k){var z=n,G=i;return n=i=void 0,u=k,o=e.apply(G,z),o}function g(k){return u=k,s=setTimeout(S,t),c?v(k):o}function x(k){var z=k-l,G=k-u,J=t-z;return f?C1e(J,a-G):J}function w(k){var z=k-l,G=k-u;return l===void 0||z>=t||z<0||f&&G>=a}function S(){var k=LM();if(w(k))return M(k);s=setTimeout(S,x(k))}function M(k){return s=void 0,d&&n?v(k):(n=i=void 0,o)}function R(){s!==void 0&&clearTimeout(s),u=0,n=l=i=s=void 0}function I(){return s===void 0?o:M(LM())}function P(){var k=LM(),z=w(k);if(n=arguments,i=this,l=k,z){if(s===void 0)return g(l);if(f)return clearTimeout(s),s=setTimeout(S,t),v(l)}return s===void 0&&(s=setTimeout(S,t)),o}return P.cancel=R,P.flush=I,P}function S1e(e,t){return e==null||e!==e?t:e}var ect=Object.prototype,T1e=ect.hasOwnProperty,A1e=Ji(function(e,t){e=Object(e);var r=-1,n=t.length,i=n>2?t[2]:void 0;for(i&&hc(t[0],t[1],i)&&(n=1);++r<n;)for(var a=t[r],o=fh(a),s=-1,l=o.length;++s<l;){var u=o[s],c=e[u];(c===void 0||ap(c,ect[u])&&!T1e.call(e,u))&&(e[u]=a[u])}return e}),M1e=A1e;function t5(e,t,r){(r!==void 0&&!ap(e[t],r)||r===void 0&&!(t in e))&&Lg(e,t,r)}function Xs(e){return Fs(e)&&hh(e)}function e5(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}function rct(e){return fv(e,fh(e))}function R1e(e,t,r,n,i,a,o){var s=e5(e,r),l=e5(t,r),u=o.get(l);if(u){t5(e,r,u);return}var c=a?a(s,l,r+"",e,t,o):void 0,f=c===void 0;if(f){var d=Xn(l),v=!d&&v0(l),g=!d&&!v&&eE(l);c=l,d||v||g?Xn(s)?c=s:Xs(s)?c=Jc(s):v?(f=!1,c=Dut(l,!0)):g?(f=!1,c=Nut(l,!0)):c=[]:S2(l)||__(l)?(c=s,__(s)?c=rct(s):(!ro(s)||mu(s))&&(c=kut(l))):f=!1}f&&(o.set(l,c),i(c,l,n,a,o),o.delete(l)),t5(e,r,c)}function sL(e,t,r,n,i){e!==t&&$6(t,function(a,o){if(i||(i=new Wd),ro(a))R1e(e,t,o,r,sL,n,i);else{var s=n?n(e5(e,o),a,o+"",e,t,i):void 0;s===void 0&&(s=a),t5(e,o,s)}},fh)}function nct(e,t,r,n,i,a){return ro(e)&&ro(t)&&(a.set(t,e),sL(e,t,void 0,nct,a),a.delete(t)),e}var I1e=tE(function(e,t,r,n){sL(e,t,r,n)}),G6=I1e,L1e=Ji(function(e){return e.push(void 0,nct),Yh(G6,void 0,e)}),O1e=L1e,P1e="Expected a function";function ict(e,t,r){if(typeof e!="function")throw new TypeError(P1e);return setTimeout(function(){e.apply(void 0,r)},t)}var D1e=Ji(function(e,t){return ict(e,1,t)}),F1e=D1e,B1e=Ji(function(e,t,r){return ict(e,Hh(t)||0,r)}),N1e=B1e;function W6(e,t,r){for(var n=-1,i=e==null?0:e.length;++n<i;)if(r(t,e[n]))return!0;return!1}var k1e=200;function M2(e,t,r,n){var i=-1,a=J3,o=!0,s=e.length,l=[],u=t.length;if(!s)return l;r&&(t=rs(t,Zh(r))),n?(a=W6,o=!1):t.length>=k1e&&(a=vS,o=!1,t=new b_(t));t:for(;++i<s;){var c=e[i],f=r==null?c:r(c);if(c=n||c!==0?c:0,o&&f===f){for(var d=u;d--;)if(t[d]===f)continue t;l.push(c)}else a(t,f,n)||l.push(c)}return l}var z1e=Ji(function(e,t){return Xs(e)?M2(e,yu(t,1,Xs,!0)):[]}),act=z1e;function no(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var U1e=Ji(function(e,t){var r=no(t);return Xs(r)&&(r=void 0),Xs(e)?M2(e,yu(t,1,Xs,!0),Ri(r)):[]}),$1e=U1e,H1e=Ji(function(e,t){var r=no(t);return Xs(r)&&(r=void 0),Xs(e)?M2(e,yu(t,1,Xs,!0),void 0,r):[]}),oct=H1e,V1e=Z3(function(e,t){return e/t},1),G1e=V1e;function W1e(e,t,r){var n=e==null?0:e.length;return n?(t=r||t===void 0?1:$i(t),ed(e,t<0?0:t,n)):[]}function X1e(e,t,r){var n=e==null?0:e.length;return n?(t=r||t===void 0?1:$i(t),t=n-t,ed(e,0,t<0?0:t)):[]}function lL(e,t,r,n){for(var i=e.length,a=n?i:-1;(n?a--:++a<i)&&t(e[a],a,e););return r?ed(e,n?0:a,n?a+1:i):ed(e,n?a+1:0,n?i:a)}function j1e(e,t){return e&&e.length?lL(e,Ri(t),!0,!0):[]}function Y1e(e,t){return e&&e.length?lL(e,Ri(t),!0):[]}function vv(e){return typeof e=="function"?e:Wu}function bi(e,t){var r=Xn(e)?ld:I0;return r(e,vv(t))}function Z1e(e,t){for(var r=e==null?0:e.length;r--&&t(e[r],r,e)!==!1;);return e}var q1e=Jut(!0),sct=q1e;function X6(e,t){return e&&sct(e,t,Es)}var K1e=tct(X6,!0),lct=K1e;function NY(e,t){var r=Xn(e)?Z1e:lct;return r(e,vv(t))}function Q1e(e,t,r){e=$a(e),t=jh(t);var n=e.length;r=r===void 0?n:X_($i(r),0,n);var i=r;return r-=t.length,r>=0&&e.slice(r,i)==t}function J1e(e,t){return rs(t,function(r){return[r,e[r]]})}function txe(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=[n,n]}),r}var exe="[object Map]",rxe="[object Set]";function uct(e){return function(t){var r=ov(t);return r==exe?N6(t):r==rxe?txe(t):J1e(t,e(t))}}var nxe=uct(Es),kY=nxe,ixe=uct(fh),zY=ixe,axe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},oxe=I6(axe),sxe=oxe,cct=/[&<>"']/g,lxe=RegExp(cct.source);function j6(e){return e=$a(e),e&&lxe.test(e)?e.replace(cct,sxe):e}var hct=/[\\^$.*+?()[\]{}|]/g,uxe=RegExp(hct.source);function cxe(e){return e=$a(e),e&&uxe.test(e)?e.replace(hct,"\\$&"):e}function fct(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}function hxe(e,t){var r=!0;return I0(e,function(n,i,a){return r=!!t(n,i,a),r}),r}function uL(e,t,r){var n=Xn(e)?fct:hxe;return r&&hc(e,t,r)&&(t=void 0),n(e,Ri(t))}var fxe=4294967295;function dct(e){return e?X_($i(e),0,fxe):0}function dxe(e,t,r,n){var i=e.length;for(r=$i(r),r<0&&(r=-r>i?0:i+r),n=n===void 0||n>i?i:$i(n),n<0&&(n+=i),n=r>n?0:dct(n);r<n;)e[r++]=t;return e}function pxe(e,t,r,n){var i=e==null?0:e.length;return i?(r&&typeof r!="number"&&hc(e,t,r)&&(r=0,n=i),dxe(e,t,r,n)):[]}function pct(e,t){var r=[];return I0(e,function(n,i,a){t(n,i,a)&&r.push(n)}),r}function Fg(e,t){var r=Xn(e)?R0:pct;return r(e,Ri(t))}function vct(e){return function(t,r,n){var i=Object(t);if(!hh(t)){var a=Ri(r);t=Es(t),r=function(s){return a(i[s],s,i)}}var o=e(t,r,n);return o>-1?i[a?t[o]:o]:void 0}}var vxe=Math.max;function xb(e,t,r){var n=e==null?0:e.length;if(!n)return-1;var i=r==null?0:$i(r);return i<0&&(i=vxe(n+i,0)),Q3(e,Ri(t),i)}var gxe=vct(xb),Hu=gxe;function gct(e,t,r){var n;return r(e,function(i,a,o){if(t(i,a,o))return n=a,!1}),n}function mxe(e,t){return gct(e,Ri(t),pv)}var yxe=Math.max,_xe=Math.min;function mct(e,t,r){var n=e==null?0:e.length;if(!n)return-1;var i=n-1;return r!==void 0&&(i=$i(r),i=r<0?yxe(n+i,0):_xe(i,n-1)),Q3(e,Ri(t),i,!0)}var xxe=vct(mct),cL=xxe;function bxe(e,t){return gct(e,Ri(t),X6)}function w_(e){return e&&e.length?e[0]:void 0}function yct(e,t){var r=-1,n=hh(e)?Array(e.length):[];return I0(e,function(i,a,o){n[++r]=t(i,a,o)}),n}function oa(e,t){var r=Xn(e)?rs:yct;return r(e,Ri(t))}function R2(e,t){return yu(oa(e,t),1)}var Exe=1/0;function wxe(e,t){return yu(oa(e,t),Exe)}function Cxe(e,t,r){return r=r===void 0?1:$i(r),yu(oa(e,t),r)}var Sxe=1/0;function _ct(e){var t=e==null?0:e.length;return t?yu(e,Sxe):[]}function Txe(e,t){var r=e==null?0:e.length;return r?(t=t===void 0?1:$i(t),yu(e,t)):[]}var Axe=512;function Mxe(e){return Ig(e,Axe)}var Rxe=L6("floor"),Ixe=Rxe,Lxe="Expected a function",Oxe=8,Pxe=32,Dxe=128,Fxe=256;function xct(e){return Dg(function(t){var r=t.length,n=r,i=Jf.prototype.thru;for(e&&t.reverse();n--;){var a=t[n];if(typeof a!="function")throw new TypeError(Lxe);if(i&&!o&&IM(a)=="wrapper")var o=new Jf([],!0)}for(n=o?n:r;++n<r;){a=t[n];var s=IM(a),l=s=="wrapper"?y6(a):void 0;l&&jB(l[0])&&l[1]==(Dxe|Oxe|Pxe|Fxe)&&!l[4].length&&l[9]==1?o=o[IM(l[0])].apply(o,l[3]):o=a.length==1&&jB(a)?o[s]():o.thru(a)}return function(){var u=arguments,c=u[0];if(o&&u.length==1&&Xn(c))return o.plant(c).value();for(var f=0,d=r?t[f].apply(this,u):c;++f<r;)d=t[f].call(this,d);return d}})}var Bxe=xct(),Nxe=Bxe,kxe=xct(!0),zxe=kxe;function bct(e,t){return e==null?e:$6(e,vv(t),fh)}function Uxe(e,t){return e==null?e:sct(e,vv(t),fh)}function $xe(e,t){return e&&pv(e,vv(t))}function Hxe(e,t){return e&&X6(e,vv(t))}function Vxe(e){for(var t=-1,r=e==null?0:e.length,n={};++t<r;){var i=e[t];n[i[0]]=i[1]}return n}function hL(e,t){return R0(t,function(r){return mu(e[r])})}function Gxe(e){return e==null?[]:hL(e,Es(e))}function Wxe(e){return e==null?[]:hL(e,fh(e))}var Xxe=Object.prototype,jxe=Xxe.hasOwnProperty,Yxe=oL(function(e,t,r){jxe.call(e,r)?e[r].push(t):Lg(e,r,[t])}),Zxe=Yxe;function Y6(e,t){return e>t}function fL(e){return function(t,r){return typeof t=="string"&&typeof r=="string"||(t=Hh(t),r=Hh(r)),e(t,r)}}var qxe=fL(Y6),Kxe=qxe,Qxe=fL(function(e,t){return e>=t}),Jxe=Qxe,tbe=Object.prototype,ebe=tbe.hasOwnProperty;function rbe(e,t){return e!=null&&ebe.call(e,t)}function r5(e,t){return e!=null&&Yut(e,t,rbe)}var nbe=Math.max,ibe=Math.min;function abe(e,t,r){return e>=ibe(t,r)&&e<nbe(t,r)}function n5(e,t,r){return t=mg(t),r===void 0?(r=t,t=0):r=mg(r),e=Hh(e),abe(e,t,r)}var obe="[object String]";function iE(e){return typeof e=="string"||!Xn(e)&&Fs(e)&&dc(e)==obe}function Z6(e,t){return rs(t,function(r){return e[r]})}function Bg(e){return e==null?[]:Z6(e,Es(e))}var sbe=Math.max;function lc(e,t,r,n){e=hh(e)?e:Bg(e),r=r&&!n?$i(r):0;var i=e.length;return r<0&&(r=sbe(i+r,0)),iE(e)?r<=i&&e.indexOf(t,r)>-1:!!i&&Qb(e,t,r)>-1}var lbe=Math.max;function dL(e,t,r){var n=e==null?0:e.length;if(!n)return-1;var i=r==null?0:$i(r);return i<0&&(i=lbe(n+i,0)),Qb(e,t,i)}function ube(e){var t=e==null?0:e.length;return t?ed(e,0,-1):[]}var cbe=Math.min;function q6(e,t,r){for(var n=r?W6:J3,i=e[0].length,a=e.length,o=a,s=Array(a),l=1/0,u=[];o--;){var c=e[o];o&&t&&(c=rs(c,Zh(t))),l=cbe(c.length,l),s[o]=!r&&(t||i>=120&&c.length>=120)?new b_(o&&c):void 0}c=e[0];var f=-1,d=s[0];t:for(;++f<i&&u.length<l;){var v=c[f],g=t?t(v):v;if(v=r||v!==0?v:0,!(d?vS(d,g):n(u,g,r))){for(o=a;--o;){var x=s[o];if(!(x?vS(x,g):n(e[o],g,r)))continue t}d&&d.push(g),u.push(v)}}return u}function K6(e){return Xs(e)?e:[]}var hbe=Ji(function(e){var t=rs(e,K6);return t.length&&t[0]===e[0]?q6(t):[]}),Ect=hbe,fbe=Ji(function(e){var t=no(e),r=rs(e,K6);return t===no(r)?t=void 0:r.pop(),r.length&&r[0]===e[0]?q6(r,Ri(t)):[]}),dbe=fbe,pbe=Ji(function(e){var t=no(e),r=rs(e,K6);return t=typeof t=="function"?t:void 0,t&&r.pop(),r.length&&r[0]===e[0]?q6(r,void 0,t):[]}),vbe=pbe;function gbe(e,t,r,n){return pv(e,function(i,a,o){t(n,r(i),a,o)}),n}function wct(e,t){return function(r,n){return gbe(r,e,t(n),{})}}var mbe=Object.prototype,ybe=mbe.toString,_be=wct(function(e,t,r){t!=null&&typeof t.toString!="function"&&(t=ybe.call(t)),e[t]=r},Bx(Wu)),xbe=_be,Cct=Object.prototype,bbe=Cct.hasOwnProperty,Ebe=Cct.toString,wbe=wct(function(e,t,r){t!=null&&typeof t.toString!="function"&&(t=Ebe.call(t)),bbe.call(e,t)?e[t].push(r):e[t]=[r]},Ri),Cbe=wbe;function Sct(e,t){return t.length<2?e:W_(e,ed(t,0,-1))}function I2(e,t,r){t=T0(t,e),e=Sct(e,t);var n=e==null?e:e[dv(no(t))];return n==null?void 0:Yh(n,e,r)}var Sbe=Ji(I2),Tbe=Sbe,Abe=Ji(function(e,t,r){var n=-1,i=typeof t=="function",a=hh(e)?Array(e.length):[];return I0(e,function(o){a[++n]=i?Yh(t,o,r):I2(o,t,r)}),a}),Mbe=Abe,Rbe="[object ArrayBuffer]";function Ibe(e){return Fs(e)&&dc(e)==Rbe}var UY=td&&td.isArrayBuffer,Lbe=UY?Zh(UY):Ibe,Obe=Lbe,Pbe="[object Boolean]";function Gp(e){return e===!0||e===!1||Fs(e)&&dc(e)==Pbe}var Dbe="[object Date]";function Fbe(e){return Fs(e)&&dc(e)==Dbe}var $Y=td&&td.isDate,Bbe=$Y?Zh($Y):Fbe,Nbe=Bbe;function kbe(e){return Fs(e)&&e.nodeType===1&&!S2(e)}var zbe="[object Map]",Ube="[object Set]",$be=Object.prototype,Hbe=$be.hasOwnProperty;function Dr(e){if(e==null)return!0;if(hh(e)&&(Xn(e)||typeof e=="string"||typeof e.splice=="function"||v0(e)||eE(e)||__(e)))return!e.length;var t=ov(e);if(t==zbe||t==Ube)return!e.size;if(C2(e))return!E6(e).length;for(var r in e)if(Hbe.call(e,r))return!1;return!0}function pu(e,t){return A2(e,t)}function Vbe(e,t,r){r=typeof r=="function"?r:void 0;var n=r?r(e,t):void 0;return n===void 0?A2(e,t,void 0,r):!!n}var Gbe=Zl.isFinite;function Wbe(e){return typeof e=="number"&&Gbe(e)}function Tct(e){return typeof e=="number"&&e==$i(e)}function Xbe(e,t){return e===t||k6(e,t,z6(t))}function jbe(e,t,r){return r=typeof r=="function"?r:void 0,k6(e,t,z6(t),r)}var Ybe="[object Number]";function ac(e){return typeof e=="number"||Fs(e)&&dc(e)==Ybe}function Act(e){return ac(e)&&e!=+e}var Zbe=RM?mu:b6,qbe=Zbe,Kbe="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.";function Qbe(e){if(qbe(e))throw new Error(Kbe);return klt(e)}function Sl(e){return e==null}function Mct(e){return e===null}var Jbe="[object RegExp]";function tEe(e){return Fs(e)&&dc(e)==Jbe}var HY=td&&td.isRegExp,eEe=HY?Zh(HY):tEe,Q6=eEe,VY=9007199254740991;function rEe(e){return Tct(e)&&e>=-VY&&e<=VY}function pL(e){return e===void 0}var nEe="[object WeakMap]";function iEe(e){return Fs(e)&&ov(e)==nEe}var aEe="[object WeakSet]";function oEe(e){return Fs(e)&&dc(e)==aEe}var sEe=1;function lEe(e){return Ri(typeof e=="function"?e:Yf(e,sEe))}var uEe=Array.prototype,cEe=uEe.join;function hEe(e,t){return e==null?"":cEe.call(e,t)}var fEe=nE(function(e,t,r){return e+(r?"-":"")+t.toLowerCase()}),dEe=fEe,pEe=oL(function(e,t,r){Lg(e,r,t)}),vEe=pEe;function gEe(e,t,r){for(var n=r+1;n--;)if(e[n]===t)return n;return n}var mEe=Math.max,yEe=Math.min;function _Ee(e,t,r){var n=e==null?0:e.length;if(!n)return-1;var i=n;return r!==void 0&&(i=$i(r),i=i<0?mEe(n+i,0):yEe(i,n-1)),t===t?gEe(e,t,i):Q3(e,Wlt,i,!0)}var xEe=nE(function(e,t,r){return e+(r?" ":"")+t.toLowerCase()}),J6=xEe,bEe=put("toLowerCase"),EEe=bEe;function t8(e,t){return e<t}var wEe=fL(t8),CEe=wEe,SEe=fL(function(e,t){return e<=t}),TEe=SEe;function Rct(e,t){var r={};return t=Ri(t),pv(e,function(n,i,a){Lg(r,t(n,i,a),n)}),r}function AEe(e,t){var r={};return t=Ri(t),pv(e,function(n,i,a){Lg(r,i,t(n,i,a))}),r}var MEe=1;function i5(e){return jut(Yf(e,MEe))}var REe=1;function IEe(e,t){return Zut(e,Yf(t,REe))}function vL(e,t,r){for(var n=-1,i=e.length;++n<i;){var a=e[n],o=t(a);if(o!=null&&(s===void 0?o===o&&!Xh(o):r(o,s)))var s=o,l=a}return l}function bb(e){return e&&e.length?vL(e,Wu,Y6):void 0}function e8(e,t){return e&&e.length?vL(e,Ri(t),Y6):void 0}function r8(e,t){for(var r,n=-1,i=e.length;++n<i;){var a=t(e[n]);a!==void 0&&(r=r===void 0?a:r+a)}return r}var LEe=0/0;function Ict(e,t){var r=e==null?0:e.length;return r?r8(e,t)/r:LEe}function OEe(e){return Ict(e,Wu)}function PEe(e,t){return Ict(e,Ri(t))}var DEe=tE(function(e,t,r){sL(e,t,r)}),fI=DEe,FEe=Ji(function(e,t){return function(r){return I2(r,e,t)}}),BEe=FEe,NEe=Ji(function(e,t){return function(r){return I2(e,r,t)}}),kEe=NEe;function n8(e){return e&&e.length?vL(e,Wu,t8):void 0}function zEe(e,t){return e&&e.length?vL(e,Ri(t),t8):void 0}function Lct(e,t,r){var n=Es(t),i=hL(t,n),a=!(ro(r)&&"chain"in r)||!!r.chain,o=mu(e);return ld(i,function(s){var l=t[s];e[s]=l,o&&(e.prototype[s]=function(){var u=this.__chain__;if(a||u){var c=e(this.__wrapped__),f=c.__actions__=Jc(this.__actions__);return f.push({func:l,args:arguments,thisArg:e}),c.__chain__=u,c}return l.apply(e,A0([this.value()],arguments))})}),e}var UEe=Z3(function(e,t){return e*t},1),$Ee=UEe,HEe="Expected a function";function L2(e){if(typeof e!="function")throw new TypeError(HEe);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function VEe(e){for(var t,r=[];!(t=e.next()).done;)r.push(t.value);return r}var GEe="[object Map]",WEe="[object Set]",JP=$u?$u.iterator:void 0;function Oct(e){if(!e)return[];if(hh(e))return iE(e)?Kd(e):Jc(e);if(JP&&e[JP])return VEe(e[JP]());var t=ov(e),r=t==GEe?N6:t==WEe?aL:Bg;return r(e)}function XEe(){this.__values__===void 0&&(this.__values__=Oct(this.value()));var e=this.__index__>=this.__values__.length,t=e?void 0:this.__values__[this.__index__++];return{done:e,value:t}}function Pct(e,t){var r=e.length;if(r)return t+=t<0?r:0,Rg(t,r)?e[t]:void 0}function jEe(e,t){return e&&e.length?Pct(e,$i(t)):void 0}function YEe(e){return e=$i(e),Ji(function(t){return Pct(t,e)})}function i8(e,t){return t=T0(t,e),e=Sct(e,t),e==null||delete e[dv(no(t))]}function ZEe(e){return S2(e)?void 0:e}var qEe=1,KEe=2,QEe=4,JEe=Dg(function(e,t){var r={};if(e==null)return r;var n=!1;t=rs(t,function(a){return a=T0(a,e),n||(n=a.length>1),a}),fv(e,D6(e),r),n&&(r=Yf(r,qEe|KEe|QEe,ZEe));for(var i=t.length;i--;)i8(r,t[i]);return r}),a8=JEe;function O2(e,t,r,n){if(!ro(e))return e;t=T0(t,e);for(var i=-1,a=t.length,o=a-1,s=e;s!=null&&++i<a;){var l=dv(t[i]),u=r;if(l==="__proto__"||l==="constructor"||l==="prototype")return e;if(i!=o){var c=s[l];u=n?n(c,l,s):void 0,u===void 0&&(u=ro(c)?c:Rg(t[i+1])?[]:{})}w2(s,l,u),s=s[l]}return e}function Dct(e,t,r){for(var n=-1,i=t.length,a={};++n<i;){var o=t[n],s=W_(e,o);r(s,o)&&O2(a,T0(o,e),s)}return a}function o8(e,t){if(e==null)return{};var r=rs(D6(e),function(n){return[n]});return t=Ri(t),Dct(e,r,function(n,i){return t(n,i[0])})}function twe(e,t){return o8(e,L2(Ri(t)))}function ewe(e){return out(2,e)}function rwe(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}function Fct(e,t){if(e!==t){var r=e!==void 0,n=e===null,i=e===e,a=Xh(e),o=t!==void 0,s=t===null,l=t===t,u=Xh(t);if(!s&&!u&&!a&&e>t||a&&o&&l&&!s&&!u||n&&o&&l||!r&&l||!i)return 1;if(!n&&!a&&!u&&e<t||u&&r&&i&&!n&&!a||s&&r&&i||!o&&i||!l)return-1}return 0}function nwe(e,t,r){for(var n=-1,i=e.criteria,a=t.criteria,o=i.length,s=r.length;++n<o;){var l=Fct(i[n],a[n]);if(l){if(n>=s)return l;var u=r[n];return l*(u=="desc"?-1:1)}}return e.index-t.index}function Bct(e,t,r){t.length?t=rs(t,function(a){return Xn(a)?function(o){return W_(o,a.length===1?a[0]:a)}:a}):t=[Wu];var n=-1;t=rs(t,Zh(Ri));var i=yct(e,function(a,o,s){var l=rs(t,function(u){return u(a)});return{criteria:l,index:++n,value:a}});return rwe(i,function(a,o){return nwe(a,o,r)})}function s8(e,t,r,n){return e==null?[]:(Xn(t)||(t=t==null?[]:[t]),r=n?void 0:r,Xn(r)||(r=r==null?[]:[r]),Bct(e,t,r))}function l8(e){return Dg(function(t){return t=rs(t,Zh(Ri)),Ji(function(r){var n=this;return e(t,function(i){return Yh(i,n,r)})})})}var iwe=l8(rs),awe=iwe,owe=Ji,swe=owe,lwe=Math.min,uwe=swe(function(e,t){t=t.length==1&&Xn(t[0])?rs(t[0],Zh(Ri)):rs(yu(t,1),Zh(Ri));var r=t.length;return Ji(function(n){for(var i=-1,a=lwe(n.length,r);++i<a;)n[i]=t[i].call(this,n[i]);return Yh(e,this,n)})}),cwe=uwe,hwe=l8(fct),fwe=hwe,dwe=l8(B6),pwe=dwe,vwe=9007199254740991,gwe=Math.floor;function a5(e,t){var r="";if(!e||t<1||t>vwe)return r;do t%2&&(r+=e),t=gwe(t/2),t&&(e+=e);while(t);return r}var mwe=U6("length"),ywe=mwe,Nct="\\ud800-\\udfff",_we="\\u0300-\\u036f",xwe="\\ufe20-\\ufe2f",bwe="\\u20d0-\\u20ff",Ewe=_we+xwe+bwe,wwe="\\ufe0e\\ufe0f",Cwe="["+Nct+"]",o5="["+Ewe+"]",s5="\\ud83c[\\udffb-\\udfff]",Swe="(?:"+o5+"|"+s5+")",kct="[^"+Nct+"]",zct="(?:\\ud83c[\\udde6-\\uddff]){2}",Uct="[\\ud800-\\udbff][\\udc00-\\udfff]",Twe="\\u200d",$ct=Swe+"?",Hct="["+wwe+"]?",Awe="(?:"+Twe+"(?:"+[kct,zct,Uct].join("|")+")"+Hct+$ct+")*",Mwe=Hct+$ct+Awe,Rwe="(?:"+[kct+o5+"?",o5,zct,Uct,Cwe].join("|")+")",GY=RegExp(s5+"(?="+s5+")|"+Rwe+Mwe,"g");function Iwe(e){for(var t=GY.lastIndex=0;GY.test(e);)++t;return t}function aE(e){return rE(e)?Iwe(e):ywe(e)}var Lwe=Math.ceil;function dI(e,t){t=t===void 0?" ":jh(t);var r=t.length;if(r<2)return r?a5(t,e):t;var n=a5(t,Lwe(e/aE(t)));return rE(t)?M0(Kd(n),0,e).join(""):n.slice(0,e)}var Owe=Math.ceil,Pwe=Math.floor;function Dwe(e,t,r){e=$a(e),t=$i(t);var n=t?aE(e):0;if(!t||n>=t)return e;var i=(t-n)/2;return dI(Pwe(i),r)+e+dI(Owe(i),r)}function Fwe(e,t,r){e=$a(e),t=$i(t);var n=t?aE(e):0;return t&&n<t?e+dI(t-n,r):e}function Bwe(e,t,r){e=$a(e),t=$i(t);var n=t?aE(e):0;return t&&n<t?dI(t-n,r)+e:e}var Nwe=/^\s+/,kwe=Zl.parseInt;function zwe(e,t,r){return r||t==null?t=0:t&&(t=+t),kwe($a(e).replace(Nwe,""),t||0)}var Uwe=32,u8=Ji(function(e,t){var r=p0(t,Jb(u8));return Ig(e,Uwe,void 0,t,r)});u8.placeholder={};var Vct=u8,$we=64,c8=Ji(function(e,t){var r=p0(t,Jb(c8));return Ig(e,$we,void 0,t,r)});c8.placeholder={};var Hwe=c8,Vwe=oL(function(e,t,r){e[r?0:1].push(t)},function(){return[[],[]]}),Gwe=Vwe;function Wwe(e,t){return Dct(e,t,function(r,n){return E_(e,n)})}var Xwe=Dg(function(e,t){return e==null?{}:Wwe(e,t)}),Gct=Xwe;function jwe(e){for(var t,r=this;r instanceof q3;){var n=Hlt(r);n.__index__=0,n.__values__=void 0,t?i.__wrapped__=n:t=n;var i=n;r=r.__wrapped__}return i.__wrapped__=e,t}function Ywe(e){return function(t){return e==null?void 0:W_(e,t)}}function Zwe(e,t,r,n){for(var i=r-1,a=e.length;++i<a;)if(n(e[i],t))return i;return-1}var qwe=Array.prototype,WY=qwe.splice;function h8(e,t,r,n){var i=n?Zwe:Qb,a=-1,o=t.length,s=e;for(e===t&&(t=Jc(t)),r&&(s=rs(e,Zh(r)));++a<o;)for(var l=0,u=t[a],c=r?r(u):u;(l=i(s,c,l,n))>-1;)s!==e&&WY.call(s,l,1),WY.call(e,l,1);return e}function Wct(e,t){return e&&e.length&&t&&t.length?h8(e,t):e}var Kwe=Ji(Wct),Qwe=Kwe;function Jwe(e,t,r){return e&&e.length&&t&&t.length?h8(e,t,Ri(r)):e}function tCe(e,t,r){return e&&e.length&&t&&t.length?h8(e,t,void 0,r):e}var eCe=Array.prototype,rCe=eCe.splice;function Xct(e,t){for(var r=e?t.length:0,n=r-1;r--;){var i=t[r];if(r==n||i!==a){var a=i;Rg(i)?rCe.call(e,i,1):i8(e,i)}}return e}var nCe=Dg(function(e,t){var r=e==null?0:e.length,n=C6(e,t);return Xct(e,rs(t,function(i){return Rg(i,r)?+i:i}).sort(Fct)),n}),iCe=nCe,aCe=Math.floor,oCe=Math.random;function f8(e,t){return e+aCe(oCe()*(t-e+1))}var sCe=parseFloat,lCe=Math.min,uCe=Math.random;function cCe(e,t,r){if(r&&typeof r!="boolean"&&hc(e,t,r)&&(t=r=void 0),r===void 0&&(typeof t=="boolean"?(r=t,t=void 0):typeof e=="boolean"&&(r=e,e=void 0)),e===void 0&&t===void 0?(e=0,t=1):(e=mg(e),t===void 0?(t=e,e=0):t=mg(t)),e>t){var n=e;e=t,t=n}if(r||e%1||t%1){var i=uCe();return lCe(e+i*(t-e+sCe("1e-"+((i+"").length-1))),t)}return f8(e,t)}var hCe=Math.ceil,fCe=Math.max;function dCe(e,t,r,n){for(var i=-1,a=fCe(hCe((t-e)/(r||1)),0),o=Array(a);a--;)o[n?a:++i]=e,e+=r;return o}function jct(e){return function(t,r,n){return n&&typeof n!="number"&&hc(t,r,n)&&(r=n=void 0),t=mg(t),r===void 0?(r=t,t=0):r=mg(r),n=n===void 0?t<r?1:-1:mg(n),dCe(t,r,n,e)}}var pCe=jct(),kx=pCe,vCe=jct(!0),gCe=vCe,mCe=256,yCe=Dg(function(e,t){return Ig(e,mCe,void 0,void 0,void 0,t)}),_Ce=yCe;function Yct(e,t,r,n,i){return i(e,function(a,o,s){r=n?(n=!1,a):t(r,a,o,s)}),r}function gL(e,t,r){var n=Xn(e)?R6:Yct,i=arguments.length<3;return n(e,Ri(t),r,i,I0)}function xCe(e,t,r,n){var i=e==null?0:e.length;for(n&&i&&(r=e[--i]);i--;)r=t(r,e[i],i,e);return r}function bCe(e,t,r){var n=Xn(e)?xCe:Yct,i=arguments.length<3;return n(e,Ri(t),r,i,lct)}function ECe(e,t){var r=Xn(e)?R0:pct;return r(e,L2(Ri(t)))}function wCe(e,t){var r=[];if(!(e&&e.length))return r;var n=-1,i=[],a=e.length;for(t=Ri(t);++n<a;){var o=e[n];t(o,n,e)&&(r.push(o),i.push(n))}return Xct(e,i),r}function CCe(e,t,r){return(r?hc(e,t,r):t===void 0)?t=1:t=$i(t),a5($a(e),t)}function SCe(){var e=arguments,t=$a(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var TCe="Expected a function";function ACe(e,t){if(typeof e!="function")throw new TypeError(TCe);return t=t===void 0?t:$i(t),Ji(e,t)}function MCe(e,t,r){t=T0(t,e);var n=-1,i=t.length;for(i||(i=1,e=void 0);++n<i;){var a=e==null?void 0:e[dv(t[n])];a===void 0&&(n=i,a=r),e=mu(a)?a.call(e):a}return e}var RCe=Array.prototype,ICe=RCe.reverse;function l5(e){return e==null?e:ICe.call(e)}var LCe=L6("round"),OCe=LCe;function Zct(e){var t=e.length;return t?e[f8(0,t-1)]:void 0}function PCe(e){return Zct(Bg(e))}function DCe(e){var t=Xn(e)?Zct:PCe;return t(e)}function mL(e,t){var r=-1,n=e.length,i=n-1;for(t=t===void 0?n:t;++r<t;){var a=f8(r,i),o=e[a];e[a]=e[r],e[r]=o}return e.length=t,e}function FCe(e,t){return mL(Jc(e),X_(t,0,e.length))}function BCe(e,t){var r=Bg(e);return mL(r,X_(t,0,r.length))}function NCe(e,t,r){(r?hc(e,t,r):t===void 0)?t=1:t=$i(t);var n=Xn(e)?FCe:BCe;return n(e,t)}function mS(e,t,r){return e==null?e:O2(e,t,r)}function kCe(e,t,r,n){return n=typeof n=="function"?n:void 0,e==null?e:O2(e,t,r,n)}function zCe(e){return mL(Jc(e))}function UCe(e){return mL(Bg(e))}function $Ce(e){var t=Xn(e)?zCe:UCe;return t(e)}var HCe="[object Map]",VCe="[object Set]";function px(e){if(e==null)return 0;if(hh(e))return iE(e)?aE(e):e.length;var t=ov(e);return t==HCe||t==VCe?e.size:E6(e).length}function GCe(e,t,r){var n=e==null?0:e.length;return n?(r&&typeof r!="number"&&hc(e,t,r)?(t=0,r=n):(t=t==null?0:$i(t),r=r===void 0?n:$i(r)),ed(e,t,r)):[]}var WCe=nE(function(e,t,r){return e+(r?"_":"")+t.toLowerCase()}),XCe=WCe;function jCe(e,t){var r;return I0(e,function(n,i,a){return r=t(n,i,a),!r}),!!r}function qct(e,t,r){var n=Xn(e)?B6:jCe;return r&&hc(e,t,r)&&(t=void 0),n(e,Ri(t))}var YCe=Ji(function(e,t){if(e==null)return[];var r=t.length;return r>1&&hc(e,t[0],t[1])?t=[]:r>2&&hc(t[0],t[1],t[2])&&(t=[t[0]]),Bct(e,yu(t,1),[])}),Kct=YCe,ZCe=4294967295,qCe=ZCe-1,KCe=Math.floor,QCe=Math.min;function d8(e,t,r,n){var i=0,a=e==null?0:e.length;if(a===0)return 0;t=r(t);for(var o=t!==t,s=t===null,l=Xh(t),u=t===void 0;i<a;){var c=KCe((i+a)/2),f=r(e[c]),d=f!==void 0,v=f===null,g=f===f,x=Xh(f);if(o)var w=n||g;else u?w=g&&(n||d):s?w=g&&d&&(n||!v):l?w=g&&d&&!v&&(n||!x):v||x?w=!1:w=n?f<=t:f<t;w?i=c+1:a=c}return QCe(a,qCe)}var JCe=4294967295,tSe=JCe>>>1;function yL(e,t,r){var n=0,i=e==null?n:e.length;if(typeof t=="number"&&t===t&&i<=tSe){for(;n<i;){var a=n+i>>>1,o=e[a];o!==null&&!Xh(o)&&(r?o<=t:o<t)?n=a+1:i=a}return i}return d8(e,t,Wu,r)}function eSe(e,t){return yL(e,t)}function rSe(e,t,r){return d8(e,t,Ri(r))}function nSe(e,t){var r=e==null?0:e.length;if(r){var n=yL(e,t);if(n<r&&ap(e[n],t))return n}return-1}function iSe(e,t){return yL(e,t,!0)}function aSe(e,t,r){return d8(e,t,Ri(r),!0)}function oSe(e,t){var r=e==null?0:e.length;if(r){var n=yL(e,t,!0)-1;if(ap(e[n],t))return n}return-1}function Qct(e,t){for(var r=-1,n=e.length,i=0,a=[];++r<n;){var o=e[r],s=t?t(o):o;if(!r||!ap(s,l)){var l=s;a[i++]=o===0?0:o}}return a}function sSe(e){return e&&e.length?Qct(e):[]}function lSe(e,t){return e&&e.length?Qct(e,Ri(t)):[]}var uSe=4294967295;function p8(e,t,r){return r&&typeof r!="number"&&hc(e,t,r)&&(t=r=void 0),r=r===void 0?uSe:r>>>0,r?(e=$a(e),e&&(typeof t=="string"||t!=null&&!Q6(t))&&(t=jh(t),!t&&rE(e))?M0(Kd(e),0,r):e.split(t,r)):[]}var cSe="Expected a function",hSe=Math.max;function fSe(e,t){if(typeof e!="function")throw new TypeError(cSe);return t=t==null?0:hSe($i(t),0),Ji(function(r){var n=r[t],i=M0(r,0,t);return n&&A0(i,n),Yh(e,this,i)})}var dSe=nE(function(e,t,r){return e+(r?" ":"")+M6(t)}),pSe=dSe;function vSe(e,t,r){return e=$a(e),r=r==null?0:X_($i(r),0,e.length),t=jh(t),e.slice(r,r+t.length)==t}function gSe(){return{}}function mSe(){return""}function Jct(){return!0}var ySe=Z3(function(e,t){return e-t},0),_Se=ySe;function xSe(e){return e&&e.length?r8(e,Wu):0}function tht(e,t){return e&&e.length?r8(e,Ri(t)):0}function bSe(e){var t=e==null?0:e.length;return t?ed(e,1,t):[]}function ESe(e,t,r){return e&&e.length?(t=r||t===void 0?1:$i(t),ed(e,0,t<0?0:t)):[]}function wSe(e,t,r){var n=e==null?0:e.length;return n?(t=r||t===void 0?1:$i(t),t=n-t,ed(e,t<0?0:t,n)):[]}function CSe(e,t){return e&&e.length?lL(e,Ri(t),!1,!0):[]}function SSe(e,t){return e&&e.length?lL(e,Ri(t)):[]}function TSe(e,t){return t(e),e}var eht=Object.prototype,ASe=eht.hasOwnProperty;function XY(e,t,r,n){return e===void 0||ap(e,eht[r])&&!ASe.call(n,r)?t:e}var MSe={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};function RSe(e){return"\\"+MSe[e]}var ISe=/<%=([\s\S]+?)%>/g,rht=ISe,LSe=/<%-([\s\S]+?)%>/g,OSe=LSe,PSe=/<%([\s\S]+?)%>/g,DSe=PSe,FSe={escape:OSe,evaluate:DSe,interpolate:rht,variable:"",imports:{_:{escape:j6}}},u5=FSe,BSe="Invalid `variable` option passed into `_.template`",NSe=/\b__p \+= '';/g,kSe=/\b(__p \+=) '' \+/g,zSe=/(__e\(.*?\)|\b__t\)) \+\n'';/g,USe=/[()=,{}\[\]\/\s]/,$Se=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,jA=/($^)/,HSe=/['\n\r\u2028\u2029\\]/g,VSe=Object.prototype,jY=VSe.hasOwnProperty;function GSe(e,t,r){var n=u5.imports._.templateSettings||u5;r&&hc(e,t,r)&&(t=void 0),e=$a(e),t=uI({},t,n,XY);var i=uI({},t.imports,n.imports,XY),a=Es(i),o=Z6(i,a),s,l,u=0,c=t.interpolate||jA,f="__p += '",d=RegExp((t.escape||jA).source+"|"+c.source+"|"+(c===rht?$Se:jA).source+"|"+(t.evaluate||jA).source+"|$","g"),v=jY.call(t,"sourceURL")?"//# sourceURL="+(t.sourceURL+"").replace(/\s/g," ")+`
`:"";e.replace(d,function(w,S,M,R,I,P){return M||(M=R),f+=e.slice(u,P).replace(HSe,RSe),S&&(s=!0,f+=`' +
__e(`+S+`) +
'`),I&&(l=!0,f+=`';
`+I+`;
__p += '`),M&&(f+=`' +
((__t = (`+M+`)) == null ? '' : __t) +
'`),u=P+w.length,w}),f+=`';
`;var g=jY.call(t,"variable")&&t.variable;if(!g)f=`with (obj) {
`+f+`
}
`;else if(USe.test(g))throw new Error(BSe);f=(l?f.replace(NSe,""):f).replace(kSe,"$1").replace(zSe,"$1;"),f="function("+(g||"obj")+`) {
`+(g?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(s?", __e = _.escape":"")+(l?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+f+`return __p
}`;var x=aut(function(){return Function(a,v+"return "+f).apply(void 0,o)});if(x.source=f,S6(x))throw x;return x}var WSe="Expected a function";function v8(e,t,r){var n=!0,i=!0;if(typeof e!="function")throw new TypeError(WSe);return ro(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),gS(e,t,{leading:n,maxWait:t,trailing:i})}function P2(e,t){return t(e)}var XSe=9007199254740991,tD=4294967295,jSe=Math.min;function YSe(e,t){if(e=$i(e),e<1||e>XSe)return[];var r=tD,n=jSe(e,tD);t=vv(t),e-=tD;for(var i=x6(n,t);++r<e;)t(r);return i}function ZSe(){return this}function nht(e,t){var r=e;return r instanceof ha&&(r=r.value()),R6(t,function(n,i){return i.func.apply(i.thisArg,A0([n],i.args))},r)}function eD(){return nht(this.__wrapped__,this.__actions__)}function qSe(e){return $a(e).toLowerCase()}function KSe(e){return Xn(e)?rs(e,dv):Xh(e)?[e]:Jc(rut($a(e)))}var YY=9007199254740991;function QSe(e){return e?X_($i(e),-YY,YY):e===0?e:0}function yS(e){return $a(e).toUpperCase()}function JSe(e,t,r){var n=Xn(e),i=n||v0(e)||eE(e);if(t=Ri(t),r==null){var a=e&&e.constructor;i?r=n?new a:[]:ro(e)?r=mu(a)?Kb(iL(e)):{}:r={}}return(i?ld:pv)(e,function(o,s,l){return t(r,o,s,l)}),r}function iht(e,t){for(var r=e.length;r--&&Qb(t,e[r],0)>-1;);return r}function aht(e,t){for(var r=-1,n=e.length;++r<n&&Qb(t,e[r],0)>-1;);return r}function t2e(e,t,r){if(e=$a(e),e&&(r||t===void 0))return Nlt(e);if(!e||!(t=jh(t)))return e;var n=Kd(e),i=Kd(t),a=aht(n,i),o=iht(n,i)+1;return M0(n,a,o).join("")}function e2e(e,t,r){if(e=$a(e),e&&(r||t===void 0))return e.slice(0,Blt(e)+1);if(!e||!(t=jh(t)))return e;var n=Kd(e),i=iht(n,Kd(t))+1;return M0(n,0,i).join("")}var r2e=/^\s+/;function n2e(e,t,r){if(e=$a(e),e&&(r||t===void 0))return e.replace(r2e,"");if(!e||!(t=jh(t)))return e;var n=Kd(e),i=aht(n,Kd(t));return M0(n,i).join("")}var i2e=30,a2e="...",o2e=/\w*$/;function s2e(e,t){var r=i2e,n=a2e;if(ro(t)){var i="separator"in t?t.separator:i;r="length"in t?$i(t.length):r,n="omission"in t?jh(t.omission):n}e=$a(e);var a=e.length;if(rE(e)){var o=Kd(e);a=o.length}if(r>=a)return e;var s=r-aE(n);if(s<1)return n;var l=o?M0(o,0,s).join(""):e.slice(0,s);if(i===void 0)return l+n;if(o&&(s+=l.length-s),Q6(i)){if(e.slice(s).search(i)){var u,c=l;for(i.global||(i=RegExp(i.source,$a(o2e.exec(i))+"g")),i.lastIndex=0;u=i.exec(c);)var f=u.index;l=l.slice(0,f===void 0?s:f)}}else if(e.indexOf(jh(i),s)!=s){var d=l.lastIndexOf(i);d>-1&&(l=l.slice(0,d))}return l+n}function l2e(e){return Ylt(e,1)}var u2e={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},c2e=I6(u2e),h2e=c2e,oht=/&(?:amp|lt|gt|quot|#39);/g,f2e=RegExp(oht.source);function d2e(e){return e=$a(e),e&&f2e.test(e)?e.replace(oht,h2e):e}var p2e=1/0,v2e=Nx&&1/aL(new Nx([,-0]))[1]==p2e?function(e){return new Nx(e)}:K3,g2e=v2e,m2e=200;function g0(e,t,r){var n=-1,i=J3,a=e.length,o=!0,s=[],l=s;if(r)o=!1,i=W6;else if(a>=m2e){var u=t?null:g2e(e);if(u)return aL(u);o=!1,i=vS,l=new b_}else l=t?[]:s;t:for(;++n<a;){var c=e[n],f=t?t(c):c;if(c=r||c!==0?c:0,o&&f===f){for(var d=l.length;d--;)if(l[d]===f)continue t;t&&l.push(f),s.push(c)}else i(l,f,r)||(l!==s&&l.push(f),s.push(c))}return s}var y2e=Ji(function(e){return g0(yu(e,1,Xs,!0))}),_2e=y2e,x2e=Ji(function(e){var t=no(e);return Xs(t)&&(t=void 0),g0(yu(e,1,Xs,!0),Ri(t))}),b2e=x2e,E2e=Ji(function(e){var t=no(e);return t=typeof t=="function"?t:void 0,g0(yu(e,1,Xs,!0),void 0,t)}),w2e=E2e;function ig(e){return e&&e.length?g0(e):[]}function C2e(e,t){return e&&e.length?g0(e,Ri(t)):[]}function S2e(e,t){return t=typeof t=="function"?t:void 0,e&&e.length?g0(e,void 0,t):[]}var T2e=0;function A2e(e){var t=++T2e;return $a(e)+t}function c5(e,t){return e==null?!0:i8(e,t)}var M2e=Math.max;function g8(e){if(!(e&&e.length))return[];var t=0;return e=R0(e,function(r){if(Xs(r))return t=M2e(r.length,t),!0}),x6(t,function(r){return rs(e,U6(r))})}function sht(e,t){if(!(e&&e.length))return[];var r=g8(e);return t==null?r:rs(r,function(n){return Yh(t,void 0,n)})}function lht(e,t,r,n){return O2(e,t,r(W_(e,t)),n)}function R2e(e,t,r){return e==null?e:lht(e,t,vv(r))}function I2e(e,t,r,n){return n=typeof n=="function"?n:void 0,e==null?e:lht(e,t,vv(r),n)}var L2e=nE(function(e,t,r){return e+(r?" ":"")+t.toUpperCase()}),O2e=L2e;function P2e(e){return e==null?[]:Z6(e,fh(e))}var D2e=Ji(function(e,t){return Xs(e)?M2(e,t):[]}),F2e=D2e;function B2e(e,t){return Vct(vv(t),e)}var N2e=Dg(function(e){var t=e.length,r=t?e[0]:0,n=this.__wrapped__,i=function(a){return C6(a,e)};return t>1||this.__actions__.length||!(n instanceof ha)||!Rg(r)?this.thru(i):(n=n.slice(r,+r+(t?1:0)),n.__actions__.push({func:P2,args:[i],thisArg:void 0}),new Jf(n,this.__chain__).thru(function(a){return t&&!a.length&&a.push(void 0),a}))}),k2e=N2e;function z2e(){return Lut(this)}function U2e(){var e=this.__wrapped__;if(e instanceof ha){var t=e;return this.__actions__.length&&(t=new ha(this)),t=t.reverse(),t.__actions__.push({func:P2,args:[l5],thisArg:void 0}),new Jf(t,this.__chain__)}return this.thru(l5)}function m8(e,t,r){var n=e.length;if(n<2)return n?g0(e[0]):[];for(var i=-1,a=Array(n);++i<n;)for(var o=e[i],s=-1;++s<n;)s!=i&&(a[i]=M2(a[i]||o,e[s],t,r));return g0(yu(a,1),t,r)}var $2e=Ji(function(e){return m8(R0(e,Xs))}),H2e=$2e,V2e=Ji(function(e){var t=no(e);return Xs(t)&&(t=void 0),m8(R0(e,Xs),Ri(t))}),G2e=V2e,W2e=Ji(function(e){var t=no(e);return t=typeof t=="function"?t:void 0,m8(R0(e,Xs),void 0,t)}),X2e=W2e,j2e=Ji(g8),_L=j2e;function uht(e,t,r){for(var n=-1,i=e.length,a=t.length,o={};++n<i;){var s=n<a?t[n]:void 0;r(o,e[n],s)}return o}function Y2e(e,t){return uht(e||[],t||[],w2)}function Z2e(e,t){return uht(e||[],t||[],O2)}var q2e=Ji(function(e){var t=e.length,r=t>1?e[t-1]:void 0;return r=typeof r=="function"?(e.pop(),r):void 0,sht(e,r)}),K2e=q2e,Mn={chunk:$0e,compact:Xd,concat:dx,difference:act,differenceBy:$1e,differenceWith:oct,drop:W1e,dropRight:X1e,dropRightWhile:j1e,dropWhile:Y1e,fill:pxe,findIndex:xb,findLastIndex:mct,first:w_,flatten:nut,flattenDeep:_ct,flattenDepth:Txe,fromPairs:Vxe,head:w_,indexOf:dL,initial:ube,intersection:Ect,intersectionBy:dbe,intersectionWith:vbe,join:hEe,last:no,lastIndexOf:_Ee,nth:jEe,pull:Qwe,pullAll:Wct,pullAllBy:Jwe,pullAllWith:tCe,pullAt:iCe,remove:wCe,reverse:l5,slice:GCe,sortedIndex:eSe,sortedIndexBy:rSe,sortedIndexOf:nSe,sortedLastIndex:iSe,sortedLastIndexBy:aSe,sortedLastIndexOf:oSe,sortedUniq:sSe,sortedUniqBy:lSe,tail:bSe,take:ESe,takeRight:wSe,takeRightWhile:CSe,takeWhile:SSe,union:_2e,unionBy:b2e,unionWith:w2e,uniq:ig,uniqBy:C2e,uniqWith:S2e,unzip:g8,unzipWith:sht,without:F2e,xor:H2e,xorBy:G2e,xorWith:X2e,zip:_L,zipObject:Y2e,zipObjectDeep:Z2e,zipWith:K2e},po={countBy:m1e,each:bi,eachRight:NY,every:uL,filter:Fg,find:Hu,findLast:cL,flatMap:R2,flatMapDeep:wxe,flatMapDepth:Cxe,forEach:bi,forEachRight:NY,groupBy:Zxe,includes:lc,invokeMap:Mbe,keyBy:vEe,map:oa,orderBy:s8,partition:Gwe,reduce:gL,reduceRight:bCe,reject:ECe,sample:DCe,sampleSize:NCe,shuffle:$Ce,size:px,some:qct,sortBy:Kct},Q2e={now:LM},Bs={after:Xde,ary:Ylt,before:out,bind:sut,bindKey:wme,curry:H6,curryRight:V6,debounce:gS,defer:F1e,delay:N1e,flip:Mxe,memoize:G_,negate:L2,once:ewe,overArgs:cwe,partial:Vct,partialRight:Hwe,rearg:_Ce,rest:ACe,spread:fSe,throttle:v8,unary:l2e,wrap:B2e},Kn={castArray:D0e,clone:T2,cloneDeep:JB,cloneDeepWith:w_e,cloneWith:S_e,conformsTo:u1e,eq:ap,gt:Kxe,gte:Jxe,isArguments:__,isArray:Xn,isArrayBuffer:Obe,isArrayLike:hh,isArrayLikeObject:Xs,isBoolean:Gp,isBuffer:v0,isDate:Nbe,isElement:kbe,isEmpty:Dr,isEqual:pu,isEqualWith:Vbe,isError:S6,isFinite:Wbe,isFunction:mu,isInteger:Tct,isLength:eL,isMap:zut,isMatch:Xbe,isMatchWith:jbe,isNaN:Act,isNative:Qbe,isNil:Sl,isNull:Mct,isNumber:ac,isObject:ro,isObjectLike:Fs,isPlainObject:S2,isRegExp:Q6,isSafeInteger:rEe,isSet:Uut,isString:iE,isSymbol:Xh,isTypedArray:eE,isUndefined:pL,isWeakMap:iEe,isWeakSet:oEe,lt:CEe,lte:TEe,toArray:Oct,toFinite:mg,toInteger:$i,toLength:dct,toNumber:Hh,toPlainObject:rct,toSafeInteger:QSe,toString:$a},pc={add:Nde,ceil:k0e,divide:G1e,floor:Ixe,max:bb,maxBy:e8,mean:OEe,meanBy:PEe,min:n8,minBy:zEe,multiply:$Ee,round:OCe,subtract:_Se,sum:xSe,sumBy:tht},y8={clamp:cI,inRange:n5,random:cCe},wi={assign:eut,assignIn:pY,assignInWith:uI,assignWith:bge,at:ame,create:y1e,defaults:M1e,defaultsDeep:O1e,entries:kY,entriesIn:zY,extend:pY,extendWith:uI,findKey:mxe,findLastKey:bxe,forIn:bct,forInRight:Uxe,forOwn:$xe,forOwnRight:Hxe,functions:Gxe,functionsIn:Wxe,get:ai,has:r5,hasIn:E_,invert:xbe,invertBy:Cbe,invoke:Tbe,keys:Es,keysIn:fh,mapKeys:Rct,mapValues:AEe,merge:fI,mergeWith:G6,omit:a8,omitBy:twe,pick:Gct,pickBy:o8,result:MCe,set:mS,setWith:kCe,toPairs:kY,toPairsIn:zY,transform:JSe,unset:c5,update:R2e,updateWith:I2e,values:Bg,valuesIn:P2e},gv={at:k2e,chain:Lut,commit:T_e,lodash:mt,next:XEe,plant:jwe,reverse:U2e,tap:TSe,thru:P2,toIterator:ZSe,toJSON:eD,value:eD,valueOf:eD,wrapperChain:z2e},Va={camelCase:P0e,capitalize:vut,deburr:gut,endsWith:Q1e,escape:j6,escapeRegExp:cxe,kebabCase:dEe,lowerCase:J6,lowerFirst:EEe,pad:Dwe,padEnd:Fwe,padStart:Bwe,parseInt:zwe,repeat:CCe,replace:SCe,snakeCase:XCe,split:p8,startCase:pSe,startsWith:vSe,template:GSe,templateSettings:u5,toLower:qSe,toUpper:yS,trim:t2e,trimEnd:e2e,trimStart:n2e,truncate:s2e,unescape:d2e,upperCase:O2e,upperFirst:M6,words:Iut},Ya={attempt:aut,bindAll:_me,cond:Kut,conforms:l1e,constant:Bx,defaultTo:S1e,flow:Nxe,flowRight:zxe,identity:Wu,iteratee:lEe,matches:i5,matchesProperty:IEe,method:BEe,methodOf:kEe,mixin:Lct,noop:K3,nthArg:YEe,over:awe,overEvery:fwe,overSome:pwe,property:qut,propertyOf:Ywe,range:kx,rangeRight:gCe,stubArray:O6,stubFalse:b6,stubObject:gSe,stubString:mSe,stubTrue:Jct,times:YSe,toPath:KSe,uniqueId:A2e};function J2e(){var e=new ha(this.__wrapped__);return e.__actions__=Jc(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Jc(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Jc(this.__views__),e}function tTe(){if(this.__filtered__){var e=new ha(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}var eTe=Math.max,rTe=Math.min;function nTe(e,t,r){for(var n=-1,i=r.length;++n<i;){var a=r[n],o=a.size;switch(a.type){case"drop":e+=o;break;case"dropRight":t-=o;break;case"take":t=rTe(t,e+o);break;case"takeRight":e=eTe(e,t-o);break}}return{start:e,end:t}}var iTe=1,aTe=2,oTe=Math.min;function sTe(){var e=this.__wrapped__.value(),t=this.__dir__,r=Xn(e),n=t<0,i=r?e.length:0,a=nTe(0,i,this.__views__),o=a.start,s=a.end,l=s-o,u=n?s:o-1,c=this.__iteratees__,f=c.length,d=0,v=oTe(l,this.__takeCount__);if(!r||!n&&i==l&&v==l)return nht(e,this.__actions__);var g=[];t:for(;l--&&d<v;){u+=t;for(var x=-1,w=e[u];++x<f;){var S=c[x],M=S.iteratee,R=S.type,I=M(w);if(R==aTe)w=I;else if(!I){if(R==iTe)continue t;break t}}g[d++]=w}return g}/**
 * @license
 * Lodash (Custom Build) <https://lodash.com/>
 * Build: `lodash modularize exports="es" -o ./`
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */var lTe="4.17.21",uTe=2,cTe=1,hTe=3,cht=4294967295,fTe=Array.prototype,dTe=Object.prototype,hht=dTe.hasOwnProperty,ZY=$u?$u.iterator:void 0,pTe=Math.max,qY=Math.min,_8=function(e){return function(t,r,n){if(n==null){var i=ro(r),a=i&&Es(r),o=a&&a.length&&hL(r,a);(o?o.length:i)||(n=r,r=t,t=this)}return e(t,r,n)}}(Lct);mt.after=Bs.after;mt.ary=Bs.ary;mt.assign=wi.assign;mt.assignIn=wi.assignIn;mt.assignInWith=wi.assignInWith;mt.assignWith=wi.assignWith;mt.at=wi.at;mt.before=Bs.before;mt.bind=Bs.bind;mt.bindAll=Ya.bindAll;mt.bindKey=Bs.bindKey;mt.castArray=Kn.castArray;mt.chain=gv.chain;mt.chunk=Mn.chunk;mt.compact=Mn.compact;mt.concat=Mn.concat;mt.cond=Ya.cond;mt.conforms=Ya.conforms;mt.constant=Ya.constant;mt.countBy=po.countBy;mt.create=wi.create;mt.curry=Bs.curry;mt.curryRight=Bs.curryRight;mt.debounce=Bs.debounce;mt.defaults=wi.defaults;mt.defaultsDeep=wi.defaultsDeep;mt.defer=Bs.defer;mt.delay=Bs.delay;mt.difference=Mn.difference;mt.differenceBy=Mn.differenceBy;mt.differenceWith=Mn.differenceWith;mt.drop=Mn.drop;mt.dropRight=Mn.dropRight;mt.dropRightWhile=Mn.dropRightWhile;mt.dropWhile=Mn.dropWhile;mt.fill=Mn.fill;mt.filter=po.filter;mt.flatMap=po.flatMap;mt.flatMapDeep=po.flatMapDeep;mt.flatMapDepth=po.flatMapDepth;mt.flatten=Mn.flatten;mt.flattenDeep=Mn.flattenDeep;mt.flattenDepth=Mn.flattenDepth;mt.flip=Bs.flip;mt.flow=Ya.flow;mt.flowRight=Ya.flowRight;mt.fromPairs=Mn.fromPairs;mt.functions=wi.functions;mt.functionsIn=wi.functionsIn;mt.groupBy=po.groupBy;mt.initial=Mn.initial;mt.intersection=Mn.intersection;mt.intersectionBy=Mn.intersectionBy;mt.intersectionWith=Mn.intersectionWith;mt.invert=wi.invert;mt.invertBy=wi.invertBy;mt.invokeMap=po.invokeMap;mt.iteratee=Ya.iteratee;mt.keyBy=po.keyBy;mt.keys=Es;mt.keysIn=wi.keysIn;mt.map=po.map;mt.mapKeys=wi.mapKeys;mt.mapValues=wi.mapValues;mt.matches=Ya.matches;mt.matchesProperty=Ya.matchesProperty;mt.memoize=Bs.memoize;mt.merge=wi.merge;mt.mergeWith=wi.mergeWith;mt.method=Ya.method;mt.methodOf=Ya.methodOf;mt.mixin=_8;mt.negate=L2;mt.nthArg=Ya.nthArg;mt.omit=wi.omit;mt.omitBy=wi.omitBy;mt.once=Bs.once;mt.orderBy=po.orderBy;mt.over=Ya.over;mt.overArgs=Bs.overArgs;mt.overEvery=Ya.overEvery;mt.overSome=Ya.overSome;mt.partial=Bs.partial;mt.partialRight=Bs.partialRight;mt.partition=po.partition;mt.pick=wi.pick;mt.pickBy=wi.pickBy;mt.property=Ya.property;mt.propertyOf=Ya.propertyOf;mt.pull=Mn.pull;mt.pullAll=Mn.pullAll;mt.pullAllBy=Mn.pullAllBy;mt.pullAllWith=Mn.pullAllWith;mt.pullAt=Mn.pullAt;mt.range=Ya.range;mt.rangeRight=Ya.rangeRight;mt.rearg=Bs.rearg;mt.reject=po.reject;mt.remove=Mn.remove;mt.rest=Bs.rest;mt.reverse=Mn.reverse;mt.sampleSize=po.sampleSize;mt.set=wi.set;mt.setWith=wi.setWith;mt.shuffle=po.shuffle;mt.slice=Mn.slice;mt.sortBy=po.sortBy;mt.sortedUniq=Mn.sortedUniq;mt.sortedUniqBy=Mn.sortedUniqBy;mt.split=Va.split;mt.spread=Bs.spread;mt.tail=Mn.tail;mt.take=Mn.take;mt.takeRight=Mn.takeRight;mt.takeRightWhile=Mn.takeRightWhile;mt.takeWhile=Mn.takeWhile;mt.tap=gv.tap;mt.throttle=Bs.throttle;mt.thru=P2;mt.toArray=Kn.toArray;mt.toPairs=wi.toPairs;mt.toPairsIn=wi.toPairsIn;mt.toPath=Ya.toPath;mt.toPlainObject=Kn.toPlainObject;mt.transform=wi.transform;mt.unary=Bs.unary;mt.union=Mn.union;mt.unionBy=Mn.unionBy;mt.unionWith=Mn.unionWith;mt.uniq=Mn.uniq;mt.uniqBy=Mn.uniqBy;mt.uniqWith=Mn.uniqWith;mt.unset=wi.unset;mt.unzip=Mn.unzip;mt.unzipWith=Mn.unzipWith;mt.update=wi.update;mt.updateWith=wi.updateWith;mt.values=wi.values;mt.valuesIn=wi.valuesIn;mt.without=Mn.without;mt.words=Va.words;mt.wrap=Bs.wrap;mt.xor=Mn.xor;mt.xorBy=Mn.xorBy;mt.xorWith=Mn.xorWith;mt.zip=Mn.zip;mt.zipObject=Mn.zipObject;mt.zipObjectDeep=Mn.zipObjectDeep;mt.zipWith=Mn.zipWith;mt.entries=wi.toPairs;mt.entriesIn=wi.toPairsIn;mt.extend=wi.assignIn;mt.extendWith=wi.assignInWith;_8(mt,mt);mt.add=pc.add;mt.attempt=Ya.attempt;mt.camelCase=Va.camelCase;mt.capitalize=Va.capitalize;mt.ceil=pc.ceil;mt.clamp=y8.clamp;mt.clone=Kn.clone;mt.cloneDeep=Kn.cloneDeep;mt.cloneDeepWith=Kn.cloneDeepWith;mt.cloneWith=Kn.cloneWith;mt.conformsTo=Kn.conformsTo;mt.deburr=Va.deburr;mt.defaultTo=Ya.defaultTo;mt.divide=pc.divide;mt.endsWith=Va.endsWith;mt.eq=Kn.eq;mt.escape=Va.escape;mt.escapeRegExp=Va.escapeRegExp;mt.every=po.every;mt.find=po.find;mt.findIndex=Mn.findIndex;mt.findKey=wi.findKey;mt.findLast=po.findLast;mt.findLastIndex=Mn.findLastIndex;mt.findLastKey=wi.findLastKey;mt.floor=pc.floor;mt.forEach=po.forEach;mt.forEachRight=po.forEachRight;mt.forIn=wi.forIn;mt.forInRight=wi.forInRight;mt.forOwn=wi.forOwn;mt.forOwnRight=wi.forOwnRight;mt.get=wi.get;mt.gt=Kn.gt;mt.gte=Kn.gte;mt.has=wi.has;mt.hasIn=wi.hasIn;mt.head=Mn.head;mt.identity=Wu;mt.includes=po.includes;mt.indexOf=Mn.indexOf;mt.inRange=y8.inRange;mt.invoke=wi.invoke;mt.isArguments=Kn.isArguments;mt.isArray=Xn;mt.isArrayBuffer=Kn.isArrayBuffer;mt.isArrayLike=Kn.isArrayLike;mt.isArrayLikeObject=Kn.isArrayLikeObject;mt.isBoolean=Kn.isBoolean;mt.isBuffer=Kn.isBuffer;mt.isDate=Kn.isDate;mt.isElement=Kn.isElement;mt.isEmpty=Kn.isEmpty;mt.isEqual=Kn.isEqual;mt.isEqualWith=Kn.isEqualWith;mt.isError=Kn.isError;mt.isFinite=Kn.isFinite;mt.isFunction=Kn.isFunction;mt.isInteger=Kn.isInteger;mt.isLength=Kn.isLength;mt.isMap=Kn.isMap;mt.isMatch=Kn.isMatch;mt.isMatchWith=Kn.isMatchWith;mt.isNaN=Kn.isNaN;mt.isNative=Kn.isNative;mt.isNil=Kn.isNil;mt.isNull=Kn.isNull;mt.isNumber=Kn.isNumber;mt.isObject=ro;mt.isObjectLike=Kn.isObjectLike;mt.isPlainObject=Kn.isPlainObject;mt.isRegExp=Kn.isRegExp;mt.isSafeInteger=Kn.isSafeInteger;mt.isSet=Kn.isSet;mt.isString=Kn.isString;mt.isSymbol=Kn.isSymbol;mt.isTypedArray=Kn.isTypedArray;mt.isUndefined=Kn.isUndefined;mt.isWeakMap=Kn.isWeakMap;mt.isWeakSet=Kn.isWeakSet;mt.join=Mn.join;mt.kebabCase=Va.kebabCase;mt.last=no;mt.lastIndexOf=Mn.lastIndexOf;mt.lowerCase=Va.lowerCase;mt.lowerFirst=Va.lowerFirst;mt.lt=Kn.lt;mt.lte=Kn.lte;mt.max=pc.max;mt.maxBy=pc.maxBy;mt.mean=pc.mean;mt.meanBy=pc.meanBy;mt.min=pc.min;mt.minBy=pc.minBy;mt.stubArray=Ya.stubArray;mt.stubFalse=Ya.stubFalse;mt.stubObject=Ya.stubObject;mt.stubString=Ya.stubString;mt.stubTrue=Ya.stubTrue;mt.multiply=pc.multiply;mt.nth=Mn.nth;mt.noop=Ya.noop;mt.now=Q2e.now;mt.pad=Va.pad;mt.padEnd=Va.padEnd;mt.padStart=Va.padStart;mt.parseInt=Va.parseInt;mt.random=y8.random;mt.reduce=po.reduce;mt.reduceRight=po.reduceRight;mt.repeat=Va.repeat;mt.replace=Va.replace;mt.result=wi.result;mt.round=pc.round;mt.sample=po.sample;mt.size=po.size;mt.snakeCase=Va.snakeCase;mt.some=po.some;mt.sortedIndex=Mn.sortedIndex;mt.sortedIndexBy=Mn.sortedIndexBy;mt.sortedIndexOf=Mn.sortedIndexOf;mt.sortedLastIndex=Mn.sortedLastIndex;mt.sortedLastIndexBy=Mn.sortedLastIndexBy;mt.sortedLastIndexOf=Mn.sortedLastIndexOf;mt.startCase=Va.startCase;mt.startsWith=Va.startsWith;mt.subtract=pc.subtract;mt.sum=pc.sum;mt.sumBy=pc.sumBy;mt.template=Va.template;mt.times=Ya.times;mt.toFinite=Kn.toFinite;mt.toInteger=$i;mt.toLength=Kn.toLength;mt.toLower=Va.toLower;mt.toNumber=Kn.toNumber;mt.toSafeInteger=Kn.toSafeInteger;mt.toString=Kn.toString;mt.toUpper=Va.toUpper;mt.trim=Va.trim;mt.trimEnd=Va.trimEnd;mt.trimStart=Va.trimStart;mt.truncate=Va.truncate;mt.unescape=Va.unescape;mt.uniqueId=Ya.uniqueId;mt.upperCase=Va.upperCase;mt.upperFirst=Va.upperFirst;mt.each=po.forEach;mt.eachRight=po.forEachRight;mt.first=Mn.head;_8(mt,function(){var e={};return pv(mt,function(t,r){hht.call(mt.prototype,r)||(e[r]=t)}),e}(),{chain:!1});mt.VERSION=lTe;(mt.templateSettings=Va.templateSettings).imports._=mt;ld(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){mt[e].placeholder=mt});ld(["drop","take"],function(e,t){ha.prototype[e]=function(r){r=r===void 0?1:pTe($i(r),0);var n=this.__filtered__&&!t?new ha(this):this.clone();return n.__filtered__?n.__takeCount__=qY(r,n.__takeCount__):n.__views__.push({size:qY(r,cht),type:e+(n.__dir__<0?"Right":"")}),n},ha.prototype[e+"Right"]=function(r){return this.reverse()[e](r).reverse()}});ld(["filter","map","takeWhile"],function(e,t){var r=t+1,n=r==cTe||r==hTe;ha.prototype[e]=function(i){var a=this.clone();return a.__iteratees__.push({iteratee:Ri(i),type:r}),a.__filtered__=a.__filtered__||n,a}});ld(["head","last"],function(e,t){var r="take"+(t?"Right":"");ha.prototype[e]=function(){return this[r](1).value()[0]}});ld(["initial","tail"],function(e,t){var r="drop"+(t?"":"Right");ha.prototype[e]=function(){return this.__filtered__?new ha(this):this[r](1)}});ha.prototype.compact=function(){return this.filter(Wu)};ha.prototype.find=function(e){return this.filter(e).head()};ha.prototype.findLast=function(e){return this.reverse().find(e)};ha.prototype.invokeMap=Ji(function(e,t){return typeof e=="function"?new ha(this):this.map(function(r){return I2(r,e,t)})});ha.prototype.reject=function(e){return this.filter(L2(Ri(e)))};ha.prototype.slice=function(e,t){e=$i(e);var r=this;return r.__filtered__&&(e>0||t<0)?new ha(r):(e<0?r=r.takeRight(-e):e&&(r=r.drop(e)),t!==void 0&&(t=$i(t),r=t<0?r.dropRight(-t):r.take(t-e)),r)};ha.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()};ha.prototype.toArray=function(){return this.take(cht)};pv(ha.prototype,function(e,t){var r=/^(?:filter|find|map|reject)|While$/.test(t),n=/^(?:head|last)$/.test(t),i=mt[n?"take"+(t=="last"?"Right":""):t],a=n||/^find/.test(t);i&&(mt.prototype[t]=function(){var o=this.__wrapped__,s=n?[1]:arguments,l=o instanceof ha,u=s[0],c=l||Xn(o),f=function(S){var M=i.apply(mt,A0([S],s));return n&&d?M[0]:M};c&&r&&typeof u=="function"&&u.length!=1&&(l=c=!1);var d=this.__chain__,v=!!this.__actions__.length,g=a&&!d,x=l&&!v;if(!a&&c){o=x?o:new ha(this);var w=e.apply(o,s);return w.__actions__.push({func:P2,args:[f],thisArg:void 0}),new Jf(w,d)}return g&&x?e.apply(this,s):(w=this.thru(f),g?n?w.value()[0]:w.value():w)})});ld(["pop","push","shift","sort","splice","unshift"],function(e){var t=fTe[e],r=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",n=/^(?:pop|shift)$/.test(e);mt.prototype[e]=function(){var i=arguments;if(n&&!this.__chain__){var a=this.value();return t.apply(Xn(a)?a:[],i)}return this[r](function(o){return t.apply(Xn(o)?o:[],i)})}});pv(ha.prototype,function(e,t){var r=mt[t];if(r){var n=r.name+"";hht.call(Fx,n)||(Fx[n]=[]),Fx[n].push({name:t,func:r})}});Fx[tL(void 0,uTe).name]=[{name:"wrapper",func:void 0}];ha.prototype.clone=J2e;ha.prototype.reverse=tTe;ha.prototype.value=sTe;mt.prototype.at=gv.at;mt.prototype.chain=gv.wrapperChain;mt.prototype.commit=gv.commit;mt.prototype.next=gv.next;mt.prototype.plant=gv.plant;mt.prototype.reverse=gv.reverse;mt.prototype.toJSON=mt.prototype.valueOf=mt.prototype.value=gv.value;mt.prototype.first=mt.prototype.head;ZY&&(mt.prototype[ZY]=gv.toIterator);function pI(e){"@babel/helpers - typeof";return pI=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pI(e)}var vTe=/^\s+/,gTe=/\s+$/;function Nn(e,t){if(e=e||"",t=t||{},e instanceof Nn)return e;if(!(this instanceof Nn))return new Nn(e,t);var r=mTe(e);this._originalInput=e,this._r=r.r,this._g=r.g,this._b=r.b,this._a=r.a,this._roundA=Math.round(100*this._a)/100,this._format=t.format||r.format,this._gradientType=t.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=r.ok}Nn.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var t=this.toRgb();return(t.r*299+t.g*587+t.b*114)/1e3},getLuminance:function(){var t=this.toRgb(),r,n,i,a,o,s;return r=t.r/255,n=t.g/255,i=t.b/255,r<=.03928?a=r/12.92:a=Math.pow((r+.055)/1.055,2.4),n<=.03928?o=n/12.92:o=Math.pow((n+.055)/1.055,2.4),i<=.03928?s=i/12.92:s=Math.pow((i+.055)/1.055,2.4),.2126*a+.7152*o+.0722*s},setAlpha:function(t){return this._a=fht(t),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var t=QY(this._r,this._g,this._b);return{h:t.h*360,s:t.s,v:t.v,a:this._a}},toHsvString:function(){var t=QY(this._r,this._g,this._b),r=Math.round(t.h*360),n=Math.round(t.s*100),i=Math.round(t.v*100);return this._a==1?"hsv("+r+", "+n+"%, "+i+"%)":"hsva("+r+", "+n+"%, "+i+"%, "+this._roundA+")"},toHsl:function(){var t=KY(this._r,this._g,this._b);return{h:t.h*360,s:t.s,l:t.l,a:this._a}},toHslString:function(){var t=KY(this._r,this._g,this._b),r=Math.round(t.h*360),n=Math.round(t.s*100),i=Math.round(t.l*100);return this._a==1?"hsl("+r+", "+n+"%, "+i+"%)":"hsla("+r+", "+n+"%, "+i+"%, "+this._roundA+")"},toHex:function(t){return JY(this._r,this._g,this._b,t)},toHexString:function(t){return"#"+this.toHex(t)},toHex8:function(t){return bTe(this._r,this._g,this._b,this._a,t)},toHex8String:function(t){return"#"+this.toHex8(t)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(ts(this._r,255)*100)+"%",g:Math.round(ts(this._g,255)*100)+"%",b:Math.round(ts(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(ts(this._r,255)*100)+"%, "+Math.round(ts(this._g,255)*100)+"%, "+Math.round(ts(this._b,255)*100)+"%)":"rgba("+Math.round(ts(this._r,255)*100)+"%, "+Math.round(ts(this._g,255)*100)+"%, "+Math.round(ts(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:PTe[JY(this._r,this._g,this._b,!0)]||!1},toFilter:function(t){var r="#"+tZ(this._r,this._g,this._b,this._a),n=r,i=this._gradientType?"GradientType = 1, ":"";if(t){var a=Nn(t);n="#"+tZ(a._r,a._g,a._b,a._a)}return"progid:DXImageTransform.Microsoft.gradient("+i+"startColorstr="+r+",endColorstr="+n+")"},toString:function(t){var r=!!t;t=t||this._format;var n=!1,i=this._a<1&&this._a>=0,a=!r&&i&&(t==="hex"||t==="hex6"||t==="hex3"||t==="hex4"||t==="hex8"||t==="name");return a?t==="name"&&this._a===0?this.toName():this.toRgbString():(t==="rgb"&&(n=this.toRgbString()),t==="prgb"&&(n=this.toPercentageRgbString()),(t==="hex"||t==="hex6")&&(n=this.toHexString()),t==="hex3"&&(n=this.toHexString(!0)),t==="hex4"&&(n=this.toHex8String(!0)),t==="hex8"&&(n=this.toHex8String()),t==="name"&&(n=this.toName()),t==="hsl"&&(n=this.toHslString()),t==="hsv"&&(n=this.toHsvString()),n||this.toHexString())},clone:function(){return Nn(this.toString())},_applyModification:function(t,r){var n=t.apply(null,[this].concat([].slice.call(r)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(STe,arguments)},brighten:function(){return this._applyModification(TTe,arguments)},darken:function(){return this._applyModification(ATe,arguments)},desaturate:function(){return this._applyModification(ETe,arguments)},saturate:function(){return this._applyModification(wTe,arguments)},greyscale:function(){return this._applyModification(CTe,arguments)},spin:function(){return this._applyModification(MTe,arguments)},_applyCombination:function(t,r){return t.apply(null,[this].concat([].slice.call(r)))},analogous:function(){return this._applyCombination(LTe,arguments)},complement:function(){return this._applyCombination(RTe,arguments)},monochromatic:function(){return this._applyCombination(OTe,arguments)},splitcomplement:function(){return this._applyCombination(ITe,arguments)},triad:function(){return this._applyCombination(eZ,[3])},tetrad:function(){return this._applyCombination(eZ,[4])}};Nn.fromRatio=function(e,t){if(pI(e)=="object"){var r={};for(var n in e)e.hasOwnProperty(n)&&(n==="a"?r[n]=e[n]:r[n]=Xw(e[n]));e=r}return Nn(e,t)};function mTe(e){var t={r:0,g:0,b:0},r=1,n=null,i=null,a=null,o=!1,s=!1;return typeof e=="string"&&(e=NTe(e)),pI(e)=="object"&&(Kv(e.r)&&Kv(e.g)&&Kv(e.b)?(t=yTe(e.r,e.g,e.b),o=!0,s=String(e.r).substr(-1)==="%"?"prgb":"rgb"):Kv(e.h)&&Kv(e.s)&&Kv(e.v)?(n=Xw(e.s),i=Xw(e.v),t=xTe(e.h,n,i),o=!0,s="hsv"):Kv(e.h)&&Kv(e.s)&&Kv(e.l)&&(n=Xw(e.s),a=Xw(e.l),t=_Te(e.h,n,a),o=!0,s="hsl"),e.hasOwnProperty("a")&&(r=e.a)),r=fht(r),{ok:o,format:e.format||s,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:r}}function yTe(e,t,r){return{r:ts(e,255)*255,g:ts(t,255)*255,b:ts(r,255)*255}}function KY(e,t,r){e=ts(e,255),t=ts(t,255),r=ts(r,255);var n=Math.max(e,t,r),i=Math.min(e,t,r),a,o,s=(n+i)/2;if(n==i)a=o=0;else{var l=n-i;switch(o=s>.5?l/(2-n-i):l/(n+i),n){case e:a=(t-r)/l+(t<r?6:0);break;case t:a=(r-e)/l+2;break;case r:a=(e-t)/l+4;break}a/=6}return{h:a,s:o,l:s}}function _Te(e,t,r){var n,i,a;e=ts(e,360),t=ts(t,100),r=ts(r,100);function o(u,c,f){return f<0&&(f+=1),f>1&&(f-=1),f<1/6?u+(c-u)*6*f:f<1/2?c:f<2/3?u+(c-u)*(2/3-f)*6:u}if(t===0)n=i=a=r;else{var s=r<.5?r*(1+t):r+t-r*t,l=2*r-s;n=o(l,s,e+1/3),i=o(l,s,e),a=o(l,s,e-1/3)}return{r:n*255,g:i*255,b:a*255}}function QY(e,t,r){e=ts(e,255),t=ts(t,255),r=ts(r,255);var n=Math.max(e,t,r),i=Math.min(e,t,r),a,o,s=n,l=n-i;if(o=n===0?0:l/n,n==i)a=0;else{switch(n){case e:a=(t-r)/l+(t<r?6:0);break;case t:a=(r-e)/l+2;break;case r:a=(e-t)/l+4;break}a/=6}return{h:a,s:o,v:s}}function xTe(e,t,r){e=ts(e,360)*6,t=ts(t,100),r=ts(r,100);var n=Math.floor(e),i=e-n,a=r*(1-t),o=r*(1-i*t),s=r*(1-(1-i)*t),l=n%6,u=[r,o,a,a,s,r][l],c=[s,r,r,o,a,a][l],f=[a,a,s,r,r,o][l];return{r:u*255,g:c*255,b:f*255}}function JY(e,t,r,n){var i=[zd(Math.round(e).toString(16)),zd(Math.round(t).toString(16)),zd(Math.round(r).toString(16))];return n&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function bTe(e,t,r,n,i){var a=[zd(Math.round(e).toString(16)),zd(Math.round(t).toString(16)),zd(Math.round(r).toString(16)),zd(dht(n))];return i&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)&&a[3].charAt(0)==a[3].charAt(1)?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0)+a[3].charAt(0):a.join("")}function tZ(e,t,r,n){var i=[zd(dht(n)),zd(Math.round(e).toString(16)),zd(Math.round(t).toString(16)),zd(Math.round(r).toString(16))];return i.join("")}Nn.equals=function(e,t){return!e||!t?!1:Nn(e).toRgbString()==Nn(t).toRgbString()};Nn.random=function(){return Nn.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function ETe(e,t){t=t===0?0:t||10;var r=Nn(e).toHsl();return r.s-=t/100,r.s=xL(r.s),Nn(r)}function wTe(e,t){t=t===0?0:t||10;var r=Nn(e).toHsl();return r.s+=t/100,r.s=xL(r.s),Nn(r)}function CTe(e){return Nn(e).desaturate(100)}function STe(e,t){t=t===0?0:t||10;var r=Nn(e).toHsl();return r.l+=t/100,r.l=xL(r.l),Nn(r)}function TTe(e,t){t=t===0?0:t||10;var r=Nn(e).toRgb();return r.r=Math.max(0,Math.min(255,r.r-Math.round(255*-(t/100)))),r.g=Math.max(0,Math.min(255,r.g-Math.round(255*-(t/100)))),r.b=Math.max(0,Math.min(255,r.b-Math.round(255*-(t/100)))),Nn(r)}function ATe(e,t){t=t===0?0:t||10;var r=Nn(e).toHsl();return r.l-=t/100,r.l=xL(r.l),Nn(r)}function MTe(e,t){var r=Nn(e).toHsl(),n=(r.h+t)%360;return r.h=n<0?360+n:n,Nn(r)}function RTe(e){var t=Nn(e).toHsl();return t.h=(t.h+180)%360,Nn(t)}function eZ(e,t){if(isNaN(t)||t<=0)throw new Error("Argument to polyad must be a positive number");for(var r=Nn(e).toHsl(),n=[Nn(e)],i=360/t,a=1;a<t;a++)n.push(Nn({h:(r.h+a*i)%360,s:r.s,l:r.l}));return n}function ITe(e){var t=Nn(e).toHsl(),r=t.h;return[Nn(e),Nn({h:(r+72)%360,s:t.s,l:t.l}),Nn({h:(r+216)%360,s:t.s,l:t.l})]}function LTe(e,t,r){t=t||6,r=r||30;var n=Nn(e).toHsl(),i=360/r,a=[Nn(e)];for(n.h=(n.h-(i*t>>1)+720)%360;--t;)n.h=(n.h+i)%360,a.push(Nn(n));return a}function OTe(e,t){t=t||6;for(var r=Nn(e).toHsv(),n=r.h,i=r.s,a=r.v,o=[],s=1/t;t--;)o.push(Nn({h:n,s:i,v:a})),a=(a+s)%1;return o}Nn.mix=function(e,t,r){r=r===0?0:r||50;var n=Nn(e).toRgb(),i=Nn(t).toRgb(),a=r/100,o={r:(i.r-n.r)*a+n.r,g:(i.g-n.g)*a+n.g,b:(i.b-n.b)*a+n.b,a:(i.a-n.a)*a+n.a};return Nn(o)};Nn.readability=function(e,t){var r=Nn(e),n=Nn(t);return(Math.max(r.getLuminance(),n.getLuminance())+.05)/(Math.min(r.getLuminance(),n.getLuminance())+.05)};Nn.isReadable=function(e,t,r){var n=Nn.readability(e,t),i,a;switch(a=!1,i=kTe(r),i.level+i.size){case"AAsmall":case"AAAlarge":a=n>=4.5;break;case"AAlarge":a=n>=3;break;case"AAAsmall":a=n>=7;break}return a};Nn.mostReadable=function(e,t,r){var n=null,i=0,a,o,s,l;r=r||{},o=r.includeFallbackColors,s=r.level,l=r.size;for(var u=0;u<t.length;u++)a=Nn.readability(e,t[u]),a>i&&(i=a,n=Nn(t[u]));return Nn.isReadable(e,n,{level:s,size:l})||!o?n:(r.includeFallbackColors=!1,Nn.mostReadable(e,["#fff","#000"],r))};var h5=Nn.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},PTe=Nn.hexNames=DTe(h5);function DTe(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[e[r]]=r);return t}function fht(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function ts(e,t){FTe(e)&&(e="100%");var r=BTe(e);return e=Math.min(t,Math.max(0,parseFloat(e))),r&&(e=parseInt(e*t,10)/100),Math.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function xL(e){return Math.min(1,Math.max(0,e))}function Dh(e){return parseInt(e,16)}function FTe(e){return typeof e=="string"&&e.indexOf(".")!=-1&&parseFloat(e)===1}function BTe(e){return typeof e=="string"&&e.indexOf("%")!=-1}function zd(e){return e.length==1?"0"+e:""+e}function Xw(e){return e<=1&&(e=e*100+"%"),e}function dht(e){return Math.round(parseFloat(e)*255).toString(16)}function rZ(e){return Dh(e)/255}var Rd=function(){var e="[-\\+]?\\d+%?",t="[-\\+]?\\d*\\.\\d+%?",r="(?:"+t+")|(?:"+e+")",n="[\\s|\\(]+("+r+")[,|\\s]+("+r+")[,|\\s]+("+r+")\\s*\\)?",i="[\\s|\\(]+("+r+")[,|\\s]+("+r+")[,|\\s]+("+r+")[,|\\s]+("+r+")\\s*\\)?";return{CSS_UNIT:new RegExp(r),rgb:new RegExp("rgb"+n),rgba:new RegExp("rgba"+i),hsl:new RegExp("hsl"+n),hsla:new RegExp("hsla"+i),hsv:new RegExp("hsv"+n),hsva:new RegExp("hsva"+i),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function Kv(e){return!!Rd.CSS_UNIT.exec(e)}function NTe(e){e=e.replace(vTe,"").replace(gTe,"").toLowerCase();var t=!1;if(h5[e])e=h5[e],t=!0;else if(e=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var r;return(r=Rd.rgb.exec(e))?{r:r[1],g:r[2],b:r[3]}:(r=Rd.rgba.exec(e))?{r:r[1],g:r[2],b:r[3],a:r[4]}:(r=Rd.hsl.exec(e))?{h:r[1],s:r[2],l:r[3]}:(r=Rd.hsla.exec(e))?{h:r[1],s:r[2],l:r[3],a:r[4]}:(r=Rd.hsv.exec(e))?{h:r[1],s:r[2],v:r[3]}:(r=Rd.hsva.exec(e))?{h:r[1],s:r[2],v:r[3],a:r[4]}:(r=Rd.hex8.exec(e))?{r:Dh(r[1]),g:Dh(r[2]),b:Dh(r[3]),a:rZ(r[4]),format:t?"name":"hex8"}:(r=Rd.hex6.exec(e))?{r:Dh(r[1]),g:Dh(r[2]),b:Dh(r[3]),format:t?"name":"hex"}:(r=Rd.hex4.exec(e))?{r:Dh(r[1]+""+r[1]),g:Dh(r[2]+""+r[2]),b:Dh(r[3]+""+r[3]),a:rZ(r[4]+""+r[4]),format:t?"name":"hex8"}:(r=Rd.hex3.exec(e))?{r:Dh(r[1]+""+r[1]),g:Dh(r[2]+""+r[2]),b:Dh(r[3]+""+r[3]),format:t?"name":"hex"}:!1}function kTe(e){var t,r;return e=e||{level:"AA",size:"small"},t=(e.level||"AA").toUpperCase(),r=(e.size||"small").toLowerCase(),t!=="AA"&&t!=="AAA"&&(t="AA"),r!=="small"&&r!=="large"&&(r="small"),{level:t,size:r}}var zTe="#FFFFFF",UTe="#000000",$Te=[95,85,75,30,15,0,15,30,45,60,80],HTe=15,pht=function(e){return Nn(e).getLuminance()<=.5},VTe=function(e,t){return Nn.isReadable(e,t,{level:"AA",size:"small"})},GTe=[{fontColorIndex:0,bgColorIndex:3},{fontColorIndex:13,bgColorIndex:8},{fontColorIndex:14,bgColorIndex:1}],WTe=function(e){for(var t=[],r=0;r<11;r++){var n=$Te[r];t.push(yS(n===0?e:Nn.mix(e,r<5?zTe:UTe,n).toHexString()))}return t},x8=function(e){e===void 0&&(e={});var t=Array.from(Array(HTe)).fill(GB),r=e.basicColorRelations,n=r===void 0?[]:r,i=e.brandColor,a=WTe(i);return n.forEach(function(o){t[o.basicColorIndex]=a[o.standardColorIndex]}),GTe.forEach(function(o){var s=o.fontColorIndex,l=o.bgColorIndex;t[s]=pht(t[l])?GB:Llt}),qt(qt({},e),{basicColors:t})},XTe={brandColor:"#3471F9",semanticColors:{red:"#FF4D4F",green:"#29A294",yellow:"#FAAD14"},others:{highlight:"#87B5FF",results:"#F0F7FF"},basicColorRelations:[{basicColorIndex:1,standardColorIndex:0},{basicColorIndex:2,standardColorIndex:1},{basicColorIndex:3,standardColorIndex:5},{basicColorIndex:4,standardColorIndex:6},{basicColorIndex:5,standardColorIndex:6},{basicColorIndex:6,standardColorIndex:6},{basicColorIndex:7,standardColorIndex:5},{basicColorIndex:9,standardColorIndex:1},{basicColorIndex:10,standardColorIndex:4},{basicColorIndex:11,standardColorIndex:4},{basicColorIndex:12,standardColorIndex:5}]},jTe=x8(XTe),YTe={brandColor:"#326EF4",semanticColors:{red:"#FF4D4F",green:"#29A294",yellow:"#FAAD14"},others:{highlight:"#87B5FF",results:"#F0F7FF"},basicColorRelations:[{basicColorIndex:1,standardColorIndex:0},{basicColorIndex:2,standardColorIndex:1},{basicColorIndex:3,standardColorIndex:1},{basicColorIndex:4,standardColorIndex:2},{basicColorIndex:5,standardColorIndex:7},{basicColorIndex:6,standardColorIndex:5},{basicColorIndex:7,standardColorIndex:5},{basicColorIndex:9,standardColorIndex:1},{basicColorIndex:10,standardColorIndex:2},{basicColorIndex:11,standardColorIndex:5},{basicColorIndex:12,standardColorIndex:5}]},ZTe=x8(YTe),qTe={brandColor:"#9DA7B6",semanticColors:{red:"#FF4D4F",green:"#29A294",yellow:"#FAAD14"},others:{highlight:"#87B5FF",results:"#F0F7FF"},basicColorRelations:[{basicColorIndex:1,standardColorIndex:0},{basicColorIndex:2,standardColorIndex:1},{basicColorIndex:3,standardColorIndex:1},{basicColorIndex:4,standardColorIndex:2},{basicColorIndex:5,standardColorIndex:7},{basicColorIndex:6,standardColorIndex:8},{basicColorIndex:7,standardColorIndex:5},{basicColorIndex:9,standardColorIndex:1},{basicColorIndex:10,standardColorIndex:2},{basicColorIndex:11,standardColorIndex:3},{basicColorIndex:12,standardColorIndex:3}]},KTe=x8(qTe),QTe={default:ZTe,colorful:jTe,gray:KTe},Md="Roboto, PingFangSC, BlinkMacSystemFont, Microsoft YaHei, Arial, sans-serif",JTe=12,tAe={小计:"Total",总计:"Total",总和:"(SUM)",项:"items",已选择:"selected",序号:"Index",度量:"Measure",数值:"Measure",共计:"Total",条:"",隐藏:"Hide",趋势:"Trend",组内升序:"Group ASC",组内降序:"Group DESC",升序:"ASC",降序:"DESC",不排序:"No order","，":", "},eAe={小计:"Промежуточный итог",总计:"Общий итог",总和:"(СУММА)",项:"элемент(-а/-ов)",已选择:"выбрано",序号:"Индекс",度量:"Мера",数值:"Численная величина",共计:"Общее количество",条:"",隐藏:"Скрыть",趋势:"Курс",组内升序:"Группировать по возрастанию",组内降序:"Группировать по убыванию",升序:"По возрастанию",降序:"По убыванию",不排序:"Не отсортировано","，":", "},rAe={小计:"小计",总计:"总计",总和:"（总和）",项:"项",已选择:"已选择",序号:"序号",度量:"度量",数值:"数值",共计:"共计",条:"条",趋势:"趋势",隐藏:"隐藏",组内升序:"组内升序",升序:"升序",降序:"降序",组内降序:"组内降序",不排序:"不排序","，":"，"},nAe="zh_CN",iAe=nAe,aAe={zh_CN:rAe,en_US:tAe,ru_RU:eAe},Tl=function(e,t){return t===void 0&&(t=e),ai(aAe,[iAe,e],t)},oAe="".concat(fde,"-tooltip"),b8="".concat(oAe,"-container"),sAe="".concat(b8,"-show"),lAe="".concat(b8,"-hide"),nZ={x:15,y:10},uAe=function(){return{key:"hiddenColumns",text:Tl("隐藏"),icon:"EyeOutlined"}},cAe=function(){return{key:"trend",text:Tl("趋势"),icon:"Trend"}},hAe=function(){return[{key:"asc",icon:"groupAsc",text:Tl("组内升序")},{key:"desc",icon:"groupDesc",text:Tl("组内降序")},{key:"none",text:Tl("不排序")}]},fAe=function(){return[{key:"asc",icon:"groupAsc",text:Tl("升序")},{key:"desc",icon:"groupDesc",text:Tl("降序")},{key:"none",text:Tl("不排序")}]},iZ;(function(e){e[e.ALL=0]="ALL",e[e.COL=1]="COL",e[e.ROW=2]="ROW"})(iZ||(iZ={}));var f5=1,$f;(function(e){e.All="all",e.DetailOnly="detailOnly"})($f||($f={}));function Ul(e){return e==="mobile"?!0:/(iPhone|iPad|SymbianOS|Windows Phone|iPod|iOS|Android)/i.test(navigator.userAgent)}function dAe(){return/iPhone/gi.test(navigator.userAgent)&&window.screen.height===812&&window.screen.width===375}function vht(){return/windows/i.test(navigator.userAgent)}var pAe=function(e){var t=e||"default";return QTe[t.toLowerCase()]},vAe=function(e){var t,r,n,i,a,o=(e==null?void 0:e.palette)||pAe(e==null?void 0:e.name),s=o.basicColors,l=o.semanticColors,u=o.others,c=(t=e==null?void 0:e.spreadsheet)===null||t===void 0?void 0:t.isTableMode(),f=vht()?"bold":700,d=function(){var v,g;return{bolderText:{fontFamily:Md,fontSize:12,fontWeight:f,fill:s[13],opacity:1,textAlign:"right",textBaseline:"middle",linkTextFill:s[6]},text:{fontFamily:Md,fontSize:12,fontWeight:"normal",fill:s[13],opacity:1,textAlign:"right",textBaseline:"middle",linkTextFill:s[6]},cell:{crossBackgroundColor:s[1],backgroundColor:s[8],backgroundColorOpacity:1,horizontalBorderColor:s[9],horizontalBorderColorOpacity:1,verticalBorderColor:s[9],verticalBorderColorOpacity:1,horizontalBorderWidth:1,verticalBorderWidth:1,borderDash:[],padding:{top:8,right:8,bottom:8,left:8},interactionState:{hover:{backgroundColor:s[2],backgroundOpacity:.6},hoverFocus:{backgroundColor:s[2],backgroundOpacity:.6,borderColor:s[14],borderWidth:1,borderOpacity:1},selected:{backgroundColor:s[2],backgroundOpacity:.6},unselected:{backgroundOpacity:.3,textOpacity:.3,opacity:.3},searchResult:{backgroundColor:(v=u==null?void 0:u.results)!==null&&v!==void 0?v:s[2],backgroundOpacity:1},highlight:{backgroundColor:(g=u==null?void 0:u.highlight)!==null&&g!==void 0?g:s[6],backgroundOpacity:1},prepareSelect:{borderColor:s[14],borderOpacity:1,borderWidth:1}}},miniChart:{line:{point:{size:2.2,fill:s[6],opacity:1},linkLine:{size:1.5,fill:s[6],opacity:.6}},bar:{intervalPadding:4,fill:s[6],opacity:1},bullet:{progressBar:{widthPercent:.6,height:10,innerHeight:6},comparativeMeasure:{width:1,height:12,fill:s[13],opacity:.25},rangeColors:{good:l==null?void 0:l.green,satisfactory:l.yellow,bad:l.red},backgroundColor:"#E9E9E9"},interval:{height:JTe,fill:s[7]}},icon:{fill:s[13],downIconColor:l.red,upIconColor:l.green,size:10,margin:{right:4,left:4}}}};return{cornerCell:{bolderText:{fontFamily:Md,fontSize:12,fontWeight:f,fill:s[0],opacity:1,textAlign:c?"center":"left",textBaseline:"middle"},text:{fontFamily:Md,fontSize:12,fontWeight:f,fill:s[0],opacity:1,textAlign:"right",textBaseline:"middle"},cell:{backgroundColor:s[3],backgroundColorOpacity:1,horizontalBorderColor:s[10],horizontalBorderColorOpacity:1,verticalBorderColor:s[10],verticalBorderColorOpacity:1,horizontalBorderWidth:1,verticalBorderWidth:1,borderDash:[],padding:{top:0,right:8,bottom:0,left:8}},icon:{fill:s[0],size:10,margin:{right:4,left:4}}},rowCell:{seriesText:{fontFamily:Md,fontSize:12,fontWeight:"normal",fill:s[14],linkTextFill:s[6],opacity:1,textBaseline:c?"middle":"top",textAlign:"center"},measureText:{fontFamily:Md,fontSize:12,fontWeight:"normal",fill:s[14],linkTextFill:s[6],opacity:1,textAlign:c?"center":"left",textBaseline:"top"},bolderText:{fontFamily:Md,fontSize:12,fontWeight:f,fill:s[14],linkTextFill:s[6],opacity:1,textAlign:c?"center":"left",textBaseline:"top"},text:{fontFamily:Md,fontSize:12,fontWeight:"normal",fill:s[14],linkTextFill:s[6],opacity:1,textBaseline:"top",textAlign:c?"center":"left"},cell:{backgroundColor:s[1],backgroundColorOpacity:1,horizontalBorderColor:s[9],horizontalBorderColorOpacity:1,verticalBorderColor:s[9],verticalBorderColorOpacity:1,horizontalBorderWidth:1,verticalBorderWidth:1,borderDash:[],padding:{top:0,right:8,bottom:0,left:8},interactionState:{hover:{backgroundColor:s[2],backgroundOpacity:.6},selected:{backgroundColor:s[2],backgroundOpacity:.6},unselected:{backgroundOpacity:.3,textOpacity:.3,opacity:.3},prepareSelect:{borderColor:s[14],borderOpacity:1,borderWidth:1},searchResult:{backgroundColor:(r=u==null?void 0:u.results)!==null&&r!==void 0?r:s[2],backgroundOpacity:1},highlight:{backgroundColor:(n=u==null?void 0:u.highlight)!==null&&n!==void 0?n:s[6],backgroundOpacity:1}}},icon:{fill:s[14],size:10,margin:{right:4,left:4}},seriesNumberWidth:80},colCell:{measureText:{fontFamily:Md,fontSize:12,fontWeight:"normal",fill:s[0],opacity:1,textAlign:"right",textBaseline:"middle"},bolderText:{fontFamily:Md,fontSize:12,fontWeight:f,fill:s[0],opacity:1,textAlign:"center",textBaseline:"middle"},text:{fontFamily:Md,fontSize:12,fontWeight:"normal",fill:s[0],opacity:1,textAlign:"center",textBaseline:"middle"},cell:{backgroundColor:s[3],backgroundColorOpacity:1,horizontalBorderColor:s[10],horizontalBorderColorOpacity:1,verticalBorderColor:s[10],verticalBorderColorOpacity:1,horizontalBorderWidth:1,verticalBorderWidth:1,borderDash:[],padding:{top:0,right:8,bottom:0,left:8},interactionState:{hover:{backgroundColor:s[4],backgroundOpacity:.6},selected:{backgroundColor:s[4],backgroundOpacity:.6},unselected:{backgroundOpacity:.3,textOpacity:.3,opacity:.3},prepareSelect:{borderColor:s[14],borderOpacity:1,borderWidth:1},searchResult:{backgroundColor:(i=u==null?void 0:u.results)!==null&&i!==void 0?i:s[2],backgroundOpacity:1},highlight:{backgroundColor:(a=u==null?void 0:u.highlight)!==null&&a!==void 0?a:s[6],backgroundOpacity:1}}},icon:{fill:s[0],size:10,margin:{top:6,right:4,bottom:6,left:4}}},dataCell:d(),mergedCell:d(),resizeArea:{size:3,background:s[7],backgroundOpacity:0,guideLineColor:s[7],guideLineDisableColor:"rgba(0,0,0,0.25)",guideLineDash:[3,3],interactionState:{hover:{backgroundColor:s[7],backgroundOpacity:1}}},scrollBar:{trackColor:"rgba(0,0,0,0.01)",thumbHoverColor:"rgba(0,0,0,0.25)",thumbColor:"rgba(0,0,0,0.15)",thumbHorizontalMinSize:32,thumbVerticalMinSize:32,size:Ul()?3:6,hoverSize:Ul()?4:8,lineCap:"round"},splitLine:{horizontalBorderColor:s[12],horizontalBorderColorOpacity:.2,horizontalBorderWidth:2,verticalBorderColor:s[11],verticalBorderColorOpacity:.25,verticalBorderWidth:2,showShadow:!0,shadowWidth:8,shadowColors:{left:"rgba(0,0,0,0.1)",right:"rgba(0,0,0,0)"},borderDash:[]},prepareSelectMask:{backgroundColor:s[5],backgroundOpacity:.3},background:{color:s[8],opacity:1}}},cu=function(){function e(t){this.x=0,this.y=0,this.width=0,this.height=0,this.colIndex=-1,this.level=0,this.isLeaf=!1,this.children=[],this.padding=0;var r=t.id,n=t.key,i=t.value,a=t.label,o=t.parent,s=t.level,l=t.rowIndex,u=t.isTotals,c=t.isGrandTotals,f=t.isSubTotals,d=t.isCollapsed,v=t.isTotalRoot,g=t.hierarchy,x=t.isPivotMode,w=t.seriesNumberWidth,S=t.field,M=t.spreadsheet,R=t.query,I=t.belongsCell,P=t.inCollapseNode,k=t.isTotalMeasure,z=t.isLeaf,G=t.extra;this.id=r,this.key=n,this.value=i,this.label=a||i,this.parent=o,this.level=s,this.rowIndex=l,this.isTotals=u,this.isCollapsed=d,this.hierarchy=g,this.isPivotMode=x,this.seriesNumberWidth=w,this.field=S,this.spreadsheet=M,this.query=R,this.belongsCell=I,this.inCollapseNode=P,this.isTotalMeasure=k,this.isLeaf=z,this.isGrandTotals=c,this.isSubTotals=f,this.isTotalRoot=v,this.extra=G}return e.getFieldPath=function(t,r){if(t&&!t.isTotals||t&&r){for(var n=t.parent,i=[t.field];n&&n.id!==Rlt;)i.push(n.field),n=n.parent;return i.reverse()}},e.getAllLeaveNodes=function(t){var r=[];if(t.isLeaf)return[t];for(var n=Gr([],ur(t.children),!1),i=n.shift();i;)i.isLeaf?r.push(i):n.unshift.apply(n,Gr([],ur(i.children),!1)),i=n.shift();return r},e.getAllChildrenNodes=function(t){var r=[];if(t.isLeaf)return[t];for(var n=Gr([],ur(t.children||[]),!1),i=n.shift();i;)r.push(i),n.unshift.apply(n,Gr([],ur(i.children),!1)),i=n.shift();return r},e.getAllBranch=function(t){for(var r=[],n=this.getAllLeaveNodes(t),i=n.shift(),a=[];i;){a.unshift(i);for(var o=i.parent;o&&!pu(o,t);){a.unshift(o);o=o.parent}r.push(a),i=n.shift(),a=[]}return r},e.blankNode=function(){return new e({id:"",key:"",value:""})},e.rootNode=function(){return new e({id:"root",key:"",value:""})},e.prototype.toJSON=function(){return a8(this,["config","hierarchy","parent","spreadsheet"])},e.prototype.getHeadLeafChild=function(){for(var t=this;!Dr(t.children);)t=w_(t.children);return t},e.prototype.getTotalHeightForTreeHierarchy=function(){return this.height===0||Dr(this.children)?this.height:this.children.reduce(function(t,r){return t+r.getTotalHeightForTreeHierarchy()},this.height)},e}(),ght=function(){function e(){this.width=0,this.height=0,this.maxLevel=-1,this.sampleNodesForAllLevels=[],this.sampleNodeForLastLevel=null,this.allNodesWithoutRoot=[],this.indexNode=[]}return e.prototype.getLeaves=function(){return this.allNodesWithoutRoot.filter(function(t){return t.isLeaf})},e.prototype.getNodes=function(t){return t!==void 0?this.allNodesWithoutRoot.filter(function(r){return r.level===t}):this.allNodesWithoutRoot},e.prototype.getNodesLessThanLevel=function(t){return this.allNodesWithoutRoot.filter(function(r){return r.level<=t})},e.prototype.pushNode=function(t,r){r===void 0&&(r=-1),r===-1?this.allNodesWithoutRoot.push(t):this.allNodesWithoutRoot.splice(r,0,t)},e.prototype.pushIndexNode=function(t){this.indexNode.push(t)},e.prototype.getIndexNodes=function(){return this.indexNode},e}(),Eb=function(){function e(t){var r=t.label,n=t.isSubTotals,i=t.isGrandTotals,a=t.isTotalRoot;this.label=r,this.isSubTotals=n,this.isGrandTotals=i,this.isTotalRoot=a}return e}(),gAe=function(e){var t,r=e.isFirstField,n=e.currentField,i=e.fieldValues,a=e.spreadsheet,o=e.lastField,s=a.getTotalsConfig(r?n:o),l,u;r?s!=null&&s.showGrandTotals&&(l=s.reverseLayout?"unshift":"push",u=new Eb({label:s.label,isSubTotals:!1,isGrandTotals:!0,isTotalRoot:!0})):s!=null&&s.showSubTotals&&(mt.size(i)>1||mt.get(s,"showSubTotals.always")!==!1)&&n!==Fi&&(l=s.reverseSubLayout?"unshift":"push",u=new Eb({label:s.subLabel,isSubTotals:!0,isGrandTotals:!1,isTotalRoot:!0})),(t=i[l])===null||t===void 0||t.call(i,u)};function d5(e,t){for(var r={},n=e;n&&n.key;)(!n.isTotalRoot||t)&&n.value!==$_&&(r[n.key]=n.value),n=n.parent;return r}var mAe="Transform Data",yAe="Header Layout",_Ae="Data Cell Render",Wp=function(){function e(){var t=this;this.debug=!1,this.debugCallback=function(r,n){if(t.debug){var i=performance.now();n();var a=performance.now();console.log(r,"".concat(a-i," ms"))}else n()},this.logger=function(r){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];t.debug&&console.log.apply(console,Gr([r],ur(n),!1))}}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.setDebug=function(t){this.debug=t},e}(),xAe=`
<svg width="10px" height="10px" viewBox="0 0 10 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" font-family="Roboto, PingFangSC, BlinkMacSystemFont, Microsoft YaHei, Arial, sans-serif" font-size="12" font-weight="bold">
    <text id="↓" fill="#29A294">
        <tspan x="-0.225097656" y="8.5">↓</tspan>
    </text>
</g>
</svg>`,bAe=`<svg width="10px" height="10px" viewBox="0 0 10 10" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" font-family="Roboto, PingFangSC, BlinkMacSystemFont, Microsoft YaHei, Arial, sans-serif" font-size="12" font-weight="bold">
    <text id="↑" fill="#FF4D4F">
        <tspan x="-0.225097656" y="8.5">↑</tspan>
    </text>
</g>
</svg>
`,EAe=`<?xml version="1.0" encoding="UTF-8"?>
<svg width="7px" height="9px" viewBox="0 0 7 9" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 58 (84663) - https://sketch.com -->
    <title>down</title>
    <desc>Created with Sketch.</desc>
    <g id="一期开发" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <polygon id="down" fill="#58AE57" transform="translate(3.500000, 4.500000) scale(1, -1) translate(-3.500000, -4.500000) " points="3.5 0 7 9 0 9"></polygon>
    </g>
</svg>`,wAe=`<?xml version="1.0" encoding="UTF-8"?>
<svg width="7px" height="9px" viewBox="0 0 7 9" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!-- Generator: Sketch 58 (84663) - https://sketch.com -->
    <title>up</title>
    <desc>Created with Sketch.</desc>
    <g id="一期开发" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <polygon id="up" fill="#F46649" points="3.5 0 7 9 0 9"></polygon>
    </g>
</svg> `,CAe=`<svg t="1557124621626" class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
xmlns="http://www.w3.org/2000/svg" p-id="17452"
xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14">
<defs>
  <style type="text/css"></style>
</defs>
<path d="M182.272 167.04a8 8 0 0 0-12.544 0L57.728 309.056A8 8 0 0 0 64 321.984h76.032v530.048c0 4.352 3.584 7.936 7.936 7.936h56.064a8 8 0 0 0 7.936-7.936V321.92H288a8 8 0 0 0 6.272-12.992l-112-141.888z m209.728 626.944h176c4.416 0 8 3.584 8 8v56a8 8 0 0 1-8 8h-176A8 8 0 0 1 384 857.984v-56c0-4.416 3.584-8 8-8z m0-424h368c4.416 0 8 3.648 8 8v56a8 8 0 0 1-8 8h-368A8 8 0 0 1 384 433.984v-56c0-4.352 3.584-8 8-8z m528-139.968h-528A8 8 0 0 1 384 222.016v-56c0-4.416 3.584-8 8-8h528c4.416 0 8 3.584 8 8v56a8 8 0 0 1-8 8z m-256 424h-272A8 8 0 0 1 384 646.016v-56c0-4.416 3.584-8 8-8h272c4.416 0 8 3.584 8 8v56a8 8 0 0 1-8 8z" p-id="17453"></path>
</svg>`,SAe=`<svg t="1557124685600" class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" p-id="17561"
  xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14">
  <defs>
    <style type="text/css"></style>
  </defs>
  <path d="M182.272 856.96a8 8 0 0 1-12.544 0l-112-141.952A8 8 0 0 1 64 702.08h76.032V172.032c0-4.416 3.584-8 7.936-8h56.064c4.352 0 7.936 3.584 7.936 8v529.984H288c6.72 0 10.496 7.808 6.272 12.992l-112 141.888z m209.728-626.944h176A8 8 0 0 0 576 222.016v-56a8 8 0 0 0-8-8h-176A8 8 0 0 0 384 166.016v56c0 4.416 3.584 8 8 8z m0 424h368a8 8 0 0 0 8-8v-56a8 8 0 0 0-8-8h-368A8 8 0 0 0 384 590.016v56c0 4.416 3.584 8 8 8z m528 139.968h-528a8 8 0 0 0-8 8v56c0 4.416 3.584 8 8 8h528a8 8 0 0 0 8-8v-56a8 8 0 0 0-8-8z m-256-424h-272A8 8 0 0 0 384 377.984v56c0 4.416 3.584 8 8 8h272a8 8 0 0 0 8-8v-56a8 8 0 0 0-8-8z" p-id="17562"></path>
</svg>`,TAe=`<svg t="1557124695786" class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" p-id="17670"
  xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14">
  <defs>
    <style type="text/css"></style>
  </defs>
  <path d="M182.272 167.04a8 8 0 0 0-12.544 0L57.728 309.056A8 8 0 0 0 64 321.984h76.032v530.048c0 4.352 3.584 7.936 7.936 7.936h56.064a8 8 0 0 0 7.936-7.936V321.92H288a8 8 0 0 0 6.272-12.992l-112-141.888z m209.728 62.976h304A8 8 0 0 0 704 222.016v-56a8 8 0 0 0-8-8h-304A8 8 0 0 0 384 166.016v56c0 4.416 3.584 8 8 8z m0 424h304a8 8 0 0 0 8-8v-56a8 8 0 0 0-8-8h-304A8 8 0 0 0 384 590.016v56c0 4.416 3.584 8 8 8z m528 139.968h-528a8 8 0 0 0-8 8v56c0 4.416 3.584 8 8 8h528a8 8 0 0 0 8-8v-56a8 8 0 0 0-8-8z m0-424h-528A8 8 0 0 0 384 377.984v56c0 4.416 3.584 8 8 8h528a8 8 0 0 0 8-8v-56a8 8 0 0 0-8-8z" p-id="17671"></path>
</svg>`,AAe=`<svg t="1557124710652" class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" p-id="17779"
  xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14">
  <defs>
    <style type="text/css"></style>
  </defs>
  <path d="M182.272 856.96a8 8 0 0 1-12.544 0l-112-141.952A8 8 0 0 1 64 702.08h76.032V172.032c0-4.416 3.584-8 7.936-8h56.064c4.352 0 7.936 3.584 7.936 8v529.984H288c6.72 0 10.496 7.808 6.272 12.992l-112 141.888z m209.728-626.944h304A8 8 0 0 0 704 222.016v-56a8 8 0 0 0-8-8h-304A8 8 0 0 0 384 166.016v56c0 4.416 3.584 8 8 8z m0 424h304a8 8 0 0 0 8-8v-56a8 8 0 0 0-8-8h-304A8 8 0 0 0 384 590.016v56c0 4.416 3.584 8 8 8z m528 139.968h-528a8 8 0 0 0-8 8v56c0 4.416 3.584 8 8 8h528a8 8 0 0 0 8-8v-56a8 8 0 0 0-8-8z m0-424h-528A8 8 0 0 0 384 377.984v56c0 4.416 3.584 8 8 8h528a8 8 0 0 0 8-8v-56a8 8 0 0 0-8-8z" p-id="17780"></path>
</svg>`,MAe=`<svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="设计输出" stroke="none" stroke-width="1" fill-opacity="0.25" fill-rule="evenodd">
    <g id="设计输出-移动端指标详情页-阅读端" transform="translate(-3275.000000, -724.000000)" fill-rule="nonzero">
        <g id="编组-39" transform="translate(3064.500000, 667.000000)">
            <g id="编组-36" transform="translate(80.500000, 44.000000)">
                <g id="不排序" transform="translate(130.000000, 13.000000)">
                    <path d="M12.0009375,12.40625 C12.0696875,12.40625 12.1259375,12.4625 12.1259375,12.53125 L12.1259375,12.53125 L12.1259375,13.40625 C12.1259375,13.475 12.0696875,13.53125 12.0009375,13.53125 L12.0009375,13.53125 L6.25093747,13.53125 C6.18218747,13.53125 6.12593747,13.475 6.12593747,13.40625 L6.12593747,13.40625 L6.12593747,12.53125 C6.12593747,12.4625 6.18218747,12.40625 6.25093747,12.40625 L6.25093747,12.40625 Z M2.93949997,2.5801875 L2.97437497,2.6109375 L4.72437497,4.828125 C4.78062497,4.89776786 4.74503823,4.99725765 4.66779698,5.02426203 L4.62593747,5.03125 L3.438,5.03089062 L3.43843747,10.9691406 L4.62593747,10.9691406 C4.73062497,10.9691406 4.78999997,11.0910156 4.72437497,11.1722656 L2.97437497,13.3894531 C2.92437497,13.4535156 2.82749997,13.4535156 2.77749997,13.3894531 L1.02749997,11.1722656 C0.961874969,11.0894531 1.02124997,10.9691406 1.12593747,10.9691406 L2.31343747,10.9691406 L2.313,5.03089062 L1.12593747,5.03125 C1.03620533,5.03125 0.979764,4.94285714 1.00679571,4.8654519 L1.02749997,4.828125 L2.77749997,2.6109375 C2.81749997,2.5596875 2.88749997,2.5494375 2.93949997,2.5801875 Z M10.5009375,9.09375 C10.5696875,9.09375 10.6259375,9.15 10.6259375,9.21875 L10.6259375,9.21875 L10.6259375,10.09375 C10.6259375,10.1625 10.5696875,10.21875 10.5009375,10.21875 L10.5009375,10.21875 L6.25093747,10.21875 C6.18218747,10.21875 6.12593747,10.1625 6.12593747,10.09375 L6.12593747,10.09375 L6.12593747,9.21875 C6.12593747,9.15 6.18218747,9.09375 6.25093747,9.09375 L6.25093747,9.09375 Z M14.5009375,5.78125 C14.5696875,5.78125 14.6259375,5.8375 14.6259375,5.90625 L14.6259375,5.90625 L14.6259375,6.78125 C14.6259375,6.85 14.5696875,6.90625 14.5009375,6.90625 L14.5009375,6.90625 L6.25093747,6.90625 C6.18218747,6.90625 6.12593747,6.85 6.12593747,6.78125 L6.12593747,6.78125 L6.12593747,5.90625 C6.12593747,5.8375 6.18218747,5.78125 6.25093747,5.78125 L6.25093747,5.78125 Z M9.00093747,2.46875 C9.06968747,2.46875 9.12593747,2.525 9.12593747,2.59375 L9.12593747,2.59375 L9.12593747,3.46875 C9.12593747,3.5375 9.06968747,3.59375 9.00093747,3.59375 L9.00093747,3.59375 L6.25093747,3.59375 C6.18218747,3.59375 6.12593747,3.5375 6.12593747,3.46875 L6.12593747,3.46875 L6.12593747,2.59375 C6.12593747,2.525 6.18218747,2.46875 6.25093747,2.46875 L6.25093747,2.46875 Z" id="形状结合"></path>
                </g>
            </g>
        </g>
    </g>q
</g>
</svg>`,RAe='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1590389330617" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="19656" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><defs><style type="text/css"></style></defs><path d="M512 64c-247.4 0-448 200.6-448 448s200.6 448 448 448 448-200.6 448-448-200.6-448-448-448z m0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z" fill="" p-id="19657"></path><path d="M464 336c0 26.5 21.5 48 48 48s48-21.5 48-48-21.5-48-48-48-48 21.5-48 48zM536 448h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8v-272c0-4.4-3.6-8-8-8z" fill="" p-id="19658"></path></svg>',IAe=`<?xml version="1.0" encoding="UTF-8"?>
<svg width="23px" height="12px" viewBox="0 0 23 12" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <title>编组 8备份 3</title>
    <g id="----隐藏列标注！" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
        <g id="隐藏列标注" transform="translate(-275.000000, -824.000000)">
            <rect fill="#FFFFFF" x="0" y="0" width="1333" height="1167"></rect>
            <g id="编组-8备份-3" transform="translate(275.000000, 824.000000)">
                <rect id="矩形" stroke-opacity="0.25" stroke="#000000" fill="#F7F7F7" x="0.5" y="0.5" width="11" height="11"></rect>
                <rect id="矩形备份-9" stroke-opacity="0.25" stroke="#000000" fill="#F7F7F7" x="11.5" y="0.5" width="11" height="11"></rect>
                <g id="7.Icon/arrow/15.down/fill" transform="translate(6.000000, 6.000000) rotate(90.000000) translate(-6.000000, -6.000000) " fill="#000000" fill-rule="nonzero" opacity="0.65">
                    <path d="M7.25020811,6.37218077 L4.91348936,8.20968077 C4.82677061,8.27764952 4.69903624,8.21671202 4.69903624,8.10655577 L4.69903624,4.43272764 C4.69903624,4.32257139 4.82677061,4.26046202 4.91348936,4.32960264 L7.25020811,6.16593077 C7.31700499,6.21866514 7.31700499,6.31944639 7.25020811,6.37218077 Z" id="fill" transform="translate(5.999671, 6.269385) rotate(90.000000) translate(-5.999671, -6.269385) "></path>
                </g>
                <g id="7.Icon/arrow/15.down/fill" transform="translate(17.000000, 6.000000) rotate(270.000000) translate(-17.000000, -6.000000) translate(11.000000, 0.000000)" fill="#000000" fill-rule="nonzero" opacity="0.65">
                    <path d="M7.25020811,6.37218077 L4.91348936,8.20968077 C4.82677061,8.27764952 4.69903624,8.21671202 4.69903624,8.10655577 L4.69903624,4.43272764 C4.69903624,4.32257139 4.82677061,4.26046202 4.91348936,4.32960264 L7.25020811,6.16593077 C7.31700499,6.21866514 7.31700499,6.31944639 7.25020811,6.37218077 Z" id="fill" transform="translate(5.999671, 6.269385) rotate(90.000000) translate(-5.999671, -6.269385) "></path>
                </g>
            </g>
            <line x1="286.5" y1="813" x2="286.5" y2="864.5" id="路径-2备份-3" stroke="#000000" opacity="0.25"></line>
        </g>
    </g>
</svg>`,LAe=`<svg t="1557140120188" class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
xmlns="http://www.w3.org/2000/svg" p-id="16909" xmlns:xlink="http://www.w3.org/1999/xlink"
width="200" height="200">
	<defs>
		<style type="text/css">
		</style>
	</defs>
	<path d="M328 544h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"
	p-id="16910">
	</path>
	<path d="M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32z m-40 728H184V184h656v656z"
	p-id="16911">
	</path>
</svg>`,OAe=`<svg t="1557140186692" class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
xmlns="http://www.w3.org/2000/svg" p-id="17025" xmlns:xlink="http://www.w3.org/1999/xlink"
width="200" height="200">
	<defs>
		<style type="text/css">
		</style>
	</defs>
	<path d="M328 544h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"
	p-id="17026">
	</path>
	<path d="M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32z m-40 728H184V184h656v656z"
	p-id="17027">
	</path>
</svg>`,PAe=`<svg t="1565940955886" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
     p-id="17472" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200">
  <defs>
    <style type="text/css"></style>
  </defs>
  <path
    d="M948 392.992l-403.008 488.99200001Q532 896 512.992 896t-32-14.016L76 392.992q-18.016-20.992-7.008-46.016T108 321.98400001L916 321.98400001q28 0 39.008 24.99199999T948 392.992z"
    p-id="17473" data-spm-anchor-id="a313x.7781069.0.i2" class="selected"></path>
</svg>
`,DAe=`<svg t="1565940955886" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
     p-id="17472" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200">
  <defs>
    <style type="text/css"></style>
  </defs>
  <path
    fill-opacity="0.45"
    d="M948 392.992l-403.008 488.99200001Q532 896 512.992 896t-32-14.016L76 392.992q-18.016-20.992-7.008-46.016T108 321.98400001L916 321.98400001q28 0 39.008 24.99199999T948 392.992z"
    p-id="17473" data-spm-anchor-id="a313x.7781069.0.i2" class="selected"></path>
</svg>
`,FAe=`<svg t="1565940979768" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
p-id="17620" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200">
<defs>
<style type="text/css"></style>
</defs>
<path
d="M76 631.008l403.008-488.99200001Q492 128 511.008 128t32 14.016L948 631.008q18.016 20.992 7.008 46.016T916 702.01599999L108 702.01599999q-28 0-39.008-24.99199999T76 631.008z"
p-id="17621"></path>
</svg>
`,BAe=`<svg t="1565940979768" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"
     p-id="17620" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200">
  <defs>
    <style type="text/css"></style>
  </defs>
  <path
    fill-opacity="0.45"
    d="M76 631.008l403.008-488.99200001Q492 128 511.008 128t32 14.016L948 631.008q18.016 20.992 7.008 46.016T916 702.01599999L108 702.01599999q-28 0-39.008-24.99199999T76 631.008z"
    p-id="17621"></path>
</svg>
`,NAe='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1596433821690" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="20229" width="16" height="16" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><style type="text/css"></style></defs><path d="M888 792H200V168c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h752c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM305.8 637.7c3.1 3.1 8.1 3.1 11.3 0l138.3-137.6L583 628.5c3.1 3.1 8.2 3.1 11.3 0l275.4-275.3c3.1-3.1 3.1-8.2 0-11.3l-39.6-39.6c-3.1-3.1-8.2-3.1-11.3 0l-230 229.9L461.4 404c-3.1-3.1-8.2-3.1-11.3 0L266.3 586.7c-3.1 3.1-3.1 8.2 0 11.3l39.5 39.7z" p-id="20230"></path></svg>',kAe=`<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1608030723688" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="21482" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16"><defs><style type="text/css"></style></defs><path d="M547.648 696a32 32 0 0 1 31.488 26.24l0.512 5.76v151.68l145.216-144.512a32 32 0 0 1 40.832-3.648l4.416 3.712a32 32 0 0 1 3.584 40.832l-3.712 4.48-203.072 202.24a32 32 0 0 1-40.768 3.648l-4.416-3.712-202.24-202.24a32 32 0 0 1 40.832-48.96l4.416 3.712 150.912 150.912v-158.144a32 32 0 0 1 32-32z m194.56-529.28l4.928 3.072 233.792 180.224a32 32 0 0 1 1.728 49.28l-4.864 3.52-409.792 245.568a32 32 0 0 1-27.328 2.624l-5.184-2.432-422.4-245.568a32 32 0 0 1-7.552-49.28l4.544-4.032 242.816-180.288a32 32 0 0 1 42.432 47.552l-4.288 3.84-203.84 151.296 364.16 211.648 353.28-211.712-196.608-151.552a32 32 0 0 1-8.896-40l3.136-4.864a32 32 0 0 1 40-8.96zM547.712 28.672a32 32 0 0 1 31.488 26.24l0.512 5.76v396.992a32 32 0 0 1-63.488 5.76l-0.512-5.76V60.736a32 32 0 0 1 32-32z" p-id="21483" fill="currentColor"></path></svg>
`,zAe='<svg viewBox="64 64 896 896" focusable="false" data-icon="eye" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258c161.3 0 279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766zm-4-430c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z"></path></svg>',aZ=Object.freeze({__proto__:null,ArrowDown:xAe,ArrowUp:bAe,CellDown:EAe,CellUp:wAe,GlobalAsc:CAe,GlobalDesc:SAe,GroupAsc:TAe,GroupDesc:AAe,GroupNone:MAe,Minus:LAe,Plus:OAe,SortDown:DAe,SortUp:BAe,SortDownSelected:PAe,SortUpSelected:FAe,InfoCircle:RAe,ExpandColIcon:IAe,Trend:NAe,DrillDownIcon:kAe,EyeOutlined:zAe}),mht={},yht=function(e,t){mht[J6(e)]=t},UAe=function(e){return mht[J6(e)]};Es(aZ).forEach(function(e){yht(e,aZ[e])});var oZ="<svg",sZ="data:image/svg+xml",lZ={},_S=function(e){nn(t,e);function t(r){var n=e.call(this,r)||this;return n.isOnlineLink=function(i){return/^(https?:)?(\/\/)/.test(i)},n.render(),n}return t.prototype.getImage=function(r,n,i){var a=this;return new Promise(function(o,s){var l=UAe(r);if(l){var u=new Image;u.onload=function(){lZ[n]=u,o(u)},u.onerror=s,l.includes(sZ)||a.isOnlineLink(l)?(u.src=l,u.crossOrigin="anonymous"):(i&&(l=l.replace(/fill=[\'\"]#?\w+[\'\"]/g,""),l=l.replace(/fill>/g,">")),l=l.replace(oZ,"".concat(oZ,' fill="').concat(i,'"')),u.src="".concat(sZ,";utf-8,").concat(encodeURIComponent(l)))}})},t.prototype.render=function(){var r=this.cfg,n=r.name,i=r.fill,a=T2(this.cfg),o=qt(qt({},a8(a,"fill")),{type:t.type}),s=new d6({attrs:o});this.iconImageShape=s,this.setImageAttrs({name:n,fill:i})},t.prototype.setImageAttrs=function(r){var n=this,i=r.name,a=r.fill,o=this.iconImageShape;i=i||o.attrs.name,a=a||o.attrs.fill;var s="".concat(i,"-").concat(a),l=lZ[s];l?(o.attr("img",l),this.addShape("image",o)):this.getImage(i,s,a).then(function(u){var c,f,d,v=(d=(f=(c=n.getParent())===null||c===void 0?void 0:c.getMeta)===null||f===void 0?void 0:f.call(c).spreadsheet)===null||d===void 0?void 0:d.container;if(n.destroyed||v&&!v.get("refreshElements")){Wp.getInstance().logger("GuiIcon ".concat(i," destroyed."));return}o.attr("img",u),n.addShape("image",o)}).catch(function(u){if(u instanceof TypeError){console.warn("GuiIcon ".concat(i," destroyed:"),u);return}console.error("GuiIcon ".concat(i," load failed:"),u)})},t.type="__GUI_ICON__",t}(hv),yl;(function(e){e.TOP="TOP",e.BOTTOM="BOTTOM",e.LEFT="LEFT",e.RIGHT="RIGHT"})(yl||(yl={}));var ky;(function(e){e.SUM="SUM",e.MIN="MIN",e.MAX="MAX",e.AVG="AVG"})(ky||(ky={}));var Fd;(function(e){e.Row="row",e.Col="col",e.Series="series"})(Fd||(Fd={}));var $Ae=function(){function e(){this.store=new Map}return e.prototype.set=function(t,r){return this.store.set(t,r)},e.prototype.get=function(t,r){var n,i=this.store.get(t);return(n=i)!==null&&n!==void 0?n:r},e.prototype.clear=function(){this.store.clear()},e.prototype.size=function(){return this.store.size},e}(),OM=function(e){var t,r,n=e.facetCfg,i=e.level,a=e.fields,o=n.colCfg,s=n.spreadsheet,l=n.dataSet,u=l.moreThanOneValue(),c=(r=(t=s.dataCfg.fields)===null||t===void 0?void 0:t.valueInCols)!==null&&r!==void 0?r:!0,f=(o==null?void 0:o.hideMeasureColumn)&&c&&!u&&lc(a,Fi),d=f?2:1;return i===a.length-d},_ht=function(e,t,r,n){return t.layoutArrange?t.layoutArrange(t.spreadsheet,r,n,e):e},E8=function(e,t,r,n){var i,a,o=(a=(i=e.spreadsheet)===null||i===void 0?void 0:i.facet)===null||a===void 0?void 0:a.getHiddenColumnsInfo(r);if(o&&e.columns.find(function(x){return x===r.field}))return!1;var s=!0,l=function(x,w,S){w===void 0&&(w=-1),S===void 0&&(S=-1),w===-1?(t.children.push(x),n.pushNode(x)):(t.children.splice(w,0,x),n.pushNode(x,S))};if(e.layoutHierarchy){var u=e.layoutHierarchy(e.spreadsheet,r);if(u){var c=Gp(u==null?void 0:u.delete)?u==null?void 0:u.delete:!1;s=!c;var f=u.push,d=u.unshift,v=t.children.length,g=n.getNodes().length;Dr(d)||(bi(d,function(x){l(x)}),v=t.children.length,g=n.getNodes().length),Dr(f)||bi(f,function(x){l(x)}),c||l(r,v,g)}else l(r)}else l(r);return s},p5=function(e,t,r){e!=null&&e.layoutCoordinate&&(t!=null&&t.isLeaf||r!=null&&r.isLeaf)&&(e==null||e.layoutCoordinate(e.spreadsheet,t,r))},HAe=function(e,t){var r=e==null?void 0:e.layoutDataPosition;if(r){var n=t.getCellMeta,i=r(e.spreadsheet,n);return qt(qt({},t),{getCellMeta:i})}return t},xht=function(){function e(t){this.label=t}return e}(),bht=function(e){var t=e.addTotalMeasureInTotal,r=e.parentNode,n=e.currentField,i=e.fields,a=e.facetCfg,o=e.hierarchy,s=i.indexOf(n),l=a.dataSet,u=a.values,c=a.spreadsheet,f=[],d={},v=c.getTotalsConfig(n),g=r.isGrandTotals?v.totalsGroupDimensions||[]:v.subTotalsGroupDimensions||[],x=l.isEmpty()?[]:g;if(x!=null&&x.includes(n)){d=d5(r);var w=l.getDimensionValues(n,d);f.push.apply(f,Gr([],ur((w||[]).map(function(M){return new Eb({label:M,isSubTotals:r.isSubTotals,isGrandTotals:r.isGrandTotals,isTotalRoot:!1})})),!1)),Dr(f)&&n&&f.push($_)}else if(t&&n===Fi)d=d5(r),f.push.apply(f,Gr([],ur(u.map(function(M){return new xht(M)})),!1));else if(OM({facetCfg:a,level:s,fields:i})){r.isLeaf=!0,o.pushIndexNode(r),r.rowIndex=o.getIndexNodes().length-1;return}else{bht(qt(qt({},e),{currentField:i[s+1]}));return}var S=f.filter(function(M){return!pL(M)});w8(qt(qt({},e),{fieldValues:S,level:s,parentNode:r,query:d}))},VAe=function(e){var t,r=e.parentNode,n=e.currentField,i=e.fields,a=e.facetCfg,o=i.indexOf(n),s=a.dataSet,l=a.spreadsheet,u=[],c={};c=d5(r,!0);var f=s.getDimensionValues(n,c),d=_ht(f,a,r,n);u.push.apply(u,Gr([],ur(d||[]),!1)),Dr(u)&&n&&(n===Fi?u.push.apply(u,Gr([],ur((t=s.fields)===null||t===void 0?void 0:t.values),!1)):u.push($_)),gAe({currentField:n,lastField:i[o-1],isFirstField:o===0,fieldValues:u,spreadsheet:l});var v=u.filter(function(g){return!pL(g)});w8(qt(qt({},e),{fieldValues:v,level:o,parentNode:r,query:c}))},Eht=function(e){e.parentNode.isTotals?bht(e):VAe(e)},xS=function(e,t){return"".concat(e).concat(Bu).concat(t)},w8=function(e){var t,r,n,i,a,o,s,l,u,c,f=e.currentField,d=e.fields,v=e.fieldValues,g=e.facetCfg,x=e.hierarchy,w=e.parentNode,S=e.level,M=e.query,R=e.addMeasureInTotalQuery,I=e.addTotalMeasureInTotal,P=g.spreadsheet,k=g.collapsedCols;try{for(var z=Kf(v.entries()),G=z.next();!G.done;G=z.next()){var J=ur(G.value,2),Z=J[0],X=J[1],et=X instanceof Eb,at=X instanceof xht,wt=void 0,Tt=void 0,vt=!1,zt=!1,oe=!1,Qt=!1,ne=f;if(et){var de=X;zt=de.isGrandTotals,oe=de.isSubTotals,Qt=de.isTotalRoot,wt=Tl(X.label),Qt?Tt=M:Tt=qt(qt({},M),(n={},n[f]=wt,n)),R&&(Tt[Fi]=(s=P==null?void 0:P.dataSet)===null||s===void 0?void 0:s.fields.values[0]),vt=OM({facetCfg:g,level:S,fields:d})}else at?(wt=Tl(X.label),Tt=qt(qt({},M),(i={},i[Fi]=wt,i)),ne=Fi,zt=w.isGrandTotals,oe=w.isSubTotals,vt=OM({facetCfg:g,level:S,fields:d})):P.isTableMode()?(wt=X,ne=d[Z],Tt=qt(qt({},M),(a={},a[ne]=wt,a)),vt=!0):(wt=X,Tt=wt===$_?qt({},M):qt(qt({},M),(o={},o[f]=wt,o)),vt=OM({facetCfg:g,level:S,fields:d}));var De=xS(w.id,wt);if(!De)return;var Ze=Gp(k==null?void 0:k[De])?k==null?void 0:k[De]:!1,ke=new cu({id:De,key:ne,value:wt,level:S,field:ne,parent:w,isTotals:et||at,isGrandTotals:zt,isSubTotals:oe,isTotalMeasure:at,isCollapsed:Ze,isTotalRoot:Qt,hierarchy:x,query:Tt,spreadsheet:P,isLeaf:vt||Ze}),Be=E8(g,w,ke,x),Zr=(l=P==null?void 0:P.facet)===null||l===void 0?void 0:l.getHiddenColumnsInfo(ke);Zr&&w&&(w.hiddenChildNodeInfo=Zr),S>x.maxLevel&&!zt&&!w.isGrandTotals&&!w.isSubTotals&&!ke.isSubTotals&&(x.sampleNodesForAllLevels.push(ke),x.maxLevel=S,x.sampleNodeForLastLevel=Zr?((u=Zr==null?void 0:Zr.displaySiblingNode)===null||u===void 0?void 0:u.next)||((c=Zr==null?void 0:Zr.displaySiblingNode)===null||c===void 0?void 0:c.prev):ke);var Wr=vt||Ze||!Be;Wr?(ke.isLeaf=!0,x.pushIndexNode(ke),ke.rowIndex=x.getIndexNodes().length-1):Eht({addTotalMeasureInTotal:I,addMeasureInTotalQuery:R,parentNode:ke,currentField:d[S+1],fields:d,facetCfg:g,hierarchy:x})}}catch(In){t={error:In}}finally{try{G&&!G.done&&(r=z.return)&&r.call(z)}finally{if(t)throw t.error}}},wht=function(e,t,r,n){var i=t.facetCfg,a=t.hierarchy,o=t.parentNode,s=i.dataSet;e.forEach(function(l,u){typeof l=="string"&&(l={key:l});var c=l.key,f=c===m_?Tl("序号"):s.getFieldName(c),d=n||o;if(w8({currentField:c,fields:[c],fieldValues:[f],facetCfg:i,hierarchy:a,parentNode:d,level:r,query:{},addMeasureInTotalQuery:!1,addTotalMeasureInTotal:!1}),l.children&&l.children.length){var v=d.children[u];v.isLeaf=!1,wht(l.children,t,r+1,v)}})},qy=function(e,t){return t>0&&e<t},Ky=function(e,t,r){return t>0&&e>=r-t},bL=function(e,t,r){return r>0&&e<t+r},D2=function(e,t,r){return r>0&&e>=t+1-r},C8=function(e,t,r,n,i,a){var o=xb(r,function(f,d){var v=e-(Sl(a)?0:a)+i.x;return v>=f&&v<r[d+1]},0);o=Math.max(o,0);var s=xb(r,function(f,d){var v=i.width+e+i.x;return v>=f&&v<r[d+1]},o);s=Math.min(s===-1?1/0:s,r.length-2);var l=n.getIndexRange(t+i.y,i.height+t+i.y),u=l.start,c=l.end;return[o,s,u,c]},GAe=function(e,t,r){var n=2,i=Math.abs(e/t),a=i<=1/n?0:e,o=i>n?0:t;return[a*r.horizontal,o*r.vertical]},ug=function(e,t,r){var n,i,a=e==null?void 0:e.getMatrix(),o=(n=a==null?void 0:a[6])!==null&&n!==void 0?n:0,s=(i=a==null?void 0:a[7])!==null&&i!==void 0?i:0;e==null||e.translate(t-o,r-s)},EL=function(e,t){var r,n=e==null?void 0:e.getMatrix(),i=(r=n==null?void 0:n[6])!==null&&r!==void 0?r:0;e==null||e.translate(t-i,0)},WAe=function(e,t){var r,n=e==null?void 0:e.getMatrix(),i=(r=n==null?void 0:n[7])!==null&&r!==void 0?r:0;e==null||e.translate(0,t-i)},XAe=function(e,t,r,n){var i=t.frozenColCount,a=t.frozenRowCount,o=t.frozenTrailingColCount,s=t.frozenTrailingRowCount,l=e.colIndex,u=e.rowIndex;return bL(u,n.start,a)?el.ROW:D2(u,n.end,s)?el.TRAILING_ROW:qy(l,i)?el.COL:Ky(l,o,r)?el.TRAILING_COL:el.SCROLL},jAe=function(e,t,r){for(var n,i=e.frozenColCount,a=e.frozenRowCount,o=e.frozenTrailingColCount,s=e.frozenTrailingRowCount,l=(n={},n[el.TOP]=[],n[el.BOTTOM]=[],n),u=0;u<i;u++){for(var c=r.start;c<r.start+a;c++)l[el.TOP].push({x:u,y:c});if(s>0)for(var c=0;c<s;c++){var f=r.end-c;l[el.BOTTOM].push({x:u,y:f})}}for(var u=0;u<o;u++){for(var d=t-1-u,c=r.start;c<r.start+a;c++)l[el.TOP].push({x:d,y:c});if(s>0)for(var c=0;c<s;c++){var f=r.end-c;l[el.BOTTOM].push({x:d,y:f})}}return l},YAe=function(e,t,r,n){var i=t.frozenColCount,a=t.frozenRowCount,o=t.frozenTrailingColCount,s=t.frozenTrailingRowCount,l=Gr([],ur(e),!1);qy(l[0],i)&&(l[0]=i),Ky(l[1],o,r)&&(l[1]=r-o-1),bL(l[2],n.start,a)&&(l[2]=n.start+a),D2(l[3],n.end,s)&&(l[3]=n.end-s);var u=Gr([],ur(l),!1);u[2]=n.start,u[3]=n.start+a-1;var c=Gr([],ur(l),!1);c[0]=0,c[1]=i-1;var f=Gr([],ur(l),!1);f[2]=n.end+1-s,f[3]=n.end;var d=Gr([],ur(l),!1);return d[0]=r-o,d[1]=r-1,{center:l,frozenRow:u,frozenCol:c,frozenTrailingCol:d,frozenTrailingRow:f}},ZAe=function(e,t){var r=e,n=0,i=r.getTotalLength()-1;if(t){var a=t.current,o=a===void 0?f5:a,s=t.pageSize;n=Math.max((o-1)*s,0),i=Math.min(o*s-1,r.getTotalLength()-1)}return{start:n,end:i}},vI=function(e,t,r){var n=t,i=r,a=function(o){return o.isLeaf?1:o.children?o.children.reduce(function(s,l){return s+=a(l),s},0):0};return t&&(n=e.slice(0,t).reduce(function(o,s){return o+=a(s),o},0)),r&&(i=e.slice(e.length-r).reduce(function(o,s){return o+=a(s),o},0)),{colCount:n,trailingColCount:i}},Cht=function(e,t){return e.reduce(function(r,n){typeof n=="string"&&(n={key:n});var i=qt({},n);return i.children?(i.children=Cht(i.children,t),r.push(i),r):(t[i.key]&&r.push(i),r)},[])},Xp=function(e){return e.parent.id==="root"},qAe=function(e){for(;!Xp(e);)e=e.parent;return e},KAe=function(e){var t=[],r=function(n){n.forEach(function(i){typeof i=="string"||!i.children?t.push(i):r(i.children)})};return r(e),t},oE=function(e){var t=KAe(e);return t.map(function(r){return typeof r=="string"?r:r.key})},v5=function(e){var t=e.children[0];return t?t.isLeaf?t:v5(t):e},QAe=function(e){return Dr(e.rows)&&Dr(e.columns)&&Dr(e.values)&&Dr(e.customTreeItems)},wb=function(e,t){var r,n=e.pagination,i=e.frozenFirstRow,a=e.hierarchyType,o=e.showSeriesNumber,s=n&&n.pageSize,l=!1,u=t==null?void 0:t[0];if(!s&&i){l=((r=u==null?void 0:u.children)===null||r===void 0?void 0:r.length)===0;var c=a==="tree"||a==="customTree";c&&!l&&(l=!o)}var f=l&&!!u;return{frozenRowCount:f?1:0,frozenColCount:0,frozenTrailingColCount:0,frozenTrailingRowCount:0,enableFrozenFirstRow:l,frozenRowHeight:f?u.height:0}},JAe=function(e){return e===$_?Y3:e},tMe=function(e){var t=e.facetCfg,r=t.columns,n=t.spreadsheet,i=n.store.get("hiddenColumnsDetail"),a=t==null?void 0:t.showSeriesNumber,o=oE(r),s=o.filter(function(f){return i?i.every(function(d){return d.hideColumnNodes.every(function(v){return v.field!==f})}):!0}),l=Gr([],ur(s),!1),u=Gr([],ur(r),!1),c={};a&&(u.unshift({key:m_}),c[m_]=!0),l.reduce(function(f,d){return f[d]=!0,f},c),wht(Cht(u,c),e,0,null)},vx=function(e){return Number.parseFloat((Hh(e)||0).toPrecision(Ilt))},Qm=function(e,t,r){if(r===void 0&&(r=0),!Object.values(e).find(function(o){return o>0}))return e;var n=qt({},e);n.frozenColCount>=t&&(n.frozenColCount=t);var i=t-n.frozenColCount;n.frozenTrailingColCount>i&&(n.frozenTrailingColCount=i),n.frozenRowCount>=r&&(n.frozenRowCount=r);var a=r-n.frozenRowCount;return n.frozenTrailingRowCount>a&&(n.frozenTrailingRowCount=a),n},eMe=function(e){var t;return(t=e==null?void 0:e.position)!==null&&t!==void 0?t:"right"},rMe=function(e,t){e===void 0&&(e=0),t===void 0&&(t=0),e=vx(e),t=vx(t);var r=e>=0,n=t>=0&&e<=0,i=r?e:t,a=n?0:i,o=t-e;return function(s){var l=r?0:1,u=n?cI(Math.abs(0-e)/o,0,1):l,c=cI((s-a)/o,-1,1);return{zeroScale:u,scale:c}}},Sht=function(e,t){return cL(e,function(r){return r.field instanceof RegExp?r.field.test(t):r.field===t})},S8=function(e){return fI({size:0,position:"right",margin:{left:0,right:0}},e)},Tht=function(e,t,r){var n=t.size,i=t.margin,a=Sht(e==null?void 0:e.icon,r),o=a&&a.mapping&&{size:n,margin:i,position:eMe(a)};return S8(o)};function Vh(e,t,r){var n;return(n=e==null?void 0:e.addShape)===null||n===void 0?void 0:n.call(e,"rect",qt({zIndex:1,attrs:t},r||{}))}function nMe(e,t){var r;return(r=e==null?void 0:e.addShape)===null||r===void 0?void 0:r.call(e,"polygon",{attrs:t})}function iMe(e,t){var r;return(r=e==null?void 0:e.addShape)===null||r===void 0?void 0:r.call(e,"polyline",{attrs:t})}function Aht(e,t){var r;return(r=e==null?void 0:e.addShape)===null||r===void 0?void 0:r.call(e,"circle",{attrs:t})}function C_(e,t,r,n,i,a,o,s){var l;return!Dr(t)&&e&&bi(t,function(u){e.contain(u)&&e.removeChild(u,!0)}),(l=e==null?void 0:e.addShape)===null||l===void 0?void 0:l.call(e,"text",{attrs:qt(qt({x:r,y:n,text:i,originalText:s},a),o)})}function hu(e,t,r){var n;return(n=e==null?void 0:e.addShape)===null||n===void 0?void 0:n.call(e,"line",{zIndex:100,attrs:qt(qt({},t),r)})}function Pf(e,t,r){if(!Dr(e)){var n=Xn(e)?e:[e];n.forEach(function(i){mS(i,"attrs.".concat(t),r)})}}function T8(e,t){var r=new _S(t);return e==null||e.add(r),r}function Mht(e,t,r,n,i){var a=new _S(qt(qt({name:n?"Plus":"Minus"},t),{fill:r}));return mu(i)&&a.on("click",i),e==null||e.add(a),a}var g5="s2-offscreen-canvas",aMe=function(){var e=document.getElementById(g5);return e||(e=document.createElement("canvas"),e.id=g5,e.style.display="none",document.body.appendChild(e),e)},oMe=function(){var e;(e=document.getElementById(g5))===null||e===void 0||e.remove()},Rht=function(e,t){var r,n,i,a=e.data,o=e.encode,s=e.type,l=t.getMeta(),u=l.x,c=l.y,f=l.height,d=l.width,v=t.getStyle(kr.DATA_CELL),g=v.cell,x=v.miniChart,w=[],S=oa(a,function(at){return w.push(at==null?void 0:at[o.y]),{x:at[o.x],y:at[o.y]}}),M=bb(w),R=n8(w),I=M-R,P=u+g.padding.left,k=u+d-g.padding.right,z=c+g.padding.top,G=c+f-g.padding.bottom,J=G-z,Z=s===_b.Bar?(k-P-(w.length-1)*((r=x==null?void 0:x.bar)===null||r===void 0?void 0:r.intervalPadding))/w.length+((n=x==null?void 0:x.bar)===null||n===void 0?void 0:n.intervalPadding):(i=(k-P)/(w.length-1))!==null&&i!==void 0?i:0,X=[],et=oa(S,function(at,wt){var Tt,vt=P+wt*Z,zt;if(I!==0?zt=G-((at==null?void 0:at.y)-R)/I*J:zt=R>0?z:G,s===_b.Bar){var oe=void 0,Qt=void 0;R<0&&M>0&&I!==0?(oe=G-(0-R)/I*J,Qt=Math.abs(zt-oe),(at==null?void 0:at.y)<0&&(zt=oe)):(oe=R<0?z:G,I=bb([Math.abs(M),Math.abs(R)]),Qt=I===0?J:Math.abs((at==null?void 0:at.y)-0)/I*J,zt=oe);var ne=Z-((Tt=x==null?void 0:x.bar)===null||Tt===void 0?void 0:Tt.intervalPadding);X.push([ne,Qt])}return[vt,zt]});return{points:et,box:X}},sMe=function(e,t){if(!(Dr(e==null?void 0:e.data)||Dr(t))){var r=t.getStyle(kr.DATA_CELL),n=r.miniChart,i=n.line,a=i.point,o=i.linkLine,s=Rht(e,t).points;iMe(t,{points:s,stroke:o.fill,lineWidth:o.size,opacity:o.opacity});for(var l=0;l<s.length;l++)Aht(t,{x:s[l][0],y:s[l][1],r:a.size,fill:a.fill,fillOpacity:a.opacity})}},lMe=function(e,t){if(!(Dr(e==null?void 0:e.data)||Dr(t)))for(var r=t.getStyle(kr.DATA_CELL),n=r.miniChart,i=n.bar,a=Rht(e,t),o=a.points,s=a.box,l=0;l<o.length;l++)Vh(t,{x:o[l][0],y:o[l][1],width:s[l][0],height:s[l][1],fill:i.fill,fillOpacity:i.opacity})},uMe=function(e,t,r){var n=Number(t)-Number(e);return Number.isNaN(n)||Number(e)<0?r.bad:n<=.1?r.good:n>.1&&n<=.2?r.satisfactory:r.bad},cMe=function(e,t){var r,n;t===void 0&&(t={min:0,max:0});var i=Number(e);if(Number.isNaN(i))return e;var a=(r=t==null?void 0:t.min)!==null&&r!==void 0?r:t,o=(n=t==null?void 0:t.max)!==null&&n!==void 0?n:t,s=new Intl.NumberFormat("en-US",{minimumFractionDigits:a,maximumFractionDigits:o,useGrouping:!1,style:"percent"});return s.format(i)},hMe=function(e){var t,r,n,i,a,o;if(!Dr(e)){var s=e.getCellArea(),l=s.x,u=s.y,c=s.height,f=s.width,d=e.findFieldCondition((t=e.cellConditions)===null||t===void 0?void 0:t.interval);if(d&&d.mapping){var v=e.mappingValue(d);if(!v)return;var g=v.isCompare?v:e.valueRangeByField,x=vx(g.minValue),w=vx(g.maxValue),S=Sl(v==null?void 0:v.fieldValue)?vx(e.getMeta().fieldValue):vx(v==null?void 0:v.fieldValue);if(S<x||S>w)return;var M=(n=(r=e.getStyle().miniChart.interval)===null||r===void 0?void 0:r.height)!==null&&n!==void 0?n:e.getStyle().cell.miniBarChartHeight,R=(a=(i=e.getStyle().miniChart.interval)===null||i===void 0?void 0:i.fill)!==null&&a!==void 0?a:e.getStyle().cell.miniBarChartFillColor,I=rMe(x,w),P=I(S),k=P.zeroScale,z=P.scale,G=(o=v.fill)!==null&&o!==void 0?o:R;return Vh(e,{x:l+f*k,y:u+c/2-M/2,width:f*z,height:M,fill:G})}}},fMe=function(e,t){var r,n=t.getStyle(kr.DATA_CELL),i=t.getMeta(),a=i.x,o=i.y,s=i.height,l=i.width,u=i.spreadsheet;if(Dr(e)){C_(t,[],a+l-n.cell.padding.right,o+s/2,j_(t,u.options.placeholder),n.text);return}var c=n.miniChart.bullet,f=c.progressBar,d=c.comparativeMeasure,v=c.rangeColors,g=c.backgroundColor,x=e.measure,w=e.target,S=Math.max(Number(x),0),M=Math.max(Number(w),0),R=cMe(x,2),I=(f==null?void 0:f.widthPercent)>1?(f==null?void 0:f.widthPercent)/100:f==null?void 0:f.widthPercent,P=n.cell.padding,k=l-P.left-P.right,z=I*k,G=k-z,J=a+l-P.right-z,Z=o+s/2-f.height/2;Vh(t,{x:J,y:Z,width:z,height:f.height,fill:g,textBaseline:n.text.textBaseline});var X=ai(t.getMeta(),"spreadsheet.options.bullet.getRangeColor"),et=Math.max(Math.min(z*S,z),0);Vh(t,{x:J,y:Z+(f.height-f.innerHeight)/2,width:et,height:f.innerHeight,fill:(r=X==null?void 0:X(S,M))!==null&&r!==void 0?r:uMe(S,M,v)});var at=J+z*M;hu(t,{x1:at,y1:o+(s-d.height)/2,x2:at,y2:o+(s-d.height)/2+d.height},{stroke:(d==null?void 0:d.fill)||(d==null?void 0:d.color),lineWidth:d.width,opacity:d==null?void 0:d.opacity}),C_(t,[],J-P.right,o+s/2,Cb({measureTextWidth:u.measureTextWidth,text:R,maxWidth:G-P.right,fontParam:n.text}),n.text)},dMe=function(e,t){switch(t==null?void 0:t.type){case _b.Line:sMe(t,e);break;case _b.Bar:lMe(t,e);break;default:fMe(t,e);break}},Iht=function(e,t){var r=e.x,n=e.y,i=e.width,a=e.height,o=i-(t==null?void 0:t.left)-(t==null?void 0:t.right),s=a-(t==null?void 0:t.top)-(t==null?void 0:t.bottom);return{x:r+(t==null?void 0:t.left),y:n+(t==null?void 0:t.top),width:o,height:s}},Lht=function(e,t){return t=S8(t),e-t.size-t.margin.right-t.margin.left},gI=function(e,t,r){var n=e.y,i=e.height;r===void 0&&(r=0);var a=0;switch(t){case"top":a=n;break;case"middle":a=n+i/2-r/2;break;default:a=n+i-r;break}return a},F2=function(e,t,r,n,i){r===void 0&&(r=0),i===void 0&&(i=1);var a=e.x,o=e.width,s=t||{},l=s.textAlign,u=s.textBaseline,c=S8(n),f=c.size,d=c.margin,v=c.position,g=i*(f+d.left)+(i?d.right:0),x,w;switch(l){case"left":x=a+(v==="left"?g:0),w=a+(v==="left"?d.left:r+d.left);break;case"center":{var S=g-(v==="left"?d.left:d.right)+r,M=a+o/2-S/2;x=M+r/2+(v==="left"?g-d.left:0),w=M+(v==="left"?0:r+d.left);break}default:{x=a+o-(v==="right"?g:0),w=a+o-(v==="right"?g-d.left:r+g-d.left);break}}var R=gI(e,u,0),I=gI(e,u,f);return{text:{x,y:R},icon:{x:w,y:I}}},pMe=function(e,t){return F2(e,t).text},vMe=function(e,t,r){var n=t.start+t.width,i=e.start+e.width,a,o;if(t.start<=e.start&&n>=i)a=e.start+e.width/2,o=e.width;else if(t.start<=e.start){var s=t.width-(e.start-t.start);a=s<r?n-r/2:n-s/2,o=s}else if(n>=i){var s=t.width-(n-i);a=s<r?t.start+r/2:t.start+s/2,o=s}else a=t.start+t.width/2,o=t.width;return{start:a,width:o}},S_=function(e,t,r){var n=t.x,i=t.y,a=t.width,o=t.height,s=r.horizontalBorderWidth,l=r.horizontalBorderColorOpacity,u=r.horizontalBorderColor,c=r.verticalBorderWidth,f=r.verticalBorderColor,d=r.verticalBorderColorOpacity,v=r.borderDash,g,x,w,S,M;if(e===yl.TOP||e===yl.BOTTOM){var R=i;e===yl.TOP?R=i+c/2:R=i+o-c/2,x=R,S=R,g=n,w=n+a,M={lineWidth:s,stroke:u,strokeOpacity:l,lineDash:v}}if(e===yl.LEFT||e===yl.RIGHT){var I=n;e===yl.LEFT?I=n+s/2:I=n+a-s/2,g=I,w=I,x=i,S=i+o,M={lineWidth:c,stroke:f,strokeOpacity:d,lineDash:v}}return{position:{x1:g,x2:w,y1:x,y2:S},style:M}},gMe=function(e,t,r){r===void 0&&(r={left:0,right:0});var n=qt({},e);return t==="left"?(n.start+=r.left,n.width-=r.left):t==="right"&&(n.width-=r.right),n},mMe=function(e,t,r,n){var i=t+r,a=e.start;if(n==="center")return a-r/2;var o=e.width-i>0,s=o?e.width/2:i/2;return n==="left"?a-s:a+s-r};G_(function(e,t){if(e===void 0&&(e=""),!t)return 0;var r=aMe().getContext("2d"),n=t,i=n.fontSize,a=n.fontFamily,o=n.fontWeight,s=n.fontStyle,l=n.fontVariant;return r.font=[s,l,o,"".concat(i,"px"),a].join(" ").trim(),r.measureText("".concat(e)).width},function(e,t){return Gr([e],ur(Bg(t)),!1).join("")});var uZ=function(e,t,r,n){var i=16,a=e(Dx,n),o;iE(t)?o=t:o=$a(t);var s=r,l=[],u,c;if(e(t,n)<=r)return t;for(var f=!0;f;){if(u=o.substr(0,i),c=e(u,n),c+a>s&&c>s){f=!1;break}if(l.push(u),s-=c,o=o.substr(i),!o)return l.join("")}for(var d=!0;d;){if(u=o.substr(0,1),c=e(u,n),c+a>s){d=!1;break}if(l.push(u),s-=c,o=o.substr(1),!o)return l.join("")}return"".concat(l.join(""),"...")},Cb=function(e){var t=e.measureTextWidth,r=e.text,n=e.maxWidth,i=e.fontParam,a=e.priorityParam,o=e.placeholder,s={},l=o??Y3,u=Sl(r)||r===""||r===$_,c=u?l:"".concat(r),f=a;if(i&&Xn(i)?f=i:s=i||{},!f||!f.length)return uZ(t,c,n,s);var d=[],v=[c];f.forEach(function(S){v.forEach(function(M,R){var I=-1,P=M.match(new RegExp(S));if(P){var k=P[0];I=P.index,d.push(k);var z=I+k.length,G=M.slice(0,I),J=M.slice(z),Z=[G,J].filter(function(X){return!!X});v.splice.apply(v,Gr([R,1],ur(Z),!1))}})}),v=d.concat(v);var g=c,x=t(Dx,s),w=n;return v.forEach(function(S){if(w<=0){var M=g.indexOf(S),R=g.slice(M-3,M);if(R&&R!==Dx){var I=t(S,s);g=g.replace(S,I>x?Dx:S)}else g=g.replace(S,"");w-=x}else{var I=t(S,s);if(w<I&&I>x){var P=uZ(t,S,w,s);g=g.replace(S,P),w=0}else w-=I}}),g},yMe=function(e,t,r,n){n===void 0&&(n="left");var i=t.right,a=t.left,o=r||0;return n==="left"?e+i/2+o:n==="right"?e-i/2-o:e+a/2+o},_Me=function(e){var t,r,n=e.getMeta().isTotals,i=(r=(t=e).isMeasureField)===null||r===void 0?void 0:r.call(t),a=e.getStyle(e.cellType||kr.DATA_CELL),o;return i?o=a.measureText:n?o=a.bolderText:o=a.text,{cellStyle:a,textStyle:o}},xMe=function(e){var t=e.rowIndex,r=e.colIndex,n=e.meta,i=e.data,a=e.textStyle,o=e.textCondition,s=a==null?void 0:a.fill;return o!=null&&o.mapping&&(s=o==null?void 0:o.mapping(i,{rowIndex:t,colIndex:r,meta:n}).fill),qt(qt({},a),{fill:s})},j_=function(e,t){return mu(t)?t(e):t},bMe=function(e,t,r){for(var n=e.x,i=e.y,a=e.width,o=e.height,s=o/px(t),l=[],u,c,f,d=0,v=oa(r,function(S){return S>1?S/100:S}),g=0;g<px(t);g++){c=i+s*g;var x=[];u=n,d=0;for(var w=0;w<px(t[g]);w++)f=Dr(v)?a/px(t[0]):a*v[w],u=yMe(n,{left:0,right:0},d,"left"),d+=f,x.push({x:u,y:c,width:f,height:s});l.push(x)}return l},EMe=function(e,t,r){var n,i,a,o;r===void 0&&(r=!0);var s=e.getContentArea(),l=s.x,u=s.y,c=s.height,f=s.width,d=t||e.getMeta().fieldValue,v=d.values,g=e.getMeta().spreadsheet,x=g.options,w=g.measureTextWidth,S=x.style.cellCfg.valuesCfg,M=(i=(n=x==null?void 0:x.conditions)===null||n===void 0?void 0:n.text)===null||i===void 0?void 0:i[0],R=(o=(a=x==null?void 0:x.conditions)===null||a===void 0?void 0:a.icon)===null||o===void 0?void 0:o[0];if(!Xn(v)){dMe(e,v);return}var I=S==null?void 0:S.widthPercent,P=0;if(d!=null&&d.label){var k=e.getStyle(kr.DATA_CELL),z=k.bolderText;P=c/(v.length+1);var G=C_(e,[],l,u+P/2,Cb({measureTextWidth:w,text:d.label,maxWidth:f,fontParam:z}),z);e.addTextShape(G)}for(var J=_Me(e),Z=J.cellStyle,X=J.textStyle,et=Z==null?void 0:Z.icon,at=R&&R.mapping&&{size:et==null?void 0:et.size,margin:et==null?void 0:et.margin,position:R==null?void 0:R.position},wt,Tt=bMe({x:l,y:u+P,height:c-P,width:f},v,I),vt=0;vt<v.length;vt++)for(var zt=T2(v[vt]),oe=0;oe<zt.length;oe++){wt=zt[oe];var Qt=r?xMe({rowIndex:vt,colIndex:oe,meta:e==null?void 0:e.getMeta(),data:wt,textStyle:X,textCondition:M}):X,ne=(e==null?void 0:e.getMeta().spreadsheet.options).placeholder,de=j_(e==null?void 0:e.getMeta(),ne),De=Lht(Tt[vt][oe].width,et),Ze=Cb({measureTextWidth:w,text:wt,maxWidth:De,fontParam:Qt,placeholder:de}),ke=w(Ze,X),Be=F2(Tt[vt][oe],X,ke,at,R?1:0),G=C_(e,[],Be.text.x,Be.text.y,Ze,Qt,{},wt==null?void 0:wt.toString());if(e.addTextShape(G),R&&r){var Zr=R==null?void 0:R.mapping(wt,{rowIndex:vt,colIndex:oe,meta:e==null?void 0:e.getMeta()});if(Zr){var Wr=T8(e,qt(qt({},Be.icon),{name:Zr.icon,width:et==null?void 0:et.size,height:et==null?void 0:et.size,fill:Zr.fill}));e.addConditionIconShape(Wr)}}}},rD=function(e,t){return t===void 0&&(t=1),(e==null?void 0:e.width)*t},wMe=function(e){try{return JSON.parse(e)}catch{return null}},CMe=function(e,t,r){return e.sort(function(n,i){r&&(n=r(n),i=r(i));var a=t.indexOf(n),o=t.indexOf(i);return a===-1&&o===-1?0:a===-1?1:o===-1?-1:a-o})},SMe=function(e){return e===void 0&&(e=[]),e.filter(function(t){return t!==av&&t!==g6})},TMe=function(e){return Xn(e)?_ct(e):[e]},AMe=function(e,t){var r;return(r=e==null?void 0:e.filter(function(n){return!(t!=null&&t.includes(n))}))===null||r===void 0?void 0:r.concat(t)};function MMe(e,t){var r=e.isRowTotal,n=e.isRowSubTotal,i=e.isColTotal,a=e.isColSubTotal,o=t||{},s=o.row,l=o.col,u=s||{},c=u.calcTotals,f=c===void 0?{}:c,d=u.calcSubTotals,v=d===void 0?{}:d,g=l||{},x=g.calcTotals,w=x===void 0?{}:x,S=g.calcSubTotals,M=S===void 0?{}:S,R=function(I,P){if((I.aggregation||I.calcFunc)&&P)return{aggregation:I.aggregation,calcFunc:I.calcFunc}};return R(w,i)||R(M,a)||R(f,r)||R(v,n)}function bS(e){return e===MM}function My(e,t,r){return e===void 0&&(e={}),t===void 0&&(t=[]),r===void 0&&(r=av),t.reduce(function(n,i){var a=e[i];return i in e?n.push(String(a)):n.push(r),n},[])}function Oht(e,t){var r=t.filter(function(n){return n in e});return Dr(r)&&r.push(g6),r}function cZ(e,t,r){e===void 0&&(e={}),t===void 0&&(t=[]);var n=[];function i(a,o,s){return o.reduce(function(l,u){var c=a[u];return u in a?l.push(String(c)):u===Fi&&s?l.push(s):l.push(av),l},[])}return r?r.forEach(function(a){n.push(i(e,t,a))}):n.push(i(e,t)),n}function RMe(e,t,r){var n,i=t.slice(0,t.indexOf(e)+1);return(n=r.map(function(a){return i.map(function(o){return a[o]}).join("".concat(Bu))}))===null||n===void 0?void 0:n.filter(function(a){return a})}function mI(e,t){return e.concat(t).filter(function(r){return r!==Fi}).join(Bu)}function yI(e){var t=e.rowDimensionValues,r=e.colDimensionValues,n=e.isFirstCreate,i=e.onFirstCreate,a=e.rowFields,o=e.colFields,s=e.rowPivotMeta,l=e.colPivotMeta,u=e.prefix,c=u===void 0?"":u,f=function(g,x,w,S){for(var M=w,R=[],I=0;I<x.length;I++){var P=x[I];if(n&&M&&!(M!=null&&M.has(P))){var k=x.slice(0,I+1).map(function(et){return String(et)}),z=k.join(Bu),G=P===av,J=void 0;G?J=0:M.has(av)?J=M.size:J=M.size+1,M.set(P,{id:z,dimensions:k,value:P,level:J,children:new Map}),i==null||i({dimension:g==null?void 0:g[I],dimensionPath:z,careRepeated:S})}var Z=M==null?void 0:M.get(P);if(R.push(bS(P)?P:Z==null?void 0:Z.level),Z){var X=g==null?void 0:g[I+1];n&&Z.childField!==X&&(Z.childField=X),M=Z==null?void 0:Z.children}}return R},d=f(a,t,s,!1),v=f(o,r,l,!0);return Gr(Gr([c],ur(d),!1),ur(v),!1)}function IMe(e){var t=e.rows,r=e.columns,n=e.values,i=e.valueInCols,a=e.data,o=a===void 0?[]:a,s=e.indexesData,l=s===void 0?{}:s,u=e.sortedDimensionValues,c=e.rowPivotMeta,f=e.colPivotMeta,d=e.getExistValuesByDataItem,v=[],g=new Set(Ect(t,r)),x=function(S){var M=S.dimension,R=S.dimensionPath,I=S.careRepeated,P=I===void 0?!0:I;P&&g.has(M)||(u[M]||(u[M]=[])).push(R)},w=mI(t,r);return o.forEach(function(S){var M,R,I,P;if(!(!S||Dr(S))){var k=d?d(S,n):Oht(S,n),z=cZ(S,t,i?null:k),G=cZ(S,r,i?k:null);try{for(var J=Kf(z),Z=J.next();!Z.done;Z=J.next()){var X=Z.value;try{for(var et=(I=void 0,Kf(G)),at=et.next();!at.done;at=et.next()){var wt=at.value,Tt=yI({rowDimensionValues:X,colDimensionValues:wt,rowPivotMeta:c,colPivotMeta:f,rowFields:t,colFields:r,isFirstCreate:!0,onFirstCreate:x,prefix:w});v.push(Tt),mS(l,Tt,S)}}catch(vt){I={error:vt}}finally{try{at&&!at.done&&(P=et.return)&&P.call(et)}finally{if(I)throw I.error}}}}catch(vt){M={error:vt}}finally{try{Z&&!Z.done&&(R=J.return)&&R.call(J)}finally{if(M)throw M.error}}}}),{paths:v,indexesData:l,rowPivotMeta:c,colPivotMeta:f,sortedDimensionValues:u}}function hZ(e,t){if(!(!e||!t)){var r=t.split(Bu),n=no(r),i=e;bi(r,function(a,o){var s=i.get(a);return s?(a===n?(s.children=new Map,s.childField=void 0):i=s.children,!0):o===0&&a===Rlt})}}function LMe(e,t,r){var n=function(o){var s=Hu(e,function(l){var u=l.field;return u===o});return ai(s,"name",o)},i=t||r,a={field:Fi,name:i,formatter:function(o){return n(o)}};return a}function gC(e,t){return{isRowTotal:e.isGrandTotals,isRowSubTotal:e.isSubTotals,isColTotal:t.isGrandTotals,isColSubTotal:t.isSubTotals}}function OMe(e){for(var t=null,r=0;r<e.length;r++){var n=e[r];if(bS(n))t=r;else if(!Mct(t)&&t<r)return!0}return!1}function Pht(e){var t=e.pivotMeta,r=e.dimensionValues,n=e.fieldIdx,i=e.queryType,a=e.fields,o=e.sortedDimensionValues,s={children:t},l=[s];function u(d,v){var g,x=R2(d,function(M){var R,I,P=[];try{for(var k=Kf(M.children.values()),z=k.next();!z.done;z=k.next()){var G=z.value;G.value!==g6&&(i===$f.All||G.value!==av)&&P.push(G)}}catch(J){R={error:J}}finally{try{z&&!z.done&&(I=k.return)&&I.call(k)}finally{if(R)throw R.error}}return P});if(d.length>1){var w=(g=o[v])!==null&&g!==void 0?g:[],S=new Map(w.map(function(M,R){return[M,R]}));return x.sort(function(M,R){return S.get(M.id)-S.get(R.id)}),x}return x}for(var c=function(d){var v=r[d],g=a[d];bS(v)?l=u(l,g):l=l.map(function(x){return x.children.get(v)}).filter(Boolean)},f=0;f<=n;f++)c(f);return l}function fZ(e){var t=e.dimensionValues,r=e.pivotMeta,n=e.fields,i=e.sortedDimensionValues,a=e.queryType,o=a===void 0?$f.All:a;if(!OMe(t))return[t];var s=Pht({pivotMeta:r,dimensionValues:t,fieldIdx:t.length-1,queryType:o,fields:n,sortedDimensionValues:i});return s.map(function(l){return l.dimensions})}function PMe(e){var t=e.rowFields,r=e.rowDimensionValues,n=e.rowPivotMeta,i=e.colFields,a=e.colDimensionValues,o=e.colPivotMeta,s=e.queryType,l=e.sortedDimensionValues,u=fZ({dimensionValues:r,pivotMeta:n,fields:t,sortedDimensionValues:l,queryType:s}),c=fZ({dimensionValues:a,pivotMeta:o,fields:i,sortedDimensionValues:l,queryType:s});return{rowQueries:u,colQueries:c}}function DMe(e,t){return e?Xn(e)?R2(e,function(r){if(!Xn(r))return Xd([r]);var n=t===$f.DetailOnly?1:0;return Xd(r.slice(n))}):Xd([e]):[]}var YA;function dZ(e,t){return!e||!t?!1:String(e).toLowerCase()===String(t).toLowerCase()}var FMe=`\r
`,BMe="	",_I=function(e,t){var r=e.getColumnNodes().find(function(n){return n.id===t});return e.isPivotMode()?r==null?void 0:r.value:r==null?void 0:r.field},NMe=function(e,t){var r=t.getColumnNodes().find(function(n){return n.colIndex===e});return _I(t,r.id)},kMe=function(e,t){var r=e.rowIndex,n=e.colIndex;return[t.getRowNodes().find(function(i){return i.rowIndex===r}),t.getColumnNodes().find(function(i){return i.colIndex===n})]},ES=function(e,t){var r=t.getColumnNodes().find(function(i){return i.colIndex===e}),n=_I(t,r.id);return t.options.interaction.copyWithFormat?t.dataSet.getFieldFormatter(n):function(i){return i}},zMe=function(e){var t,r,n,i,a=((i=(n=(r=e.options)===null||r===void 0?void 0:r.style)===null||n===void 0?void 0:n.colCfg)===null||i===void 0?void 0:i.hideMeasureColumn)&&e.isValueInCols();return a?(t={},t[Fi]=e.dataCfg.fields.values[0],t):{}},UMe=function(e,t,r){var n,i;if(r.isPivotMode()){var a=ur(kMe(e,r),2),o=a[0],s=a[1],l=zMe(r),u=r.dataSet.getCellData({query:qt(qt(qt({},o.query),s.query),l),rowNode:o,isTotals:o.isTotals||o.isTotalMeasure||s.isTotals||s.isTotalMeasure,totalStatus:gC(o,s)});return(n=u==null?void 0:u[Zc])!==null&&n!==void 0?n:""}var c=NMe(e.colIndex,r);return(i=t[e.rowIndex])===null||i===void 0?void 0:i[c]},Dht=function(e,t,r){var n=ES(e.colIndex,r);return n(UMe(e,t,r))},A8=function(e){return/\n/.test(e)?'"'+e.replace(/\r\n?/g,`
`)+'"':e},wS=function(e,t){var r=e.split(Bu);return t?r.slice(r.length-t):(r.shift(),r)},m5=function(e,t){return oa(e,function(r){return t.dataSet.getFieldName(r)})},is;(function(e){e.PLAIN="text/plain",e.HTML="text/html"})(is||(is={}));var $Me=function(e){return{type:is.PLAIN,content:oa(e,function(t){return t.join(BMe)}).join(FMe)}},HMe=function(e){function t(n,i){return n.map(function(a){return"<".concat(i,">").concat(j6(a),"</").concat(i,">")}).join("")}function r(n,i){return n.map(function(a){return"<".concat(i,">").concat(t(a,"td"),"</").concat(i,">")}).join("")}return{type:is.HTML,content:'<meta charset="utf-8"><table><tbody>'.concat(r(e,"tr"),"</tbody></table>")}},VMe=(YA={},YA[is.PLAIN]=$Me,YA[is.HTML]=HMe,YA);function oh(e){return VMe[e]}function GMe(e,t){return t===void 0&&(t=is.PLAIN),Array.isArray(t)?[].concat(e).filter(function(r){return t.includes(r.type)}).map(function(r){return r.content}):[].concat(e).filter(function(r){return(r==null?void 0:r.type)===t}).map(function(r){return r.content})[0]||""}var Fht=function(e,t,r){var n,i,a,o,s,l,u=(i=(n=e[0])===null||n===void 0?void 0:n.length)!==null&&i!==void 0?i:0,c=(a=t==null?void 0:t.length)!==null&&a!==void 0?a:0,f=(s=(o=r[0])===null||o===void 0?void 0:o.length)!==null&&s!==void 0?s:0,d=(l=r.length)!==null&&l!==void 0?l:0,v=u+f,g=c+d,x=Array.from(Array(g),function(){return new Array(v)});return x=oa(x,function(w,S){return oa(w,function(M,R){if(R>=0&&R<u&&S>=0&&S<c)return"";if(R>=u&&R<=v&&S>=0&&S<c)return t[S][R-u];if(R>=0&&R<u&&S>=c&&S<g)return e[S-c][R];if(R>=u&&R<=v&&S>=c&&S<g)return r[S-c][R-u]})}),[oh(is.PLAIN)(x),oh(is.HTML)(x)]},WMe=function(e,t,r){var n=t.map(function(i){return i.map(function(a){return a?A8(Dht(a,e,r)):""})});return[oh(is.PLAIN)(n),oh(is.HTML)(n)]},XMe=function(e){if(!(e!=null&&e.length))return[];var t=ur([{row:1/0,col:1/0},{row:0,col:0}],2),r=t[0],n=t[1];e.forEach(function(l){var u=l.rowIndex,c=l.colIndex;r.col=Math.min(c,r.col),r.row=Math.min(u,r.row),n.col=Math.max(c,n.col),n.row=Math.max(u,n.row)});var i=ur([n.row-r.row+1,n.col-r.col+1],2),a=i[0],o=i[1],s=new Array(a).fill("").map(function(){return new Array(o).fill("")});return e.forEach(function(l){var u=l.rowIndex,c=l.colIndex,f=ur([u-r.row,c-r.col],2),d=f[0],v=f[1];s[d][v]=l}),s},jMe=function(e,t){var r=e.dataSet.getDisplayDataSet(),n=t.length?t.map(function(a){return{field:_I(e,a.id),formatter:ES(a.colIndex,e)}}):e.dataCfg.fields.columns.map(function(a){return e.getColumnNodes().find(function(o){return o.field===a})}).map(function(a){return{field:_I(e,a.id),formatter:ES(a.colIndex,e)}}),i=r.map(function(a){return n.map(function(o){var s=o.field,l=o.formatter;return A8(l(a[s]))})});return[oh(is.PLAIN)(i),oh(is.HTML)(i)]},Bht=function(e,t,r){return oa(e,function(n){return t.map(function(i){var a,o=r.dataSet.getCellData({query:qt(qt({},n.query),i.query),rowNode:n,isTotals:n.isTotals||n.isTotalMeasure||i.isTotals||i.isTotalMeasure,totalStatus:gC(n,i)});return ES(i.colIndex,r)((a=o==null?void 0:o[Zc])!==null&&a!==void 0?a:"")})})},YMe=function(e,t,r){var n=Bht(t,r,e);return[oh(is.PLAIN)(n),oh(is.HTML)(n)]},ZMe=function(e,t,r){var n=oa(t,function(o){return wS(o.id)}),i=_L.apply(void 0,Gr([],ur(oa(r,function(o){return wS(o.id)})),!1)),a=Bht(t,r,e);return Fht(n,i,a)};function Nht(e,t,r){var n=e.options.interaction.copyWithHeader;return n?ZMe(e,t,r):YMe(e,t,r)}var qMe=function(e,t){var r=e.getRowNodes().filter(function(a){return a.isLeaf||e.isHierarchyTreeType()}),n=e.getColumnNodes().filter(function(a){return a.isLeaf}),i=t.length?t.reduce(function(a,o){return a.push.apply(a,Gr([],ur(n.filter(function(s){return s.id.startsWith(o.id)})),!1)),a},[]):n;return Nht(e,r,i)},pZ=function(e,t,r){return t.isPivotMode()?qMe(t,r):jMe(t,r)},KMe=function(e,t){var r=e.dataSet.getDisplayDataSet(),n=r.filter(function(i,a){return t.map(function(o){return o.rowIndex}).includes(a)}).map(function(i){var a=e.getColumnNodes().reduce(function(o,s,l){return o[s.field]=l,o},{});return Object.keys(i).sort(function(o,s){return a[o]-a[s]}).map(function(o){return e.getColumnNodes().find(function(s){return s.field===o})}).filter(Boolean).map(function(o){return A8(ES(o.colIndex,e)(i[o.field]))})});return[oh(is.PLAIN)(n),oh(is.HTML)(n)]},QMe=function(e,t){var r=e.getRowNodes().filter(function(a){return a.isLeaf||e.isHierarchyTreeType()}),n=e.getColumnNodes().filter(function(a){return a.isLeaf}),i=t.reduce(function(a,o){return a.push.apply(a,Gr([],ur(r.filter(function(s){return s.id.startsWith(o.id)})),!1)),a},[]);return Nht(e,i,n)},JMe=function(e,t,r){return t.isPivotMode()?QMe(t,r):KMe(t,r)},tRe=function(e,t,r){var n=_L.apply(void 0,Gr([],ur(oa(e[0],function(o){var s,l=(o==null?void 0:o.colId)||no((s=o==null?void 0:o.id)===null||s===void 0?void 0:s.split(VB))||"";return m5(wS(l),r)})),!1)),i=oa(e,function(o){var s,l,u,c=((s=o==null?void 0:o[0])===null||s===void 0?void 0:s.rowId)||w_((u=(l=o==null?void 0:o[0])===null||l===void 0?void 0:l.id)===null||u===void 0?void 0:u.split(VB))||"";return m5(wS(c),r)}),a=oa(e,function(o){return oa(o,function(s){return Dht(s,t,r)})});return Fht(i,n,a)};function eRe(e){var t=new Set;return bi(e,function(r){var n=r.getMeta().level;t.has(n)||t.add(n)}),t}function rRe(e,t){return Fg(e,function(r){var n=r.getMeta(),i=n.level===t,a=n.isTotals&&Dr(n.children);return i||a})}function nRe(e,t){for(var r=e,n={level:t},i=r.label;r.level>=0;){for(var a=n.level-r.level;a>0;)i="".concat(r.label).concat(Bu).concat(i),a--;n=r,r=r.parent}return i}function iRe(e,t,r){return oa(e,function(n){var i=n.getMeta(),a=i.id,o=i.isTotals,s=i.spreadsheet,l=o?nRe(i,t):a,u=wS(l,r.size);return m5(u,s)})}function aRe(e){var t,r=eRe(e),n=(t=bb(Array.from(r)))!==null&&t!==void 0?t:0,i=rRe(e,n),a=e[0].cellType===kr.COL_CELL,o=iRe(i,n,r);return a&&(o=_L.apply(void 0,Gr([],ur(o),!1))),[oh(is.PLAIN)(o),oh(is.HTML)(o)]}var oRe=function(e,t,r){return oa(t,function(n){var i;return(i=e[n])!==null&&i!==void 0?i:r})},sRe=function(e,t){var r=e.options.placeholder,n=e.dataCfg.fields,i=n.rows,a=n.columns,o=n.values,s=j_(e,r),l=e.getColumnLeafNodes(),u=[];if(e.isTableMode()){var c=Fg(l,function(g){return g.field!==m_});u=oa(t,function(g){return oa(c,function(x){var w;return(w=g==null?void 0:g[x.field])!==null&&w!==void 0?w:s})})}else if(e.isPivotMode()){var f=Gr(Gr(Gr([],ur(i),!1),ur(a),!1),ur(o),!1),d=TMe(t),v=d.filter(function(g){return Gr(Gr([],ur(i),!1),ur(a),!1).every(function(x){return!Sl(g[x])})});u=gL(v,function(g,x){return Gr(Gr([],ur(g),!1),[oRe(x,f,s)],!1)},[])}return[oh(is.PLAIN)(u),oh(is.HTML)(u)]};function lRe(e,t){var r,n,i=t.filter(function(c){var f=c.type;return f===kr.COL_CELL}),a=t.filter(function(c){var f=c.type;return f===kr.ROW_CELL}),o=e.dataSet.getDisplayDataSet();if(e.interaction.getCurrentStateName()===Dn.ALL_SELECTED)n=pZ(o,e,[]);else if(i.length)n=pZ(o,e,i);else if(a.length)n=JMe(o,e,a);else{if(!t.length)return;var s=XMe(t),l=e.interaction.getSelectedCellHighlight().currentRow;if(l){var u=s8(t,"rowIndex","asc").map(function(c){return e.dataSet.getRowData(c)});n=sRe(e,u)}else!((r=e.options.interaction)===null||r===void 0)&&r.copyWithHeader?n=tRe(s,o,e):n=WMe(o,s,e)}return n}var uRe=function(e){var t,r=e.interaction,n=r.getState().cells||[],i,a=(t=r.getInteractedCells())!==null&&t!==void 0?t:[],o=Dr(a)?!1:uL(a,function(s){return s.cellType===kr.ROW_CELL||s.cellType===kr.COL_CELL});return o?i=aRe(a):i=lRe(e,n),i&&hRe(i),GMe(i,is.PLAIN)},kht=function(e){return new Promise(function(t,r){var n;Array.isArray(e)?n=ai(e.filter(function(o){return o.type===is.PLAIN}),"[0].content",""):n=e.content||"";var i=document.createElement("textarea");i.value=n,document.body.appendChild(i),i.focus({preventScroll:!0}),i.select();var a=document.execCommand("copy");document.body.removeChild(i),a?t():r()})},cRe=function(e){return navigator.clipboard.write([new ClipboardItem([].concat(e).reduce(function(t,r){var n,i=r.type,a=r.content,o=a.replace(/\x00/g,"");return qt(qt({},t),(n={},n[i]=new Blob([o],{type:i}),n))},{}))]).catch(function(){return kht(e)})},hRe=function(e,t){t===void 0&&(t=!1);var r;return typeof e=="string"?r={content:e,type:is.PLAIN}:r=e,!navigator.clipboard||!window.ClipboardItem||t?kht(r):cRe(r)},M8=function(e,t,r){var n,i=e.split(Bu);if(r)n=[e];else{n=[xS(i[0],i[1])];for(var a=2;a<i.length;a+=1)n.push(xS(n[a-2],i[a]))}var o=Fg(t,function(s){var l;return n.includes((l=s.getMeta())===null||l===void 0?void 0:l.id)});return o},zht=function(e,t,r){if(e){var n=M8(e,t);bi(n,function(i){i.updateByState(r)})}},fRe=function(e,t){return typeof e=="function"?e(t):e.some(function(r){return r===t.key||r===t.id||r===t.valueField})},Np=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=function(i,a){if(Xn(i)&&Xn(a))return a},n=Gr(Gr([],ur(e),!1),[r],!1);return G6.apply(void 0,Gr([{}],ur(n),!1))},dRe=function(e){var t=["rows","columns","values"],r=t.reduce(function(n,i){var a=e[i],o=ig(a);return pu(o,a)||console.warn("fields.".concat(i,":[").concat(a,"] should be unique")),n[i]=o,n},{});return qt(qt({},e),r)},nD=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Np.apply(void 0,Gr([dde],ur(e),!1));return r.fields=dRe(r.fields),(!Dr(r.fields.customTreeItems)||Dr(r.fields.values))&&(r.fields.valueInCols=!1),r},vZ=function(e){return Np(_de,e)},wL=function(e){nn(t,e);function t(r,n){for(var i=[],a=2;a<arguments.length;a++)i[a-2]=arguments[a];var o=e.call(this,{})||this;return o.textShapes=[],o.actualTextWidth=0,o.conditionIconShapes=[],o.stateShapes=new Map,o.meta=r,o.spreadsheet=n,o.theme=n.theme,o.conditions=o.spreadsheet.options.conditions,o.handleRestOptions.apply(o,Gr([],ur(i),!1)),o.shouldInit()&&o.initCell(),o}return t.prototype.getMeta=function(){return this.meta},t.prototype.setMeta=function(r){this.meta=Np(this.meta,r)},t.prototype.getIconStyle=function(){return this.theme[this.cellType].icon},t.prototype.getTextAndIconPosition=function(r){r===void 0&&(r=1);var n=this.getTextStyle(),i=this.getIconStyle();return F2(this.getContentArea(),n,this.actualTextWidth,i,r)},t.prototype.getActualText=function(){return this.actualText},t.prototype.isTextOverflowing=function(){var r=this.getActualText();return r?lc(r,Dx):r!==this.getFieldValue()},t.prototype.getFieldValue=function(){var r=this.getFormattedFieldValue().formattedValue;return r===$_?this.getActualText():r},t.prototype.handleRestOptions=function(){},t.prototype.shouldInit=function(){var r=this.meta,n=r.width,i=r.height;return n>0&&i>0},t.prototype.getStyle=function(r){return ai(this.theme,r||this.cellType)},t.prototype.getResizeAreaStyle=function(){return this.getStyle("resizeArea")},t.prototype.shouldDrawResizeAreaByType=function(r,n){var i=this.spreadsheet.options.interaction.resize;return Gp(i)?i:mu(i.visible)?i.visible(n):i[r]},t.prototype.getCellArea=function(){var r=this.meta,n=r.x,i=r.y,a=r.height,o=r.width;return{x:n,y:i,height:a,width:o}},t.prototype.getContentArea=function(){var r=this.getStyle()||this.theme.dataCell,n=(r==null?void 0:r.cell).padding;return Iht(this.getCellArea(),n)},t.prototype.getIconPosition=function(r){return r===void 0&&(r=1),this.getTextAndIconPosition(r).icon},t.prototype.drawTextShape=function(){var r=this.getFormattedFieldValue().formattedValue,n=this.getMaxTextWidth(),i=this.getTextStyle(),a=this.spreadsheet,o=a.options.placeholder,s=a.measureTextWidth,l=j_(this,o),u=Cb({measureTextWidth:s,text:r,maxWidth:n,fontParam:i,placeholder:l});this.actualText=u,this.actualTextWidth=s(u,i);var c=this.getTextPosition();this.textShape=C_(this,[this.textShape],c.x,c.y,u,i),this.textShapes.push(this.textShape)},t.prototype.drawLinkFieldShape=function(r,n){if(r){var i=this.spreadsheet.options.style.device;if(!Ul(i)){var a=this.getTextStyle(),o=this.getTextPosition(),s=o.x;a.textAlign==="center"?s-=this.actualTextWidth/2:a.textAlign==="right"&&(s-=this.actualTextWidth);var l=this.textShape.getBBox().maxY;this.linkFieldShape=hu(this,{x1:s,y1:l+1,x2:s+this.actualTextWidth,y2:l+1},{stroke:n,lineWidth:1})}this.textShape.attr({fill:n,cursor:"pointer",appendInfo:{isLinkFieldText:!0,cellData:this.meta}})}},t.prototype.getLinkFieldStyle=function(){return this.getTextStyle().linkTextFill},t.prototype.drawLinkField=function(r){var n=this.spreadsheet.options.interaction.linkFields,i=n===void 0?[]:n,a=this.getLinkFieldStyle(),o=fRe(i,r);this.drawLinkFieldShape(o,a)},t.prototype.updateByState=function(r,n){var i=this;this.spreadsheet.interaction.setInteractedCells(n);var a=ai(this.theme,"".concat(this.cellType,".cell.interactionState.").concat(r));bi(a,function(o,s){var l=Es(o8(pde,function(u){return lc(u,s)}));l.forEach(function(u){var c=i.stateShapes.has(u),f=c?i.stateShapes.get(u):i[u],d=Xn(f)?f:[f];if(c&&d.forEach(function(g){g.set("visible",!0)}),u==="interactiveBorderShape"&&s==="borderWidth"&&ac(o)){var v=i.getInteractiveBorderShapeStyle(o);bi(v,function(g,x){Pf(d,x,g)})}Pf(d,Fh[s],o)})})},t.prototype.getInteractiveBorderShapeStyle=function(r){var n=this.getCellArea(),i=n.x,a=n.y,o=n.height,s=n.width,l=this.theme.dataCell.cell,u=l.horizontalBorderWidth,c=l.verticalBorderWidth;return{x:i+c/2+r/2,y:a+u/2+r/2,width:s-c-r,height:o-u-r}},t.prototype.hideInteractionShape=function(){this.stateShapes.forEach(function(r){Pf(r,Fh.backgroundOpacity,0),Pf(r,Fh.backgroundColor,"transparent"),Pf(r,Fh.borderOpacity,0),Pf(r,Fh.borderWidth,1),Pf(r,Fh.borderColor,"transparent")})},t.prototype.clearUnselectedState=function(){Pf(this.backgroundShape,Fh.backgroundOpacity,1),Pf(this.textShapes,Fh.textOpacity,1),Pf(this.linkFieldShape,Fh.opacity,1)},t.prototype.getTextShape=function(){return this.textShape},t.prototype.getTextShapes=function(){return this.textShapes||[this.textShape]},t.prototype.addTextShape=function(r){r&&this.textShapes.push(r)},t.prototype.getConditionIconShape=function(){return this.conditionIconShape},t.prototype.getConditionIconShapes=function(){return this.conditionIconShapes||[this.conditionIconShape]},t.prototype.addConditionIconShape=function(r){r&&this.conditionIconShapes.push(r)},t.prototype.resetTextAndConditionIconShapes=function(){this.textShapes=[],this.conditionIconShapes=[]},Object.defineProperty(t.prototype,"cellConditions",{get:function(){return this.conditions},enumerable:!1,configurable:!0}),t.prototype.drawConditionIconShapes=function(){var r,n=this.findFieldCondition((r=this.conditions)===null||r===void 0?void 0:r.icon);if(n&&n.mapping){var i=this.mappingValue(n),a=this.getIconPosition(),o=this.theme.dataCell.icon.size;Dr(i==null?void 0:i.icon)||(this.conditionIconShape=T8(this,qt(qt({},a),{name:i.icon,width:o,height:o,fill:i.fill})),this.addConditionIconShape(this.conditionIconShape))}},t.prototype.getTextConditionFill=function(r){var n,i,a=r.fill,o=this.findFieldCondition((n=this.conditions)===null||n===void 0?void 0:n.text);return o!=null&&o.mapping&&(a=((i=this.mappingValue(o))===null||i===void 0?void 0:i.fill)||r.fill),a},t.prototype.getCrossBackgroundColor=function(r){var n=this.getStyle().cell,i=n.crossBackgroundColor,a=n.backgroundColorOpacity;return i&&r%2===0?{backgroundColorOpacity:a,backgroundColor:i}:{backgroundColorOpacity:a,backgroundColor:this.getStyle().cell.backgroundColor}},t}(hv),Uht=function(e,t){return t?t(e[Fi],e[Zc]):e[Zc]},zy=function(e,t){var r=t.getMeta().id;return e.some(function(n){return pu(n.id,r)})},B2=function(e,t){return"".concat(e).concat(VB).concat(t)},pRe=function(e){var t=e.interaction.getSelectedCellHighlight(),r=t.currentRow,n=t.currentCol,i=t.rowHeader,a=t.colHeader;return r||n||i||a},R8=function(e){return e.type===kr.DATA_CELL},vRe=function(e,t){bi(e,function(r){R8(r)&&r.rowIndex===t.getMeta().rowIndex&&t.updateByState(Dn.SELECTED)})},gRe=function(e,t){bi(e,function(r){R8(r)&&r.colIndex===t.getMeta().colIndex&&t.updateByState(Dn.SELECTED)})},mRe=function(e,t){bi(e,function(r){R8(r)&&r.rowIndex===t.getMeta().rowIndex&&r.colIndex===t.getMeta().colIndex&&t.updateByState(Dn.SELECTED)})},yRe=function(e,t,r){var n=r.interaction.getSelectedCellHighlight(),i=n.rowHeader,a=n.colHeader,o=n.currentRow,s=n.currentCol,l=t.cellType===kr.ROW_CELL,u=r.isTableMode()&&r.options.showSeriesNumber&&i&&l;(o||u)&&vRe(e,t),s&&gRe(e,t),(i||a)&&mRe(e,t)},L0=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"cellType",{get:function(){return kr.DATA_CELL},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"valueRangeByField",{get:function(){return this.spreadsheet.dataSet.getValueRangeByField(this.meta.valueField)},enumerable:!1,configurable:!0}),t.prototype.handleByStateName=function(r,n){zy(r,this)&&this.updateByState(n)},t.prototype.handleSearchResult=function(r){if(zy(r,this)){var n=Hu(r,function(i){return i==null?void 0:i.isTarget});n.id===this.getMeta().id?this.updateByState(Dn.HIGHLIGHT):this.updateByState(Dn.SEARCH_RESULT)}},t.prototype.handleSelect=function(r){var n,i=(n=r==null?void 0:r[0])===null||n===void 0?void 0:n.type;switch(i){case kr.COL_CELL:this.changeRowColSelectState("colIndex");break;case kr.ROW_CELL:this.changeRowColSelectState("rowIndex");break;case kr.DATA_CELL:pRe(this.spreadsheet)?yRe(r,this,this.spreadsheet):zy(r,this)?this.updateByState(Dn.SELECTED):this.spreadsheet.options.interaction.selectedCellsSpotlight&&this.updateByState(Dn.UNSELECTED);break}},t.prototype.handleHover=function(r){var n=w_(r);if(n.type!==kr.DATA_CELL){this.hideInteractionShape();return}var i=this.spreadsheet.interaction.getHoverHighlight(),a=i.currentRow,o=i.currentCol;if(a||o){var s=this.meta.colIndex,l=this.meta.rowIndex;o&&s===(n==null?void 0:n.colIndex)||a&&l===(n==null?void 0:n.rowIndex)?this.updateByState(Dn.HOVER):this.hideInteractionShape()}var u=this.getMeta(),c=u.id,f=u.rowIndex,d=u.colIndex;pu(n.id,c)&&pu(n.rowIndex,f)&&pu(n.colIndex,d)&&this.updateByState(Dn.HOVER_FOCUS)},t.prototype.update=function(){var r=this.spreadsheet.interaction.getCurrentStateName(),n=this.spreadsheet.interaction.getCells();if(r===Dn.ALL_SELECTED){this.updateByState(Dn.SELECTED);return}if(!(Dr(n)||!r))switch(r){case Dn.SELECTED:this.handleSelect(n);break;case Dn.HOVER_FOCUS:case Dn.HOVER:this.handleHover(n);break;case Dn.SEARCH_RESULT:this.handleSearchResult(n);break;default:this.handleByStateName(n,r);break}},t.prototype.setMeta=function(r){e.prototype.setMeta.call(this,r),this.initCell()},t.prototype.drawTextShape=function(){e.prototype.drawTextShape.call(this),this.drawLinkField(this.meta)},t.prototype.initCell=function(){this.resetTextAndConditionIconShapes(),this.drawBackgroundShape(),this.drawInteractiveBgShape(),this.shouldHideRowSubtotalData()||(this.drawConditionIntervalShape(),this.drawTextShape(),this.drawConditionIconShapes()),this.drawInteractiveBorderShape(),this.meta.isFrozenCorner&&this.drawBorderShape(),this.update()},t.prototype.getDefaultTextFill=function(r){var n=r.fill,i=this.getBackgroundColor(),a=i.backgroundColor,o=i.intelligentReverseTextColor;return pht(a)&&(n===Llt||!VTe(a,n))&&o&&(n=GB),n},t.prototype.getTextStyle=function(){var r=this.meta.isTotals,n=r?this.theme.dataCell.bolderText:this.theme.dataCell.text,i=this.getTextConditionFill(qt(qt({},n),{fill:this.getDefaultTextFill(n)}));return qt(qt({},n),{fill:i})},t.prototype.getIconStyle=function(){return Tht(this.conditions,this.theme.dataCell.icon,this.meta.valueField)},t.prototype.drawConditionIntervalShape=function(){this.conditionIntervalShape=hMe(this)},t.prototype.shouldHideRowSubtotalData=function(){var r,n=this.meta,i=n.rowId,a=n.rowIndex,o=this.spreadsheet.store.get("drillDownIdPathMap");if(o!=null&&o.has(i))return!1;var s=((r=this.spreadsheet.options.totals)!==null&&r!==void 0?r:{}).row,l=s===void 0?{}:s,u=this.spreadsheet.facet.layoutResult.rowLeafNodes[a],c=!(u!=null&&u.isGrandTotals)&&(u==null?void 0:u.isTotals);return this.spreadsheet.options.hierarchyType==="tree"&&!l.showSubTotals&&c},t.prototype.getFormattedFieldValue=function(){var r;if(this.shouldHideRowSubtotalData())return{value:null,formattedValue:Y3};var n=this.meta,i=n.rowId,a=n.valueField,o=n.fieldValue,s=n.data,l=n.id,u=(r=this.spreadsheet.dataSet.displayFormattedValueMap)===null||r===void 0?void 0:r.get(l),c=this.spreadsheet.dataSet.getFieldMeta(i),f=c?i:a,d=this.spreadsheet.dataSet.getFieldFormatter(f),v=u??d(o,s,this.meta);return{value:o,formattedValue:v}},t.prototype.getMaxTextWidth=function(){var r=this.getContentArea().width,n=this.getIconStyle();return Lht(r,n)},t.prototype.getTextPosition=function(){return this.getTextAndIconPosition().text},t.prototype.getBackgroundColor=function(){var r,n=this.getCrossBackgroundColor(this.meta.rowIndex),i=n.backgroundColor,a=n.backgroundColorOpacity;if(this.shouldHideRowSubtotalData())return{backgroundColor:i,backgroundColorOpacity:a};var o=this.findFieldCondition((r=this.conditions)===null||r===void 0?void 0:r.background),s=!1;if(o&&o.mapping){var l=this.mappingValue(o);l&&(i=l.fill,s=l.intelligentReverseTextColor,a=1)}return{backgroundColor:i,backgroundColorOpacity:a,intelligentReverseTextColor:s}},t.prototype.drawBackgroundShape=function(){var r=this.getBackgroundColor(),n=r.backgroundColor,i=r.backgroundColorOpacity;this.backgroundShape=Vh(this,qt(qt({},this.getCellArea()),{fill:n,fillOpacity:i}))},t.prototype.drawInteractiveBorderShape=function(){var r=1,n=this.getCellArea(),i=n.x,a=n.y,o=n.height,s=n.width;this.stateShapes.set("interactiveBorderShape",Vh(this,{x:i+r,y:a+r,width:s-r*2,height:o-r*2},{capture:!1,visible:!1}))},t.prototype.drawInteractiveBgShape=function(){this.stateShapes.set("interactiveBgShape",Vh(this,qt({},this.getCellArea()),{visible:!1}))},t.prototype.changeRowColSelectState=function(r){var n=this.spreadsheet.interaction,i=ai(this.meta,r),a=n.getState(),o=a.nodes,s=o===void 0?[]:o,l=a.cells,u=l===void 0?[]:l,c=!1;if(this.spreadsheet.isTableMode()&&s.length){var f=s[0].hierarchy.getLeaves();c=f.some(function(d,v){return s.some(function(g){return g===d})?v===i:!1})}else c=Gr(Gr([],ur(s),!1),ur(u),!1).some(function(d){return ai(d,r)===i});c?this.updateByState(Dn.SELECTED):this.spreadsheet.options.interaction.selectedCellsSpotlight?this.updateByState(Dn.UNSELECTED):this.hideInteractionShape()},t.prototype.drawBorderShape=function(){var r=this;[yl.BOTTOM,yl.RIGHT].forEach(function(n){var i=S_(n,r.getCellArea(),r.getStyle().cell),a=i.position,o=i.style;hu(r,a,o)})},t.prototype.findFieldCondition=function(r){return Sht(r,this.meta.valueField)},t.prototype.mappingValue=function(r){var n=this.meta.fieldValue,i=this.spreadsheet.isTableMode()?this.spreadsheet.dataSet.getCellData({query:{rowIndex:this.meta.rowIndex}}):this.meta.data;return r==null?void 0:r.mapping(n,i)},t.prototype.updateByState=function(r){if(e.prototype.updateByState.call(this,r,this),r===Dn.UNSELECTED){var n=ai(this.theme,"".concat(this.cellType,".cell.interactionState.").concat(r));n&&this.toggleConditionIntervalShapeOpacity(n.opacity)}},t.prototype.clearUnselectedState=function(){e.prototype.clearUnselectedState.call(this),this.toggleConditionIntervalShapeOpacity(1)},t.prototype.toggleConditionIntervalShapeOpacity=function(r){Pf(this.conditionIntervalShape,Fh.backgroundOpacity,r),Pf(this.conditionIconShapes,Fh.opacity,r)},t.prototype.drawLeftBorder=function(){var r=S_(yl.LEFT,this.getCellArea(),this.getStyle().cell),n=r.position,i=r.style;hu(this,n,i)},t}(wL),_Re=function(e){nn(t,e);function t(r,n,i){return e.call(this,i,r,n)||this}return t.prototype.handleRestOptions=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=ur(r,1),a=i[0];this.cells=a},Object.defineProperty(t.prototype,"cellType",{get:function(){return kr.MERGED_CELL},enumerable:!1,configurable:!0}),t.prototype.update=function(){},t.prototype.initCell=function(){this.resetTextAndConditionIconShapes(),this.conditions=this.spreadsheet.options.conditions,this.drawBackgroundShape(),this.drawTextShape()},t.prototype.drawBackgroundShape=function(){var r=wRe(this.cells),n=this.theme.dataCell.cell;this.backgroundShape=nMe(this,{points:r,stroke:n.horizontalBorderColor,fill:n.backgroundColor,lineHeight:n.horizontalBorderWidth})},t.prototype.drawTextShape=function(){Dr(this.meta)||(ro(this.meta.fieldValue)?EMe(this):e.prototype.drawTextShape.call(this))},t}(L0),xRe=function(e,t,r,n){var i=[e,t],a=[e+r,t],o=[e+r,t+n],s=[e,t+n];return[[i,a],[a,o],[o,s],[s,i]]},bRe=function(e){var t=[];return bi(e,function(r){var n=[r[1],r[0]];JSON.stringify(e).includes(JSON.stringify(n))||t.push(r)}),t},ERe=function(e,t){return Hu(t,function(r){return pu(r[0],e[1])})},wRe=function(e){var t=[];e.forEach(function(o){var s=o.getMeta(),l=s.x,u=s.y,c=s.width,f=s.height;t=t.concat(xRe(l,u,c,f))}),t=bRe(t);for(var r=[],n=t[0],i=n,a=[];!pu(n,a);)r=r.concat(i),a=ERe(i,t),i=a;return r},CRe=function(e,t){var r=[],n;return bi(e,function(i){var a,o,s,l=(o=(a=t==null?void 0:t.facet)===null||a===void 0?void 0:a.layoutResult)===null||o===void 0?void 0:o.getCellMeta(i.rowIndex,i.colIndex);if(l){var u=(s=t==null?void 0:t.facet)===null||s===void 0?void 0:s.cfg.dataCell(l);n=i!=null&&i.showText?l:n,r.push(u)}}),{cells:r,cellsMeta:n}},SRe=function(e,t){var r=[],n=[],i;return bi(e,function(a){var o=Hu(t,function(s){var l,u=(l=s==null?void 0:s.getMeta)===null||l===void 0?void 0:l.call(s);if((u==null?void 0:u.colIndex)===(a==null?void 0:a.colIndex)&&(u==null?void 0:u.rowIndex)===(a==null?void 0:a.rowIndex))return s});o?(r.push(o),i=a!=null&&a.showText?o==null?void 0:o.getMeta():i):n.push(a)}),{cells:r,invisibleCellInfo:n,cellsMeta:i}},$ht=function(e,t,r){var n;r===void 0&&(r=[]);var i=SRe(r,e),a=i.cellsMeta,o=i.cells,s=i.invisibleCellInfo,l=a,u=o,c=(s==null?void 0:s.length)>0&&s.length<r.length;if(c){var f=CRe(s,t),d=f.cells,v=f.cellsMeta;l=l||v,u=o.concat(d)}return!Dr(o)&&!l&&(l=(n=u[0])===null||n===void 0?void 0:n.getMeta()),{cells:u,viewMeta:l}},TRe=function(e){var t=e.interaction,r=t.getActiveCells(),n=[];return bi(r,function(i,a){var o=i.getMeta(),s=a===0?{showText:!0}:{};n.push(qt(qt({},s),{colIndex:o==null?void 0:o.colIndex,rowIndex:o==null?void 0:o.rowIndex}))}),n},Hht=function(e,t,r){var n;return!((n=e.options)===null||n===void 0)&&n.mergedCell?e.options.mergedCell(e,t,r):new _Re(e,t,r)},ARe=function(e,t,r){var n,i=t||TRe(e);if((i==null?void 0:i.length)<=1){console.error("[mergeCell]: The merged cells must be more than one!");return}var a=e.interaction.getPanelGroupAllDataCells(),o=$ht(a,e,i),s=o.cells,l=o.viewMeta;if(!Dr(s)){var u=((n=e.options)===null||n===void 0?void 0:n.mergedCellsInfo)||[];u.push(i),e.setOptions({mergedCellsInfo:u});var c=r?void 0:l;e.panelScrollGroup.addMergeCell(Hht(e,s,c))}},MRe=function(e,t){var r=oa(e.cells,function(n){return{colIndex:n.getMeta().colIndex,rowIndex:n.getMeta().rowIndex}});return Fg(t,function(n){var i=n.map(function(a){return a.showText?{colIndex:a.colIndex,rowIndex:a.rowIndex}:a});return!pu(i,r)})},RRe=function(e,t){var r,n,i;if(!t||t.cellType!==kr.MERGED_CELL){console.error("[unmergeCell]: The ".concat(t," is not a MergedCell"));return}var a=MRe(t,(r=e.options)===null||r===void 0?void 0:r.mergedCellsInfo);(a==null?void 0:a.length)!==((i=(n=e.options)===null||n===void 0?void 0:n.mergedCellsInfo)===null||i===void 0?void 0:i.length)&&(e.setOptions({mergedCellsInfo:a}),t.remove(!0))},IRe=function(e){return oa(e,function(t){return{cells:t.cells,viewMeta:t.getMeta()}})},gZ=function(e,t){return oct(e,t,function(r,n){return pu(r.viewMeta.id,n.viewMeta.id)})},LRe=function(e,t){var r,n=(r=e.options)===null||r===void 0?void 0:r.mergedCellsInfo;if(!Dr(n)){var i=e.interaction.getPanelGroupAllDataCells();if(!Dr(i)){var a=[];n.forEach(function(c){var f=$ht(i,e,c);f.cells.length>0&&a.push(f)});var o=t.getChildren(),s=IRe(o),l=gZ(s,a),u=gZ(a,s);bi(l,function(c){var f=Hu(o,function(d){return pu(d.getMeta().id,c.viewMeta.id)});f==null||f.remove(!0)}),bi(u,function(c){var f=c.cells,d=c.viewMeta;t.add(Hht(e,f,d))})}}},Vht=function(e){var t=e.includes(Bu)?"id":"field";return t},y5=function(e,t){t===void 0&&(t=[]);var r=e.getInitColumnLeafNodes();return Xd(t.map(function(n){var i=Vht(n);return r.find(function(a){return a[i]===n})}))},ORe=function(e,t){if(t===void 0&&(t=[]),Dr(t))return{prev:null,next:null};var r=e.getInitColumnLeafNodes(),n=y5(e,t).map(function(l){return l==null?void 0:l.colIndex}),i=Math.max.apply(Math,Gr([],ur(n),!1)),a=Math.min.apply(Math,Gr([],ur(n),!1)),o=r.find(function(l){return l.colIndex===i+1}),s=r.find(function(l){return l.colIndex===a-1});return{prev:s||null,next:o||null}},PRe=function(e,t){if(Dr(t))return[];var r=Number.NEGATIVE_INFINITY;return e.reduce(function(n,i,a){if(!t.includes(i))return n;if(a===r+1){var o=no(n);o.push(i)}else{var s=[i];n.push(s)}return r=a,n},[])},mZ=function(e,t,r){t===void 0&&(t=[]),r===void 0&&(r=!1);var n=function(f,d){f===void 0&&(f=[]),d===void 0&&(d=[]),e.setOptions({interaction:{hiddenColumnFields:f}}),e.interaction.reset(),e.store.set("hiddenColumnsDetail",d),e.render(!1,{reBuildHiddenColumnsDetail:!1})};if(Dr(t)&&r){n();return}var i=e.store.get("hiddenColumnsDetail",[]),a=e.options.interaction.hiddenColumnFields;if(!(pu(t,a)&&!r)){var o=ig(Gr(Gr([],ur(t),!1),ur(a),!1)),s=y5(e,o).every(function(f,d,v){var g=v[d+1];return!g||Math.abs(f.colIndex-g.colIndex)===1}),l=ORe(e,s?o:t),u={hideColumnNodes:y5(e,t),displaySiblingNode:l},c=Gr(Gr([],ur(i),!1),[u],!1);e.emit(Re.LAYOUT_COLS_HIDDEN,u,c),n(o,c)}},DRe=function(e){var t=e.dataCfg.fields.columns,r=t===void 0?[]:t;return e.isTableMode()?r:e.getInitColumnLeafNodes().map(function(n){var i=n.id;return i})},I8=function(e,t,r){t===void 0&&(t=[]),r===void 0&&(r=!1),Dr(t)&&r&&mZ(e,t,!0);var n=DRe(e),i=oE(n),a=PRe(i,t);a.forEach(function(o){mZ(e,o,r)})},FRe=function(e,t){var r=e.getColumnLeafNodes(),n=e.getInitColumnLeafNodes(),i=Vht(t);return ai(no(r),i)===t&&ai(no(n),i)!==t},BRe=function(e){return(e==null?void 0:e.next)||(e==null?void 0:e.prev)},NRe=function(e){var t=BRe(e);return t==null?void 0:t.id},_5=function(e,t){return NRe(e)===t},CS=function(e){var t=e.type,r=e.id,n=e.theme,i=e.width,a=e.height,o=H3(e,["type","id","theme","width","height"]),s=t===jf.Horizontal?n.size:null,l=t===jf.Vertical?n.size:null;return{fill:n.background,fillOpacity:n.backgroundOpacity,cursor:"".concat(t,"-resize"),width:s,height:l,appendInfo:qt(qt({},o),{isResizeArea:!0,type:t,id:r,width:i,height:a,size:n.size})}},N2=function(e,t){if(e.foregroundGroup){var r=e.foregroundGroup.findById(t);return r||e.foregroundGroup.addGroup({id:t,zIndex:jfe})}},L8=function(e,t,r){var n=r??{},i=n.scrollX,a=i===void 0?0:i,o=n.scrollY,s=o===void 0?0:o,l=!(e.x-a>t.x+t.width||e.x+e.width-a<t.x),u=!(e.y-s>t.y+t.height||e.y+e.height-s<t.y);return l&&u},kRe=function(e,t,r){if(!e)return!1;var n=e.iconNames,i=e.displayCondition,a=e.belongsCell;return Dr(n)||a!==r?!1:i?n.some(function(o){return i(t,o)}):!0},O8=function(e,t,r){var n=Hu(e,function(a){return kRe(a,t,r)});if(n){var i=n.iconNames;return n.displayCondition&&(i=i.filter(function(a){return n.displayCondition(t,a)})),qt(qt({},n),{iconNames:i})}},Ght=function(e,t){var r=e.label,n=e.field;return pu(n,Fi)?{formattedValue:t||r,value:r}:{formattedValue:r,value:r}},sE=function(e){return yS(e)==="ASC"},P8=function(e){return yS(e)==="DESC"},yZ=function(e){return!Act(Number(e))},_Z=function(e,t,r){var n=sE(t)?1:-1,i=["-",void 0];return e==null?void 0:e.sort(function(a,o){var s=a,l=o;if(r){if(s=a[r],l=o[r],yZ(s)&&yZ(l))return(Number(s)-Number(l))*n;if(s&&(i!=null&&i.includes(s==null?void 0:s.toString())))return-n;if(Number(s)&&(i!=null&&i.includes(l==null?void 0:l.toString())))return n}return!Sl(s)&&!Sl(l)?s.toString().localeCompare(l.toString(),"zh")*n:s?n:-n})},Wht=function(e,t,r){return r?AMe(t,ig(e)):Gr([],ur(new Set(Gr(Gr([],ur(e),!1),ur(t),!1))),!1)},Xht=function(e){var t=e.sortByValues,r=e.originValues,n=r.filter(function(s){return t.find(function(l){return no(p8(s,Bu))===l})}),i=n.map(function(s){var l=s.split(Bu);if(l.length>1){var u=l.slice(0,l.length-1).join(Bu);return[u,l[l.length-1]]}return l}),a=Array.from(new Set(i.map(function(s){return s[0]})));i.sort(function(s,l){var u=s.slice(0,s.length-1),c=l.slice(0,l.length-1);if(u.join()!==c.join()){var f=a.indexOf(u[0]),d=a.indexOf(c[0]);return f-d}var v=t.indexOf(s[s.length-1]),g=t.indexOf(l[l.length-1]);return v-g});var o=i.map(function(s){return s.join(Bu)});return CMe(r,o)},zRe=function(e){var t=e.originValues,r=e.measureValues,n=e.sortParam,i=e.dataSet,a=n.sortFunc,o=n.sortFieldId,s=n.sortMethod,l=a(qt({data:r},n));return l!=null&&l.length?(i.fields.rows.indexOf(o)>0||i.fields.columns.indexOf(o)>0)&&!lc(l[0],Bu)?Xht({sortByValues:l,originValues:t}):Wht(l,t,sE(s)):t},URe=function(e){var t=e.sortParam,r=e.measureValues,n=e.originValues,i=e.dataSet,a=t.sortByMeasure,o=t.query,s=t.sortFieldId,l=t.sortMethod,u=i.fields,c=u.rows,f=u.columns,d=c.includes(s),v;if(a){var g=_Z(r,l,a===av?o[Fi]:a);v=RMe(s,d?c:oE(f),g)}else v=oa(_Z(r,l));return Wht(v,n,sE(l))},$Re=function(e){var t=e.sortParam,r=e.originValues,n=e.measureValues,i=e.dataSet,a=t.sortFunc,o=t.sortMethod,s=t.sortBy,l=r,u={originValues:r,measureValues:n,sortParam:t,dataSet:i};return a?l=zRe(u):s?l=Xht({sortByValues:s,originValues:r}):(sE(o)||P8(o))&&(l=URe(u)),l},HRe=function(e,t,r){var n,i={},a=lc(e,Bu);if(a)for(var o=p8(e,Bu),s=!((n=t==null?void 0:t.rows)===null||n===void 0)&&n.includes(r)?t.rows:oE(t.columns),l=0;l<=dL(s,r);l++)i[s[l]]=o[l];else i[r]=e;return i},xZ=function(e){return e.filter(function(t){return t!==Fi})},VRe=function(e){var t=e.dataSet,r=e.sortParam,n=e.originValues,i=t.fields,a=r.sortByMeasure,o=r.query,s=r.sortFieldId;if(a!==av){var l=t.getMultiData(o,{queryType:$f.DetailOnly});return l}var u=t.getMultiData(o,{queryType:$f.All}),c=oE(i.columns),f=lc(i.rows,s),d=xZ(f?i.rows:c),v=xZ(f?c:i.rows),g=d[d.indexOf(s)+1],x=Es(o),w=v.filter(function(M){return!x.includes(M)}),S=u.filter(function(M){var R=new Set(Object.keys(M[v6]));if(!R.has(s)||R.has(g))return!1;var I=w.every(function(P){return!R.has(P)});return I});return Dr(S)?Xd(oa(n,function(M){var R=HRe(M,i,s);return t.getTotalValue(qt(qt({},o),R))})):S},GRe=function(e){var t=e.dataSet,r=e.sortParam,n=e.originValues,i=e.isSortByMeasure,a;return i?a=VRe(e):a=n,$Re({sortParam:r,originValues:n,measureValues:a,dataSet:t})},jht=function(e,t){if(e!=null&&e.sortMethod){if(sE(e==null?void 0:e.sortMethod))return"groupAsc";if(P8(e==null?void 0:e.sortMethod))return"groupDesc"}if(t)return"SortDown"},bZ=function(e){var t,r,n=e.pivotMeta,i=e.dimensions,a=e.sortedDimensionValues,o=e.sortFieldId,s={children:n},l=[s];try{for(var u=Kf(i),c=u.next();!c.done;c=u.next()){var f=c.value;if(f!==o)l=R2(l,function(d){return Gr([],ur(d.children.values()),!1)});else{l.forEach(function(d){var v=Gr([],ur(d.children.values()),!1),g=Kct(v,function(x){return dL(a,x.id)}).map(function(x){return[x.value,x]});d.children=new Map(g)});break}}}catch(d){t={error:d}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}return s.children},D8=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.handleRestOptions=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=ur(r,1),a=i[0];this.headerConfig=qt({},a);var o=this.meta,s=o.value,l=o.query,u=this.spreadsheet.dataCfg.sortParams,c=this.isSortCell(),f=Hu(Gr([],ur(u),!1).reverse(),function(v){return c&&(v==null?void 0:v.sortByMeasure)===s&&pu(ai(v,"query"),l)}),d=jht(f,c);this.headerConfig.sortParam=qt(qt(qt({},this.headerConfig.sortParam),f||{query:l}),{type:d})},t.prototype.initCell=function(){this.resetTextAndConditionIconShapes(),this.actionIcons=[],this.hasDefaultHiddenIcon=!1},t.prototype.getTreeIcon=function(){return this.treeIcon},t.prototype.getInteractiveBorderShapeStyle=function(r){var n=this.getCellArea(),i=n.x,a=n.y,o=n.height,s=n.width;return{x:i+r,y:a+r,width:s-r*2,height:o-r*2}},t.prototype.getFormattedFieldValue=function(){var r=this.meta,n=r.label,i=r.isTotalRoot,a=r.isGrandTotals,o=this.spreadsheet.dataSet.getFieldFormatter(this.meta.field),s=!0;this.spreadsheet.isTableMode()?s=!1:this.spreadsheet.isHierarchyTreeType()?s=!(a&&i):s=!i;var l=s&&o?o(n,void 0,this.meta):n;return{formattedValue:l,value:n}},t.prototype.getActionIconCfg=function(){return O8(this.spreadsheet.options.headerActionIcons,this.meta,this.cellType)},t.prototype.showSortIcon=function(){var r=this.spreadsheet,n=r.options,i=r.dataCfg,a=Dr(i.fields.values);if(n.showDefaultHeaderActionIcon&&!a){var o=this.headerConfig.sortParam,s=this.meta.query;return s&&pu(o==null?void 0:o.query,s)&&(o==null?void 0:o.type)&&(o==null?void 0:o.type)!=="none"}return!1},t.prototype.getActionIconsCount=function(){if(this.showSortIcon())return 1;var r=this.getActionIconCfg();if(r){var n=r.iconNames;return n.length}return 0},t.prototype.getActionIconsWidth=function(){var r=this.getStyle().icon,n=r.size,i=r.margin;return(n+i.left)*this.getActionIconsCount()},t.prototype.drawSortIcons=function(){var r=this;if(this.showSortIcon()){var n=this.getStyle(),i=n.icon,a=n.text,o=this.getTextConditionFill(a),s=this.headerConfig.sortParam,l=this.getIconPosition(),u=new _S(qt(qt({name:ai(s,"type","none")},l),{width:i.size,height:i.size,fill:o}));u.on("click",function(c){r.spreadsheet.emit(Re.GLOBAL_ACTION_ICON_CLICK,c),r.spreadsheet.handleGroupSort(c,r.meta)}),this.add(u),this.actionIcons.push(u)}},t.prototype.hasDefaultHideActionIcon=function(){return this.hasDefaultHiddenIcon},t.prototype.addActionIcon=function(r){var n=this,i=r.x,a=r.y,o=r.iconName,s=r.defaultHide,l=r.action,u=r.onClick,c=r.onHover,f=this.getStyle(),d=f.icon,v=f.text,g=this.getTextConditionFill(v),x=(d==null?void 0:d.fill)||g,w=new _S({name:o,x:i,y:a,width:d==null?void 0:d.size,height:d==null?void 0:d.size,fill:x});w.set("visible",!s),w.on("mouseover",function(S){n.spreadsheet.emit(Re.GLOBAL_ACTION_ICON_HOVER,S),c==null||c({hovering:!0,iconName:o,meta:n.meta,event:S})}),w.on("mouseleave",function(S){n.spreadsheet.emit(Re.GLOBAL_ACTION_ICON_HOVER_OFF,S),c==null||c({hovering:!1,iconName:o,meta:n.meta,event:S})}),w.on("click",function(S){var M;n.spreadsheet.emit(Re.GLOBAL_ACTION_ICON_CLICK,S),(M=u||l)===null||M===void 0||M({iconName:o,meta:n.meta,event:S})}),this.actionIcons.push(w),this.add(w)},t.prototype.drawActionIcons=function(){var r=this;if(this.showSortIcon()){this.drawSortIcons();return}var n=this.getActionIconCfg();if(n){var i=n.iconNames,a=n.action,o=n.onClick,s=n.onHover,l=n.defaultHide,u=this.getIconPosition(i.length),c=this.getStyle().icon,f=c.size,d=c.margin;bi(i,function(v,g){var x=u.x+g*f+g*d.left,w=u.y,S=typeof l=="function"?l(r.meta,v):l;S&&(r.hasDefaultHiddenIcon=!0),r.addActionIcon({iconName:v,x,y:w,defaultHide:S,action:a,onClick:o,onHover:s})})}},t.prototype.drawBackgroundShape=function(){var r=this.getBackgroundColor(),n=r.backgroundColor,i=r.backgroundColorOpacity;this.backgroundShape=Vh(this,qt(qt({},this.getCellArea()),{fill:n,fillOpacity:i}))},t.prototype.isSortCell=function(){var r,n,i,a=(n=(r=this.spreadsheet)===null||r===void 0?void 0:r.isValueInCols)===null||n===void 0?void 0:n.call(r),o=this.meta.level===((i=this.meta.hierarchy)===null||i===void 0?void 0:i.maxLevel);return a?o&&this.cellType===kr.COL_CELL:o&&this.cellType===kr.ROW_CELL},t.prototype.handleByStateName=function(r,n){zy(r,this)&&this.updateByState(n)},t.prototype.handleSearchResult=function(r){if(zy(r,this)){var n=Hu(r,function(i){return i==null?void 0:i.isTarget});n.id===this.getMeta().id?this.updateByState(Dn.HIGHLIGHT):this.updateByState(Dn.SEARCH_RESULT)}},t.prototype.handleHover=function(r){var n;zy(r,this)&&(this.updateByState(Dn.HOVER),this.hasDefaultHideActionIcon()&&this.toggleActionIcon((n=r==null?void 0:r[0])===null||n===void 0?void 0:n.id))},t.prototype.handleSelect=function(r,n){zy(r,this)&&this.updateByState(Dn.SELECTED);var i=oa(n,"id");lc(i,this.meta.id)&&this.updateByState(Dn.SELECTED)},t.prototype.getTextStyle=function(){var r=this.getStyle(),n=r.text,i=r.bolderText,a=r.measureText,o;this.isMeasureField()?o=a||n:this.isBolderText()?o=i:o=n;var s=this.getTextConditionFill(o);return qt(qt({},o),{fill:s})},t.prototype.getBackgroundColor=function(){var r,n=((r=this.getStyle())===null||r===void 0?void 0:r.cell)||{},i=n.backgroundColor,a=n.backgroundColorOpacity;return this.getBackgroundColorByCondition(i,a)},t.prototype.getBackgroundColorByCondition=function(r,n){var i,a=r,o=this.findFieldCondition((i=this.conditions)===null||i===void 0?void 0:i.background);if(o&&o.mapping){var s=this.mappingValue(o);s&&(a=s.fill)}return{backgroundColor:a,backgroundColorOpacity:n}},t.prototype.toggleActionIcon=function(r){if(this.getMeta().id===r){var n=[];bi(this.actionIcons,function(i){i.get("visible")||(i.set("visible",!0),n.push(i))}),this.spreadsheet.store.set("visibleActionIcons",n)}},t.prototype.update=function(){var r=this.spreadsheet.interaction,n=r==null?void 0:r.getState(),i=r==null?void 0:r.getCells([kr.CORNER_CELL,kr.COL_CELL,kr.ROW_CELL]);if(w_(i))switch(n==null?void 0:n.stateName){case Dn.SELECTED:case Dn.BRUSH_SELECTED:this.handleSelect(i,n==null?void 0:n.nodes);break;case Dn.HOVER_FOCUS:case Dn.HOVER:this.handleHover(i);break;case Dn.SEARCH_RESULT:this.handleSearchResult(i);break;default:this.handleByStateName(i,n==null?void 0:n.stateName);break}},t.prototype.updateByState=function(r){e.prototype.updateByState.call(this,r,this)},t.prototype.hideInteractionShape=function(){e.prototype.hideInteractionShape.call(this)},t.prototype.isMeasureField=function(){return[Fi,Gfe].includes(this.meta.field)},t.prototype.mappingValue=function(r){var n=this.getMeta().label;return r==null?void 0:r.mapping(n,this.meta)},t.prototype.findFieldCondition=function(r){var n=this;return cL(r,function(i){return i.field instanceof RegExp?i.field.test(n.meta.field):i.field===n.meta.field})},t}(wL),CL=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"cellType",{get:function(){return kr.COL_CELL},enumerable:!1,configurable:!0}),t.prototype.initCell=function(){e.prototype.initCell.call(this),this.drawBackgroundShape(),this.drawInteractiveBgShape(),this.drawInteractiveBorderShape(),this.drawTextShape(),this.drawConditionIconShapes(),this.drawActionIcons(),this.drawBorders(),this.drawResizeArea(),this.addExpandColumnIconShapes(),this.update()},t.prototype.drawInteractiveBgShape=function(){this.stateShapes.set("interactiveBgShape",Vh(this,qt({},this.getCellArea()),{visible:!1}))},t.prototype.drawInteractiveBorderShape=function(){var r=2;this.stateShapes.set("interactiveBorderShape",Vh(this,this.getInteractiveBorderShapeStyle(r),{visible:!1}))},t.prototype.getMaxTextWidth=function(){var r=this.getContentArea().width;return r-this.getActionIconsWidth()},t.prototype.getIconPosition=function(){if(this.meta.isLeaf)return e.prototype.getIconPosition.call(this,this.getActionIconsCount());var r=this.getIconStyle(),n=r.margin.left,i=this.getTextStyle(),a=this.textPosition,o=a==null?void 0:a.x,s=(a==null?void 0:a.y)-r.size/2;return i.textAlign==="left"?{x:o+this.actualTextWidth+n,y:s}:i.textAlign==="right"?{x:o+n,y:s}:{x:o+this.actualTextWidth/2+n,y:s}},t.prototype.isBolderText=function(){var r=this.meta,n=r.isLeaf,i=r.isTotals;return!!(i||!n)},t.prototype.getTextPosition=function(){var r,n=this.meta.isLeaf,i=this.headerConfig,a=i.width,o=i.scrollContainsRowHeader,s=i.cornerWidth,l=i.scrollX,u=this.getTextStyle(),c=this.getContentArea(),f=this.getIconStyle();if(n)return F2(c,u,this.actualTextWidth,f,this.getActionIconsCount()).text;var d={start:l-(o?s:0),width:a+(o?s:0)},v=this.getTextStyle().textAlign,g=gMe(d,v,(r=this.getStyle().cell)===null||r===void 0?void 0:r.padding),x=this.getActionIconsWidth(),w=this.actualTextWidth+x,S=vMe(g,{start:c.x,width:c.width},w),M=mMe(S,this.actualTextWidth,x,v),R=c.y+c.height/2;return this.textPosition={x:M,y:R},this.textPosition},t.prototype.getActionIconsWidth=function(){var r=this.getStyle().icon,n=r.size,i=r.margin,a=this.getActionIconsCount();return(n+i.left)*a+(a>0?i.right:0)},t.prototype.getColResizeAreaKey=function(){return this.meta.key},t.prototype.getColResizeArea=function(){return N2(this.spreadsheet,Tlt)},t.prototype.getHorizontalResizeAreaName=function(){return"".concat(Mlt).concat(this.meta.key)},t.prototype.drawHorizontalResizeArea=function(){var r,n,i=((n=(r=this.spreadsheet.options.style)===null||r===void 0?void 0:r.colCfg)===null||n===void 0?void 0:n.height)===0;if(!(i||!this.shouldDrawResizeAreaByType("colCellVertical",this))){var a=this.headerConfig,o=a.cornerWidth,s=a.viewportWidth,l=this.meta,u=l.y,c=l.height,f=this.getResizeAreaStyle(),d=this.getColResizeArea(),v=this.getHorizontalResizeAreaName(),g=d.find(function(w){return w.attrs.name===v});if(!g){var x=o+s;d.addShape("rect",{attrs:qt(qt({},CS({theme:f,type:jf.Vertical,id:this.getColResizeAreaKey(),effect:ic.Field,offsetX:0,offsetY:u,width:x,height:c,meta:this.meta})),{name:v,x:0,y:u+c-f.size/2,width:x})})}}},t.prototype.shouldAddVerticalResizeArea=function(){var r=this.meta,n=r.x,i=r.y,a=r.width,o=r.height,s=this.headerConfig,l=s.scrollX,u=s.scrollY,c=s.scrollContainsRowHeader,f=s.cornerWidth,d=s.height,v=s.width,g=this.getResizeAreaStyle(),x={x:n+a-g.size/2,y:i,width:g.size,height:o},w={x:c?-f:0,y:0,width:c?f+v:v,height:d};return L8(x,w,{scrollX:l,scrollY:u})},t.prototype.getVerticalResizeAreaOffset=function(){var r=this.meta,n=r.x,i=r.y,a=this.headerConfig,o=a.scrollX,s=a.position;return{x:s.x+n-o,y:s.y+i}},t.prototype.drawVerticalResizeArea=function(){if(!(!this.meta.isLeaf||!this.shouldDrawResizeAreaByType("colCellHorizontal",this))){var r=this.meta,n=r.label,i=r.width,a=r.height,o=this.getResizeAreaStyle(),s=this.getColResizeArea();if(this.shouldAddVerticalResizeArea()){var l=this.getVerticalResizeAreaOffset(),u=l.x,c=l.y;s.addShape("rect",{attrs:qt(qt({},CS({theme:o,type:jf.Horizontal,effect:ic.Cell,id:n,offsetX:u,offsetY:c,width:i,height:a,meta:this.meta})),{x:u+i-o.size/2,y:c,height:a})})}}},t.prototype.drawResizeArea=function(){this.drawHorizontalResizeArea(),this.drawVerticalResizeArea()},t.prototype.drawHorizontalBorder=function(){var r=S_(yl.TOP,this.meta,this.theme.colCell.cell),n=r.position,i=r.style;hu(this,n,i)},t.prototype.drawVerticalBorder=function(r){var n=S_(r,this.meta,this.theme.colCell.cell),i=n.position,a=n.style;hu(this,i,a)},t.prototype.drawBorders=function(){var r=this.spreadsheet,n=r.options,i=r.isTableMode;this.meta.colIndex===0&&i()&&!n.showSeriesNumber&&this.drawVerticalBorder(yl.LEFT),this.drawHorizontalBorder(),this.drawVerticalBorder(yl.RIGHT)},t.prototype.hasHiddenColumnCell=function(){var r=this,n=this.spreadsheet.options,i=n.interaction.hiddenColumnFields,a=i===void 0?[]:i,o=n.tooltip.operation,s=this.spreadsheet.store.get("hiddenColumnsDetail",[]);return Dr(s)||Dr(a)||!o.hiddenColumns?!1:!!s.find(function(l){return _5(l==null?void 0:l.displaySiblingNode,r.meta.id)})},t.prototype.getExpandIconTheme=function(){var r=this.getStyle();return r.icon},t.prototype.addExpandColumnSplitLine=function(){var r=this.meta,n=r.x,i=r.y,a=r.width,o=r.height,s=this.theme.splitLine,l=s.horizontalBorderColor,u=s.horizontalBorderWidth,c=s.horizontalBorderColorOpacity,f=s.borderDash,d=this.isLastColumn()?n+a-u:n;hu(this,{x1:d,y1:i,x2:d,y2:i+o},{stroke:l,lineWidth:u,strokeOpacity:c,lineDash:f})},t.prototype.addExpandColumnIconShapes=function(){this.hasHiddenColumnCell()&&(this.addExpandColumnSplitLine(),this.addExpandColumnIcons())},t.prototype.addExpandColumnIcons=function(){var r=this.isLastColumn();this.addExpandColumnIcon(r),this.isAllDisplaySiblingNodeHidden()&&r&&this.addExpandColumnIcon(!1)},t.prototype.addExpandColumnIcon=function(r){var n=this,i=this.getExpandColumnIconConfig(r),a=T8(this,qt(qt({},i),{name:"ExpandColIcon",cursor:"pointer"}));a.on("click",function(){n.spreadsheet.emit(Re.LAYOUT_COLS_EXPANDED,n.meta)})},t.prototype.getExpandColumnIconConfig=function(r){var n=this.getExpandIconTheme().size,i=this.getCellArea(),a=i.x,o=i.y,s=i.width,l=i.height,u=a-n,c=r?u+s:u,f=o+l/2-n/2;return{x:c,y:f,width:n*2,height:n}},t.prototype.isLastColumn=function(){return FRe(this.spreadsheet,this.meta.id)},t.prototype.isAllDisplaySiblingNodeHidden=function(){var r=this.meta.id,n=this.spreadsheet.store.get("hiddenColumnsDetail",[]),i=n.find(function(o){var s,l=o.displaySiblingNode;return((s=l==null?void 0:l.next)===null||s===void 0?void 0:s.id)===r}),a=n.find(function(o){var s,l=o.displaySiblingNode;return((s=l==null?void 0:l.prev)===null||s===void 0?void 0:s.id)===r});return a&&i},t}(D8),WRe=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.isBolderText=function(){var r=this.meta.cornerType;return r===Fd.Col},Object.defineProperty(t.prototype,"cellType",{get:function(){return kr.CORNER_CELL},enumerable:!1,configurable:!0}),t.prototype.initCell=function(){e.prototype.initCell.call(this),this.resetTextAndConditionIconShapes(),this.drawBackgroundShape(),this.drawTreeIcon(),this.drawCellText(),this.drawConditionIconShapes(),this.drawActionIcons(),this.drawBorderShape(),this.drawResizeArea(),this.update()},t.prototype.drawCellText=function(){this.drawTextShape()},t.prototype.drawTextShape=function(){var r=this.getContentArea().x,n=this.getCellArea(),i=n.y,a=n.height,o=this.getTextStyle(),s=this.getCornerText(),l=this.getMaxTextWidth(),u=j_(this.meta,this.spreadsheet.options.placeholder),c=this.spreadsheet.measureTextWidth,f=Cb({measureTextWidth:c,text:s,maxWidth:l,fontParam:o,placeholder:u});this.actualText=f;var d=f.indexOf(Dx),v=f,g="";if(d!==-1&&this.spreadsheet.isHierarchyTreeType()){var x=d+(dAe()?1:0);v=s.substr(0,x),g=s.slice(x),g=Cb({measureTextWidth:c,text:g,maxWidth:l,fontParam:o})}var w=pMe({x:r+this.getTreeIconWidth(),y:i,width:l,height:a},o).x,S=i+(Dr(g)?a/2:a/4);this.addTextShape(C_(this,[this.textShapes[0]],w,S,v,o)),Dr(g)||this.addTextShape(C_(this,[this.textShapes[1]],w,i+a*.75,g,o)),this.actualTextWidth=bb([c(v,o),c(g,o)])},t.prototype.drawTreeIcon=function(){var r=this;if(!(!this.showTreeIcon()||this.meta.cornerType===Fd.Col)){var n=this.headerConfig.hierarchyCollapse,i=this.getStyle().icon.size,a=this.getTextStyle(),o=a.textBaseline,s=a.fill,l=this.getContentArea();this.treeIcon=Mht(this,{x:l.x,y:gI(l,o,i),width:i,height:i},s,n,function(){r.headerConfig.spreadsheet.store.set("scrollY",0),r.headerConfig.spreadsheet.emit(Re.LAYOUT_TREE_ROWS_COLLAPSE_ALL,n)})}},t.prototype.drawBorderShape=function(){var r=this;[yl.TOP,yl.LEFT].forEach(function(n){var i=S_(n,r.getCellArea(),r.getStyle().cell),a=i.position,o=i.style;hu(r,a,o)})},t.prototype.isLastRowCornerCell=function(){var r=this.meta,n=r.cornerType,i=r.field,a=this.headerConfig.rows;return n===Fd.Row&&(this.spreadsheet.isHierarchyTreeType()||no(a)===i)},t.prototype.getResizeAreaEffect=function(){var r=this.meta.cornerType;return r===Fd.Series?ic.Series:this.isLastRowCornerCell()&&this.spreadsheet.isHierarchyTreeType()?ic.Tree:ic.Field},t.prototype.drawResizeArea=function(){if(this.shouldDrawResizeAreaByType("cornerCellHorizontal",this)){var r=this.getResizeAreaStyle(),n=N2(this.spreadsheet,HB),i=this.headerConfig,a=i.position,o=i.scrollX,s=i.scrollY,l=i.width,u=i.height,c=this.meta,f=c.x,d=c.y,v=c.width,g=c.height,x=c.field,w=c.cornerType,S={x:f+v-r.size/2,y:d,width:r.size,height:g},M={x:0,y:0,width:l,height:u};if(!(w===Fd.Col||!L8(S,M,{scrollX:o,scrollY:s}))){var R=a.x+f-o,I=a.y+(this.isLastRowCornerCell()?0:d);n.addShape("rect",{attrs:qt(qt({},CS({theme:r,id:x,type:jf.Horizontal,effect:this.getResizeAreaEffect(),offsetX:R,offsetY:I,width:v,height:g,meta:this.meta})),{x:R+v-r.size/2,y:I,height:this.isLastRowCornerCell()?u:g})})}}},t.prototype.showTreeIcon=function(){var r;return this.spreadsheet.isHierarchyTreeType()&&((r=this.meta)===null||r===void 0?void 0:r.x)===0},t.prototype.getIconPosition=function(){var r,n,i=(n=(r=this.textShapes)===null||r===void 0?void 0:r[0])===null||n===void 0?void 0:n.cfg.attrs,a=this.getTextStyle(),o=a.textBaseline,s=a.textAlign,l=this.getStyle().icon,u=l.size,c=l.margin,f=(i==null?void 0:i.x)+Kut([[i5("center"),Bx(this.actualTextWidth/2)],[i5("right"),Bx(0)],[Jct,Bx(this.actualTextWidth)]])(s)+c.left,d=gI(this.getContentArea(),o,u);return{x:f,y:d}},t.prototype.getTreeIconWidth=function(){var r=this.getStyle().icon,n=r.size,i=r.margin;return this.showTreeIcon()?n+i.right:0},t.prototype.getTextStyle=function(){var r=this.getStyle(),n=r.text,i=r.bolderText,a=this.isBolderText()?n:i,o=this.getTextConditionFill(a);return qt(qt({},a),{fill:o})},t.prototype.getMaxTextWidth=function(){var r=this.getContentArea().width;return r-this.getTreeIconWidth()-this.getActionIconsWidth()},t.prototype.getTextPosition=function(){return{x:0,y:0}},t.prototype.getFormattedFieldValue=function(){return Ght(this.meta,this.spreadsheet.dataSet.getFieldName(this.meta.label))},t.prototype.getCornerText=function(){var r=this.getFormattedFieldValue().formattedValue;return r},t}(D8),XRe=function(e,t,r,n){var i,a,o=ai(n,"size"),s=ai(n,"margin"),l=0;return e.options.showDefaultHeaderActionIcon?l=1:l=(a=(i=O8(e.options.headerActionIcons,t,r))===null||i===void 0?void 0:i.iconNames.length)!==null&&a!==void 0?a:0,l*(o+s.left)+(l>0?s.right:0)},Yht=function(e,t,r){var n,i,a=((n=r.icon.margin)===null||n===void 0?void 0:n.left)||0,o=((i=r.icon.margin)===null||i===void 0?void 0:i.right)||0,s=e.store.get("hiddenColumnsDetail",[]),l=!1,u=!1;s.forEach(function(f){var d,v,g,x;((v=(d=f==null?void 0:f.displaySiblingNode)===null||d===void 0?void 0:d.prev)===null||v===void 0?void 0:v.field)===t&&(l=!0),((x=(g=f==null?void 0:f.displaySiblingNode)===null||g===void 0?void 0:g.next)===null||x===void 0?void 0:x.field)===t&&(u=!0)});var c=ai(r,"icon.size");return{left:u?c+o:0,right:l?c+a:0}},jRe=function(e,t,r){var n=ai(r,"cell.padding"),i=Yht(e,t.field,r);return n.left+n.right+XRe(e,t,kr.COL_CELL,ai(r,"icon"))+i.left+i.right},Zht=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.handleRestOptions=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=ur(r,1),a=i[0];this.headerConfig=qt({},a);var o=this.meta.field,s=this.spreadsheet.dataCfg.sortParams,l=Hu(s,function(c){return(c==null?void 0:c.sortFieldId)===o}),u=jht(l,!0);this.headerConfig.sortParam=qt(qt(qt({},this.headerConfig.sortParam),l||{}),{type:u})},t.prototype.isFrozenCell=function(){var r=this.spreadsheet.options,n=r.frozenColCount,i=r.frozenTrailingColCount,a=this.spreadsheet.facet.layoutResult.colNodes.filter(function(s){return Xp(s)}),o=qAe(this.meta).colIndex;return qy(o,n)||Ky(o,i,a.length)},t.prototype.getFormattedFieldValue=function(){return Ght(this.meta,this.spreadsheet.dataSet.getFieldName(this.meta.label))},t.prototype.shouldAddVerticalResizeArea=function(){return this.isFrozenCell()?!0:e.prototype.shouldAddVerticalResizeArea.call(this)},t.prototype.getVerticalResizeAreaOffset=function(){var r=this.meta,n=r.x,i=r.y,a=this.headerConfig,o=a.scrollX,s=a.position;return this.isFrozenCell()?{x:n,y:i}:{x:s.x+n-o,y:s.y+i}},t.prototype.getColResizeArea=function(){var r=this.isFrozenCell();return r?N2(this.spreadsheet,Alt):e.prototype.getColResizeArea.call(this)},t.prototype.isSortCell=function(){return!0},t.prototype.showSortIcon=function(){return this.spreadsheet.options.showDefaultHeaderActionIcon},t.prototype.getTextStyle=function(){var r=this.getStyle();return r==null?void 0:r.bolderText},t.prototype.getContentArea=function(){var r,n=(((r=this.getStyle())===null||r===void 0?void 0:r.cell)||this.theme.dataCell.cell).padding,i=qt({},n),a=Yht(this.spreadsheet,this.meta.field,this.getStyle());return a.left&&(i.left=(i.left||0)+a.left),a.right&&(i.right=(i.right||0)+a.right),Iht(this.getCellArea(),i)},t.prototype.getHorizontalResizeAreaName=function(){return"".concat(Mlt).concat("table-col-cell")},t.prototype.drawBackgroundShape=function(){var r=this.getStyle().cell.backgroundColor;this.backgroundShape=Vh(this,qt(qt({},this.getCellArea()),{fill:r}))},t}(CL),YRe=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getStyle=function(r){return r?this.theme[r]:ai(this,"theme.cornerCell")},t.prototype.showSortIcon=function(){return!1},t.prototype.drawLeftBorder=function(){var r=S_(yl.LEFT,this.getCellArea(),this.getStyle().cell),n=r.position,i=r.style;hu(this,n,i)},t.prototype.drawBorders=function(){e.prototype.drawBorders.call(this),this.meta.colIndex===0&&this.drawLeftBorder()},t}(Zht),SL=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getLinkFieldStyle=function(){return this.theme.rowCell.text.linkTextFill},t.prototype.drawBorderShape=function(){e.prototype.drawBorderShape.call(this),this.meta.colIndex===0&&this.drawLeftBorder()},t.prototype.shouldDrawResizeArea=function(){return this.meta.colIndex===0},t.prototype.drawResizeArea=function(){if(this.shouldDrawResizeArea()){var r=this.getCellArea(),n=r.x,i=r.y,a=r.width,o=r.height,s=this.meta.rowIndex,l=this.getResizeAreaStyle(),u=this.spreadsheet.options,c=u.frozenRowCount,f=u.frozenTrailingRowCount,d=this.spreadsheet.facet.getCellRange(),v=bL(s,d.start,c),g=D2(s,d.end,f),x=v||g,w=x?Slt:yb,S=N2(this.spreadsheet,w),M=this.spreadsheet.facet.layoutResult.colsHierarchy.height,R=this.spreadsheet.facet.getScrollOffset().scrollY,I=this.spreadsheet.facet.getPaginationScrollY(),P=R+I,k=i+(g?0:M);g||(k-=v?I:P),S.addShape("rect",{attrs:qt(qt({},CS({id:String(this.meta.rowIndex),theme:l,type:jf.Vertical,effect:ic.Cell,offsetX:n,offsetY:k,width:a,height:o,meta:this.meta})),{x:n,y:k+o-l.size/2,width:a})})}},t}(L0),qht=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"cellType",{get:function(){return kr.ROW_CELL},enumerable:!1,configurable:!0}),t.prototype.getTextStyle=function(){return this.theme.rowCell.seriesText},t}(SL),TL=function(){function e(t){this.EVENT="gesture",this.gm=t}return e.prototype.do=function(t){var r=t.type;switch(r){case"touchstart":this.onTouchStart(t);break;case"touchmove":this.onTouchMove(t);break;case"touchend":this.onTouchEnd(t);break;case"touchcancel":this.onTouchCancel(t);break;default:return}},e.prototype.emit=function(t){this.gm.emit(this.EVENT,t)},e}(),ZRe=function(e){nn(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.EVENT="pan",r}return t.prototype.onTouchCancel=function(r){},t.prototype.onTouchEnd=function(r){},t.prototype.onTouchMove=function(r){var n=r.x,i=r.y,a=n-this.preX,o=i-this.preY;this.preX=n,this.preY=i,this.emit({x:n,y:i,deltaX:a,deltaY:o,event:r})},t.prototype.onTouchStart=function(r){var n=r.x,i=r.y;this.preX=n,this.preY=i},t}(TL),Jm=typeof performance=="object"&&performance.now?performance:Date,qRe=300,EZ=10,KRe=function(e){nn(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.EVENT="press",r}return t.prototype.onTouchCancel=function(r){this.clearTimeout()},t.prototype.onTouchEnd=function(r){this.clearTimeout()},t.prototype.onTouchMove=function(r){var n=r.x,i=r.y;(n-this.touchStartX>EZ||i-this.touchStartY>EZ)&&this.clearTimeout()},t.prototype.onTouchStart=function(r){var n=this;this.clearTimeout();var i=r.x,a=r.y;this.touchStartTime=Jm.now(),this.touchStartX=i,this.touchStartY=a,this.pressTimeout=window.setTimeout(function(){n.emit({x:i,y:a,event:r})},qRe)},t.prototype.clearTimeout=function(){window.clearTimeout(this.pressTimeout)},t}(TL),QRe=100,JRe=function(e){nn(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.EVENT="swipe",r.latestMoveTime=0,r.ms=0,r.speedX=0,r.speedY=0,r.preX=0,r.preY=0,r}return t.prototype.onTouchCancel=function(r){},t.prototype.onTouchEnd=function(r){var n=this.speedX,i=this.speedY;if(Jm.now()-this.latestMoveTime<QRe){var a=r.x,o=r.y;this.emit({x:a,y:o,speedX:n,speedY:i,event:r})}},t.prototype.onTouchMove=function(r){var n=r.x,i=r.y,a=Jm.now(),o=n-this.preX,s=i-this.preY,l=a-this.ms;this.speedX=o/l,this.speedY=s/l,this.latestMoveTime=a},t.prototype.onTouchStart=function(r){var n=r.x,i=r.y;this.speedX=this.speedY=0,this.preX=n,this.preY=i,this.ms=Jm.now()},t}(TL),tIe=300,wZ=2,eIe=function(e){nn(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.EVENT="tap",r}return t.prototype.onTouchCancel=function(r){},t.prototype.onTouchEnd=function(r){var n=r.x,i=r.y;n-this.touchStartX<wZ&&i-this.touchStartY<wZ&&Jm.now()-this.touchStartTime<tIe&&this.emit({x:n,y:i,event:r})},t.prototype.onTouchMove=function(r){},t.prototype.onTouchStart=function(r){var n=r.x,i=r.y;this.touchStartTime=Jm.now(),this.touchStartX=n,this.touchStartY=i},t}(TL),rIe={Pan:ZRe,Press:KRe,Swipe:JRe,Tap:eIe},nIe=function(e){return rIe[e]},Kht=function(e){nn(t,e);function t(r,n){n===void 0&&(n={});var i=e.call(this)||this;return i.onTouchStart=function(a){i.preventEvent(a),i.element.on("touchmove",i.onTouchMove),i.element.on("touchend",i.onTouchEnd),i.element.on("touchcancel",i.onTouchCancel),i.emit("touchdown",a),i.doGestures(a)},i.onTouchMove=function(a){i.preventEvent(a),i.emit("touchmove",a),i.doGestures(a)},i.onTouchEnd=function(a){i.preventEvent(a),i.emit("touchend",a),i.element.off("touchmove",i.onTouchMove),i.element.off("touchend",i.onTouchEnd),i.element.off("touchcancel",i.onTouchCancel),i.doGestures(a)},i.onTouchCancel=function(a){i.preventEvent(a),i.emit("touchcancel",a),i.element.off("touchmove",i.onTouchMove),i.element.off("touchend",i.onTouchEnd),i.element.off("touchcancel",i.onTouchCancel),i.doGestures(a)},i.element=r,i.options=n,i.initialGestures(),i.bindTouchStart(),i}return t.prototype.destroy=function(){this.element.off("touchstart",this.onTouchStart),this.off()},t.prototype.initialGestures=function(){var r=this,n=this.options.gestures||["Pan","Press","Swipe","Tap"];this.gestures=n.map(function(i){var a=nIe(i);return new a(r)})},t.prototype.bindTouchStart=function(){this.element.on("touchstart",this.onTouchStart)},t.prototype.preventEvent=function(r){var n=r.type,i=this.options.prevents||[];i.includes(n)&&r.preventDefault()},t.prototype.doGestures=function(r){this.gestures.forEach(function(n){n.do(r)})},t}(G3),iIe=Xst,aIe=800,oIe="swipe",sIe="pan",CZ="wheel",lIe=function(e){nn(t,e);function t(r){var n=e.call(this)||this;return n.rafMs=0,n.onPan=function(i){n.raf&&cancelAnimationFrame(n.raf);var a=i.deltaX,o=i.deltaY,s=n.getWrapperEvent(i,a,o);n.emit(CZ,s)},n.onSwipe=function(i){var a=i.speedX,o=i.speedY;n.rafMs=Jm.now(),n.ms=n.rafMs,(a!==0||o!==0)&&n.rafInertia(i)},n.element=r,n.gm=new Kht(r,{gestures:["Pan","Swipe"]}),n.gm.on(oIe,n.onSwipe),n.gm.on(sIe,n.onPan),n}return t.prototype.destroy=function(){window.cancelAnimationFrame(this.raf),this.gm.destroy(),this.off()},t.prototype.rafInertia=function(r){var n=this,i=r.speedX,a=r.speedY;this.raf=window.requestAnimationFrame(function(){var o=Jm.now(),s=(o-n.ms)/aIe;if(s<1){s=iIe(1-s);var l=o-n.rafMs,u=i*s*l,c=a*s*l,f=n.getWrapperEvent(r,u,c);n.emit(CZ,f),n.rafMs=o,n.rafInertia(r)}})},t.prototype.getWrapperEvent=function(r,n,i){return qt(qt({},r),{deltaX:-n,deltaY:-i})},t}(G3),uIe=function(e){var t=0,r=e.children;return r==null||r.forEach(function(n){t+=n.height||0}),t},Qht=function(e,t,r,n,i){var a=0,o=e+(t-i)/2,s=e+(t+i)/2,l=r+n;return e+i>=l?a=e:l<s?a=r+n-i:r>o?e+t-r>i?a=r:a=e+t-i:a=e+(t-i)/2,a},cIe=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"cellType",{get:function(){return kr.ROW_CELL},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){var r;e.prototype.destroy.call(this),(r=this.gm)===null||r===void 0||r.destroy()},t.prototype.initCell=function(){e.prototype.initCell.call(this),this.drawBackgroundShape(),this.drawInteractiveBgShape(),this.drawInteractiveBorderShape(),this.drawTextShape(),this.drawConditionIconShapes(),this.drawTreeIcon(),this.drawTreeLeafNodeAlignDot(),this.drawRectBorder(),this.drawResizeAreaInLeaf(),this.drawActionIcons(),this.update()},t.prototype.getBackgroundColor=function(){var r=this.getCrossBackgroundColor(this.meta.rowIndex),n=r.backgroundColor,i=r.backgroundColorOpacity;return this.getBackgroundColorByCondition(n,i)},t.prototype.drawInteractiveBorderShape=function(){var r=2;this.stateShapes.set("interactiveBorderShape",Vh(this,this.getInteractiveBorderShapeStyle(r),{visible:!1}))},t.prototype.drawInteractiveBgShape=function(){this.stateShapes.set("interactiveBgShape",Vh(this,qt({},this.getCellArea()),{visible:!1}))},t.prototype.showTreeIcon=function(){return this.spreadsheet.isHierarchyTreeType()&&!this.meta.isLeaf},t.prototype.showTreeLeafNodeAlignDot=function(){var r;return((r=this.spreadsheet.options.style)===null||r===void 0?void 0:r.showTreeLeafNodeAlignDot)&&this.spreadsheet.isHierarchyTreeType()},t.prototype.getParentTreeIconCfg=function(){if(!(!this.showTreeLeafNodeAlignDot()||!this.spreadsheet.isHierarchyTreeType()||!this.meta.isLeaf))return ai(this.meta,"parent.belongsCell.treeIcon.cfg")},t.prototype.drawTreeIcon=function(){var r=this;if(this.showTreeIcon()){var n=this.meta,i=n.isCollapsed,a=n.id,o=n.hierarchy,s=this.getContentArea().x,l=this.getTextStyle().fill,u=this.getStyle().icon.size,c=this.getContentIndent(),f=s+c,d=this.getIconYPosition();this.treeIcon=Mht(this,{x:f,y:d,width:u,height:u},l,i,function(){if(!Ul()){if(!i){var v=r.spreadsheet.store.get("scrollY"),g=r.headerConfig.viewportHeight||0,x=uIe(r.meta),w=o.height-x;if(v>0&&v+g>w){var S=w-g;r.spreadsheet.store.set("scrollY",S>0?S:0)}}r.spreadsheet.emit(Re.ROW_CELL_COLLAPSE_TREE_ROWS,{id:a,isCollapsed:!i,node:r.meta})}}),Ul()&&(this.gm=new Kht(this,{gestures:["Tap"]}),this.gm.on("tap",function(){r.spreadsheet.emit(Re.ROW_CELL_COLLAPSE_TREE_ROWS,{id:a,isCollapsed:!i,node:r.meta})}))}},t.prototype.drawTreeLeafNodeAlignDot=function(){var r=this.getParentTreeIconCfg();if(r){var n=this.getStyle().icon,i=n.size,a=n.margin,o=r.x+i+a.right,s=this.getTextPosition().y,l=this.getTextStyle(),u=l.fill,c=l.fontSize,f=i/5;this.treeLeafNodeAlignDot=Aht(this,{x:o+i/2,y:s+(c-f)/2,r:f,fill:u,fillOpacity:.3})}},t.prototype.isBolderText=function(){var r=this.meta,n=r.isLeaf,i=r.isTotals,a=r.level;return!n&&a===0||i},t.prototype.drawTextShape=function(){e.prototype.drawTextShape.call(this),this.drawLinkField(this.meta)},t.prototype.drawRectBorder=function(){var r=this,n=this.getCellArea().x,i=this.getContentIndent(),a=this.spreadsheet.isHierarchyTreeType()?n:n+i;[yl.BOTTOM,yl.LEFT].forEach(function(o){var s=S_(o,qt(qt({},r.getCellArea()),{x:a}),r.getStyle().cell),l=s.position,u=s.style;hu(r,l,u)})},t.prototype.getResizeClipAreaBBox=function(){var r=this.headerConfig,n=r.width,i=r.viewportHeight;return{x:0,y:0,width:n,height:i}},t.prototype.drawResizeAreaInLeaf=function(){if(!(!this.meta.isLeaf||!this.shouldDrawResizeAreaByType("rowCellVertical",this))){var r=this.getCellArea(),n=r.x,i=r.y,a=r.width,o=r.height,s=this.getResizeAreaStyle(),l=N2(this.spreadsheet,yb),u=this.headerConfig,c=u.position,f=u.seriesNumberWidth,d=u.width,v=u.scrollX,g=u.scrollY,x={x:n+f,y:i+o-s.size/2,width:a,height:s.size},w=this.getResizeClipAreaBBox();if(L8(x,w,{scrollX:v,scrollY:g})){var S=(c==null?void 0:c.x)+n-v+f,M=(c==null?void 0:c.y)+i-g,R=this.spreadsheet.isFrozenRowHeader()?d-f-(n-v):a;l.addShape("rect",{attrs:qt(qt({},CS({id:this.meta.id,theme:s,type:jf.Vertical,effect:ic.Cell,offsetX:S,offsetY:M,width:a,height:o,meta:this.meta})),{x:S,y:M+o-s.size/2,width:R})})}}},t.prototype.getContentIndent=function(){if(!this.spreadsheet.isHierarchyTreeType())return 0;for(var r=this.getStyle(),n=r.icon,i=r.cell,a=n.size+n.margin.right,o=this.meta.parent,s=0;o;)o.height!==0&&(s+=a),o=o.parent;return this.showTreeLeafNodeAlignDot()&&(s+=this.isTreeLevel()?0:i.padding.right+n.margin.right),s},t.prototype.getTextIndent=function(){var r=this.getStyle().icon,n=r.size,i=r.margin,a=this.getContentIndent(),o=this.showTreeIcon()||this.isTreeLevel()&&this.showTreeLeafNodeAlignDot()?n+i.right:0;return a+o},t.prototype.isTreeLevel=function(){return Hu(ai(this.meta,"parent.children"),function(r){return!r.isLeaf})},t.prototype.getIconPosition=function(){if(!this.textShape)return{x:0,y:0};var r=this.textShape.cfg.attrs,n=r.x,i=r.y,a=r.textAlign,o=this.getStyle().icon.margin.left;return a==="left"?{x:n+this.actualTextWidth+o,y:i}:a==="right"?{x:n+o,y:i}:{x:n+this.actualTextWidth/2+o,y:i}},t.prototype.getMaxTextWidth=function(){var r=this.getContentArea().width;return r-this.getTextIndent()-this.getActionIconsWidth()},t.prototype.getTextArea=function(){var r=this.getContentArea(),n=this.getTextIndent();return qt(qt({},r),{x:r.x+n,width:r.width-n})},t.prototype.getAdjustTextAreaHeight=function(r,n,i){var a=r.height;return!this.spreadsheet.facet.vScrollBar&&r.y+r.height>n+i&&(a=n+i-r.y),a},t.prototype.calculateTextY=function(r){var n=r.textArea,i=r.adjustTextAreaHeight,a=this.headerConfig,o=a.scrollY,s=a.viewportHeight,l=this.getTextStyle().fontSize;return Qht(n.y,i,o,s,l)},t.prototype.getTextPosition=function(){var r=this.getTextArea(),n=this.headerConfig,i=n.scrollY,a=n.viewportHeight,o=this.getAdjustTextAreaHeight(r,i,a),s=this.calculateTextY({textArea:r,adjustTextAreaHeight:o}),l=F2(r,this.getTextStyle(),0,this.getIconStyle(),this.getActionIconsCount()).text.x;return{x:l,y:s}},t.prototype.getIconYPosition=function(){var r=this.getTextPosition().y,n=this.getStyle().icon.size,i=this.getTextStyle().fontSize;return r+(i-n)/2},t}(D8),k2=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.handleRestOptions=function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=ur(r),a=i[0],o=i.slice(1);e.prototype.handleRestOptions.call(this,a,o),this.frozenRowCell=o[0]},t.prototype.getAdjustTextAreaHeight=function(r,n,i){var a=r.y-this.getFrozenFirstRowHeight(),o=r.height;return!this.spreadsheet.facet.vScrollBar&&a+r.height>n+i&&(o=n+i-a),o},t.prototype.calculateTextY=function(r){var n=r.textArea,i=r.adjustTextAreaHeight,a=this.headerConfig,o=a.scrollY,s=a.viewportHeight,l=this.getTextStyle().fontSize;return Qht(n.y,i,o+this.getFrozenFirstRowHeight(),s,l)},t.prototype.getResizeClipAreaBBox=function(){return qt(qt({},e.prototype.getResizeClipAreaBBox.call(this)),{y:this.getFrozenFirstRowHeight()})},t.prototype.getFrozenFirstRowHeight=function(){var r;if(this.frozenRowCell)return 0;var n=this.spreadsheet,i=n.facet,a=n.options,o=wb(a,(r=i==null?void 0:i.layoutResult)===null||r===void 0?void 0:r.rowNodes).frozenRowHeight;return o},t}(cIe),Jht=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.initCell=function(){this.drawBackgroundShape(),this.drawRectBorder(),this.drawTextShape()},t.prototype.getTextStyle=function(){var r;return(r=this.getStyle())===null||r===void 0?void 0:r.seriesText},t.prototype.getTextPosition=function(){return e.prototype.getTextPosition.call(this)},t.prototype.getActionIconsCount=function(){return 0},t.prototype.getIconStyle=function(){},t.prototype.drawResizeAreaInLeaf=function(){},t.prototype.update=function(){},t.prototype.findFieldCondition=function(){},t.prototype.mappingValue=function(){},t}(k2),xI=function(e){return[Nu.META,Nu.CONTROL].includes(e.key)},tft=function(e){return e.ctrlKey||e.metaKey},Jp=function(e){var t=e.getMeta(),r=t||{},n=r.id,i=r.colIndex,a=r.rowIndex,o=r.rowQuery;return{id:n,colIndex:i,rowIndex:a,type:e.cellType,rowQuery:o}},hIe=function(e,t){var r=e.interaction;r.changeState({stateName:Dn.SELECTED,cells:t}),e.emit(Re.GLOBAL_SELECTED,r.getActiveCells())};function x5(e,t){var r=Math.min(e.rowIndex,t.rowIndex),n=Math.max(e.rowIndex,t.rowIndex),i=Math.min(e.colIndex,t.colIndex),a=Math.max(e.colIndex,t.colIndex);return{start:{rowIndex:r,colIndex:i},end:{rowIndex:n,colIndex:a}}}function fIe(e,t){var r=t.interaction,n=t.facet,i=t.options;if(t.isTableMode()){if(!i.showSeriesNumber)return[];var a=n.layoutResult.colLeafNodes[0].id,o=B2(String(e.rowIndex),a),s=[],l=r.getAllCells().find(function(u){return u.getMeta().id===o});return l&&l instanceof qht&&s.push(l),s}return M8(e.rowId,r.getAllRowHeaderCells(),t.isHierarchyTreeType())}var F8=function(e,t){var r=e.getSelectedCellHighlight(),n=r.colHeader,i=r.rowHeader;n&&e.updateCells(e.getAllColHeaderCells()),i&&e.updateCells(e.getAllRowHeaderCells()),t()},eft=function(e){var t=e.store.get("visibleActionIcons"),r=e.interaction.getInteractedCells(),n=e.interaction.getState().cells;if(Dr(r)&&Dr(n)&&Dr(t))return!1;if(bi(t,function(a){a.set("visible",!1)}),e.store.set("visibleActionIcons",[]),bi(r,function(a){a.hideInteractionShape()}),e.interaction.resetState(),e.options.interaction.selectedCellsSpotlight){var i=e.interaction.getPanelGroupAllUnSelectedDataCells()||[];bi(i,function(a){a.clearUnselectedState()})}return!0},dIe=function(e,t){var r=t==null?void 0:t.stateName;e.interaction.isEqualStateName(r)||(eft(e),e.hideTooltip(),e.store.set(XB,t))},pIe=function(e,t,r){var n,i,a=r.facet,o=a.panelBBox.width,s=a==null?void 0:a.frozenGroupInfo,l=(n=s==null?void 0:s.frozenCol.width)!==null&&n!==void 0?n:0,u=(i=s==null?void 0:s.frozenTrailingCol.width)!==null&&i!==void 0?i:0,c=a.layoutResult.colLeafNodes[e];return t===zl.SCROLL_UP?c.x-l:c.x+c.width-(o-u)},vIe=function(e,t,r){var n,i,a=r.facet,o=a.viewCellHeights.getCellOffsetY,s=a.panelBBox.height,l=o(e+1);if(Sl(l))return 0;var u=a==null?void 0:a.frozenGroupInfo,c=(n=u==null?void 0:u.frozenRow.height)!==null&&n!==void 0?n:0,f=(i=u==null?void 0:u.frozenTrailingRow.height)!==null&&i!==void 0?i:0;return t===zl.SCROLL_UP?o(e)-c:l-(s-f)};/*!
 *  decimal.js v10.4.3
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2022 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */var gx=9e15,O0=1e9,b5="0123456789abcdef",bI="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",EI="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",E5={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-gx,maxE:gx,crypto:!1},rft,cg,Ei=!0,AL="[DecimalError] ",m0=AL+"Invalid argument: ",nft=AL+"Precision limit exceeded",ift=AL+"crypto unavailable",aft="[object Decimal]",Vu=Math.floor,gl=Math.pow,gIe=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,mIe=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,yIe=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,oft=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,jd=1e7,ii=7,_Ie=9007199254740991,xIe=bI.length-1,w5=EI.length-1,gr={toStringTag:aft};gr.absoluteValue=gr.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),Gn(e)};gr.ceil=function(){return Gn(new this.constructor(this),this.e+1,2)};gr.clampedTo=gr.clamp=function(e,t){var r,n=this,i=n.constructor;if(e=new i(e),t=new i(t),!e.s||!t.s)return new i(NaN);if(e.gt(t))throw Error(m0+t);return r=n.cmp(e),r<0?e:n.cmp(t)>0?t:new i(n)};gr.comparedTo=gr.cmp=function(e){var t,r,n,i,a=this,o=a.d,s=(e=new a.constructor(e)).d,l=a.s,u=e.s;if(!o||!s)return!l||!u?NaN:l!==u?l:o===s?0:!o^l<0?1:-1;if(!o[0]||!s[0])return o[0]?l:s[0]?-u:0;if(l!==u)return l;if(a.e!==e.e)return a.e>e.e^l<0?1:-1;for(n=o.length,i=s.length,t=0,r=n<i?n:i;t<r;++t)if(o[t]!==s[t])return o[t]>s[t]^l<0?1:-1;return n===i?0:n>i^l<0?1:-1};gr.cosine=gr.cos=function(){var e,t,r=this,n=r.constructor;return r.d?r.d[0]?(e=n.precision,t=n.rounding,n.precision=e+Math.max(r.e,r.sd())+ii,n.rounding=1,r=bIe(n,hft(n,r)),n.precision=e,n.rounding=t,Gn(cg==2||cg==3?r.neg():r,e,t,!0)):new n(1):new n(NaN)};gr.cubeRoot=gr.cbrt=function(){var e,t,r,n,i,a,o,s,l,u,c=this,f=c.constructor;if(!c.isFinite()||c.isZero())return new f(c);for(Ei=!1,a=c.s*gl(c.s*c,1/3),!a||Math.abs(a)==1/0?(r=fu(c.d),e=c.e,(a=(e-r.length+1)%3)&&(r+=a==1||a==-2?"0":"00"),a=gl(r,1/3),e=Vu((e+1)/3)-(e%3==(e<0?-1:2)),a==1/0?r="5e"+e:(r=a.toExponential(),r=r.slice(0,r.indexOf("e")+1)+e),n=new f(r),n.s=c.s):n=new f(a.toString()),o=(e=f.precision)+3;;)if(s=n,l=s.times(s).times(s),u=l.plus(c),n=_o(u.plus(c).times(s),u.plus(l),o+2,1),fu(s.d).slice(0,o)===(r=fu(n.d)).slice(0,o))if(r=r.slice(o-3,o+1),r=="9999"||!i&&r=="4999"){if(!i&&(Gn(s,e+1,0),s.times(s).times(s).eq(c))){n=s;break}o+=4,i=1}else{(!+r||!+r.slice(1)&&r.charAt(0)=="5")&&(Gn(n,e+1,1),t=!n.times(n).times(n).eq(c));break}return Ei=!0,Gn(n,e,f.rounding,t)};gr.decimalPlaces=gr.dp=function(){var e,t=this.d,r=NaN;if(t){if(e=t.length-1,r=(e-Vu(this.e/ii))*ii,e=t[e],e)for(;e%10==0;e/=10)r--;r<0&&(r=0)}return r};gr.dividedBy=gr.div=function(e){return _o(this,new this.constructor(e))};gr.dividedToIntegerBy=gr.divToInt=function(e){var t=this,r=t.constructor;return Gn(_o(t,new r(e),0,1,1),r.precision,r.rounding)};gr.equals=gr.eq=function(e){return this.cmp(e)===0};gr.floor=function(){return Gn(new this.constructor(this),this.e+1,3)};gr.greaterThan=gr.gt=function(e){return this.cmp(e)>0};gr.greaterThanOrEqualTo=gr.gte=function(e){var t=this.cmp(e);return t==1||t===0};gr.hyperbolicCosine=gr.cosh=function(){var e,t,r,n,i,a=this,o=a.constructor,s=new o(1);if(!a.isFinite())return new o(a.s?1/0:NaN);if(a.isZero())return s;r=o.precision,n=o.rounding,o.precision=r+Math.max(a.e,a.sd())+4,o.rounding=1,i=a.d.length,i<32?(e=Math.ceil(i/3),t=(1/RL(4,e)).toString()):(e=16,t="2.3283064365386962890625e-10"),a=Sb(o,1,a.times(t),new o(1),!0);for(var l,u=e,c=new o(8);u--;)l=a.times(a),a=s.minus(l.times(c.minus(l.times(c))));return Gn(a,o.precision=r,o.rounding=n,!0)};gr.hyperbolicSine=gr.sinh=function(){var e,t,r,n,i=this,a=i.constructor;if(!i.isFinite()||i.isZero())return new a(i);if(t=a.precision,r=a.rounding,a.precision=t+Math.max(i.e,i.sd())+4,a.rounding=1,n=i.d.length,n<3)i=Sb(a,2,i,i,!0);else{e=1.4*Math.sqrt(n),e=e>16?16:e|0,i=i.times(1/RL(5,e)),i=Sb(a,2,i,i,!0);for(var o,s=new a(5),l=new a(16),u=new a(20);e--;)o=i.times(i),i=i.times(s.plus(o.times(l.times(o).plus(u))))}return a.precision=t,a.rounding=r,Gn(i,t,r,!0)};gr.hyperbolicTangent=gr.tanh=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+7,n.rounding=1,_o(r.sinh(),r.cosh(),n.precision=e,n.rounding=t)):new n(r.s)};gr.inverseCosine=gr.acos=function(){var e,t=this,r=t.constructor,n=t.abs().cmp(1),i=r.precision,a=r.rounding;return n!==-1?n===0?t.isNeg()?Ud(r,i,a):new r(0):new r(NaN):t.isZero()?Ud(r,i+4,a).times(.5):(r.precision=i+6,r.rounding=1,t=t.asin(),e=Ud(r,i+4,a).times(.5),r.precision=i,r.rounding=a,e.minus(t))};gr.inverseHyperbolicCosine=gr.acosh=function(){var e,t,r=this,n=r.constructor;return r.lte(1)?new n(r.eq(1)?0:NaN):r.isFinite()?(e=n.precision,t=n.rounding,n.precision=e+Math.max(Math.abs(r.e),r.sd())+4,n.rounding=1,Ei=!1,r=r.times(r).minus(1).sqrt().plus(r),Ei=!0,n.precision=e,n.rounding=t,r.ln()):new n(r)};gr.inverseHyperbolicSine=gr.asinh=function(){var e,t,r=this,n=r.constructor;return!r.isFinite()||r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+2*Math.max(Math.abs(r.e),r.sd())+6,n.rounding=1,Ei=!1,r=r.times(r).plus(1).sqrt().plus(r),Ei=!0,n.precision=e,n.rounding=t,r.ln())};gr.inverseHyperbolicTangent=gr.atanh=function(){var e,t,r,n,i=this,a=i.constructor;return i.isFinite()?i.e>=0?new a(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(e=a.precision,t=a.rounding,n=i.sd(),Math.max(n,e)<2*-i.e-1?Gn(new a(i),e,t,!0):(a.precision=r=n-i.e,i=_o(i.plus(1),new a(1).minus(i),r+e,1),a.precision=e+4,a.rounding=1,i=i.ln(),a.precision=e,a.rounding=t,i.times(.5))):new a(NaN)};gr.inverseSine=gr.asin=function(){var e,t,r,n,i=this,a=i.constructor;return i.isZero()?new a(i):(t=i.abs().cmp(1),r=a.precision,n=a.rounding,t!==-1?t===0?(e=Ud(a,r+4,n).times(.5),e.s=i.s,e):new a(NaN):(a.precision=r+6,a.rounding=1,i=i.div(new a(1).minus(i.times(i)).sqrt().plus(1)).atan(),a.precision=r,a.rounding=n,i.times(2)))};gr.inverseTangent=gr.atan=function(){var e,t,r,n,i,a,o,s,l,u=this,c=u.constructor,f=c.precision,d=c.rounding;if(u.isFinite()){if(u.isZero())return new c(u);if(u.abs().eq(1)&&f+4<=w5)return o=Ud(c,f+4,d).times(.25),o.s=u.s,o}else{if(!u.s)return new c(NaN);if(f+4<=w5)return o=Ud(c,f+4,d).times(.5),o.s=u.s,o}for(c.precision=s=f+10,c.rounding=1,r=Math.min(28,s/ii+2|0),e=r;e;--e)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(Ei=!1,t=Math.ceil(s/ii),n=1,l=u.times(u),o=new c(u),i=u;e!==-1;)if(i=i.times(l),a=o.minus(i.div(n+=2)),i=i.times(l),o=a.plus(i.div(n+=2)),o.d[t]!==void 0)for(e=t;o.d[e]===a.d[e]&&e--;);return r&&(o=o.times(2<<r-1)),Ei=!0,Gn(o,c.precision=f,c.rounding=d,!0)};gr.isFinite=function(){return!!this.d};gr.isInteger=gr.isInt=function(){return!!this.d&&Vu(this.e/ii)>this.d.length-2};gr.isNaN=function(){return!this.s};gr.isNegative=gr.isNeg=function(){return this.s<0};gr.isPositive=gr.isPos=function(){return this.s>0};gr.isZero=function(){return!!this.d&&this.d[0]===0};gr.lessThan=gr.lt=function(e){return this.cmp(e)<0};gr.lessThanOrEqualTo=gr.lte=function(e){return this.cmp(e)<1};gr.logarithm=gr.log=function(e){var t,r,n,i,a,o,s,l,u=this,c=u.constructor,f=c.precision,d=c.rounding,v=5;if(e==null)e=new c(10),t=!0;else{if(e=new c(e),r=e.d,e.s<0||!r||!r[0]||e.eq(1))return new c(NaN);t=e.eq(10)}if(r=u.d,u.s<0||!r||!r[0]||u.eq(1))return new c(r&&!r[0]?-1/0:u.s!=1?NaN:r?0:1/0);if(t)if(r.length>1)a=!0;else{for(i=r[0];i%10===0;)i/=10;a=i!==1}if(Ei=!1,s=f+v,o=Gm(u,s),n=t?wI(c,s+10):Gm(e,s),l=_o(o,n,s,1),SS(l.d,i=f,d))do if(s+=10,o=Gm(u,s),n=t?wI(c,s+10):Gm(e,s),l=_o(o,n,s,1),!a){+fu(l.d).slice(i+1,i+15)+1==1e14&&(l=Gn(l,f+1,0));break}while(SS(l.d,i+=10,d));return Ei=!0,Gn(l,f,d)};gr.minus=gr.sub=function(e){var t,r,n,i,a,o,s,l,u,c,f,d,v=this,g=v.constructor;if(e=new g(e),!v.d||!e.d)return!v.s||!e.s?e=new g(NaN):v.d?e.s=-e.s:e=new g(e.d||v.s!==e.s?v:NaN),e;if(v.s!=e.s)return e.s=-e.s,v.plus(e);if(u=v.d,d=e.d,s=g.precision,l=g.rounding,!u[0]||!d[0]){if(d[0])e.s=-e.s;else if(u[0])e=new g(v);else return new g(l===3?-0:0);return Ei?Gn(e,s,l):e}if(r=Vu(e.e/ii),c=Vu(v.e/ii),u=u.slice(),a=c-r,a){for(f=a<0,f?(t=u,a=-a,o=d.length):(t=d,r=c,o=u.length),n=Math.max(Math.ceil(s/ii),o)+2,a>n&&(a=n,t.length=1),t.reverse(),n=a;n--;)t.push(0);t.reverse()}else{for(n=u.length,o=d.length,f=n<o,f&&(o=n),n=0;n<o;n++)if(u[n]!=d[n]){f=u[n]<d[n];break}a=0}for(f&&(t=u,u=d,d=t,e.s=-e.s),o=u.length,n=d.length-o;n>0;--n)u[o++]=0;for(n=d.length;n>a;){if(u[--n]<d[n]){for(i=n;i&&u[--i]===0;)u[i]=jd-1;--u[i],u[n]+=jd}u[n]-=d[n]}for(;u[--o]===0;)u.pop();for(;u[0]===0;u.shift())--r;return u[0]?(e.d=u,e.e=ML(u,r),Ei?Gn(e,s,l):e):new g(l===3?-0:0)};gr.modulo=gr.mod=function(e){var t,r=this,n=r.constructor;return e=new n(e),!r.d||!e.s||e.d&&!e.d[0]?new n(NaN):!e.d||r.d&&!r.d[0]?Gn(new n(r),n.precision,n.rounding):(Ei=!1,n.modulo==9?(t=_o(r,e.abs(),0,3,1),t.s*=e.s):t=_o(r,e,0,n.modulo,1),t=t.times(e),Ei=!0,r.minus(t))};gr.naturalExponential=gr.exp=function(){return C5(this)};gr.naturalLogarithm=gr.ln=function(){return Gm(this)};gr.negated=gr.neg=function(){var e=new this.constructor(this);return e.s=-e.s,Gn(e)};gr.plus=gr.add=function(e){var t,r,n,i,a,o,s,l,u,c,f=this,d=f.constructor;if(e=new d(e),!f.d||!e.d)return!f.s||!e.s?e=new d(NaN):f.d||(e=new d(e.d||f.s===e.s?f:NaN)),e;if(f.s!=e.s)return e.s=-e.s,f.minus(e);if(u=f.d,c=e.d,s=d.precision,l=d.rounding,!u[0]||!c[0])return c[0]||(e=new d(f)),Ei?Gn(e,s,l):e;if(a=Vu(f.e/ii),n=Vu(e.e/ii),u=u.slice(),i=a-n,i){for(i<0?(r=u,i=-i,o=c.length):(r=c,n=a,o=u.length),a=Math.ceil(s/ii),o=a>o?a+1:o+1,i>o&&(i=o,r.length=1),r.reverse();i--;)r.push(0);r.reverse()}for(o=u.length,i=c.length,o-i<0&&(i=o,r=c,c=u,u=r),t=0;i;)t=(u[--i]=u[i]+c[i]+t)/jd|0,u[i]%=jd;for(t&&(u.unshift(t),++n),o=u.length;u[--o]==0;)u.pop();return e.d=u,e.e=ML(u,n),Ei?Gn(e,s,l):e};gr.precision=gr.sd=function(e){var t,r=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(m0+e);return r.d?(t=sft(r.d),e&&r.e+1>t&&(t=r.e+1)):t=NaN,t};gr.round=function(){var e=this,t=e.constructor;return Gn(new t(e),e.e+1,t.rounding)};gr.sine=gr.sin=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+Math.max(r.e,r.sd())+ii,n.rounding=1,r=wIe(n,hft(n,r)),n.precision=e,n.rounding=t,Gn(cg>2?r.neg():r,e,t,!0)):new n(NaN)};gr.squareRoot=gr.sqrt=function(){var e,t,r,n,i,a,o=this,s=o.d,l=o.e,u=o.s,c=o.constructor;if(u!==1||!s||!s[0])return new c(!u||u<0&&(!s||s[0])?NaN:s?o:1/0);for(Ei=!1,u=Math.sqrt(+o),u==0||u==1/0?(t=fu(s),(t.length+l)%2==0&&(t+="0"),u=Math.sqrt(t),l=Vu((l+1)/2)-(l<0||l%2),u==1/0?t="5e"+l:(t=u.toExponential(),t=t.slice(0,t.indexOf("e")+1)+l),n=new c(t)):n=new c(u.toString()),r=(l=c.precision)+3;;)if(a=n,n=a.plus(_o(o,a,r+2,1)).times(.5),fu(a.d).slice(0,r)===(t=fu(n.d)).slice(0,r))if(t=t.slice(r-3,r+1),t=="9999"||!i&&t=="4999"){if(!i&&(Gn(a,l+1,0),a.times(a).eq(o))){n=a;break}r+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(Gn(n,l+1,1),e=!n.times(n).eq(o));break}return Ei=!0,Gn(n,l,c.rounding,e)};gr.tangent=gr.tan=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+10,n.rounding=1,r=r.sin(),r.s=1,r=_o(r,new n(1).minus(r.times(r)).sqrt(),e+10,0),n.precision=e,n.rounding=t,Gn(cg==2||cg==4?r.neg():r,e,t,!0)):new n(NaN)};gr.times=gr.mul=function(e){var t,r,n,i,a,o,s,l,u,c=this,f=c.constructor,d=c.d,v=(e=new f(e)).d;if(e.s*=c.s,!d||!d[0]||!v||!v[0])return new f(!e.s||d&&!d[0]&&!v||v&&!v[0]&&!d?NaN:!d||!v?e.s/0:e.s*0);for(r=Vu(c.e/ii)+Vu(e.e/ii),l=d.length,u=v.length,l<u&&(a=d,d=v,v=a,o=l,l=u,u=o),a=[],o=l+u,n=o;n--;)a.push(0);for(n=u;--n>=0;){for(t=0,i=l+n;i>n;)s=a[i]+v[n]*d[i-n-1]+t,a[i--]=s%jd|0,t=s/jd|0;a[i]=(a[i]+t)%jd|0}for(;!a[--o];)a.pop();return t?++r:a.shift(),e.d=a,e.e=ML(a,r),Ei?Gn(e,f.precision,f.rounding):e};gr.toBinary=function(e,t){return B8(this,2,e,t)};gr.toDecimalPlaces=gr.toDP=function(e,t){var r=this,n=r.constructor;return r=new n(r),e===void 0?r:(sh(e,0,O0),t===void 0?t=n.rounding:sh(t,0,8),Gn(r,e+r.e+1,t))};gr.toExponential=function(e,t){var r,n=this,i=n.constructor;return e===void 0?r=sv(n,!0):(sh(e,0,O0),t===void 0?t=i.rounding:sh(t,0,8),n=Gn(new i(n),e+1,t),r=sv(n,!0,e+1)),n.isNeg()&&!n.isZero()?"-"+r:r};gr.toFixed=function(e,t){var r,n,i=this,a=i.constructor;return e===void 0?r=sv(i):(sh(e,0,O0),t===void 0?t=a.rounding:sh(t,0,8),n=Gn(new a(i),e+i.e+1,t),r=sv(n,!1,e+n.e+1)),i.isNeg()&&!i.isZero()?"-"+r:r};gr.toFraction=function(e){var t,r,n,i,a,o,s,l,u,c,f,d,v=this,g=v.d,x=v.constructor;if(!g)return new x(v);if(u=r=new x(1),n=l=new x(0),t=new x(n),a=t.e=sft(g)-v.e-1,o=a%ii,t.d[0]=gl(10,o<0?ii+o:o),e==null)e=a>0?t:u;else{if(s=new x(e),!s.isInt()||s.lt(u))throw Error(m0+s);e=s.gt(t)?a>0?t:u:s}for(Ei=!1,s=new x(fu(g)),c=x.precision,x.precision=a=g.length*ii*2;f=_o(s,t,0,1,1),i=r.plus(f.times(n)),i.cmp(e)!=1;)r=n,n=i,i=u,u=l.plus(f.times(i)),l=i,i=t,t=s.minus(f.times(i)),s=i;return i=_o(e.minus(r),n,0,1,1),l=l.plus(i.times(u)),r=r.plus(i.times(n)),l.s=u.s=v.s,d=_o(u,n,a,1).minus(v).abs().cmp(_o(l,r,a,1).minus(v).abs())<1?[u,n]:[l,r],x.precision=c,Ei=!0,d};gr.toHexadecimal=gr.toHex=function(e,t){return B8(this,16,e,t)};gr.toNearest=function(e,t){var r=this,n=r.constructor;if(r=new n(r),e==null){if(!r.d)return r;e=new n(1),t=n.rounding}else{if(e=new n(e),t===void 0?t=n.rounding:sh(t,0,8),!r.d)return e.s?r:e;if(!e.d)return e.s&&(e.s=r.s),e}return e.d[0]?(Ei=!1,r=_o(r,e,0,t,1).times(e),Ei=!0,Gn(r)):(e.s=r.s,r=e),r};gr.toNumber=function(){return+this};gr.toOctal=function(e,t){return B8(this,8,e,t)};gr.toPower=gr.pow=function(e){var t,r,n,i,a,o,s=this,l=s.constructor,u=+(e=new l(e));if(!s.d||!e.d||!s.d[0]||!e.d[0])return new l(gl(+s,u));if(s=new l(s),s.eq(1))return s;if(n=l.precision,a=l.rounding,e.eq(1))return Gn(s,n,a);if(t=Vu(e.e/ii),t>=e.d.length-1&&(r=u<0?-u:u)<=_Ie)return i=lft(l,s,r,n),e.s<0?new l(1).div(i):Gn(i,n,a);if(o=s.s,o<0){if(t<e.d.length-1)return new l(NaN);if(e.d[t]&1||(o=1),s.e==0&&s.d[0]==1&&s.d.length==1)return s.s=o,s}return r=gl(+s,u),t=r==0||!isFinite(r)?Vu(u*(Math.log("0."+fu(s.d))/Math.LN10+s.e+1)):new l(r+"").e,t>l.maxE+1||t<l.minE-1?new l(t>0?o/0:0):(Ei=!1,l.rounding=s.s=1,r=Math.min(12,(t+"").length),i=C5(e.times(Gm(s,n+r)),n),i.d&&(i=Gn(i,n+5,1),SS(i.d,n,a)&&(t=n+10,i=Gn(C5(e.times(Gm(s,t+r)),t),t+5,1),+fu(i.d).slice(n+1,n+15)+1==1e14&&(i=Gn(i,n+1,0)))),i.s=o,Ei=!0,l.rounding=a,Gn(i,n,a))};gr.toPrecision=function(e,t){var r,n=this,i=n.constructor;return e===void 0?r=sv(n,n.e<=i.toExpNeg||n.e>=i.toExpPos):(sh(e,1,O0),t===void 0?t=i.rounding:sh(t,0,8),n=Gn(new i(n),e,t),r=sv(n,e<=n.e||n.e<=i.toExpNeg,e)),n.isNeg()&&!n.isZero()?"-"+r:r};gr.toSignificantDigits=gr.toSD=function(e,t){var r=this,n=r.constructor;return e===void 0?(e=n.precision,t=n.rounding):(sh(e,1,O0),t===void 0?t=n.rounding:sh(t,0,8)),Gn(new n(r),e,t)};gr.toString=function(){var e=this,t=e.constructor,r=sv(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()&&!e.isZero()?"-"+r:r};gr.truncated=gr.trunc=function(){return Gn(new this.constructor(this),this.e+1,1)};gr.valueOf=gr.toJSON=function(){var e=this,t=e.constructor,r=sv(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()?"-"+r:r};function fu(e){var t,r,n,i=e.length-1,a="",o=e[0];if(i>0){for(a+=o,t=1;t<i;t++)n=e[t]+"",r=ii-n.length,r&&(a+=Pm(r)),a+=n;o=e[t],n=o+"",r=ii-n.length,r&&(a+=Pm(r))}else if(o===0)return"0";for(;o%10===0;)o/=10;return a+o}function sh(e,t,r){if(e!==~~e||e<t||e>r)throw Error(m0+e)}function SS(e,t,r,n){var i,a,o,s;for(a=e[0];a>=10;a/=10)--t;return--t<0?(t+=ii,i=0):(i=Math.ceil((t+1)/ii),t%=ii),a=gl(10,ii-t),s=e[i]%a|0,n==null?t<3?(t==0?s=s/100|0:t==1&&(s=s/10|0),o=r<4&&s==99999||r>3&&s==49999||s==5e4||s==0):o=(r<4&&s+1==a||r>3&&s+1==a/2)&&(e[i+1]/a/100|0)==gl(10,t-2)-1||(s==a/2||s==0)&&(e[i+1]/a/100|0)==0:t<4?(t==0?s=s/1e3|0:t==1?s=s/100|0:t==2&&(s=s/10|0),o=(n||r<4)&&s==9999||!n&&r>3&&s==4999):o=((n||r<4)&&s+1==a||!n&&r>3&&s+1==a/2)&&(e[i+1]/a/1e3|0)==gl(10,t-3)-1,o}function PM(e,t,r){for(var n,i=[0],a,o=0,s=e.length;o<s;){for(a=i.length;a--;)i[a]*=t;for(i[0]+=b5.indexOf(e.charAt(o++)),n=0;n<i.length;n++)i[n]>r-1&&(i[n+1]===void 0&&(i[n+1]=0),i[n+1]+=i[n]/r|0,i[n]%=r)}return i.reverse()}function bIe(e,t){var r,n,i;if(t.isZero())return t;n=t.d.length,n<32?(r=Math.ceil(n/3),i=(1/RL(4,r)).toString()):(r=16,i="2.3283064365386962890625e-10"),e.precision+=r,t=Sb(e,1,t.times(i),new e(1));for(var a=r;a--;){var o=t.times(t);t=o.times(o).minus(o).times(8).plus(1)}return e.precision-=r,t}var _o=function(){function e(n,i,a){var o,s=0,l=n.length;for(n=n.slice();l--;)o=n[l]*i+s,n[l]=o%a|0,s=o/a|0;return s&&n.unshift(s),n}function t(n,i,a,o){var s,l;if(a!=o)l=a>o?1:-1;else for(s=l=0;s<a;s++)if(n[s]!=i[s]){l=n[s]>i[s]?1:-1;break}return l}function r(n,i,a,o){for(var s=0;a--;)n[a]-=s,s=n[a]<i[a]?1:0,n[a]=s*o+n[a]-i[a];for(;!n[0]&&n.length>1;)n.shift()}return function(n,i,a,o,s,l){var u,c,f,d,v,g,x,w,S,M,R,I,P,k,z,G,J,Z,X,et,at=n.constructor,wt=n.s==i.s?1:-1,Tt=n.d,vt=i.d;if(!Tt||!Tt[0]||!vt||!vt[0])return new at(!n.s||!i.s||(Tt?vt&&Tt[0]==vt[0]:!vt)?NaN:Tt&&Tt[0]==0||!vt?wt*0:wt/0);for(l?(v=1,c=n.e-i.e):(l=jd,v=ii,c=Vu(n.e/v)-Vu(i.e/v)),X=vt.length,J=Tt.length,S=new at(wt),M=S.d=[],f=0;vt[f]==(Tt[f]||0);f++);if(vt[f]>(Tt[f]||0)&&c--,a==null?(k=a=at.precision,o=at.rounding):s?k=a+(n.e-i.e)+1:k=a,k<0)M.push(1),g=!0;else{if(k=k/v+2|0,f=0,X==1){for(d=0,vt=vt[0],k++;(f<J||d)&&k--;f++)z=d*l+(Tt[f]||0),M[f]=z/vt|0,d=z%vt|0;g=d||f<J}else{for(d=l/(vt[0]+1)|0,d>1&&(vt=e(vt,d,l),Tt=e(Tt,d,l),X=vt.length,J=Tt.length),G=X,R=Tt.slice(0,X),I=R.length;I<X;)R[I++]=0;et=vt.slice(),et.unshift(0),Z=vt[0],vt[1]>=l/2&&++Z;do d=0,u=t(vt,R,X,I),u<0?(P=R[0],X!=I&&(P=P*l+(R[1]||0)),d=P/Z|0,d>1?(d>=l&&(d=l-1),x=e(vt,d,l),w=x.length,I=R.length,u=t(x,R,w,I),u==1&&(d--,r(x,X<w?et:vt,w,l))):(d==0&&(u=d=1),x=vt.slice()),w=x.length,w<I&&x.unshift(0),r(R,x,I,l),u==-1&&(I=R.length,u=t(vt,R,X,I),u<1&&(d++,r(R,X<I?et:vt,I,l))),I=R.length):u===0&&(d++,R=[0]),M[f++]=d,u&&R[0]?R[I++]=Tt[G]||0:(R=[Tt[G]],I=1);while((G++<J||R[0]!==void 0)&&k--);g=R[0]!==void 0}M[0]||M.shift()}if(v==1)S.e=c,rft=g;else{for(f=1,d=M[0];d>=10;d/=10)f++;S.e=f+c*v-1,Gn(S,s?a+S.e+1:a,o,g)}return S}}();function Gn(e,t,r,n){var i,a,o,s,l,u,c,f,d,v=e.constructor;t:if(t!=null){if(f=e.d,!f)return e;for(i=1,s=f[0];s>=10;s/=10)i++;if(a=t-i,a<0)a+=ii,o=t,c=f[d=0],l=c/gl(10,i-o-1)%10|0;else if(d=Math.ceil((a+1)/ii),s=f.length,d>=s)if(n){for(;s++<=d;)f.push(0);c=l=0,i=1,a%=ii,o=a-ii+1}else break t;else{for(c=s=f[d],i=1;s>=10;s/=10)i++;a%=ii,o=a-ii+i,l=o<0?0:c/gl(10,i-o-1)%10|0}if(n=n||t<0||f[d+1]!==void 0||(o<0?c:c%gl(10,i-o-1)),u=r<4?(l||n)&&(r==0||r==(e.s<0?3:2)):l>5||l==5&&(r==4||n||r==6&&(a>0?o>0?c/gl(10,i-o):0:f[d-1])%10&1||r==(e.s<0?8:7)),t<1||!f[0])return f.length=0,u?(t-=e.e+1,f[0]=gl(10,(ii-t%ii)%ii),e.e=-t||0):f[0]=e.e=0,e;if(a==0?(f.length=d,s=1,d--):(f.length=d+1,s=gl(10,ii-a),f[d]=o>0?(c/gl(10,i-o)%gl(10,o)|0)*s:0),u)for(;;)if(d==0){for(a=1,o=f[0];o>=10;o/=10)a++;for(o=f[0]+=s,s=1;o>=10;o/=10)s++;a!=s&&(e.e++,f[0]==jd&&(f[0]=1));break}else{if(f[d]+=s,f[d]!=jd)break;f[d--]=0,s=1}for(a=f.length;f[--a]===0;)f.pop()}return Ei&&(e.e>v.maxE?(e.d=null,e.e=NaN):e.e<v.minE&&(e.e=0,e.d=[0])),e}function sv(e,t,r){if(!e.isFinite())return cft(e);var n,i=e.e,a=fu(e.d),o=a.length;return t?(r&&(n=r-o)>0?a=a.charAt(0)+"."+a.slice(1)+Pm(n):o>1&&(a=a.charAt(0)+"."+a.slice(1)),a=a+(e.e<0?"e":"e+")+e.e):i<0?(a="0."+Pm(-i-1)+a,r&&(n=r-o)>0&&(a+=Pm(n))):i>=o?(a+=Pm(i+1-o),r&&(n=r-i-1)>0&&(a=a+"."+Pm(n))):((n=i+1)<o&&(a=a.slice(0,n)+"."+a.slice(n)),r&&(n=r-o)>0&&(i+1===o&&(a+="."),a+=Pm(n))),a}function ML(e,t){var r=e[0];for(t*=ii;r>=10;r/=10)t++;return t}function wI(e,t,r){if(t>xIe)throw Ei=!0,r&&(e.precision=r),Error(nft);return Gn(new e(bI),t,1,!0)}function Ud(e,t,r){if(t>w5)throw Error(nft);return Gn(new e(EI),t,r,!0)}function sft(e){var t=e.length-1,r=t*ii+1;if(t=e[t],t){for(;t%10==0;t/=10)r--;for(t=e[0];t>=10;t/=10)r++}return r}function Pm(e){for(var t="";e--;)t+="0";return t}function lft(e,t,r,n){var i,a=new e(1),o=Math.ceil(n/ii+4);for(Ei=!1;;){if(r%2&&(a=a.times(t),TZ(a.d,o)&&(i=!0)),r=Vu(r/2),r===0){r=a.d.length-1,i&&a.d[r]===0&&++a.d[r];break}t=t.times(t),TZ(t.d,o)}return Ei=!0,a}function SZ(e){return e.d[e.d.length-1]&1}function uft(e,t,r){for(var n,i=new e(t[0]),a=0;++a<t.length;)if(n=new e(t[a]),n.s)i[r](n)&&(i=n);else{i=n;break}return i}function C5(e,t){var r,n,i,a,o,s,l,u=0,c=0,f=0,d=e.constructor,v=d.rounding,g=d.precision;if(!e.d||!e.d[0]||e.e>17)return new d(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:0/0);for(t==null?(Ei=!1,l=g):l=t,s=new d(.03125);e.e>-2;)e=e.times(s),f+=5;for(n=Math.log(gl(2,f))/Math.LN10*2+5|0,l+=n,r=a=o=new d(1),d.precision=l;;){if(a=Gn(a.times(e),l,1),r=r.times(++c),s=o.plus(_o(a,r,l,1)),fu(s.d).slice(0,l)===fu(o.d).slice(0,l)){for(i=f;i--;)o=Gn(o.times(o),l,1);if(t==null)if(u<3&&SS(o.d,l-n,v,u))d.precision=l+=10,r=a=s=new d(1),c=0,u++;else return Gn(o,d.precision=g,v,Ei=!0);else return d.precision=g,o}o=s}}function Gm(e,t){var r,n,i,a,o,s,l,u,c,f,d,v=1,g=10,x=e,w=x.d,S=x.constructor,M=S.rounding,R=S.precision;if(x.s<0||!w||!w[0]||!x.e&&w[0]==1&&w.length==1)return new S(w&&!w[0]?-1/0:x.s!=1?NaN:w?0:x);if(t==null?(Ei=!1,c=R):c=t,S.precision=c+=g,r=fu(w),n=r.charAt(0),Math.abs(a=x.e)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)x=x.times(e),r=fu(x.d),n=r.charAt(0),v++;a=x.e,n>1?(x=new S("0."+r),a++):x=new S(n+"."+r.slice(1))}else return u=wI(S,c+2,R).times(a+""),x=Gm(new S(n+"."+r.slice(1)),c-g).plus(u),S.precision=R,t==null?Gn(x,R,M,Ei=!0):x;for(f=x,l=o=x=_o(x.minus(1),x.plus(1),c,1),d=Gn(x.times(x),c,1),i=3;;){if(o=Gn(o.times(d),c,1),u=l.plus(_o(o,new S(i),c,1)),fu(u.d).slice(0,c)===fu(l.d).slice(0,c))if(l=l.times(2),a!==0&&(l=l.plus(wI(S,c+2,R).times(a+""))),l=_o(l,new S(v),c,1),t==null)if(SS(l.d,c-g,M,s))S.precision=c+=g,u=o=x=_o(f.minus(1),f.plus(1),c,1),d=Gn(x.times(x),c,1),i=s=1;else return Gn(l,S.precision=R,M,Ei=!0);else return S.precision=R,l;l=u,i+=2}}function cft(e){return String(e.s*e.s/0)}function S5(e,t){var r,n,i;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;t.charCodeAt(n)===48;n++);for(i=t.length;t.charCodeAt(i-1)===48;--i);if(t=t.slice(n,i),t){if(i-=n,e.e=r=r-n-1,e.d=[],n=(r+1)%ii,r<0&&(n+=ii),n<i){for(n&&e.d.push(+t.slice(0,n)),i-=ii;n<i;)e.d.push(+t.slice(n,n+=ii));t=t.slice(n),n=ii-t.length}else n-=i;for(;n--;)t+="0";e.d.push(+t),Ei&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function EIe(e,t){var r,n,i,a,o,s,l,u,c;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),oft.test(t))return S5(e,t)}else if(t==="Infinity"||t==="NaN")return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(mIe.test(t))r=16,t=t.toLowerCase();else if(gIe.test(t))r=2;else if(yIe.test(t))r=8;else throw Error(m0+t);for(a=t.search(/p/i),a>0?(l=+t.slice(a+1),t=t.substring(2,a)):t=t.slice(2),a=t.indexOf("."),o=a>=0,n=e.constructor,o&&(t=t.replace(".",""),s=t.length,a=s-a,i=lft(n,new n(r),a,a*2)),u=PM(t,r,jd),c=u.length-1,a=c;u[a]===0;--a)u.pop();return a<0?new n(e.s*0):(e.e=ML(u,c),e.d=u,Ei=!1,o&&(e=_o(e,i,s*4)),l&&(e=e.times(Math.abs(l)<54?gl(2,l):Qd.pow(2,l))),Ei=!0,e)}function wIe(e,t){var r,n=t.d.length;if(n<3)return t.isZero()?t:Sb(e,2,t,t);r=1.4*Math.sqrt(n),r=r>16?16:r|0,t=t.times(1/RL(5,r)),t=Sb(e,2,t,t);for(var i,a=new e(5),o=new e(16),s=new e(20);r--;)i=t.times(t),t=t.times(a.plus(i.times(o.times(i).minus(s))));return t}function Sb(e,t,r,n,i){var a,o,s,l,u=e.precision,c=Math.ceil(u/ii);for(Ei=!1,l=r.times(r),s=new e(n);;){if(o=_o(s.times(l),new e(t++*t++),u,1),s=i?n.plus(o):n.minus(o),n=_o(o.times(l),new e(t++*t++),u,1),o=s.plus(n),o.d[c]!==void 0){for(a=c;o.d[a]===s.d[a]&&a--;);if(a==-1)break}a=s,s=n,n=o,o=a}return Ei=!0,o.d.length=c+1,o}function RL(e,t){for(var r=e;--t;)r*=e;return r}function hft(e,t){var r,n=t.s<0,i=Ud(e,e.precision,1),a=i.times(.5);if(t=t.abs(),t.lte(a))return cg=n?4:1,t;if(r=t.divToInt(i),r.isZero())cg=n?3:2;else{if(t=t.minus(r.times(i)),t.lte(a))return cg=SZ(r)?n?2:3:n?4:1,t;cg=SZ(r)?n?1:4:n?3:2}return t.minus(i).abs()}function B8(e,t,r,n){var i,a,o,s,l,u,c,f,d,v=e.constructor,g=r!==void 0;if(g?(sh(r,1,O0),n===void 0?n=v.rounding:sh(n,0,8)):(r=v.precision,n=v.rounding),!e.isFinite())c=cft(e);else{for(c=sv(e),o=c.indexOf("."),g?(i=2,t==16?r=r*4-3:t==8&&(r=r*3-2)):i=t,o>=0&&(c=c.replace(".",""),d=new v(1),d.e=c.length-o,d.d=PM(sv(d),10,i),d.e=d.d.length),f=PM(c,10,i),a=l=f.length;f[--l]==0;)f.pop();if(!f[0])c=g?"0p+0":"0";else{if(o<0?a--:(e=new v(e),e.d=f,e.e=a,e=_o(e,d,r,n,0,i),f=e.d,a=e.e,u=rft),o=f[r],s=i/2,u=u||f[r+1]!==void 0,u=n<4?(o!==void 0||u)&&(n===0||n===(e.s<0?3:2)):o>s||o===s&&(n===4||u||n===6&&f[r-1]&1||n===(e.s<0?8:7)),f.length=r,u)for(;++f[--r]>i-1;)f[r]=0,r||(++a,f.unshift(1));for(l=f.length;!f[l-1];--l);for(o=0,c="";o<l;o++)c+=b5.charAt(f[o]);if(g){if(l>1)if(t==16||t==8){for(o=t==16?4:3,--l;l%o;l++)c+="0";for(f=PM(c,i,t),l=f.length;!f[l-1];--l);for(o=1,c="1.";o<l;o++)c+=b5.charAt(f[o])}else c=c.charAt(0)+"."+c.slice(1);c=c+(a<0?"p":"p+")+a}else if(a<0){for(;++a;)c="0"+c;c="0."+c}else if(++a>l)for(a-=l;a--;)c+="0";else a<l&&(c=c.slice(0,a)+"."+c.slice(a))}c=(t==16?"0x":t==2?"0b":t==8?"0o":"")+c}return e.s<0?"-"+c:c}function TZ(e,t){if(e.length>t)return e.length=t,!0}function CIe(e){return new this(e).abs()}function SIe(e){return new this(e).acos()}function TIe(e){return new this(e).acosh()}function AIe(e,t){return new this(e).plus(t)}function MIe(e){return new this(e).asin()}function RIe(e){return new this(e).asinh()}function IIe(e){return new this(e).atan()}function LIe(e){return new this(e).atanh()}function OIe(e,t){e=new this(e),t=new this(t);var r,n=this.precision,i=this.rounding,a=n+4;return!e.s||!t.s?r=new this(NaN):!e.d&&!t.d?(r=Ud(this,a,1).times(t.s>0?.25:.75),r.s=e.s):!t.d||e.isZero()?(r=t.s<0?Ud(this,n,i):new this(0),r.s=e.s):!e.d||t.isZero()?(r=Ud(this,a,1).times(.5),r.s=e.s):t.s<0?(this.precision=a,this.rounding=1,r=this.atan(_o(e,t,a,1)),t=Ud(this,a,1),this.precision=n,this.rounding=i,r=e.s<0?r.minus(t):r.plus(t)):r=this.atan(_o(e,t,a,1)),r}function PIe(e){return new this(e).cbrt()}function DIe(e){return Gn(e=new this(e),e.e+1,2)}function FIe(e,t,r){return new this(e).clamp(t,r)}function BIe(e){if(!e||typeof e!="object")throw Error(AL+"Object expected");var t,r,n,i=e.defaults===!0,a=["precision",1,O0,"rounding",0,8,"toExpNeg",-gx,0,"toExpPos",0,gx,"maxE",0,gx,"minE",-gx,0,"modulo",0,9];for(t=0;t<a.length;t+=3)if(r=a[t],i&&(this[r]=E5[r]),(n=e[r])!==void 0)if(Vu(n)===n&&n>=a[t+1]&&n<=a[t+2])this[r]=n;else throw Error(m0+r+": "+n);if(r="crypto",i&&(this[r]=E5[r]),(n=e[r])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[r]=!0;else throw Error(ift);else this[r]=!1;else throw Error(m0+r+": "+n);return this}function NIe(e){return new this(e).cos()}function kIe(e){return new this(e).cosh()}function fft(e){var t,r,n;function i(a){var o,s,l,u=this;if(!(u instanceof i))return new i(a);if(u.constructor=i,AZ(a)){u.s=a.s,Ei?!a.d||a.e>i.maxE?(u.e=NaN,u.d=null):a.e<i.minE?(u.e=0,u.d=[0]):(u.e=a.e,u.d=a.d.slice()):(u.e=a.e,u.d=a.d?a.d.slice():a.d);return}if(l=typeof a,l==="number"){if(a===0){u.s=1/a<0?-1:1,u.e=0,u.d=[0];return}if(a<0?(a=-a,u.s=-1):u.s=1,a===~~a&&a<1e7){for(o=0,s=a;s>=10;s/=10)o++;Ei?o>i.maxE?(u.e=NaN,u.d=null):o<i.minE?(u.e=0,u.d=[0]):(u.e=o,u.d=[a]):(u.e=o,u.d=[a]);return}else if(a*0!==0){a||(u.s=NaN),u.e=NaN,u.d=null;return}return S5(u,a.toString())}else if(l!=="string")throw Error(m0+a);return(s=a.charCodeAt(0))===45?(a=a.slice(1),u.s=-1):(s===43&&(a=a.slice(1)),u.s=1),oft.test(a)?S5(u,a):EIe(u,a)}if(i.prototype=gr,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=BIe,i.clone=fft,i.isDecimal=AZ,i.abs=CIe,i.acos=SIe,i.acosh=TIe,i.add=AIe,i.asin=MIe,i.asinh=RIe,i.atan=IIe,i.atanh=LIe,i.atan2=OIe,i.cbrt=PIe,i.ceil=DIe,i.clamp=FIe,i.cos=NIe,i.cosh=kIe,i.div=zIe,i.exp=UIe,i.floor=$Ie,i.hypot=HIe,i.ln=VIe,i.log=GIe,i.log10=XIe,i.log2=WIe,i.max=jIe,i.min=YIe,i.mod=ZIe,i.mul=qIe,i.pow=KIe,i.random=QIe,i.round=JIe,i.sign=t3e,i.sin=e3e,i.sinh=r3e,i.sqrt=n3e,i.sub=i3e,i.sum=a3e,i.tan=o3e,i.tanh=s3e,i.trunc=l3e,e===void 0&&(e={}),e&&e.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],t=0;t<n.length;)e.hasOwnProperty(r=n[t++])||(e[r]=this[r]);return i.config(e),i}function zIe(e,t){return new this(e).div(t)}function UIe(e){return new this(e).exp()}function $Ie(e){return Gn(e=new this(e),e.e+1,3)}function HIe(){var e,t,r=new this(0);for(Ei=!1,e=0;e<arguments.length;)if(t=new this(arguments[e++]),t.d)r.d&&(r=r.plus(t.times(t)));else{if(t.s)return Ei=!0,new this(1/0);r=t}return Ei=!0,r.sqrt()}function AZ(e){return e instanceof Qd||e&&e.toStringTag===aft||!1}function VIe(e){return new this(e).ln()}function GIe(e,t){return new this(e).log(t)}function WIe(e){return new this(e).log(2)}function XIe(e){return new this(e).log(10)}function jIe(){return uft(this,arguments,"lt")}function YIe(){return uft(this,arguments,"gt")}function ZIe(e,t){return new this(e).mod(t)}function qIe(e,t){return new this(e).mul(t)}function KIe(e,t){return new this(e).pow(t)}function QIe(e){var t,r,n,i,a=0,o=new this(1),s=[];if(e===void 0?e=this.precision:sh(e,1,O0),n=Math.ceil(e/ii),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(n));a<n;)i=t[a],i>=429e7?t[a]=crypto.getRandomValues(new Uint32Array(1))[0]:s[a++]=i%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(n*=4);a<n;)i=t[a]+(t[a+1]<<8)+(t[a+2]<<16)+((t[a+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(t,a):(s.push(i%1e7),a+=4);a=n/4}else throw Error(ift);else for(;a<n;)s[a++]=Math.random()*1e7|0;for(n=s[--a],e%=ii,n&&e&&(i=gl(10,ii-e),s[a]=(n/i|0)*i);s[a]===0;a--)s.pop();if(a<0)r=0,s=[0];else{for(r=-1;s[0]===0;r-=ii)s.shift();for(n=1,i=s[0];i>=10;i/=10)n++;n<ii&&(r-=ii-n)}return o.e=r,o.d=s,o}function JIe(e){return Gn(e=new this(e),e.e+1,this.rounding)}function t3e(e){return e=new this(e),e.d?e.d[0]?e.s:0*e.s:e.s||NaN}function e3e(e){return new this(e).sin()}function r3e(e){return new this(e).sinh()}function n3e(e){return new this(e).sqrt()}function i3e(e,t){return new this(e).sub(t)}function a3e(){var e=0,t=arguments,r=new this(t[e]);for(Ei=!1;r.s&&++e<t.length;)r=r.plus(t[e]);return Ei=!0,Gn(r,this.precision,this.rounding)}function o3e(e){return new this(e).tan()}function s3e(e){return new this(e).tanh()}function l3e(e){return Gn(e=new this(e),e.e+1,1)}gr[Symbol.for("nodejs.util.inspect.custom")]=gr.toString;gr[Symbol.toStringTag]="Decimal";var Qd=gr.constructor=fft(E5);bI=new Qd(bI);EI=new Qd(EI);var Y1,dft=function(e){return typeof e=="number"?Number.isNaN(e):e&&typeof e=="string"?Number.isNaN(Number(e)):!0},N8=function(e,t,r){return r===void 0&&(r=!1),e!=null&&e.length?e.reduce(function(n,i){var a=ai(i,t),o=dft(a);if(r&&o)return n;var s=o?0:a;return n.push(new Qd(s)),n},[]):[]},pft=function(e,t){var r=N8(e,t);return r.length?Qd.sum.apply(Qd,Gr([],ur(r),!1)).toNumber():0},MZ=function(e,t,r){var n=N8(t,r,!0);if(n!=null&&n.length)return Qd[e].apply(Qd,Gr([],ur(n),!1)).toNumber()},u3e=function(e,t){var r=N8(e,t);return r!=null&&r.length?Qd.sum.apply(Qd,Gr([],ur(r),!1)).dividedBy(r.length).toNumber():0},c3e=(Y1={},Y1[ky.SUM]=pft,Y1[ky.MIN]=function(e,t){return MZ("min",e,t)},Y1[ky.MAX]=function(e,t){return MZ("max",e,t)},Y1[ky.AVG]=u3e,Y1),h3e=function(e){return ro(e)&&"values"in e},f3e=function(e){var t=e.spreadsheet,r=e.position,n=e.tooltipContainer,i=e.autoAdjustBoundary,a=t.getCanvasElement(),o=r.x+nZ.x,s=r.y+nZ.y;if(!i||!a)return{x:o,y:s};var l=i==="body",u=t.facet.panelBBox,c=u.maxX,f=u.maxY,d=t.options,v=d.width,g=d.height,x=a.getBoundingClientRect(),w=x.top,S=x.left,M=n.getBoundingClientRect(),R=M.width,I=M.height,P=document.body.getBoundingClientRect(),k=P.width,z=P.height,G=l?k:Math.min(v,c)+S,J=l?z:Math.min(g,f)+w;return o+R>=G&&(o=G-R),s+I>=J&&(s=J-I),{x:o,y:s}},d3e=function(e){return qt({operator:{onClick:K3,menus:[]},enterable:!0,enableFormat:!0},e)},T5=function(e){return qt(qt({},e==null?void 0:e.colQuery),e==null?void 0:e.rowQuery)},ZA=function(e,t){var r;if(e){var n=t.style,i=t.className,a=i===void 0?[]:i,o=t.visible;if(n&&Object.assign(e.style,n),a.length){var s=a.filter(Boolean);(r=e.classList).add.apply(r,Gr([],ur(s),!1))}e.classList.toggle(sAe,o),e.classList.toggle(lAe,!o)}},p3e=function(e){var t=ac(e)&&Number.isNaN(e),r=e==="";return Sl(e)||t||r?"-":e},k8=function(e,t){var r,n=(r=e==null?void 0:e.dataSet)===null||r===void 0?void 0:r.getFieldFormatter(t);return function(i,a){return p3e(n(i,a))}},DM=function(e,t){var r,n=t.data,i=t.field,a=t.valueField,o=t.useCompleteDataForFormatter,s=o===void 0?!0:o,l=(r=e==null?void 0:e.dataSet)===null||r===void 0?void 0:r.getFieldName(i),u=k8(e,i),c=ro(n[i])?JSON.stringify(n[i]):n[i],f=u(a||c,s?n:void 0);return{name:l,value:f}},RZ=function(e,t,r){var n=Fg(dx([],t),function(a){return a!==Fi&&r[a]}),i=oa(n,function(a){return DM(e,{data:r,field:a,useCompleteDataForFormatter:!1})});return i},v3e=function(e,t,r){var n,i,a,o,s=(r||{}).isTotals,l=[],u=[];if(t){var c=(i=(n=e==null?void 0:e.dataSet)===null||n===void 0?void 0:n.fields)===null||i===void 0?void 0:i.columns,f=(o=(a=e==null?void 0:e.dataSet)===null||a===void 0?void 0:a.fields)===null||o===void 0?void 0:o.rows;l=RZ(e,oE(c||[]),t),u=RZ(e,f,t)}return Dr(l)&&Dr(u)&&s&&(l=[{value:Tl("总计")}]),{cols:l,rows:u}},g3e=function(e,t,r){if(t){var n=r.isTotals,i=t[Fi],a=t[i],o=[];if(n)o.push(DM(e,{data:t,field:i,valueField:ai(t,Zc)}));else if(h3e(a)&&e.getTooltipDataItemMappingCallback()){var s=Uht(t,e.getTooltipDataItemMappingCallback());bi(s,function(l,u){o.push(DM(e,{data:s,field:u}))})}else o.push(DM(e,{data:t,field:i}));return o}},m3e=function(e,t,r){var n;if(r)return Tl("总计");var i=(n=e==null?void 0:e.dataSet)===null||n===void 0?void 0:n.getFieldName(t);return i&&i!=="undefined"?i:""},IZ=function(e,t,r){r===void 0&&(r=!0);var n=[];return bi(t,function(i,a){bi(e,function(o){!r&&o.colIndex!==-1?n.push([a,o.colIndex]):r&&o.rowIndex!==-1&&n.push([o.rowIndex,a])})}),n},y3e=function(e,t){var r,n=t.rowLeafNodes,i=t.colLeafNodes,a=e.interaction.getState(),o=a.nodes,s=o===void 0?[]:o,l=a.cells,u=l===void 0?[]:l,c=(r=u==null?void 0:u[0])===null||r===void 0?void 0:r.type,f=s.filter(function(d){return d==null?void 0:d.isLeaf});return c===kr.COL_CELL?IZ(f,n,!1):c===kr.ROW_CELL?IZ(f,i):[]},_3e=function(e,t,r){var n,i=(n=e.facet)===null||n===void 0?void 0:n.layoutResult,a=function(l){var u=t==null?void 0:t.getMeta(),c=u==null?void 0:u.isTotals,f=(t==null?void 0:t.cellType)===kr.COL_CELL,d=(t==null?void 0:t.cellType)===kr.ROW_CELL;if(!f&&!d)return!1;var v=i.colNodes.find(function(w){return w.colIndex===l.colIndex}),g=i.rowNodes.find(function(w){return w.rowIndex===l.rowIndex}),x=f?g==null?void 0:g.isTotals:v==null?void 0:v.isTotals;return!c&&(l==null?void 0:l.isTotals)||c&&x};if(r){var o=y3e(e,i);return Xd(oa(o,function(l){var u=ur(l,2),c=u[0],f=u[1],d=i.getCellMeta(c,f);if(!a(d))return(d==null?void 0:d.data)||T5(d)}))}var s=e.interaction.getCells();return s.filter(function(l){var u=i.getCellMeta(l.rowIndex,l.colIndex);return!a(u)}).map(function(l){var u=i.getCellMeta(l.rowIndex,l.colIndex);return(u==null?void 0:u.data)||T5(u)})},x3e=function(e){var t=e.spreadsheet,r=e.targetCell,n=e.options,i=n===void 0?{}:n,a=[],o={},s=t.isTableMode();if(s&&(i!=null&&i.showSingleTips)){var l=r.getMeta(),u=l!=null&&l.field?t.dataSet.getMultiData({field:l.field}):[t.dataSet.getRowData(l)];return[{selectedData:u,name:"",value:""}]}var c=_3e(t,r,i.showSingleTips);return bi(c,function(f){var d;o[f==null?void 0:f[Fi]]?(d=o[f==null?void 0:f[Fi]])===null||d===void 0||d.push(f):o[f==null?void 0:f[Fi]]=[f]}),Rct(o,function(f,d){var v,g=m3e(t,d,i==null?void 0:i.isTotals),x="",w="";if(uL(f,function(P){return dft(ai(P,Zc))})){var S=t.options.placeholder,M=j_(o,S);x=M,w=M}else{var R=k8(t,d),I=pft(f,Zc);w=I,x=(v=R==null?void 0:R(I,f))!==null&&v!==void 0?v:parseFloat(I.toPrecision(Ilt))}a.push({selectedData:f,name:g,value:x,originValue:w})}),a},b3e=function(e){if(e){var t=e.getMeta();if(!t.isTotals){var r=Hu(t.spreadsheet.dataCfg.meta,{field:t.field||t.value||t.valueField}),n=r==null?void 0:r.field;return t.spreadsheet.dataSet.getFieldDescription(n)}}},E3e=function(e){var t=e.spreadsheet,r=e.cellInfos,n=r===void 0?[]:r,i=e.options,a=i===void 0?{}:i,o=e.targetCell,s=null,l=null,u=null,c=b3e(o),f=n[0]||{};if(!(a!=null&&a.hideSummary))s=x3e({spreadsheet:t,options:a,targetCell:o});else if(a.showSingleTips){var d=k8(t,f.valueField),v=d(f.value),g=a.enableFormat?t.dataSet.getFieldName(f.value)||v:t.dataSet.getFieldName(f.valueField);f.name=g||""}else l=v3e(t,f,a),u=g3e(t,f,a);var x=f||{},w=x.interpretation,S=x.infos,M=x.tips,R=x.name;return{summaries:s,interpretation:w,infos:S,tips:M,name:R,headInfo:l,details:u,description:c}},w3e=function(e){return oa(e,function(t){var r=t.getMeta();return eut({},r.query||{},Gct(r,["colIndex","rowIndex"]))})},z8=function(e){if(!e.interaction.isSelectedState())return[];var t=e.dataCfg.fields.valueInCols;return e.interaction.getCells().reduce(function(r,n){var i=e.facet.layoutResult.getCellMeta(n==null?void 0:n.rowIndex,n==null?void 0:n.colIndex),a=T5(i);if(Dr(i)||Dr(a))return[];var o=qt(qt({},a),{colIndex:t?i.colIndex:null,rowIndex:t?null:i.rowIndex}),s=r.find(function(l){return pu(o,l)});return s||r.push(o),r},[])},C3e=function(e,t){e===void 0&&(e={});var r=function(s){return Np(e,s)},n=e.col,i=e.row,a=e.data,o=e.corner;return t===kr.COL_CELL?r(n):t===kr.ROW_CELL?r(i):t===kr.DATA_CELL?r(a):t===kr.CORNER_CELL?r(o):qt({},e)},U8=function(e,t){var r;if(!(!t||!e)){var n=(r=e.getCellType)===null||r===void 0?void 0:r.call(e,t==null?void 0:t.target);return C3e(e.options.tooltip,n)}},vft=function(e,t){var r=t.defaultMenus,n=r===void 0?[]:r,i=t.cell,a=function(s){return s===void 0&&(s=[]),s.filter(function(l){var u;return mu(l.visible)?l.visible(i):(u=l.visible)!==null&&u!==void 0?u:!0}).map(function(l){return l.children&&(l.children=a(l.children)),l})},o=a(e.menus);return{onClick:e.onClick,menus:Xd(Gr(Gr([],ur(n),!1),ur(o),!1))}},S3e=function(e,t){for(var r=!1,n=t;n&&n!==document.body;){if(e===n){r=!0;break}n=n.parentElement}return r},T3e=function(e){e.store.set(nI,m6)},A3e=function(e,t){var r=e.store.get(nI,m6);e.store.set(nI,qt(qt({},r),t))},M3e=function(e,t){var r=e.store.get(nI,m6);return r[t]},gft=function(){function e(t){var r=this;this.displayFormattedValueMap=new Map,this.getFieldMeta=G_(function(n,i){return Hu(r.meta||i,function(a){return a.field===n})}),this.spreadsheet=t}return e.prototype.getFieldName=function(t){var r=ai(this.getFieldMeta(t,this.meta),"name",t);return JAe(r)},e.prototype.getFieldFormatter=function(t){return ai(this.getFieldMeta(t,this.meta),"formatter",Wu)},e.prototype.getFieldDescription=function(t){return ai(this.getFieldMeta(t,this.meta),"description")},e.prototype.setDataCfg=function(t){this.getFieldMeta.cache.clear();var r=this.processDataCfg(t),n=r.fields,i=r.meta,a=r.data,o=r.totalData,s=r.sortParams,l=r.filterParams;this.fields=n,this.meta=i,this.originData=a,this.totalData=o,this.sortParams=s,this.filterParams=l,this.displayData=this.originData,this.indexesData={}},e.prototype.processMeta=function(t,r){var n,i;return t===void 0&&(t=[]),Gr(Gr([],ur(t),!1),[LMe(t,(i=(n=this.spreadsheet)===null||n===void 0?void 0:n.options)===null||i===void 0?void 0:i.cornerExtraFieldText,r)],!1)},e.prototype.getDisplayDataSet=function(){return this.displayData||[]},e.prototype.isEmpty=function(){return Dr(this.getDisplayDataSet())},e.prototype.getEmptyViewIndexes=function(){return[]},e.prototype.getValueRangeByField=function(t){var r,n=M3e(this.spreadsheet,t);if(n)return n;var i=Xd(oa(this.originData,function(o){var s=o[t];return Sl(s)?null:Number.parseFloat(s)})),a={maxValue:bb(i),minValue:n8(i)};return A3e(this.spreadsheet,(r={},r[t]=a,r)),a},e.prototype.moreThanOneValue=function(){var t,r;return((r=(t=this.fields)===null||t===void 0?void 0:t.values)===null||r===void 0?void 0:r.length)>1},e}(),A5=function(){function e(t){this.extraField=t}return e.createProxyData=function(t,r){return new Proxy(t,new e(r))},e.createProxyDataList=function(t,r){return r.map(function(n){return e.createProxyData(t,n)})},e.prototype.get=function(t,r){return r===v6?t:r===Fi?this.extraField:r===Zc?t[this.extraField]:t[r]},e.prototype.has=function(t,r){return r===Fi||r===Zc?!0:r in t},e.prototype.ownKeys=function(t){return Object.keys(t).concat(Fi,Zc)},e.prototype.getOwnPropertyDescriptor=function(t,r){return r===Fi||r===Zc?{configurable:!0,enumerable:!0}:Object.getOwnPropertyDescriptor(t,r)},e}(),M5=function(e){nn(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.handleDimensionValuesSort=function(){bi(r.sortParams,function(n){var i=n.sortFieldId,a=n.sortByMeasure;if(i){var o=Gr([],ur(r.sortedDimensionValues[i]||[]),!1),s=GRe({dataSet:r,sortParam:n,originValues:o,isSortByMeasure:!Dr(a)});r.sortedDimensionValues[i]=s,r.handlePivotMetaSort(i,s)}})},r.getTotalStatus=function(n){var i=r.fields,a=i.columns,o=i.rows,s=function(u,c){if(c){var f=Hu(u,function(d){return!r5(n,d)});return f&&f!==w_(u)}return uL(u,function(d){return!r5(n,d)})},l=function(u,c){return c?u.filter(function(f){return f!==Fi}):u};return{isRowTotal:s(l(o,!r.spreadsheet.isValueInCols())),isRowSubTotal:s(o,!0),isColTotal:s(l(a,r.spreadsheet.isValueInCols())),isColSubTotal:s(a,!0)}},r}return t.prototype.getExistValuesByDataItem=function(r,n){return Oht(r,n)},t.prototype.setDataCfg=function(r){e.prototype.setDataCfg.call(this,r);var n=this.fields.rows;this.sortedDimensionValues={},this.rowPivotMeta=new Map,this.colPivotMeta=new Map,this.dimensionValuesCache=new Map,this.transformIndexesData(this.originData.concat(this.totalData),n),this.handleDimensionValuesSort()},t.prototype.transformIndexesData=function(r,n){var i=this,a=this.fields,o=a.columns,s=a.values,l=a.valueInCols,u;return Wp.getInstance().debugCallback(mAe,function(){u=IMe({rows:n,columns:o,values:s,valueInCols:l,data:r,indexesData:i.indexesData,sortedDimensionValues:i.sortedDimensionValues,rowPivotMeta:i.rowPivotMeta,colPivotMeta:i.colPivotMeta,getExistValuesByDataItem:i.getExistValuesByDataItem}),i.indexesData=u.indexesData,i.rowPivotMeta=u.rowPivotMeta,i.colPivotMeta=u.colPivotMeta,i.sortedDimensionValues=u.sortedDimensionValues}),u},t.prototype.transformDrillDownData=function(r,n,i){var a=this,o,s=cu.getFieldPath(i,!0),l=Gr(Gr([],ur(s),!1),[r],!1),u=this.spreadsheet.store,c=i==null?void 0:i.id,f=(o=u.get("drillDownIdPathMap"))!==null&&o!==void 0?o:new Map;f.has(c)&&(bi(f.get(c),function(v){c5(a.indexesData,v)}),hZ(this.rowPivotMeta,c));var d=this.transformIndexesData(n,l).paths;f.set(c,d),u.set("drillDownIdPathMap",f)},t.prototype.clearDrillDownData=function(r){var n=this,i=this.spreadsheet.store,a=i.get("drillDownIdPathMap");if(!a)return!1;var o=i.get("drillDownDataCache",[]);if(r){var s=a.get(r);s&&bi(s,function(v){c5(n.indexesData,v)}),hZ(this.rowPivotMeta,r),a.delete(r);var l=Fg(o,function(v){return a.has(v==null?void 0:v.rowId)});i.set("drillDownDataCache",l);var u=l.map(function(v){return v==null?void 0:v.drillLevel}),c=i.get("drillDownFieldInLevel",[]),f=c.filter(function(v){return lc(u,v==null?void 0:v.drillLevel)});i.set("drillDownFieldInLevel",f)}else{a.clear();var d=this.spreadsheet.store.get("originalDataCfg");Dr(d)||this.spreadsheet.setDataCfg(d),this.spreadsheet.store.set("drillItemsNum",-1),this.spreadsheet.store.set("drillDownDataCache",[]),this.spreadsheet.store.set("drillDownFieldInLevel",[])}return i.set("drillDownIdPathMap",a),!0},t.prototype.handlePivotMetaSort=function(r,n){var i=this.fields,a=i.rows,o=i.columns;lc(a,r)?this.rowPivotMeta=bZ({pivotMeta:this.rowPivotMeta,dimensions:a,sortFieldId:r,sortedDimensionValues:n}):lc(o,r)&&(this.colPivotMeta=bZ({pivotMeta:this.colPivotMeta,dimensions:o,sortFieldId:r,sortedDimensionValues:n}))},t.prototype.processDataCfg=function(r){var n=r.data,i=r.meta,a=i===void 0?[]:i,o=r.fields,s=r.sortParams,l=s===void 0?[]:s,u=r.totalData,c=o.columns,f=o.rows,d=o.values,v=o.valueInCols,g=o.customValueOrder,x=c,w=f;v?x=this.isCustomMeasuresPosition(g)?this.handleCustomMeasuresOrder(g,x):ig(Gr(Gr([],ur(c),!1),[Fi],!1)):w=this.isCustomMeasuresPosition(g)?this.handleCustomMeasuresOrder(g,w):ig(Gr(Gr([],ur(f),!1),[Fi],!1));var S=this.processMeta(a,Tl("数值"));return{data:n,totalData:u,meta:S,fields:qt(qt({},o),{rows:w,columns:x,values:d}),sortParams:l}},t.prototype.getFieldsAndPivotMetaByField=function(r){var n=this.fields||{},i=n.rows,a=i===void 0?[]:i,o=n.columns,s=o===void 0?[]:o;return a.includes(r)?{dimensions:a,pivotMeta:this.rowPivotMeta}:s.includes(r)?{dimensions:s,pivotMeta:this.colPivotMeta}:{}},t.prototype.getDimensionValues=function(r,n){n===void 0&&(n={});var i=this.getFieldsAndPivotMetaByField(r),a=i.pivotMeta,o=i.dimensions;if(!a||!o)return[];var s=Dr(n);if(this.dimensionValuesCache.has(r)&&s)return this.dimensionValuesCache.get(r);var l=My(n,o,MM),u=Pht({pivotMeta:a,dimensionValues:l,fields:o,fieldIdx:dL(o,r),queryType:$f.DetailOnly,sortedDimensionValues:this.sortedDimensionValues}),c=ig(u.map(function(f){return f.value}));return s&&this.dimensionValuesCache.set(r,c),c},t.prototype.getTotalValue=function(r,n){var i,a=this.spreadsheet.options,o=qct(n),s=o?n:this.getTotalStatus(r),l=MMe(s,a==null?void 0:a.totals)||{},u=l.aggregation,c=l.calcFunc,f=Dr(a==null?void 0:a.totals)&&!this.spreadsheet.isHierarchyTreeType()?ky.SUM:"",d=c3e[u||f];if(d||c){var v=this.getMultiData(r,{queryType:$f.DetailOnly}),g=void 0;return c?g=c(r,v,this.spreadsheet):d&&(g=d(v,Zc)),qt(qt({},r),(i={},i[Zc]=g,i[r[Fi]]=g,i))}},t.prototype.getCellData=function(r){var n,i,a,o=r||{},s=o.query,l=s===void 0?{}:s,u=o.rowNode,c=o.isTotals,f=c===void 0?!1:c,d=o.totalStatus,v=this.fields,g=v.rows,x=v.columns,w=g,S=(n=this.spreadsheet)===null||n===void 0?void 0:n.store.get("drillDownIdPathMap"),M=Array.from((i=S==null?void 0:S.keys())!==null&&i!==void 0?i:[]).some(function(z){return u==null?void 0:u.id.startsWith(z)});u&&M&&(w=(a=cu.getFieldPath(u,M))!==null&&a!==void 0?a:g);var R=My(l,w),I=My(l,x),P=yI({rowDimensionValues:R,colDimensionValues:I,rowPivotMeta:this.rowPivotMeta,colPivotMeta:this.colPivotMeta,rowFields:w,colFields:x,prefix:mI(w,x)}),k=ai(this.indexesData,P);if(k)return A5.createProxyData(k,l[Fi]);if(f)return this.getTotalValue(l,d)},t.prototype.getQueryExtraFields=function(r){var n=this.fields.values,i=r[Fi];return i?lc(n,i)?[i]:[]:n},t.prototype.getMultiData=function(r,n,i,a,o){var s,l,u,c;r===void 0&&(r={}),a===void 0&&(a=[]),o===void 0&&(o=!0),Dr(r)&&console.warn("query: ".concat(r,` shouldn't be empty, you can get all data from dataCfg if you're intended.
 you should use { EXTRA_FIELD: xxx} as least if you want query all specific value data`));var f=ro(n)?n:{queryType:o?$f.All:$f.DetailOnly,drillDownFields:a},d=f.drillDownFields,v=d===void 0?[]:d,g=f.queryType,x=g===void 0?$f.All:g,w=this.fields,S=w.rows,M=w.columns,R=Dr(v)?S:S.concat(v),I=My(r,R,MM),P=My(r,M,MM),k=PMe({rowDimensionValues:I,colDimensionValues:P,rowPivotMeta:this.rowPivotMeta,colPivotMeta:this.colPivotMeta,rowFields:R,colFields:M,sortedDimensionValues:this.sortedDimensionValues,queryType:x}),z=k.rowQueries,G=k.colQueries,J=mI(R,M),Z=[];try{for(var X=Kf(z),et=X.next();!et.done;et=X.next()){var at=et.value;try{for(var wt=(u=void 0,Kf(G)),Tt=wt.next();!Tt.done;Tt=wt.next()){for(var vt=Tt.value,zt=yI({rowDimensionValues:at,colDimensionValues:vt,rowPivotMeta:this.rowPivotMeta,colPivotMeta:this.colPivotMeta,rowFields:R,colFields:M,prefix:J}),oe=!1,Qt=this.indexesData,ne=function(ke){var Be=zt[ke];oe?bS(Be)?Qt=DMe(Qt,x):Qt=Xd(oa(Qt,function(Zr){return Zr==null?void 0:Zr[Be]})):bS(Be)?(oe=!0,Qt=Xd([Qt]),ke--):Qt=Qt==null?void 0:Qt[Be],de=ke},de,De=0;De<zt.length;De++)ne(De),De=de;Xn(Qt)?Z.push.apply(Z,Gr([],ur(Qt),!1)):Qt&&Z.push(Qt)}}catch(ke){u={error:ke}}finally{try{Tt&&!Tt.done&&(c=wt.return)&&c.call(wt)}finally{if(u)throw u.error}}}}catch(ke){s={error:ke}}finally{try{et&&!et.done&&(l=X.return)&&l.call(X)}finally{if(s)throw s.error}}var Ze=this.getQueryExtraFields(r);return R2(ig(Z),function(ke){return ke?A5.createProxyDataList(ke,Ze):[]})},t.prototype.getFieldFormatter=function(r,n){return r===av?this.getFieldFormatterForTotalValue(n):e.prototype.getFieldFormatter.call(this,r)},t.prototype.getFieldFormatterForTotalValue=function(r){var n;return!this.spreadsheet.isValueInCols()&&r&&(n=ai(r.rowQuery,Fi)),n=n??ai(this.fields.values,0),e.prototype.getFieldFormatter.call(this,n)},t.prototype.handleCustomMeasuresOrder=function(r,n){var i=ig(Gr([],ur(n),!1));return n.length>=r?(i.splice(r,0,Fi),i):Gr(Gr([],ur(i),!1),[Fi],!1)},t.prototype.isCustomMeasuresPosition=function(r){return ac(r)},t.prototype.getRowData=function(r){return this.getMultiData(r.rowQuery)},t}(gft),R3e=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getCellData=function(r){var n=r.query,i=this.fields,a=i.rows,o=i.columns,s=My(n,a),l=My(n,o),u=yI({rowDimensionValues:s,colDimensionValues:l,rowPivotMeta:this.rowPivotMeta,colPivotMeta:this.colPivotMeta,rowFields:a,colFields:o,prefix:mI(a,o)}),c=ai(this.indexesData,u);return c&&A5.createProxyData(c,n[Fi])},t.prototype.processDataCfg=function(r){var n=r.meta,i=this.processMeta(n,Tl("指标"));return qt(qt({},r),{meta:i,fields:qt(qt({},r.fields),{rows:[Fi],valueInCols:!1})})},t}(M5),I3e=function(e){nn(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.handleDimensionValueFilter=function(){bi(r.filterParams,function(n){var i=n.filterKey,a=n.filteredValues,o=n.customFilter,s=new Set(a),l=function(c){return!s.has(c[i])},u=Fg(r.displayData,function(c){return o?o(c)&&l(c):l(c)});r.displayData=r.getDisplayData(u)})},r.handleDimensionValuesSort=function(){bi(r.sortParams,function(n){var i,a=n.sortFieldId,o=n.sortBy,s=n.sortFunc,l=n.sortMethod,u=n.query;if(a){var c=r.displayData,f=[];if(u){var d=[];c.forEach(function(M){for(var R=Object.keys(u),I=!0,P=0;P<R.length;P++){var k=R[P];if(M[k]!==u[k]){I=!1,f.push(M);break}}I&&d.push(M)}),c=d}var v=c;if(s)v=s(qt(qt({},n),{data:c}));else if(o&&!mu(o)){var g=Gr([],ur(o),!1).reverse();v=c.sort(function(M,R){var I=g.indexOf(M[a]),P=g.indexOf(R[a]);return P-I})}else if(sE(l)||P8(l)){var x=j_(r.spreadsheet,(i=r.spreadsheet.options)===null||i===void 0?void 0:i.placeholder),w=mu(o)?o:null,S=function(M){return M[a]===x?Number.MIN_VALUE:M[a]};v=s8(c,[w||S],[l.toLocaleLowerCase()])}f.length&&(v=Gr(Gr([],ur(v),!1),ur(f),!1)),r.displayData=r.getDisplayData(v)}})},r}return t.prototype.processDataCfg=function(r){return r},t.prototype.setDataCfg=function(r){e.prototype.setDataCfg.call(this,r),this.handleDimensionValueFilter(),this.handleDimensionValuesSort()},t.prototype.getStartFrozenRows=function(r){var n=(this.spreadsheet.options||{}).frozenRowCount;return n?r.slice(0,n):[]},t.prototype.getEndFrozenRows=function(r){var n=(this.spreadsheet.options||{}).frozenTrailingRowCount;return n?r.slice(-n):[]},t.prototype.getDisplayData=function(r){var n=this.getStartFrozenRows(r),i=this.getEndFrozenRows(r),a=r.slice(n.length||0,-i.length||void 0);return Gr(Gr(Gr([],ur(n),!1),ur(a),!1),ur(i),!1)},t.prototype.getDimensionValues=function(){return[]},t.prototype.getCellData=function(r){var n=r.query;if(!(this.displayData.length===0&&n.rowIndex===0)){var i=this.displayData[n.rowIndex];return!E_(n,"field")||!ro(i)?i:i[n.field]}},t.prototype.getMultiData=function(r){if(!r)return this.displayData;var n=this.displayData[r.rowIndex]?[this.displayData[r.rowIndex]]:this.displayData;return E_(r,"field")?n.map(function(i){return i[r.field]}):n},t.prototype.getRowData=function(r){return this.getCellData({query:{rowIndex:r.rowIndex}})},t}(gft);function $8(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function mft(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function z2(){}var TS=.7,CI=1/TS,zx="\\s*([+-]?\\d+)\\s*",AS="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",tv="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",L3e=/^#([0-9a-f]{3,8})$/,O3e=new RegExp("^rgb\\("+[zx,zx,zx]+"\\)$"),P3e=new RegExp("^rgb\\("+[tv,tv,tv]+"\\)$"),D3e=new RegExp("^rgba\\("+[zx,zx,zx,AS]+"\\)$"),F3e=new RegExp("^rgba\\("+[tv,tv,tv,AS]+"\\)$"),B3e=new RegExp("^hsl\\("+[AS,tv,tv]+"\\)$"),N3e=new RegExp("^hsla\\("+[AS,tv,tv,AS]+"\\)$"),LZ={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};$8(z2,MS,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:OZ,formatHex:OZ,formatHsl:k3e,formatRgb:PZ,toString:PZ});function OZ(){return this.rgb().formatHex()}function k3e(){return yft(this).formatHsl()}function PZ(){return this.rgb().formatRgb()}function MS(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=L3e.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?DZ(t):r===3?new Uh(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?qA(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?qA(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=O3e.exec(e))?new Uh(t[1],t[2],t[3],1):(t=P3e.exec(e))?new Uh(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=D3e.exec(e))?qA(t[1],t[2],t[3],t[4]):(t=F3e.exec(e))?qA(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=B3e.exec(e))?NZ(t[1],t[2]/100,t[3]/100,1):(t=N3e.exec(e))?NZ(t[1],t[2]/100,t[3]/100,t[4]):LZ.hasOwnProperty(e)?DZ(LZ[e]):e==="transparent"?new Uh(NaN,NaN,NaN,0):null}function DZ(e){return new Uh(e>>16&255,e>>8&255,e&255,1)}function qA(e,t,r,n){return n<=0&&(e=t=r=NaN),new Uh(e,t,r,n)}function z3e(e){return e instanceof z2||(e=MS(e)),e?(e=e.rgb(),new Uh(e.r,e.g,e.b,e.opacity)):new Uh}function R5(e,t,r,n){return arguments.length===1?z3e(e):new Uh(e,t,r,n??1)}function Uh(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}$8(Uh,R5,mft(z2,{brighter:function(e){return e=e==null?CI:Math.pow(CI,e),new Uh(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?TS:Math.pow(TS,e),new Uh(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:FZ,formatHex:FZ,formatRgb:BZ,toString:BZ}));function FZ(){return"#"+iD(this.r)+iD(this.g)+iD(this.b)}function BZ(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function iD(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function NZ(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new $p(e,t,r,n)}function yft(e){if(e instanceof $p)return new $p(e.h,e.s,e.l,e.opacity);if(e instanceof z2||(e=MS(e)),!e)return new $p;if(e instanceof $p)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,i=Math.min(t,r,n),a=Math.max(t,r,n),o=NaN,s=a-i,l=(a+i)/2;return s?(t===a?o=(r-n)/s+(r<n)*6:r===a?o=(n-t)/s+2:o=(t-r)/s+4,s/=l<.5?a+i:2-a-i,o*=60):s=l>0&&l<1?0:o,new $p(o,s,l,e.opacity)}function U3e(e,t,r,n){return arguments.length===1?yft(e):new $p(e,t,r,n??1)}function $p(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}$8($p,U3e,mft(z2,{brighter:function(e){return e=e==null?CI:Math.pow(CI,e),new $p(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?TS:Math.pow(TS,e),new $p(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,i=2*r-n;return new Uh(aD(e>=240?e-240:e+120,i,n),aD(e,i,n),aD(e<120?e+240:e-120,i,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function aD(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}function H8(e){return function(){return e}}function $3e(e,t){return function(r){return e+r*t}}function H3e(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function V3e(e){return(e=+e)==1?_ft:function(t,r){return r-t?H3e(t,r,e):H8(isNaN(t)?r:t)}}function _ft(e,t){var r=t-e;return r?$3e(e,r):H8(isNaN(e)?t:e)}var kZ=function e(t){var r=V3e(t);function n(i,a){var o=r((i=R5(i)).r,(a=R5(a)).r),s=r(i.g,a.g),l=r(i.b,a.b),u=_ft(i.opacity,a.opacity);return function(c){return i.r=o(c),i.g=s(c),i.b=l(c),i.opacity=u(c),i+""}}return n.gamma=e,n}(1);function xft(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),i;return function(a){for(i=0;i<r;++i)n[i]=e[i]*(1-a)+t[i]*a;return n}}function bft(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function G3e(e,t){return(bft(t)?xft:Eft)(e,t)}function Eft(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,i=new Array(n),a=new Array(r),o;for(o=0;o<n;++o)i[o]=wft(e[o],t[o]);for(;o<r;++o)a[o]=t[o];return function(s){for(o=0;o<n;++o)a[o]=i[o](s);return a}}function W3e(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function I5(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function X3e(e,t){var r={},n={},i;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in e?r[i]=wft(e[i],t[i]):n[i]=t[i];return function(a){for(i in r)n[i]=r[i](a);return n}}var L5=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,oD=new RegExp(L5.source,"g");function j3e(e){return function(){return e}}function Y3e(e){return function(t){return e(t)+""}}function Z3e(e,t){var r=L5.lastIndex=oD.lastIndex=0,n,i,a,o=-1,s=[],l=[];for(e=e+"",t=t+"";(n=L5.exec(e))&&(i=oD.exec(t));)(a=i.index)>r&&(a=t.slice(r,a),s[o]?s[o]+=a:s[++o]=a),(n=n[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,l.push({i:o,x:I5(n,i)})),r=oD.lastIndex;return r<t.length&&(a=t.slice(r),s[o]?s[o]+=a:s[++o]=a),s.length<2?l[0]?Y3e(l[0].x):j3e(t):(t=l.length,function(u){for(var c=0,f;c<t;++c)s[(f=l[c]).i]=f.x(u);return s.join("")})}function wft(e,t){var r=typeof t,n;return t==null||r==="boolean"?H8(t):(r==="number"?I5:r==="string"?(n=MS(t))?(t=n,kZ):Z3e:t instanceof MS?kZ:t instanceof Date?W3e:bft(t)?xft:Array.isArray(t)?Eft:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?X3e:I5)(e,t)}var Qy;(function(e){e.ScrollChange="scroll-change",e.ScrollEnd="scroll-end"})(Qy||(Qy={}));var sD=function(e){nn(t,e);function t(r){var n=e.call(this,r)||this;n.isMobile=!1,n.eventHandlers=[],n.scrollFrameId=null,n.getCoordinatesName=function(){var v=n.isHorizontal?"x1":"y1",g=n.isHorizontal?"x2":"y2";return{from:v,to:g}},n.getCoordinatesWithBBoxExtraPadding=function(){var v=n.theme.size,g=n.isHorizontal?0:v/2,x=n.isHorizontal?v:v/2;return{start:n.thumbOffset+g,end:n.thumbOffset+n.thumbLen-x}},n.current=function(){var v=n.thumbLen/n.trackLen,g=n.thumbOffset/n.trackLen;return g/(1-v)},n.updateThumbLen=function(v){if(n.thumbLen!==v){n.thumbLen=v;var g=n.getCoordinatesName();n.thumbShape.attr(g.to,n.thumbOffset+v),n.emitScrollChange(n.thumbOffset/(n.trackLen-n.thumbLen)*n.scrollTargetMaxOffset,!1)}},n.updateThumbOffset=function(v,g){var x;g===void 0&&(g=!0);var w=n.validateRange(v),S=n.thumbOffset===w&&w!==0;if(!S){n.thumbOffset=w;var M=n.getCoordinatesName(),R=M.from,I=M.to,P=n.getCoordinatesWithBBoxExtraPadding(),k=P.start,z=P.end;n.thumbShape.attr((x={},x[R]=k,x[I]=z,x)),g&&n.emitScrollChange(w/(n.trackLen-n.thumbLen)*n.scrollTargetMaxOffset,!1)}},n.onlyUpdateThumbOffset=function(v){var g;n.updateThumbOffset(v,!1),(g=n.get("canvas"))===null||g===void 0||g.draw()},n.emitScrollChange=function(v,g){g===void 0&&(g=!0),cancelAnimationFrame(n.scrollFrameId),n.scrollFrameId=requestAnimationFrame(function(){n.emit(Qy.ScrollChange,{offset:v,updateThumbOffset:g})})},n.addEventListener=function(v,g,x){return v==null||v.addEventListener(g,x,!1),{remove:function(){v==null||v.removeEventListener(g,x,!1)}}},n.addEvent=function(v,g,x){v.on(g,x),n.eventHandlers.push({target:v,type:g,handler:x})},n.initScrollBar=function(){n.scrollBarGroup=n.createScrollBarGroup(),n.scrollBarGroup.move(n.position.x,n.position.y),n.bindEvents()},n.createScrollBarGroup=function(){var v=n.addGroup({className:n.isHorizontal?"horizontalBar":"verticalBar"});return n.trackShape=n.createTrackShape(v),n.thumbShape=n.createThumbShape(v),v},n.createTrackShape=function(v){var g=n.theme,x=g.lineCap,w=x===void 0?"round":x,S=g.trackColor,M=g.size,R={lineWidth:M,stroke:S,lineCap:w};return n.isHorizontal?v.addShape("line",{attrs:qt(qt({},R),{x1:0,y1:M/2,x2:n.trackLen,y2:M/2})}):v.addShape("line",{attrs:qt(qt({},R),{x1:M/2,y1:0,x2:M/2,y2:n.trackLen})})},n.createThumbShape=function(v){var g=n.theme,x=g.size,w=g.lineCap,S=w===void 0?"round":w,M=g.thumbColor,R={lineWidth:x,stroke:M,lineCap:S,cursor:"default"},I=n.getCoordinatesWithBBoxExtraPadding(),P=I.start,k=I.end;return n.isHorizontal?v.addShape("line",{attrs:qt(qt({},R),{x1:P,y1:x/2,x2:k,y2:x/2})}):v.addShape("line",{attrs:qt(qt({},R),{x1:x/2,y1:P,x2:x/2,y2:k})})},n.bindEvents=function(){n.on("mousedown",n.onStartEvent(!1)),n.on("mouseup",n.onMouseUp),n.on("touchstart",n.onStartEvent(!0)),n.on("touchend",n.onMouseUp),n.trackShape.on("click",n.onTrackClick),n.thumbShape.on("mouseover",n.onTrackMouseOver),n.thumbShape.on("mouseout",n.onTrackMouseOut)},n.onStartEvent=function(v){return function(g){g.preventDefault(),n.isMobile=v;var x=n.isMobile?ai(g,"touches.0",g):g,w=x.clientX,S=x.clientY;n.startPos=n.isHorizontal?w:S,n.bindLaterEvent()}},n.bindLaterEvent=function(){var v=n.get("canvas"),g=document.body,x=[];n.isMobile?(x=[n.addEventListener(g,"touchmove",n.onMouseMove),n.addEventListener(g,"touchend",n.onMouseUp),n.addEventListener(g,"touchcancel",n.onMouseUp)],n.addEvent(v,"touchend",n.onMouseUp),n.addEvent(v,"touchcancel",n.onMouseUp)):(x=[n.addEventListener(g,"mousemove",n.onMouseMove),n.addEventListener(g,"mouseup",n.onMouseUp),n.addEventListener(g,"mouseleave",n.onMouseUp)],n.addEvent(v,"mouseup",n.onMouseUp)),n.clearEvents=function(){x.forEach(function(w){w==null||w.remove()}),bi(n.eventHandlers,function(w){var S;(S=w.target)===null||S===void 0||S.off(w.type,w.handler)}),n.eventHandlers.length=0}},n.onTrackClick=function(v){var g=n.isHorizontal?v.x-n.position.x-n.thumbLen/2:v.y-n.position.y-n.thumbLen/2,x=n.validateRange(g);n.updateThumbOffset(x)},n.onMouseMove=function(v){v.preventDefault();var g=n.isMobile?ai(v,"touches.0",v):v,x=g.clientX,w=g.clientY,S=n.isHorizontal?x:w,M=S-n.startPos;n.startPos=S,n.updateThumbOffset(n.thumbOffset+M)},n.onMouseUp=function(v){var g;n.emit(Qy.ScrollEnd,{}),v.preventDefault(),(g=n.clearEvents)===null||g===void 0||g.call(n)},n.onTrackMouseOver=function(){var v=n.theme,g=v.thumbHoverColor,x=v.hoverSize;n.thumbShape.attr("stroke",g),n.thumbShape.attr("lineWidth",x)},n.onTrackMouseOut=function(){var v=n.theme,g=v.thumbColor,x=v.size;n.thumbShape.attr("stroke",g),n.thumbShape.attr("lineWidth",x)},n.validateRange=function(v){var g=v;return v+n.thumbLen>n.trackLen?g=n.trackLen-n.thumbLen:v+n.thumbLen<n.thumbLen&&(g=0),g};var i=r.isHorizontal,a=i===void 0?!1:i,o=r.trackLen,s=r.thumbLen,l=r.position,u=r.thumbOffset,c=u===void 0?0:u,f=r.theme,d=r.scrollTargetMaxOffset;return n.isHorizontal=a,n.thumbOffset=c,n.trackLen=o,n.thumbLen=s,n.position=l,n.theme=f,n.scrollTargetMaxOffset=d,n.initScrollBar(),n}return t}(hv),Cft=function(e,t,r){if(r<=0)return{start:0,end:0};var n=xb(e,function(a,o){var s=t;return s>=a&&s<e[o+1]},0);n=Math.max(n,0);var i=r===t?n:xb(e,function(a,o){var s=r;return s>a&&s<=e[o+1]},n);return i=Math.min(i===-1?1/0:i,e.length-2),{start:n,end:i}},q3e=function(e,t){var r=t.width,n=t.originalWidth,i=Math.min(n-r,e);return i<0?0:i},lD=function(e,t,r){var n=Math.min(t-r,e);return n<0?0:n},mC=function(e,t){if(e===void 0&&(e=[]),Dr(e))return[];var r=[];return e.forEach(function(n){if(n instanceof t&&r.push(n),n instanceof hv){var i=n.getChildren();i.forEach(function(a){a instanceof t&&r.push(a)})}}),r},Sft=function(e,t,r){return r.slice(e,t+1).map(function(n){return n.x+n.width})},IL=function(e,t,r){for(var n=[],i=e;i<t+1;i++)n.push(r.getCellOffsetY(i+1));return n},K3e=function(e,t,r,n){var i=IL(e,t,n),a=n.getCellOffsetY(e);return i.map(function(o){return o-a+r})},zZ=function(e,t,r){var n=ur(r,4),i=n[0],a=n[1],o=n[2],s=n[3];return e>=i&&e<=a&&t>=o&&t<=s},UZ=function(e){for(var t=ur(e,4),r=t[0],n=t[1],i=t[2],a=t[3],o=[],s=r;s<=n;s+=1)for(var l=i;l<=a;l+=1)o.push([s,l]);return o},Q3e=function(e,t){var r=[],n=[];if(Dr(e))return Dr(t)?{add:r,remove:n}:{add:UZ(t),remove:n};if(Dr(t))return{add:r,remove:UZ(e)};for(var i=ur(e,4),a=i[0],o=i[1],s=i[2],l=i[3],u=ur(t,4),c=u[0],f=u[1],d=u[2],v=u[3],g=a;g<=o;g++)for(var x=s;x<=l;x++)zZ(g,x,t)||n.push([g,x]);for(var g=c;g<=f;g+=1)for(var x=d;x<=v;x+=1)zZ(g,x,e)||r.push([g,x]);return{add:r,remove:n}},J3e=function(e,t){var r=[],n=[];return Object.keys(t).forEach(function(i){var a=Q3e((e==null?void 0:e[i])||[],t[i]),o=a.add,s=a.remove;r.push.apply(r,Gr([],ur(o),!1)),n.push.apply(n,Gr([],ur(s),!1))}),{add:r,remove:n}},Tft=function(){function e(t,r){r===void 0&&(r=!1),this.x=0,this.y=0,this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.width=0,this.height=0,this.originalWidth=0,this.originalHeight=0,this.viewportHeight=0,this.viewportWidth=0,this.facet=t,this.spreadsheet=t.spreadsheet,this.layoutResult=t.layoutResult,r&&this.calculateBBox()}return e}(),Aft=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.calculateBBox=function(){var r=this.getCornerBBoxWidth(),n=this.getCornerBBoxHeight();this.width=r,this.height=n,this.maxX=r,this.maxY=n},t.prototype.getCornerBBoxOriginalHeight=function(){var r=this.layoutResult.colsHierarchy,n=this.spreadsheet.options.style.colCfg;return r.sampleNodeForLastLevel?Math.floor(r.height):n==null?void 0:n.height},t.prototype.getCornerBBoxHeight=function(){return this.originalHeight=this.getCornerBBoxOriginalHeight(),this.originalHeight},t.prototype.getCornerBBoxWidth=function(){var r=this.layoutResult.rowsHierarchy;return this.originalWidth=Math.floor(r.width+this.facet.getSeriesNumberWidth()),this.spreadsheet.isScrollContainsRowHeader()?this.originalWidth:this.adjustCornerBBoxWidth()},t.prototype.adjustCornerBBoxWidth=function(){var r=this.layoutResult.colsHierarchy,n=this.spreadsheet.options.width,i=n*hde,a=r==null?void 0:r.width,o=n-this.originalWidth;if(this.originalWidth<=i||a<=o)return this.originalWidth;var s=0,l=n-i;return a<=l?s=this.originalWidth-(a-o):s=i,Math.floor(s)},t}(Tft),tLe=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.calculateBBox=function(){this.originalWidth=this.facet.getRealWidth(),this.originalHeight=this.facet.getRealHeight();var r=this.facet.cornerBBox,n={x:Math.floor(r.maxX),y:Math.floor(r.maxY)},i=this.spreadsheet.theme.scrollBar.size,a=this.spreadsheet.options,o=a.width,s=a.height,l=Math.max(0,o-n.x),u=Math.max(0,s-n.y-i);this.x=n.x,this.y=n.y,this.width=l,this.height=u,this.viewportHeight=Math.abs(Math.floor(Math.min(u,this.originalHeight))),this.viewportWidth=Math.abs(Math.floor(Math.min(l,this.originalWidth))),this.maxX=n.x+this.viewportWidth,this.maxY=n.y+this.viewportHeight,this.minX=n.x,this.minY=n.y;var c=this.spreadsheet.options,f=c.frozenTrailingColCount,d=c.frozenTrailingRowCount;f>0&&(this.viewportWidth=this.width,this.maxX=n.x+this.width),d>0&&(this.viewportHeight=this.height,this.maxY=n.y+this.height)},t}(Tft),V8=function(e){nn(t,e);function t(r){var n=e.call(this,r)||this;return n.isHeaderCellInViewport=function(i,a,o,s){return i+a>=o&&o+s>=i},n.headerConfig=r,n}return t.prototype.getConfig=function(){return this.headerConfig},t.prototype.clearResizeAreaGroup=function(r){var n=this.get("parent"),i=n==null?void 0:n.findById(r);i==null||i.clear()},t.prototype.render=function(r){this.clearResizeAreaGroup(r),this.clear(),this.layout(),this.offset(),this.clip()},t.prototype.onScrollXY=function(r,n,i){this.headerConfig.scrollX=r,this.headerConfig.scrollY=n,this.render(i)},t.prototype.onRowScrollX=function(r,n){this.headerConfig.scrollX=r,this.render(n)},t.prototype.clear=function(){e.prototype.clear.call(this)},t}(hv),G8=function(e){nn(t,e);function t(r){var n=e.call(this,r)||this;return n.scrollGroup=n.addGroup({name:ade,zIndex:blt}),n}return t.prototype.onColScroll=function(r,n){this.headerConfig.scrollX!==r&&(this.headerConfig.scrollX=r,this.render(n))},t.prototype.clip=function(){var r=this.headerConfig,n=r.width,i=r.height,a=r.scrollX,o=r.spreadsheet,s=o.isFrozenRowHeader();this.scrollGroup.setClip({type:"rect",attrs:{x:s?a:0,y:0,width:s?n:n+a,height:i}})},t.prototype.clear=function(){var r,n;(r=this.scrollGroup)===null||r===void 0||r.clear(),(n=this.background)===null||n===void 0||n.remove(!0)},t.prototype.getCellInstance=function(r,n,i){return new CL(r,n,i)},t.prototype.getCellGroup=function(r){return this.scrollGroup},t.prototype.isColCellInRect=function(r){var n=this.headerConfig,i=n.spreadsheet,a=n.cornerWidth,o=n.width,s=n.scrollX;return o+s>r.x&&s-(i.isFrozenRowHeader()?0:a)<r.x+r.width},t.prototype.layout=function(){var r=this,n=this.headerConfig,i=n.data,a=n.spreadsheet,o=a.options.colCell;bi(i,function(s){var l=s;if(r.isColCellInRect(l)){var u=(o==null?void 0:o(l,a,r.headerConfig))||r.getCellInstance(l,a,r.headerConfig);l.belongsCell=u;var c=r.getCellGroup(l);c.add(u)}})},t.prototype.offset=function(){var r=this.headerConfig,n=r.position,i=r.scrollX;EL(this.scrollGroup,n.x-i)},t}(V8),eLe=function(e){nn(t,e);function t(r){return e.call(this,r)||this}return t.getCornerHeader=function(r,n,i,a,o,s){var l=r.width,u=r.height,c=n.originalWidth,f=n.originalHeight,d=n.width,v=n.height,g=this.getCornerNodes({x:n.x,y:n.y},c,f,a.rows,a.columns,o.rowsHierarchy,o.colsHierarchy,a.dataSet,i,s);return new t({data:g,position:{x:n.x,y:n.y},width:d,height:v,originalHeight:f,originalWidth:c,viewportWidth:l,viewportHeight:u,hierarchyType:a.hierarchyType,hierarchyCollapse:a.hierarchyCollapse,rows:a.rows,columns:a.columns,seriesNumberWidth:i,spreadsheet:s})},t.getCornerNodes=function(r,n,i,a,o,s,l,u,c,f){var d,v,g,x=[],w=f.options.style.colCfg,S=l==null?void 0:l.sampleNodeForLastLevel,M=(d=S==null?void 0:S.y)!==null&&d!==void 0?d:0,R=(g=(v=S==null?void 0:S.height)!==null&&v!==void 0?v:w==null?void 0:w.height)!==null&&g!==void 0?g:0;if(c){var I=new cu({id:"",key:cde,value:Tl("序号")});I.x=r==null?void 0:r.x,I.y=M,I.width=c,I.height=R,I.isPivotMode=!0,I.spreadsheet=f,I.cornerType=Fd.Series,x.push(I)}if(f.isHierarchyTreeType()){var P=this.getTreeCornerText(f),k=new cu({key:"",id:P,value:P});k.x=r.x+c,k.y=M,k.width=n-c,k.height=R,k.seriesNumberWidth=c,k.isPivotMode=!0,k.spreadsheet=f,k.cornerType=Fd.Row,x.push(k)}else s.sampleNodesForAllLevels.forEach(function(z){var G=a[z.level],J=new cu({key:G,id:G,value:u.getFieldName(G)});J.x=z.x+c,J.y=M,J.width=z.width,J.height=R,J.field=G,J.isPivotMode=!0,J.cornerType=Fd.Row,J.spreadsheet=f,x.push(J)});return l.sampleNodesForAllLevels.forEach(function(z){if(z.level<l.maxLevel){var G=o[z.level],J=new cu({key:G,id:G,value:u.getFieldName(G)});J.x=r.x,J.y=z.y,J.width=n,J.height=z.height,J.field=G,J.isPivotMode=!0,J.cornerType=Fd.Col,J.spreadsheet=f,x.push(J)}}),x},t.getTreeCornerText=function(r){var n=r.dataSet.fields.rows,i=n===void 0?[]:n,a=r.options.cornerText;if(a)return a;var o=r.store.get("drillDownFieldInLevel",[]),s=o.map(function(u){return u.drillField}),l=i.filter(function(u){return!lc(s,u)}).map(function(u){return r.dataSet.getFieldName(u)}).join("/");return l},t.prototype.onCorScroll=function(r,n){this.headerConfig.scrollX=r,this.render(n)},t.prototype.destroy=function(){e.prototype.destroy.call(this)},t.prototype.layout=function(){this.renderCells()},t.prototype.renderCells=function(){var r=this,n,i,a,o,s=this.headerConfig,l=s.data,u=s.spreadsheet,c=(i=(n=u==null?void 0:u.facet)===null||n===void 0?void 0:n.cfg)===null||i===void 0?void 0:i.cornerHeader,f=(o=(a=u==null?void 0:u.facet)===null||a===void 0?void 0:a.cfg)===null||o===void 0?void 0:o.cornerCell;if(c){c(this,u,this.headerConfig);return}l.forEach(function(d){var v;f&&(v=f(d,r.headerConfig.spreadsheet,r.headerConfig)),Dr(v)&&(v=new WRe(d,r.headerConfig.spreadsheet,r.headerConfig)),r.add(v)})},t.prototype.offset=function(){var r=this.headerConfig.scrollX;EL(this,-r)},t.prototype.clip=function(){var r=this.headerConfig,n=r.width,i=r.height,a=r.scrollX;this.setClip({type:"rect",attrs:{x:a,y:0,width:n,height:i}})},t.prototype.getNodes=function(){return this.headerConfig.data||[]},t}(V8),rLe=function(e){nn(t,e);function t(r){var n=e.call(this,r)||this;return n.render(),n}return t.prototype.layout=function(){this.addCornerBottomBorder(),this.addCornerRightBorder(),this.addSplitLineShadow()},t.prototype.render=function(){this.clear(),this.layout()},t.prototype.onBorderScroll=function(r){this.cfg.scrollX=r;var n=this.cfg.position;ug(this,n.x-r,0),this.render()},t.prototype.onChangeShadowVisibility=function(r,n){this.cfg.showViewportLeftShadow=r>0,this.cfg.showViewportRightShadow=Math.floor(r)<Math.floor(n),this.render()},t.prototype.addCornerRightBorder=function(){var r,n=this.cfg,i=n.isPivotMode;if(i){var a=n.width,o=n.height,s=n.viewportHeight,l=n.position,u=n.spreadsheet,c=(r=u.theme)===null||r===void 0?void 0:r.splitLine,f=l.x+a,d=l.y,v=l.y+o+s;this.addShape("line",{attrs:{x1:f,y1:d,x2:f,y2:v,stroke:c.verticalBorderColor,lineWidth:c.verticalBorderWidth,opacity:c.verticalBorderColorOpacity,lineDash:c.borderDash}})}},t.prototype.addCornerBottomBorder=function(){var r,n=this.cfg,i=n.width,a=n.height,o=n.viewportWidth,s=n.position,l=n.scrollX,u=n.scrollContainsRowHeader,c=n.spreadsheet,f=(r=c.theme)===null||r===void 0?void 0:r.splitLine,d=s.x,v=d+i+o+(u?l:0),g=s.y+a-1;this.addShape("line",{attrs:{x1:d,y1:g,x2:v,y2:g,stroke:f.horizontalBorderColor,lineWidth:f.horizontalBorderWidth,opacity:f.horizontalBorderColorOpacity,lineDash:f.borderDash}})},t.prototype.addSplitLineShadow=function(){var r,n=this.cfg,i=n.isPivotMode,a=n.spreadsheet,o=(r=a.theme)===null||r===void 0?void 0:r.splitLine;!i||!o.showShadow||!a.isFrozenRowHeader()||(this.addSplitLineLeftShadow(),this.addSplitLineRightShadow())},t.prototype.addSplitLineLeftShadow=function(){var r,n,i;if(this.cfg.showViewportLeftShadow){var a=this.cfg,o=a.width,s=a.height,l=a.viewportHeight,u=a.position,c=a.spreadsheet,f=(r=c.theme)===null||r===void 0?void 0:r.splitLine,d=u.x+o,v=u.y;this.addShape("rect",{attrs:{x:d,y:v,width:f.shadowWidth,height:l+s,fill:"l (0) 0:".concat((n=f.shadowColors)===null||n===void 0?void 0:n.left," 1:").concat((i=f.shadowColors)===null||i===void 0?void 0:i.right)}})}},t.prototype.addSplitLineRightShadow=function(){var r,n,i;if(this.cfg.showViewportRightShadow){var a=this.cfg,o=a.width,s=a.height,l=a.viewportHeight,u=a.viewportWidth,c=a.position,f=a.spreadsheet,d=(r=f.theme)===null||r===void 0?void 0:r.splitLine,v=c.x+o+u-d.shadowWidth,g=c.y;this.addShape("rect",{attrs:{x:v,y:g,width:d.shadowWidth,height:l+s,fill:"l (0) 0:".concat((n=d.shadowColors)===null||n===void 0?void 0:n.right," 1:").concat((i=d.shadowColors)===null||i===void 0?void 0:i.left)}})}},t}(hv),W8=function(e){nn(t,e);function t(r){return e.call(this,r)||this}return t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gm&&this.gm.destroy()},t.prototype.rowCellInRect=function(r){var n=this.headerConfig,i=n.width,a=n.viewportHeight,o=n.seriesNumberWidth,s=n.scrollY,l=n.scrollX;return a+s>r.y&&s<r.y+r.height&&i-o+l>r.x&&l-o<r.x+r.width},t.prototype.createCellInstance=function(r){return new k2(r,this.headerConfig.spreadsheet,this.headerConfig)},t.prototype.getCellGroup=function(r){return this},t.prototype.getCustomRowCell=function(){var r,n,i=this.headerConfig.spreadsheet;return(n=(r=i==null?void 0:i.facet)===null||r===void 0?void 0:r.cfg)===null||n===void 0?void 0:n.rowCell},t.prototype.layout=function(){var r=this,n=this.headerConfig,i=n.data,a=n.spreadsheet,o=this.getCustomRowCell();bi(i,function(s){if(r.rowCellInRect(s)&&s.height!==0){var l=void 0;o&&(l=o(s,a,r.headerConfig)),Dr(l)&&a.isPivotMode()&&(l=r.createCellInstance(s)),s.belongsCell=l;var u=r.getCellGroup(s);u.add(l)}})},t.prototype.offset=function(){var r=this.headerConfig,n=r.scrollX,i=r.scrollY,a=r.position,o=r.seriesNumberWidth;ug(this,a.x-n+o,a.y-i)},t.prototype.clip=function(){var r=this.headerConfig,n=r.width,i=r.viewportHeight,a=r.scrollX,o=r.scrollY,s=r.seriesNumberWidth;this.setClip({type:"rect",attrs:{x:a-s,y:o,width:n,height:i}})},t}(V8),Mft=function(e){nn(t,e);function t(r){var n=e.call(this,r)||this;n.scrollGroup=n.addGroup({name:lde,zIndex:blt}),n.frozenHeadGroup=n.addGroup({name:ude,zIndex:cS});var i=n.headerConfig,a=i.position,o=i.seriesNumberWidth;return ug(n.frozenHeadGroup,a.x+o,a.y),n}return t.prototype.rowCellInRectXDir=function(r){var n=this.headerConfig,i=n.width,a=n.scrollX,o=n.seriesNumberWidth,s=r.x+o;return i+a>s&&a<s+r.width},t.prototype.rowCellInRectYDir=function(r){var n=this.headerConfig,i=n.viewportHeight,a=n.scrollY,o=r.y-this.getFrozenFirstRowHeight();return i+a>o&&a<o+r.height},t.prototype.rowCellInRect=function(r){var n=this.rowCellInRectXDir(r);return this.isFrozenRow(r)?n:n&&this.rowCellInRectYDir(r)},t.prototype.getCellGroup=function(r){return this.isFrozenRow(r)?this.frozenHeadGroup:this.scrollGroup},t.prototype.offset=function(){var r=this.headerConfig,n=r.scrollX,i=r.scrollY,a=r.position,o=r.seriesNumberWidth,s=a.x-n+o;ug(this.scrollGroup,s,a.y-i),EL(this.frozenHeadGroup,s)},t.prototype.clip=function(){var r=this.headerConfig,n=r.width,i=r.viewportHeight,a=r.scrollX,o=r.scrollY,s=r.seriesNumberWidth,l=a-s;this.scrollGroup.setClip({type:"rect",attrs:{x:l,y:o+this.getFrozenFirstRowHeight(),width:n,height:i}}),this.frozenHeadGroup.setClip({type:"rect",attrs:{x:l,y:0,width:this.headerConfig.width,height:this.getFrozenFirstRowHeight()}})},t.prototype.isFrozenRow=function(r){var n,i=this.headerConfig.spreadsheet,a=i.facet,o=wb(i.options,(n=a.layoutResult)===null||n===void 0?void 0:n.rowNodes).frozenRowCount;return o>0&&r.rowIndex>=0&&r.rowIndex<o},t.prototype.getFrozenFirstRowHeight=function(){var r,n=this.headerConfig.spreadsheet,i=n.facet,a=wb(n.options,(r=i.layoutResult)===null||r===void 0?void 0:r.rowNodes).frozenRowHeight;return a},t.prototype.clear=function(){this.frozenHeadGroup.clear(),this.scrollGroup.clear()},t}(W8),Rft=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.getSeriesNumberHeader=function(r){var n,i=r.viewportBBox,a=r.seriesNumberWidth,o=r.leafNodes,s=r.spreadsheet,l=r.cornerWidth,u=i.height,c=i.viewportHeight,f=[],d=s.isHierarchyTreeType();o.forEach(function(M){var R=new cu({id:"",key:"",value:"".concat(f.length+1)});R.x=M.x,R.y=M.y,R.height=d?M.getTotalHeightForTreeHierarchy():M.height,R.width=a,R.rowIndex=M.rowIndex,R.spreadsheet=s,R.isLeaf=!0,f.push(R)});var v=s.facet,g=wb(s.options,(n=v.layoutResult)===null||n===void 0?void 0:n.rowNodes),x=g.frozenRowCount,w=g.frozenRowHeight,S=!!x;return new t({width:l,height:u,viewportWidth:l,viewportHeight:S?c-w:c,position:{x:0,y:i.y},data:f,spreadsheet:s,seriesNumberWidth:0,hierarchyType:s.options.hierarchyType,linkFields:[]})},t.prototype.createCellInstance=function(r){var n=this.isFrozenRow(r);return new Jht(r,this.headerConfig.spreadsheet,qt(qt({},this.headerConfig),{scrollY:n?0:this.headerConfig.scrollY}),n)},t.prototype.getCustomRowCell=function(){return null},t}(Mft),nLe=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.createCellInstance=function(r){var n=this.headerConfig,i=n.spreadsheet,a=n.scrollY,o=this.isFrozenRow(r);return new k2(r,i,qt(qt({},this.headerConfig),{scrollY:o?0:a}),o)},t}(Mft),iLe=function(){function e(t){var r=this;this.scrollFrameId=null,this.hideScrollBar=function(){var n,i,a;(n=r.hRowScrollBar)===null||n===void 0||n.hide(),(i=r.hScrollBar)===null||i===void 0||i.hide(),(a=r.vScrollBar)===null||a===void 0||a.hide()},this.delayHideScrollBar=gS(this.hideScrollBar,1e3),this.delayHideScrollbarOnMobile=function(){Ul()&&r.delayHideScrollBar()},this.showVerticalScrollBar=function(){var n;(n=r.vScrollBar)===null||n===void 0||n.show()},this.showHorizontalScrollBar=function(){var n,i;(n=r.hRowScrollBar)===null||n===void 0||n.show(),(i=r.hScrollBar)===null||i===void 0||i.show()},this.onContainerWheelForMobileCompatibility=function(){var n=r.spreadsheet.getCanvasElement(),i,a;n.addEventListener("touchstart",function(o){i=o.touches[0].clientY}),n.addEventListener("touchend",function(o){a=o.changedTouches[0].clientY,a<i?r.scrollDirection=zl.SCROLL_UP:a>i&&(r.scrollDirection=zl.SCROLL_DOWN)})},this.onContainerWheel=function(){r.onContainerWheelForPc(),r.onContainerWheelForMobile()},this.getMobileWheelDeltaY=function(n){return r.scrollDirection===zl.SCROLL_UP?Math.max(0,n):r.scrollDirection===zl.SCROLL_DOWN?Math.min(0,n):n},this.onContainerWheelForPc=function(){var n=r.spreadsheet.getCanvasElement();n==null||n.addEventListener("wheel",r.onWheel)},this.onContainerWheelForMobile=function(){r.mobileWheel=new lIe(r.spreadsheet.container),r.mobileWheel.on("wheel",function(n){r.spreadsheet.hideTooltip();var i=n.event,a=n.deltaX,o=n.deltaY,s=n.x,l=n.y,u=r.getMobileWheelDeltaY(o);r.onWheel(qt(qt({},i),{deltaX:a,deltaY:u,offsetX:s,offsetY:l}))}),r.onContainerWheelForMobileCompatibility()},this.bindEvents=function(){r.onContainerWheel(),r.emitPaginationEvent()},this.setScrollOffset=function(n){Object.keys(n).forEach(function(i){var a=n[i];pL(a)||r.spreadsheet.store.set(i,Math.floor(a))})},this.getScrollOffset=function(){var n=r.spreadsheet.store;return{scrollX:n.get("scrollX",0),scrollY:n.get("scrollY",0),rowHeaderScrollX:n.get("rowHeaderScrollX",0)}},this.emitPaginationEvent=function(){var n=r.cfg.pagination;if(n){var i=n.current,a=i===void 0?f5:i,o=n.pageSize,s=r.viewCellHeights.getTotalLength(),l=Math.floor((s-1)/o)+1;r.cfg.spreadsheet.emit(Re.LAYOUT_PAGINATION,{pageSize:o,pageCount:l,total:s,current:a})}},this.unbindEvents=function(){var n=r.spreadsheet.getCanvasElement();n==null||n.removeEventListener("wheel",r.onWheel),r.mobileWheel.destroy()},this.clipPanelGroup=function(){var n;r.foregroundGroup=r.spreadsheet.foregroundGroup,r.backgroundGroup=r.spreadsheet.backgroundGroup,r.panelGroup=r.spreadsheet.panelGroup;var i=r.panelBBox,a=i.width,o=i.height;(n=r.spreadsheet.panelScrollGroup)===null||n===void 0||n.setClip({type:"rect",attrs:{x:0,y:r.cornerBBox.height,width:a,height:o}})},this.calculateCellWidthHeight=function(){var n=r.layoutResult.colLeafNodes,i=gL(n,function(a,o){return a.push(no(a)+o.width),a},[0]);r.viewCellWidths=i,r.viewCellHeights=r.getViewCellHeights(r.layoutResult)},this.getRealScrollX=function(n,i){return i===void 0&&(i=0),r.cfg.spreadsheet.isScrollContainsRowHeader()?n:i},this.calculatePanelBBox=function(){r.panelBBox=new tLe(r,!0)},this.getRealWidth=function(){return no(r.viewCellWidths)},this.getRealHeight=function(){var n=r.cfg.pagination,i=r.viewCellHeights;if(n){var a=r.getCellRange(),o=a.start,s=a.end;return i.getCellOffsetY(s+1)-i.getCellOffsetY(o)}return i.getTotalHeight()},this.clearAllGroup=function(){for(var n=r.panelGroup.getChildren()||[],i=n.length-1;i>=0;i--){var a=n[i];a instanceof hv?a.set("children",[]):n[i].remove()}r.foregroundGroup.set("children",[]),r.backgroundGroup.set("children",[])},this.scrollWithAnimation=function(n,i,a){var o,s,l,u;n===void 0&&(n={}),i===void 0&&(i=200);var c=r.getAdjustedScrollOffset({scrollX:((o=n.offsetX)===null||o===void 0?void 0:o.value)||0,scrollY:((s=n.offsetY)===null||s===void 0?void 0:s.value)||0,rowHeaderScrollX:((l=n.rowHeaderOffsetX)===null||l===void 0?void 0:l.value)||0}),f=c.scrollX,d=c.scrollY,v=c.rowHeaderScrollX;(u=r.timer)===null||u===void 0||u.stop();var g=r.getScrollOffset(),x=[f??g.scrollX,d??g.scrollY,v??g.rowHeaderScrollX],w=G3e(Object.values(g),x);r.timer=e6(function(S){try{var M=Math.min(S/i,1),R=ur(w(M),3),I=R[0],P=R[1],k=R[2];r.setScrollOffset({rowHeaderScrollX:k,scrollX:I,scrollY:P}),r.startScroll(),S>i&&(r.timer.stop(),a==null||a())}catch(z){console.error(z),r.timer.stop()}})},this.scrollImmediately=function(n){var i,a,o;n===void 0&&(n={});var s=r.getAdjustedScrollOffset({scrollX:((i=n.offsetX)===null||i===void 0?void 0:i.value)||0,scrollY:((a=n.offsetY)===null||a===void 0?void 0:a.value)||0,rowHeaderScrollX:((o=n.rowHeaderOffsetX)===null||o===void 0?void 0:o.value)||0}),l=s.scrollX,u=s.scrollY,c=s.rowHeaderScrollX;r.setScrollOffset({scrollX:l,scrollY:u,rowHeaderScrollX:c}),r.startScroll()},this.startScroll=function(n){var i,a,o;n===void 0&&(n=!1);var s=r.getScrollOffset(),l=s.rowHeaderScrollX,u=s.scrollX,c=s.scrollY;(i=r.hRowScrollBar)===null||i===void 0||i.onlyUpdateThumbOffset(r.getScrollBarOffset(l,r.hRowScrollBar)),(a=r.hScrollBar)===null||a===void 0||a.onlyUpdateThumbOffset(r.getScrollBarOffset(u,r.hScrollBar)),(o=r.vScrollBar)===null||o===void 0||o.onlyUpdateThumbOffset(r.getScrollBarOffset(c,r.vScrollBar)),r.dynamicRenderCell(n)},this.getRendererHeight=function(){var n=r.getCellRange(),i=n.start,a=n.end;return r.viewCellHeights.getCellOffsetY(a+1)-r.viewCellHeights.getCellOffsetY(i)},this.getAdjustedScrollOffset=function(n){var i=n.scrollX,a=n.scrollY,o=n.rowHeaderScrollX;return{scrollX:lD(i,r.layoutResult.colsHierarchy.width,r.panelBBox.width),scrollY:lD(a,r.getRendererHeight(),r.panelBBox.height),rowHeaderScrollX:q3e(o,r.cornerBBox)}},this.renderRowScrollBar=function(n){if(!r.cfg.spreadsheet.isScrollContainsRowHeader()&&r.cornerBBox.width<r.cornerBBox.originalWidth){var i=r.cornerBBox.originalWidth-r.cornerBBox.width,a=r.getScrollbarPosition().maxY,o=r.spreadsheet.theme,s=o.splitLine,l=o.scrollBar,u=Math.max(r.cornerBBox.width*r.cornerBBox.width/r.cornerBBox.originalWidth,l==null?void 0:l.thumbHorizontalMinSize),c=u-(s==null?void 0:s.verticalBorderWidth);r.hRowScrollBar=new sD({isHorizontal:!0,trackLen:r.cornerBBox.width,thumbLen:c,position:{x:r.cornerBBox.minX+r.scrollBarSize/2,y:a},thumbOffset:n*(r.cornerBBox.width-u)/i,theme:r.scrollBarTheme,scrollTargetMaxOffset:i}),r.hRowScrollBar.on(Qy.ScrollChange,function(f){var d,v,g=f.offset,x=r.getValidScrollBarOffset(g,i),w=Math.floor(x);r.setScrollOffset({rowHeaderScrollX:w}),(d=r.rowHeader)===null||d===void 0||d.onRowScrollX(w,yb),(v=r.rowIndexHeader)===null||v===void 0||v.onRowScrollX(w,kj),r.cornerHeader.onRowScrollX(w,HB);var S=r.getScrollBarOffset(w,r.hRowScrollBar),M=r.getScrollOffset(),R=M.scrollX,I=M.scrollY,P={scrollX:R,scrollY:I,rowHeaderScrollX:S};r.hRowScrollBar.updateThumbOffset(S,!1),r.spreadsheet.emit(Re.ROW_CELL_SCROLL,P),r.spreadsheet.emit(Re.GLOBAL_SCROLL,P)}),r.foregroundGroup.add(r.hRowScrollBar)}},this.getValidScrollBarOffset=function(n,i){return cI(n,0,i)},this.renderHScrollBar=function(n,i,a){if(Math.floor(n)<Math.floor(i)){var o=r.scrollBarSize/2,s=r.getScrollbarPosition().maxY,l=n+(r.cfg.spreadsheet.isScrollContainsRowHeader()?Math.min(r.cornerBBox.width,r.getCanvasHW().width):0),u={x:r.panelBBox.minX+(r.cfg.spreadsheet.isScrollContainsRowHeader()?-r.cornerBBox.width+o:o),y:s},c=i+(r.cfg.spreadsheet.isScrollContainsRowHeader()?r.cornerBBox.width:0),f=r.spreadsheet.theme.scrollBar,d=c-l,v=Math.max(l/c*l,f==null?void 0:f.thumbHorizontalMinSize);r.hScrollBar=new sD({isHorizontal:!0,trackLen:l,thumbLen:v,position:u,thumbOffset:a*(l-v)/d,theme:r.scrollBarTheme,scrollTargetMaxOffset:d}),r.hScrollBar.on(Qy.ScrollChange,function(g){var x=g.offset,w=g.updateThumbOffset,S=r.getValidScrollBarOffset(x,d);w&&r.hScrollBar.updateThumbOffset(r.getScrollBarOffset(S,r.hScrollBar),!1),r.setScrollOffset({scrollX:S}),r.dynamicRenderCell()}),r.foregroundGroup.add(r.hScrollBar)}},this.getScrollbarPosition=function(){var n=r.panelBBox,i=n.maxX,a=n.maxY,o=r.getCanvasHW(),s=o.width,l=o.height,u=r.spreadsheet.options.interaction.scrollbarPosition===iI.CONTENT;return{maxX:(u?i:s)-r.scrollBarSize,maxY:u?a:l-r.scrollBarSize}},this.renderVScrollBar=function(n,i,a){if(n<i){var o=r.spreadsheet.theme.scrollBar,s=Math.max(n/i*n,o==null?void 0:o.thumbVerticalMinSize),l=i-n,u=r.getScrollbarPosition().maxX;r.vScrollBar=new sD({isHorizontal:!1,trackLen:n,thumbLen:s,thumbOffset:a*(n-s)/l,position:{x:u,y:r.panelBBox.minY},theme:r.scrollBarTheme,scrollTargetMaxOffset:l}),r.vScrollBar.on(Qy.ScrollChange,function(c){var f=c.offset,d=c.updateThumbOffset,v=r.getValidScrollBarOffset(f,l);d&&r.vScrollBar.updateThumbOffset(r.getScrollBarOffset(v,r.vScrollBar),!1),r.setScrollOffset({scrollY:v}),r.dynamicRenderCell()}),r.foregroundGroup.add(r.vScrollBar)}},this.getScrollBarOffset=function(n,i){var a=i.trackLen,o=i.thumbLen,s=i.scrollTargetMaxOffset;return n*(a-o)/s},this.isScrollOverThePanelArea=function(n){var i=n.offsetX,a=n.offsetY;return i>r.panelBBox.minX&&i<r.panelBBox.maxX&&a>r.panelBBox.minY&&a<r.panelBBox.maxY},this.isScrollOverTheCornerArea=function(n){var i=n.offsetX,a=n.offsetY;return i>r.cornerBBox.minX&&i<r.cornerBBox.maxX&&a>r.cornerBBox.minY&&a<r.cornerBBox.maxY+r.panelBBox.height},this.updateHorizontalRowScrollOffset=function(n){var i,a=n.offset,o=n.offsetX,s=n.offsetY;r.isScrollOverTheCornerArea({offsetX:o,offsetY:s})&&((i=r.hRowScrollBar)===null||i===void 0||i.emitScrollChange(a))},this.updateHorizontalScrollOffset=function(n){var i,a=n.offset,o=n.offsetX,s=n.offsetY;(!r.hRowScrollBar||r.isScrollOverThePanelArea({offsetX:o,offsetY:s}))&&((i=r.hScrollBar)===null||i===void 0||i.emitScrollChange(a))},this.isScrollToLeft=function(n){var i=n.deltaX,a=n.offsetX,o=n.offsetY;if(!r.hScrollBar&&!r.hRowScrollBar)return!0;var s=!r.hRowScrollBar||r.isScrollOverThePanelArea({offsetY:o,offsetX:a})||r.hRowScrollBar.thumbOffset<=0,l=!r.hScrollBar||r.hScrollBar.thumbOffset<=0;return i<=0&&l&&s},this.isScrollToRight=function(n){var i,a,o,s,l,u,c=n.deltaX,f=n.offsetX,d=n.offsetY;if(!r.hScrollBar&&!r.hRowScrollBar)return!0;var v=r.spreadsheet.isFrozenRowHeader()?(i=r.panelBBox)===null||i===void 0?void 0:i.width:(a=r.panelBBox)===null||a===void 0?void 0:a.maxX,g=!r.hRowScrollBar||r.isScrollOverThePanelArea({offsetY:d,offsetX:f})||((o=r.hRowScrollBar)===null||o===void 0?void 0:o.thumbOffset)+((s=r.hRowScrollBar)===null||s===void 0?void 0:s.thumbLen)>=r.cornerBBox.width,x=r.hRowScrollBar&&r.isScrollOverTheCornerArea({offsetX:f,offsetY:d})||((l=r.hScrollBar)===null||l===void 0?void 0:l.thumbOffset)+((u=r.hScrollBar)===null||u===void 0?void 0:u.thumbLen)>=v;return c>=0&&x&&g},this.isScrollToTop=function(n){var i;return r.vScrollBar?n<=0&&((i=r.vScrollBar)===null||i===void 0?void 0:i.thumbOffset)<=0:!0},this.isScrollToBottom=function(n){var i,a,o;return r.vScrollBar?n>=0&&((i=r.vScrollBar)===null||i===void 0?void 0:i.thumbOffset)+((a=r.vScrollBar)===null||a===void 0?void 0:a.thumbLen)>=((o=r.panelBBox)===null||o===void 0?void 0:o.height):!0},this.isVerticalScrollOverTheViewport=function(n){return!r.isScrollToTop(n)&&!r.isScrollToBottom(n)},this.isHorizontalScrollOverTheViewport=function(n){return!r.isScrollToLeft(n)&&!r.isScrollToRight(n)},this.isScrollOverTheViewport=function(n){var i=n.deltaY,a=n.deltaX,o=n.offsetY,s=o<=r.cornerBBox.maxY;return s?!1:i!==0?r.isVerticalScrollOverTheViewport(i):a!==0?r.isHorizontalScrollOverTheViewport(n):!1},this.cancelScrollFrame=function(){return Ul()&&r.scrollFrameId?!1:(cancelAnimationFrame(r.scrollFrameId),!0)},this.clearScrollFrameIdOnMobile=function(){Ul()&&(r.scrollFrameId=null)},this.stopScrollChainingIfNeeded=function(n){var i=r.spreadsheet.options.interaction;i.overscrollBehavior!=="auto"&&(r.cancelScrollFrame(),r.stopScrollChaining(n))},this.stopScrollChaining=function(n){var i,a;n!=null&&n.cancelable&&((i=n==null?void 0:n.preventDefault)===null||i===void 0||i.call(n));var o=n==null?void 0:n.originalEvent;o!=null&&o.cancelable&&((a=o==null?void 0:o.preventDefault)===null||a===void 0||a.call(o))},this.onWheel=function(n){var i=r.spreadsheet.options.interaction,a=n.deltaX,o=n.deltaY,s=n.offsetX,l=n.offsetY,u=n.shiftKey;u&&vht()&&(s=s-a+o,a=o,l-=o,o=0);var c=ur(GAe(a,o,i.scrollSpeedRatio),2),f=c[0],d=c[1];if(r.spreadsheet.hideTooltip(),r.spreadsheet.interaction.clearHoverTimer(),!r.isScrollOverTheViewport({deltaX:f,deltaY:d,offsetX:s,offsetY:l})){r.stopScrollChainingIfNeeded(n);return}r.stopScrollChaining(n),r.spreadsheet.interaction.addIntercepts([Ai.HOVER]),r.cancelScrollFrame()&&(r.scrollFrameId=requestAnimationFrame(function(){var v,g=r.getScrollOffset(),x=g.scrollX,w=g.scrollY,S=g.rowHeaderScrollX;f!==0&&(r.showHorizontalScrollBar(),r.updateHorizontalRowScrollOffset({offsetX:s,offsetY:l,offset:f+S}),r.updateHorizontalScrollOffset({offsetX:s,offsetY:l,offset:f+x})),d!==0&&(r.showVerticalScrollBar(),(v=r.vScrollBar)===null||v===void 0||v.emitScrollChange(d+w)),r.delayHideScrollbarOnMobile(),r.clearScrollFrameIdOnMobile()}))},this.addCell=function(n){var i=r.spreadsheet.panelScrollGroup;i==null||i.add(n)},this.realCellRender=function(n,i){var a=r.calculateXYIndexes(n,i);Wp.getInstance().logger("renderIndex:",r.preCellIndexes,a);var o=J3e(r.preCellIndexes,a),s=o.add,l=o.remove;Wp.getInstance().debugCallback(_Ae,function(){bi(s,function(c){var f=ur(c,2),d=f[0],v=f[1],g=r.layoutResult.getCellMeta(v,d);if(g){var x=r.cfg.dataCell(g);x.set("name","".concat(d,"-").concat(v)),r.addCell(x)}});var u=mC(r.panelGroup.getChildren(),L0);bi(l,function(c){var f=ur(c,2),d=f[0],v=f[1],g=Hu(u,function(x){return x.get("name")==="".concat(d,"-").concat(v)});g==null||g.remove(!0)}),Wp.getInstance().logger("Render Cell Panel: ".concat(u==null?void 0:u.length,", Add: ").concat(s==null?void 0:s.length,", Remove: ").concat(l==null?void 0:l.length))}),r.preCellIndexes=a,r.spreadsheet.emit(Re.LAYOUT_AFTER_REAL_DATA_CELL_RENDER,{add:s,remove:l,spreadsheet:r.spreadsheet})},this.getGridInfo=function(){var n=ur(r.preCellIndexes.center,4),i=n[0],a=n[1],o=n[2],s=n[3],l=Sft(i,a,r.layoutResult.colLeafNodes),u=IL(o,s,r.viewCellHeights);return{cols:l,rows:u}},this.onAfterScroll=gS(function(){var n=r.spreadsheet,i=n.interaction,a=n.container;if(!i.isSelectedState()&&(i.removeIntercepts([Ai.HOVER]),i.getHoverAfterScroll())){var o=i.eventController.canvasMousemoveEvent;if(o){var s=o.x,l=o.y,u=a.getShape(s,l);u&&a.emit(nc.MOUSE_MOVE,qt(qt({},o),{shape:u,target:u,timestamp:performance.now()}))}}},300),this.cfg=t,this.spreadsheet=t.spreadsheet,this.init()}return Object.defineProperty(e.prototype,"scrollBarTheme",{get:function(){return this.spreadsheet.theme.scrollBar},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scrollBarSize",{get:function(){return this.scrollBarTheme.size},enumerable:!1,configurable:!0}),e.prototype.getCellCustomWidth=function(t,r){return mu(r)?r==null?void 0:r(t):r},e.prototype.getCellDraggedWidth=function(t){var r=this.cfg.colCfg;return ai(r==null?void 0:r.widthByFieldValue,"".concat(t.value))},e.prototype.render=function(){QAe(this.spreadsheet.dataCfg.fields)||(this.adjustScrollOffset(),this.renderHeaders(),this.renderScrollBars(),this.renderBackground(),this.dynamicRenderCell(!0))},e.prototype.adjustScrollOffset=function(){var t=this.getAdjustedScrollOffset(this.getScrollOffset());this.setScrollOffset(t)},e.prototype.getSeriesNumberWidth=function(){var t=this.cfg.showSeriesNumber;return t?this.spreadsheet.theme.rowCell.seriesNumberWidth:0},e.prototype.getCanvasHW=function(){return{width:this.cfg.width,height:this.cfg.height}},e.prototype.updateScrollOffset=function(t){var r,n,i,a,o,s;if(((r=t.rowHeaderOffsetX)===null||r===void 0?void 0:r.value)!==void 0){!((n=t.rowHeaderOffsetX)===null||n===void 0)&&n.animate?this.scrollWithAnimation(t):this.scrollImmediately(t);return}if(((i=t.offsetX)===null||i===void 0?void 0:i.value)!==void 0){!((a=t.offsetX)===null||a===void 0)&&a.animate?this.scrollWithAnimation(t):this.scrollImmediately(t);return}((o=t.offsetY)===null||o===void 0?void 0:o.value)!==void 0&&(!((s=t.offsetY)===null||s===void 0)&&s.animate?this.scrollWithAnimation(t):this.scrollImmediately(t))},e.prototype.getPaginationScrollY=function(){var t=this.cfg.pagination;if(t){var r=t.current,n=r===void 0?f5:r,i=t.pageSize,a=this.viewCellHeights,o=Math.max((n-1)*i,0);return a.getCellOffsetY(o)}return 0},e.prototype.destroy=function(){this.unbindEvents(),this.clearAllGroup(),this.preCellIndexes=null,cancelAnimationFrame(this.scrollFrameId)},e.prototype.calculateXYIndexes=function(t,r){var n=this.panelBBox,i=n.viewportHeight,a=n.viewportWidth,o=C8(t,r,this.viewCellWidths,this.viewCellHeights,{width:a,height:i,x:0,y:0},this.getRealScrollX(this.cornerBBox.width));return{center:o}},e.prototype.calculateCornerBBox=function(){this.cornerBBox=new Aft(this,!0)},e.prototype.getCellRange=function(){var t=this.cfg.pagination;return ZAe(this.viewCellHeights,t)},e.prototype.panelScrollGroupClip=function(t,r){var n,i=this.spreadsheet.isFrozenRowHeader();(n=this.spreadsheet.panelScrollGroup)===null||n===void 0||n.setClip({type:"rect",attrs:{x:i?t:0,y:r,width:this.panelBBox.width+(i?0:t),height:this.panelBBox.height}})},e.prototype.clip=function(t,r){this.panelScrollGroupClip(t,r)},e.prototype.translateRelatedGroups=function(t,r,n){var i,a,o,s,l,u;ug(this.spreadsheet.panelScrollGroup,this.cornerBBox.width-t,this.cornerBBox.height-r),(i=this.rowHeader)===null||i===void 0||i.onScrollXY(this.getRealScrollX(t,n),r,yb),(a=this.rowIndexHeader)===null||a===void 0||a.onScrollXY(this.getRealScrollX(t,n),r,kj),(o=this.cornerHeader)===null||o===void 0||o.onCorScroll(this.getRealScrollX(t,n),HB),(s=this.centerFrame)===null||s===void 0||s.onChangeShadowVisibility(t,this.getRealWidth()-this.panelBBox.width),(l=this.centerFrame)===null||l===void 0||l.onBorderScroll(this.getRealScrollX(t)),(u=this.columnHeader)===null||u===void 0||u.onColScroll(t,Tlt)},e.prototype.init=function(){var t=this;Wp.getInstance().debugCallback(yAe,function(){t.layoutResult=t.doLayout(),t.saveInitColumnLeafNodes(t.layoutResult.colLeafNodes),t.spreadsheet.emit(Re.LAYOUT_AFTER_HEADER_LAYOUT,t.layoutResult)}),this.calculateCellWidthHeight(),this.calculateCornerBBox(),this.calculatePanelBBox(),this.clipPanelGroup(),this.bindEvents()},e.prototype.renderBackground=function(){var t=this.getCanvasHW(),r=t.width,n=t.height,i=this.spreadsheet.theme.background,a=i.color,o=i.opacity;this.backgroundGroup.addShape("rect",{attrs:{fill:a,opacity:o,x:0,y:0,width:r,height:n}})},e.prototype.renderScrollBars=function(){var t=this.getScrollOffset(),r=t.scrollX,n=t.scrollY,i=t.rowHeaderScrollX,a=this.panelBBox,o=a.width,s=a.height,l=this.layoutResult.colsHierarchy.width,u=this.getRealHeight();this.renderRowScrollBar(i),this.renderHScrollBar(o,l,r),this.renderVScrollBar(s,u,n)},e.prototype.renderHeaders=function(){var t=this.getSeriesNumberWidth();this.rowHeader=this.getRowHeader(),this.columnHeader=this.getColHeader(),t>0&&!this.rowIndexHeader&&(this.rowIndexHeader=this.getSeriesNumberHeader()),this.cornerHeader=this.getCornerHeader(),this.centerFrame=this.getCenterFrame(),this.rowIndexHeader&&this.foregroundGroup.add(this.rowIndexHeader),this.rowHeader&&this.foregroundGroup.add(this.rowHeader),this.foregroundGroup.add(this.columnHeader),this.foregroundGroup.add(this.cornerHeader),this.foregroundGroup.add(this.centerFrame)},e.prototype.getRowHeaderCfg=function(){var t,r,n,i=this.panelBBox,a=i.y,o=i.viewportHeight,s=i.viewportWidth,l=i.height,u=this.getSeriesNumberWidth();return{width:this.cornerBBox.width,height:l,viewportWidth:s,viewportHeight:o,position:{x:0,y:a},data:this.layoutResult.rowNodes,hierarchyType:this.cfg.hierarchyType,linkFields:(n=(r=(t=this.cfg.spreadsheet.options)===null||t===void 0?void 0:t.interaction)===null||r===void 0?void 0:r.linkFields)!==null&&n!==void 0?n:[],seriesNumberWidth:u,spreadsheet:this.spreadsheet}},e.prototype.getRowHeader=function(){return this.rowHeader?this.rowHeader:new W8(this.getRowHeaderCfg())},e.prototype.getColHeader=function(){if(!this.columnHeader){var t=this.panelBBox,r=t.x,n=t.width,i=t.viewportHeight,a=t.viewportWidth;return new G8({width:n,cornerWidth:this.cornerBBox.width,height:this.cornerBBox.height,viewportWidth:a,viewportHeight:i,position:{x:r,y:0},data:this.layoutResult.colNodes,scrollContainsRowHeader:this.cfg.spreadsheet.isScrollContainsRowHeader(),sortParam:this.cfg.spreadsheet.store.get("sortParam"),spreadsheet:this.spreadsheet})}return this.columnHeader},e.prototype.getCornerHeader=function(){return this.cornerHeader?this.cornerHeader:eLe.getCornerHeader(this.panelBBox,this.cornerBBox,this.getSeriesNumberWidth(),this.cfg,this.layoutResult,this.spreadsheet)},e.prototype.getSeriesNumberHeader=function(){return Rft.getSeriesNumberHeader({viewportBBox:this.panelBBox,seriesNumberWidth:this.getSeriesNumberWidth(),leafNodes:this.layoutResult.rowsHierarchy.getNodes(0),spreadsheet:this.spreadsheet,cornerWidth:this.cornerBBox.width})},e.prototype.getCenterFrame=function(){var t;if(!this.centerFrame){var r=this.panelBBox,n=r.viewportWidth,i=r.viewportHeight,a=this.cornerBBox.width,o=this.cornerBBox.height,s=(t=this.cfg)===null||t===void 0?void 0:t.frame,l={position:{x:this.cornerBBox.x,y:this.cornerBBox.y},width:a,height:o,viewportWidth:n,viewportHeight:i,showViewportLeftShadow:!1,showViewportRightShadow:!1,scrollContainsRowHeader:this.cfg.spreadsheet.isScrollContainsRowHeader(),isPivotMode:this.cfg.spreadsheet.isPivotMode(),spreadsheet:this.cfg.spreadsheet};return s?s(l):new rLe(l)}return this.centerFrame},e.prototype.updatePanelScrollGroup=function(){this.gridInfo=this.getGridInfo(),this.spreadsheet.panelScrollGroup.update(this.gridInfo)},e.prototype.dynamicRenderCell=function(t){var r=this.getScrollOffset(),n=r.scrollX,i=r.scrollY,a=r.rowHeaderScrollX,o=i+this.getPaginationScrollY(),s=lD(o,this.viewCellHeights.getTotalHeight(),this.panelBBox.viewportHeight);this.spreadsheet.hideTooltip(),this.spreadsheet.interaction.clearHoverTimer(),this.realCellRender(n,s),this.updatePanelScrollGroup(),this.translateRelatedGroups(n,s,a),this.clip(n,s),t||this.emitScrollEvent({scrollX:n,scrollY:s,rowHeaderScrollX:a}),this.onAfterScroll()},e.prototype.emitScrollEvent=function(t){this.spreadsheet.emit(Re.LAYOUT_CELL_SCROLL,t),this.spreadsheet.emit(Re.GLOBAL_SCROLL,t)},e.prototype.saveInitColumnLeafNodes=function(t){t===void 0&&(t=[]);var r=this.spreadsheet,n=r.store,i=r.options,a=i.interaction.hiddenColumnFields,o=t.length+a.length,s=n.get("initColumnLeafNodes",[]);o!==s.length&&n.set("initColumnLeafNodes",t)},e.prototype.getHiddenColumnsInfo=function(t){var r=this.spreadsheet.store.get("hiddenColumnsDetail",[]);return Dr(r)?null:r.find(function(n){var i;return(i=n==null?void 0:n.hideColumnNodes)===null||i===void 0?void 0:i.some(function(a){return a.id===t.id})})},e.prototype.getCornerNodes=function(){var t;return((t=this.cornerHeader)===null||t===void 0?void 0:t.getNodes())||[]},e}(),Ift=function(e){nn(t,e);function t(r){var n,i=e.call(this,r)||this;return i.frozenGroupInfo=(n={},n[Ff.FROZEN_COL]={width:0},n[Ff.FROZEN_ROW]={height:0},n[Ff.FROZEN_TRAILING_ROW]={height:0},n[Ff.FROZEN_TRAILING_COL]={width:0},n),i.panelScrollGroupIndexes=[],i.initFrozenGroupPosition=function(){var a=i.getScrollOffset(),o=a.scrollY,s=a.scrollX,l=i.getPaginationScrollY();ug(i.spreadsheet.frozenRowGroup,i.cornerBBox.width-s,i.cornerBBox.height-l),ug(i.spreadsheet.frozenColGroup,i.cornerBBox.width,i.cornerBBox.height-o-l),ug(i.spreadsheet.frozenTrailingColGroup,i.cornerBBox.width,i.cornerBBox.height-o-l),ug(i.spreadsheet.frozenTopGroup,i.cornerBBox.width,i.cornerBBox.height-l)},i.addCell=function(a){var o=i.getBizRevisedFrozenOptions(),s=o.frozenRowCount,l=o.frozenColCount,u=o.frozenTrailingRowCount,c=o.frozenTrailingColCount,f=i.layoutResult.colsHierarchy.getLeaves().length,d=i.getCellRange(),v=i.getRealFrozenColumns(l,c),g=v.colCount,x=v.trailingColCount,w=XAe(a.getMeta(),{frozenRowCount:s,frozenColCount:g,frozenTrailingRowCount:u,frozenTrailingColCount:x},f,d),S=Olt[w];S&&i.spreadsheet[S]&&i.spreadsheet[S].add(a)},i.renderFrozenGroupSplitLine=function(a,o){var s,l,u,c=i.panelBBox,f=c.width,d=c.height,v=c.viewportWidth,g=c.viewportHeight,x=i.cornerBBox.height,w=i.layoutResult.colNodes.filter(function(Ze){return Xp(Ze)}),S=i.getCellRange(),M=S.end-S.start,R=Qm(i.getBizRevisedFrozenOptions(),w.length,M),I=R.frozenRowCount,P=I===void 0?0:I,k=R.frozenColCount,z=k===void 0?0:k,G=R.frozenTrailingColCount,J=G===void 0?0:G,Z=R.frozenTrailingRowCount,X=Z===void 0?0:Z,et=Math.floor(o-i.getPaginationScrollY()),at=Math.max(0,((s=no(i.viewCellWidths))!==null&&s!==void 0?s:0)-v),wt=Math.max(0,i.viewCellHeights.getCellOffsetY(S.end+1)-i.viewCellHeights.getCellOffsetY(S.start)-g);(l=i.foregroundGroup.findById(rI))===null||l===void 0||l.remove();var Tt=ai(i.cfg,"spreadsheet.theme.splitLine"),vt=i.foregroundGroup.addGroup({id:rI,zIndex:cS}),zt={lineWidth:Tt==null?void 0:Tt.verticalBorderWidth,stroke:Tt==null?void 0:Tt.verticalBorderColor,opacity:Tt==null?void 0:Tt.verticalBorderColorOpacity,lineDash:Tt==null?void 0:Tt.borderDash},oe={lineWidth:Tt==null?void 0:Tt.horizontalBorderWidth,stroke:Tt==null?void 0:Tt.horizontalBorderColor,opacity:Tt==null?void 0:Tt.horizontalBorderColorOpacity,lineDash:Tt==null?void 0:Tt.borderDash};if(z>0){var Qt=w.reduce(function(Ze,ke,Be){return Be<z?Ze+ke.width:Ze},0),ne=X>0?d:g;hu(vt,{x1:Qt,x2:Qt,y1:x,y2:x+ne},qt({},zt)),Tt.showShadow&&a>0&&vt.addShape("rect",{attrs:{x:Qt,y:x,width:Tt.shadowWidth,height:ne,fill:i.getShadowFill(0)}})}if(P>0){var de=x+i.getTotalHeightForRange(S.start,S.start+P-1),De=J>0?f:v;hu(vt,{x1:0,x2:De,y1:de,y2:de},qt({},oe)),Tt.showShadow&&et>0&&vt.addShape("rect",{attrs:{x:0,y:de,width:De,height:Tt.shadowWidth,fill:i.getShadowFill(90)}})}if(J>0){var Qt=w[w.length-J].x,ne=X?d:g;hu(vt,{x1:Qt,x2:Qt,y1:x,y2:x+ne},qt({},zt)),Tt.showShadow&&Math.floor(a)<Math.floor(at)&&vt.addShape("rect",{attrs:{x:Qt-((u=Tt.shadowWidth)!==null&&u!==void 0?u:0),y:x,width:Tt.shadowWidth,height:ne,fill:i.getShadowFill(180)}})}if(X>0){var de=i.panelBBox.maxY-i.getTotalHeightForRange(S.end-X+1,S.end),De=J>0?f:v;hu(vt,{x1:0,x2:De,y1:de,y2:de},qt({},oe)),Tt.showShadow&&et<Math.floor(wt)&&vt.addShape("rect",{attrs:{x:0,y:de-Tt.shadowWidth,width:De,height:Tt.shadowWidth,fill:i.getShadowFill(270)}})}i.foregroundGroup.sort()},i.getRealFrozenColumns=function(a,o){var s,l=a,u=o;if(a||o){var c=i.layoutResult.colsHierarchy.getNodes();c=c.filter(function(f){return Xp(f)}),s=vI(c,a,o),l=s.colCount,u=s.trailingColCount}return{colCount:l,trailingColCount:u}},i.getTotalHeightForRange=function(a,o){if(a<0||o<0)return 0;if(i.rowOffsets)return i.rowOffsets[o+1]-i.rowOffsets[a];for(var s=0,l=a;l<o+1;l++){var u=i.getDefaultCellHeight();s+=u}return s},i.getShadowFill=function(a){var o,s,l=ai(i.cfg,"spreadsheet.theme.splitLine");return"l (".concat(a,") 0:").concat((o=l.shadowColors)===null||o===void 0?void 0:o.left," 1:").concat((s=l.shadowColors)===null||s===void 0?void 0:s.right)},i}return t.prototype.calculateFrozenGroupInfo=function(){var r=this.getFrozenOptionsDirectly(),n=r.frozenColCount,i=r.frozenRowCount,a=r.frozenTrailingColCount,o=r.frozenTrailingRowCount,s=this.layoutResult.colNodes.filter(function(x){return Xp(x)}),l=this.viewCellHeights,u=this.getCellRange(),c=this.frozenGroupInfo,f=c.frozenCol,d=c.frozenTrailingCol,v=c.frozenRow,g=c.frozenTrailingRow;n>0&&(f.width=s[n-1].x+s[n-1].width-0,f.range=[0,n-1]),i>0&&(v.height=l.getCellOffsetY(u.start+i)-l.getCellOffsetY(u.start),v.range=[u.start,u.start+i-1]),a>0&&(d.width=s[s.length-1].x-s[s.length-a].x+s[s.length-1].width,d.range=[s.length-a,s.length-1]),o>0&&(g.height=l.getCellOffsetY(u.end+1)-l.getCellOffsetY(u.end+1-o),g.range=[u.end-o+1,u.end])},t.prototype.calculateXYIndexes=function(r,n){var i,a,o,s=this.layoutResult.colLeafNodes.length,l=this.getCellRange(),u=this.panelBBox,c=u.viewportHeight,f=u.viewportWidth,d=this.getFrozenOptionsDirectly(),v=d.frozenColCount,g=v===void 0?0:v,x=d.frozenRowCount,w=x===void 0?0:x,S=d.frozenTrailingColCount,M=S===void 0?0:S,R=d.frozenTrailingRowCount,I=R===void 0?0:R,P={width:f,height:c,x:0,y:0};if(M>0||g>0){var k=this.frozenGroupInfo,z=k.frozenTrailingCol,G=k.frozenCol;P.width-=z.width+G.width,P.x+=(i=G.width)!==null&&i!==void 0?i:0}if(I>0||w>0){var J=this.frozenGroupInfo,Z=J.frozenRow,X=J.frozenTrailingRow;P.height<Z.height+X.height?(P.height=0,P.y=0):(P.height-=Z.height+X.height,P.y+=Z.height)}var et=this.spreadsheet.isTableMode()&&(!((o=(a=this.spreadsheet.dataSet)===null||a===void 0?void 0:a.isEmpty)===null||o===void 0)&&o.call(a))?this.spreadsheet.dataSet.getEmptyViewIndexes():C8(r,n,this.viewCellWidths,this.viewCellHeights,P,this.getRealScrollX(this.cornerBBox.width));this.panelScrollGroupIndexes=et;var at=this.getRealFrozenColumns(g,M),wt=at.colCount,Tt=at.trailingColCount;return YAe(et,{frozenColCount:wt,frozenRowCount:w,frozenTrailingColCount:Tt,frozenTrailingRowCount:I},s,l)},t.prototype.updateFrozenGroupGrid=function(){var r=this;[Ff.FROZEN_COL,Ff.FROZEN_ROW,Ff.FROZEN_TRAILING_COL,Ff.FROZEN_TRAILING_ROW].forEach(function(n){if(r.frozenGroupInfo[n].range){var i=[],a=[];if(n.toLowerCase().includes("row")){var o=ur(r.frozenGroupInfo[n].range,2),s=o[0],l=o[1];if(i=r.gridInfo.cols,a=IL(s,l,r.viewCellHeights),n===Ff.FROZEN_TRAILING_ROW){var u=r.spreadsheet.frozenTrailingRowGroup.getBBox().minY;a=K3e(s,l,Math.ceil(u),r.viewCellHeights)}}else{var c=ur(r.frozenGroupInfo[n].range,2),f=c[0],d=c[1],v=r.layoutResult.colNodes.filter(function(g){return Xp(g)});i=Sft(f,d,v),a=r.gridInfo.rows}r.spreadsheet["".concat(n,"Group")].updateGrid({cols:i,rows:a},"".concat(n,"Group"))}})},t.prototype.updatePanelScrollGroup=function(){e.prototype.updatePanelScrollGroup.call(this),this.updateFrozenGroupGrid()},t.prototype.translateRelatedGroups=function(r,n,i){var a=this,o=this.spreadsheet,s=o.frozenColGroup,l=o.frozenTrailingColGroup,u=o.frozenRowGroup,c=o.frozenTrailingRowGroup;[u,c].forEach(function(f){EL(f,a.cornerBBox.width-r)}),[s,l].forEach(function(f){WAe(f,a.cornerBBox.height-n)}),e.prototype.translateRelatedGroups.call(this,r,n,i),this.updateRowResizeArea(),this.renderFrozenGroupSplitLine(r,n)},t.prototype.updateRowResizeArea=function(){},t.prototype.clip=function(r,n){var i,a,o,s=this.getPaginationScrollY(),l=this.spreadsheet,u=l.frozenRowGroup,c=l.frozenColGroup,f=l.frozenTrailingColGroup,d=l.frozenTrailingRowGroup,v=l.panelScrollGroup,g=0,x=0,w=0;c&&(g=c.getBBox().width),u&&(x=u.getBBox().height);var S;f&&(S=f.getBBox()),d&&(w=d.getBBox().height);var M=this.panelBBox.width-g-((i=S==null?void 0:S.width)!==null&&i!==void 0?i:0),R=this.panelBBox.height-x-w;v.setClip({type:"rect",attrs:{x:r+g,y:n+x,width:M,height:R}}),u.setClip({type:"rect",attrs:{x:r+g,y:s,width:M,height:x}}),d==null||d.setClip({type:"rect",attrs:{x:r+g,y:d.getBBox().minY,width:M,height:w}});var I={y:n+x,height:R};c==null||c.setClip({type:"rect",attrs:qt(qt({},I),{x:0,width:g})}),f==null||f.setClip({type:"rect",attrs:qt(qt({},I),{x:(a=S==null?void 0:S.minX)!==null&&a!==void 0?a:0,width:(o=S==null?void 0:S.width)!==null&&o!==void 0?o:0})})},t.prototype.init=function(){e.prototype.init.call(this)},t.prototype.render=function(){this.calculateFrozenGroupInfo(),e.prototype.render.call(this),this.initFrozenGroupPosition()},t.prototype.getFrozenOptionsDirectly=function(){var r=this.layoutResult.colLeafNodes.length,n=this.getCellRange();return Qm(this.getBizRevisedFrozenOptions(),r,n.end-n.start+1)},t.prototype.getBizRevisedFrozenOptions=function(){var r=this.cfg,n=r.frozenColCount,i=r.frozenRowCount,a=r.frozenTrailingColCount,o=r.frozenTrailingRowCount;return{frozenColCount:n,frozenRowCount:i,frozenTrailingColCount:a,frozenTrailingRowCount:o}},t.prototype.getDefaultCellHeight=function(){var r,n=this.cfg.cellCfg;return(r=n==null?void 0:n.height)!==null&&r!==void 0?r:0},t}(iLe),Lft=function(e){var t,r,n,i=e.facetCfg,a=e.customTreeItems,o=a===void 0?[]:a,s=e.level,l=e.parentNode,u=e.hierarchy,c=i.spreadsheet,f=i.collapsedRows,d=i.hierarchyCollapse;try{for(var v=Kf(o),g=v.next();!g.done;g=v.next()){var x=g.value,w=x.key,S=x.title,M=x.collapsed,R=x.children,I=H3(x,["key","title","collapsed","children"]),P=(n={},n[Fi]=w,n),k=xS(l.id,S),z=M??!1,G=ai(f,k),J=G??(d||z),Z=new cu({id:k,key:w,label:S,value:S,level:s,parent:l,field:w,isTotals:!1,isCollapsed:J,hierarchy:u,query:P,spreadsheet:c,extra:I});s>u.maxLevel&&(u.maxLevel=s),Dr(R)&&(Z.isLeaf=!0);var X=E8(i,l,Z,u);!Dr(R)&&!J&&X&&Lft({facetCfg:i,parentNode:Z,level:s+1,hierarchy:u,customTreeItems:R})}}catch(et){t={error:et}}finally{try{g&&!g.done&&(r=v.return)&&r.call(v)}finally{if(t)throw t.error}}},aLe=function(e,t,r){var n=e.getTotalsConfig(t);if(n.showGrandTotals){var i=n.reverseLayout?"unshift":"push";r[i](new Eb({label:n.label,isSubTotals:!1,isGrandTotals:!0}))}},Oft=function(e){var t,r,n,i,a,o,s=e.parentNode,l=e.currentField,u=e.level,c=e.facetCfg,f=e.hierarchy,d=e.pivotMeta,v=c.spreadsheet,g=c.collapsedRows,x=c.hierarchyCollapse,w=c.rowExpandDepth,S=s.query,M=s.id,R=((i=v.dataCfg.fields.rows)===null||i===void 0?void 0:i.length)<=u,I=SMe(Array.from(d.keys())),P=_ht(I,c,s,l),k=v.store.get("drillItemsNum");R&&k>0&&(P=P.slice(0,k)),u===0&&aLe(v,l,P);try{for(var z=Kf(P),G=z.next();!G.done;G=z.next()){var J=G.value,Z=J instanceof Eb,X=Z?null:d.get(J),et=void 0,at=S,wt=!1,Tt=!1;if(Z){var vt=J;wt=vt.isGrandTotals,Tt=vt.isSubTotals,et=Tl(J.label),at=S}else et=J,at=qt(qt({},S),(n={},n[l]=et,n));var zt=xS(M,et),oe=g==null?void 0:g[zt],Qt=ac(w)?u>w:null,ne=(a=oe??Qt)!==null&&a!==void 0?a:x,de=new cu({id:zt,key:l,label:et,value:et,level:u,parent:s,field:l,isTotals:Z,isGrandTotals:wt,isSubTotals:Tt,isCollapsed:ne,hierarchy:f,query:at,spreadsheet:v});u>f.maxLevel&&(f.maxLevel=u);var De=Gr([],ur(((o=X==null?void 0:X.children)===null||o===void 0?void 0:o.keys())||[]),!1).filter(function(Be){return Be!==av}),Ze=Dr(De);(Ze||Z)&&(de.isLeaf=!0),Ze||(de.isTotals=!0);var ke=E8(c,s,de,f);!Ze&&!ne&&!Z&&ke&&Oft({level:u+1,currentField:X.childField,pivotMeta:X.children,facetCfg:c,parentNode:de,hierarchy:f})}}catch(Be){t={error:Be}}finally{try{G&&!G.done&&(r=z.return)&&r.call(z)}finally{if(t)throw t.error}}},Pft=function(e){var t=e.isValueInCols,r=e.moreThanOneValue,n=e.rootNode,i=e.facetCfg,a=e.hierarchy,o=e.fields,s=e.isRowHeader,l,u;s?(l=!t&&r,u=!t&&!r):(l=t&&r,u=t&&!r),Eht({addTotalMeasureInTotal:l,addMeasureInTotalQuery:u,parentNode:n,currentField:o[0],fields:o,facetCfg:i,hierarchy:a})},oLe=function(e){var t=e.facetCfg,r=e.rootNode,n=e.hierarchy,i=t.dataSet.fields.customTreeItems;Lft({customTreeItems:i,facetCfg:t,level:0,parentNode:r,hierarchy:n})},sLe=function(e){var t=e.facetCfg,r=e.rootNode,n=e.hierarchy,i=t.hierarchyType,a=t.rows,o=t.dataSet;i==="tree"?Oft({level:0,currentField:a[0],pivotMeta:o.rowPivotMeta,facetCfg:t,parentNode:r,hierarchy:n}):oLe(e)},lLe=function(e){var t=e.spreadsheet;t.isHierarchyTreeType()?sLe(e):Pft(e)},uLe=function(e){var t=e.isPivotMode,r=e.hierarchy,n=e.rootNode,i=e.facetCfg;t?Pft(e):tMe({parentNode:n,hierarchy:r,facetCfg:i})},O5=function(e){var t=e.isRowHeader,r=e.facetCfg,n=r.spreadsheet,i=r.rows,a=i===void 0?[]:i,o=r.columns,s=o===void 0?[]:o,l=n.dataCfg.fields.valueInCols,u=n.isPivotMode(),c=r.dataSet.moreThanOneValue(),f=cu.rootNode(),d=new ght,v={isValueInCols:l,isPivotMode:u,moreThanOneValue:c,rootNode:f,hierarchy:d,spreadsheet:n,facetCfg:r,fields:t?a:s,isRowHeader:t};t?lLe(v):uLe(v);var g=function(){return t&&n.isHierarchyTreeType()?d.getNodes():d.getLeaves()};return{hierarchy:d,leafNodes:g()}},cLe=function(e){nn(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.renderFrozenGroupSplitLine=function(n,i){var a;if((a=r.foregroundGroup.findById(rI))===null||a===void 0||a.remove(),r.enableFrozenFirstRow()){var o=Math.floor(i-r.getPaginationScrollY()),s=r.foregroundGroup.addGroup({id:rI,zIndex:cS}),l=ai(r.cfg,"spreadsheet.theme.splitLine"),u={lineWidth:l==null?void 0:l.horizontalBorderWidth,stroke:l==null?void 0:l.horizontalBorderColor,opacity:l==null?void 0:l.horizontalBorderColorOpacity},c=r.cornerBBox.height,f=r.getCellRange(),d=c+r.getTotalHeightForRange(f.start,f.start),v=r.panelBBox.viewportWidth+r.layoutResult.rowsHierarchy.width+r.getSeriesNumberWidth();hu(s,{x1:0,x2:v,y1:d,y2:d},qt({},u)),l.showShadow&&o>0&&s.addShape("rect",{attrs:{x:0,y:d,width:v,height:l.shadowWidth,fill:r.getShadowFill(90)}})}},r}return t.prototype.updateFrozenGroupGrid=function(){var r=this;[Ff.FROZEN_ROW].forEach(function(n){if(r.frozenGroupInfo[n].range){var i=[],a=[];if(n.toLowerCase().includes("row")){var o=ur(r.frozenGroupInfo[n].range,2),s=o[0],l=o[1];i=r.gridInfo.cols,a=IL(s,l,r.viewCellHeights)}r.spreadsheet["".concat(n,"Group")].updateGrid({cols:i,rows:a},"".concat(n,"Group"))}})},t.prototype.getBizRevisedFrozenOptions=function(){return wb(this.cfg,this.layoutResult.rowNodes)},t.prototype.clip=function(r,n){var i=this.spreadsheet,a=i.isFrozenRowHeader,o=i.frozenRowGroup;if(!a.call(this.spreadsheet)){if(this.panelScrollGroupClip(r,n),this.enableFrozenFirstRow()){var s=this.getPaginationScrollY();o.setClip({type:"rect",attrs:{x:0,y:s,width:this.panelBBox.width+r,height:o.getBBox().height}})}return}e.prototype.clip.call(this,r,n)},Object.defineProperty(t.prototype,"rowCellTheme",{get:function(){return this.spreadsheet.theme.rowCell.cell},enumerable:!1,configurable:!0}),t.prototype.getContentHeight=function(){var r=this.layoutResult,n=r.rowsHierarchy,i=r.colsHierarchy;return n.height+i.height},t.prototype.doLayout=function(){var r=this,n=O5({isRowHeader:!0,facetCfg:this.cfg}),i=n.leafNodes,a=n.hierarchy,o=O5({isRowHeader:!1,facetCfg:this.cfg}),s=o.leafNodes,l=o.hierarchy;this.calculateNodesCoordinate(i,a,s,l);var u=this.cfg,c=u.dataSet,f=u.spreadsheet,d=function(g,x){var w=g||0,S=x||0,M=i[w],R=s[S];if(!M||!R)return null;var I=M.query,P=R.query,k=M.isTotals||M.isTotalMeasure||R.isTotals||R.isTotalMeasure,z=r.getMeasureInfo(),G=fI({},I,P,z),J=gC(M,R),Z=c.getCellData({query:G,rowNode:M,isTotals:k,totalStatus:J}),X=G[Fi],et=ai(Z,Zc,null);return{spreadsheet:f,x:R.x,y:M.y,width:R.width,height:M.height,data:Z,rowIndex:w,colIndex:S,isTotals:k,valueField:X,fieldValue:et,rowQuery:I,colQuery:P,rowId:M.id,colId:R.id,id:B2(M.id,R.id)}},v={colNodes:l.getNodes(),colsHierarchy:l,rowNodes:a.getNodes(),rowsHierarchy:a,rowLeafNodes:i,colLeafNodes:s,getCellMeta:d,spreadsheet:f};return HAe(this.cfg,v)},t.prototype.getMeasureInfo=function(){var r,n,i,a=this.cfg,o=a.dataSet,s=a.spreadsheet,l=s.options.hierarchyType,u=(n=ai(s,"facet.cfg.colCfg.hideMeasureColumn"))!==null&&n!==void 0?n:!1;return u&&l!=="customTree"?(r={},r[Fi]=(i=o.fields.values)===null||i===void 0?void 0:i[0],r):{}},t.prototype.calculateNodesCoordinate=function(r,n,i,a){this.calculateRowNodesCoordinate(r,n,i),this.calculateColNodesCoordinate(i,a,r,n.width)},t.prototype.calculateColNodesCoordinate=function(r,n,i,a){for(var o,s,l,u=cu.blankNode(),c=n.getNodes(),f=n.sampleNodesForAllLevels,d=0;d<f.length;d++){var v=f[d];if(v.height=this.getColNodeHeight(v),n.height+=v.height,v.level===0)v.y=0;else{var g=f[d-1];v.y=(o=(g==null?void 0:g.y)+(g==null?void 0:g.height))!==null&&o!==void 0?o:0}}for(var x=0,w=function(R){var I=c[R];if(I.isLeaf&&(I.colIndex=x,x+=1,I.x=u.x+u.width,I.width=S.calculateColLeafNodesWidth(I,r,i,a),n.width+=I.width,u=I),I.level===0)I.y=0;else{var P=n.sampleNodesForAllLevels.find(function(k){return k.level===I.level-1});I.y=(s=(P==null?void 0:P.y)+(P==null?void 0:P.height))!==null&&s!==void 0?s:0}I.height=S.getColNodeHeight(I),p5(S.cfg,null,I)},S=this,M=0;M<c.length;M++)w(M);this.autoCalculateColNodeWidthAndX(r),Dr((l=this.spreadsheet.options.totals)===null||l===void 0?void 0:l.col)||(this.adjustTotalNodesCoordinate({hierarchy:n,isRowHeader:!1,isSubTotal:!0}),this.adjustTotalNodesCoordinate({hierarchy:n,isRowHeader:!1,isSubTotal:!1}))},t.prototype.autoCalculateColNodeWidthAndX=function(r){for(var n,i=null,a=0,o=r.slice(0);a<o.length;){var s=o[a++],l=s.parent;if(i!==l&&l){o.push(l);var u=(n=l.children)===null||n===void 0?void 0:n.find(function(d){return d.width}),c=u==null?void 0:u.x,f=tht(l.children,"width");l.x=c,l.width=f,i=l}}},t.prototype.calculateColLeafNodesWidth=function(r,n,i,a){var o,s,l,u,c,f=this.cfg,d=f.colCfg,v=f.dataSet,g=f.filterDisplayDataItem,x=this.getCellDraggedWidth(r);if(ac(x))return x;var w=this.getCellCustomWidth(r,d==null?void 0:d.width);if(ac(w))return w;if(this.spreadsheet.getLayoutWidthType()===y_.Compact){for(var S=this.spreadsheet.theme.colCell,M=S.bolderText,R=S.cell,I=S.icon,P=this.spreadsheet.theme.dataCell.text,k=this.spreadsheet.dataSet.getFieldFormatter(r.field),z=(o=k==null?void 0:k(r.value))!==null&&o!==void 0?o:r.label,G=this.getExpectedCellIconWidth(kr.COL_CELL,this.spreadsheet.isValueInCols()&&this.spreadsheet.options.showDefaultHeaderActionIcon,I),J=this.spreadsheet.measureTextWidth(z,M)+G,Z=this.getMeasureInfo(),X=void 0,et=0,at=0,wt=0;wt<XP;wt++){var Tt=i[wt];if(Tt){var vt=v.getCellData({query:qt(qt({},r.query),Tt.query),rowNode:Tt,isTotals:r.isTotals||r.isTotalMeasure||Tt.isTotals||Tt.isTotalMeasure,totalStatus:gC(Tt,r)});if(vt){var zt=Uht(vt,g),oe=(l=(s=this.spreadsheet.dataSet.getFieldFormatter(vt[Fi]))===null||s===void 0?void 0:s(zt))!==null&&l!==void 0?l:zt,Qt="".concat(oe),ne=fI({},Tt.query,r.query,Z),de=ne[Fi],De=Tht(this.spreadsheet.options.conditions,this.spreadsheet.theme.dataCell.icon,de),Ze=De.size,ke=De.margin,Be=ke.left,Zr=ke.right,Wr=Ze+Be+Zr,In=this.spreadsheet.measureTextWidth(Qt,P)+Wr;In>et&&(X=Qt,et=In,at=Wr)}}}var re=J>et,nr=re?z:X,zr=re?G:at;Wp.getInstance().logger("Max Label In Col:",r.field,nr,et);var Ne=this.spreadsheet.measureTextWidth(nr,qt(qt({},M),{fontSize:Math.max(P.fontSize,M.fontSize)}));return Ne+((u=R.padding)===null||u===void 0?void 0:u.left)+((c=R.padding)===null||c===void 0?void 0:c.right)+zr}return this.spreadsheet.isHierarchyTreeType()?this.getAdaptTreeColWidth(r,n,i):this.getAdaptGridColWidth(n,a)},t.prototype.getColNodeHeight=function(r){var n=this.cfg.colCfg,i=ai(n,["heightByField",r.key]);return i??(n==null?void 0:n.height)},t.prototype.getExpectedCellIconWidth=function(r,n,i){var a,o=0;if(n)o=1;else{var s=O8(oa(this.spreadsheet.options.headerActionIcons,function(l){return qt(qt({},l),{displayCondition:function(){return!0}})}),null,r);o=(a=s==null?void 0:s.iconNames.length)!==null&&a!==void 0?a:0}return o?o*(i.size+i.margin.left)+i.margin.right:0},t.prototype.calculateRowNodesCoordinate=function(r,n,i){var a,o,s,l,u,c,f,d,v,g,x=this.cfg,w=x.cellCfg,S=x.spreadsheet,M=S.isHierarchyTreeType(),R=ai(S,"options.style.rowCfg.heightByField",{}),I=(s=n.sampleNodesForAllLevels)!==null&&s!==void 0?s:[];if(M)n.width=this.getTreeRowHeaderWidth();else try{for(var P=Kf(n.sampleNodesForAllLevels),k=P.next();!k.done;k=P.next()){var z=k.value;z.width=this.calculateGridRowNodesWidth(z,i),n.width+=z.width;var G=(l=I[z.level-1])!==null&&l!==void 0?l:{x:0,width:0};z.x=(G==null?void 0:G.x)+(G==null?void 0:G.width)}}catch(Tt){a={error:Tt}}finally{try{k&&!k.done&&(o=P.return)&&o.call(P)}finally{if(a)throw a.error}}for(var J=cu.blankNode(),Z=n.getNodes(),X=0;X<Z.length;X++){var et=Z[X],at=M||!M&&et.isLeaf;if(at&&((u=et.rowIndex)!==null&&u!==void 0||(et.rowIndex=X),(c=et.colIndex)!==null&&c!==void 0||(et.colIndex=X),et.y=J.y+J.height,et.height=((f=R==null?void 0:R[et.id])!==null&&f!==void 0?f:w==null?void 0:w.height)+((d=this.rowCellTheme.padding)===null||d===void 0?void 0:d.top)+((v=this.rowCellTheme.padding)===null||v===void 0?void 0:v.bottom),J=et,n.height+=et.height),M||et.level===0)et.x=0;else{var G=I[et.level-1];et.x=(G==null?void 0:G.x)+(G==null?void 0:G.width)}if(M)et.width=this.getTreeRowHeaderWidth();else{var wt=I[et.level];et.width=wt==null?void 0:wt.width}p5(this.cfg,et,null)}M||(this.autoCalculateRowNodeHeightAndY(r),Dr((g=S.options.totals)===null||g===void 0?void 0:g.row)||(this.adjustTotalNodesCoordinate({hierarchy:n,isRowHeader:!0,isSubTotal:!1}),this.adjustTotalNodesCoordinate({hierarchy:n,isRowHeader:!0,isSubTotal:!0})))},t.prototype.autoCalculateRowNodeHeightAndY=function(r){for(var n=null,i=0,a=r.slice(0);i<a.length;){var o=a[i++],s=o.parent;n!==s&&s&&(a.push(s),s.y=s.children[0].y,s.height=s.children.reduce(function(l,u){return l+u.height},0),n=s)}},t.prototype.getMultipleMap=function(r,n,i){for(var a=r.maxLevel,o=this.cfg,s=o.totals,l=o.dataSet,u=l.moreThanOneValue(),c=l.fields,f=c.rows,d=c.columns,v=n?f:d,g=n?s.row:s.col,x=i?g.subTotalsGroupDimensions||[]:g.totalsGroupDimensions||[],w=l.isEmpty()?[]:x,S=Array.from({length:a+1},function(){return 1}),M=a;M>0;M--){var R=v[M],I=R===Fi&&u;w.includes(R)||I||(S[M-1]+=S[M],S[M]=0)}return S},t.prototype.adjustTotalNodesCoordinate=function(r){var n=r.hierarchy,i=r.isRowHeader,a=r.isSubTotal,o=this.getMultipleMap(n,i,a),s=Fg(n.getNodes(),function(u){return a?u.isSubTotals:u.isGrandTotals}),l=i?"width":"height";bi(s,function(u){var c,f=o[u.level];if(!f&&a)for(var d=1;f<1;)f=o[u.level-d]-d,d++;for(var v=0,g=function(w){v+=((c=n.sampleNodesForAllLevels.find(function(S){return S.level===u.level+w}))===null||c===void 0?void 0:c[l])||0},x=0;x<f;x++)g(x);u[l]=v})},t.prototype.calculateGridRowNodesWidth=function(r,n){var i=this.cfg,a=i.rowCfg,o=i.spreadsheet,s=ai(a,["widthByField",r.key]);if(ac(s))return s;var l=this.getCellCustomWidth(r,a==null?void 0:a.width);return ac(l)?l:o.getLayoutWidthType()!==y_.Adaptive?this.getCompactGridRowWidth(r):this.getAdaptGridColWidth(n)},t.prototype.getAdaptTreeColWidth=function(r,n,i){var a=this.getCanvasHW().width,o=a-this.getSeriesNumberWidth(),s=Math.min(o/2,this.getTreeRowHeaderWidth()),l=Math.max(1,n.length),u=this.cfg.cellCfg;return Math.max(rD(u,this.getColLabelLength(r,i)),(o-s)/l)},t.prototype.getColLabelLength=function(r,n){var i,a=wMe(r==null?void 0:r.value);if(Xn(a))return a.length;for(var o=1,s=0;s<XP;s++){var l=n[s];if(!l)return o;for(var u=this.cfg.dataSet.getCellData({query:qt(qt({},r.query),l.query),rowNode:l,isTotals:r.isTotals||r.isTotalMeasure||l.isTotals||l.isTotalMeasure,totalStatus:gC(l,r)}),c=Es(u==null?void 0:u[v6]),f=0;f<c.length;f++){var d=u[c[f]],v=px((i=d==null?void 0:d.values)===null||i===void 0?void 0:i[0]);v>o&&(o=v)}}return o},t.prototype.getAdaptGridColWidth=function(r,n){var i=this.cfg,a=i.rows,o=i.cellCfg,s=a.length,l=r.length,u=this.getCanvasHW().width,c=u-this.getSeriesNumberWidth(),f=Math.max(1,s+l);return n?Math.max(rD(o),(c-n)/l):Math.max(rD(o),c/f)},t.prototype.getTreeRowHeaderWidth=function(){var r,n,i,a,o=this.cfg,s=o.rows,l=o.dataSet,u=o.rowCfg,c=o.treeRowsWidth,f=c??(u==null?void 0:u.treeRowsWidth);if(ac(f))return f;var d=this.getCellCustomWidth(null,u==null?void 0:u.width);if(ac(d))return d;var v=s.map(function(R){return l.getFieldName(R)}).join("/"),g=this.spreadsheet.theme.cornerCell,x=g.bolderText,w=g.icon,S=1+this.spreadsheet.measureTextWidth(v,x)+w.size*2+((r=w.margin)===null||r===void 0?void 0:r.left)+((n=w.margin)===null||n===void 0?void 0:n.right)+((i=this.rowCellTheme.padding)===null||i===void 0?void 0:i.left)+((a=this.rowCellTheme.padding)===null||a===void 0?void 0:a.right),M=Math.max(f??Wj,S);return Number.isNaN(M)?Wj:M},t.prototype.getCompactGridRowWidth=function(r){var n=this,i,a=this.cfg,o=a.dataSet,s=a.spreadsheet,l=s.theme.rowCell,u=l.bolderText,c=l.icon,f=l.cell,d=s.theme.cornerCell,v=d.bolderText,g=d.icon,x=d.cell,w=r.field,S=r.isLeaf,M=this.getExpectedCellIconWidth(kr.ROW_CELL,!s.isValueInCols()&&S&&s.options.showDefaultHeaderActionIcon,c),R=(i=o.getDimensionValues(w))===null||i===void 0?void 0:i.slice(0,XP).map(function(J){var Z,X;return(X=(Z=n.spreadsheet.dataSet.getFieldFormatter(w))===null||Z===void 0?void 0:Z(J))!==null&&X!==void 0?X:J}),I=e8(R,function(J){return"".concat(J).length}),P=s.measureTextWidth(I,u)+M+f.padding.left+f.padding.right,k=o.getFieldName(w),z=this.getExpectedCellIconWidth(kr.CORNER_CELL,!1,g),G=s.measureTextWidth(k,v)+z+x.padding.left+x.padding.right;return Wp.getInstance().logger("Max Label In Row:",w,P>G?I:k),Math.max(P,G)},t.prototype.getViewCellHeights=function(r){var n=r.rowLeafNodes,i=gL(n,function(a,o){return a.push(no(a)+o.height),a},[0]);return{getTotalHeight:function(){return no(i)||0},getCellOffsetY:function(a){return i[a]||0},getTotalLength:function(){return i.length-1},getIndexRange:function(a,o){return Cft(i,a,o)}}},t.prototype.getRowHeader=function(){if(!this.rowHeader){var r=this.getRowHeaderCfg(),n=r.viewportHeight,i=H3(r,["viewportHeight"]),a=wb(this.cfg,this.layoutResult.rowNodes).frozenRowHeight;return new nLe(qt(qt({},i),{viewportHeight:n-a}))}},t.prototype.enableFrozenFirstRow=function(){return!!this.getBizRevisedFrozenOptions().frozenRowCount},t}(Ift),hLe=function(e){nn(t,e);function t(r){var n=this,i,a,o;n=e.call(this,r)||this,n.getScrollGroupClipBBox=function(){var g,x=n.headerConfig,w=x.width,S=x.height,M=x.scrollX,R=x.spreadsheet,I=R.options;if(!I.frozenColCount&&!I.frozenTrailingColCount)return{x:M,y:0,width:w,height:S};for(var P=(g=R.facet)===null||g===void 0?void 0:g.layoutResult.colLeafNodes,k=Qm(R.options,P.length),z=k.frozenColCount,G=k.frozenTrailingColCount,J=0,Z=0,X=0;X<z;X++)J+=P[X].width;for(var X=0;X<G;X++)Z+=P[P.length-1-X].width;var et=w-J-Z;return{x:M+J,y:0,width:et,height:S}};var s=(i=n.headerConfig.spreadsheet)===null||i===void 0?void 0:i.options,l=s.frozenColCount,u=s.frozenTrailingColCount,c=(o=(a=n.headerConfig.spreadsheet)===null||a===void 0?void 0:a.facet)===null||o===void 0?void 0:o.layoutResult.colNodes.filter(function(g){return Xp(g)}),f=vI(c,l,u),d=f.colCount,v=f.trailingColCount;return n.finalColCount=d,n.finalTrailingColCount=v,d&&(n.frozenColGroup=n.addGroup({name:ode,zIndex:cS})),v&&(n.frozenTrailingColGroup=n.addGroup({name:sde,zIndex:cS})),n}return t.prototype.isFrozenCell=function(r){var n=this.headerConfig.spreadsheet,i=n==null?void 0:n.options,a=i.frozenColCount,o=i.frozenTrailingColCount,s=r.colIndex,l=n==null?void 0:n.facet.layoutResult.colLeafNodes;return qy(s,a)||Ky(s,o,l.length)},t.prototype.clear=function(){var r,n,i=this.headerConfig.spreadsheet;e.prototype.clear.call(this),(r=this.frozenTrailingColGroup)===null||r===void 0||r.clear(),(n=this.frozenColGroup)===null||n===void 0||n.clear();var a=i==null?void 0:i.foregroundGroup.findById(Alt);a==null||a.clear()},t.prototype.getCellInstance=function(r,n,i){return r.field===m_?new YRe(r,n,i):new Zht(r,n,i)},t.prototype.getCellGroup=function(r){var n,i=this.headerConfig.spreadsheet,a=v5(r).colIndex;return qy(a,this.finalColCount)?this.frozenColGroup:Ky(a,this.finalTrailingColCount,(n=i==null?void 0:i.facet)===null||n===void 0?void 0:n.layoutResult.colLeafNodes.length)?this.frozenTrailingColGroup:this.scrollGroup},t.prototype.isColCellInRect=function(r){var n,i=this.headerConfig.spreadsheet,a=(n=i==null?void 0:i.facet)===null||n===void 0?void 0:n.layoutResult.colLeafNodes.length,o=v5(r).colIndex;return qy(o,this.finalColCount)||Ky(o,this.finalTrailingColCount,a)?!0:e.prototype.isColCellInRect.call(this,r)},t.prototype.clip=function(){this.scrollGroup.setClip({type:"rect",attrs:this.getScrollGroupClipBBox()})},t}(G8),fLe=function(e){nn(t,e);function t(r){var n=e.call(this,r)||this;n.onSortHandler=function(a){var o=n.spreadsheet,s=a;Array.isArray(a)||(s=[a]);var l=o.dataCfg.sortParams||[];s=s.map(function(c){var f,d,v=qt(qt({},c),{sortFieldId:(f=c.sortKey)!==null&&f!==void 0?f:c.sortFieldId}),g=(d=l.find(function(x){return x.sortFieldId===v.sortFieldId}))!==null&&d!==void 0?d:{};return qt(qt({},g),v)});var u=l.filter(function(c){var f=s.find(function(d){return d.sortFieldId===c.sortFieldId});return!f});mS(o.dataCfg,"sortParams",Gr(Gr([],ur(u),!1),ur(s),!1)),o.setDataCfg(o.dataCfg),o.render(!0),o.emit(Re.RANGE_SORTED,o.dataSet.getDisplayDataSet())},n.onFilterHandler=function(a){var o=n.spreadsheet,s=!a.filteredValues||a.filteredValues.length===0,l=o.dataCfg.filterParams||[],u=l.findIndex(function(c){return c.filterKey===a.filterKey});u!==-1?s?l.splice(u,1):l[u]=a:l.push(a),mS(o.dataCfg,"filterParams",l),o.render(!0),o.emit(Re.RANGE_FILTERED,o.dataSet.getDisplayDataSet())},n.renderFrozenPanelCornerGroup=function(){var a=n.layoutResult.colNodes.filter(function(w){return Xp(w)}),o=n.getCellRange(),s=Qm(n.spreadsheet.options,a.length,o.end-o.start+1),l=s.frozenRowCount,u=s.frozenColCount,c=s.frozenTrailingRowCount,f=s.frozenTrailingColCount,d=vI(a,u,f),v=d.colCount,g=d.trailingColCount,x=jAe({frozenRowCount:l,frozenColCount:v,frozenTrailingRowCount:c,frozenTrailingColCount:g},n.layoutResult.colLeafNodes.length,o);Object.keys(x).forEach(function(w){var S=x[w],M=n.spreadsheet[Olt[w]];M&&S.forEach(function(R){n.addFrozenCell(R.x,R.y,M)})})},n.addFrozenCell=function(a,o,s){var l=n.layoutResult.getCellMeta(o,a);if(l.isFrozenCorner=!0,l){var u=n.cfg.dataCell(l);s.add(u)}};var i=n.spreadsheet;return i.on(Re.RANGE_SORT,n.onSortHandler),i.on(Re.RANGE_FILTER,n.onFilterHandler),n}return t.prototype.updateRowResizeArea=function(){var r=this.spreadsheet,n=r.foregroundGroup,i=r.options,a=ai(i,"interaction.resize"),o=Gp(a)?a:a==null?void 0:a.rowCellVertical;if(o){var s=n.findById(yb),l=n.findById(Slt);s&&s.set("children",[]),l&&l.set("children",[]);var u=mC(this.panelGroup.getChildren(),SL).filter(function(c){return c.shouldDrawResizeArea()});u==null||u.forEach(function(c){c.drawResizeArea()})}},t.prototype.clip=function(r,n){e.prototype.clip.call(this,r,n),this.clipResizeAreaGroup()},t.prototype.clipResizeAreaGroup=function(){var r,n,i=this.spreadsheet.foregroundGroup.findById(yb);if(i){var a=this.layoutResult.colLeafNodes,o=this.spreadsheet,s=o.frozenRowGroup,l=o.frozenTrailingRowGroup,u=0,c=0;s&&(u=s.getBBox().height),l&&(c=l.getBBox().height);var f=this.panelBBox.height-u-c;i.setClip({type:"rect",attrs:{x:0,y:u+this.cornerBBox.height,width:(n=(r=a==null?void 0:a[0])===null||r===void 0?void 0:r.width)!==null&&n!==void 0?n:0,height:f}})}},t.prototype.getContentHeight=function(){var r=this.getViewCellHeights().getTotalHeight,n=this.layoutResult.colsHierarchy;return r()+n.height},Object.defineProperty(t.prototype,"dataCellTheme",{get:function(){return this.spreadsheet.theme.dataCell.cell},enumerable:!1,configurable:!0}),t.prototype.destroy=function(){var r=this.spreadsheet;r.off(Re.RANGE_SORT,this.onSortHandler),r.off(Re.RANGE_FILTER,this.onFilterHandler),e.prototype.destroy.call(this)},t.prototype.calculateCornerBBox=function(){var r=this.layoutResult.colsHierarchy,n=Math.floor(r.height);this.cornerBBox=new Aft(this),this.cornerBBox.height=n,this.cornerBBox.maxY=n},t.prototype.doLayout=function(){var r=this,n=this.cfg,i=n.dataSet,a=n.spreadsheet,o=new ght,s=O5({isRowHeader:!1,facetCfg:this.cfg}),l=s.leafNodes,u=s.hierarchy;this.calculateColNodesCoordinate(l,u);var c=function(d,v){var g,x=r.cfg.showSeriesNumber,w=l[v],S=r.getCellHeight(d),M=r.getCellRange(),R=Qm(r.cfg,l.length,M.end-M.start+1).frozenTrailingRowCount,I,P=w.x,k=r.viewCellHeights.getCellOffsetY(d);return D2(d,M.end,R)&&(k=r.panelBBox.maxY-r.getTotalHeightForRange(d,M.end)),x&&w.field===m_?I="".concat(d+1):I=i.getCellData({query:{field:w.field,rowIndex:d}}),{spreadsheet:a,x:P,y:k,width:w.width,height:S,data:(g={},g[w.field]=I,g),rowIndex:d,colIndex:v,isTotals:!1,colId:w.id,rowId:String(d),valueField:w.field,fieldValue:I,id:B2(String(d),w.id)}},f={colNodes:u.getNodes(),colsHierarchy:u,rowNodes:o.getNodes(),rowsHierarchy:o,rowLeafNodes:o.getLeaves(),colLeafNodes:l,getCellMeta:c,spreadsheet:a};return f},t.prototype.getAdaptiveColWidth=function(r){var n=this.cfg.cellCfg,i=this.cfg.showSeriesNumber;if(this.spreadsheet.getLayoutWidthType()!==y_.Compact){var a=this.getSeriesNumberWidth(),o=r.length-(i?1:0),s=this.getCanvasHW().width-a;return Math.max(n==null?void 0:n.width,s/Math.max(1,o))}return n==null?void 0:n.width},t.prototype.getColNodeHeight=function(r,n){var i=this.cfg.colCfg,a=Bg(i==null?void 0:i.heightByField)[0],o=a||(i==null?void 0:i.height);if(!n||r.children&&r.children.length)return o;for(;r.parent;)n-=Xp(r)?0:o,r=r.parent;return n},t.prototype.calculateColNodesCoordinate=function(r,n){var i,a,o,s,l,u,c=cu.blankNode(),f=n.getNodes();try{for(var d=Kf(n.sampleNodesForAllLevels),v=d.next();!v.done;v=d.next()){var g=v.value;g.height=this.getColNodeHeight(g),n.height+=g.height}}catch(G){i={error:G}}finally{try{v&&!v.done&&(a=d.return)&&a.call(d)}finally{if(i)throw i.error}}for(var x=this.getAdaptiveColWidth(r),w=0,S=0;S<f.length;S++){var M=f[S];M.isLeaf&&(M.colIndex=w,w+=1,M.x=c.x+c.width,M.width=this.calculateColLeafNodesWidth(M,x),p5(this.cfg,null,M),n.width+=M.width,c=M),M.level===0?M.y=0:M.y=(l=((o=M.parent)===null||o===void 0?void 0:o.y)+((s=M.parent)===null||s===void 0?void 0:s.height))!==null&&l!==void 0?l:0,M.height=this.getColNodeHeight(M,n.height)}var R=f.filter(function(G){return Xp(G)}),I=Qm((u=this.spreadsheet)===null||u===void 0?void 0:u.options,R.length).frozenTrailingColCount;c=cu.blankNode();var P=this.getCanvasHW().width;if(I>0)for(var k=vI(R,0,I).trailingColCount,z=f.filter(function(G){return G.isLeaf}),S=1;S<=k;S++){var M=z[z.length-S];S===1?M.x=P-M.width:M.x=c.x-M.width,c=M}this.autoCalculateColNodeWidthAndX(r)},t.prototype.autoCalculateColNodeWidthAndX=function(r){for(var n=null,i=r.slice(0);i.length;){var a=i.shift(),o=a.parent;n!==o&&o&&(i.push(o),o.x=o.children[0].x,o.width=o.children.map(function(s){return s.width}).reduce(function(s,l){return s+l},0),n=o)}},t.prototype.calculateColLeafNodesWidth=function(r,n){var i=this.cfg,a=i.colCfg,o=i.dataSet,s=i.spreadsheet,l=this.spreadsheet.getLayoutWidthType(),u=this.getCellDraggedWidth(r);if(ac(u))return u;var c=this.getCellCustomWidth(r,a==null?void 0:a.width);if(ac(c))return c;var f;if(l===y_.Compact){var d=o.getDisplayDataSet(),v=o.getFieldFormatter(r.field),g=e8(d==null?void 0:d.slice(0,50).map(function(k){var z;return"".concat((z=v==null?void 0:v(k[r.field]))!==null&&z!==void 0?z:k[r.field])}),function(k){return s.measureTextWidthRoughly(k)});Wp.getInstance().logger("Max Label In Col:",r.field,g);var x=s.theme.colCell.bolderText,w=s.theme.dataCell,S=w.text,M=w.cell,R=1,I=s.measureTextWidth(g,S)+M.padding.left+M.padding.right+R,P=s.measureTextWidth(r.label,x)+jRe(this.spreadsheet,r,s.theme.colCell);f=Math.max(P,I)}else f=n;return r.field===m_&&(f=this.getSeriesNumberWidth()),f},t.prototype.initRowOffsets=function(){var r=this,n,i=this.cfg.dataSet,a=(((n=this.spreadsheet.options.style)===null||n===void 0?void 0:n.rowCfg)||{}).heightByField,o=a===void 0?{}:a;if(Object.keys(o).length){var s=i.getDisplayDataSet();this.rowOffsets=[0];var l=0;s.forEach(function(u,c){var f,d=(f=o==null?void 0:o[String(c)])!==null&&f!==void 0?f:r.getDefaultCellHeight(),v=l+d;r.rowOffsets.push(v),l=v})}},t.prototype.getCellHeight=function(r){var n;if(this.rowOffsets){var i=(((n=this.spreadsheet.options.style)===null||n===void 0?void 0:n.rowCfg)||{}).heightByField,a=i===void 0?{}:i,o=a==null?void 0:a[String(r)];if(ac(o))return o}return this.getDefaultCellHeight()},t.prototype.getViewCellHeights=function(){var r=this,n=this.cfg.dataSet,i=this.getDefaultCellHeight();return{getTotalHeight:function(){return r.rowOffsets?no(r.rowOffsets):i*n.getDisplayDataSet().length},getCellOffsetY:function(a){if(a<=0)return 0;if(r.rowOffsets)return r.rowOffsets[a];for(var o=0,s=0;s<a;s++)o+=i;return o},getTotalLength:function(){return n.getDisplayDataSet().length},getIndexRange:function(a,o){if(r.rowOffsets)return Cft(r.rowOffsets,a,o);var s=Math.floor(a/i),l=o%i===0?o/i-1:Math.floor(o/i);return{start:Math.max(0,s),end:Math.max(0,l)}}}},t.prototype.init=function(){this.initRowOffsets(),e.prototype.init.call(this);var r=this.panelBBox,n=r.width,i=r.height;this.spreadsheet.panelGroup.setClip({type:"rect",attrs:{x:0,y:this.cornerBBox.height,width:n,height:i}})},t.prototype.getColHeader=function(){if(!this.columnHeader){var r=this.panelBBox,n=r.x,i=r.width,a=r.viewportHeight,o=r.viewportWidth;return new hLe({width:i,height:this.cornerBBox.height,viewportWidth:o,viewportHeight:a,cornerWidth:this.cornerBBox.width,position:{x:n,y:0},data:this.layoutResult.colNodes,scrollContainsRowHeader:this.cfg.spreadsheet.isScrollContainsRowHeader(),sortParam:this.cfg.spreadsheet.store.get("sortParam"),spreadsheet:this.spreadsheet})}return this.columnHeader},t.prototype.render=function(){this.renderFrozenPanelCornerGroup(),e.prototype.render.call(this)},t.prototype.getRowHeader=function(){return null},t.prototype.getSeriesNumberHeader=function(){return null},t}(Ift),Dft=function(e){nn(t,e);function t(r){var n=e.call(this,r)||this;return n.gridInfo={cols:[],rows:[]},n.updateGrid=function(i,a){a===void 0&&(a=zj);var o=n.getBBox(),s=n.s2,l=s.theme,u=s.isTableMode,c=l.dataCell.cell,f=u()&&(a===zj||a===Clt);(!n.gridGroup||!n.findById(a))&&(n.gridGroup=n.addGroup({id:a})),n.gridGroup.clear(),n.gridInfo=i,f&&n.gridInfo.cols.unshift(0);var d=c.verticalBorderWidth,v=c.verticalBorderWidth/2;n.gridInfo.cols.forEach(function(w){hu(n.gridGroup,{x1:w,x2:w,y1:Math.ceil(o.minY+v),y2:Math.floor(o.maxY-v)},{stroke:c.verticalBorderColor,strokeOpacity:c.verticalBorderColorOpacity,lineWidth:d,lineCap:Hj,lineDash:c.borderDash})});var g=c.horizontalBorderWidth,x=c.horizontalBorderWidth/2;n.gridInfo.rows.forEach(function(w){hu(n.gridGroup,{x1:Math.ceil(o.minX+x),x2:Math.floor(o.maxX-x),y1:w,y2:w},{stroke:c.horizontalBorderColor,strokeOpacity:c.horizontalBorderColorOpacity,lineWidth:g,lineCap:Hj,lineDash:c.borderDash})}),n.gridGroup.toFront()},n.s2=r.s2,n}return t}(hv),Fft=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(Dft),dLe=function(e){nn(t,e);function t(r){var n=e.call(this,r)||this;return n.initMergedCellsGroup(),n}return t.prototype.initMergedCellsGroup=function(){this.mergedCellsGroup&&this.findById(Nj)||(this.mergedCellsGroup=this.addGroup({id:Nj}))},t.prototype.updateMergedCells=function(){this.initMergedCellsGroup(),LRe(this.s2,this.mergedCellsGroup),this.mergedCellsGroup.toFront()},t.prototype.addMergeCell=function(r){var n;(n=this.mergedCellsGroup)===null||n===void 0||n.add(r)},t.prototype.update=function(r){this.updateGrid(r),this.updateMergedCells()},t}(Dft),op=function(){function e(t){var r=this;this.isLinkFieldText=function(n){var i=r.getCellAppendInfo(n);return i==null?void 0:i.isLinkFieldText},this.spreadsheet=t,this.bindEvents()}return e.prototype.getCellAppendInfo=function(t){var r,n;return((r=t==null?void 0:t.attr)===null||r===void 0?void 0:r.call(t,"appendInfo"))||((n=t==null?void 0:t.attrs)===null||n===void 0?void 0:n.appendInfo)||{}},e.prototype.reset=function(){},e}(),pLe=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.bindEvents=function(){this.bindDataCellClick()},t.prototype.bindDataCellClick=function(){var r=this;this.spreadsheet.on(Re.DATA_CELL_CLICK,function(n){var i;n.stopPropagation();var a=r.spreadsheet.interaction;if(a.clearHoverTimer(),!a.hasIntercepts([Ai.CLICK])){if(r.isLinkFieldText(n.target)){r.emitLinkFieldClickEvent(n);return}var o=r.spreadsheet.getCell(n.target),s=o.getMeta();if(s){if(a.addIntercepts([Ai.HOVER]),a.isSelectedCell(o)){((i=n.originalEvent)===null||i===void 0?void 0:i.detail)===1&&(a.reset(),r.spreadsheet.emit(Re.GLOBAL_SELECTED,a.getActiveCells()));return}a.changeState({cells:[Jp(o)],stateName:Dn.SELECTED,onUpdateCells:F8}),r.spreadsheet.emit(Re.GLOBAL_SELECTED,[o]),r.showTooltip(n,s);var l=s.rowId,u=s.colId,c=s.spreadsheet,f=a.getSelectedCellHighlight(),d=f.colHeader,v=f.rowHeader;if(d&&zht(u,a.getAllColHeaderCells(),Dn.SELECTED),v&&l){var g=fIe(s,c);bi(g,function(x){x.updateByState(Dn.SELECTED)})}}}})},t.prototype.getTooltipOperator=function(r,n){var i=this,a=cAe(),o=this.spreadsheet.getCell(r.target),s=U8(this.spreadsheet,r).operation,l=s.trend&&qt(qt({},a),{onClick:function(){i.spreadsheet.emit(Re.DATA_CELL_TREND_ICON_CLICK,qt(qt({},n),{record:i.spreadsheet.isTableMode()?i.spreadsheet.dataSet.getCellData({query:{rowIndex:n.rowIndex}}):void 0})),i.spreadsheet.hideTooltip()}});return vft(s,{defaultMenus:[l],cell:o})},t.prototype.showTooltip=function(r,n){var i=n.data,a=n.isTotals,o=a===void 0?!1:a,s=n.value,l=n.fieldValue,u=n.field,c=n.valueField,f=i,d=this.spreadsheet.isTableMode(),v=d?qt(qt({},f),{value:s||l,valueField:u||c}):f,g=[v||qt(qt({},n.rowQuery),n.colQuery)],x=this.getTooltipOperator(r,n);this.spreadsheet.showTooltipWithInfo(r,g,{isTotals:o,operator:x,enterable:!0,hideSummary:!0,showSingleTips:d})},t.prototype.emitLinkFieldClickEvent=function(r){var n=this.getCellAppendInfo(r.target).cellData,i=n.valueField,a=n.data;this.spreadsheet.emit(Re.GLOBAL_LINK_FIELD_JUMP,{key:i,cellData:n,record:Object.assign({rowIndex:n.rowIndex},a)})},t}(op),vLe=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.bindEvents=function(){this.bindDataCellClick()},t.prototype.bindDataCellClick=function(){var r=this;this.spreadsheet.on(Re.MERGED_CELLS_CLICK,function(n){n.stopPropagation();var i=r.spreadsheet.interaction;i.hasIntercepts([Ai.CLICK])||i.addIntercepts([Ai.HOVER])})},t}(op),gLe=function(e){nn(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.isMultiSelection=!1,r.handleRowColClick=function(n){if(n.stopPropagation(),!r.isLinkFieldText(n.target)){var i=r.spreadsheet,a=i.interaction,o=i.options,s=r.spreadsheet.getCell(n.target),l=o.interaction.multiSelection,u=!!(l&&r.isMultiSelection),c=a.selectHeaderCell({cell:s,isMultiSelection:u});c&&r.showTooltip(n)}},r.getHideColumnField=function(n){return r.spreadsheet.isTableMode()?n.field:n.id},r}return t.prototype.bindEvents=function(){this.bindKeyboardDown(),this.bindKeyboardUp(),this.bindColCellClick(),this.bindRowCellClick(),this.bindTableColExpand(),this.bindMouseMove()},t.prototype.reset=function(){this.isMultiSelection=!1,this.spreadsheet.interaction.removeIntercepts([Ai.CLICK])},t.prototype.bindKeyboardDown=function(){var r=this;this.spreadsheet.on(Re.GLOBAL_KEYBOARD_DOWN,function(n){xI(n)&&(r.isMultiSelection=!0)})},t.prototype.bindKeyboardUp=function(){var r=this;this.spreadsheet.on(Re.GLOBAL_KEYBOARD_UP,function(n){xI(n)&&r.reset()})},t.prototype.bindMouseMove=function(){var r=this;this.spreadsheet.on(Re.GLOBAL_MOUSE_MOVE,function(n){r.isMultiSelection&&!tft(n)&&r.reset()})},t.prototype.bindRowCellClick=function(){var r=this;this.spreadsheet.on(Re.ROW_CELL_CLICK,function(n){r.handleRowColClick(n)})},t.prototype.bindColCellClick=function(){var r=this;this.spreadsheet.on(Re.COL_CELL_CLICK,function(n){r.handleRowColClick(n)})},t.prototype.showTooltip=function(r){var n=U8(this.spreadsheet,r),i=n.operation,a=n.showTooltip;if(a){var o=this.spreadsheet.interaction,s=o.isSelectedState()?w3e(o.getActiveCells()):[],l=this.getTooltipOperator(r,i);this.spreadsheet.showTooltipWithInfo(r,s,{showSingleTips:!0,operator:l})}},t.prototype.getTooltipOperator=function(r,n){var i=this,a=this.spreadsheet.getCell(r.target),o=a.getMeta(),s=a.cellType===kr.COL_CELL,l=this.spreadsheet.getColumnLeafNodes().length===1,u=uAe(),c=s&&!l&&o.isLeaf&&n.hiddenColumns,f=c&&qt(qt({},u),{onClick:function(){i.hideSelectedColumns()}});return vft(n,{defaultMenus:[f],cell:a})},t.prototype.bindTableColExpand=function(){var r=this;this.spreadsheet.on(Re.LAYOUT_COLS_EXPANDED,function(n){r.handleExpandIconClick(n)})},t.prototype.hideSelectedColumns=function(){var r=this.spreadsheet.interaction,n=r.getActiveCells().map(function(a){return a.getMeta()}),i=n.map(this.getHideColumnField);I8(this.spreadsheet,i,!0)},t.prototype.handleExpandIconClick=function(r){var n=this.spreadsheet.store.get("hiddenColumnsDetail",[]),i=(cL(n,function(c){var f=c.displaySiblingNode;return _5(f,r.id)})||{}).hideColumnNodes,a=i===void 0?[]:i,o=this.spreadsheet.options.interaction.hiddenColumnFields,s=a.map(this.getHideColumnField),l=act(o,s),u=n.filter(function(c){var f=c.displaySiblingNode;return!_5(f,r.id)});this.spreadsheet.setOptions({interaction:{hiddenColumnFields:l}}),this.spreadsheet.store.set("hiddenColumnsDetail",u),this.spreadsheet.interaction.reset(),this.spreadsheet.render(!1)},t}(op),mLe=function(e){nn(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.getRowData=function(n){var i,a=n.getHeadLeafChild(),o=r.spreadsheet.dataSet.getMultiData(a==null?void 0:a.query)[0];return qt(qt({},o),{rowIndex:(i=n.rowIndex)!==null&&i!==void 0?i:a.rowIndex})},r}return t.prototype.bindEvents=function(){this.bindRowCellClick()},t.prototype.bindRowCellClick=function(){var r=this;this.spreadsheet.on(Re.ROW_CELL_CLICK,function(n){if(!r.spreadsheet.interaction.hasIntercepts([Ai.CLICK])&&r.isLinkFieldText(n.target)){var i=r.getCellAppendInfo(n.target).cellData,a=i.key,o=r.getRowData(i);r.spreadsheet.emit(Re.GLOBAL_LINK_FIELD_JUMP,{key:a,cellData:i,record:o})}})},t}(op),yLe=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.bindEvents=function(){this.bindCornerCellClick()},t.prototype.bindCornerCellClick=function(){var r=this;this.spreadsheet.on(Re.CORNER_CELL_CLICK,function(n){var i,a=r.spreadsheet.interaction,o=r.spreadsheet.getCell(n.target);if(o){var s=o.getMeta(),l=r.getRowNodesByField(s==null?void 0:s.field),u=(i=l[0])===null||i===void 0?void 0:i.belongsCell,c=r.getRowCells(l);if(u&&a.isSelectedCell(u)){a.reset(),r.spreadsheet.emit(Re.GLOBAL_SELECTED,a.getActiveCells());return}Dr(l)||Dr(c)||(a.addIntercepts([Ai.HOVER]),a.changeState({cells:c,stateName:Dn.SELECTED}),a.highlightNodes(l),r.showTooltip(n),r.spreadsheet.emit(Re.GLOBAL_SELECTED,a.getActiveCells()))}})},t.prototype.getRowNodesByField=function(r){return this.spreadsheet.getRowNodes().filter(function(n){return n.field===r})},t.prototype.getRowCells=function(r){return r.map(function(n){return{id:n.id,colIndex:-1,rowIndex:-1,type:kr.ROW_CELL}})},t.prototype.showTooltip=function(r){var n=this.spreadsheet.interaction.getActiveCells();this.spreadsheet.showTooltipWithInfo(r,[],{data:{summaries:[{selectedData:n,name:"",value:null}]}})},t}(op),_Le=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.bindEvents=function(){this.bindCornerCellHover(),this.bindDataCellHover(),this.bindRowCellHover(),this.bindColCellHover()},t.prototype.updateRowColCells=function(r){var n=r.rowId,i=r.colId,a=this.spreadsheet.interaction,o=a.getHoverHighlight(),s=o.rowHeader,l=o.colHeader;if(l&&zht(i,a.getAllColHeaderCells(),Dn.HOVER),s&&n){var u=M8(n,a.getAllRowHeaderCells(),this.spreadsheet.isHierarchyTreeType());bi(u,function(c){c.updateByState(Dn.HOVER)})}},t.prototype.changeStateToHoverFocus=function(r,n,i){var a=this,o,s=this.spreadsheet.interaction,l=this.spreadsheet.options.interaction,u=l.hoverFocus;s.clearHoverTimer();var c=function(){if(!s.hasIntercepts([Ai.HOVER])){s.changeState({cells:[Jp(r)],stateName:Dn.HOVER_FOCUS});var v=a.spreadsheet.isTableMode(),g={isTotals:i.isTotals,enterable:!0,hideSummary:!0,showSingleTips:v},x=s.getHoverHighlight(),w=x.rowHeader,S=x.colHeader;(w||S)&&a.updateRowColCells(i);var M=a.getCellData(i,v);a.spreadsheet.showTooltipWithInfo(n,M,g)}},f=WB;if(Gp(u)||(f=(o=u==null?void 0:u.duration)!==null&&o!==void 0?o:WB),f===0)c();else{var d=window.setTimeout(function(){return c()},f);s.setHoverTimer(d)}},t.prototype.handleHeaderHover=function(r){var n=this.spreadsheet.getCell(r.target);if(!Dr(n)){var i=this.spreadsheet.interaction;i.clearHoverTimer(),!i.isActiveCell(n)&&(i.changeState({cells:[Jp(n)],stateName:Dn.HOVER}),n.update(),this.showEllipsisTooltip(r,n))}},t.prototype.showEllipsisTooltip=function(r,n){if(!n||!n.isTextOverflowing()){this.spreadsheet.hideTooltip();return}var i=n.getMeta(),a=!0,o={isTotals:i.isTotals,enterable:!0,hideSummary:!0,showSingleTips:a,enableFormat:!0},s=this.getCellData(i,a);this.spreadsheet.showTooltipWithInfo(r,s,o)},t.prototype.getCellData=function(r,n){r===void 0&&(r={});var i=r.data,a=r.query,o=r.value,s=r.field,l=r.fieldValue,u=r.valueField,c=r.rowQuery,f=r.colQuery,d=i,v=n?[qt(qt({},a),{value:o||l,valueField:s||u})]:[d||qt(qt({},c),f)];return v},t.prototype.bindDataCellHover=function(){var r=this;this.spreadsheet.on(Re.DATA_CELL_HOVER,function(n){var i=r.spreadsheet.getCell(n.target);if(!Dr(i)){var a=r.spreadsheet,o=a.interaction,s=a.options,l=s.interaction,u=i==null?void 0:i.getMeta();if(!o.isActiveCell(i)){o.changeState({cells:[Jp(i)],stateName:Dn.HOVER});var c=o.getHoverHighlight(),f=c.rowHeader,d=c.colHeader;(f||d)&&r.updateRowColCells(u),l.hoverFocus&&r.changeStateToHoverFocus(i,n,u)}}})},t.prototype.bindRowCellHover=function(){var r=this;this.spreadsheet.on(Re.ROW_CELL_HOVER,function(n){r.handleHeaderHover(n)})},t.prototype.bindColCellHover=function(){var r=this;this.spreadsheet.on(Re.COL_CELL_HOVER,function(n){r.handleHeaderHover(n)})},t.prototype.bindCornerCellHover=function(){var r=this;this.spreadsheet.on(Re.CORNER_CELL_HOVER,function(n){r.handleHeaderHover(n)})},t}(op),X8=function(e){nn(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.displayedCells=[],r.brushRangeCells=[],r.brushSelectionStage=Du.UN_DRAGGED,r.brushSelectionMinimumMoveDistance=5,r.scrollAnimationComplete=!0,r.mouseMoveDistanceFromCanvas=0,r.setMoveDistanceFromCanvas=function(n,i,a){var o=0;if(i&&(o=n.x),a){var s=n.y;i?o=Math.max(s,o):o=s}r.mouseMoveDistanceFromCanvas=Math.abs(o)},r.formatBrushPointForScroll=function(n,i){var a,o,s,l;i===void 0&&(i=!1);var u=n.x,c=n.y,f=r.spreadsheet.facet,d=i?f.cornerBBox:f.panelBBox,v=d.minX,g=d.maxX,x=f.panelBBox,w=x.minY,S=x.maxY,M=((a=r.endBrushPoint)===null||a===void 0?void 0:a.x)+u,R=((o=r.endBrushPoint)===null||o===void 0?void 0:o.y)+c,I=!0,P=!0,k=(l=(s=f.vScrollBar)===null||s===void 0?void 0:s.getBBox())===null||l===void 0?void 0:l.width,z=2;return M>g?M=g-k-z:M<v?M=v+z:I=!1,R>S?R=S-z:R<=w?R=w+z:P=!1,{x:{value:M,needScroll:I},y:{value:R,needScroll:P}}},r.rectanglesIntersect=function(n,i){return n.maxX>i.minX&&n.minX<i.maxX&&n.minY<i.maxY&&n.maxY>i.minY},r.autoScrollIntervalId=null,r.autoScrollConfig=JB(Gj),r.validateYIndex=function(n){var i,a,o=r.spreadsheet.facet,s=o.frozenGroupInfo,l=0,u=(i=s==null?void 0:s.frozenRow)===null||i===void 0?void 0:i.range;if(u&&(l=u[1]+1),n<l)return null;var c=o.getCellRange().end,f=(a=s==null?void 0:s.frozenTrailingRow)===null||a===void 0?void 0:a.range;return f&&(c=f[0]-1),n>c?null:n},r.validateXIndex=function(n){var i,a,o=r.spreadsheet.facet,s=o.frozenGroupInfo,l=0,u=(i=s==null?void 0:s.frozenCol)===null||i===void 0?void 0:i.range;if(u&&(l=u[1]+1),n<l)return null;var c=o.layoutResult.colLeafNodes.length-1,f=(a=s==null?void 0:s.frozenTrailingCol)===null||a===void 0?void 0:a.range;return f&&(c=f[0]-1),n>c?null:n},r.adjustNextColIndexWithFrozen=function(n,i){var a=r.spreadsheet,o=a.facet,s=a.dataSet,l=a.options,u=s.getDisplayDataSet().length,c=o.layoutResult.colLeafNodes.length,f=Qm(l,c,u),d=f.frozenTrailingColCount,v=f.frozenColCount,g=o.panelScrollGroupIndexes;return d>0&&i===zl.SCROLL_DOWN&&Ky(n,d,c)?g[1]:v>0&&i===zl.SCROLL_UP&&qy(n,v)?g[0]:n},r.adjustNextRowIndexWithFrozen=function(n,i){var a=r.spreadsheet,o=a.facet,s=a.dataSet,l=a.options,u=s.getDisplayDataSet().length,c=o.layoutResult.colLeafNodes.length,f=o.getCellRange(),d=Qm(l,c,u),v=d.frozenTrailingRowCount,g=d.frozenRowCount,x=o.panelScrollGroupIndexes;return v>0&&i===zl.SCROLL_DOWN&&D2(n,f.end,v)?x[3]:g>0&&i===zl.SCROLL_UP&&bL(n,f.start,g)?x[2]:n},r.getWillScrollRowIndexDiff=function(n){return n===zl.SCROLL_DOWN?aI.SCROLL_DOWN:aI.SCROLL_UP},r.getDefaultWillScrollToRowIndex=function(n){var i=r.adjustNextRowIndexWithFrozen(r.endBrushPoint.rowIndex,n),a=i+r.getWillScrollRowIndexDiff(n);return r.validateYIndex(a)},r.getWillScrollToRowIndex=function(n){return r.getDefaultWillScrollToRowIndex(n)},r.getNextScrollDelta=function(n){var i=r.spreadsheet.facet.getScrollOffset(),a=i.scrollX,o=i.scrollY,s=0,l=0;if(n.y.scroll){var u=n.y.value>0?zl.SCROLL_DOWN:zl.SCROLL_UP,c=r.getWillScrollToRowIndex(u),f=vIe(c,u,r.spreadsheet)-o,d=Sl(c)||Sl(f)||Number.isNaN(f);l=d?0:f}if(n.x.scroll){var u=n.x.value>0?zl.SCROLL_DOWN:zl.SCROLL_UP,v=r.adjustNextColIndexWithFrozen(r.endBrushPoint.colIndex,u),g=r.validateXIndex(v+(n.x.value>0?1:-1));s=Sl(g)?0:pIe(g,u,r.spreadsheet)-a}return{x:s,y:l}},r.onScrollAnimationComplete=function(){r.scrollAnimationComplete=!0,r.brushSelectionStage!==Du.UN_DRAGGED&&r.renderPrepareSelected(r.endBrushPoint)},r.autoScroll=function(n){if(n===void 0&&(n=!1),!(r.brushSelectionStage===Du.UN_DRAGGED||!r.scrollAnimationComplete)){var i=r.autoScrollConfig,a=r.spreadsheet.facet.getScrollOffset(),o=n?"rowHeaderOffsetX":"offsetX",s={rowHeaderOffsetX:{value:a.rowHeaderScrollX,animate:!0},offsetX:{value:a.scrollX,animate:!0},offsetY:{value:a.scrollY,animate:!0}},l=r.getNextScrollDelta(i),u=l.x,c=l.y;if(c===0&&u===0){r.clearAutoScroll();return}if(i.y.scroll&&(s.offsetY.value+=c),i.x.scroll){var f=s[o];f.value+=u,f.value<0&&(f.value=0)}r.scrollAnimationComplete=!1;var d=i.x.scroll?1:3,v=Math.max(16,300-r.mouseMoveDistanceFromCanvas*d);r.spreadsheet.facet.scrollWithAnimation(s,v,r.onScrollAnimationComplete)}},r.handleScroll=v8(function(n,i,a){if(a===void 0&&(a=!1),r.brushSelectionStage!==Du.UN_DRAGGED){var o=r.formatBrushPointForScroll({x:n,y:i},a),s=o.x,l=s.value,u=s.needScroll,c=o.y,f=c.value,d=c.needScroll,v=r.autoScrollConfig;d&&(v.y.value=i,v.y.scroll=!0),u&&(v.x.value=n,v.x.scroll=!0),r.setMoveDistanceFromCanvas({x:n,y:i},u,d),r.renderPrepareSelected({x:l,y:f}),(d||u)&&(r.clearAutoScroll(),r.autoScroll(a),r.autoScrollIntervalId=setInterval(function(){r.autoScroll(a)},16))}},30),r.clearAutoScroll=function(){r.autoScrollIntervalId&&(clearInterval(r.autoScrollIntervalId),r.autoScrollIntervalId=null,r.resetScrollDelta())},r.onUpdateCells=function(n,i){return i()},r.showPrepareSelectedCells=function(){r.brushRangeCells=r.getBrushRangeCells(),r.spreadsheet.interaction.changeState({cells:oa(r.brushRangeCells,function(n){return Jp(n)}),stateName:Dn.PREPARE_SELECT,force:!0,onUpdateCells:r.onUpdateCells})},r.renderPrepareSelected=function(n){var i=n.x,a=n.y,o=r.spreadsheet.container.getShape(i,a),s=r.spreadsheet.getCell(o),l=s instanceof L0||s instanceof k2||s instanceof CL;if(!(!s||!l)){var u=s.getMeta(),c=u.rowIndex,f=u.colIndex;r.endBrushPoint={x:i,y:a,rowIndex:c,colIndex:f};var d=r.spreadsheet.interaction;d.addIntercepts([Ai.HOVER]),d.clearStyleIndependent(),r.isValidBrushSelection()&&(r.showPrepareSelectedCells(),r.updatePrepareSelectMask())}},r}return t.prototype.bindEvents=function(){this.bindMouseDown(),this.bindMouseMove(),this.bindMouseUp()},t.prototype.getPrepareSelectMaskTheme=function(){var r;return(r=this.spreadsheet.theme)===null||r===void 0?void 0:r.prepareSelectMask},t.prototype.initPrepareSelectMaskShape=function(){var r=this.spreadsheet.foregroundGroup;if(r){r.removeChild(this.prepareSelectMaskShape);var n=this.getPrepareSelectMaskTheme();this.prepareSelectMaskShape=r.addShape("rect",{visible:!1,attrs:{width:0,height:0,x:0,y:0,fill:n==null?void 0:n.backgroundColor,fillOpacity:n==null?void 0:n.backgroundOpacity,zIndex:Yfe},capture:!1})}},t.prototype.setBrushSelectionStage=function(r){this.brushSelectionStage=r},t.prototype.isPointInCanvas=function(r){var n=this.spreadsheet.facet.getCanvasHW(),i=n.height,a=n.width,o=this.spreadsheet.facet.panelBBox,s=o.minX,l=o.minY;return r.x>s&&r.x<a&&r.y>l&&r.y<i},t.prototype.resetDrag=function(){this.hidePrepareSelectMaskShape(),this.setBrushSelectionStage(Du.UN_DRAGGED)},t.prototype.isValidBrushSelection=function(){var r=this.getBrushRange(),n=r.start,i=r.end,a=i.x-n.x>this.brushSelectionMinimumMoveDistance||i.y-n.y>this.brushSelectionMinimumMoveDistance;return a},t.prototype.setDisplayedCells=function(){this.displayedCells=this.spreadsheet.interaction.getPanelGroupAllDataCells()},t.prototype.updatePrepareSelectMask=function(){var r=this.getBrushRange(),n=this.getPrepareSelectMaskPosition(r),i=n.x,a=n.y;this.prepareSelectMaskShape.attr({x:i,y:a,width:r.width,height:r.height}),this.prepareSelectMaskShape.show()},t.prototype.hidePrepareSelectMaskShape=function(){var r;(r=this.prepareSelectMaskShape)===null||r===void 0||r.hide()},t.prototype.resetScrollDelta=function(){this.autoScrollConfig=JB(Gj)},t.prototype.getBrushPoint=function(r){var n=this.spreadsheet.facet.getScrollOffset(),i=n.scrollY,a=n.scrollX,o={x:r==null?void 0:r.x,y:r==null?void 0:r.y},s=this.spreadsheet.getCell(r.target),l=s.getMeta(),u=l.colIndex,c=l.rowIndex;return qt(qt({},o),{rowIndex:c,colIndex:u,scrollY:i,scrollX:a})},t.prototype.getBrushRange=function(){var r,n,i,a,o,s,l,u,c=this.spreadsheet.facet.getScrollOffset(),f=c.scrollX,d=c.scrollY,v=Math.min(this.startBrushPoint.rowIndex,(r=this.endBrushPoint)===null||r===void 0?void 0:r.rowIndex),g=Math.max(this.startBrushPoint.rowIndex,(n=this.endBrushPoint)===null||n===void 0?void 0:n.rowIndex),x=Math.min(this.startBrushPoint.colIndex,(i=this.endBrushPoint)===null||i===void 0?void 0:i.colIndex),w=Math.max(this.startBrushPoint.colIndex,(a=this.endBrushPoint)===null||a===void 0?void 0:a.colIndex),S=this.startBrushPoint.x+this.startBrushPoint.scrollX-f,M=this.startBrushPoint.y+this.startBrushPoint.scrollY-d,R=Math.min(S,(o=this.endBrushPoint)===null||o===void 0?void 0:o.x),I=Math.max(S,(s=this.endBrushPoint)===null||s===void 0?void 0:s.x),P=Math.min(M,(l=this.endBrushPoint)===null||l===void 0?void 0:l.y),k=Math.max(M,(u=this.endBrushPoint)===null||u===void 0?void 0:u.y);return{start:{rowIndex:v,colIndex:x,x:R,y:P},end:{rowIndex:g,colIndex:w,x:I,y:k},width:I-R,height:k-P}},t.prototype.getBrushRangeCells=function(){var r=this;return this.setDisplayedCells(),this.displayedCells.filter(function(n){var i=n.getMeta();return r.isInBrushRange(i)})},t.prototype.mouseDown=function(r){var n;(n=r==null?void 0:r.preventDefault)===null||n===void 0||n.call(r),!this.spreadsheet.interaction.hasIntercepts([Ai.CLICK])&&(this.setBrushSelectionStage(Du.CLICK),this.initPrepareSelectMaskShape(),this.setDisplayedCells(),this.startBrushPoint=this.getBrushPoint(r))},t.prototype.addBrushIntercepts=function(){this.spreadsheet.interaction.addIntercepts([Ai.BRUSH_SELECTION])},t.prototype.bindMouseUp=function(r){var n=this;r===void 0&&(r=!1),this.spreadsheet.on(Re.GLOBAL_MOUSE_UP,function(i){if(n.brushSelectionStage!==Du.DRAGGED){n.resetDrag();return}if(r&&n.clearAutoScroll(),n.isValidBrushSelection()){n.addBrushIntercepts(),n.updateSelectedCells();var a=z8(n.spreadsheet);n.spreadsheet.showTooltipWithInfo(i,a)}n.spreadsheet.interaction.getCurrentStateName()===Dn.PREPARE_SELECT&&n.spreadsheet.interaction.reset(),n.resetDrag()}),this.spreadsheet.on(Re.GLOBAL_CONTEXT_MENU,function(){n.brushSelectionStage!==Du.UN_DRAGGED&&(n.spreadsheet.interaction.removeIntercepts([Ai.HOVER]),n.resetDrag())})},t.prototype.autoBrushScroll=function(r,n){var i,a;if(n===void 0&&(n=!1),this.clearAutoScroll(),!this.isPointInCanvas(r)){var o=(r==null?void 0:r.x)-((i=this.endBrushPoint)===null||i===void 0?void 0:i.x),s=(r==null?void 0:r.y)-((a=this.endBrushPoint)===null||a===void 0?void 0:a.y);return this.handleScroll(o,s,n),!0}return!1},t.prototype.emitBrushSelectionEvent=function(r,n){this.spreadsheet.emit(r,n),this.spreadsheet.emit(Re.GLOBAL_SELECTED,n),Dr(n)&&this.spreadsheet.interaction.removeIntercepts([Ai.HOVER])},t.prototype.getVisibleBrushRangeCells=function(r){return this.brushRangeCells.find(function(n){var i=n.getMeta();return(i==null?void 0:i.id)===r})},t.prototype.isInBrushRange=function(r){return!1},t.prototype.bindMouseDown=function(){},t.prototype.bindMouseMove=function(){},t.prototype.updateSelectedCells=function(){},t.prototype.getPrepareSelectMaskPosition=function(r){return{x:r.start.x,y:r.start.y}},t}(op),xLe=function(e){nn(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.displayedCells=[],r.brushRangeCells=[],r.onUpdateCells=function(n){return n.updateCells(n.getAllColHeaderCells())},r}return t.prototype.bindEvents=function(){this.bindMouseDown(),this.bindMouseMove(),this.bindMouseUp()},t.prototype.bindMouseDown=function(){var r=this;this.spreadsheet.on(Re.COL_CELL_MOUSE_DOWN,function(n){r.spreadsheet.interaction.getBrushSelection().col&&e.prototype.mouseDown.call(r,n)})},t.prototype.isPointInCanvas=function(r){var n=this.spreadsheet.facet.getCanvasHW().width,i=this.spreadsheet.facet.cornerBBox,a=i.width,o=i.minY,s=i.maxY;return r.x>=a&&r.x<=n&&r.y>=o&&r.y<=s},t.prototype.bindMouseMove=function(){var r=this;this.spreadsheet.on(Re.COL_CELL_MOUSE_MOVE,function(n){if(r.brushSelectionStage!==Du.UN_DRAGGED){r.setBrushSelectionStage(Du.DRAGGED);var i=r.spreadsheet.container.getPointByEvent(n.originalEvent);r.isPointInCanvas(i)&&r.renderPrepareSelected(i)}})},t.prototype.setDisplayedCells=function(){this.displayedCells=this.spreadsheet.interaction.getAllColHeaderCells()},t.prototype.isInBrushRange=function(r){var n=this.getBrushRange(),i=n.start,a=n.end,o=this.spreadsheet.facet.getScrollOffset().scrollX,s=this.spreadsheet.facet.cornerBBox,l=r.x,u=l===void 0?0:l,c=r.y,f=c===void 0?0:c,d=r.width,v=d===void 0?0:d,g=r.height,x=g===void 0?0:g;return this.rectanglesIntersect({minX:i.x-s.width+o,minY:i.y,maxX:a.x-s.width+o,maxY:a.y},{minX:u,maxX:u+v,minY:f,maxY:f+x})},t.prototype.updateSelectedCells=function(){var r=this.spreadsheet.interaction;r.changeState({cells:oa(this.brushRangeCells,Jp),stateName:Dn.BRUSH_SELECTED,onUpdateCells:this.onUpdateCells}),this.spreadsheet.emit(Re.COL_CELL_BRUSH_SELECTION,this.brushRangeCells),this.spreadsheet.emit(Re.GLOBAL_SELECTED,this.brushRangeCells),Dr(this.brushRangeCells)&&r.removeIntercepts([Ai.HOVER])},t.prototype.addBrushIntercepts=function(){this.spreadsheet.interaction.addIntercepts([Ai.COL_BRUSH_SELECTION])},t}(X8),bLe=function(e){nn(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.displayedCells=[],r.brushRangeCells=[],r.getSelectedCellMetas=function(n){var i=[],a=r.spreadsheet.facet.layoutResult,o=a.rowLeafNodes,s=o===void 0?[]:o,l=a.colLeafNodes,u=l===void 0?[]:l,c=kx(n.start.rowIndex,n.end.rowIndex+1),f=kx(n.start.colIndex,n.end.colIndex+1);return c.forEach(function(d){f.forEach(function(v){var g=String(u[v].id),x=Dr(s)?String(d):String(s[d].id);i.push({colIndex:v,rowIndex:d,id:B2(x,g),type:kr.DATA_CELL,rowId:x,colId:g,spreadsheet:r.spreadsheet})})}),i},r}return t.prototype.bindMouseDown=function(){var r=this;this.spreadsheet.on(Re.DATA_CELL_MOUSE_DOWN,function(n){r.spreadsheet.interaction.getBrushSelection().data&&(e.prototype.mouseDown.call(r,n),r.resetScrollDelta())})},t.prototype.bindMouseMove=function(){var r=this;this.spreadsheet.on(Re.GLOBAL_MOUSE_MOVE,function(n){if(r.brushSelectionStage!==Du.UN_DRAGGED){r.setBrushSelectionStage(Du.DRAGGED);var i=r.spreadsheet.container.getPointByEvent(n);r.autoBrushScroll(i)||r.renderPrepareSelected(i)}})},t.prototype.isInBrushRange=function(r){var n=this.getBrushRange(),i=n.start,a=n.end,o=r.rowIndex,s=r.colIndex;return o>=i.rowIndex&&o<=a.rowIndex&&s>=i.colIndex&&s<=a.colIndex},t.prototype.updateSelectedCells=function(){var r=this.getBrushRange(),n=this.getSelectedCellMetas(r);this.spreadsheet.interaction.changeState({cells:n,stateName:Dn.SELECTED,onUpdateCells:F8});var i=this.getScrollBrushRangeCells(n);this.emitBrushSelectionEvent(Re.DATA_CELL_BRUSH_SELECTION,i)},t.prototype.getScrollBrushRangeCells=function(r){var n=this;return r.map(function(i){var a=n.getVisibleBrushRangeCells(i.id);if(a)return a;var o=n.spreadsheet.facet.layoutResult.getCellMeta(i.rowIndex,i.colIndex),s=n.spreadsheet.isTableMode()?SL:L0;return new s(o,n.spreadsheet)})},t.prototype.bindMouseUp=function(){e.prototype.bindMouseUp.call(this,!0)},t.prototype.getPrepareSelectMaskPosition=function(r){var n=this.spreadsheet.facet.panelBBox,i=n.minX,a=n.minY,o=Math.max(r.start.x,i),s=Math.max(r.start.y,a);return{x:o,y:s}},t}(X8),ELe=function(e){nn(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.isInBrushRange=function(n){var i=r.getBrushRange(),a=i.start,o=i.end,s=r.spreadsheet.facet.getScrollOffset(),l=s.scrollY,u=s.rowHeaderScrollX,c=r.spreadsheet.facet.cornerBBox,f=n.x,d=f===void 0?0:f,v=n.y,g=v===void 0?0:v,x=n.width,w=x===void 0?0:x,S=n.height,M=S===void 0?0:S;return r.rectanglesIntersect({minX:a.x+u,minY:a.y-c.height+l,maxX:o.x+u,maxY:o.y-c.height+l},{minX:d,maxX:d+w,minY:g,maxY:g+M})},r.onUpdateCells=function(n){return n.updateCells(n.getAllRowHeaderCells())},r.getSelectedRowNodes=function(){return r.spreadsheet.getRowNodes().filter(r.isInBrushRange)},r.getVisibleRowLeafCellByScrollDirection=function(n){var i=r.spreadsheet.interaction.getAllRowHeaderCells();return n===zl.SCROLL_DOWN?no(i):i.find(function(a){var o=a.getMeta();return o.isLeaf})},r.getWillScrollToRowIndex=function(n){var i,a;if(!Sl(r.endBrushPoint.rowIndex))return r.getDefaultWillScrollToRowIndex(n);var o=r.getVisibleRowLeafCellByScrollDirection(n),s=(a=(i=o==null?void 0:o.getMeta())===null||i===void 0?void 0:i.rowIndex)!==null&&a!==void 0?a:0,l=s+r.getWillScrollRowIndexDiff(n);return r.validateYIndex(l)},r}return t.prototype.bindMouseDown=function(){var r=this;this.spreadsheet.on(Re.ROW_CELL_MOUSE_DOWN,function(n){r.spreadsheet.interaction.getBrushSelection().row&&e.prototype.mouseDown.call(r,n)})},t.prototype.isPointInCanvas=function(r){var n=this.spreadsheet.facet.getCanvasHW().height,i=this.spreadsheet.facet.cornerBBox,a=i.minX,o=i.height,s=i.maxX;return r.x>=a&&r.x<=s&&r.y>=o&&r.y<=n},t.prototype.bindMouseMove=function(){var r=this;this.spreadsheet.on(Re.GLOBAL_MOUSE_MOVE,function(n){if(r.brushSelectionStage!==Du.UN_DRAGGED){r.setBrushSelectionStage(Du.DRAGGED);var i=r.spreadsheet.container.getPointByEvent(n);r.autoBrushScroll(i,!0)||r.renderPrepareSelected(i)}})},t.prototype.setDisplayedCells=function(){this.displayedCells=this.spreadsheet.interaction.getAllRowHeaderCells()},t.prototype.updateSelectedCells=function(){var r=this.getSelectedRowNodes(),n=this.getScrollBrushRangeCells(r),i=oa(n,Jp);this.spreadsheet.interaction.changeState({cells:i,stateName:Dn.BRUSH_SELECTED,onUpdateCells:this.onUpdateCells}),this.emitBrushSelectionEvent(Re.ROW_CELL_BRUSH_SELECTION,n)},t.prototype.addBrushIntercepts=function(){this.spreadsheet.interaction.addIntercepts([Ai.ROW_BRUSH_SELECTION])},t.prototype.getScrollBrushRangeCells=function(r){var n=this;return r.map(function(i){var a=n.getVisibleBrushRangeCells(i.id);return a||n.spreadsheet.facet.rowHeader.createCellInstance(i)})},t.prototype.getPrepareSelectMaskPosition=function(r){var n=this.spreadsheet.facet.panelBBox.minY,i=r.start.x,a=Math.max(r.start.y,n);return{x:i,y:a}},t}(X8),wLe=function(e){nn(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.isMultiSelection=!1,r}return t.prototype.bindEvents=function(){this.bindKeyboardDown(),this.bindDataCellClick(),this.bindKeyboardUp(),this.bindMouseMove()},t.prototype.reset=function(){this.isMultiSelection=!1,this.spreadsheet.interaction.removeIntercepts([Ai.CLICK])},t.prototype.bindKeyboardDown=function(){var r=this;this.spreadsheet.on(Re.GLOBAL_KEYBOARD_DOWN,function(n){xI(n)&&(r.isMultiSelection=!0,r.spreadsheet.interaction.addIntercepts([Ai.CLICK]))})},t.prototype.bindKeyboardUp=function(){var r=this;this.spreadsheet.on(Re.GLOBAL_KEYBOARD_UP,function(n){xI(n)&&r.reset()})},t.prototype.bindMouseMove=function(){var r=this;this.spreadsheet.on(Re.GLOBAL_MOUSE_MOVE,function(n){r.isMultiSelection&&!tft(n)&&r.reset()})},t.prototype.getSelectedCells=function(r){var n=r.getMeta().id,i=this.spreadsheet.interaction,a=i.getCells([kr.DATA_CELL]),o=[];return i.getCurrentStateName()!==Dn.SELECTED&&(a=[]),a.find(function(s){return s.id===n})?o=a.filter(function(s){return s.id!==n}):o=Gr(Gr([],ur(a),!1),[Jp(r)],!1),o},t.prototype.bindDataCellClick=function(){var r=this;this.spreadsheet.on(Re.DATA_CELL_CLICK,function(n){n.stopPropagation();var i=r.spreadsheet.getCell(n.target),a=i.getMeta(),o=r.spreadsheet.interaction;if(r.isMultiSelection&&a){var s=r.getSelectedCells(i);if(Dr(s)){o.clearState(),r.spreadsheet.hideTooltip(),r.spreadsheet.emit(Re.GLOBAL_SELECTED,o.getActiveCells());return}o.addIntercepts([Ai.CLICK,Ai.HOVER]),r.spreadsheet.hideTooltip(),o.changeState({cells:s,stateName:Dn.SELECTED,onUpdateCells:F8}),r.spreadsheet.emit(Re.GLOBAL_SELECTED,o.getActiveCells()),r.spreadsheet.showTooltipWithInfo(n,z8(r.spreadsheet))}})},t}(op),CLe=function(){function e(t){var r=this;this.canvasEventHandlers=[],this.s2EventHandlers=[],this.domEventListeners=[],this.isCanvasEffect=!1,this.isGuiIconShape=function(n){return n instanceof d6&&n.attrs.type===_S.type},this.onCanvasMousedown=function(n){if(r.target=n.target,r.spreadsheet.interaction.clearHoverTimer(),r.isResizeArea(n)){r.spreadsheet.emit(Re.LAYOUT_RESIZE_MOUSE_DOWN,n);var i=function(o){if(!r.spreadsheet.getCanvasElement())return!1;r.spreadsheet.getCanvasElement()!==o.target&&(n.clientX=o.clientX,n.clientY=o.clientY,n.originalEvent=o,r.spreadsheet.emit(Re.LAYOUT_RESIZE_MOUSE_MOVE,n))};window.addEventListener("mousemove",i),window.addEventListener("mouseup",function(){window.removeEventListener("mousemove",i)},{once:!0});return}var a=r.spreadsheet.getCellType(n.target);switch(a){case kr.DATA_CELL:r.spreadsheet.emit(Re.DATA_CELL_MOUSE_DOWN,n);break;case kr.ROW_CELL:r.spreadsheet.emit(Re.ROW_CELL_MOUSE_DOWN,n);break;case kr.COL_CELL:r.spreadsheet.emit(Re.COL_CELL_MOUSE_DOWN,n);break;case kr.CORNER_CELL:r.spreadsheet.emit(Re.CORNER_CELL_MOUSE_DOWN,n);break;case kr.MERGED_CELL:r.spreadsheet.emit(Re.MERGED_CELLS_MOUSE_DOWN,n);break}},this.onCanvasMousemove=function(n){if(r.canvasMousemoveEvent=n,r.isResizeArea(n)){r.activeResizeArea(n),r.spreadsheet.emit(Re.LAYOUT_RESIZE_MOUSE_MOVE,n);return}r.resetResizeArea();var i=r.spreadsheet.getCell(n.target);if(i){var a=i.cellType;switch(a){case kr.DATA_CELL:r.spreadsheet.emit(Re.DATA_CELL_MOUSE_MOVE,n);break;case kr.ROW_CELL:r.spreadsheet.emit(Re.ROW_CELL_MOUSE_MOVE,n);break;case kr.COL_CELL:r.spreadsheet.emit(Re.COL_CELL_MOUSE_MOVE,n);break;case kr.CORNER_CELL:r.spreadsheet.emit(Re.CORNER_CELL_MOUSE_MOVE,n);break;case kr.MERGED_CELL:r.spreadsheet.emit(Re.MERGED_CELLS_MOUSE_MOVE,n);break}if(!r.hasBrushSelectionIntercepts())switch(r.spreadsheet.emit(Re.GLOBAL_HOVER,n),a){case kr.DATA_CELL:r.spreadsheet.emit(Re.DATA_CELL_HOVER,n);break;case kr.ROW_CELL:r.spreadsheet.emit(Re.ROW_CELL_HOVER,n);break;case kr.COL_CELL:r.spreadsheet.emit(Re.COL_CELL_HOVER,n);break;case kr.CORNER_CELL:r.spreadsheet.emit(Re.CORNER_CELL_HOVER,n);break;case kr.MERGED_CELL:r.spreadsheet.emit(Re.MERGED_CELLS_HOVER,n);break}}},this.onCanvasMouseup=function(n){if(r.isResizeArea(n)){r.spreadsheet.emit(Re.LAYOUT_RESIZE_MOUSE_UP,n);return}var i=r.spreadsheet.getCell(n.target);if(i){var a=i.cellType;if(r.target===n.target){var o=r.isGuiIconShape(n.target);switch(a){case kr.DATA_CELL:r.spreadsheet.emit(Re.DATA_CELL_CLICK,n);break;case kr.ROW_CELL:if(o)break;r.spreadsheet.emit(Re.ROW_CELL_CLICK,n);break;case kr.COL_CELL:if(o)break;r.spreadsheet.emit(Re.COL_CELL_CLICK,n);break;case kr.CORNER_CELL:if(o)break;r.spreadsheet.emit(Re.CORNER_CELL_CLICK,n);break;case kr.MERGED_CELL:r.spreadsheet.emit(Re.MERGED_CELLS_CLICK,n);break}}switch(a){case kr.DATA_CELL:r.spreadsheet.emit(Re.DATA_CELL_MOUSE_UP,n);break;case kr.ROW_CELL:r.spreadsheet.emit(Re.ROW_CELL_MOUSE_UP,n);break;case kr.COL_CELL:r.spreadsheet.emit(Re.COL_CELL_MOUSE_UP,n);break;case kr.CORNER_CELL:r.spreadsheet.emit(Re.CORNER_CELL_MOUSE_UP,n);break;case kr.MERGED_CELL:r.spreadsheet.emit(Re.MERGED_CELLS_MOUSE_UP,n);break}}},this.onCanvasClick=function(n){r.spreadsheet.emit(Re.GLOBAL_CLICK,n)},this.onCanvasDoubleClick=function(n){var i=r.spreadsheet;if(r.isResizeArea(n)){i.emit(Re.LAYOUT_RESIZE_MOUSE_UP,n);return}i.emit(Re.GLOBAL_DOUBLE_CLICK,n);var a=i.getCell(n.target);if(a){var o=a.cellType;if(r.target===n.target)switch(o){case kr.DATA_CELL:i.emit(Re.DATA_CELL_DOUBLE_CLICK,n);break;case kr.ROW_CELL:i.emit(Re.ROW_CELL_DOUBLE_CLICK,n);break;case kr.COL_CELL:i.emit(Re.COL_CELL_DOUBLE_CLICK,n);break;case kr.CORNER_CELL:i.emit(Re.CORNER_CELL_DOUBLE_CLICK,n);break;case kr.MERGED_CELL:i.emit(Re.MERGED_CELLS_DOUBLE_CLICK,n);break}}},this.onCanvasMouseout=function(n){if(!(!r.isAutoResetSheetStyle||n!=null&&n.shape)){var i=r.spreadsheet.interaction;!i.isSelectedState()&&!(i.intercepts.size>0)&&i.reset()}},this.onCanvasContextMenu=function(n){var i=r.spreadsheet;if(r.isResizeArea(n)){i.emit(Re.LAYOUT_RESIZE_MOUSE_UP,n);return}i.emit(Re.GLOBAL_CONTEXT_MENU,n);var a=r.spreadsheet.getCellType(n.target);switch(a){case kr.DATA_CELL:r.spreadsheet.emit(Re.DATA_CELL_CONTEXT_MENU,n);break;case kr.ROW_CELL:r.spreadsheet.emit(Re.ROW_CELL_CONTEXT_MENU,n);break;case kr.COL_CELL:r.spreadsheet.emit(Re.COL_CELL_CONTEXT_MENU,n);break;case kr.CORNER_CELL:r.spreadsheet.emit(Re.CORNER_CELL_CONTEXT_MENU,n);break;case kr.MERGED_CELL:r.spreadsheet.emit(Re.MERGED_CELLS_CONTEXT_MENU,n);break}},this.spreadsheet=t,this.bindEvents()}return Object.defineProperty(e.prototype,"canvasContainer",{get:function(){return this.spreadsheet.container},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isAutoResetSheetStyle",{get:function(){return this.spreadsheet.options.interaction.autoResetSheetStyle},enumerable:!1,configurable:!0}),e.prototype.bindEvents=function(){var t=this;this.clearAllEvents(),this.addCanvasEvent(nc.CLICK,this.onCanvasClick),this.addCanvasEvent(nc.MOUSE_DOWN,this.onCanvasMousedown),this.addCanvasEvent(nc.MOUSE_MOVE,this.onCanvasMousemove),this.addCanvasEvent(nc.MOUSE_OUT,this.onCanvasMouseout),this.addCanvasEvent(nc.MOUSE_UP,this.onCanvasMouseup),this.addCanvasEvent(nc.DOUBLE_CLICK,this.onCanvasDoubleClick),this.addCanvasEvent(nc.CONTEXT_MENU,this.onCanvasContextMenu),this.addS2Event(Re.GLOBAL_ACTION_ICON_CLICK,function(){t.spreadsheet.interaction.addIntercepts([Ai.HOVER]),t.spreadsheet.interaction.clearState()}),this.addDomEventListener(window,nc.CLICK,function(r){t.resetSheetStyle(r),t.isCanvasEffect=t.isMouseOnTheCanvasContainer(r)}),this.addDomEventListener(window,nc.KEY_DOWN,function(r){t.onKeyboardCopy(r),t.onKeyboardEsc(r),t.spreadsheet.emit(Re.GLOBAL_KEYBOARD_DOWN,r)}),this.addDomEventListener(window,nc.KEY_UP,function(r){t.spreadsheet.emit(Re.GLOBAL_KEYBOARD_UP,r)}),this.addDomEventListener(window,nc.MOUSE_UP,function(r){t.spreadsheet.emit(Re.GLOBAL_MOUSE_UP,r)}),this.addDomEventListener(window,nc.MOUSE_MOVE,function(r){t.spreadsheet.emit(Re.GLOBAL_MOUSE_MOVE,r)})},e.prototype.onKeyboardCopy=function(t){if(this.isCanvasEffect&&this.spreadsheet.options.interaction.enableCopy&&dZ(t.key,Nu.COPY)&&(t.metaKey||t.ctrlKey)){var r=uRe(this.spreadsheet);Sl(r)||this.spreadsheet.emit(Re.GLOBAL_COPIED,r)}},e.prototype.onKeyboardEsc=function(t){this.isCanvasEffect&&dZ(t.key,Nu.ESC)&&this.resetSheetStyle(t)},e.prototype.resetSheetStyle=function(t){if(!(!this.isAutoResetSheetStyle||!this.spreadsheet)){var r=this.spreadsheet.interaction;if(r.hasIntercepts([Ai.BRUSH_SELECTION,Ai.COL_BRUSH_SELECTION,Ai.ROW_BRUSH_SELECTION])){r.removeIntercepts([Ai.BRUSH_SELECTION,Ai.ROW_BRUSH_SELECTION,Ai.COL_BRUSH_SELECTION]);return}this.isMouseOnTheTooltip(t)||this.isMouseOnTheCanvasContainer(t)||(r.reset(),this.spreadsheet.emit(Re.GLOBAL_RESET,t),this.spreadsheet.emit(Re.GLOBAL_SELECTED,r.getActiveCells()))}},e.prototype.isMouseEvent=function(t){return E_(t,"clientX")&&E_(t,"clientY")},e.prototype.isMouseOnTheCanvasContainer=function(t){if(this.isMouseEvent(t)){var r=this.spreadsheet.getCanvasElement();if(!r)return!1;if(this.spreadsheet.options.supportCSSTransform)return r.contains(t.target);var n=r.getBoundingClientRect()||{},i=n.x,a=n.y,o=this.getContainerRect(),s=o.width,l=o.height;return r.contains(t.target)&&t.clientX<=i+s&&t.clientY<=a+l}return!1},e.prototype.getContainerRect=function(){var t,r=this.spreadsheet,n=r.facet,i=r.options,a=(n==null?void 0:n.hRowScrollBar)||(n==null?void 0:n.hScrollBar),o=(n==null?void 0:n.panelBBox)||{},s=o.maxX,l=o.maxY,u=i.width,c=i.height,f=((t=a==null?void 0:a.theme)===null||t===void 0?void 0:t.size)||0;return{width:Math.min(u,s),height:Math.min(c,l+f)}},e.prototype.isMouseOnTheTooltip=function(t){var r,n,i,a,o=this.spreadsheet.tooltip;if(!(o!=null&&o.visible))return!1;var s=((i=(n=(r=this.spreadsheet.tooltip)===null||r===void 0?void 0:r.container)===null||n===void 0?void 0:n.getBoundingClientRect)===null||i===void 0?void 0:i.call(n))||{},l=s.x,u=s.y,c=s.width,f=s.height;return t.target instanceof Node?S3e((a=this.spreadsheet.tooltip)===null||a===void 0?void 0:a.container,t.target):this.isMouseEvent(t)?t.clientX>=l&&t.clientX<=l+c&&t.clientY>=u&&t.clientY<=u+f:!1},e.prototype.isResizeArea=function(t){var r=ai(t.target,"attrs.appendInfo");return r==null?void 0:r.isResizeArea},e.prototype.activeResizeArea=function(t){this.resetResizeArea();var r=t.target;this.spreadsheet.store.set("activeResizeArea",r),r.attr(Fh.backgroundOpacity,this.spreadsheet.theme.resizeArea.interactionState.hover.backgroundOpacity)},e.prototype.resetResizeArea=function(){var t=this.spreadsheet.store.get("activeResizeArea");Dr(t)||t.attr(Fh.backgroundOpacity,this.spreadsheet.theme.resizeArea.backgroundOpacity),this.spreadsheet.store.set("activeResizeArea",t)},e.prototype.hasBrushSelectionIntercepts=function(){return this.spreadsheet.interaction.hasIntercepts([Ai.HOVER,Ai.BRUSH_SELECTION,Ai.ROW_BRUSH_SELECTION,Ai.COL_BRUSH_SELECTION])},e.prototype.clear=function(){this.unbindEvents()},e.prototype.unbindEvents=function(){this.clearAllEvents()},e.prototype.addCanvasEvent=function(t,r){var n;(n=this.canvasContainer)===null||n===void 0||n.on(t,r),this.canvasEventHandlers.push({type:t,handler:r})},e.prototype.addS2Event=function(t,r){this.spreadsheet.on(t,r),this.s2EventHandlers.push({type:t,handler:r})},e.prototype.addDomEventListener=function(t,r,n){if(t.addEventListener){var i=this.spreadsheet.options.interaction.eventListenerOptions;t.addEventListener(r,n,i),this.domEventListeners.push({target:t,type:r,handler:n,options:i})}else console.error("Please make sure ".concat(t," has addEventListener function"))},e.prototype.clearAllEvents=function(){var t=this;bi(this.canvasEventHandlers,function(r){var n,i=r.type,a=r.handler;(n=t.canvasContainer)===null||n===void 0||n.off(i,a)}),bi(this.s2EventHandlers,function(r){var n=r.type,i=r.handler;t.spreadsheet.off(n,i)}),bi(this.domEventListeners,function(r){r.target.removeEventListener(r.type,r.handler,r.options)}),this.canvasEventHandlers=[],this.s2EventHandlers=[],this.domEventListeners=[]},e}(),SLe=function(e){nn(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.isRangeSelection=!1,r.handleColClick=function(n){n.stopPropagation();var i=r.spreadsheet.interaction,a=r.spreadsheet.getCell(n.target),o=a==null?void 0:a.getMeta();if(!Sl(o==null?void 0:o.x)){i.addIntercepts([Ai.HOVER]);var s=[Jp(a)],l=r.spreadsheet.store.get("lastClickedCell");if(r.isRangeSelection&&l&&l.cellType===a.cellType&&l.getMeta().level===a.getMeta().level){var u=ur([r.spreadsheet.facet.layoutResult.rowsHierarchy.maxLevel,r.spreadsheet.facet.layoutResult.colsHierarchy.maxLevel],2),c=u[0],f=u[1],d=x5(l.getMeta(),a.getMeta()),v=d.start,g=d.end;a instanceof L0?s=r.handleSeriesNumberRowSelected(v.rowIndex,g.rowIndex,a):a.cellType===kr.ROW_CELL&&a.getMeta().level===c?s=r.handleRowSelected(v.rowIndex,g.rowIndex,a):a.cellType===kr.COL_CELL&&a.getMeta().level===f&&(s=r.handleColSelected(v.colIndex,g.colIndex,a)),i.changeState({cells:s,stateName:Dn.SELECTED})}else Dr(i.getCells())&&i.removeIntercepts([Ai.HOVER]),r.spreadsheet.store.set("lastClickedCell",a);var x=s.map(function(w){var S=w.id;return S});i.updateCells(i.getRowColActiveCells(x)),r.spreadsheet.emit(Re.GLOBAL_SELECTED,i.getActiveCells())}},r}return t.prototype.bindEvents=function(){this.bindKeyboardDown(),this.bindDataCellClick(),this.bindColCellClick(),this.bindKeyboardUp(),this.bindMouseMove()},t.prototype.reset=function(){this.isRangeSelection=!1,this.spreadsheet.interaction.removeIntercepts([Ai.CLICK])},t.prototype.bindKeyboardDown=function(){var r=this;this.spreadsheet.on(Re.GLOBAL_KEYBOARD_DOWN,function(n){n.key===Nu.SHIFT&&(r.isRangeSelection=!0,r.spreadsheet.interaction.addIntercepts([Ai.CLICK]))})},t.prototype.bindKeyboardUp=function(){var r=this;this.spreadsheet.on(Re.GLOBAL_KEYBOARD_UP,function(n){n.key===Nu.SHIFT&&r.reset()})},t.prototype.bindMouseMove=function(){var r=this;this.spreadsheet.on(Re.GLOBAL_MOUSE_MOVE,function(n){r.isRangeSelection&&!n.shiftKey&&r.reset()})},t.prototype.bindColCellClick=function(){var r=this;this.spreadsheet.isTableMode()&&this.spreadsheet.on(Re.ROW_CELL_CLICK,function(n){r.handleColClick(n)}),this.spreadsheet.on(Re.COL_CELL_CLICK,function(n){r.handleColClick(n)})},t.prototype.bindDataCellClick=function(){var r=this;this.spreadsheet.on(Re.DATA_CELL_CLICK,function(n){n.stopPropagation();var i=r.spreadsheet.getCell(n.target),a=i.getMeta(),o=r.spreadsheet.interaction;if(a){var s=r.spreadsheet.store.get("lastClickedCell"),l=r.isRangeSelection&&(s==null?void 0:s.cellType)===i.cellType;if(!l){r.spreadsheet.store.set("lastClickedCell",i);return}var u=x5(s.getMeta(),i.getMeta()),c=u.start,f=u.end,d=kx(c.colIndex,f.colIndex+1).flatMap(function(v){var g=r.spreadsheet.facet.layoutResult.colLeafNodes[v].id;return kx(c.rowIndex,f.rowIndex+1).map(function(x){var w=r.spreadsheet.facet.getSeriesNumberWidth()||r.spreadsheet.isTableMode()?String(x):r.spreadsheet.facet.layoutResult.rowLeafNodes[x].id;return{id:w+"-"+g,colIndex:v,rowIndex:x,type:i.cellType}})});o.addIntercepts([Ai.CLICK,Ai.HOVER]),o.changeState({cells:d,stateName:Dn.SELECTED}),r.spreadsheet.showTooltipWithInfo(n,z8(r.spreadsheet)),r.spreadsheet.emit(Re.GLOBAL_SELECTED,o.getActiveCells())}})},t.prototype.handleSeriesNumberRowSelected=function(r,n,i){var a=this.spreadsheet.facet.layoutResult.colLeafNodes[0].id;return kx(r,n+1).map(function(o){var s=String(o);return{id:s+"-"+a,colIndex:0,rowIndex:o,type:i.cellType}})},t.prototype.handleRowSelected=function(r,n,i){return this.spreadsheet.facet.layoutResult.rowNodes.filter(function(a){var o=a.rowIndex;return n5(o,r,n+1)}).map(function(a){return{id:a.id,colIndex:a.colIndex,rowIndex:a.rowIndex,type:i.cellType}})},t.prototype.handleColSelected=function(r,n,i){return this.spreadsheet.facet.layoutResult.colLeafNodes.filter(function(a){var o=a.colIndex;return n5(o,r,n+1)}).map(function(a){return{id:a.id,colIndex:a.colIndex,rowIndex:a.rowIndex,type:i.cellType}})},t}(op),TLe=function(e){nn(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.resizeStartPosition={},r.resizeMouseMove=function(n){var i,a;if(!((i=r.resizeReferenceGroup)===null||i===void 0)&&i.get("visible")){(a=n==null?void 0:n.preventDefault)===null||a===void 0||a.call(n);var o=n.originalEvent,s=r.getResizeInfo(),l=r.resizeReferenceGroup.getChildren()||[];if(!Dr(l)){var u=ur(l,2),c=u[1],f=ur(T2(c.attr("path")),2),d=f[0],v=f[1];s.type===jf.Horizontal?r.updateHorizontalResizingEndGuideLinePosition(o,s,d,v):r.updateVerticalResizingEndGuideLinePosition(o,s,d,v),r.updateResizeGuideLineTheme(c),c.attr("path",[d,v])}}},r}return t.prototype.bindEvents=function(){this.bindMouseDown(),this.bindMouseMove(),this.bindMouseUp()},t.prototype.initResizeGroup=function(){if(!this.resizeReferenceGroup){this.resizeReferenceGroup=this.spreadsheet.foregroundGroup.addGroup();var r=this.spreadsheet.options,n=r.width,i=r.height,a=this.getResizeAreaTheme(),o=a.guideLineColor,s=a.guideLineDash,l=a.size,u={path:"",lineDash:s,stroke:o,lineWidth:l};this.resizeReferenceGroup.addShape("path",{id:vde,attrs:u}),this.resizeReferenceGroup.addShape("path",{id:gde,attrs:u}),this.resizeReferenceGroup.addShape("rect",{id:mde,attrs:{appendInfo:{isResizeArea:!0},x:0,y:0,width:n,height:i,fill:"transparent"}})}},t.prototype.getResizeAreaTheme=function(){return this.spreadsheet.theme.resizeArea},t.prototype.setResizeTarget=function(r){this.resizeTarget=r},t.prototype.getGuideLineWidthAndHeight=function(){var r=this.spreadsheet.options,n=r.width,i=r.height,a=this.spreadsheet.facet.panelBBox,o=a.maxY,s=a.maxX,l=Math.min(s,n),u=Math.min(o,i);return{width:l,height:u}},t.prototype.getResizeShapes=function(){var r;return((r=this.resizeReferenceGroup)===null||r===void 0?void 0:r.get("children"))||[]},t.prototype.setResizeMaskCursor=function(r){var n=ur(this.getResizeShapes(),3),i=n[2];i==null||i.attr("cursor",r)},t.prototype.updateResizeGuideLinePosition=function(r,n){var i=this.getResizeShapes();if(!Dr(i)){var a=ur(i,2),o=a[0],s=a[1],l=n.type,u=n.offsetX,c=n.offsetY,f=n.width,d=n.height,v=this.getGuideLineWidthAndHeight(),g=v.width,x=v.height;if(this.setResizeMaskCursor("".concat(l,"-resize")),l===jf.Horizontal){o.attr("path",[["M",u,c],["L",u,x]]),s.attr("path",[["M",u+f,c],["L",u+f,x]]),this.resizeStartPosition.offsetX=r.offsetX,this.resizeStartPosition.clientX=r.clientX;return}o.attr("path",[["M",u,c],["L",g,c]]),s.attr("path",[["M",u,c+d],["L",g,c+d]]),this.resizeStartPosition.offsetY=r.offsetY,this.resizeStartPosition.clientY=r.clientY}},t.prototype.bindMouseDown=function(){var r=this;this.spreadsheet.on(Re.LAYOUT_RESIZE_MOUSE_DOWN,function(n){var i;(i=n==null?void 0:n.preventDefault)===null||i===void 0||i.call(n);var a=n.target,o=n.originalEvent,s=r.getCellAppendInfo(n.target);r.spreadsheet.store.set("resized",!1),s!=null&&s.isResizeArea&&(r.spreadsheet.interaction.reset(),r.spreadsheet.interaction.addIntercepts([Ai.RESIZE]),r.setResizeTarget(a),r.showResizeGroup(),r.updateResizeGuideLinePosition(o,s))})},t.prototype.bindMouseMove=function(){var r=this;this.spreadsheet.on(Re.LAYOUT_RESIZE_MOUSE_MOVE,function(n){v8(r.resizeMouseMove,33)(n)})},t.prototype.getResizeGuideLinePosition=function(){var r=ur(this.resizeReferenceGroup.getChildren()||[],2),n=r[0],i=r[1],a=(n==null?void 0:n.attr("path"))||[],o=(i==null?void 0:i.attr("path"))||[],s=ur(a[0]||[],3),l=s[1],u=l===void 0?0:l,c=s[2],f=c===void 0?0:c,d=ur(o[0]||[],3),v=d[1],g=v===void 0?0:v,x=d[2],w=x===void 0?0:x;return{start:{x:u,y:f},end:{x:g,y:w}}},t.prototype.getDisAllowResizeInfo=function(){var r,n=this.getResizeInfo(),i=this.spreadsheet.options.interaction.resize,a=n.width,o=n.height,s=n.resizedWidth,l=n.resizedHeight,u=(r=i==null?void 0:i.disable)===null||r===void 0?void 0:r.call(i,n),c=u?a:s,f=u?o:l;return{displayWidth:c,displayHeight:f,isDisabled:u}},t.prototype.getResizeWidthDetail=function(){var r,n,i=this.getResizeInfo(),a=this.getDisAllowResizeInfo().displayWidth;switch(i.effect){case ic.Field:return{eventType:Re.LAYOUT_RESIZE_ROW_WIDTH,style:{rowCfg:{widthByField:(r={},r[i.id]=a,r)}}};case ic.Tree:return{eventType:Re.LAYOUT_RESIZE_TREE_WIDTH,style:{treeRowsWidth:a,rowCfg:{treeRowsWidth:a}}};case ic.Cell:return{eventType:Re.LAYOUT_RESIZE_COL_WIDTH,style:{colCfg:{widthByFieldValue:(n={},n[i.id]=a,n)}}};case ic.Series:return{eventType:Re.LAYOUT_RESIZE_SERIES_WIDTH,seriesNumberWidth:a};default:return null}},t.prototype.getResizeHeightDetail=function(){var r,n,i=this.spreadsheet.options,a=i.interaction.resize,o=i.style.rowCfg.heightByField,s=this.spreadsheet.theme.rowCell.cell.padding,l=this.getResizeInfo(),u=this.getDisAllowResizeInfo().displayHeight,c=this.spreadsheet.isPivotMode()?u-s.top-s.bottom:u,f;switch(l.effect){case ic.Field:return{eventType:Re.LAYOUT_RESIZE_COL_HEIGHT,style:{colCfg:{heightByField:(r={},r[l.id]=u,r)}}};case ic.Cell:return o!=null&&o[String(l.id)]||(a==null?void 0:a.rowResizeType)===oI.CURRENT?f={rowCfg:{heightByField:(n={},n[l.id]=c,n)}}:f={cellCfg:{height:c}},{eventType:Re.LAYOUT_RESIZE_ROW_HEIGHT,style:f};default:return null}},t.prototype.getResizeDetail=function(){var r=this.getResizeInfo();return r.type===jf.Horizontal?this.getResizeWidthDetail():this.getResizeHeightDetail()},t.prototype.showResizeGroup=function(){this.initResizeGroup(),this.resizeReferenceGroup.set("visible",!0)},t.prototype.hideResizeGroup=function(){this.resizeReferenceGroup.set("visible",!1)},t.prototype.bindMouseUp=function(){var r=this;this.spreadsheet.on(Re.GLOBAL_MOUSE_UP,function(){var n;r.setResizeMaskCursor("default"),!(!r.resizeReferenceGroup||Dr((n=r.resizeReferenceGroup)===null||n===void 0?void 0:n.getChildren()))&&(r.hideResizeGroup(),r.renderResizedResult())})},t.prototype.updateResizeGuideLineTheme=function(r){var n=this.getResizeAreaTheme(),i=n.guideLineColor,a=n.guideLineDisableColor,o=this.getDisAllowResizeInfo().isDisabled;r.attr("stroke",o?a:i),this.setResizeMaskCursor(o?"no-drop":"default")},t.prototype.updateHorizontalResizingEndGuideLinePosition=function(r,n,i,a){var o=r.clientX-this.resizeStartPosition.clientX;n.width+o<Uj&&(o=-(n.width-Uj));var s=n.offsetX+n.width+o;i[1]=s,a[1]=s,this.resizeTarget.attr({x:s-n.size/2})},t.prototype.updateVerticalResizingEndGuideLinePosition=function(r,n,i,a){var o=r.clientY-this.resizeStartPosition.clientY;n.height+o<$j&&(o=-(n.height-$j));var s=n.offsetY+n.height+o;i[2]=s,a[2]=s,this.resizeTarget.attr({y:s-n.size/2})},t.prototype.renderResizedResult=function(){var r=this.getResizeInfo(),n=this.getResizeDetail()||{},i=n.style,a=n.seriesNumberWidth,o=n.eventType,s={info:r,style:i};this.spreadsheet.emit(Re.LAYOUT_RESIZE,s),this.spreadsheet.emit(o,s),i&&this.spreadsheet.setOptions({style:i}),a&&this.spreadsheet.setTheme({rowCell:{seriesNumberWidth:a}}),this.spreadsheet.store.set("resized",!0),this.render()},t.prototype.getResizeInfo=function(){var r=this.getCellAppendInfo(this.resizeTarget),n=this.getResizeGuideLinePosition(),i=n.start,a=n.end,o=Math.floor(a.x-i.x),s=Math.floor(a.y-i.y);return qt(qt({},r),{resizedWidth:o,resizedHeight:s})},t.prototype.render=function(){this.resizeStartPosition={},this.resizeTarget=null,this.resizeReferenceGroup=null,this.spreadsheet.render(!1)},t}(op),ALe=[Nu.ARROW_LEFT,Nu.ARROW_RIGHT,Nu.ARROW_UP,Nu.ARROW_DOWN],MLe=function(e){nn(t,e);function t(r){return e.call(this,r)||this}return t.prototype.isCanvasEffect=function(){return this.spreadsheet.interaction.eventController.isCanvasEffect},t.prototype.bindEvents=function(){var r=this;this.spreadsheet.on(Re.GLOBAL_KEYBOARD_DOWN,function(n){if(r.isCanvasEffect()){var i=n.shiftKey,a=n.metaKey,o=ALe.includes(n.key),s=!1,l=!1,u=!1;o&&(a&&i?(s=!1,l=!0,u=!1):a?(s=!0,l=!0,u=!0):i?(s=!1,l=!1,u=!1):(s=!0,l=!1,u=!0),r.handleMove({event:n,changeStartCell:s,isJumpMode:l,isSingleSelection:u}))}}),this.spreadsheet.on(Re.DATA_CELL_CLICK,function(n){var i=r.spreadsheet.getCell(n.target).getMeta();i&&(r.startCell=r.getCellMetaFromViewMeta(i),r.endCell=r.startCell)})},t.prototype.getCellMetaFromViewMeta=function(r){return{rowIndex:r.rowIndex,colIndex:r.colIndex,id:r.id,type:kr.DATA_CELL}},t.prototype.handleMove=function(r){var n=r.event,i=r.changeStartCell,a=r.isJumpMode,o=r.isSingleSelection,s=this,l=s.spreadsheet,u=s.startCell,c=s.endCell,f=i?u:c,d=this.getMoveInfo(n.key,f,a);if(d){var v=ur([d.row,d.col],2),g=v[0],x=v[1];this.scrollToActiveCell(l,g,x);var w=this.generateCellMeta(l,g,x),S=o?[w]:this.getRangeCells(l,u,w);hIe(l,S),i&&(this.startCell=w),this.endCell=w,this.spreadsheet.emit(Re.DATA_CELL_SELECT_MOVE,S)}},t.prototype.generateCellMeta=function(r,n,i){var a=r.isTableMode,o=r.facet.layoutResult,s=o.colLeafNodes,l=o.rowLeafNodes,u=a()?String(n):l[n].id,c=s[i].id;return{rowIndex:n,colIndex:i,id:B2(u,c),type:kr.DATA_CELL}},t.prototype.getRangeCells=function(r,n,i){for(var a=x5(n,i),o=a.start,s=o.rowIndex,l=o.colIndex,u=a.end,c=u.rowIndex,f=u.colIndex,d=[],v=s;v<=c;v++)for(var g=l;g<=f;g++)d.push(this.generateCellMeta(r,v,g));return d},t.prototype.getMoveInfo=function(r,n,i){var a=this.spreadsheet,o=a.options,s=o.frozenColCount,l=s===void 0?0:s,u=o.frozenRowCount,c=u===void 0?0:u,f=o.frozenTrailingColCount,d=f===void 0?0:f,v=o.frozenTrailingRowCount,g=v===void 0?0:v,x=a.facet.layoutResult,w=x.rowLeafNodes,S=x.colLeafNodes,M=ur([0+l,S.length-d-1],2),R=M[0],I=M[1],P=ur([0+c,(a.isTableMode()?a.dataSet.getDisplayDataSet().length:w.length)-g-1],2),k=P[0],z=P[1];if(n)switch(r){case Nu.ARROW_RIGHT:return n.colIndex+1>I?void 0:{row:n.rowIndex,col:i?I:n.colIndex+1};case Nu.ARROW_LEFT:return n.colIndex-1<R?void 0:{row:n.rowIndex,col:i?R:n.colIndex-1};case Nu.ARROW_UP:return n.rowIndex-1<k?void 0:{row:i?k:n.rowIndex-1,col:n.colIndex};case Nu.ARROW_DOWN:return n.rowIndex+1>z?void 0:{row:i?z:n.rowIndex+1,col:n.colIndex}}},t.prototype.calculateOffset=function(r,n,i){var a=r.options,o=a.frozenRowCount,s=o===void 0?0:o,l=a.frozenTrailingRowCount,u=l===void 0?0:l,c=r.facet,f=r.frozenColGroup,d=r.frozenTrailingColGroup,v=r.frozenRowGroup,g=r.frozenTrailingRowGroup,x=c.layoutResult.colLeafNodes,w=c.getScrollOffset(),S=w.scrollX,M=w.scrollY,R=c.panelBBox,I=R.viewportHeight,P=R.viewportWidth,k=ai(r,"theme.splitLine"),z=f?Math.floor(f.getBBox().width-k.verticalBorderWidth/2):0,G=d?Math.floor(d.getBBox().width):0,J=v?Math.floor(v.getBBox().height-k.horizontalBorderWidth/2):0,Z=g?Math.floor(g.getBBox().height):0,X=C8(S,M,c.viewCellWidths,c.viewCellHeights,{width:P-z-G,height:I-J-Z,x:z,y:J},c.getRealScrollX(c.cornerBBox.width)),et=-1,at=-1,wt=x.find(function(vt){return vt.colIndex===i});if(i<=X[0]?et=wt.x-z:i>=X[1]&&i<x.length-u&&(et=wt.x+wt.width-P+G),n<=X[2])at=c.viewCellHeights.getCellOffsetY(n-s);else if(n>=X[3]){var Tt=c.viewCellHeights.getCellOffsetY(n+1);at=Tt+Z-I}return{offsetX:et,offsetY:at}},t.prototype.scrollToActiveCell=function(r,n,i){var a=this.calculateOffset(r,n,i),o=a.offsetX,s=a.offsetY,l=r.facet,u=r.facet.getScrollOffset(),c=u.scrollX,f=u.scrollY;l.scrollWithAnimation({offsetX:{value:o>-1?o:c},offsetY:{value:s>-1?s:f}})},t}(op),RLe=function(){function e(t){var r=this;this.interactions=new Map,this.intercepts=new Set,this.hoverTimer=null,this.defaultState={cells:[],force:!1},this.onTriggerInteractionsResetEffect=function(){r.interactions.forEach(function(n){n.reset()})},this.selectAll=function(){r.changeState({stateName:Dn.ALL_SELECTED})},this.getCellChildrenNodes=function(n){var i,a=(i=n==null?void 0:n.getMeta)===null||i===void 0?void 0:i.call(n),o=(n==null?void 0:n.cellType)===kr.ROW_CELL,s=r.spreadsheet.isHierarchyTreeType();return s&&o?cu.getAllLeaveNodes(a).filter(function(l){return l.rowIndex===a.rowIndex}):cu.getAllChildrenNodes(a)},this.selectHeaderCell=function(n){var i;n===void 0&&(n={});var a=n.cell;if(!Dr(a)){var o=(i=a==null?void 0:a.getMeta)===null||i===void 0?void 0:i.call(a);if(!(!o||Sl(o==null?void 0:o.x))){r.addIntercepts([Ai.HOVER]);var s=r.spreadsheet.isHierarchyTreeType(),l=(a==null?void 0:a.cellType)===kr.COL_CELL,u=r.getState(),c=r.isSelectedCell(a),f=(n==null?void 0:n.isMultiSelection)&&r.isSelectedState(),d=c?[]:r.getCellChildrenNodes(a),v=c?[]:[Jp(a)];if(f&&(v=dx(u==null?void 0:u.cells,v),d=dx(u==null?void 0:u.nodes,d),c&&(v=v.filter(function(x){var w=x.id;return w!==o.id}),d=d.filter(function(x){return!(x!=null&&x.id.includes(o.id))}))),Dr(v)){r.reset(),r.spreadsheet.emit(Re.GLOBAL_SELECTED,r.getActiveCells());return}r.changeState({cells:v,nodes:d,stateName:Dn.SELECTED});var g=v.map(function(x){var w=x.id;return w});return r.updateCells(r.getRowColActiveCells(g)),(!s||l)&&r.highlightNodes(d),r.spreadsheet.emit(Re.GLOBAL_SELECTED,r.getActiveCells()),!0}}},this.highlightNodes=function(n){n===void 0&&(n=[]),n.forEach(function(i){var a;(a=i==null?void 0:i.belongsCell)===null||a===void 0||a.updateByState(Dn.SELECTED,i.belongsCell)})},this.mergeCells=function(n,i){ARe(r.spreadsheet,n,i)},this.unmergeCell=function(n){RRe(r.spreadsheet,n)},this.spreadsheet=t,this.registerEventController(),this.registerInteractions(),window.addEventListener("visibilitychange",this.onTriggerInteractionsResetEffect)}return e.prototype.destroy=function(){this.interactions.clear(),this.intercepts.clear(),this.eventController.clear(),this.clearHoverTimer(),this.resetState(),window.removeEventListener("visibilitychange",this.onTriggerInteractionsResetEffect)},e.prototype.reset=function(){this.clearState(),this.clearHoverTimer(),this.intercepts.clear(),this.spreadsheet.hideTooltip()},e.prototype.setState=function(t){dIe(this.spreadsheet,t)},e.prototype.getState=function(){return this.spreadsheet.store.get(XB)||this.defaultState},e.prototype.setInteractedCells=function(t){var r=this.getInteractedCells().concat([t]),n=this.getState();n.interactedCells=r,this.setState(n)},e.prototype.getInteractedCells=function(){var t=this.getState();return(t==null?void 0:t.interactedCells)||[]},e.prototype.resetState=function(){this.spreadsheet.store.set(XB,this.defaultState)},e.prototype.getCurrentStateName=function(){return this.getState().stateName},e.prototype.isEqualStateName=function(t){return this.getCurrentStateName()===t},e.prototype.isStateOf=function(t){var r=this.getState();return(r==null?void 0:r.stateName)===t},e.prototype.isSelectedState=function(){return this.isStateOf(Dn.SELECTED)||this.isStateOf(Dn.BRUSH_SELECTED)},e.prototype.isAllSelectedState=function(){return this.isStateOf(Dn.ALL_SELECTED)},e.prototype.isHoverFocusState=function(){return this.isStateOf(Dn.HOVER_FOCUS)},e.prototype.isHoverState=function(){return this.isStateOf(Dn.HOVER)},e.prototype.isActiveCell=function(t){return!!this.getCells().find(function(r){return t.getMeta().id===r.id})},e.prototype.isSelectedCell=function(t){return this.isSelectedState()&&this.isActiveCell(t)},e.prototype.getCells=function(t){var r=this.getState(),n=(r==null?void 0:r.cells)||[];return Sl(t)?n:n.filter(function(i){return t.includes(i.type)})},e.prototype.getActiveCells=function(){var t=this.getCells().map(function(n){return n.id}),r=this.getAllCells();return oa(t,function(n){return Hu(r,function(i){var a;return((a=i==null?void 0:i.getMeta())===null||a===void 0?void 0:a.id)===n})}).filter(function(n){return n})},e.prototype.clearStyleIndependent=function(){!this.isSelectedState()&&!this.isHoverState()&&!this.isAllSelectedState()||this.getPanelGroupAllDataCells().forEach(function(t){t.hideInteractionShape()})},e.prototype.getPanelGroupAllUnSelectedDataCells=function(){var t=this;return this.getPanelGroupAllDataCells().filter(function(r){return!t.isActiveCell(r)})},e.prototype.getPanelGroupAllDataCells=function(){var t;return mC((t=this.spreadsheet.panelGroup)===null||t===void 0?void 0:t.getChildren(),L0)},e.prototype.getAllRowHeaderCells=function(){var t,r,n=((t=this.spreadsheet.foregroundGroup)===null||t===void 0?void 0:t.getChildren())||[],i=n.find(function(o){return o instanceof W8&&!(o instanceof Rft)}),a=((r=i==null?void 0:i.cfg)===null||r===void 0?void 0:r.children)||[];return mC(a,k2).filter(function(o){return o.cellType===kr.ROW_CELL})},e.prototype.getAllColHeaderCells=function(){var t,r,n=((t=this.spreadsheet.foregroundGroup)===null||t===void 0?void 0:t.getChildren())||[],i=n.find(function(o){return o instanceof G8}),a=((r=i==null?void 0:i.cfg)===null||r===void 0?void 0:r.children)||[];return mC(a,CL).filter(function(o){return o.cellType===kr.COL_CELL})},e.prototype.getRowColActiveCells=function(t){return dx(this.getAllRowHeaderCells(),this.getAllColHeaderCells()).filter(function(r){return t.includes(r.getMeta().id)})},e.prototype.getAllCells=function(){return dx(this.getPanelGroupAllDataCells(),this.getAllRowHeaderCells(),this.getAllColHeaderCells())},e.prototype.hideColumns=function(t,r){t===void 0&&(t=[]),r===void 0&&(r=!0),I8(this.spreadsheet,t,r)},e.prototype.getBrushSelectionInfo=function(t){var r,n,i;return Gp(t)?{dataBrushSelection:t,rowBrushSelection:t,colBrushSelection:t}:{dataBrushSelection:(r=t==null?void 0:t.data)!==null&&r!==void 0?r:!1,rowBrushSelection:(n=t==null?void 0:t.row)!==null&&n!==void 0?n:!1,colBrushSelection:(i=t==null?void 0:t.col)!==null&&i!==void 0?i:!1}},e.prototype.getDefaultInteractions=function(){var t=this.spreadsheet.options.interaction,r=t.resize,n=t.brushSelection,i=t.multiSelection,a=t.rangeSelection,o=t.selectedCellMove,s=this.getBrushSelectionInfo(n),l=s.dataBrushSelection,u=s.rowBrushSelection,c=s.colBrushSelection;return[{key:rc.CORNER_CELL_CLICK,interaction:yLe},{key:rc.DATA_CELL_CLICK,interaction:pLe},{key:rc.ROW_COLUMN_CLICK,interaction:gLe},{key:rc.ROW_TEXT_CLICK,interaction:mLe},{key:rc.MERGED_CELLS_CLICK,interaction:vLe},{key:rc.HOVER,interaction:_Le,enable:!Ul()},{key:rc.BRUSH_SELECTION,interaction:bLe,enable:!Ul()&&l},{key:rc.ROW_BRUSH_SELECTION,interaction:ELe,enable:!Ul()&&u},{key:rc.COL_BRUSH_SELECTION,interaction:xLe,enable:!Ul()&&c},{key:rc.COL_ROW_RESIZE,interaction:TLe,enable:!Ul()&&r},{key:rc.DATA_CELL_MULTI_SELECTION,interaction:wLe,enable:!Ul()&&i},{key:rc.RANGE_SELECTION,interaction:SLe,enable:!Ul()&&a},{key:rc.SELECTED_CELL_MOVE,interaction:MLe,enable:!Ul()&&o}]},e.prototype.registerInteractions=function(){var t=this,r=this.spreadsheet.options.interaction.customInteractions;this.interactions.clear();var n=this.getDefaultInteractions();n.forEach(function(i){var a=i.key,o=i.interaction,s=i.enable;s!==!1&&t.interactions.set(a,new o(t.spreadsheet))}),Dr(r)||bi(r,function(i){var a=i.interaction;t.interactions.set(i.key,new a(t.spreadsheet))})},e.prototype.registerEventController=function(){this.eventController=new CLe(this.spreadsheet)},e.prototype.draw=function(){this.spreadsheet.container.draw()},e.prototype.clearState=function(){eft(this.spreadsheet)&&this.draw()},e.prototype.changeState=function(t){var r=this,n=this.spreadsheet.interaction,i=t.cells,a=i===void 0?[]:i,o=t.force,s=t.stateName,l=t.onUpdateCells;if(Dr(a)&&s===Dn.SELECTED){o&&n.changeState({cells:[],stateName:Dn.UNSELECTED});return}this.getCurrentStateName()===Dn.ALL_SELECTED&&this.clearStyleIndependent(),this.clearState(),this.setState(t);var u=function(){r.updatePanelGroupAllDataCells()};l?l(this,u):u(),this.draw()},e.prototype.updatePanelGroupAllDataCells=function(){this.updateCells(this.getPanelGroupAllDataCells())},e.prototype.updateCells=function(t){t===void 0&&(t=[]),t.forEach(function(r){r.update()})},e.prototype.addIntercepts=function(t){var r=this;t===void 0&&(t=[]),t.forEach(function(n){r.intercepts.add(n)})},e.prototype.hasIntercepts=function(t){var r=this;return t===void 0&&(t=[]),t.some(function(n){return r.intercepts.has(n)})},e.prototype.removeIntercepts=function(t){var r=this;t===void 0&&(t=[]),t.forEach(function(n){r.intercepts.delete(n)})},e.prototype.clearHoverTimer=function(){clearTimeout(this.hoverTimer)},e.prototype.setHoverTimer=function(t){this.hoverTimer=t},e.prototype.getHoverTimer=function(){return this.hoverTimer},e.prototype.getSelectedCellHighlight=function(){var t=this.spreadsheet.options.interaction.selectedCellHighlight;if(Gp(t))return{rowHeader:t,colHeader:t,currentRow:!1,currentCol:!1};var r=t??{},n=r.rowHeader,i=n===void 0?!1:n,a=r.colHeader,o=a===void 0?!1:a,s=r.currentRow,l=s===void 0?!1:s,u=r.currentCol,c=u===void 0?!1:u;return{rowHeader:i,colHeader:o,currentRow:l,currentCol:c}},e.prototype.getHoverAfterScroll=function(){return this.spreadsheet.options.interaction.hoverAfterScroll},e.prototype.getHoverHighlight=function(){var t=this.spreadsheet.options.interaction.hoverHighlight;if(Gp(t))return{rowHeader:t,colHeader:t,currentRow:t,currentCol:t};var r=t??{},n=r.rowHeader,i=n===void 0?!1:n,a=r.colHeader,o=a===void 0?!1:a,s=r.currentRow,l=s===void 0?!1:s,u=r.currentCol,c=u===void 0?!1:u;return{rowHeader:i,colHeader:o,currentRow:l,currentCol:c}},e.prototype.getBrushSelection=function(){var t=this.spreadsheet.options.interaction.brushSelection;if(Gp(t))return{data:t,row:t,col:t};var r=t??{},n=r.data,i=n===void 0?!1:n,a=r.row,o=a===void 0?!1:a,s=r.col,l=s===void 0?!1:s;return{data:i,row:o,col:l}},e}(),ILe=function(){function e(t){var r=this;this.viewport=window,this.isDevicePixelRatioChange=!1,this.init=function(){r.initDevicePixelRatioListener(),r.initDeviceZoomListener()},this.destroy=function(){r.removeDevicePixelRatioListener(),r.removeDeviceZoomListener()},this.removeDevicePixelRatioListener=function(){var n;!((n=r.devicePixelRatioMedia)===null||n===void 0)&&n.removeEventListener?r.devicePixelRatioMedia.removeEventListener("change",r.renderByDevicePixelRatioChanged):r.devicePixelRatioMedia.removeListener(r.renderByDevicePixelRatioChanged)},this.initDeviceZoomListener=function(){var n,i;Ul()||(i=(n=r.viewport)===null||n===void 0?void 0:n.visualViewport)===null||i===void 0||i.addEventListener("resize",r.renderByZoomScaleWithoutResizeEffect)},this.removeDeviceZoomListener=function(){var n,i;Ul()||(i=(n=r.viewport)===null||n===void 0?void 0:n.visualViewport)===null||i===void 0||i.removeEventListener("resize",r.renderByZoomScaleWithoutResizeEffect)},this.renderByZoomScaleWithoutResizeEffect=function(n){r.isDevicePixelRatioChange=!1,r.renderByZoomScale(n)},this.renderByDevicePixelRatioChanged=function(){r.isDevicePixelRatioChange=!0,r.renderByDevicePixelRatio()},this.renderByDevicePixelRatio=function(n){n===void 0&&(n=window.devicePixelRatio);var i=r.spreadsheet,a=i.container,o=i.options,s=o.width,l=o.height,u=o.devicePixelRatio,c=r.spreadsheet.getCanvasElement(),f=a.get("pixelRatio");if(!(f===n||!c)){var d=Math.max(n,u,Plt);a.set("pixelRatio",d),a.changeSize(s,l),r.spreadsheet.render(!1)}},this.renderByZoomScale=gS(function(n){var i=Math.ceil(n.target.scale);i>=1&&!r.isDevicePixelRatioChange&&r.renderByDevicePixelRatio(i)},350),this.spreadsheet=t}return e.prototype.initDevicePixelRatioListener=function(){var t;this.devicePixelRatioMedia=window.matchMedia("(resolution: ".concat(window.devicePixelRatio,"dppx)")),!((t=this.devicePixelRatioMedia)===null||t===void 0)&&t.addEventListener?this.devicePixelRatioMedia.addEventListener("change",this.renderByDevicePixelRatioChanged):this.devicePixelRatioMedia.addListener(this.renderByDevicePixelRatioChanged)},e}(),$Z=function(){function e(t){this.visible=!1,this.position={x:0,y:0},this.spreadsheet=t}return e.prototype.show=function(t){var r,n,i,a=t.position,o=t.options,s=t.content,l=t.event,u=d3e(o).enterable,c=this.spreadsheet.options.tooltip||{},f=c.autoAdjustBoundary,d=c.adjustPosition;this.visible=!0,this.options=t;var v=this.getContainer();this.renderContent(s);var g=f3e({spreadsheet:this.spreadsheet,position:a,tooltipContainer:v,autoAdjustBoundary:f}),x=g.x,w=g.y;this.position=(r=d==null?void 0:d({position:{x,y:w},event:l}))!==null&&r!==void 0?r:{x,y:w},ZA(v,{style:{left:"".concat((n=this.position)===null||n===void 0?void 0:n.x,"px"),top:"".concat((i=this.position)===null||i===void 0?void 0:i.y,"px"),pointerEvents:u?"all":"none"},visible:!0})},e.prototype.hide=function(){this.visible=!1,this.container&&(ZA(this.container,{style:{pointerEvents:"none"},visible:!1}),this.resetPosition())},e.prototype.destroy=function(){var t,r;this.visible=!1,this.container&&(this.resetPosition(),(r=(t=this.container).remove)===null||r===void 0||r.call(t),this.container=null)},e.prototype.renderContent=function(t){if(this.container){this.clearContent();var r=(this.spreadsheet.options.tooltip||{}).content,n=t??r;if(!Sl(n)){if(typeof n=="string"){this.container.innerHTML=n;return}n instanceof Element&&this.container.appendChild(n)}}},e.prototype.clearContent=function(){this.container&&(this.container.innerHTML="")},e.prototype.disablePointerEvent=function(){this.container&&this.container.style.pointerEvents!=="none"&&ZA(this.container,{style:{pointerEvents:"none"}})},e.prototype.resetPosition=function(){this.position={x:0,y:0}},e.prototype.getContainer=function(){var t;if(!this.container){var r=this.spreadsheet.options.tooltip,n=((t=r.getContainer)===null||t===void 0?void 0:t.call(r))||document.body,i=document.createElement("div");return ZA(i,{style:r.style,className:[b8].concat(r.className)}),n.appendChild(i),this.container=i,this.container}return this.container},e}(),Bft=function(e){nn(t,e);function t(r,n,i){var a=e.call(this)||this;return a.store=new $Ae,a.untypedOn=a.on,a.untypedEmit=a.emit,a.on=function(o,s){return a.untypedOn(o,s)},a.emit=function(o){for(var s=[],l=1;l<arguments.length;l++)s[l-1]=arguments[l];return a.untypedEmit.apply(a,Gr([o],ur(s),!1))},a.initHiddenColumnsDetail=function(){var o=a.options.interaction.hiddenColumnFields,s=a.store.get("hiddenColumnsDetail");Dr(o)&&Dr(s)||I8(a,o,!0)},a.measureText=G_(function(o,s){var l;if(o===void 0&&(o=""),!s)return null;var u=(l=a.getCanvasElement())===null||l===void 0?void 0:l.getContext("2d"),c=s,f=c.fontSize,d=c.fontFamily,v=c.fontWeight,g=c.fontStyle,x=c.fontVariant;return u.font=[g,x,v,"".concat(f,"px"),d].join(" ").trim(),u.measureText(String(o))},function(o,s){return Gr([o],ur(Bg(s)),!1).join("")}),a.measureTextWidth=function(o,s){o===void 0&&(o="");var l=a.measureText(o,s);return(l==null?void 0:l.width)||0},a.measureTextHeight=function(o,s){o===void 0&&(o="");var l=a.measureText(o,s);return l?l.actualBoundingBoxAscent+l.actualBoundingBoxDescent:0},a.measureTextWidthRoughly=function(o,s){var l,u;s===void 0&&(s={});var c=a.measureTextWidth("a",s),f=a.measureTextWidth("蚂",s),d=0;if(!o)return d;try{for(var v=Kf(o),g=v.next();!g.done;g=v.next()){var x=g.value,w=x.charCodeAt(0);d+=w>=0&&w<=255?c:f}}catch(S){l={error:S}}finally{try{g&&!g.done&&(u=v.return)&&u.call(v)}finally{if(l)throw l.error}}return d},a.dataCfg=nD(n),a.options=vZ(i),a.dataSet=a.getDataSet(a.options),a.setDebug(),a.initTooltip(),a.initGroups(r),a.bindEvents(),a.initInteraction(),a.initTheme(),a.initHdAdapter(),a.registerIcons(),a.setOverscrollBehavior(),a.mountSheetInstance(),a}return t.prototype.setOverscrollBehavior=function(){var r=this.options.interaction.overscrollBehavior,n=window.getComputedStyle(document.body).getPropertyValue("overscroll-behavior"),i=n&&n!=="auto";i?this.store.set("initOverscrollBehavior",n):r&&(document.body.style.overscrollBehavior=r)},t.prototype.restoreOverscrollBehavior=function(){document.body.style.overscrollBehavior=this.store.get("initOverscrollBehavior")||""},t.prototype.setDebug=function(){Wp.getInstance().setDebug(this.options.debug)},t.prototype.initTheme=function(){this.setThemeCfg({name:"default"})},t.prototype.getMountContainer=function(r){var n=iE(r)?document.querySelector(r):r;if(!n)throw new Error("Target mount container is not a DOM element");return n},t.prototype.initHdAdapter=function(){this.options.hdAdapter&&(this.hdAdapter=new ILe(this),this.hdAdapter.init())},t.prototype.initInteraction=function(){var r,n;(n=(r=this.interaction)===null||r===void 0?void 0:r.destroy)===null||n===void 0||n.call(r),this.interaction=new RLe(this)},t.prototype.initTooltip=function(){var r,n,i,a;(n=(r=this.tooltip)===null||r===void 0?void 0:r.destroy)===null||n===void 0||n.call(r),this.tooltip=this.renderTooltip(),this.tooltip instanceof $Z||console.warn("[Custom Tooltip]: ".concat((a=(i=this.tooltip)===null||i===void 0?void 0:i.constructor)===null||a===void 0?void 0:a.toString()," should be extends from BaseTooltip"))},t.prototype.renderTooltip=function(){var r,n;return((n=(r=this.options.tooltip)===null||r===void 0?void 0:r.renderTooltip)===null||n===void 0?void 0:n.call(r,this))||new $Z(this)},t.prototype.showTooltip=function(r){var n,i,a=r.content,o=r.event,s=this.getCell(o==null?void 0:o.target),l=mu(a)?a(s,r):a;(i=(n=this.tooltip).show)===null||i===void 0||i.call(n,qt(qt({},r),{content:l}))},t.prototype.showTooltipWithInfo=function(r,n,i){var a,o=U8(this,r),s=o.showTooltip,l=o.content;if(s){var u=this.getCell(r==null?void 0:r.target),c=(a=i==null?void 0:i.data)!==null&&a!==void 0?a:E3e({spreadsheet:this,cellInfos:n,targetCell:u,options:qt({enableFormat:!0},i)});this.showTooltip({data:c,position:{x:r.clientX,y:r.clientY},options:qt({enterable:!0},i),event:r,content:l})}},t.prototype.hideTooltip=function(){var r,n;(n=(r=this.tooltip).hide)===null||n===void 0||n.call(r)},t.prototype.destroyTooltip=function(){var r,n;(n=(r=this.tooltip).destroy)===null||n===void 0||n.call(r)},t.prototype.registerIcons=function(){var r=this.options.customSVGIcons;Dr(r)||bi(r,function(n){yht(n.name,n.svg)})},t.prototype.setDataCfg=function(r,n){this.store.set("originalDataCfg",r),n?this.dataCfg=nD(r):this.dataCfg=nD(this.dataCfg,r),T3e(this)},t.prototype.setOptions=function(r,n){var i;this.hideTooltip(),n?this.options=vZ(r):this.options=Np(this.options,r),(n||!((i=r.tooltip)===null||i===void 0)&&i.renderTooltip)&&this.initTooltip(),this.resetHiddenColumnsDetailInfoIfNeeded(),this.registerIcons()},t.prototype.resetHiddenColumnsDetailInfoIfNeeded=function(){var r;Dr((r=this.options.interaction)===null||r===void 0?void 0:r.hiddenColumnFields)||this.store.set("hiddenColumnsDetail",[])},t.prototype.render=function(r,n){if(r===void 0&&(r=!0),n===void 0&&(n={}),!!this.getCanvasElement()){var i=n.reBuildDataSet,a=i===void 0?!1:i,o=n.reBuildHiddenColumnsDetail,s=o===void 0?!0:o;this.emit(Re.LAYOUT_BEFORE_RENDER),a&&(this.dataSet=this.getDataSet(this.options)),r&&(this.clearDrillDownData("",!0),this.dataSet.setDataCfg(this.dataCfg)),this.buildFacet(),s&&this.initHiddenColumnsDetail(),this.emit(Re.LAYOUT_AFTER_RENDER)}},t.prototype.mountSheetInstance=function(){var r=this.getCanvasElement();r&&(r.__s2_instance__=this)},t.prototype.unmountSheetInstance=function(){var r=this.getCanvasElement();r&&delete r.__s2_instance__},t.prototype.destroy=function(){var r,n,i,a,o;this.restoreOverscrollBehavior(),this.emit(Re.LAYOUT_DESTROY),(r=this.facet)===null||r===void 0||r.destroy(),(n=this.hdAdapter)===null||n===void 0||n.destroy(),(i=this.interaction)===null||i===void 0||i.destroy(),(a=this.store)===null||a===void 0||a.clear(),this.destroyTooltip(),this.clearCanvasEvent(),this.unmountSheetInstance(),(o=this.container)===null||o===void 0||o.destroy(),oMe()},t.prototype.setThemeCfg=function(r){r===void 0&&(r={});var n=(r==null?void 0:r.theme)||{},i=vAe(qt(qt({},r),{spreadsheet:this}));this.theme=Np(i,n)},t.prototype.setTheme=function(r){this.theme=Np(this.theme,r)},t.prototype.updatePagination=function(r){this.options=Np(this.options,{pagination:r}),this.store.set("scrollX",0),this.store.set("scrollY",0)},t.prototype.getContentHeight=function(){return this.facet.getContentHeight()},t.prototype.changeSize=function(r,n){r===void 0&&(r=this.options.width),n===void 0&&(n=this.options.height),this.changeSheetSize(r,n)},t.prototype.changeSheetSize=function(r,n){r===void 0&&(r=this.options.width),n===void 0&&(n=this.options.height);var i=this.getCanvasElement(),a=this.container.get("width"),o=this.container.get("height"),s=r!==a||n!==o;!s||!i||(this.options=Np(this.options,{width:r,height:n}),this.container.changeSize(r,n))},t.prototype.getCanvasElement=function(){return this.container.get("el")},t.prototype.getLayoutWidthType=function(){return this.options.style.layoutWidthType},t.prototype.getRowNodes=function(r){return r===void 0&&(r=-1),r===-1?this.facet.layoutResult.rowNodes:this.facet.layoutResult.rowNodes.filter(function(n){return n.level===r})},t.prototype.getRowLeafNodes=function(){var r;return((r=this.facet)===null||r===void 0?void 0:r.layoutResult.rowLeafNodes)||[]},t.prototype.getColumnNodes=function(r){var n;r===void 0&&(r=-1);var i=((n=this.facet)===null||n===void 0?void 0:n.layoutResult.colNodes)||[];return r===-1?i:i.filter(function(a){return a.level===r})},t.prototype.getColumnLeafNodes=function(){var r;return((r=this.facet)===null||r===void 0?void 0:r.layoutResult.colLeafNodes)||[]},t.prototype.updateScrollOffset=function(r){var n={offsetX:{value:void 0,animate:!1},offsetY:{value:void 0,animate:!1},rowHeaderOffsetX:{value:void 0,animate:!1}};this.facet.updateScrollOffset(Np(n,r))},t.prototype.getTooltipDataItemMappingCallback=function(){var r;return(r=this.options)===null||r===void 0?void 0:r.mappingDisplayDataItem},t.prototype.isCellType=function(r){return r instanceof wL},t.prototype.getCell=function(r){for(var n,i=r;i&&!(i instanceof Fj);){if(this.isCellType(i))return i;i=(n=i.get)===null||n===void 0?void 0:n.call(i,"parent")}return null},t.prototype.getCellType=function(r){var n=this.getCell(r);return n==null?void 0:n.cellType},t.prototype.getTotalsConfig=function(r){var n=this.options.totals,i=this.dataSet.fields.rows,a=ai(n,lc(i,r)?"row":"col",{}),o=a.showSubTotals&&lc(a.subTotalsDimensions,r)?a.showSubTotals:!1;return qt(qt({label:Tl("总计"),subLabel:Tl("小计"),totalsGroupDimensions:[],subTotalsGroupDimensions:[]},a),{showSubTotals:o})},t.prototype.initGroups=function(r){var n=this.options,i=n.width,a=n.height,o=n.supportCSSTransform,s=n.devicePixelRatio;this.container=new Fj({container:this.getMountContainer(r),width:i,height:a,localRefresh:!1,supportCSSTransform:o,pixelRatio:Math.max(s,Plt)}),this.backgroundGroup=this.container.addGroup({name:Kfe,zIndex:Wfe}),this.panelGroup=this.container.addGroup({name:Jfe,zIndex:Zfe}),this.foregroundGroup=this.container.addGroup({name:Qfe,zIndex:Xfe}),this.initPanelGroupChildren(),this.updateContainerStyle()},t.prototype.updateContainerStyle=function(){var r=this.getCanvasElement();r&&(r.style.display="block")},t.prototype.initPanelGroupChildren=function(){this.panelScrollGroup=new dLe({name:tde,zIndex:qfe,s2:this}),this.panelGroup.add(this.panelScrollGroup)},t.prototype.getInitColumnLeafNodes=function(){return this.store.get("initColumnLeafNodes",[])},t.prototype.clearColumnLeafNodes=function(){this.clearInitColumnLeafNodes()},t.prototype.clearInitColumnLeafNodes=function(){this.store.set("initColumnLeafNodes",void 0)},t.prototype.clearCanvasEvent=function(){var r=this,n=this.getEvents();bct(n,function(i,a){r.off(a)})},t.prototype.updateSortMethodMap=function(r,n,i){var a;i===void 0&&(i=!1);var o=i?null:this.store.get("sortMethodMap");this.store.set("sortMethodMap",qt(qt({},o),(a={},a[r]=n,a)))},t.prototype.getMenuDefaultSelectedKeys=function(r){var n=this.store.get("sortMethodMap"),i=ai(n,r);return i?[i]:[]},t}(G3),LOe=function(e){nn(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.getDataSet=function(r){var n=r.dataSet,i=r.hierarchyType;if(n)return n(this);var a=i==="customTree"?new R3e(this):new M5(this);return a},t.prototype.getContentHeight=function(){return this.facet.getContentHeight()},t.prototype.isPivotMode=function(){return!0},t.prototype.isTableMode=function(){return!1},t.prototype.isHierarchyTreeType=function(){var r=this.options.hierarchyType;return r==="tree"||r==="customTree"},t.prototype.isScrollContainsRowHeader=function(){return!this.isFrozenRowHeader()},t.prototype.isFrozenRowHeader=function(){var r;return(r=this.options)===null||r===void 0?void 0:r.frozenRowHeader},t.prototype.isValueInCols=function(){var r,n;return(n=(r=this.dataSet)===null||r===void 0?void 0:r.fields)===null||n===void 0?void 0:n.valueInCols},t.prototype.clearDrillDownData=function(r,n){if(this.dataSet instanceof M5){var i=this.dataSet.clearDrillDownData(r);i&&!n&&(this.interaction.reset(),this.render(!1))}},t.prototype.getFacetCfgFromDataSetAndOptions=function(){var r=this,n=this.dataSet,i=n.fields,a=n.meta,o=this.options,s=o.style,l=o.dataCell,u=function(c){return new L0(c,r)};return qt(qt(qt(qt({},this.options),i),s),{meta:a,spreadsheet:this,dataSet:this.dataSet,dataCell:l??u})},t.prototype.buildFacet=function(){var r,n=this.getFacetCfgFromDataSetAndOptions();(r=this.facet)===null||r===void 0||r.destroy(),this.facet=new cLe(n),this.facet.render()},t.prototype.bindEvents=function(){this.off(Re.ROW_CELL_COLLAPSE_TREE_ROWS),this.off(Re.LAYOUT_TREE_ROWS_COLLAPSE_ALL),this.on(Re.ROW_CELL_COLLAPSE_TREE_ROWS,this.handleRowCellCollapseTreeRows),this.on(Re.LAYOUT_TREE_ROWS_COLLAPSE_ALL,this.handleTreeRowsCollapseAll)},t.prototype.handleRowCellCollapseTreeRows=function(r){var n,i=r.id,a=r.isCollapsed,o={style:{collapsedRows:(n={},n[i]=a,n)}};this.emit(Re.LAYOUT_COLLAPSE_ROWS,{collapsedRows:o.style.collapsedRows,meta:r==null?void 0:r.node}),this.setOptions(o),this.render(!1),this.emit(Re.LAYOUT_AFTER_COLLAPSE_ROWS,{collapsedRows:o.style.collapsedRows,meta:r==null?void 0:r.node})},t.prototype.handleTreeRowsCollapseAll=function(r){var n={style:{hierarchyCollapse:!r,collapsedRows:null,rowExpandDepth:null}};this.setOptions(n),this.render(!1)},t.prototype.groupSortByMethod=function(r,n){var i=this.dataCfg.fields,a=i.rows,o=i.columns,s=this.options.style.colCfg.hideMeasureColumn,l=this.isValueInCols()?no(a):no(o),u=n.query,c=n.value,f=T2(u),d=c;s&&this.isValueInCols()&&(d=this.dataSet.fields.values[0],f[Fi]=d);var v={sortFieldId:l,sortMethod:r,sortByMeasure:d,query:f},g=this.dataCfg.sortParams.filter(function(w){return(w==null?void 0:w.sortFieldId)!==l});this.updateSortMethodMap(n.id,r,!0);var x=Gr(Gr([],ur(g),!1),[v],!1);this.emit(Re.RANGE_SORT,x),this.setDataCfg(qt(qt({},this.dataCfg),{sortParams:x})),this.render()},t.prototype.handleGroupSort=function(r,n){var i=this;r.stopPropagation(),this.interaction.addIntercepts([Ai.HOVER]);var a=this.getMenuDefaultSelectedKeys(n==null?void 0:n.id),o={onClick:function(s){var l=s.key,u=l;i.groupSortByMethod(u,n),i.emit(Re.RANGE_SORTED,r)},menus:hAe(),defaultSelectedKeys:a};this.showTooltipWithInfo(r,[],{operator:o,onlyMenu:!0,forceRender:!0})},t.prototype.initPanelGroupChildren=function(){e.prototype.initPanelGroupChildren.call(this);var r={zIndex:Elt,s2:this};this.frozenRowGroup=new Fft(qt({KEY_GROUP_PANEL_FROZEN_ROW:wlt},r)),this.panelGroup.add(this.frozenRowGroup)},t.prototype.isCellType=function(r){return r instanceof wL&&!(r instanceof Jht)},t}(Bft),OOe=function(e){nn(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.onSortTooltipClick=function(n,i){var a=n.key,o=i.field,s={sortFieldId:o,sortMethod:a};r.updateSortMethodMap(i.id,a),r.emit(Re.RANGE_SORT,[s])},r}return t.prototype.getDataSet=function(r){var n=r.dataSet;return n?n(this):new I3e(this)},t.prototype.isPivotMode=function(){return!1},t.prototype.isTableMode=function(){return!0},t.prototype.isHierarchyTreeType=function(){return!1},t.prototype.isScrollContainsRowHeader=function(){return!1},t.prototype.isFrozenRowHeader=function(){return!1},t.prototype.clearDrillDownData=function(){},t.prototype.isValueInCols=function(){return!1},t.prototype.bindEvents=function(){},t.prototype.initPanelGroupChildren=function(){var r,n=this;e.prototype.initPanelGroupChildren.call(this);var i={zIndex:Elt,s2:this};r=ur([wlt,Clt,ede,rde,nde,ide].map(function(a){var o=new Fft(qt({name:a},i));return n.panelGroup.add(o),o}),6),this.frozenRowGroup=r[0],this.frozenColGroup=r[1],this.frozenTrailingRowGroup=r[2],this.frozenTrailingColGroup=r[3],this.frozenTopGroup=r[4],this.frozenBottomGroup=r[5]},t.prototype.getFacetCfgFromDataSetAndOptions=function(){var r=this,n=this.dataSet,i=n.fields,a=n.meta,o=this.options,s=o.style,l=o.dataCell,u=function(c){return r.options.showSeriesNumber&&c.colIndex===0?new qht(c,r):new SL(c,r)};return qt(qt(qt(qt({},this.options),i),s),{meta:a,spreadsheet:this,dataSet:this.dataSet,dataCell:l??u})},t.prototype.buildFacet=function(){var r,n=this.getFacetCfgFromDataSetAndOptions();(r=this.facet)===null||r===void 0||r.destroy(),this.facet=new fLe(n),this.facet.render()},t.prototype.clearFrozenGroups=function(){this.frozenRowGroup.set("children",[]),this.frozenColGroup.set("children",[]),this.frozenTrailingRowGroup.set("children",[]),this.frozenTrailingColGroup.set("children",[]),this.frozenTopGroup.set("children",[]),this.frozenBottomGroup.set("children",[])},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.clearFrozenGroups(),this.off(Re.RANGE_SORT),this.off(Re.RANGE_FILTER)},t.prototype.handleGroupSort=function(r,n){var i=this;r.stopPropagation(),this.interaction.addIntercepts([Ai.HOVER]);var a=this.getMenuDefaultSelectedKeys(n==null?void 0:n.id),o={onClick:function(s){var l=s.key,u=l;i.onSortTooltipClick({key:u},n)},menus:fAe(),defaultSelectedKeys:a};this.showTooltipWithInfo(r,[],{operator:o,onlyMenu:!0,forceRender:!0})},t}(Bft);export{Fi as $,SL as A,$Z as B,rdt as C,Kne as D,Pf as E,Md as F,f7t as G,ULe as H,O7 as I,Zht as J,j_ as K,F5 as L,C_ as M,Re as N,m_ as O,Gx as P,_Re as Q,wRe as R,x9t as S,tOe as T,nMe as U,Fh as V,iI as W,OOe as X,ky as Y,c6t as Z,av as _,JLe as a,LOe as a0,M5 as a1,$f as a2,Zc as a3,sat as a4,Tat as a5,Oat as a6,oF as a7,Iw as a8,aF as a9,_6t as aa,NLe as ab,Oe as ac,U as ad,lOe as ae,uOe as af,cOe as ag,hOe as ah,fOe as ai,dOe as aj,pOe as ak,vOe as al,gOe as am,mOe as an,yOe as ao,_Oe as ap,xOe as aq,bOe as ar,EOe as as,wOe as at,COe as au,SOe as av,TOe as aw,AOe as ax,MOe as ay,IOe as az,DS as b,hg as c,eOe as d,yLt as e,rOe as f,nOe as g,aOe as h,oOe as i,iOe as j,sOe as k,jN as l,h6t as m,Zb as n,Jk as o,$3 as p,Cx as q,DC as r,Tb as s,PLe as t,YLe as u,d3e as v,f3e as w,ZA as x,Dn as y,rc as z};

import{i as S,w as v,r as C,s as A,x as H,Z as J,E as Q,e as ee,C as te,p as oe,A as ae,y as re}from"./element-plus-secondary-0.0.0-dataease.js";import{h as ie,f as se}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as le,r as pe,t as de,k as me,l as ne,o as f,T as y,U as r,a as d,u as o,_ as h,Y as m,R as ue,W as a,X as g,c as ce,a8 as fe,S as _e}from"./@vue-0.0.0-dataease.js";import{d as I}from"./dv-folder-0.0.0-dataease.js";import{d as ve}from"./dv-link-target-0.0.0-dataease.js";import{e as ye}from"./dataVisualization-0.0.0-dataease.js";import{g as he}from"./dataset-0.0.0-dataease.js";import ge from"./DatasetSelect-0.0.0-dataease.js";import{d as be}from"./dvMain-0.0.0-dataease.js";import{s as we}from"./pinia-0.0.0-dataease.js";import{a as Te,g as Ve,l as ke,D as E}from"./index-0.0.0-dataease.js";import{s as De}from"./snapshot-0.0.0-dataease.js";import{i as Fe}from"./ModelUtil-0.0.0-dataease.js";import{_ as xe}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./lodash-es-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./fast-png-0.0.0-dataease.js";import"./iobuffer-0.0.0-dataease.js";import"./pako-0.0.0-dataease.js";import"./vue-router_2-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./js-base64-0.0.0-dataease.js";import"./icon_dataset-0.0.0-dataease.js";import"./icon_done_outlined-0.0.0-dataease.js";import"./app-0.0.0-dataease.js";import"./login-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";import"./treeSortUtils-0.0.0-dataease.js";import"./chart-0.0.0-dataease.js";import"./chart-0.0.0-dataease2.js";import"./decimal.js-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./snowflake-id-0.0.0-dataease.js";import"./index-0.0.0-dataease12.js";import"./@antv-0.0.0-dataease.js";import"./eventemitter3-0.0.0-dataease.js";import"./@mapbox-0.0.0-dataease.js";import"./pbf-0.0.0-dataease.js";import"./ieee754-0.0.0-dataease.js";import"./supercluster-0.0.0-dataease.js";import"./gl-matrix-0.0.0-dataease.js";import"./tslib-0.0.0-dataease.js";import"./detect-browser-0.0.0-dataease.js";import"./size-sensor-0.0.0-dataease.js";import"./d3-regression-0.0.0-dataease.js";import"./d3-hierarchy-0.0.0-dataease.js";import"./fmin-0.0.0-dataease.js";import"./pdfast-0.0.0-dataease.js";import"./d3-ease-0.0.0-dataease.js";import"./d3-interpolate-0.0.0-dataease.js";import"./d3-color-0.0.0-dataease.js";import"./d3-timer-0.0.0-dataease.js";import"./fecha-0.0.0-dataease.js";import"./topojson-client-0.0.0-dataease.js";import"./viewport-mercator-project-0.0.0-dataease.js";import"./@turf-0.0.0-dataease.js";import"./polygon-clipping-0.0.0-dataease.js";import"./splaytree-0.0.0-dataease.js";import"./robust-predicates-0.0.0-dataease.js";import"./d3-scale-0.0.0-dataease.js";import"./d3-collection-0.0.0-dataease.js";import"./d3-format-0.0.0-dataease.js";import"./d3-time-format-0.0.0-dataease.js";import"./d3-time-0.0.0-dataease.js";import"./d3-array-0.0.0-dataease.js";import"./earcut-0.0.0-dataease.js";import"./regl-0.0.0-dataease.js";import"./mapbox-gl-0.0.0-dataease.js";import"./d3-dsv-0.0.0-dataease.js";import"./geojson-vt-0.0.0-dataease.js";import"./hammerjs-0.0.0-dataease.js";import"./element-resize-detector-0.0.0-dataease.js";import"./batch-processor-0.0.0-dataease.js";import"./d3-hexbin-0.0.0-dataease.js";import"./mathjs-0.0.0-dataease.js";import"./typed-function-0.0.0-dataease.js";import"./complex.js-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./exceljs-0.0.0-dataease.js";import"./file-saver-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./less-0.0.0-dataease.js";import"./copy-anything-0.0.0-dataease.js";import"./is-what-0.0.0-dataease.js";import"./eventBus-0.0.0-dataease.js";const ze={class:"app-export"},Se={class:"de-row-rules",style:{margin:"0 0 16px"}},Ce={class:"custom-tree-node"},Ae=["title"],Ie={class:"custom-tree-node"},Ee=["title"],Ne={class:"de-row-rules",style:{margin:"0 0 16px"}},qe={class:"apply",style:{width:"100%"}},Pe=le({__name:"DeAppApply",props:{componentData:{type:Object,required:!0},canvasViewInfo:{type:Object,required:!0},curCanvasType:{type:String,required:!0},themes:{type:String,default:"dark"}},emits:["closeDraw","saveAppCanvas"],setup(N,{expose:q,emit:P}){const{wsCache:U}=Te("localStorage"),{t:i}=ie(),V=P,k=pe(null),B=be(),{dvInfo:u,appData:D}=we(B),F=De(),M=N,{curCanvasType:_}=de(M),x=U.get(Ve("open-backend"))==="1"?"_self":"_blank",z=me(()=>_.value==="dashboard"?i("work_branch.dashboard"):i("work_branch.big_data_screen")),O=()=>{const l="#/data/datasource?opt=create";window.open(l,x)},e=ne({appApplyDrawer:!1,dvTree:[],dsTree:[],propsTree:{label:"name",children:"children",isLeaf:l=>{var t;return!((t=l.children)!=null&&t.length)}},appData:{datasourceInfo:[]},form:{pid:"",name:i("visualization.new"),datasetFolderPid:null,datasetFolderName:null},rule:{name:[{required:!0,min:2,max:25,message:i("datasource.input_limit_2_25",[2,25]),trigger:"blur"}],pid:[{required:!0,message:i("visualization.select_folder"),trigger:"blur"}],datasetFolderName:[{required:!0,min:2,max:25,message:i("datasource.input_limit_2_25",[2,25]),trigger:"blur"}],datasetFolderPid:[{required:!0,message:i("visualization.select_ds_group_folder"),trigger:"blur"}]}}),R=()=>{window.history.back()},W=()=>{const l={busiFlag:_.value,resourceTable:"core",leaf:!1,weight:7};ye(l).then(p=>{E(p,_.value);const c=p||[];b(c),e.dvTree=c||[],e.dvTree.length&&e.dvTree[0].name==="root"&&e.dvTree[0].id==="0"&&(e.dvTree[0].name=_.value==="dataV"?i("work_branch.big_data_screen"):i("work_branch.dashboard"))}),he({leaf:!1,weight:7}).then(p=>{E(p,"dataset"),b(p),e.dsTree=p||[],e.dsTree.length&&e.dsTree[0].name==="root"&&e.dsTree[0].id==="0"&&(e.dsTree[0].name=i("visualization.dataset"))})},b=l=>{l.forEach(t=>{var p;t.value=t.id,(p=t.children)!=null&&p.length&&b(t.children)})},j=l=>{var t;e.appApplyDrawer=!0,e.form=l.base,e.appData.datasourceInfo=ke((t=D.value)==null?void 0:t.datasourceInfo),W()},K=l=>{e.form.pid=l.id},L=l=>{e.form.datasetFolderPid=l.id},X=()=>{V("closeDraw"),F.recordSnapshotCache("renderChart"),e.appApplyDrawer=!1},Y=()=>{var t;let l=!0;if(e.appData.datasourceInfo.forEach(p=>{p.systemDatasourceId||(l=!1)}),!l){Q.error(i("visualization.app_no_datasource_tips"));return}(t=k.value)==null||t.validate(p=>{if(p)D.value.datasourceInfo=e.appData.datasourceInfo,u.value.pid=e.form.pid,u.value.name=e.form.name,u.value.datasetFolderPid=e.form.datasetFolderPid,u.value.datasetFolderName=e.form.datasetFolderName,u.value.dataState="ready",F.recordSnapshotCache("renderChart"),V("saveAppCanvas");else return!1})};return q({init:j,close:X}),(l,t)=>{const p=se,c=ee,n=te,w=oe,Z=ae,$=re;return f(),y(o(J),{title:o(i)("visualization.save_app"),modelValue:e.appApplyDrawer,"onUpdate:modelValue":t[8]||(t[8]=s=>e.appApplyDrawer=s),"modal-class":"de-app-drawer","show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,size:"500px",direction:"rtl","z-index":"1000"},{footer:r(()=>[d("div",qe,[o(Fe)()||o(x)==="_self"?(f(),y(o(S),{key:0,onClick:R},{default:r(()=>[h(m(o(i)("visualization.back")),1)]),_:1})):ue("",!0),a(o(S),{type:"primary",onClick:Y},{default:r(()=>[h(m(o(i)("visualization.save")),1)]),_:1})])]),default:r(()=>[d("div",ze,[a(o(H),{ref_key:"appSaveForm",ref:k,model:e.form,rules:e.rule,class:"de-form-item app-form",size:"middle","label-width":"180px","label-position":"top"},{default:r(()=>[d("div",Se,[d("span",null,m(o(i)("visualization.base_info")),1)]),a(o(v),{label:z.value+o(i)("visualization.name"),prop:"name"},{default:r(()=>[a(o(C),{modelValue:e.form.name,"onUpdate:modelValue":t[0]||(t[0]=s=>e.form.name=s),autocomplete:"off",placeholder:o(i)("visualization.input_tips")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(o(v),{label:z.value+o(i)("visualization.position"),prop:"pid"},{default:r(()=>[a(o(A),{style:{width:"100%"},onKeydown:t[1]||(t[1]=g(()=>{},["stop"])),onKeyup:t[2]||(t[2]=g(()=>{},["stop"])),modelValue:e.form.pid,"onUpdate:modelValue":t[3]||(t[3]=s=>e.form.pid=s),data:e.dvTree,props:e.propsTree,onNodeClick:K,"render-after-expand":!1,filterable:""},{default:r(({data:{name:s}})=>[d("span",Ce,[a(c,null,{default:r(()=>[a(p,{name:"dv-folder"},{default:r(()=>[a(o(I),{class:"svg-icon"})]),_:1})]),_:1}),d("span",{title:s},m(s),9,Ae)])]),_:1},8,["modelValue","data","props"])]),_:1},8,["label"]),a(o(v),{label:o(i)("visualization.ds_group_name"),prop:"datasetFolderName"},{default:r(()=>[a(o(C),{modelValue:e.form.datasetFolderName,"onUpdate:modelValue":t[4]||(t[4]=s=>e.form.datasetFolderName=s),autocomplete:"off",placeholder:o(i)("visualization.input_tips")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(o(v),{label:o(i)("visualization.ds_group_position"),prop:"datasetFolderPid"},{default:r(()=>[a(o(A),{style:{width:"100%"},onKeydown:t[5]||(t[5]=g(()=>{},["stop"])),onKeyup:t[6]||(t[6]=g(()=>{},["stop"])),modelValue:e.form.datasetFolderPid,"onUpdate:modelValue":t[7]||(t[7]=s=>e.form.datasetFolderPid=s),data:e.dsTree,props:e.propsTree,onNodeClick:L,"filter-method":l.dsTreeFilterMethod,"render-after-expand":!1,filterable:""},{default:r(({data:{name:s}})=>[d("span",Ie,[a(c,null,{default:r(()=>[a(p,{name:"dv-folder"},{default:r(()=>[a(o(I),{class:"svg-icon"})]),_:1})]),_:1}),d("span",{title:s},m(s),9,Ee)])]),_:1},8,["modelValue","data","props","filter-method"])]),_:1},8,["label"]),d("div",Ne,[d("span",null,m(o(i)("visualization.datasource_info")),1)]),a(w,{class:"datasource-link"},{default:r(()=>[a(w,{class:"head"},{default:r(()=>[a(n,{span:11},{default:r(()=>[h(m(o(i)("visualization.app_datasource")),1)]),_:1}),a(n,{span:2}),a(n,{span:11},{default:r(()=>[h(m(o(i)("visualization.sys_datasource")),1)]),_:1})]),_:1}),(f(!0),ce(_e,null,fe(e.appData.datasourceInfo,(s,G)=>(f(),y(w,{key:G,class:"content"},{default:r(()=>[a(n,{span:11},{default:r(()=>[a($,{style:{width:"100%"},modelValue:s.name,"onUpdate:modelValue":T=>s.name=T,disabled:""},{default:r(()=>[(f(),y(Z,{key:s.name,label:s.name,value:s.name},null,8,["label","value"]))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(n,{span:2,class:"icon-center"},{default:r(()=>[a(p,{name:"dv-link-target"},{default:r(()=>[a(o(ve),{class:"svg-icon",style:{width:"20px",height:"20px"}})]),_:1})]),_:1}),a(n,{span:11},{default:r(()=>[a(ge,{ref_for:!0,ref:"datasetSelector",modelValue:s.systemDatasourceId,"onUpdate:modelValue":T=>s.systemDatasourceId=T,style:{flex:"1"},"state-obj":e,themes:"light","source-type":"datasource",onAddDsWindow:O,"view-id":"0"},null,8,["modelValue","onUpdate:modelValue","state-obj"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["title","modelValue"])}}});const sa=xe(Pe,[["__scopeId","data-v-a60cb38f"]]);export{sa as default};

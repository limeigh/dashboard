import{b as Q}from"./index-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import{a as Y,E as Z}from"./el-select-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as ee}from"./el-row-0.0.0-dataease.js";import{E as ae}from"./el-col-0.0.0-dataease.js";import{y as x,G as A,o as te,N as oe,D as re,n as se,j as le,aA as C}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as de,r as ie,af as pe,t as ne,y as me,X as ue,f,g as v,i as r,P as p,u as t,a3 as y,a4 as n,_ as ce,j as o,a8 as h,O as fe,a6 as _e,W as ve}from"./vue-0.0.0-dataease.js";import{d as S}from"./dv-folder-0.0.0-dataease.js";import{d as ye}from"./dv-link-target-0.0.0-dataease.js";import{E as he}from"./el-drawer-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import{E as g,a as ge}from"./el-form-item-0.0.0-dataease.js";import"./el-tree-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import{E as I}from"./el-tree-select-0.0.0-dataease.js";import{e as be}from"./dataVisualization-0.0.0-dataease.js";import{a as we}from"./dataset-0.0.0-dataease.js";import Te from"./DatasetSelect-0.0.0-dataease.js";import{d as Ve}from"./dvMain-0.0.0-dataease.js";import{s as ke}from"./snapshot-0.0.0-dataease.js";import{i as De}from"./ModelUtil-0.0.0-dataease.js";import{_ as Fe}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./index-0.0.0-dataease4.js";import"./index-0.0.0-dataease3.js";import"./index-0.0.0-dataease6.js";import"./token-0.0.0-dataease.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease5.js";import"./constants-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./index-0.0.0-dataease15.js";import"./el-popover-0.0.0-dataease.js";import"./dropdown-0.0.0-dataease.js";import"./el-footer-0.0.0-dataease.js";import"./el-aside-0.0.0-dataease.js";import"./el-main-0.0.0-dataease.js";import"./icon_dataset-0.0.0-dataease.js";import"./icon_done_outlined-0.0.0-dataease.js";import"./app-0.0.0-dataease.js";import"./treeSortUtils-0.0.0-dataease.js";import"./index-0.0.0-dataease16.js";import"./chart-0.0.0-dataease.js";import"./chart-0.0.0-dataease2.js";import"./decimal-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./index-0.0.0-dataease21.js";import"./antv-0.0.0-dataease.js";import"./index-0.0.0-dataease22.js";import"./pureFunctionsAny.generated-0.0.0-dataease.js";import"./extends-0.0.0-dataease.js";import"./tslib.es6-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./_commonjs-dynamic-modules-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./eventBus-0.0.0-dataease.js";const ze={class:"app-export"},Ee={class:"de-row-rules",style:{margin:"0 0 16px"}},xe={class:"custom-tree-node"},Ae=["title"],Ce={class:"custom-tree-node"},Se=["title"],Ie={class:"de-row-rules",style:{margin:"0 0 16px"}},Ne={class:"apply",style:{width:"100%"}},qe=de({__name:"DeAppApply",props:{componentData:{type:Object,required:!0},canvasViewInfo:{type:Object,required:!0},curCanvasType:{type:String,required:!0},themes:{type:String,default:"dark"}},emits:["closeDraw","saveAppCanvas"],setup(N,{expose:q,emit:P}){const{wsCache:U}=Q("localStorage"),{t:s}=te(),V=P,k=ie(null),j=Ve(),{dvInfo:u,appData:D}=pe(j),F=ke(),B=N,{curCanvasType:_}=ne(B),z=U.get("open-backend")==="1"?"_self":"_blank",E=me(()=>_.value==="dashboard"?s("work_branch.dashboard"):s("work_branch.big_data_screen")),M=()=>{const d="#/data/datasource?opt=create";window.open(d,z)},e=ue({appApplyDrawer:!1,dvTree:[],dsTree:[],propsTree:{label:"name",children:"children",isLeaf:d=>{var a;return!((a=d.children)!=null&&a.length)}},appData:{datasourceInfo:[]},form:{pid:"",name:s("visualization.new"),datasetFolderPid:null,datasetFolderName:null},rule:{name:[{required:!0,min:2,max:25,message:s("datasource.input_limit_2_25",[2,25]),trigger:"blur"}],pid:[{required:!0,message:s("visualization.select_folder"),trigger:"blur"}],datasetFolderName:[{required:!0,min:2,max:25,message:s("datasource.input_limit_2_25",[2,25]),trigger:"blur"}],datasetFolderPid:[{required:!0,message:s("visualization.select_ds_group_folder"),trigger:"blur"}]}}),O=()=>{window.history.back()},W=()=>{const d={busiFlag:_.value,resourceTable:"core",leaf:!1,weight:7};be(d).then(i=>{C(i,_.value);const c=i||[];b(c),e.dvTree=c||[],e.dvTree.length&&e.dvTree[0].name==="root"&&e.dvTree[0].id==="0"&&(e.dvTree[0].name=_.value==="dataV"?s("work_branch.big_data_screen"):s("work_branch.dashboard"))}),we({leaf:!1,weight:7}).then(i=>{C(i,"dataset"),b(i),e.dsTree=i||[],e.dsTree.length&&e.dsTree[0].name==="root"&&e.dsTree[0].id==="0"&&(e.dsTree[0].name=s("visualization.dataset"))})},b=d=>{d.forEach(a=>{var i;a.value=a.id,(i=a.children)!=null&&i.length&&b(a.children)})},K=d=>{var a;e.appApplyDrawer=!0,e.form=d.base,e.appData.datasourceInfo=oe((a=D.value)==null?void 0:a.datasourceInfo),W()},R=d=>{e.form.pid=d.id},L=d=>{e.form.datasetFolderPid=d.id},G=()=>{V("closeDraw"),F.recordSnapshotCache("renderChart"),e.appApplyDrawer=!1},X=()=>{var a;let d=!0;if(e.appData.datasourceInfo.forEach(i=>{i.systemDatasourceId||(d=!1)}),!d){re.error(s("visualization.app_no_datasource_tips"));return}(a=k.value)==null||a.validate(i=>{if(i)D.value.datasourceInfo=e.appData.datasourceInfo,u.value.pid=e.form.pid,u.value.name=e.form.name,u.value.datasetFolderPid=e.form.datasetFolderPid,u.value.datasetFolderName=e.form.datasetFolderName,u.value.dataState="ready",F.recordSnapshotCache("renderChart"),V("saveAppCanvas");else return!1})};return q({init:K,close:G}),(d,a)=>{const i=se,c=le,m=ae,w=ee,$=Y,H=Z;return f(),v(t(he),{title:t(s)("visualization.save_app"),modelValue:e.appApplyDrawer,"onUpdate:modelValue":a[8]||(a[8]=l=>e.appApplyDrawer=l),"modal-class":"de-app-drawer","show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,size:"500px",direction:"rtl","z-index":"1000"},{footer:r(()=>[p("div",Ne,[t(De)()||t(z)==="_self"?(f(),v(t(x),{key:0,onClick:O},{default:r(()=>[y(n(t(s)("visualization.back")),1)]),_:1})):ce("",!0),o(t(x),{type:"primary",onClick:X},{default:r(()=>[y(n(t(s)("visualization.save")),1)]),_:1})])]),default:r(()=>[p("div",ze,[o(t(ge),{ref_key:"appSaveForm",ref:k,model:e.form,rules:e.rule,class:"de-form-item app-form",size:"middle","label-width":"180px","label-position":"top"},{default:r(()=>[p("div",Ee,[p("span",null,n(t(s)("visualization.base_info")),1)]),o(t(g),{label:E.value+t(s)("visualization.name"),prop:"name"},{default:r(()=>[o(t(A),{modelValue:e.form.name,"onUpdate:modelValue":a[0]||(a[0]=l=>e.form.name=l),autocomplete:"off",placeholder:t(s)("visualization.input_tips")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(t(g),{label:E.value+t(s)("visualization.position"),prop:"pid"},{default:r(()=>[o(t(I),{style:{width:"100%"},onKeydown:a[1]||(a[1]=h(()=>{},["stop"])),onKeyup:a[2]||(a[2]=h(()=>{},["stop"])),modelValue:e.form.pid,"onUpdate:modelValue":a[3]||(a[3]=l=>e.form.pid=l),data:e.dvTree,props:e.propsTree,onNodeClick:R,"render-after-expand":!1,filterable:""},{default:r(({data:{name:l}})=>[p("span",xe,[o(c,null,{default:r(()=>[o(i,{name:"dv-folder"},{default:r(()=>[o(t(S),{class:"svg-icon"})]),_:1})]),_:1}),p("span",{title:l},n(l),9,Ae)])]),_:1},8,["modelValue","data","props"])]),_:1},8,["label"]),o(t(g),{label:t(s)("visualization.ds_group_name"),prop:"datasetFolderName"},{default:r(()=>[o(t(A),{modelValue:e.form.datasetFolderName,"onUpdate:modelValue":a[4]||(a[4]=l=>e.form.datasetFolderName=l),autocomplete:"off",placeholder:t(s)("visualization.input_tips")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(t(g),{label:t(s)("visualization.ds_group_position"),prop:"datasetFolderPid"},{default:r(()=>[o(t(I),{style:{width:"100%"},onKeydown:a[5]||(a[5]=h(()=>{},["stop"])),onKeyup:a[6]||(a[6]=h(()=>{},["stop"])),modelValue:e.form.datasetFolderPid,"onUpdate:modelValue":a[7]||(a[7]=l=>e.form.datasetFolderPid=l),data:e.dsTree,props:e.propsTree,onNodeClick:L,"filter-method":d.dsTreeFilterMethod,"render-after-expand":!1,filterable:""},{default:r(({data:{name:l}})=>[p("span",Ce,[o(c,null,{default:r(()=>[o(i,{name:"dv-folder"},{default:r(()=>[o(t(S),{class:"svg-icon"})]),_:1})]),_:1}),p("span",{title:l},n(l),9,Se)])]),_:1},8,["modelValue","data","props","filter-method"])]),_:1},8,["label"]),p("div",Ie,[p("span",null,n(t(s)("visualization.datasource_info")),1)]),o(w,{class:"datasource-link"},{default:r(()=>[o(w,{class:"head"},{default:r(()=>[o(m,{span:11},{default:r(()=>[y(n(t(s)("visualization.app_datasource")),1)]),_:1}),o(m,{span:2}),o(m,{span:11},{default:r(()=>[y(n(t(s)("visualization.sys_datasource")),1)]),_:1})]),_:1}),(f(!0),fe(ve,null,_e(e.appData.datasourceInfo,(l,J)=>(f(),v(w,{key:J,class:"content"},{default:r(()=>[o(m,{span:11},{default:r(()=>[o(H,{style:{width:"100%"},modelValue:l.name,"onUpdate:modelValue":T=>l.name=T,disabled:""},{default:r(()=>[(f(),v($,{key:l.name,label:l.name,value:l.name},null,8,["label","value"]))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(m,{span:2,class:"icon-center"},{default:r(()=>[o(i,{name:"dv-link-target"},{default:r(()=>[o(t(ye),{class:"svg-icon",style:{width:"20px",height:"20px"}})]),_:1})]),_:1}),o(m,{span:11},{default:r(()=>[o(Te,{ref_for:!0,ref:"datasetSelector",modelValue:l.systemDatasourceId,"onUpdate:modelValue":T=>l.systemDatasourceId=T,style:{flex:"1"},"state-obj":e,themes:"light","source-type":"datasource",onAddDsWindow:M,"view-id":"0"},null,8,["modelValue","onUpdate:modelValue","state-obj"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["title","modelValue"])}}});const Ga=Fe(qe,[["__scopeId","data-v-3de40ad0"]]);export{Ga as default};

import{q as Q,E as ee,e as Re,r as Me,f as Oe,t as je,G as Je,H as We,I as Ue,b as qe,m as ze,h as He,W as Ie,V as Ke,n as Xe,o as Pe,w as Ye,x as Ze,i as Qe,M as eo,A as oo,y as to}from"./element-plus-secondary-0.0.0-dataease.js";import{f as ao,j as so,e as no}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as lo,r as _,l as J,a7 as ro,o as v,c as C,W as o,U as a,a as s,Y as d,u as l,z as io,X as W,R as oe,T as ue,_ as x,S as U,Z as co,a8 as mo,n as pe}from"./@vue-0.0.0-dataease.js";import{i as te}from"./icon_add_outlined-0.0.0-dataease.js";import{i as uo}from"./icon_more_outlined-0.0.0-dataease.js";import{i as po}from"./icon_edit_outlined-0.0.0-dataease.js";import{i as _o}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{i as _e}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import{X as fe,ag as fo,aD as yo,ah as vo,aE as go,aF as ho,W as bo,aG as Co,aH as ko}from"./chart-0.0.0-dataease.js";import{E as ye}from"./EmptyBackground-0.0.0-dataease.js";import{a as Ao,F as wo,g as ve}from"./index-0.0.0-dataease.js";import Eo from"./GeometryEdit-0.0.0-dataease.js";import{i as xo,f as To}from"./@antv-0.0.0-dataease.js";import{e as Bo}from"./@turf-0.0.0-dataease.js";import{d as Vo,h as ge}from"./lodash-es-0.0.0-dataease.js";import{_ as Do}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./pinia-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./fast-png-0.0.0-dataease.js";import"./iobuffer-0.0.0-dataease.js";import"./pako-0.0.0-dataease.js";import"./vue-router_2-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./chart-0.0.0-dataease2.js";import"./dataset-0.0.0-dataease.js";import"./js-base64-0.0.0-dataease.js";import"./app-0.0.0-dataease.js";import"./login-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";import"./decimal.js-0.0.0-dataease.js";import"./none-0.0.0-dataease.js";import"./nothing-tree-0.0.0-dataease.js";import"./dv-info-0.0.0-dataease.js";import"./icon_upload_outlined-0.0.0-dataease.js";import"./eventemitter3-0.0.0-dataease.js";import"./@mapbox-0.0.0-dataease.js";import"./pbf-0.0.0-dataease.js";import"./ieee754-0.0.0-dataease.js";import"./supercluster-0.0.0-dataease.js";import"./gl-matrix-0.0.0-dataease.js";import"./tslib-0.0.0-dataease.js";import"./detect-browser-0.0.0-dataease.js";import"./size-sensor-0.0.0-dataease.js";import"./d3-regression-0.0.0-dataease.js";import"./d3-hierarchy-0.0.0-dataease.js";import"./fmin-0.0.0-dataease.js";import"./pdfast-0.0.0-dataease.js";import"./d3-ease-0.0.0-dataease.js";import"./d3-interpolate-0.0.0-dataease.js";import"./d3-color-0.0.0-dataease.js";import"./d3-timer-0.0.0-dataease.js";import"./fecha-0.0.0-dataease.js";import"./topojson-client-0.0.0-dataease.js";import"./viewport-mercator-project-0.0.0-dataease.js";import"./d3-scale-0.0.0-dataease.js";import"./d3-collection-0.0.0-dataease.js";import"./d3-format-0.0.0-dataease.js";import"./d3-time-format-0.0.0-dataease.js";import"./d3-time-0.0.0-dataease.js";import"./d3-array-0.0.0-dataease.js";import"./earcut-0.0.0-dataease.js";import"./regl-0.0.0-dataease.js";import"./mapbox-gl-0.0.0-dataease.js";import"./d3-dsv-0.0.0-dataease.js";import"./geojson-vt-0.0.0-dataease.js";import"./hammerjs-0.0.0-dataease.js";import"./element-resize-detector-0.0.0-dataease.js";import"./batch-processor-0.0.0-dataease.js";import"./d3-hexbin-0.0.0-dataease.js";import"./polygon-clipping-0.0.0-dataease.js";import"./splaytree-0.0.0-dataease.js";import"./robust-predicates-0.0.0-dataease.js";const Fo={class:"geo-title"},Go={class:"geo-search"},Lo={class:"map-tree-container"},So=["title","innerHTML"],$o={key:1,class:"geo-operate-container"},No={class:"custom-area-root"},Ro=["title"],Mo={class:"opt-icon"},Oo={key:0,class:"geo-content-container"},jo={key:1,class:"geo-content-container"},Jo={class:"geo-content-top"},Wo={class:"geo-content-middle"},Uo={class:"geo-area"},qo={class:"area-label"},zo={class:"area-content"},Ho={class:"geo-area"},Io={class:"area-label"},Ko={class:"area-content"},Xo={key:0,class:"area-secondary"},Po={class:"geo-content-bottom"},Yo={class:"area-label"},Zo={key:0},Qo={key:1,class:"sub-area-view"},et={class:"sub-area-editor"},ot={class:"header"},tt={class:"label"},at={class:"area-edit-btn"},st=["onClick"],nt=["onClick"],lt={class:"dialog-footer"},rt={class:"dialog-footer"},it=lo({__name:"Geometry",setup(ct){const{wsCache:ae}=Ao(),{t:n}=ao(),q=_(""),L=_([]),S=_(),$=_(null),he=_(!1),g=_(null),z=_(!0),be=async t=>{var m;g.value=t,(m=I.value)==null||m.setCurrentKey(null),u==null||u.destroy(),u=null,A.id="";const e=ge(await fe(t.id));g.value.geoJson=JSON.stringify(e);const r=t.pid;if(r){const c=$.value.getNode(r);c&&(g.value.parentName=c.data.name)}z.value=!0},Ce=t=>{Q.confirm(n("system.delete_this_node"),{confirmButtonType:"danger",type:"warning",confirmButtonText:n("common.delete"),cancelButtonText:n("dataset.cancel"),autofocus:!1,showClose:!1}).then(()=>{const e="/geometry/delete/"+t.id;so.post({url:e}).then(()=>{var r;((r=g.value)==null?void 0:r.id)===t.id&&(g.value=null),ee.success(n("common.delete_success")),H(!1)})}).catch(()=>{he.value=!1})},ke=t=>{var e;(e=$.value)==null||e.filter(t)},se=(t,e)=>(wo(e,t),t?e.name.toLocaleLowerCase().includes(t.toLocaleLowerCase()):!0),H=t=>{const e="de-area-tree",r=ae.get(ve(e));if(r&&t){L.value=r;return}fo().then(m=>{const c=m.data;L.value=[c],ae.set(ve(e),L.value)}).catch(m=>{console.error(m)})},Ae=t=>{S==null||S.value.edit(t)};H(!0);const N=_([{id:"000",name:n("system.custom_area")}]),T=_(!1),A=J({id:"",name:""}),I=_(),ne=_(),we=async()=>{var t;(t=ne.value)==null||t.validate(async e=>{if(e){const r=await yo(w);if(r.code){ee.error(r.msg);return}await K(),T.value=!1}})},K=async()=>{await vo().then(t=>{var e;(e=t.data)!=null&&e.length?(N.value[0].children=t.data,A.id&&pe(()=>{var r;(r=I.value)==null||r.setCurrentKey(A.id)})):N.value[0].children=null})},w=J({id:"",name:""}),le=t=>{t?(w.id=t.id,w.name=t.name):(w.id="",w.name=""),T.value=!0},Ee=t=>{Q.confirm(n("system.delete_custom_area_tip"),"",{type:"warning",confirmButtonType:"danger",customClass:"area-delete-dialog",autofocus:!1,confirmButtonText:n("common.delete"),showClose:!1}).then(async()=>{var e;await go(t.id),await K(),!((e=N.value[0].children)!=null&&e.length)||t.id===A.id?(R.value=!0,u==null||u.destroy(),u=null):R.value=!1}).catch(()=>{})};let B=null;const xe=()=>{ho().then(t=>{M.value.splice(0,M.value.length,...t.data),B||(B=M.value.reduce((e,r)=>(e[r.id]=r.name,e),{}))})},R=_(!1),X=async(t,e)=>{var r;(r=$.value)==null||r.setCurrentKey(null),!(t.id==="000"||A.id===t.id&&e!==!0)&&(R.value=!1,A.id=t.id,bo(t.id).then(m=>{const c=m.data.reduce((f,h)=>{var G;const k=((G=h.scope)==null?void 0:G.split(","))||[];h.scopeArr=k;const b=[];k.forEach(P=>{b.push(B==null?void 0:B[P])});const E={...h,scopeName:b.join(",")};return f.push(E),f},[]);D.value.splice(0,D.value.length,...c),z.value=!1,pe(()=>{Ve()})}))},V=_(!1),p=J({id:"",name:"",scope:"",geoAreaId:"",scopeArr:[]}),M=_([]),D=_([]),re=_(),ie=J({name:[{type:"string",required:!0,message:n("common.input_name"),trigger:"change"},{min:1,max:50,message:n("common.input_limit",[1,50]),trigger:"blur"}],scopeArr:[{type:"array",required:!0,message:n("system.please_select_area"),trigger:"change"}]}),ce=t=>{p.geoAreaId=A.id,t?(p.name=t.name,p.scopeArr=t.scopeArr,p.id=t.id,p.scope=t.scope):(p.name="",p.scopeArr=[],p.id="",p.scope=""),V.value=!0},Te=async()=>{var t;(t=re.value)==null||t.validate(async e=>{if(!e)return;p.scope=p.scopeArr.join(",");const r=await Co(p);if(r.code){ee.error(r.msg);return}await X({id:A.id},!0),V.value=!1})},Be=async t=>{Q.confirm(n("system.delete_custom_sub_area_tip"),"",{type:"warning",confirmButtonType:"danger",customClass:"area-delete-dialog",autofocus:!1,confirmButtonText:n("common.delete"),showClose:!1}).then(async()=>{await ko(t.id),await X({id:A.id},!0)}).catch(()=>{})};K(),xe();const O=["#1E90FF","#90EE90","#00CED1","#E2BD84","#7A90E0","#3BA272","#2BE7FF","#0A8ADA","#FFD700"],F={map:{type:"mapbox",style:"blank"},geoArea:{type:"geojson"},source:{data:[],joinBy:{sourceField:"name",geoField:"name"}},viewLevel:{adcode:"all",level:"world"},autoFit:!0,chinaBorder:!1,style:{stroke:"grey",opacity:1,lineWidth:.6,lineOpacity:1},label:!1,state:{active:{stroke:"green",lineWidth:1}},legend:!1,tooltip:!1,customFetchGeoData:()=>null};let u=null;const Ve=Vo(async()=>{var m;if(!F.source.joinBy.geoData){const c=ge(await fe("156"));F.source.joinBy.geoData=c}const t=F.source.joinBy.geoData.features.reduce((c,f)=>(f.properties.adcode&&(c["156"+f.properties.adcode]=f),c),{}),e=[];(m=D.value)==null||m.forEach(c=>{var h;const f=[];if((h=c.scopeArr)==null||h.forEach(k=>{const b=t[k];b&&f.push(b)}),f.length){const b=Bo({type:"FeatureCollection",features:f});e.push({name:c.name,x:b.geometry.coordinates[0],y:b.geometry.coordinates[1]})}});const r=new xo({name:"areaTextLayer",source:{data:e,parser:{type:"json",x:"x",y:"y"}},field:"name",style:{fill:"black",fontSize:20,opacity:1,fontWeight:"bold",textAnchor:"center",textAllowOverlap:!0}});if(u){const c=u.getLayerByName("areaTextLayer");c&&u.removeLayer(c),u.addLayer(r),u.update({})}else F.color={field:["name","adcode"],value:c=>{var h;let f="white";return(h=D.value)==null||h.forEach((k,b)=>{var E;(E=k.scopeArr)!=null&&E.includes("156"+c.adcode)&&(f=O[b%O.length])}),f},scale:{type:"quantize",unknown:"white"}},u=new To("map-container",F),u.on("loaded",()=>{u.addLayer(r)})},500);return ro(()=>{u==null||u.destroy()}),(t,e)=>{const r=no,m=Re,c=Me,f=Oe,h=je,k=Je,b=We,E=Ue,G=qe,P=ze,De=He,Y=Ie,Fe=Ke,Ge=Xe,Le=Pe,Z=Ye,me=Ze,j=Qe,de=eo,Se=oo,$e=to;return v(),C(U,null,[o(Le,{class:"geometry-container"},{default:a(()=>[o(P,{class:"geonetry-aside"},{default:a(()=>[s("div",Fo,[s("span",null,d(l(n)("online_map.geometry")),1)]),s("div",Go,[o(c,{class:"m16 w100",modelValue:q.value,"onUpdate:modelValue":e[0]||(e[0]=i=>q.value=i),clearable:"",placeholder:l(n)("commons.search"),onChange:ke},{prefix:a(()=>[o(m,null,{default:a(()=>[o(r,{name:"icon_search-outline_outlined"},{default:a(()=>[o(l(_o),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"])]),s("div",Lo,[o(G,{class:"menu-tree"},{default:a(()=>[o(h,{menu:"",ref_key:"areaTreeRef",ref:$,"node-key":"id",data:L.value,onNodeClick:be,"highlight-current":!0,"expand-on-click-node":!1,"default-expand-all":!1,"filter-node-method":se},{default:a(({node:i,data:y})=>[s("span",{class:io(["custom-tree-node",{"is-disabled":i.disabled||y.root}])},[s("span",{class:"geo-name-span",title:y.name,innerHTML:y.colorName&&q.value?y.colorName:y.name},null,8,So),y.id==="000"?(v(),C("span",{key:0,class:"add-icon-span",onClick:e[1]||(e[1]=W(Ne=>Ae(),["stop"]))},[o(m,null,{default:a(()=>[o(r,{name:"icon_add_outlined"},{default:a(()=>[o(l(te),{class:"svg-icon"})]),_:1})]),_:1})])):oe("",!0),y.custom?(v(),C("span",$o,[o(f,{class:"box-item",effect:"dark",content:l(n)("common.delete"),placement:"top"},{default:a(()=>[o(m,{onClick:W(Ne=>Ce(y),["stop"]),class:"hover-icon"},{default:a(()=>[o(r,{name:"icon_delete-trash_outlined"},{default:a(()=>[o(l(_e),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["content"])])):oe("",!0)],2)]),_:1},8,["data"]),o(h,{menu:"",ref_key:"customAreaTreeRef",ref:I,"node-key":"id",data:N.value,"highlight-current":!0,"expand-on-click-node":!1,"default-expand-all":!1,"filter-node-method":se,onNodeClick:X},{default:a(({data:i})=>[s("span",No,[s("span",{class:"label",title:i.name},d(i.name),9,Ro),i.id==="000"?(v(),C("span",{key:0,class:"opt-icon",onClick:e[2]||(e[2]=W(y=>le(),["stop"]))},[o(m,null,{default:a(()=>[o(r,{name:"icon_add_outlined"},{default:a(()=>[o(l(te))]),_:1})]),_:1})])):(v(),ue(E,{key:1,placement:"bottom-end","popper-class":"area-opt-popper"},{dropdown:a(()=>[o(b,null,{default:a(()=>[o(k,{onClick:y=>le(i)},{default:a(()=>[x(d(l(n)("chart.rename")),1)]),_:1},8,["onClick"]),o(k,{onClick:W(y=>Ee(i),["stop"])},{default:a(()=>[x(d(l(n)("common.delete")),1)]),_:1},8,["onClick"])]),_:2},1024)]),default:a(()=>[s("span",Mo,[o(m,null,{default:a(()=>[o(r,{name:"icon_more_outlined"},{default:a(()=>[o(l(uo))]),_:1})]),_:1})])]),_:2},1024))])]),_:1},8,["data"])]),_:1})])]),_:1}),o(Ge,{class:"geometry-main"},{default:a(()=>[z.value?(v(),C(U,{key:0},[g.value?(v(),C("div",jo,[s("div",Jo,[s("span",null,d(g.value.name),1)]),s("div",Wo,[s("div",Uo,[s("div",qo,[s("span",null,d(l(n)("system.region_code")),1)]),s("div",zo,[s("span",null,d(g.value.id),1)])]),s("div",Ho,[s("div",Io,[s("span",null,d(l(n)("system.superior_region")),1)]),s("div",Ko,[s("span",null,d(g.value.parentName||"-"),1),g.value.pid?(v(),C("span",Xo,d("("+g.value.pid+")"),1)):oe("",!0)])])]),s("div",Po,[s("div",Yo,[s("span",null,d(l(n)("system.coordinate_file")),1)]),o(G,{class:"area-content-geo"},{default:a(()=>[s("span",null,d(g.value.geoJson),1)]),_:1})])])):(v(),C("div",Oo,[o(ye,{"img-type":"noneWhite",description:l(n)("system.on_the_left")},null,8,["description"])]))],64)):(v(),C(U,{key:1},[R.value?(v(),C("div",Zo,[o(ye,{"img-type":"noneWhite",description:l(n)("system.on_the_left")},null,8,["description"])])):(v(),C("div",Qo,[e[14]||(e[14]=s("div",{id:"map-container",class:"map-container"},null,-1)),s("div",et,[o(De),s("span",ot,[s("span",tt,[s("span",null,d(l(n)("system.custom_area")),1),s("span",null,"("+d(l(n)("system.custom_area_tip"))+")",1)]),s("span",{class:"add-btn",onClick:e[3]||(e[3]=i=>ce())},[o(m,null,{default:a(()=>[o(r,{name:"icon_add_outlined"},{default:a(()=>[o(l(te))]),_:1})]),_:1}),s("span",null,d(l(n)("system.add_area")),1)])]),o(Fe,{data:D.value,stripe:"",style:{width:"100%"},height:300},{default:a(()=>[o(Y,{prop:"name",label:l(n)("system.area_name")},{default:a(({row:i,$index:y})=>[s("span",{class:"area-color-symbol",style:co({backgroundColor:O[y%O.length]})},null,4),s("span",null,d(i.name),1)]),_:1},8,["label"]),o(Y,{prop:"scopeName",label:l(n)("system.area_scope")},null,8,["label"]),o(Y,{fixed:"right",label:l(n)("system.operation"),"min-width":"120"},{default:a(({row:i})=>[s("div",at,[s("span",{onClick:y=>ce(i)},[o(m,null,{default:a(()=>[o(r,{name:"icon_edit_outlined"},{default:a(()=>[o(l(po))]),_:1})]),_:1})],8,st),s("span",{onClick:y=>Be(i)},[o(m,null,{default:a(()=>[o(r,{name:"icon_delete-trash_outlined"},{default:a(()=>[o(l(_e))]),_:1})]),_:1})],8,nt)])]),_:1},8,["label"])]),_:1},8,["data"])])]))],64))]),_:1})]),_:1}),o(Eo,{ref_key:"editor",ref:S,onSaved:e[4]||(e[4]=i=>H(!1))},null,512),o(de,{modelValue:T.value,"onUpdate:modelValue":e[8]||(e[8]=i=>T.value=i),class:"create-dialog",title:`${w.id?l(n)("common.edit"):l(n)("common.add")} ${l(n)("system.custom_area")}`,width:"500","destroy-on-close":""},{footer:a(()=>[s("div",lt,[o(j,{onClick:e[6]||(e[6]=i=>T.value=!1)},{default:a(()=>[x(d(l(n)("common.cancel")),1)]),_:1}),o(j,{type:"primary",onClick:e[7]||(e[7]=i=>we())},{default:a(()=>[x(d(l(n)("common.sure")),1)]),_:1})])]),default:a(()=>[o(me,{ref_key:"areaFormRef",ref:ne,model:w,"label-position":"top","label-width":"auto",rules:ie},{default:a(()=>[o(Z,{"label-position":"top",required:"",prop:"name"},{default:a(()=>[o(c,{modelValue:w.name,"onUpdate:modelValue":e[5]||(e[5]=i=>w.name=i),minlenegth:1,maxlength:50},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),o(de,{modelValue:V.value,"onUpdate:modelValue":e[13]||(e[13]=i=>V.value=i),title:`${p.id?l(n)("common.edit"):l(n)("common.add")} ${l(n)("system.custom_area")}`,width:"500","destroy-on-close":""},{footer:a(()=>[s("div",rt,[o(j,{onClick:e[11]||(e[11]=i=>V.value=!1)},{default:a(()=>[x(d(l(n)("common.cancel")),1)]),_:1}),o(j,{type:"primary",onClick:e[12]||(e[12]=i=>Te())},{default:a(()=>[x(d(l(n)("common.sure")),1)]),_:1})])]),default:a(()=>[o(me,{ref_key:"subAreaFormRef",ref:re,model:p,"label-position":"top","label-width":"auto",rules:ie},{default:a(()=>[o(Z,{label:l(n)("system.area_name"),"label-position":"top",prop:"name"},{default:a(()=>[o(c,{modelValue:p.name,"onUpdate:modelValue":e[9]||(e[9]=i=>p.name=i),minlenegth:1,maxlength:50},null,8,["modelValue"])]),_:1},8,["label"]),o(Z,{label:l(n)("system.sub_area_tip"),"label-position":"top",prop:"scopeArr"},{default:a(()=>[o($e,{modelValue:p.scopeArr,"onUpdate:modelValue":e[10]||(e[10]=i=>p.scopeArr=i),multiple:"",style:{width:"100%"},filterable:""},{default:a(()=>[(v(!0),C(U,null,mo(M.value,i=>(v(),ue(Se,{key:i.id,value:i.id,label:i.name},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])],64)}}});const vs=Do(it,[["__scopeId","data-v-c1187a71"]]);export{vs as default};

import{E as b,e as Ae,f as He,i as Ne,K as Ze,r as Ge,z as je,_ as We,M as Fe,a as Ke}from"./element-plus-secondary-0.0.0-dataease.js";import{f as Oe,j as P,e as Xe}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{o as m,c as w,a as c,d as Ye,r as f,l as Je,k as pe,b as Qe,T as L,U as a,W as n,u,X as A,R as v,_ as E,Y as C,aa as et,z as H,$ as tt,S as ot,n as fe,a0 as nt}from"./@vue-0.0.0-dataease.js";import{u as lt,i as at}from"./share-0.0.0-dataease.js";import{d as st}from"./de-copy-0.0.0-dataease.js";import{i as it}from"./icon_refresh_outlined-0.0.0-dataease.js";import{i as rt}from"./icon_edit_outlined-0.0.0-dataease.js";import{i as dt}from"./icon_close_outlined-0.0.0-dataease.js";import{i as ut}from"./icon_done_outlined-0.0.0-dataease.js";import{p as S,f as ct}from"./index-0.0.0-dataease.js";import{s as pt,S as ft,a as mt}from"./ShareTicket-0.0.0-dataease.js";import{u as ht}from"./vue-clipboard3-0.0.0-dataease.js";import _t from"./CustomLinkPwd-0.0.0-dataease.js";import vt from"./TicketDialog-0.0.0-dataease.js";import{_ as wt}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./lodash-es-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./pinia-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./fast-png-0.0.0-dataease.js";import"./iobuffer-0.0.0-dataease.js";import"./pako-0.0.0-dataease.js";import"./vue-router_2-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";import"./dv-info-0.0.0-dataease.js";import"./icon_delete-trash_outlined-0.0.0-dataease.js";import"./icon_add_outlined-0.0.0-dataease.js";import"./GridTable-0.0.0-dataease.js";import"./EmptyBackground-0.0.0-dataease.js";import"./none-0.0.0-dataease.js";import"./nothing-tree-0.0.0-dataease.js";import"./TicketEdit-0.0.0-dataease.js";import"./clipboard-0.0.0-dataease.js";const kt={width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"};function gt(N,U){return m(),w("svg",kt,[...U[0]||(U[0]=[c("path",{d:"M8.66634 4.00065C8.66634 4.25739 8.70262 4.50565 8.77034 4.7406L5.88342 6.4465C5.401 5.96502 4.7351 5.66732 3.99967 5.66732C2.52692 5.66732 1.33301 6.86123 1.33301 8.33398C1.33301 9.80674 2.52692 11.0007 3.99967 11.0007C4.81776 11.0007 5.5498 10.6323 6.03896 10.0523L9.71633 11.8175C9.68353 11.9846 9.66634 12.1573 9.66634 12.334C9.66634 13.8067 10.8602 15.0007 12.333 15.0007C13.8058 15.0007 14.9997 13.8067 14.9997 12.334C14.9997 10.8612 13.8058 9.66732 12.333 9.66732C11.5149 9.66732 10.7829 10.0357 10.2937 10.6156L6.61635 8.8505C6.64915 8.6834 6.66634 8.5107 6.66634 8.33398C6.66634 8.07725 6.63006 7.82898 6.56234 7.59404L9.44926 5.88814C9.93168 6.36961 10.5976 6.66732 11.333 6.66732C12.8058 6.66732 13.9997 5.47341 13.9997 4.00065C13.9997 2.52789 12.8058 1.33398 11.333 1.33398C9.86025 1.33398 8.66634 2.52789 8.66634 4.00065ZM12.6663 4.00065C12.6663 4.73703 12.0694 5.33398 11.333 5.33398C10.5966 5.33398 9.99967 4.73703 9.99967 4.00065C9.99967 3.26427 10.5966 2.66732 11.333 2.66732C12.0694 2.66732 12.6663 3.26427 12.6663 4.00065ZM12.333 13.6673C11.5966 13.6673 10.9997 13.0704 10.9997 12.334C10.9997 11.5976 11.5966 11.0007 12.333 11.0007C13.0694 11.0007 13.6663 11.5976 13.6663 12.334C13.6663 13.0704 13.0694 13.6673 12.333 13.6673ZM5.33301 8.33398C5.33301 9.07036 4.73605 9.66732 3.99967 9.66732C3.26329 9.66732 2.66634 9.07036 2.66634 8.33398C2.66634 7.5976 3.26329 7.00065 3.99967 7.00065C4.73605 7.00065 5.33301 7.5976 5.33301 8.33398Z"},null,-1)])])}const yt={render:gt},bt={class:"share-dialog-container"},Ct={class:"copy-link"},xt={class:"open-share flex-align-center"},It={key:0,class:"custom-link-line"},Vt={class:"share-input-suffix"},Et={key:1,class:"exp-container"},St={class:"checkbox-span"},qt={class:"inline-share-item-picker"},Rt={key:1,class:"exp-error"},Tt={key:2,class:"pwd-container"},Pt={class:"checkbox-span"},Ut={key:0,class:"auto-pwd-container"},Mt={key:1,class:"inline-share-item"},Dt={class:"share-input-suffix"},zt={class:"dialog-footer"},$t={key:0},Bt=Ye({__name:"ShareHandler",props:{inGrid:S.bool.def(!1),disabled:S.bool.def(!1),resourceId:S.string.def(""),resourceType:S.string.def(""),weight:S.number.def(0),isButton:S.bool.def(!1)},emits:["loaded"],setup(N,{expose:U,emit:me}){const he=lt(),J=ct(),{toClipboard:Q}=ht(),{t:l}=Oe(),h=N,ee=f(""),te=f(),Z=f(),M=f(null),G=f(),j=f(),oe=f(null),q=f(!1),R=f(!1),g=f(!1),p=f(!1),ne=f(""),D=f(!1),y=f(!1),x=f(null),T=f(!1),i=Je({detailInfo:{id:"",uuid:"",pwd:"",exp:0,autoPwd:!0,ticketRequire:!1}}),_e=me,ve=pe(()=>`${l("work_branch.open_link_hint")}${h.resourceType==="dashboard"?l("work_branch.dashboard"):l("work_branch.big_data_screen")}`),I=pe(()=>he.getSharePeRequire),we=()=>{y.value=!0,fe(()=>{x!=null&&x.value&&x.value.input.focus()})},W=async()=>{const e=i.detailInfo.uuid,t="link-uuid-error-msg";if(!e)return B(l("commons.cannot_be_null"),x,t),!1;const r=/^[a-zA-Z0-9]{8,16}$/.test(e);if(!r)B(l("work_branch.uuid_checker"),x,t);else{const s=await ke(e);return B(s,x,t),!s}return r},ke=async e=>{const t="/share/editUuid",o={resourceId:h.resourceId,uuid:e};return(await P.post({url:t,data:o})).data},le=async()=>{const e=await W();y.value=!e},ge=e=>{e.stopPropagation(),i.detailInfo.uuid=ee.value,le()},ye=async()=>{if(p.value&&g.value){if(!i.detailInfo.autoPwd&&O("link-pwd-error-msg")){b.warning(l("work_branch.error_password_hint"));return}try{await Q(i.detailInfo.pwd),b.success(l("common.copy_success"))}catch{b.warning(l("common.copy_unsupported"))}}else b.warning(l("common.copy_unsupported"))},be=async()=>{if(p.value)try{if(O("link-uuid-error-msg")){b.warning(l("work_branch.error_link_hint"));return}if(g.value&&!i.detailInfo.autoPwd&&O("link-pwd-error-msg")){b.warning(l("work_branch.error_password_hint"));return}if(I.value&&!K())return;ae();let e=ne.value;g.value&&(e+=`,${i.detailInfo.pwd}`),await Q(e),b.success(l("common.copy_success"))}catch{b.warning(l("common.copy_unsupported"))}else b.warning(l("common.copy_unsupported"));q.value=!1},Ce=e=>e.getTime()<new Date().getTime(),xe=()=>{oe.value=Ke.service({target:".share-dialog-container"})},Ie=()=>{var e;(e=oe.value)==null||e.close()},F=()=>{h.disabled||(q.value=!0,z(K))},z=e=>{xe();const o=`/share/detail/${h.resourceId}`;P.get({url:o}).then(r=>{var s;i.detailInfo={...r.data},(s=r.data)!=null&&s.uuid&&(ee.value=r.data.uuid),Ve()}).finally(()=>{Ie(),e&&e()})},Ve=()=>{i.detailInfo.id&&i.detailInfo.uuid&&(p.value=!0,ae()),g.value=!!i.detailInfo.pwd,R.value=!!i.detailInfo.exp},Ee=()=>{const t=`/share/switcher/${h.resourceId}`;P.post({url:t}).then(()=>{z(null)})},ae=()=>{ne.value=se()+i.detailInfo.uuid},se=()=>{let e="/";return J.baseUrl?e=J.baseUrl+"#":e=window.location.origin+window.location.pathname+"#",(e.includes("oidcbi/")||e.includes("casbi/"))&&(e=e.replace("oidcbi/",""),e=e.replace("casbi/","")),e+mt},Se=e=>{let t=0;if(e){const o=new Date;o.setTime(o.getTime()+3600*1e3),t=o.getTime(),i.detailInfo.exp=t}re(),ie(t)},ie=e=>{if(R.value&&e<new Date().getTime()){D.value=!0;return}D.value=!1;const t=h.resourceId,o="/share/editExp",r={resourceId:t,exp:e};P.post({url:o,data:r}).then(()=>{z(null)})},qe=async e=>{if(!p.value){T.value=!1,e();return}if(I.value&&!K())return;await W()&&(y.value=!1,T.value=!1,e())},K=()=>{if(p.value&&I.value){const e=re(),t=de();return e&&t}return!0},re=()=>!I.value||R.value?($(null,G),!0):($(l("common.required"),G),!1),de=()=>!I.value||g.value?($(null,j),!0):($(l("common.required"),j),!1),$=(e,t,o)=>{if(!t.value)return;o=o||"checkbox-span-require";const r=`.${o}`,s=t.value.$el;if(e){s.style.color="red",s.children[0].children[1].style.borderColor="red";const d=s.children[1].children[0].querySelector(r);if(d)d.innerText=e;else{const k=document.createElement("span");k.className=o,k.innerText=e,s.children[1].children[0].appendChild(k)}}else{s.style=null,s.children[0].children[1].style.borderColor=null;const d=s.children[1].children[0].querySelector(r);d&&s.children[1].children[0].removeChild(d)}},B=(e,t,o)=>{o=o||"link-pwd-error-msg";const r=`.${o}`,s=t||M;if(!s.value)return;const d=s.value.input;if(e){d.style.color="red",d.style.borderColor="red",d.parentElement.style["box-shadow"]="0 0 0 1px red inset";const k=d.parentElement.querySelector(r);if(k)k.innerText=e;else{const V=document.createElement("div");V.className=o,V.innerText=e,d.parentElement.appendChild(V)}}else{d.style=null,d.style.borderColor=null;const k=d.parentElement.querySelector(r);k&&(d.parentElement.style=null,d.parentElement.removeChild(k))}},O=e=>{var t;return(t=document.getElementsByClassName(e))==null?void 0:t.length},Re=e=>{e?(B(null,M),ue()):(i.detailInfo.pwd="",fe(()=>{M.value.input.focus()}))},Te=e=>{let t="";e&&(t=ce()),de(),X(t,!0)},ue=()=>{const e=ce();X(e,!0)},X=(e,t)=>{const o=h.resourceId,r="/share/editPwd",s={resourceId:o,pwd:e,autoPwd:t};P.post({url:r,data:s}).then(()=>{z(null)})},ce=()=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+";let o="";const r="!@#$%^&*()_+";let s=!1;for(let d=0;d<10;d++)d===0?o+=t.charAt(Math.floor(Math.random()*t.length)):!s&&d<10-2?(o+=r.charAt(Math.floor(Math.random()*r.length)),s=!0):o+=t.charAt(Math.floor(Math.random()*t.length));return o=o.split("").sort(()=>.5-Math.random()).join(""),o},Pe=()=>{T.value=!0,Z.value.open()},Ue=()=>{Z.value.close(),T.value=!1},Me=e=>{i.detailInfo.ticketRequire=e},De=()=>{F()},ze=()=>{te.value.open(i.detailInfo.pwd)},$e=e=>{i.detailInfo.pwd=e,X(e,!1)};return U({execute:De}),Qe(()=>{if(!h.inGrid&&h.weight>=7){const e={label:l("visualization.share"),command:"share",svgName:yt};_e("loaded",e)}}),(e,t)=>{const o=Xe,r=Ae,s=He,d=Ne,k=Ze,V=Ge,Y=je,Be=We,Le=Fe;return m(),w(ot,null,[h.weight>=7&&h.inGrid?(m(),L(s,{key:0,effect:"dark",disabled:N.disabled,content:u(l)("visualization.share"),placement:"top"},{default:a(()=>[n(r,{class:"hover-icon hover-icon-in-table share-button-icon",onClick:A(F,["stop"])},{default:a(()=>[n(o,null,{default:a(()=>[n(u(at),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["disabled","content"])):v("",!0),h.weight>=7&&h.isButton?(m(),L(d,{key:1,onClick:A(F,["stop"]),icon:"Share"},{default:a(()=>[E(C(u(l)("visualization.share")),1)]),_:1})):v("",!0),q.value&&h.weight>=7?(m(),L(Le,{key:2,class:H(["copy-link_dialog",{"hidden-footer":!p.value}]),modelValue:q.value,"onUpdate:modelValue":t[7]||(t[7]=_=>q.value=_),"close-on-click-modal":!0,"append-to-body":!0,"before-close":qe,title:u(l)("work_branch.public_link_share"),width:"480px","show-close":!1},{footer:a(()=>[c("span",zt,[n(d,{secondary:"",onClick:Pe},{default:a(()=>[E(C(u(l)("work_branch.ticket_setting")),1)]),_:1}),n(d,{disabled:!p.value||D.value,type:"primary",onClick:A(be,["stop"])},{default:a(()=>[E(C(g.value?u(l)("visualization.copy_link_passwd"):u(l)("visualization.copy_link")),1)]),_:1},8,["disabled"])])]),default:a(()=>[c("div",bt,[c("div",Ct,[c("div",xt,[n(k,{size:"small",modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=_=>p.value=_),onChange:Ee},null,8,["modelValue"]),E(" "+C(ve.value),1)]),p.value?(m(),w("div",It,[n(V,{class:H(y.value?"":"link-input-readlonly"),ref_key:"linkUuidRef",ref:x,placeholder:"",modelValue:i.detailInfo.uuid,"onUpdate:modelValue":t[1]||(t[1]=_=>i.detailInfo.uuid=_),readonly:!y.value,onBlur:W},et({suffix:a(()=>[c("div",Vt,[t[8]||(t[8]=c("span",{class:"suffix-split"},null,-1)),y.value?v("",!0):(m(),w("div",{key:0,class:"input-suffix-btn",onClick:we},[n(s,{class:"item",effect:"dark",content:u(l)("commons.edit")+u(l)("chart.indicator_suffix"),placement:"top"},{default:a(()=>[n(r,{style:{cursor:"pointer"}},{default:a(()=>[n(o,null,{default:a(()=>[n(u(rt),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])])),y.value?(m(),w("div",{key:1,class:"input-suffix-btn",onClick:A(ge,["stop"])},[n(s,{class:"item",effect:"dark",content:u(l)("commons.cancel"),placement:"top"},{default:a(()=>[n(r,{style:{cursor:"pointer"}},{default:a(()=>[n(o,null,{default:a(()=>[n(u(dt),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])])):v("",!0),y.value?(m(),w("div",{key:2,class:"input-suffix-btn done-finish",onClick:le},[n(s,{class:"item",effect:"dark",content:u(l)("commons.save"),placement:"top"},{default:a(()=>[n(r,{style:{cursor:"pointer"}},{default:a(()=>[n(o,null,{default:a(()=>[n(u(ut),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])])):v("",!0)])]),_:2},[y.value?void 0:{name:"prefix",fn:a(()=>[E(C(se()),1)]),key:"0"}]),1032,["class","modelValue","readonly"])])):v("",!0),p.value?(m(),w("div",Et,[n(Y,{ref_key:"expCheckbox",ref:G,disabled:!p.value,modelValue:R.value,"onUpdate:modelValue":t[2]||(t[2]=_=>R.value=_),onChange:Se},{default:a(()=>[c("div",St,[c("span",null,C(u(l)("visualization.over_time")),1),c("span",{class:H(["pe-require",{"pe-tips-hidden":!I.value}])},[...t[9]||(t[9]=[c("span",null,"*",-1)])],2)])]),_:1},8,["disabled","modelValue"]),c("div",qt,[i.detailInfo.exp?(m(),L(Be,{key:0,clearable:!1,class:"share-exp-picker",modelValue:i.detailInfo.exp,"onUpdate:modelValue":t[3]||(t[3]=_=>i.detailInfo.exp=_),type:"datetime",placeholder:"",shortcuts:u(pt),onChange:ie,"disabled-date":Ce,"value-format":"x"},null,8,["modelValue","shortcuts"])):v("",!0),D.value?(m(),w("span",Rt,C(u(l)("work_branch.share_time_limit")),1)):v("",!0)])])):v("",!0),p.value?(m(),w("div",Tt,[n(Y,{ref_key:"pwdCheckbox",ref:j,disabled:!p.value,modelValue:g.value,"onUpdate:modelValue":t[4]||(t[4]=_=>g.value=_),onChange:Te},{default:a(()=>[c("div",Pt,[c("span",null,C(u(l)("visualization.passwd_protect")),1),c("span",{class:H(["pe-require",{"pe-tips-hidden":!I.value}])},[...t[10]||(t[10]=[c("span",null,"*",-1)])],2)])]),_:1},8,["disabled","modelValue"]),g.value?(m(),w("div",Ut,[tt(n(Y,{disabled:!p.value,modelValue:i.detailInfo.autoPwd,"onUpdate:modelValue":t[5]||(t[5]=_=>i.detailInfo.autoPwd=_),onChange:Re,label:u(l)("visualization.auto_pwd")},null,8,["disabled","modelValue","label"]),[[nt,!1]])])):v("",!0),g.value?(m(),w("div",Mt,[n(V,{ref_key:"pwdRef",ref:M,style:{flex:"1"},class:"link-input-readlonly",modelValue:i.detailInfo.pwd,"onUpdate:modelValue":t[6]||(t[6]=_=>i.detailInfo.pwd=_),readonly:""},{suffix:a(()=>[c("div",Dt,[t[11]||(t[11]=c("span",{class:"suffix-split"},null,-1)),c("div",{class:"input-suffix-btn",onClick:ye},[n(s,{class:"item",effect:"dark",content:u(l)("commons.copy"),placement:"top"},{default:a(()=>[n(r,{style:{cursor:"pointer"}},{default:a(()=>[n(o,null,{default:a(()=>[n(u(st),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])]),c("div",{class:"input-suffix-btn",onClick:ue},[n(s,{class:"item",effect:"dark",content:u(l)("commons.reset"),placement:"top"},{default:a(()=>[n(r,{style:{cursor:"pointer"}},{default:a(()=>[n(o,null,{default:a(()=>[n(u(it),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])])])]),_:1},8,["modelValue"]),n(d,{secondary:"",onClick:ze},{default:a(()=>[E(C(u(l)("user.change_password")),1)]),_:1})])):v("",!0)])):v("",!0)])])]),_:1},8,["class","modelValue","title"])):v("",!0),n(_t,{ref_key:"customPwdRef",ref:te,onPwdChange:$e},null,512),n(vt,{ref_key:"ticketDialogRef",ref:Z},{default:a(()=>[p.value&&T.value?(m(),w("div",$t,[n(ft,{uuid:i.detailInfo.uuid,"resource-id":h.resourceId,"ticket-require":i.detailInfo.ticketRequire,onRequireChange:Me,onClose:Ue},null,8,["uuid","resource-id","ticket-require"])])):v("",!0)]),_:1},512)],64)}}});const rn=wt(Bt,[["__scopeId","data-v-18a7e1fa"]]);export{rn as default};

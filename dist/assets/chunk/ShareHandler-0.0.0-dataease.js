import{p as V,c as Ae,aE as He}from"./index-0.0.0-dataease.js";import{E as Ne}from"./el-dialog-0.0.0-dataease.js";import{o as Ze,x as T,D as b,n as Ge,j as je,y as Oe,G as We}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{E as Fe}from"./el-date-picker-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as Xe}from"./el-checkbox-0.0.0-dataease.js";import{E as Je}from"./el-switch-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import{f as m,O as w,P as c,d as Ke,r as f,X as Qe,y as pe,o as Ye,g as L,i as a,j as n,u,a8 as A,_ as v,a3 as S,a4 as C,at as et,S as H,R as tt,W as ot,n as fe,U as nt}from"./vue-0.0.0-dataease.js";import{u as lt,i as at}from"./share-0.0.0-dataease.js";import{d as st}from"./de-copy-0.0.0-dataease.js";import{i as it}from"./icon_refresh_outlined-0.0.0-dataease.js";import{i as rt}from"./icon_edit_outlined-0.0.0-dataease.js";import{i as dt}from"./icon_close_outlined-0.0.0-dataease.js";import{i as ut}from"./icon_done_outlined-0.0.0-dataease.js";import{s as ct,S as pt,a as ft}from"./ShareTicket-0.0.0-dataease.js";import{u as mt}from"./index-0.0.0-dataease19.js";import ht from"./CustomLinkPwd-0.0.0-dataease.js";import _t from"./TicketDialog-0.0.0-dataease.js";import{E as vt}from"./index-0.0.0-dataease4.js";import{_ as wt}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./index-0.0.0-dataease3.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./dayjs.min-0.0.0-dataease.js";import"./arrays-0.0.0-dataease.js";import"./index-0.0.0-dataease18.js";import"./index-0.0.0-dataease5.js";import"./el-table-0.0.0-dataease.js";import"./raf-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./dv-info-0.0.0-dataease.js";import"./icon_delete-trash_outlined-0.0.0-dataease.js";import"./icon_add_outlined-0.0.0-dataease.js";import"./GridTable-0.0.0-dataease.js";import"./el-pagination-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import"./index-0.0.0-dataease6.js";import"./token-0.0.0-dataease.js";import"./strings-0.0.0-dataease.js";import"./EmptyBackground-0.0.0-dataease.js";import"./el-empty-0.0.0-dataease.js";import"./none-0.0.0-dataease.js";import"./nothing-tree-0.0.0-dataease.js";import"./TicketEdit-0.0.0-dataease.js";import"./el-drawer-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import"./el-form-item-0.0.0-dataease.js";import"./el-input-number-0.0.0-dataease.js";import"./index-0.0.0-dataease20.js";const kt={width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"};function yt(N,U){return m(),w("svg",kt,[...U[0]||(U[0]=[c("path",{d:"M8.66634 4.00065C8.66634 4.25739 8.70262 4.50565 8.77034 4.7406L5.88342 6.4465C5.401 5.96502 4.7351 5.66732 3.99967 5.66732C2.52692 5.66732 1.33301 6.86123 1.33301 8.33398C1.33301 9.80674 2.52692 11.0007 3.99967 11.0007C4.81776 11.0007 5.5498 10.6323 6.03896 10.0523L9.71633 11.8175C9.68353 11.9846 9.66634 12.1573 9.66634 12.334C9.66634 13.8067 10.8602 15.0007 12.333 15.0007C13.8058 15.0007 14.9997 13.8067 14.9997 12.334C14.9997 10.8612 13.8058 9.66732 12.333 9.66732C11.5149 9.66732 10.7829 10.0357 10.2937 10.6156L6.61635 8.8505C6.64915 8.6834 6.66634 8.5107 6.66634 8.33398C6.66634 8.07725 6.63006 7.82898 6.56234 7.59404L9.44926 5.88814C9.93168 6.36961 10.5976 6.66732 11.333 6.66732C12.8058 6.66732 13.9997 5.47341 13.9997 4.00065C13.9997 2.52789 12.8058 1.33398 11.333 1.33398C9.86025 1.33398 8.66634 2.52789 8.66634 4.00065ZM12.6663 4.00065C12.6663 4.73703 12.0694 5.33398 11.333 5.33398C10.5966 5.33398 9.99967 4.73703 9.99967 4.00065C9.99967 3.26427 10.5966 2.66732 11.333 2.66732C12.0694 2.66732 12.6663 3.26427 12.6663 4.00065ZM12.333 13.6673C11.5966 13.6673 10.9997 13.0704 10.9997 12.334C10.9997 11.5976 11.5966 11.0007 12.333 11.0007C13.0694 11.0007 13.6663 11.5976 13.6663 12.334C13.6663 13.0704 13.0694 13.6673 12.333 13.6673ZM5.33301 8.33398C5.33301 9.07036 4.73605 9.66732 3.99967 9.66732C3.26329 9.66732 2.66634 9.07036 2.66634 8.33398C2.66634 7.5976 3.26329 7.00065 3.99967 7.00065C4.73605 7.00065 5.33301 7.5976 5.33301 8.33398Z"},null,-1)])])}const gt={render:yt},bt={class:"share-dialog-container"},Ct={class:"copy-link"},xt={class:"open-share flex-align-center"},It={key:0,class:"custom-link-line"},Et={class:"share-input-suffix"},Vt={key:1,class:"exp-container"},St={class:"checkbox-span"},qt={class:"inline-share-item-picker"},Rt={key:1,class:"exp-error"},Pt={key:2,class:"pwd-container"},Tt={class:"checkbox-span"},Ut={key:0,class:"auto-pwd-container"},Dt={key:1,class:"inline-share-item"},Mt={class:"share-input-suffix"},Bt={class:"dialog-footer"},$t={key:0},zt=Ke({__name:"ShareHandler",props:{inGrid:V.bool.def(!1),disabled:V.bool.def(!1),resourceId:V.string.def(""),resourceType:V.string.def(""),weight:V.number.def(0),isButton:V.bool.def(!1)},emits:["loaded"],setup(N,{expose:U,emit:me}){const he=lt(),Q=Ae(),{toClipboard:Y}=mt(),{t:l}=Ze(),h=N,ee=f(""),te=f(),Z=f(),D=f(null),G=f(),j=f(),oe=f(null),q=f(!1),R=f(!1),y=f(!1),p=f(!1),ne=f(""),M=f(!1),g=f(!1),x=f(null),P=f(!1),i=Qe({detailInfo:{id:"",uuid:"",pwd:"",exp:0,autoPwd:!0,ticketRequire:!1}}),_e=me,ve=pe(()=>`${l("work_branch.open_link_hint")}${h.resourceType==="dashboard"?l("work_branch.dashboard"):l("work_branch.big_data_screen")}`),I=pe(()=>he.getSharePeRequire),we=()=>{g.value=!0,fe(()=>{x!=null&&x.value&&x.value.input.focus()})},O=async()=>{const e=i.detailInfo.uuid,t="link-uuid-error-msg";if(!e)return z(l("commons.cannot_be_null"),x,t),!1;const r=/^[a-zA-Z0-9]{8,16}$/.test(e);if(!r)z(l("work_branch.uuid_checker"),x,t);else{const s=await ke(e);return z(s,x,t),!s}return r},ke=async e=>{const t="/share/editUuid",o={resourceId:h.resourceId,uuid:e};return(await T.post({url:t,data:o})).data},le=async()=>{const e=await O();g.value=!e},ye=e=>{e.stopPropagation(),i.detailInfo.uuid=ee.value,le()},ge=async()=>{if(p.value&&y.value){if(!i.detailInfo.autoPwd&&X("link-pwd-error-msg")){b.warning(l("work_branch.error_password_hint"));return}try{await Y(i.detailInfo.pwd),b.success(l("common.copy_success"))}catch{b.warning(l("common.copy_unsupported"))}}else b.warning(l("common.copy_unsupported"))},be=async()=>{if(p.value)try{if(X("link-uuid-error-msg")){b.warning(l("work_branch.error_link_hint"));return}if(y.value&&!i.detailInfo.autoPwd&&X("link-pwd-error-msg")){b.warning(l("work_branch.error_password_hint"));return}if(I.value&&!F())return;ae();let e=ne.value;y.value&&(e+=`,${i.detailInfo.pwd}`),await Y(e),b.success(l("common.copy_success"))}catch{b.warning(l("common.copy_unsupported"))}else b.warning(l("common.copy_unsupported"));q.value=!1},Ce=e=>e.getTime()<new Date().getTime(),xe=()=>{oe.value=He.service({target:".share-dialog-container"})},Ie=()=>{var e;(e=oe.value)==null||e.close()},W=()=>{h.disabled||(q.value=!0,B(F))},B=e=>{xe();const o=`/share/detail/${h.resourceId}`;T.get({url:o}).then(r=>{var s;i.detailInfo={...r.data},(s=r.data)!=null&&s.uuid&&(ee.value=r.data.uuid),Ee()}).finally(()=>{Ie(),e&&e()})},Ee=()=>{i.detailInfo.id&&i.detailInfo.uuid&&(p.value=!0,ae()),y.value=!!i.detailInfo.pwd,R.value=!!i.detailInfo.exp},Ve=()=>{const t=`/share/switcher/${h.resourceId}`;T.post({url:t}).then(()=>{B(null)})},ae=()=>{ne.value=se()+i.detailInfo.uuid},se=()=>{let e="/";return Q.baseUrl?e=Q.baseUrl+"#":e=window.location.origin+window.location.pathname+"#",(e.includes("oidcbi/")||e.includes("casbi/"))&&(e=e.replace("oidcbi/",""),e=e.replace("casbi/","")),e+ft},Se=e=>{let t=0;if(e){const o=new Date;o.setTime(o.getTime()+3600*1e3),t=o.getTime(),i.detailInfo.exp=t}re(),ie(t)},ie=e=>{if(R.value&&e<new Date().getTime()){M.value=!0;return}M.value=!1;const t=h.resourceId,o="/share/editExp",r={resourceId:t,exp:e};T.post({url:o,data:r}).then(()=>{B(null)})},qe=async e=>{if(!p.value){P.value=!1,e();return}if(I.value&&!F())return;await O()&&(g.value=!1,P.value=!1,e())},F=()=>{if(p.value&&I.value){const e=re(),t=de();return e&&t}return!0},re=()=>!I.value||R.value?($(null,G),!0):($(l("common.required"),G),!1),de=()=>!I.value||y.value?($(null,j),!0):($(l("common.required"),j),!1),$=(e,t,o)=>{if(!t.value)return;o=o||"checkbox-span-require";const r=`.${o}`,s=t.value.$el;if(e){s.style.color="red",s.children[0].children[1].style.borderColor="red";const d=s.children[1].children[0].querySelector(r);if(d)d.innerText=e;else{const k=document.createElement("span");k.className=o,k.innerText=e,s.children[1].children[0].appendChild(k)}}else{s.style=null,s.children[0].children[1].style.borderColor=null;const d=s.children[1].children[0].querySelector(r);d&&s.children[1].children[0].removeChild(d)}},z=(e,t,o)=>{o=o||"link-pwd-error-msg";const r=`.${o}`,s=t||D;if(!s.value)return;const d=s.value.input;if(e){d.style.color="red",d.style.borderColor="red",d.parentElement.style["box-shadow"]="0 0 0 1px red inset";const k=d.parentElement.querySelector(r);if(k)k.innerText=e;else{const E=document.createElement("div");E.className=o,E.innerText=e,d.parentElement.appendChild(E)}}else{d.style=null,d.style.borderColor=null;const k=d.parentElement.querySelector(r);k&&(d.parentElement.style=null,d.parentElement.removeChild(k))}},X=e=>{var t;return(t=document.getElementsByClassName(e))==null?void 0:t.length},Re=e=>{e?(z(null,D),ue()):(i.detailInfo.pwd="",fe(()=>{D.value.input.focus()}))},Pe=e=>{let t="";e&&(t=ce()),de(),J(t,!0)},ue=()=>{const e=ce();J(e,!0)},J=(e,t)=>{const o=h.resourceId,r="/share/editPwd",s={resourceId:o,pwd:e,autoPwd:t};T.post({url:r,data:s}).then(()=>{B(null)})},ce=()=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+";let o="";const r="!@#$%^&*()_+";let s=!1;for(let d=0;d<10;d++)d===0?o+=t.charAt(Math.floor(Math.random()*t.length)):!s&&d<10-2?(o+=r.charAt(Math.floor(Math.random()*r.length)),s=!0):o+=t.charAt(Math.floor(Math.random()*t.length));return o=o.split("").sort(()=>.5-Math.random()).join(""),o},Te=()=>{P.value=!0,Z.value.open()},Ue=()=>{Z.value.close(),P.value=!1},De=e=>{i.detailInfo.ticketRequire=e},Me=()=>{W()},Be=()=>{te.value.open(i.detailInfo.pwd)},$e=e=>{i.detailInfo.pwd=e,J(e,!1)};return U({execute:Me}),Ye(()=>{if(!h.inGrid&&h.weight>=7){const e={label:l("visualization.share"),command:"share",svgName:gt};_e("loaded",e)}}),(e,t)=>{const o=Ge,r=je,s=vt,d=Oe,k=Je,E=We,K=Xe,ze=Fe,Le=Ne;return m(),w(ot,null,[h.weight>=7&&h.inGrid?(m(),L(s,{key:0,effect:"dark",disabled:N.disabled,content:u(l)("visualization.share"),placement:"top"},{default:a(()=>[n(r,{class:"hover-icon hover-icon-in-table share-button-icon",onClick:A(W,["stop"])},{default:a(()=>[n(o,null,{default:a(()=>[n(u(at),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["disabled","content"])):v("",!0),h.weight>=7&&h.isButton?(m(),L(d,{key:1,onClick:A(W,["stop"]),icon:"Share"},{default:a(()=>[S(C(u(l)("visualization.share")),1)]),_:1})):v("",!0),q.value&&h.weight>=7?(m(),L(Le,{key:2,class:H(["copy-link_dialog",{"hidden-footer":!p.value}]),modelValue:q.value,"onUpdate:modelValue":t[7]||(t[7]=_=>q.value=_),"close-on-click-modal":!0,"append-to-body":!0,"before-close":qe,title:u(l)("work_branch.public_link_share"),width:"480px","show-close":!1},{footer:a(()=>[c("span",Bt,[n(d,{secondary:"",onClick:Te},{default:a(()=>[S(C(u(l)("work_branch.ticket_setting")),1)]),_:1}),n(d,{disabled:!p.value||M.value,type:"primary",onClick:A(be,["stop"])},{default:a(()=>[S(C(y.value?u(l)("visualization.copy_link_passwd"):u(l)("visualization.copy_link")),1)]),_:1},8,["disabled"])])]),default:a(()=>[c("div",bt,[c("div",Ct,[c("div",xt,[n(k,{size:"small",modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=_=>p.value=_),onChange:Ve},null,8,["modelValue"]),S(" "+C(ve.value),1)]),p.value?(m(),w("div",It,[n(E,{class:H(g.value?"":"link-input-readlonly"),ref_key:"linkUuidRef",ref:x,placeholder:"",modelValue:i.detailInfo.uuid,"onUpdate:modelValue":t[1]||(t[1]=_=>i.detailInfo.uuid=_),readonly:!g.value,onBlur:O},et({suffix:a(()=>[c("div",Et,[t[8]||(t[8]=c("span",{class:"suffix-split"},null,-1)),g.value?v("",!0):(m(),w("div",{key:0,class:"input-suffix-btn",onClick:we},[n(s,{class:"item",effect:"dark",content:u(l)("commons.edit")+u(l)("chart.indicator_suffix"),placement:"top"},{default:a(()=>[n(r,{style:{cursor:"pointer"}},{default:a(()=>[n(o,null,{default:a(()=>[n(u(rt),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])])),g.value?(m(),w("div",{key:1,class:"input-suffix-btn",onClick:A(ye,["stop"])},[n(s,{class:"item",effect:"dark",content:u(l)("commons.cancel"),placement:"top"},{default:a(()=>[n(r,{style:{cursor:"pointer"}},{default:a(()=>[n(o,null,{default:a(()=>[n(u(dt),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])])):v("",!0),g.value?(m(),w("div",{key:2,class:"input-suffix-btn done-finish",onClick:le},[n(s,{class:"item",effect:"dark",content:u(l)("commons.save"),placement:"top"},{default:a(()=>[n(r,{style:{cursor:"pointer"}},{default:a(()=>[n(o,null,{default:a(()=>[n(u(ut),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])])):v("",!0)])]),_:2},[g.value?void 0:{name:"prefix",fn:a(()=>[S(C(se()),1)]),key:"0"}]),1032,["class","modelValue","readonly"])])):v("",!0),p.value?(m(),w("div",Vt,[n(K,{ref_key:"expCheckbox",ref:G,disabled:!p.value,modelValue:R.value,"onUpdate:modelValue":t[2]||(t[2]=_=>R.value=_),onChange:Se},{default:a(()=>[c("div",St,[c("span",null,C(u(l)("visualization.over_time")),1),c("span",{class:H(["pe-require",{"pe-tips-hidden":!I.value}])},[...t[9]||(t[9]=[c("span",null,"*",-1)])],2)])]),_:1},8,["disabled","modelValue"]),c("div",qt,[i.detailInfo.exp?(m(),L(ze,{key:0,clearable:!1,class:"share-exp-picker",modelValue:i.detailInfo.exp,"onUpdate:modelValue":t[3]||(t[3]=_=>i.detailInfo.exp=_),type:"datetime",placeholder:"",shortcuts:u(ct),onChange:ie,"disabled-date":Ce,"value-format":"x"},null,8,["modelValue","shortcuts"])):v("",!0),M.value?(m(),w("span",Rt,C(u(l)("work_branch.share_time_limit")),1)):v("",!0)])])):v("",!0),p.value?(m(),w("div",Pt,[n(K,{ref_key:"pwdCheckbox",ref:j,disabled:!p.value,modelValue:y.value,"onUpdate:modelValue":t[4]||(t[4]=_=>y.value=_),onChange:Pe},{default:a(()=>[c("div",Tt,[c("span",null,C(u(l)("visualization.passwd_protect")),1),c("span",{class:H(["pe-require",{"pe-tips-hidden":!I.value}])},[...t[10]||(t[10]=[c("span",null,"*",-1)])],2)])]),_:1},8,["disabled","modelValue"]),y.value?(m(),w("div",Ut,[tt(n(K,{disabled:!p.value,modelValue:i.detailInfo.autoPwd,"onUpdate:modelValue":t[5]||(t[5]=_=>i.detailInfo.autoPwd=_),onChange:Re,label:u(l)("visualization.auto_pwd")},null,8,["disabled","modelValue","label"]),[[nt,!1]])])):v("",!0),y.value?(m(),w("div",Dt,[n(E,{ref_key:"pwdRef",ref:D,style:{flex:"1"},class:"link-input-readlonly",modelValue:i.detailInfo.pwd,"onUpdate:modelValue":t[6]||(t[6]=_=>i.detailInfo.pwd=_),readonly:""},{suffix:a(()=>[c("div",Mt,[t[11]||(t[11]=c("span",{class:"suffix-split"},null,-1)),c("div",{class:"input-suffix-btn",onClick:ge},[n(s,{class:"item",effect:"dark",content:u(l)("commons.copy"),placement:"top"},{default:a(()=>[n(r,{style:{cursor:"pointer"}},{default:a(()=>[n(o,null,{default:a(()=>[n(u(st),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])]),c("div",{class:"input-suffix-btn",onClick:ue},[n(s,{class:"item",effect:"dark",content:u(l)("commons.reset"),placement:"top"},{default:a(()=>[n(r,{style:{cursor:"pointer"}},{default:a(()=>[n(o,null,{default:a(()=>[n(u(it),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])])])]),_:1},8,["modelValue"]),n(d,{secondary:"",onClick:Be},{default:a(()=>[S(C(u(l)("user.change_password")),1)]),_:1})])):v("",!0)])):v("",!0)])])]),_:1},8,["class","modelValue","title"])):v("",!0),n(ht,{ref_key:"customPwdRef",ref:te,onPwdChange:$e},null,512),n(_t,{ref_key:"ticketDialogRef",ref:Z},{default:a(()=>[p.value&&P.value?(m(),w("div",$t,[n(pt,{uuid:i.detailInfo.uuid,"resource-id":h.resourceId,"ticket-require":i.detailInfo.ticketRequire,onRequireChange:De,onClose:Ue},null,8,["uuid","resource-id","ticket-require"])])):v("",!0)]),_:1},512)],64)}}});const Ho=wt(zt,[["__scopeId","data-v-18a7e1fa"]]);export{Ho as default};

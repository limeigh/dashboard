import{m as g}from"./mitt-0.0.0-dataease.js";import{e as y}from"./@vue-0.0.0-dataease.js";import{W as b}from"./web-storage-cache-0.0.0-dataease.js";import{E as P,a as w,b as v}from"./element-plus-secondary-0.0.0-dataease.js";import{U as T,j as x}from"./vue-types-0.0.0-dataease.js";import{c as k,d as E}from"./pinia-0.0.0-dataease.js";import{E as S}from"./@element-plus-0.0.0-dataease.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function s(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=s(r);fetch(r.href,o)}})();const l=g(),Y=e=>(e&&(l.on(e.name,e.callback),y(()=>{l.off(e.name,e.callback)})),{emitter:l}),h=k(),Z=e=>{e.use(h)},C=(e="localStorage")=>({wsCache:new b({storage:e})}),O=(e,t)=>new Promise(function(s,n){var a;const r=t||"de-fit2cloud-script-id";let o=document.getElementById(r);o&&((a=o.parentElement)==null||a.removeChild(o),o=null);const i=document.createElement("script");i.id=r,i.onload=function(){return s(null)},i.onerror=function(){return n(new Error("Load script from ".concat(e," failed")))},i.src=e;const c=document.head||document.getElementsByTagName("head")[0];(document.body||c).appendChild(i)}),{wsCache:f}=C();function D(e){if(e==null)return e;if(typeof e=="object"){const t=Array.isArray(e)?[]:{};for(const s in e)e[s]===null||e[s]===void 0?t[s]=e[s]:e[s]instanceof Date?t[s]=new Date(e[s]):typeof e[s]=="object"?t[s]=D(e[s]):t[s]=e[s];return t}return e}function K(e,t,s){const n=e[t];e[t]=e[s],e[s]=n}function ee(e){return document.querySelector(e)}function te(e){return document.querySelector(e)}const A=["VText","RectShape","CircleShape"];function se(e){return!A.includes(e)&&!e.startsWith("SVG")}function re(e){return e&&(/^(http(s)?:\/\/)/.test(e.toLowerCase())?e:"http://"+e)}const ne=(e,t,s,n)=>{if(s=s||"name",n=n||"colorName",!t){e[n]=null;return}const r=e[s],o=r.indexOf(t);if(o>-1){const i=r.substring(0,o)+'<span class="search-key-span">'+t+"</span>"+r.substring(o+t.length,r.length);e[n]=i;return}e[n]=null},d=e=>{const t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),s=window.location.search.substr(1).match(t);return s!=null?unescape(s[2]):null},N=()=>!!d("state")&&!!d("code"),F=()=>{var e;return!!d("client")||((e=d("state"))==null?void 0:e.includes("client"))},oe=()=>{const e=["/casbi","oidcbi"],t=window.location.pathname;return!e.some(s=>t.includes(s))&&!N()&&!F()?B():!0},B=()=>{const e="out_auth_platform";return f.delete(e),!1},U=()=>{try{return window.top!==window.self}catch(e){return console.error(e),!0}},ie=e=>!e||e==="0"?!0:e==="1"?!1:!U();function ae(){return navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)&&!m()}function ce(){return navigator.userAgent.match(/(iPhone|iPad|iPod)/i)&&!m()}const L=window.navigator.userAgent.toLowerCase().includes("dingtalk"),de=e=>{var r,o;if(!L){document.title=e||"DataEase";return}const t="https://g.alicdn.com/dingding/dingtalk-jsapi/3.0.25/dingtalk.open.js",s="fit2cloud-dataease-v2-platform-client-dingtalk";if(window.dd&&((o=(r=window.dd.biz)==null?void 0:r.navigation)!=null&&o.setTitle)){window.dd.biz.navigation.setTitle({title:e});return}O(t,s).then(()=>{window.dd.ready(()=>{window.dd.biz.navigation.setTitle({title:e})})}).catch(()=>{document.title=e||"DataEase"})};function m(){const e=navigator.userAgent;return/iPad|Silk|Galaxy Tab|PlayBook|BlackBerry|(tablet|ipad|playbook)/i.test(e)}function j(e,t){e.forEach((s,n)=>{if(s.id===t){e.splice(n,1);return}else s.children&&j(s.children,t)})}const ue=()=>window.location.hash.startsWith("#/de-link/"),le=e=>typeof e>"u"||e===null||e==="null",fe=(e,t)=>{const s=[0,0,0];if(!e||e===1)return s;if(e===9)return[1,1,1];if(!t)return s;const n=M(t)||[];for(let r=0;r<n.length;r++)s[r]=n[r];return s},M=e=>{var n;if(!e)return null;const t=e.toString().split("").reverse().join("");return((n=t==null?void 0:t.split(""))==null?void 0:n.map(Number))??[]},he=()=>"en",me=(e,t)=>{const s=f.get(p("user.oid"));if(!s)return!1;const n=(Number(s)+t).toString();let r=e;for(;r;){if(r.data.id===n)return!0;r=r.parent}return!1},pe=(e,t)=>{const n=["dashboard","dataV","dataset","datasource"].findIndex(c=>c===t),r=f.get(p("user.oid"));if(!r||n<0)return;const o=(Number(r)+n+1).toString();let i=e.length;for(;i--;){const c=e[i];if(c.id===o){e.splice(i,1);return}if(c.id==="0"){const a=c.children;let u=a==null?void 0:a.length;for(;u--;)if(a[u].id===o){a.splice(u,1);return}}}},Ie=(e,t="名称字段长度1-64个字符")=>{if(e.name&&(e.name=e.name.trim(),e.name.length<1||e.name.length>64))throw P.warning(t),new Error(t)},ge=e=>{const t=["最近使用"];return e&&e.forEach(s=>{s.showFlag&&s.categories.forEach(n=>{t.push(n.name)})}),new Set(t)},p=e=>`dataease2-${e}`,I=e=>typeof e!="string"?!1:(e=e.replace(/\s/g,"").replace(/\n|\r/,""),/^\{(.*?)\}$/.test(e)?/"(.*?)":(.*?)/g.test(e):/^\[(.*?)\]$/.test(e)?e.replace(/^\[/,"").replace(/\]$/,"").replace(/},{/g,`}
{`).split(/\n/).map(t=>I(t)).reduce((t,s)=>!!s):!1),ye=()=>{let e=null;const t=window.location.href.lastIndexOf("?");if(t>0){const s={};return e=window.location.href.substring(t+1,window.location.href.length),e=e.split("&"),e.forEach(n=>{const r=n.split("="),o=r[0];let i=decodeURIComponent(r[1]);I(i)&&(i=JSON.parse(i)),s[o]=i}),s}},R=T({func:void 0,bool:void 0,string:void 0,number:void 0,object:void 0,integer:void 0});class be extends R{style(){return x("style",{type:[String,Object],default:void 0})}}const $=E("embedded",{state:()=>({type:"",token:"",busiFlag:"",outerParams:"",suffixId:"",baseUrl:"",dvId:"",pid:"",chartId:"",resourceId:"",dfId:"",opt:"",createType:"",templateParams:"",outerUrl:"",jumpInfoParam:"",datasourceId:"",tableName:"",datasetId:"",datasetCopyId:"",datasetPid:"",tokenInfo:new Map}),getters:{getType(){return this.type},getJumpInfoParam(){return this.jumpInfoParam},getOuterUrl(){return this.outerUrl},getCreateType(){return this.createType},getTemplateParams(){return this.templateParams},getToken(){return this.token},getBusiFlag(){return this.busiFlag},getOuterParams(){return this.outerParams},getSuffixId(){return this.suffixId},getBaseUrl(){return this.baseUrl},getDvId(){return this.dvId},getPid(){return this.pid},getChartId(){return this.chartId},getResourceId(){return this.resourceId},getDfId(){return this.dfId},getOpt(){return this.opt},getTokenInfo(){return this.tokenInfo},getIframeData(){return{embeddedToken:this.token,busiFlag:this.busiFlag,outerParams:this.outerParams,suffixId:this.suffixId,type:this.type,dvId:this.dvId,chartId:this.chartId,pid:this.pid,resourceId:this.resourceId,dfId:this.dfId}}},actions:{setType(e){this.type=e},setdatasetPid(e){this.datasetPid=e},setDatasourceId(e){this.datasourceId=e},setTableName(e){this.tableName=e},setDatasetId(e){this.datasetId=e},setDatasetCopyId(e){this.datasetCopyId=e},setOuterUrl(e){this.outerUrl=e},setJumpInfoParam(e){this.jumpInfoParam=e},setCreateType(e){this.createType=e},setTemplateParams(e){this.templateParams=e},setToken(e){this.token=e},setBusiFlag(e){this.busiFlag=e},setOuterParams(e){this.outerParams=e},setSuffixId(e){this.suffixId=e},setBaseUrl(e){this.baseUrl=e},setDvId(e){this.dvId=e},setPid(e){this.pid=e},setChartId(e){this.chartId=e},setResourceId(e){this.resourceId=e},setDfId(e){this.dfId=e},setOpt(e){this.opt=e},async setIframeData(e){this.type=e.type,this.token=e.embeddedToken,this.busiFlag=e.busiFlag,this.outerParams=e.outerParams,this.suffixId=e.suffixId,this.dvId=e.dvId,this.chartId=e.chartId,this.pid=e.pid,this.resourceId=e.resourceId,this.dfId=e.dfId},async setTokenInfo(e){this.tokenInfo=e},clearState(){this.setPid(""),this.setOpt(""),this.setCreateType(""),this.setTemplateParams(""),this.setResourceId(""),this.setDfId(""),this.setDvId(""),this.setJumpInfoParam(""),this.setOuterUrl(""),this.setDatasourceId(""),this.setTableName(""),this.setDatasetId(""),this.setDatasetCopyId(""),this.setdatasetPid("")}}}),Pe=()=>$(h),J=[w],W=[v],we=e=>{J.forEach(t=>{e.use(t)}),W.forEach(t=>{e.component(t.name,t)})},ve=e=>{for(const[t,s]of Object.entries(S))e.component(t,s)};export{te as $,se as A,ce as B,re as C,pe as D,j as E,U as F,ne as G,ee as _,C as a,ye as b,oe as c,F as d,N as e,Pe as f,p as g,we as h,ae as i,ve as j,B as k,D as l,fe as m,me as n,h as o,be as p,le as q,ue as r,Z as s,he as t,Y as u,ie as v,de as w,Ie as x,ge as y,K as z};

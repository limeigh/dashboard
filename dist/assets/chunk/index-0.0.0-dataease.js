import{m as g}from"./mitt-0.0.0-dataease.js";import{e as I}from"./@vue-0.0.0-dataease.js";import{W as y}from"./web-storage-cache-0.0.0-dataease.js";import{E as b,a as P,b as w}from"./element-plus-secondary-0.0.0-dataease.js";import{U as v,j as T}from"./vue-types-0.0.0-dataease.js";import{c as C,d as x}from"./pinia-0.0.0-dataease.js";import{E}from"./@element-plus-0.0.0-dataease.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function s(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=s(r);fetch(r.href,o)}})();const f=g(),Y=e=>(e&&(f.on(e.name,e.callback),I(()=>{f.off(e.name,e.callback)})),{emitter:f}),m=C(),Z=e=>{e.use(m)},S=(e="localStorage")=>({wsCache:new y({storage:e})}),k=(e,t)=>new Promise(function(s,n){var a;const r=t||"de-fit2cloud-script-id";let o=document.getElementById(r);o&&((a=o.parentElement)==null||a.removeChild(o),o=null);const i=document.createElement("script");i.id=r,i.onload=function(){return s(null)},i.onerror=function(){return n(new Error("Load script from ".concat(e," failed")))},i.src=e;const d=document.head||document.getElementsByTagName("head")[0];(document.body||d).appendChild(i)}),{wsCache:u}=S();function N(e){if(e==null)return e;if(typeof e=="object"){const t=Array.isArray(e)?[]:{};for(const s in e)e[s]===null||e[s]===void 0?t[s]=e[s]:e[s]instanceof Date?t[s]=new Date(e[s]):typeof e[s]=="object"?t[s]=N(e[s]):t[s]=e[s];return t}return e}function K(e,t,s){const n=e[t];e[t]=e[s],e[s]=n}function ee(e){return document.querySelector(e)}function te(e){return document.querySelector(e)}const D=["VText","RectShape","CircleShape"];function se(e){return!D.includes(e)&&!e.startsWith("SVG")}function re(e){return e&&(/^(http(s)?:\/\/)/.test(e.toLowerCase())?e:"http://"+e)}const ne=(e,t,s,n)=>{if(s=s||"name",n=n||"colorName",!t){e[n]=null;return}const r=e[s],o=r.indexOf(t);if(o>-1){const i=r.substring(0,o)+'<span class="search-key-span">'+t+"</span>"+r.substring(o+t.length,r.length);e[n]=i;return}e[n]=null},c=e=>{const t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),s=window.location.search.substr(1).match(t);return s!=null?unescape(s[2]):null},O=()=>!!c("state")&&!!c("code"),A=()=>{var e;return!!c("client")||((e=c("state"))==null?void 0:e.includes("client"))},oe=()=>{const e=["/casbi","oidcbi"],t=window.location.pathname;return!e.some(s=>t.includes(s))&&!O()&&!A()?B():!0},B=()=>{const e="out_auth_platform";return u.delete(e),!1},F=()=>{try{return window.top!==window.self}catch(e){return console.error(e),!0}},ie=e=>!e||e==="0"?!0:e==="1"?!1:!F();function ae(){return navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)&&!p()}function de(){return navigator.userAgent.match(/(iPhone|iPad|iPod)/i)&&!p()}const L=window.navigator.userAgent.toLowerCase().includes("dingtalk"),ce=e=>{var r,o;if(!L){document.title=e||"DataEase";return}const t="https://g.alicdn.com/dingding/dingtalk-jsapi/3.0.25/dingtalk.open.js",s="fit2cloud-dataease-v2-platform-client-dingtalk";if(window.dd&&((o=(r=window.dd.biz)==null?void 0:r.navigation)!=null&&o.setTitle)){window.dd.biz.navigation.setTitle({title:e});return}k(t,s).then(()=>{window.dd.ready(()=>{window.dd.biz.navigation.setTitle({title:e})})}).catch(()=>{document.title=e||"DataEase"})};function p(){const e=navigator.userAgent;return/iPad|Silk|Galaxy Tab|PlayBook|BlackBerry|(tablet|ipad|playbook)/i.test(e)}function U(e,t){e.forEach((s,n)=>{if(s.id===t){e.splice(n,1);return}else s.children&&U(s.children,t)})}const ue=()=>window.location.hash.startsWith("#/de-link/"),le=e=>typeof e>"u"||e===null||e==="null",fe=(e,t)=>{const s=[0,0,0];if(!e||e===1)return s;if(e===9)return[1,1,1];if(!t)return s;const n=j(t)||[];for(let r=0;r<n.length;r++)s[r]=n[r];return s},j=e=>{var n;if(!e)return null;const t=e.toString().split("").reverse().join("");return((n=t==null?void 0:t.split(""))==null?void 0:n.map(Number))??[]},z=()=>{const e=navigator.language;if(!e)return"zh-CN";if(e.startsWith("en"))return"en";if(e.toLowerCase().startsWith("zh")){const t=e.toLowerCase().replace("_","-");return t==="zh"||t==="zh-cn"?"zh-CN":"tw"}return e},he=()=>u.get(h("user.language"))||z()||"zh-CN",me=(e,t)=>{const s=u.get(h("user.oid"));if(!s)return!1;const n=(Number(s)+t).toString();let r=e;for(;r;){if(r.data.id===n)return!0;r=r.parent}return!1},pe=(e,t)=>{const n=["dashboard","dataV","dataset","datasource"].findIndex(d=>d===t),r=u.get(h("user.oid"));if(!r||n<0)return;const o=(Number(r)+n+1).toString();let i=e.length;for(;i--;){const d=e[i];if(d.id===o){e.splice(i,1);return}if(d.id==="0"){const a=d.children;let l=a==null?void 0:a.length;for(;l--;)if(a[l].id===o){a.splice(l,1);return}}}},ge=(e,t="名称字段长度1-64个字符")=>{if(e.name&&(e.name=e.name.trim(),e.name.length<1||e.name.length>64))throw b.warning(t),new Error(t)},Ie=e=>{const t=["最近使用"];return e&&e.forEach(s=>{s.showFlag&&s.categories.forEach(n=>{t.push(n.name)})}),new Set(t)},h=e=>`dataease2-${e}`,M=v({func:void 0,bool:void 0,string:void 0,number:void 0,object:void 0,integer:void 0});class ye extends M{style(){return T("style",{type:[String,Object],default:void 0})}}const R=x("embedded",{state:()=>({type:"",token:"",busiFlag:"",outerParams:"",suffixId:"",baseUrl:"",dvId:"",pid:"",chartId:"",resourceId:"",dfId:"",opt:"",createType:"",templateParams:"",outerUrl:"",jumpInfoParam:"",datasourceId:"",tableName:"",datasetId:"",datasetCopyId:"",datasetPid:"",tokenInfo:new Map}),getters:{getType(){return this.type},getJumpInfoParam(){return this.jumpInfoParam},getOuterUrl(){return this.outerUrl},getCreateType(){return this.createType},getTemplateParams(){return this.templateParams},getToken(){return this.token},getBusiFlag(){return this.busiFlag},getOuterParams(){return this.outerParams},getSuffixId(){return this.suffixId},getBaseUrl(){return this.baseUrl},getDvId(){return this.dvId},getPid(){return this.pid},getChartId(){return this.chartId},getResourceId(){return this.resourceId},getDfId(){return this.dfId},getOpt(){return this.opt},getTokenInfo(){return this.tokenInfo},getIframeData(){return{embeddedToken:this.token,busiFlag:this.busiFlag,outerParams:this.outerParams,suffixId:this.suffixId,type:this.type,dvId:this.dvId,chartId:this.chartId,pid:this.pid,resourceId:this.resourceId,dfId:this.dfId}}},actions:{setType(e){this.type=e},setdatasetPid(e){this.datasetPid=e},setDatasourceId(e){this.datasourceId=e},setTableName(e){this.tableName=e},setDatasetId(e){this.datasetId=e},setDatasetCopyId(e){this.datasetCopyId=e},setOuterUrl(e){this.outerUrl=e},setJumpInfoParam(e){this.jumpInfoParam=e},setCreateType(e){this.createType=e},setTemplateParams(e){this.templateParams=e},setToken(e){this.token=e},setBusiFlag(e){this.busiFlag=e},setOuterParams(e){this.outerParams=e},setSuffixId(e){this.suffixId=e},setBaseUrl(e){this.baseUrl=e},setDvId(e){this.dvId=e},setPid(e){this.pid=e},setChartId(e){this.chartId=e},setResourceId(e){this.resourceId=e},setDfId(e){this.dfId=e},setOpt(e){this.opt=e},async setIframeData(e){this.type=e.type,this.token=e.embeddedToken,this.busiFlag=e.busiFlag,this.outerParams=e.outerParams,this.suffixId=e.suffixId,this.dvId=e.dvId,this.chartId=e.chartId,this.pid=e.pid,this.resourceId=e.resourceId,this.dfId=e.dfId},async setTokenInfo(e){this.tokenInfo=e},clearState(){this.setPid(""),this.setOpt(""),this.setCreateType(""),this.setTemplateParams(""),this.setResourceId(""),this.setDfId(""),this.setDvId(""),this.setJumpInfoParam(""),this.setOuterUrl(""),this.setDatasourceId(""),this.setTableName(""),this.setDatasetId(""),this.setDatasetCopyId(""),this.setdatasetPid("")}}}),be=()=>R(m),W=[P],$=[w],Pe=e=>{W.forEach(t=>{e.use(t)}),$.forEach(t=>{e.component(t.name,t)})},we=e=>{for(const[t,s]of Object.entries(E))e.component(t,s)};export{te as $,de as A,re as B,pe as C,U as D,F as E,ne as F,ee as _,S as a,A as b,oe as c,O as d,be as e,Pe as f,h as g,we as h,ae as i,B as j,N as k,fe as l,me as m,m as n,le as o,ye as p,ue as q,he as r,Z as s,ie as t,Y as u,ce as v,ge as w,Ie as x,K as y,se as z};

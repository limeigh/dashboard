import{p as z,c as Fe,aE as Ge}from"./index-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as Xe}from"./el-popover-0.0.0-dataease.js";import{E as Ze}from"./el-divider-0.0.0-dataease.js";import{E as Je}from"./el-date-picker-0.0.0-dataease.js";import{o as Ke,D as I,x as R,n as ve,y as Qe,j as Ye,G as et}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{E as tt}from"./el-checkbox-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import{E as ot}from"./el-switch-0.0.0-dataease.js";import{d as at,r as m,X as st,w as nt,y as X,a7 as lt,f,O as v,j as s,i as l,R as ke,g as A,u as d,a3 as P,a4 as w,_ as h,P as u,S as Z,at as it,a8 as J,W as rt,n as B,U as dt}from"./vue-0.0.0-dataease.js";import{u as ct,i as ut}from"./share-0.0.0-dataease.js";import{i as pt}from"./icon_edit_outlined-0.0.0-dataease.js";import{i as ft}from"./icon_close_outlined-0.0.0-dataease.js";import{i as mt}from"./icon_done_outlined-0.0.0-dataease.js";import{d as _t}from"./de-copy-0.0.0-dataease.js";import{i as ht}from"./icon_refresh_outlined-0.0.0-dataease.js";import{s as vt,S as kt,a as wt}from"./ShareTicket-0.0.0-dataease.js";import{u as yt}from"./index-0.0.0-dataease19.js";import gt from"./CustomLinkPwd-0.0.0-dataease.js";import bt from"./TicketDialog-0.0.0-dataease.js";import{E as xt}from"./index-0.0.0-dataease4.js";import{_ as It}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./dropdown-0.0.0-dataease.js";import"./dayjs.min-0.0.0-dataease.js";import"./arrays-0.0.0-dataease.js";import"./index-0.0.0-dataease18.js";import"./index-0.0.0-dataease5.js";import"./axios-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./el-table-0.0.0-dataease.js";import"./raf-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./dv-info-0.0.0-dataease.js";import"./icon_delete-trash_outlined-0.0.0-dataease.js";import"./icon_add_outlined-0.0.0-dataease.js";import"./GridTable-0.0.0-dataease.js";import"./el-pagination-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import"./index-0.0.0-dataease6.js";import"./token-0.0.0-dataease.js";import"./strings-0.0.0-dataease.js";import"./EmptyBackground-0.0.0-dataease.js";import"./el-empty-0.0.0-dataease.js";import"./none-0.0.0-dataease.js";import"./nothing-tree-0.0.0-dataease.js";import"./TicketEdit-0.0.0-dataease.js";import"./el-drawer-0.0.0-dataease.js";import"./index-0.0.0-dataease3.js";import"./use-dialog-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import"./el-form-item-0.0.0-dataease.js";import"./el-input-number-0.0.0-dataease.js";import"./index-0.0.0-dataease20.js";import"./el-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";const Ct={key:0,class:"share-container"},Et={class:"share-title share-padding"},Vt={class:"open-share flex-align-center share-padding"},St={key:0,class:"custom-link-line share-padding"},Pt={class:"share-input-suffix"},qt={key:1,class:"exp-container share-padding"},Rt={class:"checkbox-span"},Tt={class:"inline-share-item-picker"},Dt={key:1,class:"exp-error"},Ut={key:2,class:"pwd-container share-padding"},$t={class:"checkbox-span"},Mt={key:0,class:"auto-pwd-container"},zt={key:1,class:"inline-share-item"},At={class:"share-input-suffix"},Bt={key:4,class:"share-foot share-padding"},Lt={key:1,class:"share-container"},Ht={class:"share-title share-padding"},Nt={class:"open-share flex-align-center share-padding"},jt={key:0},Ot=at({__name:"ShareVisualHead",props:{resourceId:z.string.def(""),resourceType:z.string.def(""),weight:z.number.def(0),disabled:z.bool.def(!1)},setup(K,{expose:we}){const Q=ct(),Y=Fe(),{toClipboard:ee}=yt(),{t:o}=Ke(),g=K,E=m(!1),T=m(null),L=m(),H=m(),te=m(null),S=m(!1),y=m(!1),p=m(!1),oe=m(""),D=m(!1),b=m(!1),C=m(null),q=m(!1),ae=m(""),se=m(),N=m(),n=st({detailInfo:{id:"",uuid:"",pwd:"",exp:0,autoPwd:!0}});nt(()=>g.resourceId,()=>{E.value=!1});const ne=async()=>{if(!p.value){E.value=!1;return}if(V.value&&!O())return;if(await F()){b.value=!1,E.value=!1;return}},ye=e=>{var t,a;!E.value||e.target.closest('[class*="share-popover"]')||e.target.closest('[class*="ed-overlay-dialog"]')||(a=(t=e.target.classList)==null?void 0:t.toString())!=null&&a.includes("edit-uuid-icon")||ne()},ge=()=>{E.value||(q.value=!1,E.value=!0)},be=X(()=>`${o("work_branch.open_link_hint")}${g.resourceType==="dashboard"?o("work_branch.dashboard"):o("work_branch.big_data_screen")}`),le=X(()=>Q.getShareDisable),V=X(()=>Q.getSharePeRequire),xe=async()=>{if(p.value)try{if(W("link-uuid-error-msg")){I.warning(o("work_branch.error_link_hint"));return}if(y.value&&!n.detailInfo.autoPwd&&W("link-pwd-error-msg")){I.warning(o("work_branch.error_password_hint"));return}if(V.value&&!O())return;re();let e=oe.value;y.value&&(e+=`,${n.detailInfo.pwd}`),await ee(e),I.success(o("common.copy_success"))}catch{I.warning(o("common.copy_unsupported"))}else I.warning(o("common.copy_unsupported"));ne()},Ie=e=>e.getTime()<new Date().getTime(),Ce=()=>{te.value=Ge.service({target:".share-dialog-container"})},Ee=()=>{var e;(e=te.value)==null||e.close()},ie=()=>{U(O)},U=e=>{Ce();const a=`/share/detail/${g.resourceId}`;R.get({url:a}).then(r=>{var c;n.detailInfo={...r.data},(c=r.data)!=null&&c.uuid&&(ae.value=r.data.uuid),Ve()}).finally(()=>{Ee(),e&&e()})},Ve=()=>{n.detailInfo.id&&n.detailInfo.uuid?(p.value=!0,re(),y.value=!!n.detailInfo.pwd,S.value=!!n.detailInfo.exp):(p.value=!1,y.value=!1,S.value=!1)},Se=()=>{const t=`/share/switcher/${g.resourceId}`;R.post({url:t}).then(()=>{U(null)})},re=()=>{oe.value=de()+n.detailInfo.uuid},de=()=>{let e="/";return Y.baseUrl?e=Y.baseUrl+"#":e=window.location.origin+window.location.pathname+"#",(e.includes("oidcbi/")||e.includes("casbi/"))&&(e=e.replace("oidcbi/",""),e=e.replace("casbi/","")),e+wt},Pe=e=>{let t=0;if(e){const a=new Date;a.setTime(a.getTime()+3600*1e3),t=a.getTime(),n.detailInfo.exp=t}fe(),ce(t)},ce=e=>{if(S.value&&e<new Date().getTime()){D.value=!0;return}D.value=!1;const t=g.resourceId,a="/share/editExp",r={resourceId:t,exp:e};R.post({url:a,data:r}).then(()=>{U(null)})},qe=e=>{let t="";e&&(t=pe()),me(),j(t,!0)},ue=()=>{const e=pe();j(e,!0)},j=(e,t)=>{const a=g.resourceId,r="/share/editPwd",c={resourceId:a,pwd:e,autoPwd:t};R.post({url:r,data:c}).then(()=>{U(null)})},pe=()=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+";let a="";const r="!@#$%^&*()_+";let c=!1;for(let i=0;i<10;i++)i===0?a+=t.charAt(Math.floor(Math.random()*t.length)):!c&&i<10-2?(a+=r.charAt(Math.floor(Math.random()*r.length)),c=!0):a+=t.charAt(Math.floor(Math.random()*t.length));return a=a.split("").sort(()=>.5-Math.random()).join(""),a},O=()=>{if(p.value&&V.value){const e=fe(),t=me();return e&&t}return!0},fe=()=>!V.value||S.value?($(null,L),!0):($(o("common.required"),L),!1),me=()=>!V.value||y.value?($(null,H),!0):($(o("common.required"),H),!1),$=(e,t,a)=>{if(!t.value)return;a=a||"checkbox-span-require";const r=`.${a}`,c=t.value.$el;if(e){c.style.color="red",c.children[0].children[1].style.borderColor="red";const i=c.children[1].children[0].querySelector(r);if(i)i.innerText=e;else{const _=document.createElement("span");_.className=a,_.innerText=e,c.children[1].children[0].appendChild(_)}}else{c.style=null,c.children[0].children[1].style.borderColor=null;const i=c.children[1].children[0].querySelector(r);i&&c.children[1].children[0].removeChild(i)}},M=(e,t,a)=>{a=a||"link-pwd-error-msg";const r=`.${a}`,c=t||T;if(!c.value)return;const i=c.value.input;if(e){i.style.color="red",i.style.borderColor="red",i.parentElement.style["box-shadow"]="0 0 0 1px red inset";const _=i.parentElement.querySelector(r);if(_)_.innerText=e;else{const x=document.createElement("div");x.className=a,x.innerText=e,i.parentElement.appendChild(x)}}else{i.style=null,i.style.borderColor=null;const _=i.parentElement.querySelector(r);_&&(i.parentElement.style=null,i.parentElement.removeChild(_))}},W=e=>{var t;return(t=document.getElementsByClassName(e))==null?void 0:t.length},Re=e=>{e?(M(null,T),ue()):(n.detailInfo.pwd="",B(()=>{T.value.input.focus()}))},Te=async()=>{if(p.value&&y.value){if(!n.detailInfo.autoPwd&&W("link-pwd-error-msg")){I.warning(o("work_branch.error_password_hint"));return}try{await ee(n.detailInfo.pwd),I.success(o("common.copy_success"))}catch{I.warning(o("common.copy_unsupported"))}}else I.warning(o("common.copy_unsupported"))},De=()=>{b.value=!0,B(()=>{C!=null&&C.value&&C.value.input.focus()})},F=async()=>{const e=n.detailInfo.uuid,t="link-uuid-error-msg";if(!e)return M(o("commons.cannot_be_null"),C,t),!1;const r=/^[a-zA-Z0-9]{8,16}$/.test(e);if(!r)M(o("work_branch.uuid_checker"),C,t);else{const c=await Ue(e);return M(c,C,t),!c}return r},Ue=async e=>{const t="/share/editUuid",a={resourceId:g.resourceId,uuid:e};return(await R.post({url:t,data:a})).data},_e=async()=>{const e=await F();b.value=!e},$e=e=>{e.stopPropagation(),n.detailInfo.uuid=ae.value,_e()},Me=()=>{q.value=!0,B(()=>{N.value.open()})},ze=()=>{N.value.close(),B(()=>{q.value=!1})},Ae=e=>{n.detailInfo.ticketRequire=e},Be=()=>{ie()},Le=()=>{se.value.open(n.detailInfo.pwd)},He=e=>{n.detailInfo.pwd=e,j(e,!1)};return we({execute:Be}),(e,t)=>{const a=ve,r=Qe,c=ot,i=ve,_=Ye,x=xt,he=et,G=tt,Ne=Je,je=Ze,Oe=Xe,We=lt("click-outside");return f(),v(rt,null,[s(Oe,{visible:E.value,title:"",width:"480",placement:"bottom-end","show-arrow":!1,"popper-class":"share-popover",onShow:ie},{reference:l(()=>[g.weight>=7?ke((f(),A(r,{key:0,secondary:"",disabled:K.disabled,onClick:ge},{icon:l(()=>[s(a,{name:"icon_share-label_outlined"},{default:l(()=>[s(d(ut),{class:"svg-icon"})]),_:1})]),default:l(()=>[P(" "+w(d(o)("visualization.share")),1)]),_:1},8,["disabled"])),[[We,ye]]):h("",!0)]),default:l(()=>[le.value?(f(),v("div",Lt,[u("div",Ht,w(d(o)("work_branch.public_link_share")),1),u("div",Nt,[u("span",null,w(d(o)("work_branch.cannot_share_link")),1)])])):(f(),v("div",Ct,[u("div",Et,w(d(o)("work_branch.public_link_share")),1),u("div",Vt,[s(c,{size:"small",modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=k=>p.value=k),onChange:Se},null,8,["modelValue"]),P(" "+w(be.value),1)]),p.value?(f(),v("div",St,[s(he,{ref_key:"linkUuidRef",ref:C,placeholder:"",class:Z(b.value?"":"link-input-readlonly"),modelValue:n.detailInfo.uuid,"onUpdate:modelValue":t[1]||(t[1]=k=>n.detailInfo.uuid=k),readonly:!b.value,onBlur:F},it({suffix:l(()=>[u("div",Pt,[t[7]||(t[7]=u("span",{class:"suffix-split"},null,-1)),b.value?h("",!0):(f(),v("div",{key:0,class:"input-suffix-btn edit-uuid-icon",onClick:J(De,["stop"])},[s(x,{class:"item",effect:"dark",content:d(o)("commons.edit")+d(o)("chart.indicator_suffix"),placement:"top"},{default:l(()=>[s(_,{class:"edit-uuid-icon",style:{cursor:"pointer"}},{default:l(()=>[s(i,{class:"edit-uuid-icon"},{default:l(()=>[s(d(pt),{class:"svg-icon edit-uuid-icon"})]),_:1})]),_:1})]),_:1},8,["content"])])),b.value?(f(),v("div",{key:1,class:"input-suffix-btn",onClick:J($e,["stop"])},[s(x,{class:"item",effect:"dark",content:d(o)("commons.cancel"),placement:"top"},{default:l(()=>[s(_,{style:{cursor:"pointer"}},{default:l(()=>[s(i,null,{default:l(()=>[s(d(ft),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])])):h("",!0),b.value?(f(),v("div",{key:2,class:"input-suffix-btn done-finish",onClick:J(_e,["stop"])},[s(x,{class:"item",effect:"dark",content:d(o)("commons.save"),placement:"top"},{default:l(()=>[s(_,{style:{cursor:"pointer"}},{default:l(()=>[s(i,null,{default:l(()=>[s(d(mt),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])])):h("",!0)])]),_:2},[b.value?void 0:{name:"prefix",fn:l(()=>[P(w(de()),1)]),key:"0"}]),1032,["class","modelValue","readonly"])])):h("",!0),p.value?(f(),v("div",qt,[s(G,{ref_key:"expCheckbox",ref:L,disabled:!p.value,modelValue:S.value,"onUpdate:modelValue":t[2]||(t[2]=k=>S.value=k),onChange:Pe},{default:l(()=>[u("div",Rt,[u("span",null,w(d(o)("visualization.over_time")),1),u("span",{class:Z(["pe-require",{"pe-tips-hidden":!V.value}])},[...t[8]||(t[8]=[u("span",null,"*",-1)])],2)])]),_:1},8,["disabled","modelValue"]),u("div",Tt,[n.detailInfo.exp?(f(),A(Ne,{key:0,clearable:!1,class:"share-exp-picker",modelValue:n.detailInfo.exp,"onUpdate:modelValue":t[3]||(t[3]=k=>n.detailInfo.exp=k),type:"datetime",teleported:!1,placeholder:"",shortcuts:d(vt),onChange:ce,"disabled-date":Ie,"value-format":"x"},null,8,["modelValue","shortcuts"])):h("",!0),D.value?(f(),v("span",Dt,w(d(o)("work_branch.share_time_limit")),1)):h("",!0)])])):h("",!0),p.value?(f(),v("div",Ut,[s(G,{ref_key:"pwdCheckbox",ref:H,disabled:!p.value,modelValue:y.value,"onUpdate:modelValue":t[4]||(t[4]=k=>y.value=k),onChange:qe},{default:l(()=>[u("div",$t,[u("span",null,w(d(o)("visualization.passwd_protect")),1),u("span",{class:Z(["pe-require",{"pe-tips-hidden":!V.value}])},[...t[9]||(t[9]=[u("span",null,"*",-1)])],2)])]),_:1},8,["disabled","modelValue"]),y.value?(f(),v("div",Mt,[ke(s(G,{disabled:!p.value,modelValue:n.detailInfo.autoPwd,"onUpdate:modelValue":t[5]||(t[5]=k=>n.detailInfo.autoPwd=k),onChange:Re,label:d(o)("visualization.auto_pwd")},null,8,["disabled","modelValue","label"]),[[dt,!1]])])):h("",!0),y.value?(f(),v("div",zt,[s(he,{ref_key:"pwdRef",ref:T,style:{flex:"1"},class:"link-input-readlonly",modelValue:n.detailInfo.pwd,"onUpdate:modelValue":t[6]||(t[6]=k=>n.detailInfo.pwd=k),readonly:n.detailInfo.autoPwd},{suffix:l(()=>[u("div",At,[t[10]||(t[10]=u("span",{class:"suffix-split"},null,-1)),u("div",{class:"input-suffix-btn",onClick:Te},[s(x,{class:"item",effect:"dark",content:d(o)("commons.copy"),placement:"top"},{default:l(()=>[s(_,{style:{cursor:"pointer"}},{default:l(()=>[s(i,null,{default:l(()=>[s(d(_t),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])]),u("div",{class:"input-suffix-btn",onClick:ue},[s(x,{class:"item",effect:"dark",content:d(o)("commons.reset"),placement:"top"},{default:l(()=>[s(_,{style:{cursor:"pointer"}},{default:l(()=>[s(i,null,{default:l(()=>[s(d(ht),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])])])]),_:1},8,["modelValue","readonly"]),s(r,{secondary:"",onClick:Le},{default:l(()=>[P(w(d(o)("user.change_password")),1)]),_:1})])):h("",!0)])):h("",!0),p.value?(f(),A(je,{key:3,class:"share-divider"})):h("",!0),p.value?(f(),v("div",Bt,[s(r,{secondary:"",onClick:Me},{default:l(()=>[P(w(d(o)("work_branch.ticket_setting")),1)]),_:1}),s(r,{disabled:!p.value||D.value,type:"primary",onClick:xe},{default:l(()=>[P(w(y.value?d(o)("visualization.copy_link_passwd"):d(o)("visualization.copy_link")),1)]),_:1},8,["disabled"])])):h("",!0)]))]),_:1},8,["visible"]),s(gt,{ref_key:"customPwdRef",ref:se,onPwdChange:He},null,512),q.value?(f(),A(bt,{key:0,ref_key:"ticketDialogRef",ref:N},{default:l(()=>[!le.value&&p.value&&q.value?(f(),v("div",jt,[s(kt,{uuid:n.detailInfo.uuid,"resource-id":g.resourceId,"ticket-require":n.detailInfo.ticketRequire,onRequireChange:Ae,onClose:ze},null,8,["uuid","resource-id","ticket-require"])])):h("",!0)]),_:1},512)):h("",!0)],64)}}});const Jo=It(Ot,[["__scopeId","data-v-ad340447"]]);export{Jo as default};

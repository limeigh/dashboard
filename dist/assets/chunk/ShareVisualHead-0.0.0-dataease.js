import{E as I,i as Fe,K as Ke,e as Xe,f as Ye,r as Ze,z as Ge,_ as Je,g as Qe,a as et,h as tt}from"./element-plus-secondary-0.0.0-dataease.js";import{f as ot,j as R,e as ve}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as at,r as m,l as st,w as nt,k as X,aq as lt,o as f,c as v,W as s,U as l,$ as ke,T as M,u as d,_ as q,Y as w,R as h,a as u,z as Y,aa as it,X as Z,S as rt,n as A,a0 as dt}from"./@vue-0.0.0-dataease.js";import{u as ct,i as ut}from"./share-0.0.0-dataease.js";import{i as pt}from"./icon_edit_outlined-0.0.0-dataease.js";import{i as ft}from"./icon_close_outlined-0.0.0-dataease.js";import{i as mt}from"./icon_done_outlined-0.0.0-dataease.js";import{d as _t}from"./de-copy-0.0.0-dataease.js";import{i as ht}from"./icon_refresh_outlined-0.0.0-dataease.js";import{p as B,f as vt}from"./index-0.0.0-dataease.js";import{s as kt,S as wt,a as yt}from"./ShareTicket-0.0.0-dataease.js";import{u as gt}from"./vue-clipboard3-0.0.0-dataease.js";import bt from"./CustomLinkPwd-0.0.0-dataease.js";import xt from"./TicketDialog-0.0.0-dataease.js";import{_ as It}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./lodash-es-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./pinia-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./fast-png-0.0.0-dataease.js";import"./iobuffer-0.0.0-dataease.js";import"./pako-0.0.0-dataease.js";import"./vue-router_2-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";import"./dv-info-0.0.0-dataease.js";import"./icon_delete-trash_outlined-0.0.0-dataease.js";import"./icon_add_outlined-0.0.0-dataease.js";import"./GridTable-0.0.0-dataease.js";import"./EmptyBackground-0.0.0-dataease.js";import"./none-0.0.0-dataease.js";import"./nothing-tree-0.0.0-dataease.js";import"./TicketEdit-0.0.0-dataease.js";import"./clipboard-0.0.0-dataease.js";const Ct={key:0,class:"share-container"},Vt={class:"share-title share-padding"},Et={class:"open-share flex-align-center share-padding"},St={key:0,class:"custom-link-line share-padding"},qt={class:"share-input-suffix"},Pt={key:1,class:"exp-container share-padding"},Rt={class:"checkbox-span"},Tt={class:"inline-share-item-picker"},Dt={key:1,class:"exp-error"},Ut={key:2,class:"pwd-container share-padding"},$t={class:"checkbox-span"},zt={key:0,class:"auto-pwd-container"},Mt={key:1,class:"inline-share-item"},At={class:"share-input-suffix"},Bt={key:4,class:"share-foot share-padding"},Lt={key:1,class:"share-container"},Ht={class:"share-title share-padding"},Nt={class:"open-share flex-align-center share-padding"},jt={key:0},Ot=at({__name:"ShareVisualHead",props:{resourceId:B.string.def(""),resourceType:B.string.def(""),weight:B.number.def(0),disabled:B.bool.def(!1)},setup(G,{expose:we}){const J=ct(),Q=vt(),{toClipboard:ee}=gt(),{t:o}=ot(),g=G,V=m(!1),T=m(null),L=m(),H=m(),te=m(null),S=m(!1),y=m(!1),p=m(!1),oe=m(""),D=m(!1),b=m(!1),C=m(null),P=m(!1),ae=m(""),se=m(),N=m(),n=st({detailInfo:{id:"",uuid:"",pwd:"",exp:0,autoPwd:!0}});nt(()=>g.resourceId,()=>{V.value=!1});const ne=async()=>{if(!p.value){V.value=!1;return}if(E.value&&!O())return;if(await F()){b.value=!1,V.value=!1;return}},ye=e=>{var t,a;!V.value||e.target.closest('[class*="share-popover"]')||e.target.closest('[class*="ed-overlay-dialog"]')||(a=(t=e.target.classList)==null?void 0:t.toString())!=null&&a.includes("edit-uuid-icon")||ne()},ge=()=>{V.value||(P.value=!1,V.value=!0)},be=X(()=>`${o("work_branch.open_link_hint")}${g.resourceType==="dashboard"?o("work_branch.dashboard"):o("work_branch.big_data_screen")}`),le=X(()=>J.getShareDisable),E=X(()=>J.getSharePeRequire),xe=async()=>{if(p.value)try{if(W("link-uuid-error-msg")){I.warning(o("work_branch.error_link_hint"));return}if(y.value&&!n.detailInfo.autoPwd&&W("link-pwd-error-msg")){I.warning(o("work_branch.error_password_hint"));return}if(E.value&&!O())return;re();let e=oe.value;y.value&&(e+=`,${n.detailInfo.pwd}`),await ee(e),I.success(o("common.copy_success"))}catch{I.warning(o("common.copy_unsupported"))}else I.warning(o("common.copy_unsupported"));ne()},Ie=e=>e.getTime()<new Date().getTime(),Ce=()=>{te.value=et.service({target:".share-dialog-container"})},Ve=()=>{var e;(e=te.value)==null||e.close()},ie=()=>{U(O)},U=e=>{Ce();const a=`/share/detail/${g.resourceId}`;R.get({url:a}).then(r=>{var c;n.detailInfo={...r.data},(c=r.data)!=null&&c.uuid&&(ae.value=r.data.uuid),Ee()}).finally(()=>{Ve(),e&&e()})},Ee=()=>{n.detailInfo.id&&n.detailInfo.uuid?(p.value=!0,re(),y.value=!!n.detailInfo.pwd,S.value=!!n.detailInfo.exp):(p.value=!1,y.value=!1,S.value=!1)},Se=()=>{const t=`/share/switcher/${g.resourceId}`;R.post({url:t}).then(()=>{U(null)})},re=()=>{oe.value=de()+n.detailInfo.uuid},de=()=>{let e="/";return Q.baseUrl?e=Q.baseUrl+"#":e=window.location.origin+window.location.pathname+"#",(e.includes("oidcbi/")||e.includes("casbi/"))&&(e=e.replace("oidcbi/",""),e=e.replace("casbi/","")),e+yt},qe=e=>{let t=0;if(e){const a=new Date;a.setTime(a.getTime()+3600*1e3),t=a.getTime(),n.detailInfo.exp=t}fe(),ce(t)},ce=e=>{if(S.value&&e<new Date().getTime()){D.value=!0;return}D.value=!1;const t=g.resourceId,a="/share/editExp",r={resourceId:t,exp:e};R.post({url:a,data:r}).then(()=>{U(null)})},Pe=e=>{let t="";e&&(t=pe()),me(),j(t,!0)},ue=()=>{const e=pe();j(e,!0)},j=(e,t)=>{const a=g.resourceId,r="/share/editPwd",c={resourceId:a,pwd:e,autoPwd:t};R.post({url:r,data:c}).then(()=>{U(null)})},pe=()=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+";let a="";const r="!@#$%^&*()_+";let c=!1;for(let i=0;i<10;i++)i===0?a+=t.charAt(Math.floor(Math.random()*t.length)):!c&&i<10-2?(a+=r.charAt(Math.floor(Math.random()*r.length)),c=!0):a+=t.charAt(Math.floor(Math.random()*t.length));return a=a.split("").sort(()=>.5-Math.random()).join(""),a},O=()=>{if(p.value&&E.value){const e=fe(),t=me();return e&&t}return!0},fe=()=>!E.value||S.value?($(null,L),!0):($(o("common.required"),L),!1),me=()=>!E.value||y.value?($(null,H),!0):($(o("common.required"),H),!1),$=(e,t,a)=>{if(!t.value)return;a=a||"checkbox-span-require";const r=`.${a}`,c=t.value.$el;if(e){c.style.color="red",c.children[0].children[1].style.borderColor="red";const i=c.children[1].children[0].querySelector(r);if(i)i.innerText=e;else{const _=document.createElement("span");_.className=a,_.innerText=e,c.children[1].children[0].appendChild(_)}}else{c.style=null,c.children[0].children[1].style.borderColor=null;const i=c.children[1].children[0].querySelector(r);i&&c.children[1].children[0].removeChild(i)}},z=(e,t,a)=>{a=a||"link-pwd-error-msg";const r=`.${a}`,c=t||T;if(!c.value)return;const i=c.value.input;if(e){i.style.color="red",i.style.borderColor="red",i.parentElement.style["box-shadow"]="0 0 0 1px red inset";const _=i.parentElement.querySelector(r);if(_)_.innerText=e;else{const x=document.createElement("div");x.className=a,x.innerText=e,i.parentElement.appendChild(x)}}else{i.style=null,i.style.borderColor=null;const _=i.parentElement.querySelector(r);_&&(i.parentElement.style=null,i.parentElement.removeChild(_))}},W=e=>{var t;return(t=document.getElementsByClassName(e))==null?void 0:t.length},Re=e=>{e?(z(null,T),ue()):(n.detailInfo.pwd="",A(()=>{T.value.input.focus()}))},Te=async()=>{if(p.value&&y.value){if(!n.detailInfo.autoPwd&&W("link-pwd-error-msg")){I.warning(o("work_branch.error_password_hint"));return}try{await ee(n.detailInfo.pwd),I.success(o("common.copy_success"))}catch{I.warning(o("common.copy_unsupported"))}}else I.warning(o("common.copy_unsupported"))},De=()=>{b.value=!0,A(()=>{C!=null&&C.value&&C.value.input.focus()})},F=async()=>{const e=n.detailInfo.uuid,t="link-uuid-error-msg";if(!e)return z(o("commons.cannot_be_null"),C,t),!1;const r=/^[a-zA-Z0-9]{8,16}$/.test(e);if(!r)z(o("work_branch.uuid_checker"),C,t);else{const c=await Ue(e);return z(c,C,t),!c}return r},Ue=async e=>{const t="/share/editUuid",a={resourceId:g.resourceId,uuid:e};return(await R.post({url:t,data:a})).data},_e=async()=>{const e=await F();b.value=!e},$e=e=>{e.stopPropagation(),n.detailInfo.uuid=ae.value,_e()},ze=()=>{P.value=!0,A(()=>{N.value.open()})},Me=()=>{N.value.close(),A(()=>{P.value=!1})},Ae=e=>{n.detailInfo.ticketRequire=e},Be=()=>{ie()},Le=()=>{se.value.open(n.detailInfo.pwd)},He=e=>{n.detailInfo.pwd=e,j(e,!1)};return we({execute:Be}),(e,t)=>{const a=ve,r=Fe,c=Ke,i=ve,_=Xe,x=Ye,he=Ze,K=Ge,Ne=Je,je=tt,Oe=Qe,We=lt("click-outside");return f(),v(rt,null,[s(Oe,{visible:V.value,title:"",width:"480",placement:"bottom-end","show-arrow":!1,"popper-class":"share-popover",onShow:ie},{reference:l(()=>[g.weight>=7?ke((f(),M(r,{key:0,secondary:"",disabled:G.disabled,onClick:ge},{icon:l(()=>[s(a,{name:"icon_share-label_outlined"},{default:l(()=>[s(d(ut),{class:"svg-icon"})]),_:1})]),default:l(()=>[q(" "+w(d(o)("visualization.share")),1)]),_:1},8,["disabled"])),[[We,ye]]):h("",!0)]),default:l(()=>[le.value?(f(),v("div",Lt,[u("div",Ht,w(d(o)("work_branch.public_link_share")),1),u("div",Nt,[u("span",null,w(d(o)("work_branch.cannot_share_link")),1)])])):(f(),v("div",Ct,[u("div",Vt,w(d(o)("work_branch.public_link_share")),1),u("div",Et,[s(c,{size:"small",modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=k=>p.value=k),onChange:Se},null,8,["modelValue"]),q(" "+w(be.value),1)]),p.value?(f(),v("div",St,[s(he,{ref_key:"linkUuidRef",ref:C,placeholder:"",class:Y(b.value?"":"link-input-readlonly"),modelValue:n.detailInfo.uuid,"onUpdate:modelValue":t[1]||(t[1]=k=>n.detailInfo.uuid=k),readonly:!b.value,onBlur:F},it({suffix:l(()=>[u("div",qt,[t[7]||(t[7]=u("span",{class:"suffix-split"},null,-1)),b.value?h("",!0):(f(),v("div",{key:0,class:"input-suffix-btn edit-uuid-icon",onClick:Z(De,["stop"])},[s(x,{class:"item",effect:"dark",content:d(o)("commons.edit")+d(o)("chart.indicator_suffix"),placement:"top"},{default:l(()=>[s(_,{class:"edit-uuid-icon",style:{cursor:"pointer"}},{default:l(()=>[s(i,{class:"edit-uuid-icon"},{default:l(()=>[s(d(pt),{class:"svg-icon edit-uuid-icon"})]),_:1})]),_:1})]),_:1},8,["content"])])),b.value?(f(),v("div",{key:1,class:"input-suffix-btn",onClick:Z($e,["stop"])},[s(x,{class:"item",effect:"dark",content:d(o)("commons.cancel"),placement:"top"},{default:l(()=>[s(_,{style:{cursor:"pointer"}},{default:l(()=>[s(i,null,{default:l(()=>[s(d(ft),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])])):h("",!0),b.value?(f(),v("div",{key:2,class:"input-suffix-btn done-finish",onClick:Z(_e,["stop"])},[s(x,{class:"item",effect:"dark",content:d(o)("commons.save"),placement:"top"},{default:l(()=>[s(_,{style:{cursor:"pointer"}},{default:l(()=>[s(i,null,{default:l(()=>[s(d(mt),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])])):h("",!0)])]),_:2},[b.value?void 0:{name:"prefix",fn:l(()=>[q(w(de()),1)]),key:"0"}]),1032,["class","modelValue","readonly"])])):h("",!0),p.value?(f(),v("div",Pt,[s(K,{ref_key:"expCheckbox",ref:L,disabled:!p.value,modelValue:S.value,"onUpdate:modelValue":t[2]||(t[2]=k=>S.value=k),onChange:qe},{default:l(()=>[u("div",Rt,[u("span",null,w(d(o)("visualization.over_time")),1),u("span",{class:Y(["pe-require",{"pe-tips-hidden":!E.value}])},[...t[8]||(t[8]=[u("span",null,"*",-1)])],2)])]),_:1},8,["disabled","modelValue"]),u("div",Tt,[n.detailInfo.exp?(f(),M(Ne,{key:0,clearable:!1,class:"share-exp-picker",modelValue:n.detailInfo.exp,"onUpdate:modelValue":t[3]||(t[3]=k=>n.detailInfo.exp=k),type:"datetime",teleported:!1,placeholder:"",shortcuts:d(kt),onChange:ce,"disabled-date":Ie,"value-format":"x"},null,8,["modelValue","shortcuts"])):h("",!0),D.value?(f(),v("span",Dt,w(d(o)("work_branch.share_time_limit")),1)):h("",!0)])])):h("",!0),p.value?(f(),v("div",Ut,[s(K,{ref_key:"pwdCheckbox",ref:H,disabled:!p.value,modelValue:y.value,"onUpdate:modelValue":t[4]||(t[4]=k=>y.value=k),onChange:Pe},{default:l(()=>[u("div",$t,[u("span",null,w(d(o)("visualization.passwd_protect")),1),u("span",{class:Y(["pe-require",{"pe-tips-hidden":!E.value}])},[...t[9]||(t[9]=[u("span",null,"*",-1)])],2)])]),_:1},8,["disabled","modelValue"]),y.value?(f(),v("div",zt,[ke(s(K,{disabled:!p.value,modelValue:n.detailInfo.autoPwd,"onUpdate:modelValue":t[5]||(t[5]=k=>n.detailInfo.autoPwd=k),onChange:Re,label:d(o)("visualization.auto_pwd")},null,8,["disabled","modelValue","label"]),[[dt,!1]])])):h("",!0),y.value?(f(),v("div",Mt,[s(he,{ref_key:"pwdRef",ref:T,style:{flex:"1"},class:"link-input-readlonly",modelValue:n.detailInfo.pwd,"onUpdate:modelValue":t[6]||(t[6]=k=>n.detailInfo.pwd=k),readonly:n.detailInfo.autoPwd},{suffix:l(()=>[u("div",At,[t[10]||(t[10]=u("span",{class:"suffix-split"},null,-1)),u("div",{class:"input-suffix-btn",onClick:Te},[s(x,{class:"item",effect:"dark",content:d(o)("commons.copy"),placement:"top"},{default:l(()=>[s(_,{style:{cursor:"pointer"}},{default:l(()=>[s(i,null,{default:l(()=>[s(d(_t),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])]),u("div",{class:"input-suffix-btn",onClick:ue},[s(x,{class:"item",effect:"dark",content:d(o)("commons.reset"),placement:"top"},{default:l(()=>[s(_,{style:{cursor:"pointer"}},{default:l(()=>[s(i,null,{default:l(()=>[s(d(ht),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])])])]),_:1},8,["modelValue","readonly"]),s(r,{secondary:"",onClick:Le},{default:l(()=>[q(w(d(o)("user.change_password")),1)]),_:1})])):h("",!0)])):h("",!0),p.value?(f(),M(je,{key:3,class:"share-divider"})):h("",!0),p.value?(f(),v("div",Bt,[s(r,{secondary:"",onClick:ze},{default:l(()=>[q(w(d(o)("work_branch.ticket_setting")),1)]),_:1}),s(r,{disabled:!p.value||D.value,type:"primary",onClick:xe},{default:l(()=>[q(w(y.value?d(o)("visualization.copy_link_passwd"):d(o)("visualization.copy_link")),1)]),_:1},8,["disabled"])])):h("",!0)]))]),_:1},8,["visible"]),s(bt,{ref_key:"customPwdRef",ref:se,onPwdChange:He},null,512),P.value?(f(),M(xt,{key:0,ref_key:"ticketDialogRef",ref:N},{default:l(()=>[!le.value&&p.value&&P.value?(f(),v("div",jt,[s(wt,{uuid:n.detailInfo.uuid,"resource-id":g.resourceId,"ticket-require":n.detailInfo.ticketRequire,onRequireChange:Ae,onClose:Me},null,8,["uuid","resource-id","ticket-require"])])):h("",!0)]),_:1},512)):h("",!0)],64)}}});const fa=It(Ot,[["__scopeId","data-v-ad340447"]]);export{fa as default};

import{E as Z,e as ee,i as te,A as ae,y as oe,M as se}from"./element-plus-secondary-0.0.0-dataease.js";import{f as le,e as ie}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as de,x as q,r as U,o as v,T as $,U as l,a as u,_ as b,Y as _,u as n,W as o,c as g,S as V,a8 as E,$ as ne,a0 as re,X as T}from"./@vue-0.0.0-dataease.js";import{i as ce}from"./icon_info_colorful-0.0.0-dataease.js";import{i as S}from"./icon_add_outlined-0.0.0-dataease.js";import{i as N}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import{j as ue}from"./join-join-0.0.0-dataease.js";import{g as pe}from"./util-0.0.0-dataease.js";import{R as _e}from"./dataset-0.0.0-dataease.js";import{h as O}from"./lodash-es-0.0.0-dataease.js";import{_ as me}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./pinia-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./index-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./fast-png-0.0.0-dataease.js";import"./iobuffer-0.0.0-dataease.js";import"./pako-0.0.0-dataease.js";import"./vue-router_2-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./snowflake-id-0.0.0-dataease.js";import"./js-base64-0.0.0-dataease.js";const fe={class:"title"},ve={style:{"margin-left":"8px"},class:"tip"},he={class:"content"},ye={style:{display:"flex","align-items":"center","justify-content":"space-between"}},Ie={class:"cascade-item"},be={class:"label"},ge={class:"item-name"},Ce={class:"item-field"},ke={class:"label"},qe={class:"item-name"},Ve={class:"cascade-icon"},Ee={class:"item-field"},we={class:"dialog-footer"},Be=de({__name:"QueryCascade",emits:["saveCascade"],setup($e,{expose:Q,emit:L}){const{t:s}=le();let j=q({});const R=L,C=U(!1),w=()=>{C.value=!1},p=U([]),M=q({}),B=q([]),F=()=>{w()},J=()=>{const{isError:a,arr:e}=P();if(a){Z.error(s("v_query.cannot_be_empty"));return}R("saveCascade",e),w()},P=()=>{let a=!1;const e=O(p.value);return e.forEach(i=>{i.forEach(t=>{!t.placeholder&&!t.fieldId&&(a=!0),t.datasetId||(a=!0),t.selectValue=[]})}),{arr:e,isError:a}},W=(a,e)=>{p.value=O(e),B.value=Object.values(a).map(t=>({label:t.name,deType:t.deType,value:`${t.datasetId}--${t.queryId}--${t.fieldId}`}));let i={};Object.values(a).forEach(t=>{i[`${t.datasetId}--${t.queryId}--${t.fieldId}`]=t.deType}),j.value=i,_e(B.value.map(t=>t.value.split("--")[0])).then(t=>{M.value=t}).finally(()=>{C.value=!0})},z=q([]),X=(a,e,i)=>{let t="",m=[],h="",y=[];for(let r in p.value[e]){if(r>i){p.value[e][r].datasetId&&!h&&(h=p.value[e][r].datasetId);continue}p.value[e][r].datasetId&&(t=p.value[e][r].datasetId),r===i&&(t=(p.value[e][i-1]||{}).datasetId)}p.value.forEach(r=>{let f=[],I=[];for(let d in r){if(m[m.length-1]===f||h===r[d].datasetId){h===r[d].datasetId&&y.push(I),y[y.length-1]===I&&I.push(r[d].datasetId);continue}r[d].datasetId&&f.push(r[d].datasetId),t===r[d].datasetId&&m.push(f)}}),a&&(z.value=[...new Set([...m.flat(),...y.flat()])].filter(r=>!!r))},A=a=>{a.push({datasetId:"",fieldId:"",placeholder:a.length?"":s("v_query.the_first_level"),id:pe()})},D=()=>{p.value.forEach(a=>{a.forEach((e,i)=>{i&&(e.placeholder=""),e&&a[i-1]&&e.datasetId&&e.datasetId.split("--")[0]===a[i-1].datasetId.split("--")[0]&&(e.placeholder=s("v_query.configure_cascaded_fields"),e.fieldId="")})})},Y=(a,e)=>{e.splice(a,1),e[0].fieldId="",e[0].placeholder=s("v_query.the_first_level"),D()},x=a=>{p.value.splice(a,1)},G=()=>{const a=[];A(a),p.value.push(a)},H=[s("visualization.number1"),s("visualization.number2"),s("visualization.number3"),s("visualization.number4"),s("visualization.number5")];return Q({init:W}),(a,e)=>{const i=ie,t=ee,m=te,h=ae,y=oe,r=se;return v(),$(r,{class:"query-condition-cascade",modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=f=>C.value=f),width:"900px",onClick:e[1]||(e[1]=T(()=>{},["stop"])),"before-close":w,onMousedown:e[2]||(e[2]=T(()=>{},["stop"])),onMousedup:e[3]||(e[3]=T(()=>{},["stop"]))},{title:l(()=>[u("div",fe,[b(_(n(s)("v_query.condition_cascade_configuration")),1),u("span",ve,_(n(s)("v_query.not_reverse_cascade")),1)])]),footer:l(()=>[u("div",we,[o(m,{onClick:F},{default:l(()=>[b(_(n(s)("chart.cancel")),1)]),_:1}),o(m,{onClick:J,type:"primary"},{default:l(()=>[b(_(n(s)("chart.confirm")),1)]),_:1})])]),default:l(()=>[u("div",he,[o(t,{style:{"font-size":"16px"}},{default:l(()=>[o(i,{name:"icon_info_colorful"},{default:l(()=>[o(n(ce),{class:"svg-icon"})]),_:1})]),_:1}),b(" "+_(n(s)("v_query.must_be_met")),1),e[4]||(e[4]=u("br",null,null,-1)),b(" "+_(n(s)("v_query.select_data_set")),1),e[5]||(e[5]=u("br",null,null,-1))]),o(m,{text:"",onClick:G},{icon:l(()=>[o(i,{name:"icon_add_outlined"},{default:l(()=>[o(n(S),{class:"svg-icon"})]),_:1})]),default:l(()=>[b(" "+_(n(s)("v_query.add_cascade_configuration")),1)]),_:1}),(v(!0),g(V,null,E(p.value,(f,I)=>(v(),g("div",{class:"cascade-content",key:I},[u("div",ye,[o(m,{disabled:f.length===2,text:"",onClick:d=>A(f)},{icon:l(()=>[o(i,{name:"icon_add_outlined"},{default:l(()=>[o(n(S),{class:"svg-icon"})]),_:1})]),default:l(()=>[b(" "+_(n(s)("v_query.add_cascade_condition")),1)]),_:1},8,["disabled","onClick"]),o(m,{onClick:d=>x(I),class:"cascade-delete-block",text:""},{icon:l(()=>[o(i,{name:"icon_delete-trash_outlined"},{default:l(()=>[o(n(N),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]),u("div",Ie,[u("div",be,_(n(s)("v_query.query_condition_level")),1),u("div",ge,_(n(s)("v_query.select_query_condition")),1),e[6]||(e[6]=u("div",{class:"cascade-icon"},null,-1)),u("div",Ce,_(n(s)("v_query.select_cascaded_field")),1)]),(v(!0),g(V,null,E(f,(d,k)=>(v(),g("div",{class:"cascade-item",key:d.id},[u("div",ke,_(n(s)("v_query.level_1",{msg:H[k]})),1),u("div",qe,[o(y,{onVisibleChange:c=>X(c,I,k),modelValue:d.datasetId,"onUpdate:modelValue":c=>d.datasetId=c,onChange:D,style:{width:"300px"}},{default:l(()=>[(v(!0),g(V,null,E(B.value,c=>(v(),$(h,{key:c.value,label:c.label,value:c.value,disabled:z.value.includes(c.value)&&f.map(K=>K.datasetId).includes(c.value)||!!d.datasetId&&n(j)[d.datasetId]!==c.deType},null,8,["label","value","disabled"]))),128))]),_:2},1032,["onVisibleChange","modelValue","onUpdate:modelValue"])]),u("div",Ve,[o(t,null,{default:l(()=>[o(i,{name:"join-join"},{default:l(()=>[o(n(ue),{class:"svg-icon"})]),_:1})]),_:1})]),u("div",Ee,[o(y,{placeholder:d.placeholder,disabled:!!d.placeholder,modelValue:d.fieldId,"onUpdate:modelValue":c=>d.fieldId=c,style:{width:"300px"}},{default:l(()=>[(v(!0),g(V,null,E(M.value[d.datasetId.split("--")[0]],c=>(v(),$(h,{key:c.id,label:c.name,value:c.id},null,8,["label","value"]))),128))]),_:2},1032,["placeholder","disabled","modelValue","onUpdate:modelValue"])]),ne(o(m,{onClick:c=>Y(k,f),class:"cascade-delete",text:""},{icon:l(()=>[o(i,{name:"icon_delete-trash_outlined"},{default:l(()=>[o(n(N),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"]),[[re,k!==0]])]))),128))]))),128))]),_:1},8,["modelValue"])}}});const Qt=me(Be,[["__scopeId","data-v-a5c86c18"]]);export{Qt as default};

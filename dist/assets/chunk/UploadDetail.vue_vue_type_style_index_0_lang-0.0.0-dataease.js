import{E as p,r as Y,w as G,i as H,L as K,x as P,M as Q,v as Z}from"./element-plus-secondary-0.0.0-dataease.js";import{f as ee,e as te}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as ae,l as U,r as m,o as g,T as v,U as l,a as oe,W as s,_ as y,Y as h,u as r,$ as u,X as le,R as B,a0 as E}from"./@vue-0.0.0-dataease.js";import{i as se}from"./icon_upload_outlined-0.0.0-dataease.js";import{u as ne,e as ie}from"./font-0.0.0-dataease.js";import re from"./FontInfo-0.0.0-dataease.js";import{h as T}from"./lodash-es-0.0.0-dataease.js";const me={class:"dialog-footer"},ye=ae({__name:"UploadDetail",emits:["finish"],setup(ue,{expose:S,emit:I}){const i=U({fileList:null}),f=m(!1),A=m(),{t:o}=ee(),D=()=>{const a=new FormData;return a.append("file",i.fileList.raw),f.value=!0,ne(a).then(e=>{var n;t.name=e.data.name,t.size=e.data.size,t.sizeType=e.data.sizeType,t.fileTransName=e.data.fileTransName,t.fileName=i.fileList.raw.name,(n=A.value)==null||n.clearFiles()}).catch(e=>{e.code==="ECONNABORTED"&&p({type:"error",message:e.message,showClose:!0})}).finally(()=>{f.value=!1})},b=m(""),c=m(!1),d=m(""),w={id:null,name:"",fileName:"",fileTransName:"",size:0,sizeType:"",isDefault:0,isBuiltin:0,updateTime:0},t=U(T(w)),M=(a,e,n)=>{b.value=a||o("system.add_font"),d.value=e,c.value=!0,Object.assign(t,T(w)),Object.assign(t,JSON.parse(JSON.stringify(n)))},R=()=>{i.fileList=null},F=m(),j={name:[{required:!0,message:o("system.the_font_name"),trigger:"blur"},{min:1,max:50,message:o("system.character_length_1_50"),trigger:"blur"}]};S({init:M});const V=a=>a.name.toLocaleLowerCase().endsWith(".ttf")?!0:(p.error(o("system.in_ttf_format")),!1),x=a=>{var e,n;(n=(e=a.raw)==null?void 0:e.name)!=null&&n.toLocaleLowerCase().endsWith(".ttf")&&(i.fileList=a)},z=a=>{a.toString().replace("Error: ","")},q=I,L=()=>{Object.assign(t,T(w)),F.value.clearValidate(),i.fileList=null,c.value=!1},W=()=>{F.value.validate(a=>{if(a){if(d.value==="uploadFile"&&t.fileTransName===""){p.error(o("system.upload_font_file_de"));return}ie(t).then(()=>{p.success(b.value+o("data_set.success")),L(),q("finish")})}})};return(a,e)=>{const n=Y,C=G,J=te,_=H,k=K,$=P,X=Q,O=Z;return g(),v(X,{class:"create-dialog add-form_font_dialog",modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=N=>c.value=N),"before-close":L,title:b.value,width:"420"},{footer:l(()=>[oe("div",me,[s(_,{onClick:L},{default:l(()=>[y(h(r(o)("userimport.cancel")),1)]),_:1}),u((g(),v(_,{type:"primary",onClick:W},{default:l(()=>[y(h(r(o)("userimport.sure")),1)]),_:1})),[[O,f.value]])])]),default:l(()=>[s($,{onSubmit:e[1]||(e[1]=le(()=>{},["prevent"])),ref_key:"ruleFormRef",ref:F,model:t,"label-position":"top",rules:j,"label-width":"auto",class:"demo-ruleForm"},{default:l(()=>[d.value!=="uploadFile"?(g(),v(C,{key:0,label:r(o)("system.font_name"),prop:"name"},{default:l(()=>[s(n,{placeholder:r(o)("system.the_font_name"),modelValue:t.name,"onUpdate:modelValue":e[0]||(e[0]=N=>t.name=N),modelModifiers:{trim:!0}},null,8,["placeholder","modelValue"])]),_:1},8,["label"])):B("",!0),d.value!=="rename"?u((g(),v(C,{key:1,label:r(o)("system.font_file_de")},{default:l(()=>[u(s(k,{action:"",multiple:!1,ref:"uploadAgain","show-file-list":!1,accept:".ttf","on-change":x,"before-upload":V,"http-request":D,"on-error":z,name:"file"},{trigger:l(()=>[s(_,{secondary:""},{icon:l(()=>[s(J,{name:"icon_upload_outlined"},{default:l(()=>[s(r(se),{class:"svg-icon"})]),_:1})]),default:l(()=>[y(" "+h(r(o)("system.upload_font_file")),1)]),_:1})]),_:1},512),[[E,!i.fileList]]),u(s(re,{onDel:R,size:t.size+" "+t.sizeType,name:t.fileName},null,8,["size","name"]),[[E,i.fileList]]),u(s(k,{action:"",multiple:!1,ref:"uploadAgain","before-upload":V,"show-file-list":!1,accept:".ttf","on-change":x,"http-request":D,"on-error":z,name:"file"},{trigger:l(()=>[s(_,{text:""},{default:l(()=>[y(h(r(o)("data_source.reupload")),1)]),_:1})]),_:1},512),[[E,i.fileList]])]),_:1},8,["label"])),[[O,f.value]]):B("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}});export{ye as _};

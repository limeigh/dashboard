import{z as X}from"./index-0.0.0-dataease.js";import{E as $}from"./el-dialog-0.0.0-dataease.js";import{o as H,D as _,G as K,n as Q,y as Y}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import{E as Z}from"./el-upload-0.0.0-dataease.js";import"./el-progress-0.0.0-dataease.js";import{E as ee,a as te}from"./el-form-item-0.0.0-dataease.js";import{d as ae,X as U,r as m,f as g,g as v,i as l,P as oe,j as s,a3 as y,a4 as h,u as r,R as u,a8 as le,_ as B,U as L}from"./vue-0.0.0-dataease.js";import{i as se}from"./icon_upload_outlined-0.0.0-dataease.js";import{u as ie,e as ne}from"./font-0.0.0-dataease.js";import re from"./FontInfo-0.0.0-dataease.js";import{e as D}from"./lodash-0.0.0-dataease.js";const me={class:"dialog-footer"},Fe=ae({__name:"UploadDetail",emits:["finish"],setup(ue,{expose:S,emit:I}){const n=U({fileList:null}),f=m(!1),j=m(),{t:o}=H(),T=()=>{const a=new FormData;return a.append("file",n.fileList.raw),f.value=!0,ie(a).then(e=>{var i;t.name=e.data.name,t.size=e.data.size,t.sizeType=e.data.sizeType,t.fileTransName=e.data.fileTransName,t.fileName=n.fileList.raw.name,(i=j.value)==null||i.clearFiles()}).catch(e=>{e.code==="ECONNABORTED"&&_({type:"error",message:e.message,showClose:!0})}).finally(()=>{f.value=!1})},b=m(""),c=m(!1),d=m(""),E={id:null,name:"",fileName:"",fileTransName:"",size:0,sizeType:"",isDefault:0,isBuiltin:0,updateTime:0},t=U(D(E)),A=(a,e,i)=>{b.value=a||o("system.add_font"),d.value=e,c.value=!0,Object.assign(t,D(E)),Object.assign(t,JSON.parse(JSON.stringify(i)))},R=()=>{n.fileList=null},w=m(),q={name:[{required:!0,message:o("system.the_font_name"),trigger:"blur"},{min:1,max:50,message:o("system.character_length_1_50"),trigger:"blur"}]};S({init:A});const V=a=>a.name.toLocaleLowerCase().endsWith(".ttf")?!0:(_.error(o("system.in_ttf_format")),!1),z=a=>{var e,i;(i=(e=a.raw)==null?void 0:e.name)!=null&&i.toLocaleLowerCase().endsWith(".ttf")&&(n.fileList=a)},C=a=>{a.toString().replace("Error: ","")},M=I,F=()=>{Object.assign(t,D(E)),w.value.clearValidate(),n.fileList=null,c.value=!1},J=()=>{w.value.validate(a=>{if(a){if(d.value==="uploadFile"&&t.fileTransName===""){_.error(o("system.upload_font_file_de"));return}ne(t).then(()=>{_.success(b.value+o("data_set.success")),F(),M("finish")})}})};return(a,e)=>{const i=K,x=ee,W=Q,p=Y,k=Z,G=te,P=$,O=X;return g(),v(P,{class:"create-dialog add-form_font_dialog",modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=N=>c.value=N),"before-close":F,title:b.value,width:"420"},{footer:l(()=>[oe("div",me,[s(p,{onClick:F},{default:l(()=>[y(h(r(o)("userimport.cancel")),1)]),_:1}),u((g(),v(p,{type:"primary",onClick:J},{default:l(()=>[y(h(r(o)("userimport.sure")),1)]),_:1})),[[O,f.value]])])]),default:l(()=>[s(G,{onSubmit:e[1]||(e[1]=le(()=>{},["prevent"])),ref_key:"ruleFormRef",ref:w,model:t,"label-position":"top",rules:q,"label-width":"auto",class:"demo-ruleForm"},{default:l(()=>[d.value!=="uploadFile"?(g(),v(x,{key:0,label:r(o)("system.font_name"),prop:"name"},{default:l(()=>[s(i,{placeholder:r(o)("system.the_font_name"),modelValue:t.name,"onUpdate:modelValue":e[0]||(e[0]=N=>t.name=N),modelModifiers:{trim:!0}},null,8,["placeholder","modelValue"])]),_:1},8,["label"])):B("",!0),d.value!=="rename"?u((g(),v(x,{key:1,label:r(o)("system.font_file_de")},{default:l(()=>[u(s(k,{action:"",multiple:!1,ref:"uploadAgain","show-file-list":!1,accept:".ttf","on-change":z,"before-upload":V,"http-request":T,"on-error":C,name:"file"},{trigger:l(()=>[s(p,{secondary:""},{icon:l(()=>[s(W,{name:"icon_upload_outlined"},{default:l(()=>[s(r(se),{class:"svg-icon"})]),_:1})]),default:l(()=>[y(" "+h(r(o)("system.upload_font_file")),1)]),_:1})]),_:1},512),[[L,!n.fileList]]),u(s(re,{onDel:R,size:t.size+" "+t.sizeType,name:t.fileName},null,8,["size","name"]),[[L,n.fileList]]),u(s(k,{action:"",multiple:!1,ref:"uploadAgain","before-upload":V,"show-file-list":!1,accept:".ttf","on-change":z,"http-request":T,"on-error":C,name:"file"},{trigger:l(()=>[s(p,{text:""},{default:l(()=>[y(h(r(o)("data_source.reupload")),1)]),_:1})]),_:1},512),[[L,n.fileList]])]),_:1},8,["label"])),[[O,f.value]]):B("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}});export{Fe as _};

import{b as ve,z as he}from"./index-0.0.0-dataease.js";import{E as ge}from"./el-dialog-0.0.0-dataease.js";import{o as be,aA as ye,D as T,G as ke,n as De,j as we,y as Ve}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import{E as xe}from"./el-tree-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as Te}from"./el-tree-select-0.0.0-dataease.js";import{E as Ee,a as Ce}from"./el-form-item-0.0.0-dataease.js";import{d as Fe,X as $,r as n,w as Ne,y as E,f as v,g as C,i as o,j as r,a3 as H,a4 as k,u as c,R as qe,_ as F,P as h,O as X,a9 as Se,a8 as Ie,n as J}from"./vue-0.0.0-dataease.js";import{d as Q}from"./dv-folder-0.0.0-dataease.js";import{i as Le}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{t as Re}from"./treeSortUtils-0.0.0-dataease.js";import{a as Ae,m as Be,O as Ge,P as Me}from"./dataset-0.0.0-dataease.js";import{n as Ue}from"./nothing-tree-0.0.0-dataease.js";import{e as Pe}from"./lodash-0.0.0-dataease.js";import{_ as Oe}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./index-0.0.0-dataease3.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./token-0.0.0-dataease.js";import"./index-0.0.0-dataease15.js";import"./index-0.0.0-dataease4.js";import"./index-0.0.0-dataease6.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease5.js";const je=["title"],ze={key:2},Ke={class:"tree-content"},$e={class:"custom-tree-node"},He=["title"],Xe={key:0,class:"empty-search"},Je=["src"],Qe=Fe({__name:"CreatDsGroup",emits:["finish","onDatasetSave"],setup(We,{expose:W,emit:Y}){const{t:a}=be(),{wsCache:S}=ve(),u=$({tData:[],nameList:[]}),D=n(""),f=n(),m=n(),g=n(),i=n(""),N=n(),w=n("");let I=[],L=[],R=!1;const s=$({pid:"",name:""}),A=n(!1),Z=(t,e)=>(J(()=>{A.value=N.value.isEmpty}),t?e.name.includes(t):!0);Ne(w,t=>{oe.value=!t,N.value.filter(t),J(()=>{document.querySelectorAll(".node-text").forEach(e=>{const d=e.getAttribute("title");e.innerHTML=d.replace(t,`<span class="highLight">${t}</span>`)})})});const ee=E(()=>f.value==="folder"&&m.value?!1:!["rename","move"].includes(i.value)&&!!m.value),te=E(()=>f.value==="folder"?a("deDataset.folder_name"):a("dataset.name")),ae=E(()=>{let t="";switch(f.value){case"folder":t=a("deDataset.new_folder");break;case"dataset":t=a("common.save")+a("auth.dataset");break}switch(i.value){case"move":t=a("chart.move_to");break;case"rename":t=a("chart.rename");break}return t}),se=E(()=>i.value!=="move"),B=n(),G=n(!1),oe=n(!0),V=n(),q=n(!1),b=n(!1),le=(t,e)=>e.name.includes(t),M=()=>{b.value=!1},U=t=>{t==null||t.forEach(e=>{var d;e.value=e.id,(d=e.children)!=null&&d.length&&U(e.children)})},ne=(t,e)=>e!=null&&e.length?t==="0"&&e[0].id!=="0"?e[0].id:t:"",P=n([]),re=["time_asc","time_desc","name_asc","name_desc"],ie=(t,e,d,p)=>{m.value="",g.value="",i.value="",s.pid="",s.name="",w.value="",f.value=t,D.value=a(t==="folder"?"data_set.a_folder_name":"data_set.the_dataset_name"),t==="dataset"&&(I=e.union,L=e.allfields,R=e.isCross),e.id&&(Ae({leaf:!1,weight:7}).then(_=>{ye(_,"dataset"),U(_),u.tData=_||[];let y=re[Number(S.get("TreeSort-backend"))??1];y=S.get("TreeSort-dataset")??y,P.value=Pe(c(u.tData)),u.tData=Re(P.value,y),u.tData.length&&u.tData[0].name==="root"&&u.tData[0].id==="0"&&(u.tData[0].name=a("data_set.data_set")),e.id=ne(e.id,u.tData),d?(m.value=e.pid,g.value=e.id,s.pid=e.pid,s.name=e.name):(s.pid=e.id,m.value=e.id)}),i.value=d),p&&(s.name=p),b.value=!0,B.value={name:[{required:!0,message:D.value,trigger:"change"},{required:!0,message:D.value,trigger:"blur"},{min:1,max:64,message:a("datasource.input_limit_1_64",[1,64]),trigger:"blur"}],pid:[{required:!0,message:a("common.please_select"),trigger:"blur"}]},setTimeout(()=>{V.value.clearValidate()},50)},de=t=>{m.value=t.pid,g.value=t.id},O={label:"name",children:"children",isLeaf:t=>{var e;return!((e=t.children)!=null&&e.length)}},j=t=>{G.value=!1,s.pid=t.id},ue=t=>t!==0&&!t?(T.error(a("data_set.the_destination_folder")),!1):!0,ce=()=>{V.value.validate(t=>{if(t){const e={nodeType:f.value,name:s.name};switch(i.value){case"move":e.pid=G.value?"0":s.pid,e.id=g.value;break;case"rename":e.pid=m.value,e.id=g.value;break;default:e.pid=s.pid||m.value||"0";break}if(f.value==="dataset"&&(e.union=I,e.allFields=L,e.isCross=R),i.value==="move"&&!ue(e.pid))return;q.value=!0,(i.value==="move"?Be:e.id?Ge:Me)(e).then(p=>{switch(V.value.resetFields(),b.value=!1,z("finish",p),i.value){case"move":T.success(a("data_set.moved_successfully"));break;case"rename":T.success(a("data_set.rename_successful"));break;default:z("onDatasetSave"),T.success(a("common.save_success"));break}}).finally(()=>{q.value=!1})}})};W({createInit:ie,editeInit:de});const z=Y;return(t,e)=>{const d=ke,p=Ee,x=De,_=we,y=Te,me=xe,pe=Ce,K=Ve,_e=ge,fe=he;return v(),C(_e,{title:ae.value,modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=l=>b.value=l),class:"create-dialog",width:i.value==="move"?"600px":"420px","before-close":M},{footer:o(()=>[r(K,{secondary:"",onClick:M},{default:o(()=>[H(k(c(a)("dataset.cancel")),1)]),_:1}),qe((v(),C(K,{type:"primary",onClick:ce},{default:o(()=>[H(k(c(a)("dataset.confirm")),1)]),_:1})),[[fe,q.value]])]),default:o(()=>[r(pe,{"label-position":"top","require-asterisk-position":"right",ref_key:"dataset",ref:V,onKeydown:e[4]||(e[4]=Se(Ie(()=>{},["stop","prevent"]),["enter"])),model:s,rules:B.value},{default:o(()=>[se.value?(v(),C(p,{key:0,label:te.value,prop:"name"},{default:o(()=>[r(d,{placeholder:D.value,modelValue:s.name,"onUpdate:modelValue":e[0]||(e[0]=l=>s.name=l)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])):F("",!0),ee.value?(v(),C(p,{key:1,label:c(a)("deDataset.folder"),prop:"pid"},{default:o(()=>[r(y,{modelValue:s.pid,"onUpdate:modelValue":e[1]||(e[1]=l=>s.pid=l),data:u.tData,"popper-class":"dataset-tree-select","render-after-expand":!1,style:{width:"100%"},props:O,onNodeClick:j,"filter-node-method":le,filterable:""},{default:o(({data:{name:l}})=>[r(_,null,{default:o(()=>[r(x,{name:"dv-folder"},{default:o(()=>[r(c(Q),{class:"svg-icon"})]),_:1})]),_:1}),h("span",{title:l},k(l),9,je)]),_:1},8,["modelValue","data"])]),_:1},8,["label"])):F("",!0),i.value==="move"?(v(),X("div",ze,[r(d,{style:{"margin-bottom":"12px"},modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=l=>w.value=l),clearable:""},{prefix:o(()=>[r(_,null,{default:o(()=>[r(x,{name:"icon_search-outline_outlined"},{default:o(()=>[r(c(Le),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue"]),h("div",Ke,[r(me,{ref_key:"treeRef",ref:N,"filter-node-method":Z,filterable:"",modelValue:s.pid,"onUpdate:modelValue":e[3]||(e[3]=l=>s.pid=l),menu:"","empty-text":"",data:u.tData,props:O,onNodeClick:j},{default:o(({data:l})=>[h("span",$e,[r(_,{style:{"font-size":"18px"}},{default:o(()=>[r(x,{name:"dv-folder"},{default:o(()=>[r(c(Q),{class:"svg-icon"})]),_:1})]),_:1}),h("span",{class:"node-text",title:l.name},k(l.name),9,He)])]),_:1},8,["modelValue","data"]),A.value?(v(),X("div",Xe,[h("img",{src:c(Ue)},null,8,Je),h("span",null,k(c(a)("data_set.relevant_content_found")),1)])):F("",!0)])])):F("",!0)]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","width"])}}});const Nt=Oe(Qe,[["__scopeId","data-v-068a2634"]]);export{Nt as default};

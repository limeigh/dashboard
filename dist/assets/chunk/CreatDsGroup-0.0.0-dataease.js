import{E as V,r as he,w as ge,e as be,s as ke,t as ye,x as De,i as we,M as xe,v as Te}from"./element-plus-secondary-0.0.0-dataease.js";import{f as Ve,e as Ce}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as Ee,l as H,r,w as Ne,k as C,o as v,T as E,U as s,W as i,_ as W,Y as y,u,$ as Fe,R as N,a as h,c as X,a9 as Se,X as qe,n as Y}from"./@vue-0.0.0-dataease.js";import{d as j}from"./dv-folder-0.0.0-dataease.js";import{i as Ie}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{t as Le}from"./treeSortUtils-0.0.0-dataease.js";import{a as Me,D as Re,g as J}from"./index-0.0.0-dataease.js";import{g as Ue,m as Be,N as Ae,O as Ge}from"./dataset-0.0.0-dataease.js";import{n as Pe}from"./nothing-tree-0.0.0-dataease.js";import{h as $e}from"./lodash-es-0.0.0-dataease.js";import{_ as Ke}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./pinia-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./fast-png-0.0.0-dataease.js";import"./iobuffer-0.0.0-dataease.js";import"./pako-0.0.0-dataease.js";import"./vue-router_2-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";import"./js-base64-0.0.0-dataease.js";const Oe=["title"],ze={key:2},He={class:"tree-content"},We={class:"custom-tree-node"},Xe=["title"],Ye={key:0,class:"empty-search"},je=["src"],Je=Ee({__name:"CreatDsGroup",emits:["finish","onDatasetSave"],setup(Qe,{expose:Q,emit:Z}){const{t:a}=Ve(),{wsCache:q}=Me(),d=H({tData:[],nameList:[]}),D=r(""),f=r(),c=r(),g=r(),n=r(""),F=r(),w=r("");let I=[],L=[],M=!1;const o=H({pid:"",name:""}),R=r(!1),ee=(t,e)=>(Y(()=>{R.value=F.value.isEmpty}),t?e.name.includes(t):!0);Ne(w,t=>{le.value=!t,F.value.filter(t),Y(()=>{document.querySelectorAll(".node-text").forEach(e=>{const m=e.getAttribute("title");e.innerHTML=m.replace(t,`<span class="highLight">${t}</span>`)})})});const te=C(()=>f.value==="folder"&&c.value?!1:!["rename","move"].includes(n.value)&&!!c.value),ae=C(()=>f.value==="folder"?a("deDataset.folder_name"):a("dataset.name")),oe=C(()=>{let t="";switch(f.value){case"folder":t=a("deDataset.new_folder");break;case"dataset":t=a("common.save")+a("auth.dataset");break}switch(n.value){case"move":t=a("chart.move_to");break;case"rename":t=a("chart.rename");break}return t}),se=C(()=>n.value!=="move"),U=r(),B=r(!1),le=r(!0),x=r(),S=r(!1),b=r(!1),re=(t,e)=>e.name.includes(t),A=()=>{b.value=!1},G=t=>{t==null||t.forEach(e=>{var m;e.value=e.id,(m=e.children)!=null&&m.length&&G(e.children)})},ie=(t,e)=>e!=null&&e.length?t==="0"&&e[0].id!=="0"?e[0].id:t:"",P=r([]),ne=["time_asc","time_desc","name_asc","name_desc"],me=(t,e,m,p)=>{c.value="",g.value="",n.value="",o.pid="",o.name="",w.value="",f.value=t,D.value=a(t==="folder"?"data_set.a_folder_name":"data_set.the_dataset_name"),t==="dataset"&&(I=e.union,L=e.allfields,M=e.isCross),e.id&&(Ue({leaf:!1,weight:7}).then(_=>{Re(_,"dataset"),G(_),d.tData=_||[];let k=ne[Number(q.get(J("TreeSort-backend")))??1];k=q.get(J("TreeSort-dataset"))??k,P.value=$e(u(d.tData)),d.tData=Le(P.value,k),d.tData.length&&d.tData[0].name==="root"&&d.tData[0].id==="0"&&(d.tData[0].name=a("data_set.data_set")),e.id=ie(e.id,d.tData),m?(c.value=e.pid,g.value=e.id,o.pid=e.pid,o.name=e.name):(o.pid=e.id,c.value=e.id)}),n.value=m),p&&(o.name=p),b.value=!0,U.value={name:[{required:!0,message:D.value,trigger:"change"},{required:!0,message:D.value,trigger:"blur"},{min:1,max:64,message:a("datasource.input_limit_1_64",[1,64]),trigger:"blur"}],pid:[{required:!0,message:a("common.please_select"),trigger:"blur"}]},setTimeout(()=>{x.value.clearValidate()},50)},de=t=>{c.value=t.pid,g.value=t.id},$={label:"name",children:"children",isLeaf:t=>{var e;return!((e=t.children)!=null&&e.length)}},K=t=>{B.value=!1,o.pid=t.id},ue=t=>t!==0&&!t?(V.error(a("data_set.the_destination_folder")),!1):!0,ce=()=>{x.value.validate(t=>{if(t){const e={nodeType:f.value,name:o.name};switch(n.value){case"move":e.pid=B.value?"0":o.pid,e.id=g.value;break;case"rename":e.pid=c.value,e.id=g.value;break;default:e.pid=o.pid||c.value||"0";break}if(f.value==="dataset"&&(e.union=I,e.allFields=L,e.isCross=M),n.value==="move"&&!ue(e.pid))return;S.value=!0,(n.value==="move"?Be:e.id?Ae:Ge)(e).then(p=>{switch(x.value.resetFields(),b.value=!1,O("finish",p),n.value){case"move":V.success(a("data_set.moved_successfully"));break;case"rename":V.success(a("data_set.rename_successful"));break;default:O("onDatasetSave"),V.success(a("common.save_success"));break}}).finally(()=>{S.value=!1})}})};Q({createInit:me,editeInit:de});const O=Z;return(t,e)=>{const m=he,p=ge,T=Ce,_=be,k=ke,pe=ye,_e=De,z=we,fe=xe,ve=Te;return v(),E(fe,{title:oe.value,modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=l=>b.value=l),class:"create-dialog",width:n.value==="move"?"600px":"420px","before-close":A},{footer:s(()=>[i(z,{secondary:"",onClick:A},{default:s(()=>[W(y(u(a)("dataset.cancel")),1)]),_:1}),Fe((v(),E(z,{type:"primary",onClick:ce},{default:s(()=>[W(y(u(a)("dataset.confirm")),1)]),_:1})),[[ve,S.value]])]),default:s(()=>[i(_e,{"label-position":"top","require-asterisk-position":"right",ref_key:"dataset",ref:x,onKeydown:e[4]||(e[4]=Se(qe(()=>{},["stop","prevent"]),["enter"])),model:o,rules:U.value},{default:s(()=>[se.value?(v(),E(p,{key:0,label:ae.value,prop:"name"},{default:s(()=>[i(m,{placeholder:D.value,modelValue:o.name,"onUpdate:modelValue":e[0]||(e[0]=l=>o.name=l)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])):N("",!0),te.value?(v(),E(p,{key:1,label:u(a)("deDataset.folder"),prop:"pid"},{default:s(()=>[i(k,{modelValue:o.pid,"onUpdate:modelValue":e[1]||(e[1]=l=>o.pid=l),data:d.tData,"popper-class":"dataset-tree-select","render-after-expand":!1,style:{width:"100%"},props:$,onNodeClick:K,"filter-node-method":re,filterable:""},{default:s(({data:{name:l}})=>[i(_,null,{default:s(()=>[i(T,{name:"dv-folder"},{default:s(()=>[i(u(j),{class:"svg-icon"})]),_:1})]),_:1}),h("span",{title:l},y(l),9,Oe)]),_:1},8,["modelValue","data"])]),_:1},8,["label"])):N("",!0),n.value==="move"?(v(),X("div",ze,[i(m,{style:{"margin-bottom":"12px"},modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=l=>w.value=l),clearable:""},{prefix:s(()=>[i(_,null,{default:s(()=>[i(T,{name:"icon_search-outline_outlined"},{default:s(()=>[i(u(Ie),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue"]),h("div",He,[i(pe,{ref_key:"treeRef",ref:F,"filter-node-method":ee,filterable:"",modelValue:o.pid,"onUpdate:modelValue":e[3]||(e[3]=l=>o.pid=l),menu:"","empty-text":"",data:d.tData,props:$,onNodeClick:K},{default:s(({data:l})=>[h("span",We,[i(_,{style:{"font-size":"18px"}},{default:s(()=>[i(T,{name:"dv-folder"},{default:s(()=>[i(u(j),{class:"svg-icon"})]),_:1})]),_:1}),h("span",{class:"node-text",title:l.name},y(l.name),9,Xe)])]),_:1},8,["modelValue","data"]),R.value?(v(),X("div",Ye,[h("img",{src:u(Pe)},null,8,je),h("span",null,y(u(a)("data_set.relevant_content_found")),1)])):N("",!0)])])):N("",!0)]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","width"])}}});const ia=Ke(Je,[["__scopeId","data-v-07602e4f"]]);export{ia as default};

import{i as Z}from"./imgUtils-0.0.0-dataease.js";import{d as $}from"./dvMain-0.0.0-dataease.js";import{b as H}from"./chart-0.0.0-dataease2.js";import{p as x}from"./chart-0.0.0-dataease.js";import{m as K}from"./index-0.0.0-dataease12.js";import{s as Q}from"./pinia-0.0.0-dataease.js";import X from"./ChartEmptyInfo-0.0.0-dataease.js";import Y from"./ChartError-0.0.0-dataease.js";import{d as D,l as b,r as u,t as k,k as C,w as F,a7 as tt,o as c,c as L,T,Z as ot,u as A,n as f}from"./@vue-0.0.0-dataease.js";import{_ as et}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./html2canvas-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./fast-png-0.0.0-dataease.js";import"./iobuffer-0.0.0-dataease.js";import"./pako-0.0.0-dataease.js";import"./index-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./element-plus-secondary-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./lodash-es-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";import"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./vue-router_2-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./util-0.0.0-dataease.js";import"./snowflake-id-0.0.0-dataease.js";import"./file-saver-0.0.0-dataease.js";import"./html-to-image-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./login-0.0.0-dataease.js";import"./less-0.0.0-dataease.js";import"./tslib-0.0.0-dataease.js";import"./copy-anything-0.0.0-dataease.js";import"./is-what-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./dataset-0.0.0-dataease.js";import"./js-base64-0.0.0-dataease.js";import"./app-0.0.0-dataease.js";import"./decimal.js-0.0.0-dataease.js";import"./@antv-0.0.0-dataease.js";import"./eventemitter3-0.0.0-dataease.js";import"./@mapbox-0.0.0-dataease.js";import"./pbf-0.0.0-dataease.js";import"./ieee754-0.0.0-dataease.js";import"./supercluster-0.0.0-dataease.js";import"./gl-matrix-0.0.0-dataease.js";import"./detect-browser-0.0.0-dataease.js";import"./size-sensor-0.0.0-dataease.js";import"./d3-regression-0.0.0-dataease.js";import"./d3-hierarchy-0.0.0-dataease.js";import"./fmin-0.0.0-dataease.js";import"./pdfast-0.0.0-dataease.js";import"./d3-ease-0.0.0-dataease.js";import"./d3-interpolate-0.0.0-dataease.js";import"./d3-color-0.0.0-dataease.js";import"./d3-timer-0.0.0-dataease.js";import"./fecha-0.0.0-dataease.js";import"./topojson-client-0.0.0-dataease.js";import"./viewport-mercator-project-0.0.0-dataease.js";import"./@turf-0.0.0-dataease.js";import"./polygon-clipping-0.0.0-dataease.js";import"./splaytree-0.0.0-dataease.js";import"./robust-predicates-0.0.0-dataease.js";import"./d3-scale-0.0.0-dataease.js";import"./d3-collection-0.0.0-dataease.js";import"./d3-format-0.0.0-dataease.js";import"./d3-time-format-0.0.0-dataease.js";import"./d3-time-0.0.0-dataease.js";import"./d3-array-0.0.0-dataease.js";import"./earcut-0.0.0-dataease.js";import"./regl-0.0.0-dataease.js";import"./mapbox-gl-0.0.0-dataease.js";import"./d3-dsv-0.0.0-dataease.js";import"./geojson-vt-0.0.0-dataease.js";import"./hammerjs-0.0.0-dataease.js";import"./element-resize-detector-0.0.0-dataease.js";import"./batch-processor-0.0.0-dataease.js";import"./d3-hexbin-0.0.0-dataease.js";import"./mathjs-0.0.0-dataease.js";import"./typed-function-0.0.0-dataease.js";import"./complex.js-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./exceljs-0.0.0-dataease.js";import"./chart-dark-list-0.0.0-dataease.js";import"./chart-list-0.0.0-dataease.js";const rt={class:"pic-main"},it=["src"],pt=D({__name:"Component",props:{element:{type:Object,default(){return{propValue:{urlList:[]}}}},showPosition:{required:!1,type:String,default:"preview"},searchCount:{type:Number,required:!1,default:0},view:{type:Object,default(){return{propValue:null}}}},setup(E,{expose:U}){const R=$(),{canvasViewInfo:J,mobileInPc:M,fullscreenFlag:B}=Q(R),m=b({emptyValue:"-",data:null,viewDataInfo:null,showUrl:null,firstRender:!0,previewFirstRender:!0,curImgList:[]}),a=u(!0),S=E,h=u(!1),V=u(""),P=u({}),g=u({}),w=u([]);let s=null;const{element:p,view:l,showPosition:N}=k(S);let d=null;const O=C(()=>N.value.includes("canvas")&&!M.value&&!B.value);F([()=>S.searchCount],()=>{d||I(l.value,()=>{})});const q=(o=!1,e="minute",i=5)=>{if(N.value==="preview"&&!d&&o){d&&clearInterval(d);const r=e==="second"?i*1e3:i*6e4;d=setInterval(()=>{I(l.value,()=>{})},r)}};F(()=>O.value,()=>{y()});const y=()=>{var i,r;s&&clearInterval(s),s=null;const o=((i=p.value.propValue.urlList)==null?void 0:i.length)||0,{threshold:e}=x(l.value.senior);if(!O.value&&!e.enable&&o>0&&((r=p.value.carousel)!=null&&r.enable)){const t=(p.value.carousel.time||5)*1e3;let n=1;s=setInterval(()=>{const v=n%p.value.propValue.urlList.length;n++,f(()=>{m.showUrl=p.value.propValue.urlList[v].url})},t)}},j=C(()=>{const o={position:"relative",width:"100%",height:"100%"};return p.value.style.adaptation==="original"?(o.width="auto",o.height="auto"):p.value.style.adaptation==="equiratio"&&(o.height="auto"),o}),z=o=>{if(w.value=[],P.value={},g.value={},o.data&&o.data.sourceFields){const e=JSON.stringify(o.xAxis)+JSON.stringify(o.xAxisExt)+JSON.stringify(o.yAxis)+JSON.stringify(o.yAxisExt);o.data.sourceFields.forEach(t=>{e.indexOf(t.id)>-1&&w.value.push(`[${t.name}]`)}),e.indexOf('"记录数*"')>-1&&w.value.push("[记录数*]");const i=o.data.fields.reduce((t,n)=>(t[n.dataeaseName]=n.name,t),{}),r=o.data.tableRow[0];for(const t in r)g.value[i[t]]=r[t]}G(l.value)},G=o=>{if(m.showUrl=null,!o||!o.senior)return;const{threshold:e}=x(o.senior);if(!e.enable)return;const i=e.tableThreshold??[];if((i==null?void 0:i.length)>0)for(let r=0;r<i.length;r++){const t=i[r];let n=null;const v=K(g.value[t.field.name],n,t,"url");v&&(m.showUrl=v)}},_=()=>{p.value.propValue.urlList&&p.value.propValue.urlList.length>0&&(m.showUrl=p.value.propValue.urlList[0].url),y()},I=(o,e)=>{h.value=!1;const{threshold:i}=x(o.senior);if(!i.enable){_(),e==null||e();return}if(o.tableId||o.dataFrom==="template"){const r=JSON.parse(JSON.stringify(o));r.type="table-info",r.render="antv",r.resultCount=1,H(r).then(t=>{if(t.code&&t.code!==0)h.value=!0,V.value=t.msg;else{t.type="picture-group",t.render="custom",m.data=t==null?void 0:t.data,m.viewDataInfo=t,m.totalItems=t==null?void 0:t.totalItems;const n=J.value[p.value.id];n.curFields=t.data.fields,R.setViewDataDetails(p.value.id,t),a.value=!0,z(t),y()}e==null||e(),f(()=>{a.value=!0})}).catch(t=>{console.error(t),f(()=>{a.value=!0}),e==null||e()})}else o.tableId?(_(),f(()=>{a.value=!0}),e==null||e()):(a.value=!0,_(),e==null||e(),f(()=>{a.value=!0}))},W=()=>{};return tt(()=>{s&&(clearInterval(s),s=null),q()}),U({calcData:I,renderChart:W}),(o,e)=>(c(),L("div",rt,[h.value?(c(),T(Y,{key:0,"err-msg":V.value},null,8,["err-msg"])):m.showUrl?(c(),L("img",{key:1,draggable:"false",style:ot(j.value),src:A(Z)(m.showUrl)},null,12,it)):(c(),T(X,{key:2,"view-icon":A(l).type},null,8,["view-icon"]))]))}});const Ne=et(pt,[["__scopeId","data-v-a6a88b5f"]]);export{Ne as default};

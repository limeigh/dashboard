import{i as X}from"./imgUtils-0.0.0-dataease.js";import{d as $}from"./dvMain-0.0.0-dataease.js";import{b as H}from"./chart-0.0.0-dataease2.js";import{p as x}from"./chart-0.0.0-dataease.js";import{m as K}from"./index-0.0.0-dataease21.js";import{d as Q,af as Y,X as Z,r as p,t as D,y as C,w as F,aj as b,f as c,O as L,g as T,T as k,u as A,n as f}from"./vue-0.0.0-dataease.js";import ee from"./ChartEmptyInfo-0.0.0-dataease.js";import te from"./ChartError-0.0.0-dataease.js";import{_ as oe}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./index-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./util-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./tslib.es6-0.0.0-dataease.js";import"./antv-0.0.0-dataease.js";import"./dataset-0.0.0-dataease.js";import"./app-0.0.0-dataease.js";import"./decimal-0.0.0-dataease.js";import"./index-0.0.0-dataease22.js";import"./pureFunctionsAny.generated-0.0.0-dataease.js";import"./extends-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./el-col-0.0.0-dataease.js";import"./constants-0.0.0-dataease.js";import"./el-row-0.0.0-dataease.js";import"./_commonjs-dynamic-modules-0.0.0-dataease.js";import"./chart-dark-list-0.0.0-dataease.js";import"./chart-list-0.0.0-dataease.js";import"./el-dialog-0.0.0-dataease.js";import"./index-0.0.0-dataease3.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./el-main-0.0.0-dataease.js";import"./index-0.0.0-dataease16.js";const re={class:"pic-main"},ie=["src"],ne=Q({__name:"Component",props:{element:{type:Object,default(){return{propValue:{urlList:[]}}}},showPosition:{required:!1,type:String,default:"preview"},searchCount:{type:Number,required:!1,default:0},view:{type:Object,default(){return{propValue:null}}}},setup(E,{expose:U}){const R=$(),{canvasViewInfo:J,mobileInPc:M,fullscreenFlag:B}=Y(R),s=Z({emptyValue:"-",data:null,viewDataInfo:null,showUrl:null,firstRender:!0,previewFirstRender:!0,curImgList:[]}),l=p(!0),S=E,h=p(!1),V=p(""),P=p({}),g=p({}),w=p([]);let u=null;const{element:n,view:m,showPosition:O}=D(S);let d=null;const N=C(()=>O.value.includes("canvas")&&!M.value&&!B.value);F([()=>S.searchCount],()=>{d||I(m.value,()=>{})});const j=(t=!1,o="minute",i=5)=>{if(O.value==="preview"&&!d&&t){d&&clearInterval(d);const r=o==="second"?i*1e3:i*6e4;d=setInterval(()=>{I(m.value,()=>{})},r)}};F(()=>N.value,()=>{y()});const y=()=>{var i,r;u&&clearInterval(u),u=null;const t=((i=n.value.propValue.urlList)==null?void 0:i.length)||0,{threshold:o}=x(m.value.senior);if(!N.value&&!o.enable&&t>0&&((r=n.value.carousel)!=null&&r.enable)){const e=(n.value.carousel.time||5)*1e3;let a=1;u=setInterval(()=>{const v=a%n.value.propValue.urlList.length;a++,f(()=>{s.showUrl=n.value.propValue.urlList[v].url})},e)}},q=C(()=>{const t={position:"relative",width:"100%",height:"100%"};return n.value.style.adaptation==="original"?(t.width="auto",t.height="auto"):n.value.style.adaptation==="equiratio"&&(t.height="auto"),t}),z=t=>{if(w.value=[],P.value={},g.value={},t.data&&t.data.sourceFields){const o=JSON.stringify(t.xAxis)+JSON.stringify(t.xAxisExt)+JSON.stringify(t.yAxis)+JSON.stringify(t.yAxisExt);t.data.sourceFields.forEach(e=>{o.indexOf(e.id)>-1&&w.value.push(`[${e.name}]`)}),o.indexOf('"记录数*"')>-1&&w.value.push("[记录数*]");const i=t.data.fields.reduce((e,a)=>(e[a.dataeaseName]=a.name,e),{}),r=t.data.tableRow[0];for(const e in r)g.value[i[e]]=r[e]}G(m.value)},G=t=>{if(s.showUrl=null,!t||!t.senior)return;const{threshold:o}=x(t.senior);if(!o.enable)return;const i=o.tableThreshold??[];if((i==null?void 0:i.length)>0)for(let r=0;r<i.length;r++){const e=i[r];let a=null;const v=K(g.value[e.field.name],a,e,"url");v&&(s.showUrl=v)}},_=()=>{n.value.propValue.urlList&&n.value.propValue.urlList.length>0&&(s.showUrl=n.value.propValue.urlList[0].url),y()},I=(t,o)=>{h.value=!1;const{threshold:i}=x(t.senior);if(!i.enable){_(),o==null||o();return}if(t.tableId||t.dataFrom==="template"){const r=JSON.parse(JSON.stringify(t));r.type="table-info",r.render="antv",r.resultCount=1,H(r).then(e=>{if(e.code&&e.code!==0)h.value=!0,V.value=e.msg;else{e.type="picture-group",e.render="custom",s.data=e==null?void 0:e.data,s.viewDataInfo=e,s.totalItems=e==null?void 0:e.totalItems;const a=J.value[n.value.id];a.curFields=e.data.fields,R.setViewDataDetails(n.value.id,e),l.value=!0,z(e),y()}o==null||o(),f(()=>{l.value=!0})}).catch(e=>{console.error(e),f(()=>{l.value=!0}),o==null||o()})}else t.tableId?(_(),f(()=>{l.value=!0}),o==null||o()):(l.value=!0,_(),o==null||o(),f(()=>{l.value=!0}))},W=()=>{};return b(()=>{u&&(clearInterval(u),u=null),j()}),U({calcData:I,renderChart:W}),(t,o)=>(c(),L("div",re,[h.value?(c(),T(te,{key:0,"err-msg":V.value},null,8,["err-msg"])):s.showUrl?(c(),L("img",{key:1,draggable:"false",style:k(q.value),src:A(X)(s.showUrl)},null,12,ie)):(c(),T(ee,{key:2,"view-icon":A(m).type},null,8,["view-icon"]))]))}});const Qe=oe(ne,[["__scopeId","data-v-a6a88b5f"]]);export{Qe as default};

import{p as re,aE as ie}from"./index-0.0.0-dataease.js";import{E as ce}from"./el-drawer-0.0.0-dataease.js";import{o as me,x as N,D as S,n as R,y as pe,j as de,G as ue}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import{E as fe,a as _e}from"./el-form-item-0.0.0-dataease.js";import"./el-input-number-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{d as ge,r as _,X as T,f as O,g as ke,i as n,P as p,j as s,a3 as $,a4 as g,u as l,a8 as V,O as U,a6 as ve,W as ye,T as he}from"./vue-0.0.0-dataease.js";import{d as Ee}from"./de-copy-0.0.0-dataease.js";import{i as be}from"./icon_refresh_outlined-0.0.0-dataease.js";import{i as xe}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import{i as Le}from"./icon_add_outlined-0.0.0-dataease.js";import{d as q}from"./dv-info-0.0.0-dataease.js";import{u as Te}from"./index-0.0.0-dataease19.js";import{E as Ve}from"./index-0.0.0-dataease4.js";import{E as Ce}from"./index-0.0.0-dataease20.js";import{_ as Ne}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./index-0.0.0-dataease3.js";import"./use-dialog-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./index-0.0.0-dataease18.js";const Se={class:"ticket-row ticket-tips-label"},Oe=["title"],$e={class:"ticket-form-info-tips"},Ie={class:"custom-form-item__label"},Fe={class:"ticket-form-info-tips"},Ae={class:"custom-form-item__label"},we=["onClick"],Be={class:"ticket-add"},Je={class:"dialog-footer"},Re=ge({__name:"TicketEdit",props:{uuid:re.string.def("")},emits:["saved"],setup(z,{expose:D,emit:j}){const{toClipboard:M}=Te(),{t:r}=me(),k=_(!1),I=_(null),h=_(),F=_([]),P=z,E=_(!1),C=_(""),o=T({form:T({ticket:"",exp:30,args:""}),argList:T([{name:"",val:""}])}),G=T({exp:[{required:!0,message:r("common.require"),trigger:"blur"}]}),A=j,W=async e=>{e&&await e.validate(t=>{if(t){ee();const a={uuid:P.uuid,ticket:o.form.ticket,exp:o.form.exp,args:o.form.args};H(),N.post({url:"/ticket/saveTicket",data:a}).then(i=>{i.msg||(S.success(r("common.save_success")),A("saved"),X()),B()}).catch(()=>{B()})}})},w=e=>{e&&(e.resetFields(),k.value=!1)},X=()=>{w(h.value)},H=()=>{I.value=ie.service({target:".ticket-param-drawer"})},B=()=>{var e;(e=I.value)==null||e.close()},K=(e,t)=>{if(ne(),C.value=t,E.value=!!(e!=null&&e.ticket),!E.value){J(),k.value=!0;return}for(const a in e)o.form.hasOwnProperty(a)&&(o.form[a]=e[a]);o.form.args&&Z(),k.value=!0},J=()=>{const e="/ticket/tempTicket";N.get({url:e}).then(t=>{o.form.ticket=t.data})},Q=()=>{const e={name:"",val:""};o.argList.push(e)},Y=e=>{if(o.argList.length===1){o.argList[e].name="",o.argList[e].val="";return}o.argList.splice(e,1)},Z=()=>{var t;if(!o.form.args)return;const e=JSON.parse(o.form.args);for(const a in e){const i=e[a];if(i&&Array.isArray(i)){const u={name:a,val:JSON.stringify(i)};o.argList.push(u)}else{const c={name:a,val:JSON.stringify([i])};o.argList.push(c)}}((t=o.argList)==null?void 0:t.length)>1&&!o.argList[0].name&&o.argList.splice(0,1)},ee=()=>{var t;if(!((t=o.argList)!=null&&t.length)){o.form.args="";return}const e={};o.argList.forEach(a=>{a.name&&a.val&&(e[a.name]=JSON.parse(a.val))}),o.form.args=JSON.stringify(e)},te=(e,t,a)=>{let i=!!a;if(!(t!=null&&t.length))i=!0;else if(a===null||typeof a>"u")try{JSON.parse(t),i=!0}catch{i=!1}const c=F[e].input,b="link-ticket-error-msg",v=`.${b}`;if(i){c.style=null,c.style.borderColor=null;const d=c.parentElement.querySelector(v);d&&(c.parentElement.style=null,c.parentElement.removeChild(d))}else{const d="JSON格式错误";c.style.color="red",c.style.borderColor="red",c.parentElement.style["box-shadow"]="0 0 0 1px red inset";const x=c.parentElement.querySelector(v);if(x)x.innerText=d;else{const y=document.createElement("div");y.className=b,y.innerText=d,c.parentElement.appendChild(y)}}},oe=(e,t)=>{e&&(F[t]=e)},se=async e=>{const t=`${C.value}?ticket=${e}`;try{await M(t),S.success(r("common.copy_success"))}catch(a){S.warning(r("common.copy_unsupported"),a)}},ae=()=>{if(!E.value){J();return}const e="/ticket/saveTicket",t={ticket:o.form.ticket};t.generateNew=!0,N.post({url:e,data:t}).then(a=>{o.form.ticket=a.data,A("saved")})},ne=()=>{o.form={ticket:"",exp:30,args:""},o.argList=[{name:"",val:""}],E.value=!1,C.value=""};return D({edit:K}),(e,t)=>{const a=R,i=pe,u=Ve,c=de,b=Ce,v=fe,d=ue,x=R,y=_e,le=ce;return O(),ke(le,{title:`${l(r)("commons.add")} Ticket`,modelValue:k.value,"onUpdate:modelValue":t[4]||(t[4]=m=>k.value=m),"modal-class":"ticket-param-drawer",size:"600px",direction:"rtl"},{footer:n(()=>[p("span",Je,[s(i,{secondary:"",onClick:t[2]||(t[2]=m=>w(h.value))},{default:n(()=>[$(g(l(r)("common.cancel")),1)]),_:1}),s(i,{type:"primary",onClick:t[3]||(t[3]=m=>W(h.value))},{default:n(()=>[$(g(l(r)("commons.save")),1)]),_:1})])]),default:n(()=>[s(y,{ref_key:"ticketForm",ref:h,"require-asterisk-position":"right",model:o.form,rules:G,"label-width":"80px","label-position":"top"},{default:n(()=>[t[5]||(t[5]=p("div",{class:"ticket-tips-label"},[p("span",null,"Ticket")],-1)),p("div",Se,[p("span",{title:o.form.ticket},g(o.form.ticket),9,Oe),s(u,{class:"item",effect:"dark",content:l(r)("commons.copy"),placement:"top"},{default:n(()=>[s(i,{text:"",onClick:t[0]||(t[0]=V(m=>se(o.form.ticket),["stop"]))},{icon:n(()=>[s(a,{name:"de-copy"},{default:n(()=>[s(l(Ee),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"]),s(u,{class:"item",effect:"dark",content:`${l(r)("link_ticket.refresh")} ticket`,placement:"top"},{default:n(()=>[s(i,{text:"",onClick:V(ae,["stop"])},{icon:n(()=>[s(a,{name:"icon_refresh_outlined"},{default:n(()=>[s(l(be),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])]),s(v,{prop:"exp",label:l(r)("visualization.over_time")},{label:n(()=>[p("div",$e,[p("span",Ie,g(l(r)("visualization.over_time")),1),s(u,{effect:"dark",content:l(r)("link_ticket.time_tips"),placement:"top"},{default:n(()=>[s(c,null,{default:n(()=>[s(a,{name:"dv-info"},{default:n(()=>[s(l(q),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])])]),default:n(()=>[s(b,{modelValue:o.form.exp,"onUpdate:modelValue":t[1]||(t[1]=m=>o.form.exp=m),autocomplete:"off","step-strictly":"",class:"text-left edit-all-line",min:0,max:1440,placeholder:l(r)("common.inputText"),"controls-position":"right",type:"number"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(v,{prop:"args",label:l(r)("dataset.param"),class:"last-form-item"},{label:n(()=>[p("div",Fe,[p("span",Ae,g(l(r)("dataset.param")),1),s(u,{effect:"dark",content:l(r)("link_ticket.arg_format_tips"),placement:"top"},{default:n(()=>[s(c,null,{default:n(()=>[s(a,{name:"dv-info"},{default:n(()=>[s(l(q),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])])]),default:n(()=>[(O(!0),U(ye,null,ve(o.argList,(m,L)=>(O(),U("div",{class:"args-line",key:L},[s(d,{modelValue:m.name,"onUpdate:modelValue":f=>m.name=f,placeholder:l(r)("visualization.input_param_name")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),s(d,{ref_for:!0,ref:f=>oe(f,L),modelValue:m.val,"onUpdate:modelValue":f=>m.val=f,placeholder:l(r)("link_ticket.arg_val_tips"),onBlur:f=>te(L,m.val)},null,8,["modelValue","onUpdate:modelValue","placeholder","onBlur"]),p("div",{style:he({opacity:o.argList.length!==1?1:0}),class:"arg-del-btn",onClick:V(f=>Y(L),["stop"])},[s(a,null,{default:n(()=>[s(l(xe),{class:"svg-icon"})]),_:1})],12,we)]))),128))]),_:1},8,["label"]),p("div",Be,[s(i,{onClick:V(Q,["stop"]),text:""},{icon:n(()=>[s(x,{name:"icon_add_outlined"},{default:n(()=>[s(l(Le),{class:"svg-icon"})]),_:1})]),default:n(()=>[$(" "+g(l(r)("commons.add")),1)]),_:1})])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}});const pt=Ne(Re,[["__scopeId","data-v-5f016692"]]);export{pt as default};

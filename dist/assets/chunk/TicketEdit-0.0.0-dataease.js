import{E as N,a as nt,i as lt,f as ct,e as mt,B as pt,w as dt,x as ut,Z as ft,r as _t}from"./element-plus-secondary-0.0.0-dataease.js";import{h as gt,k as S,f as J}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as kt,r as _,l as T,o as $,T as vt,U as r,a as p,W as s,_ as I,Y as g,u as i,X as V,c as R,a8 as yt,S as ht,Z as bt}from"./@vue-0.0.0-dataease.js";import{d as xt}from"./de-copy-0.0.0-dataease.js";import{i as Et}from"./icon_refresh_outlined-0.0.0-dataease.js";import{i as Lt}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import{i as Tt}from"./icon_add_outlined-0.0.0-dataease.js";import{d as q}from"./dv-info-0.0.0-dataease.js";import{u as Vt}from"./vue-clipboard3-0.0.0-dataease.js";import{p as Ct}from"./index-0.0.0-dataease.js";import{_ as Nt}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./lodash-es-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./pinia-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./fast-png-0.0.0-dataease.js";import"./iobuffer-0.0.0-dataease.js";import"./pako-0.0.0-dataease.js";import"./vue-router_2-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./clipboard-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";const St={class:"ticket-row ticket-tips-label"},$t=["title"],It={class:"ticket-form-info-tips"},Ot={class:"custom-form-item__label"},Ft={class:"ticket-form-info-tips"},wt={class:"custom-form-item__label"},At=["onClick"],Bt={class:"ticket-add"},Ut={class:"dialog-footer"},Jt=kt({__name:"TicketEdit",props:{uuid:Ct.string.def("")},emits:["saved"],setup(z,{expose:D,emit:j}){const{toClipboard:M}=Vt(),{t:n}=gt(),k=_(!1),O=_(null),h=_(),F=_([]),Z=z,b=_(!1),C=_(""),o=T({form:T({ticket:"",exp:30,args:""}),argList:T([{name:"",val:""}])}),P=T({exp:[{required:!0,message:n("common.require"),trigger:"blur"}]}),w=j,W=async t=>{t&&await t.validate(e=>{if(e){tt();const a={uuid:Z.uuid,ticket:o.form.ticket,exp:o.form.exp,args:o.form.args};Y(),S.post({url:"/ticket/saveTicket",data:a}).then(l=>{l.msg||(N.success(n("common.save_success")),w("saved"),X()),B()}).catch(()=>{B()})}})},A=t=>{t&&(t.resetFields(),k.value=!1)},X=()=>{A(h.value)},Y=()=>{O.value=nt.service({target:".ticket-param-drawer"})},B=()=>{var t;(t=O.value)==null||t.close()},G=(t,e)=>{if(rt(),C.value=e,b.value=!!(t!=null&&t.ticket),!b.value){U(),k.value=!0;return}for(const a in t)o.form.hasOwnProperty(a)&&(o.form[a]=t[a]);o.form.args&&Q(),k.value=!0},U=()=>{const t="/ticket/tempTicket";S.get({url:t}).then(e=>{o.form.ticket=e.data})},H=()=>{const t={name:"",val:""};o.argList.push(t)},K=t=>{if(o.argList.length===1){o.argList[t].name="",o.argList[t].val="";return}o.argList.splice(t,1)},Q=()=>{var e;if(!o.form.args)return;const t=JSON.parse(o.form.args);for(const a in t){const l=t[a];if(l&&Array.isArray(l)){const u={name:a,val:JSON.stringify(l)};o.argList.push(u)}else{const c={name:a,val:JSON.stringify([l])};o.argList.push(c)}}((e=o.argList)==null?void 0:e.length)>1&&!o.argList[0].name&&o.argList.splice(0,1)},tt=()=>{var e;if(!((e=o.argList)!=null&&e.length)){o.form.args="";return}const t={};o.argList.forEach(a=>{a.name&&a.val&&(t[a.name]=JSON.parse(a.val))}),o.form.args=JSON.stringify(t)},et=(t,e,a)=>{let l=!!a;if(!(e!=null&&e.length))l=!0;else if(a===null||typeof a>"u")try{JSON.parse(e),l=!0}catch{l=!1}const c=F[t].input,x="link-ticket-error-msg",v=`.${x}`;if(l){c.style=null,c.style.borderColor=null;const d=c.parentElement.querySelector(v);d&&(c.parentElement.style=null,c.parentElement.removeChild(d))}else{const d="JSON格式错误";c.style.color="red",c.style.borderColor="red",c.parentElement.style["box-shadow"]="0 0 0 1px red inset";const E=c.parentElement.querySelector(v);if(E)E.innerText=d;else{const y=document.createElement("div");y.className=x,y.innerText=d,c.parentElement.appendChild(y)}}},ot=(t,e)=>{t&&(F[e]=t)},st=async t=>{const e=`${C.value}?ticket=${t}`;try{await M(e),N.success(n("common.copy_success"))}catch(a){N.warning(n("common.copy_unsupported"),a)}},at=()=>{if(!b.value){U();return}const t="/ticket/saveTicket",e={ticket:o.form.ticket};e.generateNew=!0,S.post({url:t,data:e}).then(a=>{o.form.ticket=a.data,w("saved")})},rt=()=>{o.form={ticket:"",exp:30,args:""},o.argList=[{name:"",val:""}],b.value=!1,C.value=""};return D({edit:G}),(t,e)=>{const a=J,l=lt,u=ct,c=mt,x=pt,v=dt,d=_t,E=J,y=ut,it=ft;return $(),vt(it,{title:`${i(n)("commons.add")} Ticket`,modelValue:k.value,"onUpdate:modelValue":e[4]||(e[4]=m=>k.value=m),"modal-class":"ticket-param-drawer",size:"600px",direction:"rtl"},{footer:r(()=>[p("span",Ut,[s(l,{secondary:"",onClick:e[2]||(e[2]=m=>A(h.value))},{default:r(()=>[I(g(i(n)("common.cancel")),1)]),_:1}),s(l,{type:"primary",onClick:e[3]||(e[3]=m=>W(h.value))},{default:r(()=>[I(g(i(n)("commons.save")),1)]),_:1})])]),default:r(()=>[s(y,{ref_key:"ticketForm",ref:h,"require-asterisk-position":"right",model:o.form,rules:P,"label-width":"80px","label-position":"top"},{default:r(()=>[e[5]||(e[5]=p("div",{class:"ticket-tips-label"},[p("span",null,"Ticket")],-1)),p("div",St,[p("span",{title:o.form.ticket},g(o.form.ticket),9,$t),s(u,{class:"item",effect:"dark",content:i(n)("commons.copy"),placement:"top"},{default:r(()=>[s(l,{text:"",onClick:e[0]||(e[0]=V(m=>st(o.form.ticket),["stop"]))},{icon:r(()=>[s(a,{name:"de-copy"},{default:r(()=>[s(i(xt),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"]),s(u,{class:"item",effect:"dark",content:`${i(n)("link_ticket.refresh")} ticket`,placement:"top"},{default:r(()=>[s(l,{text:"",onClick:V(at,["stop"])},{icon:r(()=>[s(a,{name:"icon_refresh_outlined"},{default:r(()=>[s(i(Et),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])]),s(v,{prop:"exp",label:i(n)("visualization.over_time")},{label:r(()=>[p("div",It,[p("span",Ot,g(i(n)("visualization.over_time")),1),s(u,{effect:"dark",content:i(n)("link_ticket.time_tips"),placement:"top"},{default:r(()=>[s(c,null,{default:r(()=>[s(a,{name:"dv-info"},{default:r(()=>[s(i(q),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])])]),default:r(()=>[s(x,{modelValue:o.form.exp,"onUpdate:modelValue":e[1]||(e[1]=m=>o.form.exp=m),autocomplete:"off","step-strictly":"",class:"text-left edit-all-line",min:0,max:1440,placeholder:i(n)("common.inputText"),"controls-position":"right",type:"number"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(v,{prop:"args",label:i(n)("dataset.param"),class:"last-form-item"},{label:r(()=>[p("div",Ft,[p("span",wt,g(i(n)("dataset.param")),1),s(u,{effect:"dark",content:i(n)("link_ticket.arg_format_tips"),placement:"top"},{default:r(()=>[s(c,null,{default:r(()=>[s(a,{name:"dv-info"},{default:r(()=>[s(i(q),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"])])]),default:r(()=>[($(!0),R(ht,null,yt(o.argList,(m,L)=>($(),R("div",{class:"args-line",key:L},[s(d,{modelValue:m.name,"onUpdate:modelValue":f=>m.name=f,placeholder:i(n)("visualization.input_param_name")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),s(d,{ref_for:!0,ref:f=>ot(f,L),modelValue:m.val,"onUpdate:modelValue":f=>m.val=f,placeholder:i(n)("link_ticket.arg_val_tips"),onBlur:f=>et(L,m.val)},null,8,["modelValue","onUpdate:modelValue","placeholder","onBlur"]),p("div",{style:bt({opacity:o.argList.length!==1?1:0}),class:"arg-del-btn",onClick:V(f=>K(L),["stop"])},[s(a,null,{default:r(()=>[s(i(Lt),{class:"svg-icon"})]),_:1})],12,At)]))),128))]),_:1},8,["label"]),p("div",Bt,[s(l,{onClick:V(H,["stop"]),text:""},{icon:r(()=>[s(E,{name:"icon_add_outlined"},{default:r(()=>[s(i(Tt),{class:"svg-icon"})]),_:1})]),default:r(()=>[I(" "+g(i(n)("commons.add")),1)]),_:1})])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}});const Xe=Nt(Jt,[["__scopeId","data-v-5f016692"]]);export{Xe as default};

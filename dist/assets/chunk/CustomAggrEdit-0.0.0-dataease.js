import{e as tt,f as et,r as ot,b as at,p as st,g as it}from"./element-plus-secondary-0.0.0-dataease.js";import{h as nt,f as lt}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as rt,r as k,l as E,b as ct,e as dt,w as B,o as c,c as _,a as i,Y as l,u as s,W as e,U as a,_ as v,S as J,a8 as z,X as w,n as pt,T,V as mt,z as ut,R as _t}from"./@vue-0.0.0-dataease.js";import{i as V}from"./icon_info_outlined-0.0.0-dataease.js";import{i as P}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{i as ft}from"./icon_adjustment_outlined-0.0.0-dataease.js";import{i as vt}from"./icon_edit_outlined-0.0.0-dataease.js";import{i as gt}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import ht from"./CodeMirror-0.0.0-dataease2.js";import{L as yt}from"./dataset-0.0.0-dataease.js";import{f as L}from"./attr-0.0.0-dataease23.js";import{i as kt}from"./field-list-0.0.0-dataease.js";import{h as b}from"./lodash-es-0.0.0-dataease.js";import{_ as Ct}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./pinia-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./index-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./fast-png-0.0.0-dataease.js";import"./iobuffer-0.0.0-dataease.js";import"./pako-0.0.0-dataease.js";import"./vue-router_2-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./@codemirror-0.0.0-dataease.js";import"./@lezer-0.0.0-dataease.js";import"./style-mod-0.0.0-dataease.js";import"./crelt-0.0.0-dataease.js";import"./@marijn-0.0.0-dataease.js";import"./w3c-keyname-0.0.0-dataease.js";import"./codemirror-0.0.0-dataease.js";import"./js-base64-0.0.0-dataease.js";const xt={class:"calcu-cont"},Dt={style:{flex:"1"}},wt={style:{"max-width":"488px"}},Tt={class:"mb8 field-exp"},bt={key:0},Nt={key:1},St={class:"padding-lr"},Ft={class:"mb8"},qt={class:"padding-lr-content"},Et={class:"quota-btn_de"},Vt={class:"field-height"},Lt={key:0,class:"field-list"},Mt=["title","onClick"],It={key:2,class:"icon-right"},Ot={key:1,class:"class-na"},At={class:"padding-lr"},$t={class:"mb8"},Bt={key:0},Jt={key:1},zt={class:"padding-lr-content"},Pt={key:0,style:{width:"100%"}},Rt=["onClick"],Ut={class:"pop-title"},Qt={class:"pop-info"},jt={class:"pop-info"},Kt={key:1,class:"class-na"},Ht=rt({__name:"CustomAggrEdit",props:{crossDs:{type:Boolean,default:()=>!1}},setup(R,{expose:U}){const{t:r}=nt(),M=k(),N=k(""),S=k(""),d=k(),I=R,O={originName:"",name:"",groupType:"d",type:"VARCHAR",deType:0,extField:2,id:"",params:[],checked:!0},p=E({functionData:[],quotaData:[]}),A=E({id:null,name:"",value:null}),Q=k(!1),f=E({...O}),j=()=>{const o=d.value.state.doc.toString(),t=[];f.originName=x("name","id",o,t)},x=(o,t,m,u)=>{let h=m;const C=p.quotaData.reduce((y,g)=>(y[g[o]]=g[t],y),{}),D=m.match(/\[(.+?)\]/g)||[];return D&&D.forEach(y=>{const g=y.slice(1,-1);u&&u.push(C[g]),h=h.replace(`[${g}]`,`[${C[g]}]`)}),h};let F=[];const K=(o,t)=>{if(A.id=null,Object.assign(f,{...O,...o}),p.quotaData=t.concat(f.params||[]),F=b(t.concat(f.params||[])),!o.originName){d.value.dispatch({changes:{from:0,to:d.value.viewState.state.doc.length,insert:""}});return}pt(()=>{d.value.dispatch({changes:{from:0,to:d.value.viewState.state.doc.length,insert:x("id","name",o.originName)}})})},H=o=>{d.value.dispatch({changes:{from:d.value.viewState.state.selection.ranges[0].from,insert:o},selection:{anchor:d.value.viewState.state.selection.ranges[0].from}})};ct(()=>{d.value=M.value.codeComInit()}),dt(()=>{var o,t;(t=(o=d.value).destroy)==null||t.call(o)});const W=o=>{d.value.dispatch({changes:{from:d.value.viewState.state.selection.ranges[0].from,insert:o},selection:{anchor:d.value.viewState.state.selection.ranges[0].from}})};let q=[];const X=()=>{yt().then(o=>{q=b(o),p.functionData=b(o)})};B(()=>N.value,o=>{o&&o!==""?p.quotaData=JSON.parse(JSON.stringify(F.filter(t=>t.name.toLocaleLowerCase().includes(o.toLocaleLowerCase())&&t.extField===0))):p.quotaData=JSON.parse(JSON.stringify(F)).filter(t=>t.extField===0)}),B(()=>S.value,o=>{o&&o!==""?p.functionData=JSON.parse(JSON.stringify(q.filter(t=>t.func.toLocaleLowerCase().includes(o.toLocaleLowerCase())))):p.functionData=b(q)}),U({initEdit:K,setFieldForm:j,fieldForm:f});const Y=k(""),G=()=>{const[o]=f.params;Y.value="编辑计算参数",Object.assign(A,o||{}),Q.value=!0},Z=()=>{const[o]=f.params;f.params=[];const t=d.value.state.doc.toString(),m=[];f.originName=x("name","id",t,m).replaceAll(`[${o.id}]`,""),p.quotaData=p.quotaData.filter(u=>u.id!==o.id),d.value.dispatch({changes:{from:0,to:d.value.viewState.state.doc.length,insert:x("id","name",f.originName)}})};return X(),(o,t)=>{const m=lt,u=tt,h=et,C=ot,D=at,y=it,g=st;return c(),_("div",{onKeydown:t[2]||(t[2]=w(()=>{},["stop"])),onKeyup:t[3]||(t[3]=w(()=>{},["stop"])),class:"calcu-field"},[i("div",xt,[i("div",Dt,[i("div",wt,[i("div",Tt,[i("span",null,l(s(r)("dataset.field_exp")),1),t[4]||(t[4]=i("span",null,"*",-1)),e(h,{class:"item",effect:"dark",placement:"top"},{content:a(()=>[I.crossDs?(c(),_("div",bt,l(s(r)("dataset.calc_tips.tip1")),1)):(c(),_("div",Nt,l(s(r)("dataset.calc_tips.tip1_1")),1)),i("div",null,l(s(r)("dataset.calc_tips.tip2")),1)]),default:a(()=>[e(u,{size:"16px"},{default:a(()=>[e(m,{name:"icon_info_outlined"},{default:a(()=>[e(s(V),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),e(ht,{quotaMap:p.quotaData.map(n=>n.name),dimensionMap:[],ref_key:"myCm",ref:M,height:"500px","dom-id":"calcField"},null,8,["quotaMap"])])]),i("div",St,[i("span",Ft,[v(l(s(r)("dataset.click_ref_field"))+" ",1),e(h,{class:"item",effect:"dark",placement:"bottom"},{content:a(()=>[v(l(s(r)("dataset.calc_tips.tip3"))+" ",1),t[5]||(t[5]=i("br",null,null,-1)),v(" "+l(s(r)("dataset.calc_tips.tip4"))+" ",1),t[6]||(t[6]=i("br",null,null,-1)),v(" "+l(s(r)("dataset.calc_tips.tip5")),1)]),default:a(()=>[e(u,{size:"16px"},{default:a(()=>[e(m,{name:"icon_info_outlined"},{default:a(()=>[e(s(V),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),i("div",qt,[e(C,{modelValue:N.value,"onUpdate:modelValue":t[0]||(t[0]=n=>N.value=n),placeholder:s(r)("dataset.edit_search"),clearable:""},{prefix:a(()=>[e(u,null,{default:a(()=>[e(m,{name:"icon_search-outline_outlined"},{default:a(()=>[e(s(P),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"]),i("div",Et,[i("span",null,l(s(r)("chart.quota")),1)]),i("div",Vt,[e(D,null,{default:a(()=>[p.quotaData.length?(c(),_("div",Lt,[(c(!0),_(J,null,z(p.quotaData,n=>(c(),_("span",{key:n.id,class:"item-quota flex-align-center ellipsis",title:n.name,onClick:$=>H("["+n.name+"]")},[n.groupType?(c(),T(u,{key:1},{default:a(()=>[e(m,{className:`field-icon-${s(L)[n.deType]}`},{default:a(()=>[(c(),T(mt(s(kt)[s(L)[n.deType]]),{class:ut(["svg-icon",`field-icon-${s(L)[n.deType]}`])},null,8,["class"]))]),_:2},1032,["className"])]),_:2},1024)):(c(),T(u,{key:0},{default:a(()=>[e(m,{name:"icon_adjustment_outlined"},{default:a(()=>[e(s(ft),{class:"svg-icon"})]),_:1})]),_:1})),v(" "+l(n.name)+" ",1),n.groupType?_t("",!0):(c(),_("div",It,[e(u,{onClick:w(G,["stop"]),class:"hover-icon"},{default:a(()=>[e(m,{name:"icon_edit_outlined"},{default:a(()=>[e(s(vt),{class:"svg-icon"})]),_:1})]),_:1}),e(u,{onClick:w(Z,["stop"]),class:"hover-icon"},{default:a(()=>[e(m,{name:"icon_delete-trash_outlined"},{default:a(()=>[e(s(gt),{class:"svg-icon"})]),_:1})]),_:1})]))],8,Mt))),128))])):(c(),_("div",Ot,l(s(r)("dataset.na")),1))]),_:1})])])]),i("div",At,[i("span",$t,[v(l(s(r)("dataset.click_ref_function"))+" ",1),e(h,{class:"item",effect:"dark",placement:"bottom"},{content:a(()=>[I.crossDs?(c(),_("div",Bt,[v(l(s(r)("dataset.calc_tips.tip6"))+" ",1),t[7]||(t[7]=i("br",null,null,-1)),v(" "+l(s(r)("dataset.calc_tips.tip8"))+" ",1),t[8]||(t[8]=i("br",null,null,-1)),t[9]||(t[9]=v(" https://calcite.apache.org/docs/reference.html ",-1))])):(c(),_("div",Jt,l(s(r)("dataset.calc_tips.tip7")),1))]),default:a(()=>[e(u,{size:"16px"},{default:a(()=>[e(m,{name:"icon_info_outlined"},{default:a(()=>[e(s(V),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),i("div",zt,[e(C,{modelValue:S.value,"onUpdate:modelValue":t[1]||(t[1]=n=>S.value=n),style:{"margin-bottom":"8px"},placeholder:s(r)("dataset.edit_search"),clearable:""},{prefix:a(()=>[e(u,null,{default:a(()=>[e(m,{name:"icon_search-outline_outlined"},{default:a(()=>[e(s(P),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"]),e(g,{class:"function-height"},{default:a(()=>[p.functionData.length?(c(),_("div",Pt,[(c(!0),_(J,null,z(p.functionData,(n,$)=>(c(),T(y,{key:$,class:"function-pop",placement:"right",width:"200",trigger:"hover","open-delay":500},{reference:a(()=>[i("span",{class:"function-style flex-align-center",onClick:Wt=>W(n.func)},l(n.func),9,Rt)]),default:a(()=>[i("p",Ut,l(n.name),1),i("p",Qt,l(n.func),1),i("p",jt,l(n.desc),1)]),_:2},1024))),128))])):(c(),_("div",Kt,l(s(r)("chart.no_function")),1))]),_:1})])])])],32)}}});const vo=Ct(Ht,[["__scopeId","data-v-aea35c14"]]);export{vo as default};

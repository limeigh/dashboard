import{e as _,X as hl,E as z,q as gl,r as Cl,i as yl,h as bl,s as wl,f as Vl,W as xl,V as Tl,g as Hl,R as kl,S as Sl,T as El,U as Ml,Y as $l,y as ql,_ as Nl,Z as Dl,v as Ll,A as Il}from"./element-plus-secondary-0.0.0-dataease.js";import{o as r,c as m,a as i,d as Zl,t as Al,r as C,l as Ze,x as Ul,i as Ol,k as Pl,b as Yl,e as Rl,w as ye,W as l,u as e,U as t,_ as w,Y as c,T as x,R as D,$ as A,a0 as Q,Z as K,z as U,X as Ae,V as ie,S as j,a8 as ee,h as Bl,s as zl}from"./@vue-0.0.0-dataease.js";import{i as Ue}from"./icon_close_outlined-0.0.0-dataease.js";import{i as jl}from"./icon_right_outlined-0.0.0-dataease.js";import{i as Fl}from"./icon_left_outlined-0.0.0-dataease.js";import{i as Oe}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{i as be}from"./icon_copy_outlined-0.0.0-dataease.js";import{i as Wl}from"./icon_info_outlined-0.0.0-dataease.js";import{i as Xl}from"./icon_info_colorful-0.0.0-dataease.js";import{k as Jl,f,h as Gl}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{g as F}from"./js-base64-0.0.0-dataease.js";import{p as Ql}from"./@vueuse-0.0.0-dataease.js";import{u as Kl}from"./vue-clipboard3-0.0.0-dataease.js";import{P as ea,l as la,Q as aa,n as ta}from"./dataset-0.0.0-dataease.js";import sa from"./CodeMirror-0.0.0-dataease2.js";import{G as oa}from"./GridTable-0.0.0-dataease.js";import{E as we}from"./EmptyBackground-0.0.0-dataease.js";import{t as na,f as ia,d as Ve}from"./util-0.0.0-dataease.js";import{f as de}from"./attr-0.0.0-dataease23.js";import{i as re,f as da,a as ra,b as ua}from"./field-list-0.0.0-dataease.js";import{i as ca}from"./ModelUtil-0.0.0-dataease.js";import{d as ma}from"./lodash-es-0.0.0-dataease.js";import{_ as pa}from"./_plugin-vue_export-helper-0.0.0-dataease.js";const _a={width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"};function fa(S,v){return r(),m("svg",_a,[...v[0]||(v[0]=[i("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M3.15156 1.33301C2.1474 1.33301 1.33337 2.14703 1.33337 3.15119V12.8482C1.33337 13.8523 2.1474 14.6663 3.15155 14.6663H12.8485C13.8527 14.6663 14.6667 13.8523 14.6667 12.8482V3.15119C14.6667 2.14704 13.8527 1.33301 12.8485 1.33301H3.15156ZM13.3334 2.66634H2.66671V5.33301H5.33337H6.66671H9.33337H10.6667H13.3334V2.66634ZM2.66671 9.33301V6.66634H5.33337V9.33301H2.66671ZM2.66671 10.6663V13.333L5.33337 13.333V10.6663H2.66671ZM6.66671 10.6663V13.333H9.33337V10.6663H6.66671ZM10.6667 10.6663V13.333L13.3334 13.333V10.6663H10.6667ZM13.3334 9.33301V6.66634H10.6667V9.33301H13.3334ZM9.33337 9.33301H6.66671V6.66634H9.33337V9.33301Z"},null,-1)])])}const va={render:fa},ha={width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"};function ga(S,v){return r(),m("svg",ha,[...v[0]||(v[0]=[i("path",{d:"M13 7H16.5C16.7761 7 17 7.22386 17 7.5V8.5C17 8.77614 16.7761 9 16.5 9H13V16.5C13 16.7761 12.7761 17 12.5 17H11.5C11.2239 17 11 16.7761 11 16.5V9H7.5C7.22386 9 7 8.77614 7 8.5V7.5C7 7.22386 7.22386 7 7.5 7H11C11 7 13 7.02833 13 7Z"},null,-1),i("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M2 3C2 2.44772 2.44772 2 3 2H21C21.5523 2 22 2.44772 22 3V21C22 21.5523 21.5523 22 21 22H3C2.44772 22 2 21.5523 2 21V3ZM4 20V4H20V20H4Z"},null,-1)])])}const Ca={render:ga},ya={width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"};function ba(S,v){return r(),m("svg",ya,[...v[0]||(v[0]=[i("g",{"clip-path":"url(#clip0_4476_153334)"},[i("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M7.99984 1.66699C11.4976 1.66699 14.3332 4.50261 14.3332 8.00033C14.3332 11.498 11.4976 14.3337 7.99984 14.3337C4.50212 14.3337 1.6665 11.498 1.6665 8.00033C1.6665 4.50261 4.50212 1.66699 7.99984 1.66699ZM7.99984 0.666992C12.0498 0.666992 15.3332 3.95033 15.3332 8.00033C15.3332 12.0503 12.0498 15.3337 7.99984 15.3337C3.94984 15.3337 0.666504 12.0503 0.666504 8.00033C0.666504 3.95033 3.94984 0.666992 7.99984 0.666992ZM6.85744 11.4096L11.4714 8.50657C11.5568 8.45249 11.6271 8.37772 11.6758 8.2892C11.7245 8.20069 11.75 8.1013 11.75 8.00027C11.75 7.89924 11.7245 7.79985 11.6758 7.71133C11.6271 7.62282 11.5568 7.54804 11.4714 7.49397L6.85764 4.59117C6.76324 4.53177 6.65444 4.50037 6.54324 4.50037C6.46511 4.50063 6.38779 4.51628 6.3157 4.54642C6.24361 4.57657 6.17816 4.62061 6.1231 4.67605C6.06803 4.73149 6.02443 4.79723 5.99477 4.86952C5.96511 4.94181 5.94998 5.01923 5.95024 5.09737V10.9036C5.95031 11.0152 5.98155 11.1247 6.04044 11.2196C6.0814 11.2859 6.13508 11.3435 6.1984 11.389C6.26172 11.4345 6.33342 11.4671 6.40937 11.4847C6.48532 11.5024 6.56402 11.5048 6.64092 11.4919C6.71782 11.479 6.79141 11.451 6.85744 11.4096Z"})],-1),i("defs",null,[i("clipPath",{id:"clip0_4476_153334"},[i("rect",{width:"16",height:"16"})])],-1)])])}const wa={render:ba},Va={width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"};function xa(S,v){return r(),m("svg",Va,[...v[0]||(v[0]=[i("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M11 11.333H14.2393C14.3879 11.333 14.4418 11.3485 14.4961 11.3775C14.5505 11.4066 14.5931 11.4492 14.6221 11.5035C14.6512 11.5579 14.6667 11.6117 14.6667 11.7603V12.239C14.6667 12.3876 14.6512 12.4415 14.6221 12.4958C14.5931 12.5501 14.5505 12.5928 14.4961 12.6218C14.4418 12.6509 14.3879 12.6663 14.2393 12.6663H11V14.239C11 14.3876 10.9845 14.4415 10.9555 14.4958C10.9264 14.5501 10.8838 14.5928 10.8295 14.6218C10.7751 14.6509 10.7213 14.6663 10.5727 14.6663H10.094C9.94539 14.6663 9.89151 14.6509 9.83719 14.6218C9.78287 14.5928 9.74024 14.5501 9.71118 14.4958C9.68213 14.4415 9.66666 14.3876 9.66666 14.239V12.6663H1.76064C1.61206 12.6663 1.55817 12.6509 1.50385 12.6218C1.44953 12.5928 1.4069 12.5501 1.37785 12.4958C1.3488 12.4415 1.33333 12.3876 1.33333 12.239V11.7603C1.33333 11.6117 1.3488 11.5579 1.37785 11.5035C1.4069 11.4492 1.44953 11.4066 1.50385 11.3775C1.55817 11.3485 1.61206 11.333 1.76064 11.333H9.66666V9.76032C9.66666 9.61174 9.68213 9.55785 9.71118 9.50353C9.74024 9.44921 9.78287 9.40658 9.83719 9.37753C9.89151 9.34848 9.94539 9.33301 10.094 9.33301H10.5727C10.7213 9.33301 10.7751 9.34848 10.8295 9.37753C10.8838 9.40658 10.9264 9.44921 10.9555 9.50353C10.9845 9.55785 11 9.61174 11 9.76032V11.333ZM4.99999 3.33301V1.76032C4.99999 1.61174 5.01547 1.55785 5.04452 1.50353C5.07357 1.44921 5.1162 1.40658 5.17052 1.37753C5.22484 1.34848 5.27872 1.33301 5.42731 1.33301H5.90601C6.0546 1.33301 6.10848 1.34848 6.1628 1.37753C6.21712 1.40658 6.25976 1.44921 6.28881 1.50353C6.31786 1.55785 6.33333 1.61174 6.33333 1.76032V3.33301H14.2393C14.3879 3.33301 14.4418 3.34848 14.4961 3.37753C14.5505 3.40658 14.5931 3.44921 14.6221 3.50353C14.6512 3.55785 14.6667 3.61174 14.6667 3.76032V4.23903C14.6667 4.38761 14.6512 4.44149 14.6221 4.49582C14.5931 4.55014 14.5505 4.59277 14.4961 4.62182C14.4418 4.65087 14.3879 4.66634 14.2393 4.66634H6.33333V6.23903C6.33333 6.38761 6.31786 6.44149 6.28881 6.49582C6.25976 6.55014 6.21712 6.59277 6.1628 6.62182C6.10848 6.65087 6.0546 6.66634 5.90601 6.66634H5.42731C5.27872 6.66634 5.22484 6.65087 5.17052 6.62182C5.1162 6.59277 5.07357 6.55014 5.04452 6.49582C5.01547 6.44149 4.99999 6.38761 4.99999 6.23903V4.66634H1.76064C1.61206 4.66634 1.55817 4.65087 1.50385 4.62182C1.44953 4.59277 1.4069 4.55014 1.37785 4.49582C1.3488 4.44149 1.33333 4.38761 1.33333 4.23903V3.76032C1.33333 3.61174 1.3488 3.55785 1.37785 3.50353C1.4069 3.44921 1.44953 3.40658 1.50385 3.37753C1.55817 3.34848 1.61206 3.33301 1.76064 3.33301H4.99999Z",fill:"#1F2329"},null,-1)])])}const Ta={render:xa},Ha={width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"};function ka(S,v){return r(),m("svg",Ha,[...v[0]||(v[0]=[i("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M1.33325 3.66665C1.33325 2.37798 2.37792 1.33331 3.66659 1.33331C4.72358 1.33331 5.61644 2.03615 5.90329 2.99998H14.3333C14.5173 2.99998 14.6666 3.14922 14.6666 3.33331V3.99998C14.6666 4.18407 14.5173 4.33331 14.3333 4.33331H5.90329C5.61644 5.29714 4.72358 5.99998 3.66659 5.99998C2.37792 5.99998 1.33325 4.9553 1.33325 3.66665ZM1.66659 8.66665C1.48249 8.66665 1.33325 8.51741 1.33325 8.33331V7.66665C1.33325 7.48255 1.48249 7.33331 1.66659 7.33331H5.76321C6.05007 6.36949 6.94292 5.66665 7.99992 5.66665C9.05692 5.66665 9.94977 6.36949 10.2366 7.33331H14.3333C14.5173 7.33331 14.6666 7.48255 14.6666 7.66665V8.33331C14.6666 8.51741 14.5173 8.66665 14.3333 8.66665H10.2366C9.94977 9.63047 9.05692 10.3333 7.99992 10.3333C6.94292 10.3333 6.05007 9.63047 5.76321 8.66665H1.66659ZM7.99992 8.99998C8.5522 8.99998 8.99992 8.55226 8.99992 7.99998C8.99992 7.4477 8.5522 6.99998 7.99992 6.99998C7.44764 6.99998 6.99992 7.4477 6.99992 7.99998C6.99992 8.55226 7.44764 8.99998 7.99992 8.99998ZM1.66659 13C1.48249 13 1.33325 12.8507 1.33325 12.6666V12C1.33325 11.8159 1.48249 11.6666 1.66659 11.6666H10.0965C10.3834 10.7028 11.2763 9.99998 12.3333 9.99998C13.6219 9.99998 14.6666 11.0447 14.6666 12.3333C14.6666 13.622 13.6219 14.6666 12.3333 14.6666C11.2763 14.6666 10.3834 13.9638 10.0965 13H1.66659ZM12.3333 11.3333C11.781 11.3333 11.3333 11.781 11.3333 12.3333C11.3333 12.8856 11.781 13.3333 12.3333 13.3333C12.8855 13.3333 13.3333 12.8856 13.3333 12.3333C13.3333 11.781 12.8855 11.3333 12.3333 11.3333ZM3.66659 4.66665C4.21886 4.66665 4.66659 4.21892 4.66659 3.66665C4.66659 3.11436 4.21886 2.66665 3.66659 2.66665C3.1143 2.66665 2.66659 3.11436 2.66659 3.66665C2.66659 4.21892 3.1143 4.66665 3.66659 4.66665Z"},null,-1)])])}const Sa={render:ka},Ea={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Ma(S,v){return r(),m("svg",Ea,[...v[0]||(v[0]=[i("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M2.53248 2.53248C2.87342 2.19154 3.33584 2 3.818 2H20.182C20.6642 2 21.1266 2.19154 21.4675 2.53248C21.8085 2.87342 22 3.33584 22 3.818V20.182C22 20.6642 21.8085 21.1266 21.4675 21.4675C21.1266 21.8085 20.6642 22 20.182 22H3.818C2.814 22 2 21.186 2 20.182V3.818C2 3.33584 2.19154 2.87342 2.53248 2.53248ZM4 10V14H8V10H4ZM4 16V20H8V16H4ZM10 20H14V16H10V20ZM16 20H20V16H16V20ZM20 14V10H16V14H20ZM14 10H10V14H14V10ZM20 4H4V8H20V4Z",fill:"#1F2329"},null,-1)])])}const $a={render:Ma},qa={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Na(S,v){return r(),m("svg",qa,[...v[0]||(v[0]=[i("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M11.9998 2.49994C17.2463 2.49994 21.4998 6.75337 21.4998 11.9999C21.4998 17.2465 17.2463 21.4999 11.9998 21.4999C6.75318 21.4999 2.49976 17.2465 2.49976 11.9999C2.49976 6.75337 6.75318 2.49994 11.9998 2.49994ZM11.9998 0.999939C18.0748 0.999939 22.9998 5.92494 22.9998 11.9999C22.9998 18.0749 18.0748 22.9999 11.9998 22.9999C5.92476 22.9999 0.999756 18.0749 0.999756 11.9999C0.999756 5.92494 5.92476 0.999939 11.9998 0.999939ZM10.2862 17.1138L17.2072 12.7593C17.3352 12.6782 17.4406 12.566 17.5136 12.4333C17.5867 12.3005 17.625 12.1514 17.625 11.9999C17.625 11.8483 17.5867 11.6992 17.5136 11.5664C17.4406 11.4337 17.3352 11.3215 17.2072 11.2404L10.2865 6.8862C10.1449 6.7971 9.98166 6.75 9.81486 6.75C9.69766 6.75039 9.58168 6.77387 9.47355 6.81908C9.36541 6.8643 9.26725 6.93037 9.18465 7.01353C9.10205 7.09668 9.03664 7.19529 8.99215 7.30373C8.94766 7.41216 8.92497 7.5283 8.92536 7.6455V16.3548C8.92547 16.5223 8.97233 16.6865 9.06066 16.8288C9.12209 16.9283 9.20262 17.0147 9.2976 17.083C9.39258 17.1512 9.50013 17.2 9.61406 17.2265C9.72798 17.253 9.84603 17.2567 9.96138 17.2374C10.0767 17.218 10.1871 17.176 10.2862 17.1138Z",fill:"#1F2329"},null,-1)])])}const Da={render:Na},La=async S=>Jl.post({url:"/sysVariable/query",data:S}),Ia={class:"add-sql-name"},Za={class:"save-or-cancel flex-align-center"},Aa={class:"table-list-top"},Ua={class:"select-ds"},Oa={class:"left-outlined"},Pa={class:"select-ds table-num"},Ya={class:"num"},Ra={key:0,class:"el-empty"},Ba={class:"el-empty__description",style:{"margin-top":"80px",color:"#5e6d82","text-align":"center"}},za={key:1,class:"table-checkbox-list"},ja=["title","onClick"],Fa={class:"label"},Wa={class:"name-copy"},Xa={class:"table-filed"},Ja={class:"top flex-align-center"},Ga={class:"title ellipsis"},Qa={class:"num flex-align-center"},Ka={class:"table-grid"},et={class:"flex-align-center icon"},lt={class:"sql-title"},at={class:"padding-24"},tt={class:"table-sql"},st={key:0,class:"table-scroll"},ot={class:"sql-tips flex-align-center"},nt={class:"table-container"},it={key:1},dt={key:0,class:"handle-system"},rt={class:"handle-system_title"},ut={class:"handle-system_list"},ct={class:"system-list"},mt={class:"built-in"},pt=["onClick"],_t={class:"built-in",style:{"margin-top":"16px"}},ft=["onClick"],vt=["title"],ht={class:"content"},gt={class:"select-svg-icon"},Ct={key:2,class:"ed-input ed-input--light ed-input-group ed-input-group--prepend de-group__prepend"},yt={class:"ed-input-group__prepend"};function bt(S){return typeof S=="function"||Object.prototype.toString.call(S)==="[object Object]"&&!zl(S)}const wt=Zl({__name:"AddSql",props:{sqlNode:{type:Object,default:()=>({})}},emits:["close","save"],setup(S,{emit:v}){const Pe=S,{sqlNode:T}=Al(Pe),{toClipboard:Ye}=Kl(),{t:n}=Gl(),xe=C(""),Te=C(),V=C(),Re=n("sql_variable.variable_mgm")+" ",le=C("result"),W=C(""),X=C(!1),ue=C(!1),Be=C(!1),L=C(240),I=C(!0),ze=C(),u=Ze({plxTableData:[],variables:[],fields:[],sqlData:[],variablesTmp:[],dataSourceList:[],table:{name:"",id:""},param:{tableId:0}}),H=Ul([]),He=Ol("isCross"),je=Ze({currentPage:1,pageSize:10,total:0}),Fe=({name:s,enableCheck:o})=>{o&&(xe.value=s)},{height:We}=Ql(),Xe=s=>s.map(o=>({key:o.originName,deType:o.deType,dataKey:o.originName,title:o.originName,width:170,headerCellRenderer:({column:y})=>{let b;return l("div",{class:"flex-align-center"},[l(_,{style:{marginRight:"6px"}},{default:()=>[l(f,null,bt(b=Bl(re[de[y.deType]],{class:`svg-icon field-icon-${de[y.deType]}`}))?b:{default:()=>[b]})]}),l("span",{class:"ellipsis",title:y.title,style:{width:"120px"}},[y.title])])}})),Je=()=>{X.value=!0,he()},O=C([]),J=C([{id:"sysParams.userId",name:n("system.account")},{id:"sysParams.userName",name:n("datasource.user_name")},{id:"sysParams.userEmail",name:n("commons.email")}]),Ge=s=>{if(s==="text")return da;if(s==="num")return ra;if(s==="time")return ua},Qe=s=>{if(s==="text")return"field-icon-text";if(s==="num")return"field-icon-value";if(s==="time")return"field-icon-time"},Ke=Pl(()=>O.value.filter(s=>s.name.toLowerCase().includes(ce.value.toLowerCase()))),ke=ca(),ae=C(!1),ce=C(""),el=()=>{ae.value=!0,Ee()},Se=s=>{V.value.dispatch({changes:{from:V.value.viewState.state.selection.ranges[0].from,insert:s},selection:{anchor:V.value.viewState.state.selection.ranges[0].from}})},Y=(s,o,y,b)=>{let E=y;const q=[...J.value,...O.value].map(p=>p.id),M=[...J.value,...O.value].map(p=>p.name),g=[...J.value,...O.value].reduce((p,h)=>(p[h[s]]=h[o],p),{}),k=y.match(/\$f2cde\[(.+?)\]/g);return k&&k.forEach(p=>{const h=p.slice(7,-1);b&&b.push(g[h]),s==="id"&&q.includes(h)&&(E=E.replace(`$f2cde[${h}]`,`$f2cde[${g[h]}]`)),s==="name"&&M.includes(h)&&(E=E.replace(`$f2cde[${h}]`,`$f2cde[${g[h]}]`))}),E},Ee=async()=>La({}).then(s=>{O.value=(s==null?void 0:s.data)||[]}),Me=C(!0);Yl(async()=>{if(ve(T.value.datasourceId),!ke)try{await Ee()}catch(s){s&&(Me.value=!1)}Z=F.decode(T.value.sql),V.value=Te.value.codeComInit(Y("id","name",Z),!0)}),Rl(()=>{var s,o;(o=(s=V.value).destroy)==null||o.call(s)});const me=C([]),pe=C(!1),ll=({datasourceId:s,tableName:o})=>{pe.value=!0,ea({datasourceId:s,info:JSON.stringify({table:o,sql:""}),tableName:o,type:"db",isCross:He.value}).then(b=>{me.value=b}).finally(()=>{pe.value=!1})},al=()=>{la().then(s=>{const o=s||[];o&&o.length>0&&o[0].id==="0"?u.dataSourceList=o[0].children:u.dataSourceList=o})},G=C(260),tl=()=>{document.querySelector(".sql-eidtor").addEventListener("mousemove",$e)},$e=s=>{if(s.pageY-164<64){G.value=64;return}if(s.pageY-164>document.documentElement.clientHeight-200){G.value=document.documentElement.clientHeight-200;return}G.value=s.pageY-164},qe=s=>{if(s.pageX<240){L.value=240;return}if(s.pageX>400){L.value=400;return}L.value=s.pageX},Ne=s=>{V.value.dispatch({changes:{from:0,to:V.value.state.doc.toString().length,insert:""}}),V.value.dispatch({changes:{from:V.value.viewState.state.selection.ranges[0].from,insert:s},selection:{anchor:V.value.viewState.state.selection.ranges[0].from}})};ye(()=>T.value.datasourceId,s=>{ve(s)}),ye(()=>T.value.id,()=>{u.variables=T.value.variables,V.value&&Ne(Y("id","name",F.decode(T.value.sql)))},{immediate:!0});const sl={children:"children",label:"name"};al();const De=v;let te=!1;const R=C(!1),Le=()=>{te=!0,R.value=!0};let Z="";const ol=s=>{if(!T.value.tableName.trim()){z.error(n("data_set.cannot_be_empty"));return}if(he(),Z=Y("name","id",V.value.state.doc.toString()),T.value.changeFlag=!0,!Z.trim()){z.error(n("data_set.cannot_be_empty_de"));return}T.value.sql=F.encode(Z),De("save",{...T.value,sql:F.encode(Z),sqlVariableDetails:JSON.stringify(u.variables)},s),te=!1,z.success(n("common.save_success"))},Ie=()=>{W.value="",u.plxTableData=[],u.fields=[],V.value&&Ne(Y("id","name",F.decode(T.value.sql))),De("close")},nl=()=>{let s=Y("name","id",V.value.state.doc.toString());te||Z!==s||!s.trim()?gl.confirm(n("chart.tips"),{confirmButtonType:"primary",tip:n("data_set.sure_to_exit"),type:"warning",autofocus:!1,showClose:!1}).then(()=>{Ie(),te=!1,R.value=!1}):(Ie(),R.value=!1)},_e=C(!1),il=()=>{he(),_e.value=!0,aa({isCross:He.value,sql:F.encode(Z=Y("name","id",V.value.state.doc.toString())),datasourceId:T.value.datasourceId,sqlVariableDetails:JSON.stringify(u.variables)}).then(s=>{u.plxTableData=s.data.data,u.fields=Xe(s.data.fields)}).finally(()=>{_e.value=!1})};let fe=[];ye(W,s=>{H.value=fe.filter(o=>o.tableName.toLowerCase().includes(s.toLowerCase()))});const P=s=>{if(["DATETIME-YEAR","DATETIME-YEAR-MONTH","DATETIME","DATETIME-YEAR-MONTH-DAY"].includes(s))return"time";if(s==="TEXT")return"text";if(["LONG","DOUBLE"].includes(s))return"value"},dl=(s,o,y)=>y?`${y} ${n("commons.millisecond")}`:"-",rl=()=>{I.value=!I.value,L.value=I.value?240:0},ve=ma(s=>{ue.value=!0,ta({datasourceId:s}).then(o=>{fe=o||[],H.value=[...fe]}).finally(()=>{ue.value=!1})},300),ul=()=>{Le(),ve()},se=async s=>{try{await Ye(s),z.success(n("data_set.copied_successfully"))}catch(o){z.warning(n("data_set.not_support_copying"),o)}},cl=()=>{const s=document.querySelector(".sql-eidtor");s.removeEventListener("mousemove",qe),s.removeEventListener("mousemove",$e)},he=()=>{var y,b;u.variablesTmp=[];const s=new RegExp("\\$DE_PARAM{(.*?)}","gim"),o=V.value.state.doc.toString().match(s);if(o!==null){const E=[],q=new RegExp("\\$\\[[^\\]]+\\]","gim");for(let M=0;M<o.length;M++){const k=o[M].substring(10,o[M].length-1).match(q);if(k!==null)for(let p=0;p<k.length;p++){let h=k[p].substring(2,k[p].length-1);if(E.indexOf(h)<0){E.push(h);let N;for(let B=0;B<((y=u.variables)==null?void 0:y.length);B++)u.variables[B].variableName===h&&(N=u.variables[B],N.hasOwnProperty("defaultValueScope")||(N.defaultValueScope="EDIT"));N===void 0&&(N={variableName:h,alias:"",type:[],required:!1,defaultValue:"",details:"",defaultValueScope:"EDIT"},N.type.push("TEXT")),u.variablesTmp.push(N)}}}}else{const E=new RegExp("\\${(.*?)}","gim"),q=V.value.state.doc.toString().match(E),M=[];if(q!==null)for(let g=0;g<q.length;g++){let k=q[g].substring(2,q[g].length-1);if(M.indexOf(k)<0){M.push(k);let p;for(let h=0;h<((b=u.variables)==null?void 0:b.length);h++)u.variables[h].variableName===k&&(p=u.variables[h],p.hasOwnProperty("defaultValueScope")||(p.defaultValueScope="EDIT"));p===void 0&&(p={variableName:k,alias:"",type:[],required:!1,defaultValue:"",details:"",defaultValueScope:"EDIT"},p.type.push("TEXT")),u.variablesTmp.push(p)}}}u.variables=JSON.parse(JSON.stringify(u.variablesTmp))},ml=()=>{u.variables=JSON.parse(JSON.stringify(u.variablesTmp)),X.value=!1,R.value=!0,z.success(n("data_set.parameters_set_successfully"))},pl=()=>{document.querySelector(".sql-eidtor").addEventListener("mousemove",qe)};return(s,o)=>{const y=Cl,b=yl,E=bl,q=wl,M=Vl,g=xl,k=Tl,p=Hl,h=kl,N=Sl,B=El,_l=Ml,fl=$l,ge=Il,Ce=ql,oe=Nl,vl=Dl,ne=Ll;return r(),m(j,null,[i("div",Ia,[l(y,{class:"name",ref_key:"editerName",ref:ze,modelValue:e(T).tableName,"onUpdate:modelValue":o[0]||(o[0]=a=>e(T).tableName=a),onChange:Le},null,8,["modelValue"]),i("div",Za,[l(b,{onClick:il,text:"",style:{color:"#1f2329"}},{icon:t(()=>[l(e(_),null,{default:t(()=>[l(e(f),{name:"reference-play"},{default:t(()=>[l(e(wa),{class:"svg-icon"})]),_:1})]),_:1})]),default:t(()=>[w(" "+c(e(n)("data_set.run")),1)]),_:1}),l(b,{onClick:o[1]||(o[1]=a=>Je()),style:{color:"#1f2329"},text:""},{icon:t(()=>[l(e(_),null,{default:t(()=>[l(e(f),{name:"reference-setting"},{default:t(()=>[l(e(Ta),{class:"svg-icon"})]),_:1})]),_:1})]),default:t(()=>[w(" "+c(e(n)("data_set.parameter_settings")),1)]),_:1}),!e(ke)&&Me.value?(r(),x(b,{key:0,onClick:el,class:"system-text_bg",text:""},{icon:t(()=>[l(e(_),null,{default:t(()=>[l(e(f),null,{default:t(()=>[l(e(Sa),{class:"svg-icon"})]),_:1})]),_:1})]),default:t(()=>[w(" "+c(e(n)("auth.sysParams")),1)]),_:1})):D("",!0),l(b,{disabled:!R.value,onClick:o[2]||(o[2]=a=>ol(()=>{})),type:"primary"},{default:t(()=>[w(c(e(n)("data_set.save")),1)]),_:1},8,["disabled"]),l(E,{direction:"vertical"}),l(e(_),{class:"hover-icon",onClick:nl},{default:t(()=>[l(e(f),{name:"icon_close_outlined"},{default:t(()=>[l(e(Ue),{class:"svg-icon"})]),_:1})]),_:1})])]),i("div",{class:"sql-eidtor",onMouseup:cl},[A(i("p",{class:"arrow-right",onClick:rl},[l(e(_),null,{default:t(()=>[l(e(f),{name:"icon_right_outlined"},{default:t(()=>[l(e(jl),{class:"svg-icon"})]),_:1})]),_:1})],512),[[Q,!I.value]]),A(i("div",{style:K({left:L.value+"px"}),class:"drag-left",onMousedown:pl},null,36),[[Q,I.value]]),A((r(),m("div",{class:"table-list",style:K({width:L.value+"px"})},[i("div",Aa,[i("p",Ua,[w(c(e(n)("data_set.current_data_source"))+" ",1),i("span",Oa,[l(e(_),{style:{color:"#1f2329"},onClick:o[3]||(o[3]=a=>I.value=!1)},{default:t(()=>[l(e(f),{name:"icon_left_outlined"},{default:t(()=>[l(e(Fl),{class:"svg-icon"})]),_:1})]),_:1})])]),l(q,{"check-strictly":!1,onChange:ul,placeholder:e(n)("dataset.pls_slc_data_source"),class:"ds-list","popper-class":"tree-select-ds_popper",modelValue:e(T).datasourceId,"onUpdate:modelValue":o[4]||(o[4]=a=>e(T).datasourceId=a),"node-key":"id",props:sl,data:u.dataSourceList,"render-after-expand":!1},null,8,["placeholder","modelValue","data"]),i("p",Pa,[w(c(e(n)("datasource.data_table")),1),i("span",Ya,[l(e(_),{class:"icon-color"},{default:t(()=>[l(e(f),{name:"reference-table"},{default:t(()=>[l(e(va),{class:"svg-icon"})]),_:1})]),_:1}),w(" "+c(H.value.length),1)])]),l(y,{modelValue:W.value,"onUpdate:modelValue":o[5]||(o[5]=a=>W.value=a),class:"search",placeholder:e(n)("deDataset.by_table_name"),clearable:""},{prefix:t(()=>[l(e(_),null,{default:t(()=>[l(e(f),{name:"icon_search-outline_outlined"},{default:t(()=>[l(e(Oe),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"])]),!H.value.length&&W.value!==""?(r(),m("div",Ra,[i("div",Ba,c(e(n)("data_set.relevant_content_found")),1)])):(r(),m("div",za,[l(e(hl),{itemSize:40,data:H.value,total:H.value.length,width:L.value-17,height:e(We)-350,scrollbarAlwaysOn:!1,"class-name":"el-select-dropdown__list",layout:"vertical"},{default:t(({index:a,style:d})=>[i("div",{class:U([[{active:xe.value===H.value[a].tableName}],"list-item_primary"]),style:K(d),title:H.value[a].tableName,onClick:$=>Fe(H.value[a])},[l(e(_),{class:"icon-color"},{default:t(()=>[l(e(f),{name:"icon_form_outlined"},{default:t(()=>[l(e($a),{class:"svg-icon"})]),_:1})]),_:1}),i("span",Fa,c(H.value[a].tableName),1),i("span",Wa,[l(M,{effect:"dark",content:e(n)("common.copy"),placement:"top"},{default:t(()=>[l(e(_),{class:"hover-icon",onClick:$=>se(H.value[a].tableName)},{default:t(()=>[l(e(f),{name:"icon_copy_outlined"},{default:t(()=>[l(e(be),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["content"]),l(p,{"popper-class":"sql-table-info",placement:"right",width:502,persistent:!1,onShow:$=>ll(H.value[a]),trigger:"click"},{reference:t(()=>[l(e(_),{class:"hover-icon"},{default:t(()=>[l(e(f),{name:"icon_info_outlined"},{default:t(()=>[l(e(Wl),{class:"svg-icon"})]),_:1})]),_:1})]),default:t(()=>[A((r(),m("div",Xa,[i("div",Ja,[i("div",Ga,c(H.value[a].name||H.value[a].tableName),1),l(e(_),{class:"hover-icon de-hover-icon-primary",onClick:Ae($=>se(H.value[a].name||H.value[a].tableName),["stop"])},{default:t(()=>[l(e(f),{name:"icon_copy_outlined"},{default:t(()=>[l(e(be),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"]),i("div",Qa,[l(e(_),null,{default:t(()=>[l(e(f),{name:"icon_text-box_outlined"},{default:t(()=>[l(e(Ca),{class:"svg-icon"})]),_:1})]),_:1}),w(" "+c(me.value.length),1)])]),i("div",Ka,[l(k,{height:"405",style:{width:"100%"},"header-cell-class-name":"header-cell",data:me.value},{default:t(()=>[l(g,{label:e(n)("data_set.physical_field_name")},{default:t($=>[i("div",et,[l(e(_),null,{default:t(()=>[l(e(f),null,{default:t(()=>[(r(),x(ie(e(re)[e(de)[$.row.deType]]),{class:U(["svg-icon",`field-icon-${e(de)[$.row.deType]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),w(" "+c($.row.originName),1)])]),_:1},8,["label"]),l(g,{label:e(n)("common.label")},{default:t($=>[w(c($.row.description||"-"),1)]),_:1},8,["label"]),l(g,{label:e(n)("common.operate")},{default:t($=>[l(e(_),{class:"hover-icon de-hover-icon-primary",onClick:Ae(xt=>se($.row.originName),["stop"])},{default:t(()=>[l(e(f),{name:"icon_copy_outlined"},{default:t(()=>[l(e(be),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])])])),[[ne,pe.value]])]),_:2},1032,["onShow"])])],14,ja)]),_:1},8,["data","total","width","height"])]))],4)),[[ne,ue.value],[Q,I.value]]),i("div",{class:U(["sql-code-right",ae.value&&"p280"]),style:K({width:`calc(100% - ${I.value?L.value:0}px)`})},[l(sa,{onChange:o[6]||(o[6]=a=>R.value=!0),height:`${G.value}px`,"dom-id":"sql-editor",regexp:/\$f2cde\[(.*?)\]/g,ref_key:"myCm",ref:Te,quotaMap:O.value.filter(a=>["num"].includes(a.type)).map(a=>a.name),dimensionMap:J.value.concat(O.value.filter(a=>!["num"].includes(a.type))).map(a=>a.name)},null,8,["height","quotaMap","dimensionMap"]),i("div",{class:"sql-result",style:K({height:`calc(100% - ${G.value}px)`})},[i("div",lt,[i("span",{class:"drag",onMousedown:tl},null,32)]),i("div",at,[l(N,{modelValue:le.value,"onUpdate:modelValue":o[7]||(o[7]=a=>le.value=a)},{default:t(()=>[l(h,{label:e(n)("deDataset.running_results"),name:"result"},null,8,["label"])]),_:1},8,["modelValue"])]),A(i("div",tt,[u.fields.length?(r(),m("div",st,[l(_l,null,{default:t(({height:a,width:d})=>[A((r(),x(B,{columns:u.fields,"header-class":"header-cell",data:u.plxTableData,width:d,height:a,fixed:""},{empty:t(()=>[l(e(we),{description:e(n)("data_set.no_data"),"img-type":"noneWhite"},null,8,["description"])]),_:1},8,["columns","data","width","height"])),[[ne,_e.value]])]),_:1})])):(r(),x(e(we),{key:1,description:" ","img-type":"noneWhite"},{default:t(()=>[i("div",ot,[w(c(e(n)("data_set.click_above"))+" ",1),l(e(_),null,{default:t(()=>[l(e(f),{name:"icon_play-round_outlined"},{default:t(()=>[l(e(Da),{class:"svg-icon"})]),_:1})]),_:1}),w(" "+c(e(n)("data_set.see_the_results")),1)])]),_:1}))],512),[[Q,le.value==="result"]]),A(i("div",nt,[A((r(),x(oa,{"table-data":u.sqlData,"show-pagination":!!u.param.tableId,columns:[],pagination:je},{default:t(()=>[l(g,{key:"startTimeTable","min-width":"100px",prop:"startTime",label:e(n)("dataset.start_time")},{default:t(a=>[i("span",null,c(e(na)(a.row.startTime)),1)]),_:1},8,["label"]),l(g,{key:"sql",prop:"sql","show-overflow-tooltip":"",label:e(n)("dataset.sql")},null,8,["label"]),l(g,{key:"spend",prop:"spend",formatter:dl,label:e(n)("dataset.spend_time")},null,8,["label"]),l(g,{key:"status",prop:"status",label:e(n)("dataset.sql_result")},{default:t(a=>[a.row.status?(r(),m("span",{key:0,class:U([`de-${a.row.status}-pre`,"de-status"])},c(e(n)(`dataset.${a.row.status.toLocaleLowerCase()}`)),3)):(r(),m("span",it,"-"))]),_:1},8,["label"]),l(g,{key:"__operation",label:e(n)("commons.operating"),fixed:"right",width:"100"},{default:t(a=>[l(b,{text:"",onClick:d=>se(a.row.sql)},{default:t(()=>[w(c(e(n)("common.copy")),1)]),_:1},8,["onClick"])]),_:1},8,["label"])]),_:1},8,["table-data","show-pagination","pagination"])),[[ne,Be.value]])],512),[[Q,le.value==="execLog"]])],4),ae.value?(r(),m("div",dt,[i("div",rt,[w(c(e(n)("auth.sysParams"))+" ",1),l(e(_),{class:"hover-icon",onClick:o[8]||(o[8]=a=>ae.value=!1)},{default:t(()=>[l(e(f),{name:"icon_close_outlined"},{default:t(()=>[l(e(Ue),{class:"svg-icon"})]),_:1})]),_:1})]),i("div",ut,[l(y,{style:{width:"100%","margin-bottom":"16px"},modelValue:ce.value,"onUpdate:modelValue":o[9]||(o[9]=a=>ce.value=a),placeholder:e(n)("dataset.edit_search"),clearable:""},{prefix:t(()=>[l(e(_),null,{default:t(()=>[l(e(f),null,{default:t(()=>[l(e(Oe),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"]),i("div",ct,[i("div",mt,c(e(n)("system.system_built_in_variable")),1),(r(!0),m(j,null,ee(J.value,a=>(r(),m("div",{class:"variable-item flex-align-center",onClick:d=>Se(`$f2cde[${a.name}]`),key:a.id},c(a.name),9,pt))),128)),i("div",_t,c(e(n)("system.custom_variable")),1),(r(!0),m(j,null,ee(Ke.value,a=>(r(),m("div",{class:U(["variable-item flex-align-center",["num"].includes(a.type)&&"with-type"]),key:a.id,onClick:d=>Se(`$f2cde[${a.name}]`)},[l(e(_),null,{default:t(()=>[l(e(f),null,{default:t(()=>[(r(),x(ie(Ge(a.type)),{class:U(["svg-icon",Qe(a.type)])},null,8,["class"]))]),_:2},1024)]),_:2},1024),i("span",{title:a.name,class:"ellipsis"},c(a.name),9,vt)],10,ft))),128))])])])):D("",!0)],6)],32),l(vl,{title:Re,modelValue:X.value,"onUpdate:modelValue":o[12]||(o[12]=a=>X.value=a),"modal-class":"sql-dataset-drawer",size:"870px",direction:"rtl"},{footer:t(()=>[l(b,{secondary:"",onClick:o[10]||(o[10]=a=>X.value=!1)},{default:t(()=>[w(c(e(n)("dataset.cancel")),1)]),_:1}),l(b,{type:"primary",onClick:o[11]||(o[11]=a=>ml())},{default:t(()=>[w(c(e(n)("dataset.confirm")),1)]),_:1})]),default:t(()=>[i("div",ht,[l(e(_),{style:{"font-size":"16px"}},{default:t(()=>[l(e(f),{name:"icon_info_colorful"},{default:t(()=>[l(e(Xl),{class:"svg-icon"})]),_:1})]),_:1}),w(" "+c(e(n)("dataset.sql_variable_limit_1")),1),o[13]||(o[13]=i("br",null,null,-1)),w(" "+c(e(n)("dataset.sql_variable_limit_2")),1),o[14]||(o[14]=i("br",null,null,-1))]),l(k,{"header-cell-class-name":"header-cell",data:u.variablesTmp},{empty:t(()=>[l(e(we),{description:e(n)("data_set.no_data"),"img-type":"noneWhite"},null,8,["description"])]),default:t(()=>[l(g,{width:"220",prop:"variableName",label:e(n)("visualization.param_name")},null,8,["label"]),l(g,{width:"200",label:e(n)("deDataset.parameter_type")},{default:t(a=>[l(fl,{class:"select-type","popper-class":"cascader-panel no-scroll_bar",modelValue:a.row.type,"onUpdate:modelValue":d=>a.row.type=d,options:e(ia),onChange:d=>a.row.defaultValue=""},{default:t(({data:d})=>[l(e(_),null,{default:t(()=>[l(e(f),null,{default:t(()=>[(r(),x(ie(e(re)[P(d.value)]),{class:U(["svg-icon",`field-icon-${P(d.value)}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),i("span",null,c(d.label),1)]),_:1},8,["modelValue","onUpdate:modelValue","options","onChange"]),i("span",gt,[l(e(_),null,{default:t(()=>[l(e(f),null,{default:t(()=>[(r(),x(ie(e(re)[P(a.row.type[0])]),{class:U(["svg-icon",`field-icon-${P(a.row.type[0])}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024)])]),_:1},8,["label"]),l(g,{"min-width":"350",prop:"defaultValue",label:e(n)("commons.params_value")},{header:t(()=>[w(c(e(n)("commons.params_value")),1)]),default:t(a=>[P(a.row.type[0])==="text"?(r(),x(y,{key:0,modelValue:a.row.defaultValue,"onUpdate:modelValue":d=>a.row.defaultValue=d,type:"text",placeholder:e(n)("common.please_input")},{prepend:t(()=>[l(Ce,{modelValue:a.row.defaultValueScope,"onUpdate:modelValue":d=>a.row.defaultValueScope=d,style:{width:"calc(100% + 22px)"}},{default:t(()=>[(r(!0),m(j,null,ee(e(Ve),d=>(r(),x(ge,{key:d.value,label:d.label,value:d.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])):D("",!0),P(a.row.type[0])==="value"?(r(),x(y,{key:1,modelValue:a.row.defaultValue,"onUpdate:modelValue":d=>a.row.defaultValue=d,placeholder:e(n)("common.please_input"),type:"number"},{prepend:t(()=>[l(Ce,{modelValue:a.row.defaultValueScope,"onUpdate:modelValue":d=>a.row.defaultValueScope=d,style:{width:"calc(100% + 22px)"}},{default:t(()=>[(r(!0),m(j,null,ee(e(Ve),d=>(r(),x(ge,{key:d.value,label:d.label,value:d.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])):D("",!0),P(a.row.type[0])==="time"?(r(),m("div",Ct,[i("div",yt,[l(Ce,{modelValue:a.row.defaultValueScope,"onUpdate:modelValue":d=>a.row.defaultValueScope=d,style:{width:"calc(100% + 22px)"}},{default:t(()=>[(r(!0),m(j,null,ee(e(Ve),d=>(r(),x(ge,{key:d.value,label:d.label,value:d.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onUpdate:modelValue"])]),a.row.type[0]==="DATETIME-YEAR"?(r(),x(oe,{key:0,modelValue:a.row.defaultValue,"onUpdate:modelValue":d=>a.row.defaultValue=d,type:"year",format:"YYYY","value-format":"YYYY",placeholder:e(n)("dataset.select_year")},null,8,["modelValue","onUpdate:modelValue","placeholder"])):D("",!0),a.row.type[0]==="DATETIME-YEAR-MONTH"?(r(),x(oe,{key:1,modelValue:a.row.defaultValue,"onUpdate:modelValue":d=>a.row.defaultValue=d,type:"month",format:a.row.type[1],"value-format":a.row.type[1],placeholder:e(n)("dataset.select_month")},null,8,["modelValue","onUpdate:modelValue","format","value-format","placeholder"])):D("",!0),a.row.type[0]==="DATETIME-YEAR-MONTH-DAY"?(r(),x(oe,{key:2,modelValue:a.row.defaultValue,"onUpdate:modelValue":d=>a.row.defaultValue=d,type:"date",format:a.row.type[1],"value-format":a.row.type[1],placeholder:e(n)("dataset.select_date")},null,8,["modelValue","onUpdate:modelValue","format","value-format","placeholder"])):D("",!0),a.row.type[0]==="DATETIME"?(r(),x(oe,{key:3,modelValue:a.row.defaultValue,"onUpdate:modelValue":d=>a.row.defaultValue=d,type:"datetime",format:a.row.type[1],"value-format":a.row.type[1],placeholder:e(n)("dataset.select_time")},null,8,["modelValue","onUpdate:modelValue","format","value-format","placeholder"])):D("",!0)])):D("",!0)]),_:1},8,["label"])]),_:1},8,["data"])]),_:1},8,["modelValue"])],64)}}});const Vt=pa(wt,[["__scopeId","data-v-ec400450"]]),Wt=Object.freeze(Object.defineProperty({__proto__:null,default:Vt},Symbol.toStringTag,{value:"Module"}));export{Vt as A,Wt as a,Ca as i,va as r};

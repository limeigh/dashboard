import{i as xe,q as te}from"./element-plus-secondary-0.0.0-dataease.js";import{d as ye}from"./dvMain-0.0.0-dataease.js";import{v as _e,O as Me}from"./chart-0.0.0-dataease.js";import{K as ke,x as q,B as Ie}from"./@antv-0.0.0-dataease.js";import{u as oe}from"./vue-uuid-0.0.0-dataease.js";import{h as Te}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{f as F,i as be,j as b}from"./index-0.0.0-dataease12.js";import{d as we,h as Se,c as Ee,w as Ne}from"./lodash-es-0.0.0-dataease.js";import{d as De,k as Y,b as Be,j as ze,o as He,c as Ae,a as W,z as Le,W as ne,U as re,_ as ie,Y as ae,u as ce,S as Oe,n as Ke}from"./@vue-0.0.0-dataease.js";import{_ as Ve}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./pinia-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./index-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./snowflake-id-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./login-0.0.0-dataease.js";import"./less-0.0.0-dataease.js";import"./tslib-0.0.0-dataease.js";import"./copy-anything-0.0.0-dataease.js";import"./is-what-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./fast-png-0.0.0-dataease.js";import"./iobuffer-0.0.0-dataease.js";import"./pako-0.0.0-dataease.js";import"./vue-router_2-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./dataset-0.0.0-dataease.js";import"./js-base64-0.0.0-dataease.js";import"./chart-0.0.0-dataease2.js";import"./app-0.0.0-dataease.js";import"./decimal.js-0.0.0-dataease.js";import"./eventemitter3-0.0.0-dataease.js";import"./@mapbox-0.0.0-dataease.js";import"./pbf-0.0.0-dataease.js";import"./ieee754-0.0.0-dataease.js";import"./supercluster-0.0.0-dataease.js";import"./gl-matrix-0.0.0-dataease.js";import"./detect-browser-0.0.0-dataease.js";import"./size-sensor-0.0.0-dataease.js";import"./d3-regression-0.0.0-dataease.js";import"./d3-hierarchy-0.0.0-dataease.js";import"./fmin-0.0.0-dataease.js";import"./pdfast-0.0.0-dataease.js";import"./d3-ease-0.0.0-dataease.js";import"./d3-interpolate-0.0.0-dataease.js";import"./d3-color-0.0.0-dataease.js";import"./d3-timer-0.0.0-dataease.js";import"./fecha-0.0.0-dataease.js";import"./topojson-client-0.0.0-dataease.js";import"./viewport-mercator-project-0.0.0-dataease.js";import"./@turf-0.0.0-dataease.js";import"./polygon-clipping-0.0.0-dataease.js";import"./splaytree-0.0.0-dataease.js";import"./robust-predicates-0.0.0-dataease.js";import"./d3-scale-0.0.0-dataease.js";import"./d3-collection-0.0.0-dataease.js";import"./d3-format-0.0.0-dataease.js";import"./d3-time-format-0.0.0-dataease.js";import"./d3-time-0.0.0-dataease.js";import"./d3-array-0.0.0-dataease.js";import"./earcut-0.0.0-dataease.js";import"./regl-0.0.0-dataease.js";import"./mapbox-gl-0.0.0-dataease.js";import"./d3-dsv-0.0.0-dataease.js";import"./geojson-vt-0.0.0-dataease.js";import"./hammerjs-0.0.0-dataease.js";import"./element-resize-detector-0.0.0-dataease.js";import"./batch-processor-0.0.0-dataease.js";import"./d3-hexbin-0.0.0-dataease.js";import"./uuid-0.0.0-dataease.js";import"./mathjs-0.0.0-dataease.js";import"./typed-function-0.0.0-dataease.js";import"./complex.js-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./exceljs-0.0.0-dataease.js";import"./file-saver-0.0.0-dataease.js";const Re=["id"],Ge={class:"button-group"},Ue=["id"],Pe=1,je=De({__name:"TableHeaderGroupConfig",props:{chart:{type:Object,required:!0},themes:{type:String,default:"dark"},propertyInner:{type:Array}},emits:["onConfigChange","onCancelConfig"],setup(P,{emit:se}){const{t:C}=Te(),le=ye(),B=P,X=se,pe=()=>{X("onCancelConfig")},O=Y(()=>{const c=[...B.chart.xAxis];return B.chart.type==="table-normal"&&c.push(...B.chart.yAxis),c}),de=()=>{var k;const c=(k=O.value)==null?void 0:k.map(d=>d.hide!==!0&&d.dataeaseName).filter(d=>d),{fields:n,meta:l}=e.dataCfg,f=l.filter(d=>!c.includes(d.field));X("onConfigChange",{columns:n.columns,meta:f})},me=()=>{var f,k;const c=Se(B.chart),{headerGroupConfig:n}=c.customAttr.tableHeader,l=[];if((f=O.value)==null||f.forEach(d=>{d.hide!==!0&&l.push({key:d.dataeaseName})}),!!l.length){if((k=n==null?void 0:n.columns)!=null&&k.length){const d=l.map(w=>w.key),j=F(n.columns).map(w=>w.key);if(!Ee(d,j)){const{columns:w,meta:V}=n;w.splice(0,w.length,...l),V.splice(0,V.length)}}else c.customAttr.tableHeader.headerGroupConfig={columns:[...l],meta:[]};Ke(()=>{fe(c)})}},v=Y(()=>"menu-group-"+B.chart.id),K=Y(()=>"table-container-"+B.chart.id);let e;const fe=c=>{var Z,$,ee;const n=le.getViewDataDetails(c.id),l=document.getElementById(K.value);let f=[];(Z=n==null?void 0:n.tableRow)!=null&&Z.length&&(f=n.tableRow.slice(0,10));const{headerGroupConfig:k}=c.customAttr.tableHeader,d=[...k.meta],Q=k.columns,j=O.value.reduce((r,o)=>(r[o.dataeaseName]=o,r),{});($=n==null?void 0:n.fields)!=null&&$.length?n.fields.forEach(r=>{const o=j[r.dataeaseName];(o==null?void 0:o.hide)!==!0&&d.push({field:r.dataeaseName,name:r.chartShowName??r.name,formatter:function(t){if(!o||t==null||![2,3].includes(o.deType)||!Ne(t))return t;let _=o.formatterCfg;return _||(_=Me),_e(t,_)}})}):(ee=O.value)==null||ee.forEach(r=>{r.hide!==!0&&d.push({field:r.dataeaseName,name:r.chartShowName??r.name})});const w={fields:{columns:Q},meta:d,data:f},V={width:l.getBoundingClientRect().width,height:l.offsetHeight,tooltip:{getContainer:()=>l,renderTooltip:r=>new ge(r),style:{position:"absolute",borderRadius:"4px"}},interaction:{rangeSelection:!1,resize:{colCellHorizontal:!1,colCellVertical:!1,rowCellVertical:!1}}};e=new ke(l,w,V);const Ce=be(c);e.setTheme(Ce);const D=document.getElementById(v.value);e.on(q.COL_CELL_CONTEXT_MENU,r=>{var A,L,R,G,U;r.preventDefault();const o=e.dataCfg.fields.columns,t=e.dataCfg.meta,_=e.interaction.getActiveCells(),S=_==null?void 0:_.map(y=>y.getMeta().field),h=b(S,o),s=e.getCell(r.target);if(D.innerText="",h!=null&&h.length&&h.findIndex(E=>E.key===s.getMeta().field)===-1){e.interaction.clearState(),e.hideTooltip();return}if((h==null?void 0:h.length)===1&&s.getMeta().colIndex===-1){e.interaction.clearState(),e.interaction.selectHeaderCell({cell:s});const y=document.createElement("span");D.appendChild(y),y.innerText=C("chart.cancel_group"),y.onclick=()=>{var i,x;e.hideTooltip();const p=s.getMeta().parent;if((p==null?void 0:p.id)==="root"){const u=o.findIndex(a=>a.key===s.getMeta().field),[T]=b([s.getMeta().field],o);o.splice(u,1,...T.children);const I=t.findIndex(a=>a.field===s.getMeta().field);t.splice(I,1),e.setDataCfg({fields:{columns:o},meta:t}),e.render(!0)}else{const[u]=b([p.field],o);if(u){const T=(i=u.children)==null?void 0:i.findIndex(g=>g.key===s.getMeta().field),[I]=b([s.getMeta().field],u.children);(x=u.children)==null||x.splice(T,1,...I.children);const a=t.findIndex(g=>g.field===s.getMeta().field);t.splice(a,1),e.setDataCfg({fields:{columns:o},meta:t}),e.render(!0)}}e.interaction.clearState()};const E=document.createElement("span");D.appendChild(E),E.innerText=C("chart.cancel_all_group"),E.onclick=()=>{var i,x;e.hideTooltip();const p=s.getMeta().parent;if((p==null?void 0:p.id)==="root"){const[u]=b([s.getMeta().field],o),T=F(u.children),I=o.findIndex(M=>M.key===s.getMeta().field);o.splice(I,1,...T);const a=J([u]),g=t.filter(M=>!a.includes(M.field));e.setDataCfg({fields:{columns:o},meta:g}),e.render(!0)}else{const[u]=b([p.field],o);if(u){const[T]=b([s.getMeta().field],u.children),I=F(T.children),a=(i=u.children)==null?void 0:i.findIndex(z=>z.key===s.getMeta().field);(x=u.children)==null||x.splice(a,1,...I);const g=J([T]),M=t.filter(z=>!g.includes(z.field));e.setDataCfg({fields:{columns:o},meta:M}),e.render(!0)}}e.interaction.clearState()};const m=document.createElement("span");D.appendChild(m),m.innerText=C("chart.rename"),m.onclick=()=>{e.hideTooltip();const p=t.find(i=>i.field===s.getMeta().field);te.prompt("",C("chart.group_name"),{confirmButtonText:C("chart.confirm"),cancelButtonText:C("chart.cancel"),showClose:!1,showInput:!0,inputPlaceholder:C("chart.group_name_edit_tip"),inputValue:p.name,inputErrorMessage:C("chart.group_name_error_tip"),inputValidator:i=>(i==null?void 0:i.length)<1||(i==null?void 0:i.length)>50?C("chart.group_name_error_tip"):!0}).then(i=>{p.name=i.value,e.setDataCfg({meta:t}),e.render(!0)}).catch(()=>{})},e.showTooltip({position:{x:r.x,y:r.y},content:D});return}if((h==null?void 0:h.length)>1){if(!_.every(a=>a.getMeta().parent.id===s.getMeta().parent.id))return;let E=-1,m=s;for(;(L=(A=m==null?void 0:m.getMeta)==null?void 0:A.call(m))!=null&&L.parent||m!=null&&m.parent;)E++,m=((G=(R=m==null?void 0:m.getMeta)==null?void 0:R.call(m))==null?void 0:G.parent)||(m==null?void 0:m.parent);let p=-1,i=-1;const x=s.getMeta().parent;x.colIndex!==-1?h.forEach(a=>{const g=x.children.findIndex(M=>M.getMeta().field===a.key);(g<p||p===-1)&&(p=g),(g>i||i===-1)&&(i=g)}):h.forEach(a=>{const g=x.children.findIndex(M=>M.key===a.key);(g<p||p===-1)&&(p=g),(g>i||i===-1)&&(i=g)});const u=[];if((x==null?void 0:x.id)==="root")u.push(...o.slice(p,i+1));else{const[a]=b([x.field],o);u.push(...(U=a.children)==null?void 0:U.slice(p,i+1))}if(he(u)+E>1)return;const I=document.createElement("span");D.appendChild(I),I.innerText=C("chart.merge_group"),I.onclick=()=>{e.hideTooltip(),te.prompt("",C("chart.group_name"),{confirmButtonText:C("chart.confirm"),cancelButtonText:C("chart.cancel"),showClose:!1,showInput:!0,inputPlaceholder:C("chart.group_name_edit_tip"),inputErrorMessage:C("chart.group_name_error_tip"),inputValue:C("chart.group"),inputValidator:a=>(a==null?void 0:a.length)<1||(a==null?void 0:a.length)>50?C("chart.group_name_error_tip"):!0}).then(a=>{var g;if((x==null?void 0:x.id)==="root"){const M=oe.v4();o==null||o.splice(p,i-p+1,{key:M,children:u}),t.push({field:M,name:a.value}),e.setDataCfg({fields:{columns:o},meta:t}),e.render(!0)}else{const[M]=b([x.field],o),z=oe.v4();(g=M.children)==null||g.splice(p,i-p+1,{key:z,children:u}),t.push({field:z,name:a.value}),e.setDataCfg({fields:{columns:o},meta:t}),e.render(!0)}e.interaction.clearState()}).catch(()=>{})},e.showTooltip({position:{x:r.x,y:r.y},content:D});return}}),e.on(q.COL_CELL_CLICK,r=>{const o=e.store.get("lastClickedCell"),t=r.originalEvent;if(!o||!(t!=null&&t.ctrlKey||t!=null&&t.metaKey||t!=null&&t.shiftKey)){const _=e.getCell(r.target);e.store.set("lastClickedCell",_);return}if(t!=null&&t.shiftKey){if(!o){const y=e.getCell(r.target);e.store.set("lastClickedCell",y);return}const _=e.getCell(r.target),S=o.getMeta(),h=_.getMeta();if(S.key===h.key||S.level!==h.level||S.parent!==h.parent)return;const s=h.parent,A=s.children.findIndex(y=>y.key===S.key),L=s.children.findIndex(y=>y.key===h.key),R=Math.min(A,L),G=Math.max(A,L),U=s.children.slice(R,G+1);e.interaction.clearState(),U.forEach(y=>{e.interaction.selectHeaderCell({cell:y.belongsCell,isMultiSelection:!0})})}}),e.once(q.LAYOUT_AFTER_HEADER_LAYOUT,r=>{var t;if(!e.store.get("initialized")){e.store.set("initialized",!0),e.changeSheetSize(r.colsHierarchy.width);const _=((t=e.dataCfg.data)==null?void 0:t.length)||0,S=r.colsHierarchy.height,h=e.options.style.cellCfg.height,s=S+h*_;l.offsetHeight>s&&(l.style.height=s+"px"),e.render(!1)}}),e.render()},J=c=>{const n=[],l=f=>{var k;if(((k=f.children)==null?void 0:k.length)>0){n.push(f.key);for(let d=0;d<f.children.length;d++)l(f.children[d])}};return c.forEach(f=>l(f)),n},he=c=>{if(!(c!=null&&c.length))return 0;const n=f=>{if(!f.children||f.children.length===0)return 0;const k=f.children.map(d=>n(d));return Math.max(...k)+1},l=c.map(f=>n(f));return Math.max(...l)},ue=we(c=>{if(e){const n=e.container.cfg.height;if(c>n){const l=document.getElementById(K.value);l.style.height=n+"px"}e.changeSheetSize(void 0,c),e.render(!1)}},500),N=[0,0];let H;Be(()=>{me(),H=new ResizeObserver(([c]=[])=>{const[n]=c.borderBoxSize||[];N[0]||N[1]||(N[0]=n.inlineSize,N[1]=n.blockSize),!(Math.abs(n.blockSize-N[1])<Pe)&&(N[0]=n.inlineSize,N[1]=n.blockSize,ue(Math.round(n.blockSize)))}),H.observe(document.getElementById(K.value))}),ze(()=>{H==null||H.disconnect()});class ge extends Ie{show(n){super.show(n),this.container.style.display="flex"}hide(){this.container&&(this.container.style.display="none")}}return(c,n)=>{const l=xe;return He(),Ae(Oe,null,[W("div",{id:K.value,class:Le(["table-container",{dark:P.themes==="dark"}])},null,10,Re),W("div",Ge,[ne(l,{effect:P.themes,onClick:pe},{default:re(()=>[ie(ae(ce(C)("chart.cancel")),1)]),_:1},8,["effect"]),ne(l,{type:"primary",onClick:de},{default:re(()=>[ie(ae(ce(C)("chart.confirm")),1)]),_:1})]),W("div",{id:v.value,class:"group-menu"},null,8,Ue)],64)}}});const an=Ve(je,[["__scopeId","data-v-996aa40d"]]);export{an as default};

import{E as ge,m as Se,e as ke,i as Ce,o as De,v as Pe}from"./element-plus-secondary-0.0.0-dataease.js";import{d as be,k as u,r as i,l as Ie,t as Ae,b as xe,n as E,a7 as Ee,ae as W,o as s,c as G,a as $,T as l,Z as k,u as t,R as v,W as d,U as f,$ as j,a0 as Te,z as T,S as H,_ as Be,Y as U}from"./@vue-0.0.0-dataease.js";import{i as Ne}from"./icon_add_outlined-0.0.0-dataease.js";import{D as Re}from"./DeResourceTree-0.0.0-dataease.js";import{d as Me}from"./dvMain-0.0.0-dataease.js";import{m as Oe,n as Ve}from"./DePreview-0.0.0-dataease.js";import{_ as Fe}from"./PreviewHead.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import{E as Y}from"./EmptyBackground-0.0.0-dataease.js";import Z from"./DeResourceArrow-0.0.0-dataease.js";import{S as Le,i as qe,o as ze}from"./canvasUtils-0.0.0-dataease.js";import{useAppStoreWithOut as We}from"./app-0.0.0-dataease.js";import{u as Ge}from"./useMoveLine-0.0.0-dataease.js";import{a as $e,e as je,f as He}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{a as Ue,c as Ye}from"./imgUtils-0.0.0-dataease.js";import{s as Ze}from"./pinia-0.0.0-dataease.js";import{A as Je}from"./AppExportForm-0.0.0-dataease.js";import{u as B}from"./index-0.0.0-dataease.js";const ma=be({__name:"DashboardPreviewShow",props:{showPosition:{required:!1,type:String,default:"preview"},noClose:{required:!1,type:Boolean,default:!1},resourceTable:{required:!1,type:String,default:"core"}},setup(C,{expose:J}){const K=$e(),Q=u(()=>K.getName),N=i(null),h=Me(),D=i(null),R=i(null),y=i(!0),P=We(),g=i(!0),m=i(!1),a=Ie({canvasDataPreview:null,canvasStylePreview:null,canvasViewInfoPreview:null,dvInfo:null,curPreviewGap:0,showOffset:{top:110,left:280}}),{fullscreenFlag:X,canvasViewDataInfo:M}=Ze(h),{width:b,node:ee}=Ge("DASHBOARD"),{t:w}=He(),ae=C,{showPosition:c,resourceTable:te}=Ae(ae),_=i(),oe=u(()=>{var e;return(e=_.value)==null?void 0:e.hasData}),ne=u(()=>P.getIsDataEaseBi),se=u(()=>{var e;return(e=_.value)==null?void 0:e.rootManage}),O=u(()=>{var e;return(e=_.value)==null?void 0:e.mounted});xe(()=>{B({name:"canvasDownload",callback:function(){F("img")}})});function re(){var e;(e=_.value)==null||e.createNewObject()}const V=(e,r)=>{const o=c.value==="multiplexing"?Le:qe;g.value=!1,o(e,{busiFlag:"dashboard",resourceTable:"core"},function({canvasDataResult:n,canvasStyleResult:S,dvInfo:I,canvasViewInfoPreview:A,curPreviewGap:x}){I.weight=r,a.canvasDataPreview=n,a.canvasStylePreview=S,a.canvasViewInfoPreview=A,a.dvInfo=I,a.curPreviewGap=x,g.value=!0,E(()=>{R.value.restore(),ze({resourceId:e})})})},ie=["bubble-map","flow-map","heat-map","map","symbolic-map"],F=e=>{var o;m.value=!0;const r=((o=a.canvasDataPreview)==null?void 0:o.filter(n=>ie.includes(n.innerType)).map(n=>n.id))||[];r.forEach(n=>B().emitter.emit("l7-prepare-picture",n)),E(()=>{const n=D.value.querySelector(".canvas-container");Ue(e,n,a.dvInfo.name,()=>{m.value=!1,r.forEach(S=>B().emitter.emit("l7-unprepare-picture",S))})})},le=e=>{e==="template"?L(e,null):e==="app"&&ce()},ce=()=>{const e=ue();e&&e.length>0?ge.warning(w("visualization.export_tips",[e])):N.value.init({appName:a.dvInfo.name,icon:null,version:"2.0",creator:Q.value,required:"2.9.0",description:null})},ue=()=>{let e=",";return Object.keys(M.value).forEach(r=>{const o=M.value[r];o&&(o==null?void 0:o.dataFrom)==="template"&&(e=e+o.title+",")}),e.slice(1)},L=(e,r)=>{m.value=!0,E(()=>{const o=D.value.querySelector(".canvas-container");Ye(e,o,a.dvInfo.name,r,()=>{m.value=!1})})},Ke=()=>{y.value=!y.value},ve=()=>a,pe=e=>{V(e,a.dvInfo.weight)},de=e=>{V(e.id,e.weight),c.value==="multiplexing"&&h.initCurMultiplexingComponents()},fe=u(()=>{var e;return!!((e=h.dvInfo)!=null&&e.name)});Ee(()=>{c.value==="preview"&&h.canvasDataInit()});const p=i(!0),q=e=>{p.value=e},me=()=>{P.setArrowSide(!0)},we=()=>{P.setArrowSide(!1)},_e=e=>{L("app",e)},he=u(()=>[{"--top-show-offset":a.showOffset.top},{"--left-show-offset":a.showOffset.left}]);return J({getPreviewStateInfo:ve}),(e,r)=>{var z;const o=Se,n=W("ArrowLeft"),S=ke,I=W("ArrowRight"),A=Ce,x=De,ye=Pe;return s(),G(H,null,[$("div",{class:"dv-preview dv-teleport-query",style:k(he.value)},[C.noClose?v("",!0):(s(),l(Z,{key:0,style:k({left:(p.value?t(b)-12:0)+"px"}),onChangeSideTreeStatus:q,isInside:!p.value},null,8,["style","isInside"])),d(o,{onMouseenter:me,onMouseleave:we,class:T(["resource-area",{"close-side":!y.value,retract:!p.value}]),ref_key:"node",ref:ee,style:k({width:t(b)+"px"})},{default:f(()=>[C.noClose?v("",!0):(s(),l(Z,{key:0,isInside:!p.value,style:k({left:(p.value?t(b)-12:0)+"px"}),onChangeSideTreeStatus:q},null,8,["isInside","style"])),j(d(Re,{ref_key:"resourceTreeRef",ref:_,"cur-canvas-type":"dashboard","show-position":t(c),"resource-table":t(te),onNodeClick:de},null,8,["show-position","resource-table"]),[[Te,y.value]])]),_:1},8,["class","style"]),j((s(),l(x,{class:T(["preview-area",{"no-data":!((z=a.dvInfo)!=null&&z.id)}])},{default:f(()=>[(t(c),v("",!0)),fe.value?(s(),G(H,{key:1},[t(c)==="preview"?(s(),l(Fe,{key:0,onReload:pe,onDownload:F,onDownloadAsAppTemplate:le})):v("",!0),$("div",{ref_key:"previewCanvasContainer",ref:D,class:T(["content",{"de-screen-full":t(X)}]),id:"de-preview-content"},[d(Oe,{"canvas-id":"canvas-main","canvas-style-data":a.canvasStylePreview||{},"component-data":a.canvasDataPreview||[]},null,8,["canvas-style-data","component-data"]),a.canvasStylePreview&&g.value?(s(),l(Ve,{key:0,ref_key:"dashboardPreview",ref:R,"dv-info":a.dvInfo,"cur-gap":a.curPreviewGap,"component-data":a.canvasDataPreview,"canvas-style-data":a.canvasStylePreview,"canvas-view-info":a.canvasViewInfoPreview,"show-position":t(c),"download-status":m.value,"show-linkage-button":!1},null,8,["dv-info","cur-gap","component-data","canvas-style-data","canvas-view-info","show-position","download-status"])):v("",!0)],2)],64)):oe.value&&O.value?(s(),l(Y,{key:2,description:t(w)("visualization.preview_select_tips"),"img-type":"select"},null,8,["description"])):O.value?(s(),l(Y,{key:3,description:t(w)("visualization.have_none_resource"),"img-type":"none"},{default:f(()=>[se.value&&!ne.value?(s(),l(A,{key:0,onClick:re,type:"primary"},{icon:f(()=>[d(t(je),{name:"icon_add_outlined"},{default:f(()=>[d(t(Ne),{class:"svg-icon"})]),_:1})]),default:f(()=>[Be(" "+U(t(w)("commons.create"))+U(t(w)("chart.dashboard")),1)]),_:1})):v("",!0)]),_:1},8,["description"])):v("",!0)]),_:1},8,["class"])),[[ye,!g.value]])],4),d(Je,{ref_key:"appExportFormRef",ref:N,"dv-info":a.dvInfo,"component-data":a.canvasDataPreview,"canvas-view-info":a.canvasViewInfoPreview,onDownLoadApp:_e},null,8,["dv-info","component-data","canvas-view-info"])],64)}}});export{ma as _};

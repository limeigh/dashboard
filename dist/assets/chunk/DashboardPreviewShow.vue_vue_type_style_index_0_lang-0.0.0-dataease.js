import{a as T,z as ge}from"./index-0.0.0-dataease.js";import"./el-footer-0.0.0-dataease.js";import"./el-aside-0.0.0-dataease.js";import"./el-main-0.0.0-dataease.js";import{a as Se,n as ke,o as Ce,D as De,j as Pe,y as Ie}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as be,y as u,r as i,X as Ae,af as xe,t as Te,o as Ee,n as E,aj as Be,e as j,f as s,O as W,P as G,g as l,T as k,u as t,_ as v,j as d,i as f,R as H,U as Ne,S as B,W as U,a3 as Re,a4 as $}from"./vue-0.0.0-dataease.js";import{i as Oe}from"./icon_add_outlined-0.0.0-dataease.js";import{D as Me}from"./DeResourceTree-0.0.0-dataease.js";import{d as Ve}from"./dvMain-0.0.0-dataease.js";import{m as Fe,n as Le}from"./DePreview-0.0.0-dataease.js";import{_ as qe}from"./PreviewHead.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import{E as X}from"./EmptyBackground-0.0.0-dataease.js";import J from"./DeResourceArrow-0.0.0-dataease.js";import{S as ze,i as je,o as We}from"./canvasUtils-0.0.0-dataease.js";import{useAppStoreWithOut as Ge}from"./app-0.0.0-dataease.js";import{u as He}from"./useMoveLine-0.0.0-dataease.js";import{a as Ue,c as $e}from"./imgUtils-0.0.0-dataease.js";import{A as Xe}from"./AppExportForm-0.0.0-dataease.js";import{a as Je,c as Ke}from"./index-0.0.0-dataease16.js";const _a=be({__name:"DashboardPreviewShow",props:{showPosition:{required:!1,type:String,default:"preview"},noClose:{required:!1,type:Boolean,default:!1},resourceTable:{required:!1,type:String,default:"core"}},setup(C,{expose:K}){const Q=Se(),Y=u(()=>Q.getName),N=i(null),h=Ve(),D=i(null),R=i(null),y=i(!0),P=Ge(),g=i(!0),m=i(!1),a=Ae({canvasDataPreview:null,canvasStylePreview:null,canvasViewInfoPreview:null,dvInfo:null,curPreviewGap:0,showOffset:{top:110,left:280}}),{fullscreenFlag:Z,canvasViewDataInfo:O}=xe(h),{width:I,node:ee}=He("DASHBOARD"),{t:w}=Ce(),ae=C,{showPosition:c,resourceTable:te}=Te(ae),_=i(),oe=u(()=>{var e;return(e=_.value)==null?void 0:e.hasData}),ne=u(()=>P.getIsDataEaseBi),se=u(()=>{var e;return(e=_.value)==null?void 0:e.rootManage}),M=u(()=>{var e;return(e=_.value)==null?void 0:e.mounted});Ee(()=>{T({name:"canvasDownload",callback:function(){F("img")}})});function re(){var e;(e=_.value)==null||e.createNewObject()}const V=(e,r)=>{const o=c.value==="multiplexing"?ze:je;g.value=!1,o(e,{busiFlag:"dashboard",resourceTable:"core"},function({canvasDataResult:n,canvasStyleResult:S,dvInfo:b,canvasViewInfoPreview:A,curPreviewGap:x}){b.weight=r,a.canvasDataPreview=n,a.canvasStylePreview=S,a.canvasViewInfoPreview=A,a.dvInfo=b,a.curPreviewGap=x,g.value=!0,E(()=>{R.value.restore(),We({resourceId:e})})})},ie=["bubble-map","flow-map","heat-map","map","symbolic-map"],F=e=>{var o;m.value=!0;const r=((o=a.canvasDataPreview)==null?void 0:o.filter(n=>ie.includes(n.innerType)).map(n=>n.id))||[];r.forEach(n=>T().emitter.emit("l7-prepare-picture",n)),E(()=>{const n=D.value.querySelector(".canvas-container");Ue(e,n,a.dvInfo.name,()=>{m.value=!1,r.forEach(S=>T().emitter.emit("l7-unprepare-picture",S))})})},le=e=>{e==="template"?L(e,null):e==="app"&&ce()},ce=()=>{const e=ue();e&&e.length>0?De.warning(w("visualization.export_tips",[e])):N.value.init({appName:a.dvInfo.name,icon:null,version:"2.0",creator:Y.value,required:"2.9.0",description:null})},ue=()=>{let e=",";return Object.keys(O.value).forEach(r=>{const o=O.value[r];o&&(o==null?void 0:o.dataFrom)==="template"&&(e=e+o.title+",")}),e.slice(1)},L=(e,r)=>{m.value=!0,E(()=>{const o=D.value.querySelector(".canvas-container");$e(e,o,a.dvInfo.name,r,()=>{m.value=!1})})},Qe=()=>{y.value=!y.value},ve=()=>a,pe=e=>{V(e,a.dvInfo.weight)},de=e=>{V(e.id,e.weight),c.value==="multiplexing"&&h.initCurMultiplexingComponents()},fe=u(()=>{var e;return!!((e=h.dvInfo)!=null&&e.name)});Be(()=>{c.value==="preview"&&h.canvasDataInit()});const p=i(!0),q=e=>{p.value=e},me=()=>{P.setArrowSide(!0)},we=()=>{P.setArrowSide(!1)},_e=e=>{L("app",e)},he=u(()=>[{"--top-show-offset":a.showOffset.top},{"--left-show-offset":a.showOffset.left}]);return K({getPreviewStateInfo:ve}),(e,r)=>{var z;const o=Je,n=j("ArrowLeft"),S=Pe,b=j("ArrowRight"),A=Ie,x=Ke,ye=ge;return s(),W(U,null,[G("div",{class:"dv-preview dv-teleport-query",style:k(he.value)},[C.noClose?v("",!0):(s(),l(J,{key:0,style:k({left:(p.value?t(I)-12:0)+"px"}),onChangeSideTreeStatus:q,isInside:!p.value},null,8,["style","isInside"])),d(o,{onMouseenter:me,onMouseleave:we,class:B(["resource-area",{"close-side":!y.value,retract:!p.value}]),ref_key:"node",ref:ee,style:k({width:t(I)+"px"})},{default:f(()=>[C.noClose?v("",!0):(s(),l(J,{key:0,isInside:!p.value,style:k({left:(p.value?t(I)-12:0)+"px"}),onChangeSideTreeStatus:q},null,8,["isInside","style"])),H(d(Me,{ref_key:"resourceTreeRef",ref:_,"cur-canvas-type":"dashboard","show-position":t(c),"resource-table":t(te),onNodeClick:de},null,8,["show-position","resource-table"]),[[Ne,y.value]])]),_:1},8,["class","style"]),H((s(),l(x,{class:B(["preview-area",{"no-data":!((z=a.dvInfo)!=null&&z.id)}])},{default:f(()=>[(t(c),v("",!0)),fe.value?(s(),W(U,{key:1},[t(c)==="preview"?(s(),l(qe,{key:0,onReload:pe,onDownload:F,onDownloadAsAppTemplate:le})):v("",!0),G("div",{ref_key:"previewCanvasContainer",ref:D,class:B(["content",{"de-screen-full":t(Z)}]),id:"de-preview-content"},[d(Fe,{"canvas-id":"canvas-main","canvas-style-data":a.canvasStylePreview||{},"component-data":a.canvasDataPreview||[]},null,8,["canvas-style-data","component-data"]),a.canvasStylePreview&&g.value?(s(),l(Le,{key:0,ref_key:"dashboardPreview",ref:R,"dv-info":a.dvInfo,"cur-gap":a.curPreviewGap,"component-data":a.canvasDataPreview,"canvas-style-data":a.canvasStylePreview,"canvas-view-info":a.canvasViewInfoPreview,"show-position":t(c),"download-status":m.value,"show-linkage-button":!1},null,8,["dv-info","cur-gap","component-data","canvas-style-data","canvas-view-info","show-position","download-status"])):v("",!0)],2)],64)):oe.value&&M.value?(s(),l(X,{key:2,description:t(w)("visualization.preview_select_tips"),"img-type":"select"},null,8,["description"])):M.value?(s(),l(X,{key:3,description:t(w)("visualization.have_none_resource"),"img-type":"none"},{default:f(()=>[se.value&&!ne.value?(s(),l(A,{key:0,onClick:re,type:"primary"},{icon:f(()=>[d(t(ke),{name:"icon_add_outlined"},{default:f(()=>[d(t(Oe),{class:"svg-icon"})]),_:1})]),default:f(()=>[Re(" "+$(t(w)("commons.create"))+$(t(w)("chart.dashboard")),1)]),_:1})):v("",!0)]),_:1},8,["description"])):v("",!0)]),_:1},8,["class"])),[[ye,!g.value]])],4),d(Xe,{ref_key:"appExportFormRef",ref:N,"dv-info":a.dvInfo,"component-data":a.canvasDataPreview,"canvas-view-info":a.canvasViewInfoPreview,onDownLoadApp:_e},null,8,["dv-info","component-data","canvas-view-info"])],64)}}});export{_a as _};

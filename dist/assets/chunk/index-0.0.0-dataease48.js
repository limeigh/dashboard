import{y as te}from"./index-0.0.0-dataease.js";import{a as ne,w as oe,n as le,j as re}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{i as F}from"./icon_right_outlined-0.0.0-dataease.js";import{mountedOrg as ie,switchOrg as se}from"./user-0.0.0-dataease.js";import H from"./OrgCell-0.0.0-dataease.js";import{l as ce}from"./logout-0.0.0-dataease.js";import{s as ue}from"./index-0.0.0-dataease59.js";import{c as de,A as U,i as ve,B as ge,n as D,t as W,k as q,I as fe,w as he}from"./index-0.0.0-dataease29.js";import{d as Y,r as f,q as me,y as Z,w as _e,a as pe,o as ee,n as M,j as i,R as ye,a7 as ke,a2 as G,f as _,O as I,W as N,P as p,u as L,a4 as J,S as K,g as V,i as $,_ as Q,a6 as X}from"./vue-0.0.0-dataease.js";import"./index-0.0.0-dataease30.js";import"./index-0.0.0-dataease60.js";import{_ as we}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./interactive-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease.js";import"./dataset-0.0.0-dataease.js";import"./datasource-0.0.0-dataease.js";import"./app-0.0.0-dataease.js";const[xe,S]=de("image"),Ce={src:String,alt:String,fit:String,position:String,round:Boolean,block:Boolean,width:D,height:D,radius:D,lazyLoad:Boolean,iconSize:D,showError:W,errorIcon:q("photo-fail"),iconPrefix:String,showLoading:W,loadingIcon:q("photo"),crossorigin:String,referrerpolicy:String,decoding:String};var be=Y({name:xe,props:Ce,emits:["load","error"],setup(t,{emit:h,slots:x}){const k=f(!1),u=f(!0),s=f(),{$Lazyload:w}=me().proxy,T=Z(()=>{const e={width:U(t.width),height:U(t.height)};return ve(t.radius)&&(e.overflow="hidden",e.borderRadius=U(t.radius)),e});_e(()=>t.src,()=>{k.value=!1,u.value=!0});const d=e=>{u.value&&(u.value=!1,h("load",e))},C=()=>{const e=new Event("load");Object.defineProperty(e,"target",{value:s.value,enumerable:!0}),d(e)},P=e=>{k.value=!0,u.value=!1,h("error",e)},c=(e,b,O)=>O?O():i(fe,{name:e,size:t.iconSize,class:b,classPrefix:t.iconPrefix},null),y=()=>{if(u.value&&t.showLoading)return i("div",{class:S("loading")},[c(t.loadingIcon,S("loading-icon"),x.loading)]);if(k.value&&t.showError)return i("div",{class:S("error")},[c(t.errorIcon,S("error-icon"),x.error)])},B=()=>{if(k.value||!t.src)return;const e={alt:t.alt,class:S("img"),decoding:t.decoding,style:{objectFit:t.fit,objectPosition:t.position},crossorigin:t.crossorigin,referrerpolicy:t.referrerpolicy};return t.lazyLoad?ye(i("img",G({ref:s},e),null),[[ke("lazy"),t.src]]):i("img",G({ref:s,src:t.src,onLoad:d,onError:P},e),null)},E=({el:e})=>{const b=()=>{e===s.value&&u.value&&C()};s.value?b():M(b)},z=({el:e})=>{e===s.value&&!k.value&&P()};return w&&ge&&(w.$on("loaded",E),w.$on("error",z),pe(()=>{w.$off("loaded",E),w.$off("error",z)})),ee(()=>{M(()=>{var e;(e=s.value)!=null&&e.complete&&!t.lazyLoad&&C()})}),()=>{var e;return i("div",{class:S({round:t.round,block:t.block}),style:T.value},[B(),y(),(e=x.default)==null?void 0:e.call(x)])}}});const Ie=he(be);var Le=Ie;const Se=""+new URL("../png/user-0.0.0-dataease.png",import.meta.url).href;const Pe={class:"de-mobile-user"},Be={class:"mobile-user-top"},Ee={class:"user-name"},ze={class:"cell-org_scroll"},Oe={class:"grey"},De=["onClick"],Ne=Y({__name:"index",setup(t){const h=ne(),{push:x}=te(),k=f("组织"),u=f(""),s=f(!0),w=async()=>{await oe(),ce(),x("/login")},T=()=>{s.value=!1},d=f("");let C=null;const P=()=>{var o;const n=[...C];for(;n.length;){const a=n.pop();if((a==null?void 0:a.id)===h.getOid){u.value=a==null?void 0:a.name;break}(o=a==null?void 0:a.children)!=null&&o.length&&a.children.forEach(g=>n.push(g))}};let c=[],y=[];const B=(n,o)=>{n.forEach(a=>{var R;const{name:g,id:r}=a;o<=c.length?(o<c.length&&(c=c.slice(0,o),y=y.slice(0,o)),c.splice(c.length-1,1,r),y.splice(y.length-1,1,g)):(c.push(r),y.push(g));let m=o+1;r===h.getOid&&(l.value=[...y],v.value=[...c],m=999),(R=a==null?void 0:a.children)!=null&&R.length&&m!==999&&B(a==null?void 0:a.children,m)})};ee(()=>{ie().then(n=>{C=n.data,j.value=n.data,P(),B(C,1),l.value.pop(),v.value.pop(),d.value=l.value[l.value.length-1]})});const E=n=>{se(n).then(o=>{const a=o.data.token;h.setToken(a),h.setExp(o.data.exp),h.setTime(Date.now()),window.location.reload()})},z=()=>{l.value.pop(),d.value=l.value[l.value.length-1],v.value.pop(),l.value.length||(s.value=!0)},e=()=>{l.value.length&&(l.value=[],d.value="",v.value=[])},b=(n,o)=>{n!=="right"?E(o.id):(l.value.push(o.name),d.value=o.name,v.value.push(o.id))},O=n=>{n!==v.value.length-1&&(v.value=v.value.slice(0,n+1),l.value=l.value.slice(0,n+1),d.value=l.value[l.value.length-1])},j=f([]),l=f([]),v=f([]),A=(n,o)=>{const a=n.shift();return o.reduce((g,r)=>{if(a&&r.id===a){if(!n.length)return r.children||[];g=A([...n],r.children||[])||[]}return g},[])},ae=Z(()=>v.value.length?A([...v.value],j.value):j.value);return(n,o)=>{const a=le,g=re;return _(),I("div",Pe,[s.value?(_(),I(N,{key:0},[o[0]||(o[0]=p("div",{class:"logout flex-center",style:{"padding-top":"8px",margin:"0"}},"我的",-1)),p("div",Be,[i(L(Le),{round:"",width:"48",height:"48",src:L(Se)},null,8,["src"]),p("div",Ee,J(L(h).name),1)]),i(H,{onClick:T,label:"切换组织","prefix-icon":"icon_switch_outlined",tips:u.value,nextlevel:""},null,8,["tips"]),p("div",{class:"logout flex-center danger",onClick:w},"注销")],64)):(_(),I(N,{key:1},[i(L(ue),{"safe-area-inset-top":"",title:d.value||k.value,"left-arrow":"",onClickLeft:z},null,8,["title"]),p("div",ze,[p("div",Oe,[p("div",{onClick:e,class:"flex-align-center"},[p("span",{class:K(["ellipsis",!!l.value.length&&"active"])},"组织",2),l.value.length?(_(),V(g,{key:0},{default:$(()=>[i(a,{name:"icon_right_outlined"},{default:$(()=>[i(L(F),{class:"svg-icon"})]),_:1})]),_:1})):Q("",!0)]),(_(!0),I(N,null,X(l.value,(r,m)=>(_(),I("div",{onClick:R=>O(m),class:"flex-align-center",key:r},[p("span",{class:K(["ellipsis",r!==d.value&&"active"])},J(r),3),l.value.length>1&&m!==l.value.length-1?(_(),V(g,{key:0},{default:$(()=>[i(a,{name:"icon_right_outlined"},{default:$(()=>[i(L(F),{class:"svg-icon"})]),_:1})]),_:1})):Q("",!0)],8,De))),128))]),(_(!0),I(N,null,X(ae.value,r=>(_(),V(H,{onClick:m=>b(m,r),key:r.id,label:r.name,nextlevel:r.children,active:u.value===r.name},null,8,["onClick","label","nextlevel","active"]))),128))])],64))])}}});const na=we(Ne,[["__scopeId","data-v-289afcd3"]]);export{na as default};

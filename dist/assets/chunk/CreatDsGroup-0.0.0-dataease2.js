import{b as ge,z as ye}from"./index-0.0.0-dataease.js";import{E as be}from"./el-dialog-0.0.0-dataease.js";import{o as we,aA as ke,F as De,D as R,G as xe,n as Ee,j as Ve,y as Ce}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import{E as Te}from"./el-tree-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as Fe}from"./el-tree-select-0.0.0-dataease.js";import{E as Ne,a as Se}from"./el-form-item-0.0.0-dataease.js";import{d as Ie,X as $,r as n,w as Re,n as H,y as F,s as qe,R as Be,f as D,g as q,i as s,j as l,a3 as W,a4 as x,u as f,a9 as Pe,a8 as Ae,_ as N,P as y,O as X}from"./vue-0.0.0-dataease.js";import{d as J}from"./dv-folder-0.0.0-dataease.js";import{i as Ge}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{l as Le,a as Me,b as Ue,u as je}from"./datasource-0.0.0-dataease.js";import{t as ze}from"./treeSortUtils-0.0.0-dataease.js";import{n as Ke}from"./nothing-tree-0.0.0-dataease.js";import{e as Oe}from"./lodash-0.0.0-dataease.js";import{_ as $e}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./index-0.0.0-dataease3.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./token-0.0.0-dataease.js";import"./index-0.0.0-dataease15.js";import"./index-0.0.0-dataease4.js";import"./index-0.0.0-dataease6.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease5.js";const He=["title"],We={key:2},Xe={class:"tree-content"},Je={class:"custom-tree-node"},Qe=["title"],Ye={key:0,class:"empty-search"},Ze=["src"],et=Ie({__name:"CreatDsGroup",emits:["finish","handleShowFinishPage"],setup(tt,{expose:Q,emit:Y}){const{t:o}=we(),{wsCache:b}=ge(),p=$({tData:[]}),w=n(),_=n(),k=n(),B=n(),d=n(""),S=n(),E=n(""),a=$({pid:"",name:""}),P=n(!1),Z=(t,e)=>(H(()=>{P.value=S.value.isEmpty}),t?e.name.includes(t):!0);Re(E,t=>{se.value=!t,S.value.filter(t),H(()=>{document.querySelectorAll(".node-text").forEach(e=>{const i=e.getAttribute("title");e.innerHTML=i.replace(t,`<span class="highLight">${t}</span>`)})})});const ee=F(()=>w.value==="folder"&&_.value?!1:!["rename","move"].includes(d.value)&&!!_.value),te=F(()=>w.value==="folder"?o("deDataset.folder_name"):o("data_source.data_source_name")),ae=F(()=>{let t="";switch(w.value){case"folder":t=o("deDataset.new_folder");break;case"datasource":t=o("deDataset.create")+o("auth.datasource");break}switch(d.value){case"move":t=o("chart.move_to");break;case"rename":t=o("chart.rename");break}return t}),oe=F(()=>d.value!=="move"),V=n(""),A=n(),G=n(!1),se=n(!0),C=n(),v=n(!1),g=n(!1),le=(t,e)=>{if(!e)return!1;e.name.includes(t)},L=()=>{g.value=!1},M=qe([]),re=t=>{p.tData=ze(M.value,t)},U=t=>{t.forEach(e=>{var i;e.value=e.id,(i=e.children)!=null&&i.length&&U(e.children)})};let c=null,j="";const ne=["time_asc","time_desc","name_asc","name_desc"],ie=(t,e,i,h)=>{_.value="",k.value="",d.value="",a.pid="",a.name="",w.value=t,E.value="",V.value=o(t==="folder"?"data_source.a_folder_name":"data_source.data_source_name_de"),j=e.type,t==="datasource"&&(c=e.request),e.id&&(i!=="rename"&&Le({leaf:!1,id:e.id,weight:7}).then(m=>{ke(m,"datasource"),U(m),p.tData=m||[],p.tData.length&&p.tData[0].name==="root"&&p.tData[0].id==="0"&&(p.tData[0].name=o("data_source.data_source")),M.value=Oe(f(p.tData));let u=ne[Number(b.get("TreeSort-backend"))??1];u=b.get("TreeSort-datasource")??u,re(u)}),i?(_.value=e.pid,k.value=e.id,a.pid=e.pid,a.name=e.name,B.value=e.name):(a.pid=e.id,_.value=e.id)),d.value=e.id?i:"",h&&(a.name=h),g.value=!0,A.value={name:[{required:!0,message:V.value,trigger:"change"},{required:!0,message:V.value,trigger:"blur"},{min:1,max:64,message:o("datasource.input_limit_1_64",[1,64]),trigger:"blur"}],pid:[{required:!0,message:o("common.please_select"),trigger:"blur"}]},setTimeout(()=>{C.value.clearValidate()},50)},ue=t=>{_.value=t.pid,k.value=t.id},z={label:"name",children:"children",isLeaf:t=>{var e;return!((e=t.children)!=null&&e.length)}},K=t=>{G.value=!1,a.pid=t.id},T=()=>{b.set("ds-new-success",!0),C.value.resetFields(),c=null,a.pid="",a.name="",g.value=!1},de=()=>{v.value=!1},ce=t=>t!==0&&!t?(R.error(o("data_source.the_destination_folder")),!1):!0,me=()=>{C.value.validate(t=>{if(t){const e={nodeType:w.value,name:a.name.trim()};switch(d.value){case"move":e.pid=G.value?"0":a.pid,e.id=k.value,e.action="move";break;case"rename":e.pid=_.value,e.id=k.value,e.action="rename";break;default:e.pid=a.pid||_.value||"0",e.action="create";break}if(d.value==="rename"&&B.value===e.name){T();return}if(d.value==="move"&&!ce(e.pid)||v.value)return;if(v.value=!0,c){let i={confirmButtonType:"danger",type:"warning",autofocus:!1,showClose:!1,tip:""};c.apiConfiguration="",Me(c).then(h=>{let m=c.id===""?Ue:je;!c.type.startsWith("API")&&c.type!=="ExcelRemote"&&(c.syncSetting=null),h?De.confirm(o("datasource.has_same_ds"),i).then(()=>{m({...c,name:a.name,pid:e.pid}).then(u=>{u!==void 0&&(b.set("ds-new-success",!0),I("handleShowFinishPage",{...u,pid:e.pid}),R.success(o("data_source.source_saved_successfully")),T())}).finally(()=>{v.value=!1})}).catch(()=>{v.value=!1,g.value=!1}):m({...c,name:a.name,pid:e.pid}).then(u=>{u!==void 0&&(b.set("ds-new-success",!0),I("handleShowFinishPage",{...u,pid:e.pid}),R.success(o("data_source.source_saved_successfully")),T())}).finally(()=>{v.value=!1})});return}I("finish",e,T,de,d.value,j)}})};Q({createInit:ie,editeInit:ue});const I=Y;return(t,e)=>{const i=xe,h=Ne,m=Ee,u=Ve,pe=Fe,fe=Te,_e=Se,O=Ce,ve=be,he=ye;return Be((D(),q(ve,{title:ae.value,modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=r=>g.value=r),width:d.value==="move"?"600px":"420px",class:"create-dialog","before-close":L},{footer:s(()=>[l(O,{secondary:"",onClick:L},{default:s(()=>[W(x(f(o)("dataset.cancel")),1)]),_:1}),l(O,{type:"primary",onClick:me},{default:s(()=>[W(x(f(o)("dataset.confirm")),1)]),_:1})]),default:s(()=>[l(_e,{"label-position":"top","require-asterisk-position":"right",ref_key:"datasource",ref:C,onKeydown:e[4]||(e[4]=Pe(Ae(()=>{},["stop","prevent"]),["enter"])),model:a,rules:A.value},{default:s(()=>[oe.value?(D(),q(h,{key:0,label:te.value,prop:"name"},{default:s(()=>[l(i,{placeholder:V.value,modelValue:a.name,"onUpdate:modelValue":e[0]||(e[0]=r=>a.name=r)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])):N("",!0),ee.value?(D(),q(h,{key:1,label:f(o)("deDataset.folder"),prop:"pid"},{default:s(()=>[l(pe,{modelValue:a.pid,"onUpdate:modelValue":e[1]||(e[1]=r=>a.pid=r),data:p.tData,"popper-class":"dataset-tree-select",style:{width:"100%"},"render-after-expand":!1,props:z,onNodeClick:K,"filter-method":le,filterable:""},{default:s(({data:{name:r}})=>[l(u,null,{default:s(()=>[l(m,{name:"dv-folder"},{default:s(()=>[l(f(J),{class:"svg-icon"})]),_:1})]),_:1}),y("span",{title:r},x(r),9,He)]),_:1},8,["modelValue","data"])]),_:1},8,["label"])):N("",!0),d.value==="move"?(D(),X("div",We,[l(i,{style:{"margin-bottom":"12px"},modelValue:E.value,"onUpdate:modelValue":e[2]||(e[2]=r=>E.value=r),clearable:""},{prefix:s(()=>[l(u,null,{default:s(()=>[l(m,{name:"icon_search-outline_outlined"},{default:s(()=>[l(f(Ge),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue"]),y("div",Xe,[l(fe,{ref_key:"treeRef",ref:S,"filter-node-method":Z,filterable:"",modelValue:a.pid,"onUpdate:modelValue":e[3]||(e[3]=r=>a.pid=r),menu:"","empty-text":"",data:p.tData,props:z,onNodeClick:K},{default:s(({data:r})=>[y("span",Je,[l(u,{style:{"font-size":"18px"}},{default:s(()=>[l(m,{name:"dv-folder"},{default:s(()=>[l(f(J),{class:"svg-icon"})]),_:1})]),_:1}),y("span",{class:"node-text",title:r.name},x(r.name),9,Qe)])]),_:1},8,["modelValue","data"]),P.value?(D(),X("div",Ye,[y("img",{src:f(Ke)},null,8,Ze),y("span",null,x(f(o)("data_source.relevant_content_found")),1)])):N("",!0)])])):N("",!0)]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","width"])),[[he,v.value]])}}});const qt=$e(et,[["__scopeId","data-v-64dee4c4"]]);export{qt as default};

import{q as ye,E as R,r as be,w as we,e as ke,s as De,t as xe,x as Ce,i as Ve,M as Te,v as Ee}from"./element-plus-secondary-0.0.0-dataease.js";import{f as Fe,e as Se}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as Ne,l as O,r as i,w as Ie,n as X,k as S,x as qe,$ as Re,o as D,T as B,U as s,W as l,_ as Y,Y as x,u as f,a9 as Be,X as Pe,R as N,a as y,c as j}from"./@vue-0.0.0-dataease.js";import{d as J}from"./dv-folder-0.0.0-dataease.js";import{i as Me}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{l as Ue,a as Ae,b as Le,u as Ge}from"./datasource-0.0.0-dataease.js";import{t as $e}from"./treeSortUtils-0.0.0-dataease.js";import{n as Ke}from"./nothing-tree-0.0.0-dataease.js";import{a as We,C as ze,g as C}from"./index-0.0.0-dataease.js";import{h as He}from"./lodash-es-0.0.0-dataease.js";import{_ as Oe}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./pinia-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./fast-png-0.0.0-dataease.js";import"./iobuffer-0.0.0-dataease.js";import"./pako-0.0.0-dataease.js";import"./vue-router_2-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";const Xe=["title"],Ye={key:2},je={class:"tree-content"},Je={class:"custom-tree-node"},Qe=["title"],Ze={key:0,class:"empty-search"},et=["src"],tt=Ne({__name:"CreatDsGroup",emits:["finish","handleShowFinishPage"],setup(at,{expose:Q,emit:Z}){const{t:o}=Fe(),{wsCache:b}=We(),p=O({tData:[]}),w=i(),_=i(),k=i(),P=i(),d=i(""),I=i(),V=i(""),a=O({pid:"",name:""}),M=i(!1),ee=(t,e)=>(X(()=>{M.value=I.value.isEmpty}),t?e.name.includes(t):!0);Ie(V,t=>{le.value=!t,I.value.filter(t),X(()=>{document.querySelectorAll(".node-text").forEach(e=>{const n=e.getAttribute("title");e.innerHTML=n.replace(t,`<span class="highLight">${t}</span>`)})})});const te=S(()=>w.value==="folder"&&_.value?!1:!["rename","move"].includes(d.value)&&!!_.value),ae=S(()=>w.value==="folder"?o("deDataset.folder_name"):o("data_source.data_source_name")),oe=S(()=>{let t="";switch(w.value){case"folder":t=o("deDataset.new_folder");break;case"datasource":t=o("deDataset.create")+o("auth.datasource");break}switch(d.value){case"move":t=o("chart.move_to");break;case"rename":t=o("chart.rename");break}return t}),se=S(()=>d.value!=="move"),T=i(""),U=i(),A=i(!1),le=i(!0),E=i(),v=i(!1),g=i(!1),re=(t,e)=>{if(!e)return!1;e.name.includes(t)},L=()=>{g.value=!1},G=qe([]),ie=t=>{p.tData=$e(G.value,t)},$=t=>{t.forEach(e=>{var n;e.value=e.id,(n=e.children)!=null&&n.length&&$(e.children)})};let c=null,K="";const ne=["time_asc","time_desc","name_asc","name_desc"],ue=(t,e,n,h)=>{_.value="",k.value="",d.value="",a.pid="",a.name="",w.value=t,V.value="",T.value=o(t==="folder"?"data_source.a_folder_name":"data_source.data_source_name_de"),K=e.type,t==="datasource"&&(c=e.request),e.id&&(n!=="rename"&&Ue({leaf:!1,id:e.id,weight:7}).then(m=>{ze(m,"datasource"),$(m),p.tData=m||[],p.tData.length&&p.tData[0].name==="root"&&p.tData[0].id==="0"&&(p.tData[0].name=o("data_source.data_source")),G.value=He(f(p.tData));let u=ne[Number(b.get(C("TreeSort-backend")))??1];u=b.get(C("TreeSort-datasource"))??u,ie(u)}),n?(_.value=e.pid,k.value=e.id,a.pid=e.pid,a.name=e.name,P.value=e.name):(a.pid=e.id,_.value=e.id)),d.value=e.id?n:"",h&&(a.name=h),g.value=!0,U.value={name:[{required:!0,message:T.value,trigger:"change"},{required:!0,message:T.value,trigger:"blur"},{min:1,max:64,message:o("datasource.input_limit_1_64",[1,64]),trigger:"blur"}],pid:[{required:!0,message:o("common.please_select"),trigger:"blur"}]},setTimeout(()=>{E.value.clearValidate()},50)},de=t=>{_.value=t.pid,k.value=t.id},W={label:"name",children:"children",isLeaf:t=>{var e;return!((e=t.children)!=null&&e.length)}},z=t=>{A.value=!1,a.pid=t.id},F=()=>{b.set(C("ds-new-success"),!0),E.value.resetFields(),c=null,a.pid="",a.name="",g.value=!1},ce=()=>{v.value=!1},me=t=>t!==0&&!t?(R.error(o("data_source.the_destination_folder")),!1):!0,pe=()=>{E.value.validate(t=>{if(t){const e={nodeType:w.value,name:a.name.trim()};switch(d.value){case"move":e.pid=A.value?"0":a.pid,e.id=k.value,e.action="move";break;case"rename":e.pid=_.value,e.id=k.value,e.action="rename";break;default:e.pid=a.pid||_.value||"0",e.action="create";break}if(d.value==="rename"&&P.value===e.name){F();return}if(d.value==="move"&&!me(e.pid)||v.value)return;if(v.value=!0,c){let n={confirmButtonType:"danger",type:"warning",autofocus:!1,showClose:!1,tip:""};c.apiConfiguration="",Ae(c).then(h=>{let m=c.id===""?Le:Ge;!c.type.startsWith("API")&&c.type!=="ExcelRemote"&&(c.syncSetting=null),h?ye.confirm(o("datasource.has_same_ds"),n).then(()=>{m({...c,name:a.name,pid:e.pid}).then(u=>{u!==void 0&&(b.set(C("ds-new-success"),!0),q("handleShowFinishPage",{...u,pid:e.pid}),R.success(o("data_source.source_saved_successfully")),F())}).finally(()=>{v.value=!1})}).catch(()=>{v.value=!1,g.value=!1}):m({...c,name:a.name,pid:e.pid}).then(u=>{u!==void 0&&(b.set(C("ds-new-success"),!0),q("handleShowFinishPage",{...u,pid:e.pid}),R.success(o("data_source.source_saved_successfully")),F())}).finally(()=>{v.value=!1})});return}q("finish",e,F,ce,d.value,K)}})};Q({createInit:ue,editeInit:de});const q=Z;return(t,e)=>{const n=be,h=we,m=Se,u=ke,fe=De,_e=xe,ve=Ce,H=Ve,he=Te,ge=Ee;return Re((D(),B(he,{title:oe.value,modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=r=>g.value=r),width:d.value==="move"?"600px":"420px",class:"create-dialog","before-close":L},{footer:s(()=>[l(H,{secondary:"",onClick:L},{default:s(()=>[Y(x(f(o)("dataset.cancel")),1)]),_:1}),l(H,{type:"primary",onClick:pe},{default:s(()=>[Y(x(f(o)("dataset.confirm")),1)]),_:1})]),default:s(()=>[l(ve,{"label-position":"top","require-asterisk-position":"right",ref_key:"datasource",ref:E,onKeydown:e[4]||(e[4]=Be(Pe(()=>{},["stop","prevent"]),["enter"])),model:a,rules:U.value},{default:s(()=>[se.value?(D(),B(h,{key:0,label:ae.value,prop:"name"},{default:s(()=>[l(n,{placeholder:T.value,modelValue:a.name,"onUpdate:modelValue":e[0]||(e[0]=r=>a.name=r)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])):N("",!0),te.value?(D(),B(h,{key:1,label:f(o)("deDataset.folder"),prop:"pid"},{default:s(()=>[l(fe,{modelValue:a.pid,"onUpdate:modelValue":e[1]||(e[1]=r=>a.pid=r),data:p.tData,"popper-class":"dataset-tree-select",style:{width:"100%"},"render-after-expand":!1,props:W,onNodeClick:z,"filter-method":re,filterable:""},{default:s(({data:{name:r}})=>[l(u,null,{default:s(()=>[l(m,{name:"dv-folder"},{default:s(()=>[l(f(J),{class:"svg-icon"})]),_:1})]),_:1}),y("span",{title:r},x(r),9,Xe)]),_:1},8,["modelValue","data"])]),_:1},8,["label"])):N("",!0),d.value==="move"?(D(),j("div",Ye,[l(n,{style:{"margin-bottom":"12px"},modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=r=>V.value=r),clearable:""},{prefix:s(()=>[l(u,null,{default:s(()=>[l(m,{name:"icon_search-outline_outlined"},{default:s(()=>[l(f(Me),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue"]),y("div",je,[l(_e,{ref_key:"treeRef",ref:I,"filter-node-method":ee,filterable:"",modelValue:a.pid,"onUpdate:modelValue":e[3]||(e[3]=r=>a.pid=r),menu:"","empty-text":"",data:p.tData,props:W,onNodeClick:z},{default:s(({data:r})=>[y("span",Je,[l(u,{style:{"font-size":"18px"}},{default:s(()=>[l(m,{name:"dv-folder"},{default:s(()=>[l(f(J),{class:"svg-icon"})]),_:1})]),_:1}),y("span",{class:"node-text",title:r.name},x(r.name),9,Qe)])]),_:1},8,["modelValue","data"]),M.value?(D(),j("div",Ze,[y("img",{src:f(Ke)},null,8,et),y("span",null,x(f(o)("data_source.relevant_content_found")),1)])):N("",!0)])])):N("",!0)]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","width"])),[[ge,v.value]])}}});const da=Oe(tt,[["__scopeId","data-v-f4ad73ce"]]);export{da as default};

import{_ as I}from"./InfoTemplate.vue_vue_type_style_index_0_scope_true_lang-0.0.0-dataease.js";import J from"./BasicEdit-0.0.0-dataease.js";import{o as K,x as O}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{i as Q}from"./ModelUtil-0.0.0-dataease.js";import{e as g}from"./lodash-0.0.0-dataease.js";import{d as Y,r as c,X as Z,y as R,f as B,O as ee,j as P,u as d,g as T,_ as j,W as te,n as ae}from"./vue-0.0.0-dataease.js";import{_ as se}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./index-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import"./dv-info-0.0.0-dataease.js";import"./de-copy-0.0.0-dataease.js";import"./index-0.0.0-dataease19.js";import"./index-0.0.0-dataease4.js";import"./index-0.0.0-dataease3.js";import"./el-drawer-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import"./el-form-item-0.0.0-dataease.js";import"./el-radio-group-0.0.0-dataease.js";import"./el-radio-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import"./index-0.0.0-dataease6.js";import"./token-0.0.0-dataease.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease5.js";import"./el-tree-0.0.0-dataease.js";import"./index-0.0.0-dataease15.js";import"./el-checkbox-0.0.0-dataease.js";import"./el-tree-select-0.0.0-dataease.js";import"./el-input-number-0.0.0-dataease.js";import"./el-switch-0.0.0-dataease.js";import"./index-0.0.0-dataease20.js";import"./index-0.0.0-dataease18.js";import"./index-0.0.0-dataease27.js";import"./axios-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";const le=Y({__name:"BasicInfo",setup(ie){const{t:a}=K(),v=c(),f=c(),_=c(),b=c(),y=c(!1),U=Q(),V=[{value:"0",label:a("commons.date.permanent")},{value:"1",label:a("commons.date.one_year")},{value:"2",label:a("commons.date.six_months")},{value:"3",label:a("commons.date.three_months")},{value:"4",label:a("commons.date.one_month")}],k=[{key:"setting_basic.defaultOpen",val:a("setting_basic.default_open_tips")},{key:"setting_basic.frontTimeOut",val:a("system.to_take_effect")},{key:"setting_basic.platformOid",val:a("system.and_platform_docking")},{key:"setting_basic.platformRid",val:a("system.and_platform_docking")},{key:"setting_basic.shareDisable",val:a("setting_basic.share_disable_tips")}],C=["setting_basic.dip","setting_basic.pvp","setting_basic.defaultLogin","setting_basic.loginLimit","setting_basic.loginLimitRate","setting_basic.loginLimitTime"],E=["setting_basic.autoCreateUser","setting_basic.platformOid","setting_basic.platformRid"],s=Z({templateList:[],orgOptions:[],roleOptions:[{value:"admin",label:a("role.org_admin"),children:null,disabled:!1},{value:"readonly",label:a("role.average_role"),children:null,disabled:!1}],loginOptions:[{value:"0",label:a("system.normal_login")},{value:"1",label:"LDAP"},{value:"2",label:"OIDC"},{value:"3",label:"CAS"},{value:"9",label:"OAuth2"}],sortOptions:[{value:"0",label:a("resource_sort.time_asc")},{value:"1",label:a("resource_sort.time_desc")},{value:"2",label:a("resource_sort.name_asc")},{value:"3",label:a("resource_sort.name_desc")}],openOptions:[{value:"0",label:a("open_opt.new_page")},{value:"1",label:a("open_opt.local_page")}]});let m=[];const L=c(""),q=c(""),w=c([]),h=c([]),$=c("0"),A=R(()=>s.templateList.filter(l=>!C.concat(E).includes(l.pkey)&&(!U||l.pkey!=="setting_basic.defaultOpen"))),S=R(()=>s.templateList.filter(l=>E.includes(l.pkey))),x=R(()=>s.templateList.filter(t=>C.includes(t.pkey))),W=l=>{const t="/sysParameter/basic/query";m=[],s.templateList=[];const o=[];O.get({url:t}).then(async n=>{m=g(n.data);const r=n.data;for(let p=0;p<r.length;p++){const e=r[p];if(e.pkey==="basic.autoCreateUser"||e.pkey==="basic.dip"||e.pkey==="basic.pwdStrategy"||e.pkey==="basic.shareDisable"||e.pkey==="basic.sharePeRequire"||e.pkey==="basic.loginLimit")e.pval=e.pval==="true"?a("chart.open"):a("system.not_enabled");else if(e.pkey==="basic.platformOid")L.value=e.pval,await z(),e.pval=q.value||a("system.default_organization");else if(e.pkey==="basic.platformRid"){const i=e.pval;if(i!=null&&i.length){const u=i.split(",");w.value=u,await F(),h.value.length?e.pval=h.value.join(","):e.pval=a("system.normal_role")}else w.value=[],e.pval=a("system.normal_role")}else if(e.pkey==="basic.pvp")$.value=e.pval||"0",e.pval=V.filter(i=>i.value===$.value)[0].label;else if(e.pkey==="basic.defaultLogin"){if(await G(),y.value)if(e.pval){const i=s.loginOptions.filter(u=>u.value===e.pval);i!=null&&i.length?e.pval=i[0].label:(e.pval=s.loginOptions[0].label,H())}else e.pval=s.loginOptions[0].label}else if(e.pkey==="basic.defaultSort")if(e.pval){const i=s.sortOptions.filter(u=>u.value===e.pval);i!=null&&i.length?e.pval=i[0].label:e.pval=s.sortOptions[1].label}else e.pval=s.sortOptions[1].label;else if(e.pkey==="basic.defaultOpen")if(e.pval){const i=s.openOptions.filter(u=>u.value===e.pval);i!=null&&i.length?e.pval=i[0].label:e.pval=s.openOptions[0].label}else e.pval=s.openOptions[0].label;else e.pval=e.pval;e.pkey="setting_"+e.pkey,(!e.pkey.includes("defaultLogin")||y.value)&&o.push(e)}s.templateList.splice(0,o.length,...o),l&&l()})},N=()=>{W(()=>{ae(()=>{var l,t,o;(l=f==null?void 0:f.value)==null||l.init(),(t=_==null?void 0:_.value)==null||t.init(),(o=b==null?void 0:b.value)==null||o.init()})})};N();const D=(l,t)=>{v==null||v.value.edit(g(m),g(s.orgOptions),g(s.roleOptions),g(s.loginOptions),g(s.sortOptions),g(s.openOptions),l,t)},z=async()=>{const t=(await O.post({url:"/org/mounted",data:{}})).data;M(t),s.orgOptions=t},F=async()=>{const t=(await O.get({url:`/role/queryWithOid/${L.value}`})).data,o=X(t);s.roleOptions[0].children=o.get(!1),s.roleOptions[1].children=o.get(!0)},M=l=>{var o;const t=[...l];for(;t.length;){const n=t.pop();n.id===L.value&&(q.value=n.name),n.value=n.id,n.label=n.name,n.disabled=n.readOnly,(o=n.children)!=null&&o.length&&n.children.forEach(r=>t.push(r))}},X=l=>{const t=new Map;return h.value=[],l.forEach(o=>{w.value.includes(o.id)&&h.value.push(o.name);const n=o.readonly;let r=t.get(n);r||(r=[]),r.push({value:o.id,label:o.name,disabled:!1}),t.set(n,r)}),t},G=async()=>{const l="/setting/authentication/status",n=(await O.get({url:l})).data.reduce((p,{name:e,enable:i})=>(p[e]=i,p),{});let r=s.loginOptions.length;for(;r--;){const p=s.loginOptions[r];p.value!=="0"&&!n[p.label.toLocaleLowerCase()]&&s.loginOptions.splice(r,1)}if(y.value=s.loginOptions.length>1,!y.value){let p=m.length;for(;p--;)m[p].pkey==="basic.defaultLogin"&&m.splice(p,1)}},H=()=>{let l=m.length;for(;l--;){const t=m[l];t.pkey==="basic.defaultLogin"&&(t.pval="0")}};return(l,t)=>{var o,n;return B(),ee(te,null,[P(I,{ref_key:"infoTemplate",ref:f,"label-tooltips":k,"setting-key":"basic","setting-title":d(a)("system.basic_settings"),"setting-data":A.value,onEdit:t[0]||(t[0]=r=>D(d(a)("system.basic_settings"),A.value.map(p=>p.pkey.split(".")[1])))},null,8,["setting-title","setting-data"]),(o=x.value)!=null&&o.length?(B(),T(I,{key:0,ref_key:"loginTemplate",ref:_,class:"login-setting-template","label-tooltips":k,"setting-key":"basic","setting-title":d(a)("system.login_settings"),"setting-data":x.value,onEdit:t[1]||(t[1]=r=>D(d(a)("system.login_settings"),x.value.map(p=>p.pkey.split(".")[1])))},null,8,["setting-title","setting-data"])):j("",!0),(n=S.value)!=null&&n.length?(B(),T(I,{key:1,ref_key:"thirdTemplate",ref:b,class:"login-setting-template","label-tooltips":k,"setting-key":"basic","setting-title":d(a)("setting_basic.third_platform_settings"),"setting-data":S.value,onEdit:t[2]||(t[2]=r=>D(d(a)("setting_basic.third_platform_settings"),S.value.map(p=>p.pkey.split(".")[1])))},null,8,["setting-title","setting-data"])):j("",!0),P(J,{ref_key:"editor",ref:v,"label-tooltips":k,onSaved:N},null,512)],64)}}});const Xe=se(le,[["__scopeId","data-v-cc377fd8"]]);export{Xe as default};

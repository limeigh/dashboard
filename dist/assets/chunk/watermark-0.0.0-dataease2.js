import{af as y,r as d}from"./vue-0.0.0-dataease.js";import{d as u}from"./dvMain-0.0.0-dataease.js";import{ipInfoApi as g}from"./user-0.0.0-dataease.js";import{ax as v}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";const x=u(),{dvInfo:c}=y(x),k=d(null);function M(t,o){const n=document.getElementById(o),e={watermark_txt:"",watermark_x:20,watermark_y:20,watermark_rows:60,watermark_cols:60,watermark_x_space:100,watermark_y_space:50,watermark_color:"#aaa",watermark_alpha:.4,watermark_fontsize:"15px",watermark_font:"微软雅黑",watermark_width:210,watermark_height:80,watermark_angle:20};if(t&&typeof t=="object"){const w=t||{};for(const m in w)w[m]&&e[m]&&w[m]===e[m]||w[m]&&(e[m]=w[m])}const i=document.createElement("p");let l=n.clientWidth;const r=l*.015;l=l-r;let s=n.scrollHeight-56;s=s<220?220:s,(e.watermark_cols===0||Math.floor(e.watermark_x+e.watermark_width*e.watermark_cols+e.watermark_x_space*(e.watermark_cols-1))>l)&&(e.watermark_cols=Math.floor((l-e.watermark_x+e.watermark_x_space)/(e.watermark_width+e.watermark_x_space)),e.watermark_x_space=Math.floor((l-e.watermark_x-e.watermark_width*e.watermark_cols)/(e.watermark_cols-1))),(e.watermark_rows===0||Math.floor(e.watermark_y+e.watermark_height*e.watermark_rows+e.watermark_y_space*(e.watermark_rows-1))>s)&&(e.watermark_rows=Math.floor((e.watermark_y_space+s-e.watermark_y)/(e.watermark_height+e.watermark_y_space)),e.watermark_y_space=Math.floor((s-e.watermark_y-e.watermark_height*e.watermark_rows)/(e.watermark_rows-1))),e.watermark_rows=e.watermark_rows<2?2:e.watermark_rows,e.watermark_cols=e.watermark_cols<2?2:e.watermark_cols;let _,p;for(let w=0;w<e.watermark_rows;w++){p=e.watermark_y+(e.watermark_y_space+e.watermark_height)*w;for(let m=0;m<e.watermark_cols;m++){_=e.watermark_x+(e.watermark_width+e.watermark_x_space)*m;const a=document.createElement("div");a.id="mask_div"+w+m,a.className="mask_div",a.appendChild(document.createTextNode(e.watermark_txt)),a.style.webkitTransform="rotate(-"+e.watermark_angle+"deg)",a.style.MozTransform="rotate(-"+e.watermark_angle+"deg)",a.style.msTransform="rotate(-"+e.watermark_angle+"deg)",a.style.OTransform="rotate(-"+e.watermark_angle+"deg)",a.style.transform="rotate(-"+e.watermark_angle+"deg)",a.style.visibility="",a.style.position="absolute",a.style.left=_+"px",a.style.top=p+"px",a.style.overflow="hidden",a.style.zIndex="10",a.style.pointerEvents="none",a.style.opacity=e.watermark_alpha,a.style.fontSize=e.watermark_fontsize,a.style.fontFamily=e.watermark_font,a.style.color=e.watermark_color,a.style.textAlign="center",a.style.width=e.watermark_width+"px",a.style.height=e.watermark_height+"px",a.style.display="block",i.appendChild(a)}}i.setAttribute("id",o+"-de-watermark-server"),n.appendChild(i)}function f(){const t=new Date,o=t.getFullYear(),n=r(t.getMonth()+1),e=r(t.getDate()),i=r(t.getHours()),l=r(t.getMinutes());function r(_){return _<10?"0"+_:_}return o+"-"+n+"-"+e+" "+i+":"+l}function S(t,o,n=1){c.value.watermarkInfo&&(k.value&&k.value.model!=="lose"?h(c.value.watermarkInfo.settingContent,k.value,t,o,c.value.selfWatermarkStatus,n):g().then(e=>{k.value=e.data,k.value&&k.value.model!=="lose"&&h(c.value.watermarkInfo.settingContent,k.value,t,o,c.value.selfWatermarkStatus,n)}))}function b(t){const o=document.getElementById(t+"-de-watermark-server");o&&o.remove()}function h(t,o,n,e,i,l=1){if(b(n),!(e==="canvas-main"&&(t.enable&&!t.enablePanelCustom||t.enable&&i)))return;let r,s=120;t.type==="custom"?(r=t.content,r=r.replaceAll("${ip}",o.ip),r=r.replaceAll("${username}",o.account),r=r.replaceAll("${nickName}",o.name),r=r.replaceAll("${time}",f()),s=r.length*t.watermark_fontsize*.75,s=s>350?350:s):t.type==="nickName"?r=o.name:t.type==="ip"?(r=o.ip,s=150):t.type==="time"?(r=f(),s=200):r=o.account;const _={watermark_txt:r,watermark_width:s*l,watermark_color:t.watermark_color,watermark_x_space:t.watermark_x_space*l,watermark_y_space:t.watermark_y_space*l,watermark_fontsize:t.watermark_fontsize*l*(v()?2.5:1)+"px"};M(_,n)}export{S as a,f as g,b as r,M as w};

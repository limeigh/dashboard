import{z as $}from"./index-0.0.0-dataease.js";import{E as q}from"./el-dialog-0.0.0-dataease.js";import{o as M,D as v,y as P,G as j}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{E as A}from"./el-row-0.0.0-dataease.js";import{E as G}from"./el-col-0.0.0-dataease.js";import"./el-radio-0.0.0-dataease.js";import{d as J,r as W,X,y as w,w as H,f as c,g as _,i as a,R as K,j as o,a3 as m,a4 as u,u as s,P as Q,_ as y,T as h,a8 as Y}from"./vue-0.0.0-dataease.js";import{i as Z}from"./template-0.0.0-dataease.js";import{i as ee}from"./imgUtils-0.0.0-dataease.js";import{h as te}from"./dataVisualization-0.0.0-dataease.js";import ae from"./DeTemplatePreviewList-0.0.0-dataease.js";import{E as oe}from"./index-0.0.0-dataease27.js";import{_ as ne}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./index-0.0.0-dataease3.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./constants-0.0.0-dataease.js";import"./dvMain-0.0.0-dataease.js";import"./chart-0.0.0-dataease.js";import"./chart-0.0.0-dataease2.js";import"./dataset-0.0.0-dataease.js";import"./app-0.0.0-dataease.js";import"./decimal-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./index-0.0.0-dataease21.js";import"./antv-0.0.0-dataease.js";import"./index-0.0.0-dataease22.js";import"./pureFunctionsAny.generated-0.0.0-dataease.js";import"./extends-0.0.0-dataease.js";import"./tslib.es6-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./_commonjs-dynamic-modules-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./el-tree-0.0.0-dataease.js";import"./token-0.0.0-dataease.js";import"./index-0.0.0-dataease15.js";import"./el-checkbox-0.0.0-dataease.js";import"./dv-folder-0.0.0-dataease.js";import"./dv-dashboard-spine-0.0.0-dataease.js";import"./icon_operation-analysis_outlined-0.0.0-dataease.js";const le=J({__name:"DeResourceCreateOpt",props:{curCanvasType:{type:String,required:!0}},emits:["finish"],setup(S,{expose:D,emit:V}){const{t:l}=M(),I=V,g=W(null),k=S,e=X({dialogShow:!1,loading:!1,inputType:"new_outer_template",fieldName:"name",tableRadio:null,keyWordSearch:"",columnLabel:l("visualization.belong_to_category"),templateList:[],importTemplateInfo:{snapshot:""},dvCreateInfo:{pid:-1,name:null,canvasStyleData:null,componentData:null,templateId:null,dynamicData:null,staticResource:null},templateSelected:!1}),b=w(()=>e.dvCreateInfo.name&&e.templateSelected),C=w(()=>e.importTemplateInfo.snapshot?{background:`url(${ee(e.importTemplateInfo.snapshot)}) no-repeat`}:{});H(()=>e.inputType,()=>{T()});const T=()=>{e.templateSelected=!1,e.dvCreateInfo.name=null,e.dvCreateInfo.canvasStyleData=null,e.dvCreateInfo.componentData=null,e.importTemplateInfo.snapshot=null,e.dvCreateInfo.templateId=null},z=n=>{e.dvCreateInfo.templateId=n.id,n.nodeType==="folder"?(e.dvCreateInfo.name=null,e.importTemplateInfo.snapshot=null,e.templateSelected=!1):(e.dvCreateInfo.name=n.name,e.importTemplateInfo.snapshot=n.snapshot,e.templateSelected=!0)},E=()=>{const n={level:"0",leafDvType:k.curCanvasType,withChildren:!0};e.loading=!0,Z(n).then(t=>{e.templateList=t.data,e.loading=!1})},R=()=>{I("finish")},x=()=>{if(!e.dvCreateInfo.name)return v.warning(l("common.save_success")),!1;if(e.dvCreateInfo.name.length>50)return v.warning(l("common.char_can_not_more_50")),!1;if(!e.dvCreateInfo.templateId&&e.inputType==="new_inner_template")return v.warning("chart.template_can_not_empty"),!1;e.dvCreateInfo.newFrom=e.inputType,e.loading=!0,te(e.dvCreateInfo).then(n=>{e.loading=!1,I("finish",n.data)}).catch(()=>{e.loading=!1})},L=n=>{const t=n.target.files[0],d=new FileReader;d.onload=i=>{e.templateSelected=!0;const f=i.target.result;e.importTemplateInfo=JSON.parse(f),e.dvCreateInfo.name=e.importTemplateInfo.name.name,e.dvCreateInfo.canvasStyleData=e.importTemplateInfo.canvasStyleData,e.dvCreateInfo.componentData=e.importTemplateInfo.componentData,e.dvCreateInfo.dynamicData=e.importTemplateInfo.dynamicData,e.dvCreateInfo.staticResource=e.importTemplateInfo.staticResource},d.readAsText(t)},N=()=>{g.value.click()},B=()=>{e.dialogShow=!1};return D({optInit:()=>{e.dialogShow=!0,T()}}),(n,t)=>{const d=oe,i=G,f=P,p=A,U=j,F=q,O=$;return c(),_(F,{class:"create-dialog",title:s(l)("visualization.new_from_template"),modelValue:e.dialogShow,"onUpdate:modelValue":t[5]||(t[5]=r=>e.dialogShow=r),width:"700","before-close":B,onSubmit:t[6]||(t[6]=Y(()=>{},["prevent"]))},{default:a(()=>[K((c(),_(p,{class:"create-main"},{default:a(()=>[o(p,null,{default:a(()=>[o(i,{span:18,style:{height:"40px"}},{default:a(()=>[o(d,{modelValue:e.inputType,"onUpdate:modelValue":t[0]||(t[0]=r=>e.inputType=r),label:"new_outer_template"},{default:a(()=>[m(u(s(l)("visualization.import_template")),1)]),_:1},8,["modelValue"]),o(d,{modelValue:e.inputType,"onUpdate:modelValue":t[1]||(t[1]=r=>e.inputType=r),label:"new_inner_template",onClick:E},{default:a(()=>[m(u(s(l)("visualization.copy_template")),1)]),_:1},8,["modelValue"])]),_:1}),e.inputType==="new_outer_template"?(c(),_(i,{key:0,span:6,class:"button-main"},{default:a(()=>[o(f,{class:"el-icon-upload",size:"small",type:"primary",onClick:N},{default:a(()=>[m(u(s(l)("visualization.upload_template")),1)]),_:1}),Q("input",{id:"input",ref_key:"files",ref:g,type:"file",accept:".DET2",hidden:"",onChange:L},null,544)]),_:1})):y("",!0)]),_:1}),o(p,{style:{"margin-top":"5px"}},{default:a(()=>[o(i,{span:4,class:"name-area"},{default:a(()=>[m(u(s(l)("visualization.name")),1)]),_:1}),o(i,{span:20},{default:a(()=>[o(U,{modelValue:e.dvCreateInfo.name,"onUpdate:modelValue":t[2]||(t[2]=r=>e.dvCreateInfo.name=r),clearable:"",size:"small"},null,8,["modelValue"])]),_:1})]),_:1}),e.inputType==="new_inner_template"?(c(),_(p,{key:0,class:"preview"},{default:a(()=>[o(i,{span:8,style:{height:"100%","overflow-y":"auto"}},{default:a(()=>[o(ae,{"template-list":e.templateList,onShowCurrentTemplateInfo:z},null,8,["template-list"])]),_:1}),o(i,{span:16,style:h(C.value),class:"preview-show"},null,8,["style"])]),_:1})):y("",!0),e.inputType==="new_outer_template"?(c(),_(p,{key:1,class:"preview",style:h(C.value)},null,8,["style"])):y("",!0),o(p,{class:"root-class"},{default:a(()=>[o(f,{size:"small",onClick:t[3]||(t[3]=r=>R())},{default:a(()=>[m(u(s(l)("commons.cancel")),1)]),_:1}),o(f,{type:"primary",size:"small",disabled:!b.value,onClick:t[4]||(t[4]=r=>x())},{default:a(()=>[m(u(s(l)("commons.confirm")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})),[[O,e.loading]])]),_:1},8,["title","modelValue"])}}});const tt=ne(le,[["__scopeId","data-v-afa0ea15"]]);export{tt as default};

import{E as fe,m as we,i as me,o as _e,v as he,e as ye}from"./element-plus-secondary-0.0.0-dataease.js";import{d as Se,k as d,r as l,l as ke,b as ge,a7 as Pe,ae as W,o,c as k,a as Ce,T as c,Z as T,u as n,R as r,W as p,U as f,$ as G,a0 as De,z as B,S as j,_ as Ie,Y as U,n as E}from"./@vue-0.0.0-dataease.js";import{i as Ae}from"./icon_add_outlined-0.0.0-dataease.js";import{D as xe}from"./DeResourceTree-0.0.0-dataease.js";import{d as Te}from"./dvMain-0.0.0-dataease.js";import H from"./DeResourceArrow-0.0.0-dataease.js";import{_ as Be}from"./PreviewHead.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import{E as K}from"./EmptyBackground-0.0.0-dataease.js";import{s as Ee}from"./pinia-0.0.0-dataease.js";import{useAppStoreWithOut as Ve}from"./app-0.0.0-dataease.js";import{S as be,i as Re,o as Ne}from"./canvasUtils-0.0.0-dataease.js";import{u as Me}from"./useMoveLine-0.0.0-dataease.js";import{a as Le,f as Oe,h as ze}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{a as qe,c as Fe}from"./imgUtils-0.0.0-dataease.js";import{M as $e}from"./MultiplexPreviewShow-0.0.0-dataease.js";import{g as We}from"./DePreview-0.0.0-dataease.js";import{A as Ge}from"./AppExportForm-0.0.0-dataease.js";import{u as je}from"./index-0.0.0-dataease.js";const Ue={class:"dv-preview"},He={key:1,class:"content multiplexing-content"},pa=Se({__name:"PreviewShow",props:{showPosition:{required:!1,type:String,default:"preview"},noClose:{required:!1,type:Boolean,default:!1},resourceTable:{required:!1,type:String,default:"core"}},setup(s,{expose:Y}){const Z=Le(),J=d(()=>Z.getName),{t:y}=ze(),g=Te(),{dvInfo:Q,canvasViewDataInfo:V}=Ee(g),P=l(null),b=l(null),S=l(!0),w=l(!0),m=l(!1),{width:C,node:X}=Me("DASHBOARD"),R=l(null),D=s,_=l(),ee=d(()=>{var e;return(e=_.value)==null?void 0:e.hasData}),N=d(()=>{var e;return(e=_.value)==null?void 0:e.mounted}),ae=d(()=>{var e;return(e=_.value)==null?void 0:e.rootManage}),I=Ve(),oe=d(()=>I.getIsDataEaseBi);function te(){var e;(e=_.value)==null||e.createNewObject()}const M=(e,i,t)=>{const q=D.showPosition==="multiplexing"?be:Re;w.value=!1,q(e,{busiFlag:"dataV",resourceTable:"core"},function({canvasDataResult:F,canvasStyleResult:$,dvInfo:u,canvasViewInfoPreview:A,curPreviewGap:x}){u.weight=i,u.ext=t||0,a.canvasDataPreview=F,a.canvasStylePreview=$,a.canvasViewInfoPreview=A,a.dvInfo=u,a.curPreviewGap=x,w.value=!0,D.showPosition==="preview"&&(g.updateCurDvInfo(u),E(()=>{var h;(h=b.value)==null||h.restore()})),E(()=>{Ne({resourceId:e})})})},L=e=>{m.value=!0,setTimeout(()=>{const i=P.value.querySelector(".canvas-container");qe(e,i,a.dvInfo.name,()=>{m.value=!1})},200)},O=(e,i)=>{m.value=!0,E(()=>{const t=P.value.querySelector(".canvas-container");Fe(e,t,a.dvInfo.name,i,()=>{m.value=!1})})},ne=e=>{e==="template"?O(e,null):e==="app"&&se()},se=()=>{const e=re();e&&e.length>0?fe.warning(`当前仪表板中[${e}]属于模版图表，无法导出，请先设置数据集！`):R.value.init({appName:a.dvInfo.name,icon:null,version:"2.0",creator:J.value,required:"2.9.0",description:null})},re=()=>{let e=",";return Object.keys(V.value).forEach(i=>{const t=V.value[i];t&&(t==null?void 0:t.dataFrom)==="template"&&(e=e+t.title+",")}),e.slice(1)},Ke=()=>{S.value=!S.value},ie=e=>{M(e,a.dvInfo.weight,a.dvInfo.ext)},le=e=>{M(e.id,e.weight,e.ext)},ce=d(()=>{var e;return((e=a.canvasStylePreview)==null?void 0:e.screenAdaptor)==="keep"}),a=ke({canvasDataPreview:null,canvasStylePreview:null,canvasViewInfoPreview:null,dvInfo:null,curPreviewGap:0}),v=l(!0),z=e=>{v.value=e},ve=()=>{I.setArrowSide(!0)},ue=()=>{I.setArrowSide(!1)},de=()=>a,pe=e=>{O("app",e)};return ge(()=>{je({name:"canvasDownload",callback:function(){L("img")}})}),Y({getPreviewStateInfo:de}),Pe(()=>{D.showPosition==="preview"&&g.canvasDataInit()}),(e,i)=>{var h;const t=we,q=W("ArrowLeft"),F=ye,$=W("ArrowRight"),u=me,A=_e,x=he;return o(),k(j,null,[Ce("div",Ue,[s.noClose?r("",!0):(o(),c(H,{key:0,style:T({left:(v.value?n(C)-12:0)+"px"}),onChangeSideTreeStatus:z,isInside:!v.value},null,8,["style","isInside"])),p(t,{class:B(["resource-area",{"close-side":!S.value,retract:!v.value}]),onMouseenter:ve,onMouseleave:ue,ref_key:"node",ref:X,style:T({width:n(C)+"px"})},{default:f(()=>[s.noClose?r("",!0):(o(),c(H,{key:0,isInside:!v.value,style:T({left:(v.value?n(C)-12:0)+"px"}),onChangeSideTreeStatus:z},null,8,["isInside","style"])),G(p(xe,{ref_key:"resourceTreeRef",ref:_,"cur-canvas-type":"dataV","show-position":s.showPosition,"resource-table":s.resourceTable,onNodeClick:le},null,8,["show-position","resource-table"]),[[De,S.value]])]),_:1},8,["class","style"]),G((o(),c(A,{class:B(["preview-area",{"no-data":!((h=a.dvInfo)!=null&&h.id)}])},{default:f(()=>[r("",!0),n(Q).name?(o(),k(j,{key:1},[s.showPosition==="preview"?(o(),c(Be,{key:0,onReload:ie,onDownload:L,onDownloadAsAppTemplate:ne})):r("",!0),s.showPosition==="multiplexing"&&w.value?(o(),k("div",He,[p($e,{"component-data":a.canvasDataPreview,"canvas-style-data":a.canvasStylePreview,"canvas-view-info":a.canvasViewInfoPreview,"dv-info":a.dvInfo},null,8,["component-data","canvas-style-data","canvas-view-info","dv-info"])])):r("",!0),s.showPosition==="preview"?(o(),k("div",{key:2,class:B([{"canvas_keep-size":ce.value},"content"]),ref_key:"previewCanvasContainer",ref:P},[a.canvasStylePreview&&w.value?(o(),c(We,{key:0,ref_key:"dvPreviewRef",ref:b,"show-position":s.showPosition,"canvas-data-preview":a.canvasDataPreview,"canvas-style-preview":a.canvasStylePreview,"canvas-view-info-preview":a.canvasViewInfoPreview,"dv-info":a.dvInfo,"cur-preview-gap":a.curPreviewGap,"download-status":m.value},null,8,["show-position","canvas-data-preview","canvas-style-preview","canvas-view-info-preview","dv-info","cur-preview-gap","download-status"])):r("",!0)],2)):r("",!0)],64)):ee.value&&N.value?(o(),c(K,{key:2,description:n(y)("visualization.select_screen_tips"),"img-type":"select"},null,8,["description"])):N.value?(o(),c(K,{key:3,description:n(y)("visualization.no_screen"),"img-type":"none"},{default:f(()=>[ae.value&&!oe.value?(o(),c(u,{key:0,onClick:te,type:"primary"},{icon:f(()=>[p(n(Oe),{name:"icon_add_outlined"},{default:f(()=>[p(n(Ae),{class:"svg-icon"})]),_:1})]),default:f(()=>[Ie(" "+U(n(y)("commons.create"))+U(n(y)("work_branch.big_data_screen")),1)]),_:1})):r("",!0)]),_:1},8,["description"])):r("",!0)]),_:1},8,["class"])),[[x,!w.value]])]),p(Ge,{ref_key:"appExportFormRef",ref:R,"dv-info":a.dvInfo,"component-data":a.canvasDataPreview,"canvas-view-info":a.canvasViewInfoPreview,onDownLoadApp:pe},null,8,["dv-info","component-data","canvas-view-info"])],64)}}});export{pa as _};

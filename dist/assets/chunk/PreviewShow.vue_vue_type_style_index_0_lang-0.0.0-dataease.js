import{a as fe,z as we}from"./index-0.0.0-dataease.js";import"./el-footer-0.0.0-dataease.js";import"./el-aside-0.0.0-dataease.js";import"./el-main-0.0.0-dataease.js";import{a as me,n as _e,o as ye,D as he,y as Se,j as ge}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as ke,y as d,af as Pe,r as l,X as De,o as Ce,aj as Ie,e as W,f as o,O as g,P as Ae,g as c,T,u as n,_ as r,j as p,i as f,R as $,U as xe,S as B,W as G,a3 as Te,a4 as U,n as E}from"./vue-0.0.0-dataease.js";import{i as Be}from"./icon_add_outlined-0.0.0-dataease.js";import{D as Ee}from"./DeResourceTree-0.0.0-dataease.js";import{d as Ve}from"./dvMain-0.0.0-dataease.js";import H from"./DeResourceArrow-0.0.0-dataease.js";import{_ as Re}from"./PreviewHead.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import{E as K}from"./EmptyBackground-0.0.0-dataease.js";import{useAppStoreWithOut as be}from"./app-0.0.0-dataease.js";import{S as Ne,i as Me,o as Oe}from"./canvasUtils-0.0.0-dataease.js";import{u as Le}from"./useMoveLine-0.0.0-dataease.js";import{a as ze,c as qe}from"./imgUtils-0.0.0-dataease.js";import{M as Fe}from"./MultiplexPreviewShow-0.0.0-dataease.js";import{g as je}from"./DePreview-0.0.0-dataease.js";import{A as We}from"./AppExportForm-0.0.0-dataease.js";import{a as $e,c as Ge}from"./index-0.0.0-dataease16.js";const Ue={class:"dv-preview"},He={key:1,class:"content multiplexing-content"},wa=ke({__name:"PreviewShow",props:{showPosition:{required:!1,type:String,default:"preview"},noClose:{required:!1,type:Boolean,default:!1},resourceTable:{required:!1,type:String,default:"core"}},setup(s,{expose:X}){const J=me(),Q=d(()=>J.getName),{t:h}=ye(),k=Ve(),{dvInfo:Y,canvasViewDataInfo:V}=Pe(k),P=l(null),R=l(null),S=l(!0),w=l(!0),m=l(!1),{width:D,node:Z}=Le("DASHBOARD"),b=l(null),C=s,_=l(),ee=d(()=>{var e;return(e=_.value)==null?void 0:e.hasData}),N=d(()=>{var e;return(e=_.value)==null?void 0:e.mounted}),ae=d(()=>{var e;return(e=_.value)==null?void 0:e.rootManage}),I=be(),oe=d(()=>I.getIsDataEaseBi);function te(){var e;(e=_.value)==null||e.createNewObject()}const M=(e,i,t)=>{const q=C.showPosition==="multiplexing"?Ne:Me;w.value=!1,q(e,{busiFlag:"dataV",resourceTable:"core"},function({canvasDataResult:F,canvasStyleResult:j,dvInfo:u,canvasViewInfoPreview:A,curPreviewGap:x}){u.weight=i,u.ext=t||0,a.canvasDataPreview=F,a.canvasStylePreview=j,a.canvasViewInfoPreview=A,a.dvInfo=u,a.curPreviewGap=x,w.value=!0,C.showPosition==="preview"&&(k.updateCurDvInfo(u),E(()=>{var y;(y=R.value)==null||y.restore()})),E(()=>{Oe({resourceId:e})})})},O=e=>{m.value=!0,setTimeout(()=>{const i=P.value.querySelector(".canvas-container");ze(e,i,a.dvInfo.name,()=>{m.value=!1})},200)},L=(e,i)=>{m.value=!0,E(()=>{const t=P.value.querySelector(".canvas-container");qe(e,t,a.dvInfo.name,i,()=>{m.value=!1})})},ne=e=>{e==="template"?L(e,null):e==="app"&&se()},se=()=>{const e=re();e&&e.length>0?he.warning(`当前仪表板中[${e}]属于模版图表，无法导出，请先设置数据集！`):b.value.init({appName:a.dvInfo.name,icon:null,version:"2.0",creator:Q.value,required:"2.9.0",description:null})},re=()=>{let e=",";return Object.keys(V.value).forEach(i=>{const t=V.value[i];t&&(t==null?void 0:t.dataFrom)==="template"&&(e=e+t.title+",")}),e.slice(1)},Ke=()=>{S.value=!S.value},ie=e=>{M(e,a.dvInfo.weight,a.dvInfo.ext)},le=e=>{M(e.id,e.weight,e.ext)},ce=d(()=>{var e;return((e=a.canvasStylePreview)==null?void 0:e.screenAdaptor)==="keep"}),a=De({canvasDataPreview:null,canvasStylePreview:null,canvasViewInfoPreview:null,dvInfo:null,curPreviewGap:0}),v=l(!0),z=e=>{v.value=e},ve=()=>{I.setArrowSide(!0)},ue=()=>{I.setArrowSide(!1)},de=()=>a,pe=e=>{L("app",e)};return Ce(()=>{fe({name:"canvasDownload",callback:function(){O("img")}})}),X({getPreviewStateInfo:de}),Ie(()=>{C.showPosition==="preview"&&k.canvasDataInit()}),(e,i)=>{var y;const t=$e,q=W("ArrowLeft"),F=ge,j=W("ArrowRight"),u=Se,A=Ge,x=we;return o(),g(G,null,[Ae("div",Ue,[s.noClose?r("",!0):(o(),c(H,{key:0,style:T({left:(v.value?n(D)-12:0)+"px"}),onChangeSideTreeStatus:z,isInside:!v.value},null,8,["style","isInside"])),p(t,{class:B(["resource-area",{"close-side":!S.value,retract:!v.value}]),onMouseenter:ve,onMouseleave:ue,ref_key:"node",ref:Z,style:T({width:n(D)+"px"})},{default:f(()=>[s.noClose?r("",!0):(o(),c(H,{key:0,isInside:!v.value,style:T({left:(v.value?n(D)-12:0)+"px"}),onChangeSideTreeStatus:z},null,8,["isInside","style"])),$(p(Ee,{ref_key:"resourceTreeRef",ref:_,"cur-canvas-type":"dataV","show-position":s.showPosition,"resource-table":s.resourceTable,onNodeClick:le},null,8,["show-position","resource-table"]),[[xe,S.value]])]),_:1},8,["class","style"]),$((o(),c(A,{class:B(["preview-area",{"no-data":!((y=a.dvInfo)!=null&&y.id)}])},{default:f(()=>[r("",!0),n(Y).name?(o(),g(G,{key:1},[s.showPosition==="preview"?(o(),c(Re,{key:0,onReload:ie,onDownload:O,onDownloadAsAppTemplate:ne})):r("",!0),s.showPosition==="multiplexing"&&w.value?(o(),g("div",He,[p(Fe,{"component-data":a.canvasDataPreview,"canvas-style-data":a.canvasStylePreview,"canvas-view-info":a.canvasViewInfoPreview,"dv-info":a.dvInfo},null,8,["component-data","canvas-style-data","canvas-view-info","dv-info"])])):r("",!0),s.showPosition==="preview"?(o(),g("div",{key:2,class:B([{"canvas_keep-size":ce.value},"content"]),ref_key:"previewCanvasContainer",ref:P},[a.canvasStylePreview&&w.value?(o(),c(je,{key:0,ref_key:"dvPreviewRef",ref:R,"show-position":s.showPosition,"canvas-data-preview":a.canvasDataPreview,"canvas-style-preview":a.canvasStylePreview,"canvas-view-info-preview":a.canvasViewInfoPreview,"dv-info":a.dvInfo,"cur-preview-gap":a.curPreviewGap,"download-status":m.value},null,8,["show-position","canvas-data-preview","canvas-style-preview","canvas-view-info-preview","dv-info","cur-preview-gap","download-status"])):r("",!0)],2)):r("",!0)],64)):ee.value&&N.value?(o(),c(K,{key:2,description:n(h)("visualization.select_screen_tips"),"img-type":"select"},null,8,["description"])):N.value?(o(),c(K,{key:3,description:n(h)("visualization.no_screen"),"img-type":"none"},{default:f(()=>[ae.value&&!oe.value?(o(),c(u,{key:0,onClick:te,type:"primary"},{icon:f(()=>[p(n(_e),{name:"icon_add_outlined"},{default:f(()=>[p(n(Be),{class:"svg-icon"})]),_:1})]),default:f(()=>[Te(" "+U(n(h)("commons.create"))+U(n(h)("work_branch.big_data_screen")),1)]),_:1})):r("",!0)]),_:1},8,["description"])):r("",!0)]),_:1},8,["class"])),[[x,!w.value]])]),p(We,{ref_key:"appExportFormRef",ref:b,"dv-info":a.dvInfo,"component-data":a.canvasDataPreview,"canvas-view-info":a.canvasViewInfoPreview,onDownLoadApp:pe},null,8,["dv-info","component-data","canvas-view-info"])],64)}}});export{wa as _};

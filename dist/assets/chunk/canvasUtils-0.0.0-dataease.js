import{l as $,j as J,C as Z,a as R,M as I,k as ee,A as ae,m as te}from"./dataVisualization-0.0.0-dataease2.js";import{e as W}from"./eventBus-0.0.0-dataease.js";import{d as re}from"./dvMain-0.0.0-dataease.js";import{g as P,h as ie,i as se,j as oe,k as B,l as ne,m as ue,n as le}from"./dataVisualization-0.0.0-dataease.js";import{af as de}from"./vue-0.0.0-dataease.js";import{x as b,N as D,o as fe,F as ce,D as pe,a7 as he}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{ac as ge,S as M}from"./chart-0.0.0-dataease.js";import{s as ye}from"./snapshot-0.0.0-dataease.js";import{b as be}from"./index-0.0.0-dataease.js";import{g as L}from"./util-0.0.0-dataease.js";import{u as ve}from"./appearance-0.0.0-dataease.js";import{i as De}from"./ModelUtil-0.0.0-dataease.js";import{e as V}from"./lodash-0.0.0-dataease.js";const He=e=>b.post({url:"/linkage/getViewLinkageGatherArray",data:e}),Ue=e=>b.post({url:"/linkage/saveLinkage",data:e}),F=(e,a="snapshot")=>b.get({url:"/linkage/getVisualizationAllLinkageInfo/"+e+"/"+a}),Ye=e=>b.post({url:"/linkage/updateLinkageActive",data:e}),qe=e=>b.post({url:"/linkage/removeLinkage",data:e});function Xe(e,a){return b.get({url:"/linkJump/queryWithViewId/"+e+"/"+a})}function je(e){return b.post({url:"/linkJump/updateJumpSet",data:e,loading:!0})}function Ke(e){return b.post({url:"/linkJump/queryTargetVisualizationJumpInfo",data:e,loading:!0})}function H(e,a="snapshot"){return b.get({url:"/linkJump/queryVisualizationJumpInfo/"+e+"/"+a,loading:!1})}function Qe(e){return b.get({url:"/linkJump/viewTableDetailList/"+e,loading:!1})}function $e(e){return b.post({url:"/linkJump/updateJumpSetActive",data:e,loading:!0})}function Ze(e){return b.post({url:"/linkJump/removeJumpSet",data:e,loading:!0})}const f=re(),{inMobile:Te,dvInfo:y,canvasStyleData:U,componentData:p,canvasViewInfo:T,appData:G}=de(f),ke=ye(),{t:S}=fe(),Ee=ve(),{wsCache:Y}=be();function Re(e){const a=e.split("&"),t=a[0],r=a[1];return Ce(t,r)}function Ce(e,a,t){let r;if($.forEach(i=>{(i.component===e||i.component===a)&&(r=V(i),["DeTabs","DeScreen"].includes(r.component)&&(r.propValue[0].name=L(),r.titleBackground=D(J)),r.innerType=a,r.innerType==="richText"&&(r.propValue={textValue:""}),f.curOriginThemes==="light"?r.commonBackground=V(Z):r.commonBackground=V(R))}),e==="UserView"){const i=ge(a);r.name=i==null?void 0:i.title,r.label=i==null?void 0:i.title,r.render=i==null?void 0:i.render,r.isPlugin=!!t,r.isPlugin&&(r.staticMap=t)}else["DeDecoration","DynamicBackground"].includes(e)&&(r.style.borderWidth=0,r.style.innerPadding=0);return r}function Ie(e,a){const t=e.target.dataset.id;a==="dashboard"?W.emit("handleDragStartMoveIn-canvas-main",t):e.dataTransfer.setData("id",t)}function ea(e,a){a==="dashboard"&&W.emit("handleDragEnd-canvas-main",e)}function A(e){var a,t;e.x=1+(e.x-1)*2,e.y=1+(e.y-1)*2,e.sizeX=e.sizeX*2,e.sizeY=e.sizeY*2,e.mx=1+(e.mx-1)*2,e.my=1+(e.my-1)*2,e.mSizeX=e.mSizeX*2,e.mSizeY=e.mSizeY*2,e.component==="Group"?(a=e.propValue)==null||a.forEach(r=>{A(r)}):e.component==="DeTabs"&&((t=e.propValue)==null||t.forEach(r=>{var i;(i=r.componentData)==null||i.forEach(n=>{A(n)})}))}function N(e,a,t,r,i){var n,l,s,u;e.canvasActive=!1,e.component==="VQuery"&&(e.freeze=e.freeze||!1),e.component==="VQuery"&&(t==null?void 0:t.source)==="report"&&a&&((n=e.propValue)!=null&&n.forEach)&&((l=e.propValue)==null||l.forEach((o,d)=>{a[o.id]&&(e.propValue[d]=JSON.parse(a[o.id].filterInfo))})),e.component==="DeTabs"&&(e.editableTabsValue=e.editableTabsValue||"",e.style.showTabTitle=e.style.showTabTitle===void 0?!0:e.style.showTabTitle),e.expand=e.expand||!1,e.resizeInnerKeep=e.resizeInnerKeep||!1,e.component==="Picture"&&(e.style.adaptation=e.style.adaptation||"adaptation"),e.style.adaptation=e.style.adaptation||"adaptation",e.style.borderActive===void 0?(e.style.borderActive=!1,e.style.borderWidth=1,e.style.borderRadius=5,e.style.borderStyle="solid",e.style.borderColor="#cccccc"):(e.style.borderWidth=e.style.borderWidth===void 0?1:e.style.borderWidth,e.style.borderRadius=e.style.borderRadius===void 0?5:e.style.borderRadius,e.style.borderStyle=e.style.borderStyle===void 0?"solid":e.style.borderStyle,e.style.borderColor=e.style.borderColor===void 0?"#cccccc":e.style.borderColor),e.dashboardHidden=e.dashboardHidden||!1,e.maintainRadio=e.maintainRadio||!1,e.multiDimensional=e.multiDimensional||D(I),e.carousel=e.carousel||D(ee),e.aspectRatio=e.aspectRatio||1,e.component==="UserView"&&(e.actionSelection=e.actionSelection||D(ae)),(!r||r===2)&&(i==null?void 0:i.type)==="dashboard"&&A(e),e.events=e.events&&e.events.checked!==void 0&&e.events.type!=="displayChange"?e.events:D(te),e.events.jump.type=e.events.jump.type||"_blank",e.category=e.category||"base",e.component==="DeTabs"?(e.titleBackground=e.titleBackground||D(J),e.style.fontStyle=e.style.fontStyle||"normal",e.style.fontWeight=e.style.fontWeight||"normal",e.style.textDecoration=e.style.textDecoration||"none",(s=e.propValue)==null||s.forEach(o=>{var d;(d=o.componentData)==null||d.forEach(c=>{N(c,a,t,r,i)})})):e.component==="Group"&&((u=e.propValue)==null||u.forEach(o=>{N(o,a,t,r,i)}))}function q(e,a,t,r,i){(r==null?void 0:r.resourceTable)==="snapshot"&&a.forEach(s=>{s.canvasId="canvas-main"});const n=Y.get("x-de-execute-version"),l=t==null?void 0:t.reportFilterInfo;(t==null?void 0:t.checkVersion)===n&&!l||(e.component.seniorStyleSetting=e.component.seniorStyleSetting||D(M),e.fontFamily=e.fontFamily||"PingFang",e.dashboard.showGrid=e.dashboard.showGrid||!1,e.dashboard.matrixBase=e.dashboard.matrixBase||4,e.dashboard.gapMode=e.dashboard.gapMode||"middle",e.component.seniorStyleSetting=e.component.seniorStyleSetting||D(M),e.suspensionButtonAvailable=e.suspensionButtonAvailable===void 0?!1:e.suspensionButtonAvailable,e.screenAdaptor=e.screenAdaptor||"widthFirst",e.dashboardAdaptor=e.dashboardAdaptor||"keepHeightAndWidth",e.refreshBrowserEnable=e.refreshBrowserEnable===void 0?!1:e.refreshBrowserEnable,e.refreshBrowserUnit=e.refreshBrowserUnit||"minute",e.refreshBrowserTime=e.refreshBrowserTime||5,e.scaleWidth=e.scale,e.scaleHeight=e.scale,e.popupAvailable=e.popupAvailable===void 0?!0:e.popupAvailable,e.popupButtonAvailable=e.popupButtonAvailable===void 0?!0:e.popupButtonAvailable,a.forEach(s=>{N(s,l,r,i,t)}))}function aa(e,a){const t=p.value.filter(r=>["ScrollText"].includes(r.component)||r.innerType==="rich-text");if(t&&t.length>0){const r=t.map(i=>i.id);P(e,a,{}).then(i=>{const n=i.data,s=JSON.parse(n.componentData).reduce((u,o)=>(u[o.id]=o,u),{});for(let u=0;u<p.value.length;u++){const o=p.value[u];if(r.includes(o.id)&&s[o.id])if(Te.value)p.value[u].propValue=s[o.id].propValue;else{const{top:d,left:c,height:v,width:k,fontSize:h}=p.value[u].style,{linkageFilters:C,outerParamsFilters:w,webParamsFilters:E}=p.value[u];s[o.id].style.top=d,s[o.id].style.left=c,s[o.id].style.height=v,s[o.id].style.width=k,s[o.id].linkageFilters=C,s[o.id].outerParamsFilters=w,s[o.id].webParamsFilters=E,h&&(s[o.id].style.fontSize=h),p.value[u]=s[o.id]}}})}}function x(e,a,t){const r=a.busiFlag,i=r!=null&&r.includes("-copy"),n=i?r.split("-")[0]:r,l=i?le:P;let s={source:a.source?a.source:"main"};if(f.canvasAttachInfo&&f.canvasAttachInfo.taskId&&(s={source:"report",taskId:f.canvasAttachInfo.taskId},f.canvasAttachInfo.hasOwnProperty("showWatermark")&&typeof f.canvasAttachInfo.showWatermark<"u"&&f.canvasAttachInfo.showWatermark!==null)){const o=f.canvasAttachInfo.showWatermark==="true";s.showWatermark=o}s.resourceTable=a.resourceTable?a.resourceTable:"core",l(e,n,s).then(u=>{var E;const o=u.data,d={...o.watermarkInfo,settingContent:(E=o.watermarkInfo)!=null&&E.settingContent?JSON.parse(o.watermarkInfo.settingContent):{}},c={id:o.id,name:o.name,pid:o.pid,status:o.status,selfWatermarkStatus:o.selfWatermarkStatus,type:o.type,creatorName:o.creatorName,updateName:o.updateName,createTime:o.createTime,updateTime:o.updateTime,watermarkInfo:d,weight:o.weight,ext:o.ext,contentId:o.contentId,mobileLayout:o.mobileLayout||!1},v=o.version,k=JSON.parse(o.componentData),h=JSON.parse(o.canvasStyleData),C=o.canvasViewInfo;q(h,k,o,s,v);const w=c.type==="dashboard"&&h.dashboard.gap==="yes"?h.dashboard.gapSize:0;Ee.setCurrentFont(h.fontFamily),document.documentElement.style.setProperty("--de-canvas_custom_font",`${h.fontFamily}`),t({canvasDataResult:k,canvasStyleResult:h,dvInfo:c,canvasViewInfoPreview:C,curPreviewGap:w})})}async function ta(e,a,t){x(e,a,function({canvasDataResult:r,canvasStyleResult:i,dvInfo:n,canvasViewInfoPreview:l}){a.onlyPreview||(f.setComponentData(r),f.setCanvasStyle(i),f.updateCurDvInfo(n),f.setCanvasViewInfo(l),F(n.id,a.resourceTable).then(s=>{f.setNowPanelTrackInfo(s.data)}),H(n.id,a.resourceTable).then(s=>{f.setNowPanelJumpInfo(s.data)})),t({canvasDataResult:r,canvasStyleResult:i,dvInfo:n,canvasViewInfoPreview:l})})}async function ra(e,a,t,r){x(e,{busiFlag:t},function({canvasDataResult:i,canvasStyleResult:n,canvasViewInfoPreview:l}){const s=i.filter(d=>!!d.inMobile),u=s.map(d=>d.id);p.value.forEach(d=>{if(d.inMobile=u.includes(d.id),d.inMobile){const{mx:c,my:v,mSizeX:k,mSizeY:h,mPropValue:C,mEvents:w,mCommonBackground:E}=s.find(m=>m.id===d.id);d.mx=c,d.my=v,d.mSizeX=k,d.mSizeY=h,d.mEvents=w,d.mCommonBackground=E,d.component==="VQuery"&&(d.mPropValue=C)}}),Object.keys(l).forEach(d=>{if(T.value[d]&&l[d]){const{customAttrMobile:c,customStyleMobile:v}=l[d];T.value[d].customStyleMobile=v,T.value[d].customAttrMobile=c}}),f.setComponentData(p.value);const o=V(U.value);o.mobileSetting?o.mobileSetting=n.mobileSetting:o.mobileSetting={backgroundColorSelect:!1,background:"",color:"#ffffff",backgroundImageEnable:!1,customSetting:!1},f.setCanvasStyle(o),r()})}function ia(e,a,t){x(e,a,function({canvasDataResult:r,canvasStyleResult:i,dvInfo:n,canvasViewInfoPreview:l}){const s=r.filter(u=>!!u.inMobile);r.forEach(u=>{var z;const{mx:o,my:d,mSizeX:c,mSizeY:v,mStyle:k,mPropValue:h,mEvents:C,mCommonBackground:w,style:E,propValue:m,events:j,commonBackground:K}=u;u.x=o,u.y=d,u.sizeX=c,u.sizeY=v,u.style=k||E,u.propValue=h||m,u.events=C||j,u.commonBackground=w||K,u.component==="DeTabs"&&((z=u.propValue)==null||z.forEach(Q=>{var _;(_=Q.componentData)==null||_.forEach(g=>{g.style=g.mStyle||g.style,g.propValue=g.mPropValue||g.propValue,g.events=g.mEvents||g.events,g.commonBackground=g.mCommonBackground||g.commonBackground})}))}),l&&Object.keys(l).forEach(u=>{const o=l[u],{customAttrMobile:d,customStyleMobile:c}=o;o.customAttr=d||o.customAttr,o.customStyle=c||o.customStyle}),f.setComponentData(s),f.setCanvasStyle(i),f.updateCurDvInfo(n),f.setCanvasViewInfo(l),F(n.id,a.resourceTable).then(u=>{f.setNowPanelTrackInfo(u.data)}),H(n.id).then(u=>{f.setNowPanelJumpInfo(u.data)}),t({canvasDataResult:s,canvasStyleResult:i,dvInfo:n,canvasViewInfoPreview:l})})}function sa(e){if(y.value.id&&y.value.optType!=="copy"&&!De()){const t={...y.value,watermarkInfo:null},r=(y.value.type==="dashboard"?S("work_branch.dashboard"):S("work_branch.big_data_screen"))+S("visualization.save_conflict_tips");se(t).then(i=>{i&&i.data==="Repeat"?ce.confirm(r,{confirmButtonType:"danger",type:"warning",autofocus:!1,showClose:!1}).then(()=>{e()}):e()})}else e()}async function oa(e){await we(null,e)}async function we(e,a){f.removeGroupArea();const t=V(p.value);t.forEach(s=>{var u,o;s.component==="UserView"?s.linkageFilters=[]:s.component==="Group"?(u=s.propValue)==null||u.forEach(d=>{d.linkageFilters=[]}):s.component==="DeTabs"&&((o=s.propValue)==null||o.forEach(d=>{var c;(c=d.componentData)==null||c.forEach(v=>{v.linkageFilters=[]})}))});const r=L(),i={canvasStyleData:JSON.stringify(U.value),componentData:JSON.stringify(t),canvasViewInfo:T.value,appData:G.value,...y.value,checkVersion:Y.get("x-de-execute-version"),contentId:r,watermarkInfo:null};let n="success";if(G.value&&await oe({datasetFolderPid:i.datasetFolderPid,datasetFolderName:i.datasetFolderName}).then(s=>{n=s.data}),n==="repeat"){pe.error("数据集分组名称已存在");return}he(y.value,S("components.length_1_64_characters"));const l=y.value.id&&y.value.optType!=="copy"?B:ne;l===B&&await ue({opt:"edit",nodeType:"leaf",name:y.value.name,type:y.value.type,id:y.value.id}),l(i).then(s=>{var u;if(l===B){const o=e!=null&&e.status?e==null?void 0:e.status:(u=s.data)==null?void 0:u.status;f.updateDvInfoCall(o,null,r)}else f.updateDvInfoCall(0,s.data,r);ke.resetStyleChangeTimes(),a(s)})}function na(e){return e&&(/^(http(s)?:\/\/)/.test(e.toLowerCase())?e:"http://"+e)}function ua(e,a,t,r){if(!t)return t;let i=t;const n=r.reduce((s,u)=>(s[u[e]]=u[a],s),{}),l=(t==null?void 0:t.match(/\[(.+?)\]/g))||[];return l&&l.forEach(s=>{const u=s.slice(1,-1);i=i.replace(s,n[u])}),i}function X(e){return e==="canvas-main"}function la(e){var a;if(e.component==="DeTabs"){let t=!0;return(a=e.propValue)==null||a.forEach(r=>{var i;(i=r.componentData)==null||i.forEach(n=>{n.component==="Group"&&(t=!1)})}),t}else return!0}function da(e){var a;if(e.component==="Group"){let t=!0;return(a=e.propValue)==null||a.forEach(r=>{r.component==="DeTabs"&&(t=!1)}),t}else return!0}function fa(e,a){if(a==="canvas-main")return X(e.canvasId);const t={};return p.value.forEach(r=>{O(r,null,t)}),a==="pTabGroup"?!!(t[e.id]&&t[e.id].component==="DeTabs"&&t[t[e.id].id]&&t[t[e.id].id].component==="Group"):a==="groupInTab"?!!(e.component==="Group"&&t[t[e.id].id]&&t[t[e.id].id].component==="DeTabs"):a==="tabInGroup"?!!(e.component==="DeTabs"&&t[e.id]&&t[e.id].component==="Group"):!1}function O(e,a,t){var r,i;t[e.id]=a,e.component==="DeTabs"?(r=e.propValue)==null||r.forEach(n=>{var l;(l=n.componentData)==null||l.forEach(s=>{O(s,e,t)})}):e.component==="Group"&&((i=e.propValue)==null||i.forEach(n=>{O(n,e,t)}))}function ca(e,a){return e.canvasId===a}function pa(e){return Ve(e)||Se(e)}function Ve(e){return e&&e.includes("Group")}function Se(e){return e&&!e.includes("Group")&&!X(e)}function ha(e,a=p.value){let t=-1;return a.forEach((r,i)=>{r.id===e&&(t=i)}),t}function ga(e,a,t=!1){const r=document.querySelector(t?"#point-shadow-main":"#shape-id-"+e.id),i=r.offsetWidth,n=r.offsetHeight;if(e.sizeX=Math.round(i/a.baseWidth),e.sizeY=Math.round(n/a.baseHeight),e.style.width=i,e.style.height=n,t){const l=r.offsetLeft,s=r.offsetTop;e.x=Math.round(l/a.baseWidth),e.y=Math.round(s/a.baseHeight),e.style.left=l,e.style.height=s}}function ya(e,a){e.forEach(t=>{var r,i;t.component==="UserView"&&t.innerType!="VQuery"?a.push(t.id):t.component==="Group"?(r=t.propValue)==null||r.forEach(n=>{a.push(n.id)}):t.component==="DeTabs"&&((i=t.propValue)==null||i.forEach(n=>{var l;(l=n.componentData)==null||l.forEach(s=>{a.push(s.id)})}))})}function Ae(e){return e.filter(a=>a.leaf?!0:a.children&&a.children.length>0?(a.children=Ae(a.children),!0):!1)}function ba(e,a){function t(r,i){if(r.children)for(const n of r.children){if(n.id===i)return r.id;const l=t(n,i);if(l!==null)return l}return null}for(const r of e){const i=t(r,a);if(i!==null)return i}return null}async function va(e,a){let t;await ie(e).then(r=>{const i=r.data,n=JSON.parse(i.componentData),l=i.appData,s=JSON.parse(i.canvasStyleData);n.forEach(u=>{(!i.version||i.version===2)&&i.type==="dashboard"&&A(u)}),s.component.seniorStyleSetting=s.component.seniorStyleSetting||D(M),s.scaleWidth=s.scale,s.scaleHeight=s.scaleHeight,t={canvasStyleData:s,componentData:n,canvasViewInfo:i.canvasViewInfo,appData:l,baseInfo:{preName:i.name}}}).catch(r=>{console.error(r)}),q(t.canvasStyleData,t.componentData,null,{resourceTable:"snapshot"},null),a(t)}function Da(){return y.value.type==="dashboard"}function Ta(e,a,t,r){const{width:i,height:n}=e.style,l=i,s=n;function u(d){return d===2?75:75+Math.floor(d-2)*35}a.left<0?a.left=0:l-a.left<60&&(a.left=a.left-60);const o=u(r);a.top<0?a.top=0:a.top+o+60>s&&(a.top=a.top-o)}function me(e){e&&Array.isArray(e)&&(e.sort((a,t)=>a.y-t.y),e.forEach(a=>{var t;a.component==="DeTabs"&&((t=a.propValue)==null||t.forEach(r=>{me(r.componentData)}))}))}function ka(){return p.value.length===0?1:p.value.filter(e=>e.y).map(e=>e.y+e.sizeY).reduce((e,a)=>Math.max(e,a),0)}function Ea(e){let a;return p.value.forEach(t=>{var r,i;t.id===e?a=t:t.component==="Group"?(r=t.propValue)==null||r.forEach(n=>{n.id===e&&(a=n)}):t.component==="DeTabs"&&((i=t.propValue)==null||i.forEach(n=>{var l;(l=n.componentData)==null||l.forEach(s=>{s.id===e&&(a=s)})}))}),a}function Ca(e,a="canvas_init_ready"){try{console.info("event:"+a);const t={type:"dataease-embedded-interactive",eventName:a,args:e};window.parent.postMessage(t,"*")}catch{console.warn("de_inner_params send error")}}function wa(e){if(e){const a=T.value[e.id];a.customStyle=e.customStyle,a.customAttr=e.customAttr,a.title=e.title,a.name=e.name}}function Va(e){e&&T.value[e.id]&&(["UserView"].includes(e.component)?T.value[e.id].title=e.name:["VQuery"].includes(e.component)&&(T.value[e.id].title=e.name,T.value[e.id].customStyle.component.title=e.name))}export{me as A,ga as B,ha as C,Ke as D,Ae as E,aa as F,ba as G,$e as H,Ye as I,qe as J,Ze as K,Xe as L,je as M,Qe as N,He as O,Ta as P,ua as Q,na as R,x as S,Ea as T,ra as U,ia as V,wa as W,ea as a,sa as b,Ie as c,oa as d,we as e,ya as f,la as g,va as h,ta as i,Ce as j,Re as k,Ue as l,F as m,Se as n,Ca as o,O as p,H as q,ka as r,Va as s,Ve as t,X as u,fa as v,da as w,Da as x,pa as y,ca as z};

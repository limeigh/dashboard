import{e as V,X as jl,q as lt,E as fe,r as Yl,i as Zl,K as Pl,f as Xl,s as zl,R as Wl,S as Jl,t as Kl,W as Ql,V as eo,Y as to,D as ao,F as lo,Z as oo,M as so,w as no,x as io,C as ro,y as uo,p as co,b as mo,v as po,A as fo,B as vo,_ as _o}from"./element-plus-secondary-0.0.0-dataease.js";import{o as c,c as h,aU as Ea,d as go,r as v,l as Ft,w as ho,x as Ze,k as Pe,b as yo,e as bo,n as ve,$ as K,a as m,W as l,U as s,u as a,S as de,Y as p,R as A,_ as T,a0 as Ne,Z as Xe,z as S,T as y,V as O,a8 as Ee,h as Co,q as ga,v as wo,s as To}from"./@vue-0.0.0-dataease.js";import{d as xo}from"./dv-folder-0.0.0-dataease.js";import{i as ha}from"./icon_left_outlined-0.0.0-dataease.js";import{i as Fo}from"./icon_right_outlined-0.0.0-dataease.js";import{r as ya}from"./AddSql-0.0.0-dataease.js";import{i as ko}from"./icon_organization_outlined-0.0.0-dataease.js";import{i as Vo}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{i as ba}from"./icon_add_outlined-0.0.0-dataease.js";import{i as No}from"./icon_refresh_outlined-0.0.0-dataease.js";import{i as Ca}from"./icon_expand-right_filled-0.0.0-dataease.js";import{F as wa,i as Ta}from"./FieldMore-0.0.0-dataease.js";import{i as xa}from"./icon_copy_outlined-0.0.0-dataease.js";import{i as kt}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import{i as Fa}from"./icon_edit_outlined-0.0.0-dataease.js";import{i as Eo}from"./icon_info_outlined-0.0.0-dataease.js";import{d as ka}from"./dayjs-0.0.0-dataease.js";import{i as Lo,a as Do}from"./field-calculated-list-0.0.0-dataease.js";import{l as So,n as Io,f as Uo,o as Ao,q as qo,r as Va,s as Mo}from"./dataset-0.0.0-dataease.js";import{a as $o,e as Bo,g as Ho,u as Ro}from"./index-0.0.0-dataease.js";import{e as b,i as Vt,f as Oo,n as Go}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{E as jo}from"./EmptyBackground-0.0.0-dataease.js";import{p as Yo}from"./@vueuse-0.0.0-dataease.js";import Zo from"./CalcFieldEdit-0.0.0-dataease.js";import{u as Po,b as Xo}from"./vue-router_2-0.0.0-dataease.js";import zo from"./UnionEdit-0.0.0-dataease.js";import Wo from"./CreatDsGroup-0.0.0-dataease.js";import{a as Jo,g as Le,b as Na}from"./util-0.0.0-dataease.js";import{f as G}from"./attr-0.0.0-dataease23.js";import{useAppStoreWithOut as Ko}from"./app-0.0.0-dataease.js";import{_ as Qo}from"./DatasetUnion.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import{i as X}from"./field-list-0.0.0-dataease.js";import{i as es}from"./datasource-list-0.0.0-dataease.js";import{h as q,d as ts}from"./lodash-es-0.0.0-dataease.js";import{_ as as}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./icon_close_outlined-0.0.0-dataease.js";import"./icon_info_colorful-0.0.0-dataease.js";import"./js-base64-0.0.0-dataease.js";import"./vue-clipboard3-0.0.0-dataease.js";import"./clipboard-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./CodeMirror-0.0.0-dataease2.js";import"./@codemirror-0.0.0-dataease.js";import"./@lezer-0.0.0-dataease.js";import"./style-mod-0.0.0-dataease.js";import"./crelt-0.0.0-dataease.js";import"./@marijn-0.0.0-dataease.js";import"./w3c-keyname-0.0.0-dataease.js";import"./codemirror-0.0.0-dataease.js";import"./GridTable-0.0.0-dataease.js";import"./ModelUtil-0.0.0-dataease.js";import"./dv-rename-0.0.0-dataease.js";import"./icon_calendar_outlined-0.0.0-dataease.js";import"./more_v-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";import"./pinia-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./fast-png-0.0.0-dataease.js";import"./iobuffer-0.0.0-dataease.js";import"./pako-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./none-0.0.0-dataease.js";import"./nothing-tree-0.0.0-dataease.js";import"./icon_adjustment_outlined-0.0.0-dataease.js";import"./UnionFieldList-0.0.0-dataease.js";import"./UnionItemEdit-0.0.0-dataease.js";import"./icon_right-association-0.0.0-dataease.js";import"./join-join-0.0.0-dataease.js";import"./treeSortUtils-0.0.0-dataease.js";import"./snowflake-id-0.0.0-dataease.js";import"./login-0.0.0-dataease.js";import"./icon_rename_outlined-0.0.0-dataease.js";import"./icon_more-vertical_outlined-0.0.0-dataease.js";import"./HandleMore.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import"./icon_more_outlined-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./less-0.0.0-dataease.js";import"./tslib-0.0.0-dataease.js";import"./copy-anything-0.0.0-dataease.js";import"./is-what-0.0.0-dataease.js";const ls={width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"};function os(_e,re){return c(),h("svg",ls,[...re[0]||(re[0]=[Ea('<g id="icon_sql_outlined"><g id="Union"><path d="M3.73875 8.736V8.60266H2.66342L2.66143 8.73398C2.65762 8.98596 2.70337 9.21143 2.8045 9.40559C2.90241 9.59358 3.03463 9.74989 3.2009 9.87261L3.20211 9.87349C3.3693 9.99402 3.55876 10.0807 3.76906 10.1343C3.97937 10.1906 4.19515 10.2187 4.41609 10.2187C4.68545 10.2187 4.92669 10.1874 5.1378 10.1222C5.34961 10.0578 5.53149 9.96695 5.67904 9.84731C5.82907 9.72491 5.94364 9.57892 6.02023 9.40962C6.09609 9.24194 6.13342 9.06129 6.13342 8.86933C6.13342 8.638 6.08342 8.4359 5.97261 8.27307C5.87491 8.12108 5.7558 7.99733 5.61464 7.90457C5.48072 7.81656 5.34269 7.75187 5.20064 7.71214C5.07741 7.67346 4.97621 7.64561 4.899 7.62994C4.66262 7.56996 4.4704 7.52058 4.32226 7.48178C4.18072 7.4438 4.0736 7.40713 3.99797 7.37258C3.92618 7.33811 3.89834 7.30959 3.88964 7.29545C3.87812 7.27672 3.86675 7.24291 3.86675 7.184C3.86675 7.12132 3.88029 7.0814 3.89769 7.05529C3.92312 7.01714 3.95447 6.98562 3.99243 6.96002C4.03522 6.93355 4.0822 6.91475 4.13422 6.9038C4.19294 6.89144 4.25129 6.88533 4.30942 6.88533C4.405 6.88533 4.48995 6.89359 4.56489 6.9092L4.56594 6.90941C4.64097 6.92441 4.70351 6.94919 4.75555 6.98206C4.80217 7.0115 4.83972 7.05217 4.86856 7.10724L4.87099 7.11148C4.9008 7.16365 4.92211 7.23655 4.92835 7.33631L4.93616 7.46133H6.00542V7.328C6.00542 7.09131 5.95973 6.88155 5.86141 6.70462C5.76997 6.5303 5.64409 6.38644 5.48455 6.27477C5.32744 6.16479 5.1483 6.08729 4.94889 6.04109C4.75657 5.9922 4.55573 5.968 4.34675 5.968C4.1639 5.968 3.98152 5.99278 3.7999 6.04197C3.61506 6.09203 3.44764 6.1696 3.29886 6.27531C3.14805 6.38246 3.02504 6.51755 2.93035 6.67931L2.92983 6.6802C2.83438 6.84621 2.78942 7.03894 2.78942 7.25333C2.78942 7.44367 2.82432 7.61498 2.90011 7.76235L2.90236 7.76637C2.9785 7.90262 3.07744 8.01798 3.19896 8.11115C3.31621 8.20104 3.44808 8.27454 3.59378 8.33205L3.59666 8.33311C3.73574 8.38435 3.87835 8.42826 4.02447 8.46486C4.16423 8.50425 4.3023 8.54011 4.43869 8.57241C4.56867 8.60319 4.68311 8.63868 4.78257 8.67846C4.87681 8.71616 4.94548 8.76069 4.99377 8.80898L4.99639 8.81146C5.03435 8.84742 5.05609 8.89446 5.05609 8.96533C5.05609 9.03643 5.03834 9.08573 5.01058 9.12208C4.9741 9.16593 4.92816 9.20162 4.87076 9.22895C4.80857 9.25856 4.74142 9.2797 4.66879 9.29204C4.5892 9.30189 4.51569 9.30666 4.44809 9.30666C4.34875 9.30666 4.2533 9.29554 4.16148 9.27356C4.07296 9.24893 3.99768 9.21464 3.93414 9.17183C3.87737 9.12793 3.83023 9.07132 3.79305 8.99982C3.75907 8.93447 3.73875 8.84836 3.73875 8.736Z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M10.2467 9.94025L9.76461 9.50152C9.89584 9.33145 9.99908 9.1408 10.0745 8.93029C10.1655 8.67632 10.2103 8.40319 10.2103 8.112C10.2103 7.8142 10.1656 7.53601 10.0748 7.27859C9.98421 7.01824 9.85316 6.78963 9.68094 6.59445C9.50771 6.39812 9.29635 6.24476 9.04862 6.13423C8.79781 6.02233 8.51571 5.968 8.20496 5.968C7.89747 5.968 7.61574 6.02243 7.36199 6.13393L7.3613 6.13423C7.11358 6.24476 6.90221 6.39812 6.72898 6.59445C6.55676 6.78963 6.42571 7.01824 6.33512 7.27859C6.24431 7.53601 6.19963 7.8142 6.19963 8.112C6.19963 8.40321 6.24468 8.67847 6.33544 8.93563C6.42627 9.18921 6.55759 9.41246 6.72985 9.60386C6.90306 9.79631 7.11415 9.94752 7.36129 10.0578L7.36355 10.0587C7.61689 10.1662 7.89807 10.2187 8.20496 10.2187C8.54665 10.2187 8.84912 10.1569 9.10796 10.0284L9.67299 10.5375L10.2467 9.94025ZM7.99391 9.01558L8.25457 9.2529C8.23915 9.25318 8.22262 9.25333 8.20496 9.25333C8.03365 9.25333 7.89703 9.22114 7.78956 9.16335C7.67575 9.09853 7.585 9.01485 7.5154 8.91196C7.44287 8.80474 7.3886 8.68419 7.35307 8.54932C7.32015 8.4071 7.30363 8.26139 7.30363 8.112C7.30363 7.95492 7.32028 7.80354 7.35333 7.65762C7.38906 7.5153 7.44346 7.39173 7.51541 7.28538L7.51639 7.28389C7.586 7.17796 7.67614 7.09532 7.78838 7.03465L7.79077 7.03329C7.8979 6.97249 8.03399 6.93866 8.20496 6.93866C8.37593 6.93866 8.51201 6.97251 8.61913 7.03331L8.62156 7.03463C8.73379 7.09529 8.82391 7.17797 8.89352 7.28389L8.89452 7.28537C8.96615 7.39126 9.01866 7.51431 9.05091 7.65622L9.05161 7.659C9.08798 7.80449 9.10629 7.95539 9.10629 8.112C9.10629 8.30607 9.08578 8.46482 9.04792 8.59102C9.02689 8.6611 9.00256 8.72358 8.97527 8.77894L8.56563 8.4047L7.99391 9.01558Z"></path><path d="M11.62 6.05866H10.516V10.1333H13.476V9.16266H11.62V6.05866Z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M1.33341 2C0.965225 2 0.666748 2.29848 0.666748 2.66667V13.3333C0.666748 13.7015 0.965225 14 1.33341 14H14.6667C15.0349 14 15.3334 13.7015 15.3334 13.3333V2.66667C15.3334 2.29848 15.0349 2 14.6667 2H1.33341ZM2.00008 3.33333V12.6667H14.0001V3.33333H2.00008Z"></path></g></g>',1)])])}const ss={render:os},ns={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function is(_e,re){return c(),h("svg",ns,[...re[0]||(re[0]=[Ea('<g clip-path="url(#clip0_1052_111876)"><path d="M8.00033 15.3332C12.0504 15.3332 15.3337 12.0499 15.3337 7.99984C15.3337 3.94975 12.0504 0.666504 8.00033 0.666504C3.95024 0.666504 0.666992 3.94975 0.666992 7.99984C0.666992 12.0499 3.95024 15.3332 8.00033 15.3332Z" fill="#FF8800"></path><path d="M7.66634 4.6665C7.48225 4.6665 7.33301 4.81574 7.33301 4.99984V8.99984C7.33301 9.18393 7.48225 9.33317 7.66634 9.33317H8.33301C8.5171 9.33317 8.66634 9.18393 8.66634 8.99984V4.99984C8.66634 4.81574 8.5171 4.6665 8.33301 4.6665H7.66634Z" fill="white"></path><path d="M7.66634 9.99984C7.48225 9.99984 7.33301 10.1491 7.33301 10.3332V10.9998C7.33301 11.1839 7.48225 11.3332 7.66634 11.3332H8.33301C8.5171 11.3332 8.66634 11.1839 8.66634 10.9998V10.3332C8.66634 10.1491 8.5171 9.99984 8.33301 9.99984H7.66634Z" fill="white"></path></g><defs><clipPath id="clip0_1052_111876"><rect width="16" height="16" fill="white"></rect></clipPath></defs>',2)])])}const ds={render:is},rs={class:"de-dataset-form"},us={class:"top"},cs={class:"name"},ms={key:0,class:"ed-form-item__error"},ps={class:"oprate"},fs={class:"table-list-top"},vs={class:"select-ds"},_s={class:"left-outlined"},gs={class:"flex-align-center icon"},hs={key:0},ys={class:"select-ds table-num"},bs={class:"num"},Cs={key:0,class:"el-empty"},ws={class:"el-empty__description",style:{"margin-top":"80px",color:"#5e6d82","text-align":"center"}},Ts={key:1,class:"table-checkbox-list"},xs={class:"label"},Fs=["title","onDragstart","onClick"],ks={class:"label"},Vs={key:0,class:"different-datasource"},Ns={class:"sql-title"},Es={class:"field-data"},Ls={class:"table-preview"},Ds={class:"preview-field"},Ss={class:"custom-tree-node father"},Is=["title"],Us={class:"operate child"},As={class:"custom-tree-node father"},qs=["title"],Ms={class:"operate child"},$s={class:"preview-data"},Bs={class:"flex-align-center"},Hs=["title"],Rs={class:"batch-area"},Os={class:"manage-container"},Gs={class:"column-style"},js={class:"column-style"},Ys={key:0,style:{color:"#8d9199"}},Zs={key:1,style:{color:"#8d9199"}},Ps={key:2},Xs={class:"column-style"},zs={key:0},Ws={key:1,style:{color:"#8d9199"}},Js={key:1,style:{"padding-left":"30px"}},Ks={class:"select-svg-icon"},Qs={class:"column-style"},en={key:0,style:{color:"#8d9199"}},tn={key:1,style:{color:"#8d9199"}},an={key:2,class:"flex-align-center icon"},ln={class:"column-style"},on={class:"column-style"},sn={key:0},nn={key:1,style:{color:"#8d9199"}},dn={class:"column-style"},rn={key:0},un={key:1,style:{color:"#8d9199"}},cn={class:"select-svg-icon"},mn={class:"column-style"},pn={key:0,style:{color:"#8d9199"}},fn={key:1,style:{color:"#8d9199"}},vn={key:2,class:"flex-align-center icon"},_n={key:0,class:"batch-operate flex-align-center"},gn={class:"flex-align-center"},hn={class:"num"},yn={class:"cascader-batch"},bn={class:"select-svg-icon"},Cn={class:"grouping_settings_label"},wn={style:{width:"100%"}},Tn={key:1,class:"group-fields_num"},xn={class:"name"},Fn={class:"group-fields_item",style:{"align-items":"center"}};function kn(_e){return typeof _e=="function"||Object.prototype.toString.call(_e)==="[object Object]"&&!To(_e)}const Vn=go({__name:"index",setup(_e){const{wsCache:re}=$o(),De=Ko(),le=Bo(),{t:d}=Oo(),ot=Po(),{push:La}=Xo()||{push:t=>{le.getToken||(window.location.href=t)}},ze=v(238),Nt=v(),ge=v(!1),j=v(),he=v(!1),E=v(),Q=v(d("data_set.unnamed_dataset")),ye=v("preview"),Da=v(""),oe=v(""),Se=v(""),Ie=v(!1),st=v(!1),ue=v(240),Et=v(0),Lt=v(0),be=v(!0),We=v(!1),Ce=v(!1),se=v(!1),Dt=v(),nt=v({}),N=v({dateFormat:"",id:"",dateFormatType:"",name:"",idArr:[]}),Y=v(!1);let it=!1;const St=t=>[d("dataset.text"),d("dataset.time"),d("dataset.value"),d("dataset.value")+"("+d("dataset.float")+")",d("dataset.value"),d("dataset.location")][t],dt=()=>{it=!0},rt=[{label:d("dataset.text"),value:0},{label:d("dataset.time"),value:1,children:[{value:"yyyy-MM-dd",label:"yyyy-MM-dd"},{value:"yyyy/MM/dd",label:"yyyy/MM/dd"},{value:"yyyy-MM-dd HH:mm:ss",label:"yyyy-MM-dd HH:mm:ss"},{value:"yyyy/MM/dd HH:mm:ss",label:"yyyy/MM/dd HH:mm:ss"},{value:"custom",label:d("visualization.custom")}]},{label:d("dataset.location"),value:5},{label:d("dataset.value"),value:2},{label:d("dataset.value")+"("+d("dataset.float")+")",value:3},{label:"URL",value:7}],ut=[{label:d("dataset.text"),value:0},{label:d("dataset.time"),value:1},{label:d("dataset.location"),value:5},{label:d("dataset.value"),value:2},{label:d("dataset.value")+"("+d("dataset.float")+")",value:3},{label:"URL",value:7}],It=v(),Ut=v(),Sa={name:[{required:!0,message:d("data_set.cannot_be_empty_time"),trigger:"blur"}]},Ia={name:[{required:!0,message:d("dataset.input_edit_name"),trigger:"blur"}]},ct=Ft({datasourceId:"",name:"",tableName:d("data_set.custom_sql"),type:"sql"});let Z={id:"",pid:"",name:""};const At={children:"children",label:"label"},$=v(260);let mt=[];const qt=(t,e)=>{let n="";return t.some(i=>{var u;return i.id===e?(n=i.name,!0):((u=i.children)!=null&&u.length&&(n=qt(i.children,e)||n),!1)}),n},{height:Ua}=Yo(),pt=t=>t.filter(e=>{var n,i;return e.leaf?!0:((n=e.children)!=null&&n.length&&(e.children=pt(e.children||[])),!!((i=e.children)!=null&&i.length))}),Aa=t=>qt(B.dataSourceList,t),Ue=()=>{if(re.set(Ho("dataset-info-id"),Z.id),De.isDataEaseBi){le.clearState(),Ro().emitter.emit("changeCurrentComponent","Dataset");return}const t=le.getToken&&De.getIsIframe?"dataset-embedded":"dataset";history.state.back&&!De.getIsIframe?history.back():La({name:t,params:{id:Z.id}})},qa=()=>{it?lt.confirm(d("data_set.want_to_exit"),{confirmButtonText:d("dataset.confirm"),cancelButtonText:d("common.cancel"),showCancelButton:!0,confirmButtonType:"primary",type:"warning",autofocus:!1,showClose:!1}).then(()=>{Ue()}):Ue()},Ma=()=>{if(N.value.idArr.length){const{idArr:t}=N.value;f.value.forEach(e=>{t.includes(e.id)&&Object.assign(e,{deTypeArr:[...et]})}),delete N.value.name,Fe()}else te.value.concat(ee.value).some(t=>t.id===N.value.id?(delete N.value.name,Object.assign(t,{deTypeArr:[...et]}),!0):!1);N.value.idArr=[],N.value.id="",se.value=!1},$a=()=>{if(N.value.idArr.length){const{name:t,idArr:e}=N.value;f.value.forEach(n=>{e.includes(n.id)&&Object.assign(n,{deType:1,dateFormatType:"custom",dateFormat:t,deTypeArr:[1,"custom"]})}),delete N.value.name,Fe(),se.value=!1}else It.value.validate(t=>{t&&(te.value.concat(ee.value).some(e=>e.id===N.value.id?(e.dateFormat=N.value.name,e.deType=1,e.dateFormatType="custom",!0):!1),se.value=!1)})};ho(Se,t=>{W.value=mt.filter(e=>e.tableName.toLowerCase().includes(t.toLowerCase()))});const Ba=()=>{const t=[];Ce.value=!0,Te(t,E.value.getNodeList()),Mo({...Z,name:Q.value,union:t,isCross:Y.value,allFields:f.value,nodeType:"dataset"}).then(()=>{it=!1,fe.success(d("data_set.saved_successfully")),xt&&Ue()}).finally(()=>{Ce.value=!1})},z=(t,e)=>{dt(),ye.value==="manage"&&(Re.value=me.value.getSelectionRows().map(i=>i.id),Oe.value=ce.value.getSelectionRows().map(i=>i.id));const n=["text","time","value","float","value","location","binary","url"];if(n.includes(e)){t.deType=n.indexOf(e),t.dateFormat="";return}switch(Jo.includes(e)&&(N.value.dateFormat=t.dateFormat,N.value.dateFormatType=t.dateFormatType,t.deType=1,t.dateFormatType=e,t.dateFormat=e),e){case"copy":t.extField===3?Ga(t):Ra(t);break;case"delete":Ya(t);break;case"translate":Ha(t.id);break;case"editor":t.extField===3?cl(t):Xa(t);break;case"rename":Pa(t);break;case"custom":N.value.id=t.id,se.value=!0;break}ye.value==="manage"&&Fe()},Ha=t=>{const e=f.value.find(n=>n.id===t);e.groupType=e.groupType==="d"?"q":"d"},Mt=t=>{const e=pe.value.map(n=>n.id);f.value.forEach(n=>{e.includes(n.id)&&(n.groupType=t)}),Fe()},Ra=t=>{const e=q(t);e.id=Le(),e.extField=2,e.originName=t.extField===2?t.originName:"["+t.id+"]",e.name=Na(te.value.concat(ee.value),t.name),e.dataeaseName=null,e.lastSyncTime=null;const n=f.value.findIndex(i=>i.id===t.id);f.value.splice(n+1,0,e)},Oa=t=>![3].includes(t.extField),Ga=t=>{const e=q(t);e.id=Le(),e.name=Na(te.value.concat(ee.value),t.name);const n=f.value.findIndex(i=>i.id===t.id);f.value.splice(n+1,0,e)},$t=t=>{const e=[...t];for(;e.length;){const[n]=e;e.shift(),f.value=f.value.filter(r=>r.id!==n);const i=f.value.reduce((r,g)=>(g.extField===2&&(r=[...r,...(g.params||[]).map(F=>F.id)]),r),[]),u=f.value.map(r=>r.id).concat(i);f.value=f.value.filter(r=>{if(![2,3].includes(r.extField))return!0;const g=r.originName.match(/\[(.+?)\]/g)||[];return!g||g.every(L=>{const k=L.slice(1,-1);return u.includes(k)})?!0:(e.push(r.id),!1)})}ll()},ja=(t,e)=>{const n=[...t];let i=[];for(;n.length;){const[u]=n;n.shift(),e=e.filter(g=>g.id!==u);const r=e.map(g=>g.id);e=e.filter(g=>{if(![2,3].includes(g.extField))return!0;const F=g.originName.match(/\[(.+?)\]/g)||[];return!F||F.every(k=>{var w;return(w=g.params)==null?void 0:w.map(I=>I.id).includes(k.slice(1,-1))})||F.every(k=>{const w=k.slice(1,-1);return r.includes(w)})?!0:(n.push(g.id),i.push(g.id),!1)})}return i},Ya=t=>{let e="";e=f.value.reduce((i,u)=>{if(![2,3].includes(u.extField))return i;let r=u.originName.match(/\[(.+?)\]/g)||[];return r=r.filter(F=>{var L;return!((L=u.params)!=null&&L.map(k=>k.id).includes(F.slice(1,-1)))}),i=[...r.map(F=>F.slice(1,-1)),...i],i},[]).includes(t.id)?d("data_set.deleted_confirm_deletion"):"",lt.confirm(d("data_set.delete_field_a",{a:t.name}),{confirmButtonText:d("dataset.confirm"),tip:e,cancelButtonText:d("common.cancel"),showCancelButton:!0,confirmButtonType:"danger",type:"warning",autofocus:!1,showClose:!1,callback:i=>{i==="confirm"&&($t([t.id]),E.value.dfsNodeFieldBackReal(t),fe({message:d("chart.delete_success"),type:"success"}))}})},Za=t=>{ge.value=!0,ft.value=d("dataset.add_calc_field"),ve(()=>{j.value.initEdit({groupType:t,id:Le()},te.value.filter(e=>e.extField!==3),ee.value.filter(e=>e.extField!==3))})},Je=v(!1),ne=v({id:"",name:""}),Pa=t=>{const{id:e,name:n}=t;ne.value={id:e,name:n},Je.value=!0},ft=v(""),Xa=t=>{ge.value=!0,ve(()=>{ft.value=d("dataset.edit_calc_field"),j.value.initEdit(t,te.value,ee.value)})},Bt=()=>{ne.value.id="",ne.value.name="",Je.value=!1},za=()=>{Ut.value.validate(t=>{t&&(f.value.some(e=>e.id===ne.value.id?(e.name=ne.value.name,!0):!1),Bt())})},Wa=()=>{ge.value=!1},Ja=()=>{j.value.formField.validate(t=>{if(t){if(j.value.setFieldForm(),!j.value.fieldForm.originName.trim()){fe.error(d("data_set.cannot_be_empty_de_"));return}const e=q(j.value.fieldForm),{deType:n,dateFormat:i,deExtractType:u}=e;e.dateFormat=n===1?i:"",e.dateFormatType=n===1?i:"",e.deTypeArr=n===1&&u===0?[n,i]:[n];const r=f.value.findIndex(g=>e.id===g.id);r!==-1?f.value.splice(r,1,e):f.value.push(e),ge.value=!1}})},Ka=t=>t.map(e=>({key:e.dataeaseName,deType:e.deType,dataKey:e.dataeaseName,title:e.name,width:150,headerCellRenderer:({column:n})=>{let i;return l("div",{class:"flex-align-center"},[l(V,null,{default:()=>[l(b,null,kn(i=Co(X[G[n.deType]],{class:`svg-icon field-icon-${G[n.deType]}`}))?i:{default:()=>[i]})]}),l("span",{class:"ellipsis",title:n.title,style:{width:"120px",marginLeft:"4px"}},[n.title])])}})),vt=t=>(st.value=!0,ct.datasourceId=oe.value,Io({datasourceId:t}).then(e=>{mt=e||[],W.value=[...mt]}).finally(()=>{st.value=!1})),Qa=async(t,e)=>{await vt(t),e&&(Se.value=e)},Ae=v(!1),Ht=v(),el=async()=>{var u;let{id:t,datasourceId:e,tableName:n}=ot.query,{id:i}=ot.params;if(De.getIsDataEaseBi&&(t=le.datasetId,e=le.datasourceId,n=le.tableName,i=le.datasetCopyId||i),Ae.value=!1,i||t){const r=await Uo(i||t);if(!r||!r.id)return;Ae.value=!0}if(e&&(oe.value=e,Qa(e,n)),!(!t&&!i)){Ce.value=!0;try{const r=await Ao(i||t);Ce.value=!1;let g=[];const{pid:F,name:L}=r||{};Z={id:(r==null?void 0:r.id)||null,pid:F,name:i?d("data_set.copy_a_dataset"):L},i&&(Z.id=""),Q.value=Z.name,f.value=r.allFields||[],Y.value=r.isCross||!1,pa(g,r.union||[]);const[k]=r.union;oe.value=(u=k==null?void 0:k.currentDs)==null?void 0:u.datasourceId,vt(oe.value),E.value.initState(g)}catch(r){console.error(r),Ce.value=!1}}},tl=t=>{B.editArr=q(t),he.value=!0,ve(()=>{Be.value.initState()})},qe=Ze([]),_t=Ze([]),ee=Pe(()=>f.value.filter(t=>t.groupType==="q")),te=Pe(()=>f.value.filter(t=>t.groupType==="d")),Rt=(t,e)=>{t.forEach(n=>{var i;e[n.id]=n.tableName,(i=n.children)!=null&&i.length&&Rt(n.children,e)})},Ot=t=>{t!=="preview"&&(ht(),f.value.forEach(e=>{if(!Array.isArray(e.deTypeArr))e.deTypeArr=e.deType===1&&e.deExtractType===0?[e.deType,e.dateFormatType]:[e.deType];else{const[n]=e.deTypeArr;e.deTypeArr.length&&n!==e.deType&&e.deTypeArr.splice(0,1,e.deType)}}))},gt=()=>{var t,e,n;B.nodeNameList=[...E.value.nodeNameList],dt(),(t=B.nodeNameList)!=null&&t.length||(qe.value=[],_t.value=[]),(n=(e=Go)["/datasetData/previewData"])==null||n.call(e),ae.value=!1,ht()},ht=()=>{Rt(E.value.getNodeList(),nt.value)},B=Ft({nodeNameList:[],editArr:[],dataSourceList:[],fieldCollapse:["dimension","quota"]}),W=Ze([]),J=t=>{if(t===1)return"time";if(t===0)return"text";if([2,3,4].includes(t))return"value";if(t===5)return"location";if(t===7)return"url"},f=v([]);ga("allfields",f),ga("isCross",Y);let al=+new Date;const Me=v(!0),$e=v(!0),Gt=(t,e,n,i)=>{t.forEach(u=>{var r;u.id||(u.id=((r=i.find(g=>g.originName===u.originName))==null?void 0:r.id)||`${++al}`,u.datasetTableId=e,u.datasourceId=n)})},jt=(t,e)=>{e.forEach(n=>{var u;(u=n.children)!=null&&u.length&&jt(t,n.children);const{currentDsFields:i}=n;t.push(...q(i))})},Yt=(t,e)=>{const n=t.map(i=>i.id);return[...e.filter(i=>![2,3].includes(i.extField)).filter(i=>!n.includes(i.id)),...e.filter(i=>[2,3].includes(i.extField))]},Zt=(t,e)=>{const n=t.map(r=>r.id),i=e.map(r=>r.id),u=t.filter(r=>!i.includes(r.id));return q([...e.filter(r=>[2,3].includes(r.extField)),...u,...e.filter(r=>n.includes(r.id))])},Pt=()=>{pl(),Be.value.clearState(),he.value=!1},Be=v(),yt=()=>{var n;const t=[];jt(t,E.value.getNodeList());const e=Yt(t,f.value);f.value=Zt(t,f.value),$t(e),Ot("manage"),(n=Be.value)==null||n.clearState()},ll=()=>{const t=[],e=f.value.map(i=>i.id);f.value.filter(i=>i.extField===3).forEach(i=>{e.includes(i.originName)||t.push(i.id)}),f.value=f.value.filter(i=>!t.includes(i.id))},bt=(t,e)=>t.reduce((n,i)=>{var u;return i.id===e?n=[...i.currentDsFields]:(u=i.children)!=null&&u.length&&(n=bt(i.children,e)),n},[]),Xt=(t,e,n)=>{e.forEach(i=>{var u;if((u=i.children)!=null&&u.length&&Xt(t,i.children,n),!n.includes(i.id)){const{currentDsFields:r}=i;t.push(...q(r))}})},ol=()=>{const{node:t,parent:e}=Be.value,n=t.id,i=e.id;if(t.unionFields.some(U=>{const{currentField:D,parentField:P}=U;return!D||!P})){fe.error(d("data_set.cannot_be_empty_de_field"));return}const r=bt(E.value.getNodeList(),n),g=bt(E.value.getNodeList(),i);Gt(t.currentDsFields,t.id,t.datasourceId,r),Gt(e.currentDsFields,e.id,e.datasourceId,g);const F=q(t),L=q(e);let k=[];Xt(k,E.value.getNodeList(),[t.id,e.id]),k=[...k,...t.currentDsFields,...e.currentDsFields];const w=Yt(k,f.value);let I=Zt(k,f.value);const R=ja(w,I);if(R.length){const U=f.value.reduce((D,P)=>(R.includes(P.id)&&(D=[...(P.originName.match(/\[(.+?)\]/g)||[]).map(Ve=>Ve.slice(1,-1)),...D]),D),[]);lt.confirm(d("data_set.field_selection"),{confirmButtonText:d("dataset.confirm"),cancelButtonText:d("common.cancel"),showCancelButton:!0,tip:`${d("data_set.field")}: ${f.value.filter(D=>[...new Set(U)].includes(D.id)&&![2,3].includes(D.extField)).map(D=>D.name).join(",")}, ${d("data_set.confirm_the_deletion")}`,confirmButtonType:"danger",type:"warning",autofocus:!1,showClose:!1,callback:D=>{D==="confirm"&&(E.value.setStateBack(F,L),yt(),he.value=!1,gt(),E.value.setChangeStatus(n,i))}});return}E.value.setStateBack(F,L),yt(),he.value=!1,gt(),E.value.setChangeStatus(n,i)},sl=()=>{yt()},zt=[{value:"lt",label:"<"},{value:"le",label:"<="}],Wt=(t,e,n)=>{!e||!e.length?n(new Error(d("chart.value_can_not_empty"))):n()},Ke=v([]),nl={name:[{required:!0,message:d("dataset.input_edit_name"),trigger:"blur"}]},Jt={name:"",id:+new Date,datasourceId:"",datasetTableId:"",datasetGroupId:"",originName:"",otherGroup:"",groupType:"d",deType:0,type:"ANY",deExtractType:0,extField:3,deTypeOrigin:null,groupList:[{name:"",text:[],time:"",minTerm:"lt",maxTerm:"lt",min:null,max:null}]},x=Ft(q(Jt)),Kt=v(),we=v(!1),Ct=v(!1),Qe=Ze([]),Qt=Ze([]),il=()=>{Qe.value=f.value.filter(t=>![2,3].includes(t.extField)),Object.assign(x,q(Jt)),x.id=Le(),wt.value=d("dataset.create_grouping_field"),we.value=!0},ea=t=>{const e=Qe.value.find(r=>r.id===t),{deType:n}=e;if((n!==x.deExtractType||n===0)&&(Ke.value=[],x.groupList=[{name:"",text:[],time:"",minTerm:"lt",maxTerm:"lt",min:null,max:null}]),x.deTypeOrigin=n,n!==0)return;Ct.value=!0;const i=[],u=q(a(f));Te(i,E.value.getNodeList()),qo({dataset:{union:i,allFields:u,isCross:Y.value},field:e}).then(r=>{Qt.value=r||[]}).finally(()=>{Ct.value=!1})},dl=()=>{we.value=!1},rl=Pe(()=>{var t;return(t=x.groupList)==null?void 0:t.map(e=>e.text).flat()}),ul=(t,e)=>rl.value.includes(t)&&!e.includes(t),wt=v(d("dataset.create_grouping_field")),cl=t=>{Qe.value=f.value.filter(n=>![2,3].includes(n.extField)),Object.assign(x,t);const e=[];t.groupList.forEach(n=>{const{name:i,text:u=[],startTime:r,endTime:g,min:F,max:L,minTerm:k,maxTerm:w}=n,I={name:i,text:u,min:F,max:L,minTerm:k,maxTerm:w,time:[]};r&&g&&(I.time=[r,g]),e.push(I)}),ea(x.originName),x.groupList=e,wt.value=d("dataset.editing_grouping_field"),we.value=!0},ml=()=>{Kt.value.validate(t=>{let e=0,n;Ke.value.forEach(i=>{i==null||i.validate(u=>{u&&e++})}),n=setTimeout(()=>{if(clearTimeout(n),n=null,t&&e===x.groupList.length){const i=[];x.groupList.forEach(r=>{const{name:g,text:F=[],time:L,min:k,max:w,minTerm:I,maxTerm:R}=r,U={name:g,text:F,min:k,max:w,minTerm:I,maxTerm:R,startTime:"",endTime:""};if(x.deTypeOrigin===1){const[D,P]=L;U.startTime=ka(D).format("YYYY-MM-DD HH:mm:ss"),U.endTime=ka(P).format("YYYY-MM-DD HH:mm:ss")}i.push(U)});const u=f.value.findIndex(r=>r.id===x.id);u!==-1?f.value.splice(u,1,{...x,groupList:i}):f.value.push({...x,groupList:i}),we.value=!1}},1e3)})},pl=()=>{E.value.notConfirm()},fl=()=>{x.groupList.push({name:"",text:[],time:"",minTerm:"lt",maxTerm:"lt",min:null,max:null})},vl=t=>{x.groupList.splice(t,1),Ke.value.splice(t,1)},ta=(t,e)=>{Et.value=t.offsetX,Lt.value=t.offsetY,t.dataTransfer.setData("text/plain",JSON.stringify(e)),We.value=!0},aa=t=>{t.unableCheck||(Da.value=t.tableName)},_l=()=>{ae.value||j.value.formField.validate(t=>{if(t){if(j.value.setFieldForm(),!j.value.fieldForm.originName.trim()){fe.error(d("data_set.cannot_be_empty_de_"));return}const e=q(j.value.fieldForm),{deType:n,dateFormat:i,deExtractType:u}=e;e.dateFormat=n===1?i:"",e.dateFormatType=n===1?i:"",e.deTypeArr=n===1&&u===0?[n,i]:[n];const r=f.value.findIndex(L=>e.id===L.id),g=q(a(f));r!==-1?g.splice(r,1,e):g.push(e);const F=[];Te(F,E.value.getNodeList()),ae.value=!0,Va({union:F,allFields:g,isCross:Y.value}).then(()=>{fe.success(d("data_set.validation_succeeded"))}).finally(()=>{ae.value=!1})}})},Tt=v(!1),gl=()=>{Tt.value=!0,document.querySelector("body").style.userSelect="none",document.querySelector(".dataset-db").addEventListener("mousemove",la)},hl=()=>{Tt.value=!1,document.querySelector("body").style.userSelect="auto";const t=document.querySelector(".dataset-db");t.removeEventListener("mousemove",la),t.removeEventListener("mousemove",oa)},He=Pe(()=>{var t;return(t=E.value)==null?void 0:t.crossDatasources}),la=t=>{if(t.pageX<240){ue.value=240;return}if(t.pageX>500){ue.value=500;return}ue.value=t.pageX},yl=()=>{document.querySelector(".dataset-db").addEventListener("mousemove",oa)},oa=t=>{const e=document.documentElement.clientHeight;if(t.pageY-56<64){$.value=64,H.value=e-$.value-56;return}if(t.pageY>e-57){$.value=e-113,H.value=e-$.value-56;return}$.value=t.pageY-56,H.value=e-$.value-56,ze.value=H.value-242},H=v(0),sa=ts(()=>{const t=document.documentElement.clientHeight;if(t-H.value-56<64){$.value=64,H.value=t-$.value-56;return}$.value=t-H.value-56},60);let xt=!1;const bl=()=>{xt&&Ue()};let na=null;const ia=()=>na(!0);yo(async()=>{Ae.value=!1,await new Promise(t=>na=t),await el(),wl(Ae.value?0:2),window.addEventListener("resize",sa),Cl(),ze.value=H.value-242}),bo(()=>{window.removeEventListener("resize",sa)});const Cl=()=>{H.value=document.querySelector(".sql-result").offsetHeight},wl=t=>{So(t).then(e=>{const n=e||[];n&&n.length>0&&n[0].id==="0"?B.dataSourceList=pt(n[0].children):B.dataSourceList=pt(n),ve(()=>{var u;const i={methodName:"execute",args:null};(u=Ht.value)==null||u.invokeMethod(i)})})},da=(t,e)=>{var n;for(let i in t){const u=Le();e[t[i].currentDs.id]=u,t[i].currentDs.id=u,(n=t[i].childrenDs)!=null&&n.length&&da(t[i].childrenDs,e)}},Tl=t=>{const e={};for(let n in f.value){const i=Le();e[f.value[n].id]=i,f.value[n].id=i,f.value[n].datasetGroupId=""}return da(t,e),e},xl=(t,e)=>{let n=JSON.stringify(t),i=JSON.stringify(wo(E.value.getNodeList())),u=JSON.stringify(a(f.value));return Object.entries(e).forEach(([r,g])=>{n=n.replaceAll(r,g),u=u.replaceAll(r,g),i=i.replaceAll(r,g)}),f.value=JSON.parse(u),E.value.initState(JSON.parse(i)),JSON.parse(n)},ra=()=>{if(Z.id){Ba();return}let t=[];Te(t,E.value.getNodeList());const e=De.getIsDataEaseBi?le.datasetPid:ot.query.pid||Z.pid;if(!t.length){fe.error(d("data_set.dataset_cannot_be"));return}Z.pid&&!Z.id&&(t=xl(t,Tl(t))),Nt.value.createInit("dataset",{id:e||"0",union:t,allfields:f.value,isCross:Y.value},"",Q.value)},Fl=()=>{xt=!0,ra()},ae=v(!1),kl=()=>{if(ae.value)return;const t=[];Te(t,E.value.getNodeList()),ae.value=!0,Va({union:t,allFields:f.value,isCross:Y.value}).then(e=>{qe.value=Ka(e.data.fields||[]),_t.value=e.data.data||[]}).finally(()=>{ae.value=!1})},Te=(t,e)=>{e.forEach(n=>{var U;const i=[];(U=n.children)!=null&&U.length&&Te(i,n.children);const{tableName:u,type:r,datasourceId:g,id:F,info:L,unionType:k,unionFields:w,currentDsFields:I,sqlVariableDetails:R}=n;t.push({currentDs:{sqlVariableDetails:R,tableName:u,type:r,datasourceId:g,id:F,info:L},currentDsFields:I,childrenDs:i,unionToParent:{unionType:k,unionFields:w}})})},ce=v(),me=v(),Re=v([]),Oe=v([]),xe=v([]),pe=v([]),ua=Pe(()=>!!xe.value.length&&Array.from(new Set(xe.value)).length===1),Vl=()=>{me.value.clearSelection(),ce.value.clearSelection()},ie=v([]),ca=()=>{pe.value=[...me.value.getSelectionRows(),...ce.value.getSelectionRows()],xe.value=pe.value.map(n=>n.deExtractType);let t=pe.value.map(n=>n.deType);const[e]=pe.value;if(ve(()=>{Re.value=me.value.getSelectionRows().map(n=>n.id),Oe.value=ce.value.getSelectionRows().map(n=>n.id)}),Array.from(new Set(t)).length!==1){ie.value=[];return}ie.value=e.deType===1&&e.deExtractType===0?[1,e.dateFormatType]:[e.deType]},Nl=(t,e,n)=>{const i=n.target.parentNode.parentNode;if([...i.classList].includes("no-hide")){i.classList.remove("no-hide");return}i.classList.add("no-hide")};let et=[];const El=t=>{const[e,n]=t;Re.value=me.value.getSelectionRows().map(u=>u.id),Oe.value=ce.value.getSelectionRows().map(u=>u.id);const i=[...Oe.value,...Re.value];if(n==="custom"){const[u]=f.value.filter(r=>i.includes(r.id));et=u.deType===1?[1,u.dateFormatType]:[u.deType],N.value.id="",N.value.idArr=[...i],N.value.dateFormat="",N.value.dateFormatType=n,se.value=!0,Fe();return}f.value.forEach(u=>{i.includes(u.id)&&(u.deType=e,u.dateFormat=e===1?n:"",u.dateFormatType=e===1?n:"",u.deTypeArr=e===1&&u.deExtractType===0?[e,n]:[e])}),Fe()},Ll=(t,e)=>{var n;return t?(n=e.name)==null?void 0:n.toLowerCase().includes(t.toLowerCase()):!0},Fe=()=>{ve(()=>{ee.value.forEach(t=>{Oe.value.includes(t.id)&&ce.value.toggleRowSelection(t,!0)}),te.value.forEach(t=>{Re.value.includes(t.id)&&me.value.toggleRowSelection(t,!0)})})},Dl=()=>{We.value=!1},ma=(t,e)=>{const[n,i]=e;if(i==="custom"){et=t.deType===1?[1,t.dateFormatType]:[t.deType],N.value.id=t.id,se.value=!0;return}t.deType=n,t.dateFormat=n===1?i:"",t.dateFormatType=n===1?i:""},pa=(t,e)=>{e.forEach(n=>{var P;const i=[];(P=n.childrenDs)!=null&&P.length&&pa(i,n.childrenDs);const{unionToParent:u,currentDsFields:r,currentDs:g}=n,{tableName:F,type:L,datasourceId:k,id:w,info:I,sqlVariableDetails:R}=g||{},{unionType:U,unionFields:D}=u||{};t.push({sqlVariableDetails:R,tableName:F,type:L,datasourceId:k,id:w,info:I,currentDsFields:r,children:i,unionType:U,unionFields:D})})},Sl=()=>{Ie.value=!0,ve(()=>{Dt.value.focus()})},Il=t=>{t||He.value&&(Y.value=!t,lt.confirm(d("common.source_tips"),{confirmButtonText:d("dataset.confirm"),cancelButtonText:d("common.cancel"),showCancelButton:!0,confirmButtonType:"primary",type:"warning",autofocus:!1,showClose:!1}).then(()=>{Y.value=t}))},Ul=t=>{const{id:e,pid:n,name:i}=t;Q.value=i,Z={id:e,pid:n,name:i},f.value=t.allFields||[]},ke=v(""),Al=()=>{ke.value="",Q.value.trim()||(ke.value=d("commons.input_content")),Q.value.trim().length<1&&(ke.value=d("datasource.input_limit_1_64",[1,64])),Ie.value=!!ke.value},ql={children:"children",label:"name",disabled:t=>{var e;return!((e=t.children)!=null&&e.length)&&!t.leaf||t.extraFlag<0&&t.type!=="API"}},Ge=v([]),Ml=t=>{Ge.value=t},$l=t=>{if((Ge==null?void 0:Ge.value.length)===0||!t.leaf)return null;const e=Ge.value.filter(n=>n.type===t.type);return e&&e.length>0?e[0].icon:null},Bl=t=>t.leaf?es[t.type]:xo,fa=(t,e,n=!1)=>e===2?(n?Lo:Do)[t]:X[G[t]];return(t,e)=>{const n=Yl,i=Zl,u=Pl,r=Xl,g=zl,F=Wl,L=Jl,k=Kl,w=Ql,I=eo,R=to,U=ao,D=lo,P=oo,je=so,M=no,Ve=io,va=ro,tt=fo,at=uo,Hl=co,_a=vo,Rl=_o,Ol=mo,Ye=po;return c(),h(de,null,[K((c(),h("div",rs,[m("div",us,[m("span",cs,[l(a(V),{onClick:qa},{default:s(()=>[l(a(b),{name:"icon_left_outlined"},{default:s(()=>[l(a(ha),{class:"svg-icon"})]),_:1})]),_:1}),Ie.value?(c(),h(de,{key:0},[l(n,{maxlength:"64",ref_key:"editerName",ref:Dt,modelValue:Q.value,"onUpdate:modelValue":e[0]||(e[0]=o=>Q.value=o),onBlur:Al},null,8,["modelValue"]),ke.value?(c(),h("div",ms,p(ke.value),1)):A("",!0)],64)):(c(),h("span",{key:1,onClick:Sl,class:"dataset-name ellipsis",style:{"margin-left":"12px"}},p(Q.value),1))]),m("span",ps,[l(i,{disabled:Ie.value,type:"primary",onClick:Fl},{default:s(()=>[T(p(a(d)("data_set.save_and_return")),1)]),_:1},8,["disabled"]),l(i,{disabled:Ie.value,type:"primary",onClick:ra},{default:s(()=>[T(p(a(d)("data_set.save")),1)]),_:1},8,["disabled"])])]),m("div",{class:"container dataset-db",onMouseup:hl},[K(m("p",{class:"arrow-right",onClick:e[1]||(e[1]=o=>be.value=!0)},[l(a(V),null,{default:s(()=>[l(a(b),null,{default:s(()=>[l(a(Fo),{class:"svg-icon"})]),_:1})]),_:1})],512),[[Ne,!be.value]]),K(m("div",{style:Xe({left:ue.value+"px"}),class:S(["drag-left",Tt.value&&"is-dragging"]),onMousedown:gl},null,38),[[Ne,be.value]]),K((c(),h("div",{class:"table-list",style:Xe({width:ue.value+"px"})},[m("div",fs,[l(u,{style:{"margin-bottom":"8px"},modelValue:Y.value,"onUpdate:modelValue":e[2]||(e[2]=o=>Y.value=o),onChange:Il,"active-text":t.$t("common.cross_source"),"inactive-text":t.$t("common.single_source")},null,8,["modelValue","active-text","inactive-text"]),m("p",vs,[T(p(a(d)("data_set.select_data_source"))+" ",1),m("span",_s,[l(a(V),{style:{color:"#1f2329"},onClick:e[3]||(e[3]=o=>be.value=!1)},{default:s(()=>[l(a(b),{name:"icon_left_outlined"},{default:s(()=>[l(a(ha),{class:"svg-icon"})]),_:1})]),_:1})])]),l(g,{"check-strictly":!1,onChange:vt,placeholder:a(d)("dataset.pls_slc_data_source"),class:"ds-list","filter-node-method":Ll,filterable:"","popper-class":"tree-select-ds_popper",modelValue:oe.value,"onUpdate:modelValue":e[4]||(e[4]=o=>oe.value=o),"node-key":"id",props:ql,data:B.dataSourceList,"render-after-expand":!1},{default:s(({data:{name:o,leaf:_,type:C,extraFlag:Gl}})=>[m("div",gs,[l(a(V),null,{default:s(()=>[l(a(b),{"static-content":$l({leaf:_,type:C})},{default:s(()=>[(c(),y(O(Bl({leaf:_,type:C})),{class:"svg-icon"}))]),_:2},1032,["static-content"])]),_:2},1024),!_||Gl>-1?(c(),h("span",hs,p(o),1)):(c(),y(r,{key:1,effect:"dark",content:`${a(d)("data_set.invalid_data_source")}:${o}`,placement:"top"},{default:s(()=>[m("span",null,p(o),1)]),_:2},1032,["content"]))])]),_:1},8,["placeholder","modelValue","data"]),m("p",ys,[T(p(a(d)("datasource.data_table"))+" ",1),m("span",bs,[l(a(V),{class:"icon-color"},{default:s(()=>[l(a(b),{name:"reference-table"},{default:s(()=>[l(a(ya),{class:"svg-icon"})]),_:1})]),_:1}),T(" "+p(W.value.length),1)])]),l(n,{modelValue:Se.value,"onUpdate:modelValue":e[5]||(e[5]=o=>Se.value=o),class:"search",placeholder:a(d)("deDataset.by_table_name"),clearable:""},{prefix:s(()=>[l(a(V),null,{default:s(()=>[l(a(b),{name:"icon_search-outline_outlined"},{default:s(()=>[l(a(Vo),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"])]),!W.value.length&&Se.value!==""?(c(),h("div",Cs,[m("div",ws,p(a(d)("data_set.relevant_content_found")),1)])):(c(),h("div",Ts,[oe.value?(c(),h("div",{key:0,class:"list-item_primary",onDragstart:e[6]||(e[6]=o=>ta(o,ct)),onDragend:Dl,draggable:!0,onClick:e[7]||(e[7]=o=>aa(ct))},[l(a(V),{class:"icon-color"},{default:s(()=>[l(a(b),{name:"icon_sql_outlined_1"},{default:s(()=>[l(a(ss),{class:"svg-icon"})]),_:1})]),_:1}),m("span",xs,p(a(d)("data_set.custom_sql")),1)],32)):A("",!0),l(a(jl),{itemSize:40,data:W.value,total:W.value.length,width:ue.value-17,height:a(Ua)-305,scrollbarAlwaysOn:!1,"class-name":"el-select-dropdown__list",layout:"vertical"},{default:s(({index:o,style:_})=>[m("div",{class:"list-item_primary",style:Xe(_),title:W.value[o].tableName,onDragstart:C=>ta(C,W.value[o]),onDragend:e[8]||(e[8]=C=>We.value=!1),draggable:!0,onClick:C=>aa(W.value[o])},[l(a(V),{class:"icon-color"},{default:s(()=>[l(a(b),{name:"reference-table"},{default:s(()=>[l(a(ya),{class:"svg-icon"})]),_:1})]),_:1}),m("span",ks,p(W.value[o].tableName),1)],44,Fs)]),_:1},8,["data","total","width","height"])]))],4)),[[Ye,st.value],[Ne,be.value]]),m("div",{class:"drag-right",style:Xe({width:`calc(100vw - ${be.value?ue.value:0}px)`})},[He.value?(c(),h("div",Vs,[l(a(V),null,{default:s(()=>[l(a(b),{name:"icon_warning_colorful"},{default:s(()=>[l(a(ds),{class:"svg-icon"})]),_:1})]),_:1}),T(" "+p(a(d)("data_set.be_reported_incorrectly")),1)])):A("",!0),l(Qo,{onReGetName:ht,onJoinEditor:tl,onChangeUpdate:dt,maskShow:We.value,dragHeight:$.value,getDsName:Aa,offsetX:Et.value,offsetY:Lt.value,ref_key:"datasetDrag",ref:E,onUpdateAllfields:sl,onAddComplete:gt},null,8,["maskShow","dragHeight","offsetX","offsetY"]),m("div",{class:"sql-result",style:Xe({height:H.value?`${He.value?H.value-40:H.value}px`:`calc(100% - ${He.value?$.value+40:$.value}px)`})},[m("div",Ns,[m("span",{class:"drag",onMousedown:yl},null,32),m("div",Es,[l(i,{disabled:!f.value.length,onClick:e[9]||(e[9]=o=>Za("q")),secondary:""},{icon:s(()=>[l(a(V),null,{default:s(()=>[l(a(b),{name:"icon_add_outlined"},{default:s(()=>[l(a(ba),{class:"svg-icon"})]),_:1})]),_:1})]),default:s(()=>[T(" "+p(a(d)("dataset.add_calc_field")),1)]),_:1},8,["disabled"]),l(i,{disabled:!f.value.length,onClick:il,secondary:""},{icon:s(()=>[l(a(V),null,{default:s(()=>[l(a(b),null,{default:s(()=>[l(a(ko),{class:"svg-icon"})]),_:1})]),_:1})]),default:s(()=>[T(" "+p(a(d)("dataset.create_grouping_field")),1)]),_:1},8,["disabled"]),K((c(),y(i,{style:{"min-width":"70px"},disabled:!f.value.length,onClick:kl,secondary:""},{icon:s(()=>[l(a(V),null,{default:s(()=>[l(a(b),{name:"icon_refresh_outlined"},{default:s(()=>[l(a(No),{class:"svg-icon"})]),_:1})]),_:1})]),default:s(()=>[T(" "+p(a(d)("data_set.refresh_data")),1)]),_:1},8,["disabled"])),[[Ye,ae.value]])])]),l(L,{class:"padding-24",modelValue:ye.value,"onUpdate:modelValue":e[10]||(e[10]=o=>ye.value=o),onTabChange:Ot},{default:s(()=>[l(F,{label:a(d)("chart.data_preview"),name:"preview"},null,8,["label"]),l(F,{label:a(d)("dataset.batch_manage"),name:"manage"},null,8,["label"])]),_:1},8,["modelValue"]),K(m("div",Ls,[m("div",Ds,[m("div",{class:S(["field-d",{open:Me.value}])},[m("div",{class:S(["title",{expanded:Me.value}]),onClick:e[11]||(e[11]=o=>Me.value=!Me.value)},[l(a(V),{class:"expand"},{default:s(()=>[l(a(b),{name:"icon_expand-right_filled"},{default:s(()=>[l(a(Ca),{class:"svg-icon"})]),_:1})]),_:1}),T("  "+p(a(d)("chart.dimension")),1)],2),Me.value?(c(),y(k,{key:0,data:te.value,props:At},{default:s(({data:o})=>[m("span",Ss,[l(a(V),null,{default:s(()=>[l(a(b),null,{default:s(()=>[(c(),y(O(fa(o.deType,o.extField)),{class:S(["svg-icon",`field-icon-${a(G)[[2,3].includes(o.deType)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),m("span",{title:o.name,class:"label-tooltip"},p(o.name),9,Is),m("div",Us,[l(wa,{extField:o.extField,"trans-type":a(d)("data_set.convert_to_indicator"),"show-time":o.deExtractType===0,onHandleCommand:_=>z(o,_)},null,8,["extField","trans-type","show-time","onHandleCommand"])])])]),_:1},8,["data"])):A("",!0)],2),m("div",{class:S(["field-q",{open:$e.value}])},[m("div",{class:S(["title",{expanded:$e.value}]),onClick:e[12]||(e[12]=o=>$e.value=!$e.value)},[l(a(V),{class:"expand"},{default:s(()=>[l(a(b),{name:"icon_expand-right_filled"},{default:s(()=>[l(a(Ca),{class:"svg-icon"})]),_:1})]),_:1}),T("  "+p(a(d)("chart.quota")),1)],2),$e.value?(c(),y(k,{key:0,data:ee.value,props:At},{default:s(({data:o})=>[m("span",As,[l(a(V),null,{default:s(()=>[l(a(b),null,{default:s(()=>[(c(),y(O(fa(o.deType,o.extField,!0)),{class:S(["svg-icon",`field-icon-${a(G)[[2,3].includes(o.deType)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),m("span",{title:o.name,class:"label-tooltip"},p(o.name),9,qs),m("div",Ms,[l(wa,{"trans-type":a(d)("data_set.convert_to_dimension"),typeColor:"green-color","show-time":o.deExtractType===0,extField:o.extField,onHandleCommand:_=>z(o,_)},null,8,["trans-type","show-time","extField","onHandleCommand"])])])]),_:1},8,["data"])):A("",!0)],2)]),m("div",$s,[K((c(),y(I,{class:"dataset-preview_table",onRowClick:Nl,"header-class":"header-cell",data:_t.value,border:"",style:{width:"100%",height:"100%"}},{empty:s(()=>[l(jo,{description:a(d)("data_set.no_data"),"img-type":"noneWhite"},null,8,["description"])]),default:s(()=>[(c(!0),h(de,null,Ee(qe.value,(o,_)=>(c(),y(w,{key:o.dataKey+o.deType,prop:o.dataKey,label:o.title,width:qe.value.length-1===_?150:"auto",fixed:qe.value.length-1===_?"right":!1},{header:s(()=>[m("div",Bs,[l(a(V),{style:{"margin-right":"6px"}},{default:s(()=>[l(a(b),null,{default:s(()=>[(c(),y(O(a(X)[a(G)[o.deType]]),{class:S(["svg-icon",`field-icon-${a(G)[[2,3].includes(o.deType)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),m("span",{class:"ellipsis",title:o.title,style:{width:"120px"}},p(o.title),9,Hs)])]),_:2},1032,["prop","label","width","fixed"]))),128))]),_:1},8,["data"])),[[Ye,ae.value]])])],512),[[Ne,ye.value==="preview"&&!!f.value.length]]),K(m("div",Rs,[m("div",Os,[l(D,{modelValue:B.fieldCollapse,"onUpdate:modelValue":e[13]||(e[13]=o=>B.fieldCollapse=o),class:"style-collapse"},{default:s(()=>[l(U,{name:"dimension",title:a(d)("chart.dimension"),class:"dimension-manage-header manage-header"},{default:s(()=>[l(I,{onSelectionChange:ca,ref_key:"dimensionsTable",ref:me,data:te.value,height:ze.value,style:{width:"100%"}},{default:s(()=>[l(w,{selectable:Oa,type:"selection",width:"40"}),l(w,{prop:"name",label:a(d)("dataset.field_name"),width:"264"},{default:s(o=>[m("div",Gs,[l(n,{modelValue:o.row.name,"onUpdate:modelValue":_=>o.row.name=_,placeholder:a(d)("commons.input_content")},null,8,["modelValue","onUpdate:modelValue","placeholder"])])]),_:1},8,["label"]),l(w,{prop:"originName",label:a(d)("dataset.origin_name"),width:"240"},{default:s(o=>[m("div",js,[o.row.extField===2?(c(),h("span",Ys,p(a(d)("dataset.calc_field")),1)):o.row.extField===3?(c(),h("span",Zs,p(a(d)("dataset.grouping_field")),1)):(c(),h("span",Ps,p(o.row.originName),1))])]),_:1},8,["label"]),l(w,{prop:"description",label:a(d)("deDataset.description"),width:"240"},{default:s(o=>[m("div",Xs,[o.row.extField===0?(c(),h("span",zs,p(o.row.description),1)):(c(),h("span",Ws," "))])]),_:1},8,["label"]),l(w,{prop:"datasetTableId",label:a(d)("data_set.table_name_de"),width:"240"},{default:s(o=>[T(p(o.row.extField===0?nt.value[o.row.datasetTableId]:""),1)]),_:1},8,["label"]),l(w,{prop:"deType",label:a(d)("dataset.field_type"),width:"200"},{default:s(o=>[o.row.extField!==3?(c(),y(R,{key:0,class:S(!!o.row.deTypeArr&&!!o.row.deTypeArr.length&&"select-type"),"popper-class":"cascader-panel",modelValue:o.row.deTypeArr,"onUpdate:modelValue":_=>o.row.deTypeArr=_,onChange:_=>ma(o.row,_),options:o.row.deExtractType===0?rt:ut},{default:s(({data:_})=>[l(a(V),null,{default:s(()=>[l(a(b),null,{default:s(()=>[(c(),y(O(a(X)[J(_.value)]),{class:S(["svg-icon",`field-icon-${a(G)[[2,3].includes(_.value)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),m("span",null,p(_.label),1)]),_:1},8,["class","modelValue","onUpdate:modelValue","onChange","options"])):(c(),h("div",Js,p(t.$t("data_set.text")),1)),m("span",Ks,[l(a(V),null,{default:s(()=>[l(a(b),null,{default:s(()=>[(c(),y(O(a(X)[J(o.row.deType)]),{class:S(["svg-icon",`field-icon-${a(G)[[2,3].includes(o.row.deType)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024)])]),_:1},8,["label"]),l(w,{prop:"deExtraType",label:a(d)("dataset.origin_type"),width:"168"},{default:s(o=>[m("div",Qs,[o.row.extField===2?(c(),h("span",en,p(a(d)("dataset.calc_field")),1)):o.row.extField===3?(c(),h("span",tn,p(a(d)("dataset.grouping_field")),1)):o.row.extField===0?(c(),h("span",an,[l(a(V),null,{default:s(()=>[l(a(b),{className:"primary-color"},{default:s(()=>[(c(),y(O(a(X)[J(o.row.deExtractType)]),{class:"svg-icon primary-color"}))]),_:2},1024)]),_:2},1024),T(" "+p(St(o.row.deExtractType)),1)])):A("",!0)])]),_:1},8,["label"]),l(w,{fixed:"right",label:a(d)("chart.dimension")},{default:s(o=>[l(r,{effect:"dark",content:a(d)("data_set.convert_to_indicator"),placement:"top"},{default:s(()=>[[3].includes(o.row.extField)?A("",!0):(c(),y(i,{key:0,text:"",onClick:_=>z(o.row,"translate")},{icon:s(()=>[l(a(b),{name:"icon_switch_outlined"},{default:s(()=>[l(a(Ta),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"]))]),_:2},1032,["content"])]),_:1},8,["label"]),l(w,{fixed:"right",width:"168",label:a(d)("dataset.operator")},{default:s(o=>[l(r,{effect:"dark",content:a(d)("dataset.copy"),placement:"top"},{default:s(()=>[l(i,{text:"",onClick:_=>z(o.row,"copy")},{icon:s(()=>[l(a(b),{name:"icon_copy_outlined"},{default:s(()=>[l(a(xa),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["content"]),l(r,{effect:"dark",content:a(d)("dataset.delete"),placement:"top"},{default:s(()=>[l(i,{text:"",onClick:_=>z(o.row,"delete")},{icon:s(()=>[l(a(b),{name:"icon_delete-trash_outlined"},{default:s(()=>[l(a(kt),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["content"]),l(r,{effect:"dark",content:a(d)("dataset.edit"),placement:"top"},{default:s(()=>[[2,3].includes(o.row.extField)?(c(),y(i,{key:0,text:"",onClick:_=>z(o.row,"editor")},{icon:s(()=>[l(a(b),{name:"icon_edit_outlined"},{default:s(()=>[l(a(Fa),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])):A("",!0)]),_:2},1032,["content"])]),_:1},8,["label"])]),_:1},8,["data","height"])]),_:1},8,["title"]),l(U,{name:"quota",title:a(d)("chart.quota"),class:"quota-manage-header manage-header"},{default:s(()=>[l(I,{onSelectionChange:ca,ref_key:"quotaTable",ref:ce,height:ze.value,data:ee.value,style:{width:"100%"}},{default:s(()=>[l(w,{type:"selection",width:"40"}),l(w,{prop:"name",label:a(d)("dataset.field_name"),width:"264"},{default:s(o=>[m("div",ln,[l(n,{modelValue:o.row.name,"onUpdate:modelValue":_=>o.row.name=_,placeholder:a(d)("commons.input_content")},null,8,["modelValue","onUpdate:modelValue","placeholder"])])]),_:1},8,["label"]),l(w,{prop:"originName",label:a(d)("dataset.origin_name"),width:"240"},{default:s(o=>[m("div",on,[o.row.extField===0?(c(),h("span",sn,p(o.row.originName),1)):(c(),h("span",nn,p(a(d)("dataset.calc_field")),1))])]),_:1},8,["label"]),l(w,{prop:"description",label:a(d)("deDataset.description"),width:"240"},{default:s(o=>[m("div",dn,[o.row.extField===0?(c(),h("span",rn,p(o.row.description),1)):(c(),h("span",un," "))])]),_:1},8,["label"]),l(w,{prop:"datasetTableId",label:a(d)("data_set.table_name_de"),width:"240"},{default:s(o=>[T(p(o.row.extField===0?nt.value[o.row.datasetTableId]:""),1)]),_:1},8,["label"]),l(w,{prop:"deType",label:a(d)("dataset.field_type"),width:"200"},{default:s(o=>[l(R,{class:S(!!o.row.deTypeArr&&!!o.row.deTypeArr.length&&"select-type"),"popper-class":"cascader-panel",modelValue:o.row.deTypeArr,"onUpdate:modelValue":_=>o.row.deTypeArr=_,onChange:_=>ma(o.row,_),options:o.row.deExtractType===0?rt:ut},{default:s(({data:_})=>[l(a(V),null,{default:s(()=>[l(a(b),null,{default:s(()=>[(c(),y(O(a(X)[J(_.value)]),{class:S(["svg-icon",`field-icon-${a(G)[[2,3].includes(_.value)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),m("span",null,p(_.label),1)]),_:1},8,["class","modelValue","onUpdate:modelValue","onChange","options"]),m("span",cn,[l(a(V),null,{default:s(()=>[l(a(b),null,{default:s(()=>[(c(),y(O(a(X)[J(o.row.deType)]),{class:S(["svg-icon",`field-icon-${a(G)[[2,3].includes(o.row.deType)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024)])]),_:1},8,["label"]),l(w,{prop:"deExtraType",label:a(d)("dataset.origin_type"),width:"168"},{default:s(o=>[m("div",mn,[o.row.extField===2?(c(),h("span",pn,p(a(d)("dataset.calc_field")),1)):o.row.extField===3?(c(),h("span",fn,p(a(d)("dataset.grouping_field")),1)):o.row.extField===0?(c(),h("span",vn,[l(a(V),null,{default:s(()=>[l(a(b),{className:"green-color"},{default:s(()=>[(c(),y(O(a(X)[J(o.row.deExtractType)]),{class:"svg-icon green-color"}))]),_:2},1024)]),_:2},1024),T(" "+p(St(o.row.deExtractType)),1)])):A("",!0)])]),_:1},8,["label"]),l(w,{fixed:"right",label:a(d)("chart.quota")},{default:s(o=>[l(r,{effect:"dark",content:a(d)("data_set.convert_to_dimension"),placement:"top"},{default:s(()=>[l(i,{text:"",onClick:_=>z(o.row,"translate")},{icon:s(()=>[l(a(b),{name:"icon_switch_outlined"},{default:s(()=>[l(a(Ta),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["content"])]),_:1},8,["label"]),l(w,{fixed:"right",width:"168",label:a(d)("dataset.operator")},{default:s(o=>[l(r,{effect:"dark",content:a(d)("dataset.copy"),placement:"top"},{default:s(()=>[l(i,{text:"",onClick:_=>z(o.row,"copy")},{icon:s(()=>[l(a(b),{name:"icon_copy_outlined"},{default:s(()=>[l(a(xa),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["content"]),l(r,{effect:"dark",content:a(d)("dataset.delete"),placement:"top"},{default:s(()=>[l(i,{text:"",onClick:_=>z(o.row,"delete")},{icon:s(()=>[l(a(b),{name:"icon_delete-trash_outlined"},{default:s(()=>[l(a(kt),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["content"]),l(r,{effect:"dark",content:a(d)("dataset.edit"),placement:"top"},{default:s(()=>[o.row.extField===2?(c(),y(i,{key:0,text:"",onClick:_=>z(o.row,"editor")},{icon:s(()=>[l(a(b),{name:"icon_edit_outlined"},{default:s(()=>[l(a(Fa),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])):A("",!0)]),_:2},1032,["content"])]),_:1},8,["label"])]),_:1},8,["height","data"])]),_:1},8,["title"])]),_:1},8,["modelValue"])]),xe.value.length?(c(),h("div",_n,[m("div",gn,[T(p(a(d)("data_set.selected"))+" ",1),m("span",hn,p(xe.value.length),1),T(" "+p(a(d)("data_set.bar"))+" ",1),l(i,{onClick:Vl,text:"",style:{"margin-left":"16px"}},{default:s(()=>[T(p(a(d)("commons.clear")),1)]),_:1})]),m("div",yn,[l(R,{disabled:!ua.value,class:S(!!ie.value.length&&"select-type"),modelValue:ie.value,"onUpdate:modelValue":e[14]||(e[14]=o=>ie.value=o),onChange:El,"popper-class":"cascader-panel",options:xe.value.every(o=>o===0)?rt:ut},{default:s(({data:o})=>[l(a(V),null,{default:s(()=>[l(a(b),null,{default:s(()=>[(c(),y(O(a(X)[J(o.value)]),{class:S(["svg-icon",`field-icon-${a(G)[[2,3].includes(o.value)?2:0]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),m("span",null,p(o.label),1)]),_:1},8,["disabled","class","modelValue","options"]),m("span",bn,[l(a(V),null,{default:s(()=>[l(a(b),{className:`field-icon-${J(ie.value[0])}`},{default:s(()=>[(c(),y(O(a(X)[J(ie.value[0])]),{class:S(["svg-icon",`field-icon-${J(ie.value[0])}`])},null,8,["class"]))]),_:1},8,["className"])]),_:1})]),l(r,{class:"item",effect:"dark",placement:"top"},{content:s(()=>[m("div",null,p(a(d)("dataset.field_diff")),1)]),default:s(()=>[K(l(a(V),{size:"16px",style:{"margin-left":"6px"}},{default:s(()=>[l(a(b),{name:"icon_info_outlined"},{default:s(()=>[l(a(Eo),{class:"svg-icon tip-icon"})]),_:1})]),_:1},512),[[Ne,!ua.value]])]),_:1})]),pe.value.every(o=>o.groupType==="d")?(c(),y(i,{key:0,onClick:e[15]||(e[15]=o=>Mt("q")),plain:"",style:{"margin-left":"200px"}},{default:s(()=>[T(p(a(d)("data_set.convert_to_indicator")),1)]),_:1})):pe.value.every(o=>o.groupType==="q")?(c(),y(i,{key:1,onClick:e[16]||(e[16]=o=>Mt("d")),plain:"",style:{"margin-left":"200px"}},{default:s(()=>[T(p(a(d)("data_set.convert_to_dimension")),1)]),_:1})):A("",!0)])):A("",!0)],512),[[Ne,ye.value!=="preview"&&!!f.value.length]])],4)],4)],32),l(P,{title:a(d)("dataset.edit_union_relation"),modelValue:he.value,"onUpdate:modelValue":e[17]||(e[17]=o=>he.value=o),"modal-class":"union-dataset-drawer",size:"840px","before-close":Pt,direction:"rtl"},{footer:s(()=>[l(i,{secondary:"",onClick:Pt},{default:s(()=>[T(p(a(d)("dataset.cancel")),1)]),_:1}),l(i,{type:"primary",onClick:ol},{default:s(()=>[T(p(a(d)("dataset.confirm")),1)]),_:1})]),default:s(()=>[l(zo,{ref_key:"fieldUnion",ref:Be,editArr:B.editArr},null,8,["editArr"])]),_:1},8,["title","modelValue"])])),[[Ye,Ce.value]]),l(Wo,{onFinish:Ul,onOnDatasetSave:bl,ref_key:"creatDsFolder",ref:Nt},null,512),l(je,{"modal-class":"calc-field-edit-dialog",modelValue:ge.value,"onUpdate:modelValue":e[20]||(e[20]=o=>ge.value=o),width:"1000px",title:ft.value},{footer:s(()=>[l(i,{secondary:"",onClick:e[18]||(e[18]=o=>Wa())},{default:s(()=>[T(p(a(d)("dataset.cancel")),1)]),_:1}),l(i,{secondary:"",onClick:_l},{default:s(()=>[T(p(a(d)("datasource.validate")),1)]),_:1}),l(i,{type:"primary",onClick:e[19]||(e[19]=o=>Ja())},{default:s(()=>[T(p(a(d)("dataset.confirm")),1)]),_:1})]),default:s(()=>[l(Zo,{ref_key:"calcEdit",ref:j,crossDs:He.value},null,8,["crossDs"])]),_:1},8,["modelValue","title"]),l(je,{class:"create-dialog",title:a(d)("data_set.format_edit"),modelValue:se.value,"onUpdate:modelValue":e[24]||(e[24]=o=>se.value=o),width:"1000px"},{footer:s(()=>[l(i,{secondary:"",onClick:e[22]||(e[22]=o=>Ma())},{default:s(()=>[T(p(a(d)("dataset.cancel")),1)]),_:1}),l(i,{type:"primary",onClick:e[23]||(e[23]=o=>$a())},{default:s(()=>[T(p(a(d)("dataset.confirm")),1)]),_:1})]),default:s(()=>[l(Ve,{ref_key:"ruleFormRef",ref:It,rules:Sa,model:N.value,"label-width":"120px"},{default:s(()=>[l(M,{prop:"name",label:a(d)("data_set.custom_time_format")},{default:s(()=>[l(n,{modelValue:N.value.name,"onUpdate:modelValue":e[21]||(e[21]=o=>N.value.name=o)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),l(je,{class:"create-dialog",title:a(d)("datasource.field_rename"),modelValue:Je.value,"onUpdate:modelValue":e[28]||(e[28]=o=>Je.value=o),width:"420px"},{footer:s(()=>[l(i,{secondary:"",onClick:e[26]||(e[26]=o=>Bt())},{default:s(()=>[T(p(a(d)("dataset.cancel")),1)]),_:1}),l(i,{type:"primary",onClick:e[27]||(e[27]=o=>za())},{default:s(()=>[T(p(a(d)("dataset.confirm")),1)]),_:1})]),default:s(()=>[l(Ve,{ref_key:"ruleFormFieldRef",ref:Ut,rules:Ia,model:ne.value,"require-asterisk-position":"right","label-position":"top","label-width":"120px"},{default:s(()=>[l(M,{prop:"name",label:a(d)("dataset.field_name")},{default:s(()=>[l(n,{modelValue:ne.value.name,"onUpdate:modelValue":e[25]||(e[25]=o=>ne.value.name=o)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),l(je,{class:"create-dialog group-fields_dialog",title:wt.value,modelValue:we.value,"onUpdate:modelValue":e[32]||(e[32]=o=>we.value=o),width:"1000px"},{footer:s(()=>[l(i,{secondary:"",onClick:dl},{default:s(()=>[T(p(a(d)("dataset.cancel")),1)]),_:1}),l(i,{type:"primary",onClick:ml},{default:s(()=>[T(p(a(d)("dataset.confirm")),1)]),_:1})]),default:s(()=>[K((c(),y(Ve,{ref_key:"ruleGroupFieldRef",ref:Kt,rules:nl,model:x,"require-asterisk-position":"right","label-position":"top","label-width":"120px"},{default:s(()=>[l(Hl,{gutter:24},{default:s(()=>[l(va,{span:12},{default:s(()=>[l(M,{prop:"name",label:a(d)("dataset.field_name")},{default:s(()=>[l(n,{placeholder:a(d)("dataset.input_edit_name"),modelValue:x.name,"onUpdate:modelValue":e[29]||(e[29]=o=>x.name=o)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])]),_:1}),l(va,{span:12},{default:s(()=>[l(M,{prop:"originName",label:a(d)("dataset.grouping_field")},{default:s(()=>[l(at,{onChange:ea,modelValue:x.originName,"onUpdate:modelValue":e[30]||(e[30]=o=>x.originName=o),style:{width:"100%"}},{default:s(()=>[(c(!0),h(de,null,Ee(Qe.value,o=>(c(),y(tt,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),l(M,{style:{"margin-top":"16px"}},{label:s(()=>[m("div",Cn,p(a(d)("dataset.grouping_settings")),1)]),default:s(()=>[m("div",wn,[l(Ol,{"max-height":"393px"},{default:s(()=>[(c(!0),h(de,null,Ee(x.groupList,(o,_)=>(c(),h("div",{class:"group-fields_item",key:_},[(c(),y(Ve,{ref_for:!0,ref:C=>Ke.value[_]=C,model:o,inline:"",key:_,"label-width":"auto",class:"form-dynamic"},{default:s(()=>[(c(),y(M,{key:_+"name",prop:"name",rules:{required:!0,message:a(d)("chart.value_can_not_empty"),trigger:"blur"}},{default:s(()=>[l(n,{style:{width:"278px"},modelValue:o.name,"onUpdate:modelValue":C=>o.name=C,placeholder:a(d)("common.inputText")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["rules"])),[0,null].includes(x.deTypeOrigin)?(c(),y(M,{key:_+"text",prop:"text",style:{width:"100%","margin-left":"24px"},rules:{validator:Wt,required:!0,trigger:"change"}},{default:s(()=>[l(at,{style:{width:"100%"},multiple:"","collapse-tags":"",filterable:"","collapse-tags-tooltip":"","max-collapse-tags":2,modelValue:o.text,"onUpdate:modelValue":C=>o.text=C},{default:s(()=>[(c(!0),h(de,null,Ee(Qt.value,C=>(c(),y(tt,{key:C,label:C,disabled:ul(C,o.text),value:C},null,8,["label","disabled","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["rules"])):[2,3,4].includes(x.deTypeOrigin)?(c(),h("div",Tn,[(c(),y(M,{key:_+"min",prop:"min",rules:{required:!0,message:a(d)("chart.value_can_not_empty"),trigger:"blur"}},{default:s(()=>[l(_a,{placeholder:a(d)("dataset.please_enter_number"),modelValue:o.min,"onUpdate:modelValue":C=>o.min=C,"controls-position":"right"},null,8,["placeholder","modelValue","onUpdate:modelValue"])]),_:2},1032,["rules"])),(c(),y(M,{key:_+"minTerm"},{default:s(()=>[l(at,{modelValue:o.minTerm,"onUpdate:modelValue":C=>o.minTerm=C},{default:s(()=>[(c(),h(de,null,Ee(zt,C=>l(tt,{key:C.value,label:C.label,value:C.value},null,8,["label","value"])),64))]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1024)),m("div",xn,p(a(d)("dataset.field_value")),1),(c(),y(M,{key:_+"maxTerm"},{default:s(()=>[l(at,{modelValue:o.maxTerm,"onUpdate:modelValue":C=>o.maxTerm=C},{default:s(()=>[(c(),h(de,null,Ee(zt,C=>l(tt,{key:C.value,label:C.label,value:C.value},null,8,["label","value"])),64))]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1024)),(c(),y(M,{key:_+"max",prop:"max",rules:{required:!0,message:a(d)("chart.value_can_not_empty"),trigger:"blur"}},{default:s(()=>[l(_a,{placeholder:a(d)("dataset.please_enter_number"),modelValue:o.max,"onUpdate:modelValue":C=>o.max=C,"validate-even":!1,"controls-position":"right"},null,8,["placeholder","modelValue","onUpdate:modelValue"])]),_:2},1032,["rules"]))])):[1].includes(x.deTypeOrigin)?(c(),y(M,{key:_+"time",prop:"time",class:"group-fields_num",rules:{required:!0,validator:Wt,trigger:"change"}},{default:s(()=>[l(Rl,{"end-placeholder":a(d)("commons.date.end_date"),"start-placeholder":a(d)("commons.date.start_date"),modelValue:o.time,"onUpdate:modelValue":C=>o.time=C,type:"daterange"},null,8,["end-placeholder","start-placeholder","modelValue","onUpdate:modelValue"])]),_:2},1032,["rules"])):A("",!0)]),_:2},1032,["model"])),x.groupList.length!==1?(c(),y(i,{key:0,class:"variable_del",text:"",onClick:C=>vl(_)},{icon:s(()=>[l(a(b),null,{default:s(()=>[l(a(kt),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])):A("",!0)]))),128))]),_:1})])]),_:1}),l(i,{style:{"margin-top":"-20px"},onClick:fl,text:""},{icon:s(()=>[l(a(b),null,{default:s(()=>[l(a(ba),{class:"svg-icon"})]),_:1})]),default:s(()=>[T(" "+p(a(d)("auth.add_condition")),1)]),_:1}),e[33]||(e[33]=m("div",{class:"line"},null,-1)),m("div",Fn,[l(n,{placeholder:a(d)("common.inputText"),style:{width:"278px","margin-right":"24px"},modelValue:x.otherGroup,"onUpdate:modelValue":e[31]||(e[31]=o=>x.otherGroup=o)},null,8,["placeholder","modelValue"]),T(" "+p(a(d)("dataset.ungrouped_value")),1)])]),_:1},8,["model"])),[[Ye,Ct.value]])]),_:1},8,["title","modelValue"]),l(a(Vt),{jsname:"L2NvbXBvbmVudC9lbWJlZGRlZC1pZnJhbWUvTmV3V2luZG93SGFuZGxlcg==",onLoaded:ia,onLoadFail:ia}),l(a(Vt),{jsname:"L2NvbXBvbmVudC9wbHVnaW5zLWhhbmRsZXIvRHNDYXRlZ29yeUhhbmRsZXI=",onLoadDsPlugin:Ml}),B.dataSourceList?(c(),y(a(Vt),{key:0,ref_key:"datasetCheckRef",ref:Ht,"is-edit":Ae.value,"ds-list":B.dataSourceList,"ds-id":oe.value,onBack:Ue,jsname:"L2NvbXBvbmVudC9kYXRhc2V0L2luZGV4"},null,8,["is-edit","ds-list","ds-id"])):A("",!0)],64)}}});const Hd=as(Vn,[["__scopeId","data-v-587eaa66"]]);export{Hd as default};

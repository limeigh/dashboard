import{b as ve,c as fe,a as Te,z as be}from"./index-0.0.0-dataease.js";import{v as ye,o as we,aj as ke,D as Se,j as ge,y as Ce,G as xe,n as Fe}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{E as Ee}from"./el-tree-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import{E as Me,a as Pe}from"./el-select-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as Ae}from"./el-row-0.0.0-dataease.js";import{E as Ie}from"./el-divider-0.0.0-dataease.js";import{d as Ve,r as D,y as k,X as Ue,w as E,o as Ne,n as C,e as $,f as i,O as b,R as v,U as f,g as c,i as o,j as l,P as _,a4 as T,a3 as M,u,_ as x,W as y,a6 as P,S as Oe,T as Re}from"./vue-0.0.0-dataease.js";import{n as Le,a as We}from"./templateMarket-0.0.0-dataease.js";import{useAppStoreWithOut as ze}from"./app-0.0.0-dataease.js";import{e as Be}from"./antv-0.0.0-dataease.js";import De from"./MarketPreviewV2-0.0.0-dataease.js";import{i as j}from"./imgUtils-0.0.0-dataease.js";import J from"./CategoryTemplateV2-0.0.0-dataease.js";import $e from"./TemplateSkeleton-0.0.0-dataease.js";import{i as je}from"./interactive-0.0.0-dataease.js";import{g as Z}from"./dataset-0.0.0-dataease.js";import{_ as Je}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./token-0.0.0-dataease.js";import"./index-0.0.0-dataease15.js";import"./index-0.0.0-dataease4.js";import"./index-0.0.0-dataease3.js";import"./index-0.0.0-dataease6.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease5.js";import"./constants-0.0.0-dataease.js";import"./el-col-0.0.0-dataease.js";import"./el-main-0.0.0-dataease.js";import"./el-collapse-item-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import"./icon_left_outlined-0.0.0-dataease.js";import"./icon-filter-0.0.0-dataease.js";import"./TemplateMarketPreviewItem-0.0.0-dataease.js";import"./index-0.0.0-dataease16.js";import"./dvMain-0.0.0-dataease.js";import"./chart-0.0.0-dataease.js";import"./chart-0.0.0-dataease2.js";import"./decimal-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./index-0.0.0-dataease21.js";import"./index-0.0.0-dataease22.js";import"./pureFunctionsAny.generated-0.0.0-dataease.js";import"./extends-0.0.0-dataease.js";import"./tslib.es6-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./_commonjs-dynamic-modules-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./TemplateMarketV2Item-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease.js";import"./datasource-0.0.0-dataease.js";const Ze=["src"],qe={class:"template-left"},Ge=["title"],He={id:"template-show-area",class:"template-right",style:{"padding-top":"16px"}},Xe={style:{"text-align":"center"}},Ke=Ve({__name:"index",emits:["close"],setup(Qe,{expose:q,emit:G}){const{t:n}=we(),{wsCache:A}=ve(),S=fe(),R=ze(),H=je(),d=D("full"),X=G,L=()=>{X("close")},K=k(()=>e.curPosition==="branch"?n("work_branch.template_center"):n("work_branch.new_using_template")),Q=k(()=>R.getIsDataEaseBi||R.getIsIframe),e=Ue({initReady:!0,curPosition:"branch",pid:null,treeProps:{value:"label",label:"label"},templateType:"all",templateSourceType:"all",templateClassifyType:"all",treeShow:!0,templateClassifyOptions:[{value:"all",label:n("visualization.all_type")},{value:"app",label:n("visualization.apply_template")},{value:"template",label:n("visualization.style_template")}],templateSourceOptions:[{value:"all",label:n("work_branch.all_source")},{value:"market",label:n("visualization.template_market")},{value:"manage",label:n("template_manage.name")}],templateTypeOptions:[{value:"all",label:n("work_branch.all_types")},{value:"PANEL",label:n("work_branch.dashboard")},{value:"SCREEN",label:n("work_branch.big_data_screen")}],loading:!1,hasResult:!0,templateMiniWidth:250,templateCurWidth:310,templateSpan:"25%",previewVisible:!1,templatePreviewId:"",marketTabs:[],marketActiveTab:null,searchText:null,dvCreateForm:{resourceName:null,name:null,pid:null,nodeType:"panel",templateUrl:null,newFrom:"new_market_template",templateId:null,panelType:"self",panelStyle:{},panelData:"[]"},panelGroupList:[],curApplyTemplate:null,folderSelectShow:!1,baseUrl:"https://dataease.io/templates",currentMarketTemplateShowList:[],curTemplateShowFilter:[],curTemplateIndex:0,curTemplate:null,networkStatus:!0,rule:{name:[{required:!0,message:n("visualization.template_name_tips"),trigger:"blur"}],pid:[{required:!0,message:"",trigger:"blur"}]}}),I=k(()=>{var a,s,m,h;const t=H.getData;return{PANEL:((a=t[0])==null?void 0:a.menuAuth)&&((s=t[0])==null?void 0:s.anyManage),SCREEN:((m=t[1])==null?void 0:m.menuAuth)&&((h=t[1])==null?void 0:h.anyManage)}}),W=k(()=>{let t;return e.templateSourceType==="all"?t=e.marketTabs:t=e.marketTabs.filter(a=>a.source==="public"||a.source===e.templateSourceType),t}),Y=k(()=>e.curTemplate.thumbnail.indexOf("http")>-1||e.curTemplate.thumbnail.indexOf("static-resource")>-1?j(e.curTemplate.thumbnail):j(e.baseUrl+e.curTemplate.thumbnail)),ee=k(()=>e.curPosition==="branch"&&d.value!=="marketPreview"),te=t=>{e.initReady=!1,e.curPosition=t.curPosition,e.templateType=t.templateType,d.value="full",e.pid=t.pid,C(()=>{e.initReady=!0})};E(()=>e.searchText,()=>{w()}),E(()=>e.templateType,()=>{w()}),E(()=>e.templateSourceType,()=>{e.treeShow=!1,w(),C(()=>{e.treeShow=!0,V()})}),E(()=>e.templateClassifyType,()=>{e.treeShow=!1,w(),C(()=>{e.treeShow=!0,V()})});const ae=t=>{e.marketActiveTab=t.label,w()},le=()=>{d.value="full"},re=async()=>{await We().then(t=>{e.baseUrl=t.data.baseUrl,e.currentMarketTemplateShowList=t.data.contents,V(),w();const a=ke(e.currentMarketTemplateShowList);e.marketTabs=t.data.categories.filter(s=>a.has(s.label)),e.marketActiveTab=e.marketTabs[1].label}).catch(t=>{console.error("searchMarket:",t),e.networkStatus=!1})},V=()=>{C(()=>{const t=document.querySelector(".custom-market-tree"),a=document.createElement("hr");a.classList.add("custom-line"),t.firstElementChild.appendChild(a)})},oe=()=>{e.curTemplateIndex>0&&(e.curTemplateIndex--,e.curTemplate=e.curTemplateShowFilter[e.curTemplateIndex])},ne=()=>{e.curTemplateIndex<e.curTemplateShowFilter.length-1&&(e.curTemplateIndex++,e.curTemplate=e.curTemplateShowFilter[e.curTemplateIndex])},F=t=>{e.curApplyTemplate=t,e.dvCreateForm.name=t.title,e.dvCreateForm.nodeType=t.templateType,t.source==="market"?(e.dvCreateForm.newFrom="new_market_template",e.dvCreateForm.templateUrl=t.metas.theme_repo,e.dvCreateForm.resourceName=t.id):(e.dvCreateForm.newFrom="new_inner_template",e.dvCreateForm.templateId=t.id),se()},se=()=>{if(e.dvCreateForm.newFrom==="new_market_template"&&!e.dvCreateForm.templateUrl)return Se.warning(n("template_manage.get_download_link_hint")),!1;const t={newFrom:e.dvCreateForm.newFrom,templateUrl:e.dvCreateForm.templateUrl,resourceName:e.dvCreateForm.resourceName,templateId:e.dvCreateForm.templateId};e.curApplyTemplate.recentUseTime=Date.now(),e.curApplyTemplate.categoryNames.push(n("work_branch.recent"));const a=(["dataV","SCREEN"].includes(e.dvCreateForm.nodeType)?"#/dvCanvas?opt=create&createType=template":"#/dashboard?opt=create&createType=template")+"&templateParams="+encodeURIComponent(Z.encode(JSON.stringify(t)));let s=null;if(Q.value){S.clearState(),S.setCreateType("template"),S.setTemplateParams(encodeURIComponent(Z.encode(JSON.stringify(t)))),S.setOpt("create"),e.pid&&S.setPid(e.pid),Te().emitter.emit("changeCurrentComponent",["dataV","SCREEN"].includes(e.dvCreateForm.nodeType)?"VisualizationEditor":"DashboardEditor");return}const m=A.get("open-backend")==="1"?"_self":"_blank";e.pid?s=window.open(a+`&pid=${e.pid}`,m):s=window.open(a,m),ie(s)},g=D(null),ie=t=>{if(g!=null&&g.value){const a={methodName:"initOpenHandler",args:t};g.value.invokeMethod(a)}},w=()=>{let t=!1;e.currentMarketTemplateShowList.forEach(a=>{a.showFlag=pe(a),a.showFlag&&(t=!0)}),e.currentMarketTemplateShowList.length>0&&(e.hasResult=t)},pe=t=>{let a=!1,s=!1,m=!1,h=!1;return(!e.searchText||t.title.indexOf(e.searchText)>-1)&&(a=!0),(e.templateType==="all"||t.templateType===e.templateType)&&(s=!0),(e.templateSourceType==="all"||t.source===e.templateSourceType)&&(m=!0),(e.templateClassifyType==="all"||t.classify===e.templateClassifyType)&&(h=!0),a&&s&&m&&h},U=t=>{e.curPosition==="branch"?(e.templatePreviewId=t,d.value="marketPreview"):(e.curTemplateShowFilter=e.marketActiveTab===n("work_branch.recommend")?e.currentMarketTemplateShowList.filter(a=>a.showFlag):e.currentMarketTemplateShowList.filter(a=>{var s;return a.showFlag&&((s=a.categoryNames)==null?void 0:s.includes(e.marketActiveTab))}),e.curTemplateIndex=e.curTemplateShowFilter.findIndex(a=>a.id===t),e.curTemplate=e.curTemplateShowFilter[e.curTemplateIndex],d.value="createPreview")};Ne(()=>{me(),re();const t=Be(),a=document.getElementById("template-show-area");a&&t.listenTo(a,()=>{C(()=>{const s=a.offsetWidth-26,m=Math.trunc(s/e.templateMiniWidth);e.templateSpan=100/Math.trunc(s/e.templateMiniWidth)+"%",e.templateCurWidth=Math.trunc(s/m)-33})})});const me=()=>{const t=A.get("template-preview-id");t&&(U(t),A.delete("template-preview-id"))};return q({optInit:te}),(t,a)=>{const s=$("ArrowLeft"),m=ge,h=Ce,z=Ie,B=$("Close"),p=Ae,ue=xe,N=Pe,O=Me,ce=Ee,de=Fe,he=be;return i(),b(y,null,[v((i(),c(p,{class:Oe(["template-outer-body",{"template-outer-body-padding":ee.value}])},{default:o(()=>[v(l(De,{"preview-id":e.templatePreviewId,"create-auth":I.value,onClosePreview:le,onTemplateApply:F},null,8,["preview-id","create-auth"]),[[f,d.value==="marketPreview"]]),d.value==="createPreview"?(i(),c(p,{key:0,class:"main-container"},{default:o(()=>[l(p,{class:"market-head"},{default:o(()=>[l(m,{class:"custom-back-icon hover-icon",onClick:a[0]||(a[0]=r=>d.value="full")},{default:o(()=>[l(s)]),_:1}),_("span",null,T(e.curTemplate.title),1),l(p,{class:"head-right"},{default:o(()=>[l(h,{secondary:"",disabled:e.curTemplateIndex===0,style:{float:"right"},onClick:oe},{default:o(()=>[M(T(u(n)("work_branch.last")),1)]),_:1},8,["disabled"]),l(h,{disabled:e.curTemplateIndex===e.curTemplateShowFilter.length-1,style:{float:"right"},secondary:"",onClick:ne},{default:o(()=>[M(T(u(n)("work_branch.next")),1)]),_:1},8,["disabled"]),l(h,{style:{float:"right"},type:"primary",onClick:a[1]||(a[1]=r=>F(e.curTemplate))},{default:o(()=>[M(T(u(n)("visualization.apply_this_template")),1)]),_:1}),l(z,{class:"custom-divider-line",direction:"vertical"}),l(m,{class:"custom-market-icon hover-icon_custom",onClick:L},{default:o(()=>[l(B)]),_:1})]),_:1})]),_:1}),l(p,{class:"template-area"},{default:o(()=>[l(p,{class:"img-main-create"},{default:o(()=>[_("img",{style:{height:"100%"},src:Y.value,alt:""},null,8,Ze)]),_:1})]),_:1})]),_:1})):x("",!0),v(l(p,{class:"main-container"},{default:o(()=>[l(p,{class:"market-head"},{default:o(()=>[_("span",null,T(K.value),1),l(p,{class:"head-right"},{default:o(()=>[l(ue,{class:"title-search",modelValue:e.searchText,"onUpdate:modelValue":a[2]||(a[2]=r=>e.searchText=r),"prefix-icon":"Search",placeholder:u(n)("visualization.enter_template_name_tips"),clearable:!0},null,8,["modelValue","placeholder"]),l(O,{class:"title-type",modelValue:e.templateSourceType,"onUpdate:modelValue":a[3]||(a[3]=r=>e.templateSourceType=r),placeholder:"Select"},{default:o(()=>[(i(!0),b(y,null,P(e.templateSourceOptions,r=>(i(),c(N,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),["branchCreate","branch"].includes(e.curPosition)?(i(),c(O,{key:0,class:"title-type",modelValue:e.templateType,"onUpdate:modelValue":a[4]||(a[4]=r=>e.templateType=r),placeholder:"Select"},{default:o(()=>[(i(!0),b(y,null,P(e.templateTypeOptions,r=>(i(),c(N,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):x("",!0),l(O,{class:"title-type",modelValue:e.templateClassifyType,"onUpdate:modelValue":a[5]||(a[5]=r=>e.templateClassifyType=r),placeholder:"Select"},{default:o(()=>[(i(!0),b(y,null,P(e.templateClassifyOptions,r=>(i(),c(N,{key:r.value,label:r.label,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),["branchCreate","create"].includes(e.curPosition)?(i(),b(y,{key:1},[l(z,{class:"custom-divider-line",direction:"vertical"}),l(m,{class:"custom-market-icon hover-icon_custom",onClick:L},{default:o(()=>[l(B)]),_:1})],64)):x("",!0)]),_:1})]),_:1}),l(p,{class:"template-area"},{default:o(()=>[_("div",qe,[e.treeShow?(i(),c(ce,{key:0,menu:"",class:"custom-market-tree",modelValue:e.marketActiveTab,"onUpdate:modelValue":a[6]||(a[6]=r=>e.marketActiveTab=r),data:W.value,props:e.treeProps,"node-key":"label","default-expand-all":"","highlight-current":"","current-node-key":e.marketActiveTab,onNodeClick:ae},{default:o(({data:r})=>[_("span",{title:r.label,class:"ed-tree-node__label"},T(r.label),9,Ge)]),_:1},8,["modelValue","data","props","current-node-key"])):x("",!0)]),v(_("div",He,[e.marketActiveTab===null?(i(),c(p,{key:0},{default:o(()=>[l($e,{width:e.templateCurWidth},null,8,["width"])]),_:1})):(i(),b(y,{key:1},[v(l(p,null,{default:o(()=>[l(J,{"search-text":e.searchText,label:e.marketActiveTab,"full-template-show-list":e.currentMarketTemplateShowList,"template-span":e.templateSpan,"base-url":e.baseUrl,"template-cur-width":e.templateCurWidth,"cur-position":e.curPosition,"create-auth":I.value,onTemplateApply:F,onTemplatePreview:U},null,8,["search-text","label","full-template-show-list","template-span","base-url","template-cur-width","cur-position","create-auth"])]),_:1},512),[[f,e.marketActiveTab!==u(n)("work_branch.recommend")]]),v(l(p,null,{default:o(()=>[(i(!0),b(y,null,P(W.value,(r,_e)=>(i(),c(p,{style:Re([{display:"inline",width:"100%","margin-bottom":"32px"},{marginBottom:r.label!==u(n)("work_branch.recent")?"32px":0}]),key:_e},{default:o(()=>[r.label!==u(n)("work_branch.recent")?(i(),c(J,{key:0,"search-text":e.searchText,label:r.label,"full-template-show-list":e.currentMarketTemplateShowList,"template-span":e.templateSpan,"base-url":e.baseUrl,"template-cur-width":e.templateCurWidth,"cur-position":e.curPosition,"create-auth":I.value,onTemplateApply:F,onTemplatePreview:U},null,8,["search-text","label","full-template-show-list","template-span","base-url","template-cur-width","cur-position","create-auth"])):x("",!0)]),_:2},1032,["style"]))),128))]),_:1},512),[[f,e.marketActiveTab===u(n)("work_branch.recommend")]])],64))],512),[[f,e.networkStatus&&e.hasResult]]),v(l(p,{class:"template-empty"},{default:o(()=>[_("div",Xe,[l(de,{name:"no_result"},{default:o(()=>[l(u(Le),{style:{"margin-bottom":"16px","font-size":"75px"},class:"svg-icon"})]),_:1}),a[7]||(a[7]=_("br",null,null,-1)),_("span",null,T(u(n)("work_branch.relevant_templates_found")),1)])]),_:1},512),[[f,e.networkStatus&&!e.hasResult]]),v(l(p,{class:"template-empty"},{default:o(()=>[M(" 111 "+T(u(n)("visualization.market_network_tips",[e.baseUrl])),1)]),_:1},512),[[f,!e.networkStatus]])]),_:1})]),_:1},512),[[f,d.value==="full"]])]),_:1},8,["class"])),[[he,e.loading],[f,e.initReady]]),l(u(ye),{ref_key:"openHandler",ref:g,jsname:"L2NvbXBvbmVudC9lbWJlZGRlZC1pZnJhbWUvT3BlbkhhbmRsZXI="},null,512)],64)}}});const oa=Je(Ke,[["__scopeId","data-v-13e0979c"]]);export{oa as default};

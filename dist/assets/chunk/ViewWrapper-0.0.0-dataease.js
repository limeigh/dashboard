import{o as W,k as F,p as T}from"./DePreview-0.0.0-dataease.js";import{i as N,o as j}from"./canvasUtils-0.0.0-dataease.js";import{i as M}from"./interactive-0.0.0-dataease.js";import{b as R,c as D}from"./index-0.0.0-dataease.js";import{a as Z}from"./CrossPermission-0.0.0-dataease.js";import{o as J,x as X,D as q,v as G}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as L}from"./dvMain-0.0.0-dataease.js";import{E as U}from"./EmptyBackground-0.0.0-dataease.js";import{d as z,x as A,r as f,X as H,aj as $,n as K,f as _,O as k,j as g,_ as y,g as Q,u as Y,W as tt}from"./vue-0.0.0-dataease.js";import{_ as rt}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./style-0.0.0-dataease.js";import"./translate-0.0.0-dataease.js";import"./pureFunctionsAny.generated-0.0.0-dataease.js";import"./extends-0.0.0-dataease.js";import"./decimal-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./imgUtils-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./util-0.0.0-dataease.js";import"./index-0.0.0-dataease21.js";import"./chart-0.0.0-dataease.js";import"./chart-0.0.0-dataease2.js";import"./dataset-0.0.0-dataease.js";import"./app-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./antv-0.0.0-dataease.js";import"./index-0.0.0-dataease22.js";import"./tslib.es6-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./el-col-0.0.0-dataease.js";import"./constants-0.0.0-dataease.js";import"./el-row-0.0.0-dataease.js";import"./_commonjs-dynamic-modules-0.0.0-dataease.js";import"./eventBus-0.0.0-dataease.js";import"./Component-0.0.0-dataease18.js";import"./DeShortcutKey-0.0.0-dataease.js";import"./snapshot-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./canvasStyle-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";import"./ModelUtil-0.0.0-dataease.js";import"./Component-0.0.0-dataease17.js";import"./el-tooltip-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import"./icon_edit_outlined-0.0.0-dataease.js";import"./icon_delete-trash_outlined-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import"./el-form-item-0.0.0-dataease.js";import"./index-0.0.0-dataease4.js";import"./index-0.0.0-dataease3.js";import"./el-dialog-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./el-popover-0.0.0-dataease.js";import"./dropdown-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import"./index-0.0.0-dataease6.js";import"./token-0.0.0-dataease.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease5.js";import"./el-tree-0.0.0-dataease.js";import"./index-0.0.0-dataease15.js";import"./el-checkbox-0.0.0-dataease.js";import"./el-tree-select-0.0.0-dataease.js";import"./el-checkbox-group-0.0.0-dataease.js";import"./el-tabs-0.0.0-dataease.js";import"./el-radio-group-0.0.0-dataease.js";import"./el-radio-0.0.0-dataease.js";import"./HandleMore.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import"./el-dropdown-menu-0.0.0-dataease.js";import"./el-dropdown-item-0.0.0-dataease.js";import"./icon_more_outlined-0.0.0-dataease.js";import"./more_v-0.0.0-dataease.js";import"./icon_add_outlined-0.0.0-dataease.js";import"./icon_drag_outlined-0.0.0-dataease.js";import"./icon_visible_outlined-0.0.0-dataease.js";import"./dv-folder-0.0.0-dataease.js";import"./icon_dataset-0.0.0-dataease.js";import"./icon_warning_filled-0.0.0-dataease.js";import"./icon_info_outlined-0.0.0-dataease.js";import"./vuedraggable-es-0.0.0-dataease.js";import"./time-format-0.0.0-dataease.js";import"./dayjs.min-0.0.0-dataease.js";import"./time-format-dayjs-0.0.0-dataease.js";import"./attr-0.0.0-dataease23.js";import"./el-time-picker-0.0.0-dataease.js";import"./el-date-picker-0.0.0-dataease.js";import"./arrays-0.0.0-dataease.js";import"./index-0.0.0-dataease18.js";import"./el-input-number-0.0.0-dataease.js";import"./icon_admin_outlined-0.0.0-dataease.js";import"./index-0.0.0-dataease27.js";import"./index-0.0.0-dataease20.js";import"./index-0.0.0-dataease28.js";import"./index-0.0.0-dataease29.js";import"./use-route-0.0.0-dataease.js";import"./index-0.0.0-dataease30.js";import"./index-0.0.0-dataease31.js";import"./index-0.0.0-dataease32.js";import"./index-0.0.0-dataease33.js";import"./el-virtual-list-0.0.0-dataease.js";import"./raf-0.0.0-dataease.js";import"./el-select-v2-0.0.0-dataease.js";import"./fixed-size-list-0.0.0-dataease.js";import"./chart-list-0.0.0-dataease.js";import"./field-list-0.0.0-dataease.js";import"./treeSortUtils-0.0.0-dataease.js";import"./Attr-0.0.0-dataease22.js";import"./CommonAttr-0.0.0-dataease.js";import"./el-collapse-item-0.0.0-dataease.js";import"./CommonBorderSetting.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./el-color-picker-0.0.0-dataease.js";import"./position-0.0.0-dataease.js";import"./BackgroundOverallCommon-0.0.0-dataease.js";import"./el-upload-0.0.0-dataease.js";import"./el-progress-0.0.0-dataease.js";import"./board-list-0.0.0-dataease.js";import"./ImgViewDialog-0.0.0-dataease.js";import"./el-space-0.0.0-dataease.js";import"./icon_italic_outlined-0.0.0-dataease.js";import"./icon_right-alignment_outlined-0.0.0-dataease.js";import"./CarouselSetting.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./CollapseSwitchItem-0.0.0-dataease.js";import"./el-switch-0.0.0-dataease.js";import"./icon_replace_outlined-0.0.0-dataease.js";import"./icon_download_outlined-0.0.0-dataease.js";import"./Component.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./watermark-0.0.0-dataease2.js";import"./user-0.0.0-dataease.js";import"./el-divider-0.0.0-dataease.js";import"./ChartComponentS2-0.0.0-dataease.js";import"./ViewTrackBar-0.0.0-dataease.js";import"./el-pagination-0.0.0-dataease.js";import"./ChartError-0.0.0-dataease.js";import"./el-main-0.0.0-dataease.js";import"./index-0.0.0-dataease16.js";import"./LinkageSet-0.0.0-dataease.js";import"./el-footer-0.0.0-dataease.js";import"./el-aside-0.0.0-dataease.js";import"./dv-link-target-0.0.0-dataease.js";import"./dv-dashboard-spine-0.0.0-dataease.js";import"./dv-screen-spine-0.0.0-dataease.js";import"./CodeMirror-0.0.0-dataease.js";import"./dv-empty-0.0.0-dataease.js";import"./Attr.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import"./Component-0.0.0-dataease16.js";import"./index-0.0.0-dataease34.js";import"./ChartComponentG2Plot-0.0.0-dataease.js";import"./PluginComponent.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./DrillPath-0.0.0-dataease.js";import"./DeRichTextView-0.0.0-dataease.js";import"./Component-0.0.0-dataease12.js";import"./ChartEmptyInfo-0.0.0-dataease.js";import"./chart-dark-list-0.0.0-dataease.js";import"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./Component-0.0.0-dataease13.js";import"./Attr-0.0.0-dataease16.js";import"./Component-0.0.0-dataease10.js";import"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease2.js";import"./Component-0.0.0-dataease5.js";import"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease3.js";import"./Attr-0.0.0-dataease.js";import"./Component-0.0.0-dataease3.js";import"./Attr.vue_vue_type_style_index_0_lang-0.0.0-dataease2.js";import"./Attr-0.0.0-dataease9.js";import"./Component-0.0.0-dataease6.js";import"./Attr-0.0.0-dataease6.js";import"./Component-0.0.0-dataease4.js";import"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease4.js";import"./Component-0.0.0-dataease14.js";import"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease5.js";import"./Component.vue_vue_type_script_setup_true_lang-0.0.0-dataease2.js";import"./Attr-0.0.0-dataease10.js";import"./Component-0.0.0-dataease11.js";import"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease6.js";import"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease7.js";import"./Attr-0.0.0-dataease7.js";import"./Component-0.0.0-dataease9.js";import"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease8.js";import"./Component-0.0.0-dataease7.js";import"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease9.js";import"./Component-0.0.0-dataease15.js";import"./Attr-0.0.0-dataease19.js";import"./Attr.vue_vue_type_script_setup_true_lang-0.0.0-dataease10.js";import"./Attr-0.0.0-dataease15.js";import"./DatasetSelect-0.0.0-dataease.js";import"./icon_done_outlined-0.0.0-dataease.js";import"./Threshold-0.0.0-dataease.js";import"./TableThresholdEdit-0.0.0-dataease.js";import"./icon_info_filled-0.0.0-dataease.js";import"./TextLabelThresholdEdit-0.0.0-dataease.js";import"./TextThresholdEdit-0.0.0-dataease.js";import"./LineThresholdEdit-0.0.0-dataease.js";import"./PictureGroupThresholdEdit-0.0.0-dataease.js";import"./Component-0.0.0-dataease2.js";import"./icon_left_outlined-0.0.0-dataease.js";import"./datasource-0.0.0-dataease.js";import"./el-empty-0.0.0-dataease.js";import"./none-0.0.0-dataease.js";import"./nothing-tree-0.0.0-dataease.js";const ot={key:0,class:"de-view-wrapper"},it=z({__name:"ViewWrapper",setup(et){const{wsCache:P}=R(),b=M(),s=D(),d=A("embeddedParams"),a=f(),v=f(),w=f(),u=L(),{t:S}=J(),c=f(null),t=H({canvasDataPreview:null,canvasStylePreview:null,canvasViewInfoPreview:null,dvInfo:null,dvId:null,suffixId:"common",initState:!0}),o=d!=null&&d.chartId?d:s,V=e=>{const r=e.data;if(r&&r.type==="attachParams"&&r.targetSourceId===t.dvId+""&&(!r.suffixId||r.suffixId===t.suffixId)){const m=r.params;t.initState=!1,u.addOuterParamsFilter(m,t.canvasDataPreview,"outer"),t.initState=!0}},x=async e=>{if(!window.DataEaseBi||!e)return!0;const r={busiFlag:o.busiFlag,resourceTable:"core"};await b.setInteractive(r);const m=o.busiFlag==="dataV"?"screen-weight":"panel-weight";return Z(P.get(m),e,1)};$(async()=>{if(!await x(o.dvId))return;t.dvId=o.dvId,t.suffixId=o.suffixId||"common",window.addEventListener("message",V);let r=null;if(s.getToken&&!Object.keys(r=s.getTokenInfo).length){const i=await X.get({url:"/embedded/getTokenArgs"});s.setTokenInfo(i.data),r=s.getTokenInfo}let m;if(await W(o.dvId).then(i=>{u.setNowPanelOuterParamsInfoV2(i.data,o.dvId)}),o.outerParams)try{const i=JSON.parse(o.outerParams);m=i.attachParams,u.setEmbeddedCallBack(i.callBackFlag||"no")}catch(i){console.error(i),q.error(S("visualization.outer_param_decode_error"));return}r&&Object.keys(r).length&&(m=Object.assign({},m,r));const p=o==null?void 0:o.chartId;N(o.dvId,{busiFlag:o.busiFlag},function({canvasDataResult:i,canvasStyleResult:C,dvInfo:B,canvasViewInfoPreview:I}){t.canvasDataPreview=i,t.canvasStylePreview=C,t.canvasViewInfoPreview=I,t.dvInfo=B,t.initState=!1,u.addOuterParamsFilter(m,i),t.initState=!0,v.value=I[p],(i||[]).some(n=>n.id===p?(a.value=n,!0):n.component==="Group"?(n.propValue||[]).some(l=>l.id===p?(a.value=l,!0):!1):(n.component==="DeTabs"&&n.propValue.forEach(l=>(l.componentData||[]).some(h=>h.id===p?(a.value=h,!0):!1)),!1)),K(()=>{j({resourceId:p})})})});const O=e=>{w.value.dialogInit(t.canvasStylePreview,v.value,a.value,e)},E=e=>{try{if(console.info("de_inner_params send"),window["dataease-embedded-host"]&&(c!=null&&c.value)){const r={methodName:"embeddedInteractive",args:{eventName:"de_inner_params",args:e}};c.value.invokeMethod(r)}else{console.info("de_inner_params send to host");const r={type:"dataease-embedded-interactive",eventName:"de_inner_params",args:e};window.parent.postMessage(r,"*")}}catch{console.warn("de_inner_params send error")}};return(e,r)=>{const m=F,p=T;return _(),k(tt,null,[a.value&&t.initState?(_(),k("div",ot,[g(m,{style:{width:"100%",height:"100%"},"view-info":v.value,config:a.value,"canvas-style-data":t.canvasStylePreview,"dv-info":t.dvInfo,"canvas-view-info":t.canvasViewInfoPreview,onUserViewEnlargeOpen:O,onOnPointClick:E,"suffix-id":t.suffixId},null,8,["view-info","config","canvas-style-data","dv-info","canvas-view-info","suffix-id"]),g(p,{ref_key:"userViewEnlargeRef",ref:w},null,512)])):y("",!0),t.initState?y("",!0):(_(),Q(U,{key:1,description:"参数不能为空","img-type":"noneWhite"})),g(Y(G),{ref_key:"openHandler",ref:c,jsname:"L2NvbXBvbmVudC9lbWJlZGRlZC1pZnJhbWUvT3BlbkhhbmRsZXI="},null,512)],64)}}});const $i=rt(it,[["__scopeId","data-v-1e113828"]]);export{$i as default};

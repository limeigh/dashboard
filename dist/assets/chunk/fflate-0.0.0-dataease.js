var D=Uint8Array,k=Uint16Array,lr=Int32Array,ur=new D([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),hr=new D([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ir=new D([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Fr=function(r,a){for(var v=new k(31),n=0;n<31;++n)v[n]=a+=1<<r[n-1];for(var e=new lr(v[30]),n=1;n<30;++n)for(var f=v[n];f<v[n+1];++f)e[f]=f-v[n]<<5|n;return{b:v,r:e}},xr=Fr(ur,2),Ur=xr.b,vr=xr.r;Ur[28]=258,vr[258]=28;var br=Fr(hr,0),gr=br.r,er=new k(32768);for(var t=0;t<32768;++t){var O=(t&43690)>>1|(t&21845)<<1;O=(O&52428)>>2|(O&13107)<<2,O=(O&61680)>>4|(O&3855)<<4,er[t]=((O&65280)>>8|(O&255)<<8)>>1}var j=function(r,a,v){for(var n=r.length,e=0,f=new k(a);e<n;++e)r[e]&&++f[r[e]-1];var u=new k(a);for(e=1;e<a;++e)u[e]=u[e-1]+f[e-1]<<1;var w;if(v){w=new k(1<<a);var c=15-a;for(e=0;e<n;++e)if(r[e])for(var g=e<<4|r[e],l=a-r[e],F=u[r[e]-1]++<<l,T=F|(1<<l)-1;F<=T;++F)w[er[F]>>c]=g}else for(w=new k(n),e=0;e<n;++e)r[e]&&(w[e]=er[u[r[e]-1]++]>>15-r[e]);return w},R=new D(288);for(var t=0;t<144;++t)R[t]=8;for(var t=144;t<256;++t)R[t]=9;for(var t=256;t<280;++t)R[t]=7;for(var t=280;t<288;++t)R[t]=8;var m=new D(32);for(var t=0;t<32;++t)m[t]=5;var qr=j(R,9,0),sr=j(m,5,0),Ar=function(r){return(r+7)/8|0},Ir=function(r,a,v){return(a==null||a<0)&&(a=0),(v==null||v>r.length)&&(v=r.length),new D(r.subarray(a,v))},K=function(r,a,v){v<<=a&7;var n=a/8|0;r[n]|=v,r[n+1]|=v>>8},$=function(r,a,v){v<<=a&7;var n=a/8|0;r[n]|=v,r[n+1]|=v>>8,r[n+2]|=v>>16},nr=function(r,a){for(var v=[],n=0;n<r.length;++n)r[n]&&v.push({s:n,f:r[n]});var e=v.length,f=v.slice();if(!e)return{t:Cr,l:0};if(e==1){var u=new D(v[0].s+1);return u[v[0].s]=1,{t:u,l:1}}v.sort(function(S,q){return S.f-q.f}),v.push({s:-1,f:25001});var w=v[0],c=v[1],g=0,l=1,F=2;for(v[0]={s:-1,f:w.f+c.f,l:w,r:c};l!=e-1;)w=v[v[g].f<v[F].f?g++:F++],c=v[g!=l&&v[g].f<v[F].f?g++:F++],v[l++]={s:-1,f:w.f+c.f,l:w,r:c};for(var T=f[0].s,n=1;n<e;++n)f[n].s>T&&(T=f[n].s);var x=new k(T+1),U=fr(v[l-1],x,0);if(U>a){var n=0,M=0,L=U-a,P=1<<L;for(f.sort(function(q,A){return x[A.s]-x[q.s]||q.f-A.f});n<e;++n){var J=f[n].s;if(x[J]>a)M+=P-(1<<U-x[J]),x[J]=a;else break}for(M>>=L;M>0;){var Q=f[n].s;x[Q]<a?M-=1<<a-x[Q]++-1:++n}for(;n>=0&&M;--n){var b=f[n].s;x[b]==a&&(--x[b],++M)}U=a}return{t:new D(x),l:U}},fr=function(r,a,v){return r.s==-1?Math.max(fr(r.l,a,v+1),fr(r.r,a,v+1)):a[r.s]=v},Mr=function(r){for(var a=r.length;a&&!r[--a];);for(var v=new k(++a),n=0,e=r[0],f=1,u=function(c){v[n++]=c},w=1;w<=a;++w)if(r[w]==e&&w!=a)++f;else{if(!e&&f>2){for(;f>138;f-=138)u(32754);f>2&&(u(f>10?f-11<<5|28690:f-3<<5|12305),f=0)}else if(f>3){for(u(e),--f;f>6;f-=6)u(8304);f>2&&(u(f-3<<5|8208),f=0)}for(;f--;)u(e);f=1,e=r[w]}return{c:v.subarray(0,n),n:a}},_=function(r,a){for(var v=0,n=0;n<a.length;++n)v+=r[n]*a[n];return v},zr=function(r,a,v){var n=v.length,e=Ar(a+2);r[e]=n&255,r[e+1]=n>>8,r[e+2]=r[e]^255,r[e+3]=r[e+1]^255;for(var f=0;f<n;++f)r[e+f+4]=v[f];return(e+4+n)*8},yr=function(r,a,v,n,e,f,u,w,c,g,l){K(a,l++,v),++e[256];for(var F=nr(e,15),T=F.t,x=F.l,U=nr(f,15),M=U.t,L=U.l,P=Mr(T),J=P.c,Q=P.n,b=Mr(M),S=b.c,q=b.n,A=new k(19),o=0;o<J.length;++o)++A[J[o]&31];for(var o=0;o<S.length;++o)++A[S[o]&31];for(var h=nr(A,7),z=h.t,V=h.l,C=19;C>4&&!z[ir[C-1]];--C);var W=g+5<<3,s=_(e,R)+_(f,m)+u,I=_(e,T)+_(f,M)+u+14+3*C+_(A,z)+2*A[16]+3*A[17]+7*A[18];if(c>=0&&W<=s&&W<=I)return zr(a,l,r.subarray(c,c+g));var E,i,B,N;if(K(a,l,1+(I<s)),l+=2,I<s){E=j(T,x,0),i=T,B=j(M,L,0),N=M;var p=j(z,V,0);K(a,l,Q-257),K(a,l+5,q-1),K(a,l+10,C-4),l+=14;for(var o=0;o<C;++o)K(a,l+3*o,z[ir[o]]);l+=3*C;for(var G=[J,S],Z=0;Z<2;++Z)for(var X=G[Z],o=0;o<X.length;++o){var H=X[o]&31;K(a,l,p[H]),l+=z[H],H>15&&(K(a,l,X[o]>>5&127),l+=X[o]>>12)}}else E=qr,i=R,B=sr,N=m;for(var o=0;o<w;++o){var y=n[o];if(y>255){var H=y>>18&31;$(a,l,E[H+257]),l+=i[H+257],H>7&&(K(a,l,y>>23&31),l+=ur[H]);var Y=y&31;$(a,l,B[Y]),l+=N[Y],Y>3&&($(a,l,y>>5&8191),l+=hr[Y])}else $(a,l,E[y]),l+=i[y]}return $(a,l,E[256]),l+i[256]},Br=new lr([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Cr=new D(0),Dr=function(r,a,v,n,e,f){var u=f.z||r.length,w=new D(n+u+5*(1+Math.ceil(u/7e3))+e),c=w.subarray(n,w.length-e),g=f.l,l=(f.r||0)&7;if(a){l&&(c[0]=f.r>>3);for(var F=Br[a-1],T=F>>13,x=F&8191,U=(1<<v)-1,M=f.p||new k(32768),L=f.h||new k(U+1),P=Math.ceil(v/3),J=2*P,Q=function(ar){return(r[ar]^r[ar+1]<<P^r[ar+2]<<J)&U},b=new lr(25e3),S=new k(288),q=new k(32),A=0,o=0,h=f.i||0,z=0,V=f.w||0,C=0;h+2<u;++h){var W=Q(h),s=h&32767,I=L[W];if(M[s]=I,L[W]=s,V<=h){var E=u-h;if((A>7e3||z>24576)&&(E>423||!g)){l=yr(r,c,0,b,S,q,o,z,C,h-C,l),z=A=o=0,C=h;for(var i=0;i<286;++i)S[i]=0;for(var i=0;i<30;++i)q[i]=0}var B=2,N=0,p=x,G=s-I&32767;if(E>2&&W==Q(h-G))for(var Z=Math.min(T,E)-1,X=Math.min(32767,h),H=Math.min(258,E);G<=X&&--p&&s!=I;){if(r[h+B]==r[h+B-G]){for(var y=0;y<H&&r[h+y]==r[h+y-G];++y);if(y>B){if(B=y,N=G,y>Z)break;for(var Y=Math.min(G,y-2),or=0,i=0;i<Y;++i){var d=h-G+i&32767,Sr=M[d],wr=d-Sr&32767;wr>or&&(or=wr,I=d)}}}s=I,I=M[s],G+=s-I&32767}if(N){b[z++]=268435456|vr[B]<<18|gr[N];var tr=vr[B]&31,cr=gr[N]&31;o+=ur[tr]+hr[cr],++S[257+tr],++q[cr],V=h+B,++A}else b[z++]=r[h],++S[r[h]]}}for(h=Math.max(h,V);h<u;++h)b[z++]=r[h],++S[r[h]];l=yr(r,c,g,b,S,q,o,z,C,h-C,l),g||(f.r=l&7|c[l/8|0]<<3,l-=7,f.h=L,f.p=M,f.i=h,f.w=V)}else{for(var h=f.w||0;h<u+g;h+=65535){var rr=h+65535;rr>=u&&(c[l/8|0]=g,rr=u),l=zr(c,l+1,r.subarray(h,rr))}f.i=u}return Ir(w,0,n+Ar(l)+e)},kr=function(){var r=1,a=0;return{p:function(v){for(var n=r,e=a,f=v.length|0,u=0;u!=f;){for(var w=Math.min(u+2655,f);u<w;++u)e+=n+=v[u];n=(n&65535)+15*(n>>16),e=(e&65535)+15*(e>>16)}r=n,a=e},d:function(){return r%=65521,a%=65521,(r&255)<<24|(r&65280)<<8|(a&255)<<8|a>>8}}},Er=function(r,a,v,n,e){if(!e&&(e={l:1},a.dictionary)){var f=a.dictionary.subarray(-32768),u=new D(f.length+r.length);u.set(f),u.set(r,f.length),r=u,e.w=f.length}return Dr(r,a.level==null?6:a.level,a.mem==null?e.l?Math.ceil(Math.max(8,Math.min(13,Math.log(r.length)))*1.5):20:12+a.mem,v,n,e)},Tr=function(r,a,v){for(;v;++a)r[a]=v,v>>>=8},Gr=function(r,a){var v=a.level,n=v==0?0:v<6?1:v==9?3:2;if(r[0]=120,r[1]=n<<6|(a.dictionary&&32),r[1]|=31-(r[0]<<8|r[1])%31,a.dictionary){var e=kr();e.p(a.dictionary),Tr(r,2,e.d())}};function Kr(r,a){a||(a={});var v=kr();v.p(r);var n=Er(r,a,a.dictionary?6:2,4);return Gr(n,a),Tr(n,n.length-4,v.d()),n}var Hr=typeof TextDecoder<"u"&&new TextDecoder,Jr=0;try{Hr.decode(Cr,{stream:!0}),Jr=1}catch{}export{Kr as z};

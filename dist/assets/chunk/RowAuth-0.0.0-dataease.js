import{f as q}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import H from"./AuthTree-0.0.0-dataease.js";import{d as J,r as M,k as I,o as V,c as k,W as K,a as S}from"./@vue-0.0.0-dataease.js";import{_ as Q}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./element-plus-secondary-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./lodash-es-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./pinia-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./index-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./fast-png-0.0.0-dataease.js";import"./iobuffer-0.0.0-dataease.js";import"./pako-0.0.0-dataease.js";import"./vue-router_2-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./FilterFiled-0.0.0-dataease.js";import"./icon_search-outline_outlined-0.0.0-dataease.js";import"./icon_close_outlined-0.0.0-dataease.js";import"./icon_delete-trash_outlined-0.0.0-dataease.js";import"./TimeDialog-0.0.0-dataease.js";import"./time-format-0.0.0-dataease.js";import"./dataset-0.0.0-dataease.js";import"./js-base64-0.0.0-dataease.js";import"./options-0.0.0-dataease.js";import"./field-list-0.0.0-dataease.js";import"./icon_down_outlined-0.0.0-dataease.js";const Z={class:"rowAuth"},j={width:"388",height:"100%",class:"real-line"},tt=["d"],et={width:"388",height:"100%",class:"dash-line"},it=["d"],lt=J({__name:"RowAuth",emits:["save"],setup(rt,{expose:B,emit:N}){const{t:f}=q(),d=M(""),$=M("or"),c=M([]),Y=I(()=>{const i=c.value.length;let t={x:0,y:0,child:c.value};return t.y=Math.floor(L(t,0)/2),i?x(t):""}),b=I(()=>{const i=c.value.length;let t={x:0,y:0,child:c.value};return t.y=Math.floor(L(t,0)/2),i?w(t):"M48 20 L68 20"}),O=i=>{const{items:t}=i;$.value=i.logic||"or",c.value=A(t||[])},P=()=>{d.value="",X("save",{logic:$.value,items:D(c.value),errorMessage:d.value})},z=({enumValue:i,deType:t,filterType:e,term:l,value:o,name:r,timeValue:a,filterTypeTime:n})=>{if(!r){d.value=f("data_set.cannot_be_empty_");return}if(e==="logic"){if(!l){d.value=f("data_set.cannot_be_empty_de_ruler");return}if(!l.includes("null")&&!l.includes("empty")&&["",null,void 0].includes(o)&&t!==1){d.value=f("chart.filter_value_can_null");return}if(!l.includes("null")&&!l.includes("empty")&&["",null,void 0].includes(a)&&t===1&&n==="dynamicDate"){d.value=f("chart.filter_value_can_null");return}if([2,3].includes(t)&&parseFloat(o).toString()==="NaN"){d.value=f("chart.filter_value_can_not_str");return}}if(e==="enum"&&i.length<1){d.value=f("chart.enum_value_can_not_null");return}},F=i=>{var m;const t={year:"年",month:"月",date:"日",datetime:"日"};let e="";const{timeGranularity:l,timeNum:o,relativeToCurrentType:r,around:a,arbitraryTime:n,relativeToCurrent:s}=i||{};return s!=="custom"?(e=(m=[{label:"今年",value:"thisYear"},{label:"去年",value:"lastYear"},{label:"本月",value:"thisMonth"},{label:"上月",value:"lastMonth"},{label:"今天",value:"today"},{label:"昨天",value:"yesterday"},{label:"月初",value:"monthBeginning"},{label:"年初",value:"yearBeginning"}].find(u=>u.value===s))==null?void 0:m.label,e):(e=`${o}${t[r]}${a==="f"?"前":"后"}`,l==="datetime"&&(e+=new Date(n).toLocaleString().split(" ")[1]),e)},A=i=>{const t=[];return i.forEach(e=>{const{subTree:l}=e;if(l){const{items:o=[],logic:r}=l,a=A(o);t.push({logic:r,child:a})}else{const{enumValue:o,filterTypeTime:r,dynamicTimeSetting:a,fieldId:n,filterType:s,term:m,value:u,field:h}=e,{name:v,deType:p}=h||{};t.push({enumValue:o.join(","),fieldId:n,filterType:s,term:m,timeValue:F(a),filterTypeTime:r,dynamicTimeSetting:a,value:u,name:v,deType:p})}}),t},D=i=>{const t=[];return i.forEach(e=>{const{child:l=[]}=e;if(l.length){const{logic:o}=e,r=D(l);t.push({enumValue:[],fieldId:"",filterType:"",term:"",type:"tree",value:"",filterTypeTime:"dateValue",timeValue:"",dynamicTimeSetting:{},subTree:{logic:o,items:r}})}else{const{enumValue:o,filterTypeTime:r,dynamicTimeSetting:a,fieldId:n,filterType:s,deType:m,term:u,value:h,name:v,timeValue:p}=e;z({deType:m,enumValue:o,filterType:s,term:u,value:h,name:v,timeValue:p,filterTypeTime:r}),n&&t.push({enumValue:o?o.split(","):[],fieldId:n,timeValue:p,filterType:s,filterTypeTime:r,dynamicTimeSetting:a,term:u,value:h,type:"item",subTree:null})}}),t},G=()=>{c.value=[]},_=i=>{var e;const[t]=i;return(e=t.child)!=null&&e.length?_(t.child):t.y},w=i=>{var l,o;const t=(l=i.child)==null?void 0:l.length;let e="";if(!t&&Array.isArray(i.child)){const{x:r,y:a}=i;e+=`M${48+r*68} ${a*41.4+20} L${88+r*68} ${a*41.4+20}`}else if((o=i.child)!=null&&o.length){let r=Math.max(R(i,0),g(i.child,0)+_(i.child)-1),a=g(i.child,0)*41.4/2+(_(i.child)||0)*41.4;const{x:n}=i;e+=`M${24+n*68} ${a} L${24+n*68} ${r*41.4+20} L${64+n*68} ${r*41.4+20}`,i.child.forEach(s=>{e+=w(s)})}return e},x=i=>{const t=i.child.length;if(!t)return"";let e="";const{x:l,y:o}=i;return i.child.forEach((r,a)=>{var m,u,h,v;const{y:n,z:s}=r;if((m=r.child)!=null&&m.length){let p=g(i.child,0)*41.4/2+(_(i.child)||0)*41.4,T=g(r.child,0)*41.4/2+_(r.child)*41.4,C=0,y=0;p<T?(C=p,y=T):[C,y]=[T,p],o>=n&&(C=p,y=T),e+=`M${24+l*68} ${C} L${24+l*68} ${y} L${68+l*68} ${y}`,e+=x(r)}(u=r.child)!=null&&u.length||(n>=o?e+=`M${24+l*68} ${o*40} L${24+l*68} ${(n+1)*41.4-20.69921875} L${68+l*68} ${(n+1)*41.4-20.69921875}`:e+=`M${24+l*68} ${(n+(t===1&&a===0?0:1)+((v=(h=i.child[a+1])==null?void 0:h.child)!=null&&v.length?o-n-1:0))*41.4+20+(t===1&&a===0?26:0)} L${24+l*68} ${(n+1)*41.4-20.69921875-(t===1&&a===0?(s||0)*1.4:0)} L${68+l*68} ${(n+1)*41.4-20.69921875-(t===1&&a===0?(s||0)*1.4:0)}`)}),e},E=(i,t)=>{i.forEach(e=>{e.child&&(e.logic=t==="and"?"or":"and",E(e.child,e.logic))})},g=(i,t)=>(i.forEach(e=>{var l;(l=e.child)!=null&&l.length?t=g(e.child,t):t+=1}),t+=1,t),R=(i,t)=>(i.child.forEach(e=>{var l;(l=e.child)!=null&&l.length?t=R(e,t):t=Math.max(t,e.y,i.y)}),t),L=(i,t)=>(i.child.forEach(e=>{var l;if(e.x=i.x+1,(l=e.child)!=null&&l.length){let o=g(e.child,0);e.y=Math.floor(o/2)+t,t=L(e,t)}else t+=1,e.y=t-1}),t+=1,t),U=(i,t)=>{c.value.push(i==="condition"?{fieldId:"",value:"",enumValue:"",term:"",filterType:"logic",name:"",timeValue:"",filterTypeTime:"dateValue",dynamicTimeSetting:{},deType:""}:{child:[],logic:t})},W=i=>{c.value.splice(i,1)};B({init:O,submit:P});const X=N;return(i,t)=>(V(),k("div",Z,[K(H,{onDel:t[0]||(t[0]=e=>W(e)),onAddCondReal:U,onRemoveRelationList:G,onChangeAndOrDfs:t[1]||(t[1]=e=>E(c.value,e)),relationList:c.value,logic:$.value,"onUpdate:logic":t[2]||(t[2]=e=>$.value=e)},null,8,["relationList","logic"]),(V(),k("svg",j,[S("path",{"stroke-linejoin":"round","stroke-linecap":"round",d:Y.value,fill:"none",stroke:"#CCCCCC","stroke-width":"0.5"},null,8,tt)])),(V(),k("svg",et,[S("path",{"stroke-linejoin":"round","stroke-linecap":"round",d:b.value,fill:"none",stroke:"#CCCCCC","stroke-width":"0.5","stroke-dasharray":"4,4"},null,8,it)]))]))}});const ye=Q(lt,[["__scopeId","data-v-36c1c74a"]]);export{ye as default};

import{o as H}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import J from"./AuthTree-0.0.0-dataease.js";import{d as K,r as M,y as I,f as V,O as k,j as Q,P as S}from"./vue-0.0.0-dataease.js";import{_ as W}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./index-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./el-dropdown-menu-0.0.0-dataease.js";import"./index-0.0.0-dataease4.js";import"./index-0.0.0-dataease3.js";import"./dropdown-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import"./el-dropdown-item-0.0.0-dataease.js";import"./FilterFiled-0.0.0-dataease.js";import"./el-dialog-0.0.0-dataease.js";import"./use-dialog-0.0.0-dataease.js";import"./el-popover-0.0.0-dataease.js";import"./el-checkbox-group-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import"./el-input-number-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import"./index-0.0.0-dataease6.js";import"./token-0.0.0-dataease.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease5.js";import"./icon_search-outline_outlined-0.0.0-dataease.js";import"./icon_close_outlined-0.0.0-dataease.js";import"./icon_delete-trash_outlined-0.0.0-dataease.js";import"./TimeDialog-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import"./el-time-picker-0.0.0-dataease.js";import"./dayjs.min-0.0.0-dataease.js";import"./el-date-picker-0.0.0-dataease.js";import"./arrays-0.0.0-dataease.js";import"./index-0.0.0-dataease18.js";import"./el-form-item-0.0.0-dataease.js";import"./time-format-0.0.0-dataease.js";import"./index-0.0.0-dataease20.js";import"./dataset-0.0.0-dataease.js";import"./options-0.0.0-dataease.js";import"./field-list-0.0.0-dataease.js";import"./icon_down_outlined-0.0.0-dataease.js";const Z={class:"rowAuth"},j={width:"388",height:"100%",class:"real-line"},ee=["d"],te={width:"388",height:"100%",class:"dash-line"},le=["d"],ie=K({__name:"RowAuth",emits:["save"],setup(re,{expose:B,emit:N}){const{t:f}=H(),m=M(""),$=M("or"),c=M([]),Y=I(()=>{const l=c.value.length;let e={x:0,y:0,child:c.value};return e.y=Math.floor(L(e,0)/2),l?x(e):""}),O=I(()=>{const l=c.value.length;let e={x:0,y:0,child:c.value};return e.y=Math.floor(L(e,0)/2),l?w(e):"M48 20 L68 20"}),P=l=>{const{items:e}=l;$.value=l.logic||"or",c.value=A(e||[])},b=()=>{m.value="",q("save",{logic:$.value,items:D(c.value),errorMessage:m.value})},z=({enumValue:l,deType:e,filterType:t,term:i,value:a,name:r,timeValue:n,filterTypeTime:o})=>{if(!r){m.value=f("data_set.cannot_be_empty_");return}if(t==="logic"){if(!i){m.value=f("data_set.cannot_be_empty_de_ruler");return}if(!i.includes("null")&&!i.includes("empty")&&["",null,void 0].includes(a)&&e!==1){m.value=f("chart.filter_value_can_null");return}if(!i.includes("null")&&!i.includes("empty")&&["",null,void 0].includes(n)&&e===1&&o==="dynamicDate"){m.value=f("chart.filter_value_can_null");return}if([2,3].includes(e)&&parseFloat(a).toString()==="NaN"){m.value=f("chart.filter_value_can_not_str");return}}if(t==="enum"&&l.length<1){m.value=f("chart.enum_value_can_not_null");return}},F=l=>{var u;const e={year:"年",month:"月",date:"日",datetime:"日"};let t="";const{timeGranularity:i,timeNum:a,relativeToCurrentType:r,around:n,arbitraryTime:o,relativeToCurrent:s}=l||{};return s!=="custom"?(t=(u=[{label:"今年",value:"thisYear"},{label:"去年",value:"lastYear"},{label:"本月",value:"thisMonth"},{label:"上月",value:"lastMonth"},{label:"今天",value:"today"},{label:"昨天",value:"yesterday"},{label:"月初",value:"monthBeginning"},{label:"年初",value:"yearBeginning"}].find(d=>d.value===s))==null?void 0:u.label,t):(t=`${a}${e[r]}${n==="f"?"前":"后"}`,i==="datetime"&&(t+=new Date(o).toLocaleString().split(" ")[1]),t)},A=l=>{const e=[];return l.forEach(t=>{const{subTree:i}=t;if(i){const{items:a=[],logic:r}=i,n=A(a);e.push({logic:r,child:n})}else{const{enumValue:a,filterTypeTime:r,dynamicTimeSetting:n,fieldId:o,filterType:s,term:u,value:d,field:p}=t,{name:v,deType:h}=p||{};e.push({enumValue:a.join(","),fieldId:o,filterType:s,term:u,timeValue:F(n),filterTypeTime:r,dynamicTimeSetting:n,value:d,name:v,deType:h})}}),e},D=l=>{const e=[];return l.forEach(t=>{const{child:i=[]}=t;if(i.length){const{logic:a}=t,r=D(i);e.push({enumValue:[],fieldId:"",filterType:"",term:"",type:"tree",value:"",filterTypeTime:"dateValue",timeValue:"",dynamicTimeSetting:{},subTree:{logic:a,items:r}})}else{const{enumValue:a,filterTypeTime:r,dynamicTimeSetting:n,fieldId:o,filterType:s,deType:u,term:d,value:p,name:v,timeValue:h}=t;z({deType:u,enumValue:a,filterType:s,term:d,value:p,name:v,timeValue:h,filterTypeTime:r}),o&&e.push({enumValue:a?a.split(","):[],fieldId:o,timeValue:h,filterType:s,filterTypeTime:r,dynamicTimeSetting:n,term:d,value:p,type:"item",subTree:null})}}),e},G=()=>{c.value=[]},_=l=>{var t;const[e]=l;return(t=e.child)!=null&&t.length?_(e.child):e.y},w=l=>{var i,a;const e=(i=l.child)==null?void 0:i.length;let t="";if(!e&&Array.isArray(l.child)){const{x:r,y:n}=l;t+=`M${48+r*68} ${n*41.4+20} L${88+r*68} ${n*41.4+20}`}else if((a=l.child)!=null&&a.length){let r=Math.max(R(l,0),g(l.child,0)+_(l.child)-1),n=g(l.child,0)*41.4/2+(_(l.child)||0)*41.4;const{x:o}=l;t+=`M${24+o*68} ${n} L${24+o*68} ${r*41.4+20} L${64+o*68} ${r*41.4+20}`,l.child.forEach(s=>{t+=w(s)})}return t},x=l=>{const e=l.child.length;if(!e)return"";let t="";const{x:i,y:a}=l;return l.child.forEach((r,n)=>{var u,d,p,v;const{y:o,z:s}=r;if((u=r.child)!=null&&u.length){let h=g(l.child,0)*41.4/2+(_(l.child)||0)*41.4,T=g(r.child,0)*41.4/2+_(r.child)*41.4,C=0,y=0;h<T?(C=h,y=T):[C,y]=[T,h],a>=o&&(C=h,y=T),t+=`M${24+i*68} ${C} L${24+i*68} ${y} L${68+i*68} ${y}`,t+=x(r)}(d=r.child)!=null&&d.length||(o>=a?t+=`M${24+i*68} ${a*40} L${24+i*68} ${(o+1)*41.4-20.69921875} L${68+i*68} ${(o+1)*41.4-20.69921875}`:t+=`M${24+i*68} ${(o+(e===1&&n===0?0:1)+((v=(p=l.child[n+1])==null?void 0:p.child)!=null&&v.length?a-o-1:0))*41.4+20+(e===1&&n===0?26:0)} L${24+i*68} ${(o+1)*41.4-20.69921875-(e===1&&n===0?(s||0)*1.4:0)} L${68+i*68} ${(o+1)*41.4-20.69921875-(e===1&&n===0?(s||0)*1.4:0)}`)}),t},E=(l,e)=>{l.forEach(t=>{t.child&&(t.logic=e==="and"?"or":"and",E(t.child,t.logic))})},g=(l,e)=>(l.forEach(t=>{var i;(i=t.child)!=null&&i.length?e=g(t.child,e):e+=1}),e+=1,e),R=(l,e)=>(l.child.forEach(t=>{var i;(i=t.child)!=null&&i.length?e=R(t,e):e=Math.max(e,t.y,l.y)}),e),L=(l,e)=>(l.child.forEach(t=>{var i;if(t.x=l.x+1,(i=t.child)!=null&&i.length){let a=g(t.child,0);t.y=Math.floor(a/2)+e,e=L(t,e)}else e+=1,t.y=e-1}),e+=1,e),U=(l,e)=>{c.value.push(l==="condition"?{fieldId:"",value:"",enumValue:"",term:"",filterType:"logic",name:"",timeValue:"",filterTypeTime:"dateValue",dynamicTimeSetting:{},deType:""}:{child:[],logic:e})},X=l=>{c.value.splice(l,1)};B({init:P,submit:b});const q=N;return(l,e)=>(V(),k("div",Z,[Q(J,{onDel:e[0]||(e[0]=t=>X(t)),onAddCondReal:U,onRemoveRelationList:G,onChangeAndOrDfs:e[1]||(e[1]=t=>E(c.value,t)),relationList:c.value,logic:$.value,"onUpdate:logic":e[2]||(e[2]=t=>$.value=t)},null,8,["relationList","logic"]),(V(),k("svg",j,[S("path",{"stroke-linejoin":"round","stroke-linecap":"round",d:Y.value,fill:"none",stroke:"#CCCCCC","stroke-width":"0.5"},null,8,ee)])),(V(),k("svg",te,[S("path",{"stroke-linejoin":"round","stroke-linecap":"round",d:O.value,fill:"none",stroke:"#CCCCCC","stroke-width":"0.5","stroke-dasharray":"4,4"},null,8,le)]))]))}});const je=W(ie,[["__scopeId","data-v-36c1c74a"]]);export{je as default};

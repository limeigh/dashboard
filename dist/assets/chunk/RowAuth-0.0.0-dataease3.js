import{o as H}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import J from"./AuthTree-0.0.0-dataease3.js";import{d as K,r as M,y as I,f as k,O as A,j as Q,P as N}from"./vue-0.0.0-dataease.js";import{_ as W}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./index-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./el-dropdown-menu-0.0.0-dataease.js";import"./index-0.0.0-dataease4.js";import"./index-0.0.0-dataease3.js";import"./dropdown-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import"./el-dropdown-item-0.0.0-dataease.js";import"./FilterFiled-0.0.0-dataease3.js";import"./el-popover-0.0.0-dataease.js";import"./el-checkbox-group-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import"./el-input-number-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import"./el-select-0.0.0-dataease.js";import"./index-0.0.0-dataease6.js";import"./token-0.0.0-dataease.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease5.js";import"./icon_search-outline_outlined-0.0.0-dataease.js";import"./icon_close_outlined-0.0.0-dataease.js";import"./icon_delete-trash_outlined-0.0.0-dataease.js";import"./dataset-0.0.0-dataease.js";import"./options-0.0.0-dataease.js";import"./field-list-0.0.0-dataease.js";import"./index-0.0.0-dataease20.js";import"./index-0.0.0-dataease18.js";import"./icon_down_outlined-0.0.0-dataease.js";const Z={class:"rowAuth"},b={width:"388",height:"100%",class:"real-line"},j=["d"],tt={width:"388",height:"100%",class:"dash-line"},et=["d"],lt=K({__name:"RowAuth",emits:["save"],setup(it,{expose:B,emit:O}){const{t:m}=H(),h=M(""),_=M("or"),a=M([]),P=I(()=>{const l=a.value.length;let t={x:0,y:0,child:a.value};return t.y=Math.floor(C(t,0)/2),l?R(t):""}),Y=I(()=>{const l=a.value.length;let t={x:0,y:0,child:a.value};return t.y=Math.floor(C(t,0)/2),l?E(t):"M48 20 L68 20"}),S=l=>{const{items:t}=l;_.value=l.logic||"or",a.value=T(t||[])},z=()=>{h.value="",G("save",{logic:_.value,items:x(a.value),errorMessage:h.value})},F=({enumValue:l,deType:t,filterType:e,term:i,value:o,name:r})=>{if(!r){h.value=m("data_set.cannot_be_empty_");return}if(e==="logic"){if(!i){h.value=m("data_set.cannot_be_empty_de_ruler");return}if(!i.includes("null")&&!i.includes("empty")&&o===""){h.value=m("chart.filter_value_can_null");return}if([2,3].includes(t)&&parseFloat(o).toString()==="NaN"){h.value=m("chart.filter_value_can_not_str");return}}if(e==="enum"&&l.length<1){h.value=m("chart.enum_value_can_not_null");return}},T=l=>{const t=[];return l.forEach(e=>{const{subTree:i}=e;if(i){const{items:o=[],logic:r}=i,n=T(o);t.push({logic:r,child:n})}else{const{enumValue:o,fieldId:r,filterType:n,term:s,value:c,field:d}=e,{name:p,deType:v}=d||{};t.push({enumValue:o.join(","),fieldId:r,filterType:n,term:s,value:c,name:p,deType:v})}}),t},x=l=>{const t=[];return l.forEach(e=>{const{child:i=[]}=e;if(i.length){const{logic:o}=e,r=x(i);t.push({enumValue:[],fieldId:"",filterType:"",term:"",type:"tree",value:"",subTree:{logic:o,items:r}})}else{const{enumValue:o,fieldId:r,filterType:n,deType:s,term:c,value:d,name:p}=e;F({deType:s,enumValue:o,filterType:n,term:c,value:d,name:p}),r&&t.push({enumValue:o?o.split(","):[],fieldId:r,filterType:n,term:c,value:d,type:"item",subTree:null})}}),t},U=()=>{a.value=[]},f=l=>{var e;const[t]=l;return(e=t.child)!=null&&e.length?f(t.child):t.y},E=l=>{var i,o;const t=(i=l.child)==null?void 0:i.length;let e="";if(!t&&Array.isArray(l.child)){const{x:r,y:n}=l;e+=`M${48+r*68} ${n*41.4+20} L${88+r*68} ${n*41.4+20}`}else if((o=l.child)!=null&&o.length){let r=Math.max(D(l,0),u(l.child,0)+f(l.child)-1),n=u(l.child,0)*41.4/2+(f(l.child)||0)*41.4;const{x:s}=l;e+=`M${24+s*68} ${n} L${24+s*68} ${r*41.4+20} L${64+s*68} ${r*41.4+20}`,l.child.forEach(c=>{e+=E(c)})}return e},R=l=>{const t=l.child.length;if(!t)return"";let e="";const{x:i,y:o}=l;return l.child.forEach((r,n)=>{var d,p,v,V;const{y:s,z:c}=r;if((d=r.child)!=null&&d.length){let y=u(l.child,0)*41.4/2+(f(l.child)||0)*41.4,$=u(r.child,0)*41.4/2+f(r.child)*41.4,L=0,g=0;y<$?(L=y,g=$):[L,g]=[$,y],o>=s&&(L=y,g=$),e+=`M${24+i*68} ${L} L${24+i*68} ${g} L${68+i*68} ${g}`,e+=R(r)}(p=r.child)!=null&&p.length||(s>=o?e+=`M${24+i*68} ${o*40} L${24+i*68} ${(s+1)*41.4-20.69921875} L${68+i*68} ${(s+1)*41.4-20.69921875}`:e+=`M${24+i*68} ${(s+(t===1&&n===0?0:1)+((V=(v=l.child[n+1])==null?void 0:v.child)!=null&&V.length?o-s-1:0))*41.4+20+(t===1&&n===0?26:0)} L${24+i*68} ${(s+1)*41.4-20.69921875-(t===1&&n===0?(c||0)*1.4:0)} L${68+i*68} ${(s+1)*41.4-20.69921875-(t===1&&n===0?(c||0)*1.4:0)}`)}),e},w=(l,t)=>{l.forEach(e=>{e.child&&(e.logic=t==="and"?"or":"and",w(e.child,e.logic))})},u=(l,t)=>(l.forEach(e=>{var i;(i=e.child)!=null&&i.length?t=u(e.child,t):t+=1}),t+=1,t),D=(l,t)=>(l.child.forEach(e=>{var i;(i=e.child)!=null&&i.length?t=D(e,t):t=Math.max(t,e.y,l.y)}),t),C=(l,t)=>(l.child.forEach(e=>{var i;if(e.x=l.x+1,(i=e.child)!=null&&i.length){let o=u(e.child,0);e.y=Math.floor(o/2)+t,t=C(e,t)}else t+=1,e.y=t-1}),t+=1,t),X=(l,t)=>{a.value.push(l==="condition"?{fieldId:"",value:"",enumValue:"",term:"",filterType:"logic",name:"",deType:""}:{child:[],logic:t})},q=l=>{a.value.splice(l,1)};B({init:S,submit:z});const G=O;return(l,t)=>(k(),A("div",Z,[Q(J,{onDel:t[0]||(t[0]=e=>q(e)),onAddCondReal:X,onRemoveRelationList:U,onChangeAndOrDfs:t[1]||(t[1]=e=>w(a.value,e)),relationList:a.value,logic:_.value,"onUpdate:logic":t[2]||(t[2]=e=>_.value=e)},null,8,["relationList","logic"]),(k(),A("svg",b,[N("path",{"stroke-linejoin":"round","stroke-linecap":"round",d:P.value,fill:"none",stroke:"#CCCCCC","stroke-width":"0.5"},null,8,j)])),(k(),A("svg",tt,[N("path",{"stroke-linejoin":"round","stroke-linecap":"round",d:Y.value,fill:"none",stroke:"#CCCCCC","stroke-width":"0.5","stroke-dasharray":"4,4"},null,8,et)]))]))}});const Ft=W(lt,[["__scopeId","data-v-21e8b8eb"]]);export{Ft as default};

import{e as N,H as $e,I as Ee,f as Re,G as Fe,b as ht,q as gt,E as fe,r as Ct,t as wt,v as bt}from"./element-plus-secondary-0.0.0-dataease.js";import{o as c,c as k,a as L,d as Pe,k as A,r as S,W as s,U as n,S as ee,a8 as Be,z as U,X as Oe,u as o,T as w,V as te,R as z,_ as Q,Y as j,t as yt,l as Vt,w as Tt,b as xt,$ as ke,a0 as St,n as ve}from"./@vue-0.0.0-dataease.js";import{d as Dt,a as kt}from"./dv-dashboard-spine-mobile-disabled-0.0.0-dataease.js";import{i as Lt}from"./icon_add_outlined-0.0.0-dataease.js";import{m as Ht,o as Mt,p as Nt,t as zt,w as It,q as $t}from"./dataVisualization-0.0.0-dataease.js";import{h as Le,d as Et}from"./lodash-es-0.0.0-dataease.js";import{d as _e}from"./dv-rename-0.0.0-dataease.js";import{d as He}from"./dv-dashboard-spine-0.0.0-dataease.js";import{d as Rt}from"./dv-screen-spine-0.0.0-dataease.js";import{d as Ft,i as Pt}from"./icon_file-add_outlined-0.0.0-dataease.js";import{i as Bt}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{d as Ot,a as Zt}from"./dv-sort-desc-0.0.0-dataease.js";import{d as Me}from"./dv-folder-0.0.0-dataease.js";import{i as Wt}from"./icon_operation-analysis_outlined-0.0.0-dataease.js";import{i as qt}from"./icon_edit_outlined-0.0.0-dataease.js";import{e as D,f as Ze,r as At,i as Ut,o as ne}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{p as se,a as Gt,f as Jt,g as W,u as re,n as jt}from"./index-0.0.0-dataease.js";import{_ as Kt}from"./HandleMore.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import Xt from"./DeResourceGroupOpt-0.0.0-dataease.js";import{d as Yt}from"./dvMain-0.0.0-dataease.js";import{useAppStoreWithOut as Qt}from"./app-0.0.0-dataease.js";import{s as eo}from"./pinia-0.0.0-dataease.js";import{i as to}from"./icon_more_outlined-0.0.0-dataease.js";import oo from"./ShareHandler-0.0.0-dataease.js";import{u as We}from"./share-0.0.0-dataease.js";import{i as ao}from"./ModelUtil-0.0.0-dataease.js";import{i as no}from"./interactive-0.0.0-dataease.js";import{_ as le}from"./lodash-0.0.0-dataease.js";import{_ as so}from"./DeResourceCreateOptV2.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import{o as ro,G as lo}from"./canvasUtils-0.0.0-dataease.js";import{a as io,t as Ne}from"./treeSortUtils-0.0.0-dataease.js";import{_ as co}from"./_plugin-vue_export-helper-0.0.0-dataease.js";const uo={width:"20",height:"20",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"};function po(h,u){return c(),k("svg",uo,[...u[0]||(u[0]=[L("path",{d:"M6.43791 2.26348L2.3524 6.34898C2.17884 6.52255 2.17884 6.80395 2.3524 6.97752L6.83075 11.4559C7.00431 11.6294 7.28572 11.6294 7.45929 11.4559L8.00926 10.9059C8.18283 10.7323 8.18283 10.4509 8.00926 10.2774L4.9589 7.22552L12.2222 7.22219V7.22698C14.5234 7.22698 16.3889 9.09246 16.3889 11.3937C16.3889 13.6948 14.5234 15.5603 12.2222 15.5603V15.5555L8.9696 15.5597C8.72436 15.5601 8.52573 15.759 8.52573 16.0042V16.782C8.52573 16.9967 8.67808 17.1759 8.8806 17.2174L8.97075 17.2264L12 17.2214L12.2222 17.227C15.4439 17.227 18.0556 14.6153 18.0556 11.3937C18.0556 8.17199 15.4439 5.56032 12.2222 5.56032V5.55552L5.4989 5.55886L7.61642 3.44199C7.78999 3.26842 7.78999 2.98701 7.61642 2.81345L7.06645 2.26348C6.89288 2.08991 6.61148 2.08991 6.43791 2.26348Z"},null,-1)])])}const ze={render:po},mo={width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"};function fo(h,u){return c(),k("svg",mo,[...u[0]||(u[0]=[L("path",{d:"M3.33333 5.33398V13.334H10V5.33398H3.33333ZM11.3333 4.66732V14.0747C11.3333 14.402 11.0548 14.6673 10.7111 14.6673H2.62222C2.27858 14.6673 2 14.402 2 14.0747V4.59324C2 4.26596 2.27858 4.00065 2.62222 4.00065H10.6667C11.0349 4.00065 11.3333 4.29913 11.3333 4.66732ZM13.8047 1.52925C13.9254 1.64989 14 1.81656 14 2.00065V10.334C14 10.5181 13.8508 10.6673 13.6667 10.6673H13C12.8159 10.6673 12.6667 10.5181 12.6667 10.334V2.66732H6.33333C6.14924 2.66732 6 2.51808 6 2.33398V1.66732C6 1.48322 6.14924 1.33398 6.33333 1.33398H13.3333C13.5174 1.33398 13.6841 1.4086 13.8047 1.52925Z"},null,-1)])])}const vo={render:fo},_o={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function ho(h,u){return c(),k("svg",_o,[...u[0]||(u[0]=[L("path",{d:"M5.33301 2.66732V2.00065C5.33301 1.63246 5.63148 1.33398 5.99967 1.33398H9.99967C10.3679 1.33398 10.6663 1.63246 10.6663 2.00065V2.66732H14.239C14.3876 2.66732 14.4415 2.68279 14.4958 2.71184C14.5501 2.74089 14.5928 2.78352 14.6218 2.83784C14.6509 2.89216 14.6663 2.94605 14.6663 3.09463V3.57334C14.6663 3.72192 14.6509 3.7758 14.6218 3.83013C14.5928 3.88445 14.5501 3.92708 14.4958 3.95613C14.4415 3.98518 14.3876 4.00065 14.239 4.00065H13.333V14.0007C13.333 14.3688 13.0345 14.6673 12.6663 14.6673H3.33301C2.96482 14.6673 2.66634 14.3688 2.66634 14.0007V4.00065H1.76032C1.61174 4.00065 1.55785 3.98518 1.50353 3.95613C1.44921 3.92708 1.40658 3.88445 1.37753 3.83013C1.34848 3.7758 1.33301 3.72192 1.33301 3.57334V3.09463C1.33301 2.94605 1.34848 2.89216 1.37753 2.83784C1.40658 2.78352 1.44921 2.74089 1.50353 2.71184C1.55785 2.68279 1.61174 2.66732 1.76032 2.66732H5.33301ZM3.99967 4.00065V13.334H11.9997V4.00065H3.99967ZM6.33301 5.33398H6.99967C7.18377 5.33398 7.33301 5.48322 7.33301 5.66732V11.6673C7.33301 11.8514 7.18377 12.0007 6.99967 12.0007H6.33301C6.14891 12.0007 5.99967 11.8514 5.99967 11.6673V5.66732C5.99967 5.48322 6.14891 5.33398 6.33301 5.33398ZM8.99967 5.33398H9.66634C9.85044 5.33398 9.99967 5.48322 9.99967 5.66732V11.6673C9.99967 11.8514 9.85044 12.0007 9.66634 12.0007H8.99967C8.81558 12.0007 8.66634 11.8514 8.66634 11.6673V5.66732C8.66634 5.48322 8.81558 5.33398 8.99967 5.33398Z",fill:"#646A73"},null,-1)])])}const he={render:ho},go={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Co(h,u){return c(),k("svg",go,[...u[0]||(u[0]=[L("path",{d:"M14.0021 1.77734C14.3396 1.77734 14.6186 2.02815 14.6627 2.35355L14.6688 2.44401V13.5614C14.6688 13.8989 14.418 14.1779 14.0926 14.222L14.0021 14.2281H9.89167C9.73059 14.2281 9.59619 14.1138 9.56511 13.962L9.55834 13.8948V13.2281C9.55834 13.067 9.6726 12.9326 9.82449 12.9015L9.89167 12.8948H13.3355V3.11068H4.40563L4.40652 6.11325C4.40652 6.29735 4.25728 6.44659 4.07319 6.44659H3.40652C3.22243 6.44659 3.07319 6.29735 3.07319 6.11325V2.11068C3.07319 1.94959 3.18745 1.8152 3.33934 1.78412L3.40652 1.77734H14.0021ZM6.64113 7.59282C6.73925 7.59282 6.83418 7.6276 6.90908 7.69097L9.70393 10.0559C9.87882 10.2038 9.90063 10.4656 9.75265 10.6405C9.73779 10.658 9.72149 10.6743 9.70393 10.6892L6.90908 13.0541C6.73419 13.202 6.47245 13.1802 6.32447 13.0053C6.26109 12.9304 6.22632 12.8355 6.22632 12.7374L6.22681 11.1164L2.11165 11.1164C1.92756 11.1164 1.77832 10.9672 1.77832 10.7831V10.1164C1.77832 9.93231 1.92756 9.78307 2.11165 9.78307L6.22681 9.78305L6.22632 8.00764C6.22632 7.77854 6.41204 7.59282 6.64113 7.59282Z",fill:"#646A73"},null,-1)])])}const ge={render:Co},wo=(h,u,K)=>{let F="",T="",y=0,H=[];const P=(m,a)=>{m.forEach((d,_)=>{var p;d.id===T&&(y=_,F=a),(p=d.children)!=null&&p.length&&P(d.children,d.id)})},g=(m,a)=>{m.forEach(d=>{var p;const _=a.findIndex(M=>M===d.id);_!==-1&&a.splice(_,1),(p=d.children)!=null&&p.length&&a.length===2&&g(d.children,a)})},I=(m,a,d)=>{m.forEach(_=>{var p;_.id===d.id&&(d.pid=a),(p=_.children)!=null&&p.length&&I(_.children,_.id,d)})},l=(m,a)=>{m.forEach(d=>{var _;d.id===F&&d.children.splice(y,0,a),(_=d.children)!=null&&_.length&&l(d.children,a)})},$=(m,a)=>{m.forEach((d,_)=>{var p;d.id===a.id&&m.splice(_,1),(p=d.children)!=null&&p.length&&$(d.children,a)})};return{handleDrop:async(m,a,d)=>{var p,M,q,O,R;const _={id:(p=m.data)==null?void 0:p.id,name:(M=m.data)==null?void 0:M.name,nodeType:(q=m.data)!=null&&q.leaf?"leaf":"folder",pid:"0",opt:"move",type:K};if(d!=="inner"){const Z=[_.id,(O=a.data)==null?void 0:O.id];if(g(H,Z),Z.length===0){$(h[u],m.data),setTimeout(()=>{F==="0"?h[u].splice(y,0,m.data):l(h[u],m.data)},0);return}}try{await Ht(_)}catch(Z){console.error(Z)}delete _.opt,d==="inner"?_.pid=(R=a.data)==null?void 0:R.id:I(h[u],"0",_),Mt(_).then(()=>{h.originResourceTree=Le(h[u])}).catch(()=>{if(F==="0"){h[u].splice(y,0,m.data);return}l(h[u],m.data)})},allowDrop:(m,a)=>{var d;return!((d=a.data)!=null&&d.leaf)},handleDragStart:m=>{T=m.data.id,H=Le(h[u]),P(h[u],"0")}}},bo={width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function yo(h,u){return c(),k("svg",bo,[...u[0]||(u[0]=[L("path",{d:"M0 3C0 1.34315 1.59845 0 3.57025 0H14.4298C16.4015 0 18 1.34315 18 3V15C18 16.6569 16.4015 18 14.4298 18H3.57025C1.59845 18 0 16.6569 0 15V3Z",fill:"#BBBFC4"},null,-1),L("path",{d:"M4.25 13V8.77273C4.25 8.48403 4.48985 8.25 4.78571 8.25H7V4.52632C7 4.23564 7.25584 4 7.57143 4H10.4286C10.7442 4 11 4.23564 11 4.52632V7H13.2143C13.5102 7 13.75 7.22386 13.75 7.5V13H14C14.1381 13 14.25 13.1119 14.25 13.25V13.75C14.25 13.8881 14.1381 14 14 14H4C3.86193 14 3.75 13.8881 3.75 13.75V13.25C3.75 13.1119 3.86193 13 4 13H4.25ZM12.75 13V8H11V13H12.75ZM10 13V5H8V13H10ZM7 13V9.25H5.25V13H7Z",fill:"white"},null,-1)])])}const Vo={render:yo},To={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function xo(h,u){return c(),k("svg",To,[...u[0]||(u[0]=[L("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M17.0855 1.00006H4C3.73478 1.00006 3.48043 1.10542 3.29289 1.29295C3.10536 1.48049 3 1.73484 3 2.00006V22.0001C3 22.2653 3.10536 22.5196 3.29289 22.7072C3.48043 22.8947 3.73478 23.0001 4 23.0001H20C20.2652 23.0001 20.5196 22.8947 20.7071 22.7072C20.8946 22.5196 21 22.2653 21 22.0001V4.91556C21.0001 4.65044 20.8949 4.39614 20.7075 4.20856L17.793 1.29306C17.7001 1.20014 17.5898 1.12643 17.4684 1.07616C17.347 1.02588 17.2169 1.00002 17.0855 1.00006ZM7 8.5C7 8.22386 7.22386 8 7.5 8H16.5C16.7761 8 17 8.22386 17 8.5V9.5C17 9.77614 16.7761 10 16.5 10H7.5C7.22386 10 7 9.77614 7 9.5V8.5ZM11 12.5C11 12.2239 11.2239 12 11.5 12H16.5C16.7761 12 17 12.2239 17 12.5V17.5C17 17.7761 16.7761 18 16.5 18H11.5C11.2239 18 11 17.7761 11 17.5V12.5ZM7 12.5C7 12.2239 7.22386 12 7.5 12H8.5C8.77614 12 9 12.2239 9 12.5V17.5C9 17.7761 8.77614 18 8.5 18H7.5C7.22386 18 7 17.7761 7 17.5V12.5Z",fill:"#FF8800"},null,-1)])])}const Ie={render:xo},So=Pe({__name:"DvHandleMore",props:{menuList:{type:Array},placement:{type:String,default:"bottom-end"},iconName:se.string.def(""),inTable:se.bool.def(!1),resourceType:se.string.def("dashboard"),node:{type:Object,default(){return{}}},anyManage:se.bool.def(!1)},emits:["handleCommand"],setup(h,{emit:u}){const K=We(),{t:F}=Ze(),T=h,y=A(()=>K.getShareDisable||ao()),H=S(null),P=S([...T.menuList.map(V=>(!T.anyManage&&(V.command==="copy"||V.command==="move")&&(V.hidden=!0),V))]),g=V=>{if(V==="share"){H.value.execute();return}l("handleCommand",V)},I=V=>{var E;y.value||T.node.leaf&&((E=T.node)==null?void 0:E.weight)>=7&&P.value.splice(0,0,V)},l=u,$=V=>V.disabled||T.node.extraFlag1===0&&["share","copy"].includes(V.command);return(V,E)=>{const B=N,m=Re,a=Fe,d=$e,_=Ee;return c(),k(ee,null,[s(_,{"popper-class":"menu-more-dv_popper",placement:h.placement,trigger:"click",onCommand:g},{dropdown:n(()=>[s(d,null,{default:n(()=>[(c(!0),k(ee,null,Be(P.value,p=>(c(),w(a,{divided:p.divided,command:p.command,key:p.label,disabled:$(p),class:U({"de-hidden-drop-item":p.hidden||p.command==="cancelPublish"&&h.node.extraFlag1===0})},{default:n(()=>[p.svgName?(c(),w(B,{key:0,class:"handle-icon",color:"#646a73",size:"16"},{default:n(()=>[s(o(D),null,{default:n(()=>[(c(),w(te(p.svgName),{class:U(["svg-icon",{"custom-disable":$(p)}])},null,8,["class"]))]),_:2},1024)]),_:2},1024)):z("",!0),s(m,{class:"box-item",effect:"dark",content:o(F)("visualization.publish_tips2",[p.label]),disabled:!$(p),placement:"top-start"},{default:n(()=>[Q(j(p.label),1)]),_:2},1032,["content","disabled"])]),_:2},1032,["divided","command","disabled","class"]))),128))]),_:1})]),default:n(()=>[s(B,{class:U(["hover-icon",h.inTable&&"hover-icon-in-table"]),onClick:E[0]||(E[0]=Oe(()=>{},["stop"]))},{default:n(()=>[s(o(D),null,{default:n(()=>[(c(),w(te(h.iconName||o(to)),{class:"svg-icon"}))]),_:1})]),_:1},8,["class"])]),_:1},8,["placement"]),y.value?z("",!0):(c(),w(oo,{key:0,ref_key:"shareComponent",ref:H,"resource-id":T.node.id,"resource-type":T.resourceType,weight:h.node.weight,onLoaded:I},null,8,["resource-id","resource-type","weight"]))],64)}}});const Do={class:"resource-tree"},ko={class:"tree-header"},Lo={class:"icon-methods"},Ho={class:"title"},Mo={key:0,class:"flex-align-center"},No={key:0,class:"ed-dropdown-menu__item--divided"},zo=["title"],Io={key:3,class:"icon-more"},$o=Pe({__name:"DeResourceTree",props:{curCanvasType:{type:String,required:!0},showPosition:{required:!1,type:String,default:"preview"},resourceTable:{required:!1,type:String,default:"core"}},emits:["nodeClick"],setup(h,{expose:u,emit:K}){const F=We(),T=no(),{wsCache:y}=Gt(),H=Yt(),P=Qt(),g=Jt(),{dvInfo:I}=eo(H),{t:l}=Ze(),$=h,V={children:"children",label:"name",disabled:t=>t.extraFlag1===0},E=S(!1),B=S(!1),m=S(!1),{curCanvasType:a,showPosition:d}=yt($),_=a.value==="dataV"?l("work_branch.big_data_screen"):l("work_branch.dashboard"),p=a.value==="dataV"?l("visualization.new_screen"):l("visualization.new_dashboard"),M=S(null),q=S(null),O=S([]),R=S(),Z=S(),Ce=S(),ie=S(!1),f=Vt({pWeightMap:{},curSortType:"time_desc",resourceTree:[],originResourceTree:[],folderMenuList:[{label:l("visualization.move_to"),command:"move",svgName:ge},{label:l("visualization.rename"),command:"rename",svgName:_e},{label:l("visualization.delete"),command:"delete",svgName:he,divided:!0}],sortType:[{label:l("visualization.time_asc"),value:"time_asc"},{label:l("visualization.time_desc"),value:"time_desc"},{label:l("visualization.name_asc"),value:"name_asc"},{label:l("visualization.name_desc"),value:"name_desc"}],templateCreatePid:0}),we=A(()=>a.value==="dashboard"?He:Rt),oe=A(()=>P.getIsDataEaseBi||P.getIsIframe),qe=A(()=>[{label:l("work_branch.new_empty"),svgName:we.value,command:"newLeaf"},{label:l("work_branch.new_using_template"),svgName:Ie,command:"newFromTemplate"},{label:l("work_branch.new_folder"),divided:!0,svgName:Me,command:"newFolder"}]),{handleDrop:Ae,allowDrop:Ue,handleDragStart:Ge}=wo(f,"resourceTree",a.value),Je=t=>f.pWeightMap[t]<7?Ke:je,je=[{label:l("visualization.cancel_publish"),command:"cancelPublish",svgName:ze},{label:l("visualization.copy"),command:"copy",svgName:vo,divided:!0},{label:l("visualization.move_to"),command:"move",svgName:ge},{label:l("visualization.rename"),command:"rename",svgName:_e},{label:l("visualization.delete"),command:"delete",svgName:he,divided:!0}],Ke=[{label:l("visualization.cancel_publish"),command:"cancelPublish",svgName:ze},{label:l("visualization.move_to"),command:"move",svgName:ge,divided:!0},{label:l("visualization.rename"),command:"rename",svgName:_e},{label:l("visualization.delete"),command:"delete",svgName:he,divided:!0}],Xe=y.get(W(a.value==="dashboard"?"db-info-id":"dv-info-id")),Ye=At.currentRoute.value.query.dvId,be=g.dvId||Xe||Ye;y.delete(W(a.value==="dashboard"?"db-info-id":"dv-info-id")),be&&d.value==="preview"&&(M.value=be,ie.value=!0);const Qe=t=>{t.id&&O.value.push(t.id)},et=t=>{t.id&&O.value.splice(O.value.indexOf(t.id),1)},tt=(t,e)=>{var r,i;return d.value==="multiplexing"&&e.id===((r=I.value)==null?void 0:r.id)?!1:t?(i=e.name)==null?void 0:i.toLocaleLowerCase().includes(t.toLocaleLowerCase()):!0},ot=()=>{ne("/dataVisualization/findById"),ne("/chartData/getData"),ne("/linkage/getVisualizationAllLinkageInfo/**"),ne("/linkJump/queryVisualizationJumpInfo/**")},at=(t,e)=>{if(H.setCurComponent({component:null,index:null}),d.value!=="multiplexing"&&H.setEditMode("preview"),e.disabled)ve(()=>{const r=R.value.$el.querySelector(".is-current");r&&r.classList.remove("is-current")});else if(ot(),M.value=t.id,t.leaf){if(!g.baseUrl){let r=window.location.href;const i="dvId",v=t.id;if(r.includes("?")){const b=new RegExp(`([?&])${i}=[^&]*`);b.test(r)?r=r.replace(b,`$1${i}=${v}`):r+=`&${i}=${v}`}else r+=`?${i}=${v}`;window.history.replaceState({path:r},"",r)}rt("nodeClick",t)}else R.value.setCurrentKey(null)},de=async()=>{const t={busiFlag:a.value,resourceTable:$.resourceTable},e=a.value=="dashboard";await T.setInteractive(t);const r=e?T.getPanel:T.getScreen,i=r.treeNodes;B.value=r.rootManage,m.value=r.anyManage,I.value&&I.value.id&&!JSON.stringify(i).includes(I.value.id)&&d.value!=="multiplexing"&&H.resetDvInfo();let v=ue[Number(y.get(W("TreeSort-backend")))??1].value;if(v=y.get(W(`TreeSort-${a.value}`))??v,i.length&&i[0].id==="0"&&i[0].name==="root"){f.originResourceTree=i[0].children||[],De(v),Ve();return}f.originResourceTree=i,De(v),Ve()},nt=A(()=>le.filter(ye(f.resourceTree),t=>t.leaf)),st=A(()=>nt.value.length>0);function ye(t){let e=le.cloneDeep(t);return le.forEach(t,r=>{r.children&&r.children.length>0&&(e=le.union(e,ye(r.children)))}),e}const Ve=()=>{f.pWeightMap=io(f.originResourceTree,B.value?9:0),E.value=!0,M.value&&ie.value&&(O.value=ut(),ie.value=!1),ro({type:a.value},"resource_tree_init_ready"),ve(()=>{R.value.setCurrentKey(M.value),R.value.filter(q.value),ve(()=>{var t,e;(e=(t=document.querySelector(".is-current"))==null?void 0:t.firstChild)==null||e.click()})})},ce=S(!1),G=y.get(W("open-backend"))==="1"?"_self":"_blank",rt=K,lt=(t,e,r)=>{if(t==="delete"){const i=e.leaf?"":l("visualization.delete_tips"),v=e.leaf?_:l("visualization.folder");gt.confirm(l("visualization.delete_warn",[v]),{confirmButtonType:"danger",type:"warning",tip:i,autofocus:!1,showClose:!1}).then(()=>{Nt(e.id,a.value).then(()=>{fe.success(l("visualization.delete_success")),de()})})}else if(t==="cancelPublish"){const i={id:e.id,nodeType:"leaf",name:e.name,type:a.value,mobileLayout:e==null?void 0:e.extraFlag,status:0};zt(i).then(()=>{e.extraFlag1=0,I.value.id===e.id&&H.updateDvInfoCall(0),fe.warning(l("visualization.cancel_publish_tips"))})}else if(t==="edit")Te(e.id);else if(t==="copy"){const i=lo(f.resourceTree,e.id),v={nodeType:r,name:e.name+"-copy",type:a.value,id:e.id,pid:i||"0"};ce.value=!0,It(v).then(b=>{const pe=a.value==="dataV"?`#/dvCanvas?opt=copy&pid=${v.pid}&dvId=${b.data}`:`#/dashboard?opt=copy&pid=${v.pid}&resourceId=${b.data}`;if(oe.value){g.clearState(),g.setPid(v.pid),g.setOpt("copy"),a.value==="dataV"?g.setDvId(b.data):g.setResourceId(b.data),re().emitter.emit("changeCurrentComponent",a.value==="dataV"?"VisualizationEditor":"DashboardEditor");return}const me=window.open(pe,G);ae(me)}).finally(()=>{ce.value=!1})}else Z.value.optInit(r,e,t,["copy"].includes(t))},J=(t,e,r,i)=>{if(t==="newLeaf"){const v=a.value==="dataV"?"#/dvCanvas?opt=create":"#/dashboard?opt=create";let b=null;if(oe.value){g.clearState(),g.setOpt("create"),e!=null&&e.id&&g.setPid(e==null?void 0:e.id),re().emitter.emit("changeCurrentComponent",a.value==="dataV"?"VisualizationEditor":"DashboardEditor");return}e!=null&&e.id?b=window.open(v+`&pid=${e.id}`,G):b=window.open(v,G),ae(b)}else if(t==="newFromTemplate"){const v={curPosition:"create",pid:e==null?void 0:e.id,templateType:a.value==="dataV"?"SCREEN":"PANEL"};Ce.value.optInit(v)}else Z.value.optInit(r,e||{},t,i)};function it(){return J("newLeaf",null,"leaf",!0)}const Te=t=>{const e=a.value==="dataV"?"#/dvCanvas?dvId=":"#/dashboard?resourceId=";if(oe.value){g.clearState(),a.value==="dataV"?g.setDvId(t):g.setResourceId(t),re().emitter.emit("changeCurrentComponent",a.value==="dataV"?"VisualizationEditor":"DashboardEditor");return}const r=window.open(e+t,G);ae(r)},dt=()=>{de()},ct=t=>{y.set(W("de-template-data"),JSON.stringify(t));const e=a.value==="dataV"?"#/dvCanvas?opt=create&createType=template":"#/dashboard?opt=create&createType=template";let r=null;if(oe.value){g.clearState(),g.setOpt("create"),g.setCreateType("template"),f.templateCreatePid&&g.setPid(f.templateCreatePid),re().emitter.emit("changeCurrentComponent",a.value==="dataV"?"VisualizationEditor":"DashboardEditor");return}f.templateCreatePid?r=window.open(e+`&pid=${f.templateCreatePid}`,G):r=window.open(e,G),ae(r)},xe=(t,e,r=[])=>{for(const i of t){if(i.id===e)return r;if(i.children){const v=[...r,i.id],b=xe(i.children,e,v);if(b)return b}}return null},ut=()=>{const t=xe(f.resourceTree,M.value);return t?[M.value,...t]:[]},ue=[{name:l("visualization.time_asc"),value:"time_asc"},{name:l("visualization.time_desc"),value:"time_desc",divided:!0},{name:l("visualization.name_asc"),value:"name_asc"},{name:l("visualization.name_desc"),value:"name_desc"}],Se=A(()=>ue.find(t=>t.value===f.curSortType).name),pt=t=>{f.resourceTree=Ne(f.originResourceTree,t),f.curSortType=t,y.set(W("TreeSort-"+a.value),f.curSortType)},De=t=>{f.resourceTree=Ne(f.originResourceTree,t),f.curSortType=t},mt=Et((t,e)=>{const i=["dashboard","dataV","dataset","datasource"].findIndex(v=>v===a.value);return i<0||!jt(e,i+1)?Ue(t,e):(fe.warning(l("free.save_error")),!1)},300);Tt(q,t=>{R.value.filter(t)});const X=S(null),ae=t=>{if(X!=null&&X.value){const e={methodName:"initOpenHandler",args:t};X.value.invokeMethod(e)}},ft=()=>{const t=y.get(W("TreeSort-"+a.value));t&&(f.curSortType=t)},vt=()=>{$t().then(t=>{var r,i;const e={shareDisable:(r=t.data)==null?void 0:r.disable,sharePeRequire:(i=t.data)==null?void 0:i.peRequire};F.setData(e)})};return xt(()=>{ft(),de(),vt()}),u({rootManage:B,hasData:st,createNewObject:it,mounted:E}),(t,e)=>{const r=Re,i=Fe,v=$e,b=Ee,pe=Ct,me=wt,_t=bt;return c(),k(ee,null,[L("div",Do,[L("div",ko,[ke(L("div",Lo,[L("span",Ho,j(o(_)),1),B.value?(c(),k("div",Mo,[s(r,{content:o(l)("work_branch.new_folder"),placement:"top",effect:"dark"},{default:n(()=>[s(o(N),{class:"custom-icon btn",style:{"margin-right":"20px"},onClick:e[0]||(e[0]=x=>J("newFolder",null,"folder"))},{default:n(()=>[s(o(D),{name:"dv-new-folder"},{default:n(()=>[s(o(Ft),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"]),s(r,{content:o(p),placement:"top",effect:"dark"},{default:n(()=>[s(b,{"popper-class":"menu-outer-dv_popper",trigger:"hover"},{dropdown:n(()=>[s(v,null,{default:n(()=>[s(i,{onClick:e[2]||(e[2]=x=>J("newLeaf",null,"leaf",!0))},{default:n(()=>[s(o(N),{class:U(`handle-icon color-${o(a)}`)},{default:n(()=>[s(o(D),null,{default:n(()=>[(c(),w(te(we.value),{class:"svg-icon"}))]),_:1})]),_:1},8,["class"]),Q(" "+j(o(l)("work_branch.new_empty")),1)]),_:1}),s(i,{onClick:e[3]||(e[3]=x=>J("newFromTemplate",null,"leaf",!0))},{default:n(()=>[s(o(N),{class:"handle-icon"},{default:n(()=>[s(o(D),{name:"dv-use-template"},{default:n(()=>[s(o(Ie),{class:"svg-icon"})]),_:1})]),_:1}),Q(" "+j(o(l)("work_branch.new_using_template")),1)]),_:1})]),_:1})]),default:n(()=>[s(o(N),{class:"custom-icon btn",onClick:e[1]||(e[1]=x=>J("newLeaf",null,"leaf",!0))},{default:n(()=>[s(o(D),{name:"icon_file-add_outlined"},{default:n(()=>[s(o(Pt),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),_:1},8,["content"])])):z("",!0)],512),[[St,o(d)==="preview"]]),s(pe,{placeholder:o(l)("commons.search"),modelValue:q.value,"onUpdate:modelValue":e[4]||(e[4]=x=>q.value=x),clearable:"",class:"search-bar"},{prefix:n(()=>[s(o(N),null,{default:n(()=>[s(o(D),{name:"icon_search-outline_outlined"},{default:n(()=>[s(o(Bt),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["placeholder","modelValue"]),s(b,{onCommand:pt,trigger:"click"},{dropdown:n(()=>[s(v,{style:{width:"246px"}},{default:n(()=>[(c(),k(ee,null,Be(ue,x=>(c(),k(ee,{key:x.value},[s(i,{class:U(["ed-select-dropdown__item",x.value===f.curSortType&&"selected"]),command:x.value},{default:n(()=>[Q(j(x.name),1)]),_:2},1032,["class","command"]),x.divided?(c(),k("li",No)):z("",!0)],64))),64))]),_:1})]),default:n(()=>[s(o(N),{class:"filter-icon-span"},{default:n(()=>[s(r,{offset:16,effect:"dark",content:Se.value,placement:"top"},{default:n(()=>[f.curSortType.includes("asc")?(c(),w(o(D),{key:0,name:"dv-sort-asc",class:"opt-icon"},{default:n(()=>[s(o(Ot),{class:"svg-icon opt-icon"})]),_:1})):z("",!0)]),_:1},8,["content"]),s(r,{offset:16,effect:"dark",content:Se.value,placement:"top"},{default:n(()=>[f.curSortType.includes("desc")?(c(),w(o(D),{key:0,name:"dv-sort-desc",class:"opt-icon"},{default:n(()=>[s(o(Zt),{class:"svg-icon opt-icon"})]),_:1})):z("",!0)]),_:1},8,["content"])]),_:1})]),_:1})]),ke((c(),w(o(ht),{class:"custom-tree"},{default:n(()=>[s(me,{menu:"",ref_key:"resourceListTree",ref:R,"default-expanded-keys":O.value,data:f.resourceTree,props:V,"node-key":"id","highlight-current":"","expand-on-click-node":!0,"filter-node-method":tt,onNodeExpand:Qe,onNodeCollapse:et,onNodeClick:at,onNodeDragStart:o(Ge),"allow-drop":o(mt),onNodeDrop:o(Ae),draggable:""},{default:n(({node:x,data:C})=>[L("span",{class:U(["custom-tree-node",{"node-disabled-custom":C.extraFlag1===0}])},[C.leaf?o(a)==="dashboard"?(c(),w(o(N),{key:1,style:{"font-size":"18px"}},{default:n(()=>[C.extraFlag1?(c(),w(o(D),{key:0},{default:n(()=>[(c(),w(te(C.extraFlag?o(Dt):o(He))))]),_:2},1024)):z("",!0),C.extraFlag1?z("",!0):(c(),w(o(D),{key:1},{default:n(()=>[(c(),w(te(C.extraFlag?o(kt):o(Vo))))]),_:2},1024))]),_:2},1024)):(c(),w(o(N),{key:2,class:U(["icon-screen-new color-dataV",{"color-dataV":C.extraFlag1,"color-dataV-disabled":!C.extraFlag1}]),style:{"font-size":"18px"}},{default:n(()=>[s(o(D),{name:"icon_operation-analysis_outlined"},{default:n(()=>[s(o(Wt),{class:"svg-icon"})]),_:1})]),_:1},8,["class"])):(c(),w(o(N),{key:0,style:{"font-size":"18px"}},{default:n(()=>[s(o(D),{name:"dv-folder"},{default:n(()=>[s(o(Me),{class:"svg-icon"})]),_:1})]),_:1})),L("span",{title:x.label,class:"label-tooltip"},[s(r,{class:"box-item",effect:"dark",content:o(l)("visualization.publish_tips1"),disabled:C.extraFlag1,placement:"top-start"},{default:n(()=>[Q(j(x.label),1)]),_:2},1032,["content","disabled"])],8,zo),C.weight>=7&&o(d)==="preview"?(c(),k("div",Io,[C.leaf?(c(),w(o(N),{key:0,onClick:[e[5]||(e[5]=Oe(()=>{},["stop"])),Y=>Te(C.id)],class:"hover-icon"},{default:n(()=>[s(o(D),null,{default:n(()=>[s(o(qt),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])):z("",!0),C.leaf?z("",!0):(c(),w(o(Kt),{key:1,onHandleCommand:Y=>J(Y,C,Y==="newFolder"?"folder":"leaf"),"menu-list":qe.value,"icon-name":o(Lt),placement:"bottom-start"},null,8,["onHandleCommand","menu-list","icon-name"])),s(So,{onHandleCommand:Y=>lt(Y,C,C.leaf?"leaf":"folder"),node:C,"any-manage":m.value,"resource-type":o(a),"menu-list":C.leaf?Je(C.id):f.folderMenuList},null,8,["onHandleCommand","node","any-manage","resource-type","menu-list"])])):z("",!0)],2)]),_:1},8,["default-expanded-keys","data","onNodeDragStart","allow-drop","onNodeDrop"]),s(Xt,{"cur-canvas-type":o(a),onFinish:dt,ref_key:"resourceGroupOpt",ref:Z},null,8,["cur-canvas-type"]),s(so,{"cur-canvas-type":o(a),ref_key:"resourceCreateOpt",ref:Ce,onFinish:ct},null,8,["cur-canvas-type"])]),_:1})),[[_t,ce.value]])]),s(o(Ut),{ref_key:"openHandler",ref:X,jsname:"L2NvbXBvbmVudC9lbWJlZGRlZC1pZnJhbWUvT3BlbkhhbmRsZXI="},null,512)],64)}}});const Eo=co($o,[["__scopeId","data-v-6983f296"]]),va=Object.freeze(Object.defineProperty({__proto__:null,default:Eo},Symbol.toStringTag,{value:"Module"}));export{Eo as D,va as a,ze as d};

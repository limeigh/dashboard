import{p as ae,b as _t,c as ht,R as Ct,a as ne,z as gt}from"./index-0.0.0-dataease.js";import{E as wt}from"./el-tree-0.0.0-dataease.js";import"./el-checkbox-0.0.0-dataease.js";import{n as S,j as N,o as Ee,r as bt,v as yt,F as Vt,D as me,G as Tt,az as re,P as xt}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{a as Ie,b as $e,E as Re}from"./el-dropdown-menu-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import"./el-dropdown-item-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import{f as c,O as k,P as L,d as Fe,y as q,r as D,j as r,i as n,W as Y,a6 as Pe,S as A,a8 as Be,u as o,g as w,l as ee,_ as z,a3 as Q,a4 as G,af as St,t as Dt,X as kt,w as Lt,o as Ht,R as De,U as Mt,n as fe}from"./vue-0.0.0-dataease.js";import{d as Nt,a as zt}from"./dv-dashboard-spine-mobile-disabled-0.0.0-dataease.js";import{i as Et}from"./icon_add_outlined-0.0.0-dataease.js";import{m as It,o as $t,p as Rt,t as Ft,w as Pt,q as Bt}from"./dataVisualization-0.0.0-dataease.js";import{e as ke,_ as se,h as Ot}from"./lodash-0.0.0-dataease.js";import{d as ve}from"./dv-rename-0.0.0-dataease.js";import{d as Le}from"./dv-dashboard-spine-0.0.0-dataease.js";import{d as Zt}from"./dv-screen-spine-0.0.0-dataease.js";import{d as Wt,i as qt}from"./icon_file-add_outlined-0.0.0-dataease.js";import{i as At}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{d as Ut,a as jt}from"./dv-sort-desc-0.0.0-dataease.js";import{d as He}from"./dv-folder-0.0.0-dataease.js";import{i as Gt}from"./icon_operation-analysis_outlined-0.0.0-dataease.js";import{i as Jt}from"./icon_edit_outlined-0.0.0-dataease.js";import{_ as Kt}from"./HandleMore.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import Xt from"./DeResourceGroupOpt-0.0.0-dataease.js";import{d as Qt}from"./dvMain-0.0.0-dataease.js";import{useAppStoreWithOut as Yt}from"./app-0.0.0-dataease.js";import{i as eo}from"./icon_more_outlined-0.0.0-dataease.js";import to from"./ShareHandler-0.0.0-dataease.js";import{u as Oe}from"./share-0.0.0-dataease.js";import{i as oo}from"./ModelUtil-0.0.0-dataease.js";import{E as Ze}from"./index-0.0.0-dataease4.js";import{i as ao}from"./interactive-0.0.0-dataease.js";import{_ as no}from"./DeResourceCreateOptV2.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import{o as ro,G as so}from"./canvasUtils-0.0.0-dataease.js";import{a as lo,t as Me}from"./treeSortUtils-0.0.0-dataease.js";import{_ as io}from"./_plugin-vue_export-helper-0.0.0-dataease.js";const co={width:"20",height:"20",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"};function uo(h,u){return c(),k("svg",co,[...u[0]||(u[0]=[L("path",{d:"M6.43791 2.26348L2.3524 6.34898C2.17884 6.52255 2.17884 6.80395 2.3524 6.97752L6.83075 11.4559C7.00431 11.6294 7.28572 11.6294 7.45929 11.4559L8.00926 10.9059C8.18283 10.7323 8.18283 10.4509 8.00926 10.2774L4.9589 7.22552L12.2222 7.22219V7.22698C14.5234 7.22698 16.3889 9.09246 16.3889 11.3937C16.3889 13.6948 14.5234 15.5603 12.2222 15.5603V15.5555L8.9696 15.5597C8.72436 15.5601 8.52573 15.759 8.52573 16.0042V16.782C8.52573 16.9967 8.67808 17.1759 8.8806 17.2174L8.97075 17.2264L12 17.2214L12.2222 17.227C15.4439 17.227 18.0556 14.6153 18.0556 11.3937C18.0556 8.17199 15.4439 5.56032 12.2222 5.56032V5.55552L5.4989 5.55886L7.61642 3.44199C7.78999 3.26842 7.78999 2.98701 7.61642 2.81345L7.06645 2.26348C6.89288 2.08991 6.61148 2.08991 6.43791 2.26348Z"},null,-1)])])}const Ne={render:uo},po={width:"16",height:"16",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"};function mo(h,u){return c(),k("svg",po,[...u[0]||(u[0]=[L("path",{d:"M3.33333 5.33398V13.334H10V5.33398H3.33333ZM11.3333 4.66732V14.0747C11.3333 14.402 11.0548 14.6673 10.7111 14.6673H2.62222C2.27858 14.6673 2 14.402 2 14.0747V4.59324C2 4.26596 2.27858 4.00065 2.62222 4.00065H10.6667C11.0349 4.00065 11.3333 4.29913 11.3333 4.66732ZM13.8047 1.52925C13.9254 1.64989 14 1.81656 14 2.00065V10.334C14 10.5181 13.8508 10.6673 13.6667 10.6673H13C12.8159 10.6673 12.6667 10.5181 12.6667 10.334V2.66732H6.33333C6.14924 2.66732 6 2.51808 6 2.33398V1.66732C6 1.48322 6.14924 1.33398 6.33333 1.33398H13.3333C13.5174 1.33398 13.6841 1.4086 13.8047 1.52925Z"},null,-1)])])}const fo={render:mo},vo={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function _o(h,u){return c(),k("svg",vo,[...u[0]||(u[0]=[L("path",{d:"M5.33301 2.66732V2.00065C5.33301 1.63246 5.63148 1.33398 5.99967 1.33398H9.99967C10.3679 1.33398 10.6663 1.63246 10.6663 2.00065V2.66732H14.239C14.3876 2.66732 14.4415 2.68279 14.4958 2.71184C14.5501 2.74089 14.5928 2.78352 14.6218 2.83784C14.6509 2.89216 14.6663 2.94605 14.6663 3.09463V3.57334C14.6663 3.72192 14.6509 3.7758 14.6218 3.83013C14.5928 3.88445 14.5501 3.92708 14.4958 3.95613C14.4415 3.98518 14.3876 4.00065 14.239 4.00065H13.333V14.0007C13.333 14.3688 13.0345 14.6673 12.6663 14.6673H3.33301C2.96482 14.6673 2.66634 14.3688 2.66634 14.0007V4.00065H1.76032C1.61174 4.00065 1.55785 3.98518 1.50353 3.95613C1.44921 3.92708 1.40658 3.88445 1.37753 3.83013C1.34848 3.7758 1.33301 3.72192 1.33301 3.57334V3.09463C1.33301 2.94605 1.34848 2.89216 1.37753 2.83784C1.40658 2.78352 1.44921 2.74089 1.50353 2.71184C1.55785 2.68279 1.61174 2.66732 1.76032 2.66732H5.33301ZM3.99967 4.00065V13.334H11.9997V4.00065H3.99967ZM6.33301 5.33398H6.99967C7.18377 5.33398 7.33301 5.48322 7.33301 5.66732V11.6673C7.33301 11.8514 7.18377 12.0007 6.99967 12.0007H6.33301C6.14891 12.0007 5.99967 11.8514 5.99967 11.6673V5.66732C5.99967 5.48322 6.14891 5.33398 6.33301 5.33398ZM8.99967 5.33398H9.66634C9.85044 5.33398 9.99967 5.48322 9.99967 5.66732V11.6673C9.99967 11.8514 9.85044 12.0007 9.66634 12.0007H8.99967C8.81558 12.0007 8.66634 11.8514 8.66634 11.6673V5.66732C8.66634 5.48322 8.81558 5.33398 8.99967 5.33398Z",fill:"#646A73"},null,-1)])])}const _e={render:_o},ho={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Co(h,u){return c(),k("svg",ho,[...u[0]||(u[0]=[L("path",{d:"M14.0021 1.77734C14.3396 1.77734 14.6186 2.02815 14.6627 2.35355L14.6688 2.44401V13.5614C14.6688 13.8989 14.418 14.1779 14.0926 14.222L14.0021 14.2281H9.89167C9.73059 14.2281 9.59619 14.1138 9.56511 13.962L9.55834 13.8948V13.2281C9.55834 13.067 9.6726 12.9326 9.82449 12.9015L9.89167 12.8948H13.3355V3.11068H4.40563L4.40652 6.11325C4.40652 6.29735 4.25728 6.44659 4.07319 6.44659H3.40652C3.22243 6.44659 3.07319 6.29735 3.07319 6.11325V2.11068C3.07319 1.94959 3.18745 1.8152 3.33934 1.78412L3.40652 1.77734H14.0021ZM6.64113 7.59282C6.73925 7.59282 6.83418 7.6276 6.90908 7.69097L9.70393 10.0559C9.87882 10.2038 9.90063 10.4656 9.75265 10.6405C9.73779 10.658 9.72149 10.6743 9.70393 10.6892L6.90908 13.0541C6.73419 13.202 6.47245 13.1802 6.32447 13.0053C6.26109 12.9304 6.22632 12.8355 6.22632 12.7374L6.22681 11.1164L2.11165 11.1164C1.92756 11.1164 1.77832 10.9672 1.77832 10.7831V10.1164C1.77832 9.93231 1.92756 9.78307 2.11165 9.78307L6.22681 9.78305L6.22632 8.00764C6.22632 7.77854 6.41204 7.59282 6.64113 7.59282Z",fill:"#646A73"},null,-1)])])}const he={render:Co},go=(h,u,J)=>{let F="",T="",y=0,H=[];const P=(m,a)=>{m.forEach((d,_)=>{var p;d.id===T&&(y=_,F=a),(p=d.children)!=null&&p.length&&P(d.children,d.id)})},C=(m,a)=>{m.forEach(d=>{var p;const _=a.findIndex(M=>M===d.id);_!==-1&&a.splice(_,1),(p=d.children)!=null&&p.length&&a.length===2&&C(d.children,a)})},E=(m,a,d)=>{m.forEach(_=>{var p;_.id===d.id&&(d.pid=a),(p=_.children)!=null&&p.length&&E(_.children,_.id,d)})},l=(m,a)=>{m.forEach(d=>{var _;d.id===F&&d.children.splice(y,0,a),(_=d.children)!=null&&_.length&&l(d.children,a)})},I=(m,a)=>{m.forEach((d,_)=>{var p;d.id===a.id&&m.splice(_,1),(p=d.children)!=null&&p.length&&I(d.children,a)})};return{handleDrop:async(m,a,d)=>{var p,M,W,O,R;const _={id:(p=m.data)==null?void 0:p.id,name:(M=m.data)==null?void 0:M.name,nodeType:(W=m.data)!=null&&W.leaf?"leaf":"folder",pid:"0",opt:"move",type:J};if(d!=="inner"){const Z=[_.id,(O=a.data)==null?void 0:O.id];if(C(H,Z),Z.length===0){I(h[u],m.data),setTimeout(()=>{F==="0"?h[u].splice(y,0,m.data):l(h[u],m.data)},0);return}}try{await It(_)}catch(Z){console.error(Z)}delete _.opt,d==="inner"?_.pid=(R=a.data)==null?void 0:R.id:E(h[u],"0",_),$t(_).then(()=>{h.originResourceTree=ke(h[u])}).catch(()=>{if(F==="0"){h[u].splice(y,0,m.data);return}l(h[u],m.data)})},allowDrop:(m,a)=>{var d;return!((d=a.data)!=null&&d.leaf)},handleDragStart:m=>{T=m.data.id,H=ke(h[u]),P(h[u],"0")}}},wo={width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function bo(h,u){return c(),k("svg",wo,[...u[0]||(u[0]=[L("path",{d:"M0 3C0 1.34315 1.59845 0 3.57025 0H14.4298C16.4015 0 18 1.34315 18 3V15C18 16.6569 16.4015 18 14.4298 18H3.57025C1.59845 18 0 16.6569 0 15V3Z",fill:"#BBBFC4"},null,-1),L("path",{d:"M4.25 13V8.77273C4.25 8.48403 4.48985 8.25 4.78571 8.25H7V4.52632C7 4.23564 7.25584 4 7.57143 4H10.4286C10.7442 4 11 4.23564 11 4.52632V7H13.2143C13.5102 7 13.75 7.22386 13.75 7.5V13H14C14.1381 13 14.25 13.1119 14.25 13.25V13.75C14.25 13.8881 14.1381 14 14 14H4C3.86193 14 3.75 13.8881 3.75 13.75V13.25C3.75 13.1119 3.86193 13 4 13H4.25ZM12.75 13V8H11V13H12.75ZM10 13V5H8V13H10ZM7 13V9.25H5.25V13H7Z",fill:"white"},null,-1)])])}const yo={render:bo},Vo={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function To(h,u){return c(),k("svg",Vo,[...u[0]||(u[0]=[L("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M17.0855 1.00006H4C3.73478 1.00006 3.48043 1.10542 3.29289 1.29295C3.10536 1.48049 3 1.73484 3 2.00006V22.0001C3 22.2653 3.10536 22.5196 3.29289 22.7072C3.48043 22.8947 3.73478 23.0001 4 23.0001H20C20.2652 23.0001 20.5196 22.8947 20.7071 22.7072C20.8946 22.5196 21 22.2653 21 22.0001V4.91556C21.0001 4.65044 20.8949 4.39614 20.7075 4.20856L17.793 1.29306C17.7001 1.20014 17.5898 1.12643 17.4684 1.07616C17.347 1.02588 17.2169 1.00002 17.0855 1.00006ZM7 8.5C7 8.22386 7.22386 8 7.5 8H16.5C16.7761 8 17 8.22386 17 8.5V9.5C17 9.77614 16.7761 10 16.5 10H7.5C7.22386 10 7 9.77614 7 9.5V8.5ZM11 12.5C11 12.2239 11.2239 12 11.5 12H16.5C16.7761 12 17 12.2239 17 12.5V17.5C17 17.7761 16.7761 18 16.5 18H11.5C11.2239 18 11 17.7761 11 17.5V12.5ZM7 12.5C7 12.2239 7.22386 12 7.5 12H8.5C8.77614 12 9 12.2239 9 12.5V17.5C9 17.7761 8.77614 18 8.5 18H7.5C7.22386 18 7 17.7761 7 17.5V12.5Z",fill:"#FF8800"},null,-1)])])}const ze={render:To},xo=Fe({__name:"DvHandleMore",props:{menuList:{type:Array},placement:{type:String,default:"bottom-end"},iconName:ae.string.def(""),inTable:ae.bool.def(!1),resourceType:ae.string.def("dashboard"),node:{type:Object,default(){return{}}},anyManage:ae.bool.def(!1)},emits:["handleCommand"],setup(h,{emit:u}){const J=Oe(),{t:F}=Ee(),T=h,y=q(()=>J.getShareDisable||oo()),H=D(null),P=D([...T.menuList.map(V=>(!T.anyManage&&(V.command==="copy"||V.command==="move")&&(V.hidden=!0),V))]),C=V=>{if(V==="share"){H.value.execute();return}l("handleCommand",V)},E=V=>{var $;y.value||T.node.leaf&&(($=T.node)==null?void 0:$.weight)>=7&&P.value.splice(0,0,V)},l=u,I=V=>V.disabled||T.node.extraFlag1===0&&["share","copy"].includes(V.command);return(V,$)=>{const B=N,m=Ze,a=Re,d=Ie,_=$e;return c(),k(Y,null,[r(_,{"popper-class":"menu-more-dv_popper",placement:h.placement,trigger:"click",onCommand:C},{dropdown:n(()=>[r(d,null,{default:n(()=>[(c(!0),k(Y,null,Pe(P.value,p=>(c(),w(a,{divided:p.divided,command:p.command,key:p.label,disabled:I(p),class:A({"de-hidden-drop-item":p.hidden||p.command==="cancelPublish"&&h.node.extraFlag1===0})},{default:n(()=>[p.svgName?(c(),w(B,{key:0,class:"handle-icon",color:"#646a73",size:"16"},{default:n(()=>[r(o(S),null,{default:n(()=>[(c(),w(ee(p.svgName),{class:A(["svg-icon",{"custom-disable":I(p)}])},null,8,["class"]))]),_:2},1024)]),_:2},1024)):z("",!0),r(m,{class:"box-item",effect:"dark",content:o(F)("visualization.publish_tips2",[p.label]),disabled:!I(p),placement:"top-start"},{default:n(()=>[Q(G(p.label),1)]),_:2},1032,["content","disabled"])]),_:2},1032,["divided","command","disabled","class"]))),128))]),_:1})]),default:n(()=>[r(B,{class:A(["hover-icon",h.inTable&&"hover-icon-in-table"]),onClick:$[0]||($[0]=Be(()=>{},["stop"]))},{default:n(()=>[r(o(S),null,{default:n(()=>[(c(),w(ee(h.iconName||o(eo)),{class:"svg-icon"}))]),_:1})]),_:1},8,["class"])]),_:1},8,["placement"]),y.value?z("",!0):(c(),w(to,{key:0,ref_key:"shareComponent",ref:H,"resource-id":T.node.id,"resource-type":T.resourceType,weight:h.node.weight,onLoaded:E},null,8,["resource-id","resource-type","weight"]))],64)}}});const So={class:"resource-tree"},Do={class:"tree-header"},ko={class:"icon-methods"},Lo={class:"title"},Ho={key:0,class:"flex-align-center"},Mo={key:0,class:"ed-dropdown-menu__item--divided"},No=["title"],zo={key:3,class:"icon-more"},Eo=Fe({__name:"DeResourceTree",props:{curCanvasType:{type:String,required:!0},showPosition:{required:!1,type:String,default:"preview"},resourceTable:{required:!1,type:String,default:"core"}},emits:["nodeClick"],setup(h,{expose:u,emit:J}){const F=Oe(),T=ao(),{wsCache:y}=_t(),H=Qt(),P=Yt(),C=ht(),{dvInfo:E}=St(H),{t:l}=Ee(),I=h,V={children:"children",label:"name",disabled:t=>t.extraFlag1===0},$=D(!1),B=D(!1),m=D(!1),{curCanvasType:a,showPosition:d}=Dt(I),_=a.value==="dataV"?l("work_branch.big_data_screen"):l("work_branch.dashboard"),p=a.value==="dataV"?l("visualization.new_screen"):l("visualization.new_dashboard"),M=D(null),W=D(null),O=D([]),R=D(),Z=D(),Ce=D(),le=D(!1),f=kt({pWeightMap:{},curSortType:"time_desc",resourceTree:[],originResourceTree:[],folderMenuList:[{label:l("visualization.move_to"),command:"move",svgName:he},{label:l("visualization.rename"),command:"rename",svgName:ve},{label:l("visualization.delete"),command:"delete",svgName:_e,divided:!0}],sortType:[{label:l("visualization.time_asc"),value:"time_asc"},{label:l("visualization.time_desc"),value:"time_desc"},{label:l("visualization.name_asc"),value:"name_asc"},{label:l("visualization.name_desc"),value:"name_desc"}],templateCreatePid:0}),ge=q(()=>a.value==="dashboard"?Le:Zt),te=q(()=>P.getIsDataEaseBi||P.getIsIframe),We=q(()=>[{label:l("work_branch.new_empty"),svgName:ge.value,command:"newLeaf"},{label:l("work_branch.new_using_template"),svgName:ze,command:"newFromTemplate"},{label:l("work_branch.new_folder"),divided:!0,svgName:He,command:"newFolder"}]),{handleDrop:qe,allowDrop:Ae,handleDragStart:Ue}=go(f,"resourceTree",a.value),je=t=>f.pWeightMap[t]<7?Je:Ge,Ge=[{label:l("visualization.cancel_publish"),command:"cancelPublish",svgName:Ne},{label:l("visualization.copy"),command:"copy",svgName:fo,divided:!0},{label:l("visualization.move_to"),command:"move",svgName:he},{label:l("visualization.rename"),command:"rename",svgName:ve},{label:l("visualization.delete"),command:"delete",svgName:_e,divided:!0}],Je=[{label:l("visualization.cancel_publish"),command:"cancelPublish",svgName:Ne},{label:l("visualization.move_to"),command:"move",svgName:he,divided:!0},{label:l("visualization.rename"),command:"rename",svgName:ve},{label:l("visualization.delete"),command:"delete",svgName:_e,divided:!0}],Ke=y.get(a.value==="dashboard"?"db-info-id":"dv-info-id"),Xe=bt.currentRoute.value.query.dvId,we=C.dvId||Ke||Xe;y.delete(a.value==="dashboard"?"db-info-id":"dv-info-id"),we&&d.value==="preview"&&(M.value=we,le.value=!0);const Qe=t=>{t.id&&O.value.push(t.id)},Ye=t=>{t.id&&O.value.splice(O.value.indexOf(t.id),1)},et=(t,e)=>{var s,i;return d.value==="multiplexing"&&e.id===((s=E.value)==null?void 0:s.id)?!1:t?(i=e.name)==null?void 0:i.toLocaleLowerCase().includes(t.toLocaleLowerCase()):!0},tt=()=>{re("/dataVisualization/findById"),re("/chartData/getData"),re("/linkage/getVisualizationAllLinkageInfo/**"),re("/linkJump/queryVisualizationJumpInfo/**")},ot=(t,e)=>{if(H.setCurComponent({component:null,index:null}),d.value!=="multiplexing"&&H.setEditMode("preview"),e.disabled)fe(()=>{const s=R.value.$el.querySelector(".is-current");s&&s.classList.remove("is-current")});else if(tt(),M.value=t.id,t.leaf){if(!C.baseUrl){let s=window.location.href;const i="dvId",v=t.id;if(s.includes("?")){const b=new RegExp(`([?&])${i}=[^&]*`);b.test(s)?s=s.replace(b,`$1${i}=${v}`):s+=`&${i}=${v}`}else s+=`?${i}=${v}`;window.history.replaceState({path:s},"",s)}rt("nodeClick",t)}else R.value.setCurrentKey(null)},ie=async()=>{const t={busiFlag:a.value,resourceTable:I.resourceTable},e=a.value=="dashboard";await T.setInteractive(t);const s=e?T.getPanel:T.getScreen,i=s.treeNodes;B.value=s.rootManage,m.value=s.anyManage,E.value&&E.value.id&&!JSON.stringify(i).includes(E.value.id)&&d.value!=="multiplexing"&&H.resetDvInfo();let v=ce[Number(y.get("TreeSort-backend"))??1].value;if(v=y.get(`TreeSort-${a.value}`)??v,i.length&&i[0].id==="0"&&i[0].name==="root"){f.originResourceTree=i[0].children||[],Se(v),ye();return}f.originResourceTree=i,Se(v),ye()},at=q(()=>se.filter(be(f.resourceTree),t=>t.leaf)),nt=q(()=>at.value.length>0);function be(t){let e=se.cloneDeep(t);return se.forEach(t,s=>{s.children&&s.children.length>0&&(e=se.union(e,be(s.children)))}),e}const ye=()=>{f.pWeightMap=lo(f.originResourceTree,B.value?9:0),$.value=!0,M.value&&le.value&&(O.value=ct(),le.value=!1),ro({type:a.value},"resource_tree_init_ready"),fe(()=>{R.value.setCurrentKey(M.value),R.value.filter(W.value),fe(()=>{var t,e;(e=(t=document.querySelector(".is-current"))==null?void 0:t.firstChild)==null||e.click()})})},de=D(!1),U=y.get("open-backend")==="1"?"_self":"_blank",rt=J,st=(t,e,s)=>{if(t==="delete"){const i=e.leaf?"":l("visualization.delete_tips"),v=e.leaf?_:l("visualization.folder");Vt.confirm(l("visualization.delete_warn",[v]),{confirmButtonType:"danger",type:"warning",tip:i,autofocus:!1,showClose:!1}).then(()=>{Rt(e.id,a.value).then(()=>{me.success(l("visualization.delete_success")),ie()})})}else if(t==="cancelPublish"){const i={id:e.id,nodeType:"leaf",name:e.name,type:a.value,mobileLayout:e==null?void 0:e.extraFlag,status:0};Ft(i).then(()=>{e.extraFlag1=0,E.value.id===e.id&&H.updateDvInfoCall(0),me.warning(l("visualization.cancel_publish_tips"))})}else if(t==="edit")Ve(e.id);else if(t==="copy"){const i=so(f.resourceTree,e.id),v={nodeType:s,name:e.name+"-copy",type:a.value,id:e.id,pid:i||"0"};de.value=!0,Pt(v).then(b=>{const ue=a.value==="dataV"?`#/dvCanvas?opt=copy&pid=${v.pid}&dvId=${b.data}`:`#/dashboard?opt=copy&pid=${v.pid}&resourceId=${b.data}`;if(te.value){C.clearState(),C.setPid(v.pid),C.setOpt("copy"),a.value==="dataV"?C.setDvId(b.data):C.setResourceId(b.data),ne().emitter.emit("changeCurrentComponent",a.value==="dataV"?"VisualizationEditor":"DashboardEditor");return}const pe=window.open(ue,U);oe(pe)}).finally(()=>{de.value=!1})}else Z.value.optInit(s,e,t,["copy"].includes(t))},j=(t,e,s,i)=>{if(t==="newLeaf"){const v=a.value==="dataV"?"#/dvCanvas?opt=create":"#/dashboard?opt=create";let b=null;if(te.value){C.clearState(),C.setOpt("create"),e!=null&&e.id&&C.setPid(e==null?void 0:e.id),ne().emitter.emit("changeCurrentComponent",a.value==="dataV"?"VisualizationEditor":"DashboardEditor");return}e!=null&&e.id?b=window.open(v+`&pid=${e.id}`,U):b=window.open(v,U),oe(b)}else if(t==="newFromTemplate"){const v={curPosition:"create",pid:e==null?void 0:e.id,templateType:a.value==="dataV"?"SCREEN":"PANEL"};Ce.value.optInit(v)}else Z.value.optInit(s,e||{},t,i)};function lt(){return j("newLeaf",null,"leaf",!0)}const Ve=t=>{const e=a.value==="dataV"?"#/dvCanvas?dvId=":"#/dashboard?resourceId=";if(te.value){C.clearState(),a.value==="dataV"?C.setDvId(t):C.setResourceId(t),ne().emitter.emit("changeCurrentComponent",a.value==="dataV"?"VisualizationEditor":"DashboardEditor");return}const s=window.open(e+t,U);oe(s)},it=()=>{ie()},dt=t=>{y.set("de-template-data",JSON.stringify(t));const e=a.value==="dataV"?"#/dvCanvas?opt=create&createType=template":"#/dashboard?opt=create&createType=template";let s=null;if(te.value){C.clearState(),C.setOpt("create"),C.setCreateType("template"),f.templateCreatePid&&C.setPid(f.templateCreatePid),ne().emitter.emit("changeCurrentComponent",a.value==="dataV"?"VisualizationEditor":"DashboardEditor");return}f.templateCreatePid?s=window.open(e+`&pid=${f.templateCreatePid}`,U):s=window.open(e,U),oe(s)},Te=(t,e,s=[])=>{for(const i of t){if(i.id===e)return s;if(i.children){const v=[...s,i.id],b=Te(i.children,e,v);if(b)return b}}return null},ct=()=>{const t=Te(f.resourceTree,M.value);return t?[M.value,...t]:[]},ce=[{name:l("visualization.time_asc"),value:"time_asc"},{name:l("visualization.time_desc"),value:"time_desc",divided:!0},{name:l("visualization.name_asc"),value:"name_asc"},{name:l("visualization.name_desc"),value:"name_desc"}],xe=q(()=>ce.find(t=>t.value===f.curSortType).name),ut=t=>{f.resourceTree=Me(f.originResourceTree,t),f.curSortType=t,y.set("TreeSort-"+a.value,f.curSortType)},Se=t=>{f.resourceTree=Me(f.originResourceTree,t),f.curSortType=t},pt=Ot((t,e)=>{const i=["dashboard","dataV","dataset","datasource"].findIndex(v=>v===a.value);return i<0||!xt(e,i+1)?Ae(t,e):(me.warning(l("free.save_error")),!1)},300);Lt(W,t=>{R.value.filter(t)});const K=D(null),oe=t=>{if(K!=null&&K.value){const e={methodName:"initOpenHandler",args:t};K.value.invokeMethod(e)}},mt=()=>{const t=y.get("TreeSort-"+a.value);t&&(f.curSortType=t)},ft=()=>{Bt().then(t=>{var s,i;const e={shareDisable:(s=t.data)==null?void 0:s.disable,sharePeRequire:(i=t.data)==null?void 0:i.peRequire};F.setData(e)})};return Ht(()=>{mt(),ie(),ft()}),u({rootManage:B,hasData:nt,createNewObject:lt,mounted:$}),(t,e)=>{const s=Ze,i=Re,v=Ie,b=$e,ue=Tt,pe=wt,vt=gt;return c(),k(Y,null,[L("div",So,[L("div",Do,[De(L("div",ko,[L("span",Lo,G(o(_)),1),B.value?(c(),k("div",Ho,[r(s,{content:o(l)("work_branch.new_folder"),placement:"top",effect:"dark"},{default:n(()=>[r(o(N),{class:"custom-icon btn",style:{"margin-right":"20px"},onClick:e[0]||(e[0]=x=>j("newFolder",null,"folder"))},{default:n(()=>[r(o(S),{name:"dv-new-folder"},{default:n(()=>[r(o(Wt),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["content"]),r(s,{content:o(p),placement:"top",effect:"dark"},{default:n(()=>[r(b,{"popper-class":"menu-outer-dv_popper",trigger:"hover"},{dropdown:n(()=>[r(v,null,{default:n(()=>[r(i,{onClick:e[2]||(e[2]=x=>j("newLeaf",null,"leaf",!0))},{default:n(()=>[r(o(N),{class:A(`handle-icon color-${o(a)}`)},{default:n(()=>[r(o(S),null,{default:n(()=>[(c(),w(ee(ge.value),{class:"svg-icon"}))]),_:1})]),_:1},8,["class"]),Q(" "+G(o(l)("work_branch.new_empty")),1)]),_:1}),r(i,{onClick:e[3]||(e[3]=x=>j("newFromTemplate",null,"leaf",!0))},{default:n(()=>[r(o(N),{class:"handle-icon"},{default:n(()=>[r(o(S),{name:"dv-use-template"},{default:n(()=>[r(o(ze),{class:"svg-icon"})]),_:1})]),_:1}),Q(" "+G(o(l)("work_branch.new_using_template")),1)]),_:1})]),_:1})]),default:n(()=>[r(o(N),{class:"custom-icon btn",onClick:e[1]||(e[1]=x=>j("newLeaf",null,"leaf",!0))},{default:n(()=>[r(o(S),{name:"icon_file-add_outlined"},{default:n(()=>[r(o(qt),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),_:1},8,["content"])])):z("",!0)],512),[[Mt,o(d)==="preview"]]),r(ue,{placeholder:o(l)("commons.search"),modelValue:W.value,"onUpdate:modelValue":e[4]||(e[4]=x=>W.value=x),clearable:"",class:"search-bar"},{prefix:n(()=>[r(o(N),null,{default:n(()=>[r(o(S),{name:"icon_search-outline_outlined"},{default:n(()=>[r(o(At),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["placeholder","modelValue"]),r(b,{onCommand:ut,trigger:"click"},{dropdown:n(()=>[r(v,{style:{width:"246px"}},{default:n(()=>[(c(),k(Y,null,Pe(ce,x=>(c(),k(Y,{key:x.value},[r(i,{class:A(["ed-select-dropdown__item",x.value===f.curSortType&&"selected"]),command:x.value},{default:n(()=>[Q(G(x.name),1)]),_:2},1032,["class","command"]),x.divided?(c(),k("li",Mo)):z("",!0)],64))),64))]),_:1})]),default:n(()=>[r(o(N),{class:"filter-icon-span"},{default:n(()=>[r(s,{offset:16,effect:"dark",content:xe.value,placement:"top"},{default:n(()=>[f.curSortType.includes("asc")?(c(),w(o(S),{key:0,name:"dv-sort-asc",class:"opt-icon"},{default:n(()=>[r(o(Ut),{class:"svg-icon opt-icon"})]),_:1})):z("",!0)]),_:1},8,["content"]),r(s,{offset:16,effect:"dark",content:xe.value,placement:"top"},{default:n(()=>[f.curSortType.includes("desc")?(c(),w(o(S),{key:0,name:"dv-sort-desc",class:"opt-icon"},{default:n(()=>[r(o(jt),{class:"svg-icon opt-icon"})]),_:1})):z("",!0)]),_:1},8,["content"])]),_:1})]),_:1})]),De((c(),w(o(Ct),{class:"custom-tree"},{default:n(()=>[r(pe,{menu:"",ref_key:"resourceListTree",ref:R,"default-expanded-keys":O.value,data:f.resourceTree,props:V,"node-key":"id","highlight-current":"","expand-on-click-node":!0,"filter-node-method":et,onNodeExpand:Qe,onNodeCollapse:Ye,onNodeClick:ot,onNodeDragStart:o(Ue),"allow-drop":o(pt),onNodeDrop:o(qe),draggable:""},{default:n(({node:x,data:g})=>[L("span",{class:A(["custom-tree-node",{"node-disabled-custom":g.extraFlag1===0}])},[g.leaf?o(a)==="dashboard"?(c(),w(o(N),{key:1,style:{"font-size":"18px"}},{default:n(()=>[g.extraFlag1?(c(),w(o(S),{key:0},{default:n(()=>[(c(),w(ee(g.extraFlag?o(Nt):o(Le))))]),_:2},1024)):z("",!0),g.extraFlag1?z("",!0):(c(),w(o(S),{key:1},{default:n(()=>[(c(),w(ee(g.extraFlag?o(zt):o(yo))))]),_:2},1024))]),_:2},1024)):(c(),w(o(N),{key:2,class:A(["icon-screen-new color-dataV",{"color-dataV":g.extraFlag1,"color-dataV-disabled":!g.extraFlag1}]),style:{"font-size":"18px"}},{default:n(()=>[r(o(S),{name:"icon_operation-analysis_outlined"},{default:n(()=>[r(o(Gt),{class:"svg-icon"})]),_:1})]),_:1},8,["class"])):(c(),w(o(N),{key:0,style:{"font-size":"18px"}},{default:n(()=>[r(o(S),{name:"dv-folder"},{default:n(()=>[r(o(He),{class:"svg-icon"})]),_:1})]),_:1})),L("span",{title:x.label,class:"label-tooltip"},[r(s,{class:"box-item",effect:"dark",content:o(l)("visualization.publish_tips1"),disabled:g.extraFlag1,placement:"top-start"},{default:n(()=>[Q(G(x.label),1)]),_:2},1032,["content","disabled"])],8,No),g.weight>=7&&o(d)==="preview"?(c(),k("div",zo,[g.leaf?(c(),w(o(N),{key:0,onClick:[e[5]||(e[5]=Be(()=>{},["stop"])),X=>Ve(g.id)],class:"hover-icon"},{default:n(()=>[r(o(S),null,{default:n(()=>[r(o(Jt),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])):z("",!0),g.leaf?z("",!0):(c(),w(o(Kt),{key:1,onHandleCommand:X=>j(X,g,X==="newFolder"?"folder":"leaf"),"menu-list":We.value,"icon-name":o(Et),placement:"bottom-start"},null,8,["onHandleCommand","menu-list","icon-name"])),r(xo,{onHandleCommand:X=>st(X,g,g.leaf?"leaf":"folder"),node:g,"any-manage":m.value,"resource-type":o(a),"menu-list":g.leaf?je(g.id):f.folderMenuList},null,8,["onHandleCommand","node","any-manage","resource-type","menu-list"])])):z("",!0)],2)]),_:1},8,["default-expanded-keys","data","onNodeDragStart","allow-drop","onNodeDrop"]),r(Xt,{"cur-canvas-type":o(a),onFinish:it,ref_key:"resourceGroupOpt",ref:Z},null,8,["cur-canvas-type"]),r(no,{"cur-canvas-type":o(a),ref_key:"resourceCreateOpt",ref:Ce,onFinish:dt},null,8,["cur-canvas-type"])]),_:1})),[[vt,de.value]])]),r(o(yt),{ref_key:"openHandler",ref:K,jsname:"L2NvbXBvbmVudC9lbWJlZGRlZC1pZnJhbWUvT3BlbkhhbmRsZXI="},null,512)],64)}}});const Io=io(Eo,[["__scopeId","data-v-e696f009"]]),Ca=Object.freeze(Object.defineProperty({__proto__:null,default:Io},Symbol.toStringTag,{value:"Module"}));export{Io as D,Ca as a,Ne as d};

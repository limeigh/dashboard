import{M as ea,r as ta,e as tt,E as Ue,f as aa,v as na}from"./element-plus-secondary-0.0.0-dataease.js";import{j as vt,k as ia,h as la,f as oa}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{o as P,c as te,a as _e,d as gt,t as Rt,r as O,l as it,x as jt,k as I,W as z,Z as de,u as o,Y as nt,R as ee,z as mt,U as G,S as qt,w as Ye,a7 as ra,n as xe,b as sa,$ as dt,T as K,X as ua,a9 as ca,a0 as da,a1 as fa,q as va}from"./@vue-0.0.0-dataease.js";import{i as ma}from"./icon_info_outlined-0.0.0-dataease.js";import pa from"./ChartComponentG2Plot-0.0.0-dataease.js";import{b as ha}from"./chart-0.0.0-dataease2.js";import{d as yt,v as ga}from"./dvMain-0.0.0-dataease.js";import{r as At,e as ya,f as wa}from"./canvasStyle-0.0.0-dataease.js";import{i as ka,l as xa,f as Ht,a as Ca,u as J,o as ba,g as ft}from"./index-0.0.0-dataease.js";import{l as Y,v as _a,ar as be,m as Ce,B as Sa,as as Ot,u as Da,p as Ia,k as Ta}from"./chart-0.0.0-dataease.js";import{s as wt}from"./pinia-0.0.0-dataease.js";import{x as La,P as Fa,Q as Pa,R as Ea}from"./canvasUtils-0.0.0-dataease.js";import{V as Aa}from"./ViewTrackBar-0.0.0-dataease.js";import{C as Ee,h as pt,E as Oa}from"./lodash-es-0.0.0-dataease.js";import{_ as Nt}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import{useAppearanceStoreWithOut as Ma}from"./appearance-0.0.0-dataease.js";import{useAppStoreWithOut as Va}from"./app-0.0.0-dataease.js";import{_ as Ra}from"./PluginComponent.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import ja from"./DrillPath-0.0.0-dataease.js";import{d as Fe}from"./dayjs-0.0.0-dataease.js";import{k as qa,g as ht}from"./time-format-0.0.0-dataease.js";import{d as Ha}from"./time-format-dayjs-0.0.0-dataease.js";import Na from"./ChartComponentS2-0.0.0-dataease.js";import{a as Ba,b as Ae,c as Mt}from"./index-0.0.0-dataease12.js";import{g as at}from"./js-base64-0.0.0-dataease.js";import Ya from"./DeRichTextView-0.0.0-dataease.js";import za from"./Component-0.0.0-dataease12.js";import $a from"./ChartEmptyInfo-0.0.0-dataease.js";import{s as Ja}from"./snapshot-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import{u as Wa}from"./vue-router_2-0.0.0-dataease.js";const Ua={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Ga(r,c){return P(),te("svg",Ua,[...c[0]||(c[0]=[_e("path",{d:"M8.622 5.77734C8.76928 5.77734 8.88867 5.89674 8.88867 6.04401V6.84401C8.88867 6.99129 8.76928 7.11068 8.622 7.11068H6.88867C6.77958 7.11068 6.68885 7.18929 6.67003 7.29295L6.66645 7.3329V12.6662C6.66645 12.7753 6.74506 12.8661 6.84873 12.8849L6.88867 12.8885H13.9998C14.1089 12.8885 14.1996 12.8098 14.2184 12.7062L14.222 12.6662V7.3329C14.222 7.22381 14.1434 7.13307 14.0397 7.11426L13.9998 7.11068H12.2664C12.1192 7.11068 11.9998 6.99129 11.9998 6.84401V6.04401C11.9998 5.89674 12.1192 5.77734 12.2664 5.77734H13.9998C14.8303 5.77734 15.5087 6.42813 15.553 7.24755L15.5553 7.3329V12.6662C15.5553 13.4967 14.9045 14.1752 14.0851 14.2195L13.9998 14.2218H6.88867C6.0582 14.2218 5.37973 13.571 5.33542 12.7516L5.33312 12.6662V7.3329C5.33312 6.50243 5.98391 5.82395 6.80332 5.77965L6.88867 5.77734H8.622ZM9.55534 1.77734C10.3858 1.77734 11.0643 2.42813 11.1086 3.24755L11.1109 3.3329V8.66623C11.1109 9.49671 10.4601 10.1752 9.64069 10.2195L9.55534 10.2218H7.822C7.67473 10.2218 7.55534 10.1024 7.55534 9.95512V9.15512C7.55534 9.00785 7.67473 8.88846 7.822 8.88846H9.55534C9.66443 8.88846 9.75516 8.80984 9.77398 8.70618L9.77756 8.66623V3.3329C9.77756 3.22381 9.69895 3.13307 9.59528 3.11426L9.55534 3.11068H2.44423C2.33513 3.11068 2.2444 3.18929 2.22559 3.29295L2.22201 3.3329V8.66623C2.22201 8.77533 2.30062 8.86606 2.40428 8.88488L2.44423 8.88846H4.17756C4.32484 8.88846 4.44423 9.00785 4.44423 9.15512V9.95512C4.44423 10.1024 4.32484 10.2218 4.17756 10.2218H2.44423C1.61375 10.2218 0.935282 9.571 0.890973 8.75158L0.888672 8.66623V3.3329C0.888672 2.50243 1.53946 1.82395 2.35888 1.77965L2.44423 1.77734H9.55534Z",fill:"currentColor"},null,-1)])])}const Za={render:Ga},Xa={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function Qa(r,c){return P(),te("svg",Xa,[...c[0]||(c[0]=[_e("path",{d:"M11.9858 11L10.5036 9.51778C10.3083 9.32252 10.3083 9.00594 10.5036 8.81067L11.2107 8.10357C11.4059 7.90831 11.7225 7.90831 11.9178 8.10357L15.4749 11.6607C15.6701 11.8559 15.6701 12.1725 15.4749 12.3678L11.9393 15.9033C11.7441 16.0986 11.4275 16.0986 11.2322 15.9033L10.5251 15.1962C10.3299 15.0009 10.3299 14.6844 10.5251 14.4891L12.0142 13H2.5C2.22386 13 2 12.7762 2 12.5V11.5C2 11.2239 2.22386 11 2.5 11H11.9858ZM4 4V9H2V3C2 2.49625 2.47102 2 3 2H21C21.529 2 22 2.49625 22 3V21C22 21.5037 21.529 22 21 22H3C2.47102 22 2 21.5037 2 21V15H4V20H20V4H4Z",fill:"currentColor"},null,-1)])])}const Ka={render:Qa},en={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function tn(r,c){return P(),te("svg",en,[...c[0]||(c[0]=[_e("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M5.34423 1.50735C5.34246 1.22627 5.56945 0.999292 5.85087 1.00071L18.271 1C18.5524 1.00141 18.7787 1.22769 18.7766 1.50558L18.7791 2.49801C18.7773 2.77554 18.5503 3.00253 18.2724 3.00465L16.0653 3.0043L16.0646 7.53066C16.0646 7.66501 16.1588 7.79441 16.2507 7.88634L20.3954 12.6558C20.4908 12.7512 20.5449 12.881 20.5449 13.0153L20.5439 14.3245C20.5453 14.606 20.3187 14.8326 20.0372 14.8312L13.0651 14.8337L13.065 18H15.3988C15.9133 18 16.1892 18.605 15.8519 18.9934L12.4531 22.9077C12.2138 23.1832 11.7862 23.1832 11.5469 22.9077L8.14813 18.9934C7.81084 18.605 8.08675 18 8.60119 18H11.0371L11.0372 14.8322L4.0505 14.8313C3.77272 14.8333 3.54644 14.607 3.54492 14.3257L3.54584 13.0166C3.54588 12.8822 3.5981 12.7522 3.6931 12.6572L7.84885 7.88775C7.94395 7.79264 8.05642 7.66254 8.05642 7.52819L8.05678 3.00217L5.84875 3.00182C5.57086 3.00394 5.34459 2.77767 5.34317 2.49624L5.34423 1.50735ZM10.0578 3.00197L10.061 8.39982L6.19585 12.8316L11 12.8331C11.1142 12.8334 11.5511 12.8334 11.991 12.8334C12.4309 12.8334 12.8738 12.8334 13 12.8337L17.8942 12.8351L14.0678 8.41842L14.0624 2.99973L10.0578 3.00197Z",fill:"currentColor"},null,-1)])])}const an={render:tn},nn=gt({__name:"DeIndicator",props:{commonParams:{type:Object,required:!1},element:{type:Object,default(){return{propValue:null}}},view:{type:Object,default(){return{propValue:null}}},showPosition:{type:String,required:!1,default:"canvas"},scale:{type:Number,required:!1,default:1},terminal:{type:String,default:"pc"},suffixId:{type:String,required:!1,default:"common"},fontFamily:{type:String,required:!1,default:"inherit"}},emits:["onPointClick","onChartClick","onDrillFilters","onJumpClick","onComponentEvent"],setup(r,{expose:c,emit:i}){const d=r,{view:a,scale:p,terminal:f,showPosition:S,commonParams:g}=Rt(d),T=yt(),V=!La()&&ka(),{embeddedCallBack:X,nowPanelTrackInfo:ae,nowPanelJumpInfo:fe,mobileInPc:ne,inMobile:re}=wt(T),se=O(null),M=O(null),ve=O(""),Se=O(!1),D=it({pointParam:null,data:null,loading:!1,totalItems:0,trackBarStyle:{position:"absolute",left:"50%",top:"50%"}}),he=jt({fields:[]}),Oe=I(()=>{var u;const s=(u=he.value)==null?void 0:u.series;if(s&&s.length>0)return s[0]}),Me=I(()=>{var s,u;if((u=(s=a.value)==null?void 0:s.yAxis)!=null&&u.length){const m=a.value.yAxis[0];return m.chartShowName?m.chartShowName:m.name}}),ie=I(()=>{var m,v,k;const s=(m=Oe.value)==null?void 0:m.data;let u;if(s&&s.length>0&&(u=s[0]),u==null)if(a.value.senior&&((k=(v=a.value.senior)==null?void 0:v.functionCfg)==null?void 0:k.emptyDataStrategy)==="setZero")u=0;else return"-";return u}),De=O(Y.color),t=I(()=>{var v,k,E;let s=De.value,u=Y.backgroundColor;if(ie.value==="-")return{color:s,backgroundColor:u};const m=ie.value;if(a.value.senior&&((v=a.value.senior.threshold)!=null&&v.enable)&&((E=(k=a.value.senior.threshold)==null?void 0:k.labelThreshold)==null?void 0:E.length)>0){const _=a.value.senior;for(let A=0;A<_.threshold.labelThreshold.length;A++){let L=!1;const h=_.threshold.labelThreshold[A],B=h.value;if(h.term==="eq"?m===B&&(s=h.color,u=h.backgroundColor,L=!0):h.term==="not_eq"?m!==B&&(s=h.color,u=h.backgroundColor,L=!0):h.term==="lt"?m<B&&(s=h.color,u=h.backgroundColor,L=!0):h.term==="gt"?m>B&&(s=h.color,u=h.backgroundColor,L=!0):h.term==="le"?m<=B&&(s=h.color,u=h.backgroundColor,L=!0):h.term==="ge"?m>=B&&(s=h.color,u=h.backgroundColor,L=!0):h.term==="between"&&h.min<=m&&m<=h.max&&(s=h.color,u=h.backgroundColor,L=!0),L)break}}return{color:s,backgroundColor:u}}),N=I(()=>{let s=ie.value;return s==="-"?s:a.value.yAxis&&a.value.yAxis.length>0&&a.value.yAxis[0].formatterCfg?_a(s,a.value.yAxis[0].formatterCfg):s}),b=i,W=O({display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",height:"100%","background-color":t.value.backgroundColor}),Ie=O({color:t.value.color,"font-size":Y.fontSize+"px","font-family":Ee(d.fontFamily,be[Y.fontFamily]),"font-weight":Y.isBolder?"bold":"normal","font-style":Y.isItalic?"italic":"normal","letter-spacing":Y.letterSpace+"px","text-shadow":Y.fontShadow?"2px 2px 4px":"none","font-synthesis":"weight style"}),U=O({color:Y.suffixColor,"font-size":Y.suffixFontSize+"px","font-family":Ee(d.fontFamily,be[Y.fontFamily]),"font-weight":Y.suffixIsBolder?"bold":"normal","font-style":Y.suffixIsItalic?"italic":"normal","letter-spacing":Y.suffixLetterSpace+"px","text-shadow":Y.suffixFontShadow?"2px 2px 4px":"none","font-synthesis":"weight style"}),Q=O(Y.suffixEnable),me=O(""),Te=O(!1),w=it({"margin-top":Ce.nameValueSpacing+"px"}),Ve=O({color:Ce.color,"font-size":Ce.fontSize+"px","font-family":Ee(d.fontFamily,be[Y.fontFamily]),"font-weight":Ce.isBolder?"bold":"normal","font-style":Ce.isItalic?"italic":"normal","letter-spacing":Ce.letterSpace+"px","text-shadow":Ce.fontShadow?"2px 2px 4px":"none","font-synthesis":"weight style"}),Re=async s=>{if(!s)return;const u=pt(Sa);delete u.customAttr.basicStyle.alpha;const m=xa({...Oa(s,u),data:he.value});if(At(ya,m.customAttr,p.value,f.value),At(wa,m.customStyle,p.value,f.value),m.customAttr){const{indicator:v,indicatorName:k}=m.customAttr;if(v){switch(v.hPosition){case"left":W.value["align-items"]="flex-start";break;case"right":W.value["align-items"]="flex-end";break;default:W.value["align-items"]="center"}switch(v.vPosition){case"top":W.value["justify-content"]="flex-start";break;case"bottom":W.value["justify-content"]="flex-end";break;default:W.value["justify-content"]="center"}De.value=v.color;let E=v.suffixColor;Ie.value={color:t.value.color,"font-size":v.fontSize+"px","font-family":Ee(v.fontFamily,be[Y.fontFamily]),"font-weight":v.isBolder?"bold":"normal","font-style":v.isItalic?"italic":"normal","letter-spacing":v.letterSpace+"px","text-shadow":v.fontShadow?"2px 2px 4px":"none","font-synthesis":"weight style"},W.value["background-color"]=t.value.backgroundColor,U.value={color:E,"font-size":v.suffixFontSize+"px","font-family":Ee(v.suffixFontFamily,be[Y.suffixFontFamily]),"font-weight":v.suffixIsBolder?"bold":"normal","font-style":v.suffixIsItalic?"italic":"normal","letter-spacing":v.suffixLetterSpace+"px","text-shadow":v.suffixFontShadow?"2px 2px 4px":"none","font-synthesis":"weight style"},Q.value=v.suffixEnable,me.value=Ee(v.suffix,"")}if(k!=null&&k.show){let E=k.color;Te.value=!0,Ve.value={color:E,"font-size":k.fontSize+"px","font-family":Ee(k.fontFamily,be[Ce.fontFamily]),"font-weight":k.isBolder?"bold":"normal","font-style":k.isItalic?"italic":"normal","letter-spacing":k.letterSpace+"px","text-shadow":k.fontShadow?"2px 2px 4px":"none","font-synthesis":"weight style"},w["margin-top"]=(k.nameValueSpacing??Ce.nameValueSpacing)+"px"}else Te.value=!1}},le=(s,u)=>{if(s.tableId||s.dataFrom==="template"){D.loading=!0,Se.value=!1;const m=JSON.parse(JSON.stringify(s));ha(m).then(v=>{v.code&&v.code!==0?(Se.value=!0,ve.value=v.msg):(he.value=v==null?void 0:v.data,b("onDrillFilters",v==null?void 0:v.drillFilters),T.setViewDataDetails(s.id,v),Re(v)),u==null||u()}).catch(()=>{u==null||u()})}else u==null||u()},Pe=s=>{var E,_;const u=D.pointParam;if(!((E=u==null?void 0:u.data)!=null&&E.dimensionList)&&!((_=u==null?void 0:u.data)!=null&&_.quotaList))return;const m={option:"linkage",innerType:"indicator",name:D.pointParam.data.name,viewId:a.value.id,dimensionList:D.pointParam.data.dimensionList,quotaList:D.pointParam.data.quotaList,customFilter:D.pointParam.data.customFilter},v={option:"jump",innerType:"indicator",name:D.pointParam.data.name,viewId:a.value.id,dimensionList:D.pointParam.data.dimensionList,quotaList:D.pointParam.data.quotaList,sourceType:D.pointParam.data.sourceType},k={option:"pointClick",innerType:"indicator",name:D.pointParam.data.name,viewId:a.value.id,dimensionList:D.pointParam.data.dimensionList,quotaList:D.pointParam.data.quotaList,customFilter:D.pointParam.data.customFilter};switch(s){case"pointClick":b("onPointClick",k);break;case"linkageAndDrill":T.addViewTrackFilter(m),b("onChartClick",u);break;case"drill":b("onChartClick",u);break;case"linkage":T.addViewTrackFilter(m);break;case"jump":if(ne.value&&!re.value)return;b("onJumpClick",v);break;case"event_jump":case"event_download":case"event_share":case"event_fullScreen":case"event_showHidden":case"event_refreshDataV":case"event_refreshView":b("onComponentEvent",v);break}},ge=I(()=>{var v,k,E,_,A,L;let s=[];if(S.value==="viewDialog")return s;let u=0,m=0;return(k=(v=he.value)==null?void 0:v.fields)==null||k.forEach(h=>{const B=a.value.id+"#"+h.id;ae.value[B]&&u++,fe.value[B]&&m++}),m&&((E=a.value)!=null&&E.jumpActive)&&(!ne.value||re.value)&&s.push("jump"),u&&((_=a.value)!=null&&_.linkageActive)&&s.push("linkage"),a.value.drillFields.length&&s.push("drill"),s.length===3&&d.element.actionSelection.linkageActive==="auto"?s=["jump","linkageAndDrill"]:s.length===2&&d.element.actionSelection.linkageActive==="auto"&&!s.includes("jump")&&(s=["linkageAndDrill"]),(A=g.value)!=null&&A.eventEnable&&s.push("event_"+((L=g.value)==null?void 0:L.eventType)),s}),$e=I(()=>ge.value.length||X.value==="yes"),ue=()=>{X.value==="yes"&&Pe("pointClick")},Z=s=>{D.pointParam=s,ue(),ge.value.length<2?Pe(ge.value[0]):setTimeout(()=>{const u={left:s.x-50,top:s.y+10};Fa(d.element,u,d.scale,ge.value.length),V?(D.trackBarStyle.left=u.left+40+"px",D.trackBarStyle.top=u.top+70+"px"):(D.trackBarStyle.left=u.left+"px",D.trackBarStyle.top=u.top+"px"),se.value.trackButtonClick()},200)},je=s=>{var u,m;if((m=(u=a.value)==null?void 0:u.yAxis)!=null&&m.length){const v=a.value.yAxis[0],k=s.clientX,E=s.clientY,_=M.value.getBoundingClientRect(),A=_.left,L=_.top,h=k-A;let B=E-L;const qe={x:h,y:B,data:{name:v.name,dimensionList:a.value.xAxis,quotaList:a.value.yAxis,customFilter:a.value.customFilter}};Z(qe)}};return c({calcData:le,renderChart:Re}),(s,u)=>(P(),te("div",{ref_key:"indicatorRef",ref:M,class:mt({"menu-point":$e.value}),style:de(W.value),onMousedown:je},[z(Aa,{ref_key:"viewTrack",ref:se,"track-menu":ge.value,"font-family":r.fontFamily,class:"track-bar",style:de(D.trackBarStyle),onTrackClick:Pe,"is-data-v-mobile":o(V)},null,8,["track-menu","font-family","style","is-data-v-mobile"]),_e("div",null,[_e("span",{style:de(Ie.value)},nt(N.value),5),Q.value?(P(),te("span",{key:0,style:de(U.value)},nt(me.value),5)):ee("",!0)]),Te.value?(P(),te("div",{key:0,style:de(w)},[_e("span",{style:de(Ve.value)},nt(Me.value),5)],4)):ee("",!0)],38))}});const ln=Nt(nn,[["__scopeId","data-v-2b9e1a2f"]]),on=yt(),{componentData:Vt,canvasStyleData:rn}=wt(on),sn=(r,c,i)=>{const d=(i||"").split("range")[0];if(i==="datetimerange"||r===1||!d)return c.map(p=>+new Date(p));if(i.includes("range")&&r===7)return[+new Date(Fe(c[0]).startOf(d).format("YYYY-MM-DD HH:mm:ss")),+new Date(Fe(c[1]).endOf(d).format("YYYY-MM-DD HH:mm:ss"))];const[a]=c;return[+new Date(a),+ht(1,d,d,"b",null,i,"start-config")-1e3]},un=(r,c,i,d)=>[1,7].includes(r)?Array.isArray(c)?sn(r,c,d):cn(c,i):Array.isArray(c)?c:[c],cn=(r,c)=>{switch(c){case"year":return dn(r);case"month":return fn(r);case"date":return vn(r);case"datetime":return[+new Date(r),+new Date(r)]}},dn=r=>[+new Date(Fe(r).startOf("year").format("YYYY/MM/DD HH:mm:ss")),+new Date(Fe(r).endOf("year").format("YYYY/MM/DD HH:mm:ss"))],fn=r=>[+new Date(Fe(r).startOf("month").format("YYYY/MM/DD HH:mm:ss")),+new Date(Fe(r).endOf("month").format("YYYY/MM/DD HH:mm:ss"))],vn=r=>[+new Date(Fe(r).startOf("day").format("YYYY/MM/DD HH:mm:ss")),+new Date(Fe(r).endOf("day").format("YYYY/MM/DD HH:mm:ss"))],mn=(r,c,i,d)=>{const[a]=[...c].reverse(),p=a.split(","),f=r.map(g=>g.id),S=i.filter(g=>p[g]);if(i.length){for(const g in c)c[g]=S.map(T=>c[g].split(",")[T]).join(",");return[S.map(g=>d[g]).join(","),c.filter(g=>!g.endsWith(",")&&!!g)]}else return[f.slice(0,p.length).join(","),[...new Set(c)]]},pn=(r,c,i,d,a,p,f,S,g,T)=>+g==9?d?r?a?c.map(V=>V.split("-de-").join(",")):(c||"").split("-de-").join(","):[]:i!=null&&i.length?a?i.map(V=>V.split("-de-").join(",")):(i||"").split("-de-").join(","):[]:f===1&&(p!=null&&p.length||T)&&![1,7].includes(+g)?d?r?p:a?[]:"":(i!=null&&i.length?S:i)||"":d?r?c:a?[]:"":i||(a?[]:""),hn=(r,c=!1)=>{const i=rn.value.popupAvailable,d=[],a=Vt.value.filter(p=>p.component==="VQuery"&&(i||!i&&p.category!=="hidden"));return ze(a,d,r,c),Vt.value.forEach(p=>{if(p.component==="Group"){const f=p.propValue.filter(S=>S.innerType==="VQuery"&&(i||!i&&p.category!=="hidden"));ze(f,d,r,c),f.forEach(S=>{S.innerType==="DeTabs"&&S.propValue.forEach(g=>{const T=g.componentData.filter(V=>V.innerType==="VQuery"&&(i||!i&&p.category!=="hidden"));ze(T,d,r,c)})}),p.propValue.forEach(S=>{S.innerType==="DeTabs"&&S.propValue.forEach(g=>{const T=g.componentData.filter(V=>V.innerType==="VQuery"&&(i||!i&&p.category!=="hidden"));ze(T,d,r,c)})})}p.innerType==="DeTabs"&&p.propValue.forEach(f=>{f.componentData.forEach(g=>{if(g.component==="Group"){const T=g.propValue.filter(V=>V.innerType==="VQuery"&&(i||!i&&g.category!=="hidden"));ze(T,d,r,c)}});const S=f.componentData.filter(g=>g.innerType==="VQuery");ze(S,d,r,c)})}),{filter:d}},gn=(r,c,i,d,a,p)=>{const f=p?c:d,S=p?i:a;return r===0?f===""?[]:f:[f||"",S||""].filter(g=>g!=="")},yn=(r,c,i,d,a,p)=>p&&!a?[]:[(p?d:i)??"",(p?r:c)??""].filter(g=>g!==""),wn=(r,c,i,d,a,p,f,S,g,T,V,X)=>{if(+r==9)return c?"in":"eq";if(+r==22)return"between";const ae=X?a:g,fe=X?f:V,ne=X?d:S,re=X?p:T;if(r==="8"){if(i===0)return ne;const se=[ae===""?"":ne,fe===""?"":re].filter(M=>M!=="");return se.length===2?se.join(`-${i===1?"and":"or"}-`):ae===""?re:ne}return[1,7].includes(+r)?"between":c?"in":"eq"},Ge=r=>{const c=[];let i=r.map(d=>d.id);for(let d=0;d<r.length;d++){const a=r[d];i.includes(a.id)&&(c.push(a),i=i.filter(p=>p!==a.id))}return c},ze=(r,c,i,d)=>{r.forEach(a=>{var p;(p=a.propValue)!=null&&p.length&&a.propValue.forEach(f=>{var V,X,ae,fe,ne,re,se;let S=!1;const g=[],T=Array(5).fill(1);if(f.displayType==="9"&&((V=f.treeCheckedList)!=null&&V.length)?f.treeCheckedList.forEach((M,ve)=>{M.checkedFields.includes(i)&&M.checkedFieldsMap[i]&&ve<f.treeFieldList.length&&(g.push(ve),T[ve]=M.checkedFieldsMap[i])}):S=f.checkedFields.includes(i)&&f.checkedFieldsMap[i],S||g.length){let M;const{id:ve,selectValue:Se,timeGranularityMultiple:D,defaultNumValueEnd:he,numValueEnd:Oe,numValueStart:Me,defaultNumValueStart:ie,conditionType:De=0,treeFieldList:t=[],defaultConditionValueOperatorF:N="eq",defaultConditionValueF:b="",defaultConditionValueOperatorS:W="like",defaultConditionValueS:Ie="",conditionValueOperatorF:U="eq",conditionValueF:Q="",conditionValueOperatorS:me="like",conditionValueS:Te="",defaultValueCheck:w,timeType:Ve="fixed",defaultValue:Re,optionValueSource:le,defaultMapValue:Pe,mapValue:ge,parameters:$e=[],timeGranularity:ue="date",displayType:Z,displayId:je,multiple:s}=f,u=+Z==9;if(Ve==="dynamic"&&[1,7].includes(+Z)&&d&&w)if(+Z==1)M=qa(f),f.defaultValue=new Date(M[0]),f.selectValue=new Date(M[0]);else{const{timeNum:m,relativeToCurrentType:v,around:k,relativeToCurrentRange:E,arbitraryTime:_,timeGranularity:A,timeNumRange:L,relativeToCurrentTypeRange:h,aroundRange:B,timeGranularityMultiple:qe,arbitraryTimeRange:Ze}=f;let Le=ht(m,v,A,k,_,qe,"start-panel"),ye=ht(L,h,A,B,Ze,qe,"end-panel");E&&E!=="custom"&&([Le,ye]=Ha(E)),f.defaultValue=[Le,ye],f.selectValue=[Le,ye],M=[Le,ye]}else Z==="8"?M=gn(De,b,Ie,Q,Te,d):Z==="22"?M=yn(he,Oe,Me,ie,w,d):M=pn(w,Re,Se,d,s,Pe,le,ge,Z,je);if(M!=null&&M.length||["[object Number]","[object Date]"].includes(Object.prototype.toString.call(M))||Z==="8"){let m=un(+Z,M,ue,D);const v=wn(Z,s,De,N,b,W,Ie,U,Q,me,Te,d);if(m!=null&&m.length){let k=f.checkedFieldsMap[i];if(u){const[_,A]=mn(t,m,g,T);k=_,m=A}let E=Ge($e.reduce((_,A)=>(A.id===k&&!_.length&&_.push(A),_),[]));if((ae=(X=f.checkedFieldsMapArr)==null?void 0:X[i])!=null&&ae.length){const _=(fe=f.checkedFieldsMapArr)==null?void 0:fe[i].find(h=>h!==k),A=Array(2).fill(_===f.checkedFieldsMapEnd[i]?m[1]:m[0]);m=Array(2).fill(_===f.checkedFieldsMapEnd[i]?m[0]:m[1]),E=Ge(f.parametersArr[i].filter(h=>h.id===k));const L=Ge(f.parametersArr[i].filter(h=>h.id===_));c.push({componentId:a.id,fieldId:_,operator:v,value:A,parameters:L,isTree:u})}if((re=(ne=f.checkedFieldsMapArrNum)==null?void 0:ne[i])!=null&&re.length){const _=(se=f.checkedFieldsMapArrNum)==null?void 0:se[i].find(h=>h!==k),A=Array(2).fill(_===f.checkedFieldsMapEndNum[i]?m[1]:m[0]);m=Array(2).fill(_===f.checkedFieldsMapEndNum[i]?m[0]:m[1]),E=Ge(f.parametersArr[i].filter(h=>h.id===k));const L=Ge(f.parametersArr[i].filter(h=>h.id===_));c.push({componentId:a.id,fieldId:_,operator:v,value:A,parameters:L,isTree:u})}c.push({filterId:ve,componentId:a.id,fieldId:k,operator:v,value:m,parameters:E,isTree:u})}}}})})},kn={key:0,class:"preview-main-frame-outer"},xn=["src"],Cn=gt({__name:"DePreviewPopDialog",setup(r,{expose:c}){const i=it({dialogShow:!1,name:"",fullscreen:!1,url:"",width:"70vw",height:"70%"}),d=O(),a=Ht(),p=I(()=>i.fullscreen?{}:{height:i.height});return c({previewInit:S=>{if(S.url.includes("?")?i.url=`${S.url}&popWindow=true`:i.url=`${S.url}?popWindow=true`,S.size==="large"?i.fullscreen=!0:S.size==="middle"?(i.fullscreen=!1,i.width="80vw",i.height="80%"):(i.fullscreen=!1,i.width="65vw",i.height="65%"),i.dialogShow=!0,a.getToken&&i.url.includes("#/preview?dvId=")&&d!=null&&d.value){const g={methodName:"iframeInit",args:null};d.value.invokeMethod(g)}}}),(S,g)=>{const T=ea;return P(),te(qt,null,[z(T,{ref:"previewPopDialog","modal-class":"preview_pop_custom","append-to-body":!0,fullscreen:i.fullscreen,modelValue:i.dialogShow,"onUpdate:modelValue":g[0]||(g[0]=V=>i.dialogShow=V),style:de(p.value),modal:!1,width:i.width},{default:G(()=>[i.url?(P(),te("div",kn,[i.dialogShow?(P(),te("iframe",{key:0,class:"preview-main-frame",id:"iframe-de-preview-pop",src:i.url,scrolling:"auto",frameborder:"0"},null,8,xn)):ee("",!0)])):ee("",!0)]),_:1},8,["fullscreen","modelValue","style","width"]),z(o(vt),{ref_key:"xpackIframe",ref:d,jsname:"L2NvbXBvbmVudC9lbWJlZGRlZC1pZnJhbWUvSWZyYW1lU2VsZg=="},null,512)],64)}}});const bn=["innerHTML"],_n={key:0,style:{flex:"1",overflow:"hidden"}},Sn=gt({__name:"index",props:{commonParams:{type:Object,required:!1},active:{type:Boolean,default:!1},element:{type:Object,default(){return{propValue:null}}},view:{type:Object,default(){return{propValue:null}}},themes:{type:String,required:!1,default:"dark"},showPosition:{type:String,required:!1,default:"preview"},searchCount:{type:Number,required:!1,default:0},disabled:{type:Boolean,required:!1,default:!1},scale:{type:Number,required:!1,default:1},suffixId:{type:String,required:!1,default:"common"},fontFamily:{type:String,required:!1,default:"inherit"},optType:{type:String,required:!1}},emits:["onPointClick","onComponentEvent"],setup(r,{emit:c}){const i=Wa(),{wsCache:d}=Ca(),a=O(),{t:p}=la(),f=yt(),{emitter:S}=J(),g=O(null);let T=null,V=0;const X=Va(),ae=Ma(),fe=I(()=>X.getIsDataEaseBi),ne=I(()=>X.getIsIframe),re=c,{nowPanelJumpInfo:se,publicLinkStatus:M,dvInfo:ve,curComponent:Se,canvasStyleData:D,mobileInPc:he,inMobile:Oe,editMode:Me}=wt(f),ie=r,De=O(""),{view:t,showPosition:N,element:b,active:W,searchCount:Ie,scale:U,suffixId:Q}=Rt(ie),me=I(()=>!["rich-text","picture-group"].includes(b.value.innerType)&&w.title_show&&N.value!=="viewDialog"),Te=Ja(),w=it({initReady:!0,title_show:!0,title_remark:{show:!1,remark:""},title_class:{fontSize:"18px",color:"#303133",textAlign:"left",fontStyle:"normal",fontWeight:"normal",background:"",fontFamily:"",textShadow:"none",letterSpacing:"0px",fontSynthesis:"style weight",width:"fit-content",maxWidth:"100%",wordBreak:"break-word",whiteSpace:"pre-wrap"},drillFilters:[],viewInfoData:null,drillClickDimensionList:[]}),Ve=I(()=>w.drillClickDimensionList.length),Re=I(()=>me.value?w.title_class.textAlign==="center"?"center":w.title_class.textAlign==="right"?"flex-end":"flex-start":"flex-start"),le=I(()=>{var e;return((e=a==null?void 0:a.value)==null?void 0:e.trackMenu)??[]}),Pe=I(()=>le.value.indexOf("linkage")>-1||le.value.indexOf("linkageAndDrill")>-1),ge=I(()=>le.value.indexOf("jump")>-1&&!he.value),$e=I(()=>le.value.indexOf("drill")>-1||le.value.indexOf("linkageAndDrill")>-1),ue=O(!1),Z=I(()=>{var e;return((e=D.value.dashboard)==null?void 0:e.resultMode)||null}),je=I(()=>{var e;return((e=D.value.dashboard)==null?void 0:e.resultCount)||null}),s=Ht(),u=(e=!1,n="minute",l=5)=>{if(N.value==="preview"&&!T&&e){T&&clearInterval(T);const x=n==="second"?l*1e3:l*6e4;T=setInterval(()=>{m(),He(),V++},x)}},m=()=>{f.clearViewLinkage(b.value.id),J().emitter.emit("clearPanelLinkage",{viewId:b.value.id})};Ye([()=>U.value],()=>{k()}),Ye([()=>Ie.value],()=>{T||He()}),Ye([()=>je.value],()=>{He()}),Ye([()=>Z.value],()=>{He()}),Ye([()=>U.value],()=>{xe(()=>{var e,n;(n=(e=a==null?void 0:a.value)==null?void 0:e.renderChart)==null||n.call(e,t.value)})}),Ye([()=>Se.value],()=>{Se.value&&Se.value.id===t.value.id&&(w.initReady=!1,xe(()=>{w.initReady=!0}))});const v=jt(null);va("chartExtRequest",v);const k=()=>{var e;if(t.value.customStyle){const n=t.value.customStyle;n.text&&(w.title_show=n.text.show,w.title_class.fontSize=n.text.fontSize*U.value+"px",w.title_class.color=n.text.color,w.title_class.textAlign=n.text.hPosition,w.title_class.fontStyle=n.text.isItalic?"italic":"normal",w.title_class.fontWeight=n.text.isBolder?"bold":"normal",ae.fontList.length&&ae.fontList.forEach(l=>{be[l.name]=l.name}),w.title_class.fontFamily=n.text.fontFamily?be[n.text.fontFamily]:Ot.fontFamily,be[n.text.fontFamily]||(w.title_class.fontFamily=(e=ae.fontList.find(l=>l.isDefault))==null?void 0:e.name,n.text.fontFamily=w.title_class.fontFamily),ae.setCurrentFont(w.title_class.fontFamily),w.title_class.letterSpacing=(n.text.letterSpace?n.text.letterSpace:Ot.letterSpace)+"px",w.title_class.textShadow=n.text.fontShadow?"2px 2px 4px":"none"),n.background&&(w.title_class.background=Da(n.background.color,n.background.alpha)),w.title_remark.show=n.text.show&&n.text.remarkShow,w.title_remark.remark=n.text.remark}},E=e=>{w.drillClickDimensionList.splice(e),t.value.chartExtRequest=L(),Ne(t.value)},_=e=>{try{const n={sourceDvId:ve.value.id,sourceViewId:t.value.id,message:at.encode(JSON.stringify(e))};re("onPointClick",n)}catch{console.warn("de_inner_params send error")}},A=e=>{if(t.value.xAxis.map(l=>l.id).indexOf(ie.view.drillFields[0].id)==-1){Ue.error(p("chart.drill_field_error"));return}if(t.value.type==="circle-packing"&&e.data.name===p("commons.all")){Ue.error(p("chart.last_layer"));return}w.drillClickDimensionList.length<ie.view.drillFields.length-1?(w.drillClickDimensionList.push({dimensionList:e.data.dimensionList,extra:e.extra}),t.value.chartExtRequest=L(),Ne(t.value)):ie.view.drillFields.length>0&&Ue.error(p("chart.last_layer"))},L=e=>{const{filter:n}=hn(t.value.id,e),l={user:d.get(ft("user.uid")),filter:n,linkageFilters:b.value.linkageFilters,outerParamsFilters:b.value.outerParamsFilters,webParamsFilters:b.value.webParamsFilters,drill:w.drillClickDimensionList,resultCount:je.value,resultMode:Z.value};if(i.path==="/preview"&&i.query.taskId){const x=t.value.sceneId,F=window[`de-report-filter-${x}`];let y={};F&&(y=JSON.parse(F)),y[t.value.id]=l,window[`de-report-filter-${x}`]=JSON.stringify(y)}return l},h=e=>{w.drillFilters=e||[]},B=O(null),qe=e=>{if(B!=null&&B.value){const n={methodName:"initOpenHandler",args:e};B.value.invokeMethod(n)}},Ze=e=>{J().emitter.emit("changeCurrentComponent",e)},Le=(e,n,l="middle")=>{try{let x;n==="newPop"?g.value.previewInit({url:e,size:l}):n==="_self"?(x=window.open(e,n),Oe.value&&window.location.reload()):x=window.open(e,n),qe(x)}catch{console.warn(p("visualization.url_check_error")+":"+e)}},ye=e=>{let n,l,x;if(e.name)e.dimensionList.forEach(F=>{(F.id===e.name||F.value===e.name)&&(n=F,x=e.viewId+"#"+n.id,l=se.value[x])});else for(let F=e.dimensionList.length-1;F>=0&&(n=e.dimensionList[F],x=e.viewId+"#"+n.id,l=se.value[x],!l);F--);if(l){ga(f.getViewDataDetails(e.viewId),e),e.sourceDvId=ve.value.id,e.sourceViewId=e.viewId,e.sourceFieldId=n.id;let F="";const y=fe.value&&l.jumpType==="_self",C=ne.value&&l.jumpType==="_self";fe.value&&(F=s.baseUrl);const q=`&jumpInfoParam=${encodeURIComponent(at.encode(JSON.stringify(e)))}`;if(l.linkType==="inner")if(l.targetDvId){const $=["canvas","edit-preview"].includes(N.value)?"&editPreview=true":"",R={},H=f.getLastViewRequestInfo(e.viewId),oe=l.targetViewInfoList;H&&H.filter&&H.filter.length>0&&oe&&oe.length>0&&H.filter.forEach(j=>{oe.forEach(pe=>{pe.sourceFieldActiveId===j.filterId&&(R[pe.outerParamsName]={operator:j.operator,value:j.value})})});let ce;if(Object.keys(R).length>0&&(R.outerParamsVersion="v2",ce="&attachParams="+encodeURIComponent(at.encode(JSON.stringify(R)))),M.value)if(l.publicJumpId){let j=`${F}#/de-link/${l.publicJumpId}?fromLink=true&dvType=${l.targetDvType}`;ce?j=j+ce+q+$:j=j+"&ignoreParams=true"+q+$;const pe=window.location.href;localStorage.setItem(ft("beforeJumpUrl"),pe),Le(j,l.jumpType,l.windowSize)}else Ue.warning(p("visualization.public_link_tips"));else{let j=`${F}#/preview?dvId=${l.targetDvId}&fromLink=true&dvType=${l.targetDvType}`;ce?j=j+ce+q+$:j=j+"&ignoreParams=true"+q+$;const pe=window.location.href;if(localStorage.setItem(ft("beforeJumpUrl"),pe),y||C){s.setDvId(l.targetDvId),s.setJumpInfoParam(encodeURIComponent(at.encode(JSON.stringify(e)))),Ze("Preview");return}Le(j,l.jumpType,l.windowSize)}}else Ue.warning("未指定跳转仪表板");else{const $=[...e.dimensionList,...e.quotaList];let R=Pa("id","value",l.content,$);if(R=Ea(R),(ne.value||fe.value)&&s.clearState(),y){s.setOuterUrl(R),Ze("Iframe");return}Le(R,l.jumpType,l.windowSize)}}},He=(e=!1)=>{if(ue.value)return;const n=f.firstLoadMap.includes(b.value.id),l=L(n?!1:e);let x=pt(t.value);x.chartExtRequest=l,v.value=l,Ne(x)},Ne=e=>{var n,l,x;f.setLastViewRequestInfo(e.id,e.chartExtRequest),a!=null&&a.value&&(ue.value=!0,t.value.isPlugin?(n=a==null?void 0:a.value)==null||n.invokeMethod({methodName:"calcData",args:[e,()=>{ue.value=!1}]}):(x=(l=a==null?void 0:a.value)==null?void 0:l.calcData)==null||x.call(l,e,()=>{ue.value=!1}))},Je=(...e)=>{var n,l;if((n=t.value)!=null&&n.render&&((l=t.value)!=null&&l.type)){const x=Mt.getChartView(t.value.render,t.value.type);return x&&(e==null?void 0:e.includes(x.library))}else return!1};ra(()=>{N.value.includes("viewDialog")||xe(()=>{J({name:`query-data-${t.value.id}`,callback:He})})});const Bt=I(()=>!N.value.includes("viewDialog")),lt=new Map,we=O(!1),ot=e=>{var n,l,x,F,y,C,q,$,R,H,oe,ce,j,pe,Ke,Lt,Ft;if(we.value=!1,(n=t.value)!=null&&n.render&&((l=t.value)!=null&&l.type)){const Pt=Mt.getChartView(t.value.render,t.value.type);if(!Pt)return;const st=Ia(t.value.customAttr).map;if(["bubble-map","map"].includes((x=t.value)==null?void 0:x.type)&&!(st!=null&&st.id)){we.value=!0;return}const Et=new Map(Object.entries(Pt.axisConfig));let et=!1;if(e&&e.length>0){lt.set(t.value.id,e);e:for(const[ke,Be]of Et)if(!Be.allowEmpty&&(y=(F=t.value)==null?void 0:F[ke])!=null&&y.length){for(const ut of t.value[ke])if(!e.find(ct=>ct.id===ut.id)){et=!0;break e}}}if(et){we.value=!0;return}for(const[ke,Be]of Et)if(!Be.allowEmpty){if(lt.get((C=t.value)==null?void 0:C.id)){if(($=(q=t.value)==null?void 0:q[ke])!=null&&$.length){for(const ut of t.value[ke])if(!lt.get((R=t.value)==null?void 0:R.id).find(ct=>ct.id===ut.id)){et=!0;break}}if(et){we.value=!0;break}}if(!Be.limit&&((oe=(H=t.value)==null?void 0:H[ke])==null?void 0:oe.length)===0){we.value=!0;break}if(Be.limit&&(!((ce=t.value)!=null&&ce[ke])||((pe=(j=t.value)==null?void 0:j[ke])==null?void 0:pe.length)<parseInt(Be.limit))){we.value=!0;break}if(((Ke=t.value)==null?void 0:Ke.type)==="table-info"&&((Ft=(Lt=t.value)==null?void 0:Lt[ke])==null?void 0:Ft.length)===0){we.value=!0;break}}}},Yt=()=>{ot()},zt=()=>{ot()},kt=O(!1);sa(()=>{var x,F;if(!t.value.isPlugin)w.drillClickDimensionList=((F=(x=t.value)==null?void 0:x.chartExtRequest)==null?void 0:F.drill)??[],He(!N.value.includes("viewDialog"));else{const y=f.firstLoadMap.includes(b.value.id),C=L(!y);t.value.chartExtRequest=C,v.value=C,kt.value=!0}if(!Bt.value)return;J({name:"checkShowEmpty",callback:y=>{var C;((C=y.view)==null?void 0:C.id)===t.value.id&&ot(y.allFields)}}),J({name:"chart-type-change",callback:Yt}),J({name:"dataset-change",callback:zt}),J({name:"clearPanelLinkage",callback:function(y){var C,q;(y.viewId==="all"||y.viewId===b.value.id)&&((q=(C=a==null?void 0:a.value)==null?void 0:C.clearLinkage)==null||q.call(C))}}),J({name:"snapshotChangeToView",callback:function(y){k(),xe(()=>{var C,q;y.snapshotCacheViewCalc.includes(t.value.id)||y.snapshotCacheViewCalc.includes("all")?(t.value.chartExtRequest=L(!1),Ne(t.value)):(y.snapshotCacheViewRender.includes(t.value.id)||y.snapshotCacheViewRender.includes("all"))&&((q=(C=a==null?void 0:a.value)==null?void 0:C.renderChart)==null||q.call(C,t.value))})}}),J({name:"calcData-"+t.value.id,callback:function(y){w.initReady&&(k(),xe(()=>{t.value.chartExtRequest=L(!1);const C=y||t.value;Ne(C)}))}}),J({name:"calcData-all",callback:function(){w.initReady&&(k(),xe(()=>{t.value.chartExtRequest=L(!1),Ne(t.value)}))}}),J({name:"renderChart-"+t.value.id,callback:function(y){if(!w.initReady)return;k();const C=y||t.value;xe(()=>{var q,$,R,H,oe;if(($=(q=t.value)==null?void 0:q.plugin)!=null&&$.isPlugin){(R=a==null?void 0:a.value)==null||R.invokeMethod({methodName:"renderChart",args:[C]});return}(oe=(H=a==null?void 0:a.value)==null?void 0:H.renderChart)==null||oe.call(H,C)})}}),J({name:"resetDrill-"+t.value.id,callback:function(y){xe(()=>{E(y)})}}),J({name:"tabCanvasChange-"+b.value.canvasId,callback:function(){!w.initReady&&!t.value.type.includes("table")||setTimeout(function(){var y,C;(C=(y=a==null?void 0:a.value)==null?void 0:y.renderChart)==null||C.call(y,t.value)},200)}}),J({name:"updateTitle-"+t.value.id,callback:()=>{k()}}),J({name:"chart-type-change-"+t.value.id,callback:()=>{const y=pt(t.value);y.container="container-"+N.value+"-"+t.value.id+"-"+Q.value,Ba(y)}});const{refreshViewEnable:e,refreshUnit:n,refreshTime:l}=t.value;u(e,n,l),k()});const xt=I(()=>(D.value.refreshViewLoading||Ie.value===0&&V===0)&&ue.value),Ct=I(()=>{var e,n,l;return!!(t.value.tableId&&(b.value.state===void 0||b.value.state==="ready")||["rich-text","picture-group"].includes(t.value.type)||(e=t.value)!=null&&e.isPlugin||t.value.dataFrom==="template"||(l=(n=t.value.customAttr)==null?void 0:n.map)!=null&&l.id&&["map","bubble-map","flow-map"].includes(t.value.type))}),bt=O(),We=O(!1);function $t(){ie.active&&(We.value||(We.value=!0,xe(()=>{var e;(e=bt.value)==null||e.focus(),b.value.editing=!0})))}function _t(){b.value.editing=!1,We.value=!1}const Jt={beforeMount(e,n){e.clickOutsideEvent=function(l){e===l.target||e.contains(l.target)||n.value(l)},document.addEventListener("click",e.clickOutsideEvent)},unmounted(e){document.removeEventListener("click",e.clickOutsideEvent)}};function Wt(){b.value.name=t.value.title,b.value.label=t.value.title,Te.recordSnapshotCache("onTitleChange")}const Xe=I(()=>ie.themes==="dark"?"light":"dark"),Ut=I(()=>me.value&&(me.value||le.value.length>0||w.title_remark.show)?12*U.value+"px":0),Qe=I(()=>16*U.value+"px"),St=e=>{const{backgroundColor:n,backgroundType:l,backgroundImageEnable:x,backgroundColorSelect:F}=b.value.commonBackground,y="rgba(0,0,0,0.01)";if(l==="outerImage"&&x)return y;if(n.includes("#"))return e||!F?y:n;const C=n.match(/rgba\((\d+), (\d+), (\d+), (\d+|0.\d+)\)/);if(!C)return n;const[q,$,R,H]=C.slice(1).map(Number);return`rgba(${q}, ${$}, ${R}, ${!F||e?.01:H})`},Gt=I(()=>{const e=St(!1),l={position:"absolute",border:`1px solid ${St(!0)}`,"background-color":e,"border-radius":"2px",padding:"0 2px 0 2px","z-index":1,top:"2px",left:"2px",...le.value.length?{}:{display:"none"}};return{color:D.value.component.seniorStyleSetting.linkageIconColor,...me.value?{}:l}}),rt=O(!1),Zt=I(()=>rt.value?le.value.length>0||w.title_remark.show:!1),Dt=O(Ta),Xt=I(()=>{let e=!1;return Dt.value.forEach(n=>{e=n.details.find(l=>{var x;return((x=t.value)==null?void 0:x.type)===l.value})!==void 0}),e}),Qt=e=>{e.forEach(n=>{var ce;const{category:l,title:x,render:F,chartValue:y,chartTitle:C,icon:q,staticMap:$}=n,R={render:F,category:l,icon:q,value:y,title:C,isPlugin:!0,staticMap:$};((ce=t.value)==null?void 0:ce.type)===R.value&&(t.value.plugin={isPlugin:!0,staticMap:$});const H=[...Dt.value];let oe=!1;for(;H!=null&&H.length;){const j=H.pop();j.category===l&&(j.details.find(Ke=>Ke.value===R.value)||j.details.push(R),oe=!0)}oe||H.push({category:l,title:x,display:"show",details:[R]})})},It=I(()=>["rich-text","picture-group"].includes(b.value.innerType)),Kt=I(()=>Oe.value?`${screen.width-10}px`:he.value?"270px":"500px"),Tt=()=>{const e=document.getElementById("g2-tooltip-wrapper");if(e)for(const n of e.children)n.style.display="none"};return(e,n)=>{var y;const l=oa,x=aa,F=na;return dt((P(),te("div",{class:mt(["chart-area report-load",{"report-load-finish":!xt.value}]),"element-loading-background":"rgba(0,0,0,0)",onMouseover:n[5]||(n[5]=C=>rt.value=!0),onMouseleave:n[6]||(n[6]=C=>rt.value=!1)},[_e("div",{class:"title-container",style:de({"justify-content":Re.value,"margin-bottom":Ut.value})},[We.value?dt((P(),K(o(ta),{key:1,style:{flex:"1"},effect:o(D).dashboard.themeColor,ref_key:"titleInputRef",ref:bt,modelValue:o(t).title,"onUpdate:modelValue":n[0]||(n[0]=C=>o(t).title=C),onKeydown:[n[1]||(n[1]=ua(()=>{},["stop"])),ca(_t,["enter"])],onChange:Wt},null,8,["effect","modelValue"])),[[Jt,_t]]):(P(),te(qt,{key:0},[me.value?(P(),te("p",{key:0,class:"ellipsis",style:de(w.title_class),onDblclick:$t},nt(o(t).title),37)):ee("",!0)],64)),z(fa,{name:"fade"},{default:G(()=>[dt(_e("div",{class:mt(["icons-container",{"is-editing":We.value}]),style:de(Gt.value)},[w.title_remark.show?(P(),K(x,{key:0,effect:Xe.value,placement:"top"},{content:G(()=>[_e("div",{style:de({maxWidth:Kt.value,wordBreak:"break-all",wordWrap:"break-word",whiteSpace:"pre-wrap"}),innerHTML:w.title_remark.remark},null,12,bn)]),default:G(()=>[z(o(tt),{size:Qe.value,class:"inner-icon"},{default:G(()=>[z(l,{name:"icon_info_outlined"},{default:G(()=>[z(o(ma),{class:"svg-icon"})]),_:1})]),_:1},8,["size"])]),_:1},8,["effect"])):ee("",!0),Pe.value?(P(),K(x,{key:1,effect:Xe.value,placement:"top",content:"已设置联动"},{default:G(()=>[z(o(tt),{size:Qe.value,class:"inner-icon"},{default:G(()=>[z(l,{name:"icon_link-record_outlined"},{default:G(()=>[z(o(Za),{class:"svg-icon"})]),_:1})]),_:1},8,["size"])]),_:1},8,["effect"])):ee("",!0),ge.value?(P(),K(x,{key:2,effect:Xe.value,placement:"top",content:o(p)("visualization.jump_set_tips")},{default:G(()=>[z(o(tt),{size:Qe.value,class:"inner-icon"},{default:G(()=>[z(l,{name:"icon_viewinchat_outlined"},{default:G(()=>[z(o(Ka),{class:"svg-icon"})]),_:1})]),_:1},8,["size"])]),_:1},8,["effect","content"])):ee("",!0),$e.value?(P(),K(x,{key:3,effect:Xe.value,placement:"top",content:o(p)("visualization.drill_set_tips")},{default:G(()=>[z(o(tt),{size:Qe.value,class:"inner-icon"},{default:G(()=>[z(l,{name:"icon_drilling_outlined"},{default:G(()=>[z(o(an),{class:"svg-icon"})]),_:1})]),_:1},8,["size"])]),_:1},8,["effect","content"])):ee("",!0)],6),[[da,Zt.value]])]),_:1})],4),It.value||Ct.value&&!we.value?(P(),te("div",_n,[(y=o(t).plugin)!=null&&y.isPlugin&&kt.value?(P(),K(o(Ra),{key:0,jsname:o(t).plugin.staticMap.index,scale:o(U),"dynamic-area-id":De.value,view:o(t),"show-position":o(N),element:o(b),request:o(ia),emitter:o(S),store:o(ba),suffixId:o(Q),active:o(W),disabled:!["canvas","canvasDataV"].includes(o(N))||r.disabled,"edit-mode":o(Me),ref_key:"chartComponent",ref:a,onOnChartClick:A,onOnPointClick:_,onOnDrillFilters:h,onOnJumpClick:ye,onResetLoading:n[2]||(n[2]=()=>ue.value=!1)},null,8,["jsname","scale","dynamic-area-id","view","show-position","element","request","emitter","store","suffixId","active","disabled","edit-mode"])):Je(o(Ae).PICTURE_GROUP)?(P(),K(za,{key:1,themes:o(D).dashboard.themeColor,ref_key:"chartComponent",ref:a,element:o(b),active:o(W),view:o(t),"show-position":o(N),suffixId:o(Q)},null,8,["themes","element","active","view","show-position","suffixId"])):Je(o(Ae).RICH_TEXT)?(P(),K(Ya,{key:2,scale:o(U),themes:o(D).dashboard.themeColor,ref_key:"chartComponent",ref:a,element:o(b),disabled:!["canvas","canvasDataV"].includes(o(N))||r.disabled,active:o(W),"show-position":o(N),"edit-mode":o(Me),suffixId:o(Q)},null,8,["scale","themes","element","disabled","active","show-position","edit-mode","suffixId"])):Je(o(Ae).INDICATOR)?(P(),K(ln,{key:3,scale:o(U),themes:o(D).dashboard.themeColor,ref_key:"chartComponent",ref:a,view:o(t),element:o(b),"show-position":o(N),suffixId:o(Q),"font-family":r.fontFamily,"common-params":r.commonParams,onTouchstart:Tt,onOnChartClick:A,onOnPointClick:_,onOnDrillFilters:h,onOnJumpClick:ye,onOnComponentEvent:n[3]||(n[3]=()=>re("onComponentEvent"))},null,8,["scale","themes","view","element","show-position","suffixId","font-family","common-params"])):Je(o(Ae).G2_PLOT,o(Ae).L7_PLOT,o(Ae).L7)?(P(),K(pa,{key:4,scale:o(U),"dynamic-area-id":De.value,view:o(t),"show-position":o(N),element:o(b),suffixId:o(Q),"font-family":r.fontFamily,active:o(W),ref_key:"chartComponent",ref:a,onOnChartClick:A,onOnPointClick:_,onOnDrillFilters:h,onOnJumpClick:ye,onResetLoading:n[4]||(n[4]=()=>ue.value=!1)},null,8,["scale","dynamic-area-id","view","show-position","element","suffixId","font-family","active"])):Je(o(Ae).S2)?(P(),K(Na,{key:5,view:o(t),scale:o(U),"show-position":o(N),element:o(b),"drill-length":Ve.value,"font-family":r.fontFamily,ref_key:"chartComponent",ref:a,onOnPointClick:_,onOnChartClick:A,onOnDrillFilters:h,onOnJumpClick:ye,suffixId:o(Q)},null,8,["view","scale","show-position","element","drill-length","font-family","suffixId"])):ee("",!0)])):ee("",!0),(!Ct.value||we.value)&&!It.value?(P(),K($a,{key:1,themes:o(D).dashboard.themeColor,"view-icon":o(t).type,onTouchstart:Tt},null,8,["themes","view-icon"])):ee("",!0),z(ja,{disabled:r.optType==="enlarge","drill-filters":w.drillFilters,onOnDrillJump:E},null,8,["disabled","drill-filters"]),z(o(vt),{ref_key:"openHandler",ref:B,jsname:"L2NvbXBvbmVudC9lbWJlZGRlZC1pZnJhbWUvT3BlbkhhbmRsZXI="},null,512),!Xt.value&&o(t).isPlugin?(P(),K(o(vt),{key:2,jsname:"L2NvbXBvbmVudC9wbHVnaW5zLWhhbmRsZXIvVmlld0NhdGVnb3J5SGFuZGxlcg==",onLoadPluginCategory:Qt})):ee("",!0),z(Cn,{ref_key:"dePreviewPopDialogRef",ref:g},null,512)],34)),[[F,xt.value]])}}});const Dn=Nt(Sn,[["__scopeId","data-v-562f5715"]]),ii=Object.freeze(Object.defineProperty({__proto__:null,default:Dn},Symbol.toStringTag,{value:"Module"}));export{Dn as C,Cn as _,ii as i};

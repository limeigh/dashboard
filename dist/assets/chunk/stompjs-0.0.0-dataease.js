import{c as T,g as R}from"./@amap-0.0.0-dataease.js";import{r as A}from"./net-0.0.0-dataease.js";import{r as P}from"./websocket-0.0.0-dataease.js";var x={exports:{}},_={};(function(S){(function(){var p,N,k,f,F={}.hasOwnProperty,l=[].slice;p={LF:`
`,NULL:"\0"},k=function(){var u;function i(n,t,e){this.command=n,this.headers=t??{},this.body=e??""}return i.prototype.toString=function(){var n,t,e,r,o;n=[this.command],e=this.headers["content-length"]===!1,e&&delete this.headers["content-length"],o=this.headers;for(t in o)F.call(o,t)&&(r=o[t],n.push(""+t+":"+r));return this.body&&!e&&n.push("content-length:"+i.sizeOfUTF8(this.body)),n.push(p.LF+this.body),n.join(p.LF)},i.sizeOfUTF8=function(n){return n?encodeURI(n).match(/%..|./g).length:0},u=function(n){var t,e,r,o,a,g,c,d,b,s,h,C,w,y,E,I,m;for(o=n.search(RegExp(""+p.LF+p.LF)),a=n.substring(0,o).split(p.LF),r=a.shift(),g={},C=function(v){return v.replace(/^\s+|\s+$/g,"")},I=a.reverse(),w=0,E=I.length;w<E;w++)s=I[w],d=s.indexOf(":"),g[C(s.substring(0,d))]=C(s.substring(d+1));if(t="",h=o+2,g["content-length"])b=parseInt(g["content-length"]),t=(""+n).substring(h,h+b);else for(e=null,c=y=h,m=n.length;(h<=m?y<m:y>m)&&(e=n.charAt(c),e!==p.NULL);c=h<=m?++y:--y)t+=e;return new i(r,g,t)},i.unmarshall=function(n){var t;return function(){var e,r,o,a;for(o=n.split(RegExp(""+p.NULL+p.LF+"*")),a=[],e=0,r=o.length;e<r;e++)t=o[e],(t!=null?t.length:void 0)>0&&a.push(u(t));return a}()},i.marshall=function(n,t,e){var r;return r=new i(n,t,e),r.toString()+p.NULL},i}(),N=function(){var u;function i(n){this.ws=n,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16*1024,this.subscriptions={}}return i.prototype.debug=function(n){var t;return typeof window<"u"&&window!==null&&(t=window.console)!=null?t.log(n):void 0},u=function(){return Date.now?Date.now():new Date().valueOf},i.prototype._transmit=function(n,t,e){var r;for(r=k.marshall(n,t,e),typeof this.debug=="function"&&this.debug(">>> "+r);;)if(r.length>this.maxWebSocketFrameSize)this.ws.send(r.substring(0,this.maxWebSocketFrameSize)),r=r.substring(this.maxWebSocketFrameSize),typeof this.debug=="function"&&this.debug("remaining = "+r.length);else return this.ws.send(r)},i.prototype._setupHeartbeat=function(n){var t,e,r,o,a,g;if(!((a=n.version)!==f.VERSIONS.V1_1&&a!==f.VERSIONS.V1_2)&&(g=function(){var c,d,b,s;for(b=n["heart-beat"].split(","),s=[],c=0,d=b.length;c<d;c++)o=b[c],s.push(parseInt(o));return s}(),e=g[0],t=g[1],this.heartbeat.outgoing===0||t===0||(r=Math.max(this.heartbeat.outgoing,t),typeof this.debug=="function"&&this.debug("send PING every "+r+"ms"),this.pinger=f.setInterval(r,function(c){return function(){return c.ws.send(p.LF),typeof c.debug=="function"?c.debug(">>> PING"):void 0}}(this))),!(this.heartbeat.incoming===0||e===0)))return r=Math.max(this.heartbeat.incoming,e),typeof this.debug=="function"&&this.debug("check PONG every "+r+"ms"),this.ponger=f.setInterval(r,function(c){return function(){var d;if(d=u()-c.serverActivity,d>r*2)return typeof c.debug=="function"&&c.debug("did not receive server activity for the last "+d+"ms"),c.ws.close()}}(this))},i.prototype._parseConnect=function(){var n,t,e,r;switch(n=1<=arguments.length?l.call(arguments,0):[],r={},n.length){case 2:r=n[0],t=n[1];break;case 3:n[1]instanceof Function?(r=n[0],t=n[1],e=n[2]):(r.login=n[0],r.passcode=n[1],t=n[2]);break;case 4:r.login=n[0],r.passcode=n[1],t=n[2],e=n[3];break;default:r.login=n[0],r.passcode=n[1],t=n[2],e=n[3],r.host=n[4]}return[r,t,e]},i.prototype.connect=function(){var n,t,e,r;return n=1<=arguments.length?l.call(arguments,0):[],r=this._parseConnect.apply(this,n),e=r[0],this.connectCallback=r[1],t=r[2],typeof this.debug=="function"&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(o){return function(a){var g,c,d,b,s,h,C,w,y,E,I,m;if(b=typeof ArrayBuffer<"u"&&a.data instanceof ArrayBuffer?(g=new Uint8Array(a.data),typeof o.debug=="function"&&o.debug("--- got data length: "+g.length),function(){var v,U,L;for(L=[],v=0,U=g.length;v<U;v++)c=g[v],L.push(String.fromCharCode(c));return L}().join("")):a.data,o.serverActivity=u(),b===p.LF){typeof o.debug=="function"&&o.debug("<<< PONG");return}for(typeof o.debug=="function"&&o.debug("<<< "+b),I=k.unmarshall(b),m=[],y=0,E=I.length;y<E;y++)switch(s=I[y],s.command){case"CONNECTED":typeof o.debug=="function"&&o.debug("connected to server "+s.headers.server),o.connected=!0,o._setupHeartbeat(s.headers),m.push(typeof o.connectCallback=="function"?o.connectCallback(s):void 0);break;case"MESSAGE":w=s.headers.subscription,C=o.subscriptions[w]||o.onreceive,C?(d=o,h=s.headers["message-id"],s.ack=function(v){return v==null&&(v={}),d.ack(h,w,v)},s.nack=function(v){return v==null&&(v={}),d.nack(h,w,v)},m.push(C(s))):m.push(typeof o.debug=="function"?o.debug("Unhandled received MESSAGE: "+s):void 0);break;case"RECEIPT":m.push(typeof o.onreceipt=="function"?o.onreceipt(s):void 0);break;case"ERROR":m.push(typeof t=="function"?t(s):void 0);break;default:m.push(typeof o.debug=="function"?o.debug("Unhandled frame: "+s):void 0)}return m}}(this),this.ws.onclose=function(o){return function(){var a;return a="Whoops! Lost connection to "+o.ws.url,typeof o.debug=="function"&&o.debug(a),o._cleanUp(),typeof t=="function"?t(a):void 0}}(this),this.ws.onopen=function(o){return function(){return typeof o.debug=="function"&&o.debug("Web Socket Opened..."),e["accept-version"]=f.VERSIONS.supportedVersions(),e["heart-beat"]=[o.heartbeat.outgoing,o.heartbeat.incoming].join(","),o._transmit("CONNECT",e)}}(this)},i.prototype.disconnect=function(n,t){return t==null&&(t={}),this._transmit("DISCONNECT",t),this.ws.onclose=null,this.ws.close(),this._cleanUp(),typeof n=="function"?n():void 0},i.prototype._cleanUp=function(){if(this.connected=!1,this.pinger&&f.clearInterval(this.pinger),this.ponger)return f.clearInterval(this.ponger)},i.prototype.send=function(n,t,e){return t==null&&(t={}),e==null&&(e=""),t.destination=n,this._transmit("SEND",t,e)},i.prototype.subscribe=function(n,t,e){var r;return e==null&&(e={}),e.id||(e.id="sub-"+this.counter++),e.destination=n,this.subscriptions[e.id]=t,this._transmit("SUBSCRIBE",e),r=this,{id:e.id,unsubscribe:function(){return r.unsubscribe(e.id)}}},i.prototype.unsubscribe=function(n){return delete this.subscriptions[n],this._transmit("UNSUBSCRIBE",{id:n})},i.prototype.begin=function(n){var t,e;return e=n||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:e}),t=this,{id:e,commit:function(){return t.commit(e)},abort:function(){return t.abort(e)}}},i.prototype.commit=function(n){return this._transmit("COMMIT",{transaction:n})},i.prototype.abort=function(n){return this._transmit("ABORT",{transaction:n})},i.prototype.ack=function(n,t,e){return e==null&&(e={}),e["message-id"]=n,e.subscription=t,this._transmit("ACK",e)},i.prototype.nack=function(n,t,e){return e==null&&(e={}),e["message-id"]=n,e.subscription=t,this._transmit("NACK",e)},i}(),f={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(u,i){var n,t;return i==null&&(i=["v10.stomp","v11.stomp"]),n=f.WebSocketClass||WebSocket,t=new n(u,i),new N(t)},over:function(u){return new N(u)},Frame:k},S!==null&&(S.Stomp=f),typeof window<"u"&&window!==null?(f.setInterval=function(u,i){return window.setInterval(i,u)},f.clearInterval=function(u){return window.clearInterval(u)},window.Stomp=f):S||(self.Stomp=f)}).call(T)})(_);var O={};(function(){var S,p,N,k,f,F;S=_,p=A(),S.Stomp.setInterval=function(l,u){return setInterval(u,l)},S.Stomp.clearInterval=function(l){return clearInterval(l)},f=function(l,u){var i,n;return i=null,n={url:"tcp:// "+u+":"+l,send:function(t){return i.write(t)},close:function(){return i.end()}},i=p.connect(l,u,function(t){return n.onopen()}),i.on("error",function(t){return typeof n.onclose=="function"?n.onclose(t):void 0}),i.on("close",function(t){return typeof n.onclose=="function"?n.onclose(t):void 0}),i.on("data",function(t){var e;return e={data:t.toString()},n.onmessage(e)}),n},F=function(l){var u,i,n,t;return u=P().client,i=null,t={url:l,send:function(e){return i.sendUTF(e)},close:function(){return i.close()}},n=new u,n.on("connect",function(e){return i=e,t.onopen(),i.on("error",function(r){return typeof t.onclose=="function"?t.onclose(r):void 0}),i.on("close",function(){return typeof t.onclose=="function"?t.onclose():void 0}),i.on("message",function(r){var o;if(r.type==="utf8")return o={data:r.utf8Data},t.onmessage(o)})}),n.connect(l),t},N=function(l,u){var i;return i=f(u,l),S.Stomp.over(i)},k=function(l){var u;return u=F(l),S.Stomp.over(u)},O.overTCP=N,O.overWS=k}).call(T);var V=_,W=O;x.exports=V.Stomp;x.exports.overTCP=W.overTCP;x.exports.overWS=W.overWS;var B=x.exports;const z=R(B);export{z as S};

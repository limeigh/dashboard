import{S as Se,R as we,i as g,E as N,q as R,W as xe,e as he,a3 as Ee,f as ke,Z as be,M as ye,v as Le}from"./element-plus-secondary-0.0.0-dataease.js";import{i as U}from"./icon_download_outlined-0.0.0-dataease.js";import{d as V}from"./de-delete-0.0.0-dataease.js";import{o as i,c as C,a as m,d as Ne,l as De,r as v,j as Ie,k as Ae,$ as Pe,T as f,U as t,W as o,u as r,S as Z,a8 as Te,_ as h,Y as d,R as c,z as $e,h as D}from"./@vue-0.0.0-dataease.js";import{i as Fe}from"./icon_refresh_outlined-0.0.0-dataease.js";import{E as Re}from"./EmptyBackground-0.0.0-dataease.js";import{t as Ue}from"./@element-plus-0.0.0-dataease.js";import{t as j,u as q,v as z,w as Ve,x as ze,y as Ge,z as Be}from"./dataset-0.0.0-dataease.js";import{h as Oe,d as He,f as w,P as G}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{a as Me,g as Y,u as B}from"./index-0.0.0-dataease.js";import{useAppStoreWithOut as We}from"./app-0.0.0-dataease.js";import{G as Je}from"./GridTable-0.0.0-dataease.js";const Ze={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"};function je(K,E){return i(),C("svg",Ze,[...E[0]||(E[0]=[m("path",{d:"M4 2.5C4 1.94772 4.44772 1.5 5 1.5H14.7929C14.9255 1.5 15.0527 1.55268 15.1464 1.64645L19.8536 6.35355C19.9473 6.44732 20 6.5745 20 6.70711V21.5C20 22.0523 19.5523 22.5 19 22.5H5C4.44772 22.5 4 22.0523 4 21.5V2.5Z",fill:"#34C724"},null,-1),m("path",{d:"M15 1.54492C15.054 1.56949 15.1037 1.6037 15.1464 1.64646L19.8536 6.35357C19.8963 6.39632 19.9305 6.44602 19.9551 6.50001H16C15.4477 6.50001 15 6.0523 15 5.50001V1.54492Z",fill:"#2EA121"},null,-1),m("path",{d:"M11.308 13.5956L8.33203 17.9996H9.60403L11.98 14.4596L14.284 17.9996H15.676L12.664 13.5956L15.496 9.43164H14.224L11.992 12.7796L9.85603 9.43164H8.48803L11.308 13.5956Z",fill:"white"},null,-1)])])}const qe={render:je},Ye={class:"name-excel"},Ke={class:"name-content"},Qe={class:"fileName"},Xe=["onClick"],ea={key:1,class:"success"},aa={key:0,class:"red-line"},ta={key:0},oa={key:1},la={key:2},na={class:"dialog-footer"},Ca=Ne({__name:"ExportExcel",setup(K,{expose:E}){const{t:a}=Oe(),p=De({paginationConfig:{currentPage:1,pageSize:10,total:0}}),x=v([]),I=v(!1),k=v(!1),b=v(!1),A=v(""),u=v("ALL"),_=v([]),y=v(a("data_set.no_tasks_yet")),P=v([{label:a("data_set.exporting")+"(0)",name:"IN_PROGRESS"},{label:a("data_set.success")+"(0)",name:"SUCCESS"},{label:a("data_set.fail")+"(0)",name:"FAILED"},{label:a("data_set.waiting")+"(0)",name:"PENDING"},{label:a("data_set.all")+"(0)",name:"ALL"}]);let T;const Q=()=>{k.value=!1,clearInterval(T)},{wsCache:O}=Me(),X=O.get(Y("open-backend"))==="1"?"_self":"_blank",ee=O.get(Y("app.desktop"));Ie(()=>{clearInterval(T)});const S=e=>{e&&(u.value=e.paneName),u.value==="ALL"?y.value=a("data_export.no_file"):u.value==="FAILED"?y.value=a("data_export.no_failed_file"):y.value=a("data_export.no_task"),I.value=!0,j().then(s=>{P.value.forEach(n=>{n.name==="ALL"&&(n.label=a("data_set.all")+"("+s.data.ALL+")"),n.name==="IN_PROGRESS"&&(n.label=a("data_set.exporting")+"("+s.data.IN_PROGRESS+")"),n.name==="SUCCESS"&&(n.label=a("data_set.success")+"("+s.data.SUCCESS+")"),n.name==="FAILED"&&(n.label=a("data_set.fail")+"("+s.data.FAILED+")"),n.name==="PENDING"&&(n.label=a("data_set.waiting")+"("+s.data.PENDING+")")})}),q(p.paginationConfig.currentPage,p.paginationConfig.pageSize,u.value).then(s=>{p.paginationConfig.total=s.data.total,x.value=s.data.records}).finally(()=>{I.value=!1})},ae=e=>{k.value=!0,e&&e.activeName!==void 0&&(u.value=e.activeName),S(),T=setInterval(()=>{u.value==="IN_PROGRESS"&&(j().then(s=>{P.value.forEach(n=>{n.name==="ALL"&&(n.label=a("data_set.all")+"("+s.data.ALL+")"),n.name==="IN_PROGRESS"&&(n.label=a("data_set.exporting")+"("+s.data.IN_PROGRESS+")"),n.name==="SUCCESS"&&(n.label=a("data_set.success")+"("+s.data.SUCCESS+")"),n.name==="FAILED"&&(n.label=a("data_set.fail")+"("+s.data.FAILED+")"),n.name==="PENDING"&&(n.label=a("data_set.waiting")+"("+s.data.PENDING+")")})}),q(p.paginationConfig.currentPage,p.paginationConfig.pageSize,u.value).then(s=>{p.paginationConfig.total=s.data.total,x.value=s.data.records}))},5e3)},te=He(),H=We(),oe=Ae(()=>H.getIsDataEaseBi),le=e=>{if(!te.getLinkToken&&!oe.value&&!H.getIsIframe){if(JSON.parse(e).exportStatus==="SUCCESS"){M(JSON.parse(e).exportFromName+` ${a("data_set.successful_go_to")}`,"success",se);return}JSON.parse(e).exportStatus==="FAILED"&&M(JSON.parse(e).exportFromName+` ${a("data_set.failed_go_to")}`,"error",ne)}},M=(e,s="success",n)=>{const L=`de-message-${s||"success"} de-message-export`;N({message:D("p",null,[D("span",{title:a(e),class:"ellipsis m50-export"},a(e)),D(g,{text:!0,size:"small",class:"btn-text",onClick:()=>{n()}},a("data_export.export_center"))]),icon:s==="loading"?D(Ue):"",type:s,showClose:!0,customClass:L})},ne=()=>{B().emitter.emit("data-export-center",{activeName:"FAILED"})},se=()=>{B().emitter.emit("data-export-center",{activeName:"SUCCESS"})},W=()=>{if(_.value.length===0){x.value.forEach(e=>{z(e.id).then(()=>{window.open(G+"/exportCenter/download/"+e.id)})});return}_.value.map(e=>{z(e.id).then(()=>{window.open(G+"/exportCenter/download/"+e.id)})})},re=e=>{A.value="",A.value=e.msg,b.value=!0},ie=e=>e?new Date(e).toLocaleString():"-",de=e=>{z(e.id).then(()=>{window.open(G+"/exportCenter/download/"+e.id,X)})},ce=e=>{Ve(e.id).then(()=>{S()})},ue=e=>{R.confirm(a("data_export.sure_del"),{confirmButtonType:"danger",type:"warning",autofocus:!1,showClose:!1}).then(()=>{ze(e.id).then(()=>{N.success(a("commons.delete_success")),S()})}).catch(()=>{})},pe=e=>{_.value=e},_e=e=>{typeof e=="number"&&(p.paginationConfig.currentPage=e,S())},fe=e=>{p.paginationConfig.currentPage=1,p.paginationConfig.pageSize=e,S()},J=()=>{if(_.value.length===0){R.confirm(a("data_export.sure_del_all"),{confirmButtonType:"danger",type:"warning",autofocus:!1,showClose:!1}).then(()=>{Ge(u.value,_.value.map(e=>e.id)).then(()=>{N.success(a("commons.delete_success")),S()})}).catch(()=>{});return}R.confirm(a("data_export.sure_del"),{confirmButtonType:"danger",type:"warning",autofocus:!1,showClose:!1}).then(()=>{Be(_.value.map(e=>e.id)).then(()=>{N.success(a("commons.delete_success")),S()})}).catch(()=>{})};return B({name:"task-export-topic-call",callback:le}),E({init:ae}),(e,s)=>{const n=xe,L=he,me=Ee,$=ke,ge=be,ve=ye,Ce=Le;return i(),C(Z,null,[Pe((i(),f(ge,{"modal-class":"de-export-excel",title:e.$t("data_export.export_center"),modelValue:k.value,"onUpdate:modelValue":s[1]||(s[1]=l=>k.value=l),direction:"rtl",size:"1000px","append-to-body":"","before-close":Q},{default:t(()=>[o(r(Se),{modelValue:u.value,"onUpdate:modelValue":s[0]||(s[0]=l=>u.value=l),onTabClick:S},{default:t(()=>[(i(!0),C(Z,null,Te(P.value,l=>(i(),f(r(we),{key:l.name,label:l.label,name:l.name},null,8,["label","name"]))),128))]),_:1},8,["modelValue"]),u.value==="SUCCESS"&&_.value.length===0?(i(),f(r(g),{key:0,secondary:"",onClick:W},{icon:t(()=>[o(w,{name:"dv-preview-download"},{default:t(()=>[o(r(U),{class:"svg-icon"})]),_:1})]),default:t(()=>[h(" "+d(e.$t("data_export.download_all")),1)]),_:1})):c("",!0),u.value==="SUCCESS"&&_.value.length!==0?(i(),f(r(g),{key:1,secondary:"",onClick:W},{icon:t(()=>[o(w,{name:"dv-preview-download"},{default:t(()=>[o(r(U),{class:"svg-icon"})]),_:1})]),default:t(()=>[h(" "+d(e.$t("data_export.download")),1)]),_:1})):c("",!0),_.value.length===0?(i(),f(r(g),{key:2,secondary:"",onClick:J},{icon:t(()=>[o(w,{name:"de-delete"},{default:t(()=>[o(r(V),{class:"svg-icon"})]),_:1})]),default:t(()=>[h(d(e.$t("data_export.del_all")),1)]),_:1})):c("",!0),_.value.length!==0?(i(),f(r(g),{key:3,secondary:"",onClick:J},{icon:t(()=>[o(w,{name:"de-delete"},{default:t(()=>[o(r(V),{class:"svg-icon"})]),_:1})]),default:t(()=>[h(d(e.$t("commons.delete")),1)]),_:1})):c("",!0),m("div",{class:$e(["table-container",!x.value.length&&"hidden-bottom"])},[o(Je,{ref:"multipleTable",pagination:p.paginationConfig,"table-data":x.value,class:"popper-max-width",onCurrentChange:_e,onSizeChange:fe,onSelectionChange:pe},{empty:t(()=>[o(r(Re),{description:y.value,"img-type":"noneWhite"},null,8,["description"])]),default:t(()=>[o(n,{type:"selection",width:"50"}),o(n,{prop:"fileName",label:e.$t("driver.file_name"),width:"332"},{default:t(l=>[m("div",Ye,[o(L,{style:{"font-size":"24px"}},{default:t(()=>[o(w,{name:"icon_file-excel_colorful"},{default:t(()=>[o(r(qe),{class:"svg-icon"})]),_:1})]),_:1}),m("div",Ke,[m("div",Qe,d(l.row.fileName),1),l.row.exportStatus==="FAILED"?(i(),C("div",{key:0,class:"failed",onClick:F=>re(l.row)},d(e.$t("data_export.export_failed")),9,Xe)):c("",!0),l.row.exportStatus==="SUCCESS"?(i(),C("div",ea,d(l.row.fileSize)+d(l.row.fileSizeUnit),1)):c("",!0)])]),l.row.exportStatus==="FAILED"?(i(),C("div",aa)):c("",!0),l.row.exportStatus==="IN_PROGRESS"?(i(),f(me,{key:1,percentage:+l.row.exportProgress},null,8,["percentage"])):c("",!0)]),_:1},8,["label"]),o(n,{prop:"exportFromName",label:e.$t("data_export.export_obj"),width:"200"},null,8,["label"]),o(n,{prop:"exportTime",width:"180",label:e.$t("data_export.export_time")},{default:t(l=>[m("span",null,d(ie(l.row.exportTime)),1)]),_:1},8,["label"]),o(n,{prop:"exportFromType",width:"120",label:e.$t("data_export.export_from")},{default:t(l=>[l.row.exportFromType==="dataset"?(i(),C("span",ta,d(r(a)("data_set.data_set")),1)):c("",!0),l.row.exportFromType==="chart"?(i(),C("span",oa,d(r(a)("data_set.view")),1)):c("",!0),l.row.exportFromType==="data_filling"?(i(),C("span",la,d(r(a)("data_fill.data_fill")),1)):c("",!0)]),_:1},8,["label"]),r(ee)?c("",!0):(i(),f(n,{key:0,prop:"orgName",label:r(a)("data_set.organization"),width:"200"},null,8,["label"])),o(n,{fixed:"right",prop:"operate",width:"90",label:e.$t("commons.operating")},{default:t(l=>[o($,{effect:"dark",content:r(a)("data_set.download"),placement:"top"},{default:t(()=>[l.row.exportStatus==="SUCCESS"?(i(),f(r(g),{key:0,text:"",onClick:F=>de(l.row)},{icon:t(()=>[o(L,null,{default:t(()=>[o(w,{name:"dv-preview-download"},{default:t(()=>[o(r(U),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["onClick"])):c("",!0)]),_:2},1032,["content"]),o($,{effect:"dark",content:r(a)("data_set.re_export"),placement:"top"},{default:t(()=>[l.row.exportStatus==="FAILED"?(i(),f(r(g),{key:0,text:"",onClick:F=>ce(l.row)},{icon:t(()=>[o(w,{name:"icon_refresh_outlined"},{default:t(()=>[o(r(Fe),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])):c("",!0)]),_:2},1032,["content"]),o($,{effect:"dark",content:r(a)("data_set.delete"),placement:"top"},{default:t(()=>[o(r(g),{text:"",onClick:F=>ue(l.row)},{icon:t(()=>[o(w,{name:"de-delete"},{default:t(()=>[o(r(V),{class:"svg-icon"})]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["content"])]),_:1},8,["label"])]),_:1},8,["pagination","table-data"])],2)]),_:1},8,["title","modelValue"])),[[Ce,I.value]]),o(ve,{title:r(a)("data_set.reason_for_failure"),modelValue:b.value,"onUpdate:modelValue":s[3]||(s[3]=l=>b.value=l),width:"30%"},{footer:t(()=>[m("span",na,[o(r(g),{type:"primary",onClick:s[2]||(s[2]=l=>b.value=!1)},{default:t(()=>[h(d(r(a)("data_set.closure")),1)]),_:1})])]),default:t(()=>[m("span",null,d(A.value),1)]),_:1},8,["title","modelValue"])],64)}}});export{Ca as _};

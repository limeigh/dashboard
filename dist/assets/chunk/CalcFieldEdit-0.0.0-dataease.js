import{r as Ce,w as xe,x as we,i as De,e as Te,y as Ve,f as qe,b as Fe,p as Se,B as Ne,M as Ee,A as Le,g as Oe}from"./element-plus-secondary-0.0.0-dataease.js";import{f as $e,e as Me}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as Ie,r as x,l as K,b as Je,e as Ue,w as ee,k as Qe,o as c,c as _,a as i,W as t,U as o,u as a,a9 as te,X as F,z as D,_ as y,Y as d,T,V as O,S as $,a8 as M,n as ae,R as Be}from"./@vue-0.0.0-dataease.js";import{i as j}from"./icon_info_outlined-0.0.0-dataease.js";import{i as oe}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{i as le}from"./icon_adjustment_outlined-0.0.0-dataease.js";import{i as Re}from"./icon_edit_outlined-0.0.0-dataease.js";import{i as ze}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import Ae from"./CodeMirror-0.0.0-dataease2.js";import{L as Pe}from"./dataset-0.0.0-dataease.js";import{f as k}from"./attr-0.0.0-dataease23.js";import{g as Ke}from"./util-0.0.0-dataease.js";import{i as I}from"./field-list-0.0.0-dataease.js";import{h as V}from"./lodash-es-0.0.0-dataease.js";import{_ as je}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./@vueuse-0.0.0-dataease.js";import"./@element-plus-0.0.0-dataease.js";import"./dayjs-0.0.0-dataease.js";import"./@amap-0.0.0-dataease.js";import"./@popperjs-0.0.0-dataease.js";import"./async-validator-0.0.0-dataease.js";import"./@ctrl-0.0.0-dataease.js";import"./normalize-wheel-es-0.0.0-dataease.js";import"./memoize-one-0.0.0-dataease.js";import"./pinia-0.0.0-dataease.js";import"./vue-demi-0.0.0-dataease.js";import"./index-0.0.0-dataease.js";import"./mitt-0.0.0-dataease.js";import"./web-storage-cache-0.0.0-dataease.js";import"./vue-types-0.0.0-dataease.js";import"./is-plain-object-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./qs-0.0.0-dataease.js";import"./side-channel-0.0.0-dataease.js";import"./es-errors-0.0.0-dataease.js";import"./object-inspect-0.0.0-dataease.js";import"./crypto-js-0.0.0-dataease.js";import"./side-channel-list-0.0.0-dataease.js";import"./side-channel-map-0.0.0-dataease.js";import"./get-intrinsic-0.0.0-dataease.js";import"./es-object-atoms-0.0.0-dataease.js";import"./math-intrinsics-0.0.0-dataease.js";import"./gopd-0.0.0-dataease.js";import"./es-define-property-0.0.0-dataease.js";import"./has-symbols-0.0.0-dataease.js";import"./get-proto-0.0.0-dataease.js";import"./dunder-proto-0.0.0-dataease.js";import"./call-bind-apply-helpers-0.0.0-dataease.js";import"./function-bind-0.0.0-dataease.js";import"./hasown-0.0.0-dataease.js";import"./call-bound-0.0.0-dataease.js";import"./side-channel-weakmap-0.0.0-dataease.js";import"./jspdf-0.0.0-dataease.js";import"./@babel-0.0.0-dataease.js";import"./fflate-0.0.0-dataease.js";import"./fast-png-0.0.0-dataease.js";import"./iobuffer-0.0.0-dataease.js";import"./pako-0.0.0-dataease.js";import"./vue-router_2-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./vue-0.0.0-dataease.js";import"./vue-i18n-0.0.0-dataease.js";import"./@intlify-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./zrender-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./@codemirror-0.0.0-dataease.js";import"./@lezer-0.0.0-dataease.js";import"./style-mod-0.0.0-dataease.js";import"./crelt-0.0.0-dataease.js";import"./@marijn-0.0.0-dataease.js";import"./w3c-keyname-0.0.0-dataease.js";import"./codemirror-0.0.0-dataease.js";import"./js-base64-0.0.0-dataease.js";import"./snowflake-id-0.0.0-dataease.js";const He={class:"calcu-cont"},We={style:{flex:"1"}},Xe={style:{"max-width":"488px"}},Ye={class:"btn-select"},Ge={style:{display:"flex","align-items":"center"}},Ze={style:{"margin-left":"5px","font-size":"12px",color:"#8492a6"}},et={class:"mb8 field-exp"},tt={key:0},at={key:1},ot={class:"padding-lr"},lt={class:"mb8"},st={class:"padding-lr-content"},nt={class:"field-height"},it={key:0,class:"field-list"},rt=["title","onClick"],dt=["title"],ct={key:1,class:"class-na"},ut={class:"quota-btn_de"},pt={class:"field-height"},mt={key:0,class:"field-list"},_t=["onClick"],ft=["title"],vt={key:2,class:"icon-right"},gt={key:1,class:"class-na"},ht={class:"padding-lr"},yt={class:"mb8"},bt={key:0},kt={key:1},Ct={class:"padding-lr-content"},xt={key:0,style:{width:"100%"}},wt=["onClick"],Dt={class:"pop-title"},Tt={class:"pop-info"},Vt={class:"pop-info"},qt={key:1,class:"class-na"},Ft={class:"dialog-footer"},St=Ie({__name:"CalcFieldEdit",props:{crossDs:{type:Boolean,default:()=>!1}},setup(se,{expose:ne}){const{t:s}=$e(),H=x(),J=x(""),U=x(""),p=x(),W=se,ie=[{label:s("dataset.text"),value:0},{label:s("dataset.time"),value:1},{label:s("dataset.value"),value:2},{label:s("dataset.value")+"("+s("dataset.float")+")",value:3},{label:s("dataset.location"),value:5},{label:"URL",value:7}],X={originName:"",name:"",groupType:"d",type:"VARCHAR",deType:0,extField:2,id:"",params:[],checked:!0},u=K({functionData:[],dimensionData:[],dimensionList:[],quotaData:[]}),Q=x(),h=K({id:null,name:"",value:null}),S=x(!1),re={name:[{required:!0,message:s("data_set.enter_parameter_name"),trigger:"blur"},{min:1,max:50,message:s("data_set.enter_1_50_characters"),trigger:"blur"}],value:[{required:!0,message:s("data_set.parameter_default_value"),trigger:"blur"}]},B=()=>{Q.value.resetFields(),S.value=!1},de=()=>{Q.value.validate(n=>{if(n){h.id||(h.id=`params_${Ke()}`);const e=V(a(h));r.params=[e];const v=u.quotaData.find(g=>g.id===h.id);if(v){const g=p.value.state.doc.toString(),b=[];r.originName=q("name","id",g,b),Object.assign(v,V(a(h))),ae(()=>{p.value.dispatch({changes:{from:0,to:p.value.viewState.state.doc.length,insert:q("id","name",r.originName)}})})}else u.quotaData.push(e);B()}})},r=K({...X}),ce=()=>{const n=p.value.state.doc.toString(),e=[];r.originName=q("name","id",n,e)},q=(n,e,v,g)=>{let b=v;const w=[...E,...N].reduce((m,C)=>(m[C[n]]=C[e],m),{}),f=v.match(/\[(.+?)\]/g)||[];return f&&f.forEach(m=>{const C=m.slice(1,-1);g&&g.push(w[C]),b=b.replace(`[${C}]`,`[${w[C]}]`)}),b};let N=[],E=[];const ue=(n,e,v)=>{if(h.id=null,Object.assign(r,{...X,...n}),u.dimensionData=e,u.quotaData=v.concat(r.params||[]),N=V(v.concat(r.params||[])),E=V(e),setTimeout(()=>{z.value.clearValidate()},100),!n.originName){p.value.dispatch({changes:{from:0,to:p.value.viewState.state.doc.length,insert:""}});return}ae(()=>{p.value.dispatch({changes:{from:0,to:p.value.viewState.state.doc.length,insert:q("id","name",n.originName)}})})},Y=n=>{p.value.dispatch({changes:{from:p.value.viewState.state.selection.ranges[0].from,insert:n},selection:{anchor:p.value.viewState.state.selection.ranges[0].from}})};Je(()=>{p.value=H.value.codeComInit()}),Ue(()=>{var n,e;(e=(n=p.value).destroy)==null||e.call(n)});const pe=n=>{p.value.dispatch({changes:{from:p.value.viewState.state.selection.ranges[0].from,insert:n},selection:{anchor:p.value.viewState.state.selection.ranges[0].from}})};let R=[];const me=()=>{Pe().then(n=>{R=V(n),u.functionData=V(n)})};ee(()=>J.value,n=>{n&&n!==""?(u.dimensionData=JSON.parse(JSON.stringify(E.filter(e=>e.name.toLocaleLowerCase().includes(n.toLocaleLowerCase())&&e.extField===0))),u.quotaData=JSON.parse(JSON.stringify(N.filter(e=>e.name.toLocaleLowerCase().includes(n.toLocaleLowerCase())&&e.extField===0)))):(u.dimensionData=JSON.parse(JSON.stringify(E)),u.quotaData=JSON.parse(JSON.stringify(N)))}),ee(()=>U.value,n=>{n&&n!==""?u.functionData=JSON.parse(JSON.stringify(R.filter(e=>e.func.toLocaleLowerCase().includes(n.toLocaleLowerCase())))):u.functionData=V(R)});const z=x();ne({initEdit:ue,setFieldForm:ce,fieldForm:r,formField:z});const G=x(""),_e=()=>{A.value||(G.value=s("data_set.add_calculation_parameters"),r.params||(r.params=[]),S.value=!0)},fe=()=>{const[n]=r.params;G.value=s("data_set.edit_calculation_parameters"),Object.assign(h,n||{}),S.value=!0},A=Qe(()=>{var n;return!!((n=r.params)!=null&&n.length)}),ve=()=>{const[n]=r.params;r.params=[];const e=p.value.state.doc.toString(),v=[];r.originName=q("name","id",e,v).replaceAll(`[${n.id}]`,""),u.quotaData=u.quotaData.filter(g=>g.id!==n.id),p.value.dispatch({changes:{from:0,to:p.value.viewState.state.doc.length,insert:q("id","name",r.originName)}})};return me(),(n,e)=>{const v=Ce,g=xe,b=we,w=De,f=Me,m=Te,C=Le,ge=Ve,L=qe,Z=Fe,he=Oe,ye=Se,be=Ne,ke=Ee;return c(),_("div",{onKeydown:e[11]||(e[11]=F(()=>{},["stop"])),onKeyup:e[12]||(e[12]=F(()=>{},["stop"])),class:"calcu-field"},[i("div",He,[i("div",We,[i("div",Xe,[t(b,{"require-asterisk-position":"right",ref_key:"formField",ref:z,onKeydown:e[1]||(e[1]=te(F(()=>{},["stop","prevent"]),["enter"])),model:r,"label-position":"top"},{default:o(()=>[t(g,{prop:"name",rules:[{required:!0,message:a(s)("dataset.input_edit_name")},{max:50,message:a(s)("commons.char_can_not_more_50")}],label:a(s)("dataset.field_edit_name")},{default:o(()=>[t(v,{modelValue:r.name,"onUpdate:modelValue":e[0]||(e[0]=l=>r.name=l),placeholder:a(s)("dataset.input_edit_name")},null,8,["modelValue","placeholder"])]),_:1},8,["rules","label"])]),_:1},8,["model"]),i("div",null,[t(b,{"label-position":"top",ref:"form",inline:"",model:r},{default:o(()=>[t(g,{class:"mr12",label:a(s)("dataset.data_type")},{default:o(()=>[i("div",Ye,[t(w,{onClick:e[2]||(e[2]=l=>r.groupType="d"),class:D([r.groupType==="d"&&"is-active"]),text:""},{default:o(()=>[y(d(a(s)("chart.dimension_abb")),1)]),_:1},8,["class"]),t(w,{onClick:e[3]||(e[3]=l=>r.groupType="q"),class:D([r.groupType==="q"&&"is-active"]),text:""},{default:o(()=>[y(d(a(s)("chart.quota_abb")),1)]),_:1},8,["class"])])]),_:1},8,["label"]),t(g,{class:"mr0",label:a(s)("dataset.field_type")},{default:o(()=>[t(ge,{modelValue:r.deType,"onUpdate:modelValue":e[4]||(e[4]=l=>r.deType=l),style:{width:"376px"}},{prefix:o(()=>[t(m,null,{default:o(()=>[t(f,null,{default:o(()=>[(c(),T(O(a(I)[a(k)[r.deType]]),{class:D(["svg-icon",`field-icon-${a(k)[r.deType]}`])},null,8,["class"]))]),_:1})]),_:1})]),default:o(()=>[(c(),_($,null,M(ie,l=>t(C,{key:l.value,label:l.label,value:l.value},{default:o(()=>[i("span",Ge,[t(m,null,{default:o(()=>[t(f,null,{default:o(()=>[(c(),T(O(a(I)[a(k)[l.value]]),{class:D(["svg-icon",`field-icon-${a(k)[l.value]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024)]),i("span",Ze,d(l.label),1)]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),i("div",et,[i("span",null,d(a(s)("dataset.field_exp")),1),e[13]||(e[13]=i("span",null,"*",-1)),t(L,{class:"item",effect:"dark",placement:"top"},{content:o(()=>[W.crossDs?(c(),_("div",tt,d(a(s)("dataset.calc_tips.tip1")),1)):(c(),_("div",at,d(a(s)("dataset.calc_tips.tip1_1")),1)),i("div",null,d(a(s)("dataset.calc_tips.tip2")),1)]),default:o(()=>[t(m,{size:"16px"},{default:o(()=>[t(f,{name:"icon_info_outlined"},{default:o(()=>[t(a(j),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),t(Ae,{quotaMap:u.quotaData.map(l=>l.name),dimensionMap:u.dimensionData.map(l=>l.name),ref_key:"myCm",ref:H,height:"318px","dom-id":"calcField"},null,8,["quotaMap","dimensionMap"])])]),i("div",ot,[i("span",lt,[y(d(a(s)("dataset.click_ref_field"))+" ",1),t(L,{class:"item",effect:"dark",placement:"bottom"},{content:o(()=>[y(d(a(s)("dataset.calc_tips.tip3"))+" ",1),e[14]||(e[14]=i("br",null,null,-1)),y(" "+d(a(s)("dataset.calc_tips.tip4"))+" ",1),e[15]||(e[15]=i("br",null,null,-1)),y(" "+d(a(s)("dataset.calc_tips.tip5")),1)]),default:o(()=>[t(m,{size:"16px"},{default:o(()=>[t(f,{name:"icon_info_outlined"},{default:o(()=>[t(a(j),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),i("div",st,[t(v,{modelValue:J.value,"onUpdate:modelValue":e[5]||(e[5]=l=>J.value=l),placeholder:a(s)("dataset.edit_search"),clearable:""},{prefix:o(()=>[t(m,null,{default:o(()=>[t(f,{name:"icon_search-outline_outlined"},{default:o(()=>[t(a(oe),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"]),i("div",nt,[t(Z,null,{default:o(()=>[i("span",null,d(a(s)("chart.dimension")),1),u.dimensionData.length?(c(),_("div",it,[(c(!0),_($,null,M(u.dimensionData,l=>(c(),_("span",{key:l.id,class:"item-dimension flex-align-center",title:l.name,onClick:P=>Y("["+l.name+"]")},[t(m,null,{default:o(()=>[t(f,null,{default:o(()=>[(c(),T(O(a(I)[a(k)[l.deType]]),{class:D(["svg-icon",`field-icon-${a(k)[l.deType]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),i("span",{class:"ellipsis",title:l.name},d(l.name),9,dt)],8,rt))),128))])):(c(),_("div",ct,d(a(s)("dataset.na")),1))]),_:1})]),i("div",ut,[i("span",null,d(a(s)("chart.quota")),1),t(L,{effect:"dark",content:A.value?a(s)("data_set.parameter_is_supported"):a(s)("data_set.add_calculation_parameters"),placement:"top"},{default:o(()=>[t(m,{class:"hover-icon_quota",onClick:_e},{default:o(()=>[t(f,{class:D([`field-icon-${a(k)[0]}`,A.value&&"not-allow"]),style:{color:"#646a73"},name:"icon_adjustment_outlined"},{default:o(()=>[t(a(le),{class:"svg-icon"})]),_:1},8,["class"])]),_:1})]),_:1},8,["content"])]),i("div",pt,[t(Z,null,{default:o(()=>[u.quotaData.length?(c(),_("div",mt,[(c(!0),_($,null,M(u.quotaData,l=>(c(),_("span",{key:l.id,class:"item-quota flex-align-center",onClick:P=>Y("["+l.name+"]")},[l.groupType?(c(),T(m,{key:1},{default:o(()=>[t(f,null,{default:o(()=>[(c(),T(O(a(I)[a(k)[l.deType]]),{class:D(["svg-icon",`field-icon-${a(k)[l.deType]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024)):(c(),T(m,{key:0},{default:o(()=>[t(f,{name:"icon_adjustment_outlined"},{default:o(()=>[t(a(le),{class:"svg-icon"})]),_:1})]),_:1})),i("span",{class:"ellipsis",title:l.name},d(l.name),9,ft),l.groupType?Be("",!0):(c(),_("div",vt,[t(m,{onClick:F(fe,["stop"]),class:"hover-icon"},{default:o(()=>[t(f,{name:"icon_edit_outlined"},{default:o(()=>[t(a(Re),{class:"svg-icon"})]),_:1})]),_:1}),t(m,{onClick:F(ve,["stop"]),class:"hover-icon"},{default:o(()=>[t(f,{name:"icon_delete-trash_outlined"},{default:o(()=>[t(a(ze),{class:"svg-icon"})]),_:1})]),_:1})]))],8,_t))),128))])):(c(),_("div",gt,d(a(s)("dataset.na")),1))]),_:1})])])]),i("div",ht,[i("span",yt,[y(d(a(s)("dataset.click_ref_function"))+" ",1),t(L,{class:"item",effect:"dark",placement:"bottom"},{content:o(()=>[W.crossDs?(c(),_("div",bt,[y(d(a(s)("dataset.calc_tips.tip6"))+" ",1),e[16]||(e[16]=i("br",null,null,-1)),y(" "+d(a(s)("dataset.calc_tips.tip8"))+" ",1),e[17]||(e[17]=i("br",null,null,-1)),e[18]||(e[18]=y(" https://calcite.apache.org/docs/reference.html ",-1))])):(c(),_("div",kt,d(a(s)("dataset.calc_tips.tip7")),1))]),default:o(()=>[t(m,{size:"16px"},{default:o(()=>[t(f,{name:"icon_info_outlined"},{default:o(()=>[t(a(j),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),i("div",Ct,[t(v,{modelValue:U.value,"onUpdate:modelValue":e[6]||(e[6]=l=>U.value=l),style:{"margin-bottom":"8px"},placeholder:a(s)("dataset.edit_search"),clearable:""},{prefix:o(()=>[t(m,null,{default:o(()=>[t(f,{name:"icon_search-outline_outlined"},{default:o(()=>[t(a(oe),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"]),t(ye,{class:"function-height"},{default:o(()=>[u.functionData.length?(c(),_("div",xt,[(c(!0),_($,null,M(u.functionData,(l,P)=>(c(),T(he,{key:P,class:"function-pop",placement:"right",width:"200",trigger:"hover","open-delay":500},{reference:o(()=>[i("span",{class:"function-style flex-align-center",onClick:Nt=>pe(l.func)},d(l.func),9,wt)]),default:o(()=>[i("p",Dt,d(l.name),1),i("p",Tt,d(l.func),1),i("p",Vt,d(l.desc),1)]),_:2},1024))),128))])):(c(),_("div",qt,d(a(s)("chart.no_function")),1))]),_:1})])])]),t(ke,{"before-close":B,modelValue:S.value,"onUpdate:modelValue":e[10]||(e[10]=l=>S.value=l),"append-to-body":"",class:"create-dialog",title:a(s)("data_set.add_calculation_parameters"),width:"500"},{footer:o(()=>[i("div",Ft,[t(w,{onClick:B},{default:o(()=>[y(d(a(s)("chart.cancel")),1)]),_:1}),t(w,{type:"primary",onClick:de},{default:o(()=>[y(d(a(s)("chart.confirm")),1)]),_:1})])]),default:o(()=>[t(b,{onKeydown:e[9]||(e[9]=te(F(()=>{},["stop","prevent"]),["enter"])),"label-position":"top",ref_key:"formQuotaRef",ref:Q,model:h,rules:re},{default:o(()=>[t(g,{label:a(s)("data_set.parameter_name"),prop:"name"},{default:o(()=>[t(v,{style:{width:"100%"},modelValue:h.name,"onUpdate:modelValue":e[7]||(e[7]=l=>h.name=l),placeholder:a(s)("data_set.enter_1_50_characters")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(g,{label:a(s)("data_set.parameter_default_value_de"),prop:"value"},{default:o(()=>[t(be,{style:{width:"100%"},modelValue:h.value,"onUpdate:modelValue":e[8]||(e[8]=l=>h.value=l),placeholder:a(s)("data_set.enter_a_number"),"controls-position":"right"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],32)}}});const Za=je(St,[["__scopeId","data-v-5f316016"]]);export{Za as default};

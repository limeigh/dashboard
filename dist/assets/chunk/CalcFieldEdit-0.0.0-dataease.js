import{R as Ce}from"./index-0.0.0-dataease.js";import{E as xe}from"./el-dialog-0.0.0-dataease.js";import{o as we,G as De,y as Te,n as Ve,j as Ee}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import"./el-input-number-0.0.0-dataease.js";import{E as qe}from"./el-row-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as Fe}from"./el-popover-0.0.0-dataease.js";import"./el-tooltip-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import{E as Se,a as Ne}from"./el-select-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import{E as Le,a as Oe}from"./el-form-item-0.0.0-dataease.js";import{d as $e,r as x,X as A,o as Me,a as Ie,w as ee,y as Je,f as c,O as _,P as i,j as t,i as o,u as a,a9 as te,a8 as q,S as D,a3 as y,a4 as r,g as T,l as O,W as $,a6 as M,n as ae,_ as Qe}from"./vue-0.0.0-dataease.js";import{i as K}from"./icon_info_outlined-0.0.0-dataease.js";import{i as oe}from"./icon_search-outline_outlined-0.0.0-dataease.js";import{i as le}from"./icon_adjustment_outlined-0.0.0-dataease.js";import{i as Ue}from"./icon_edit_outlined-0.0.0-dataease.js";import{i as Re}from"./icon_delete-trash_outlined-0.0.0-dataease.js";import Be from"./CodeMirror-0.0.0-dataease.js";import{M as Pe}from"./dataset-0.0.0-dataease.js";import{f as k}from"./attr-0.0.0-dataease23.js";import{g as je}from"./util-0.0.0-dataease.js";import{i as I}from"./field-list-0.0.0-dataease.js";import{e as V}from"./lodash-0.0.0-dataease.js";import{E as ze}from"./index-0.0.0-dataease4.js";import{E as Ae}from"./index-0.0.0-dataease20.js";import{_ as Ke}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./index-0.0.0-dataease3.js";import"./use-dialog-0.0.0-dataease.js";import"./refs-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./constants-0.0.0-dataease.js";import"./dropdown-0.0.0-dataease.js";import"./index-0.0.0-dataease6.js";import"./token-0.0.0-dataease.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease5.js";import"./index-0.0.0-dataease18.js";const Ge={class:"calcu-cont"},He={style:{flex:"1"}},We={style:{"max-width":"488px"}},Xe={class:"btn-select"},Ye={style:{display:"flex","align-items":"center"}},Ze={style:{"margin-left":"5px","font-size":"12px",color:"#8492a6"}},et={class:"mb8 field-exp"},tt={key:0},at={key:1},ot={class:"padding-lr"},lt={class:"mb8"},st={class:"padding-lr-content"},nt={class:"field-height"},it={key:0,class:"field-list"},dt=["title","onClick"],rt=["title"],ct={key:1,class:"class-na"},ut={class:"quota-btn_de"},pt={class:"field-height"},mt={key:0,class:"field-list"},_t=["onClick"],ft=["title"],vt={key:2,class:"icon-right"},gt={key:1,class:"class-na"},ht={class:"padding-lr"},yt={class:"mb8"},bt={key:0},kt={key:1},Ct={class:"padding-lr-content"},xt={key:0,style:{width:"100%"}},wt=["onClick"],Dt={class:"pop-title"},Tt={class:"pop-info"},Vt={class:"pop-info"},Et={key:1,class:"class-na"},qt={class:"dialog-footer"},Ft=$e({__name:"CalcFieldEdit",props:{crossDs:{type:Boolean,default:()=>!1}},setup(se,{expose:ne}){const{t:s}=we(),G=x(),J=x(""),Q=x(""),p=x(),H=se,ie=[{label:s("dataset.text"),value:0},{label:s("dataset.time"),value:1},{label:s("dataset.value"),value:2},{label:s("dataset.value")+"("+s("dataset.float")+")",value:3},{label:s("dataset.location"),value:5},{label:"URL",value:7}],W={originName:"",name:"",groupType:"d",type:"VARCHAR",deType:0,extField:2,id:"",params:[],checked:!0},u=A({functionData:[],dimensionData:[],dimensionList:[],quotaData:[]}),U=x(),h=A({id:null,name:"",value:null}),F=x(!1),de={name:[{required:!0,message:s("data_set.enter_parameter_name"),trigger:"blur"},{min:1,max:50,message:s("data_set.enter_1_50_characters"),trigger:"blur"}],value:[{required:!0,message:s("data_set.parameter_default_value"),trigger:"blur"}]},R=()=>{U.value.resetFields(),F.value=!1},re=()=>{U.value.validate(n=>{if(n){h.id||(h.id=`params_${je()}`);const e=V(a(h));d.params=[e];const v=u.quotaData.find(g=>g.id===h.id);if(v){const g=p.value.state.doc.toString(),b=[];d.originName=E("name","id",g,b),Object.assign(v,V(a(h))),ae(()=>{p.value.dispatch({changes:{from:0,to:p.value.viewState.state.doc.length,insert:E("id","name",d.originName)}})})}else u.quotaData.push(e);R()}})},d=A({...W}),ce=()=>{const n=p.value.state.doc.toString(),e=[];d.originName=E("name","id",n,e)},E=(n,e,v,g)=>{let b=v;const w=[...N,...S].reduce((m,C)=>(m[C[n]]=C[e],m),{}),f=v.match(/\[(.+?)\]/g)||[];return f&&f.forEach(m=>{const C=m.slice(1,-1);g&&g.push(w[C]),b=b.replace(`[${C}]`,`[${w[C]}]`)}),b};let S=[],N=[];const ue=(n,e,v)=>{if(h.id=null,Object.assign(d,{...W,...n}),u.dimensionData=e,u.quotaData=v.concat(d.params||[]),S=V(v.concat(d.params||[])),N=V(e),setTimeout(()=>{P.value.clearValidate()},100),!n.originName){p.value.dispatch({changes:{from:0,to:p.value.viewState.state.doc.length,insert:""}});return}ae(()=>{p.value.dispatch({changes:{from:0,to:p.value.viewState.state.doc.length,insert:E("id","name",n.originName)}})})},X=n=>{p.value.dispatch({changes:{from:p.value.viewState.state.selection.ranges[0].from,insert:n},selection:{anchor:p.value.viewState.state.selection.ranges[0].from}})};Me(()=>{p.value=G.value.codeComInit()}),Ie(()=>{var n,e;(e=(n=p.value).destroy)==null||e.call(n)});const pe=n=>{p.value.dispatch({changes:{from:p.value.viewState.state.selection.ranges[0].from,insert:n},selection:{anchor:p.value.viewState.state.selection.ranges[0].from}})};let B=[];const me=()=>{Pe().then(n=>{B=V(n),u.functionData=V(n)})};ee(()=>J.value,n=>{n&&n!==""?(u.dimensionData=JSON.parse(JSON.stringify(N.filter(e=>e.name.toLocaleLowerCase().includes(n.toLocaleLowerCase())&&e.extField===0))),u.quotaData=JSON.parse(JSON.stringify(S.filter(e=>e.name.toLocaleLowerCase().includes(n.toLocaleLowerCase())&&e.extField===0)))):(u.dimensionData=JSON.parse(JSON.stringify(N)),u.quotaData=JSON.parse(JSON.stringify(S)))}),ee(()=>Q.value,n=>{n&&n!==""?u.functionData=JSON.parse(JSON.stringify(B.filter(e=>e.func.toLocaleLowerCase().includes(n.toLocaleLowerCase())))):u.functionData=V(B)});const P=x();ne({initEdit:ue,setFieldForm:ce,fieldForm:d,formField:P});const Y=x(""),_e=()=>{j.value||(Y.value=s("data_set.add_calculation_parameters"),d.params||(d.params=[]),F.value=!0)},fe=()=>{const[n]=d.params;Y.value=s("data_set.edit_calculation_parameters"),Object.assign(h,n||{}),F.value=!0},j=Je(()=>{var n;return!!((n=d.params)!=null&&n.length)}),ve=()=>{const[n]=d.params;d.params=[];const e=p.value.state.doc.toString(),v=[];d.originName=E("name","id",e,v).replaceAll(`[${n.id}]`,""),u.quotaData=u.quotaData.filter(g=>g.id!==n.id),p.value.dispatch({changes:{from:0,to:p.value.viewState.state.doc.length,insert:E("id","name",d.originName)}})};return me(),(n,e)=>{const v=De,g=Le,b=Oe,w=Te,f=Ve,m=Ee,C=Ne,ge=Se,L=ze,Z=Ce,he=Fe,ye=qe,be=Ae,ke=xe;return c(),_("div",{onKeydown:e[11]||(e[11]=q(()=>{},["stop"])),onKeyup:e[12]||(e[12]=q(()=>{},["stop"])),class:"calcu-field"},[i("div",Ge,[i("div",He,[i("div",We,[t(b,{"require-asterisk-position":"right",ref_key:"formField",ref:P,onKeydown:e[1]||(e[1]=te(q(()=>{},["stop","prevent"]),["enter"])),model:d,"label-position":"top"},{default:o(()=>[t(g,{prop:"name",rules:[{required:!0,message:a(s)("dataset.input_edit_name")},{max:50,message:a(s)("commons.char_can_not_more_50")}],label:a(s)("dataset.field_edit_name")},{default:o(()=>[t(v,{modelValue:d.name,"onUpdate:modelValue":e[0]||(e[0]=l=>d.name=l),placeholder:a(s)("dataset.input_edit_name")},null,8,["modelValue","placeholder"])]),_:1},8,["rules","label"])]),_:1},8,["model"]),i("div",null,[t(b,{"label-position":"top",ref:"form",inline:"",model:d},{default:o(()=>[t(g,{class:"mr12",label:a(s)("dataset.data_type")},{default:o(()=>[i("div",Xe,[t(w,{onClick:e[2]||(e[2]=l=>d.groupType="d"),class:D([d.groupType==="d"&&"is-active"]),text:""},{default:o(()=>[y(r(a(s)("chart.dimension_abb")),1)]),_:1},8,["class"]),t(w,{onClick:e[3]||(e[3]=l=>d.groupType="q"),class:D([d.groupType==="q"&&"is-active"]),text:""},{default:o(()=>[y(r(a(s)("chart.quota_abb")),1)]),_:1},8,["class"])])]),_:1},8,["label"]),t(g,{class:"mr0",label:a(s)("dataset.field_type")},{default:o(()=>[t(ge,{modelValue:d.deType,"onUpdate:modelValue":e[4]||(e[4]=l=>d.deType=l),style:{width:"376px"}},{prefix:o(()=>[t(m,null,{default:o(()=>[t(f,null,{default:o(()=>[(c(),T(O(a(I)[a(k)[d.deType]]),{class:D(["svg-icon",`field-icon-${a(k)[d.deType]}`])},null,8,["class"]))]),_:1})]),_:1})]),default:o(()=>[(c(),_($,null,M(ie,l=>t(C,{key:l.value,label:l.label,value:l.value},{default:o(()=>[i("span",Ye,[t(m,null,{default:o(()=>[t(f,null,{default:o(()=>[(c(),T(O(a(I)[a(k)[l.value]]),{class:D(["svg-icon",`field-icon-${a(k)[l.value]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024)]),i("span",Ze,r(l.label),1)]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),i("div",et,[i("span",null,r(a(s)("dataset.field_exp")),1),e[13]||(e[13]=i("span",null,"*",-1)),t(L,{class:"item",effect:"dark",placement:"top"},{content:o(()=>[H.crossDs?(c(),_("div",tt,r(a(s)("dataset.calc_tips.tip1")),1)):(c(),_("div",at,r(a(s)("dataset.calc_tips.tip1_1")),1)),i("div",null,r(a(s)("dataset.calc_tips.tip2")),1)]),default:o(()=>[t(m,{size:"16px"},{default:o(()=>[t(f,{name:"icon_info_outlined"},{default:o(()=>[t(a(K),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),t(Be,{quotaMap:u.quotaData.map(l=>l.name),dimensionMap:u.dimensionData.map(l=>l.name),ref_key:"myCm",ref:G,height:"318px","dom-id":"calcField"},null,8,["quotaMap","dimensionMap"])])]),i("div",ot,[i("span",lt,[y(r(a(s)("dataset.click_ref_field"))+" ",1),t(L,{class:"item",effect:"dark",placement:"bottom"},{content:o(()=>[y(r(a(s)("dataset.calc_tips.tip3"))+" ",1),e[14]||(e[14]=i("br",null,null,-1)),y(" "+r(a(s)("dataset.calc_tips.tip4"))+" ",1),e[15]||(e[15]=i("br",null,null,-1)),y(" "+r(a(s)("dataset.calc_tips.tip5")),1)]),default:o(()=>[t(m,{size:"16px"},{default:o(()=>[t(f,{name:"icon_info_outlined"},{default:o(()=>[t(a(K),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),i("div",st,[t(v,{modelValue:J.value,"onUpdate:modelValue":e[5]||(e[5]=l=>J.value=l),placeholder:a(s)("dataset.edit_search"),clearable:""},{prefix:o(()=>[t(m,null,{default:o(()=>[t(f,{name:"icon_search-outline_outlined"},{default:o(()=>[t(a(oe),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"]),i("div",nt,[t(Z,null,{default:o(()=>[i("span",null,r(a(s)("chart.dimension")),1),u.dimensionData.length?(c(),_("div",it,[(c(!0),_($,null,M(u.dimensionData,l=>(c(),_("span",{key:l.id,class:"item-dimension flex-align-center",title:l.name,onClick:z=>X("["+l.name+"]")},[t(m,null,{default:o(()=>[t(f,null,{default:o(()=>[(c(),T(O(a(I)[a(k)[l.deType]]),{class:D(["svg-icon",`field-icon-${a(k)[l.deType]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024),i("span",{class:"ellipsis",title:l.name},r(l.name),9,rt)],8,dt))),128))])):(c(),_("div",ct,r(a(s)("dataset.na")),1))]),_:1})]),i("div",ut,[i("span",null,r(a(s)("chart.quota")),1),t(L,{effect:"dark",content:j.value?a(s)("data_set.parameter_is_supported"):a(s)("data_set.add_calculation_parameters"),placement:"top"},{default:o(()=>[t(m,{class:"hover-icon_quota",onClick:_e},{default:o(()=>[t(f,{class:D([`field-icon-${a(k)[0]}`,j.value&&"not-allow"]),style:{color:"#646a73"},name:"icon_adjustment_outlined"},{default:o(()=>[t(a(le),{class:"svg-icon"})]),_:1},8,["class"])]),_:1})]),_:1},8,["content"])]),i("div",pt,[t(Z,null,{default:o(()=>[u.quotaData.length?(c(),_("div",mt,[(c(!0),_($,null,M(u.quotaData,l=>(c(),_("span",{key:l.id,class:"item-quota flex-align-center",onClick:z=>X("["+l.name+"]")},[l.groupType?(c(),T(m,{key:1},{default:o(()=>[t(f,null,{default:o(()=>[(c(),T(O(a(I)[a(k)[l.deType]]),{class:D(["svg-icon",`field-icon-${a(k)[l.deType]}`])},null,8,["class"]))]),_:2},1024)]),_:2},1024)):(c(),T(m,{key:0},{default:o(()=>[t(f,{name:"icon_adjustment_outlined"},{default:o(()=>[t(a(le),{class:"svg-icon"})]),_:1})]),_:1})),i("span",{class:"ellipsis",title:l.name},r(l.name),9,ft),l.groupType?Qe("",!0):(c(),_("div",vt,[t(m,{onClick:q(fe,["stop"]),class:"hover-icon"},{default:o(()=>[t(f,{name:"icon_edit_outlined"},{default:o(()=>[t(a(Ue),{class:"svg-icon"})]),_:1})]),_:1}),t(m,{onClick:q(ve,["stop"]),class:"hover-icon"},{default:o(()=>[t(f,{name:"icon_delete-trash_outlined"},{default:o(()=>[t(a(Re),{class:"svg-icon"})]),_:1})]),_:1})]))],8,_t))),128))])):(c(),_("div",gt,r(a(s)("dataset.na")),1))]),_:1})])])]),i("div",ht,[i("span",yt,[y(r(a(s)("dataset.click_ref_function"))+" ",1),t(L,{class:"item",effect:"dark",placement:"bottom"},{content:o(()=>[H.crossDs?(c(),_("div",bt,[y(r(a(s)("dataset.calc_tips.tip6"))+" ",1),e[16]||(e[16]=i("br",null,null,-1)),y(" "+r(a(s)("dataset.calc_tips.tip8"))+" ",1),e[17]||(e[17]=i("br",null,null,-1)),e[18]||(e[18]=y(" https://calcite.apache.org/docs/reference.html ",-1))])):(c(),_("div",kt,r(a(s)("dataset.calc_tips.tip7")),1))]),default:o(()=>[t(m,{size:"16px"},{default:o(()=>[t(f,{name:"icon_info_outlined"},{default:o(()=>[t(a(K),{class:"svg-icon"})]),_:1})]),_:1})]),_:1})]),i("div",Ct,[t(v,{modelValue:Q.value,"onUpdate:modelValue":e[6]||(e[6]=l=>Q.value=l),style:{"margin-bottom":"8px"},placeholder:a(s)("dataset.edit_search"),clearable:""},{prefix:o(()=>[t(m,null,{default:o(()=>[t(f,{name:"icon_search-outline_outlined"},{default:o(()=>[t(a(oe),{class:"svg-icon"})]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder"]),t(ye,{class:"function-height"},{default:o(()=>[u.functionData.length?(c(),_("div",xt,[(c(!0),_($,null,M(u.functionData,(l,z)=>(c(),T(he,{key:z,class:"function-pop",placement:"right",width:"200",trigger:"hover","open-delay":500},{reference:o(()=>[i("span",{class:"function-style flex-align-center",onClick:St=>pe(l.func)},r(l.func),9,wt)]),default:o(()=>[i("p",Dt,r(l.name),1),i("p",Tt,r(l.func),1),i("p",Vt,r(l.desc),1)]),_:2},1024))),128))])):(c(),_("div",Et,r(a(s)("chart.no_function")),1))]),_:1})])])]),t(ke,{"before-close":R,modelValue:F.value,"onUpdate:modelValue":e[10]||(e[10]=l=>F.value=l),"append-to-body":"",class:"create-dialog",title:a(s)("data_set.add_calculation_parameters"),width:"500"},{footer:o(()=>[i("div",qt,[t(w,{onClick:R},{default:o(()=>[y(r(a(s)("chart.cancel")),1)]),_:1}),t(w,{type:"primary",onClick:re},{default:o(()=>[y(r(a(s)("chart.confirm")),1)]),_:1})])]),default:o(()=>[t(b,{onKeydown:e[9]||(e[9]=te(q(()=>{},["stop","prevent"]),["enter"])),"label-position":"top",ref_key:"formQuotaRef",ref:U,model:h,rules:de},{default:o(()=>[t(g,{label:a(s)("data_set.parameter_name"),prop:"name"},{default:o(()=>[t(v,{style:{width:"100%"},modelValue:h.name,"onUpdate:modelValue":e[7]||(e[7]=l=>h.name=l),placeholder:a(s)("data_set.enter_1_50_characters")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(g,{label:a(s)("data_set.parameter_default_value_de"),prop:"value"},{default:o(()=>[t(be,{style:{width:"100%"},modelValue:h.value,"onUpdate:modelValue":e[8]||(e[8]=l=>h.value=l),placeholder:a(s)("data_set.enter_a_number"),"controls-position":"right"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])],32)}}});const ya=Ke(Ft,[["__scopeId","data-v-5f316016"]]);export{ya as default};

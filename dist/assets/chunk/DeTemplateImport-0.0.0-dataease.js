import"./index-0.0.0-dataease.js";import"./el-form-0.0.0-dataease.js";import"./el-tag-0.0.0-dataease.js";import{E as z,a as A}from"./el-select-0.0.0-dataease.js";import"./el-popper-0.0.0-dataease.js";import{E as $}from"./el-row-0.0.0-dataease.js";import{E as j,a as L}from"./el-form-item-0.0.0-dataease.js";import{o as M,D as l,F as G,G as J,y as W,j as X}from"./ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{d as H,r as K,X as Q,y as Y,e as Z,f as T,O as x,j as o,i as s,u as i,P as f,a3 as g,a4 as _,R as ee,U as te,T as ae,W as oe,a6 as ne,g as le}from"./vue-0.0.0-dataease.js";import{c as me,n as E,s as v,e as pe}from"./template-0.0.0-dataease.js";import{i as se}from"./imgUtils-0.0.0-dataease.js";import{_ as re}from"./_plugin-vue_export-helper-0.0.0-dataease.js";import"./lodash-0.0.0-dataease.js";import"./index-0.0.0-dataease4.js";import"./index-0.0.0-dataease3.js";import"./index-0.0.0-dataease6.js";import"./token-0.0.0-dataease.js";import"./strings-0.0.0-dataease.js";import"./index-0.0.0-dataease5.js";import"./constants-0.0.0-dataease.js";import"./axios-0.0.0-dataease.js";import"./library-0.0.0-dataease.js";import"./echarts-0.0.0-dataease.js";import"./tinymce-0.0.0-dataease.js";import"./dvMain-0.0.0-dataease.js";import"./chart-0.0.0-dataease.js";import"./chart-0.0.0-dataease2.js";import"./dataset-0.0.0-dataease.js";import"./app-0.0.0-dataease.js";import"./decimal-0.0.0-dataease.js";import"./dataVisualization-0.0.0-dataease2.js";import"./util-0.0.0-dataease.js";import"./index-0.0.0-dataease21.js";import"./antv-0.0.0-dataease.js";import"./index-0.0.0-dataease22.js";import"./pureFunctionsAny.generated-0.0.0-dataease.js";import"./extends-0.0.0-dataease.js";import"./tslib.es6-0.0.0-dataease.js";import"./sysParameter-0.0.0-dataease.js";import"./TableTooltip-0.0.0-dataease.js";import"./el-col-0.0.0-dataease.js";import"./_commonjs-dynamic-modules-0.0.0-dataease.js";import"./appearance-0.0.0-dataease.js";import"./font-0.0.0-dataease.js";const ie={class:"template-import"},ce={class:"flex-template"},fe={class:"custom-dropdown__empty"},de={class:"custom-option-line"},_e=35e6,ue=H({__name:"DeTemplateImport",props:{pid:{type:String,required:!0},templateCategories:{type:Array,required:!0},optType:{type:String,required:!0,default:"insert"},templateId:{type:String,required:!1}},emits:["closeEditTemplateDialog","refresh","addCategoryInfo"],setup(I,{emit:C}){const r=C,{t}=M(),D=K(null),c=I,e=Q({categories:[],nameList:[],importTemplateInfo:{snapshot:""},templateInfoRules:{name:[{required:!0,message:t("commons.input_content"),trigger:"change"},{max:50,message:t("commons.char_can_not_more_50"),trigger:"change"}],categories:[{required:!0,message:t("commons.input_content"),trigger:"change"}]},recover:!1,templateInfo:{id:null,level:"1",pid:c.pid,categories:[],dvType:"dashboard",nodeType:"template",name:"",templateStyle:null,templateData:null,dynamicData:null,appData:null,staticResource:null,snapshot:"",version:null}}),w=Y(()=>e.templateInfo.snapshot?{background:`url(${se(e.templateInfo.snapshot)}) no-repeat`}:{}),k=()=>{r("closeEditTemplateDialog")},R=()=>{if(!e.templateInfo.name)return l.warning(t("chart.name_can_not_empty")),!1;if(e.templateInfo.name.length>50)return l.warning(t("commons.char_can_not_more_50")),!1;if(!e.templateInfo.templateData)return l.warning(t("chart.template_can_not_empty")),!1;if(!e.templateInfo.categories.length)return l.warning(t("template_manage.please_select_catalog")),!1;c.optType==="insert"?S():b()},b=()=>{const n={pid:e.templateInfo.pid,id:e.templateInfo.id,name:e.templateInfo.name,categories:e.templateInfo.categories,optType:c.optType};E(n).then(a=>{a.data.indexOf("exist")>-1?l.warning(t("template_manage.exists_name_hint")):v(e.templateInfo).then(()=>{l.success(t("template_manage.edit_success")),r("refresh",y()),r("closeEditTemplateDialog")})})},y=()=>{const n=e.templateInfo.categories[0];let a="";return c.templateCategories.forEach(m=>{m.id===n&&(a=m.name)}),{optType:"refresh",refreshPid:n,refreshPName:a}},S=()=>{const n={pid:e.templateInfo.pid,name:e.templateInfo.name,categories:e.templateInfo.categories,optType:c.optType};pe(n).then(a=>{a.data.indexOf("exist")>-1?G.confirm(t("template_manage.hint"),{tip:t("template_manage.cover_exists_hint"),confirmButtonType:"danger",type:"warning",autofocus:!1,showClose:!1}).then(()=>{v(e.templateInfo).then(()=>{l.success(t("template_manage.cover_success")),r("refresh",y()),r("closeEditTemplateDialog")})}):E(n).then(m=>{m.data.indexOf("exist")>-1?l.warning(t("template_manage.exists_name_hint")):v(e.templateInfo).then(()=>{l.success(t("template_manage.import_success")),r("refresh",y()),r("closeEditTemplateDialog")})})})},V=n=>{const a=n.target.files[0],m=new FileReader;if(a.size>_e){l.success(t("template_manage.template_size_hint"));return}m.onload=d=>{const u=d.target.result;e.importTemplateInfo=JSON.parse(u),e.templateInfo.name=e.importTemplateInfo.name,e.templateInfo.dvType=e.importTemplateInfo.dvType,e.templateInfo.templateStyle=e.importTemplateInfo.canvasStyleData,e.templateInfo.templateData=e.importTemplateInfo.componentData,e.templateInfo.snapshot=e.importTemplateInfo.snapshot,e.templateInfo.dynamicData=e.importTemplateInfo.dynamicData,e.templateInfo.appData=e.importTemplateInfo.appData,e.templateInfo.staticResource=e.importTemplateInfo.staticResource,e.templateInfo.nodeType=e.importTemplateInfo.nodeType||"template",e.templateInfo.version=e.importTemplateInfo.version},m.readAsText(a)},q=()=>{D.value.click()},B=()=>{r("refresh",{optType:"addCategory"})};return c.templateId&&me(c.templateId).then(n=>{e.templateInfo=n.data}),(n,a)=>{const m=J,d=W,u=j,h=$,F=A,P=Z("Plus"),O=X,N=z,U=L;return T(),x("div",ie,[o(U,{ref:"templateImportForm",class:"de-form-item",model:e.templateInfo,rules:e.templateInfoRules,"label-position":"top"},{default:s(()=>[o(u,{label:i(t)("template_manage.template_name"),prop:"name"},{default:s(()=>[f("div",ce,[o(m,{modelValue:e.templateInfo.name,"onUpdate:modelValue":a[0]||(a[0]=p=>e.templateInfo.name=p),placeholder:i(t)("template_manage.enter_template_name_hint"),clearable:""},null,8,["modelValue","placeholder"]),o(d,{style:{"margin-left":"10px"},icon:"Upload",secondary:"",onClick:q},{default:s(()=>[g(_(i(t)("template_manage.import_template")),1)]),_:1}),f("input",{id:"input",ref_key:"filesRef",ref:D,type:"file",accept:".DET2,.DET2APP",hidden:"",onChange:V},null,544)])]),_:1},8,["label"]),ee(o(h,{class:"preview",style:ae(w.value)},null,8,["style"]),[[te,!!e.templateInfo.snapshot]]),o(u,{label:i(t)("template_manage.select_catalog"),prop:"categories",style:{"margin-top":"16px"}},{default:s(()=>[o(N,{modelValue:e.templateInfo.categories,"onUpdate:modelValue":a[1]||(a[1]=p=>e.templateInfo.categories=p),multiple:"",style:{width:"100%"},"popper-class":I.templateCategories.length?"custom-category-padding":"custom-category-empty custom-category-padding"},{default:s(()=>[(T(!0),x(oe,null,ne(I.templateCategories,p=>(T(),le(F,{key:p.id,label:p.name,value:p.id},null,8,["label","value"]))),128)),f("div",fe,[f("span",null,_(i(t)("template_manage.no_selectable_catalog")),1)]),f("div",de,[f("div",{onClick:B,class:"flex-align-center"},[o(O,null,{default:s(()=>[o(P)]),_:1}),g(" "+_(i(t)("template_manage.add_catalog")),1)])])]),_:1},8,["modelValue","popper-class"])]),_:1},8,["label"])]),_:1},8,["model","rules"]),o(h),o(h,{class:"de-root-class"},{default:s(()=>[o(d,{secondary:"",onClick:a[2]||(a[2]=p=>k())},{default:s(()=>[g(_(i(t)("commons.cancel")),1)]),_:1}),o(d,{type:"primary",onClick:a[3]||(a[3]=p=>R())},{default:s(()=>[g(_(i(t)("commons.confirm")),1)]),_:1})]),_:1})])}}});const mt=re(ue,[["__scopeId","data-v-c30a4f69"]]);export{mt as default};

import{u as E,a as R,g as a,b as q,c as D,i as $,d as T,e as j,f as B,s as N,h as F,j as J}from"../assets/chunk/index-0.0.0-dataease.js";import{d as M,r as Q,ae as V,o as P,T as _,U as z,u as G,W as H,at as K}from"../assets/chunk/@vue-0.0.0-dataease.js";/* empty css                                          */import"../assets/chunk/@antv-0.0.0-dataease.js";import{_ as X,u as Y,a as Z,g as tt,r as S,p as v,b as I,s as et,c as ot}from"../assets/chunk/ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{u as rt}from"../assets/chunk/vue-router_2-0.0.0-dataease.js";import{_ as it}from"../assets/chunk/ExportExcel.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import{u as st,a as at,s as pt}from"../assets/chunk/usePageLoading-0.0.0-dataease.js";import{installDirective as nt}from"../assets/chunk/index-0.0.0-dataease2.js";import{useAppStoreWithOut as mt}from"../assets/chunk/app-0.0.0-dataease.js";import{getDefaultSettings as ct,getRoleRouters as lt}from"../assets/chunk/common-0.0.0-dataease.js";import{i as ut}from"../assets/chunk/interactive-0.0.0-dataease.js";import{useAppearanceStoreWithOut as dt}from"../assets/chunk/appearance-0.0.0-dataease.js";import{S as ft}from"../assets/chunk/sockjs-client-0.0.0-dataease.js";import{S as ht}from"../assets/chunk/stompjs-0.0.0-dataease.js";import"../assets/chunk/mitt-0.0.0-dataease.js";import"../assets/chunk/web-storage-cache-0.0.0-dataease.js";import"../assets/chunk/@amap-0.0.0-dataease.js";import"../assets/chunk/element-plus-secondary-0.0.0-dataease.js";import"../assets/chunk/@vueuse-0.0.0-dataease.js";import"../assets/chunk/@element-plus-0.0.0-dataease.js";import"../assets/chunk/lodash-es-0.0.0-dataease.js";import"../assets/chunk/dayjs-0.0.0-dataease.js";import"../assets/chunk/@popperjs-0.0.0-dataease.js";import"../assets/chunk/async-validator-0.0.0-dataease.js";import"../assets/chunk/@ctrl-0.0.0-dataease.js";import"../assets/chunk/normalize-wheel-es-0.0.0-dataease.js";import"../assets/chunk/memoize-one-0.0.0-dataease.js";import"../assets/chunk/vue-types-0.0.0-dataease.js";import"../assets/chunk/is-plain-object-0.0.0-dataease.js";import"../assets/chunk/pinia-0.0.0-dataease.js";import"../assets/chunk/vue-demi-0.0.0-dataease.js";import"../assets/chunk/eventemitter3-0.0.0-dataease.js";import"../assets/chunk/lodash-0.0.0-dataease.js";import"../assets/chunk/@mapbox-0.0.0-dataease.js";import"../assets/chunk/pbf-0.0.0-dataease.js";import"../assets/chunk/ieee754-0.0.0-dataease.js";import"../assets/chunk/supercluster-0.0.0-dataease.js";import"../assets/chunk/@babel-0.0.0-dataease.js";import"../assets/chunk/gl-matrix-0.0.0-dataease.js";import"../assets/chunk/tslib-0.0.0-dataease.js";import"../assets/chunk/detect-browser-0.0.0-dataease.js";import"../assets/chunk/size-sensor-0.0.0-dataease.js";import"../assets/chunk/d3-regression-0.0.0-dataease.js";import"../assets/chunk/d3-hierarchy-0.0.0-dataease.js";import"../assets/chunk/fmin-0.0.0-dataease.js";import"../assets/chunk/pdfast-0.0.0-dataease.js";import"../assets/chunk/d3-ease-0.0.0-dataease.js";import"../assets/chunk/d3-interpolate-0.0.0-dataease.js";import"../assets/chunk/d3-color-0.0.0-dataease.js";import"../assets/chunk/d3-timer-0.0.0-dataease.js";import"../assets/chunk/fecha-0.0.0-dataease.js";import"../assets/chunk/topojson-client-0.0.0-dataease.js";import"../assets/chunk/viewport-mercator-project-0.0.0-dataease.js";import"../assets/chunk/@turf-0.0.0-dataease.js";import"../assets/chunk/polygon-clipping-0.0.0-dataease.js";import"../assets/chunk/splaytree-0.0.0-dataease.js";import"../assets/chunk/robust-predicates-0.0.0-dataease.js";import"../assets/chunk/d3-scale-0.0.0-dataease.js";import"../assets/chunk/d3-collection-0.0.0-dataease.js";import"../assets/chunk/d3-format-0.0.0-dataease.js";import"../assets/chunk/d3-time-format-0.0.0-dataease.js";import"../assets/chunk/d3-time-0.0.0-dataease.js";import"../assets/chunk/d3-array-0.0.0-dataease.js";import"../assets/chunk/earcut-0.0.0-dataease.js";import"../assets/chunk/regl-0.0.0-dataease.js";import"../assets/chunk/mapbox-gl-0.0.0-dataease.js";import"../assets/chunk/d3-dsv-0.0.0-dataease.js";import"../assets/chunk/geojson-vt-0.0.0-dataease.js";import"../assets/chunk/hammerjs-0.0.0-dataease.js";import"../assets/chunk/element-resize-detector-0.0.0-dataease.js";import"../assets/chunk/batch-processor-0.0.0-dataease.js";import"../assets/chunk/d3-hexbin-0.0.0-dataease.js";import"../assets/chunk/axios-0.0.0-dataease.js";import"../assets/chunk/qs-0.0.0-dataease.js";import"../assets/chunk/side-channel-0.0.0-dataease.js";import"../assets/chunk/es-errors-0.0.0-dataease.js";import"../assets/chunk/object-inspect-0.0.0-dataease.js";import"../assets/chunk/crypto-js-0.0.0-dataease.js";import"../assets/chunk/side-channel-list-0.0.0-dataease.js";import"../assets/chunk/side-channel-map-0.0.0-dataease.js";import"../assets/chunk/get-intrinsic-0.0.0-dataease.js";import"../assets/chunk/es-object-atoms-0.0.0-dataease.js";import"../assets/chunk/math-intrinsics-0.0.0-dataease.js";import"../assets/chunk/gopd-0.0.0-dataease.js";import"../assets/chunk/es-define-property-0.0.0-dataease.js";import"../assets/chunk/has-symbols-0.0.0-dataease.js";import"../assets/chunk/get-proto-0.0.0-dataease.js";import"../assets/chunk/dunder-proto-0.0.0-dataease.js";import"../assets/chunk/call-bind-apply-helpers-0.0.0-dataease.js";import"../assets/chunk/function-bind-0.0.0-dataease.js";import"../assets/chunk/hasown-0.0.0-dataease.js";import"../assets/chunk/call-bound-0.0.0-dataease.js";import"../assets/chunk/side-channel-weakmap-0.0.0-dataease.js";import"../assets/chunk/jspdf-0.0.0-dataease.js";import"../assets/chunk/fflate-0.0.0-dataease.js";import"../assets/chunk/fast-png-0.0.0-dataease.js";import"../assets/chunk/iobuffer-0.0.0-dataease.js";import"../assets/chunk/pako-0.0.0-dataease.js";import"../assets/chunk/vue-0.0.0-dataease.js";import"../assets/chunk/vue-i18n-0.0.0-dataease.js";import"../assets/chunk/@intlify-0.0.0-dataease.js";import"../assets/chunk/echarts-0.0.0-dataease.js";import"../assets/chunk/zrender-0.0.0-dataease.js";import"../assets/chunk/tinymce-0.0.0-dataease.js";import"../assets/chunk/icon_download_outlined-0.0.0-dataease.js";import"../assets/chunk/de-delete-0.0.0-dataease.js";import"../assets/chunk/icon_refresh_outlined-0.0.0-dataease.js";import"../assets/chunk/EmptyBackground-0.0.0-dataease.js";import"../assets/chunk/none-0.0.0-dataease.js";import"../assets/chunk/nothing-tree-0.0.0-dataease.js";import"../assets/chunk/_plugin-vue_export-helper-0.0.0-dataease.js";import"../assets/chunk/dataset-0.0.0-dataease.js";import"../assets/chunk/js-base64-0.0.0-dataease.js";import"../assets/chunk/GridTable-0.0.0-dataease.js";import"../assets/chunk/nprogress-0.0.0-dataease.js";import"../assets/chunk/login-0.0.0-dataease.js";import"../assets/chunk/dataVisualization-0.0.0-dataease.js";import"../assets/chunk/datasource-0.0.0-dataease.js";import"../assets/chunk/font-0.0.0-dataease.js";import"../assets/chunk/less-0.0.0-dataease.js";import"../assets/chunk/copy-anything-0.0.0-dataease.js";import"../assets/chunk/is-what-0.0.0-dataease.js";import"../assets/chunk/net-0.0.0-dataease.js";import"../assets/chunk/websocket-0.0.0-dataease.js";import"../assets/chunk/es5-ext-0.0.0-dataease.js";const wt=M({__name:"App",setup(t){const p=rt(),r=Q();return E({name:"data-export-center",callback:s=>{r.value.init(s)}}),(s,n)=>{const o=V("router-view");return P(),_(X,null,{default:z(()=>[(P(),_(o,{key:G(p).path})),H(it,{ref_key:"exportExcelRef",ref:r},null,512)]),_:1})}}}),k=dt(),{wsCache:f}=R(),d=Y(),gt=ut(),C=Z(),b=mt(),{start:kt,done:x}=st(),{loadStart:bt,loadDone:A}=at(),St=["/login","/de-link","/chart-view","/admin-login","/401"],yt=["/dvCanvas","/dashboard","/preview","/dataset-embedded-form"],Pt=["/dataset-embedded","/dataset-form","/dataset-embedded-form"],y=JSON.parse(sessionStorage.getItem("iicSeaUmsWeb-userInfo"));console.log("userInfo========",y);var W;if(y){const{tokenType:t="",token:p="",accessToken:r=""}=y,c=`${t} ${p||r}`;f.set(a("user.token"),c)}else{const t=(W=q())==null?void 0:W.userInfo;if(t){sessionStorage.setItem("iicSeaUmsWeb-userInfo",JSON.stringify(t));const{tokenType:p="",token:r="",accessToken:c=""}=t,s=`${p} ${r||c}`;f.set(a("user.token"),s),window.location.href=window.location.pathname+"#/"}else tt()}S.beforeEach(async(t,p,r)=>{kt(),bt();const c=D();let s=f.get(a("app.desktop"));if(s===null)try{await b.setAppModel(),s=b.getDesktop}catch(o){console.log(o)}if($()&&!["/chart-view"].includes(t.path)){if(x(),A(),t.name==="link"){let o="";if(Object.keys(t.query)){const u=Object.keys(t.query).map(e=>e+"="+t.query[e]).join("&");u&&(o="?"+u)}let i=window.location.pathname;i=i.replace("casbi/",""),i=i.replace("oidc/",""),i=i.substring(0,i.length-1);const h=window.origin+i;let l=t.fullPath;l.includes("?")&&(l=t.fullPath.substring(0,t.fullPath.lastIndexOf("?"))),window.location.href=h+"/mobile.html#"+l+o}else if(f.get(a("user.token"))||s||!T()&&!j()){let o=window.location.pathname;o=o.substring(0,o.length-1);let i=window.origin+o+"/mobile.html#/index";window.location.search&&(i+=window.location.search),window.location.href=i}}await k.setAppearance(),await k.setFontList();const n=await ct()||{};if(f.set(a("TreeSort-backend"),n["basic.defaultSort"]??"1"),f.set(a("open-backend"),n["basic.defaultOpen"]??"0"),(f.get(a("user.token"))||s)&&!t.path.startsWith("/de-link/"))if(C.getUid||await C.setUser(),t.path==="/login")r({path:"/workbranch/index"});else{if(d.setCurrentPath(t.path),d.getIsAddRouters){let e="";if((p.query.redirect||"?").split("?")[0]===t.path&&(e=(window.location.hash||"?").split("?").reverse()[0],e.includes("redirect=")&&(e="")),e&&(t.fullPath+="?"+e,t.query=e.split("&").reduce((g,O)=>{const[U,L]=O.split("=");return g[U]=L,g},{})),!v(t.path)&&t.path!=="/404"&&!t.path.startsWith("/de-link")){const g=I();r({path:g||"/404"});return}r();return}let o=await lt()||[];s&&(o=o.filter(e=>e.name!=="system"));const i=o;i.forEach(e=>e.top=!0),await d.generateRoutes(i),d.getAddRouters.forEach(e=>{S.addRoute(e)});const h=p.query.redirect||t.path,l=decodeURIComponent(h),u=t.path===l?{...t,replace:!0}:{path:l};if(d.setIsAddRouters(!0),await gt.initInteractive(!0),!v(t.path)&&t.path!=="/404"&&!t.path.startsWith("/de-link")){const e=I();r({path:e||"/404"});return}r(u)}else if(B().getToken&&b.getIsIframe&&Pt.includes(t.path)){if(t.path.includes("/dataset-form")){r({path:"/dataset-embedded-form",query:t.query});return}d.setCurrentPath(t.path),r()}else!c&&yt.includes(t.path)||St.includes(t.path)||t.path.startsWith("/de-link/")?(await k.setFontList(),d.setCurrentPath(t.path),r()):r(`/login?redirect=${t.fullPath||t.path}`)});S.afterEach(()=>{x(),A()});const{wsCache:w}=R();let m;const _t={install(){const t=[{topic:"/task-export-topic",event:"task-export-topic-call"},{topic:"/report-notice",event:"report-notice-call"}];function p(){return w.get(a("app.desktop"))?!0:w.get(a("user.token"))&&w.get(a("user.uid"))}function r(){var l;if(!p()||m&&m.connected)return;let n="/";(l=window.DataEaseBi)!=null&&l.baseUrl?n=window.DataEaseBi.baseUrl:n=location.origin+"/",n.endsWith("/")||(n+="/");const o=w.get(a("app.desktop"))?1:w.get(a("user.uid")),i=new ft(n+"websocket?userId="+o);m=ht.over(i);const h={userId:o};m.connect(h,()=>{t.forEach(u=>{m.subscribe("/user/"+o+u.topic,e=>{e&&e.body&&E().emitter.emit(u.event,e.body)})})},u=>{c(),console.error("连接失败: "+u)})}function c(){m&&m.connected&&m.disconnect(function(){console.info("断开连接")},function(n){console.info("断开连接失败: "+n)}),m=null}function s(){r(),setInterval(()=>{if(!p()){c();return}(!m||!m.connected)&&r()},5e3)}s()}},vt=async()=>{const t=K(wt);nt(t),N(t),await et(t),ot(t),F(t),pt(t),J(t),t.use(_t),t.mount("#app")};vt();

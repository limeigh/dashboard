import{u as E,a as I,g as p,c as D,i as L,b as U,d as $,e as T,s as B,f as j,h as F}from"../assets/chunk/index-0.0.0-dataease.js";import{d as M,r as N,ae as J,o as y,T as v,U as Q,u as V,W as z,at as G}from"../assets/chunk/@vue-0.0.0-dataease.js";/* empty css                                          */import"../assets/chunk/@antv-0.0.0-dataease.js";import{_ as H,u as K,a as X,r as S,p as _,g as C,s as Y,b as Z}from"../assets/chunk/ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{u as tt}from"../assets/chunk/vue-router_2-0.0.0-dataease.js";import{_ as et}from"../assets/chunk/ExportExcel.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import{u as ot,a as rt,s as it}from"../assets/chunk/usePageLoading-0.0.0-dataease.js";import{installDirective as st}from"../assets/chunk/index-0.0.0-dataease2.js";import{useAppStoreWithOut as at}from"../assets/chunk/app-0.0.0-dataease.js";import{getDefaultSettings as pt,getRoleRouters as nt}from"../assets/chunk/common-0.0.0-dataease.js";import{i as mt}from"../assets/chunk/interactive-0.0.0-dataease.js";import{useAppearanceStoreWithOut as ct}from"../assets/chunk/appearance-0.0.0-dataease.js";import{S as lt}from"../assets/chunk/sockjs-client-0.0.0-dataease.js";import{S as ut}from"../assets/chunk/stompjs-0.0.0-dataease.js";import"../assets/chunk/mitt-0.0.0-dataease.js";import"../assets/chunk/web-storage-cache-0.0.0-dataease.js";import"../assets/chunk/@amap-0.0.0-dataease.js";import"../assets/chunk/element-plus-secondary-0.0.0-dataease.js";import"../assets/chunk/@vueuse-0.0.0-dataease.js";import"../assets/chunk/@element-plus-0.0.0-dataease.js";import"../assets/chunk/lodash-es-0.0.0-dataease.js";import"../assets/chunk/dayjs-0.0.0-dataease.js";import"../assets/chunk/@popperjs-0.0.0-dataease.js";import"../assets/chunk/async-validator-0.0.0-dataease.js";import"../assets/chunk/@ctrl-0.0.0-dataease.js";import"../assets/chunk/normalize-wheel-es-0.0.0-dataease.js";import"../assets/chunk/memoize-one-0.0.0-dataease.js";import"../assets/chunk/vue-types-0.0.0-dataease.js";import"../assets/chunk/is-plain-object-0.0.0-dataease.js";import"../assets/chunk/pinia-0.0.0-dataease.js";import"../assets/chunk/vue-demi-0.0.0-dataease.js";import"../assets/chunk/eventemitter3-0.0.0-dataease.js";import"../assets/chunk/lodash-0.0.0-dataease.js";import"../assets/chunk/@mapbox-0.0.0-dataease.js";import"../assets/chunk/pbf-0.0.0-dataease.js";import"../assets/chunk/ieee754-0.0.0-dataease.js";import"../assets/chunk/supercluster-0.0.0-dataease.js";import"../assets/chunk/@babel-0.0.0-dataease.js";import"../assets/chunk/gl-matrix-0.0.0-dataease.js";import"../assets/chunk/tslib-0.0.0-dataease.js";import"../assets/chunk/detect-browser-0.0.0-dataease.js";import"../assets/chunk/size-sensor-0.0.0-dataease.js";import"../assets/chunk/d3-regression-0.0.0-dataease.js";import"../assets/chunk/d3-hierarchy-0.0.0-dataease.js";import"../assets/chunk/fmin-0.0.0-dataease.js";import"../assets/chunk/pdfast-0.0.0-dataease.js";import"../assets/chunk/d3-ease-0.0.0-dataease.js";import"../assets/chunk/d3-interpolate-0.0.0-dataease.js";import"../assets/chunk/d3-color-0.0.0-dataease.js";import"../assets/chunk/d3-timer-0.0.0-dataease.js";import"../assets/chunk/fecha-0.0.0-dataease.js";import"../assets/chunk/topojson-client-0.0.0-dataease.js";import"../assets/chunk/viewport-mercator-project-0.0.0-dataease.js";import"../assets/chunk/@turf-0.0.0-dataease.js";import"../assets/chunk/polygon-clipping-0.0.0-dataease.js";import"../assets/chunk/splaytree-0.0.0-dataease.js";import"../assets/chunk/robust-predicates-0.0.0-dataease.js";import"../assets/chunk/d3-scale-0.0.0-dataease.js";import"../assets/chunk/d3-collection-0.0.0-dataease.js";import"../assets/chunk/d3-format-0.0.0-dataease.js";import"../assets/chunk/d3-time-format-0.0.0-dataease.js";import"../assets/chunk/d3-time-0.0.0-dataease.js";import"../assets/chunk/d3-array-0.0.0-dataease.js";import"../assets/chunk/earcut-0.0.0-dataease.js";import"../assets/chunk/regl-0.0.0-dataease.js";import"../assets/chunk/mapbox-gl-0.0.0-dataease.js";import"../assets/chunk/d3-dsv-0.0.0-dataease.js";import"../assets/chunk/geojson-vt-0.0.0-dataease.js";import"../assets/chunk/hammerjs-0.0.0-dataease.js";import"../assets/chunk/element-resize-detector-0.0.0-dataease.js";import"../assets/chunk/batch-processor-0.0.0-dataease.js";import"../assets/chunk/d3-hexbin-0.0.0-dataease.js";import"../assets/chunk/axios-0.0.0-dataease.js";import"../assets/chunk/qs-0.0.0-dataease.js";import"../assets/chunk/side-channel-0.0.0-dataease.js";import"../assets/chunk/es-errors-0.0.0-dataease.js";import"../assets/chunk/object-inspect-0.0.0-dataease.js";import"../assets/chunk/crypto-js-0.0.0-dataease.js";import"../assets/chunk/side-channel-list-0.0.0-dataease.js";import"../assets/chunk/side-channel-map-0.0.0-dataease.js";import"../assets/chunk/get-intrinsic-0.0.0-dataease.js";import"../assets/chunk/es-object-atoms-0.0.0-dataease.js";import"../assets/chunk/math-intrinsics-0.0.0-dataease.js";import"../assets/chunk/gopd-0.0.0-dataease.js";import"../assets/chunk/es-define-property-0.0.0-dataease.js";import"../assets/chunk/has-symbols-0.0.0-dataease.js";import"../assets/chunk/get-proto-0.0.0-dataease.js";import"../assets/chunk/dunder-proto-0.0.0-dataease.js";import"../assets/chunk/call-bind-apply-helpers-0.0.0-dataease.js";import"../assets/chunk/function-bind-0.0.0-dataease.js";import"../assets/chunk/hasown-0.0.0-dataease.js";import"../assets/chunk/call-bound-0.0.0-dataease.js";import"../assets/chunk/side-channel-weakmap-0.0.0-dataease.js";import"../assets/chunk/jspdf-0.0.0-dataease.js";import"../assets/chunk/fflate-0.0.0-dataease.js";import"../assets/chunk/fast-png-0.0.0-dataease.js";import"../assets/chunk/iobuffer-0.0.0-dataease.js";import"../assets/chunk/pako-0.0.0-dataease.js";import"../assets/chunk/vue-0.0.0-dataease.js";import"../assets/chunk/vue-i18n-0.0.0-dataease.js";import"../assets/chunk/@intlify-0.0.0-dataease.js";import"../assets/chunk/echarts-0.0.0-dataease.js";import"../assets/chunk/zrender-0.0.0-dataease.js";import"../assets/chunk/tinymce-0.0.0-dataease.js";import"../assets/chunk/icon_download_outlined-0.0.0-dataease.js";import"../assets/chunk/de-delete-0.0.0-dataease.js";import"../assets/chunk/icon_refresh_outlined-0.0.0-dataease.js";import"../assets/chunk/EmptyBackground-0.0.0-dataease.js";import"../assets/chunk/none-0.0.0-dataease.js";import"../assets/chunk/nothing-tree-0.0.0-dataease.js";import"../assets/chunk/_plugin-vue_export-helper-0.0.0-dataease.js";import"../assets/chunk/dataset-0.0.0-dataease.js";import"../assets/chunk/js-base64-0.0.0-dataease.js";import"../assets/chunk/GridTable-0.0.0-dataease.js";import"../assets/chunk/nprogress-0.0.0-dataease.js";import"../assets/chunk/login-0.0.0-dataease.js";import"../assets/chunk/dataVisualization-0.0.0-dataease.js";import"../assets/chunk/datasource-0.0.0-dataease.js";import"../assets/chunk/font-0.0.0-dataease.js";import"../assets/chunk/less-0.0.0-dataease.js";import"../assets/chunk/copy-anything-0.0.0-dataease.js";import"../assets/chunk/is-what-0.0.0-dataease.js";import"../assets/chunk/net-0.0.0-dataease.js";import"../assets/chunk/websocket-0.0.0-dataease.js";import"../assets/chunk/es5-ext-0.0.0-dataease.js";const dt=M({__name:"App",setup(t){const m=tt(),r=N();return E({name:"data-export-center",callback:n=>{r.value.init(n)}}),(n,s)=>{const o=J("router-view");return y(),v(H,null,{default:Q(()=>[(y(),v(o,{key:V(m).path})),z(et,{ref_key:"exportExcelRef",ref:r},null,512)]),_:1})}}}),k=ct(),{wsCache:f}=I(),d=K(),ft=mt(),W=X(),b=at(),{start:ht,done:R}=ot(),{loadStart:wt,loadDone:x}=rt(),gt=["/login","/de-link","/chart-view","/admin-login","/401"],kt=["/dvCanvas","/dashboard","/preview","/dataset-embedded-form"],bt=["/dataset-embedded","/dataset-form","/dataset-embedded-form"],P=JSON.parse(sessionStorage.getItem("iicSeaUmsWeb-userInfo"));console.log("dingtest2",P);if(P){const{tokenType:t="",token:m="",accessToken:r=""}=P,u=`${t} ${m||r}`;f.set(p("user.token"),u)}S.beforeEach(async(t,m,r)=>{ht(),wt();const u=D();let n=f.get(p("app.desktop"));if(n===null)try{await b.setAppModel(),n=b.getDesktop}catch(o){console.log(o)}if(L()&&!["/chart-view"].includes(t.path)){if(R(),x(),t.name==="link"){let o="";if(Object.keys(t.query)){const l=Object.keys(t.query).map(e=>e+"="+t.query[e]).join("&");l&&(o="?"+l)}let i=window.location.pathname;i=i.replace("casbi/",""),i=i.replace("oidc/",""),i=i.substring(0,i.length-1);const h=window.origin+i;let c=t.fullPath;c.includes("?")&&(c=t.fullPath.substring(0,t.fullPath.lastIndexOf("?"))),window.location.href=h+"/mobile.html#"+c+o}else if(f.get(p("user.token"))||n||!U()&&!$()){let o=window.location.pathname;o=o.substring(0,o.length-1);let i=window.origin+o+"/mobile.html#/index";window.location.search&&(i+=window.location.search),window.location.href=i}}await k.setAppearance(),await k.setFontList();const s=await pt()||{};if(f.set(p("TreeSort-backend"),s["basic.defaultSort"]??"1"),f.set(p("open-backend"),s["basic.defaultOpen"]??"0"),(f.get(p("user.token"))||n)&&!t.path.startsWith("/de-link/"))if(W.getUid||await W.setUser(),t.path==="/login")r({path:"/workbranch/index"});else{if(d.setCurrentPath(t.path),d.getIsAddRouters){let e="";if((m.query.redirect||"?").split("?")[0]===t.path&&(e=(window.location.hash||"?").split("?").reverse()[0],e.includes("redirect=")&&(e="")),e&&(t.fullPath+="?"+e,t.query=e.split("&").reduce((g,A)=>{const[O,q]=A.split("=");return g[O]=q,g},{})),!_(t.path)&&t.path!=="/404"&&!t.path.startsWith("/de-link")){const g=C();r({path:g||"/404"});return}r();return}let o=await nt()||[];n&&(o=o.filter(e=>e.name!=="system"));const i=o;i.forEach(e=>e.top=!0),await d.generateRoutes(i),d.getAddRouters.forEach(e=>{S.addRoute(e)});const h=m.query.redirect||t.path,c=decodeURIComponent(h),l=t.path===c?{...t,replace:!0}:{path:c};if(d.setIsAddRouters(!0),await ft.initInteractive(!0),!_(t.path)&&t.path!=="/404"&&!t.path.startsWith("/de-link")){const e=C();r({path:e||"/404"});return}r(l)}else if(T().getToken&&b.getIsIframe&&bt.includes(t.path)){if(t.path.includes("/dataset-form")){r({path:"/dataset-embedded-form",query:t.query});return}d.setCurrentPath(t.path),r()}else!u&&kt.includes(t.path)||gt.includes(t.path)||t.path.startsWith("/de-link/")?(await k.setFontList(),d.setCurrentPath(t.path),r()):r(`/login?redirect=${t.fullPath||t.path}`)});S.afterEach(()=>{R(),x()});const{wsCache:w}=I();let a;const St={install(){const t=[{topic:"/task-export-topic",event:"task-export-topic-call"},{topic:"/report-notice",event:"report-notice-call"}];function m(){return w.get(p("app.desktop"))?!0:w.get(p("user.token"))&&w.get(p("user.uid"))}function r(){var c;if(!m()||a&&a.connected)return;let s="/";(c=window.DataEaseBi)!=null&&c.baseUrl?s=window.DataEaseBi.baseUrl:s=location.origin+location.pathname,s.endsWith("/")||(s+="/");const o=w.get(p("app.desktop"))?1:w.get(p("user.uid")),i=new lt(s+"websocket?userId="+o);a=ut.over(i);const h={userId:o};a.connect(h,()=>{t.forEach(l=>{a.subscribe("/user/"+o+l.topic,e=>{e&&e.body&&E().emitter.emit(l.event,e.body)})})},l=>{u(),console.error("连接失败: "+l)})}function u(){a&&a.connected&&a.disconnect(function(){console.info("断开连接")},function(s){console.info("断开连接失败: "+s)}),a=null}function n(){r(),setInterval(()=>{if(!m()){u();return}(!a||!a.connected)&&r()},5e3)}n()}},Pt=async()=>{const t=G(dt);st(t),B(t),await Y(t),Z(t),j(t),it(t),F(t),t.use(St),t.mount("#app")};Pt();

import{u as E,a as W,c as q,g as n,i as D,b as L,d as U,e as B,s as $,f as j,h as F}from"../assets/chunk/index-0.0.0-dataease.js";import{d as M,r as T,ae as N,o as P,T as v,U as Q,u as V,W as z,at as J}from"../assets/chunk/@vue-0.0.0-dataease.js";/* empty css                                          */import"../assets/chunk/@antv-0.0.0-dataease.js";import{_ as G,u as H,a as K,r as S,p as y,g as _,s as X,b as Y}from"../assets/chunk/ConfigGlobal.vue_vue_type_script_setup_true_lang-0.0.0-dataease.js";import{u as Z}from"../assets/chunk/vue-router_2-0.0.0-dataease.js";import{_ as tt}from"../assets/chunk/ExportExcel.vue_vue_type_style_index_0_lang-0.0.0-dataease.js";import{u as et,a as rt,s as it}from"../assets/chunk/usePageLoading-0.0.0-dataease.js";import{installDirective as ot}from"../assets/chunk/index-0.0.0-dataease2.js";import{useAppStoreWithOut as at}from"../assets/chunk/app-0.0.0-dataease.js";import{getDefaultSettings as st,getRoleRouters as pt}from"../assets/chunk/common-0.0.0-dataease.js";import{i as nt}from"../assets/chunk/interactive-0.0.0-dataease.js";import{useAppearanceStoreWithOut as mt}from"../assets/chunk/appearance-0.0.0-dataease.js";import{S as ct}from"../assets/chunk/sockjs-client-0.0.0-dataease.js";import{S as lt}from"../assets/chunk/stompjs-0.0.0-dataease.js";import"../assets/chunk/mitt-0.0.0-dataease.js";import"../assets/chunk/web-storage-cache-0.0.0-dataease.js";import"../assets/chunk/@amap-0.0.0-dataease.js";import"../assets/chunk/element-plus-secondary-0.0.0-dataease.js";import"../assets/chunk/@vueuse-0.0.0-dataease.js";import"../assets/chunk/@element-plus-0.0.0-dataease.js";import"../assets/chunk/lodash-es-0.0.0-dataease.js";import"../assets/chunk/dayjs-0.0.0-dataease.js";import"../assets/chunk/@popperjs-0.0.0-dataease.js";import"../assets/chunk/async-validator-0.0.0-dataease.js";import"../assets/chunk/@ctrl-0.0.0-dataease.js";import"../assets/chunk/normalize-wheel-es-0.0.0-dataease.js";import"../assets/chunk/memoize-one-0.0.0-dataease.js";import"../assets/chunk/vue-types-0.0.0-dataease.js";import"../assets/chunk/is-plain-object-0.0.0-dataease.js";import"../assets/chunk/pinia-0.0.0-dataease.js";import"../assets/chunk/vue-demi-0.0.0-dataease.js";import"../assets/chunk/eventemitter3-0.0.0-dataease.js";import"../assets/chunk/lodash-0.0.0-dataease.js";import"../assets/chunk/@mapbox-0.0.0-dataease.js";import"../assets/chunk/pbf-0.0.0-dataease.js";import"../assets/chunk/ieee754-0.0.0-dataease.js";import"../assets/chunk/supercluster-0.0.0-dataease.js";import"../assets/chunk/@babel-0.0.0-dataease.js";import"../assets/chunk/gl-matrix-0.0.0-dataease.js";import"../assets/chunk/tslib-0.0.0-dataease.js";import"../assets/chunk/detect-browser-0.0.0-dataease.js";import"../assets/chunk/size-sensor-0.0.0-dataease.js";import"../assets/chunk/d3-regression-0.0.0-dataease.js";import"../assets/chunk/d3-hierarchy-0.0.0-dataease.js";import"../assets/chunk/fmin-0.0.0-dataease.js";import"../assets/chunk/pdfast-0.0.0-dataease.js";import"../assets/chunk/d3-ease-0.0.0-dataease.js";import"../assets/chunk/d3-interpolate-0.0.0-dataease.js";import"../assets/chunk/d3-color-0.0.0-dataease.js";import"../assets/chunk/d3-timer-0.0.0-dataease.js";import"../assets/chunk/fecha-0.0.0-dataease.js";import"../assets/chunk/topojson-client-0.0.0-dataease.js";import"../assets/chunk/viewport-mercator-project-0.0.0-dataease.js";import"../assets/chunk/@turf-0.0.0-dataease.js";import"../assets/chunk/polygon-clipping-0.0.0-dataease.js";import"../assets/chunk/splaytree-0.0.0-dataease.js";import"../assets/chunk/robust-predicates-0.0.0-dataease.js";import"../assets/chunk/d3-scale-0.0.0-dataease.js";import"../assets/chunk/d3-collection-0.0.0-dataease.js";import"../assets/chunk/d3-format-0.0.0-dataease.js";import"../assets/chunk/d3-time-format-0.0.0-dataease.js";import"../assets/chunk/d3-time-0.0.0-dataease.js";import"../assets/chunk/d3-array-0.0.0-dataease.js";import"../assets/chunk/earcut-0.0.0-dataease.js";import"../assets/chunk/regl-0.0.0-dataease.js";import"../assets/chunk/mapbox-gl-0.0.0-dataease.js";import"../assets/chunk/d3-dsv-0.0.0-dataease.js";import"../assets/chunk/geojson-vt-0.0.0-dataease.js";import"../assets/chunk/hammerjs-0.0.0-dataease.js";import"../assets/chunk/element-resize-detector-0.0.0-dataease.js";import"../assets/chunk/batch-processor-0.0.0-dataease.js";import"../assets/chunk/d3-hexbin-0.0.0-dataease.js";import"../assets/chunk/axios-0.0.0-dataease.js";import"../assets/chunk/qs-0.0.0-dataease.js";import"../assets/chunk/side-channel-0.0.0-dataease.js";import"../assets/chunk/es-errors-0.0.0-dataease.js";import"../assets/chunk/object-inspect-0.0.0-dataease.js";import"../assets/chunk/crypto-js-0.0.0-dataease.js";import"../assets/chunk/side-channel-list-0.0.0-dataease.js";import"../assets/chunk/side-channel-map-0.0.0-dataease.js";import"../assets/chunk/get-intrinsic-0.0.0-dataease.js";import"../assets/chunk/es-object-atoms-0.0.0-dataease.js";import"../assets/chunk/math-intrinsics-0.0.0-dataease.js";import"../assets/chunk/gopd-0.0.0-dataease.js";import"../assets/chunk/es-define-property-0.0.0-dataease.js";import"../assets/chunk/has-symbols-0.0.0-dataease.js";import"../assets/chunk/get-proto-0.0.0-dataease.js";import"../assets/chunk/dunder-proto-0.0.0-dataease.js";import"../assets/chunk/call-bind-apply-helpers-0.0.0-dataease.js";import"../assets/chunk/function-bind-0.0.0-dataease.js";import"../assets/chunk/hasown-0.0.0-dataease.js";import"../assets/chunk/call-bound-0.0.0-dataease.js";import"../assets/chunk/side-channel-weakmap-0.0.0-dataease.js";import"../assets/chunk/jspdf-0.0.0-dataease.js";import"../assets/chunk/fflate-0.0.0-dataease.js";import"../assets/chunk/fast-png-0.0.0-dataease.js";import"../assets/chunk/iobuffer-0.0.0-dataease.js";import"../assets/chunk/pako-0.0.0-dataease.js";import"../assets/chunk/vue-0.0.0-dataease.js";import"../assets/chunk/vue-i18n-0.0.0-dataease.js";import"../assets/chunk/@intlify-0.0.0-dataease.js";import"../assets/chunk/echarts-0.0.0-dataease.js";import"../assets/chunk/zrender-0.0.0-dataease.js";import"../assets/chunk/tinymce-0.0.0-dataease.js";import"../assets/chunk/icon_download_outlined-0.0.0-dataease.js";import"../assets/chunk/de-delete-0.0.0-dataease.js";import"../assets/chunk/icon_refresh_outlined-0.0.0-dataease.js";import"../assets/chunk/EmptyBackground-0.0.0-dataease.js";import"../assets/chunk/none-0.0.0-dataease.js";import"../assets/chunk/nothing-tree-0.0.0-dataease.js";import"../assets/chunk/_plugin-vue_export-helper-0.0.0-dataease.js";import"../assets/chunk/dataset-0.0.0-dataease.js";import"../assets/chunk/js-base64-0.0.0-dataease.js";import"../assets/chunk/GridTable-0.0.0-dataease.js";import"../assets/chunk/nprogress-0.0.0-dataease.js";import"../assets/chunk/login-0.0.0-dataease.js";import"../assets/chunk/dataVisualization-0.0.0-dataease.js";import"../assets/chunk/datasource-0.0.0-dataease.js";import"../assets/chunk/font-0.0.0-dataease.js";import"../assets/chunk/less-0.0.0-dataease.js";import"../assets/chunk/copy-anything-0.0.0-dataease.js";import"../assets/chunk/is-what-0.0.0-dataease.js";import"../assets/chunk/net-0.0.0-dataease.js";import"../assets/chunk/websocket-0.0.0-dataease.js";import"../assets/chunk/es5-ext-0.0.0-dataease.js";const ut=M({__name:"App",setup(t){const l=Z(),o=T();return E({name:"data-export-center",callback:p=>{o.value.init(p)}}),(p,a)=>{const r=N("router-view");return P(),v(G,null,{default:Q(()=>[(P(),v(r,{key:V(l).path})),z(tt,{ref_key:"exportExcelRef",ref:o},null,512)]),_:1})}}}),b=mt(),{wsCache:h}=W(),u=H(),dt=nt(),C=K(),k=at(),{start:ft,done:R}=et(),{loadStart:ht,loadDone:x}=rt(),wt=["/login","/de-link","/chart-view","/admin-login","/401"],gt=["/dvCanvas","/dashboard","/preview","/dataset-embedded-form"],bt=["/dataset-embedded","/dataset-form","/dataset-embedded-form"];S.beforeEach(async(t,l,o)=>{ft(),ht();const d=q();let p=h.get(n("app.desktop"));if(p===null)try{await k.setAppModel(),p=k.getDesktop}catch(r){console.log(r)}if(D()&&!["/chart-view"].includes(t.path)){if(R(),x(),t.name==="link"){let r="";if(Object.keys(t.query)){const c=Object.keys(t.query).map(e=>e+"="+t.query[e]).join("&");c&&(r="?"+c)}let i=window.location.pathname;i=i.replace("casbi/",""),i=i.replace("oidc/",""),i=i.substring(0,i.length-1);const f=window.origin+i;let m=t.fullPath;m.includes("?")&&(m=t.fullPath.substring(0,t.fullPath.lastIndexOf("?"))),window.location.href=f+"/mobile.html#"+m+r}else if(h.get(n("user.token"))||p||!L()&&!U()){let r=window.location.pathname;r=r.substring(0,r.length-1);let i=window.origin+r+"/mobile.html#/index";window.location.search&&(i+=window.location.search),window.location.href=i}}await b.setAppearance(),await b.setFontList();const a=await st()||{};if(h.set(n("TreeSort-backend"),a["basic.defaultSort"]??"1"),h.set(n("open-backend"),a["basic.defaultOpen"]??"0"),(h.get(n("user.token"))||p)&&!t.path.startsWith("/de-link/"))if(C.getUid||await C.setUser(),t.path==="/login")o({path:"/workbranch/index"});else{if(u.setCurrentPath(t.path),u.getIsAddRouters){let e="";if((l.query.redirect||"?").split("?")[0]===t.path&&(e=(window.location.hash||"?").split("?").reverse()[0],e.includes("redirect=")&&(e="")),e&&(t.fullPath+="?"+e,t.query=e.split("&").reduce((g,I)=>{const[A,O]=I.split("=");return g[A]=O,g},{})),!y(t.path)&&t.path!=="/404"&&!t.path.startsWith("/de-link")){const g=_();o({path:g||"/404"});return}o();return}let r=await pt()||[];p&&(r=r.filter(e=>e.name!=="system"));const i=r;i.forEach(e=>e.top=!0),await u.generateRoutes(i),u.getAddRouters.forEach(e=>{S.addRoute(e)});const f=l.query.redirect||t.path,m=decodeURIComponent(f),c=t.path===m?{...t,replace:!0}:{path:m};if(u.setIsAddRouters(!0),await dt.initInteractive(!0),!y(t.path)&&t.path!=="/404"&&!t.path.startsWith("/de-link")){const e=_();o({path:e||"/404"});return}o(c)}else if(B().getToken&&k.getIsIframe&&bt.includes(t.path)){if(t.path.includes("/dataset-form")){o({path:"/dataset-embedded-form",query:t.query});return}u.setCurrentPath(t.path),o()}else!d&&gt.includes(t.path)||wt.includes(t.path)||t.path.startsWith("/de-link/")?(await b.setFontList(),u.setCurrentPath(t.path),o()):o(`/login?redirect=${t.fullPath||t.path}`)});S.afterEach(()=>{R(),x()});const{wsCache:w}=W();let s;const kt={install(){const t=[{topic:"/task-export-topic",event:"task-export-topic-call"},{topic:"/report-notice",event:"report-notice-call"}];function l(){return w.get(n("app.desktop"))?!0:w.get(n("user.token"))&&w.get(n("user.uid"))}function o(){var m;if(!l()||s&&s.connected)return;let a="/";(m=window.DataEaseBi)!=null&&m.baseUrl?a=window.DataEaseBi.baseUrl:a=location.origin+location.pathname,a.endsWith("/")||(a+="/");const r=w.get(n("app.desktop"))?1:w.get(n("user.uid")),i=new ct(a+"websocket?userId="+r);s=lt.over(i);const f={userId:r};s.connect(f,()=>{t.forEach(c=>{s.subscribe("/user/"+r+c.topic,e=>{e&&e.body&&E().emitter.emit(c.event,e.body)})})},c=>{d(),console.error("连接失败: "+c)})}function d(){s&&s.connected&&s.disconnect(function(){console.info("断开连接")},function(a){console.info("断开连接失败: "+a)}),s=null}function p(){o(),setInterval(()=>{if(!l()){d();return}(!s||!s.connected)&&o()},5e3)}p()}},St=async()=>{const t=J(ut);ot(t),$(t),await X(t),Y(t),j(t),it(t),F(t),t.use(kt),t.mount("#app")};St();
